---
title: aaaTransactions et Modes de verrouillage dans Azure Service Fabric fiable Collections | Documents Microsoft
description: "Verrouillage et transactions des collections fiables et gestionnaire d’état fiable Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="f4d07-103">Modes Transactions et Verrouillage dans les Collections fiables Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="f4d07-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="f4d07-104">Transaction</span><span class="sxs-lookup"><span data-stu-id="f4d07-104">Transaction</span></span>
<span data-ttu-id="f4d07-105">Une transaction est une séquence d’opérations effectuées en tant qu’unité logique de travail unique.</span><span class="sxs-lookup"><span data-stu-id="f4d07-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="f4d07-106">Une transaction doit présenter hello propriétés ACID suivantes.</span><span class="sxs-lookup"><span data-stu-id="f4d07-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="f4d07-107">(voir : https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="f4d07-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="f4d07-108">**Atomicité** : une transaction doit correspondre à une unité de travail atomique.</span><span class="sxs-lookup"><span data-stu-id="f4d07-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="f4d07-109">En d’autres termes, soit toutes les modifications de données sont effectuées, soit aucune n’est effectuée.</span><span class="sxs-lookup"><span data-stu-id="f4d07-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="f4d07-110">**Cohérence** : une fois terminée, une transaction doit laisser toutes les données dans un état cohérent.</span><span class="sxs-lookup"><span data-stu-id="f4d07-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="f4d07-111">Toutes les structures de données internes doivent être corrects à fin hello de transaction de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="f4d07-112">**Isolation**: les Modifications apportées par les transactions simultanées doivent être isolées des modifications de hello effectuées par d’autres transactions simultanées.</span><span class="sxs-lookup"><span data-stu-id="f4d07-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="f4d07-113">niveau d’isolation de Hello utilisé pour une opération dans une ITransaction est déterminé par hello IReliableState une opération de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="f4d07-114">**Durabilité**: une fois une transaction terminée, ses effets sont définitivement en place dans le système de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="f4d07-115">modifications de Hello sont conservées même en cas de hello une défaillance du système.</span><span class="sxs-lookup"><span data-stu-id="f4d07-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="f4d07-116">Niveaux d'isolement</span><span class="sxs-lookup"><span data-stu-id="f4d07-116">Isolation levels</span></span>
<span data-ttu-id="f4d07-117">Niveau d’isolement définit le degré de hello transaction de hello toowhich doit être isolée des modifications apportées par d’autres transactions.</span><span class="sxs-lookup"><span data-stu-id="f4d07-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="f4d07-118">Il existe deux niveaux d'isolement pris en charge dans les Collections fiables :</span><span class="sxs-lookup"><span data-stu-id="f4d07-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="f4d07-119">**Lecture renouvelable**: Spécifie que les instructions ne peuvent pas lire les données qui a été modifiées mais pas encore validées par d’autres transactions et qu’aucune autre transaction ne peut modifier les données qui a été lu par la transaction en cours hello jusqu'à hello en cours fin de la transaction.</span><span class="sxs-lookup"><span data-stu-id="f4d07-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="f4d07-120">Pour plus d’informations, consultez la page [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4d07-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="f4d07-121">**Instantané**: Spécifie que les données lues par n’importe quelle instruction dans une transaction sont la version cohérente de hello de données hello qui existaient au début de hello de transaction de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="f4d07-122">transaction de Hello peut reconnaître seulement les modifications de données qui ont été validées avant le début de hello de transaction de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="f4d07-123">Modifications de données effectuées par d’autres transactions après hello de début de la transaction en cours hello ne sont pas visibles toostatements l’exécution de la transaction en cours hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="f4d07-124">Hello se comme si les instructions de hello dans une transaction obtenaient un instantané des données de hello validée telles qu’elles existaient au début de hello de transaction de hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="f4d07-125">Les instantanés sont cohérents sur les Collections fiables.</span><span class="sxs-lookup"><span data-stu-id="f4d07-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="f4d07-126">Pour plus d’informations, consultez la page [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="f4d07-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="f4d07-127">Collections fiables choisissent automatiquement hello toouse de niveau d’isolation pour une opération de lecture donnée selon l’opération de hello et rôle hello du réplica de hello lors de la création de la transaction hello.</span><span class="sxs-lookup"><span data-stu-id="f4d07-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="f4d07-128">Voici la table hello qui décrit les valeurs par défaut au niveau d’isolation pour les opérations de dictionnaire fiable et de file d’attente.</span><span class="sxs-lookup"><span data-stu-id="f4d07-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="f4d07-129">Fonctionnement \ Rôle</span><span class="sxs-lookup"><span data-stu-id="f4d07-129">Operation \ Role</span></span> | <span data-ttu-id="f4d07-130">Primaire</span><span class="sxs-lookup"><span data-stu-id="f4d07-130">Primary</span></span> | <span data-ttu-id="f4d07-131">Secondaire</span><span class="sxs-lookup"><span data-stu-id="f4d07-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="f4d07-132">Lecture d'une seule entité</span><span class="sxs-lookup"><span data-stu-id="f4d07-132">Single Entity Read</span></span> |<span data-ttu-id="f4d07-133">Lecture renouvelée</span><span class="sxs-lookup"><span data-stu-id="f4d07-133">Repeatable Read</span></span> |<span data-ttu-id="f4d07-134">Instantané</span><span class="sxs-lookup"><span data-stu-id="f4d07-134">Snapshot</span></span> |
| <span data-ttu-id="f4d07-135">Énumération, décompte</span><span class="sxs-lookup"><span data-stu-id="f4d07-135">Enumeration, Count</span></span> |<span data-ttu-id="f4d07-136">Instantané</span><span class="sxs-lookup"><span data-stu-id="f4d07-136">Snapshot</span></span> |<span data-ttu-id="f4d07-137">Instantané</span><span class="sxs-lookup"><span data-stu-id="f4d07-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="f4d07-138">`IReliableDictionary.TryGetValueAsync` et `IReliableQueue.TryPeekAsync` sont des exemples typiques d’opérations à une seule entité.</span><span class="sxs-lookup"><span data-stu-id="f4d07-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="f4d07-139">Hello dictionnaire fiable et hello file d’attente fiable prend en charge l’écrit votre lecture.</span><span class="sxs-lookup"><span data-stu-id="f4d07-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="f4d07-140">En d’autres termes, toute écriture dans une transaction ne sera visible tooa suivant lue qui appartient toohello la même transaction.</span><span class="sxs-lookup"><span data-stu-id="f4d07-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="f4d07-141">Verrous</span><span class="sxs-lookup"><span data-stu-id="f4d07-141">Locks</span></span>
<span data-ttu-id="f4d07-142">Dans les Collections fiable, implémentez de toutes les transactions rigoureux à deux phases de verrouillage : une transaction ne libère pas les verrous hello elle a acquis jusqu'à ce que la transaction de hello se termine avec un abandon ou une validation.</span><span class="sxs-lookup"><span data-stu-id="f4d07-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="f4d07-143">Dictionnaire fiable utilise le verrou au niveau des lignes pour toutes les opérations à une seule entité.</span><span class="sxs-lookup"><span data-stu-id="f4d07-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="f4d07-144">File d’attente fiable compense la concurrence par une propriété FIFO transactionnelle stricte.</span><span class="sxs-lookup"><span data-stu-id="f4d07-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="f4d07-145">File d’attente fiable utilise des verrous au niveau des opérations permettant une transaction avec `TryPeekAsync` et/ou `TryDequeueAsync`, et une transaction avec `EnqueueAsync` à la fois.</span><span class="sxs-lookup"><span data-stu-id="f4d07-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="f4d07-146">Notez que toopreserve FIFO, si un `TryPeekAsync` ou `TryDequeueAsync` jamais observe que hello fiable de file d’attente est vide, ils seront également verrouiller `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="f4d07-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="f4d07-147">Les opérations d’écriture prennent toujours des verrous exclusifs.</span><span class="sxs-lookup"><span data-stu-id="f4d07-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="f4d07-148">Pour les opérations de lecture, hello verrouillage dépend de plusieurs facteurs.</span><span class="sxs-lookup"><span data-stu-id="f4d07-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="f4d07-149">Les opérations de lecture effectuées à l’aide de l’isolement d’instantané ne sont pas verrouillées.</span><span class="sxs-lookup"><span data-stu-id="f4d07-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="f4d07-150">Les opérations de lecture renouvelée utilisent par défaut des verrous partagés.</span><span class="sxs-lookup"><span data-stu-id="f4d07-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="f4d07-151">Toutefois, pour toute opération de lecture qui prend en charge la lecture renouvelable, utilisateur de hello peut demander un verrou de mise à jour au lieu de hello verrou partagé.</span><span class="sxs-lookup"><span data-stu-id="f4d07-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="f4d07-152">Un verrou de mise à jour est qu'un verrou asymétrique utilisé tooprevent une forme courante d’interblocage se produit lorsque plusieurs transactions verrouillent les ressources pour les mises à jour potentielles à une date ultérieure.</span><span class="sxs-lookup"><span data-stu-id="f4d07-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="f4d07-153">Vous trouverez la matrice de compatibilité de verrouillage Hello Bonjour tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="f4d07-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="f4d07-154">Requête \ Accordé</span><span class="sxs-lookup"><span data-stu-id="f4d07-154">Request \ Granted</span></span> | <span data-ttu-id="f4d07-155">Aucun</span><span class="sxs-lookup"><span data-stu-id="f4d07-155">None</span></span> | <span data-ttu-id="f4d07-156">Partagé</span><span class="sxs-lookup"><span data-stu-id="f4d07-156">Shared</span></span> | <span data-ttu-id="f4d07-157">Mettre à jour</span><span class="sxs-lookup"><span data-stu-id="f4d07-157">Update</span></span> | <span data-ttu-id="f4d07-158">Exclusif</span><span class="sxs-lookup"><span data-stu-id="f4d07-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="f4d07-159">Partagé</span><span class="sxs-lookup"><span data-stu-id="f4d07-159">Shared</span></span> |<span data-ttu-id="f4d07-160">Aucun conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-160">No conflict</span></span> |<span data-ttu-id="f4d07-161">Aucun conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-161">No conflict</span></span> |<span data-ttu-id="f4d07-162">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-162">Conflict</span></span> |<span data-ttu-id="f4d07-163">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-163">Conflict</span></span> |
| <span data-ttu-id="f4d07-164">Mettre à jour</span><span class="sxs-lookup"><span data-stu-id="f4d07-164">Update</span></span> |<span data-ttu-id="f4d07-165">Aucun conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-165">No conflict</span></span> |<span data-ttu-id="f4d07-166">Aucun conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-166">No conflict</span></span> |<span data-ttu-id="f4d07-167">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-167">Conflict</span></span> |<span data-ttu-id="f4d07-168">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-168">Conflict</span></span> |
| <span data-ttu-id="f4d07-169">Exclusif</span><span class="sxs-lookup"><span data-stu-id="f4d07-169">Exclusive</span></span> |<span data-ttu-id="f4d07-170">Aucun conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-170">No conflict</span></span> |<span data-ttu-id="f4d07-171">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-171">Conflict</span></span> |<span data-ttu-id="f4d07-172">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-172">Conflict</span></span> |<span data-ttu-id="f4d07-173">Conflit</span><span class="sxs-lookup"><span data-stu-id="f4d07-173">Conflict</span></span> |

<span data-ttu-id="f4d07-174">Argument de délai d’attente Bonjour fiable API de Collections est utilisé pour la détection de blocage.</span><span class="sxs-lookup"><span data-stu-id="f4d07-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="f4d07-175">Par exemple, deux transactions (T1 et T2) essaient tooread et mettre à jour K1.</span><span class="sxs-lookup"><span data-stu-id="f4d07-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="f4d07-176">Il est possible de leur toodeadlock, car ils sont tous deux avoir hello des verrou partagé.</span><span class="sxs-lookup"><span data-stu-id="f4d07-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="f4d07-177">Dans ce cas, une ou les deux opérations de hello expire.</span><span class="sxs-lookup"><span data-stu-id="f4d07-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="f4d07-178">Ce scénario de blocage est un exemple illustrant parfaitement en quoi le verrou de mise à jour peut empêcher les blocages.</span><span class="sxs-lookup"><span data-stu-id="f4d07-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f4d07-179">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f4d07-179">Next steps</span></span>
* [<span data-ttu-id="f4d07-180">Utilisation des collections fiables</span><span class="sxs-lookup"><span data-stu-id="f4d07-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="f4d07-181">Notifications Reliable Services</span><span class="sxs-lookup"><span data-stu-id="f4d07-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="f4d07-182">Sauvegarde et restauration de Reliable Services (récupération d’urgence)</span><span class="sxs-lookup"><span data-stu-id="f4d07-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="f4d07-183">Configuration du Gestionnaire d’état fiable</span><span class="sxs-lookup"><span data-stu-id="f4d07-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="f4d07-184">Référence du développeur pour les Collections fiables</span><span class="sxs-lookup"><span data-stu-id="f4d07-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

