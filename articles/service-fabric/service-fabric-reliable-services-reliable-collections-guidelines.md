---
title: aaaGuidelines & recommandations pour les Collections fiable dans Azure Service Fabric | Documents Microsoft
description: "Instructions et recommandations relatives à l’utilisation de collections fiables Fabric Service"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: bcdbc9d013bc044e06c43761e7f515c7e4bf340c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="57aa8-103">Instructions et recommandations pour les collections fiables dans Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="57aa8-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="57aa8-104">Cette section fournit des instructions pour l’utilisation du gestionnaire d’état fiable et des collections fiables.</span><span class="sxs-lookup"><span data-stu-id="57aa8-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="57aa8-105">Hello vise toohelp utilisateurs évitent les pièges courants.</span><span class="sxs-lookup"><span data-stu-id="57aa8-105">hello goal is toohelp users avoid common pitfalls.</span></span>

<span data-ttu-id="57aa8-106">les instructions Hello sont organisées comme des recommandations simples ci-après préfixés avec les termes du contrat de hello *faire*, *envisagez*, *Évitez* et *pas*.</span><span class="sxs-lookup"><span data-stu-id="57aa8-106">hello guidelines are organized as simple recommendations prefixed with hello terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="57aa8-107">Ne modifiez pas un objet de type personnalisé renvoyé par les opérations de lecture (par exemple, `TryPeekAsync` ou `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="57aa8-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="57aa8-108">Collections fiables, tout comme les Collections simultanées, retournent un toohello des objets de référence et non une copie.</span><span class="sxs-lookup"><span data-stu-id="57aa8-108">Reliable Collections, just like Concurrent Collections, return a reference toohello objects and not a copy.</span></span>
* <span data-ttu-id="57aa8-109">Faire hello en copie complète a retourné d’objet d’un type personnalisé avant de le modifier.</span><span class="sxs-lookup"><span data-stu-id="57aa8-109">Do deep copy hello returned object of a custom type before modifying it.</span></span> <span data-ttu-id="57aa8-110">Étant donné que les structures et les types intégrés sont passés par valeur, vous n’avez pas besoin de toodo une copie complète sur les.</span><span class="sxs-lookup"><span data-stu-id="57aa8-110">Since structs and built-in types are pass-by-value, you do not need toodo a deep copy on them.</span></span>
* <span data-ttu-id="57aa8-111">N’utilisez pas `TimeSpan.MaxValue` pour les délais d’attente.</span><span class="sxs-lookup"><span data-stu-id="57aa8-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="57aa8-112">Délais d’expiration doivent être utilisé toodetect blocages.</span><span class="sxs-lookup"><span data-stu-id="57aa8-112">Time-outs should be used toodetect deadlocks.</span></span>
* <span data-ttu-id="57aa8-113">N’utilisez pas une transaction une fois qu’elle a été validée, abandonnée ou supprimée.</span><span class="sxs-lookup"><span data-stu-id="57aa8-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="57aa8-114">N’utilisez pas une énumération en dehors de l’étendue de transaction hello qu'il a été créé.</span><span class="sxs-lookup"><span data-stu-id="57aa8-114">Do not use an enumeration outside of hello transaction scope it was created in.</span></span>
* <span data-ttu-id="57aa8-115">Ne créez pas une transaction au sein de l’instruction `using` d’une autre transaction, car cela peut provoquer des blocages.</span><span class="sxs-lookup"><span data-stu-id="57aa8-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="57aa8-116">Assurez-vous que votre implémentation de `IComparable<TKey>` est correcte.</span><span class="sxs-lookup"><span data-stu-id="57aa8-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="57aa8-117">système de Hello prend la dépendance `IComparable<TKey>` pour fusionner des points de contrôle et des lignes.</span><span class="sxs-lookup"><span data-stu-id="57aa8-117">hello system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="57aa8-118">Utilisez le verrou de mise à jour lors de la lecture d’un élément avec un tooupdate intention il tooprevent une certaine classe de blocages.</span><span class="sxs-lookup"><span data-stu-id="57aa8-118">Do use Update lock when reading an item with an intention tooupdate it tooprevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="57aa8-119">Envisagez de vos éléments (par exemple, TKey + TValue dictionnaire fiable) ci-dessous 80 kilo-octets : hello plus petit mieux.</span><span class="sxs-lookup"><span data-stu-id="57aa8-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller hello better.</span></span> <span data-ttu-id="57aa8-120">Cela réduit hello des spécifications d’e/s de tas des objets volumineux d’utilisation, ainsi que de disque et réseau.</span><span class="sxs-lookup"><span data-stu-id="57aa8-120">This reduces hello amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="57aa8-121">Souvent, il réduit la réplication des données en double lorsque qu’une petite partie de la valeur de hello est en cours de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="57aa8-121">Often, it reduces replicating duplicate data when only one small part of hello value is being updated.</span></span> <span data-ttu-id="57aa8-122">Tooachieve de manière commune dans le dictionnaire fiable, est toobreak les lignes dans les lignes de toomultiple.</span><span class="sxs-lookup"><span data-stu-id="57aa8-122">Common way tooachieve this in Reliable Dictionary, is toobreak your rows in toomultiple rows.</span></span>
* <span data-ttu-id="57aa8-123">Envisagez d’utiliser la sauvegarde et de restauration de la récupération d’urgence toohave fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="57aa8-123">Consider using backup and restore functionality toohave disaster recovery.</span></span>
* <span data-ttu-id="57aa8-124">Évitez de combiner des opérations d’entité unique et les opérations de plusieurs entités (par exemple `GetCountAsync`, `CreateEnumerableAsync`) Bonjour même échéance toohello différents niveaux d’isolation de la transaction.</span><span class="sxs-lookup"><span data-stu-id="57aa8-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in hello same transaction due toohello different isolation levels.</span></span>
* <span data-ttu-id="57aa8-125">Gérez l’exception InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="57aa8-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="57aa8-126">Les transactions utilisateur peuvent être annulées par le système hello pour diverses raisons.</span><span class="sxs-lookup"><span data-stu-id="57aa8-126">User transactions can be aborted by hello system for variety of reasons.</span></span> <span data-ttu-id="57aa8-127">Par exemple, lorsque hello fiable Gestionnaire d’état change son rôle de principal ou lorsqu’une transaction à long terme bloque la troncation du journal des transactions hello.</span><span class="sxs-lookup"><span data-stu-id="57aa8-127">For example, when hello Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of hello transactional log.</span></span> <span data-ttu-id="57aa8-128">Dans ce cas, l’utilisateur peut recevoir l’exception InvalidOperationException, indiquant que sa transaction a déjà été terminée.</span><span class="sxs-lookup"><span data-stu-id="57aa8-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="57aa8-129">En supposant que, arrêt hello de transaction de hello n’a pas été demandé par l’utilisateur de hello, meilleure manière toohandle cette exception est la transaction de hello toodispose, vérifiez si le jeton d’annulation hello a été signalé (ou rôle hello du réplica de hello a été modifié) et dans le cas contraire créer une nouvelle transaction et une nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="57aa8-129">Assuming, hello termination of hello transaction was not requested by hello user, best way toohandle this exception is toodispose hello transaction, check if hello cancellation token has been signaled (or hello role of hello replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="57aa8-130">Voici certains tookeep choses à l’esprit :</span><span class="sxs-lookup"><span data-stu-id="57aa8-130">Here are some things tookeep in mind:</span></span>

* <span data-ttu-id="57aa8-131">le délai d’attente de Hello par défaut est quatre secondes pour hello toutes les API de Collection fiable.</span><span class="sxs-lookup"><span data-stu-id="57aa8-131">hello default time-out is four seconds for all hello Reliable Collection APIs.</span></span> <span data-ttu-id="57aa8-132">La plupart des utilisateurs doivent utiliser le délai d’attente de hello par défaut.</span><span class="sxs-lookup"><span data-stu-id="57aa8-132">Most users should use hello default time-out.</span></span>
* <span data-ttu-id="57aa8-133">Bonjour jeton d’annulation par défaut est `CancellationToken.None` dans toutes les API de Collections fiable.</span><span class="sxs-lookup"><span data-stu-id="57aa8-133">hello default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="57aa8-134">Hello du paramètre de type de clé (*TKey*) pour un dictionnaire fiable doit implémenter correctement `GetHashCode()` et `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="57aa8-134">hello key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="57aa8-135">Les clés doivent être immuables.</span><span class="sxs-lookup"><span data-stu-id="57aa8-135">Keys must be immutable.</span></span>
* <span data-ttu-id="57aa8-136">tooachieve haute disponibilité pour hello Collections fiable, chaque service doit avoir au moins une cible et un réplica minimum définir la taille de 3.</span><span class="sxs-lookup"><span data-stu-id="57aa8-136">tooachieve high availability for hello Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="57aa8-137">Les opérations de lecture sur hello secondaire peuvent lire les versions qui ne sont pas validée de quorum.</span><span class="sxs-lookup"><span data-stu-id="57aa8-137">Read operations on hello secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="57aa8-138">Cela signifie qu’une version des données lue à partir d’un seul secondaire peut présenter une progression erronée.</span><span class="sxs-lookup"><span data-stu-id="57aa8-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="57aa8-139">Les lectures à partir du principal sont toujours stables : la progression n’est jamais erronée.</span><span class="sxs-lookup"><span data-stu-id="57aa8-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="57aa8-140">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="57aa8-140">Next steps</span></span>
* [<span data-ttu-id="57aa8-141">Utilisation des collections fiables</span><span class="sxs-lookup"><span data-stu-id="57aa8-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="57aa8-142">Transactions et verrous</span><span class="sxs-lookup"><span data-stu-id="57aa8-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="57aa8-143">Gestionnaire d’état fiable et éléments internes de collections</span><span class="sxs-lookup"><span data-stu-id="57aa8-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="57aa8-144">Gestion des données</span><span class="sxs-lookup"><span data-stu-id="57aa8-144">Managing Data</span></span>
  * [<span data-ttu-id="57aa8-145">Sauvegarde et restauration</span><span class="sxs-lookup"><span data-stu-id="57aa8-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="57aa8-146">Notifications</span><span class="sxs-lookup"><span data-stu-id="57aa8-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="57aa8-147">Sérialisation et mise à niveau</span><span class="sxs-lookup"><span data-stu-id="57aa8-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="57aa8-148">Configuration du Gestionnaire d’état fiable</span><span class="sxs-lookup"><span data-stu-id="57aa8-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="57aa8-149">Autres</span><span class="sxs-lookup"><span data-stu-id="57aa8-149">Others</span></span>
  * [<span data-ttu-id="57aa8-150">Démarrage rapide de Reliable Services</span><span class="sxs-lookup"><span data-stu-id="57aa8-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="57aa8-151">Référence du développeur pour les Collections fiables</span><span class="sxs-lookup"><span data-stu-id="57aa8-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)
