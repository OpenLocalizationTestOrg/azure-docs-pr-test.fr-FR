---
title: "Modèle d’hébergement Azure Service Fabric | Microsoft Docs"
description: "Décrit la relation entre les réplicas (ou instances) d’un service Service Fabric déployé et le processus hôte du service."
services: service-fabric
documentationcenter: .net
author: harahma
manager: timlt
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/15/2017
ms.author: harahma
ms.openlocfilehash: ca7092a06a9ffce8383ca8bc9f70ce312cdf9de4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="service-fabric-hosting-model"></a><span data-ttu-id="1a50f-103">Modèle d’hébergement Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1a50f-103">Service Fabric hosting model</span></span>
<span data-ttu-id="1a50f-104">Cet article fournit une vue d’ensemble des modèles d’hébergement d’applications fournis par Service Fabric et décrit les différences entre les modèles à **processus partagé** et à **processus exclusif**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-104">This article provides an overview of application hosting models provided by Service Fabric, and describes the differences between the **Shared Process** and **Exclusive Process** models.</span></span> <span data-ttu-id="1a50f-105">Il décrit le fonctionnement d’une application déployée sur un nœud Service Fabric et présente la relation entre les réplicas (ou instances) du service et le processus hôte du service.</span><span class="sxs-lookup"><span data-stu-id="1a50f-105">It describes how a deployed application looks on a Service Fabric node and relationship between replicas (or instances) of the service and the service-host process.</span></span>

<span data-ttu-id="1a50f-106">Avant de continuer, veillez à vous familiariser avec le [modèle d’application Service Fabric][a1] et à comprendre les différents concepts et leurs relations.</span><span class="sxs-lookup"><span data-stu-id="1a50f-106">Before proceeding further, make sure that you are familiar with [Service Fabric Application Model][a1] and understand various concepts and relation among them.</span></span> 

> [!NOTE]
> <span data-ttu-id="1a50f-107">Dans cet article, par souci de simplicité et sauf indication contraire :</span><span class="sxs-lookup"><span data-stu-id="1a50f-107">In this article, for simplicity, unless explicitly mentioned:</span></span>
>
> - <span data-ttu-id="1a50f-108">Le terme *réplica* fait référence à la fois au réplica d’un service avec état et à une instance d’un service sans état.</span><span class="sxs-lookup"><span data-stu-id="1a50f-108">All uses of word *replica* refers to both a replica of a stateful service or an instance of a statless service.</span></span>
> - <span data-ttu-id="1a50f-109">*CodePackage* est traité de la même manière que le processus *ServiceHost*, qui inscrit un *ServiceType* et héberge des réplicas de services du même *ServiceType*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-109">*CodePackage* is treated equivalent to *ServiceHost* process that registers a *ServiceType* and hosts replicas of services of that *ServiceType*.</span></span>
>

<span data-ttu-id="1a50f-110">Pour comprendre le modèle d’hébergement, commençons par un exemple.</span><span class="sxs-lookup"><span data-stu-id="1a50f-110">To understand the hosting model, let us walk through an example.</span></span> <span data-ttu-id="1a50f-111">Supposons que nous avons un *ApplicationType* appelé « MyAppType » qui possède un *ServiceType* « MyServiceType » fourni par le *ServicePackage* « MyServicePackage », lequel possède un *CodePackage* « MyCodePackage » qui inscrit le *ServiceType* « MyServiceType » lors de son exécution.</span><span class="sxs-lookup"><span data-stu-id="1a50f-111">Let us say, we have an *ApplicationType* 'MyAppType' which has a *ServiceType* 'MyServiceType' which is provided by *ServicePackage* 'MyServicePackage' which has a *CodePackage* 'MyCodePackage' which registers *ServiceType* 'MyServiceType' when it runs.</span></span>

<span data-ttu-id="1a50f-112">Imaginons que nous avons un cluster à 3 nœuds et que nous créons une *application* **fabric:/App1** de type « MyAppType ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-112">Let's say we have a 3 node cluster and we create an *application* **fabric:/App1** of type 'MyAppType'.</span></span> <span data-ttu-id="1a50f-113">À l’intérieur de cette *application* **fabric:/App1**, nous créons un service **fabric:/App1/ServiceA** de type « MyServiceType » qui comporte 2 partitions (par exemple, **P1** & **P2**) avec 3 réplicas par partition.</span><span class="sxs-lookup"><span data-stu-id="1a50f-113">Inside this *application* **fabric:/App1** we create a service **fabric:/App1/ServiceA** of type 'MyServiceType' which has 2 partitions (say **P1** & **P2**) and 3 replicas per partition.</span></span> <span data-ttu-id="1a50f-114">Le schéma suivant illustre la vue de cette application lorsqu’elle est déployée sur un nœud.</span><span class="sxs-lookup"><span data-stu-id="1a50f-114">The following diagram shows the view of this application as it ends up deployed on a node.</span></span>

<span data-ttu-id="1a50f-115"><center>
![Vue de l’application déployée sur un nœud][node-view-one]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-115"><center>
![Node view of deployed application][node-view-one]
</center></span></span>

<span data-ttu-id="1a50f-116">Service Fabric a activé « MyServicePackage », qui a démarré « MyCodePackage », lequel héberge les réplicas des deux partitions, c’est-à-dire **P1** & **P2**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-116">Service Fabric activated 'MyServicePackage' which started 'MyCodePackage' which is hosting replicas from both the partitions i.e. **P1** & **P2**.</span></span> <span data-ttu-id="1a50f-117">Notez que tous les nœuds du cluster auront la même vue puisque nous avons choisi un nombre de réplicas par partition égal au nombre de nœuds dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="1a50f-117">Note that all the nodes in the cluster will have same view since we chose number of replicas per partition equal to number of nodes in the cluster.</span></span> <span data-ttu-id="1a50f-118">Nous allons maintenant créer un autre service **fabric:/App1/ServiceB** dans l’application **fabric:/App1** qui comporte 1 partition (par exemple **P3**), avec 3 réplicas pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="1a50f-118">Let's create another service **fabric:/App1/ServiceB** in application **fabric:/App1** which has 1 partition (say **P3**) and 3 replicas per partition.</span></span> <span data-ttu-id="1a50f-119">Le schéma suivant illustre la nouvelle vue sur le nœud :</span><span class="sxs-lookup"><span data-stu-id="1a50f-119">Following diagram shows the new view on the node:</span></span>

<span data-ttu-id="1a50f-120"><center>
![Vue de l’application déployée sur un nœud][node-view-two]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-120"><center>
![Node view of deployed application][node-view-two]
</center></span></span>

<span data-ttu-id="1a50f-121">Comme nous pouvons le constater, Service Fabric a placé le nouveau réplica de la partition **P3** du service **fabric:/App1/ServiceB** dans l’activation existante de « MyServicePackage ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-121">As we can see Service Fabric placed the new replica for partition **P3** of service **fabric:/App1/ServiceB** in the existing activation of 'MyServicePackage'.</span></span> <span data-ttu-id="1a50f-122">Créons maintenant une autre *application* **fabric:/App2** de type « MyAppType » ; à l’intérieur de cette application **fabric:/App2**, nous allons créer le service **fabric: App2/ServiceA** qui comporte 2 partitions (par exemple **P4** & **P5**) avec 3 réplicas pour chaque partition.</span><span class="sxs-lookup"><span data-stu-id="1a50f-122">Now lets create another *application* **fabric:/App2** of type 'MyAppType' and inside **fabric:/App2** create service **fabric:/App2/ServiceA** which has 2 partitions (say **P4** & **P5**) and 3 replicas per partition.</span></span> <span data-ttu-id="1a50f-123">Le schéma suivant illustre la nouvelle vue du nœud :</span><span class="sxs-lookup"><span data-stu-id="1a50f-123">Following diagrams shows the new node view:</span></span>

<span data-ttu-id="1a50f-124"><center>
![Vue de l’application déployée sur un nœud][node-view-three]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-124"><center>
![Node view of deployed application][node-view-three]
</center></span></span>

<span data-ttu-id="1a50f-125">Cette fois, Service Fabric a activé une nouvelle copie de « MyServicePackage », qui démarre une nouvelle copie de « MyCodePackage », et les réplicas des deux partitions du service **fabric:/App2/ServiceA** (c’est-à-dire **P4** & **P5**) sont placés dans cette nouvelle copie « MyCodePackage ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-125">This time Service Fabric has activated a new copy of 'MyServicePackage' which starts a new copy of 'MyCodePackage' and replicas from both partitions of service **fabric:/App2/ServiceA** (i.e. **P4** & **P5**) are placed in this new copy 'MyCodePackage'.</span></span>

## <a name="shared-process-model"></a><span data-ttu-id="1a50f-126">Modèle à processus partagé</span><span class="sxs-lookup"><span data-stu-id="1a50f-126">Shared process model</span></span>
<span data-ttu-id="1a50f-127">Nous venons de voir le modèle d’hébergement par défaut fourni par Service Fabric, que l’on appelle le modèle à **processus partagé**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-127">What we saw above is the default hosting model provided by Service Fabric and is referred to as **Shared Process** model.</span></span> <span data-ttu-id="1a50f-128">Dans ce modèle, pour une *application* donnée, seule une copie d’un *ServicePackage* donné est activée sur un *nœud* (qui démarre tous les *CodePackages* qu’il contient) et tous les réplicas de tous les services d’un *ServiceType* donné sont placés dans le *CodePackage* qui inscrit ce *ServiceType*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-128">In this model, for a given *application*, only one copy of a given *ServicePackage* is activated on a *Node* (which starts all the *CodePackages* contained in it) and all the replicas of all services of a given  *ServiceType* are placed in the *CodePackage* that registers that *ServiceType*.</span></span> <span data-ttu-id="1a50f-129">En d’autres termes, tous les réplicas de tous les services d’un *ServiceType* donné partagent le même processus.</span><span class="sxs-lookup"><span data-stu-id="1a50f-129">In other words, all the replicas of all services of a given *ServiceType* share the same process.</span></span>

## <a name="exclusive-process-model"></a><span data-ttu-id="1a50f-130">Modèle à processus exclusif</span><span class="sxs-lookup"><span data-stu-id="1a50f-130">Exclusive process model</span></span>
<span data-ttu-id="1a50f-131">L’autre modèle d’hébergement fourni par Service Fabric est le modèle à **processus exclusif**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-131">The other hosting model provided by Service Fabric is **Exclusive Process** model.</span></span> <span data-ttu-id="1a50f-132">Dans ce modèle, sur un *nœud* donné, pour placer chaque réplica, Service Fabric active une nouvelle copie d’un *ServicePackage* (qui démarre tous les *CodePackages* qu’il contient) et le réplica est placé dans le *CodePackage* qui a inscrit le *ServiceType* du service auquel le réplica appartient.</span><span class="sxs-lookup"><span data-stu-id="1a50f-132">In this model, on a given *Node*, for placing each replica, Service Fabric activates a new copy of *ServicePackage* (which starts all the *CodePackages* contained in it) and replica is placed in the *CodePackage* that registered the *ServiceType* of the service to which replica belongs.</span></span> <span data-ttu-id="1a50f-133">En d’autres termes, chaque réplica réside dans son propre processus dédié.</span><span class="sxs-lookup"><span data-stu-id="1a50f-133">In other words, each replica lives in its own dedicated process.</span></span> 

<span data-ttu-id="1a50f-134">Ce modèle est pris en charge à partir de la version 5.6 de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1a50f-134">This model is supported starting version 5.6 of Service Fabric.</span></span> <span data-ttu-id="1a50f-135">Le modèle à **processus exclusif** peut être choisi au moment de la création du service (à l’aide de [PowerShell][p1], de [REST][r1] ou de [FabricClient][c1]) en spécifiant **ServicePackageActivationMode** en tant que « ExclusiveProcess ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-135">**Exclusive Process** model can be chosen at the time of creating the service (using [PowerShell][p1], [REST][r1] or [FabricClient][c1]) by specifying **ServicePackageActivationMode** as 'ExclusiveProcess'.</span></span>

```powershell
PS C:\>New-ServiceFabricService -ApplicationName "fabric:/App1" -ServiceName "fabric:/App1/ServiceA" -ServiceTypeName "MyServiceType" -Stateless -PartitionSchemeSingleton -InstanceCount -1 -ServicePackageActivationMode "ExclusiveProcess"
```

```csharp
var serviceDescription = new StatelessServiceDescription
{
    ApplicationName = new Uri("fabric:/App1"),
    ServiceName = new Uri("fabric:/App1/ServiceA"),
    ServiceTypeName = "MyServiceType",
    PartitionSchemeDescription = new SingletonPartitionSchemeDescription(),
    InstanceCount = -1,
    ServicePackageActivationMode = ServicePackageActivationMode.ExclusiveProcess
};

var fabricClient = new FabricClient(clusterEndpoints);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="1a50f-136">Si votre manifeste d’application comporte un service par défaut, vous pouvez choisir le modèle à **processus exclusif** en spécifiant l’attribut **ServicePackageActivationMode** comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="1a50f-136">If you have a default service in your application manifest, you can choose **Exclusive Process** model by specifying **ServicePackageActivationMode** attribute as shown below:</span></span>

```xml
<DefaultServices>
  <Service Name="MyService" ServicePackageActivationMode="ExclusiveProcess">
    <StatelessService ServiceTypeName="MyServiceType" InstanceCount="1">
      <SingletonPartition/>
    </StatelessService>
  </Service>
</DefaultServices>
```
<span data-ttu-id="1a50f-137">En poursuivant avec l’exemple ci-dessus, créons maintenant un autre service **fabric:/App1/ServiceC** dans l’application **fabric:/App1** qui comporte 2 partitions (par exemple **P6** & **P7**), avec 3 réplicas par partition et où **ServicePackageActivationMode** est défini sur « ExclusiveProcess ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-137">Continuing with our example above, lets create another service **fabric:/App1/ServiceC** in application **fabric:/App1** which has 2 partitions (say **P6** & **P7**) and 3 replicas per partition with **ServicePackageActivationMode** set to 'ExclusiveProcess'.</span></span> <span data-ttu-id="1a50f-138">Le schéma suivant illustre la nouvelle vue sur le nœud :</span><span class="sxs-lookup"><span data-stu-id="1a50f-138">Following diagram shows new view on the node:</span></span>

<span data-ttu-id="1a50f-139"><center>
![Vue de l’application déployée sur un nœud][node-view-four]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-139"><center>
![Node view of deployed application][node-view-four]
</center></span></span>

<span data-ttu-id="1a50f-140">Comme vous pouvez le voir, Service Fabric a activé deux nouvelles copies de « MyServicePackage » (une pour chaque réplica des partitions **P6** & **P7**) et placé chaque réplica dans sa copie dédiée de *CodePackage*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-140">As you can see, Service Fabric activated two new copies of 'MyServicePackage' (one for each replica from partition **P6** & **P7**) and placed each replica in its dedicated copy of *CodePackage*.</span></span> <span data-ttu-id="1a50f-141">Notez également que, lorsque le modèle à **processus exclusif** est utilisé, plusieurs copies d’un *ServicePackage* donné peuvent être actives sur un *nœud* pour une *application* donnée.</span><span class="sxs-lookup"><span data-stu-id="1a50f-141">Another thing to note here is, when **Exclusive Process** model is used, for a given *application*, multiple copies of a given *ServicePackage* can be active on a *Node*.</span></span> <span data-ttu-id="1a50f-142">Dans l’exemple ci-dessus, nous voyons que trois copies de « MyServicePackage » sont actives pour **fabric:/App1**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-142">In above example, we see that three copies of 'MyServicePackage' are active for **fabric:/App1**.</span></span> <span data-ttu-id="1a50f-143">Chacune de ces copies actives de « MyServicePackage » est associé à un **ServicePackageActivationId** qui identifie cette copie dans *l’application* **fabric:/App1**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-143">Each of these active copies of 'MyServicePackage' has a **ServicePackageAtivationId** associated with it which identifies that copy within *application* **fabric:/App1**.</span></span>

<span data-ttu-id="1a50f-144">Lorsque seul le modèle à **processus partagé** est utilisé pour une *application*, comme **fabric:/App2** dans l’exemple ci-dessus, il n’existe qu’une seule copie active de *ServicePackage* sur un *nœud* et le **ServicePackageActivationId** de cette activation de *ServicePackage* est « chaîne vide ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-144">When only **Shared Process** model is used for an *application*, like **fabric:/App2** in above example, there is only one active copy of *ServicePackage* on a *Node* and **ServicePackageAtivationId** for this activation of *ServicePackage* is 'empty string'.</span></span>

> [!NOTE]
>- <span data-ttu-id="1a50f-145">Le modèle d’hébergement à **processus partagé** correspond à un **ServicePackageActivationMode** égal à **SharedProcess**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-145">**Shared Process** hosting model corresponds to **ServicePackageAtivationMode** equal **SharedProcess**.</span></span> <span data-ttu-id="1a50f-146">Il s’agit du modèle d’hébergement par défaut et il n’est pas nécessaire de spécifier **ServicePackageActivationMode** au moment de la création du service.</span><span class="sxs-lookup"><span data-stu-id="1a50f-146">This is the default hosting model and **ServicePackageAtivationMode** need not be specified at the time of creating the service.</span></span>
>
>- <span data-ttu-id="1a50f-147">Le modèle à **processus exclusif** correspond à un **ServicePackageActivationMode** égal à **ExclusiveProcess** et doit être explicitement spécifié au moment de la création du service.</span><span class="sxs-lookup"><span data-stu-id="1a50f-147">**Exclusive Process** hosting model corresponds to **ServicePackageAtivationMode** equal **ExclusiveProcess** and need to be explicitly specified at the time of creating the service.</span></span> 
>
>- <span data-ttu-id="1a50f-148">Le modèle d’hébergement d’un service peut être déterminé en interrogeant la [description du service][p2] et en examinant la valeur de **ServicePackageActivationMode**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-148">Hosting model of a service can be known by querying the [service description][p2] and looking at value of **ServicePackageAtivationMode**.</span></span>
>
>

## <a name="working-with-deployed-service-package"></a><span data-ttu-id="1a50f-149">Utilisation d’un package de services déployé</span><span class="sxs-lookup"><span data-stu-id="1a50f-149">Working with deployed service package</span></span>
<span data-ttu-id="1a50f-150">Une copie active d’un *ServicePackage* sur un nœud est appelée [package de services déployé][p3].</span><span class="sxs-lookup"><span data-stu-id="1a50f-150">An active copy of a *ServicePackage* on a node is referred as [deployed service package][p3].</span></span> <span data-ttu-id="1a50f-151">Comme mentionné précédemment, lorsque le modèle à **processus exclusif** est utilisé pour la création de services, il peut y avoir, pour une *application* donnée, plusieurs packages de services déployés pour le même *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-151">As previously mentioned above, when **Exclusive Process** model is used for creating services, for a given *application*, there could be multiple deployed service packages for the same *ServicePackage*.</span></span> <span data-ttu-id="1a50f-152">Lorsque vous exécutez des opérations spécifiques à un package de services déployé, par exemple lorsque [vous générez des rapports d’intégrité pour un package de services déployé][p4] ou que [vous redémarrez le package de code d’un package de services déployé][p5] etc., vous devez spécifier le **ServicePackageActivationId** pour pouvoir identifier un package de services déployé spécifique.</span><span class="sxs-lookup"><span data-stu-id="1a50f-152">While performing operations specific to deployed service package like [reporting health of a deployed service package][p4] or [restarting code package of a deployed service package][p5] etc., **ServicePackageActivationId** needs to be provided to identify a specific deployed service package.</span></span>

 <span data-ttu-id="1a50f-153">Le **ServicePackageActivationId** d’un package de services déployé peut être obtenu en interrogeant la liste des [packages de services déployés][p3] sur un nœud.</span><span class="sxs-lookup"><span data-stu-id="1a50f-153">**ServicePackageActivationId** of a deployed service package can be obtained by querying the list of [deployed service packages][p3] on a node.</span></span> <span data-ttu-id="1a50f-154">Lorsque vous envoyez une requête sur les [types de services déployés][p6], les [réplicas déployés][p7] et les [packages de code déployés][p8] sur un nœud, le résultat de la requête contient également le **ServicePackageActivationId** du package de service parent déployé.</span><span class="sxs-lookup"><span data-stu-id="1a50f-154">When querying [deployed service types][p6], [deployed replicas][p7] and [deployed code packages][p8] on a node, the query result also contains the **ServicePackageActivationId** of parent deployed service package.</span></span>

> [!NOTE]
>- <span data-ttu-id="1a50f-155">Sous le modèle d’hébergement à **processus partagé**, une seule copie d’un *ServicePackage* est activée sur un *nœud* donné et pour une *application* donnée.</span><span class="sxs-lookup"><span data-stu-id="1a50f-155">Under **Shared Process** hosting model, on a given *node*, for a given *application*, only one copy of a *ServicePackage* is activated.</span></span> <span data-ttu-id="1a50f-156">Le **ServicePackageActivationId** est alors égal à une *chaîne vide* et il n’est pas nécessaire de le spécifier lors de l’exécution des opérations associées au package de services déployé.</span><span class="sxs-lookup"><span data-stu-id="1a50f-156">It has **ServicePackageActivationId** equal to *empty string* and need not be specified while performing deployed service package related operations.</span></span> 
>
> - <span data-ttu-id="1a50f-157">Sous le modèle d’hébergement à **processus exclusif**, une ou plusieurs copies d’un *ServicePackage* peuvent être actives sur un *nœud* donné et pour une *application* donnée.</span><span class="sxs-lookup"><span data-stu-id="1a50f-157">Under **Exclusive Process** hosting model, on a given *node*, for a given *application*, one or more copies of a *ServicePackage* can be active.</span></span> <span data-ttu-id="1a50f-158">Chaque activation est associée à un **ServicePackageActivationId** *non vide* qui doit être spécifié lors de l’exécution des opérations associées au package de services déployé.</span><span class="sxs-lookup"><span data-stu-id="1a50f-158">Each activation has a *non-empty* **ServicePackageActivationId** and needs to be specified while performing deployed service package related operations.</span></span> 
>
> - <span data-ttu-id="1a50f-159">Si le **ServicePackageActivationId** est omis, la valeur par défaut sera une « chaîne vide ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-159">If **ServicePackageActivationId** is ommited it defaults to 'empty string'.</span></span> <span data-ttu-id="1a50f-160">En présence d’un package de services déployé qui a été activé sous le modèle à **processus partagé**, l’opération sera exécutée sur ce serveur ; sinon l’opération échouera.</span><span class="sxs-lookup"><span data-stu-id="1a50f-160">If a deployed service package that was activated under **Shared Process** model is present, then operation will be performed on it, otherwise the operation will fail.</span></span>
>
> - <span data-ttu-id="1a50f-161">Il n’est pas recommandé d’effectuer une seule requête et de mettre en cache le **ServicePackageActivationId** car il est généré dynamiquement et peut changer pour différentes raisons.</span><span class="sxs-lookup"><span data-stu-id="1a50f-161">It is not recommended to query once and cache **ServicePackageActivationId** as it is dynamically generated and can change for various reasons.</span></span> <span data-ttu-id="1a50f-162">Avant d’effectuer une opération qui requiert un **ServicePackageActivationId**, vous devez commencer par interroger la liste des [packages de services déployés][p3] sur un nœud, puis utiliser le *ServicePackageActivationId** généré à partir du résultat de la requête pour exécuter l’opération d’origine.</span><span class="sxs-lookup"><span data-stu-id="1a50f-162">Before performing an operation that needs **ServicePackageActivationId**, you should first query the list of [deployed service packages][p3] on a node and then use *ServicePackageActivationId** from query result to perform the original operation.</span></span>
>
>

## <a name="guest-executable-and-container-applications"></a><span data-ttu-id="1a50f-163">Applications d’exécutables invités et de conteneurs</span><span class="sxs-lookup"><span data-stu-id="1a50f-163">Guest executable and container applications</span></span>
<span data-ttu-id="1a50f-164">Service Fabric traite les applications [d’exécutables invités][a2] et de [conteneurs][a3] en tant que services sans état autonomes ; autrement dit, il n’y a aucun runtime Service Fabric dans *ServiceHost* (un processus ou un conteneur).</span><span class="sxs-lookup"><span data-stu-id="1a50f-164">Service Fabric treats [Guest executable][a2] and [container][a3] applications as statless services which are self-contained i.e. there is no Service Fabric runtime in *ServiceHost* (a process or container).</span></span> <span data-ttu-id="1a50f-165">Étant donné que ces services sont autonomes, le nombre de réplicas par *ServiceHost* n’est pas applicable à ces services.</span><span class="sxs-lookup"><span data-stu-id="1a50f-165">Since these services are self-contained, number of replicas per *ServiceHost* is not applicable for these services.</span></span> <span data-ttu-id="1a50f-166">La configuration la plus couramment utilisée avec ces services est la partition unique avec un [InstanceCount][c2] égal à -1 (autrement dit, une seule copie du code de service est en cours d’exécution sur chaque nœud du cluster).</span><span class="sxs-lookup"><span data-stu-id="1a50f-166">The most common configuration used with these services is single-partition with [InstanceCount][c2] equal to -1 (i.e. one copy of the service code running on each node of cluster).</span></span> 

<span data-ttu-id="1a50f-167">Le **ServicePackageActivationMode** par défaut pour ces services est **SharedProcess** ; dans ce cas, Service Fabric active uniquement une copie de *ServicePackage* sur un *nœud* pour une *application* donnée, ce qui signifie qu’une seule copie du code de service s’exécutera sur un *nœud*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-167">The default **ServicePackageActivationMode** for these services is **SharedProcess** in which case Service Fabric only activates one copy of *ServicePackage* on a *Node* for a given *application* which means only one copy of service code will run a *Node*.</span></span> <span data-ttu-id="1a50f-168">Si vous souhaitez que plusieurs copies de votre code de service s’exécutent sur un *nœud* lorsque vous créez plusieurs services (*Service1* à *ServiceN*) d’un *ServiceType* (spécifié dans *ServiceManifest*) ou lorsque votre service comporte plusieurs partitions, vous devez spécifier **ServicePackageActivationMode** en tant que **ExclusiveProcess** au moment de la création du service.</span><span class="sxs-lookup"><span data-stu-id="1a50f-168">If you want multiple copies of your service code to run on a *Node* when you create multiple services (*Service1* to *ServiceN*) of *ServiceType* (specified in *ServiceManifest*) or when your service is multi-partitioned, you should specify **ServicePackageActivationMode** as **ExclusiveProcess** at the time of creating the service.</span></span>

## <a name="changing-hosting-model-of-an-existing-service"></a><span data-ttu-id="1a50f-169">Modification du modèle d’hébergement d’un service existant</span><span class="sxs-lookup"><span data-stu-id="1a50f-169">Changing hosting model of an existing service</span></span>
<span data-ttu-id="1a50f-170">Le mécanisme de mise à niveau ou de mise à jour (ou la spécification du service par défaut dans le manifeste d’application) ne permet pas actuellement de passer, pour un service existant, d’un modèle d’hébergement à **processus partagé** vers un modèle d’hébergement à **processus exclusif** et inversement.</span><span class="sxs-lookup"><span data-stu-id="1a50f-170">Changing hosting model of an existing service from **Shared Process** to **Exclusive Process** and vice-versa through upgrade or update mechanism (or in default service specification in application manifest) is currently not supported.</span></span> <span data-ttu-id="1a50f-171">Cette fonctionnalité sera prise en charge dans les futures versions.</span><span class="sxs-lookup"><span data-stu-id="1a50f-171">Support for this feature will come in future versions.</span></span>

## <a name="choosing-between-shared-process-and-exclusive-process-model"></a><span data-ttu-id="1a50f-172">Choix entre un modèle à processus partagé et un modèle à processus exclusif</span><span class="sxs-lookup"><span data-stu-id="1a50f-172">Choosing between shared process and exclusive process model</span></span>
<span data-ttu-id="1a50f-173">Ces deux modèles d’hébergement présentent des avantages et des inconvénients. Il est donc important que l’utilisateur détermine le modèle qui répond le mieux à ses besoins.</span><span class="sxs-lookup"><span data-stu-id="1a50f-173">Both these hosting models have its pros and cons and user needs to evaluate which one fits their requirements best.</span></span> <span data-ttu-id="1a50f-174">Le modèle à **processus partagé** garantit une meilleure utilisation des ressources du système d’exploitation, puisqu’il réduit le nombre de processus générés, permet à plusieurs réplicas du même processus de partager des ports, etc. Toutefois, si l’un des réplicas rencontre une erreur qui l’oblige à arrêter l’hôte de service, cela aura un impact sur tous les autres réplicas du même processus.</span><span class="sxs-lookup"><span data-stu-id="1a50f-174">**Shared Process** model enables better utilization of OS resources because fewer processes are spawned, multiple replicas in the same process can share ports, etc. However, if one of the replicas hits an error where it needs to bring down the service host, it will impact all other replicas in same process.</span></span>

 <span data-ttu-id="1a50f-175">Le modèle à **processus exclusif** isole mieux les réplicas en les associant à un processus dédié. Aussi, un dysfonctionnement d’un réplica n’aura aucune incidence sur les autres réplicas.</span><span class="sxs-lookup"><span data-stu-id="1a50f-175">**Exclusive Process** model provides better isolation with every replica in its own process and a misbehaving replica will not impact other replicas.</span></span> <span data-ttu-id="1a50f-176">Ce modèle est utile lorsque le partage de port n’est pas pris en charge par le protocole de communication.</span><span class="sxs-lookup"><span data-stu-id="1a50f-176">It comes in handy for cases where port sharing is not supported by the communication protocol.</span></span> <span data-ttu-id="1a50f-177">Il permet également d’appliquer la gouvernance des ressources au niveau du réplica.</span><span class="sxs-lookup"><span data-stu-id="1a50f-177">It facilitates the ability to apply resource governance at replica level.</span></span> <span data-ttu-id="1a50f-178">En revanche, le modèle à **processus exclusif** consomme plus de ressources du système d’exploitation puisqu’il engendre un processus pour chaque réplica présent sur le nœud.</span><span class="sxs-lookup"><span data-stu-id="1a50f-178">On the other hand, **Exclusive Process** will consume more OS resources as it spawns one process for each replica on the node.</span></span>

## <a name="exclusive-process-model-and-application-model-considerations"></a><span data-ttu-id="1a50f-179">Considérations relatives au modèle à processus exclusif et au modèle d’application</span><span class="sxs-lookup"><span data-stu-id="1a50f-179">Exclusive process model and application model considerations</span></span>
<span data-ttu-id="1a50f-180">Pour modéliser votre application dans Service Fabric, il est recommandé de conserver un seul *ServiceType* par *ServicePackage*. Ce modèle fonctionne très bien pour la plupart des applications.</span><span class="sxs-lookup"><span data-stu-id="1a50f-180">The recommended way to model your application in Service Fabric is to keep one *ServiceType* per *ServicePackage* and this model works well for most of the applications.</span></span> 

<span data-ttu-id="1a50f-181">Cependant, pour prendre en charge des scénarios particuliers où il n’est pas souhaitable, d’un point de vue fonctionnel, d’avoir un *ServiceType* par *ServicePackage*, Service Fabric autorise les configurations avec plusieurs *ServiceTypes* par *ServicePackage* (et où un seul *CodePackage* peut inscrire plusieurs *ServiceTypes*).</span><span class="sxs-lookup"><span data-stu-id="1a50f-181">However, to enable special scenarios where one *ServiceType* per *ServicePackage* may not be desirable, functionally, Service Fabric allows to have more than one *ServiceType* per *ServicePackage* (and one *CodePackage* can register more than one *ServiceType*).</span></span> <span data-ttu-id="1a50f-182">Voici quelques scénarios dans lesquels ces configurations peuvent être utiles :</span><span class="sxs-lookup"><span data-stu-id="1a50f-182">Following are some of the scenarios where these configurations can be useful:</span></span>

- <span data-ttu-id="1a50f-183">Vous souhaitez optimiser l’utilisation des ressources du système d’exploitation en générant moins de processus et en augmentant la densité de réplica par processus.</span><span class="sxs-lookup"><span data-stu-id="1a50f-183">You want to optimize OS resource utilization by spawning fewer processes and having higher replica density per process.</span></span>
- <span data-ttu-id="1a50f-184">Les réplicas de différents ServiceTypes doivent partager certaines données qui présentent un coût élevé d’initialisation ou de mémoire.</span><span class="sxs-lookup"><span data-stu-id="1a50f-184">Replicas from different ServiceTypes need to share some common data that has a high initialization or memory cost.</span></span>
- <span data-ttu-id="1a50f-185">Vous disposez d’une offre de service gratuite et vous souhaitez limiter l’utilisation des ressources en plaçant tous les réplicas du service dans le même processus.</span><span class="sxs-lookup"><span data-stu-id="1a50f-185">You have a free service offering and you want to put a limit on resource utilization by putting all replicas of the service in same process.</span></span>

<span data-ttu-id="1a50f-186">Le modèle d’hébergement à **processus exclusif** n’est pas cohérent avec le modèle d’application qui utilise plusieurs *ServiceTypes* par *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-186">**Exclusive Process** hosting model is not coherent with application model having multiple *ServiceTypes* per *ServicePackage*.</span></span> <span data-ttu-id="1a50f-187">En effet, une configuration à plusieurs *ServiceTypes* par *ServicePackage* est destinée à améliorer le partage des ressources entre les réplicas et à augmenter la densité de réplica par processus.</span><span class="sxs-lookup"><span data-stu-id="1a50f-187">This is because multiple *ServiceTypes* per *ServicePackage* is designed to achieve higher resource sharing among replicas and enables higher replica density per process.</span></span> <span data-ttu-id="1a50f-188">Cette utilisation est contraire à l’intention du modèle à **processus exclusif**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-188">This is contrary to what **Exclusive Process** model is designed to achieve.</span></span>

<span data-ttu-id="1a50f-189">Prenons le cas de plusieurs *ServiceTypes* par *ServicePackage* avec un *CodePackage* différent qui inscrit chaque *ServiceType*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-189">Consider the case of multiple *ServiceTypes* per *ServicePackage* with different *CodePackage* registering each *ServiceType*.</span></span> <span data-ttu-id="1a50f-190">Supposons que nous avons un *ServicePackage* « MultiTypeServicePackage » qui comporte deux *CodePackages* :</span><span class="sxs-lookup"><span data-stu-id="1a50f-190">Let's say we have a *ServicePackage* 'MultiTypeServicePackge' which has two *CodePackages*:</span></span>

- <span data-ttu-id="1a50f-191">« MyCodePackageA » inscrit le *ServiceType* « MyServiceTypeA ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-191">'MyCodePackageA' which registers *ServiceType* 'MyServiceTypeA'.</span></span>
- <span data-ttu-id="1a50f-192">« MyCodePackageB » inscrit le *ServiceType* « MyServiceTypeB ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-192">'MyCodePackageB' which registers *ServiceType* 'MyServiceTypeB'.</span></span>

<span data-ttu-id="1a50f-193">Supposons, à présent, que nous créons une *application* **fabric:/SpecialApp** et que, à l’intérieur de cette application **fabric:/SpecialApp**, nous créons les deux services suivants avec le modèle à **processus exclusif** :</span><span class="sxs-lookup"><span data-stu-id="1a50f-193">Now, lets say, we create an *application* **fabric:/SpecialApp** and inside **fabric:/SpecialApp** we create following two services with **Exclusive Process** model:</span></span>

- <span data-ttu-id="1a50f-194">Le service **fabric:/SpecialApp/ServiceA** de type « MyServiceTypeA » avec deux partitions (par exemple, **P1** et **P2**) et 3 réplicas par partition.</span><span class="sxs-lookup"><span data-stu-id="1a50f-194">Service **fabric:/SpecialApp/ServiceA** of type 'MyServiceTypeA' with two partitions (say **P1** and **P2**) and 3 replicas per partition.</span></span>
- <span data-ttu-id="1a50f-195">Le service **fabric:/SpecialApp/ServiceB** de type « MyServiceTypeB » avec deux partitions (par exemple, **P3** et **P4**) et 3 réplicas par partition.</span><span class="sxs-lookup"><span data-stu-id="1a50f-195">Service **fabric:/SpecialApp/ServiceB** of type 'MyServiceTypeB' with two partitions (say **P3** and **P4**) and 3 replicas per partition.</span></span>

<span data-ttu-id="1a50f-196">Sur un nœud donné, les deux services auront chacun deux réplicas.</span><span class="sxs-lookup"><span data-stu-id="1a50f-196">On a given node, both the services will have two replicas each.</span></span> <span data-ttu-id="1a50f-197">Étant donné que nous avons utilisé le modèle à **processus exclusif** pour créer les services, Service Fabric activera une nouvelle copie de « MyServicePackage » pour chaque réplica.</span><span class="sxs-lookup"><span data-stu-id="1a50f-197">Since we used **Exclusive Process** model to create the services, Service Fabric will activate a new copy of 'MyServicePackge' for each replica.</span></span> <span data-ttu-id="1a50f-198">Chaque activation de «MultiTypeServicePackage » démarre une copie de « MyCodePackageA » et « MyCodePackageB ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-198">Each activation of 'MultiTypeServicePackge' will start a copy of 'MyCodePackageA' and 'MyCodePackageB'.</span></span> <span data-ttu-id="1a50f-199">Cependant, le réplica pour lequel « MultiTypeServicePackage » a été activé ne pourra être hébergé que par « MyCodePackageA » ou par « MyCodePackageB ».</span><span class="sxs-lookup"><span data-stu-id="1a50f-199">However, only one of 'MyCodePackageA' or 'MyCodePackageB' will host the replica for which 'MultiTypeServicePackge' was activated.</span></span> <span data-ttu-id="1a50f-200">Le schéma qui suit présente la vue du nœud :</span><span class="sxs-lookup"><span data-stu-id="1a50f-200">Following diagram shows the node view:</span></span>

<span data-ttu-id="1a50f-201"><center>
![Vue de l’application déployée sur un nœud][node-view-five]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-201"><center>
![Node view of deployed application][node-view-five]
</center></span></span>

 <span data-ttu-id="1a50f-202">Comme nous pouvons le constater, dans l’activation de « MultiTypeServicePackage » pour le réplica de la partition **P1** du service **fabric:/SpecialApp/ServiceA**, « MyCodePackageA » héberge le réplica et « MyCodePackageB » est simplement en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="1a50f-202">As we can see, in the activation of 'MultiTypeServicePackge' for replica of partition **P1** of service **fabric:/SpecialApp/ServiceA**, 'MyCodePackageA' is hosting the replica and 'MyCodePackageB' is just up and running.</span></span> <span data-ttu-id="1a50f-203">De même, dans l’activation de « MultiTypeServicePackage » pour le réplica de la partition **P3** du service **fabric:/SpecialApp/ServiceB**, « MyCodePackageB » héberge le réplica et « MyCodePackageA » est simplement en cours d’exécution, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="1a50f-203">Similarly, in activation of 'MultiTypeServicePackge' for replica of partition **P3** of service **fabric:/SpecialApp/ServiceB**, 'MyCodePackageB' is hosting the replica and 'MyCodePackageA' is just up and running and so on.</span></span> <span data-ttu-id="1a50f-204">Par conséquent, plus il y a de *CodePackages* (inscrivant différents *ServiceTypes*) par *ServicePackage*, plus on utilisera de ressources redondantes.</span><span class="sxs-lookup"><span data-stu-id="1a50f-204">Hence, more the number of *CodePackages* (registering different *ServiceTypes*) per *ServicePackage*, higher will be redundant resource usage.</span></span> 
 
 <span data-ttu-id="1a50f-205">En revanche, si nous créons les services **fabric:/SpecialApp/ServiceA** et **fabric:/SpecialApp/ServiceB** avec le modèle à **processus partagé**, Service Fabric activera une seule copie de « MultiTypeServicePackage » pour *l’application* **fabric:/SpecialApp** (comme nous l’avons vu précédemment).</span><span class="sxs-lookup"><span data-stu-id="1a50f-205">On the other hand if we create services **fabric:/SpecialApp/ServiceA** and **fabric:/SpecialApp/ServiceB** with **Shared Process** model, Service Fabric will activate only one copy of 'MultiTypeServicePackge' for *application* **fabric:/SpecialApp** (as we saw previously).</span></span> <span data-ttu-id="1a50f-206">« MyCodePackageA » hébergera tous les réplicas du service **fabric:/SpecialApp/ServiceA** (ou, pour être plus précis, de tous les services de type « MyServiceTypeA ») et « MyCodePackageB » hébergera tous les réplicas du service **fabric:/SpecialApp/ServiceB** (ou, pour être plus précis, de tous les services de type « MyServiceTypeB »).</span><span class="sxs-lookup"><span data-stu-id="1a50f-206">'MyCodePackageA' will host all replicas for service **fabric:/SpecialApp/ServiceA** (or of any service of type 'MyServiceTypeA' to be more precise) and 'MyCodePackageB' will host all replicas for service **fabric:/SpecialApp/ServiceB** (or of any service of type 'MyServiceTypeB' to be more precise).</span></span> <span data-ttu-id="1a50f-207">Le schéma qui suit présente la vue du nœud dans cette configuration :</span><span class="sxs-lookup"><span data-stu-id="1a50f-207">Following diagram shows the node view in this setting:</span></span> 

<span data-ttu-id="1a50f-208"><center>
![Vue de l’application déployée sur un nœud][node-view-six]
</center></span><span class="sxs-lookup"><span data-stu-id="1a50f-208"><center>
![Node view of deployed application][node-view-six]
</center></span></span>

<span data-ttu-id="1a50f-209">Dans l’exemple ci-dessus, vous pourriez penser que si « MyCodePackageA » inscrit « MyServiceTypeA » et « MyServiceTypeB » et s’il n’existe aucun « MyCodePackageB », aucun *CodePackage* redondant ne sera exécuté.</span><span class="sxs-lookup"><span data-stu-id="1a50f-209">In the above example, you might think if 'MyCodePackageA' registers both 'MyServiceTypeA' and 'MyServiceTypeB' and there is no 'MyCodePackageB', then there will be no redundant *CodePackage* running.</span></span> <span data-ttu-id="1a50f-210">Cela est correct, cependant, comme mentionné précédemment, ce modèle d’application n’est pas aligné sur modèle d’hébergement à **processus exclusif**.</span><span class="sxs-lookup"><span data-stu-id="1a50f-210">This is correct, however, as mentioned previously, this application model does not align with **Exclusive Process** hosting model.</span></span> <span data-ttu-id="1a50f-211">Si l’objectif est de placer chaque réplica dans son propre processus dédié, alors il n’est pas nécessaire d’inscrire les deux *ServiceTypes* du même *CodePackage*. Il est plus naturel de placer chaque *ServiceType* dans son propre *ServicePackage*.</span><span class="sxs-lookup"><span data-stu-id="1a50f-211">If goal is to put each replica in its own dedicated process then registering both *ServiceTypes* from same *CodePackage* is not needed and putting each *ServiceType* in its own *ServicePacakge* is a more natural choice.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1a50f-212">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1a50f-212">Next steps</span></span>
<span data-ttu-id="1a50f-213">[Empaquetez une application][a4] et préparez-la pour le déploiement.</span><span class="sxs-lookup"><span data-stu-id="1a50f-213">[Package an application][a4] and get it ready to deploy.</span></span>

<span data-ttu-id="1a50f-214">[Déployer et supprimer des applications][a5] explique comment utiliser PowerShell pour gérer des instances d’application.</span><span class="sxs-lookup"><span data-stu-id="1a50f-214">[Deploy and remove applications][a5] describes how to use PowerShell to manage application instances.</span></span>

<!--Image references-->
[node-view-one]: ./media/service-fabric-hosting-model/node-view-one.png
[node-view-two]: ./media/service-fabric-hosting-model/node-view-two.png
[node-view-three]: ./media/service-fabric-hosting-model/node-view-three.png
[node-view-four]: ./media/service-fabric-hosting-model/node-view-four.png
[node-view-five]: ./media/service-fabric-hosting-model/node-view-five.png
[node-view-six]: ./media/service-fabric-hosting-model/node-view-six.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[a1]: service-fabric-application-model.md
[a2]: service-fabric-deploy-existing-app.md
[a3]: service-fabric-containers-overview.md
[a4]: service-fabric-package-apps.md
[a5]: service-fabric-deploy-remove-applications.md

[r1]: https://docs.microsoft.com/rest/api/servicefabric/sfclient-api-createservice

[c1]: https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.servicemanagementclient.createserviceasync
[c2]: https://docs.microsoft.com/dotnet/api/system.fabric.description.statelessservicedescription.instancecount

[p1]: https://docs.microsoft.com/powershell/servicefabric/vlatest/new-servicefabricservice
[p2]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricservicedescription
[p3]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedservicePackage
[p4]: https://docs.microsoft.com/powershell/servicefabric/vlatest/send-servicefabricdeployedservicepackagehealthreport
[p5]: https://docs.microsoft.com/powershell/servicefabric/vlatest/restart-servicefabricdeployedcodepackage
[p6]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedservicetype
[p7]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedreplica
[p8]: https://docs.microsoft.com/powershell/servicefabric/vlatest/get-servicefabricdeployedcodepackage