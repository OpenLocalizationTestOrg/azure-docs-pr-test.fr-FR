---
title: "aaaUsing Elasticsearch comme un magasin de suivi d’application Service Fabric | Documents Microsoft"
description: "Explique comment les applications de l’infrastructure de Service peuvent utiliser toostore Elasticsearch et Kibana, index et recherche dans les traces d’application (journaux)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: b5977c54e69319e3caa376e44a02f971b66a3254
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="124cd-103">Utiliser Elasticsearch en tant que magasin de trace d’applications Service Fabric</span><span class="sxs-lookup"><span data-stu-id="124cd-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="124cd-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="124cd-104">Introduction</span></span>
<span data-ttu-id="124cd-105">Cet article décrit comment les applications [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) peuvent utiliser **Elasticsearch** et **Kibana** pour le stockage, l’indexation et la recherche de traces d’applications.</span><span class="sxs-lookup"><span data-stu-id="124cd-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="124cd-106">[Elasticsearch](https://www.elastic.co/guide/index.html) est un moteur de recherche et d’analyse en temps réel open source, distribué et évolutif, qui convient parfaitement à cette tâche.</span><span class="sxs-lookup"><span data-stu-id="124cd-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="124cd-107">Il peut être installé sur des machines virtuelles Windows ou Linux exécutées dans Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="124cd-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="124cd-108">Elasticsearch peut traiter efficacement les traces *structurées* produites à l’aide de technologies telles que **Event Tracing for Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="124cd-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="124cd-109">ETW est utilisé par l’infrastructure de Service runtime toosource des informations de diagnostic (suivi).</span><span class="sxs-lookup"><span data-stu-id="124cd-109">ETW is used by Service Fabric runtime toosource diagnostic information (traces).</span></span> <span data-ttu-id="124cd-110">Il s’agit de hello méthode recommandée pour le Service Fabric applications toosource leurs informations de diagnostic, trop.</span><span class="sxs-lookup"><span data-stu-id="124cd-110">It is hello recommended method for Service Fabric applications toosource their diagnostic information, too.</span></span> <span data-ttu-id="124cd-111">À l’aide de hello même mécanisme permettant de corrélation entre les suivis fourni par le runtime et fourni par l’application et en fait, résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="124cd-111">Using hello same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="124cd-112">Modèles de projet de service Fabric dans Visual Studio incluent une API de journalisation (en fonction de hello .NET **EventSource** classe) qui émet des suivis ETW par défaut.</span><span class="sxs-lookup"><span data-stu-id="124cd-112">Service Fabric project templates in Visual Studio include a logging API (based on hello .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="124cd-113">Pour obtenir une vue d’ensemble du traçage d’applications Service Fabric à l’aide d’ETW, consultez [Surveillance et diagnostic des services dans une configuration de développement d’ordinateur local](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="124cd-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="124cd-114">Pour les traces hello tooshow dans Elasticsearch, ils ont besoin de toobe capturées au niveau de nœuds de cluster Service Fabric hello en temps réel (pendant l’exécution application hello) et envoyé le point de terminaison tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="124cd-114">For hello traces tooshow up in Elasticsearch, they need toobe captured at hello Service Fabric cluster nodes in real time (while hello application is running) and sent tooan Elasticsearch endpoint.</span></span> <span data-ttu-id="124cd-115">Il existe deux options principales pour la capture de traces :</span><span class="sxs-lookup"><span data-stu-id="124cd-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="124cd-116">**Capture de traces dans le processus**</span><span class="sxs-lookup"><span data-stu-id="124cd-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="124cd-117">application Hello, ou plus précisément, les processus de service, est responsable de l’envoi de magasin de trace toohello hello des données de diagnostic (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="124cd-117">hello application, or more precisely, service process, is responsible for sending out hello diagnostic data toohello trace store (Elasticsearch).</span></span>
* <span data-ttu-id="124cd-118">**Capture de traces hors processus**</span><span class="sxs-lookup"><span data-stu-id="124cd-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="124cd-119">Un agent séparé est capturer une trace à partir de service hello ou les processus et les envoyer de magasin de trace toohello.</span><span class="sxs-lookup"><span data-stu-id="124cd-119">A separate agent is capturing traces from hello service process or processes and sending them toohello trace store.</span></span>

<span data-ttu-id="124cd-120">Nous décrivons ci-dessous comment tooset des Elasticsearch sur Azure, traitent les professionnels de l’hello et les inconvénients des deux options de capture et expliquent comment tooconfigure une infrastructure de Service service toosend données tooElasticsearch.</span><span class="sxs-lookup"><span data-stu-id="124cd-120">Below, we describe how tooset up Elasticsearch on Azure, discuss hello pros and cons for both capture options, and explain how tooconfigure a Service Fabric service toosend data tooElasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="124cd-121">Configurer Elasticsearch sur Azure</span><span class="sxs-lookup"><span data-stu-id="124cd-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="124cd-122">Hello tooset de façon plus simple de service de Elasticsearch hello sur Azure s’effectue via [ **modèles Azure Resource Manager**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="124cd-122">hello most straightforward way tooset up hello Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="124cd-123">Un [modèle Azure Resource Manager de démarrage rapide pour Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) est disponible à partir du référentiel de modèles de démarrage rapide Azure.</span><span class="sxs-lookup"><span data-stu-id="124cd-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="124cd-124">Ce modèle utilise des comptes de stockage distincts pour les unités d’échelle (groupes de nœuds).</span><span class="sxs-lookup"><span data-stu-id="124cd-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="124cd-125">Il peut également approvisionner des nœuds client et serveur distincts avec des configurations différentes et divers nombres de disques de données associés.</span><span class="sxs-lookup"><span data-stu-id="124cd-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="124cd-126">Ici, nous utilisons un autre modèle, appelé **ES-multiposte** de hello [référentiel des outils de diagnostic Azure](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="124cd-126">Here, we use another template, called **ES-MultiNode** from hello [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="124cd-127">Ce modèle est toouse plus facile, et il crée un cluster Elasticsearch protégé par l’authentification de base HTTP.</span><span class="sxs-lookup"><span data-stu-id="124cd-127">This template is easier toouse, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="124cd-128">Avant de continuer, vous pouvez télécharger hello du référentiel à partir de GitHub tooyour machine (par le clonage du référentiel de hello ou téléchargement d’un fichier zip).</span><span class="sxs-lookup"><span data-stu-id="124cd-128">Before you proceed, download hello repository from GitHub tooyour machine (by either cloning hello repository or downloading a zip file).</span></span> <span data-ttu-id="124cd-129">modèle de Hello ES-multiposte se trouve dans le dossier hello avec hello même nom.</span><span class="sxs-lookup"><span data-stu-id="124cd-129">hello ES-MultiNode template is located in hello folder with hello same name.</span></span>

### <a name="prepare-a-machine-toorun-elasticsearch-installation-scripts"></a><span data-ttu-id="124cd-130">Préparer un ordinateur toorun Elasticsearch des scripts d’installation</span><span class="sxs-lookup"><span data-stu-id="124cd-130">Prepare a machine toorun Elasticsearch installation scripts</span></span>
<span data-ttu-id="124cd-131">Hello plus simple façon toouse hello ES-multiposte modèle est via un script Azure PowerShell fourni appelé `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="124cd-131">hello easiest way toouse hello ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="124cd-132">toouse ce script, vous devez les modules PowerShell tooinstall et un outil appelé **openssl**.</span><span class="sxs-lookup"><span data-stu-id="124cd-132">toouse this script, you need tooinstall PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="124cd-133">Hello ce dernier est nécessaire pour la création d’une clé SSH qui peut être utilisé tooadminister votre cluster Elasticsearch à distance.</span><span class="sxs-lookup"><span data-stu-id="124cd-133">hello latter is needed for creating an SSH key that can be used tooadminister your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="124cd-134">`CreateElasticSearchCluster`script est conçu pour simplifier l’utilisation avec le modèle hello ES-multiposte depuis un ordinateur Windows.</span><span class="sxs-lookup"><span data-stu-id="124cd-134">`CreateElasticSearchCluster` script is designed for ease of use with hello ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="124cd-135">Il s’agit de modèle de hello toouse possible sur un ordinateur non-Windows, mais ce scénario est abordée dans cet article hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-135">It is possible toouse hello template on a non-Windows machine, but that scenario is beyond hello scope of this article.</span></span>

1. <span data-ttu-id="124cd-136">Si vous ne l’avez pas déjà fait, installez les [**modules Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="124cd-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="124cd-137">À l’invite, cliquez sur **Exécuter**, puis sur **Installer**.</span><span class="sxs-lookup"><span data-stu-id="124cd-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="124cd-138">PowerShell Azure 1.3 (ou une version ultérieure) est requis.</span><span class="sxs-lookup"><span data-stu-id="124cd-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="124cd-139">Hello **openssl** tool est inclus dans la distribution hello de [ **Git pour Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="124cd-139">hello **openssl** tool is included in hello distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="124cd-140">Si vous ne l’avez pas déjà fait, installez [Git pour Windows](http://www.git-scm.com/downloads) maintenant.</span><span class="sxs-lookup"><span data-stu-id="124cd-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="124cd-141">(les options d’installation par défaut hello sont OK).</span><span class="sxs-lookup"><span data-stu-id="124cd-141">(hello default installation options are OK.)</span></span>
3. <span data-ttu-id="124cd-142">En supposant que Git a été installé mais non inclus dans le chemin d’accès de système de hello, ouvrez une fenêtre de Microsoft Azure PowerShell et exécutez hello suivant de commandes :</span><span class="sxs-lookup"><span data-stu-id="124cd-142">Assuming that Git has been installed but not included in hello system path, open a Microsoft Azure PowerShell window and run hello following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="124cd-143">Remplacez hello `<Git installation folder>` emplacement Git de hello sur votre ordinateur ; valeur par défaut hello est **« C:\Program Files\Git »**.</span><span class="sxs-lookup"><span data-stu-id="124cd-143">Replace hello `<Git installation folder>` with hello Git location on your machine; hello default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="124cd-144">Notez le point-virgule hello au début de hello du chemin d’accès de la première hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-144">Note hello semicolon character at hello beginning of hello first path.</span></span>
4. <span data-ttu-id="124cd-145">Vérifiez que vous êtes connecté tooAzure (via [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) applet de commande) et que vous avez sélectionné les abonnement hello qui doivent être utilisé toocreate votre cluster recherche élastique.</span><span class="sxs-lookup"><span data-stu-id="124cd-145">Ensure that you are logged on tooAzure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected hello subscription that should be used toocreate your Elastic Search cluster.</span></span> <span data-ttu-id="124cd-146">Vous pouvez vérifier que l’abonnement sélectionné est correct à l’aide des applets de commande `Get-AzureRmContext` et `Get-AzureRmSubscription`.</span><span class="sxs-lookup"><span data-stu-id="124cd-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="124cd-147">Si vous n’avez pas déjà fait, accédez hello Active toohello ES-multiposte.</span><span class="sxs-lookup"><span data-stu-id="124cd-147">If you haven't done so already, change hello current directory toohello ES-MultiNode folder.</span></span>

### <a name="run-hello-createelasticsearchcluster-script"></a><span data-ttu-id="124cd-148">Exécutez le script de CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="124cd-148">Run hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="124cd-149">Avant d’exécuter les script hello, ouvrez hello `azuredeploy-parameters.json` de fichiers et de vérifier ou de fournir des valeurs pour les paramètres du script hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-149">Before you run hello script, open hello `azuredeploy-parameters.json` file and verify or provide values for hello script parameters.</span></span> <span data-ttu-id="124cd-150">Hello paramètres suivants est fourni :</span><span class="sxs-lookup"><span data-stu-id="124cd-150">hello following parameters are provided:</span></span>

| <span data-ttu-id="124cd-151">Nom du paramètre</span><span class="sxs-lookup"><span data-stu-id="124cd-151">Parameter Name</span></span> | <span data-ttu-id="124cd-152">Description</span><span class="sxs-lookup"><span data-stu-id="124cd-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="124cd-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="124cd-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="124cd-154">nom Hello toocreate utilisé hello visible publiquement nom DNS de cluster de recherche élastique hello (en ajoutant le nom de toohello fourni domaine hello région Azure).</span><span class="sxs-lookup"><span data-stu-id="124cd-154">hello name that is used toocreate hello publicly visible DNS name for hello Elastic Search cluster (by appending hello Azure region domain toohello provided name).</span></span> <span data-ttu-id="124cd-155">Par exemple, si la valeur de ce paramètre est « myBigCluster » et la région Azure hello choisi est ouest des États-Unis, hello résultant nom DNS de cluster de hello est myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="124cd-155">For example, if this parameter value is "myBigCluster" and hello chosen Azure region is West US, hello resulting DNS name for hello cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="124cd-156">Ce nom sert également de nombreux artefacts associé hello recherche élastique cluster, tels que les noms de nœud de données, un nom de racine.</span><span class="sxs-lookup"><span data-stu-id="124cd-156">This name also serves as a root name for many artifacts associated with hello Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="124cd-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="124cd-157">adminUsername</span></span> |<span data-ttu-id="124cd-158">nom Hello du compte d’administrateur hello pour la gestion de cluster de recherche élastique hello (clés SSH correspondantes sont générées automatiquement).</span><span class="sxs-lookup"><span data-stu-id="124cd-158">hello name of hello administrator account for managing hello Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="124cd-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="124cd-159">dataNodeCount</span></span> |<span data-ttu-id="124cd-160">nombre de Hello de nœuds de cluster de recherche élastique hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-160">hello number of nodes in hello Elastic Search cluster.</span></span> <span data-ttu-id="124cd-161">version actuelle de Hello du script de hello ne distingue pas entre les nœuds de données et des requêtes ; tous les nœuds de lire les deux rôles.</span><span class="sxs-lookup"><span data-stu-id="124cd-161">hello current version of hello script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="124cd-162">Nœuds de too3 de valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="124cd-162">Defaults too3 nodes.</span></span> |
| <span data-ttu-id="124cd-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="124cd-163">dataDiskSize</span></span> |<span data-ttu-id="124cd-164">taille de Hello de disques de données (en Go) qui est allouée à chaque nœud de données.</span><span class="sxs-lookup"><span data-stu-id="124cd-164">hello size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="124cd-165">Chaque nœud reçoit 4 disques de données, exclusivement dédié tooElastic service de recherche.</span><span class="sxs-lookup"><span data-stu-id="124cd-165">Each node receives 4 data disks, exclusively dedicated tooElastic Search service.</span></span> |
| <span data-ttu-id="124cd-166">region</span><span class="sxs-lookup"><span data-stu-id="124cd-166">region</span></span> |<span data-ttu-id="124cd-167">nom de Hello de région Azure où le cluster de recherche élastique hello doit être situé.</span><span class="sxs-lookup"><span data-stu-id="124cd-167">hello name of Azure region where hello Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="124cd-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="124cd-168">esUserName</span></span> |<span data-ttu-id="124cd-169">Hello nom d’utilisateur de l’utilisateur de hello est configuré du cluster de tooES toohave accès (sujet tooHTTP l’authentification de base).</span><span class="sxs-lookup"><span data-stu-id="124cd-169">hello user name of hello user that is configured toohave access tooES cluster (subject tooHTTP basic authentication).</span></span> <span data-ttu-id="124cd-170">Hello et mot de passe ne fait pas partie du fichier de paramètres doit être fourni lorsque `CreateElasticSearchCluster` script est appelé.</span><span class="sxs-lookup"><span data-stu-id="124cd-170">hello password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="124cd-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="124cd-171">vmSizeDataNodes</span></span> |<span data-ttu-id="124cd-172">Hello taille de machine virtuelle Azure pour les nœuds de cluster recherche élastique.</span><span class="sxs-lookup"><span data-stu-id="124cd-172">hello Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="124cd-173">TooStandard_D2 de valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="124cd-173">Defaults tooStandard_D2.</span></span> |

<span data-ttu-id="124cd-174">Vous êtes le script de hello toorun prêt.</span><span class="sxs-lookup"><span data-stu-id="124cd-174">Now you are ready toorun hello script.</span></span> <span data-ttu-id="124cd-175">Exécutez hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="124cd-175">Issue hello following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="124cd-176">où</span><span class="sxs-lookup"><span data-stu-id="124cd-176">where</span></span> 

| <span data-ttu-id="124cd-177">Nom du paramètre de script</span><span class="sxs-lookup"><span data-stu-id="124cd-177">Script Parameter Name</span></span> | <span data-ttu-id="124cd-178">Description</span><span class="sxs-lookup"><span data-stu-id="124cd-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="124cd-179">nom Hello hello Azure du groupe de ressources qui contient toutes les ressources de cluster recherche élastique.</span><span class="sxs-lookup"><span data-stu-id="124cd-179">hello name of hello Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="124cd-180">nom Hello Hello région Azure où le cluster de recherche élastique hello doit être créé.</span><span class="sxs-lookup"><span data-stu-id="124cd-180">hello name of hello Azure region where hello Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="124cd-181">mot de passe Hello pour hello élastique rechercher un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="124cd-181">hello password for hello Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="124cd-182">Si vous obtenez une exception NullReferenceException à partir de l’applet de commande Test-AzureResourceGroup de hello, vous avez oublié toolog sur tooAzure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="124cd-182">If you get a NullReferenceException from hello Test-AzureResourceGroup cmdlet, you have forgotten toolog on tooAzure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="124cd-183">Si vous obtenez une erreur de script de hello en cours d’exécution et que vous déterminez que l’erreur de hello a été provoqué par une valeur de paramètre de modèle incorrect, corrigez le fichier de paramètres hello et réexécutez le script de hello avec un nom de groupe de ressources différent.</span><span class="sxs-lookup"><span data-stu-id="124cd-183">If you get an error from running hello script and you determine that hello error was caused by a wrong template parameter value, correct hello parameter file and run hello script again with a different resource group name.</span></span> <span data-ttu-id="124cd-184">Vous pouvez également réutiliser hello du même nom de groupe de ressources et script hello hello ancien de nettoyage en ajoutant hello `-RemoveExistingResourceGroup` invocation du script toohello paramètre.</span><span class="sxs-lookup"><span data-stu-id="124cd-184">You can also reuse hello same resource group name and have hello script clean up hello old one by adding hello `-RemoveExistingResourceGroup` parameter toohello script invocation.</span></span>

### <a name="result-of-running-hello-createelasticsearchcluster-script"></a><span data-ttu-id="124cd-185">Résultat de l’exécution du script de CreateElasticSearchCluster hello</span><span class="sxs-lookup"><span data-stu-id="124cd-185">Result of running hello CreateElasticSearchCluster script</span></span>
<span data-ttu-id="124cd-186">Une fois que vous exécutez hello `CreateElasticSearchCluster` script, hello suivant artefacts principales sera créé.</span><span class="sxs-lookup"><span data-stu-id="124cd-186">After you run hello `CreateElasticSearchCluster` script, hello following main artifacts will be created.</span></span> <span data-ttu-id="124cd-187">Pour cet exemple, nous supposons que vous avez utilisé « myBigCluster » en tant que valeur hello Hello `dnsNameForLoadBalancerIP` paramètre et cette région de hello où vous avez créé le cluster de hello est ouest des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="124cd-187">For this example we assume that you have used "myBigCluster" as hello value of hello `dnsNameForLoadBalancerIP` parameter and that hello region where you created hello cluster is West US.</span></span>

| <span data-ttu-id="124cd-188">Artefact</span><span class="sxs-lookup"><span data-stu-id="124cd-188">Artifact</span></span> | <span data-ttu-id="124cd-189">Nom, emplacement et remarques</span><span class="sxs-lookup"><span data-stu-id="124cd-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="124cd-190">Clé SSH d’administration à distance</span><span class="sxs-lookup"><span data-stu-id="124cd-190">SSH key for remote administration</span></span> |<span data-ttu-id="124cd-191">fichier myBigCluster.key (dans le répertoire hello à partir de quels hello CreateElasticSearchCluster a été exécuté).</span><span class="sxs-lookup"><span data-stu-id="124cd-191">myBigCluster.key file (in hello directory from which hello CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="124cd-192">Ce fichier de clé peut être utilisé tooconnect toohello admin nœud et (via le nœud Administration de hello) toodata des nœuds de cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-192">This key file can be used tooconnect toohello admin node and (through hello admin node) toodata nodes in hello cluster.</span></span> |
| <span data-ttu-id="124cd-193">Nœud admin</span><span class="sxs-lookup"><span data-stu-id="124cd-193">Admin node</span></span> |<span data-ttu-id="124cd-194">myBigCluster-admin.westus.cloudapp.azure.com </span><span class="sxs-lookup"><span data-stu-id="124cd-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="124cd-195">Un ordinateur virtuel dédié pour l’administration à distance du cluster de Elasticsearch--hello uniquement un type qui autorise les connexions SSH externes.</span><span class="sxs-lookup"><span data-stu-id="124cd-195">A dedicated VM for remote Elasticsearch cluster administration--hello only one that allows external SSH connections.</span></span> <span data-ttu-id="124cd-196">Il s’exécute sur hello est du même réseau virtuel que tous les nœuds de cluster Elasticsearch hello, mais ne pas exécuter les services Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="124cd-196">It runs on hello same virtual network as all hello Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="124cd-197">Nœuds de données</span><span class="sxs-lookup"><span data-stu-id="124cd-197">Data nodes</span></span> |<span data-ttu-id="124cd-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="124cd-198">myBigCluster1 …</span></span> <span data-ttu-id="124cd-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="124cd-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="124cd-200">Nœuds de données qui exécutent les services Elasticsearch et Kibana.</span><span class="sxs-lookup"><span data-stu-id="124cd-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="124cd-201">Vous pouvez vous connecter via SSH tooeach nœud, mais uniquement via le nœud Administration de hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-201">You can connect via SSH tooeach node, but only via hello admin node.</span></span> |
| <span data-ttu-id="124cd-202">Cluster Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="124cd-202">Elasticsearch cluster</span></span> |<span data-ttu-id="124cd-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span><span class="sxs-lookup"><span data-stu-id="124cd-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="124cd-204">point de terminaison principal Hello pour cluster de Elasticsearch hello (suffixe de /es Remarque hello).</span><span class="sxs-lookup"><span data-stu-id="124cd-204">hello primary endpoint for hello Elasticsearch cluster (note hello /es suffix).</span></span> <span data-ttu-id="124cd-205">Il est protégé par l’authentification HTTP de base (informations d’identification hello étaient hello spécifié esUserName/esPassword des paramètres de modèle de hello multiposte-ES).</span><span class="sxs-lookup"><span data-stu-id="124cd-205">It is protected by basic HTTP authentication (hello credentials were hello specified esUserName/esPassword parameters of hello ES-MultiNode template).</span></span> <span data-ttu-id="124cd-206">Hello cluster possède également hello head plug-in installé (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) pour l’administration du cluster de base.</span><span class="sxs-lookup"><span data-stu-id="124cd-206">hello cluster has also hello head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="124cd-207">Service Kibana</span><span class="sxs-lookup"><span data-stu-id="124cd-207">Kibana service</span></span> |<span data-ttu-id="124cd-208">http://myBigCluster.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="124cd-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="124cd-209">Hello Kibana service tooshow données est définie à partir de hello créé Elasticsearch cluster.</span><span class="sxs-lookup"><span data-stu-id="124cd-209">hello Kibana service is set up tooshow data from hello created Elasticsearch cluster.</span></span> <span data-ttu-id="124cd-210">Il est protégé par hello mêmes informations d’identification de l’authentification en tant que hello du cluster lui-même.</span><span class="sxs-lookup"><span data-stu-id="124cd-210">It is protected by hello same authentication credentials as hello cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="124cd-211">Comparaison de la collecte de traces dans le processus et hors processus</span><span class="sxs-lookup"><span data-stu-id="124cd-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="124cd-212">Dans l’introduction de hello, nous l’avons mentionné deux méthodes fondamentales de la collecte de données de diagnostic : intra-processus et out-of-process.</span><span class="sxs-lookup"><span data-stu-id="124cd-212">In hello introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="124cd-213">Chacune de ces méthodes présente ses propres avantages et inconvénients.</span><span class="sxs-lookup"><span data-stu-id="124cd-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="124cd-214">Avantages de hello **capture de trace dans le processus** incluent :</span><span class="sxs-lookup"><span data-stu-id="124cd-214">Advantages of hello **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="124cd-215">*Simplicité de configuration et de déploiement*</span><span class="sxs-lookup"><span data-stu-id="124cd-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="124cd-216">configuration de Hello de collecte de données de diagnostic est simplement dans le cadre de la configuration de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-216">hello configuration of diagnostic data collection is just part of hello application configuration.</span></span> <span data-ttu-id="124cd-217">Il s’agit de conserver facilement tooalways « synchronisé » avec hello il le reste de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-217">It is easy tooalways keep it "in sync" with hello rest of hello application.</span></span>
   * <span data-ttu-id="124cd-218">Vous pouvez facilement réaliser une configuration par application ou par service.</span><span class="sxs-lookup"><span data-stu-id="124cd-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="124cd-219">Out-of-process trace capture nécessite généralement un déploiement séparé et la configuration de l’agent de diagnostic hello, qui est une tâche administrative supplémentaire et une source potentielle d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="124cd-219">Out-of-process trace capturing usually requires a separate deployment and configuration of hello diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="124cd-220">technologie d’agent particulier Hello permet souvent qu’une seule instance de l’agent de hello par l’ordinateur virtuel (nœud).</span><span class="sxs-lookup"><span data-stu-id="124cd-220">hello particular agent technology often allows only one instance of hello agent per virtual machine (node).</span></span> <span data-ttu-id="124cd-221">Cela signifie que la configuration de la collection hello de configuration de diagnostic hello est partagée entre toutes les applications et services qui s’exécutent sur ce nœud.</span><span class="sxs-lookup"><span data-stu-id="124cd-221">This means that configuration for hello collection of hello diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="124cd-222">*Flexibilité*</span><span class="sxs-lookup"><span data-stu-id="124cd-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="124cd-223">application Hello peut envoyer des données de hello qu’elle puisse toogo, tant qu’il existe une bibliothèque de client qui prend en charge le système de stockage de données hello ciblé.</span><span class="sxs-lookup"><span data-stu-id="124cd-223">hello application can send hello data wherever it needs toogo, as long as there is a client library that supports hello targeted data storage system.</span></span> <span data-ttu-id="124cd-224">Vous pouvez ajouter de nouveaux récepteurs si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="124cd-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="124cd-225">Vous pouvez également implémenter des règles de capture, de filtrage et d’agrégation de données complexes.</span><span class="sxs-lookup"><span data-stu-id="124cd-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="124cd-226">Capture d’une trace d’out-of-process est souvent limitée par les récepteurs de données hello hello prend en charge de l’agent.</span><span class="sxs-lookup"><span data-stu-id="124cd-226">An out-of-process trace capturing is often limited by hello data sinks that hello agent supports.</span></span> <span data-ttu-id="124cd-227">Certains agents sont extensibles.</span><span class="sxs-lookup"><span data-stu-id="124cd-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="124cd-228">*Contexte et des données d’application toointernal accès*</span><span class="sxs-lookup"><span data-stu-id="124cd-228">*Access toointernal application data and context*</span></span>
   
   * <span data-ttu-id="124cd-229">sous-système de diagnostic Hello en cours d’exécution à l’intérieur du processus de service ou application hello peut accroître facilement les traces hello avec des informations contextuelles.</span><span class="sxs-lookup"><span data-stu-id="124cd-229">hello diagnostic subsystem running inside hello application/service process can easily augment hello traces with contextual information.</span></span>
   * <span data-ttu-id="124cd-230">Dans l’approche d’out-of-process hello, hello données doivent être envoyées agent tooan via un mécanisme de communication entre processus, tels que le suivi d’événements pour Windows.</span><span class="sxs-lookup"><span data-stu-id="124cd-230">In hello out-of-process approach, hello data must be sent tooan agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="124cd-231">Ce mécanisme peut imposer des limites supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="124cd-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="124cd-232">Avantages de hello **out-of-process trace capture** incluent :</span><span class="sxs-lookup"><span data-stu-id="124cd-232">Advantages of hello **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="124cd-233">*Hello capacité toomonitor hello application et collecter les vidages sur incident*</span><span class="sxs-lookup"><span data-stu-id="124cd-233">*hello ability toomonitor hello application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="124cd-234">Dans le processus trace capture peut être échoue si l’application hello échoue toostart ou tombe en panne.</span><span class="sxs-lookup"><span data-stu-id="124cd-234">In-process trace capturing may be unsuccessful if hello application fails toostart or crashes.</span></span> <span data-ttu-id="124cd-235">Un agent indépendant a beaucoup plus de chance de capturer des informations de dépannage cruciales.</span><span class="sxs-lookup"><span data-stu-id="124cd-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="124cd-236">*Maturité, fiabilité et performances éprouvées*</span><span class="sxs-lookup"><span data-stu-id="124cd-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="124cd-237">Un agent développé par un fournisseur de plate-forme (par exemple, un agent Microsoft Azure Diagnostics) a été toorigorous sujet renforcement de nom et de test.</span><span class="sxs-lookup"><span data-stu-id="124cd-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject toorigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="124cd-238">Avec la trace dans le processus capture, il convient tooensure qu’activité hello d’envoi de données de diagnostic à partir d’un processus d’application ne pas interférer avec les tâches principales de l’application hello ou introduire des problèmes de synchronisation ou de performances.</span><span class="sxs-lookup"><span data-stu-id="124cd-238">With in-process trace capturing, care must be taken tooensure that hello activity of sending diagnostic data from an application process does not interfere with hello application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="124cd-239">Un agent de manière indépendante en cours d’exécution est moins susceptible d’engendrer des problèmes de toothese et spécifiquement conçue toolimit son impact sur le système de hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-239">An independently running agent is less prone toothese issues and is specifically designed toolimit its impact on hello system.</span></span>

<span data-ttu-id="124cd-240">Il est possible de toocombine et tirent parti de ces deux approches.</span><span class="sxs-lookup"><span data-stu-id="124cd-240">It is possible toocombine and benefit from both approaches.</span></span> <span data-ttu-id="124cd-241">En effet, il peut être la meilleure solution hello pour de nombreuses applications.</span><span class="sxs-lookup"><span data-stu-id="124cd-241">Indeed, it might be hello best solution for many applications.</span></span>

<span data-ttu-id="124cd-242">Ici, nous utilisons hello **Microsoft.Diagnostic.Listeners bibliothèque** et hello intra-processus trace de la capture de données toosend à partir d’un cluster de Service Fabric application tooan Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="124cd-242">Here, we use hello **Microsoft.Diagnostic.Listeners library** and hello in-process trace capturing toosend data from a Service Fabric application tooan Elasticsearch cluster.</span></span>

## <a name="use-hello-listeners-library-toosend-diagnostic-data-tooelasticsearch"></a><span data-ttu-id="124cd-243">Utilisez tooElasticsearch de données de diagnostic toosend hello écouteurs de la bibliothèque</span><span class="sxs-lookup"><span data-stu-id="124cd-243">Use hello Listeners library toosend diagnostic data tooElasticsearch</span></span>
<span data-ttu-id="124cd-244">bibliothèque de Microsoft.Diagnostic.Listeners Hello fait partie de l’exemple d’application de Service Fabric PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="124cd-244">hello Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="124cd-245">toouse il :</span><span class="sxs-lookup"><span data-stu-id="124cd-245">toouse it:</span></span>

1. <span data-ttu-id="124cd-246">Télécharger [hello PartyCluster exemple](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) à partir de GitHub.</span><span class="sxs-lookup"><span data-stu-id="124cd-246">Download [hello PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="124cd-247">Copier projets hello Microsoft.Diagnostics.Listeners et Microsoft.Diagnostics.Listeners.Fabric (dossiers entières) hello PartyCluster Active toohello solution dossier d’exemples d’application hello supposée toosend hello données tooElasticsearch .</span><span class="sxs-lookup"><span data-stu-id="124cd-247">Copy hello Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from hello PartyCluster sample directory toohello solution folder of hello application that is supposed toosend hello data tooElasticsearch.</span></span>
3. <span data-ttu-id="124cd-248">Ouvrez la solution de cible de hello, cliquez sur le nœud de la solution dans l’Explorateur de solutions de hello hello et choisissez **ajouter un projet existant**.</span><span class="sxs-lookup"><span data-stu-id="124cd-248">Open hello target solution, right-click hello solution node in hello Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="124cd-249">Ajoutez le projet toohello solution hello Microsoft.Diagnostics.Listeners.</span><span class="sxs-lookup"><span data-stu-id="124cd-249">Add hello Microsoft.Diagnostics.Listeners project toohello solution.</span></span> <span data-ttu-id="124cd-250">Répétez même hello pour le projet de Microsoft.Diagnostics.Listeners.Fabric hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-250">Repeat hello same for hello Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="124cd-251">Ajouter une référence de projet à partir de vos projets toohello deux ajouté projets de service.</span><span class="sxs-lookup"><span data-stu-id="124cd-251">Add a project reference from your service project(s) toohello two added projects.</span></span> <span data-ttu-id="124cd-252">(Chaque service qui est supposé toosend données tooElasticsearch doit référencer Microsoft.Diagnostics.EventListeners et Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="124cd-252">(Each service that is supposed toosend data tooElasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![TooMicrosoft.Diagnostics.EventListeners de références de projet et les bibliothèques Microsoft.Diagnostics.EventListeners.Fabric][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="124cd-254">Disponibilité générale de la version de Service Fabric et package NuGet Microsoft.Diagnostics.Tracing</span><span class="sxs-lookup"><span data-stu-id="124cd-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="124cd-255">Les applications créées avec version à disponibilité générale de Service Fabric (2.0.135, publiée le 31 mars 2016) ciblent **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="124cd-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="124cd-256">Cette version est la version la plus récente de hello Hello .NET Framework pris en charge par Azure lors de mise en production hello GA hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-256">This version is hello highest version of hello .NET Framework supported by Azure at hello time of hello GA release.</span></span> <span data-ttu-id="124cd-257">Malheureusement, cette version de framework de hello ne dispose pas de certaines APIs EventListener que hello Microsoft.Diagnostics.Listeners a besoin de bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="124cd-257">Unfortunately, this version of hello framework lacks certain EventListener APIs that hello Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="124cd-258">Étant donné que EventSource (composant hello base hello de journalisation de l’API dans les applications de l’infrastructure) et EventListener sont étroitement liés, chaque projet qui utilise la bibliothèque de Microsoft.Diagnostics.Listeners hello doit utiliser une autre implémentation de EventSource.</span><span class="sxs-lookup"><span data-stu-id="124cd-258">Because EventSource (hello component that forms hello basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses hello Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="124cd-259">Cette implémentation est fournie par hello **package Nuget de Microsoft.Diagnostics.Tracing**, créés par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="124cd-259">This implementation is provided by hello **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="124cd-260">package de Hello est entièrement compatible avec la source d’événement inclus dans le cadre de hello, aucune modification de code ne doit donc être nécessaire que les modifications de l’espace de noms référencé.</span><span class="sxs-lookup"><span data-stu-id="124cd-260">hello package is fully backward-compatible with EventSource included in hello framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="124cd-261">toostart à l’aide de la mise en œuvre de Microsoft.Diagnostics.Tracing hello de classe EventSource de hello, procédez comme suit pour chaque projet de service qui doit toosend données tooElasticsearch :</span><span class="sxs-lookup"><span data-stu-id="124cd-261">toostart using hello Microsoft.Diagnostics.Tracing implementation of hello EventSource class, follow these steps for each service project that needs toosend data tooElasticsearch:</span></span>

1. <span data-ttu-id="124cd-262">Avec le bouton droit sur le projet de service hello et choisissez **gérer les Packages Nuget**.</span><span class="sxs-lookup"><span data-stu-id="124cd-262">Right-click on hello service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="124cd-263">Basculer la source du package toohello nuget.org (si ce n’est pas déjà fait) et recherchez «**Microsoft.Diagnostics.Tracing**».</span><span class="sxs-lookup"><span data-stu-id="124cd-263">Switch toohello nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="124cd-264">Installer hello `Microsoft.Diagnostics.Tracing.EventSource` package (et ses dépendances).</span><span class="sxs-lookup"><span data-stu-id="124cd-264">Install hello `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="124cd-265">Ouvrez hello **ServiceEventSource.cs** ou **ActorEventSource.cs** dans votre projet de service et remplacez hello `using System.Diagnostics.Tracing` directive sur fichier hello avec hello `using Microsoft.Diagnostics.Tracing` directive.</span><span class="sxs-lookup"><span data-stu-id="124cd-265">Open hello **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace hello `using System.Diagnostics.Tracing` directive on top of hello file with hello `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="124cd-266">Ces étapes ne sera pas nécessaires qu’une seule fois hello **.NET Framework 4.6** est pris en charge par Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="124cd-266">These steps will not be necessary once hello **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="124cd-267">Instanciation et configuration de l’écouteur Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="124cd-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="124cd-268">Hello dernière étape pour l’envoi de données de diagnostic tooElasticsearch est toocreate une instance de `ElasticSearchListener` et configurez-le avec les données de connexion Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="124cd-268">hello final step for sending diagnostic data tooElasticsearch is toocreate an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="124cd-269">écouteur de Hello capture automatiquement tous les événements déclenchés via les classes EventSource définies dans le projet de service hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-269">hello listener automatically captures all events raised via EventSource classes defined in hello service project.</span></span> <span data-ttu-id="124cd-270">Il nécessitant toobe actif pendant la durée de vie hello du service de hello, hello meilleures placer toocreate il se trouve dans le code d’initialisation service hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-270">It needs toobe alive during hello lifetime of hello service, so hello best place toocreate it is in hello service initialization code.</span></span> <span data-ttu-id="124cd-271">Voici comment le code d’initialisation hello pour un service sans état pourrait ressembler après les modifications nécessaires hello (ajouts décrites dans les commentaires commençant par `****`) :</span><span class="sxs-lookup"><span data-stu-id="124cd-271">Here is how hello initialization code for a stateless service could look after hello necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add hello following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is hello entry point of hello service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // hello ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name tooa .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of hello class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that hello ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="124cd-272">Les données de connexion Elasticsearch doivent être placées dans une section distincte dans le fichier de configuration de service hello (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="124cd-272">Elasticsearch connection data should be put in a separate section in hello service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="124cd-273">nom Hello de section de hello doit correspondre à valeur toohello passé toohello `FabricConfigurationProvider` constructeur, par exemple :</span><span class="sxs-lookup"><span data-stu-id="124cd-273">hello name of hello section must correspond toohello value passed toohello `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="124cd-274">Hello des valeurs de `serviceUri`, `userName` et `password` paramètres correspondent adresse de point de terminaison du cluster toohello Elasticsearch Elasticsearch nom d’utilisateur et mot de passe, respectivement.</span><span class="sxs-lookup"><span data-stu-id="124cd-274">hello values of `serviceUri`, `userName` and `password` parameters correspond toohello Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="124cd-275">`indexNamePrefix`est le préfixe hello pour les index de Elasticsearch ; bibliothèque de Microsoft.Diagnostics.Listeners Hello crée un nouvel index pour ses données tous les jours.</span><span class="sxs-lookup"><span data-stu-id="124cd-275">`indexNamePrefix` is hello prefix for Elasticsearch indexes; hello Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="124cd-276">Vérification</span><span class="sxs-lookup"><span data-stu-id="124cd-276">Verification</span></span>
<span data-ttu-id="124cd-277">Et voilà !</span><span class="sxs-lookup"><span data-stu-id="124cd-277">That's it!</span></span> <span data-ttu-id="124cd-278">Maintenant, chaque fois que le service de hello est exécuté, il commence à envoyer des traces toohello Elasticsearch de service spécifié dans la configuration de hello.</span><span class="sxs-lookup"><span data-stu-id="124cd-278">Now, whenever hello service is run, it starts sending traces toohello Elasticsearch service specified in hello configuration.</span></span> <span data-ttu-id="124cd-279">Vous pouvez le vérifier en hello ouverture que kibana UI associé avec l’instance de Elasticsearch hello cible.</span><span class="sxs-lookup"><span data-stu-id="124cd-279">You can verify this by opening hello Kibana UI associated with hello target Elasticsearch instance.</span></span> <span data-ttu-id="124cd-280">Dans notre exemple, adresse de la page hello est http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="124cd-280">In our example, hello page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="124cd-281">Vérifiez que les index avec le préfixe de nom hello choisi pour hello `ElasticSearchListener` instance effectivement ont été créés et remplis avec des données.</span><span class="sxs-lookup"><span data-stu-id="124cd-281">Check that indexes with hello name prefix chosen for hello `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Kibana affichant des événements d’application du cluster Party][2]

## <a name="next-steps"></a><span data-ttu-id="124cd-283">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="124cd-283">Next steps</span></span>
* [<span data-ttu-id="124cd-284">En savoir plus sur le diagnostic et la surveillance d’un service Fabric Service</span><span class="sxs-lookup"><span data-stu-id="124cd-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
