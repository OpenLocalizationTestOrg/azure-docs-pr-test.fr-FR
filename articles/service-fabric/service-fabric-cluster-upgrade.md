---
title: aaaUpgrade un cluster Azure Service Fabric | Documents Microsoft
description: "Mise à niveau du code de Service Fabric hello et/ou de configuration qui s’exécute à un cluster Service Fabric, notamment en définissant le mode de mise à jour de cluster, la mise à niveau des certificats, ajout de ports d’application, faisant de correctifs de système d’exploitation, et ainsi de suite. Ce que vous attendez lorsque des mises à niveau hello sont effectuées ?"
services: service-fabric
documentationcenter: .net
author: ChackDan
manager: timlt
editor: 
ms.assetid: 15190ace-31ed-491f-a54b-b5ff61e718db
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 8/10/2017
ms.author: chackdan
ms.openlocfilehash: 94ac3833ec0810f79de06ecb50f254028fa90408
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="upgrade-an-azure-service-fabric-cluster"></a><span data-ttu-id="223de-104">Mettre à niveau un cluster Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="223de-104">Upgrade an Azure Service Fabric cluster</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="223de-105">Cluster Azure</span><span class="sxs-lookup"><span data-stu-id="223de-105">Azure Cluster</span></span>](service-fabric-cluster-upgrade.md)
> * [<span data-ttu-id="223de-106">Cluster autonome</span><span class="sxs-lookup"><span data-stu-id="223de-106">Standalone Cluster</span></span>](service-fabric-cluster-upgrade-windows-server.md)
> 
> 

<span data-ttu-id="223de-107">Pour n’importe quel système moderne, la conception des mises à jour est tooachieving clé de succès à long terme de votre produit.</span><span class="sxs-lookup"><span data-stu-id="223de-107">For any modern system, designing for upgradability is key tooachieving long-term success of your product.</span></span> <span data-ttu-id="223de-108">Un cluster Azure Service Fabric est une ressource que vous possédez mais qui est en partie gérée par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="223de-108">An Azure Service Fabric cluster is a resource that you own, but is partly managed by Microsoft.</span></span> <span data-ttu-id="223de-109">Cet article décrit ce qui est géré automatiquement et ce que vous pouvez configurer vous-même.</span><span class="sxs-lookup"><span data-stu-id="223de-109">This article describes what is managed automatically and what you can configure yourself.</span></span>

## <a name="controlling-hello-fabric-version-that-runs-on-your-cluster"></a><span data-ttu-id="223de-110">Contrôle de version de l’ensemble fibre optique hello qui s’exécute sur votre Cluster</span><span class="sxs-lookup"><span data-stu-id="223de-110">Controlling hello fabric version that runs on your Cluster</span></span>
<span data-ttu-id="223de-111">Vous pouvez définir votre structure automatique de cluster tooreceive mises à niveau comme elles sont publiées par Microsoft, ou vous pouvez sélectionner une version prise en charge l’infrastructure souhaité dans votre toobe de cluster.</span><span class="sxs-lookup"><span data-stu-id="223de-111">You can set your cluster tooreceive automatic fabric upgrades as they are released by Microsoft or you can select a supported fabric version you want your cluster toobe on.</span></span>

<span data-ttu-id="223de-112">Pour ce faire, la configuration de cluster « upgrademode doit être » paramètre hello sur le portail de hello ou à l’aide du Gestionnaire de ressources au moment de la création de hello ou version ultérieure sur un cluster dynamique</span><span class="sxs-lookup"><span data-stu-id="223de-112">You do this by setting hello "upgradeMode" cluster configuration on hello portal or using Resource Manager at hello time of creation or later on a live cluster</span></span> 

> [!NOTE]
> <span data-ttu-id="223de-113">Assurez-vous que tookeep votre cluster exécutant une version prise en charge l’infrastructure toujours.</span><span class="sxs-lookup"><span data-stu-id="223de-113">Make sure tookeep your cluster running a supported fabric version always.</span></span> <span data-ttu-id="223de-114">Et, lorsque nous annoncer version hello d’une nouvelle version de l’infrastructure de service, version précédente de hello est marquée pour la fin de la prise en charge un minimum de 60 jours à partir de cette date.</span><span class="sxs-lookup"><span data-stu-id="223de-114">As and when we announce hello release of a new version of service fabric, hello previous version is marked for end of support after a minimum of 60 days from that date.</span></span> <span data-ttu-id="223de-115">Hello nouvelles versions de hello sont annoncées [sur le blog de l’équipe service fabric hello](https://blogs.msdn.microsoft.com/azureservicefabric/).</span><span class="sxs-lookup"><span data-stu-id="223de-115">hello  hello new releases are announced [on hello service fabric team blog](https://blogs.msdn.microsoft.com/azureservicefabric/).</span></span> <span data-ttu-id="223de-116">mise en production Hello est toochoose disponible.</span><span class="sxs-lookup"><span data-stu-id="223de-116">hello new release is available toochoose then.</span></span> 
> 
> 

<span data-ttu-id="223de-117">14 jours expiration toohello préalable de mise en production hello votre cluster est en cours d’exécution, un événement de contrôle d’intégrité est généré qui place de votre cluster dans un état d’avertissement.</span><span class="sxs-lookup"><span data-stu-id="223de-117">14 days prior toohello expiry of hello release your cluster is running, a health event is generated that puts your cluster into a warning health state.</span></span> <span data-ttu-id="223de-118">cluster de Hello reste dans un état d’avertissement jusqu'à ce que vous mettez à niveau la version de l’infrastructure de prise en charge tooa.</span><span class="sxs-lookup"><span data-stu-id="223de-118">hello cluster remains in a warning state until you upgrade tooa supported fabric version.</span></span>

### <a name="setting-hello-upgrade-mode-via-portal"></a><span data-ttu-id="223de-119">Paramètre de mode de mise à niveau hello via le portail</span><span class="sxs-lookup"><span data-stu-id="223de-119">Setting hello upgrade mode via portal</span></span>
<span data-ttu-id="223de-120">Lorsque vous créez un cluster de hello, vous pouvez définir hello cluster tooautomatic ou manuelle.</span><span class="sxs-lookup"><span data-stu-id="223de-120">You can set hello cluster tooautomatic or manual when you are creating hello cluster.</span></span>

![Create_Manualmode][Create_Manualmode]

<span data-ttu-id="223de-122">Vous pouvez définir hello cluster tooautomatic ou manuelle sur un cluster dynamique, à l’aide de hello gérer l’expérience.</span><span class="sxs-lookup"><span data-stu-id="223de-122">You can set hello cluster tooautomatic or manual when on a live cluster, using hello manage experience.</span></span> 

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-portal"></a><span data-ttu-id="223de-123">La mise à niveau tooa une nouvelle version sur un cluster qui est défini en mode de tooManual via le portail.</span><span class="sxs-lookup"><span data-stu-id="223de-123">Upgrading tooa new version on a cluster that is set tooManual mode via portal.</span></span>
<span data-ttu-id="223de-124">tooupgrade tooa nouvelle version, vous devez toodo est sélectionnez la version hello disponible à partir de la liste déroulante de hello et enregistrez.</span><span class="sxs-lookup"><span data-stu-id="223de-124">tooupgrade tooa new version, all you need toodo is select hello available version from hello dropdown and save.</span></span> <span data-ttu-id="223de-125">mise à niveau de Fabric Hello obtient lancé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="223de-125">hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="223de-126">Hello stratégies d’intégrité de cluster (il s’agit d’une combinaison de l’intégrité de nœud et de contrôle d’intégrité hello tous hello applications s’exécutant dans un cluster de hello) sont respectés mise à niveau de tooduring hello.</span><span class="sxs-lookup"><span data-stu-id="223de-126">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="223de-127">Si les stratégies d’intégrité de cluster hello ne sont pas remplies, mise à niveau hello est restaurée.</span><span class="sxs-lookup"><span data-stu-id="223de-127">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="223de-128">Défiler ce document de tooread plus sur la façon de tooset ces stratégies d’intégrité personnalisés.</span><span class="sxs-lookup"><span data-stu-id="223de-128">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="223de-129">Une fois que vous avez résolution des problèmes de hello qui a entraîné la restauration hello, vous devez mise à niveau de hello tooinitiate à nouveau, en suivant hello même procédure qu’avant.</span><span class="sxs-lookup"><span data-stu-id="223de-129">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

![Manage_Automaticmode][Manage_Automaticmode]

### <a name="setting-hello-upgrade-mode-via-a-resource-manager-template"></a><span data-ttu-id="223de-131">Paramètre de mode de mise à niveau hello via un modèle de gestionnaire de ressources</span><span class="sxs-lookup"><span data-stu-id="223de-131">Setting hello upgrade mode via a Resource Manager template</span></span>
<span data-ttu-id="223de-132">Ajouter hello de définition de ressource « upgrademode doit être » configuration toohello Microsoft.ServiceFabric/clusters et ensemble hello « clusterCodeVersion » tooone Hello pris en charge les versions de l’infrastructure, comme indiqué ci-dessous et ensuite déployer le modèle de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-132">Add hello "upgradeMode" configuration toohello Microsoft.ServiceFabric/clusters resource definition and set hello "clusterCodeVersion" tooone of hello supported fabric versions as shown below and then deploy hello template.</span></span> <span data-ttu-id="223de-133">les valeurs valides de Hello pour « upgrademode doit être » sont « Manuel » ou « Automatique »</span><span class="sxs-lookup"><span data-stu-id="223de-133">hello valid values for "upgradeMode" are "Manual" or "Automatic"</span></span>

![ARMUpgradeMode][ARMUpgradeMode]

#### <a name="upgrading-tooa-new-version-on-a-cluster-that-is-set-toomanual-mode-via-a-resource-manager-template"></a><span data-ttu-id="223de-135">La mise à niveau tooa une nouvelle version sur un cluster qui est défini en mode de tooManual via un modèle de gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="223de-135">Upgrading tooa new version on a cluster that is set tooManual mode via a Resource Manager template.</span></span>
<span data-ttu-id="223de-136">Lorsque le cluster de hello est en mode manuel, tooupgrade tooa nouvelle version, modifiez la version prise en charge de tooa hello « clusterCodeVersion » et le déployer.</span><span class="sxs-lookup"><span data-stu-id="223de-136">When hello cluster is in Manual mode, tooupgrade tooa new version, change hello "clusterCodeVersion" tooa supported version and deploy it.</span></span> <span data-ttu-id="223de-137">déploiement de modèle de hello Hello plaisir de mise à niveau de Fabric hello obtient lancé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="223de-137">hello deployment of hello template, kicks of hello Fabric upgrade gets kicked off automatically.</span></span> <span data-ttu-id="223de-138">Hello stratégies d’intégrité de cluster (il s’agit d’une combinaison de l’intégrité de nœud et de contrôle d’intégrité hello tous hello applications s’exécutant dans un cluster de hello) sont respectés mise à niveau de tooduring hello.</span><span class="sxs-lookup"><span data-stu-id="223de-138">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="223de-139">Si les stratégies d’intégrité de cluster hello ne sont pas remplies, mise à niveau hello est restaurée.</span><span class="sxs-lookup"><span data-stu-id="223de-139">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="223de-140">Défiler ce document de tooread plus sur la façon de tooset ces stratégies d’intégrité personnalisés.</span><span class="sxs-lookup"><span data-stu-id="223de-140">Scroll down this document tooread more on how tooset those custom health policies.</span></span> 

<span data-ttu-id="223de-141">Une fois que vous avez résolution des problèmes de hello qui a entraîné la restauration hello, vous devez mise à niveau de hello tooinitiate à nouveau, en suivant hello même procédure qu’avant.</span><span class="sxs-lookup"><span data-stu-id="223de-141">Once you have fixed hello issues that resulted in hello rollback, you need tooinitiate hello upgrade again, by following hello same steps as before.</span></span>

### <a name="get-list-of-all-available-version-for-all-environments-for-a-given-subscription"></a><span data-ttu-id="223de-142">Obtenir la liste de toutes les versions disponibles pour tous les environnements dans le cas d’un abonnement donné</span><span class="sxs-lookup"><span data-stu-id="223de-142">Get list of all available version for all environments for a given subscription</span></span>
<span data-ttu-id="223de-143">Exécutez hello la commande suivante, et vous devez obtenir un toothis similaire de sortie.</span><span class="sxs-lookup"><span data-stu-id="223de-143">Run hello following command, and you should get an output similar toothis.</span></span>

<span data-ttu-id="223de-144">Le paramètre « supportExpiryUtc » vous indique lorsqu’une version donnée arrive à expiration ou a expiré.</span><span class="sxs-lookup"><span data-stu-id="223de-144">"supportExpiryUtc" tells your when a given release is expiring or has expired.</span></span> <span data-ttu-id="223de-145">Hello version la plus récente n’a pas une date valide - elle a la valeur « 9999-12-31T23:59:59.9999999 », ce qui signifie simplement que date d’expiration hello n’est pas encore définie.</span><span class="sxs-lookup"><span data-stu-id="223de-145">hello latest release does not have a valid date - it has a value of "9999-12-31T23:59:59.9999999", which just means that hello expiry date is not yet set.</span></span>

```REST
GET https://<endpoint>/subscriptions/{{subscriptionId}}/providers/Microsoft.ServiceFabric/locations/{{location}}/clusterVersions?api-version=2016-09-01

Example: https://management.azure.com/subscriptions/1857f442-3bce-4b96-ad95-627f76437a67/providers/Microsoft.ServiceFabric/locations/eastus/clusterVersions?api-version=2016-09-01

Output:
{
                  "value": [
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/5.0.1427.9490",
                      "name": "5.0.1427.9490",
                      "type": "Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.0.1427.9490",
                        "supportExpiryUtc": "2016-11-26T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.0.1427.9490",
                      "name": "5.1.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "5.1.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Windows"
                      }
                    },
                    {
                      "id": "subscriptions/35349203-a0b3-405e-8a23-9f1450984307/providers/Microsoft.ServiceFabric/environments/Windows/clusterVersions/4.4.1427.9490",
                      "name": "4.4.1427.9490",
                      "type": " Microsoft.ServiceFabric/environments/clusterVersions",
                      "properties": {
                        "codeVersion": "4.4.1427.9490",
                        "supportExpiryUtc": "9999-12-31T23:59:59.9999999",
                        "environment": "Linux"
                      }
                    }
                  ]
                }


```

## <a name="fabric-upgrade-behavior-when-hello-cluster-upgrade-mode-is-automatic"></a><span data-ttu-id="223de-146">Comportement de mise à niveau de fabric lorsque le Mode de mise à niveau de cluster de hello est automatique</span><span class="sxs-lookup"><span data-stu-id="223de-146">Fabric upgrade behavior when hello cluster Upgrade Mode is Automatic</span></span>
<span data-ttu-id="223de-147">Microsoft gère la configuration qui s’exécute dans un cluster Azure et le code de l’ensemble fibre optique hello.</span><span class="sxs-lookup"><span data-stu-id="223de-147">Microsoft maintains hello fabric code and configuration that runs in an Azure cluster.</span></span> <span data-ttu-id="223de-148">Nous effectuons des logiciels de toohello automatique de mises à niveau analysées en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="223de-148">We perform automatic monitored upgrades toohello software on an as-needed basis.</span></span> <span data-ttu-id="223de-149">Ces mises à niveau peuvent concerner le code, la configuration ou les deux.</span><span class="sxs-lookup"><span data-stu-id="223de-149">These upgrades could be code, configuration, or both.</span></span> <span data-ttu-id="223de-150">toomake sûr que votre application ne subit aucun impact ou un impact minime en raison de mises à niveau toothese, nous effectuer des mises à niveau de la hello Bonjour suivant phases :</span><span class="sxs-lookup"><span data-stu-id="223de-150">toomake sure that your application suffers no impact or minimal impact due toothese upgrades, we perform hello upgrades in hello following phases:</span></span>

### <a name="phase-1-an-upgrade-is-performed-by-using-all-cluster-health-policies"></a><span data-ttu-id="223de-151">Phase 1 : Une mise à niveau est effectuée à l'aide de toutes les stratégies d'intégrité du cluster</span><span class="sxs-lookup"><span data-stu-id="223de-151">Phase 1: An upgrade is performed by using all cluster health policies</span></span>
<span data-ttu-id="223de-152">Pendant cette phase, les mises à niveau hello passer un seul domaine de mise à niveau à la fois, et les applications de hello en cours d’exécution dans un cluster de hello continuent toorun sans interruption de service.</span><span class="sxs-lookup"><span data-stu-id="223de-152">During this phase, hello upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="223de-153">Hello stratégies d’intégrité de cluster (il s’agit d’une combinaison de l’intégrité de nœud et de contrôle d’intégrité hello tous hello applications s’exécutant dans un cluster de hello) sont respectés mise à niveau de tooduring hello.</span><span class="sxs-lookup"><span data-stu-id="223de-153">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered tooduring hello upgrade.</span></span>

<span data-ttu-id="223de-154">Si les stratégies d’intégrité de cluster hello ne sont pas remplies, mise à niveau hello est restaurée.</span><span class="sxs-lookup"><span data-stu-id="223de-154">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="223de-155">Puis un message électronique est envoyé propriétaire toohello d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-155">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="223de-156">messagerie de Hello contient hello informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="223de-156">hello email contains hello following information:</span></span>

* <span data-ttu-id="223de-157">Notification que nous avons dû tooroll dans une mise à niveau de cluster.</span><span class="sxs-lookup"><span data-stu-id="223de-157">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="223de-158">Des suggestions d'actions correctives, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="223de-158">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="223de-159">nombre de Hello de jours (n) jusqu'à ce que nous exécutons la Phase 2.</span><span class="sxs-lookup"><span data-stu-id="223de-159">hello number of days (n) until we execute Phase 2.</span></span>

<span data-ttu-id="223de-160">Nous essayons hello tooexecute que même mettre à niveau plusieurs fois au cas où les mises à niveau a échoué pour des raisons de l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="223de-160">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="223de-161">Hello n jours à partir de la messagerie de hello hello date a été envoyée, nous progressons tooPhase 2.</span><span class="sxs-lookup"><span data-stu-id="223de-161">After hello n days from hello date hello email was sent, we proceed tooPhase 2.</span></span>

<span data-ttu-id="223de-162">Si les stratégies de contrôle d’intégrité de cluster hello sont remplies, mise à niveau hello est considérée comme réussie et marquée comme terminée.</span><span class="sxs-lookup"><span data-stu-id="223de-162">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="223de-163">Cela peut se produire pendant la mise à niveau initiale de hello ou des rediffusions de mise à niveau hello dans cette phase.</span><span class="sxs-lookup"><span data-stu-id="223de-163">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="223de-164">Aucun message électronique de confirmation d'une exécution réussie n'est envoyé.</span><span class="sxs-lookup"><span data-stu-id="223de-164">There is no email confirmation of a successful run.</span></span> <span data-ttu-id="223de-165">Il s’agit de tooavoid envoi vous trop de courriels--reçoit un message électronique devez être considérée comme un toonormal d’exception.</span><span class="sxs-lookup"><span data-stu-id="223de-165">This is tooavoid sending you too many emails--receiving an email should be seen as an exception toonormal.</span></span> <span data-ttu-id="223de-166">Nous pensons que la plupart des toosucceed de mises à niveau de cluster hello sans affecter la disponibilité de votre application.</span><span class="sxs-lookup"><span data-stu-id="223de-166">We expect most of hello cluster upgrades toosucceed without impacting your application availability.</span></span>

### <a name="phase-2-an-upgrade-is-performed-by-using-default-health-policies-only"></a><span data-ttu-id="223de-167">Phase 2 : Une mise à niveau est effectuée à l'aide des stratégies d'intégrité par défaut uniquement</span><span class="sxs-lookup"><span data-stu-id="223de-167">Phase 2: An upgrade is performed by using default health policies only</span></span>
<span data-ttu-id="223de-168">stratégies de contrôle d’intégrité Hello dans cette phase sont définies de telle sorte que nombre de hello d’applications qui ont été intègre au début de hello de mise à niveau hello reste hello même pour hello durée du processus de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="223de-168">hello health policies in this phase are set in such a way that hello number of applications that were healthy at hello beginning of hello upgrade remains hello same for hello duration of hello upgrade process.</span></span> <span data-ttu-id="223de-169">Dans la Phase 1, mises à niveau de la Phase 2 de hello passer un seul domaine de mise à niveau à la fois, et les applications de hello en cours d’exécution dans un cluster de hello continuent toorun sans interruption de service.</span><span class="sxs-lookup"><span data-stu-id="223de-169">As in Phase 1, hello Phase 2 upgrades proceed one upgrade domain at a time, and hello applications that were running in hello cluster continue toorun without any downtime.</span></span> <span data-ttu-id="223de-170">stratégies d’intégrité de cluster Hello (une combinaison de l’intégrité de nœud et de contrôle d’intégrité hello que tous hello applications s’exécutant dans un cluster de hello) sont durée de hello adhésive toofor de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="223de-170">hello cluster health policies (a combination of node health and hello health all hello applications running in hello cluster) are adhered toofor hello duration of hello upgrade.</span></span>

<span data-ttu-id="223de-171">Si les stratégies d’intégrité de cluster hello en vigueur ne sont pas remplies, mise à niveau hello est restaurée.</span><span class="sxs-lookup"><span data-stu-id="223de-171">If hello cluster health policies in effect are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="223de-172">Puis un message électronique est envoyé propriétaire toohello d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-172">Then an email is sent toohello owner of hello subscription.</span></span> <span data-ttu-id="223de-173">messagerie de Hello contient hello informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="223de-173">hello email contains hello following information:</span></span>

* <span data-ttu-id="223de-174">Notification que nous avons dû tooroll dans une mise à niveau de cluster.</span><span class="sxs-lookup"><span data-stu-id="223de-174">Notification that we had tooroll back a cluster upgrade.</span></span>
* <span data-ttu-id="223de-175">Des suggestions d'actions correctives, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="223de-175">Suggested remedial actions, if any.</span></span>
* <span data-ttu-id="223de-176">nombre de Hello de jours (n) jusqu'à ce que nous exécutons la Phase 3.</span><span class="sxs-lookup"><span data-stu-id="223de-176">hello number of days (n) until we execute Phase 3.</span></span>

<span data-ttu-id="223de-177">Nous essayons hello tooexecute que même mettre à niveau plusieurs fois au cas où les mises à niveau a échoué pour des raisons de l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="223de-177">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="223de-178">Un message électronique de rappel est envoyé deux jours avant que le délai de n jours ne soit écoulé.</span><span class="sxs-lookup"><span data-stu-id="223de-178">A reminder email is sent a couple of days before n days are up.</span></span> <span data-ttu-id="223de-179">Hello n jours à partir de la messagerie de hello hello date a été envoyée, nous progressons tooPhase 3.</span><span class="sxs-lookup"><span data-stu-id="223de-179">After hello n days from hello date hello email was sent, we proceed tooPhase 3.</span></span> <span data-ttu-id="223de-180">des messages électroniques Hello que nous envoyer dans la Phase 2 doivent être prises au sérieux et actions de réparation doivent être effectuées.</span><span class="sxs-lookup"><span data-stu-id="223de-180">hello emails we send you in Phase 2 must be taken seriously and remedial actions must be taken.</span></span>

<span data-ttu-id="223de-181">Si les stratégies de contrôle d’intégrité de cluster hello sont remplies, mise à niveau hello est considérée comme réussie et marquée comme terminée.</span><span class="sxs-lookup"><span data-stu-id="223de-181">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="223de-182">Cela peut se produire pendant la mise à niveau initiale de hello ou des rediffusions de mise à niveau hello dans cette phase.</span><span class="sxs-lookup"><span data-stu-id="223de-182">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="223de-183">Aucun message électronique de confirmation d'une exécution réussie n'est envoyé.</span><span class="sxs-lookup"><span data-stu-id="223de-183">There is no email confirmation of a successful run.</span></span>

### <a name="phase-3-an-upgrade-is-performed-by-using-aggressive-health-policies"></a><span data-ttu-id="223de-184">Phase 3 : Une mise à niveau est effectuée à l'aide de stratégies d'intégrité agressives</span><span class="sxs-lookup"><span data-stu-id="223de-184">Phase 3: An upgrade is performed by using aggressive health policies</span></span>
<span data-ttu-id="223de-185">Ces stratégies d’intégrité de cette phase sont adressent à la fin de la mise à niveau hello plutôt que d’intégrité de hello des applications de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-185">These health policies in this phase are geared towards completion of hello upgrade rather than hello health of hello applications.</span></span> <span data-ttu-id="223de-186">Un nombre très faible de mises à niveau du cluster se termine par cette phase.</span><span class="sxs-lookup"><span data-stu-id="223de-186">Very few cluster upgrades end up in this phase.</span></span> <span data-ttu-id="223de-187">Si votre cluster obtient toothis phase, il est probable que votre application devient non intègre et/ou de perdre la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="223de-187">If your cluster gets toothis phase, there is a good chance that your application becomes unhealthy and/or lose availability.</span></span>

<span data-ttu-id="223de-188">Toohello similaire autres deux phases, les mises à niveau de la Phase 3 passer un seul domaine de mise à niveau à la fois.</span><span class="sxs-lookup"><span data-stu-id="223de-188">Similar toohello other two phases, Phase 3 upgrades proceed one upgrade domain at a time.</span></span>

<span data-ttu-id="223de-189">Si les stratégies d’intégrité de cluster hello ne sont pas remplies, mise à niveau hello est restaurée.</span><span class="sxs-lookup"><span data-stu-id="223de-189">If hello cluster health policies are not met, hello upgrade is rolled back.</span></span> <span data-ttu-id="223de-190">Nous essayons hello tooexecute que même mettre à niveau plusieurs fois au cas où les mises à niveau a échoué pour des raisons de l’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="223de-190">We try tooexecute hello same upgrade a few more times in case any upgrades failed for infrastructure reasons.</span></span> <span data-ttu-id="223de-191">Après cela, le cluster de hello est épinglé, afin qu’il ne recevra plus les mises à niveau et/ou de prise en charge.</span><span class="sxs-lookup"><span data-stu-id="223de-191">After that, hello cluster is pinned, so that it will no longer receive support and/or upgrades.</span></span>

<span data-ttu-id="223de-192">Propriétaire de l’abonnement toohello, ainsi que les actions correctives hello est envoyé à un message avec ces informations.</span><span class="sxs-lookup"><span data-stu-id="223de-192">An email with this information is sent toohello subscription owner, along with hello remedial actions.</span></span> <span data-ttu-id="223de-193">N’importe quel tooget clusters ne devrait pas dans un état où la Phase 3 a échoué.</span><span class="sxs-lookup"><span data-stu-id="223de-193">We do not expect any clusters tooget into a state where Phase 3 has failed.</span></span>

<span data-ttu-id="223de-194">Si les stratégies de contrôle d’intégrité de cluster hello sont remplies, mise à niveau hello est considérée comme réussie et marquée comme terminée.</span><span class="sxs-lookup"><span data-stu-id="223de-194">If hello cluster health policies are met, hello upgrade is considered successful and marked complete.</span></span> <span data-ttu-id="223de-195">Cela peut se produire pendant la mise à niveau initiale de hello ou des rediffusions de mise à niveau hello dans cette phase.</span><span class="sxs-lookup"><span data-stu-id="223de-195">This can happen during hello initial upgrade or any of hello upgrade reruns in this phase.</span></span> <span data-ttu-id="223de-196">Aucun message électronique de confirmation d'une exécution réussie n'est envoyé.</span><span class="sxs-lookup"><span data-stu-id="223de-196">There is no email confirmation of a successful run.</span></span>

## <a name="cluster-configurations-that-you-control"></a><span data-ttu-id="223de-197">Configurations de cluster que vous contrôlez</span><span class="sxs-lookup"><span data-stu-id="223de-197">Cluster configurations that you control</span></span>
<span data-ttu-id="223de-198">En outre cluster hello de toohello capacité tooset mise à niveau en mode, voici les configurations hello que vous pouvez modifier sur un cluster dynamique.</span><span class="sxs-lookup"><span data-stu-id="223de-198">In addition toohello ability tooset hello cluster upgrade mode, Here are hello configurations that you can change on a live cluster.</span></span>

### <a name="certificates"></a><span data-ttu-id="223de-199">Certificats</span><span class="sxs-lookup"><span data-stu-id="223de-199">Certificates</span></span>
<span data-ttu-id="223de-200">Vous pouvez ajouter de nouvelles ou supprimer des certificats pour le cluster de hello et du client via le portail de hello facilement.</span><span class="sxs-lookup"><span data-stu-id="223de-200">You can add new or delete certificates for hello cluster and client via hello portal easily.</span></span> <span data-ttu-id="223de-201">Consultez trop[ce document pour obtenir des instructions détaillées](service-fabric-cluster-security-update-certs-azure.md)</span><span class="sxs-lookup"><span data-stu-id="223de-201">Refer too[this document for detailed instructions](service-fabric-cluster-security-update-certs-azure.md)</span></span>

![Capture d’écran qui affiche les empreintes numériques de certificat Bonjour portail Azure.][CertificateUpgrade]

### <a name="application-ports"></a><span data-ttu-id="223de-203">Ports d'application</span><span class="sxs-lookup"><span data-stu-id="223de-203">Application ports</span></span>
<span data-ttu-id="223de-204">Vous pouvez modifier les ports d’application en modifiant les propriétés de ressource d’équilibrage de charge hello qui sont associées au type de nœud hello.</span><span class="sxs-lookup"><span data-stu-id="223de-204">You can change application ports by changing hello Load Balancer resource properties that are associated with hello node type.</span></span> <span data-ttu-id="223de-205">Vous pouvez utiliser le portail de hello, ou vous pouvez utiliser le Gestionnaire de ressources PowerShell directement.</span><span class="sxs-lookup"><span data-stu-id="223de-205">You can use hello portal, or you can use Resource Manager PowerShell directly.</span></span>

<span data-ttu-id="223de-206">tooopen un nouveau port sur toutes les machines virtuelles dans un type de nœud, hello suivant :</span><span class="sxs-lookup"><span data-stu-id="223de-206">tooopen a new port on all VMs in a node type, do hello following:</span></span>

1. <span data-ttu-id="223de-207">Ajouter un nouvel équilibrage de charge approprié toohello sonde.</span><span class="sxs-lookup"><span data-stu-id="223de-207">Add a new probe toohello appropriate load balancer.</span></span>
   
    <span data-ttu-id="223de-208">Si vous avez déployé votre cluster à l’aide du portail de hello, équilibreurs de charge hello sont nommées « LB-nom du groupe de ressources hello-NodeTypename », une pour chaque type de nœud.</span><span class="sxs-lookup"><span data-stu-id="223de-208">If you deployed your cluster by using hello portal, hello load balancers are named "LB-name of hello Resource group-NodeTypename", one for each node type.</span></span> <span data-ttu-id="223de-209">Étant donné que les noms d’équilibrage de charge de hello sont uniques uniquement dans un groupe de ressources, il est préférable du faire si vous recherchez les sous un groupe de ressources spécifique.</span><span class="sxs-lookup"><span data-stu-id="223de-209">Since hello load balancer names are unique only within a resource group, it is best if you search for them under a specific resource group.</span></span>
   
    ![Capture d’écran montre l’ajout d’une sonde tooa charger équilibrage dans le portail de hello.][AddingProbes]
2. <span data-ttu-id="223de-211">Ajouter un équilibrage de charge nouvelle règle toohello.</span><span class="sxs-lookup"><span data-stu-id="223de-211">Add a new rule toohello load balancer.</span></span>
   
    <span data-ttu-id="223de-212">Ajouter un nouveau toohello de règle même équilibreur de charge à l’aide de sonde hello que vous avez créé à l’étape précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-212">Add a new rule toohello same load balancer by using hello probe that you created in hello previous step.</span></span>
   
    ![Ajout d’un équilibreur de charge nouvelle règle tooa dans le portail de hello.][AddingLBRules]

### <a name="placement-properties"></a><span data-ttu-id="223de-214">Propriétés de positionnement</span><span class="sxs-lookup"><span data-stu-id="223de-214">Placement properties</span></span>
<span data-ttu-id="223de-215">Pour chacun des types de nœuds hello, vous pouvez ajouter des propriétés de sélection élective personnalisée que vous souhaitez toouse dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="223de-215">For each of hello node types, you can add custom placement properties that you want toouse in your applications.</span></span> <span data-ttu-id="223de-216">NodeType est une propriété par défaut que vous pouvez utiliser sans l'ajouter explicitement.</span><span class="sxs-lookup"><span data-stu-id="223de-216">NodeType is a default property that you can use without adding it explicitly.</span></span>

> [!NOTE]
> <span data-ttu-id="223de-217">Pour plus d’informations sur l’utilisation de hello de contraintes de placement, propriétés de nœud, et comment toodefine, référence toohello section « Contraintes de Placement et propriétés du nœud » Bonjour Document du Gestionnaire de ressources du Cluster Service Fabric sur [décrivant de votre Cluster ](service-fabric-cluster-resource-manager-cluster-description.md).</span><span class="sxs-lookup"><span data-stu-id="223de-217">For details on hello use of placement constraints, node properties, and how toodefine them, refer toohello section "Placement Constraints and Node Properties" in hello Service Fabric Cluster Resource Manager Document on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>
> 
> 

### <a name="capacity-metrics"></a><span data-ttu-id="223de-218">Métriques de capacité</span><span class="sxs-lookup"><span data-stu-id="223de-218">Capacity metrics</span></span>
<span data-ttu-id="223de-219">Pour chacun des types de nœuds hello, vous pouvez ajouter des métriques de capacité personnalisé que vous souhaitez toouse dans votre charge de tooreport d’applications.</span><span class="sxs-lookup"><span data-stu-id="223de-219">For each of hello node types, you can add custom capacity metrics that you want toouse in your applications tooreport load.</span></span> <span data-ttu-id="223de-220">Pour plus d’informations sur l’utilisation hello de métriques tooreport charge, consultez la toohello Documents du Gestionnaire de ressources du Cluster Service Fabric [décrivant de votre Cluster](service-fabric-cluster-resource-manager-cluster-description.md) et [métriques et charge](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="223de-220">For details on hello use of capacity metrics tooreport load, refer toohello Service Fabric Cluster Resource Manager Documents on [Describing Your Cluster](service-fabric-cluster-resource-manager-cluster-description.md) and [Metrics and Load](service-fabric-cluster-resource-manager-metrics.md).</span></span>

### <a name="fabric-upgrade-settings---health-polices"></a><span data-ttu-id="223de-221">Paramètres de mise à niveau de la structure : stratégies de contrôle d’intégrité</span><span class="sxs-lookup"><span data-stu-id="223de-221">Fabric upgrade settings - Health polices</span></span>
<span data-ttu-id="223de-222">Vous pouvez spécifier des stratégies de contrôle d’intégrité personnalisées pour la mise à niveau de la structure.</span><span class="sxs-lookup"><span data-stu-id="223de-222">You can specify custom health polices for fabric upgrade.</span></span> <span data-ttu-id="223de-223">Si vous avez défini votre tooAutomatic cluster mises à niveau de l’ensemble fibre optique, ces stratégies obtiennent appliqué toohello Phase 1 de mises à niveau de l’ensemble fibre optique automatique hello.</span><span class="sxs-lookup"><span data-stu-id="223de-223">If you have set your cluster tooAutomatic fabric upgrades, then these policies get applied toohello Phase-1 of hello automatic fabric upgrades.</span></span>
<span data-ttu-id="223de-224">Si vous avez défini votre cluster de l’ensemble fibre optique manuelle de mises à niveau, puis ces stratégies soient appliqués à chaque fois que vous sélectionnez une nouvelle version de déclenchement tookick de système de hello désactiver la mise à niveau de fabric hello dans votre cluster.</span><span class="sxs-lookup"><span data-stu-id="223de-224">If you have set your cluster for Manual fabric upgrades, then these policies get applied each time you select a new version triggering hello system tookick off hello fabric upgrade in your cluster.</span></span> <span data-ttu-id="223de-225">Si vous ne substituez pas les stratégies de hello, valeurs par défaut de hello sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="223de-225">If you do not override hello policies, hello defaults are used.</span></span>

<span data-ttu-id="223de-226">Vous pouvez spécifier des stratégies de contrôle d’intégrité personnalisé hello ou passez en revue les paramètres actuels de hello sous le panneau de « mise à niveau de fabric » hello, en sélectionnant la mise à niveau des paramètres avancé de hello.</span><span class="sxs-lookup"><span data-stu-id="223de-226">You can specify hello custom health policies or review hello current settings under hello "fabric upgrade" blade, by selecting hello advanced upgrade settings.</span></span> <span data-ttu-id="223de-227">Passez en revue hello suivant image comment.</span><span class="sxs-lookup"><span data-stu-id="223de-227">Review hello following picture on how to.</span></span> 

![Gérer les stratégies de contrôle d’intégrité personnalisées][HealthPolices]

### <a name="customize-fabric-settings-for-your-cluster"></a><span data-ttu-id="223de-229">Personnaliser les paramètres de la structure pour votre cluster</span><span class="sxs-lookup"><span data-stu-id="223de-229">Customize Fabric settings for your cluster</span></span>
<span data-ttu-id="223de-230">Consultez trop[les paramètres de l’infrastructure de cluster l’infrastructure de service](service-fabric-cluster-fabric-settings.md) sur les éléments et comment vous pouvez les personnaliser.</span><span class="sxs-lookup"><span data-stu-id="223de-230">Refer too[service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md) on what and how you can customize them.</span></span>

### <a name="os-patches-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="223de-231">Correctifs de système d’exploitation sur hello machines virtuelles qui composent hello cluster</span><span class="sxs-lookup"><span data-stu-id="223de-231">OS patches on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="223de-232">Consultez trop[correctif Orchestration Application](service-fabric-patch-orchestration-application.md) qui peuvent être déployés sur vos correctifs tooinstall de cluster à partir de Windows Update de façon orchestrée, en conservant les services hello disponibles tout temps hello.</span><span class="sxs-lookup"><span data-stu-id="223de-232">Refer too[Patch Orchestration Application](service-fabric-patch-orchestration-application.md) which can be deployed on your cluster tooinstall patches from Windows Update in an orchestrated manner, keeping hello services available all hello time.</span></span> 

### <a name="os-upgrades-on-hello-vms-that-make-up-hello-cluster"></a><span data-ttu-id="223de-233">Mises à niveau du système d’exploitation sur hello machines virtuelles qui composent hello cluster</span><span class="sxs-lookup"><span data-stu-id="223de-233">OS upgrades on hello VMs that make up hello cluster</span></span>
<span data-ttu-id="223de-234">Si vous devez mettre à niveau d’image de système d’exploitation hello sur des machines virtuelles de hello du cluster de hello, vous devez utiliser une machine virtuelle à la fois.</span><span class="sxs-lookup"><span data-stu-id="223de-234">If you must upgrade hello OS image on hello virtual machines of hello cluster, you must do it one VM at a time.</span></span> <span data-ttu-id="223de-235">Vous êtes responsable de cette mise à niveau, rien n’est actuellement automatisé à ce sujet.</span><span class="sxs-lookup"><span data-stu-id="223de-235">You are responsible for this upgrade--there is currently no automation for this.</span></span>

## <a name="next-steps"></a><span data-ttu-id="223de-236">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="223de-236">Next steps</span></span>
* <span data-ttu-id="223de-237">Découvrez comment toocustomize certaines hello [les paramètres de l’infrastructure de cluster l’infrastructure de service](service-fabric-cluster-fabric-settings.md)</span><span class="sxs-lookup"><span data-stu-id="223de-237">Learn how toocustomize some of hello [service fabric cluster fabric settings](service-fabric-cluster-fabric-settings.md)</span></span>
* <span data-ttu-id="223de-238">Découvrez comment trop[l’échelle de votre cluster et l’extraction](service-fabric-cluster-scale-up-down.md)</span><span class="sxs-lookup"><span data-stu-id="223de-238">Learn how too[scale your cluster in and out](service-fabric-cluster-scale-up-down.md)</span></span>
* <span data-ttu-id="223de-239">Découvrez les [mises à niveau de l’application](service-fabric-application-upgrade.md)</span><span class="sxs-lookup"><span data-stu-id="223de-239">Learn about [application upgrades](service-fabric-application-upgrade.md)</span></span>

<!--Image references-->
[CertificateUpgrade]: ./media/service-fabric-cluster-upgrade/CertificateUpgrade2.png
[AddingProbes]: ./media/service-fabric-cluster-upgrade/addingProbes2.PNG
[AddingLBRules]: ./media/service-fabric-cluster-upgrade/addingLBRules.png
[HealthPolices]: ./media/service-fabric-cluster-upgrade/Manage_AutomodeWadvSettings.PNG
[ARMUpgradeMode]: ./media/service-fabric-cluster-upgrade/ARMUpgradeMode.PNG
[Create_Manualmode]: ./media/service-fabric-cluster-upgrade/Create_Manualmode.PNG
[Manage_Automaticmode]: ./media/service-fabric-cluster-upgrade/Manage_Automaticmode.PNG
