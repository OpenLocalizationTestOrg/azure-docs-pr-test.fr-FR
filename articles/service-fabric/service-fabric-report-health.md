---
title: "rapports d’intégrité de l’infrastructure de Service personnalisés aaaAdd | Documents Microsoft"
description: "Décrit comment les rapports d’état personnalisé toosend entités de contrôle d’intégrité tooAzure Service Fabric. Fournit des recommandations pour la conception et la mise en œuvre de rapports d’intégrité de qualité."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="fc75c-104">Ajout de rapports d’intégrité Service Fabric personnalisés</span><span class="sxs-lookup"><span data-stu-id="fc75c-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="fc75c-105">Azure Service Fabric introduit un [modèle d’intégrité](service-fabric-health-introduction.md) conçu tooflag les cluster défectueux et les conditions d’application sur des entités spécifiques.</span><span class="sxs-lookup"><span data-stu-id="fc75c-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="fc75c-106">modèle de contrôle d’intégrité Hello utilise **rapporteurs de contrôle d’intégrité** (composants système et des agents de surveillance).</span><span class="sxs-lookup"><span data-stu-id="fc75c-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="fc75c-107">objectif de Hello est facile et rapide de diagnostic et de réparation.</span><span class="sxs-lookup"><span data-stu-id="fc75c-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="fc75c-108">Enregistreurs de service doivent toothink dès le départ sur le contrôle d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="fc75c-109">Toutes les conditions qui peuvent avoir un impact sur l’intégrité doivent être signalée, surtout si elle peut aider à des problèmes d’indicateur fermer toohello racine.</span><span class="sxs-lookup"><span data-stu-id="fc75c-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="fc75c-110">informations de contrôle d’intégrité Hello pouvant gagner du temps sur l’examen et le débogage.</span><span class="sxs-lookup"><span data-stu-id="fc75c-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="fc75c-111">Hello utilité est particulièrement évident une fois hello service en cours d’exécution à grande échelle dans le cloud de hello (privée ou Azure).</span><span class="sxs-lookup"><span data-stu-id="fc75c-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="fc75c-112">Moniteur de rapporteurs Hello Service Fabric identifié les conditions d’intérêt.</span><span class="sxs-lookup"><span data-stu-id="fc75c-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="fc75c-113">Ils dressent un rapport sur ces conditions en fonction de leur vue locale.</span><span class="sxs-lookup"><span data-stu-id="fc75c-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="fc75c-114">Hello [magasin de contrôle d’intégrité](service-fabric-health-introduction.md#health-store) agrège des données de contrôle d’intégrité envoyées par tous les rapporteurs toodetermine si les entités sont globalement intègres.</span><span class="sxs-lookup"><span data-stu-id="fc75c-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="fc75c-115">modèle de Hello est toouse riche, flexible et facile de toobe prévue.</span><span class="sxs-lookup"><span data-stu-id="fc75c-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="fc75c-116">qualité Hello de rapports d’intégrité de hello détermine la précision hello de vue de contrôle d’intégrité hello du cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="fc75c-117">Des faux positifs qui indiquent erronément des problèmes d’intégrité peuvent avoir une incidence négative sur les mises à niveau ou autres services utilisant des données d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="fc75c-118">Les services de réparation et mécanismes d’alertes sont des exemples de services de ce type.</span><span class="sxs-lookup"><span data-stu-id="fc75c-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="fc75c-119">Par conséquent, la réflexion est rapports tooprovide nécessaires qui capturent les conditions d’intérêt dans hello meilleure façon possible.</span><span class="sxs-lookup"><span data-stu-id="fc75c-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="fc75c-120">toodesign et mettre en œuvre l’intégrité reporting, agents de surveillance et les composants système doivent :</span><span class="sxs-lookup"><span data-stu-id="fc75c-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="fc75c-121">Définir la condition hello qu'intéressent, moyen hello qu'il est analysé et hello a d’impact sur la fonctionnalité de cluster ou une application hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="fc75c-122">En fonction de ces informations, décider de hello rapport d’intégrité et de la propriété état d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="fc75c-123">Déterminer hello [entité](service-fabric-health-introduction.md#health-entities-and-hierarchy) que hello état s’applique.</span><span class="sxs-lookup"><span data-stu-id="fc75c-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="fc75c-124">Déterminer où hello reporting est effectuée, depuis hello surveillance de service ou à partir d’une commande interne ou externe.</span><span class="sxs-lookup"><span data-stu-id="fc75c-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="fc75c-125">Définir un rapporteur de hello tooidentify source utilisée.</span><span class="sxs-lookup"><span data-stu-id="fc75c-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="fc75c-126">Choisir une stratégie de création de rapports, périodiquement ou selon les transitions.</span><span class="sxs-lookup"><span data-stu-id="fc75c-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="fc75c-127">Hello recommandé consiste régulièrement, car elle nécessite que du code plus simple et est moins sujet tooerrors.</span><span class="sxs-lookup"><span data-stu-id="fc75c-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="fc75c-128">Déterminer les rapports hello combien de temps pour les conditions non intègres doivent rester dans le magasin de contrôle d’intégrité hello et comment il doit être effacé.</span><span class="sxs-lookup"><span data-stu-id="fc75c-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="fc75c-129">À l’aide de ces informations, de déterminer le comportement au moment de l’état hello toolive et suppression à l’expiration.</span><span class="sxs-lookup"><span data-stu-id="fc75c-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="fc75c-130">Comme mentionné auparavant, la création de rapports peut être effectuée à partir des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="fc75c-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="fc75c-131">Hello analysés réplica de service Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="fc75c-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="fc75c-132">Les agents de surveillance internes déployés en tant que services Service Fabric (par exemple, un service Service Fabric sans état, qui surveille des conditions et émet des rapports).</span><span class="sxs-lookup"><span data-stu-id="fc75c-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="fc75c-133">agents de surveillance Hello peuvent être déployé une tous les nœuds ou peuvent être associés toohello analysé service.</span><span class="sxs-lookup"><span data-stu-id="fc75c-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="fc75c-134">Agents de surveillance internes qui s’exécutent sur des nœuds de Service Fabric hello mais sont *pas* implémenté en tant que services de Fabric de Service.</span><span class="sxs-lookup"><span data-stu-id="fc75c-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="fc75c-135">Externe watchdogs cette ressource hello de sonde de *en dehors de* cluster Service Fabric de hello (par exemple, service de surveillance comme Gomez).</span><span class="sxs-lookup"><span data-stu-id="fc75c-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="fc75c-136">En dehors de la zone de hello, cluster de hello est remplie avec les rapports d’intégrité envoyés par les composants du système hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="fc75c-137">Pour en savoir plus, voir [Utilisation des rapports d’intégrité système pour la résolution des problèmes](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="fc75c-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="fc75c-138">Hello rapports utilisateur doivent être envoyés [les entités d’intégrité](service-fabric-health-introduction.md#health-entities-and-hierarchy) qui ont déjà été créés par le système de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="fc75c-139">Une fois hello design de création de rapports d’intégrité est clair, rapports d’intégrité peuvent être envoyés facilement.</span><span class="sxs-lookup"><span data-stu-id="fc75c-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="fc75c-140">Vous pouvez utiliser [fabricclient ne](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport intégrité si hello cluster n’est pas [sécurisé](service-fabric-cluster-security.md) ou si le client de l’ensemble fibre optique hello a des privilèges d’administrateur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="fc75c-141">Création de rapports peut être effectuée via hello API par à l’aide de [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), PowerShell, ou via REST.</span><span class="sxs-lookup"><span data-stu-id="fc75c-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="fc75c-142">Des boutons de configuration regroupent les rapports afin d’améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="fc75c-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="fc75c-143">Signalement d’intégrité est synchrone, et il représente uniquement les travaux de validation hello côté client de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="fc75c-144">fait que hello rapport Hello est accepté par le client de contrôle d’intégrité de hello ou hello `Partition` ou `CodePackageActivationContext` objets ne signifie pas qu’il est appliqué dans le magasin de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="fc75c-145">Il est envoyé de manière asynchrone et éventuellement regroupé avec d’autres rapports.</span><span class="sxs-lookup"><span data-stu-id="fc75c-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="fc75c-146">Hello traitement sur le serveur de hello peut-être encore échouer : numéro de séquence hello peut être périmé, entité hello sur quel hello rapport doit être appliqué a été supprimé, etc..</span><span class="sxs-lookup"><span data-stu-id="fc75c-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="fc75c-147">Client de contrôle d’intégrité</span><span class="sxs-lookup"><span data-stu-id="fc75c-147">Health client</span></span>
<span data-ttu-id="fc75c-148">rapports d’intégrité de Hello sont envoyés magasin de contrôle d’intégrité toohello via un client de contrôle d’intégrité, qui se trouve à l’intérieur du client de l’ensemble fibre optique hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="fc75c-149">client de contrôle d’intégrité Hello peut être configuré avec hello suivant les paramètres :</span><span class="sxs-lookup"><span data-stu-id="fc75c-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="fc75c-150">**HealthReportSendInterval**: délai hello entre le rapport de hello temps hello est ajouté toohello client et hello le temps qu’il est envoyé le magasin de contrôle d’intégrité toohello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="fc75c-151">Rapports toobatch utilisé dans un seul message, plutôt que d’envoyer un message pour chaque rapport.</span><span class="sxs-lookup"><span data-stu-id="fc75c-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="fc75c-152">le traitement par lot Hello améliore les performances.</span><span class="sxs-lookup"><span data-stu-id="fc75c-152">hello batching improves performance.</span></span> <span data-ttu-id="fc75c-153">Par défaut : 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="fc75c-154">**HealthReportRetrySendInterval**: magasin de contrôle d’intégrité toohello des rapports intervalle hello à quels hello client de contrôle d’intégrité renvoie le cumul d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="fc75c-155">Par défaut : 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="fc75c-156">**HealthOperationTimeout**: délai d’attente hello pour un message de rapport envoyé le magasin de contrôle d’intégrité toohello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="fc75c-157">Si un message arrive à expiration, client de contrôle d’intégrité hello réessaie jusqu'à ce que le magasin de contrôle d’intégrité hello confirme que le rapport de hello a été traitée.</span><span class="sxs-lookup"><span data-stu-id="fc75c-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="fc75c-158">Par défaut : deux minutes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="fc75c-159">Lorsque les rapports hello sont traités par lot, les clients de l’ensemble fibre optique hello doivent être maintenus actifs au moins hello tooensure HealthReportSendInterval qui leur sont envoyés.</span><span class="sxs-lookup"><span data-stu-id="fc75c-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="fc75c-160">Si le message de type hello est perdu ou magasin de contrôle d’intégrité hello ne peut pas les appliquer en raison d’erreurs de tootransient, client de l’ensemble fibre optique hello doit rester actif toogive plus de temps il un tooretry chance.</span><span class="sxs-lookup"><span data-stu-id="fc75c-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="fc75c-161">Hello mise en mémoire tampon sur le client de hello prend l’unicité de hello des rapports de hello en considération.</span><span class="sxs-lookup"><span data-stu-id="fc75c-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="fc75c-162">Par exemple, si un rapporteur incorrect particulier ne signale pas 100 rapports par seconde sur hello même propriété Hello même entité, hello rapports sont remplacées par la dernière version de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="fc75c-163">Au plus un rapport de ce type existe dans la file d’attente du client hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="fc75c-164">Si le traitement par lot est configurée, hello d’états envoyés magasin de contrôle d’intégrité toohello est qu’une seule par intervalle d’envoi.</span><span class="sxs-lookup"><span data-stu-id="fc75c-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="fc75c-165">Ce rapport est hello dernier ajout de rapports, qui reflète l’état le plus récent de l’entité de hello hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="fc75c-166">Spécifiez les paramètres de configuration lorsque `FabricClient` est créé en passant [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) avec hello valeurs souhaitées pour les entrées relatives à la santé.</span><span class="sxs-lookup"><span data-stu-id="fc75c-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="fc75c-167">Bonjour exemple suivant crée un client de l’ensemble fibre optique et spécifie que les rapports hello doivent être envoyés lorsqu’ils sont ajoutés.</span><span class="sxs-lookup"><span data-stu-id="fc75c-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="fc75c-168">En cas de délais d’attente et d’erreurs pouvant donner lieu à une nouvelle tentative, les nouvelles tentatives ont lieu toutes les 40 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="fc75c-169">Nous recommandons de conserver l’ensemble fibre optique de hello par défaut des paramètres de client, définissent `HealthReportSendInterval` too30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="fc75c-170">Ce paramètre permet de garantir des performances optimales toobatching échéance.</span><span class="sxs-lookup"><span data-stu-id="fc75c-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="fc75c-171">Pour les rapports critiques qui doivent être envoyés dès que possible, utilisez `HealthReportSendOptions` avec Immediate `true` dans l’API [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth).</span><span class="sxs-lookup"><span data-stu-id="fc75c-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="fc75c-172">Rapports immédiates contournement hello intervalle de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="fc75c-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="fc75c-173">Utilisez cet indicateur avec précaution ; Nous souhaitons parti tootake du client de contrôle d’intégrité hello le traitement par lots chaque fois que possible.</span><span class="sxs-lookup"><span data-stu-id="fc75c-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="fc75c-174">Envoi immédiat est également utile lors de la fermeture de client de l’ensemble fibre optique hello (par exemple, les processus hello a déterminé l’état non valide et doit tooshut tooprevent effets vers le bas).</span><span class="sxs-lookup"><span data-stu-id="fc75c-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="fc75c-175">Elle garantit un envoi meilleur effort des rapports de hello accumulée.</span><span class="sxs-lookup"><span data-stu-id="fc75c-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="fc75c-176">Lorsqu’un rapport est ajouté avec l’indicateur immédiate, client de contrôle d’intégrité hello traite tous les rapports hello accumulée depuis le dernier envoi.</span><span class="sxs-lookup"><span data-stu-id="fc75c-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="fc75c-177">Mêmes paramètres peuvent être spécifiés lors de la création d’un cluster de tooa connexion via PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fc75c-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="fc75c-178">Bonjour à l’exemple suivant démarre un cluster local tooa de connexion :</span><span class="sxs-lookup"><span data-stu-id="fc75c-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="fc75c-179">De même tooAPI, les rapports peuvent être envoyés à l’aide de `-Immediate` commutateur toobe envoyé immédiatement, quelle que soit hello `HealthReportSendInterval` valeur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="fc75c-180">Pour REST, hello rapports sont envoyés passerelle toohello Service Fabric, ce qui a un client de l’infrastructure interne.</span><span class="sxs-lookup"><span data-stu-id="fc75c-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="fc75c-181">Par défaut, ce client est configuré toosend les rapports traités par lot toutes les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="fc75c-182">Vous pouvez modifier l’intervalle de lot hello avec le paramètre de configuration de cluster hello `HttpGatewayHealthReportSendInterval` sur `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="fc75c-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="fc75c-183">Comme mentionné, il vaut mieux toosend des rapports hello avec `Immediate` true.</span><span class="sxs-lookup"><span data-stu-id="fc75c-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="fc75c-184">tooensure non autorisée de services ne peut pas rapporter d’intégrité sur des entités hello dans un cluster de hello, configurer hello server tooaccept uniquement les demandes provenant des clients sécurisés.</span><span class="sxs-lookup"><span data-stu-id="fc75c-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="fc75c-185">Hello `FabricClient` utilisé pour la création de rapports doit avoir sécurité activée toocommunicate en mesure de toobe avec cluster hello (par exemple, avec l’authentification Kerberos ou certificat).</span><span class="sxs-lookup"><span data-stu-id="fc75c-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="fc75c-186">En savoir plus sur la [sécurité du cluster](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="fc75c-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="fc75c-187">Création de rapports depuis les services à faibles privilèges</span><span class="sxs-lookup"><span data-stu-id="fc75c-187">Report from within low privilege services</span></span>
<span data-ttu-id="fc75c-188">Si les services de Fabric de Service n’ont pas de cluster de toohello d’accès administrateur, vous pouvez signaler d’intégrité sur les entités à partir du contexte actuel de hello via `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="fc75c-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="fc75c-189">Pour les services sans état, utilisez [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport sur l’instance actuelle du service hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="fc75c-190">Pour les services avec état, utilisez [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport sur le réplica en cours.</span><span class="sxs-lookup"><span data-stu-id="fc75c-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="fc75c-191">Utilisez [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport sur l’entité de partition actuel hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="fc75c-192">Utilisez [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport sur l’application actuelle.</span><span class="sxs-lookup"><span data-stu-id="fc75c-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="fc75c-193">Utilisez [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport dans l’application actuelle hello déployée sur le nœud actuel de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="fc75c-194">Utilisez [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport sur un package de service pour l’application hello déployé sur le nœud actuel de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="fc75c-195">En interne, hello `Partition` et hello `CodePackageActivationContext` contenir un client de contrôle d’intégrité configuré avec les paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="fc75c-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="fc75c-196">Comme expliqué pourquoi [client de contrôle d’intégrité](service-fabric-report-health.md#health-client), les rapports sont traités par lot et envoyés sur un minuteur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="fc75c-197">les objets Hello doivent être conservés toohave actif à un rapport de hello toosend chance.</span><span class="sxs-lookup"><span data-stu-id="fc75c-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="fc75c-198">Vous pouvez spécifier `HealthReportSendOptions` lors de l’envoi de rapports par le biais des API de contrôle d’intégrité `Partition` et `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="fc75c-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="fc75c-199">Si des rapports critiques doivent être envoyés dès que possible, utilisez `HealthReportSendOptions` avec Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="fc75c-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="fc75c-200">Rapports immédiates contournement hello intervalle du client de contrôle d’intégrité interne hello de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="fc75c-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="fc75c-201">Comme mentionné précédemment, utilisez-le avec précaution ; Nous souhaitons parti tootake du client de contrôle d’intégrité hello le traitement par lots chaque fois que possible.</span><span class="sxs-lookup"><span data-stu-id="fc75c-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="fc75c-202">Conception de rapports d’intégrité</span><span class="sxs-lookup"><span data-stu-id="fc75c-202">Design health reporting</span></span>
<span data-ttu-id="fc75c-203">Hello première étape de génération de rapports de haute qualité est l’identification des conditions de hello pouvant affecter intégrité hello du service de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="fc75c-204">Toutes les conditions qui peuvent aider à des problèmes d’indicateur dans le cluster ou le service de hello lors du démarrage, ou mieux encore, avant un problème se produit, peut éventuellement enregistrer milliards de dollars.</span><span class="sxs-lookup"><span data-stu-id="fc75c-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="fc75c-205">Hello avantages inférieur temps d’arrêt, le moins d’heures nuit consacré à examiner et réparer les problèmes et la satisfaction des clients plus élevée.</span><span class="sxs-lookup"><span data-stu-id="fc75c-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="fc75c-206">Une fois que les conditions de hello sont identifiées, les enregistreurs de surveillance doivent toofigure des meilleures toomonitor de façon hello pour trouver un équilibre entre la charge et de l’utilité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="fc75c-207">Prenons comme exemple un service qui effectue des calculs complexes qui utilisent des fichiers temporaires sur un partage.</span><span class="sxs-lookup"><span data-stu-id="fc75c-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="fc75c-208">Une surveillance peut surveiller hello tooensure de partage que l’espace est suffisant.</span><span class="sxs-lookup"><span data-stu-id="fc75c-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="fc75c-209">Il peut écouter les notifications relatives aux modifications de fichiers ou de répertoires.</span><span class="sxs-lookup"><span data-stu-id="fc75c-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="fc75c-210">Il peut signaler un avertissement si un seuil initial est atteint et signale une erreur si le partage de hello est plein.</span><span class="sxs-lookup"><span data-stu-id="fc75c-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="fc75c-211">Un avertissement, un système de réparation a pu démarrer nettoyage des anciens fichiers sur le partage de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="fc75c-212">En cas d’erreur, un système de réparation peut déplacer nœud tooanother de hello service réplica.</span><span class="sxs-lookup"><span data-stu-id="fc75c-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="fc75c-213">Notez comment les États de condition hello sont décrits en termes de contrôle d’intégrité : hello état de hello condition peut être considéré comme saine (OK) ou défectueux (avertissement ou erreur).</span><span class="sxs-lookup"><span data-stu-id="fc75c-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="fc75c-214">Une fois les détails de surveillance hello définies, un writer de surveillance doit toofigure out comment tooimplement hello surveillance.</span><span class="sxs-lookup"><span data-stu-id="fc75c-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="fc75c-215">Si les conditions hello peuvent être déterminées à partir de service de hello, surveillance de hello peut faire partie du service hello analysé lui-même.</span><span class="sxs-lookup"><span data-stu-id="fc75c-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="fc75c-216">Par exemple, code de service hello peut vérifier l’utilisation du partage hello et puis chaque fois qu’il tente de toowrite un fichier de rapport.</span><span class="sxs-lookup"><span data-stu-id="fc75c-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="fc75c-217">avantage Hello de cette approche est que la création de rapports est simple.</span><span class="sxs-lookup"><span data-stu-id="fc75c-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="fc75c-218">Il convient de tooprevent les bogues de surveillance d’affecter les fonctionnalités d’un service hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="fc75c-219">Création de rapports à partir de service de hello analysé n’est pas toujours une option.</span><span class="sxs-lookup"><span data-stu-id="fc75c-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="fc75c-220">Une surveillance au sein du service de hello peut-être pas les conditions de hello toodetect en mesure de.</span><span class="sxs-lookup"><span data-stu-id="fc75c-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="fc75c-221">Il ne peut pas avoir détermination de hello toomake logique ou les données des hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="fc75c-222">surcharge de Hello de surveillance des conditions de hello peut être élevé.</span><span class="sxs-lookup"><span data-stu-id="fc75c-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="fc75c-223">conditions de Hello également peuvent ne pas être spécifique tooa service, mais au lieu de cela affecter les interactions entre les services.</span><span class="sxs-lookup"><span data-stu-id="fc75c-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="fc75c-224">Une autre option consiste toohave des agents de surveillance dans un cluster de hello en tant que processus distincts.</span><span class="sxs-lookup"><span data-stu-id="fc75c-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="fc75c-225">agents de surveillance Hello surveiller des conditions de hello et les rapports, sans affecter les principaux services de hello en aucune façon.</span><span class="sxs-lookup"><span data-stu-id="fc75c-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="fc75c-226">Par exemple, ces agents de surveillance peuvent être implémentées en tant que services sans état Bonjour même application, déployée sur tous les nœuds ou hello mêmes nœuds en tant que service de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="fc75c-227">Parfois, une surveillance en cours d’exécution dans un cluster de hello n’est pas une option soit.</span><span class="sxs-lookup"><span data-stu-id="fc75c-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="fc75c-228">Si condition de hello analysé disponibilité de hello ou des fonctionnalités du service de hello comme les utilisateurs le voir, il s’agit meilleures agents de surveillance de hello toohave Bonjour même endroit en tant que clients utilisateur hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="fc75c-229">Là, ils peuvent tester le fonctionnement de hello Bonjour d’utilisateurs les appellent.</span><span class="sxs-lookup"><span data-stu-id="fc75c-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="fc75c-230">Par exemple, vous pouvez avoir une surveillance qui réside en dehors du cluster de hello et émet des requêtes toohello service vérifie la latence de hello et l’exactitude des résultats de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="fc75c-231">(Par exemple, pour un service de calculatrice, l’opération 2 + 2 retourne-t-elle 4 dans un délai raisonnable ?)</span><span class="sxs-lookup"><span data-stu-id="fc75c-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="fc75c-232">Une fois que les détails de surveillance hello ont été finalisées, vous devez choisir un ID de source qui identifie de façon unique.</span><span class="sxs-lookup"><span data-stu-id="fc75c-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="fc75c-233">Si plusieurs agents de surveillance de hello même type sont courantes dans hello cluster, ils doivent créer un rapport sur les différentes entités, ou, si ceux-ci font sur hello même entité, utiliser l’ID source différente ou propriété.</span><span class="sxs-lookup"><span data-stu-id="fc75c-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="fc75c-234">De cette façon, leurs rapports peuvent coexister.</span><span class="sxs-lookup"><span data-stu-id="fc75c-234">This way, their reports can coexist.</span></span> <span data-ttu-id="fc75c-235">propriété Hello du rapport de contrôle d’intégrité hello doit capturer la condition de hello analysé.</span><span class="sxs-lookup"><span data-stu-id="fc75c-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="fc75c-236">(Pour l’exemple hello ci-dessus, la propriété de hello peut être **ShareSize**.) Si plusieurs rapports appliquent toohello même condition, hello propriété doit contenir des informations dynamiques que toocoexist de rapports.</span><span class="sxs-lookup"><span data-stu-id="fc75c-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="fc75c-237">Par exemple, si plusieurs partages doivent toobe analysé, nom de la propriété hello peut être **ShareSize-nom_partage**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="fc75c-238">Faire *pas* utiliser hello magasin tookeep informations d’état.</span><span class="sxs-lookup"><span data-stu-id="fc75c-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="fc75c-239">Seules les informations relatives à la santé doivent être signalées comme contrôle d’intégrité, en tant que cette évaluation de l’intégrité des informations impacts hello d’une entité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="fc75c-240">magasin de contrôle d’intégrité Hello n’est pas conçu comme un magasin à usage général.</span><span class="sxs-lookup"><span data-stu-id="fc75c-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="fc75c-241">Il utilise tooaggregate de logique d’évaluation d’intégrité de toutes les données dans l’état d’intégrité hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="fc75c-242">Envoi d’informations toohealth non liée (par exemple, signalent l’état de l’état d’intégrité de OK) n’affecte pas la hello agrégées à l’état d’intégrité, mais il peut nuire aux performances hello du magasin de contrôle d’intégrité hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="fc75c-243">point de décision suivant Hello est le tooreport entité sur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="fc75c-244">La plupart du temps hello, condition de hello clairement idetifies hello d’entité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="fc75c-245">Choisissez l’entité de hello avec une meilleure granularité possible.</span><span class="sxs-lookup"><span data-stu-id="fc75c-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="fc75c-246">Si une condition a une incidence sur tous les réplicas d’une partition, un rapport sur la partition de hello, pas sur le service de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="fc75c-247">Il existe cependant des cas où une réflexion approfondie s’impose.</span><span class="sxs-lookup"><span data-stu-id="fc75c-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="fc75c-248">Si la condition de hello a une incidence sur une entité, comme un réplica, mais hello désir est toohave hello condition marquée plus longtemps que la durée de hello de durée de vie de réplica, puis il doit être signalée sur la partition de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="fc75c-249">Dans le cas contraire, lorsque le réplica de hello est supprimé, magasin de contrôle d’intégrité hello nettoie tous ses rapports.</span><span class="sxs-lookup"><span data-stu-id="fc75c-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="fc75c-250">Les enregistreurs de surveillance doivent penser à la durée de vie hello d’entité de hello et rapport de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="fc75c-251">Le moment où un rapport doit être effacé d’un magasin doit être clair (par exemple, lorsqu’une erreur signalée sur une entité ne s’applique plus).</span><span class="sxs-lookup"><span data-stu-id="fc75c-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="fc75c-252">Examinons un exemple qui réunit les points hello décrit.</span><span class="sxs-lookup"><span data-stu-id="fc75c-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="fc75c-253">Examinons une application Service Fabric composée d’un service maître persistant avec état et de services subordonnés sans état déployés sur tous les nœuds (un type de service secondaire par type de tâche).</span><span class="sxs-lookup"><span data-stu-id="fc75c-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="fc75c-254">maître de Hello dispose d’une file d’attente de traitement qui contient toobe commandes exécutée par les bases de données secondaires.</span><span class="sxs-lookup"><span data-stu-id="fc75c-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="fc75c-255">bases de données secondaires Hello exécutent des demandes entrantes de hello et envoyer des signaux d’accusé de réception différé.</span><span class="sxs-lookup"><span data-stu-id="fc75c-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="fc75c-256">Une condition qui peut être surveillée est la longueur de file d’attente de traitement principal hello hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="fc75c-257">Si la longueur de file d’attente principale hello atteint un seuil, un avertissement est émis.</span><span class="sxs-lookup"><span data-stu-id="fc75c-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="fc75c-258">Avertissement de Hello indique que bases de données secondaires hello ne peut pas traiter la charge de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="fc75c-259">Si la file d’attente hello atteint la longueur maximale de hello et commandes sont supprimées, une erreur est signalée, comme hello service ne peut pas récupérer.</span><span class="sxs-lookup"><span data-stu-id="fc75c-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="fc75c-260">les rapports Hello peuvent être sur la propriété de hello **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="fc75c-261">surveillance de Hello réside à l’intérieur de hello service, et il est régulièrement envoyée sur le réplica principal maître de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="fc75c-262">Hello toolive prend deux minutes, et il est envoyé régulièrement toutes les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="fc75c-263">Si hello principal tombe en panne, les rapports de hello est automatiquement nettoyée à partir du magasin.</span><span class="sxs-lookup"><span data-stu-id="fc75c-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="fc75c-264">Si le réplica de service hello est activée, mais elle est bloquée ou avoir d’autres problèmes, hello rapport arrive à expiration dans le magasin de contrôle d’intégrité hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="fc75c-265">Dans ce cas, les entités hello sont évaluée au niveau de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="fc75c-266">L’heure d’exécution de la tâche est une autre condition qui peut être surveillée.</span><span class="sxs-lookup"><span data-stu-id="fc75c-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="fc75c-267">Hello maître distribue les tâches de bases de données secondaires toohello selon le type de tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="fc75c-268">En fonction de la conception de hello, maître de hello peut interroger secondaires hello pour l’état de la tâche.</span><span class="sxs-lookup"><span data-stu-id="fc75c-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="fc75c-269">Il peut également attendre pour les bases de données secondaires toosend accusé de réception différé signaux lorsqu’elles sont effectuées.</span><span class="sxs-lookup"><span data-stu-id="fc75c-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="fc75c-270">Dans les cas de deuxième hello, être vigilant toodetect les situations où les messages ou matrice de bases de données secondaires sont conservés.</span><span class="sxs-lookup"><span data-stu-id="fc75c-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="fc75c-271">Une option est pour toosend maître de hello un toohello de demande ping secondaire, qui renvoie son état.</span><span class="sxs-lookup"><span data-stu-id="fc75c-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="fc75c-272">Si aucun état n’est reçu, maître de hello considère comme un échec et replanifie la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="fc75c-273">Ce comportement suppose que les tâches de hello sont idempotents.</span><span class="sxs-lookup"><span data-stu-id="fc75c-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="fc75c-274">condition de Hello analysé peut être traduite en tant qu’avertissement si la tâche hello n’est pas effectuée dans un certain temps (**t1**, par exemple 10 minutes).</span><span class="sxs-lookup"><span data-stu-id="fc75c-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="fc75c-275">Si la tâche hello n’est pas terminée dans le temps (**t2**, par exemple 20 minutes), la condition de hello analysé peut être traduite en tant qu’erreur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="fc75c-276">Cette création de rapport peut se faire de plusieurs façons :</span><span class="sxs-lookup"><span data-stu-id="fc75c-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="fc75c-277">réplica principal maître de Hello signale régulièrement sur lui-même.</span><span class="sxs-lookup"><span data-stu-id="fc75c-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="fc75c-278">Vous pouvez avoir une propriété pour toutes les tâches en attente dans la file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="fc75c-279">Si au moins une tâche prend plus de temps, l’état d’hello sur la propriété de hello **PendingTasks** est un avertissement ou une erreur, comme il convient.</span><span class="sxs-lookup"><span data-stu-id="fc75c-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="fc75c-280">Si aucune tâche en attente ou toutes les tâches a démarré l’exécution, l’état hello est OK.</span><span class="sxs-lookup"><span data-stu-id="fc75c-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="fc75c-281">tâches de Hello sont persistantes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-281">hello tasks are persistent.</span></span> <span data-ttu-id="fc75c-282">Si hello principal tombe en panne, principal de hello nouvellement promu peut continuer tooreport correctement.</span><span class="sxs-lookup"><span data-stu-id="fc75c-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="fc75c-283">Un autre processus de surveillance (dans le cloud de hello ou externe) vérifie les tâches hello (à partir d’à l’extérieur, en fonction de résultat de la tâche hello souhaité) toosee si elles sont terminées.</span><span class="sxs-lookup"><span data-stu-id="fc75c-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="fc75c-284">Si elles ne respectent pas les seuils de hello, un rapport est envoyé sur le service principal de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="fc75c-285">Un rapport est également envoyé sur chaque tâche incluant comme identificateur de la tâche hello, **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="fc75c-286">Des rapports ne doivent être envoyés que sur des états défectueux.</span><span class="sxs-lookup"><span data-stu-id="fc75c-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="fc75c-287">Définissez tooa toolive de temps quelques minutes et marquez hello toobe de rapports supprimé à leur expiration tooensure nettoyage.</span><span class="sxs-lookup"><span data-stu-id="fc75c-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="fc75c-288">Hello secondaire qui exécute une tâche signale quand il dure plus longtemps que prévu toorun il.</span><span class="sxs-lookup"><span data-stu-id="fc75c-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="fc75c-289">Il signale sur l’instance du service hello sur la propriété de hello **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="fc75c-290">met en évidence les rapports Hello instance du service hello qui présente des problèmes, mais il ne capture pas situation hello où perte, instance de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="fc75c-291">rapports de Hello sont nettoyés puis.</span><span class="sxs-lookup"><span data-stu-id="fc75c-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="fc75c-292">Il a un rapport sur le service secondaire hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-292">It could report on hello secondary service.</span></span> <span data-ttu-id="fc75c-293">Si hello secondaire termine la tâche hello, les instances secondaires hello efface rapport hello à partir du magasin de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="fc75c-294">rapport de Hello ne capture pas hello situation dans laquelle message d’accusé de réception hello est perdu tâche hello n’est pas terminé à partir du point de vue de la forme hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="fc75c-295">Toutefois hello reporting est effectué dans les cas de hello décrites ci-dessus, hello rapports sont capturées dans le contrôle d’intégrité de l’application lors de l’évaluation d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="fc75c-296">Rapport régulier ou sur transition</span><span class="sxs-lookup"><span data-stu-id="fc75c-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="fc75c-297">À l’aide de contrôle d’intégrité hello modèle de rapport, les agents de surveillance peuvent envoyer des rapports régulièrement ou sur les transitions.</span><span class="sxs-lookup"><span data-stu-id="fc75c-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="fc75c-298">Hello recommandé pour la surveillance reporting consiste régulièrement, comme code de hello est bien tooerrors plus simple et moins sujet.</span><span class="sxs-lookup"><span data-stu-id="fc75c-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="fc75c-299">agents de surveillance Hello doivent s’efforcent toobe aussi simple que possible tooavoid bogues qui déclenchent des rapports incorrects.</span><span class="sxs-lookup"><span data-stu-id="fc75c-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="fc75c-300">Des rapport d’état *défectueux* incorrects ont une incidence sur les évaluations de l’intégrité et les scénarios basés sur l’intégrité, dont les mises à niveau.</span><span class="sxs-lookup"><span data-stu-id="fc75c-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="fc75c-301">Incorrect *intègre* rapports masquer les problèmes dans un cluster de hello, qui n’est pas souhaité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="fc75c-302">Création de rapports périodiques, surveillance de hello peut être implémenté avec un minuteur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="fc75c-303">Sur un rappel du minuteur, surveillance de hello peut vérifier l’état de hello et envoyer un rapport basé sur l’état actuel de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="fc75c-304">Il n’existe aucun toosee besoin de rapport a été envoyé précédemment ou effectuer des optimisations en termes de messagerie.</span><span class="sxs-lookup"><span data-stu-id="fc75c-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="fc75c-305">client de contrôle d’intégrité Hello a toohelp logique dont les performances de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="fc75c-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="fc75c-306">Alors que le client de contrôle d’intégrité hello reste actif, il effectue une nouvelle tentative en interne jusqu'à ce que les rapports hello sont acceptée par le magasin de contrôle d’intégrité hello ou de surveillance de hello génère un rapport plus récent avec hello même entité, property et source.</span><span class="sxs-lookup"><span data-stu-id="fc75c-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="fc75c-307">La génération de rapports sur les transitions nécessite une gestion prudente de l’état.</span><span class="sxs-lookup"><span data-stu-id="fc75c-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="fc75c-308">surveillance de Hello surveille certaines conditions et signale uniquement lorsque les conditions hello changent.</span><span class="sxs-lookup"><span data-stu-id="fc75c-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="fc75c-309">Hello envers de cette approche est que les rapports moins sont nécessaires.</span><span class="sxs-lookup"><span data-stu-id="fc75c-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="fc75c-310">Hello inconvénient que la logique de surveillance de hello hello est complexe.</span><span class="sxs-lookup"><span data-stu-id="fc75c-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="fc75c-311">surveillance de Hello doit mettre à jour les conditions de hello ou les rapports de hello, afin qu’ils puissent être inspecté toodetermine changements d’état.</span><span class="sxs-lookup"><span data-stu-id="fc75c-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="fc75c-312">Lors du basculement, être vigilant avec les rapports ajouté, mais pas encore envoyés magasin de contrôle d’intégrité toohello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="fc75c-313">numéro de séquence Hello doit être croissante.</span><span class="sxs-lookup"><span data-stu-id="fc75c-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="fc75c-314">Dans le cas contraire, les rapports hello sont rejetées comme obsolètes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="fc75c-315">Dans hello rares cas où une perte de données est générée, la synchronisation peut être nécessaire entre état hello du rapporteur de hello et état hello du magasin de contrôle d’intégrité hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="fc75c-316">La création de rapports sur les transitions est fondée pour les services de création de rapports sur eux-mêmes, via `Partition` ou `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="fc75c-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="fc75c-317">Lorsque hello objet local (réplica ou un package de service déployé / déployé l’application) est supprimé, tous ses rapports sont également supprimés.</span><span class="sxs-lookup"><span data-stu-id="fc75c-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="fc75c-318">Le nettoyage automatique assouplit la nécessité de hello pour la synchronisation entre reporter et magasin de contrôle d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="fc75c-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="fc75c-319">Si le rapport de hello est pour la partition parente ou application parente, être vigilant sur le basculement tooavoid les rapports obsolètes dans le magasin de contrôle d’intégrité hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="fc75c-320">Logique doit être ajoutée correcte de toomaintain hello et rapport de hello clair à partir du magasin si nécessaire, ne pas plus.</span><span class="sxs-lookup"><span data-stu-id="fc75c-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="fc75c-321">Mise en œuvre de la création de rapports d’intégrité</span><span class="sxs-lookup"><span data-stu-id="fc75c-321">Implement health reporting</span></span>
<span data-ttu-id="fc75c-322">Une fois que hello détails de l’entité et les rapports sont évidentes, rapports d’intégrité peut être envoyé par le biais des API de hello, PowerShell ou REST.</span><span class="sxs-lookup"><span data-stu-id="fc75c-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="fc75c-323">API</span><span class="sxs-lookup"><span data-stu-id="fc75c-323">API</span></span>
<span data-ttu-id="fc75c-324">tooreport via hello API, vous devez toocreate un type d’entité d’intégrité rapport toohello spécifiques qu’ils souhaitent tooreport sur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="fc75c-325">Donnez un client de contrôle d’intégrité tooa hello rapports.</span><span class="sxs-lookup"><span data-stu-id="fc75c-325">Give hello report tooa health client.</span></span> <span data-ttu-id="fc75c-326">Vous pouvez également créer une contrôle d’intégrité des informations et lui passer toocorrect méthodes de création de rapports sur `Partition` ou `CodePackageActivationContext` tooreport sur les entités en cours.</span><span class="sxs-lookup"><span data-stu-id="fc75c-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="fc75c-327">Hello suivant montre périodique de création de rapports à partir d’une surveillance au sein du cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="fc75c-328">surveillance de Hello vérifie si une ressource externe sont accessibles à partir d’un nœud.</span><span class="sxs-lookup"><span data-stu-id="fc75c-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="fc75c-329">ressource de Hello est requis par un manifeste de service au sein de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="fc75c-330">Si les ressources hello ne sont pas disponible, hello autres services au sein de l’application hello continuent de fonctionner correctement.</span><span class="sxs-lookup"><span data-stu-id="fc75c-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="fc75c-331">Par conséquent, les rapports hello sont envoyé sur l’entité de package de service hello déployé toutes les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="fc75c-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="fc75c-332">PowerShell</span></span>
<span data-ttu-id="fc75c-333">Envoyez les rapports d’intégrité avec **Send-ServiceFabric*EntityType*HealthReport**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="fc75c-334">Hello suivant montre périodique de création de rapports sur les valeurs de l’UC sur un nœud.</span><span class="sxs-lookup"><span data-stu-id="fc75c-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="fc75c-335">les rapports Hello doivent être envoyés à toutes les 30 secondes, et ils ont une heure toolive de deux minutes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="fc75c-336">S’ils expirent, rapporteur de hello présente des problèmes, nœud de hello est évaluée au niveau de l’erreur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="fc75c-337">Une fois hello UC au-dessus d’un seuil, les rapports hello a un état d’intégrité de l’avertissement.</span><span class="sxs-lookup"><span data-stu-id="fc75c-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="fc75c-338">Lorsque hello du processeur reste supérieure à un seuil plus de temps de hello configuré, il est signalé comme une erreur.</span><span class="sxs-lookup"><span data-stu-id="fc75c-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="fc75c-339">Dans le cas contraire, les reporter hello envoie un état d’intégrité de OK.</span><span class="sxs-lookup"><span data-stu-id="fc75c-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="fc75c-340">Hello exemple suivant signale un avertissement temporaire sur un réplica.</span><span class="sxs-lookup"><span data-stu-id="fc75c-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="fc75c-341">Il obtient d’abord les ID de partition hello et puis hello ID de réplica pour le service hello qu'intéresse.</span><span class="sxs-lookup"><span data-stu-id="fc75c-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="fc75c-342">Il envoie ensuite un rapport à partir de **PowershellWatcher** sur la propriété de hello **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="fc75c-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="fc75c-343">rapport de Hello présente un intérêt pour que les deux minutes, et il est automatiquement supprimé à partir du magasin de hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="fc75c-344">REST</span><span class="sxs-lookup"><span data-stu-id="fc75c-344">REST</span></span>
<span data-ttu-id="fc75c-345">Envoyer des rapports d’intégrité à l’aide de REST avec les demandes POST visitez toohello souhaité entité et dans la description du rapport d’intégrité hello corps hello.</span><span class="sxs-lookup"><span data-stu-id="fc75c-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="fc75c-346">Par exemple, consultez Comment toosend REST [rapports d’intégrité de cluster](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) ou [rapports d’intégrité du service](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="fc75c-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="fc75c-347">Toutes les entités sont prises en charge.</span><span class="sxs-lookup"><span data-stu-id="fc75c-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fc75c-348">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="fc75c-348">Next steps</span></span>
<span data-ttu-id="fc75c-349">Selon les données de contrôle d’intégrité hello, aux développeurs de service et les administrateurs d’application/cluster peuvent considérer façons tooconsume hello d’informations.</span><span class="sxs-lookup"><span data-stu-id="fc75c-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="fc75c-350">Par exemple, ils peuvent définir des alertes basées sur les problèmes graves toocatch d’état de contrôle d’intégrité avant de provoquer des pannes.</span><span class="sxs-lookup"><span data-stu-id="fc75c-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="fc75c-351">Les administrateurs peuvent également définir des problèmes de réparation systèmes toofix automatiquement.</span><span class="sxs-lookup"><span data-stu-id="fc75c-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="fc75c-352">Introduction tooService d’intégrité de l’infrastructure analyse</span><span class="sxs-lookup"><span data-stu-id="fc75c-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="fc75c-353">Affichage rapports d’intégrité de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="fc75c-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="fc75c-354">Comment tooreport et vérification du service d’intégrité</span><span class="sxs-lookup"><span data-stu-id="fc75c-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="fc75c-355">Utilisation des rapports d’intégrité système pour la résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="fc75c-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="fc75c-356">Surveiller et diagnostiquer les services localement</span><span class="sxs-lookup"><span data-stu-id="fc75c-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="fc75c-357">Mise à niveau des applications Service Fabric</span><span class="sxs-lookup"><span data-stu-id="fc75c-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)

