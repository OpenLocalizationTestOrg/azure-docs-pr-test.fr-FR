---
title: "Mise à niveau d’une application : sérialisation des données | Microsoft Docs"
description: "Meilleures pratiques pour la sérialisation de données et son impact sur le déploiement des mises à niveau d'applications."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: a5f36366-a2ab-4ae3-bb08-bc2f9533bc5a
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 6aa3ac7842df4657fca7f6b4264e1c6fe52dc0c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="how-data-serialization-affects-an-application-upgrade"></a><span data-ttu-id="431a4-103">Impact de la sérialisation des données sur la mise à niveau d’une application</span><span class="sxs-lookup"><span data-stu-id="431a4-103">How data serialization affects an application upgrade</span></span>
<span data-ttu-id="431a4-104">Dans un [mise à niveau d'application propagée](service-fabric-application-upgrade.md), la mise à niveau est appliquée à un sous-ensemble de nœuds, à raison d'un domaine de mise à niveau à la fois.</span><span class="sxs-lookup"><span data-stu-id="431a4-104">In a [rolling application upgrade](service-fabric-application-upgrade.md), the upgrade is applied to a subset of nodes, one upgrade domain at a time.</span></span> <span data-ttu-id="431a4-105">Pendant ce processus, certains domaines de mise à niveau se trouvent sur la version la plus récente de votre application, tandis que d’autres se trouvent sur la version antérieure.</span><span class="sxs-lookup"><span data-stu-id="431a4-105">During this process, some upgrade domains are on the newer version of your application, and some upgrade domains are on the older version of your application.</span></span> <span data-ttu-id="431a4-106">Pendant le déploiement, la nouvelle version de votre application doit être en mesure de lire l’ancienne version de vos données, tandis que l’ancienne version de votre application doit être à même de lire la nouvelle version de vos données.</span><span class="sxs-lookup"><span data-stu-id="431a4-106">During the rollout, the new version of your application must be able to read the old version of your data, and the old version of your application must be able to read the new version of your data.</span></span> <span data-ttu-id="431a4-107">Si le format de données n’offre pas une compatibilité ascendante et descendante, la mise à niveau peut échouer ou, pire, des données peuvent être perdues ou endommagées.</span><span class="sxs-lookup"><span data-stu-id="431a4-107">If the data format is not forward and backward compatible, the upgrade may fail, or worse, data may be lost or corrupted.</span></span> <span data-ttu-id="431a4-108">Cet article explique ce qui constitue le format de données et détaille les méthodes recommandées pour que les données offrent une compatibilité ascendante et descendante.</span><span class="sxs-lookup"><span data-stu-id="431a4-108">This article discusses what constitutes your data format and offers best practices for ensuring that your data is forward and backward compatible.</span></span>

## <a name="what-makes-up-your-data-format"></a><span data-ttu-id="431a4-109">Qu'est-ce qui constitue le format de données ?</span><span class="sxs-lookup"><span data-stu-id="431a4-109">What makes up your data format?</span></span>
<span data-ttu-id="431a4-110">Dans Azure Service Fabric, les données qui sont rendues persistantes et répliquées proviennent de vos classes C#.</span><span class="sxs-lookup"><span data-stu-id="431a4-110">In Azure Service Fabric, the data that is persisted and replicated comes from your C# classes.</span></span> <span data-ttu-id="431a4-111">Dans le cas des applications utilisant des [collections fiables](service-fabric-reliable-services-reliable-collections.md), ces données sont les objets qui se trouvent dans les files d’attente et les dictionnaires fiables.</span><span class="sxs-lookup"><span data-stu-id="431a4-111">For applications that use [Reliable Collections](service-fabric-reliable-services-reliable-collections.md), that data is the objects in the reliable dictionaries and queues.</span></span> <span data-ttu-id="431a4-112">Dans le cas des applications utilisant [Reliable Actors](service-fabric-reliable-actors-introduction.md), il s’agit de l’état de sauvegarde de l’acteur.</span><span class="sxs-lookup"><span data-stu-id="431a4-112">For applications that use [Reliable Actors](service-fabric-reliable-actors-introduction.md), that is the backing state for the actor.</span></span> <span data-ttu-id="431a4-113">Ces classes C# doivent être sérialisables pour être persistantes et répliquées.</span><span class="sxs-lookup"><span data-stu-id="431a4-113">These C# classes must be serializable to be persisted and replicated.</span></span> <span data-ttu-id="431a4-114">Le format de données est donc défini par les champs et propriétés sérialisés, ainsi que par la manière dont ils sont sérialisés.</span><span class="sxs-lookup"><span data-stu-id="431a4-114">Therefore, the data format is defined by the fields and properties that are serialized, as well as how they are serialized.</span></span> <span data-ttu-id="431a4-115">Par exemple, dans un `IReliableDictionary<int, MyClass>`, les données sont un `int` sérialisé et un `MyClass` sérialisé.</span><span class="sxs-lookup"><span data-stu-id="431a4-115">For example, in an `IReliableDictionary<int, MyClass>` the data is a serialized `int` and a serialized `MyClass`.</span></span>

### <a name="code-changes-that-result-in-a-data-format-change"></a><span data-ttu-id="431a4-116">Modifications du code résultant dans une modification du format de données</span><span class="sxs-lookup"><span data-stu-id="431a4-116">Code changes that result in a data format change</span></span>
<span data-ttu-id="431a4-117">Le format de données étant déterminé par les classes C#, les modifications apportées aux classes peuvent entraîner une modification du format de données.</span><span class="sxs-lookup"><span data-stu-id="431a4-117">Since the data format is determined by C# classes, changes to the classes may cause a data format change.</span></span> <span data-ttu-id="431a4-118">Veillez à ce que la mise à niveau propagée puisse gérer la modification du format de données.</span><span class="sxs-lookup"><span data-stu-id="431a4-118">Care must be taken to ensure that a rolling upgrade can handle the data format change.</span></span> <span data-ttu-id="431a4-119">Exemples d'opérations pouvant entraîner une modification du format de données :</span><span class="sxs-lookup"><span data-stu-id="431a4-119">Examples that may cause data format changes:</span></span>

* <span data-ttu-id="431a4-120">Ajout ou suppression de champs ou de propriétés</span><span class="sxs-lookup"><span data-stu-id="431a4-120">Adding or removing fields or properties</span></span>
* <span data-ttu-id="431a4-121">Modification du nom d'un champ ou d'une propriété</span><span class="sxs-lookup"><span data-stu-id="431a4-121">Renaming fields or properties</span></span>
* <span data-ttu-id="431a4-122">Modification des types de champs ou de propriétés</span><span class="sxs-lookup"><span data-stu-id="431a4-122">Changing the types of fields or properties</span></span>
* <span data-ttu-id="431a4-123">Modification du nom de la classe ou de l'espace de noms</span><span class="sxs-lookup"><span data-stu-id="431a4-123">Changing the class name or namespace</span></span>

### <a name="data-contract-as-the-default-serializer"></a><span data-ttu-id="431a4-124">Le contrat de données est le sérialiseur par défaut.</span><span class="sxs-lookup"><span data-stu-id="431a4-124">Data Contract as the default serializer</span></span>
<span data-ttu-id="431a4-125">Le sérialiseur est généralement chargé de lire les données et de les désérialiser dans la version actuelle, même si les données sont dans une version antérieure ou *plus récente* .</span><span class="sxs-lookup"><span data-stu-id="431a4-125">The serializer is generally responsible for reading the data and deserializing it into the current version, even if the data is in an older or *newer* version.</span></span> <span data-ttu-id="431a4-126">Le sérialiseur par défaut est le [sérialiseur de contrat de données](https://msdn.microsoft.com/library/ms733127.aspx), qui possède des règles de gestion de version bien définies.</span><span class="sxs-lookup"><span data-stu-id="431a4-126">The default serializer is the [Data Contract serializer](https://msdn.microsoft.com/library/ms733127.aspx), which has well-defined versioning rules.</span></span> <span data-ttu-id="431a4-127">Les collections fiables permettent la substitution du sérialiseur, contrairement à Reliable Actors.</span><span class="sxs-lookup"><span data-stu-id="431a4-127">Reliable Collections allow the serializer to be overridden, but Reliable Actors currently do not.</span></span> <span data-ttu-id="431a4-128">Le sérialiseur de données joue un rôle important dans l'activation des mises à niveau propagées.</span><span class="sxs-lookup"><span data-stu-id="431a4-128">The data serializer plays an important role in enabling rolling upgrades.</span></span> <span data-ttu-id="431a4-129">Le sérialiseur de contrat de données est le sérialiseur recommandé pour les applications Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="431a4-129">The Data Contract serializer is the serializer that we recommend for Service Fabric applications.</span></span>

## <a name="how-the-data-format-affects-a-rolling-upgrade"></a><span data-ttu-id="431a4-130">Impact du format de données sur la mise à niveau propagée</span><span class="sxs-lookup"><span data-stu-id="431a4-130">How the data format affects a rolling upgrade</span></span>
<span data-ttu-id="431a4-131">Pendant une mise à niveau propagée, il existe deux scénarios principaux où le sérialiseur peut rencontrer une version antérieure ou *plus récente* de vos données :</span><span class="sxs-lookup"><span data-stu-id="431a4-131">During a rolling upgrade, there are two main scenarios where the serializer may encounter an older or *newer* version of your data:</span></span>

1. <span data-ttu-id="431a4-132">Une fois qu'un nœud est mis à niveau et démarre la sauvegarde, le nouveau sérialiseur charge les données qui ont été rendues persistantes sur le disque par l'ancienne version.</span><span class="sxs-lookup"><span data-stu-id="431a4-132">After a node is upgraded and starts back up, the new serializer will load the data that was persisted to disk by the old version.</span></span>
2. <span data-ttu-id="431a4-133">Au cours de la mise à niveau propagée, le cluster contiendra une combinaison des versions ancienne et nouvelle de votre code.</span><span class="sxs-lookup"><span data-stu-id="431a4-133">During the rolling upgrade, the cluster will contain a mix of the old and new versions of your code.</span></span> <span data-ttu-id="431a4-134">Dans la mesure où les réplicas peuvent être placés dans différents domaines de mise à niveau, et que les réplicas s’envoient mutuellement des données, les versions anciennes et/ou nouvelles de vos données peuvent être rencontrées par la nouvelle et/ou ancienne version de votre sérialiseur.</span><span class="sxs-lookup"><span data-stu-id="431a4-134">Since replicas may be placed in different upgrade domains, and replicas send data to each other, the new and/or old version of your data may be encountered by the new and/or old version of your serializer.</span></span>

> [!NOTE]
> <span data-ttu-id="431a4-135">« nouvelle version » et « ancienne version » font ici référence à la version de votre code en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="431a4-135">The "new version" and "old version" here refer to the version of your code that is running.</span></span> <span data-ttu-id="431a4-136">Le terme « nouveau sérialiseur » fait référence au code de sérialiseur s’exécutant dans la nouvelle version de votre application.</span><span class="sxs-lookup"><span data-stu-id="431a4-136">The "new serializer" refers to the serializer code that is executing in the new version of your application.</span></span> <span data-ttu-id="431a4-137">« nouvelles données » fait référence à la classe C# sérialisée issue de la nouvelle version de votre application.</span><span class="sxs-lookup"><span data-stu-id="431a4-137">The "new data" refers to the serialized C# class from the new version of your application.</span></span>
> 
> 

<span data-ttu-id="431a4-138">Les deux versions de format de données et de code doivent être mutuellement compatibles.</span><span class="sxs-lookup"><span data-stu-id="431a4-138">The two versions of code and data format must be both forward and backward compatible.</span></span> <span data-ttu-id="431a4-139">Si elles ne le sont pas, la mise à niveau propagée risque d'échouer ou des données peuvent être perdues.</span><span class="sxs-lookup"><span data-stu-id="431a4-139">If they are not compatible, the rolling upgrade may fail or data may be lost.</span></span> <span data-ttu-id="431a4-140">La mise à niveau propagée risque d’échouer, car le code ou le sérialiseur peut lever des exceptions ou une erreur quand il rencontre l’autre version.</span><span class="sxs-lookup"><span data-stu-id="431a4-140">The rolling upgrade may fail because the code or serializer may throw exceptions or a fault when it encounters the other version.</span></span> <span data-ttu-id="431a4-141">Des données peuvent être perdues si, par exemple, une nouvelle propriété a été ajoutée, mais que l'ancien sérialiseur l'ignore pendant la désérialisation.</span><span class="sxs-lookup"><span data-stu-id="431a4-141">Data may be lost if, for example, a new property was added but the old serializer discards it during deserialization.</span></span>

<span data-ttu-id="431a4-142">Le contrat de données est la solution recommandée pour s’assurer de la compatibilité des données.</span><span class="sxs-lookup"><span data-stu-id="431a4-142">Data Contract is the recommended solution for ensuring that your data is compatible.</span></span> <span data-ttu-id="431a4-143">Il possède des règles de gestion de version bien définies pour l'ajout, la suppression et la modification de champs.</span><span class="sxs-lookup"><span data-stu-id="431a4-143">It has well-defined versioning rules for adding, removing, and changing fields.</span></span> <span data-ttu-id="431a4-144">En outre, il prend en charge les champs inconnus, avec raccordement au processus de sérialisation et de désérialisation, ainsi que l’héritage de classe.</span><span class="sxs-lookup"><span data-stu-id="431a4-144">It also has support for dealing with unknown fields, hooking into the serialization and deserialization process, and dealing with class inheritance.</span></span> <span data-ttu-id="431a4-145">Pour plus d'informations, consultez la page [Utilisation du contrat de données](https://msdn.microsoft.com/library/ms733127.aspx).</span><span class="sxs-lookup"><span data-stu-id="431a4-145">For more information, see [Using Data Contract](https://msdn.microsoft.com/library/ms733127.aspx).</span></span>

## <a name="next-steps"></a><span data-ttu-id="431a4-146">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="431a4-146">Next steps</span></span>
<span data-ttu-id="431a4-147">[mise à niveau de votre application à l’aide de Visual Studio](service-fabric-application-upgrade-tutorial.md) vous guide à travers une mise à niveau de l’application à l’aide de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="431a4-147">[Upgrading your Application Using Visual Studio](service-fabric-application-upgrade-tutorial.md) walks you through an application upgrade using Visual Studio.</span></span>

<span data-ttu-id="431a4-148">[mise à niveau de votre application à l’aide de PowerShell](service-fabric-application-upgrade-tutorial-powershell.md) vous guide à travers une mise à niveau de l’application à l’aide de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="431a4-148">[Upgrading your Application Using Powershell](service-fabric-application-upgrade-tutorial-powershell.md) walks you through an application upgrade using PowerShell.</span></span>

<span data-ttu-id="431a4-149">Contrôlez les mises à niveau de votre application à l'aide des [Paramètres de mise à niveau](service-fabric-application-upgrade-parameters.md).</span><span class="sxs-lookup"><span data-stu-id="431a4-149">Control how your application upgrades by using [Upgrade Parameters](service-fabric-application-upgrade-parameters.md).</span></span>

<span data-ttu-id="431a4-150">Apprenez à utiliser les fonctionnalités avancées lors de la mise à niveau de votre application en consultant les [Rubriques avancées](service-fabric-application-upgrade-advanced.md).</span><span class="sxs-lookup"><span data-stu-id="431a4-150">Learn how to use advanced functionality while upgrading your application by referring to [Advanced Topics](service-fabric-application-upgrade-advanced.md).</span></span>

<span data-ttu-id="431a4-151">Résolvez les problèmes courants de mise à niveau de l'application en vous reportant aux étapes de [Résolution des problèmes de mise à niveau des applications ](service-fabric-application-upgrade-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="431a4-151">Fix common problems in application upgrades by referring to the steps in [Troubleshooting Application Upgrades ](service-fabric-application-upgrade-troubleshooting.md).</span></span>

