---
title: "Préparation du déploiement d’un cluster Azure Service Fabric autonome | Microsoft Docs"
description: "Documentation relative à la préparation de l’environnement et la création de la configuration du cluster, à prendre en considération avant de déployer un cluster conçu pour gérer une charge de travail de production."
services: service-fabric
documentationcenter: .net
author: maburlik
manager: timlt
editor: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 1/17/2017
ms.author: maburlik;chackdan
ms.openlocfilehash: f332193f9a53260173a1010b8bf9f08726bea427
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
<a id="preparemachines"></a>

## <a name="plan-and-prepare-your-service-fabric-standalone-cluster-deployment"></a><span data-ttu-id="7743e-103">Planifier et préparer votre déploiement de cluster Service Fabric autonome</span><span class="sxs-lookup"><span data-stu-id="7743e-103">Plan and prepare your Service Fabric standalone cluster deployment</span></span>
<span data-ttu-id="7743e-104">Exécutez les étapes suivantes avant de créer votre cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-104">Perform the following steps before you create your cluster.</span></span>

### <a name="step-1-plan-your-cluster-infrastructure"></a><span data-ttu-id="7743e-105">Étape 1 : planifier votre infrastructure de cluster</span><span class="sxs-lookup"><span data-stu-id="7743e-105">Step 1: Plan your cluster infrastructure</span></span>
<span data-ttu-id="7743e-106">Vous allez créer un cluster Service Fabric sur les ordinateurs que vous avez pour décider des types de défaillance auxquels le cluster doit survivre.</span><span class="sxs-lookup"><span data-stu-id="7743e-106">You are about to create a Service Fabric cluster on machines you own, so you can decide what kinds of failures you want the cluster to survive.</span></span> <span data-ttu-id="7743e-107">Par exemple, devez-vous séparer les lignes d’alimentation des connexions internet reliées à ces ordinateurs ?</span><span class="sxs-lookup"><span data-stu-id="7743e-107">For example, do you need separate power lines or Internet connections supplied to these machines?</span></span> <span data-ttu-id="7743e-108">Prenez en outre en compte la sécurité physique de ces ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="7743e-108">In addition, consider the physical security of these machines.</span></span> <span data-ttu-id="7743e-109">Où sont situés les ordinateurs et qui a besoin d’y accéder ?</span><span class="sxs-lookup"><span data-stu-id="7743e-109">Where are the machines located and who needs access to them?</span></span> <span data-ttu-id="7743e-110">Une fois ces décisions prises, vous pouvez mapper logiquement les ordinateurs sur les différents domaines d’erreur (voir l’étape 4).</span><span class="sxs-lookup"><span data-stu-id="7743e-110">After you make these decisions, you can logically map the machines to the various fault domains (see Step 4).</span></span> <span data-ttu-id="7743e-111">La planification de l’infrastructure pour les clusters de production est plus complexe que pour les clusters de test.</span><span class="sxs-lookup"><span data-stu-id="7743e-111">The infrastructure planning for production clusters is more involved than for test clusters.</span></span>

### <a name="step-2-prepare-the-machines-to-meet-the-prerequisites"></a><span data-ttu-id="7743e-112">Étape 2 : préparer les ordinateurs pour répondre aux conditions préalables</span><span class="sxs-lookup"><span data-stu-id="7743e-112">Step 2: Prepare the machines to meet the prerequisites</span></span>
<span data-ttu-id="7743e-113">Conditions préalables pour chaque ordinateur que vous souhaitez ajouter au cluster :</span><span class="sxs-lookup"><span data-stu-id="7743e-113">Prerequisites for each machine that you want to add to the cluster:</span></span>

* <span data-ttu-id="7743e-114">Un minimum de 16 Go de RAM est recommandé.</span><span class="sxs-lookup"><span data-stu-id="7743e-114">A minimum of 16 GB of RAM is recommended.</span></span>
* <span data-ttu-id="7743e-115">Un minimum de 40 Go d’espace disque disponible est recommandé.</span><span class="sxs-lookup"><span data-stu-id="7743e-115">A minimum of 40 of GB available disk space is recommended.</span></span>
* <span data-ttu-id="7743e-116">Un processeur 4 cœurs ou plus est recommandé.</span><span class="sxs-lookup"><span data-stu-id="7743e-116">A 4 core or greater CPU is recommended.</span></span>
* <span data-ttu-id="7743e-117">Connectivité à un ou plusieurs réseaux sécurisés pour tous les ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="7743e-117">Connectivity to a secure network or networks for all machines.</span></span>
* <span data-ttu-id="7743e-118">Windows Server 2012 R2 ou Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="7743e-118">Windows Server 2012 R2 or Windows Server 2016.</span></span> 
* <span data-ttu-id="7743e-119">[.NET Framework 4.5.1 ou une version ultérieure](https://www.microsoft.com/download/details.aspx?id=40773), installation complète.</span><span class="sxs-lookup"><span data-stu-id="7743e-119">[.NET Framework 4.5.1 or higher](https://www.microsoft.com/download/details.aspx?id=40773), full install.</span></span>
* <span data-ttu-id="7743e-120">[Windows PowerShell 3.0](https://msdn.microsoft.com/powershell/scripting/setup/installing-windows-powershell).</span><span class="sxs-lookup"><span data-stu-id="7743e-120">[Windows PowerShell 3.0](https://msdn.microsoft.com/powershell/scripting/setup/installing-windows-powershell).</span></span>
* <span data-ttu-id="7743e-121">Le [service RemoteRegistry](https://technet.microsoft.com/library/cc754820) doit être exécuté sur tous les ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="7743e-121">The [RemoteRegistry service](https://technet.microsoft.com/library/cc754820) should be running on all the machines.</span></span>

<span data-ttu-id="7743e-122">L’administrateur de cluster déployant et configurant le cluster doit disposer de [privilèges d’administrateur](https://social.technet.microsoft.com/wiki/contents/articles/13436.windows-server-2012-how-to-add-an-account-to-a-local-administrator-group.aspx) sur chaque ordinateur.</span><span class="sxs-lookup"><span data-stu-id="7743e-122">The cluster administrator deploying and configuring the cluster must have [administrator privileges](https://social.technet.microsoft.com/wiki/contents/articles/13436.windows-server-2012-how-to-add-an-account-to-a-local-administrator-group.aspx) on each of the machines.</span></span> <span data-ttu-id="7743e-123">Vous ne pouvez pas installer Service Fabric sur un contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="7743e-123">You cannot install Service Fabric on a domain controller.</span></span>

### <a name="step-3-determine-the-initial-cluster-size"></a><span data-ttu-id="7743e-124">Étape 3 : déterminer la taille initiale du cluster</span><span class="sxs-lookup"><span data-stu-id="7743e-124">Step 3: Determine the initial cluster size</span></span>
<span data-ttu-id="7743e-125">Le runtime Service Fabric est déployé sur chaque nœud d’un cluster Service Fabric autonome, et les nœuds sont membres du cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-125">Each node in a standalone Service Fabric cluster has the Service Fabric runtime deployed and is a member of the cluster.</span></span> <span data-ttu-id="7743e-126">Un déploiement de production type comprend un nœud par instance du système d’exploitation (physique ou virtuel).</span><span class="sxs-lookup"><span data-stu-id="7743e-126">In a typical production deployment, there is one node per OS instance (physical or virtual).</span></span> <span data-ttu-id="7743e-127">La taille de cluster est déterminée par les besoins de votre entreprise.</span><span class="sxs-lookup"><span data-stu-id="7743e-127">The cluster size is determined by your business needs.</span></span> <span data-ttu-id="7743e-128">Toutefois, vous devez disposer d’une taille minimale de cluster de trois nœuds (ordinateurs ou machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="7743e-128">However, you must have a minimum cluster size of three nodes (machines or virtual machines).</span></span>
<span data-ttu-id="7743e-129">À des fins de développement, vous pouvez avoir plusieurs nœuds sur un ordinateur donné.</span><span class="sxs-lookup"><span data-stu-id="7743e-129">For development purposes, you can have more than one node on a given machine.</span></span> <span data-ttu-id="7743e-130">Dans un environnement de production, Service Fabric ne prend en charge qu’un seul nœud par ordinateur physique ou virtuel.</span><span class="sxs-lookup"><span data-stu-id="7743e-130">In a production environment, Service Fabric supports only one node per physical or virtual machine.</span></span>

### <a name="step-4-determine-the-number-of-fault-domains-and-upgrade-domains"></a><span data-ttu-id="7743e-131">Étape 4 : déterminer le nombre de domaines d’erreur et de domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="7743e-131">Step 4: Determine the number of fault domains and upgrade domains</span></span>
<span data-ttu-id="7743e-132">Un *domaine d’erreur (FD)* est une unité physique de défaillance directement liée à l’infrastructure physique dans les centres de données.</span><span class="sxs-lookup"><span data-stu-id="7743e-132">A *fault domain* (FD) is a physical unit of failure and is directly related to the physical infrastructure in the data centers.</span></span> <span data-ttu-id="7743e-133">Un domaine d’erreur est constitué de composants matériels (ordinateurs, commutateurs, réseaux, etc.) qui partagent un point de défaillance unique.</span><span class="sxs-lookup"><span data-stu-id="7743e-133">A fault domain consists of hardware components (computers, switches, networks, and more) that share a single point of failure.</span></span> <span data-ttu-id="7743e-134">Bien qu’il n’existe aucun mappage 1:1 entre les domaines d’erreur et les racks, chaque rack peut être considéré au sens large comme un domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="7743e-134">Although there is no 1:1 mapping between fault domains and racks, loosely speaking, each rack can be considered a fault domain.</span></span> <span data-ttu-id="7743e-135">Lorsque vous envisagez d’utiliser les nœuds de votre cluster, nous vous recommandons fortement de distribuer les nœuds sur au moins trois domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="7743e-135">When considering the nodes in your cluster, we strongly recommend that the nodes be distributed among at least three fault domains.</span></span>

<span data-ttu-id="7743e-136">Quand vous spécifiez des domaines d’erreur dans ClusterConfig.json, vous pouvez choisir le nom de chaque domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="7743e-136">When you specify FDs in ClusterConfig.json, you can choose the name for each FD.</span></span> <span data-ttu-id="7743e-137">Service Fabric prend en charge les domaines d’erreur hiérarchiques pour vous permettre d’y refléter votre topologie d’infrastructure.</span><span class="sxs-lookup"><span data-stu-id="7743e-137">Service Fabric supports hierarchical FDs, so you can reflect your infrastructure topology in them.</span></span>  <span data-ttu-id="7743e-138">Par exemple, les domaines d’erreur suivants sont valides :</span><span class="sxs-lookup"><span data-stu-id="7743e-138">For example, the following FDs are valid:</span></span>

* <span data-ttu-id="7743e-139">"faultDomain": "fd:/Room1/Rack1/Machine1"</span><span class="sxs-lookup"><span data-stu-id="7743e-139">"faultDomain": "fd:/Room1/Rack1/Machine1"</span></span>
* <span data-ttu-id="7743e-140">"faultDomain": "fd:/FD1"</span><span class="sxs-lookup"><span data-stu-id="7743e-140">"faultDomain": "fd:/FD1"</span></span>
* <span data-ttu-id="7743e-141">"faultDomain": "fd:/Room1/Rack1/PDU1/M1"</span><span class="sxs-lookup"><span data-stu-id="7743e-141">"faultDomain": "fd:/Room1/Rack1/PDU1/M1"</span></span>

<span data-ttu-id="7743e-142">Un *domaine de mise à niveau (UD)* est une unité logique de nœuds.</span><span class="sxs-lookup"><span data-stu-id="7743e-142">An *upgrade domain* (UD) is a logical unit of nodes.</span></span> <span data-ttu-id="7743e-143">Pendant les mises à niveau orchestrées par Service Fabric (mise à niveau de l’application ou du cluster), tous les nœuds dans un domaine de mise à niveau sont mis hors service pour effectuer la mise à niveau alors que les nœuds dans d’autres domaines de mise à niveau restent disponibles pour répondre aux requêtes.</span><span class="sxs-lookup"><span data-stu-id="7743e-143">During Service Fabric orchestrated upgrades (either an application upgrade or a cluster upgrade), all nodes in a UD are taken down to perform the upgrade while nodes in other UDs remain available to serve requests.</span></span> <span data-ttu-id="7743e-144">Les mises à niveau du microprogramme que vous effectuez sur vos ordinateurs ne respectent pas les domaines de mise à niveau. Vous devez donc les exécuter sur un ordinateur à la fois.</span><span class="sxs-lookup"><span data-stu-id="7743e-144">The firmware upgrades you perform on your machines do not honor UDs, so you must do them one machine at a time.</span></span>

<span data-ttu-id="7743e-145">L’approche la plus simple de ces concepts consiste à considérer les domaines d’erreur comme unité de défaillance non planifiée et les domaines mise à niveau comme unité de maintenance planifiée.</span><span class="sxs-lookup"><span data-stu-id="7743e-145">The simplest way to think about these concepts is to consider FDs as the unit of unplanned failure and UDs as the unit of planned maintenance.</span></span>

<span data-ttu-id="7743e-146">Quand vous spécifiez des domaines de mise à niveau dans ClusterConfig.json, vous pouvez choisir le nom de chaque domaine de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="7743e-146">When you specify UDs in ClusterConfig.json, you can choose the name for each UD.</span></span> <span data-ttu-id="7743e-147">Par exemple, les noms suivants sont valides :</span><span class="sxs-lookup"><span data-stu-id="7743e-147">For example, the following names are valid:</span></span>

* <span data-ttu-id="7743e-148">"upgradeDomain": "UD0"</span><span class="sxs-lookup"><span data-stu-id="7743e-148">"upgradeDomain": "UD0"</span></span>
* <span data-ttu-id="7743e-149">"upgradeDomain": "UD1A"</span><span class="sxs-lookup"><span data-stu-id="7743e-149">"upgradeDomain": "UD1A"</span></span>
* <span data-ttu-id="7743e-150">"upgradeDomain": "DomainRed"</span><span class="sxs-lookup"><span data-stu-id="7743e-150">"upgradeDomain": "DomainRed"</span></span>
* <span data-ttu-id="7743e-151">"upgradeDomain": "Blue"</span><span class="sxs-lookup"><span data-stu-id="7743e-151">"upgradeDomain": "Blue"</span></span>

<span data-ttu-id="7743e-152">Pour plus d’informations sur les domaines de mise à niveau et les domaines d’erreur, consultez [Description d’un cluster Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md) .</span><span class="sxs-lookup"><span data-stu-id="7743e-152">For more detailed information on upgrade domains and fault domains, see [Describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md).</span></span>

### <a name="step-5-download-the-service-fabric-standalone-package-for-windows-server"></a><span data-ttu-id="7743e-153">Étape 5 : télécharger le package autonome Service Fabric pour Windows Server</span><span class="sxs-lookup"><span data-stu-id="7743e-153">Step 5: Download the Service Fabric standalone package for Windows Server</span></span>
<span data-ttu-id="7743e-154">[Lien de téléchargement - Package autonome Service Fabric - Windows Server](http://go.microsoft.com/fwlink/?LinkId=730690) et décompressez le package sur un ordinateur de déploiement qui ne fait pas partie du cluster ou sur l’un des ordinateurs qui fera partie de votre cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-154">[Download Link - Service Fabric Standalone Package - Windows Server](http://go.microsoft.com/fwlink/?LinkId=730690) and unzip the package, either to a deployment machine that is not part of the cluster, or to one of the machines that will be a part of your cluster.</span></span>

### <a name="step-6-modify-cluster-configuration"></a><span data-ttu-id="7743e-155">Étape 6 : Modifier la configuration du cluster</span><span class="sxs-lookup"><span data-stu-id="7743e-155">Step 6: Modify cluster configuration</span></span>
<span data-ttu-id="7743e-156">Pour créer un cluster autonome, vous devez créer un fichier ClusterConfig.json de configuration de cluster autonome qui décrit les spécifications du cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-156">To create a standalone cluster you have to create a standalone cluster configuration ClusterConfig.json file, which describes the specification of the cluster.</span></span> <span data-ttu-id="7743e-157">Vous pouvez baser le fichier de configuration sur les modèles accessibles avec le lien ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="7743e-157">You can base the configuration file on the templates found at the below link.</span></span> <br><span data-ttu-id="7743e-158">
[Configurations de cluster autonome](https://github.com/Azure-Samples/service-fabric-dotnet-standalone-cluster-configuration/tree/master/Samples)</span><span class="sxs-lookup"><span data-stu-id="7743e-158">
[Standalone Cluster Configurations](https://github.com/Azure-Samples/service-fabric-dotnet-standalone-cluster-configuration/tree/master/Samples)</span></span>

<span data-ttu-id="7743e-159">Pour plus d’informations sur les sections de ce fichier, consultez [Paramètres de configuration pour un cluster Windows autonome](service-fabric-cluster-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="7743e-159">For details on the sections in this file, see [Configuration settings for standalone Windows cluster](service-fabric-cluster-manifest.md).</span></span>

<span data-ttu-id="7743e-160">Ouvrez l’un des fichiers ClusterConfig.json à partir du package que vous avez téléchargé et modifiez les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="7743e-160">Open one of the ClusterConfig.json files from the package you downloaded and modify the following settings:</span></span>
| <span data-ttu-id="7743e-161">**Paramètres de configuration**</span><span class="sxs-lookup"><span data-stu-id="7743e-161">**Configuration Setting**</span></span> | <span data-ttu-id="7743e-162">**Description**</span><span class="sxs-lookup"><span data-stu-id="7743e-162">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="7743e-163">**NodeTypes**</span><span class="sxs-lookup"><span data-stu-id="7743e-163">**NodeTypes**</span></span> |<span data-ttu-id="7743e-164">Les types de nœuds permettent de séparer vos nœuds de cluster en différents groupes.</span><span class="sxs-lookup"><span data-stu-id="7743e-164">Node types allow you to separate your cluster nodes into various groups.</span></span> <span data-ttu-id="7743e-165">Un cluster doit comprendre au moins un NodeType.</span><span class="sxs-lookup"><span data-stu-id="7743e-165">A cluster must have at least one NodeType.</span></span> <span data-ttu-id="7743e-166">Tous les nœuds d’un groupe ont les caractéristiques communes suivantes : </span><span class="sxs-lookup"><span data-stu-id="7743e-166">All nodes in a group have the following common characteristics:</span></span> <br> <span data-ttu-id="7743e-167">**Name** : il s’agit du nom de type de nœud.</span><span class="sxs-lookup"><span data-stu-id="7743e-167">**Name** - This is the node type name.</span></span> <br><span data-ttu-id="7743e-168">**Endpoints Ports** : il s’agit de différents points de terminaison (ports) nommés qui sont associés à ce type de nœud.</span><span class="sxs-lookup"><span data-stu-id="7743e-168">**Endpoint Ports** - These are various named end points (ports) that are associated with this node type.</span></span> <span data-ttu-id="7743e-169">Vous pouvez utiliser n’importe quel numéro de port, tant qu’il n’entre pas en conflit avec un autre élément de ce manifeste et qu’il n’est pas déjà utilisé par une autre application en cours d’exécution sur l’ordinateur/la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="7743e-169">You can use any port number that you wish, as long as they do not conflict with anything else in this manifest and are not already in use by any other application running on the machine/VM.</span></span> <br> <span data-ttu-id="7743e-170">**Placement Properties** : il s’agit des propriétés pour ce type de nœud que vous avez utilisées comme contraintes de positionnement pour les services système ou pour vos services.</span><span class="sxs-lookup"><span data-stu-id="7743e-170">**Placement Properties** - These describe properties for this node type that you use as placement constraints for the system services or your services.</span></span> <span data-ttu-id="7743e-171">Ces propriétés sont des paires clé/valeur définies par l’utilisateur qui fournissent des métadonnées supplémentaires pour un nœud donné.</span><span class="sxs-lookup"><span data-stu-id="7743e-171">These properties are user-defined key/value pairs that provide extra meta data for a given node.</span></span> <span data-ttu-id="7743e-172">La présence d’un disque dur ou d’une carte graphique sur le nœud, le nombre de rotations du disque dur, les noyaux et d’autres propriétés physiques sont des exemples de propriétés du nœud.</span><span class="sxs-lookup"><span data-stu-id="7743e-172">Examples of node properties would be whether the node has a hard drive or graphics card, the number of spindles in its hard drive, cores, and other physical properties.</span></span> <br> <span data-ttu-id="7743e-173">**Capacities** : les capacités du nœud définissent le nom et la quantité d’une ressource spécifique disponible sur un nœud particulier pour consommation.</span><span class="sxs-lookup"><span data-stu-id="7743e-173">**Capacities** - Node capacities define the name and amount of a particular resource that a particular node has available for consumption.</span></span> <span data-ttu-id="7743e-174">Par exemple, un nœud peut définir qu’il possède la capacité pour une mesure appelée « MemoryInMb » et qu’il dispose de 2 048 Mo de mémoire disponible par défaut.</span><span class="sxs-lookup"><span data-stu-id="7743e-174">For example, a node may define that it has capacity for a metric called “MemoryInMb” and that it has 2048 MB available by default.</span></span> <span data-ttu-id="7743e-175">Ces capacités sont utilisées au moment de l’exécution pour garantir que les services qui nécessitent une quantité spécifique de ressources sont placés sur des nœuds où ces ressources sont disponibles dans la quantité requise.</span><span class="sxs-lookup"><span data-stu-id="7743e-175">These capacities are used at runtime to ensure that services that require particular amounts of resources are placed on the nodes that have those resources available in the required amounts.</span></span><br><span data-ttu-id="7743e-176">**IsPrimary** : si plusieurs NodeType sont définis, vérifiez qu’un seul est défini comme primaire avec la valeur *true*; c’est là que les services système s’exécutent.</span><span class="sxs-lookup"><span data-stu-id="7743e-176">**IsPrimary** - If you have more than one NodeType defined ensure that only one is set to primary with the value *true*, which is where the system services run.</span></span> <span data-ttu-id="7743e-177">Tous les autres types de nœuds doivent avoir la valeur *false*</span><span class="sxs-lookup"><span data-stu-id="7743e-177">All other node types should be set to the value *false*</span></span> |
| <span data-ttu-id="7743e-178">**Nœuds**</span><span class="sxs-lookup"><span data-stu-id="7743e-178">**Nodes**</span></span> |<span data-ttu-id="7743e-179">Il s’agit des détails de chacun des nœuds qui font partie du cluster (type de nœud, nom de nœud, adresse IP, domaine d’erreur et domaine de mise à niveau du nœud).</span><span class="sxs-lookup"><span data-stu-id="7743e-179">These are the details for each of the nodes that are part of the cluster (node type, node name, IP address, fault domain, and upgrade domain of the node).</span></span> <span data-ttu-id="7743e-180">Les ordinateurs sur lesquels vous souhaitez créer le cluster doivent être répertoriés ici avec leur adresse IP.</span><span class="sxs-lookup"><span data-stu-id="7743e-180">The machines you want the cluster to be created on need to be listed here with their IP addresses.</span></span> <br> <span data-ttu-id="7743e-181">Si vous utilisez la même adresse IP pour tous les nœuds, un cluster à boîtier unique est créé. Vous pouvez l’utiliser à des fins de test.</span><span class="sxs-lookup"><span data-stu-id="7743e-181">If you use the same IP address for all the nodes, then a one-box cluster is created, which you can use for testing purposes.</span></span> <span data-ttu-id="7743e-182">N’utilisez pas les clusters à boîtier unique pour le déploiement de charges de travail de production.</span><span class="sxs-lookup"><span data-stu-id="7743e-182">Do not use One-box clusters for deploying production workloads.</span></span> |

<span data-ttu-id="7743e-183">Une fois tous les paramètres de la configuration du cluster configurés dans l’environnement, vous pouvez tester la configuration dans l’environnement du cluster (étape 7).</span><span class="sxs-lookup"><span data-stu-id="7743e-183">After the cluster configuration has had all settings configured to the environment, it can be tested against the cluster environment (step 7).</span></span>

<a id="environmentsetup"></a>

### <a name="step-7-environment-setup"></a><span data-ttu-id="7743e-184">Étape 7.</span><span class="sxs-lookup"><span data-stu-id="7743e-184">Step 7.</span></span> <span data-ttu-id="7743e-185">Configuration de l’environnement</span><span class="sxs-lookup"><span data-stu-id="7743e-185">Environment setup</span></span>

<span data-ttu-id="7743e-186">Lorsqu’un administrateur de cluster configure un cluster autonome Service Fabric, l’environnement doit être configuré avec les critères suivants :</span><span class="sxs-lookup"><span data-stu-id="7743e-186">When a cluster administrator configures a Service Fabric standalone cluster, the environment is needs to be set up with the following criteria:</span></span> <br>
1. <span data-ttu-id="7743e-187">L’utilisateur qui crée le cluster doit disposer de privilèges de sécurité de niveau administrateur sur tous les ordinateurs qui sont répertoriés en tant que nœuds dans le fichier de configuration du cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-187">The user creating the cluster should have administrator-level security privileges to all machines that are listed as nodes in the cluster configuration file.</span></span>
2. <span data-ttu-id="7743e-188">L’ordinateur à partir duquel le cluster est créé, ainsi que chaque ordinateur nœud du cluster doit respecter les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="7743e-188">Machine from which the cluster is created, as well as each cluster node machine must:</span></span>
* <span data-ttu-id="7743e-189">le Kit de développement logiciel (SDK) Service Fabric doit être désinstallé ;</span><span class="sxs-lookup"><span data-stu-id="7743e-189">Have Service Fabric SDK uninstalled</span></span>
* <span data-ttu-id="7743e-190">le runtime Service Fabric doit être désinstallé ;</span><span class="sxs-lookup"><span data-stu-id="7743e-190">Have Service Fabric runtime uninstalled</span></span> 
* <span data-ttu-id="7743e-191">le service pare-feu Windows (mpssvc) doit être activé ;</span><span class="sxs-lookup"><span data-stu-id="7743e-191">Have the Windows Firewall service (mpssvc) enabled</span></span>
* <span data-ttu-id="7743e-192">le service Registre distant (remoteregistry) doit être activé ;</span><span class="sxs-lookup"><span data-stu-id="7743e-192">Have the Remote Registry Service (remoteregistry) enabled</span></span>
* <span data-ttu-id="7743e-193">le partage de fichiers (SMB) doit être activé ;</span><span class="sxs-lookup"><span data-stu-id="7743e-193">Have file sharing (SMB) enabled</span></span>
* <span data-ttu-id="7743e-194">les ports requis doivent être ouverts, selon les ports de configuration du cluster ;</span><span class="sxs-lookup"><span data-stu-id="7743e-194">Have necessary ports opened, based on cluster configuration ports</span></span>
* <span data-ttu-id="7743e-195">les ports requis doivent êtres ouverts pour le service Registre distant et SMB Windows : 135, 137, 138, 139 et 445 ;</span><span class="sxs-lookup"><span data-stu-id="7743e-195">Have necessary ports opened for Windows SMB and Remote Registry service: 135, 137, 138, 139, and 445</span></span>
* <span data-ttu-id="7743e-196">la connectivité réseau entre les ordinateurs doit être activée.</span><span class="sxs-lookup"><span data-stu-id="7743e-196">Have network connectivity to one another</span></span>
3. <span data-ttu-id="7743e-197">Aucun des ordinateurs nœuds de cluster ne doit être un contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="7743e-197">None of the cluster node machines should be a Domain Controller.</span></span>
4. <span data-ttu-id="7743e-198">Si le cluster à déployer est un cluster sécurisé, vérifiez que les conditions préalables de sécurité requises sont en place et correctement configurées en fonction de la configuration.</span><span class="sxs-lookup"><span data-stu-id="7743e-198">If the cluster to be deployed is a secure cluster, validate the necessary security prerequisites are in place, and are configured correctly against the configuration.</span></span>
5. <span data-ttu-id="7743e-199">Si les ordinateurs du cluster ne sont pas accessibles via Internet, définissez les éléments suivants dans la configuration du cluster :</span><span class="sxs-lookup"><span data-stu-id="7743e-199">If the cluster machines are not internet-accessible, set the following in the cluster configuration:</span></span>
* <span data-ttu-id="7743e-200">Désactiver la télémétrie : sous *Propriétés*, définissez *« enableTelemetry » : false*</span><span class="sxs-lookup"><span data-stu-id="7743e-200">Disable telemetry:   Under *properties* set   *"enableTelemetry": false*</span></span>
* <span data-ttu-id="7743e-201">Désactiver le téléchargement de version Fabric automatique et les notifications indiquant que la prise en charge de la version actuelle touche à sa fin : sous *Propriétés*, définissez *« fabricClusterAutoupgradeEnabled » : false*</span><span class="sxs-lookup"><span data-stu-id="7743e-201">Disable automatic Fabric version downloading & notifications that the current cluster version is nearing end of support:   Under *properties* set   *"fabricClusterAutoupgradeEnabled": false*</span></span>
* <span data-ttu-id="7743e-202">Si l’accès réseau à Internet est limité à des domaines sur liste verte, les domaines ci-dessous sont nécessaires pour la mise à niveau automatique : go.microsoft.com   download.microsoft.com</span><span class="sxs-lookup"><span data-stu-id="7743e-202">Alternatively if network internet access is limited to white-listed domains, the domains below are required for automatic upgrade:   go.microsoft.com   download.microsoft.com</span></span>

6. <span data-ttu-id="7743e-203">Définissez les exclusions antivirus Service Fabric appropriées :</span><span class="sxs-lookup"><span data-stu-id="7743e-203">Set appropriate Service Fabric antivirus exclusions:</span></span>

| <span data-ttu-id="7743e-204">**Répertoires exclus de l’antivirus**</span><span class="sxs-lookup"><span data-stu-id="7743e-204">**Antivirus Excluded directories**</span></span> |
| --- |
| <span data-ttu-id="7743e-205">Program Files\Microsoft Service Fabric</span><span class="sxs-lookup"><span data-stu-id="7743e-205">Program Files\Microsoft Service Fabric</span></span> |
| <span data-ttu-id="7743e-206">FabricDataRoot (dans la configuration du cluster)</span><span class="sxs-lookup"><span data-stu-id="7743e-206">FabricDataRoot (from cluster configuration)</span></span> |
| <span data-ttu-id="7743e-207">FabricLogRoot (dans la configuration du cluster)</span><span class="sxs-lookup"><span data-stu-id="7743e-207">FabricLogRoot (from cluster configuration)</span></span> |

| <span data-ttu-id="7743e-208">**Processus exclus de l’antivirus**</span><span class="sxs-lookup"><span data-stu-id="7743e-208">**Antivirus Excluded processes**</span></span> |
| --- |
| <span data-ttu-id="7743e-209">Fabric.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-209">Fabric.exe</span></span> |
| <span data-ttu-id="7743e-210">FabricHost.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-210">FabricHost.exe</span></span> |
| <span data-ttu-id="7743e-211">FabricInstallerService.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-211">FabricInstallerService.exe</span></span> |
| <span data-ttu-id="7743e-212">FabricSetup.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-212">FabricSetup.exe</span></span> |
| <span data-ttu-id="7743e-213">FabricDeployer.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-213">FabricDeployer.exe</span></span> |
| <span data-ttu-id="7743e-214">ImageBuilder.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-214">ImageBuilder.exe</span></span> |
| <span data-ttu-id="7743e-215">FabricGateway.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-215">FabricGateway.exe</span></span> |
| <span data-ttu-id="7743e-216">FabricDCA.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-216">FabricDCA.exe</span></span> |
| <span data-ttu-id="7743e-217">FabricFAS.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-217">FabricFAS.exe</span></span> |
| <span data-ttu-id="7743e-218">FabricUOS.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-218">FabricUOS.exe</span></span> |
| <span data-ttu-id="7743e-219">FabricRM.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-219">FabricRM.exe</span></span> |
| <span data-ttu-id="7743e-220">FileStoreService.exe</span><span class="sxs-lookup"><span data-stu-id="7743e-220">FileStoreService.exe</span></span> |

### <a name="step-8-validate-environment-using-testconfiguration-script"></a><span data-ttu-id="7743e-221">Étape 8 :</span><span class="sxs-lookup"><span data-stu-id="7743e-221">Step 8.</span></span> <span data-ttu-id="7743e-222">Valider l’environnement à l’aide du script TestConfiguration</span><span class="sxs-lookup"><span data-stu-id="7743e-222">Validate environment using TestConfiguration script</span></span>
<span data-ttu-id="7743e-223">Vous trouverez le script TestConfiguration.ps1 dans le package autonome.</span><span class="sxs-lookup"><span data-stu-id="7743e-223">The TestConfiguration.ps1 script can be found in the standalone package.</span></span> <span data-ttu-id="7743e-224">Il est utilisé comme un outil d’analyse des meilleures pratiques pour valider certains des critères ci-dessus et doit être utilisé comme contrôle de la validité pour vérifier si un cluster peut être déployé dans un environnement donné.</span><span class="sxs-lookup"><span data-stu-id="7743e-224">It is used as a Best Practices Analyzer to validate some of the criteria above and should be used as a sanity check to validate whether a cluster can be deployed on a given environment.</span></span> <span data-ttu-id="7743e-225">En cas de défaillance, consultez la liste sous [Configuration de l’environnement](service-fabric-cluster-standalone-deployment-preparation.md) pour la résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="7743e-225">If there is any failure, refer to the list under [Environment Setup](service-fabric-cluster-standalone-deployment-preparation.md) for troubleshooting.</span></span> 

<span data-ttu-id="7743e-226">Ce script peut être exécuté sur n’importe quel ordinateur disposant d’un accès administrateur à tous les ordinateurs qui sont répertoriés en tant que nœuds dans le fichier de configuration du cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-226">This script can be run on any machine that has administrator access to all the machines that are listed as nodes in the cluster configuration file.</span></span> <span data-ttu-id="7743e-227">L’ordinateur sur lequel ce script est exécuté ne doit pas nécessairement faire partie du cluster.</span><span class="sxs-lookup"><span data-stu-id="7743e-227">The machine that this script is run on does not have to be part of the cluster.</span></span>

```powershell
PS C:\temp\Microsoft.Azure.ServiceFabric.WindowsServer> .\TestConfiguration.ps1 -ClusterConfigFilePath .\ClusterConfig.Unsecure.DevCluster.json
Trace folder already exists. Traces will be written to existing trace folder: C:\temp\Microsoft.Azure.ServiceFabric.WindowsServer\DeploymentTraces
Running Best Practices Analyzer...
Best Practices Analyzer completed successfully.


LocalAdminPrivilege        : True
IsJsonValid                : True
IsCabValid                 : True
RequiredPortsOpen          : True
RemoteRegistryAvailable    : True
FirewallAvailable          : True
RpcCheckPassed             : True
NoConflictingInstallations : True
FabricInstallable          : True
Passed                     : True
```

<span data-ttu-id="7743e-228">Actuellement, ce module de test de configuration ne valide pas la configuration de sécurité. Cette opération doit donc être effectuée de manière indépendante.</span><span class="sxs-lookup"><span data-stu-id="7743e-228">Currently this configuration testing module does not validate the security configuration so this has to be done independently.</span></span>  

> [!NOTE]
> <span data-ttu-id="7743e-229">Nous améliorons en permanence ce module afin de le rendre plus fiable. Par conséquent, s’il existe un cas défectueux ou manquant qui, selon vous, n’est pas actuellement détecté par TestConfiguration, faites-le nous savoir via nos [canaux de prise en charge](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support).</span><span class="sxs-lookup"><span data-stu-id="7743e-229">We are continually making improvements to make this module more robust, so if there is a faulty or missing case which you believe isn't currently caught by TestConfiguration, please let us know through our [support channels](https://docs.microsoft.com/en-us/azure/service-fabric/service-fabric-support).</span></span>   
> 
> 

## <a name="next-steps"></a><span data-ttu-id="7743e-230">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="7743e-230">Next steps</span></span>
* [<span data-ttu-id="7743e-231">Créer un cluster autonome s’exécutant sur Windows Server</span><span class="sxs-lookup"><span data-stu-id="7743e-231">Create a standalone cluster running on Windows Server</span></span>](service-fabric-cluster-creation-for-windows-server.md)
