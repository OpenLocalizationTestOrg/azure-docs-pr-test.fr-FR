---
title: "Analyse d’événements Azure Service Fabric avec Azure Application Insights | Microsoft Docs"
description: "Découvrez l’analyse et la visualisation d’événements à l’aide d’Application Insights pour la surveillance et le diagnostic de clusters Azure Service Fabric."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: 
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 05/26/2017
ms.author: dekapur
ms.openlocfilehash: 4085a607b800f4f4f155cdc266bc203b0858fd7c
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="event-analysis-and-visualization-with-application-insights"></a><span data-ttu-id="af399-103">Analyse et visualisation d’événements avec Application Insights</span><span class="sxs-lookup"><span data-stu-id="af399-103">Event analysis and visualization with Application Insights</span></span>

<span data-ttu-id="af399-104">Azure Application Insights est une plateforme extensible pour la surveillance et le diagnostic d’application.</span><span class="sxs-lookup"><span data-stu-id="af399-104">Azure Application Insights is an extensible platform for application monitoring and diagnostics.</span></span> <span data-ttu-id="af399-105">Elle inclut un puissant outil d’analyse et de requête, un tableau de bord et des visualisations personnalisables, ainsi que d’autres options incluant l’alerte automatisée.</span><span class="sxs-lookup"><span data-stu-id="af399-105">It includes a powerful analytics and querying tool, customizable dashboard and visualizations, and further options including automated alerting.</span></span> <span data-ttu-id="af399-106">Il s’agit de la plateforme recommandée pour la surveillance et le diagnostic des services et applications Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="af399-106">It is the recommended platform for monitoring and diagnostics for Service Fabric applications and services.</span></span>

## <a name="setting-up-application-insights"></a><span data-ttu-id="af399-107">Configuration d'Application Insights</span><span class="sxs-lookup"><span data-stu-id="af399-107">Setting up Application Insights</span></span>

### <a name="creating-an-ai-resource"></a><span data-ttu-id="af399-108">Création d’une ressource AI (Application Insights)</span><span class="sxs-lookup"><span data-stu-id="af399-108">Creating an AI Resource</span></span>

<span data-ttu-id="af399-109">Pour créer une ressource AI, rendez-vous sur la Place de marché Azure, puis recherchez « Application Insights ».</span><span class="sxs-lookup"><span data-stu-id="af399-109">To create an AI resource, head over to the Azure Marketplace, and search for "Application Insights".</span></span> <span data-ttu-id="af399-110">Elle doit s’afficher comme première solution (elle se trouve sous la catégorie « Web + mobile »).</span><span class="sxs-lookup"><span data-stu-id="af399-110">It should show up as the first solution (it is under category "Web + Mobile").</span></span> <span data-ttu-id="af399-111">Cliquez sur **Créer** quand vous consultez la ressource appropriée (vérifiez que le chemin correspond celui indiqué dans l’image ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="af399-111">Click **Create** when you are looking at the right resource (confirm that your path matches the image below).</span></span>

![Nouvelle ressource Application Insights](media/service-fabric-diagnostics-event-analysis-appinsights/create-new-ai-resource.png)

<span data-ttu-id="af399-113">Vous devez remplir certaines informations pour approvisionner correctement la ressource.</span><span class="sxs-lookup"><span data-stu-id="af399-113">You will need to fill out some information to provision the resource correctly.</span></span> <span data-ttu-id="af399-114">Dans le champ *Type d’application*, utilisez « Application web ASP.NET » si vous comptez utiliser l’un des modèles de programmation Service Fabric ou publier une application .NET dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="af399-114">In the *Application Type* field, use "ASP.NET web application" if you will be using any of Service Fabric's programming models or publishing a .NET application to the cluster.</span></span> <span data-ttu-id="af399-115">Utilisez « Général » si vous souhaitez déployer des conteneurs et ses exécutables invités.</span><span class="sxs-lookup"><span data-stu-id="af399-115">Use "General" if you will be deploying guest executables and containers.</span></span> <span data-ttu-id="af399-116">En général, utilisez par défaut « Application web ASP.NET » pour maintenir vos options ouvertes par la suite.</span><span class="sxs-lookup"><span data-stu-id="af399-116">In general, default to using "ASP.NET web application" to keep your options open in the future.</span></span> <span data-ttu-id="af399-117">Vous pouvez définir le nom de votre choix. De plus, le groupe de ressources et l’abonnement peuvent être modifiés après le déploiement de la ressource.</span><span class="sxs-lookup"><span data-stu-id="af399-117">The name is up to your preference, and both the resource group and subscription are changeable post-deployment of the resource.</span></span> <span data-ttu-id="af399-118">Il est recommandé que votre ressources AI se trouve dans le même groupe de ressources que votre cluster.</span><span class="sxs-lookup"><span data-stu-id="af399-118">We recommend that your AI resource is in the same resource group as your cluster.</span></span> <span data-ttu-id="af399-119">Si vous voulez obtenir des informations supplémentaires, consultez [Création d’une ressource Application Insights dans Azure](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="af399-119">If you need more information, please see [Create an Application Insights resource](../application-insights/app-insights-create-new-resource.md)</span></span>

<span data-ttu-id="af399-120">Vous avez besoin de la clé d’instrumentation AI pour configurer AI avec votre outil d’agrégation d’événements.</span><span class="sxs-lookup"><span data-stu-id="af399-120">You need the AI Instrumentation Key to configure AI with your event aggregation tool.</span></span> <span data-ttu-id="af399-121">Une fois votre ressource AI configurée (ce qui prend quelques minutes après la validation du déploiement), accédez-y et recherchez la section **Propriétés** dans la barre de navigation de gauche.</span><span class="sxs-lookup"><span data-stu-id="af399-121">Once your AI resource is set up (takes a few minutes after the deployment is validated), navigate to it and find the **Properties** section on the left navigation bar.</span></span> <span data-ttu-id="af399-122">Un nouveau panneau s’ouvre, affichant une *CLÉ D’INSTRUMENTATION*.</span><span class="sxs-lookup"><span data-stu-id="af399-122">A new blade will open up that shows an *INSTRUMENTATION KEY*.</span></span> <span data-ttu-id="af399-123">Si vous devez modifier l’abonnement ou le groupe de la ressource, cela peut également être effectué ici.</span><span class="sxs-lookup"><span data-stu-id="af399-123">If you need to change the subscription or resource group of the resource, it can be done here as well.</span></span>

### <a name="configuring-ai-with-wad"></a><span data-ttu-id="af399-124">Configuration de AI avec WAD</span><span class="sxs-lookup"><span data-stu-id="af399-124">Configuring AI with WAD</span></span>

<span data-ttu-id="af399-125">Il existe deux méthodes principales permettant d’envoyer des données à Azure AI à partir de WAD, ce qui nécessite d’ajouter un récepteur AI à la configuration de WAD, comme détaillé dans [cet article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="af399-125">There are two primary ways to send data from WAD to Azure AI, which is achieved by adding an AI sink to the WAD configuration, as detailed in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

#### <a name="add-an-ai-instrumentation-key-when-creating-a-cluster-in-azure-portal"></a><span data-ttu-id="af399-126">Ajouter une clé d’instrumentation AI lors de la création d’un cluster dans le portail Azure</span><span class="sxs-lookup"><span data-stu-id="af399-126">Add an AI Instrumentation Key when creating a cluster in Azure portal</span></span>

![Ajout d’une clé AIKey](media/service-fabric-diagnostics-event-analysis-appinsights/azure-enable-diagnostics.png)

<span data-ttu-id="af399-128">Lors de la création d’un cluster, si le diagnostic est « Activé » », un champ facultatif permettant d’entrer une clé d’instrumentation Application Insights s’affiche.</span><span class="sxs-lookup"><span data-stu-id="af399-128">When creating a cluster, if Diagnostics is turned "On", an optional field to enter an Application Insights Instrumentation key will show.</span></span> <span data-ttu-id="af399-129">Si vous collez votre clé iKey AI ici, le récepteur AI est automatiquement configuré dans le modèle Resource Manager utilisé pour déployer votre cluster.</span><span class="sxs-lookup"><span data-stu-id="af399-129">If you paste your AI IKey here, the AI sink will be automatically configured for you in the Resource Manager template that is used to deploy your cluster.</span></span>

#### <a name="add-the-ai-sink-to-the-resource-manager-template"></a><span data-ttu-id="af399-130">Ajouter le récepteur AI au modèle Resource Manager</span><span class="sxs-lookup"><span data-stu-id="af399-130">Add the AI Sink to the Resource Manager template</span></span>

<span data-ttu-id="af399-131">Dans l’élément « WadCfg » du modèle Resource Manager, ajoutez un récepteur (« Sink ») en incluant les deux modifications suivantes :</span><span class="sxs-lookup"><span data-stu-id="af399-131">In the "WadCfg" of the Resource Manager template, add a "Sink" by including the following two changes:</span></span>

1. <span data-ttu-id="af399-132">Ajoutez la configuration du récepteur :</span><span class="sxs-lookup"><span data-stu-id="af399-132">Add the sink configuration:</span></span>

    ```json
    "SinksConfig": {
        "Sink": [
            {
                "name": "applicationInsights",
                "ApplicationInsights": "***ADD INSTRUMENTATION KEY HERE***"
            }
        ]
    }

    ```

2. <span data-ttu-id="af399-133">Incluez le récepteur (Sink) dans l’élément DiagnosticMonitorConfiguration en ajoutant la ligne suivante dans l’élément « DiagnosticMonitorConfiguration » de « WadCfg » :</span><span class="sxs-lookup"><span data-stu-id="af399-133">Include the Sink in the DiagnosticMonitorConfiguration by adding the following line in "DiagnosticMonitorConfiguration" of the "WadCfg":</span></span>

    ```json
    "sinks": "applicationInsights"
    ```

<span data-ttu-id="af399-134">Dans les deux extraits de code ci-dessus, le nom « applicationInsights » a été utilisé pour décrire le récepteur.</span><span class="sxs-lookup"><span data-stu-id="af399-134">In both the code snippets above, the name "applicationInsights" was used to describe the sink.</span></span> <span data-ttu-id="af399-135">Cela n’est pas obligatoire, et tant que le nom du récepteur est inclus dans l’élément « sinks », vous pouvez définir n’importe quelle chaîne comme nom.</span><span class="sxs-lookup"><span data-stu-id="af399-135">This is not a requirement and as long as the name of the sink is included in "sinks", you can set the name to any string.</span></span>

<span data-ttu-id="af399-136">Actuellement, les journaux du cluster s’affichent sous forme de traces dans la visionneuse du journal d’AI.</span><span class="sxs-lookup"><span data-stu-id="af399-136">Currently, logs from the cluster will show up as traces in AI's log viewer.</span></span> <span data-ttu-id="af399-137">Étant donné que les traces provenant du niveau plateforme sont de type « Informations », vous pouvez également envisager de modifier la configuration du récepteur pour envoyer uniquement des journaux de type « Critique » ou « Erreur ».</span><span class="sxs-lookup"><span data-stu-id="af399-137">Since most of the traces coming from the platform are of level "Informational", you can also consider changing the sink configuration to only send logs of type "Critical" or "Error".</span></span> <span data-ttu-id="af399-138">Pour ce faire, ajoutez « Channels » à votre récepteur, comme illustré dans [cet article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span><span class="sxs-lookup"><span data-stu-id="af399-138">This can be done by adding "Channels" to your sink, as demonstrated in [this article](../monitoring-and-diagnostics/azure-diagnostics-configure-application-insights.md).</span></span>

>[!NOTE]
><span data-ttu-id="af399-139">Si vous utilisez une clé iKey AI incorrecte dans le portail ou dans votre modèle Resource Manager, vous devrez modifier manuellement la clé et mettre à jour/redéployer le cluster.</span><span class="sxs-lookup"><span data-stu-id="af399-139">If you use an incorrect AI IKey either in portal or in your Resource Manager template, you will have to manually change the key and update the cluster / redeploy it.</span></span> 

### <a name="configuring-ai-with-eventflow"></a><span data-ttu-id="af399-140">Configuration de AI avec EventFlow</span><span class="sxs-lookup"><span data-stu-id="af399-140">Configuring AI with EventFlow</span></span>

<span data-ttu-id="af399-141">Si vous utilisez EventFlow pour agréger des événements, veillez à importer le package NuGet `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`.</span><span class="sxs-lookup"><span data-stu-id="af399-141">If you are using EventFlow to aggregate events, make sure to import the `Microsoft.Diagnostics.EventFlow.Output.ApplicationInsights`NuGet package.</span></span> <span data-ttu-id="af399-142">Les éléments suivants doivent être inclus dans la section *outputs* du fichier *eventFlowConfig.json* :</span><span class="sxs-lookup"><span data-stu-id="af399-142">The following has to be included in the *outputs* section of the *eventFlowConfig.json*:</span></span>

```json
"outputs": [
    {
        "type": "ApplicationInsights",
        // (replace the following value with your AI resource's instrumentation key)
        "instrumentationKey": "00000000-0000-0000-0000-000000000000"
    }
]
```

<span data-ttu-id="af399-143">Veillez à apporter les modifications obligatoires dans vos filtres, ainsi qu’à inclure toutes les autres entrées (avec leurs packages NuGet respectifs).</span><span class="sxs-lookup"><span data-stu-id="af399-143">Make sure to make the required changes in your filters, as well as include any other inputs (along with their respective NuGet packages).</span></span>

## <a name="aisdk"></a><span data-ttu-id="af399-144">SDK AI (Application Insights)</span><span class="sxs-lookup"><span data-stu-id="af399-144">AI.SDK</span></span>

<span data-ttu-id="af399-145">Il est généralement recommandé d’utiliser EventFlow et WAD comme solutions d’agrégation, car ils permettent d’adopter une approche plus modulaire du diagnostic et de l’analyse. Par exemple si vous voulez modifier vos sorties d’EventFlow, aucune modification de votre instrumentation réelle n’est nécessaire, mais juste une simple modification de votre fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="af399-145">It is generally recommended to use EventFlow and WAD as aggregation solutions, because they allow for a more modular approach to diagnostics and monitoring, i.e. if you want to change your outputs from EventFlow, it requires no change to your actual instrumentation, just a simple modification to your config file.</span></span> <span data-ttu-id="af399-146">Toutefois, si vous décidez d’investir dans Application Insights et qu’il est peu probable que vous changiez de plateforme, vous devez envisager d’utiliser le nouveau SDK d’AI pour agréger les événements et les envoyer à AI.</span><span class="sxs-lookup"><span data-stu-id="af399-146">If, however, you decide to invest in using Application Insights and are not likely to change to a different platform, you should look into using AI's new SDK for aggregating events and sending them to AI.</span></span> <span data-ttu-id="af399-147">Cela signifie que vous n’aurez plus à configurer EventFlow pour envoyer vos données à AI, mais simplement à installer le package NuGet Service Fabric d’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="af399-147">This means that you will no longer have to configure EventFlow to send your data to AI, but instead will install the ApplicationInsight's Service Fabric NuGet package.</span></span> <span data-ttu-id="af399-148">Des informations supplémentaires sur le package sont disponibles [ici](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span><span class="sxs-lookup"><span data-stu-id="af399-148">Details on the package can be found [here](https://github.com/Microsoft/ApplicationInsights-ServiceFabric).</span></span>

<span data-ttu-id="af399-149">La rubrique [Prise en charge d’Application Insights pour les microservices et les conteneurs](https://azure.microsoft.com/app-insights-microservices/) vous présente quelques-unes des nouvelles fonctionnalités en cours de développement (encore actuellement en version bêta), qui vous permettent de bénéficier d’options de surveillance prêtes à l’emploi enrichies avec AI.</span><span class="sxs-lookup"><span data-stu-id="af399-149">[Application Insights support for Microservices and Containers](https://azure.microsoft.com/app-insights-microservices/) shows you some of the new features that are being worked on (currently still in beta), which allow you to have richer out-of-the-box monitoring options with AI.</span></span> <span data-ttu-id="af399-150">Ces fonctionnalités incluent le suivi de dépendance (utilisé dans la création d’une AppMap de l’ensemble de vos services et applications dans un cluster et la communication entre eux), ainsi qu’une meilleure corrélation des suivis provenant de vos services (ce qui facilite l’identification d’un problème dans le flux de travail d’une application ou d’un service).</span><span class="sxs-lookup"><span data-stu-id="af399-150">These include dependency tracking (used in building an AppMap of all your services and applications in a cluster and the communication between them), and better correlation of traces coming from your services (helps in better pinpointing an issue in the workflow of an app or service).</span></span>

<span data-ttu-id="af399-151">Si vous effectuez un développement dans .NET, que vous utiliserez probablement certains des modèles de programmation de Service Fabric et que vous souhaitez utiliser AI comme plateforme pour la visualisation et l’analyse des données d’événement et de journal, nous vous recommandons d’utiliser l’itinéraire du SDK AI comme flux de travail de surveillance et de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="af399-151">If you are developing in .NET and will likely be using some of Service Fabric's programming models, and are willing to use AI as your platform for visualizing and analyzing event and log data, then we recommend that you go via the AI SDK route as your monitoring and diagnostics workflow.</span></span> <span data-ttu-id="af399-152">Lisez [ceci](../application-insights/app-insights-asp-net-more.md) et [cela](../application-insights/app-insights-asp-net-trace-logs.md) pour commencer avec l’utilisation d’AI pour collecter et afficher vos journaux.</span><span class="sxs-lookup"><span data-stu-id="af399-152">Read [this](../application-insights/app-insights-asp-net-more.md) and [this](../application-insights/app-insights-asp-net-trace-logs.md) to get started with using AI to collect and display your logs.</span></span>

## <a name="navigating-the-ai-resource-in-azure-portal"></a><span data-ttu-id="af399-153">Navigation dans la ressource AI dans le portail Azure</span><span class="sxs-lookup"><span data-stu-id="af399-153">Navigating the AI resource in Azure portal</span></span>

<span data-ttu-id="af399-154">Une fois que vous avez configuré AI comme sortie pour vos événements et journaux, les informations doivent commencer à s’afficher dans votre ressource AI au bout de quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="af399-154">Once you have configured AI as an output for your events and logs, information should start to show up in your AI resource in a few minutes.</span></span> <span data-ttu-id="af399-155">Accédez à la ressource AI, ce qui vous fait accéder au tableau de bord correspondant.</span><span class="sxs-lookup"><span data-stu-id="af399-155">Navigate to the AI resource, which will take you to the AI resource dashboard.</span></span> <span data-ttu-id="af399-156">Cliquez sur **Rechercher** dans la barre des tâches AI pour voir les dernières traces reçues et pour pouvoir les filtrer.</span><span class="sxs-lookup"><span data-stu-id="af399-156">Click **Search** in the AI taskbar to see the latest traces that it has received, and to be able to filter through them.</span></span>

<span data-ttu-id="af399-157">*Metrics Explorer* est un outil utile pour la création de tableaux de bord personnalisés basés sur les indicateurs de performance que vos applications, vos services et votre cluster peuvent signaler.</span><span class="sxs-lookup"><span data-stu-id="af399-157">*Metrics Explorer* is a useful tool for creating custom dashboards based on metrics that your applications, services, and cluster may be reporting.</span></span> <span data-ttu-id="af399-158">Consultez [Exploration des indicateurs de performance dans Application Insights](../application-insights/app-insights-metrics-explorer.md) pour configurer vous-mêmes quelques graphiques basés sur les données que vous collectez.</span><span class="sxs-lookup"><span data-stu-id="af399-158">See [Exploring Metrics in Application Insights](../application-insights/app-insights-metrics-explorer.md) to set up a few charts for yourself based on the data you are collecting.</span></span>

<span data-ttu-id="af399-159">Si vous cliquez sur **Analyse**, vous accédez au portail Application Insights Analytics, où vous pouvez interroger des événements et des traces avec une plus grande étendue et plus de choix.</span><span class="sxs-lookup"><span data-stu-id="af399-159">Clicking **Analytics** will take you to the Application Insights Analytics portal, where you can query events and traces with greater scope and optionality.</span></span> <span data-ttu-id="af399-160">Vous pouvez en apprendre plus à ce sujet dans [Analytics dans Application Insights](../application-insights/app-insights-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="af399-160">Read more about this at [Analytics in Application Insights](../application-insights/app-insights-analytics.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="af399-161">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="af399-161">Next steps</span></span>

* <span data-ttu-id="af399-162">[Configurer des alertes dans AI](../application-insights/app-insights-alerts.md) pour être averti des changements de performances ou d’utilisation</span><span class="sxs-lookup"><span data-stu-id="af399-162">[Set up Alerts in AI](../application-insights/app-insights-alerts.md) to be notified about changes in performance or usage</span></span>
* <span data-ttu-id="af399-163">La [détection intelligente dans Application Insights](../application-insights/app-insights-proactive-diagnostics.md) effectue une analyse proactive de la télémétrie envoyée à AI pour vous avertir d’éventuels problèmes de performances</span><span class="sxs-lookup"><span data-stu-id="af399-163">[Smart Detection in Application Insights](../application-insights/app-insights-proactive-diagnostics.md) performs a proactive analysis of the telemetry being sent to AI to warn you of potential performance problems</span></span>