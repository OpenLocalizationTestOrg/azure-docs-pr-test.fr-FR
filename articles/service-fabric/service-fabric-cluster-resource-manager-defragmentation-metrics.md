---
title: "aaaDefragmentation de métriques dans Azure Service Fabric | Documents Microsoft"
description: "Une présentation de l’utilisation de la défragmentation ou de la compression en tant que stratégie pour les métriques dans Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: e5ebfae5-c8f7-4d6c-9173-3e22a9730552
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: d09045a6cf196d2771f1a0794637f4579d3eb96b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="defragmentation-of-metrics-and-load-in-service-fabric"></a><span data-ttu-id="9f9bc-103">Défragmentation des mesures et de la charge dans Service Fabric</span><span class="sxs-lookup"><span data-stu-id="9f9bc-103">Defragmentation of metrics and load in Service Fabric</span></span>
<span data-ttu-id="9f9bc-104">stratégie par défaut de Hello Service Fabric Cluster du Gestionnaire de ressources pour la gestion des mesures de charge dans le cluster de hello est la charge de hello toodistribute.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-104">hello Service Fabric Cluster Resource Manager's default strategy for managing load metrics in hello cluster is toodistribute hello load.</span></span> <span data-ttu-id="9f9bc-105">S’assurer que les nœuds sont utilisés uniformément évite à chaud et à froids taches conduire tooboth contention et gaspillage des ressources.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-105">Ensuring that nodes are evenly utilized avoids hot and cold spots that lead tooboth contention and wasted resources.</span></span> <span data-ttu-id="9f9bc-106">Distribuer les charges de travail dans un cluster de hello est également hello plus sûre en termes de survivant d’échecs, car elle garantit qu’une défaillance ne retirez un grand pourcentage de charge de travail donné.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-106">Distributing workloads in hello cluster is also hello safest in terms of surviving failures since it ensures that a failure doesn’t take out a large percentage of a given workload.</span></span> 

<span data-ttu-id="9f9bc-107">Hello, Gestionnaire de ressources du Cluster Service Fabric ne prend pas en charge une autre stratégie pour la gestion de charge, ce qui est la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-107">hello Service Fabric Cluster Resource Manager does support a different strategy for managing load, which is defragmentation.</span></span> <span data-ttu-id="9f9bc-108">Défragmentation signifie qu’au lieu de la tentative d’utilisation de hello toodistribute d’une mesure sur le cluster de hello, il est consolidé.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-108">Defragmentation means that instead of trying toodistribute hello utilization of a metric across hello cluster, it is consolidated.</span></span> <span data-ttu-id="9f9bc-109">La consolidation est simplement une inversion de stratégie – au lieu de réduction hello moyenne écart type de charge de métrique d’équilibrage de la valeur par défaut hello, hello Gestionnaire de ressources de Cluster tente de tooincrease il.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-109">Consolidation is just an inversion of hello default balancing strategy – instead of minimizing hello average standard deviation of metric load, hello Cluster Resource Manager tries tooincrease it.</span></span>

## <a name="when-toouse-defragmentation"></a><span data-ttu-id="9f9bc-110">Lors de la défragmentation de toouse</span><span class="sxs-lookup"><span data-stu-id="9f9bc-110">When toouse defragmentation</span></span>
<span data-ttu-id="9f9bc-111">Répartition de charge dans le cluster de hello consomme des ressources hello sur chaque nœud.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-111">Distributing load in hello cluster consumes some of hello resources on each node.</span></span> <span data-ttu-id="9f9bc-112">Certaines charges de travail créent des services qui sont particulièrement volumineux et qui consomment la plus grande partie voire la totalité d’un nœud.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-112">Some workloads create services that are exceptionally large and consume most or all of a node.</span></span> <span data-ttu-id="9f9bc-113">Dans ces cas, il est possible que lorsqu’il existe de grandes charges de travail créés qu’il ne suffit pas de l’espace sur toorun de n’importe quel nœud les.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-113">In these cases, it's possible that when there are large workloads getting created that there isn't enough space on any node toorun them.</span></span> <span data-ttu-id="9f9bc-114">Grandes charges de travail ne sont pas un problème dans l’infrastructure de Service ; dans ces hello cas Gestionnaire de ressources de Cluster détermine qu’il nécessite de salle de toomake cluster tooreorganize hello pour cette grande charge de travail.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-114">Large workloads aren't a problem in Service Fabric; in these cases hello Cluster Resource Manager determines that it needs tooreorganize hello cluster toomake room for this large workload.</span></span> <span data-ttu-id="9f9bc-115">Toutefois, dans hello attendant cette charge de travail a toobe toowait planifié dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-115">However, in hello meantime that workload has toowait toobe scheduled in hello cluster.</span></span>

<span data-ttu-id="9f9bc-116">S’il existe de nombreux services et toomove état autour, il peut prendre beaucoup de temps pour hello grande charge de travail toobe est placé dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-116">If there are many services and state toomove around, then it could take a long time for hello large workload toobe placed in hello cluster.</span></span> <span data-ttu-id="9f9bc-117">Il est plus probable si les autres charges de travail dans un cluster de hello sont également volumineux et par conséquent, prennent tooreorganize plus de temps.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-117">This is more likely if other workloads in hello cluster are also large and so take longer tooreorganize.</span></span> <span data-ttu-id="9f9bc-118">équipe de Service Fabric Hello mesurée heures de création de simulations de ce scénario.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-118">hello Service Fabric team measured creation times in simulations of this scenario.</span></span> <span data-ttu-id="9f9bc-119">Nous avons constaté que la création de services volumineux prend beaucoup plus de temps dès que l’utilisation de clusters se situe entre 30 et 50 %.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-119">We found that creating large services took much longer as soon as cluster utilization got above between 30% and 50%.</span></span> <span data-ttu-id="9f9bc-120">toohandle ce scénario, nous avons présenté comme une stratégie d’équilibrage de la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-120">toohandle this scenario, we introduced defragmentation as a balancing strategy.</span></span> <span data-ttu-id="9f9bc-121">Nous avons trouvé que pour les charges de travail importantes, notamment ceux où l’heure de création était important, la défragmentation a vraiment aidé à ces nouvelles charges de travail obtient planifiées dans le cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-121">We found that for large workloads, especially ones where creation time was important, defragmentation really helped those new workloads get scheduled in hello cluster.</span></span>

<span data-ttu-id="9f9bc-122">Vous pouvez configurer la défragmentation métriques toohave hello charge de hello tooproactively du Gestionnaire de ressources du Cluster try toocondense des services de hello en moins de nœuds.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-122">You can configure defragmentation metrics toohave hello Cluster Resource Manager tooproactively try toocondense hello load of hello services into fewer nodes.</span></span> <span data-ttu-id="9f9bc-123">Cela permet de s’assurer qu’il est presque toujours place pour les services volumineux sans réorganiser les cluster hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-123">This helps ensure that there is almost always room for large services without reorganizing hello cluster.</span></span> <span data-ttu-id="9f9bc-124">N’ayant ne pas de cluster de hello tooreorganize permet de créer rapidement de grandes charges de travail.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-124">Not having tooreorganize hello cluster allows creating large workloads quickly.</span></span>

<span data-ttu-id="9f9bc-125">La plupart des utilisateurs n’ont pas besoin de la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-125">Most people don’t need defragmentation.</span></span> <span data-ttu-id="9f9bc-126">Les services sont généralement être petite, donc il n’est pas salle toofind dur pour eux dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-126">Services are usually be small, so it’s not hard toofind room for them in hello cluster.</span></span> <span data-ttu-id="9f9bc-127">Lorsqu’une réorganisation est possible, elle se déroule rapidement car la plupart des services sont petits et peuvent être déplacés rapidement et en parallèle.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-127">When reorganization is possible, it goes quickly, again because most services are small and can be moved quickly and in parallel.</span></span> <span data-ttu-id="9f9bc-128">Toutefois, si vous les services de grande taille et avez besoin de créer rapidement hello stratégie de défragmentation est pour vous.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-128">However, if you have large services and need them created quickly then hello defragmentation strategy is for you.</span></span> <span data-ttu-id="9f9bc-129">Nous aborderons compromis hello d’ensuite à l’aide de la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-129">We'll discuss hello tradeoffs of using defragmentation next.</span></span> 

## <a name="defragmentation-tradeoffs"></a><span data-ttu-id="9f9bc-130">Compromis concernant la défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-130">Defragmentation tradeoffs</span></span>
<span data-ttu-id="9f9bc-131">La défragmentation peut augmenter la probabilité que les défaillances aient un impact car plus de services sont exécutés sur des nœuds défaillants.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-131">Defragmentation can increase impactfulness of failures, since more services are running on nodes that fail.</span></span> <span data-ttu-id="9f9bc-132">Défragmentation peut également augmenter les coûts, étant donné que les ressources de cluster de hello doivent être gardées en réserve, en attente pour la création de hello de grandes charges de travail.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-132">Defragmentation can also increase costs, since resources in hello cluster must be held in reserve, waiting for hello creation of large workloads.</span></span>

<span data-ttu-id="9f9bc-133">Hello diagramme suivant donne une représentation visuelle de deux clusters, qui est la défragmentation et qui n’est pas.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-133">hello following diagram gives a visual representation of two clusters, one that is defragmented and one that is not.</span></span> 

<span data-ttu-id="9f9bc-134"><center>
![Comparaison de clusters équilibré et défragmenté][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="9f9bc-134"><center>
![Comparing Balanced and Defragmented Clusters][Image1]
</center></span></span>

<span data-ttu-id="9f9bc-135">Dans les cas de hello équilibré, envisagez nombre hello mouvements qui seraient nécessaire tooplace un des objets de service de plus grande hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-135">In hello balanced case, consider hello number of movements that would be necessary tooplace one of hello largest service objects.</span></span> <span data-ttu-id="9f9bc-136">Dans un cluster de défragmenté hello, grande charge de travail hello peut être placé sur des nœuds de quatre ou cinq sans avoir toowait pour n’importe quel autre toomove de services.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-136">In hello defragmented cluster, hello large workload could be placed on nodes four or five without having toowait for any other services toomove.</span></span>

## <a name="defragmentation-pros-and-cons"></a><span data-ttu-id="9f9bc-137">Avantages et inconvénients de la défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-137">Defragmentation pros and cons</span></span>
<span data-ttu-id="9f9bc-138">Quelles sont donc ces autres compromis ?</span><span class="sxs-lookup"><span data-stu-id="9f9bc-138">So what are those other conceptual tradeoffs?</span></span> <span data-ttu-id="9f9bc-139">Voici un tableau rapide de choses toothink sur :</span><span class="sxs-lookup"><span data-stu-id="9f9bc-139">Here’s a quick table of things toothink about:</span></span>

| <span data-ttu-id="9f9bc-140">Avantages de la défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-140">Defragmentation Pros</span></span> | <span data-ttu-id="9f9bc-141">Inconvénients de la défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-141">Defragmentation Cons</span></span> |
| --- | --- |
| <span data-ttu-id="9f9bc-142">Permet la création plus rapide de services de grande taille</span><span class="sxs-lookup"><span data-stu-id="9f9bc-142">Allows faster creation of large services</span></span> |<span data-ttu-id="9f9bc-143">Concentre la charge dans un plus petit nombre de nœuds, ce qui augmente la contention</span><span class="sxs-lookup"><span data-stu-id="9f9bc-143">Concentrates load onto fewer nodes, increasing contention</span></span> |
| <span data-ttu-id="9f9bc-144">Permet de diminuer le déplacement des données lors de la création</span><span class="sxs-lookup"><span data-stu-id="9f9bc-144">Enables lower data movement during creation</span></span> |<span data-ttu-id="9f9bc-145">Les défaillances peuvent avoir un impact sur d’autres services et provoquer une plus grande désinscription</span><span class="sxs-lookup"><span data-stu-id="9f9bc-145">Failures can impact more services and cause more churn</span></span> |
| <span data-ttu-id="9f9bc-146">Permet de décrire en détail les exigences et la récupération d’espace</span><span class="sxs-lookup"><span data-stu-id="9f9bc-146">Allows rich description of requirements and reclamation of space</span></span> |<span data-ttu-id="9f9bc-147">Configuration générale plus complexe de la gestion des ressources</span><span class="sxs-lookup"><span data-stu-id="9f9bc-147">More complex overall Resource Management configuration</span></span> |

<span data-ttu-id="9f9bc-148">Vous pouvez combiner défragmenté et de mesures normales hello même cluster.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-148">You can mix defragmented and normal metrics in hello same cluster.</span></span> <span data-ttu-id="9f9bc-149">Hello Gestionnaire de ressources de Cluster essaie tooconsolidate hello défragmentation métriques autant que possible lors de la répartition des hello d’autres.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-149">hello Cluster Resource Manager tries tooconsolidate hello defragmentation metrics as much as possible while spreading out hello others.</span></span> <span data-ttu-id="9f9bc-150">résultats Hello de mélange de défragmentation et équilibrage des stratégies dépend de plusieurs facteurs, notamment :</span><span class="sxs-lookup"><span data-stu-id="9f9bc-150">hello results of mixing defragmentation and balancing strategies depends on several factors, including:</span></span>
  - <span data-ttu-id="9f9bc-151">nombre de Hello d’équilibrage de la métrique contre le nombre de hello de métriques de défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-151">hello number of balancing metrics vs. hello number of defragmentation metrics</span></span>
  - <span data-ttu-id="9f9bc-152">si un service utilise ces deux types de mesures</span><span class="sxs-lookup"><span data-stu-id="9f9bc-152">Whether any service uses both types of metrics</span></span> 
  - <span data-ttu-id="9f9bc-153">poids de métrique Hello</span><span class="sxs-lookup"><span data-stu-id="9f9bc-153">hello metric weights</span></span>
  - <span data-ttu-id="9f9bc-154">les charges actuelles des mesures</span><span class="sxs-lookup"><span data-stu-id="9f9bc-154">current metric loads</span></span>
  
<span data-ttu-id="9f9bc-155">Expérimentation toodetermine requis hello exacte configuration est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-155">Experimentation is required toodetermine hello exact configuration necessary.</span></span> <span data-ttu-id="9f9bc-156">Nous vous recommandons d’effectuer une mesure minutieuse de vos charges de travail avant d’activer les mesures de défragmentation en production.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-156">We recommend thorough measurement of your workloads before you enable defragmentation metrics in production.</span></span> <span data-ttu-id="9f9bc-157">Cela est particulièrement vrai lorsque vous mélangez défragmentation et équilibrage de charge de métriques dans hello même service.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-157">This is especially true when mixing defragmentation and balanced metrics within hello same service.</span></span> 

## <a name="configuring-defragmentation-metrics"></a><span data-ttu-id="9f9bc-158">Configuration de mesures de défragmentation</span><span class="sxs-lookup"><span data-stu-id="9f9bc-158">Configuring defragmentation metrics</span></span>
<span data-ttu-id="9f9bc-159">Configuration des métriques de défragmentation est une décision globale dans un cluster de hello et mesures individuelles peuvent être sélectionnées pour la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-159">Configuring defragmentation metrics is a global decision in hello cluster, and individual metrics can be selected for defragmentation.</span></span> <span data-ttu-id="9f9bc-160">Hello, suivant la configuration des extraits de code montrent comment tooconfigure les métriques pour la défragmentation.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-160">hello following config snippets show how tooconfigure metrics for defragmentation.</span></span> <span data-ttu-id="9f9bc-161">Dans ce cas, « Metric1 » est configuré en tant que la défragmentation métrique, alors que « Metric2 » continue toobe équilibrée normalement.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-161">In this case, "Metric1" is configured as a defragmentation metric, while "Metric2" will continue toobe balanced normally.</span></span> 

<span data-ttu-id="9f9bc-162">ClusterManifest.xml :</span><span class="sxs-lookup"><span data-stu-id="9f9bc-162">ClusterManifest.xml:</span></span>

```xml
<Section Name="DefragmentationMetrics">
    <Parameter Name="Metric1" Value="true" />
    <Parameter Name="Metric2" Value="false" />
</Section>
```

<span data-ttu-id="9f9bc-163">via ClusterConfig.json pour les déploiements autonomes ou Template.json pour les clusters hébergés sur Azure :</span><span class="sxs-lookup"><span data-stu-id="9f9bc-163">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "DefragmentationMetrics",
    "parameters": [
      {
          "name": "Metric1",
          "value": "true"
      },
      {
          "name": "Metric2",
          "value": "false"
      }
    ]
  }
]
```


## <a name="next-steps"></a><span data-ttu-id="9f9bc-164">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9f9bc-164">Next steps</span></span>
- <span data-ttu-id="9f9bc-165">Hello Gestionnaire de ressources du Cluster a des options de man pour décrire le cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-165">hello Cluster Resource Manager has man options for describing hello cluster.</span></span> <span data-ttu-id="9f9bc-166">toofind plus d’informations à leur sujet, consultez cet article sur [décrivant un cluster Service Fabric](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="9f9bc-166">toofind out more about them, check out this article on [describing a Service Fabric cluster](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
- <span data-ttu-id="9f9bc-167">Les métriques sont comment hello Gestionnaire de ressources du Cluster Service Fabric gère la consommation et la capacité en cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="9f9bc-167">Metrics are how hello Service Fabric Cluster Resource Manger manages consumption and capacity in hello cluster.</span></span> <span data-ttu-id="9f9bc-168">toolearn plus d’informations sur les métriques et comment tooconfigure, extraire [cet article](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="9f9bc-168">toolearn more about metrics and how tooconfigure them, check out [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-defragmentation-metrics/balancing-defrag-compared.png
