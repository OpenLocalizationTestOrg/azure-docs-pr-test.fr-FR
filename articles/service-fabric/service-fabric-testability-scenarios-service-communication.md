---
title: "Testabilité : communication de service | Microsoft Docs"
description: "La communication service à service constitue un point d’intégration critique d’une application Service Fabric. Cet article aborde les problématiques de conception et les techniques de test."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="f2e6e-104">Scénarios de testabilité de Service Fabric : communication de service</span><span class="sxs-lookup"><span data-stu-id="f2e6e-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="f2e6e-105">Les microservices et les styles architecturaux orientés services émergent naturellement dans Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="f2e6e-106">Dans ces types d’architectures distribuées, les applications basées sur des composants microservice sont généralement composées de plusieurs services qui doivent tootalk tooeach autres.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="f2e6e-107">Dans les cas les plus simples hello même, vous avez généralement au moins un service web sans état et un service de stockage de données avec état qui doivent toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="f2e6e-108">Les communications de service sont un point d’intégration critiques d’une application, car chaque service expose un tooother les services API à distance.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="f2e6e-109">L’utilisation d’un ensemble de limites d’API impliquant un trafic d’E/S nécessite bien souvent une attention particulière, secondée par de solides méthodes de test et de validation.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="f2e6e-110">Il existe plusieurs considérations toomake lorsque ces limites de service sont reliées entre elles dans un système distribué :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="f2e6e-111">*Protocole de transfert*.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-111">*Transport protocol*.</span></span> <span data-ttu-id="f2e6e-112">Allez-vous utiliser le protocole HTTP, pour une interopérabilité améliorée, ou un protocole binaire personnalisé favorisant un débit optimal ?</span><span class="sxs-lookup"><span data-stu-id="f2e6e-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="f2e6e-113">*Gestion des erreurs*.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-113">*Error handling*.</span></span> <span data-ttu-id="f2e6e-114">Comment les erreurs permanentes et temporaires sont-elles traitées ?</span><span class="sxs-lookup"><span data-stu-id="f2e6e-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="f2e6e-115">Que se passe-t-il lorsqu’un service déplace tooa autre nœud ?</span><span class="sxs-lookup"><span data-stu-id="f2e6e-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="f2e6e-116">*Délais d’attente et latence*.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-116">*Timeouts and latency*.</span></span> <span data-ttu-id="f2e6e-117">Dans les applications multicouches, comment chaque couche de service gère latence par un utilisateur de la pile et toohello hello ?</span><span class="sxs-lookup"><span data-stu-id="f2e6e-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="f2e6e-118">Si vous utilisez un des composants de communication hello service intégré fournis par l’infrastructure de Service ou si vous générez votre propre, interactions hello entre vos services de test est résilience tooensuring critiques dans votre application.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="f2e6e-119">Préparer les services toomove</span><span class="sxs-lookup"><span data-stu-id="f2e6e-119">Prepare for services toomove</span></span>
<span data-ttu-id="f2e6e-120">Les instances de service peuvent se déplacer au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-120">Service instances may move around over time.</span></span> <span data-ttu-id="f2e6e-121">Ce déplacement est particulièrement avéré quand elles sont configurées avec des mesures de charge dédiées à l’équilibrage personnalisé optimal des ressources.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="f2e6e-122">Service Fabric déplace votre toomaximize d’instances de service leur disponibilité même pendant les mises à niveau, les basculements, montée en puissance parallèle et d’autres situations qui se produisent sur la durée de vie hello d’un système distribué.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="f2e6e-123">Services de se déplacement dans un cluster de hello, vos clients et autres services doivent être préparée toohandle deux scénarios lorsqu’ils parlent tooa service :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="f2e6e-124">réplica de partition ou instance de service Hello a été déplacée depuis hello heure de la dernière, nous vous avons tooit.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="f2e6e-125">Il s’agit d’un composant normal d’un cycle de vie du service, et il doit être toohappen attendu pendant la durée de vie hello de votre application.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="f2e6e-126">réplica de partition ou instance de service Hello est en cours de hello de déplacement.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="f2e6e-127">Bien que le basculement d’un service à partir d’un nœud tooanother s’effectue très rapidement dans l’infrastructure de Service, il peut avoir un délai de disponibilité si le composant de communication hello de votre service est lente toostart.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="f2e6e-128">Pour bénéficier d’un système pleinement fonctionnel, il est nécessaire de gérer ces scénarios de manière appropriée.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="f2e6e-129">toodo, gardez à l’esprit que :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="f2e6e-130">Tous les services qui peuvent être connectés toohas un *adresse* qu’il écoute sur (par exemple, HTTP ou WebSocket).</span><span class="sxs-lookup"><span data-stu-id="f2e6e-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="f2e6e-131">Quand une instance ou partition de service se déplace, le point de terminaison de son adresse change.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="f2e6e-132">(Il déplace tooa autre nœud avec une autre adresse IP.) Si vous utilisez des composants de communication intégrée hello, ils gèrent ré-résolution des adresses de service pour vous.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="f2e6e-133">Il peut y avoir une augmentation de latence de service en tant qu’instance de service hello démarre son écouteur à nouveau.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="f2e6e-134">Cela dépend de la rapidité avec laquelle le service de hello ouvre à un écouteur de hello après le déplacement de l’instance de service hello.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="f2e6e-135">Toutes les connexions existantes doivent toobe fermée et rouverte après ouverture du service de hello sur un nouveau nœud.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="f2e6e-136">Un arrêt correct de nœuds ou redémarrage permet pour toobe de connexions existant s’arrête.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="f2e6e-137">Test : déplacement des instances de service</span><span class="sxs-lookup"><span data-stu-id="f2e6e-137">Test it: Move service instances</span></span>
<span data-ttu-id="f2e6e-138">À l’aide des outils de test de Service Fabric, vous pouvez créer un tootest de scénario de test à ces situations de différentes façons :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="f2e6e-139">Déplacez un réplica principal de service avec état.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="f2e6e-140">Hello réplica principal d’une partition de service avec état peut être déplacé pour différentes raisons.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="f2e6e-141">Utilisez cet tootarget hello un réplica principal d’un toosee partition spécifique comment votre toohello réagissent de services se déplacent de façon très contrôlée.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="f2e6e-142">Arrêtez un nœud.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-142">Stop a node.</span></span>
   
    <span data-ttu-id="f2e6e-143">Lorsqu’un nœud est arrêté, se déplace le Service Fabric tous hello service instances ou les partitions qui étaient présents sur ce tooone de nœud de hello autres nœuds disponibles dans le cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="f2e6e-144">Utilisez cette tootest une situation où un nœud est perdu à partir de votre cluster et des instances de service hello et les réplicas sur le nœud toomove.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="f2e6e-145">Vous pouvez arrêter un nœud à l’aide de hello PowerShell **Stop-ServiceFabricNode** applet de commande :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="f2e6e-146">Maintenir la disponibilité du service</span><span class="sxs-lookup"><span data-stu-id="f2e6e-146">Maintain service availability</span></span>
<span data-ttu-id="f2e6e-147">En tant que plateforme, Service Fabric est conçue tooprovide haute disponibilité de vos services.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="f2e6e-148">Mais dans des cas extrêmes, les problèmes liés à l’infrastructure sous-jacente peuvent quand même entraîner une indisponibilité.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="f2e6e-149">Il est trop important tootest pour ces scénarios.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="f2e6e-150">Les services avec état utiliser un état de tooreplicate système basé sur le quorum pour la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="f2e6e-151">Cela signifie qu’un quorum de réplicas doit toobe tooperform disponibles les opérations d’écriture.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="f2e6e-152">Dans de rares cas, comme celui d’une défaillance matérielle étendue, aucun quorum de réplicas ne peut être disponible.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="f2e6e-153">Dans ce cas, vous ne serez pas en mesure de tooperform les opérations d’écriture, mais vous serez toujours en mesure de tooperform des opérations de lecture.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="f2e6e-154">Test : écriture de l’indisponibilité des opérations</span><span class="sxs-lookup"><span data-stu-id="f2e6e-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="f2e6e-155">À l’aide des outils de testabilité hello dans l’infrastructure de Service, vous pouvez injecter une erreur qui induit une perte de quorum en tant que test.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="f2e6e-156">Bien que ce cas soit rare, il est important que les clients et les services qui dépendent d’un service avec état sont préparés toohandle les situations où ils ne peuvent pas apporter tooit de demandes d’écriture.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="f2e6e-157">Il est également important que hello avec état service tient compte de cette possibilité et peut le communiquer en douceur toocallers.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="f2e6e-158">Vous est susceptible d’entraîner une perte de quorum à l’aide de hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** applet de commande :</span><span class="sxs-lookup"><span data-stu-id="f2e6e-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="f2e6e-159">Dans cet exemple, nous avons défini `QuorumLossMode` trop`QuorumReplicas` tooindicate que nous souhaitons perte de quorum tooinduce sans arrêter tous les réplicas.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="f2e6e-160">Ainsi, les opérations de lecture sont toujours possibles.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-160">This way, read operations are still possible.</span></span> <span data-ttu-id="f2e6e-161">tootest un scénario où un ensemble de la partition est indisponible, vous pouvez définir ce commutateur trop`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="f2e6e-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f2e6e-162">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f2e6e-162">Next steps</span></span>
[<span data-ttu-id="f2e6e-163">En savoir plus sur les actions de testabilité</span><span class="sxs-lookup"><span data-stu-id="f2e6e-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="f2e6e-164">En savoir plus sur les scénarios de testabilité</span><span class="sxs-lookup"><span data-stu-id="f2e6e-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)

