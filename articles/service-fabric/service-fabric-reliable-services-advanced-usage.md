---
title: "utilisation d’aaaAdvanced des Services fiables | Documents Microsoft"
description: "En savoir plus sur l’utilisation avancée de Reliable Services de Service Fabric pour améliorer la flexibilité de vos services."
services: Service-Fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: masnider
ms.assetid: f2942871-863d-47c3-b14a-7cdad9a742c7
ms.service: Service-Fabric
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: e6d6310a4deae9edcfcd76551e1337f0e39e9e5d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-usage-of-hello-reliable-services-programming-model"></a><span data-ttu-id="aff0d-103">L’utilisation du modèle de programmation des Services fiables hello avancée</span><span class="sxs-lookup"><span data-stu-id="aff0d-103">Advanced usage of hello Reliable Services programming model</span></span>
<span data-ttu-id="aff0d-104">Azure Service Fabric simplifie l’écriture et la gestion des services fiables avec et sans état.</span><span class="sxs-lookup"><span data-stu-id="aff0d-104">Azure Service Fabric simplifies writing and managing reliable stateless and stateful services.</span></span> <span data-ttu-id="aff0d-105">Ce guide parle utilisations avancées des Services fiables toogain davantage de contrôle et de flexibilité sur vos services.</span><span class="sxs-lookup"><span data-stu-id="aff0d-105">This guide talks about advanced usages of Reliable Services toogain more control and flexibility over your services.</span></span> <span data-ttu-id="aff0d-106">Tooreading préalable de ce guide, familiarisez-vous avec [modèle de programmation de Services fiables hello](service-fabric-reliable-services-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="aff0d-106">Prior tooreading this guide, familiarize yourself with [hello Reliable Services programming model](service-fabric-reliable-services-introduction.md).</span></span>

<span data-ttu-id="aff0d-107">Les services avec et sans état ont deux points d’entrée principaux pour le code utilisateur :</span><span class="sxs-lookup"><span data-stu-id="aff0d-107">Both stateful and stateless services have two primary entry points for user code:</span></span>

* <span data-ttu-id="aff0d-108">`RunAsync(C#) / runAsync(Java)` est un point d’entrée à usage général pour votre code de service.</span><span class="sxs-lookup"><span data-stu-id="aff0d-108">`RunAsync(C#) / runAsync(Java)` is a general-purpose entry point for your service code.</span></span>
* <span data-ttu-id="aff0d-109">`CreateServiceReplicaListeners(C#)` et `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` sont utilisés pour l’ouverture des écouteurs de communication pour les requêtes du client.</span><span class="sxs-lookup"><span data-stu-id="aff0d-109">`CreateServiceReplicaListeners(C#)` and `CreateServiceInstanceListeners(C#) / createServiceInstanceListeners(Java)` is for opening communication listeners for client requests.</span></span>

<span data-ttu-id="aff0d-110">Pour la plupart des services, ces deux points d’entrée sont suffisants.</span><span class="sxs-lookup"><span data-stu-id="aff0d-110">For most services, these two entry points are sufficient.</span></span> <span data-ttu-id="aff0d-111">Dans de rares cas, lorsque davantage de contrôle sur le cycle de vie d’un service est requis, des événements de cycle de vie supplémentaires sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="aff0d-111">In rare cases when more control over a service's lifecycle is required, additional lifecycle events are available.</span></span>

## <a name="stateless-service-instance-lifecycle"></a><span data-ttu-id="aff0d-112">Cycle de vie d’instance de service sans état</span><span class="sxs-lookup"><span data-stu-id="aff0d-112">Stateless service instance lifecycle</span></span>
<span data-ttu-id="aff0d-113">Le cycle de vie d’un service sans état est très simple.</span><span class="sxs-lookup"><span data-stu-id="aff0d-113">A stateless service's lifecycle is very simple.</span></span> <span data-ttu-id="aff0d-114">Un service sans état peut uniquement être ouvert, fermé ou abandonné.</span><span class="sxs-lookup"><span data-stu-id="aff0d-114">A stateless service can only be opened, closed, or aborted.</span></span> <span data-ttu-id="aff0d-115">`RunAsync` dans un service sans état est exécuté quand une instance de service est ouverte, et annulée quand une instance de service est fermée ou abandonnée.</span><span class="sxs-lookup"><span data-stu-id="aff0d-115">`RunAsync` in a stateless service is executed when a service instance is opened, and canceled when a service instance is closed or aborted.</span></span>

<span data-ttu-id="aff0d-116">Bien que `RunAsync` doit être suffisante dans presque tous les cas, hello ouvrir, fermer et abandonner les événements dans un service sans état sont également disponibles :</span><span class="sxs-lookup"><span data-stu-id="aff0d-116">Although `RunAsync` should be sufficient in almost all cases, hello open, close, and abort events in a stateless service are also available:</span></span>

* <span data-ttu-id="aff0d-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java`OnOpenAsync est appelé lorsque l’instance de service sans état hello concerne toobe utilisé.</span><span class="sxs-lookup"><span data-stu-id="aff0d-117">`Task OnOpenAsync(IStatelessServicePartition, CancellationToken) - C# / CompletableFuture<String> onOpenAsync(CancellationToken) - Java` OnOpenAsync is called when hello stateless service instance is about toobe used.</span></span> <span data-ttu-id="aff0d-118">Les tâches d'initialisation de service étendues peuvent être démarrées à ce stade.</span><span class="sxs-lookup"><span data-stu-id="aff0d-118">Extended service initialization tasks can be started at this time.</span></span>
* <span data-ttu-id="aff0d-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java`OnCloseAsync est appelé lorsque l’instance de service sans état hello est en train de toobe arrêt en douceur.</span><span class="sxs-lookup"><span data-stu-id="aff0d-119">`Task OnCloseAsync(CancellationToken) - C# / CompletableFuture onCloseAsync(CancellationToken) - Java` OnCloseAsync is called when hello stateless service instance is going toobe gracefully shut down.</span></span> <span data-ttu-id="aff0d-120">Cela peut se produire lorsque hello du code est en cours de mise à niveau, l’instance de service hello est déplacé en raison de l’équilibrage de la tooload ou une erreur transitoire est détectée.</span><span class="sxs-lookup"><span data-stu-id="aff0d-120">This can occur when hello service's code is being upgraded, hello service instance is being moved due tooload balancing, or a transient fault is detected.</span></span> <span data-ttu-id="aff0d-121">OnCloseAsync peut être utilisé toosafely fermer toutes les ressources, arrêtez tout le traitement en arrière-plan, terminer l’enregistrement de l’état externe ou fermer les connexions existantes.</span><span class="sxs-lookup"><span data-stu-id="aff0d-121">OnCloseAsync can be used toosafely close any resources, stop any background processing, finish saving external state, or close down existing connections.</span></span>
* <span data-ttu-id="aff0d-122">`void OnAbort() - C# / void onAbort() - Java`OnAbort est appelé lorsque l’instance de service sans état hello est forcé arrêté.</span><span class="sxs-lookup"><span data-stu-id="aff0d-122">`void OnAbort() - C# / void onAbort() - Java` OnAbort is called when hello stateless service instance is being forcefully shut down.</span></span> <span data-ttu-id="aff0d-123">Cela est généralement appelée lorsqu’une erreur permanente est détectée sur le nœud de hello, ou lorsque l’infrastructure de Service ne peut pas gérer le cycle de vie de l’instance de service hello en raison d’échecs de toointernal de manière fiable.</span><span class="sxs-lookup"><span data-stu-id="aff0d-123">This is generally called when a permanent fault is detected on hello node, or when Service Fabric cannot reliably manage hello service instance's lifecycle due toointernal failures.</span></span>

## <a name="stateful-service-replica-lifecycle"></a><span data-ttu-id="aff0d-124">Cycle de vie d’un réplica de service avec état</span><span class="sxs-lookup"><span data-stu-id="aff0d-124">Stateful service replica lifecycle</span></span>

> [!NOTE]
> <span data-ttu-id="aff0d-125">Les services fiables avec état ne sont pas encore pris en charge par Java.</span><span class="sxs-lookup"><span data-stu-id="aff0d-125">Stateful reliable services are not supported in Java yet.</span></span>
>
>

<span data-ttu-id="aff0d-126">Le cycle de vie d’un réplica de service avec état est beaucoup plus complexe qu’une instance de service sans état.</span><span class="sxs-lookup"><span data-stu-id="aff0d-126">A stateful service replica's lifecycle is much more complex than a stateless service instance.</span></span> <span data-ttu-id="aff0d-127">En outre tooopen, fermez et abandonner les événements, un réplica de service avec état subit des modifications de rôle pendant sa durée de vie.</span><span class="sxs-lookup"><span data-stu-id="aff0d-127">In addition tooopen, close, and abort events, a stateful service replica undergoes role changes during its lifetime.</span></span> <span data-ttu-id="aff0d-128">Quand un réplica de service avec état change de rôle, hello `OnChangeRoleAsync` est déclenché :</span><span class="sxs-lookup"><span data-stu-id="aff0d-128">When a stateful service replica changes role, hello `OnChangeRoleAsync` event is triggered:</span></span>

* <span data-ttu-id="aff0d-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)`OnChangeRoleAsync est appelé lorsque le réplica de service avec état hello est la modification de rôle, par exemple tooprimary ou base de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="aff0d-129">`Task OnChangeRoleAsync(ReplicaRole, CancellationToken)` OnChangeRoleAsync is called when hello stateful service replica is changing role, for example tooprimary or secondary.</span></span> <span data-ttu-id="aff0d-130">Les réplicas principaux figurent un statut d’écriture (sont autorisés à toocreate et écrire des Collections de tooReliable).</span><span class="sxs-lookup"><span data-stu-id="aff0d-130">Primary replicas are given write status (are allowed toocreate and write tooReliable Collections).</span></span> <span data-ttu-id="aff0d-131">Les réplicas secondaires se voient affecter un état de lecture (ils peuvent uniquement lire à partir de collections fiables existantes).</span><span class="sxs-lookup"><span data-stu-id="aff0d-131">Secondary replicas are given read status (can only read from existing Reliable Collections).</span></span> <span data-ttu-id="aff0d-132">La plupart du travail dans un service avec état est effectué au réplica principal de hello.</span><span class="sxs-lookup"><span data-stu-id="aff0d-132">Most work in a stateful service is performed at hello primary replica.</span></span> <span data-ttu-id="aff0d-133">Les réplicas secondaires peuvent effectuer la validation en lecture seule, la génération de rapports, l’exploration de données ou d’autres tâches en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="aff0d-133">Secondary replicas can perform read-only validation, report generation, data mining, or other read-only jobs.</span></span>

<span data-ttu-id="aff0d-134">Dans un service avec état, seuls les réplicas principal hello a un accès en écriture toostate et sont donc généralement lorsque le service de hello effectue le travail réel.</span><span class="sxs-lookup"><span data-stu-id="aff0d-134">In a stateful service, only hello primary replica has write access toostate and thus is generally when hello service is performing actual work.</span></span> <span data-ttu-id="aff0d-135">Hello `RunAsync` méthode dans un service avec état est exécutée que lorsque le réplica de service avec état hello est principal.</span><span class="sxs-lookup"><span data-stu-id="aff0d-135">hello `RunAsync` method in a stateful service is executed only when hello stateful service replica is primary.</span></span> <span data-ttu-id="aff0d-136">Hello `RunAsync` méthode est annulée lorsque des modifications de rôle d’un réplica principal en s’éloignant de principal, ainsi qu’au cours de hello ferment et abandonner les événements.</span><span class="sxs-lookup"><span data-stu-id="aff0d-136">hello `RunAsync` method is canceled when a primary replica's role changes away from primary, as well as during hello close and abort events.</span></span>

<span data-ttu-id="aff0d-137">À l’aide de hello `OnChangeRoleAsync` événements vous permet de travail tooperform en fonction du rôle de réplica, ainsi que dans les modifications de toorole de réponse.</span><span class="sxs-lookup"><span data-stu-id="aff0d-137">Using hello `OnChangeRoleAsync` event allows you tooperform work depending on replica role as well as in response toorole change.</span></span>

<span data-ttu-id="aff0d-138">Un service avec état fournit également des hello quatre même cycle de vie des événements comme un service sans état, avec hello même sémantique et en cas d’utilisation :</span><span class="sxs-lookup"><span data-stu-id="aff0d-138">A stateful service also provides hello same four lifecycle events as a stateless service, with hello same semantics and use cases:</span></span>

```csharp
* Task OnOpenAsync(IStatefulServicePartition, CancellationToken)
* Task OnCloseAsync(CancellationToken)
* void OnAbort()
```

## <a name="next-steps"></a><span data-ttu-id="aff0d-139">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="aff0d-139">Next steps</span></span>
<span data-ttu-id="aff0d-140">Pour plus avancées rubriques connexes tooService Fabric, consultez hello suivant des articles :</span><span class="sxs-lookup"><span data-stu-id="aff0d-140">For more advanced topics related tooService Fabric, see hello following articles:</span></span>

* [<span data-ttu-id="aff0d-141">Configuration de Reliable Services avec état</span><span class="sxs-lookup"><span data-stu-id="aff0d-141">Configuring stateful Reliable Services</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="aff0d-142">Présentation de l’intégrité de Service Fabric</span><span class="sxs-lookup"><span data-stu-id="aff0d-142">Service Fabric health introduction</span></span>](service-fabric-health-introduction.md)
* [<span data-ttu-id="aff0d-143">Utilisation des rapports d’intégrité système pour la résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="aff0d-143">Using system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)
* [<span data-ttu-id="aff0d-144">Configuration des Services avec hello Gestionnaire de ressources du Cluster Service Fabric</span><span class="sxs-lookup"><span data-stu-id="aff0d-144">Configuring Services with hello Service Fabric Cluster Resource Manager</span></span>](service-fabric-cluster-resource-manager-configure-services.md)
