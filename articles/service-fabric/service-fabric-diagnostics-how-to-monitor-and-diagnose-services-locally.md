---
title: "Déboguer les microservices Azure dans Windows | Microsoft Docs"
description: "Découvrez comment analyser et diagnostiquer vos services écrits à l’aide de Microsoft Azure Service Fabric sur un ordinateur de développement local."
services: service-fabric
documentationcenter: .net
author: dkkapur
manager: timlt
editor: 
ms.assetid: edcc0631-ed2d-45a3-851d-2c4fa0f4a326
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/24/2017
ms.author: dekapur
ms.openlocfilehash: 08998340afb2f242b9a268331607b0d1ddb9b0c6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="monitor-and-diagnose-services-in-a-local-machine-development-setup"></a><span data-ttu-id="e4554-103">Surveillance et diagnostic des services dans une configuration de développement d’ordinateur local</span><span class="sxs-lookup"><span data-stu-id="e4554-103">Monitor and diagnose services in a local machine development setup</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="e4554-104">Windows</span><span class="sxs-lookup"><span data-stu-id="e4554-104">Windows</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)
> * [<span data-ttu-id="e4554-105">Linux</span><span class="sxs-lookup"><span data-stu-id="e4554-105">Linux</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally-linux.md)
> 
> 

<span data-ttu-id="e4554-106">L’analyse, la détection, le diagnostic et la résolution des problèmes permettent aux services de fonctionner avec une interruption minimale de l’expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e4554-106">Monitoring, detecting, diagnosing, and troubleshooting allow for services to continue with minimal disruption to the user experience.</span></span> <span data-ttu-id="e4554-107">Bien que l’analyse et le diagnostic soient essentiels dans un environnement de production réel déployé, leur efficacité dépend de l’adoption d’un modèle semblable pendant le développement des services pour garantir leur fonctionnement lors du passage à une configuration réelle.</span><span class="sxs-lookup"><span data-stu-id="e4554-107">While monitoring and diagnostics are critical in an actual deployed production environment, the efficiency will depend on adopting a similar model during development of services to ensure they work when you move to a real-world setup.</span></span> <span data-ttu-id="e4554-108">Service Fabric facilite pour les développeurs de service l’implémentation de diagnostics qui peuvent fonctionner parfaitement aussi bien sur une configuration de développement d’ordinateur local unique que sur une configuration réelle de cluster de production.</span><span class="sxs-lookup"><span data-stu-id="e4554-108">Service Fabric makes it easy for service developers to implement diagnostics that can seamlessly work across both single-machine local development setups and real-world production cluster setups.</span></span>

## <a name="event-tracing-for-windows"></a><span data-ttu-id="e4554-109">Suivi d’événements pour Windows</span><span class="sxs-lookup"><span data-stu-id="e4554-109">Event Tracing for Windows</span></span>
<span data-ttu-id="e4554-110">[Suivi d'événements pour Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW) est la technologie recommandée pour le suivi des messages dans Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e4554-110">[Event Tracing for Windows](https://msdn.microsoft.com/library/windows/desktop/bb968803.aspx) (ETW) is the recommended technology for tracing messages in Service Fabric.</span></span> <span data-ttu-id="e4554-111">Voici quelques avantages liés à l’utilisation d’ETW :</span><span class="sxs-lookup"><span data-stu-id="e4554-111">Some benefits of using ETW are:</span></span>

* <span data-ttu-id="e4554-112">**ETW est rapide.**</span><span class="sxs-lookup"><span data-stu-id="e4554-112">**ETW is fast.**</span></span> <span data-ttu-id="e4554-113">Il a été créé en tant que technologie de suivi avec un impact minimal sur le temps d’exécution du code.</span><span class="sxs-lookup"><span data-stu-id="e4554-113">It was built as a tracing technology that has minimal impact on code execution times.</span></span>
* <span data-ttu-id="e4554-114">**Le suivi ETW fonctionne parfaitement dans des environnements de développement local ainsi que dans les configurations de cluster réel.**</span><span class="sxs-lookup"><span data-stu-id="e4554-114">**ETW tracing works seamlessly across local development environments and also real-world cluster setups.**</span></span> <span data-ttu-id="e4554-115">Cela signifie que vous n’êtes pas obligé de réécrire votre code de suivi quand vous êtes prêt à déployer votre code dans un cluster réel.</span><span class="sxs-lookup"><span data-stu-id="e4554-115">This  means you don't have to rewrite your tracing code when you are ready to deploy your code to a real cluster.</span></span>
* <span data-ttu-id="e4554-116">**Le code système de Service Fabric utilise également ETW pour le suivi interne.**</span><span class="sxs-lookup"><span data-stu-id="e4554-116">**Service Fabric system code also uses ETW for internal tracing.**</span></span> <span data-ttu-id="e4554-117">Vous pouvez ainsi afficher les traces de votre application entrelacées avec celles du système Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e4554-117">This allows you to view your application traces interleaved with Service Fabric system traces.</span></span> <span data-ttu-id="e4554-118">Vous pouvez également comprendre plus facilement les séquences et les relations entre votre code d’application et les événements du système sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="e4554-118">It also helps you to more easily understand the sequences and interrelationships between your application code and events in the underlying system.</span></span>
* <span data-ttu-id="e4554-119">**Les outils Visual Studio de Service Fabric prennent en charge l'affichage des événements ETW.**</span><span class="sxs-lookup"><span data-stu-id="e4554-119">**There is built-in support in Service Fabric Visual Studio tools to view ETW events.**</span></span> <span data-ttu-id="e4554-120">Les événements ETW apparaissent dans l’affichage des événements de diagnostic de Visual Studio une fois que Visual Studio est correctement configuré avec Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e4554-120">ETW events appear in the Diagnostic Events view of Visual Studio once Visual Studio is correctly configured with Service Fabric.</span></span> 

## <a name="view-service-fabric-system-events-in-visual-studio"></a><span data-ttu-id="e4554-121">Afficher les événements système de Service Fabric dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="e4554-121">View Service Fabric system events in Visual Studio</span></span>
<span data-ttu-id="e4554-122">Service Fabric émet des événements ETW pour aider les développeurs d’applications à comprendre ce qui se passe dans la plateforme.</span><span class="sxs-lookup"><span data-stu-id="e4554-122">Service Fabric emits ETW events to help application developers understand what's happening in the platform.</span></span> <span data-ttu-id="e4554-123">Si ce n’est pas déjà fait, continuez en suivant les étapes décrites dans [Création de votre première application dans Visual Studio](service-fabric-create-your-first-application-in-visual-studio.md).</span><span class="sxs-lookup"><span data-stu-id="e4554-123">If you haven't already done so, go ahead and follow the steps in [Creating your first application in Visual Studio](service-fabric-create-your-first-application-in-visual-studio.md).</span></span> <span data-ttu-id="e4554-124">Ces informations vous permettront de créer une application opérationnelle tout en observant les messages de trace dans la visionneuse d’événements de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="e4554-124">This information will help you get an application up and running with the Diagnostics Events Viewer showing the trace messages.</span></span>

1. <span data-ttu-id="e4554-125">Si la fenêtre des événements de diagnostics ne s’affiche pas automatiquement, accédez à l’onglet **Affichage** dans Visual Studio, puis choisissez **Autres fenêtres** et **Visionneuse d’événements de diagnostics**.</span><span class="sxs-lookup"><span data-stu-id="e4554-125">If the diagnostics events window does not automatically show, Go to the **View** tab in Visual Studio, choose **Other Windows** and then **Diagnostic Events Viewer**.</span></span>
2. <span data-ttu-id="e4554-126">Chaque événement comporte des informations de métadonnées standard qui vous indiquent le nœud, l’application et le service d’où il provient.</span><span class="sxs-lookup"><span data-stu-id="e4554-126">Each event has standard metadata information that tells you the node, application and service the event is coming from.</span></span> <span data-ttu-id="e4554-127">Vous pouvez également filtrer la liste des événements à l’aide de la zone **Filtrer les événements** située en haut de la fenêtre Événements.</span><span class="sxs-lookup"><span data-stu-id="e4554-127">You can also filter the list of events by using the **Filter events** box at the top of the events window.</span></span> <span data-ttu-id="e4554-128">Par exemple, vous pouvez filtrer sur **Nom du nœud** ou **Nom du service**.</span><span class="sxs-lookup"><span data-stu-id="e4554-128">For example, you can filter on **Node Name** or **Service Name.**</span></span> <span data-ttu-id="e4554-129">Lorsque vous examinez les détails d’un événement, vous pouvez également mettre en pause à l’aide du bouton **Pause** en haut de la fenêtre Événements et reprendre plus tard sans perte d’événements.</span><span class="sxs-lookup"><span data-stu-id="e4554-129">And when you're looking at event details, you can also pause by using the **Pause** button at the top of the events window and resume later without any loss of events.</span></span>
   
   ![Observateur d'événements de diagnostic de Visual Studio](./media/service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally/DiagEventsExamples2.png)

## <a name="add-your-own-custom-traces-to-the-application-code"></a><span data-ttu-id="e4554-131">Ajouter vos propres traces personnalisées au code d'application</span><span class="sxs-lookup"><span data-stu-id="e4554-131">Add your own custom traces to the application code</span></span>
<span data-ttu-id="e4554-132">Les modèles de projet Visual Studio de Service Fabric contiennent des exemples de code.</span><span class="sxs-lookup"><span data-stu-id="e4554-132">The Service Fabric Visual Studio project templates contain sample code.</span></span> <span data-ttu-id="e4554-133">Le code indique comment ajouter les traces ETW de code d’application personnalisé qui s’affichent dans la visionneuse ETW de Visual Studio avec les traces système de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="e4554-133">The code shows how to add custom application code ETW traces that show up in the Visual Studio ETW viewer alongside system traces from Service Fabric.</span></span> <span data-ttu-id="e4554-134">L’avantage de cette méthode est que les métadonnées sont automatiquement ajoutées aux traces et la visionneuse d’événements de diagnostics de Visual Studio est déjà configurée pour les afficher.</span><span class="sxs-lookup"><span data-stu-id="e4554-134">The advantage of this method is that metadata is automatically added to traces, and the Visual Studio Diagnostic Events Viewer is already configured to display them.</span></span>

<span data-ttu-id="e4554-135">Pour les projets créés à partir des **modèles de service** (sans état ou avec état), cherchez l’implémentation `RunAsync` :</span><span class="sxs-lookup"><span data-stu-id="e4554-135">For projects created from the **service templates** (stateless or stateful) just search for the `RunAsync` implementation:</span></span>

1. <span data-ttu-id="e4554-136">L’appel de `ServiceEventSource.Current.ServiceMessage` in the `RunAsync` est un exemple de suivi ETW personnalisé à partir du code d’application.</span><span class="sxs-lookup"><span data-stu-id="e4554-136">The call to `ServiceEventSource.Current.ServiceMessage` in the `RunAsync` method shows an example of a custom ETW trace from the application code.</span></span>
2. <span data-ttu-id="e4554-137">Dans le fichier **ServiceEventSource.cs**, vous trouverez une surcharge pour la méthode `ServiceEventSource.ServiceMessage` devant être utilisée pour les événements de haute fréquence pour une question de performances.</span><span class="sxs-lookup"><span data-stu-id="e4554-137">In the **ServiceEventSource.cs** file, you will find an overload for the `ServiceEventSource.ServiceMessage` method that should be used for high-frequency events due to performance reasons.</span></span>

<span data-ttu-id="e4554-138">Pour les projets créés à partir des **modèles d'acteur** (sans état ou avec état) :</span><span class="sxs-lookup"><span data-stu-id="e4554-138">For projects created from the **actor templates** (stateless or stateful):</span></span>

1. <span data-ttu-id="e4554-139">Ouvrez le fichier **« Nom_projet ».cs** où *Nom_projet* est le nom que vous avez choisi pour votre projet Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e4554-139">Open the **"ProjectName".cs** file where *ProjectName* is the name you chose for your Visual Studio project.</span></span>  
2. <span data-ttu-id="e4554-140">Recherchez le code `ActorEventSource.Current.ActorMessage(this, "Doing Work");` dans la méthode *DoWorkAsync* .</span><span class="sxs-lookup"><span data-stu-id="e4554-140">Find the code `ActorEventSource.Current.ActorMessage(this, "Doing Work");` in the *DoWorkAsync* method.</span></span>  <span data-ttu-id="e4554-141">Il s'agit d'un exemple de suivi écrit ETW personnalisé à partir du code d'application.</span><span class="sxs-lookup"><span data-stu-id="e4554-141">This is an example of a custom ETW trace written from application code.</span></span>  
3. <span data-ttu-id="e4554-142">Dans le fichier **ActorEventSource.cs**, vous trouverez une surcharge pour la méthode `ActorEventSource.ActorMessage` devant être utilisée pour les événements de haute fréquence pour une question de performances.</span><span class="sxs-lookup"><span data-stu-id="e4554-142">In file **ActorEventSource.cs**, you will find an overload for the `ActorEventSource.ActorMessage` method that should be used for high-frequency events due to performance reasons.</span></span>

<span data-ttu-id="e4554-143">Après avoir ajouté le suivi ETW personnalisé à votre code de service, vous pouvez générer, déployer et réexécuter l’application pour afficher vos événements dans la visionneuse d’événements de diagnostics.</span><span class="sxs-lookup"><span data-stu-id="e4554-143">After adding custom ETW tracing to your service code, you can build, deploy, and run the application again to see your event(s) in the Diagnostic Events Viewer.</span></span> <span data-ttu-id="e4554-144">Si vous déboguez l’application en appuyant sur **F5**, la visionneuse d’événements de diagnostics s’ouvre automatiquement.</span><span class="sxs-lookup"><span data-stu-id="e4554-144">If you debug the application with **F5**, the Diagnostic Events Viewer will open automatically.</span></span>

## <a name="next-steps"></a><span data-ttu-id="e4554-145">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="e4554-145">Next steps</span></span>
<span data-ttu-id="e4554-146">Le code de traçage que vous avez ajouté à votre application ci-dessus pour le diagnostic local fonctionnera avec les outils que vous pouvez utiliser pour afficher ces événements lors de l’exécution de votre application sur un cluster Azure.</span><span class="sxs-lookup"><span data-stu-id="e4554-146">The same tracing code that you added to your application above for local diagnostics will work with tools that you can use to view these events when running your application on an Azure cluster.</span></span> <span data-ttu-id="e4554-147">Consultez ces articles qui traitent des différentes options pour les outils et décrivent comment vous pouvez les configurer.</span><span class="sxs-lookup"><span data-stu-id="e4554-147">Check out these articles that discuss the different options for the tools and describe how you can set them up.</span></span>

* [<span data-ttu-id="e4554-148">Collecte des journaux avec Azure Diagnostics</span><span class="sxs-lookup"><span data-stu-id="e4554-148">How to collect logs with Azure Diagnostics</span></span>](service-fabric-diagnostics-how-to-setup-wad.md)
* [<span data-ttu-id="e4554-149">Agrégation et collection d’événements avec EventFlow</span><span class="sxs-lookup"><span data-stu-id="e4554-149">Event aggregation and collection using EventFlow</span></span>](service-fabric-diagnostics-event-aggregation-eventflow.md)

