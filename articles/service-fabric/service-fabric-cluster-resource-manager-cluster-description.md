---
title: aaaCluster Description du Gestionnaire de ressources Cluster | Documents Microsoft
description: "Qui décrit un cluster Service Fabric en spécifiant les domaines d’erreur, mettre à niveau des domaines, propriétés de nœud et les capacités de nœud pour hello Gestionnaire de ressources du Cluster."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 55f8ab37-9399-4c9a-9e6c-d2d859de6766
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: f2822075976bd54402af5ad56991b5b360dfb1d8
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="describing-a-service-fabric-cluster"></a><span data-ttu-id="342f9-103">Description d’un cluster Service Fabric</span><span class="sxs-lookup"><span data-stu-id="342f9-103">Describing a service fabric cluster</span></span>
<span data-ttu-id="342f9-104">Hello, Gestionnaire de ressources du Cluster Service Fabric fournit plusieurs mécanismes pour la description d’un cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-104">hello Service Fabric Cluster Resource Manager provides several mechanisms for describing a cluster.</span></span> <span data-ttu-id="342f9-105">Pendant l’exécution, hello Gestionnaire du Cluster de ressource utilise cette information tooensure haute disponibilité des services hello en cours d’exécution dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-105">During runtime, hello Cluster Resource Manager uses this information tooensure high availability of hello services running in hello cluster.</span></span> <span data-ttu-id="342f9-106">Lors de l’application de ces règles importants, il tente également de la consommation des ressources toooptimize hello au sein du cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-106">While enforcing these important rules, it also attempts toooptimize hello resource consumption within hello cluster.</span></span>

## <a name="key-concepts"></a><span data-ttu-id="342f9-107">Concepts clés</span><span class="sxs-lookup"><span data-stu-id="342f9-107">Key concepts</span></span>
<span data-ttu-id="342f9-108">Hello, Gestionnaire de ressources de Cluster prend en charge plusieurs fonctionnalités qui décrivent un cluster :</span><span class="sxs-lookup"><span data-stu-id="342f9-108">hello Cluster Resource Manager supports several features that describe a cluster:</span></span>

* <span data-ttu-id="342f9-109">Domaines d'erreur</span><span class="sxs-lookup"><span data-stu-id="342f9-109">Fault Domains</span></span>
* <span data-ttu-id="342f9-110">Domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="342f9-110">Upgrade Domains</span></span>
* <span data-ttu-id="342f9-111">Propriétés du nœud</span><span class="sxs-lookup"><span data-stu-id="342f9-111">Node Properties</span></span>
* <span data-ttu-id="342f9-112">Capacités du nœud</span><span class="sxs-lookup"><span data-stu-id="342f9-112">Node Capacities</span></span>

## <a name="fault-domains"></a><span data-ttu-id="342f9-113">Domaines d'erreur</span><span class="sxs-lookup"><span data-stu-id="342f9-113">Fault domains</span></span>
<span data-ttu-id="342f9-114">Un domaine d’erreur est une zone d’échec coordonné.</span><span class="sxs-lookup"><span data-stu-id="342f9-114">A Fault Domain is any area of coordinated failure.</span></span> <span data-ttu-id="342f9-115">Un seul ordinateur est un domaine d’erreur (dans la mesure où il peut échouer sur son propre pour diverses raisons, à partir de l’alimentation approvisionnement échecs toodrive échecs toobad NIC du microprogramme).</span><span class="sxs-lookup"><span data-stu-id="342f9-115">A single machine is a Fault Domain (since it can fail on its own for various reasons, from power supply failures toodrive failures toobad NIC firmware).</span></span> <span data-ttu-id="342f9-116">Machines toohello connecté même commutateur Ethernet sont dans hello même domaine par défaut, comme sont des ordinateurs qui partagent une seule source d’alimentation ou à un emplacement unique.</span><span class="sxs-lookup"><span data-stu-id="342f9-116">Machines connected toohello same Ethernet switch are in hello same Fault Domain, as are machines sharing a single source of power or in a single location.</span></span> <span data-ttu-id="342f9-117">Dans la mesure où il est naturel pour toooverlap des erreurs matérielles, les domaines d’erreur sont par nature hiérarchiques et sont représentées sous la forme d’URI dans l’infrastructure de Service.</span><span class="sxs-lookup"><span data-stu-id="342f9-117">Since it's natural for hardware faults toooverlap, Fault Domains are inherently hierarchal and are represented as URIs in Service Fabric.</span></span>

<span data-ttu-id="342f9-118">Il est important que les domaines d’erreur sont définies correctement, car le Service Fabric utilise cette toosafely place les services.</span><span class="sxs-lookup"><span data-stu-id="342f9-118">It is important that Fault Domains are set up correctly since Service Fabric uses this information toosafely place services.</span></span> <span data-ttu-id="342f9-119">Service Fabric ne veut pas tooplace services tels que la perte hello d’un domaine d’erreur (causée par une défaillance hello d’un composant) provoque une toogo service vers le bas.</span><span class="sxs-lookup"><span data-stu-id="342f9-119">Service Fabric doesn't want tooplace services such that hello loss of a Fault Domain (caused by hello failure of some component) causes a service toogo down.</span></span> <span data-ttu-id="342f9-120">Bonjour environnement Azure Service Fabric utilise les informations de domaine d’erreur de hello fournies par hello environnement toocorrectly configurer nœuds hello dans un cluster de hello en votre nom.</span><span class="sxs-lookup"><span data-stu-id="342f9-120">In hello Azure environment Service Fabric uses hello Fault Domain information provided by hello environment toocorrectly configure hello nodes in hello cluster on your behalf.</span></span> <span data-ttu-id="342f9-121">L’infrastructure de Service autonome, les domaines d’erreur sont définis au moment de hello ce cluster hello est configuré</span><span class="sxs-lookup"><span data-stu-id="342f9-121">For Service Fabric Standalone, Fault Domains are defined at hello time that hello cluster is set up</span></span> 

> [!WARNING]
> <span data-ttu-id="342f9-122">Il est important que les informations de domaine d’erreur hello fourni tooService Fabric est exacte.</span><span class="sxs-lookup"><span data-stu-id="342f9-122">It is important that hello Fault Domain information provided tooService Fabric is accurate.</span></span> <span data-ttu-id="342f9-123">Par exemple, supposons que les nœuds de votre cluster Service Fabric s’exécutent à l’intérieur de 10 machines virtuelles, s’exécutant sur cinq hôtes physiques.</span><span class="sxs-lookup"><span data-stu-id="342f9-123">For example, let's say that your Service Fabric cluster's nodes are running inside 10 virtual machines, running on five physical hosts.</span></span> <span data-ttu-id="342f9-124">Dans ce cas, même s’il y a 10 ordinateurs virtuels, il y a seulement 5 domaines d’erreur (de niveau supérieur) différents.</span><span class="sxs-lookup"><span data-stu-id="342f9-124">In this case, even though there are 10 virtual machines, there's only 5 different (top level) fault domains.</span></span> <span data-ttu-id="342f9-125">Partage hello même hôte physique provoque tooshare de machines virtuelles hello même domaine racine par défaut, étant donné que hello expérience des machines virtuelles coordonnée échec en cas de leur hôte physique.</span><span class="sxs-lookup"><span data-stu-id="342f9-125">Sharing hello same physical host causes VMs tooshare hello same root fault domain, since hello VMs experience coordinated failure if their physical host fails.</span></span>  
>
> <span data-ttu-id="342f9-126">Étant donné que le Service Fabric attend hello domaine par défaut d’un nœud toochange pas.</span><span class="sxs-lookup"><span data-stu-id="342f9-126">Since Service Fabric expects hello Fault Domain of a node not toochange.</span></span> <span data-ttu-id="342f9-127">Autres mécanismes de garantir la haute disponibilité de hello machines virtuelles, telles que [machines virtuelles de la haute disponibilité](https://technet.microsoft.com/en-us/library/cc967323.aspx), utilisez la migration transparente des ordinateurs virtuels à partir d’un ordinateur hôte tooanother.</span><span class="sxs-lookup"><span data-stu-id="342f9-127">Other mechanisms of ensuring high availability of hello VMs, such as [HA-VMs](https://technet.microsoft.com/en-us/library/cc967323.aspx), use transparent migration of VMs from one host tooanother.</span></span> <span data-ttu-id="342f9-128">Ces mécanismes de ne pas reconfigurer ou notifier hello code à l’intérieur de hello machine virtuelle en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="342f9-128">These mechanisms do not reconfigure or notify hello running code inside hello VM.</span></span> <span data-ttu-id="342f9-129">À ce titre, ils ne sont **pas prises en charge** en tant qu’environnements d’exécution de clusters Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="342f9-129">As such, they are **not supported** as environments for running Service Fabric clusters.</span></span> <span data-ttu-id="342f9-130">Service Fabric doit être la technologie de haute disponibilité uniquement hello utilisée.</span><span class="sxs-lookup"><span data-stu-id="342f9-130">Service Fabric should be hello only high-availability technology employed.</span></span> <span data-ttu-id="342f9-131">La migration dynamique de machines virtuelles, les SAN et autres mécanismes ne sont pas nécessaires.</span><span class="sxs-lookup"><span data-stu-id="342f9-131">Mechanisms like live VM migration, SANs, or others are not necessary.</span></span> <span data-ttu-id="342f9-132">S’ils sont utilisés avec Service Fabric, ces mécanismes _réduisent_ la disponibilité et la fiabilité des applications, car ils introduisent une complexité supplémentaire, ajoutent des sources centralisées de défaillance et utilisent des stratégies de fiabilité et de disponibilité qui sont en conflit avec celles de Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="342f9-132">If used in conjunction with Service Fabric, these mechanisms _reduce_ application availability and reliability because they introduce additional complexity, add centralized sources of failure, and utilize reliability and availability strategies that conflict with those in Service Fabric.</span></span> 
>
>

<span data-ttu-id="342f9-133">Dans le graphique de hello ci-dessous nous couleur toutes les entités hello qui contribuent tooFault domaines et liste que tous les hello différents domaines d’erreur résultant.</span><span class="sxs-lookup"><span data-stu-id="342f9-133">In hello graphic below we color all hello entities that contribute tooFault Domains and list all hello different Fault Domains that result.</span></span> <span data-ttu-id="342f9-134">Dans cet exemple, nous avons des centres de données (« DC »), des racks (« R ») et des panneaux (« B »).</span><span class="sxs-lookup"><span data-stu-id="342f9-134">In this example, we have datacenters ("DC"), racks ("R"), and blades ("B").</span></span> <span data-ttu-id="342f9-135">En théorie, si chaque panneau conserve plus d’un ordinateur virtuel, il peut être une autre couche Bonjour hiérarchie du domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-135">Conceivably, if each blade holds more than one virtual machine, there could be another layer in hello Fault Domain hierarchy.</span></span>

<span data-ttu-id="342f9-136"><center>
![Nœuds organisés par domaines d’erreur][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-136"><center>
![Nodes organized via Fault Domains][Image1]
</center></span></span>

<span data-ttu-id="342f9-137">Pendant l’exécution, hello Gestionnaire de ressources du Cluster Service Fabric considère que les domaines d’erreur hello dans un cluster de hello et modes de dispositions.</span><span class="sxs-lookup"><span data-stu-id="342f9-137">During runtime, hello Service Fabric Cluster Resource Manager considers hello Fault Domains in hello cluster and plans layouts.</span></span> <span data-ttu-id="342f9-138">Hello réplicas avec état ou sans état instances pour un service donné sont distribués afin qu’ils soient dans des domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-138">hello stateful replicas or stateless instances for a given service are distributed so they are in separate Fault Domains.</span></span> <span data-ttu-id="342f9-139">Distribution de service de hello entre domaines d’erreur garantit une disponibilité hello du service de hello n’est pas compromise en cas d’échec d’un domaine d’erreur à n’importe quel niveau de hiérarchie de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-139">Distributing hello service across fault domains ensures hello availability of hello service is not compromised when a Fault Domain fails at any level of hello hierarchy.</span></span>

<span data-ttu-id="342f9-140">Gestionnaire de ressources de Cluster du service Fabric ne tient pas compte le nombre de couches existe dans hello hiérarchie du domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-140">Service Fabric’s Cluster Resource Manager doesn’t care how many layers there are in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="342f9-141">Toutefois, il essaie de tooensure perte hello de toute une partie de la hiérarchie de hello n’affecte pas les services en cours d’exécution qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="342f9-141">However, it tries tooensure that hello loss of any one portion of hello hierarchy doesn’t impact services running in it.</span></span> 

<span data-ttu-id="342f9-142">Il est préférable de s’il n’y hello même nombre de nœuds à chaque niveau de profondeur Bonjour hiérarchie du domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-142">It is best if there are hello same number of nodes at each level of depth in hello Fault Domain hierarchy.</span></span> <span data-ttu-id="342f9-143">Si hello « arborescence » de domaines d’erreur est déséquilibrée dans votre cluster, il rend plus difficile pour hello toofigure Gestionnaire de ressources de Cluster à l’allocation de meilleures hello de services.</span><span class="sxs-lookup"><span data-stu-id="342f9-143">If hello “tree” of Fault Domains is unbalanced in your cluster, it makes it harder for hello Cluster Resource Manager toofigure out hello best allocation of services.</span></span> <span data-ttu-id="342f9-144">Déséquilibré mises en page de domaines d’erreur par cette perte de hello de certains domaines de disponibilité de hello impact de services plus que les autres domaines.</span><span class="sxs-lookup"><span data-stu-id="342f9-144">Imbalanced Fault Domains layouts mean that hello loss of some domains impact hello availability of services more than other domains.</span></span> <span data-ttu-id="342f9-145">Par conséquent, hello Gestionnaire de ressources du Cluster est détruite entre deux objectifs : il veut machines de hello toouse dans ce domaine « heavy » en plaçant des services sur les, et il tooplace des services dans d’autres domaines afin qu’une perte de hello d’un domaine n’entraîne aucun problème.</span><span class="sxs-lookup"><span data-stu-id="342f9-145">As a result, hello Cluster Resource Manager is torn between two goals: It wants toouse hello machines in that “heavy” domain by placing services on them, and it wants tooplace services in other domains so that hello loss of a domain doesn’t cause problems.</span></span> 

<span data-ttu-id="342f9-146">À quoi ressemblent des domaines déséquilibrés ?</span><span class="sxs-lookup"><span data-stu-id="342f9-146">What do imbalanced domains look like?</span></span> <span data-ttu-id="342f9-147">Dans le diagramme hello ci-dessous, nous affichons deux dispositions de cluster différent.</span><span class="sxs-lookup"><span data-stu-id="342f9-147">In hello diagram below, we show two different cluster layouts.</span></span> <span data-ttu-id="342f9-148">Dans le premier exemple de hello, les nœuds de hello sont répartis uniformément entre hello domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-148">In hello first example, hello nodes are distributed evenly across hello Fault Domains.</span></span> <span data-ttu-id="342f9-149">Dans le deuxième exemple de hello, un domaine d’erreur a bien plus de noeuds hello autres domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-149">In hello second example, one Fault Domain has many more nodes than hello other Fault Domains.</span></span> 

<span data-ttu-id="342f9-150"><center>
![Deux dispositions de cluster différentes][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-150"><center>
![Two different cluster layouts][Image2]
</center></span></span>

<span data-ttu-id="342f9-151">Dans Azure, le choix de hello dont domaine d’erreur contient un nœud est gérée pour vous.</span><span class="sxs-lookup"><span data-stu-id="342f9-151">In Azure, hello choice of which Fault Domain contains a node is managed for you.</span></span> <span data-ttu-id="342f9-152">Toutefois, en fonction du nombre de hello de nœuds que vous préparez vous pouvez toujours se retrouver avec des domaines d’erreur avec plus de noeuds dans les autres.</span><span class="sxs-lookup"><span data-stu-id="342f9-152">However, depending on hello number of nodes that you provision you can still end up with Fault Domains with more nodes in them than others.</span></span> <span data-ttu-id="342f9-153">Par exemple, vous avez cinq domaines d’erreur dans le cluster de hello mais configurez sept nœuds pour un type donné.</span><span class="sxs-lookup"><span data-stu-id="342f9-153">For example, say you have five Fault Domains in hello cluster but provision seven nodes for a given NodeType.</span></span> <span data-ttu-id="342f9-154">Dans ce cas, hello tout d’abord deux domaines d’erreur vous retrouver avec plusieurs nœuds.</span><span class="sxs-lookup"><span data-stu-id="342f9-154">In this case, hello first two Fault Domains end up with more nodes.</span></span> <span data-ttu-id="342f9-155">Si vous continuez à toodeploy plus NodeTypes avec seulement quelques instances, hello problème s’aggrave.</span><span class="sxs-lookup"><span data-stu-id="342f9-155">If you continue toodeploy more NodeTypes with only a couple instances, hello problem gets worse.</span></span> <span data-ttu-id="342f9-156">Pour cette raison, qu'il est recommandé que hello nombre de nœuds dans chaque type de nœud est un multiple de nombre hello de domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-156">For this reason it's recommended that hello number of nodes in each node type is a multiple of hello number of Fault Domains.</span></span>

## <a name="upgrade-domains"></a><span data-ttu-id="342f9-157">Domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="342f9-157">Upgrade domains</span></span>
<span data-ttu-id="342f9-158">Domaines de mise à niveau sont une autre fonctionnalité qui permet de hello du Gestionnaire de ressources du Cluster Service Fabric comprendre disposition hello du cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-158">Upgrade Domains are another feature that helps hello Service Fabric Cluster Resource Manager understand hello layout of hello cluster.</span></span> <span data-ttu-id="342f9-159">Mise à niveau des domaines définissent des jeux de nœuds qui sont mis à niveau en hello même temps.</span><span class="sxs-lookup"><span data-stu-id="342f9-159">Upgrade Domains define sets of nodes that are upgraded at hello same time.</span></span> <span data-ttu-id="342f9-160">Mettre à niveau des domaines aide hello Gestionnaire de ressources du Cluster de comprendre et orchestrer les opérations de gestion telles que des mises à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-160">Upgrade Domains help hello Cluster Resource Manager understand and orchestrate management operations like upgrades.</span></span>

<span data-ttu-id="342f9-161">Les domaines de mise à niveau sont très semblables aux domaines d’erreur, avec cependant quelques différences clés.</span><span class="sxs-lookup"><span data-stu-id="342f9-161">Upgrade Domains are a lot like Fault Domains, but with a couple key differences.</span></span> <span data-ttu-id="342f9-162">Tout d’abord, les zones de défaillances matérielles coordonnées définissent les domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-162">First, areas of coordinated hardware failures define Fault Domains.</span></span> <span data-ttu-id="342f9-163">Mise à niveau des domaines relatifs hello d’autre part, sont définis par la stratégie.</span><span class="sxs-lookup"><span data-stu-id="342f9-163">Upgrade Domains, on hello other hand, are defined by policy.</span></span> <span data-ttu-id="342f9-164">Vous obtenez toodecide combien vous voulez que, au lieu d’il dictée par l’environnement de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-164">You get toodecide how many you want, rather than it being dictated by hello environment.</span></span> <span data-ttu-id="342f9-165">Vous pouvez disposer d’autant de domaines mise à niveau que de nœuds.</span><span class="sxs-lookup"><span data-stu-id="342f9-165">You could have as many Upgrade Domains as you do nodes.</span></span> <span data-ttu-id="342f9-166">Une autre différence entre les domaines d’erreur et les domaines de mise à niveau est que les domaines de mise à niveau ne sont pas hiérarchiques.</span><span class="sxs-lookup"><span data-stu-id="342f9-166">Another difference between Fault Domains and Upgrade Domains is that Upgrade Domains are not hierarchical.</span></span> <span data-ttu-id="342f9-167">En effet, ils s’apparentent plus à une balise simple.</span><span class="sxs-lookup"><span data-stu-id="342f9-167">Instead, they are more like a simple tag.</span></span> 

<span data-ttu-id="342f9-168">Hello diagramme suivant illustre trois que domaines de mise à niveau sont réparties sur trois domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-168">hello following diagram shows three Upgrade Domains are striped across three Fault Domains.</span></span> <span data-ttu-id="342f9-169">Il montre également un emplacement possible pour trois réplicas différents d’un service avec état, où chaque réplica est attribué à des domaines d’erreur et de mise à niveau différents.</span><span class="sxs-lookup"><span data-stu-id="342f9-169">It also shows one possible placement for three different replicas of a stateful service, where each ends up in different Fault and Upgrade Domains.</span></span> <span data-ttu-id="342f9-170">Cet emplacement permet la perte de hello d’un domaine d’erreur en milieu de hello d’une mise à niveau de service et toujours avoir une copie de données et le code de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-170">This placement allows hello loss of a Fault Domain while in hello middle of a service upgrade and still have one copy of hello code and data.</span></span>  

<span data-ttu-id="342f9-171"><center>
![Positionnement avec des domaines d’erreur et de mise à niveau][Image3]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-171"><center>
![Placement With Fault and Upgrade Domains][Image3]
</center></span></span>

<span data-ttu-id="342f9-172">Il existe des avantages et inconvénients toohaving grand nombre de domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-172">There are pros and cons toohaving large numbers of Upgrade Domains.</span></span> <span data-ttu-id="342f9-173">Mettre à niveau vos domaines signifie que chaque étape de mise à niveau hello est plus précis et affecte donc un plus petit nombre de nœuds ou des services.</span><span class="sxs-lookup"><span data-stu-id="342f9-173">More Upgrade Domains means each step of hello upgrade is more granular and therefore affects a smaller number of nodes or services.</span></span> <span data-ttu-id="342f9-174">Par conséquent, moins de services ont à la fois, des toomove présentation moins de l’évolution du système de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-174">As a result, fewer services have toomove at a time, introducing less churn into hello system.</span></span> <span data-ttu-id="342f9-175">Cela a tendance tooimprove fiabilité, étant donné que moins de service de hello est affectée par n’importe quel problème introduit pendant la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-175">This tends tooimprove reliability, since less of hello service is impacted by any issue introduced during hello upgrade.</span></span> <span data-ttu-id="342f9-176">Mettre à niveau vos domaines signifie également que vous avez besoin de moins de mémoire tampon disponible autres nœuds toohandle hello l’impact de hello mettre à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-176">More Upgrade Domains also means that you need less available buffer on other nodes toohandle hello impact of hello upgrade.</span></span> <span data-ttu-id="342f9-177">Par exemple, si vous avez cinq domaines de mise à niveau, nœuds hello dans chaque sont gère environ 20 % de votre trafic.</span><span class="sxs-lookup"><span data-stu-id="342f9-177">For example, if you have five Upgrade Domains, hello nodes in each are handling roughly 20% of your traffic.</span></span> <span data-ttu-id="342f9-178">Si vous devez tootake ce domaine de mise à niveau vers le bas pour une mise à niveau, cette charge doit généralement toogo quelque part.</span><span class="sxs-lookup"><span data-stu-id="342f9-178">If you need tootake down that Upgrade Domain for an upgrade, that load usually needs toogo somewhere.</span></span> <span data-ttu-id="342f9-179">Étant donné que vous avez quatre domaines restants de mise à niveau, chacun doit avoir la salle d’environ 5 % de total du trafic hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-179">Since you have four remaining Upgrade Domains, each must have room for about 5% of hello total traffic.</span></span> <span data-ttu-id="342f9-180">Plusieurs domaines de mise à niveau implique moins mémoire tampon sur les nœuds hello dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-180">More Upgrade Domains means you need less buffer on hello nodes in hello cluster.</span></span> <span data-ttu-id="342f9-181">Par exemple, imaginons que vous disposez de 10 domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-181">For example, consider if you had 10 Upgrade Domains instead.</span></span> <span data-ttu-id="342f9-182">Dans ce cas, chaque UD serait uniquement gérer environ 10 % du total du trafic hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-182">In that case, each UD would only be handling about 10% of hello total traffic.</span></span> <span data-ttu-id="342f9-183">Lorsqu’une mise à niveau parcourt les cluster hello, chaque domaine suffit salle toohave 1.1 % environ de total du trafic hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-183">When an upgrade steps through hello cluster, each domain would only need toohave room for about 1.1% of hello total traffic.</span></span> <span data-ttu-id="342f9-184">Mettre à niveau vos domaines qui vous permettent généralement toorun vos nœuds à une utilisation plus importante, étant donné que vous avez besoin d’une capacité inférieure réservée.</span><span class="sxs-lookup"><span data-stu-id="342f9-184">More Upgrade Domains generally allow you toorun your nodes at higher utilization, since you need less reserved capacity.</span></span> <span data-ttu-id="342f9-185">Hello même a la valeur true pour les domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-185">hello same is true for Fault Domains.</span></span>  

<span data-ttu-id="342f9-186">inconvénient Hello d’avoir plusieurs domaines de mise à niveau est que les mises à niveau ont tendance à tootake plus de temps.</span><span class="sxs-lookup"><span data-stu-id="342f9-186">hello downside of having many Upgrade Domains is that upgrades tend tootake longer.</span></span> <span data-ttu-id="342f9-187">Service Fabric attend pendant une courte période de temps après qu’une mise à niveau de domaine est terminé et effectue des vérifications avant le début tooupgrade hello suivant.</span><span class="sxs-lookup"><span data-stu-id="342f9-187">Service Fabric waits a short period of time after an Upgrade Domain is completed and performs checks before starting tooupgrade hello next one.</span></span> <span data-ttu-id="342f9-188">Ces délais activer la détection de problèmes introduits par la mise à niveau hello avant le démarrage de la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-188">These delays enable detecting issues introduced by hello upgrade before hello upgrade proceeds.</span></span> <span data-ttu-id="342f9-189">compromis de Hello est acceptable, car il empêche les modifications incorrectes d’affecter trop de service de hello à la fois.</span><span class="sxs-lookup"><span data-stu-id="342f9-189">hello tradeoff is acceptable because it prevents bad changes from affecting too much of hello service at a time.</span></span>

<span data-ttu-id="342f9-190">Un nombre insuffisant de domaines de mise à niveau a de nombreux effets secondaires négatifs : quand chaque domaine de mise à niveau est hors service au cours d’une mise à niveau, une grande partie de votre capacité globale n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="342f9-190">Too few Upgrade Domains has many negative side effects – while each individual Upgrade Domain is down and being upgraded a large portion of your overall capacity is unavailable.</span></span> <span data-ttu-id="342f9-191">Par exemple, si vous avez seulement trois domaines de mise à niveau, vous vous défaites d’environ 1/3 de votre service global ou de votre capacité de cluster à la fois.</span><span class="sxs-lookup"><span data-stu-id="342f9-191">For example, if you only have three Upgrade Domains you are taking down about 1/3 of your overall service or cluster capacity at a time.</span></span> <span data-ttu-id="342f9-192">Grande partie de votre service ayant à la fois vers le bas n’est pas souhaitable puisque vous avez toohave une capacité suffisante dans reste hello de votre charge de travail de cluster toohandle hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-192">Having so much of your service down at once isn’t desirable since you have toohave enough capacity in hello rest of your cluster toohandle hello workload.</span></span> <span data-ttu-id="342f9-193">En conservant cette mémoire tampon, dans des conditions normales de fonctionnement, ces nœuds subissent une moindre charge.</span><span class="sxs-lookup"><span data-stu-id="342f9-193">Maintaining that buffer means that during normal operation those nodes are less loaded than they would be otherwise.</span></span> <span data-ttu-id="342f9-194">Cela augmente le coût de hello de votre service en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="342f9-194">This increases hello cost of running your service.</span></span>

<span data-ttu-id="342f9-195">Il n’existe aucune limite réelle toohello nombre total de pannes ou les domaines de mise à niveau dans un environnement, ou des contraintes sur la façon dont elles se chevauchent.</span><span class="sxs-lookup"><span data-stu-id="342f9-195">There’s no real limit toohello total number of fault or Upgrade Domains in an environment, or constraints on how they overlap.</span></span> <span data-ttu-id="342f9-196">Ceci dit, il existe plusieurs modèles courants :</span><span class="sxs-lookup"><span data-stu-id="342f9-196">That said, there are several common patterns:</span></span>

- <span data-ttu-id="342f9-197">Correspondance parfaite des domaines d’erreur et des domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="342f9-197">Fault Domains and Upgrade Domains mapped 1:1</span></span>
- <span data-ttu-id="342f9-198">Un domaine de mise à niveau par nœud (instance de système d’exploitation physique ou virtuel)</span><span class="sxs-lookup"><span data-stu-id="342f9-198">One Upgrade Domain per Node (physical or virtual OS instance)</span></span>
- <span data-ttu-id="342f9-199">Un modèle « agrégés par bandes » ou « matrice », où les domaines d’erreur hello et mettre à niveau forment une matrice avec les ordinateurs généralement en cours d’exécution vers le bas les diagonales hello</span><span class="sxs-lookup"><span data-stu-id="342f9-199">A “striped” or “matrix” model where hello Fault Domains and Upgrade Domains form a matrix with machines usually running down hello diagonals</span></span>

<span data-ttu-id="342f9-200"><center>
![Dispositions de domaines d’erreur et de mise à niveau][Image4]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-200"><center>
![Fault and Upgrade Domain Layouts][Image4]
</center></span></span>

<span data-ttu-id="342f9-201">Il existe qu'aucune mieux ne répondre à quels toochoose de disposition, chacun possède certains avantages et inconvénients.</span><span class="sxs-lookup"><span data-stu-id="342f9-201">There’s no best answer which layout toochoose, each has some pros and cons.</span></span> <span data-ttu-id="342f9-202">Par exemple, modèle de 1FD:1UD hello est tooset simple.</span><span class="sxs-lookup"><span data-stu-id="342f9-202">For example, hello 1FD:1UD model is simple tooset up.</span></span> <span data-ttu-id="342f9-203">Hello 1 domaine de mise à niveau par le modèle de nœud est le plus telles que les personnes sont utilisés pour.</span><span class="sxs-lookup"><span data-stu-id="342f9-203">hello 1 Upgrade Domain per Node model is most like what people are used to.</span></span> <span data-ttu-id="342f9-204">Lors des mises à niveau, chaque nœud est mis à jour indépendamment.</span><span class="sxs-lookup"><span data-stu-id="342f9-204">During upgrades each node is updated independently.</span></span> <span data-ttu-id="342f9-205">Cela s’apparente toohow de petits ensembles d’ordinateurs ont été mis à niveau manuellement Bonjour passées.</span><span class="sxs-lookup"><span data-stu-id="342f9-205">This is similar toohow small sets of machines were upgraded manually in hello past.</span></span> 

<span data-ttu-id="342f9-206">modèle le plus courant Hello est la matrice de FD/UD hello, où hello groupes et domaines d’erreur forment une table et les nœuds sont placés dans hello en diagonale.</span><span class="sxs-lookup"><span data-stu-id="342f9-206">hello most common model is hello FD/UD matrix, where hello FDs and UDs form a table and nodes are placed starting along hello diagonal.</span></span> <span data-ttu-id="342f9-207">Il s’agit de modèle hello utilisé par défaut dans les clusters Service Fabric dans Azure.</span><span class="sxs-lookup"><span data-stu-id="342f9-207">This is hello model used by default in Service Fabric clusters in Azure.</span></span> <span data-ttu-id="342f9-208">Pour les clusters à plusieurs nœuds, tous les éléments se termine ressemble au modèle de matrice dense hello ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="342f9-208">For clusters with many nodes everything ends up looking like hello dense matrix pattern above.</span></span>

## <a name="fault-and-upgrade-domain-constraints-and-resulting-behavior"></a><span data-ttu-id="342f9-209">Contraintes des domaines d’erreur et de mise à niveau, et comportement résultant</span><span class="sxs-lookup"><span data-stu-id="342f9-209">Fault and Upgrade Domain constraints and resulting behavior</span></span>
<span data-ttu-id="342f9-210">Hello, Gestionnaire de ressources du Cluster traite désir hello tookeep un service équilibrée à travers les domaines d’erreur et mettre à niveau en tant que contrainte.</span><span class="sxs-lookup"><span data-stu-id="342f9-210">hello Cluster Resource Manager treats hello desire tookeep a service balanced across fault and Upgrade Domains as a constraint.</span></span> <span data-ttu-id="342f9-211">Vous trouverez plus d’informations sur les contraintes dans [cet article](service-fabric-cluster-resource-manager-management-integration.md).</span><span class="sxs-lookup"><span data-stu-id="342f9-211">You can find out more about constraints in [this article](service-fabric-cluster-resource-manager-management-integration.md).</span></span> <span data-ttu-id="342f9-212">Hello d’état de contraintes d’erreur et de mettre à niveau un domaine : « pour une partition de service donné il devrait jamais y avoir une différence *supérieur à un* nombre hello des objets de service (instances de service sans état ou des réplicas de service avec état) entre deux domaines. »</span><span class="sxs-lookup"><span data-stu-id="342f9-212">hello Fault and Upgrade Domain constraints state: "For a given service partition there should never be a difference *greater than one* in hello number of service objects (stateless service instances or stateful service replicas) between two domains."</span></span> <span data-ttu-id="342f9-213">Cela empêche certains déplacements ou organisations qui enfreignent cette contrainte.</span><span class="sxs-lookup"><span data-stu-id="342f9-213">This prevents certain moves or arrangements that violate this constraint.</span></span>

<span data-ttu-id="342f9-214">Examinons un exemple.</span><span class="sxs-lookup"><span data-stu-id="342f9-214">Let's look at one example.</span></span> <span data-ttu-id="342f9-215">Supposons que nous avons un cluster avec six nœuds, configuré avec cinq domaines d’erreur et cinq de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-215">Let's say that we have a cluster with six nodes, configured with five Fault Domains and five Upgrade Domains.</span></span>

|  | <span data-ttu-id="342f9-216">FD0</span><span class="sxs-lookup"><span data-stu-id="342f9-216">FD0</span></span> | <span data-ttu-id="342f9-217">FD1</span><span class="sxs-lookup"><span data-stu-id="342f9-217">FD1</span></span> | <span data-ttu-id="342f9-218">FD2</span><span class="sxs-lookup"><span data-stu-id="342f9-218">FD2</span></span> | <span data-ttu-id="342f9-219">FD3</span><span class="sxs-lookup"><span data-stu-id="342f9-219">FD3</span></span> | <span data-ttu-id="342f9-220">FD4</span><span class="sxs-lookup"><span data-stu-id="342f9-220">FD4</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="342f9-221">**UD0**</span><span class="sxs-lookup"><span data-stu-id="342f9-221">**UD0**</span></span> |<span data-ttu-id="342f9-222">N1</span><span class="sxs-lookup"><span data-stu-id="342f9-222">N1</span></span> | | | | |
| <span data-ttu-id="342f9-223">**UD1**</span><span class="sxs-lookup"><span data-stu-id="342f9-223">**UD1**</span></span> |<span data-ttu-id="342f9-224">N6</span><span class="sxs-lookup"><span data-stu-id="342f9-224">N6</span></span> |<span data-ttu-id="342f9-225">N2</span><span class="sxs-lookup"><span data-stu-id="342f9-225">N2</span></span> | | | |
| <span data-ttu-id="342f9-226">**UD2**</span><span class="sxs-lookup"><span data-stu-id="342f9-226">**UD2**</span></span> | | |<span data-ttu-id="342f9-227">N3</span><span class="sxs-lookup"><span data-stu-id="342f9-227">N3</span></span> | | |
| <span data-ttu-id="342f9-228">**UD3**</span><span class="sxs-lookup"><span data-stu-id="342f9-228">**UD3**</span></span> | | | |<span data-ttu-id="342f9-229">N4</span><span class="sxs-lookup"><span data-stu-id="342f9-229">N4</span></span> | |
| <span data-ttu-id="342f9-230">**UD4**</span><span class="sxs-lookup"><span data-stu-id="342f9-230">**UD4**</span></span> | | | | |<span data-ttu-id="342f9-231">N5</span><span class="sxs-lookup"><span data-stu-id="342f9-231">N5</span></span> |

<span data-ttu-id="342f9-232">Maintenant, supposons que nous créons un service en attribuant à TargetReplicaSetSize (ou, pour un service sans état, à InstanceCount) la valeur 5.</span><span class="sxs-lookup"><span data-stu-id="342f9-232">Now let's say that we create a service with a TargetReplicaSetSize (or, for a stateless service an InstanceCount) of five.</span></span> <span data-ttu-id="342f9-233">terres de réplicas Hello sur N1-N5.</span><span class="sxs-lookup"><span data-stu-id="342f9-233">hello replicas land on N1-N5.</span></span> <span data-ttu-id="342f9-234">En fait, N6 n’est jamais utilisé, quel que soit le nombre de services équivalents que vous créez.</span><span class="sxs-lookup"><span data-stu-id="342f9-234">In fact, N6 is never used no matter how many services like this you create.</span></span> <span data-ttu-id="342f9-235">Mais pourquoi ?</span><span class="sxs-lookup"><span data-stu-id="342f9-235">But why?</span></span> <span data-ttu-id="342f9-236">Examinons la différence de hello entre la disposition actuelle de hello et ce qui se passerait si vous choisissez N6.</span><span class="sxs-lookup"><span data-stu-id="342f9-236">Let's look at hello difference between hello current layout and what would happen if N6 is chosen.</span></span>

<span data-ttu-id="342f9-237">Voici la mise en page hello nous et vos hello nombre total de réplicas par erreur et de domaine de mise à niveau :</span><span class="sxs-lookup"><span data-stu-id="342f9-237">Here's hello layout we got and hello total number of replicas per Fault and Upgrade Domain:</span></span>

|  | <span data-ttu-id="342f9-238">FD0</span><span class="sxs-lookup"><span data-stu-id="342f9-238">FD0</span></span> | <span data-ttu-id="342f9-239">FD1</span><span class="sxs-lookup"><span data-stu-id="342f9-239">FD1</span></span> | <span data-ttu-id="342f9-240">FD2</span><span class="sxs-lookup"><span data-stu-id="342f9-240">FD2</span></span> | <span data-ttu-id="342f9-241">FD3</span><span class="sxs-lookup"><span data-stu-id="342f9-241">FD3</span></span> | <span data-ttu-id="342f9-242">FD4</span><span class="sxs-lookup"><span data-stu-id="342f9-242">FD4</span></span> | <span data-ttu-id="342f9-243">UDTotal</span><span class="sxs-lookup"><span data-stu-id="342f9-243">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="342f9-244">**UD0**</span><span class="sxs-lookup"><span data-stu-id="342f9-244">**UD0**</span></span> |<span data-ttu-id="342f9-245">R1</span><span class="sxs-lookup"><span data-stu-id="342f9-245">R1</span></span> | | | | |<span data-ttu-id="342f9-246">1</span><span class="sxs-lookup"><span data-stu-id="342f9-246">1</span></span> |
| <span data-ttu-id="342f9-247">**UD1**</span><span class="sxs-lookup"><span data-stu-id="342f9-247">**UD1**</span></span> | |<span data-ttu-id="342f9-248">R2</span><span class="sxs-lookup"><span data-stu-id="342f9-248">R2</span></span> | | | |<span data-ttu-id="342f9-249">1</span><span class="sxs-lookup"><span data-stu-id="342f9-249">1</span></span> |
| <span data-ttu-id="342f9-250">**UD2**</span><span class="sxs-lookup"><span data-stu-id="342f9-250">**UD2**</span></span> | | |<span data-ttu-id="342f9-251">R3</span><span class="sxs-lookup"><span data-stu-id="342f9-251">R3</span></span> | | |<span data-ttu-id="342f9-252">1</span><span class="sxs-lookup"><span data-stu-id="342f9-252">1</span></span> |
| <span data-ttu-id="342f9-253">**UD3**</span><span class="sxs-lookup"><span data-stu-id="342f9-253">**UD3**</span></span> | | | |<span data-ttu-id="342f9-254">R4</span><span class="sxs-lookup"><span data-stu-id="342f9-254">R4</span></span> | |<span data-ttu-id="342f9-255">1</span><span class="sxs-lookup"><span data-stu-id="342f9-255">1</span></span> |
| <span data-ttu-id="342f9-256">**UD4**</span><span class="sxs-lookup"><span data-stu-id="342f9-256">**UD4**</span></span> | | | | |<span data-ttu-id="342f9-257">R5</span><span class="sxs-lookup"><span data-stu-id="342f9-257">R5</span></span> |<span data-ttu-id="342f9-258">1</span><span class="sxs-lookup"><span data-stu-id="342f9-258">1</span></span> |
| <span data-ttu-id="342f9-259">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="342f9-259">**FDTotal**</span></span> |<span data-ttu-id="342f9-260">1</span><span class="sxs-lookup"><span data-stu-id="342f9-260">1</span></span> |<span data-ttu-id="342f9-261">1</span><span class="sxs-lookup"><span data-stu-id="342f9-261">1</span></span> |<span data-ttu-id="342f9-262">1</span><span class="sxs-lookup"><span data-stu-id="342f9-262">1</span></span> |<span data-ttu-id="342f9-263">1</span><span class="sxs-lookup"><span data-stu-id="342f9-263">1</span></span> |<span data-ttu-id="342f9-264">1</span><span class="sxs-lookup"><span data-stu-id="342f9-264">1</span></span> |- |

<span data-ttu-id="342f9-265">Cette disposition est équilibrée en termes de nœuds par domaine d’erreur et domaine de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-265">This layout is balanced in terms of nodes per Fault Domain and Upgrade Domain.</span></span> <span data-ttu-id="342f9-266">Il est également équilibrée en termes de nombre de hello de réplicas par erreur et de domaine de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-266">It is also balanced in terms of hello number of replicas per Fault and Upgrade Domain.</span></span> <span data-ttu-id="342f9-267">Chaque domaine possède hello même nombre de nœuds et hello même nombre de réplicas.</span><span class="sxs-lookup"><span data-stu-id="342f9-267">Each domain has hello same number of nodes and hello same number of replicas.</span></span>

<span data-ttu-id="342f9-268">À présent, jetons un œil à ce qui se passerait si au lieu de N2, nous avions utilisé N6.</span><span class="sxs-lookup"><span data-stu-id="342f9-268">Now, let's look at what would happen if we'd used N6 instead of N2.</span></span> <span data-ttu-id="342f9-269">Comment les réplicas hello est répartis puis ?</span><span class="sxs-lookup"><span data-stu-id="342f9-269">How would hello replicas be distributed then?</span></span>

|  | <span data-ttu-id="342f9-270">FD0</span><span class="sxs-lookup"><span data-stu-id="342f9-270">FD0</span></span> | <span data-ttu-id="342f9-271">FD1</span><span class="sxs-lookup"><span data-stu-id="342f9-271">FD1</span></span> | <span data-ttu-id="342f9-272">FD2</span><span class="sxs-lookup"><span data-stu-id="342f9-272">FD2</span></span> | <span data-ttu-id="342f9-273">FD3</span><span class="sxs-lookup"><span data-stu-id="342f9-273">FD3</span></span> | <span data-ttu-id="342f9-274">FD4</span><span class="sxs-lookup"><span data-stu-id="342f9-274">FD4</span></span> | <span data-ttu-id="342f9-275">UDTotal</span><span class="sxs-lookup"><span data-stu-id="342f9-275">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="342f9-276">**UD0**</span><span class="sxs-lookup"><span data-stu-id="342f9-276">**UD0**</span></span> |<span data-ttu-id="342f9-277">R1</span><span class="sxs-lookup"><span data-stu-id="342f9-277">R1</span></span> | | | | |<span data-ttu-id="342f9-278">1</span><span class="sxs-lookup"><span data-stu-id="342f9-278">1</span></span> |
| <span data-ttu-id="342f9-279">**UD1**</span><span class="sxs-lookup"><span data-stu-id="342f9-279">**UD1**</span></span> |<span data-ttu-id="342f9-280">R5</span><span class="sxs-lookup"><span data-stu-id="342f9-280">R5</span></span> | | | | |<span data-ttu-id="342f9-281">1</span><span class="sxs-lookup"><span data-stu-id="342f9-281">1</span></span> |
| <span data-ttu-id="342f9-282">**UD2**</span><span class="sxs-lookup"><span data-stu-id="342f9-282">**UD2**</span></span> | | |<span data-ttu-id="342f9-283">R2</span><span class="sxs-lookup"><span data-stu-id="342f9-283">R2</span></span> | | |<span data-ttu-id="342f9-284">1</span><span class="sxs-lookup"><span data-stu-id="342f9-284">1</span></span> |
| <span data-ttu-id="342f9-285">**UD3**</span><span class="sxs-lookup"><span data-stu-id="342f9-285">**UD3**</span></span> | | | |<span data-ttu-id="342f9-286">R3</span><span class="sxs-lookup"><span data-stu-id="342f9-286">R3</span></span> | |<span data-ttu-id="342f9-287">1</span><span class="sxs-lookup"><span data-stu-id="342f9-287">1</span></span> |
| <span data-ttu-id="342f9-288">**UD4**</span><span class="sxs-lookup"><span data-stu-id="342f9-288">**UD4**</span></span> | | | | |<span data-ttu-id="342f9-289">R4</span><span class="sxs-lookup"><span data-stu-id="342f9-289">R4</span></span> |<span data-ttu-id="342f9-290">1</span><span class="sxs-lookup"><span data-stu-id="342f9-290">1</span></span> |
| <span data-ttu-id="342f9-291">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="342f9-291">**FDTotal**</span></span> |<span data-ttu-id="342f9-292">2</span><span class="sxs-lookup"><span data-stu-id="342f9-292">2</span></span> |<span data-ttu-id="342f9-293">0</span><span class="sxs-lookup"><span data-stu-id="342f9-293">0</span></span> |<span data-ttu-id="342f9-294">1</span><span class="sxs-lookup"><span data-stu-id="342f9-294">1</span></span> |<span data-ttu-id="342f9-295">1</span><span class="sxs-lookup"><span data-stu-id="342f9-295">1</span></span> |<span data-ttu-id="342f9-296">1</span><span class="sxs-lookup"><span data-stu-id="342f9-296">1</span></span> |- |

<span data-ttu-id="342f9-297">Cette disposition ne respecte pas notre définition pourquoi la contrainte de domaine d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-297">This layout violates our definition for hello Fault Domain constraint.</span></span> <span data-ttu-id="342f9-298">FD0 a deux réplicas, alors que FD1 a zéro, faisant hello différencie FD0 FD1 un total de deux.</span><span class="sxs-lookup"><span data-stu-id="342f9-298">FD0 has two replicas, while FD1 has zero, making hello difference between FD0 and FD1 a total of two.</span></span> <span data-ttu-id="342f9-299">Hello, Gestionnaire de ressources de Cluster n’autorise pas cette configuration.</span><span class="sxs-lookup"><span data-stu-id="342f9-299">hello Cluster Resource Manager does not allow this arrangement.</span></span> <span data-ttu-id="342f9-300">De même, si nous avions choisi N2 et N6 (au lieu de N1 et N2) nous aurions obtenu :</span><span class="sxs-lookup"><span data-stu-id="342f9-300">Similarly if we picked N2 and N6 (instead of N1 and N2) we'd get:</span></span>

|  | <span data-ttu-id="342f9-301">FD0</span><span class="sxs-lookup"><span data-stu-id="342f9-301">FD0</span></span> | <span data-ttu-id="342f9-302">FD1</span><span class="sxs-lookup"><span data-stu-id="342f9-302">FD1</span></span> | <span data-ttu-id="342f9-303">FD2</span><span class="sxs-lookup"><span data-stu-id="342f9-303">FD2</span></span> | <span data-ttu-id="342f9-304">FD3</span><span class="sxs-lookup"><span data-stu-id="342f9-304">FD3</span></span> | <span data-ttu-id="342f9-305">FD4</span><span class="sxs-lookup"><span data-stu-id="342f9-305">FD4</span></span> | <span data-ttu-id="342f9-306">UDTotal</span><span class="sxs-lookup"><span data-stu-id="342f9-306">UDTotal</span></span> |
| --- |:---:|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="342f9-307">**UD0**</span><span class="sxs-lookup"><span data-stu-id="342f9-307">**UD0**</span></span> | | | | | |<span data-ttu-id="342f9-308">0</span><span class="sxs-lookup"><span data-stu-id="342f9-308">0</span></span> |
| <span data-ttu-id="342f9-309">**UD1**</span><span class="sxs-lookup"><span data-stu-id="342f9-309">**UD1**</span></span> |<span data-ttu-id="342f9-310">R5</span><span class="sxs-lookup"><span data-stu-id="342f9-310">R5</span></span> |<span data-ttu-id="342f9-311">R1</span><span class="sxs-lookup"><span data-stu-id="342f9-311">R1</span></span> | | | |<span data-ttu-id="342f9-312">2</span><span class="sxs-lookup"><span data-stu-id="342f9-312">2</span></span> |
| <span data-ttu-id="342f9-313">**UD2**</span><span class="sxs-lookup"><span data-stu-id="342f9-313">**UD2**</span></span> | | |<span data-ttu-id="342f9-314">R2</span><span class="sxs-lookup"><span data-stu-id="342f9-314">R2</span></span> | | |<span data-ttu-id="342f9-315">1</span><span class="sxs-lookup"><span data-stu-id="342f9-315">1</span></span> |
| <span data-ttu-id="342f9-316">**UD3**</span><span class="sxs-lookup"><span data-stu-id="342f9-316">**UD3**</span></span> | | | |<span data-ttu-id="342f9-317">R3</span><span class="sxs-lookup"><span data-stu-id="342f9-317">R3</span></span> | |<span data-ttu-id="342f9-318">1</span><span class="sxs-lookup"><span data-stu-id="342f9-318">1</span></span> |
| <span data-ttu-id="342f9-319">**UD4**</span><span class="sxs-lookup"><span data-stu-id="342f9-319">**UD4**</span></span> | | | | |<span data-ttu-id="342f9-320">R4</span><span class="sxs-lookup"><span data-stu-id="342f9-320">R4</span></span> |<span data-ttu-id="342f9-321">1</span><span class="sxs-lookup"><span data-stu-id="342f9-321">1</span></span> |
| <span data-ttu-id="342f9-322">**FDTotal**</span><span class="sxs-lookup"><span data-stu-id="342f9-322">**FDTotal**</span></span> |<span data-ttu-id="342f9-323">1</span><span class="sxs-lookup"><span data-stu-id="342f9-323">1</span></span> |<span data-ttu-id="342f9-324">1</span><span class="sxs-lookup"><span data-stu-id="342f9-324">1</span></span> |<span data-ttu-id="342f9-325">1</span><span class="sxs-lookup"><span data-stu-id="342f9-325">1</span></span> |<span data-ttu-id="342f9-326">1</span><span class="sxs-lookup"><span data-stu-id="342f9-326">1</span></span> |<span data-ttu-id="342f9-327">1</span><span class="sxs-lookup"><span data-stu-id="342f9-327">1</span></span> |- |

<span data-ttu-id="342f9-328">Cette disposition est équilibrée du point de vue des domaines d’erreur.</span><span class="sxs-lookup"><span data-stu-id="342f9-328">This layout is balanced in terms of Fault Domains.</span></span> <span data-ttu-id="342f9-329">Toutefois, il est désormais violation contrainte de mise à niveau domaine hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-329">However, now it's violating hello Upgrade Domain constraint.</span></span> <span data-ttu-id="342f9-330">Cela est dû au fait que UD0 n’a aucun réplica, alors que UD1 en a deux.</span><span class="sxs-lookup"><span data-stu-id="342f9-330">This is because UD0 has zero replicas while UD1 has two.</span></span> <span data-ttu-id="342f9-331">Par conséquent, cette disposition est également non valide et ne seront pas prise en hello Gestionnaire de ressources du Cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-331">Therefore, this layout is also invalid and won't be picked by hello Cluster Resource Manager.</span></span> 

## <a name="configuring-fault-and-upgrade-domains"></a><span data-ttu-id="342f9-332">Configuration des domaines d’erreur et de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="342f9-332">Configuring fault and Upgrade Domains</span></span>
<span data-ttu-id="342f9-333">La définition des domaines d’erreur et de mise à niveau s’effectue automatiquement dans les déploiements Service Fabric hébergés sur Azure.</span><span class="sxs-lookup"><span data-stu-id="342f9-333">Defining Fault Domains and Upgrade Domains is done automatically in Azure hosted Service Fabric deployments.</span></span> <span data-ttu-id="342f9-334">Service Fabric récupère et utilise les informations sur l’environnement à partir d’Azure hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-334">Service Fabric picks up and uses hello environment information from Azure.</span></span>

<span data-ttu-id="342f9-335">Si vous créez votre propre cluster (ou souhaitez toorun une topologie particulière en cours de développement), vous pouvez fournir les informations de domaine d’erreur et de mettre à niveau un domaine hello vous-même.</span><span class="sxs-lookup"><span data-stu-id="342f9-335">If you’re creating your own cluster (or want toorun a particular topology in development), you can provide hello Fault Domain and Upgrade Domain information yourself.</span></span> <span data-ttu-id="342f9-336">Dans cet exemple, nous définissons un cluster de développement local à neuf nœuds qui s’étend sur trois « centres de données » (chacun avec trois racks).</span><span class="sxs-lookup"><span data-stu-id="342f9-336">In this example, we define a nine node local development cluster that spans three “datacenters” (each with three racks).</span></span> <span data-ttu-id="342f9-337">Ce cluster a également trois domaines de mise à niveau répartis sur ces trois centres de données.</span><span class="sxs-lookup"><span data-stu-id="342f9-337">This cluster also has three Upgrade Domains striped across those three datacenters.</span></span> <span data-ttu-id="342f9-338">Un exemple de configuration de hello est ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="342f9-338">An example of hello configuration is below:</span></span> 

<span data-ttu-id="342f9-339">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="342f9-339">ClusterManifest.xml</span></span>

```xml
  <Infrastructure>
    <!-- IsScaleMin indicates that this cluster runs on one-box /one single server -->
    <WindowsServer IsScaleMin="true">
      <NodeList>
        <Node NodeName="Node01" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType01" FaultDomain="fd:/DC01/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node02" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType02" FaultDomain="fd:/DC01/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node03" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType03" FaultDomain="fd:/DC01/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node04" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType04" FaultDomain="fd:/DC02/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node05" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType05" FaultDomain="fd:/DC02/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node06" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType06" FaultDomain="fd:/DC02/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
        <Node NodeName="Node07" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType07" FaultDomain="fd:/DC03/Rack01" UpgradeDomain="UpgradeDomain1" IsSeedNode="true" />
        <Node NodeName="Node08" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType08" FaultDomain="fd:/DC03/Rack02" UpgradeDomain="UpgradeDomain2" IsSeedNode="true" />
        <Node NodeName="Node09" IPAddressOrFQDN="localhost" NodeTypeRef="NodeType09" FaultDomain="fd:/DC03/Rack03" UpgradeDomain="UpgradeDomain3" IsSeedNode="true" />
      </NodeList>
    </WindowsServer>
  </Infrastructure>
```

<span data-ttu-id="342f9-340">via ClusterConfig.json pour les déploiements autonomes</span><span class="sxs-lookup"><span data-stu-id="342f9-340">via ClusterConfig.json for Standalone deployments</span></span>

```json
"nodes": [
  {
    "nodeName": "vm1",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm2",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm3",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc1/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm4",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm5",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm6",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc2/r0",
    "upgradeDomain": "UD3"
  },
  {
    "nodeName": "vm7",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD1"
  },
  {
    "nodeName": "vm8",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD2"
  },
  {
    "nodeName": "vm9",
    "iPAddress": "localhost",
    "nodeTypeRef": "NodeType0",
    "faultDomain": "fd:/dc3/r0",
    "upgradeDomain": "UD3"
  }
],
```

> [!NOTE]
> <span data-ttu-id="342f9-341">Quand les clusters sont définis via Azure Resource Manager, les domaines d’erreur et les domaines de mise à niveau sont assignés par Azure.</span><span class="sxs-lookup"><span data-stu-id="342f9-341">When defining clusters via Azure Resource Manager, Fault Domains and Upgrade Domains are assigned by Azure.</span></span> <span data-ttu-id="342f9-342">Par conséquent, définition hello de vos Types de nœuds et les machines virtuelles identiques dans votre modèle Azure Resource Manager n’inclut pas de domaine par défaut ou domaine de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="342f9-342">Therefore, hello definition of your Node Types and Virtual Machine Scale Sets in your Azure Resource Manager template does not include Fault Domain or Upgrade Domain information.</span></span>
>

## <a name="node-properties-and-placement-constraints"></a><span data-ttu-id="342f9-343">Propriétés de nœud et contraintes de placement</span><span class="sxs-lookup"><span data-stu-id="342f9-343">Node properties and placement constraints</span></span>
<span data-ttu-id="342f9-344">Parfois (en fait, la plupart du temps de hello) que vous allez tooensure toowant qui certaines charges de travail s’exécutent uniquement sur certains types de nœuds de cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-344">Sometimes (in fact, most of hello time) you’re going toowant tooensure that certain workloads run only on certain types of nodes in hello cluster.</span></span> <span data-ttu-id="342f9-345">Par exemple, certaines charges de travail peuvent nécessiter des GPU ou des SSD, tandis que d’autres n’en ont pas besoin.</span><span class="sxs-lookup"><span data-stu-id="342f9-345">For example, some workload may require GPUs or SSDs while others may not.</span></span> <span data-ttu-id="342f9-346">Un bon exemple de ciblage des charges de travail tooparticular matériel est presque chaque architecture multicouche très utiles.</span><span class="sxs-lookup"><span data-stu-id="342f9-346">A great example of targeting hardware tooparticular workloads is almost every n-tier architecture out there.</span></span> <span data-ttu-id="342f9-347">Certains ordinateurs servent hello frontal ou API servant le côté de l’application hello et sont exposées toohello clients ou hello internet.</span><span class="sxs-lookup"><span data-stu-id="342f9-347">Certain machines serve as hello front end or API serving side of hello application and are exposed toohello clients or hello internet.</span></span> <span data-ttu-id="342f9-348">Des ordinateurs différents, souvent avec les ressources matérielles différentes gérer hello des couches de calcul ou stockage hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-348">Different machines, often with different hardware resources, handle hello work of hello compute or storage layers.</span></span> <span data-ttu-id="342f9-349">Il s’agit généralement _pas_ directement exposé tooclients ou hello internet.</span><span class="sxs-lookup"><span data-stu-id="342f9-349">These are usually _not_ directly exposed tooclients or hello internet.</span></span> <span data-ttu-id="342f9-350">L’infrastructure de service attend qu’il existe des cas où les charges de travail particuliers doivent toorun sur les configurations de matériel spécifique.</span><span class="sxs-lookup"><span data-stu-id="342f9-350">Service Fabric expects that there are cases where particular workloads need toorun on particular hardware configurations.</span></span> <span data-ttu-id="342f9-351">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="342f9-351">For example:</span></span>

* <span data-ttu-id="342f9-352">une application multiniveau existante a été « augmentée et déplacée » dans un environnement Service Fabric</span><span class="sxs-lookup"><span data-stu-id="342f9-352">an existing n-tier application has been “lifted and shifted” into a Service Fabric environment</span></span>
* <span data-ttu-id="342f9-353">une charge de travail souhaite toorun sur du matériel spécifique pour les performances, l’échelle ou des raisons de sécurité d’isolation</span><span class="sxs-lookup"><span data-stu-id="342f9-353">a workload wants toorun on specific hardware for performance, scale, or security isolation reasons</span></span>
* <span data-ttu-id="342f9-354">une charge de travail doit être isolée des autres charges de travail pour des raisons de stratégie ou de consommation de ressources</span><span class="sxs-lookup"><span data-stu-id="342f9-354">A workload should be isolated from other workloads for policy or resource consumption reasons</span></span>

<span data-ttu-id="342f9-355">ces types de configurations, de toosupport Service Fabric a une notion de première classe de balises qui peuvent être appliqués toonodes.</span><span class="sxs-lookup"><span data-stu-id="342f9-355">toosupport these sorts of configurations, Service Fabric has a first class notion of tags that can be applied toonodes.</span></span> <span data-ttu-id="342f9-356">Ces balises sont appelés **propriétés de nœud**.</span><span class="sxs-lookup"><span data-stu-id="342f9-356">These tags are called **node properties**.</span></span> <span data-ttu-id="342f9-357">**Les contraintes de placement** sont des instructions de hello attachés tooindividual les services que vous sélectionnez pour un ou plusieurs propriétés de nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-357">**Placement constraints** are hello statements attached tooindividual services that select for one or more node properties.</span></span> <span data-ttu-id="342f9-358">Les contraintes de placement définissent là où les services doivent s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="342f9-358">Placement constraints define where services should run.</span></span> <span data-ttu-id="342f9-359">ensemble Hello de contraintes est extensible, n’importe quelle paire clé/valeur peut travailler.</span><span class="sxs-lookup"><span data-stu-id="342f9-359">hello set of constraints is extensible - any key/value pair can work.</span></span> 

<span data-ttu-id="342f9-360"><center>
![Disposition du cluster avec différentes charges de travail][Image5]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-360"><center>
![Cluster Layout Different Workloads][Image5]
</center></span></span>

### <a name="built-in-node-properties"></a><span data-ttu-id="342f9-361">Propriétés de nœud intégrées</span><span class="sxs-lookup"><span data-stu-id="342f9-361">Built in node properties</span></span>
<span data-ttu-id="342f9-362">L’infrastructure de service définit certaines propriétés de nœud par défaut qui peuvent être utilisées automatiquement sans utilisateur hello toodefine les.</span><span class="sxs-lookup"><span data-stu-id="342f9-362">Service Fabric defines some default node properties that can be used automatically without hello user having toodefine them.</span></span> <span data-ttu-id="342f9-363">propriétés par défaut de Hello définies sur chaque nœud sont hello **NodeType** et hello **NodeName**.</span><span class="sxs-lookup"><span data-stu-id="342f9-363">hello default properties defined at each node are hello **NodeType** and hello **NodeName**.</span></span> <span data-ttu-id="342f9-364">Par exemple, vous pouvez écrire une contrainte de placement ainsi : `"(NodeType == NodeType03)"`.</span><span class="sxs-lookup"><span data-stu-id="342f9-364">So for example you could write a placement constraint as `"(NodeType == NodeType03)"`.</span></span> <span data-ttu-id="342f9-365">Nous avons généralement constaté NodeType toobe une des propriétés de hello couramment utilisé.</span><span class="sxs-lookup"><span data-stu-id="342f9-365">Generally we have found NodeType toobe one of hello most commonly used properties.</span></span> <span data-ttu-id="342f9-366">Elle est utile, car elle correspond parfaitement à un type de machine.</span><span class="sxs-lookup"><span data-stu-id="342f9-366">It is useful since it corresponds 1:1 with a type of a machine.</span></span> <span data-ttu-id="342f9-367">Chaque type d’ordinateur correspond type tooa de charge de travail dans une application multicouche classique.</span><span class="sxs-lookup"><span data-stu-id="342f9-367">Each type of machine corresponds tooa type of workload in a traditional n-tier application.</span></span>

<span data-ttu-id="342f9-368"><center>
![Contraintes de placement et propriétés de nœud][Image6]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-368"><center>
![Placement Constraints and Node Properties][Image6]
</center></span></span>

## <a name="placement-constraint-and-node-property-syntax"></a><span data-ttu-id="342f9-369">Syntaxe des contraintes de placement et des propriétés de nœud</span><span class="sxs-lookup"><span data-stu-id="342f9-369">Placement Constraint and Node Property Syntax</span></span> 
<span data-ttu-id="342f9-370">valeur de Hello spécifiée dans la propriété de nœud hello peut être une chaîne, bool, ou long signé.</span><span class="sxs-lookup"><span data-stu-id="342f9-370">hello value specified in hello node property can be a string, bool, or signed long.</span></span> <span data-ttu-id="342f9-371">instruction Hello au niveau de service de hello est appelée un placement *contrainte* , car il limite où service de hello permettre s’exécuter dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-371">hello statement at hello service is called a placement *constraint* since it constrains where hello service can run in hello cluster.</span></span> <span data-ttu-id="342f9-372">contrainte de Hello peut être n’importe quelle instruction booléenne qui fonctionne sur hello différentes propriétés du nœud de cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-372">hello constraint can be any Boolean statement that operates on hello different node properties in hello cluster.</span></span> <span data-ttu-id="342f9-373">sélecteurs de valide Hello dans ces instructions booléennes sont :</span><span class="sxs-lookup"><span data-stu-id="342f9-373">hello valid selectors in these boolean statements are:</span></span>

1) <span data-ttu-id="342f9-374">des vérifications conditionnelles pour la création d’instructions particulières</span><span class="sxs-lookup"><span data-stu-id="342f9-374">conditional checks for creating particular statements</span></span>

| <span data-ttu-id="342f9-375">Instruction</span><span class="sxs-lookup"><span data-stu-id="342f9-375">Statement</span></span> | <span data-ttu-id="342f9-376">Syntaxe</span><span class="sxs-lookup"><span data-stu-id="342f9-376">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="342f9-377">"égal à"</span><span class="sxs-lookup"><span data-stu-id="342f9-377">"equal to"</span></span> | <span data-ttu-id="342f9-378">"=="</span><span class="sxs-lookup"><span data-stu-id="342f9-378">"=="</span></span> |
| <span data-ttu-id="342f9-379">"non égal à"</span><span class="sxs-lookup"><span data-stu-id="342f9-379">"not equal to"</span></span> | <span data-ttu-id="342f9-380">"!="</span><span class="sxs-lookup"><span data-stu-id="342f9-380">"!="</span></span> |
| <span data-ttu-id="342f9-381">"supérieur à"</span><span class="sxs-lookup"><span data-stu-id="342f9-381">"greater than"</span></span> | <span data-ttu-id="342f9-382">">"</span><span class="sxs-lookup"><span data-stu-id="342f9-382">">"</span></span> |
| <span data-ttu-id="342f9-383">"supérieur ou égal à"</span><span class="sxs-lookup"><span data-stu-id="342f9-383">"greater than or equal to"</span></span> | <span data-ttu-id="342f9-384">">="</span><span class="sxs-lookup"><span data-stu-id="342f9-384">">="</span></span> |
| <span data-ttu-id="342f9-385">"inférieur à"</span><span class="sxs-lookup"><span data-stu-id="342f9-385">"less than"</span></span> | <span data-ttu-id="342f9-386">"<"</span><span class="sxs-lookup"><span data-stu-id="342f9-386">"<"</span></span> |
| <span data-ttu-id="342f9-387">"inférieur ou égal à"</span><span class="sxs-lookup"><span data-stu-id="342f9-387">"less than or equal to"</span></span> | <span data-ttu-id="342f9-388">"<="</span><span class="sxs-lookup"><span data-stu-id="342f9-388">"<="</span></span> |

2) <span data-ttu-id="342f9-389">instructions booléennes pour les opérations de groupage et logiques</span><span class="sxs-lookup"><span data-stu-id="342f9-389">boolean statements for grouping and logical operations</span></span>

| <span data-ttu-id="342f9-390">Instruction</span><span class="sxs-lookup"><span data-stu-id="342f9-390">Statement</span></span> | <span data-ttu-id="342f9-391">Syntaxe</span><span class="sxs-lookup"><span data-stu-id="342f9-391">Syntax</span></span> |
| --- |:---:|
| <span data-ttu-id="342f9-392">"et"</span><span class="sxs-lookup"><span data-stu-id="342f9-392">"and"</span></span> | <span data-ttu-id="342f9-393">"&&"</span><span class="sxs-lookup"><span data-stu-id="342f9-393">"&&"</span></span> |
| <span data-ttu-id="342f9-394">"ou"</span><span class="sxs-lookup"><span data-stu-id="342f9-394">"or"</span></span> | <span data-ttu-id="342f9-395">"&#124;&#124;"</span><span class="sxs-lookup"><span data-stu-id="342f9-395">"&#124;&#124;"</span></span> |
| <span data-ttu-id="342f9-396">"non"</span><span class="sxs-lookup"><span data-stu-id="342f9-396">"not"</span></span> | <span data-ttu-id="342f9-397">"!"</span><span class="sxs-lookup"><span data-stu-id="342f9-397">"!"</span></span> |
| <span data-ttu-id="342f9-398">"regrouper en tant qu’instruction unique"</span><span class="sxs-lookup"><span data-stu-id="342f9-398">"group as single statement"</span></span> | <span data-ttu-id="342f9-399">"()"</span><span class="sxs-lookup"><span data-stu-id="342f9-399">"()"</span></span> |

<span data-ttu-id="342f9-400">Voici quelques exemples d’instructions de contrainte de base.</span><span class="sxs-lookup"><span data-stu-id="342f9-400">Here are some examples of basic constraint statements.</span></span>

  * `"Value >= 5"`
  * `"NodeColor != green"`
  * `"((OneProperty < 100) || ((AnotherProperty == false) && (OneProperty >= 100)))"`

<span data-ttu-id="342f9-401">Seuls les nœuds où hello globalement la sélection élective contrainte instruction prend la valeur trop « True » peuvent avoir service hello placé sur celui-ci.</span><span class="sxs-lookup"><span data-stu-id="342f9-401">Only nodes where hello overall placement constraint statement evaluates too“True” can have hello service placed on it.</span></span> <span data-ttu-id="342f9-402">Les nœuds sans une propriété définie ne correspondent à aucune contrainte de placement contenant cette propriété.</span><span class="sxs-lookup"><span data-stu-id="342f9-402">Nodes that do not have a property defined do not match any placement constraint containing that property.</span></span>

<span data-ttu-id="342f9-403">Supposons que hello suivant nœud propriétés ont été définies pour un type de nœud donné :</span><span class="sxs-lookup"><span data-stu-id="342f9-403">Let’s say that hello following node properties were defined for a given node type:</span></span>

<span data-ttu-id="342f9-404">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="342f9-404">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType01">
      <PlacementProperties>
        <Property Name="HasSSD" Value="true"/>
        <Property Name="NodeColor" Value="green"/>
        <Property Name="SomeProperty" Value="5"/>
      </PlacementProperties>
    </NodeType>
```

<span data-ttu-id="342f9-405">via ClusterConfig.json pour les déploiements autonomes ou Template.json pour les clusters hébergés sur Azure.</span><span class="sxs-lookup"><span data-stu-id="342f9-405">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

> [!NOTE]
> <span data-ttu-id="342f9-406">Dans le nœud de hello de votre modèle Azure Resource Manager type est généralement paramétré.</span><span class="sxs-lookup"><span data-stu-id="342f9-406">In your Azure Resource Manager template hello node type is usually parameterized.</span></span> <span data-ttu-id="342f9-407">Il ressemble à « [parameters('vmNodeType1Name')] » plutôt qu’à « NodeType01 ».</span><span class="sxs-lookup"><span data-stu-id="342f9-407">It would look like "[parameters('vmNodeType1Name')]" rather than "NodeType01".</span></span>
>

```json
"nodeTypes": [
    {
        "name": "NodeType01",
        "placementProperties": {
            "HasSSD": "true",
            "NodeColor": "green",
            "SomeProperty": "5"
        },
    }
],
```

<span data-ttu-id="342f9-408">Vous pouvez créer des *contraintes* de placement de service pour un service comme suit :</span><span class="sxs-lookup"><span data-stu-id="342f9-408">You can create service placement *constraints* for a service like as follows:</span></span>

<span data-ttu-id="342f9-409">C#</span><span class="sxs-lookup"><span data-stu-id="342f9-409">C#</span></span>

```csharp
FabricClient fabricClient = new FabricClient();
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
serviceDescription.PlacementConstraints = "(HasSSD == true && SomeProperty >= 4)";
// add other required servicedescription fields
//...
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="342f9-410">PowerShell :</span><span class="sxs-lookup"><span data-stu-id="342f9-410">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceType -Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton -PlacementConstraint "HasSSD == true && SomeProperty >= 4"
```

<span data-ttu-id="342f9-411">Si tous les nœuds de NodeType01 sont valides, vous pouvez également sélectionner ce type de nœud avec la contrainte de hello "(NodeType == NodeType01) ».</span><span class="sxs-lookup"><span data-stu-id="342f9-411">If all nodes of NodeType01 are valid, you can also select that node type with hello constraint "(NodeType == NodeType01)".</span></span>

<span data-ttu-id="342f9-412">Une des choses intéressantes hello contraintes de placement d’un service est qu’ils peuvent être mis à jour dynamiquement pendant l’exécution.</span><span class="sxs-lookup"><span data-stu-id="342f9-412">One of hello cool things about a service’s placement constraints is that they can be updated dynamically during runtime.</span></span> <span data-ttu-id="342f9-413">Par conséquent, si vous le souhaitez, vous pouvez déplacer un service de cluster de hello, ajouter et supprimer, etc.. Prend en charge l’infrastructure de service de s’assurer que le service de hello reste disponible même lorsque ces types de modifications sont apportées.</span><span class="sxs-lookup"><span data-stu-id="342f9-413">So if you need to, you can move a service around in hello cluster, add and remove requirements, etc. Service Fabric takes care of ensuring that hello service stays up and available even when these types of changes are made.</span></span>

<span data-ttu-id="342f9-414">C# :</span><span class="sxs-lookup"><span data-stu-id="342f9-414">C#:</span></span>

```csharp
StatefulServiceUpdateDescription updateDescription = new StatefulServiceUpdateDescription();
updateDescription.PlacementConstraints = "NodeType == NodeType01";
await fabricClient.ServiceManager.UpdateServiceAsync(new Uri("fabric:/app/service"), updateDescription);
```

<span data-ttu-id="342f9-415">PowerShell :</span><span class="sxs-lookup"><span data-stu-id="342f9-415">Powershell:</span></span>

```posh
Update-ServiceFabricService -Stateful -ServiceName $serviceName -PlacementConstraints "NodeType == NodeType01"
```

<span data-ttu-id="342f9-416">Les contraintes de placement sont spécifiées pour chaque différente instance de service nommée.</span><span class="sxs-lookup"><span data-stu-id="342f9-416">Placement constraints are specified for every different named service instance.</span></span> <span data-ttu-id="342f9-417">Les mises à jour ont toujours lieu hello de (overwrite) ce qui a été spécifié précédemment.</span><span class="sxs-lookup"><span data-stu-id="342f9-417">Updates always take hello place of (overwrite) what was previously specified.</span></span>

<span data-ttu-id="342f9-418">définition de cluster Hello définit les propriétés de hello sur un nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-418">hello cluster definition defines hello properties on a node.</span></span> <span data-ttu-id="342f9-419">La modification des propriétés d’un nœud nécessite une mise à niveau de la configuration du cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-419">Changing a node's properties requires a cluster configuration upgrade.</span></span> <span data-ttu-id="342f9-420">Les propriétés d’un nœud de la mise à niveau nécessite chaque tooreport toorestart de nœud affecté ses nouvelles propriétés.</span><span class="sxs-lookup"><span data-stu-id="342f9-420">Upgrading a node's properties requires each affected node toorestart tooreport its new properties.</span></span> <span data-ttu-id="342f9-421">Ces mises à niveau propagées sont gérées par Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="342f9-421">These rolling upgrades are managed by Service Fabric.</span></span>

## <a name="describing-and-managing-cluster-resources"></a><span data-ttu-id="342f9-422">Description et gestion des ressources de cluster</span><span class="sxs-lookup"><span data-stu-id="342f9-422">Describing and Managing Cluster Resources</span></span>
<span data-ttu-id="342f9-423">Une des principales tâches de n’importe quel orchestrator est toohelp de hello gérer la consommation des ressources de cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-423">One of hello most important jobs of any orchestrator is toohelp manage resource consumption in hello cluster.</span></span> <span data-ttu-id="342f9-424">La gestion des ressources de cluster peut signifier plusieurs choses.</span><span class="sxs-lookup"><span data-stu-id="342f9-424">Managing cluster resources can mean a couple of different things.</span></span> <span data-ttu-id="342f9-425">En premier lieu, il peut s’agir de veiller à ce que les machines ne soient pas en surcharge.</span><span class="sxs-lookup"><span data-stu-id="342f9-425">First, there's ensuring that machines are not overloaded.</span></span> <span data-ttu-id="342f9-426">Cela implique de vérifier que les machines n’exécutent pas plus de services qu’elles ne peuvent en gérer.</span><span class="sxs-lookup"><span data-stu-id="342f9-426">This means making sure that machines aren't running more services than they can handle.</span></span> <span data-ttu-id="342f9-427">Ensuite, il est équilibrage et optimisation qui est critique toorunning services efficacement.</span><span class="sxs-lookup"><span data-stu-id="342f9-427">Second, there's balancing and optimization which is critical toorunning services efficiently.</span></span> <span data-ttu-id="342f9-428">Les offres de service sensibles à compter du ou des performances coûts n’autorise pas certains toobe de nœuds à chaud alors que d’autres sont à froid.</span><span class="sxs-lookup"><span data-stu-id="342f9-428">Cost effective or performance sensitive service offerings can't allow some nodes toobe hot while others are cold.</span></span> <span data-ttu-id="342f9-429">Les nœuds à chaud entraîner contention de tooresource et des performances médiocres, des nœuds à froid représentent perdu et les ressources une augmentation des coûts.</span><span class="sxs-lookup"><span data-stu-id="342f9-429">Hot nodes lead tooresource contention and poor performance, and cold nodes represent wasted resources and increased costs.</span></span> 

<span data-ttu-id="342f9-430">Service Fabric représente les ressources en tant que `Metrics`.</span><span class="sxs-lookup"><span data-stu-id="342f9-430">Service Fabric represents resources as `Metrics`.</span></span> <span data-ttu-id="342f9-431">Les métriques sont n’importe quelle ressource logique ou physique que vous souhaitez toodescribe tooService l’ensemble fibre optique.</span><span class="sxs-lookup"><span data-stu-id="342f9-431">Metrics are any logical or physical resource that you want toodescribe tooService Fabric.</span></span> <span data-ttu-id="342f9-432">Par exemple, « WorkQueueDepth » et « MemoryInMb » sont des métriques.</span><span class="sxs-lookup"><span data-stu-id="342f9-432">Examples of metrics are things like “WorkQueueDepth” or “MemoryInMb”.</span></span> <span data-ttu-id="342f9-433">Pour plus d’informations sur les ressources physiques hello qui régit l’infrastructure de Service sur les nœuds, consultez [gouvernance des ressources](service-fabric-resource-governance.md).</span><span class="sxs-lookup"><span data-stu-id="342f9-433">For information about hello physical resources that Service Fabric can govern on nodes, see [resource governance](service-fabric-resource-governance.md).</span></span> <span data-ttu-id="342f9-434">Pour plus d’informations sur la configuration de métriques personnalisées et sur leur utilisation, consultez [cet article](service-fabric-cluster-resource-manager-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="342f9-434">For information on configuring custom metrics and their uses, see [this article](service-fabric-cluster-resource-manager-metrics.md)</span></span>

<span data-ttu-id="342f9-435">Les mesures sont différentes des contraintes de placement et des propriétés de nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-435">Metrics are different from placements constraints and node properties.</span></span> <span data-ttu-id="342f9-436">Propriétés de nœud sont statiques descripteurs de nœuds hello eux-mêmes.</span><span class="sxs-lookup"><span data-stu-id="342f9-436">Node properties are static descriptors of hello nodes themselves.</span></span> <span data-ttu-id="342f9-437">Les métriques décrivent les ressources à la disposition des nœuds et que les services consomment quand ils s’exécutent sur un nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-437">Metrics describe resources that nodes have and that services consume when they are run on a node.</span></span> <span data-ttu-id="342f9-438">Une propriété de nœud peut être « HasSSD » et peut être définie tootrue ou false.</span><span class="sxs-lookup"><span data-stu-id="342f9-438">A node property could be "HasSSD" and could be set tootrue or false.</span></span> <span data-ttu-id="342f9-439">quantité Hello d’espace disponible sur ce disque SSD et la quantité est consommée par les services est une mesure telle que « DriveSpaceInMb ».</span><span class="sxs-lookup"><span data-stu-id="342f9-439">hello amount of space available on that SSD and how much is consumed by services would be a metric like “DriveSpaceInMb”.</span></span> 

<span data-ttu-id="342f9-440">Il est important toonote que la même façon que pour les contraintes de placement et les propriétés du nœud, hello Gestionnaire de ressources du Cluster Service Fabric ne comprend pas les noms hello hello métriques moyenne.</span><span class="sxs-lookup"><span data-stu-id="342f9-440">It is important toonote that just like for placement constraints and node properties, hello Service Fabric Cluster Resource Manager doesn't understand what hello names of hello metrics mean.</span></span> <span data-ttu-id="342f9-441">Les noms des mesures ne sont que des chaînes.</span><span class="sxs-lookup"><span data-stu-id="342f9-441">Metric names are just strings.</span></span> <span data-ttu-id="342f9-442">Il s’agit d’un unités toodeclare de bonnes pratiques dans le cadre de noms de métrique hello que vous créez lorsque cela peut être ambiguë.</span><span class="sxs-lookup"><span data-stu-id="342f9-442">It is a good practice toodeclare units as a part of hello metric names that you create when it could be ambiguous.</span></span>

## <a name="capacity"></a><span data-ttu-id="342f9-443">Capacity</span><span class="sxs-lookup"><span data-stu-id="342f9-443">Capacity</span></span>
<span data-ttu-id="342f9-444">Si vous avez désactivé toutes les fonctions d’*équilibrage* des ressources, Cluster Resource Manager de Service Fabric est tout de même en mesure de garantir qu’aucun nœud ne dépasse sa capacité.</span><span class="sxs-lookup"><span data-stu-id="342f9-444">If you turned off all resource *balancing*, Service Fabric’s Cluster Resource Manager would still ensure that no node ended up over its capacity.</span></span> <span data-ttu-id="342f9-445">Il est possible de gérer les dépassements de capacité, sauf si le cluster de hello est saturé ou de la charge de travail hello est supérieure à n’importe quel nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-445">Managing capacity overruns is possible unless hello cluster is too full or hello workload is larger than any node.</span></span> <span data-ttu-id="342f9-446">La capacité est un autre *contrainte* ce gestionnaire de ressources du Cluster hello utilise toounderstand la quantité d’une ressource, un nœud a.</span><span class="sxs-lookup"><span data-stu-id="342f9-446">Capacity is another *constraint* that hello Cluster Resource Manager uses toounderstand how much of a resource a node has.</span></span> <span data-ttu-id="342f9-447">Capacité restante est également suivi pour le cluster de hello dans sa globalité.</span><span class="sxs-lookup"><span data-stu-id="342f9-447">Remaining capacity is also tracked for hello cluster as a whole.</span></span> <span data-ttu-id="342f9-448">Capacité de hello et la consommation au niveau de service hello hello sont exprimés en termes de métriques.</span><span class="sxs-lookup"><span data-stu-id="342f9-448">Both hello capacity and hello consumption at hello service level are expressed in terms of metrics.</span></span> <span data-ttu-id="342f9-449">Par exemple, la métrique de hello peut être « ClientConnections » et un nœud donné peut avoir une capacité de « ClientConnections » de 32 768.</span><span class="sxs-lookup"><span data-stu-id="342f9-449">So for example, hello metric might be "ClientConnections" and a given Node may have a capacity for "ClientConnections" of 32768.</span></span> <span data-ttu-id="342f9-450">Autres nœuds peuvent avoir d’autres limites à certains services en cours d’exécution sur un nœud pouvant dire qu’elle est actuellement utilise des 32256 de métrique de hello « ClientConnections ».</span><span class="sxs-lookup"><span data-stu-id="342f9-450">Other nodes can have other limits Some service running on that node can say it is currently consuming 32256 of hello metric "ClientConnections".</span></span>

<span data-ttu-id="342f9-451">Pendant l’exécution, hello Gestionnaire de ressources de Cluster effectue le suivi de capacité restante dans un cluster de hello et sur les nœuds.</span><span class="sxs-lookup"><span data-stu-id="342f9-451">During runtime, hello Cluster Resource Manager tracks remaining capacity in hello cluster and on nodes.</span></span> <span data-ttu-id="342f9-452">Dans l’ordre tootrack hello de capacité Gestionnaire de ressources du Cluster soustrait l’utilisation de chaque service à partir de la capacité du nœud sur lequel s’exécute le service de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-452">In order tootrack capacity hello Cluster Resource Manager subtracts each service's usage from node's capacity where hello service runs.</span></span> <span data-ttu-id="342f9-453">Avec cette information, hello Gestionnaire de ressources du Cluster Service Fabric peut savoir où tooplace ou déplacez les réplicas afin que les nœuds ne pas dépasser la capacité.</span><span class="sxs-lookup"><span data-stu-id="342f9-453">With this information, hello Service Fabric Cluster Resource Manager can figure out where tooplace or move replicas so that nodes don’t go over capacity.</span></span>

<span data-ttu-id="342f9-454"><center>
![Nœuds de cluster et capacité][Image7]
</center></span><span class="sxs-lookup"><span data-stu-id="342f9-454"><center>
![Cluster nodes and capacity][Image7]
</center></span></span>

<span data-ttu-id="342f9-455">C# :</span><span class="sxs-lookup"><span data-stu-id="342f9-455">C#:</span></span>

```csharp
StatefulServiceDescription serviceDescription = new StatefulServiceDescription();
ServiceLoadMetricDescription metric = new ServiceLoadMetricDescription();
metric.Name = "ClientConnections";
metric.PrimaryDefaultLoad = 1024;
metric.SecondaryDefaultLoad = 0;
metric.Weight = ServiceLoadMetricWeight.High;
serviceDescription.Metrics.Add(metric);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

<span data-ttu-id="342f9-456">PowerShell :</span><span class="sxs-lookup"><span data-stu-id="342f9-456">Powershell:</span></span>

```posh
New-ServiceFabricService -ApplicationName $applicationName -ServiceName $serviceName -ServiceTypeName $serviceTypeName –Stateful -MinReplicaSetSize 3 -TargetReplicaSetSize 3 -PartitionSchemeSingleton –Metric @("ClientConnections,High,1024,0)
```

<span data-ttu-id="342f9-457">Vous pouvez voir les capacités définies dans le manifeste du cluster hello :</span><span class="sxs-lookup"><span data-stu-id="342f9-457">You can see capacities defined in hello cluster manifest:</span></span>

<span data-ttu-id="342f9-458">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="342f9-458">ClusterManifest.xml</span></span>

```xml
    <NodeType Name="NodeType03">
      <Capacities>
        <Capacity Name="ClientConnections" Value="65536"/>
      </Capacities>
    </NodeType>
```

<span data-ttu-id="342f9-459">via ClusterConfig.json pour les déploiements autonomes ou Template.json pour les clusters hébergés sur Azure.</span><span class="sxs-lookup"><span data-stu-id="342f9-459">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters.</span></span> 

```json
"nodeTypes": [
    {
        "name": "NodeType03",
        "capacities": {
            "ClientConnections": "65536",
        }
    }
],
```

<span data-ttu-id="342f9-460">En règle générale, la charge d’un service évolue de manière dynamique.</span><span class="sxs-lookup"><span data-stu-id="342f9-460">Commonly a service’s load changes dynamically.</span></span> <span data-ttu-id="342f9-461">Supposons que chargement d’un réplica de « ClientConnections » passé de 1024 too2048 mais le nœud hello s’exécutait sur ensuite avait uniquement 512 capacité restante pour cette métrique.</span><span class="sxs-lookup"><span data-stu-id="342f9-461">Say that a replica's load of "ClientConnections" changed from 1024 too2048, but hello node it was running on then only had 512 capacity remaining for that metric.</span></span> <span data-ttu-id="342f9-462">À présent, le placement de ce réplica ou de cette instance n’est pas valide, car il n’y a pas suffisamment d’espace sur ce nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-462">Now that replica or instance's placement is invalid, since there's not enough room on that node.</span></span> <span data-ttu-id="342f9-463">Hello Gestionnaire de ressources du Cluster a tookick et obtenir le nœud hello dessous de sa capacité.</span><span class="sxs-lookup"><span data-stu-id="342f9-463">hello Cluster Resource Manager has tookick in and get hello node back below capacity.</span></span> <span data-ttu-id="342f9-464">Il réduit la charge sur le nœud de hello sur la capacité en déplaçant un ou plusieurs réplicas de hello ou les instances à partir de ce nœud tooother nœuds.</span><span class="sxs-lookup"><span data-stu-id="342f9-464">It reduces load on hello node that is over capacity by moving one or more of hello replicas or instances from that node tooother nodes.</span></span> <span data-ttu-id="342f9-465">Lorsque vous déplacez des réplicas, hello Gestionnaire de ressources de Cluster tente de coût de hello toominimize les mouvements.</span><span class="sxs-lookup"><span data-stu-id="342f9-465">When moving replicas, hello Cluster Resource Manager tries toominimize hello cost of those movements.</span></span> <span data-ttu-id="342f9-466">Le coût du mouvement est décrite dans [cet article](service-fabric-cluster-resource-manager-movement-cost.md) plus sur hello Gestionnaire de ressources du Cluster de rééquilibrage des stratégies et les règles sont décrites [ici](service-fabric-cluster-resource-manager-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="342f9-466">Movement cost is discussed in [this article](service-fabric-cluster-resource-manager-movement-cost.md) and more about hello Cluster Resource Manager's rebalancing strategies and rules is described [here](service-fabric-cluster-resource-manager-metrics.md).</span></span>

## <a name="cluster-capacity"></a><span data-ttu-id="342f9-467">Capacité de cluster</span><span class="sxs-lookup"><span data-stu-id="342f9-467">Cluster capacity</span></span>
<span data-ttu-id="342f9-468">Comment hello hello de conserver de gestionnaire de ressources du Cluster Service Fabric globale de cluster d’être trop complète ?</span><span class="sxs-lookup"><span data-stu-id="342f9-468">So how does hello Service Fabric Cluster Resource Manager keep hello overall cluster from being too full?</span></span> <span data-ttu-id="342f9-469">En fait, du fait du chargement dynamique, il ne peut pas faire grand chose.</span><span class="sxs-lookup"><span data-stu-id="342f9-469">Well, with dynamic load there’s not a lot it can do.</span></span> <span data-ttu-id="342f9-470">Services peuvent avoir leur pic de charge indépendamment des actions effectuées par hello Gestionnaire de ressources du Cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-470">Services can have their load spike independently of actions taken by hello Cluster Resource Manager.</span></span> <span data-ttu-id="342f9-471">Par conséquent, votre cluster qui dispose de suffisamment d’espace aujourd’hui pourrait ne pas être suffisamment puissant demain une fois que vous serez devenu célèbre.</span><span class="sxs-lookup"><span data-stu-id="342f9-471">As a result, your cluster with plenty of headroom today may be underpowered when you become famous tomorrow.</span></span> <span data-ttu-id="342f9-472">Ceci dit, il existe certains contrôles sont cuits tooprevent des problèmes.</span><span class="sxs-lookup"><span data-stu-id="342f9-472">That said, there are some controls that are baked in tooprevent problems.</span></span> <span data-ttu-id="342f9-473">Hello première chose que nous pouvons faire est d’empêcher la création de hello de nouvelles charges de travail qui provoquerait le toobecome de cluster hello complète.</span><span class="sxs-lookup"><span data-stu-id="342f9-473">hello first thing we can do is prevent hello creation of new workloads that would cause hello cluster toobecome full.</span></span>

<span data-ttu-id="342f9-474">Supposons que vous créez un service sans état et qu’il a une charge associée.</span><span class="sxs-lookup"><span data-stu-id="342f9-474">Say that you create a stateless service and it has some load associated with it.</span></span> <span data-ttu-id="342f9-475">Supposons que le service de hello attentive à mesure de « DiskSpaceInMb » hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-475">Let’s say that hello service cares about hello "DiskSpaceInMb" metric.</span></span> <span data-ttu-id="342f9-476">Supposons également qu’il s’agit des cours tooconsume cinq unités de « DiskSpaceInMb » pour chaque instance du service de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-476">Let's also say that it is going tooconsume five units of "DiskSpaceInMb" for every instance of hello service.</span></span> <span data-ttu-id="342f9-477">Vous souhaitez toocreate trois instances de service de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-477">You want toocreate three instances of hello service.</span></span> <span data-ttu-id="342f9-478">Parfait !</span><span class="sxs-lookup"><span data-stu-id="342f9-478">Great!</span></span> <span data-ttu-id="342f9-479">Afin que signifie que nous devons 15 unités de « DiskSpaceInMb » toobe présente cluster hello afin que nous tooeven être en mesure de toocreate ces instances de service.</span><span class="sxs-lookup"><span data-stu-id="342f9-479">So that means that we need 15 units of "DiskSpaceInMb" toobe present in hello cluster in order for us tooeven be able toocreate these service instances.</span></span> <span data-ttu-id="342f9-480">Hello Gestionnaire de ressources du Cluster calcule en permanence la capacité de hello et la consommation de chaque mesure afin qu’il peut déterminer la capacité restante de hello dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-480">hello Cluster Resource Manager continually calculates hello capacity and consumption of each metric so it can determine hello remaining capacity in hello cluster.</span></span> <span data-ttu-id="342f9-481">Si l’espace est insuffisant, hello Gestionnaire de ressources de Cluster rejette hello créer appel de service.</span><span class="sxs-lookup"><span data-stu-id="342f9-481">If there isn't enough space, hello Cluster Resource Manager rejects hello create service call.</span></span>

<span data-ttu-id="342f9-482">Étant donné que hello exigence est seulement qu’il être 15 unités disponibles, cet espace peut être affecté à différentes façons.</span><span class="sxs-lookup"><span data-stu-id="342f9-482">Since hello requirement is only that there be 15 units available, this space could be allocated many different ways.</span></span> <span data-ttu-id="342f9-483">Par exemple, il peut y avoir une unité restante de capacité sur 15 nœuds différents ou trois unités restantes de capacité sur cinq nœuds différents.</span><span class="sxs-lookup"><span data-stu-id="342f9-483">For example, there could be one remaining unit of capacity on 15 different nodes, or three remaining units of capacity on five different nodes.</span></span> <span data-ttu-id="342f9-484">Si hello Gestionnaire de ressources du Cluster peut réorganiser les choses afin de cinq unités est disponible sur trois nœuds, il place les service hello.</span><span class="sxs-lookup"><span data-stu-id="342f9-484">If hello Cluster Resource Manager can rearrange things so there's five units available on three nodes, it places hello service.</span></span> <span data-ttu-id="342f9-485">Cluster de hello la réorganisation est généralement possible, sauf si le cluster de hello est presque plein ou les services existants hello ne peut pas être consolidées pour une raison quelconque.</span><span class="sxs-lookup"><span data-stu-id="342f9-485">Rearranging hello cluster is usually possible unless hello cluster is almost full or hello existing services can't be consolidated for some reason.</span></span>

## <a name="buffered-capacity"></a><span data-ttu-id="342f9-486">Capacité de mise en mémoire tampon</span><span class="sxs-lookup"><span data-stu-id="342f9-486">Buffered Capacity</span></span>
<span data-ttu-id="342f9-487">Capacité de mise en mémoire tampon est une autre fonctionnalité de hello Gestionnaire de ressources du Cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-487">Buffered capacity is another feature of hello Cluster Resource Manager.</span></span> <span data-ttu-id="342f9-488">Il permet de réservation d’une partie du hello capacité globale du nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-488">It allows reservation of some portion of hello overall node capacity.</span></span> <span data-ttu-id="342f9-489">Cette mémoire tampon de la capacité est tooplace utilisés seuls services au cours des mises à niveau et d’échecs de nœud.</span><span class="sxs-lookup"><span data-stu-id="342f9-489">This capacity buffer is only used tooplace services during upgrades and node failures.</span></span> <span data-ttu-id="342f9-490">La capacité mise en mémoire tampon est spécifiée de manière globale par métrique pour tous les nœuds.</span><span class="sxs-lookup"><span data-stu-id="342f9-490">Buffered Capacity is specified globally per metric for all nodes.</span></span> <span data-ttu-id="342f9-491">valeur Hello choisie pour la capacité de hello réservé est une fonction du nombre de hello de domaines d’erreur et mise à niveau vous avez hello cluster.</span><span class="sxs-lookup"><span data-stu-id="342f9-491">hello value you pick for hello reserved capacity is a function of hello number of Fault and Upgrade Domains you have in hello cluster.</span></span> <span data-ttu-id="342f9-492">Un nombre de domaines d’erreur et de mise à niveau plus important signifie que vous pouvez choisir un nombre inférieur pour la capacité de mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="342f9-492">More Fault and Upgrade Domains means that you can pick a lower number for your buffered capacity.</span></span> <span data-ttu-id="342f9-493">Si vous avez plusieurs domaines, attendez-vous plus petites quantités de votre cluster de toobe indisponible pendant les mises à niveau et d’échecs.</span><span class="sxs-lookup"><span data-stu-id="342f9-493">If you have more domains, you can expect smaller amounts of your cluster toobe unavailable during upgrades and failures.</span></span> <span data-ttu-id="342f9-494">Spécification de capacité de mise en mémoire tampon convient uniquement si vous avez également la capacité de nœud hello spécifié pour une mesure.</span><span class="sxs-lookup"><span data-stu-id="342f9-494">Specifying Buffered Capacity only makes sense if you have also specified hello node capacity for a metric.</span></span>

<span data-ttu-id="342f9-495">Voici un exemple de comment toospecify mis en mémoire tampon capacité :</span><span class="sxs-lookup"><span data-stu-id="342f9-495">Here's an example of how toospecify buffered capacity:</span></span>

<span data-ttu-id="342f9-496">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="342f9-496">ClusterManifest.xml</span></span>

```xml
        <Section Name="NodeBufferPercentage">
            <Parameter Name="SomeMetric" Value="0.15" />
            <Parameter Name="SomeOtherMetric" Value="0.20" />
        </Section>
```

<span data-ttu-id="342f9-497">via ClusterConfig.json pour les déploiements autonomes ou Template.json pour les clusters hébergés sur Azure :</span><span class="sxs-lookup"><span data-stu-id="342f9-497">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "NodeBufferPercentage",
    "parameters": [
      {
          "name": "SomeMetric",
          "value": "0.15"
      },
      {
          "name": "SomeOtherMetric",
          "value": "0.20"
      }
    ]
  }
]
```

<span data-ttu-id="342f9-498">la création de nouveaux services Hello échoue lorsque le cluster de hello dépassement de la capacité de mise en mémoire tampon pour une mesure.</span><span class="sxs-lookup"><span data-stu-id="342f9-498">hello creation of new services fails when hello cluster is out of buffered capacity for a metric.</span></span> <span data-ttu-id="342f9-499">Empêche la création de la nouvelle mémoire tampon services toopreserve hello hello garantit que les échecs et les mises à niveau ne provoquent pas de nœuds toogo surchargés.</span><span class="sxs-lookup"><span data-stu-id="342f9-499">Preventing hello creation of new services toopreserve hello buffer ensures that upgrades and failures don’t cause nodes toogo over capacity.</span></span> <span data-ttu-id="342f9-500">La capacité de mise en mémoire tampon est facultative mais recommandée dans tout cluster qui définit une capacité pour une mesure.</span><span class="sxs-lookup"><span data-stu-id="342f9-500">Buffered capacity is optional but is recommended in any cluster that defines a capacity for a metric.</span></span>

<span data-ttu-id="342f9-501">Hello Gestionnaire du Cluster de ressource expose ces informations de charge.</span><span class="sxs-lookup"><span data-stu-id="342f9-501">hello Cluster Resource Manager exposes this load information.</span></span> <span data-ttu-id="342f9-502">Pour chaque métrique, ces informations incluent :</span><span class="sxs-lookup"><span data-stu-id="342f9-502">For each metric, this information includes:</span></span> 
  - <span data-ttu-id="342f9-503">Hello mis en mémoire tampon de paramètres de capacité</span><span class="sxs-lookup"><span data-stu-id="342f9-503">hello buffered capacity settings</span></span>
  - <span data-ttu-id="342f9-504">capacité totale de Hello</span><span class="sxs-lookup"><span data-stu-id="342f9-504">hello total capacity</span></span>
  - <span data-ttu-id="342f9-505">consommation actuelle de Hello</span><span class="sxs-lookup"><span data-stu-id="342f9-505">hello current consumption</span></span>
  - <span data-ttu-id="342f9-506">une indication de l’état équilibré ou non de chaque métrique ;</span><span class="sxs-lookup"><span data-stu-id="342f9-506">whether each metric is considered balanced or not</span></span>
  - <span data-ttu-id="342f9-507">statistiques concernant l’écart type hello</span><span class="sxs-lookup"><span data-stu-id="342f9-507">statistics about hello standard deviation</span></span>
  - <span data-ttu-id="342f9-508">nœuds Hello ayant hello plus et le moins de charge</span><span class="sxs-lookup"><span data-stu-id="342f9-508">hello nodes which have hello most and least load</span></span>  
  
<span data-ttu-id="342f9-509">Voici un exemple de cette sortie :</span><span class="sxs-lookup"><span data-stu-id="342f9-509">Below we see an example of that output:</span></span>

```posh
PS C:\Users\user> Get-ServiceFabricClusterLoadInformation
LastBalancingStartTimeUtc : 9/1/2016 12:54:59 AM
LastBalancingEndTimeUtc   : 9/1/2016 12:54:59 AM
LoadMetricInformation     :
                            LoadMetricName        : Metric1
                            IsBalancedBefore      : False
                            IsBalancedAfter       : False
                            DeviationBefore       : 0.192450089729875
                            DeviationAfter        : 0.192450089729875
                            BalancingThreshold    : 1
                            Action                : NoActionNeeded
                            ActivityThreshold     : 0
                            ClusterCapacity       : 189
                            ClusterLoad           : 45
                            ClusterRemainingCapacity : 144
                            NodeBufferPercentage  : 10
                            ClusterBufferedCapacity : 170
                            ClusterRemainingBufferedCapacity : 125
                            ClusterCapacityViolation : False
                            MinNodeLoadValue      : 0
                            MinNodeLoadNodeId     : 3ea71e8e01f4b0999b121abcbf27d74d
                            MaxNodeLoadValue      : 15
                            MaxNodeLoadNodeId     : 2cc648b6770be1bc9824fa995d5b68b1
```

## <a name="next-steps"></a><span data-ttu-id="342f9-510">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="342f9-510">Next steps</span></span>
* <span data-ttu-id="342f9-511">Pour plus d’informations sur le flux architecture et les informations de hello dans hello Gestionnaire de ressources de Cluster, consultez [cet article](service-fabric-cluster-resource-manager-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="342f9-511">For information on hello architecture and information flow within hello Cluster Resource Manager, check out [this article ](service-fabric-cluster-resource-manager-architecture.md)</span></span>
* <span data-ttu-id="342f9-512">Défragmentation des mesures sont charge tooconsolidate monodirectionnelle sur les nœuds au lieu de la propagation de. toolearn comment tooconfigure défragmentation, reportez-vous à la section trop[cet article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span><span class="sxs-lookup"><span data-stu-id="342f9-512">Defining Defragmentation Metrics is one way tooconsolidate load on nodes instead of spreading it out. toolearn how tooconfigure defragmentation, refer too[this article](service-fabric-cluster-resource-manager-defragmentation-metrics.md)</span></span>
* <span data-ttu-id="342f9-513">Démarrer à partir du début de hello et [obtenir une présentation de toohello Gestionnaire de ressources du Cluster Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="342f9-513">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>
* <span data-ttu-id="342f9-514">toofind out sur comment hello Gestionnaire de ressources de Cluster gère et équilibre la charge du cluster de hello, consultez l’article de hello sur [équilibrage de charge](service-fabric-cluster-resource-manager-balancing.md)</span><span class="sxs-lookup"><span data-stu-id="342f9-514">toofind out about how hello Cluster Resource Manager manages and balances load in hello cluster, check out hello article on [balancing load](service-fabric-cluster-resource-manager-balancing.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-domains.png
[Image2]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-uneven-fault-domain-layout.png
[Image3]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domains-with-placement.png
[Image4]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-fault-and-upgrade-domain-layout-strategies.png
[Image5]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-layout-different-workloads.png
[Image6]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-placement-constraints-node-properties.png
[Image7]:./media/service-fabric-cluster-resource-manager-cluster-description/cluster-nodes-and-capacity.png
