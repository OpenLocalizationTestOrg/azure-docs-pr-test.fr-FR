---
title: "Planification de la capacité pour les applications Service Fabric | Microsoft Docs"
description: "Explique comment identifier le nombre de nœuds de calcul requis pour une application Service Fabric"
services: service-fabric
documentationcenter: .net
author: mani-ramaswamy
manager: markfuss
editor: 
ms.assetid: 9fa47be0-50a2-4a51-84a5-20992af94bea
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 8/9/2017
ms.author: subramar
ms.openlocfilehash: fc98bdd8b3597810b0c07563af507e93c611f769
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="capacity-planning-for-service-fabric-applications"></a><span data-ttu-id="6ff39-103">Planification de la capacité pour les applications Service Fabric</span><span class="sxs-lookup"><span data-stu-id="6ff39-103">Capacity planning for Service Fabric applications</span></span>
<span data-ttu-id="6ff39-104">Ce document explique comment estimer la quantité de ressources (UC, RAM, stockage sur disque) dont vous avez besoin pour exécuter vos applications Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="6ff39-104">This document teaches you how to estimate the amount of resources (CPUs, RAM, disk storage) you need to run your Azure Service Fabric applications.</span></span> <span data-ttu-id="6ff39-105">Il est courant que les ressources requises changent au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="6ff39-105">It is common for your resource requirements to change over time.</span></span> <span data-ttu-id="6ff39-106">Vous avez besoin généralement de peu de ressources quand vous développez/testez votre service, puis vous avez besoin de plus de ressources quand vous passez en production et que votre application grandit en popularité.</span><span class="sxs-lookup"><span data-stu-id="6ff39-106">You typically require few resources as you develop/test your service, and then require more resources as you go into production and your application grows in popularity.</span></span> <span data-ttu-id="6ff39-107">Quand vous concevez votre application, réfléchissez à la configuration requise à long terme et faites des choix qui permettront à votre service d’évoluer pour répondre à la hausse de demande des clients.</span><span class="sxs-lookup"><span data-stu-id="6ff39-107">When you design your application, think through the long-term requirements and make choices that allow your service to scale to meet high customer demand.</span></span>

 <span data-ttu-id="6ff39-108">Quand vous créez un cluster Service Fabric, vous décidez quels types de machines virtuelles (VM) doivent le constituer.</span><span class="sxs-lookup"><span data-stu-id="6ff39-108">When you create a Service Fabric cluster, you decide what kinds of virtual machines (VMs) make up the cluster.</span></span> <span data-ttu-id="6ff39-109">Chaque machine virtuelle est fournie avec une quantité limitée de ressources sous forme d’UC (cœurs et vitesse), bande passante réseau, mémoire RAM et stockage sur disque.</span><span class="sxs-lookup"><span data-stu-id="6ff39-109">Each VM comes with a limited amount of resources in the form of CPUs (cores and speed), network bandwidth, RAM, and disk storage.</span></span> <span data-ttu-id="6ff39-110">À mesure que votre service croît, vous pouvez effectuer des mises à niveau vers des machines virtuelles qui offrent davantage de ressources et/ou ajouter des machines virtuelles à votre cluster.</span><span class="sxs-lookup"><span data-stu-id="6ff39-110">As your service grows over time, you can upgrade to VMs that offer greater resources and/or add more VMs to your cluster.</span></span> <span data-ttu-id="6ff39-111">Dans ce dernier cas, vous devez créer l’architecture de votre service initialement de façon à tirer parti des nouvelles machines virtuelles ajoutées dynamiquement au cluster.</span><span class="sxs-lookup"><span data-stu-id="6ff39-111">To do the latter, you must architect your service initially so it can take advantage of new VMs that get dynamically added to the cluster.</span></span>

<span data-ttu-id="6ff39-112">Certains services gèrent peu à pas de données sur les machines virtuelles proprement dites.</span><span class="sxs-lookup"><span data-stu-id="6ff39-112">Some services manage little to no data on the VMs themselves.</span></span> <span data-ttu-id="6ff39-113">Par conséquent, la planification de capacité pour ces services doit se concentrer principalement sur les performances, ce qui signifie qu’il faut sélectionner les unités centrales appropriées (cœurs et vitesse) des machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="6ff39-113">Therefore, capacity planning for these services should focus primarily on performance, which means selecting the appropriate CPUs (cores and speed) of the VMs.</span></span> <span data-ttu-id="6ff39-114">En outre, vous devez prendre en compte la bande passante réseau, notamment la fréquence des transferts réseau et la quantité de données transférées.</span><span class="sxs-lookup"><span data-stu-id="6ff39-114">In addition, you should consider network bandwidth, including how frequently network transfers are occurring and how much data is being transferred.</span></span> <span data-ttu-id="6ff39-115">Si votre service doit être performant lorsque l'utilisation de service augmente, vous pouvez ajouter davantage de machines virtuelles dans le cluster et équilibrer la charge des demandes réseau entre les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="6ff39-115">If your service needs to perform well as service usage increases, you can add more VMs to the cluster and load balance the network requests across all the VMs.</span></span>

<span data-ttu-id="6ff39-116">Pour les services qui gèrent de grandes quantités de données sur les machines virtuelles, la planification de la capacité doit se concentrer principalement sur la taille.</span><span class="sxs-lookup"><span data-stu-id="6ff39-116">For services that manage large amounts of data on the VMs, capacity planning should focus primarily on size.</span></span> <span data-ttu-id="6ff39-117">Cela signifie donc que vous devez être attentif à la capacité de RAM et du stockage sur disque de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6ff39-117">Thus, you should carefully consider the capacity of the VM's RAM and disk storage.</span></span> <span data-ttu-id="6ff39-118">Le système de gestion de mémoire virtuelle dans Windows rend l’espace disque similaire à la RAM pour le code d’application.</span><span class="sxs-lookup"><span data-stu-id="6ff39-118">The virtual memory management system in Windows makes disk space look like RAM to application code.</span></span> <span data-ttu-id="6ff39-119">En outre, le runtime Service Fabric offre la pagination intelligente en conservant uniquement les données à chaud en mémoire et en déplaçant les données à froid sur le disque.</span><span class="sxs-lookup"><span data-stu-id="6ff39-119">In addition, the Service Fabric runtime provides smart paging keeping only hot data in memory and moving the cold data to disk.</span></span> <span data-ttu-id="6ff39-120">Cela permet aux applications d’utiliser plus de mémoire que la quantité physique disponible sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6ff39-120">Applications can thus use more memory than is physically available on the VM.</span></span> <span data-ttu-id="6ff39-121">Avoir plus de mémoire vive augmente simplement les performances, car la machine virtuelle peut conserver davantage de stockage sur disque dans la mémoire RAM.</span><span class="sxs-lookup"><span data-stu-id="6ff39-121">Having more RAM simply increases performance, since the VM can keep more disk storage in RAM.</span></span> <span data-ttu-id="6ff39-122">La machine virtuelle que vous sélectionnez doit avoir un disque suffisamment grand pour stocker les données que vous souhaitez sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6ff39-122">The VM you select should have a disk large enough to store the data that you want on the VM.</span></span> <span data-ttu-id="6ff39-123">De même, la machine virtuelle doit avoir suffisamment de RAM pour vous fournir les performances souhaitées.</span><span class="sxs-lookup"><span data-stu-id="6ff39-123">Similarly, the VM should have enough RAM to provide you with the performance you desire.</span></span> <span data-ttu-id="6ff39-124">Si les données de votre service augmentent au fil du temps, vous pouvez ajouter davantage de machines virtuelles au cluster et partitionner les données entre les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="6ff39-124">If your service's data grows over time, you can add more VMs to the cluster and partition the data across all the VMs.</span></span>

## <a name="determine-how-many-nodes-you-need"></a><span data-ttu-id="6ff39-125">Déterminer le nombre de nœuds nécessaire</span><span class="sxs-lookup"><span data-stu-id="6ff39-125">Determine how many nodes you need</span></span>
<span data-ttu-id="6ff39-126">Le fait de partitionner votre service vous permet d’augmenter la taille des instances des données de votre service.</span><span class="sxs-lookup"><span data-stu-id="6ff39-126">Partitioning your service allows you to scale out your service's data.</span></span> <span data-ttu-id="6ff39-127">Pour plus d’informations sur le partitionnement, consultez [Partitionnement de Service Fabric](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="6ff39-127">For more information on partitioning, see [Partitioning Service Fabric](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="6ff39-128">Chaque partition doit tenir sur une seule machine virtuelle, mais plusieurs (petites) partitions peuvent être placées sur une seule machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6ff39-128">Each partition must fit within a single VM, but multiple (small) partitions can be placed on a single VM.</span></span> <span data-ttu-id="6ff39-129">Ainsi, avoir plus de petites partitions offre davantage de souplesse que d’avoir un petit nombre de grandes partitions.</span><span class="sxs-lookup"><span data-stu-id="6ff39-129">So, having more small partitions gives you greater flexibility than having a few larger partitions.</span></span> <span data-ttu-id="6ff39-130">En contrepartie, disposer d’un grand nombre de partitions augmente la charge de Service Fabric et vous ne pouvez pas effectuer des opérations traitées sur plusieurs partitions.</span><span class="sxs-lookup"><span data-stu-id="6ff39-130">The trade-off is that having lots of partitions increases Service Fabric overhead and you cannot perform transacted operations across partitions.</span></span> <span data-ttu-id="6ff39-131">Il y a également plus de trafic réseau potentiel si votre code de service doit fréquemment accéder à des éléments de données qui résident dans des partitions différentes.</span><span class="sxs-lookup"><span data-stu-id="6ff39-131">There is also more potential network traffic if your service code frequently needs to access pieces of data that live in different partitions.</span></span> <span data-ttu-id="6ff39-132">Lorsque vous concevez votre service, vous devez étudier soigneusement ces avantages et inconvénients pour obtenir une stratégie de partitionnement efficace.</span><span class="sxs-lookup"><span data-stu-id="6ff39-132">When designing your service, you should carefully consider these pros and cons to arrive at an effective partitioning strategy.</span></span>

<span data-ttu-id="6ff39-133">Supposons que votre application possède un seul service avec état qui a une taille de magasin qui doit atteindre DB_Size Go dans un an.</span><span class="sxs-lookup"><span data-stu-id="6ff39-133">Let's assume your application has a single stateful service that has a store size that you expect to grow to DB_Size GB in a year.</span></span> <span data-ttu-id="6ff39-134">Vous êtes prêt à ajouter d’autres applications (et partitions) pour accompagner votre croissance au-delà de cette année.</span><span class="sxs-lookup"><span data-stu-id="6ff39-134">You are willing to add more applications (and partitions) as you experience growth beyond that year.</span></span>  <span data-ttu-id="6ff39-135">Le facteur de réplication (RF), qui détermine le nombre de réplicas pour votre service a une incidence sur la taille DB_Size totale.</span><span class="sxs-lookup"><span data-stu-id="6ff39-135">The replication factor (RF), which determines the number of replicas for your service impacts the total DB_Size.</span></span> <span data-ttu-id="6ff39-136">La taille DB_Size totale sur tous les réplicas correspond au facteur de réplication (RF) multiplié par DB_Size.</span><span class="sxs-lookup"><span data-stu-id="6ff39-136">The total DB_Size across all replicas is the Replication Factor multiplied by DB_Size.</span></span>  <span data-ttu-id="6ff39-137">Node_Size représente l’espace disque/la RAM par nœud que vous souhaitez utiliser pour votre service.</span><span class="sxs-lookup"><span data-stu-id="6ff39-137">Node_Size represents the disk space/RAM per node you want to use for your service.</span></span> <span data-ttu-id="6ff39-138">Pour de meilleures performances, DB_Size doit tenir dans la mémoire au sein du cluster et vous devez utiliser une taille Node_Size équivalente à la RAM de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="6ff39-138">For best performance, the DB_Size should fit into memory across the cluster, and a Node_Size that is around the RAM of the VM should be chosen.</span></span> <span data-ttu-id="6ff39-139">En allouant une valeur Node_Size qui est supérieure à la capacité de la mémoire RAM, vous vous reposez sur la pagination fournie par le runtime Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="6ff39-139">By allocating a Node_Size that is larger than the RAM capacity, you are relying on the paging provided by the Service Fabric runtime.</span></span> <span data-ttu-id="6ff39-140">Par conséquent, les performances peuvent ne pas être optimales si toutes vos données sont considérées comme étant à chaud (car alors les données sont paginées en entrée/sortie).</span><span class="sxs-lookup"><span data-stu-id="6ff39-140">Thus, your performance may not be optimal if your entire data is considered to be hot (since then the data is paged in/out).</span></span> <span data-ttu-id="6ff39-141">Toutefois, pour de nombreux services où seule une fraction des données est à chaud, cela est plus rentable.</span><span class="sxs-lookup"><span data-stu-id="6ff39-141">However, for many services where only a fraction of the data is hot, it is more cost-effective.</span></span>

<span data-ttu-id="6ff39-142">Le nombre de nœuds nécessaires pour optimiser les performances peut être calculé comme suit :</span><span class="sxs-lookup"><span data-stu-id="6ff39-142">The number of nodes required for maximum performance can be computed as follows:</span></span>

```
Number of Nodes = (DB_Size * RF)/Node_Size

```


## <a name="account-for-growth"></a><span data-ttu-id="6ff39-143">Prendre la croissance en compte</span><span class="sxs-lookup"><span data-stu-id="6ff39-143">Account for growth</span></span>
<span data-ttu-id="6ff39-144">Vous pouvez calculer le nombre de nœuds en fonction de la valeur DB_Size que votre service doit atteindre selon vous, en plus de la valeur DB_Size avec laquelle vous avez commencé.</span><span class="sxs-lookup"><span data-stu-id="6ff39-144">You may want to compute the number of nodes based on the DB_Size that you expect your service to grow to, in addition to the DB_Size that you began with.</span></span> <span data-ttu-id="6ff39-145">Vous pouvez ensuite augmenter le nombre de nœuds à mesure que votre service se développe afin de ne pas surapprovisionner le nombre de nœuds.</span><span class="sxs-lookup"><span data-stu-id="6ff39-145">Then, grow the number of nodes as your service grows so that you are not over-provisioning the number of nodes.</span></span> <span data-ttu-id="6ff39-146">Toutefois, le nombre de partitions doit être basé sur le nombre de nœuds qui sont nécessaires quand vous exécutez votre service à croissance maximale.</span><span class="sxs-lookup"><span data-stu-id="6ff39-146">But the number of partitions should be based on the number of nodes that are needed when you're running your service at maximum growth.</span></span>

<span data-ttu-id="6ff39-147">Il est judicieux d’avoir des ordinateurs supplémentaires disponibles à tout moment afin de pouvoir gérer les pics ou les défaillances inattendus (si, par exemple, plusieurs machines virtuelles tombent en panne).</span><span class="sxs-lookup"><span data-stu-id="6ff39-147">It is good to have some extra machines available at any time so that you can handle any unexpected spikes or failure (for example, if a few VMs go down).</span></span>  <span data-ttu-id="6ff39-148">Bien que la capacité supplémentaire doive être déterminée à l’aide de vos pics attendus, un bon point de départ consiste à réserver quelques machines virtuelles supplémentaires (5 à 10 % supplémentaires).</span><span class="sxs-lookup"><span data-stu-id="6ff39-148">While the extra capacity should be determined by using your expected spikes, a starting point is to reserve a few extra VMs (5-10 percent extra).</span></span>

<span data-ttu-id="6ff39-149">La proposition ci-dessus suppose un seul service avec état.</span><span class="sxs-lookup"><span data-stu-id="6ff39-149">The preceding assumes a single stateful service.</span></span> <span data-ttu-id="6ff39-150">Si vous avez plus d’un service avec état, vous devez ajouter la valeur DB_Size associée aux autres services dans l’équation.</span><span class="sxs-lookup"><span data-stu-id="6ff39-150">If you have more than one stateful service, you have to add the DB_Size associated with the other services into the equation.</span></span> <span data-ttu-id="6ff39-151">Vous pouvez également calculer le nombre de nœuds séparément pour chaque service avec état.</span><span class="sxs-lookup"><span data-stu-id="6ff39-151">Alternatively, you can compute the number of nodes separately for each stateful service.</span></span>  <span data-ttu-id="6ff39-152">Votre service peut avoir des réplicas ou des partitions qui ne sont pas équilibrés.</span><span class="sxs-lookup"><span data-stu-id="6ff39-152">Your service may have replicas or partitions that aren't balanced.</span></span> <span data-ttu-id="6ff39-153">N’oubliez pas que certaines partitions peuvent également contenir plus de données que d’autres.</span><span class="sxs-lookup"><span data-stu-id="6ff39-153">Keep in mind that partitions may also have more data than others.</span></span> <span data-ttu-id="6ff39-154">Pour plus d’informations sur le partitionnement, consultez [l’article sur les meilleures pratiques de partitionnement](service-fabric-concepts-partitioning.md).</span><span class="sxs-lookup"><span data-stu-id="6ff39-154">For more information on partitioning, see [partitioning article on best practices](service-fabric-concepts-partitioning.md).</span></span> <span data-ttu-id="6ff39-155">Toutefois, l’équation précédente ne tient pas compte des partitions et des réplicas, car Service Fabric garantit que les réplicas sont répartis entre les nœuds de manière optimisée.</span><span class="sxs-lookup"><span data-stu-id="6ff39-155">However, the preceding equation is partition and replica agnostic, because Service Fabric ensures that the replicas are spread out among the nodes in an optimized manner.</span></span>

## <a name="use-a-spreadsheet-for-cost-calculation"></a><span data-ttu-id="6ff39-156">Utiliser une feuille de calcul pour le calcul des coûts</span><span class="sxs-lookup"><span data-stu-id="6ff39-156">Use a spreadsheet for cost calculation</span></span>
<span data-ttu-id="6ff39-157">Maintenant, nous allons placer des chiffres réels dans la formule.</span><span class="sxs-lookup"><span data-stu-id="6ff39-157">Now let's put some real numbers in the formula.</span></span> <span data-ttu-id="6ff39-158">Un [exemple de feuille de calcul](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) montre comment planifier la capacité pour une application qui contient trois types d’objets de données.</span><span class="sxs-lookup"><span data-stu-id="6ff39-158">An [example spreadsheet](https://servicefabricsdkstorage.blob.core.windows.net/publicrelease/SF%20VM%20Cost%20calculator-NEW.xlsx) shows how to plan the capacity for an application that contains three types of data objects.</span></span> <span data-ttu-id="6ff39-159">Pour chaque objet, nous estimons sa taille et le nombre d'objets que nous nous attendons à avoir.</span><span class="sxs-lookup"><span data-stu-id="6ff39-159">For each object, we approximate its size and how many objects we expect to have.</span></span> <span data-ttu-id="6ff39-160">Nous sélectionnons également le nombre de réplicas pour chaque type d’objet.</span><span class="sxs-lookup"><span data-stu-id="6ff39-160">We also select how many replicas we want of each object type.</span></span> <span data-ttu-id="6ff39-161">La feuille de calcul calcule la quantité totale de mémoire à stocker dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="6ff39-161">The spreadsheet calculates the total amount of memory to be stored in the cluster.</span></span>

<span data-ttu-id="6ff39-162">Ensuite, nous entrons une taille de machine virtuelle et le coût mensuel.</span><span class="sxs-lookup"><span data-stu-id="6ff39-162">Then we enter a VM size and monthly cost.</span></span> <span data-ttu-id="6ff39-163">Selon la taille de la machine virtuelle, la feuille de calcul vous indique le nombre minimal de partitions nécessaires à la répartition physique des données sur les nœuds.</span><span class="sxs-lookup"><span data-stu-id="6ff39-163">Based on the VM size, the spreadsheet tells you the minimum number of partitions you must use to split your data to physically fit on the nodes.</span></span> <span data-ttu-id="6ff39-164">Vous pouvez souhaiter un plus grand nombre de partitions pour prendre en charge les besoins en calcul et trafic réseau spécifiques de votre application.</span><span class="sxs-lookup"><span data-stu-id="6ff39-164">You may desire a larger number of partitions to accommodate your application's specific computation and network traffic needs.</span></span> <span data-ttu-id="6ff39-165">La feuille de calcul montre que le nombre de partitions pour gérer les objets de profils utilisateur est passé de un à six.</span><span class="sxs-lookup"><span data-stu-id="6ff39-165">The spreadsheet shows the number of partitions that are managing the user profile objects has increased from one to six.</span></span>

<span data-ttu-id="6ff39-166">À présent, avec toutes ces informations, la feuille de calcul montre que vous pouvez physiquement obtenir toutes les données avec les partitions et les réplicas souhaités sur un cluster de 26 nœuds.</span><span class="sxs-lookup"><span data-stu-id="6ff39-166">Now, based on all this information, the spreadsheet shows that you could physically get all the data with the desired partitions and replicas on a 26-node cluster.</span></span> <span data-ttu-id="6ff39-167">Toutefois, ce cluster étant très compact, vous pouvez vouloir des nœuds supplémentaires pour prendre en charge les mises à niveau et les défaillances de nœud.</span><span class="sxs-lookup"><span data-stu-id="6ff39-167">However, this cluster would be densely packed, so you may want some additional nodes to accommodate node failures and upgrades.</span></span> <span data-ttu-id="6ff39-168">La feuille de calcul indique également qu’avoir plus de 57 nœuds ne fournit aucune valeur supplémentaire, car vous auriez des nœuds vides.</span><span class="sxs-lookup"><span data-stu-id="6ff39-168">The spreadsheet also shows that having more than 57 nodes provides no additional value because you would have empty nodes.</span></span> <span data-ttu-id="6ff39-169">Là encore, vous souhaiterez peut-être aller au-dessus des 57 nœuds malgré tout pour prendre en charge les mises à niveau et les défaillances de nœud.</span><span class="sxs-lookup"><span data-stu-id="6ff39-169">Again, you may want to go above 57 nodes anyway to accommodate node failures and upgrades.</span></span> <span data-ttu-id="6ff39-170">Vous pouvez modifier la feuille de calcul pour répondre aux besoins spécifiques de votre application.</span><span class="sxs-lookup"><span data-stu-id="6ff39-170">You can tweak the spreadsheet to match your application's specific needs.</span></span>   

![Feuille de calcul pour le calcul des coûts][Image1]

## <a name="next-steps"></a><span data-ttu-id="6ff39-172">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="6ff39-172">Next steps</span></span>
<span data-ttu-id="6ff39-173">Consultez la page [Partitionnement des services Service Fabric][10] pour en savoir plus sur le partitionnement de votre service.</span><span class="sxs-lookup"><span data-stu-id="6ff39-173">Check out [Partitioning Service Fabric services][10] to learn more about partitioning your service.</span></span>

<!--Image references-->
[Image1]: ./media/SF-Cost.png

<!--Link references--In actual articles, you only need a single period before the slash-->
[10]: service-fabric-concepts-partitioning.md
