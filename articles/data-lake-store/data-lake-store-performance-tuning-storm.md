---
title: "Recommandations en matière d’optimisation des performances d’Azure Data Lake Store Storm | Microsoft Docs"
description: "Recommandations en matière d’optimisation des performances d’Azure Data Lake Store Storm"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 1dfa93643f45a96ded3fd022aa8b1c71d487acb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-storm-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="527be-103">Recommandations en matière d’optimisation des performances pour Storm sur HDInsight et Azure Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="527be-103">Performance tuning guidance for Storm on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="527be-104">Comprendre les facteurs à prendre en compte lorsque vous optimisez les performances d’une topologie Storm dans Azure.</span><span class="sxs-lookup"><span data-stu-id="527be-104">Understand the factors that should be considered when you tune the performance of an Azure Storm topology.</span></span> <span data-ttu-id="527be-105">Par exemple, il est important de comprendre les caractéristiques du travail effectué par les Spouts et les Bolts (si le travail est intensif en E/S ou en mémoire).</span><span class="sxs-lookup"><span data-stu-id="527be-105">For example, it's important to understand the characteristics of the work done by the spouts and the bolts (whether the work is I/O or memory intensive).</span></span> <span data-ttu-id="527be-106">Cet article aborde diverses recommandations d’optimisation des performances, y compris la résolution des problèmes courants.</span><span class="sxs-lookup"><span data-stu-id="527be-106">This article covers a range of performance tuning guidelines, including troubleshooting common issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="527be-107">Composants requis</span><span class="sxs-lookup"><span data-stu-id="527be-107">Prerequisites</span></span>

* <span data-ttu-id="527be-108">**Un abonnement Azure**.</span><span class="sxs-lookup"><span data-stu-id="527be-108">**An Azure subscription**.</span></span> <span data-ttu-id="527be-109">Consultez la page [Obtention d’un essai gratuit d’Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="527be-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="527be-110">**Un compte Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="527be-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="527be-111">Pour savoir comment en créer un, consultez [Prise en main d’Azure Data Lake Store](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="527be-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md).</span></span>
* <span data-ttu-id="527be-112">**Un cluster Azure HDInsight** ayant accès à un compte Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="527be-112">**An Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="527be-113">Voir [Créer un cluster HDInsight avec Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="527be-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="527be-114">Veillez à activer le Bureau à distance pour le cluster.</span><span class="sxs-lookup"><span data-stu-id="527be-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="527be-115">**Exécution d’un cluster Storm sur Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="527be-115">**Running a Storm cluster on Data Lake Store**.</span></span> <span data-ttu-id="527be-116">Pour plus d’informations, consultez [Présentation d’Apache Storm sur HDInsight : analyse en temps réel pour Hadoop](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span><span class="sxs-lookup"><span data-stu-id="527be-116">For more information, see [Storm on HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span></span>
* <span data-ttu-id="527be-117">**Recommandations en matière d’optimisation des performances sur Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="527be-117">**Performance tuning guidelines on Data Lake Store**.</span></span>  <span data-ttu-id="527be-118">Pour les concepts généraux sur les performances, consultez [Recommandations en matière d’optimisation des performances pour Azure Data Lake Store](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="527be-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span></span>  

## <a name="tune-the-parallelism-of-the-topology"></a><span data-ttu-id="527be-119">Ajuster le parallélisme de la topologie</span><span class="sxs-lookup"><span data-stu-id="527be-119">Tune the parallelism of the topology</span></span>

<span data-ttu-id="527be-120">Vous pouvez améliorer les performances en augmentant l’accès concurrentiel des E/S vers et à partir de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="527be-120">You might be able to improve performance by increasing the concurrency of the I/O to and from Data Lake Store.</span></span> <span data-ttu-id="527be-121">Une topologie Storm possède un ensemble de configurations qui déterminent le parallélisme :</span><span class="sxs-lookup"><span data-stu-id="527be-121">A Storm topology has a set of configurations that determine the parallelism:</span></span>
* <span data-ttu-id="527be-122">Nombre de processus Worker (les Workers sont répartis uniformément sur les machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="527be-122">Number of worker processes (the workers are evenly distributed across the VMs).</span></span>
* <span data-ttu-id="527be-123">Nombre d’instances d’exécuteur de Spout.</span><span class="sxs-lookup"><span data-stu-id="527be-123">Number of spout executor instances.</span></span>
* <span data-ttu-id="527be-124">Nombre d’instances d’exécuteur de Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-124">Number of bolt executor instances.</span></span>
* <span data-ttu-id="527be-125">Nombre de tâches de Spout.</span><span class="sxs-lookup"><span data-stu-id="527be-125">Number of spout tasks.</span></span>
* <span data-ttu-id="527be-126">Nombre de tâches de Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-126">Number of bolt tasks.</span></span>

<span data-ttu-id="527be-127">Par exemple, sur un cluster avec 4 machines virtuelles et 4 processus Worker, 32 exécuteurs de Spout et 32 tâches de Spout, 256 exécuteurs de Bolt et 512 tâches de Bolt, prenez en compte les aspects suivants :</span><span class="sxs-lookup"><span data-stu-id="527be-127">For example, on a cluster with 4 VMs and 4 worker processes, 32 spout executors and 32 spout tasks, and 256 bolt executors and 512 bolt tasks, consider the following:</span></span>

<span data-ttu-id="527be-128">Chaque superviseur, qui est un nœud Worker, a un seul processus Worker de machine virtuelle Java.</span><span class="sxs-lookup"><span data-stu-id="527be-128">Each supervisor, which is a worker node, has a single worker Java virtual machine (JVM) process.</span></span> <span data-ttu-id="527be-129">Ce processus de machine virtuelle Java gère 4 threads de Spout et 64 threads de Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-129">This JVM process manages 4 spout threads and 64 bolt threads.</span></span> <span data-ttu-id="527be-130">Au sein de chaque thread, les tâches sont exécutées séquentiellement.</span><span class="sxs-lookup"><span data-stu-id="527be-130">Within each thread, tasks are run sequentially.</span></span> <span data-ttu-id="527be-131">Avec la configuration précédente, chaque thread de Spout comporte 1 tâche, et chaque thread de Bolt comporte 2 tâches.</span><span class="sxs-lookup"><span data-stu-id="527be-131">With the preceding configuration, each spout thread has 1 task, and each bolt thread has 2 tasks.</span></span>

<span data-ttu-id="527be-132">Dans Storm, voici les différents composants impliqués et leur impact sur le niveau de parallélisme que vous obtenez :</span><span class="sxs-lookup"><span data-stu-id="527be-132">In Storm, here are the various components involved, and how they affect the level of parallelism you have:</span></span>
* <span data-ttu-id="527be-133">Le nœud principal (appelé Nimbus dans Storm) est utilisé pour envoyer et gérer les travaux.</span><span class="sxs-lookup"><span data-stu-id="527be-133">The head node (called Nimbus in Storm) is used to submit and manage jobs.</span></span> <span data-ttu-id="527be-134">Ces nœuds n’ont aucun impact sur le degré de parallélisme.</span><span class="sxs-lookup"><span data-stu-id="527be-134">These nodes have no impact on the degree of parallelism.</span></span>
* <span data-ttu-id="527be-135">Les nœuds superviseurs.</span><span class="sxs-lookup"><span data-stu-id="527be-135">The supervisor nodes.</span></span> <span data-ttu-id="527be-136">Dans HDInsight, ils correspondent aux nœuds Worker de machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="527be-136">In HDInsight, this corresponds to a worker node Azure VM.</span></span>
* <span data-ttu-id="527be-137">Les tâches worker sont des processus Storm s’exécutant sur des machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="527be-137">The worker tasks are Storm processes running in the VMs.</span></span> <span data-ttu-id="527be-138">Chaque tâche Worker correspond à une instance de machine virtuelle Java.</span><span class="sxs-lookup"><span data-stu-id="527be-138">Each worker task corresponds to a JVM instance.</span></span> <span data-ttu-id="527be-139">Storm distribue le nombre de processus worker que vous spécifiez de manière aussi égale que possible sur les nœuds de travail.</span><span class="sxs-lookup"><span data-stu-id="527be-139">Storm distributes the number of worker processes you specify to the worker nodes as evenly as possible.</span></span>
* <span data-ttu-id="527be-140">Instances d’exécuteur de Spout et de Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-140">Spout and bolt executor instances.</span></span> <span data-ttu-id="527be-141">Chaque instance d’exécuteur correspond à un thread s’exécutant dans les processus Worker (machine virtuelle Java).</span><span class="sxs-lookup"><span data-stu-id="527be-141">Each executor instance corresponds to a thread running within the workers (JVMs).</span></span>
* <span data-ttu-id="527be-142">Tâches de Storm.</span><span class="sxs-lookup"><span data-stu-id="527be-142">Storm tasks.</span></span> <span data-ttu-id="527be-143">Il s’agit des tâches logiques exécutées par chacun de ces threads.</span><span class="sxs-lookup"><span data-stu-id="527be-143">These are logical tasks that each of these threads run.</span></span> <span data-ttu-id="527be-144">Cela ne modifie pas le niveau de parallélisme. Vous devez donc évaluer si vous avez besoin de plusieurs tâches par exécuteur ou non.</span><span class="sxs-lookup"><span data-stu-id="527be-144">This does not change the level of parallelism, so you should evaluate if you need multiple tasks per executor or not.</span></span>

### <a name="get-the-best-performance-from-data-lake-store"></a><span data-ttu-id="527be-145">Obtenir des performances optimales pour Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="527be-145">Get the best performance from Data Lake Store</span></span>

<span data-ttu-id="527be-146">Lorsque vous travaillez avec Data Lake Store, vous obtenez des performances optimales si vous procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="527be-146">When working with Data Lake Store, you get the best performance if you do the following:</span></span>
* <span data-ttu-id="527be-147">Fusionnez vos petits éléments dans des tailles supérieures (idéalement 4 Mo).</span><span class="sxs-lookup"><span data-stu-id="527be-147">Coalesce your small appends into larger sizes (ideally 4 MB).</span></span>
* <span data-ttu-id="527be-148">Effectuez autant de requêtes simultanées que vous le pouvez.</span><span class="sxs-lookup"><span data-stu-id="527be-148">Do as many concurrent requests as you can.</span></span> <span data-ttu-id="527be-149">Étant donné que chaque thread de Bolt effectue des lectures bloquantes, il est préférable d’avoir un nombre de threads dans la plage de 8 à 12 par cœur.</span><span class="sxs-lookup"><span data-stu-id="527be-149">Because each bolt thread is doing blocking reads, you want to have somewhere in the range of 8-12 threads per core.</span></span> <span data-ttu-id="527be-150">Cela permet de garantir une utilisation correcte de la carte réseau et du processeur.</span><span class="sxs-lookup"><span data-stu-id="527be-150">This keeps the NIC and the CPU well utilized.</span></span> <span data-ttu-id="527be-151">Une machine virtuelle plus grande permet d’avoir plus de demandes simultanées.</span><span class="sxs-lookup"><span data-stu-id="527be-151">A larger VM enables more concurrent requests.</span></span>  

### <a name="example-topology"></a><span data-ttu-id="527be-152">Exemple de topologie</span><span class="sxs-lookup"><span data-stu-id="527be-152">Example topology</span></span>

<span data-ttu-id="527be-153">Supposons que vous disposez d’un cluster de 8 nœuds Worker avec une machine virtuelle Azure D13v2.</span><span class="sxs-lookup"><span data-stu-id="527be-153">Let’s assume you have an 8 worker node cluster with a D13v2 Azure VM.</span></span> <span data-ttu-id="527be-154">Cette machine virtuelle a 8 cœurs, donc sur les 8 nœuds Worker, vous avez un total de 64 cœurs.</span><span class="sxs-lookup"><span data-stu-id="527be-154">This VM has 8 cores, so among the 8 worker nodes, you have 64 total cores.</span></span>

<span data-ttu-id="527be-155">Supposons que nous utilisons 8 threads bolt par cœur.</span><span class="sxs-lookup"><span data-stu-id="527be-155">Let’s say we do 8 bolt threads per core.</span></span> <span data-ttu-id="527be-156">Avec 64 cœurs, nous voulons 512 instances (c’est-à-dire les threads) d’exécuteur de Bolt au total.</span><span class="sxs-lookup"><span data-stu-id="527be-156">Given 64 cores, that means we want 512 total bolt executor instances (that is, threads).</span></span> <span data-ttu-id="527be-157">Dans ce cas, supposons que nous commençons avec une machine virtuelle Java par machine virtuelle et utilisons principalement l’accès concurrentiel des threads dans la machine virtuelle Java pour obtenir l’accès concurrentiel.</span><span class="sxs-lookup"><span data-stu-id="527be-157">In this case, let’s say we start with one JVM per VM, and mainly use the thread concurrency within the JVM to achieve concurrency.</span></span> <span data-ttu-id="527be-158">Cela signifie que nous avons besoins de 8 tâches worker (une par machine virtuelle Azure) et 512 exécuteurs bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-158">That means we need 8 worker tasks (one per Azure VM), and 512 bolt executors.</span></span> <span data-ttu-id="527be-159">Avec cette configuration, Storm va tenter de distribuer les Workers uniformément entre les nœuds Worker (également appelés nœuds superviseurs), en donnant à chaque nœud Worker une machine virtuelle Java.</span><span class="sxs-lookup"><span data-stu-id="527be-159">Given this configuration, Storm tries to distribute the workers evenly across worker nodes (also known as supervisor nodes), giving each worker node 1 JVM.</span></span> <span data-ttu-id="527be-160">À présent dans l’exemple, Storm tente de distribuer les exécuteurs uniformément entre les superviseurs, en donnant à chaque superviseur (c’est-à-dire chaque machine virtuelle Java) 8 threads chacun.</span><span class="sxs-lookup"><span data-stu-id="527be-160">Now within the supervisors, Storm tries to distribute the executors evenly between supervisors, giving each supervisor (that is, JVM) 8 threads each.</span></span>

## <a name="tune-additional-parameters"></a><span data-ttu-id="527be-161">Ajuster les paramètres supplémentaires</span><span class="sxs-lookup"><span data-stu-id="527be-161">Tune additional parameters</span></span>
<span data-ttu-id="527be-162">Une fois que vous avez la topologie de base, vous pouvez envisager de modifier les paramètres :</span><span class="sxs-lookup"><span data-stu-id="527be-162">After you have the basic topology, you can consider whether you want to tweak any of the parameters:</span></span>
* <span data-ttu-id="527be-163">**Number of JVMs per worker node (Nombre de machines virtuelles Java par nœud Worker).**</span><span class="sxs-lookup"><span data-stu-id="527be-163">**Number of JVMs per worker node.**</span></span> <span data-ttu-id="527be-164">Si vous avez une structure de données de grande taille (par exemple, une table de recherche) que vous hébergez dans la mémoire, chaque machine virtuelle Java requiert une copie distincte.</span><span class="sxs-lookup"><span data-stu-id="527be-164">If you have a large data structure (for example, a lookup table) that you host in memory, each JVM requires a separate copy.</span></span> <span data-ttu-id="527be-165">Vous pouvez également utiliser la structure de données entre plusieurs threads si vous avez moins de machines virtuelles Java.</span><span class="sxs-lookup"><span data-stu-id="527be-165">Alternatively, you can use the data structure across many threads if you have fewer JVMs.</span></span> <span data-ttu-id="527be-166">Pour les E/S de Bolt, le nombre de machines virtuelles Java ne fait pas beaucoup de différence pour le nombre de threads ajoutés sur ces machines virtuelles Java.</span><span class="sxs-lookup"><span data-stu-id="527be-166">For the bolt’s I/O, the number of JVMs does not make as much of a difference as the number of threads added across those JVMs.</span></span> <span data-ttu-id="527be-167">Pour plus de simplicité, il est judicieux d’avoir une machine virtuelle Java par Worker.</span><span class="sxs-lookup"><span data-stu-id="527be-167">For simplicity, it's a good idea to have one JVM per worker.</span></span> <span data-ttu-id="527be-168">En fonction de ce que fait votre Bolt ou du type de traitement d’application nécessaire, vous devrez peut-être modifier ce nombre.</span><span class="sxs-lookup"><span data-stu-id="527be-168">Depending on what your bolt is doing or what application processing you require, though, you may need to change this number.</span></span>
* <span data-ttu-id="527be-169">**Number of spout executors (Nombre d’exécuteurs de Spout).**</span><span class="sxs-lookup"><span data-stu-id="527be-169">**Number of spout executors.**</span></span> <span data-ttu-id="527be-170">Étant donné que l’exemple précédent utilise les Bolts pour écrire dans Data Lake Store, le nombre de Spouts ne concerne pas directement les performances Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-170">Because the preceding example uses bolts for writing to Data Lake Store, the number of spouts is not directly relevant to the bolt performance.</span></span> <span data-ttu-id="527be-171">Toutefois, selon la quantité de traitement ou d’E/S se produisant dans le Spout, il est judicieux d’ajuster les Spouts pour de meilleures performances.</span><span class="sxs-lookup"><span data-stu-id="527be-171">However, depending on the amount of processing or I/O happening in the spout, it's a good idea to tune the spouts for best performance.</span></span> <span data-ttu-id="527be-172">Assurez-vous d’avoir suffisamment de Spouts pour occuper les Bolts.</span><span class="sxs-lookup"><span data-stu-id="527be-172">Ensure that you have enough spouts to be able to keep the bolts busy.</span></span> <span data-ttu-id="527be-173">Les taux de sortie des Spouts doivent correspondre au débit des Bolts.</span><span class="sxs-lookup"><span data-stu-id="527be-173">The output rates of the spouts should match the throughput of the bolts.</span></span> <span data-ttu-id="527be-174">La configuration réelle varie selon le Spout.</span><span class="sxs-lookup"><span data-stu-id="527be-174">The actual configuration depends on the spout.</span></span>
* <span data-ttu-id="527be-175">**Nombre de tâches.**</span><span class="sxs-lookup"><span data-stu-id="527be-175">**Number of tasks.**</span></span> <span data-ttu-id="527be-176">Chaque Bolt s’exécute en tant que thread unique.</span><span class="sxs-lookup"><span data-stu-id="527be-176">Each bolt runs as a single thread.</span></span> <span data-ttu-id="527be-177">Les tâches supplémentaires par Bolt n’apportent pas d’accès concurrentiel supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="527be-177">Additional tasks per bolt don't provide any additional concurrency.</span></span> <span data-ttu-id="527be-178">Le seul moment où elles sont utiles est si votre processus d’accusé de réception de tuple représente une grande partie du temps d’exécution de votre bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-178">The only time they are of benefit is if your process of acknowledging the tuple takes a large proportion of your bolt execution time.</span></span> <span data-ttu-id="527be-179">Il est judicieux de rassembler plusieurs tuples dans un élément plus grand avant d’envoyer un accusé de réception à partir du Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-179">It's a good idea to group many tuples into a larger append before you send an acknowledgement from the bolt.</span></span> <span data-ttu-id="527be-180">Par conséquent, dans la plupart des cas, plusieurs tâches ne fournissent pas d’avantage supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="527be-180">So, in most cases, multiple tasks provide no additional benefit.</span></span>
* <span data-ttu-id="527be-181">**Local or shuffle grouping (Groupage local ou aléatoire).**</span><span class="sxs-lookup"><span data-stu-id="527be-181">**Local or shuffle grouping.**</span></span> <span data-ttu-id="527be-182">Lorsque ce paramètre est activé, les tuples sont envoyés vers des Bolts dans le même processus Worker.</span><span class="sxs-lookup"><span data-stu-id="527be-182">When this setting is enabled, tuples are sent to bolts within the same worker process.</span></span> <span data-ttu-id="527be-183">Cela réduit les communications entre processus et les appels réseau.</span><span class="sxs-lookup"><span data-stu-id="527be-183">This reduces inter-process communication and network calls.</span></span> <span data-ttu-id="527be-184">Cela est recommandé pour la plupart des topologies.</span><span class="sxs-lookup"><span data-stu-id="527be-184">This is recommended for most topologies.</span></span>

<span data-ttu-id="527be-185">Ce scénario de base est un bon point de départ.</span><span class="sxs-lookup"><span data-stu-id="527be-185">This basic scenario is a good starting point.</span></span> <span data-ttu-id="527be-186">Effectuez un test avec vos propres données pour régler les paramètres précédents et ainsi optimiser les performances.</span><span class="sxs-lookup"><span data-stu-id="527be-186">Test with your own data to tweak the preceding parameters to achieve optimal performance.</span></span>

## <a name="tune-the-spout"></a><span data-ttu-id="527be-187">Ajuster le Spout</span><span class="sxs-lookup"><span data-stu-id="527be-187">Tune the spout</span></span>

<span data-ttu-id="527be-188">Vous pouvez modifier les paramètres suivants pour ajuster le Spout.</span><span class="sxs-lookup"><span data-stu-id="527be-188">You can modify the following settings to tune the spout.</span></span>

- <span data-ttu-id="527be-189">**Délai d’expiration de tuple : topology.message.timeout.secs**.</span><span class="sxs-lookup"><span data-stu-id="527be-189">**Tuple timeout: topology.message.timeout.secs**.</span></span> <span data-ttu-id="527be-190">Ce paramètre détermine la durée d’attente de fin et d’accusé de réception d’un message avant de le considérer comme ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="527be-190">This setting determines the amount of time a message takes to complete, and receive acknowledgement, before it is considered failed.</span></span>

- <span data-ttu-id="527be-191">**Mémoire maximale par le processus worker : worker.childopts**.</span><span class="sxs-lookup"><span data-stu-id="527be-191">**Max memory per worker process: worker.childopts**.</span></span> <span data-ttu-id="527be-192">Ce paramètre permet de spécifier des paramètres de ligne de commande supplémentaires pour les Workers Java.</span><span class="sxs-lookup"><span data-stu-id="527be-192">This setting lets you specify additional command-line parameters to the Java workers.</span></span> <span data-ttu-id="527be-193">Le paramètre le plus couramment utilisé ici est XmX, qui détermine la quantité maximale de mémoire allouée au segment de mémoire d’une machine virtuelle Java.</span><span class="sxs-lookup"><span data-stu-id="527be-193">The most commonly used setting here is XmX, which determines the maximum memory allocated to a JVM’s heap.</span></span>

- <span data-ttu-id="527be-194">**Nombre max. de spouts en attente : topology.max.spout.pending**.</span><span class="sxs-lookup"><span data-stu-id="527be-194">**Max spout pending: topology.max.spout.pending**.</span></span> <span data-ttu-id="527be-195">Ce paramètre détermine le nombre de tuples qui peuvent être en cours de transmission (pas encore acceptés sur tous les nœuds de la topologie) par thread de Spout à tout moment.</span><span class="sxs-lookup"><span data-stu-id="527be-195">This setting determines the number of tuples that can in be flight (not yet acknowledged at all nodes in the topology) per spout thread at any time.</span></span>

 <span data-ttu-id="527be-196">Un bon calcul à faire est l’estimation de la taille de chacun de vos tuples.</span><span class="sxs-lookup"><span data-stu-id="527be-196">A good calculation to do is to estimate the size of each of your tuples.</span></span> <span data-ttu-id="527be-197">Ensuite, calculez la quantité de mémoire par thread spout.</span><span class="sxs-lookup"><span data-stu-id="527be-197">Then figure out how much memory one spout thread has.</span></span> <span data-ttu-id="527be-198">La mémoire totale allouée à un thread divisée par cette valeur devrait vous donner la limite supérieure pour le paramètre de nombre maximal de Spouts en attente.</span><span class="sxs-lookup"><span data-stu-id="527be-198">The total memory allocated to a thread, divided by this value, should give you the upper bound for the max spout pending parameter.</span></span>

## <a name="tune-the-bolt"></a><span data-ttu-id="527be-199">Ajuster le Bolt</span><span class="sxs-lookup"><span data-stu-id="527be-199">Tune the bolt</span></span>
<span data-ttu-id="527be-200">Lorsque vous écrivez sur Data Lake Store, définissez une stratégie de synchronisation de taille (tampon du côté client) sur 4 Mo.</span><span class="sxs-lookup"><span data-stu-id="527be-200">When you're writing to Data Lake Store, set a size sync policy (buffer on the client side) to 4 MB.</span></span> <span data-ttu-id="527be-201">Un vidage ou une hsync() est ensuite effectué uniquement lorsque la taille du tampon atteint cette valeur.</span><span class="sxs-lookup"><span data-stu-id="527be-201">A flushing or hsync() is then performed only when the buffer size is the at this value.</span></span> <span data-ttu-id="527be-202">Le pilote Data Lake Store sur la machine virtuelle de Worker effectue automatiquement cette mise en tampon, à moins que vous exécutiez explicitement une hsync().</span><span class="sxs-lookup"><span data-stu-id="527be-202">The Data Lake Store driver on the worker VM automatically does this buffering, unless you explicitly perform an hsync().</span></span>

<span data-ttu-id="527be-203">Le Bolt Storm par défaut de Data Lake Store a un paramètre de stratégie de synchronisation de taille (fileBufferSize) qui peut être utilisé pour ajuster ce paramètre.</span><span class="sxs-lookup"><span data-stu-id="527be-203">The default Data Lake Store Storm bolt has a size sync policy parameter (fileBufferSize) that can be used to tune this parameter.</span></span>

<span data-ttu-id="527be-204">Dans les topologies intensives en E/S, il est judicieux que chaque thread de Bolt écrive dans son propre fichier et définisse une stratégie de rotation de fichiers (fileRotationSize).</span><span class="sxs-lookup"><span data-stu-id="527be-204">In I/O-intensive topologies, it's a good idea to have each bolt thread write to its own file, and to set a file rotation policy (fileRotationSize).</span></span> <span data-ttu-id="527be-205">Lorsque le fichier atteint une certaine taille, le flux est automatiquement vidé, et un nouveau fichier est utilisé pour l’écriture.</span><span class="sxs-lookup"><span data-stu-id="527be-205">When the file reaches a certain size, the stream is automatically flushed and a new file is written to.</span></span> <span data-ttu-id="527be-206">La taille de fichier recommandée pour la rotation est de 1 Go.</span><span class="sxs-lookup"><span data-stu-id="527be-206">The recommended file size for rotation is 1 GB.</span></span>

### <a name="handle-tuple-data"></a><span data-ttu-id="527be-207">Gérer les données de tuple</span><span class="sxs-lookup"><span data-stu-id="527be-207">Handle tuple data</span></span>

<span data-ttu-id="527be-208">Dans Storm, un Spout conserve un tuple jusqu’à ce qu’il soit accepté explicitement par le Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-208">In Storm, a spout holds on to a tuple until it is explicitly acknowledged by the bolt.</span></span> <span data-ttu-id="527be-209">Si un tuple a été lu par le Bolt, mais qu’il n’a pas encore été accepté, le Spout peut ne pas avoir été conservé dans le serveur principal de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="527be-209">If a tuple has been read by the bolt but has not been acknowledged yet, the spout might not have persisted into Data Lake Store back end.</span></span> <span data-ttu-id="527be-210">Une fois qu’un tuple est accepté, la persistance du Spout peut être garantie par le Bolt. Il peut donc supprimer les données source, quelle que soit la source utilisée pour la lecture.</span><span class="sxs-lookup"><span data-stu-id="527be-210">After a tuple is acknowledged, the spout can be guaranteed persistence by the bolt, and can then delete the source data from whatever source it is reading from.</span></span>  

<span data-ttu-id="527be-211">Pour obtenir des performances optimales sur Data Lake Store, le Bolt doit mettre en mémoire tampon 4 Mo de données de tuple.</span><span class="sxs-lookup"><span data-stu-id="527be-211">For best performance on Data Lake Store, have the bolt buffer 4 MB of tuple data.</span></span> <span data-ttu-id="527be-212">Écrivez ensuite au serveur principal de Data Lake Store sous la forme d’une écriture de 4 Mo.</span><span class="sxs-lookup"><span data-stu-id="527be-212">Then write to the Data Lake Store back end as one 4-MB write.</span></span> <span data-ttu-id="527be-213">Une fois les données correctement écrites dans le magasin (en appelant hflush()), le Bolt peut accuser réception des données auprès du Spout.</span><span class="sxs-lookup"><span data-stu-id="527be-213">After the data has been successfully written to the store (by calling hflush()), the bolt can acknowledge the data back to the spout.</span></span> <span data-ttu-id="527be-214">C’est ce que l’exemple de bolt fourni ici effectue.</span><span class="sxs-lookup"><span data-stu-id="527be-214">This is what the example bolt supplied here does.</span></span> <span data-ttu-id="527be-215">Il est également acceptable de contenir de grands nombres de tuples avant d’appeler hflush() et d’accuser réception des tuples.</span><span class="sxs-lookup"><span data-stu-id="527be-215">It is also acceptable to hold a larger number of tuples before the hflush() call is made and the tuples acknowledged.</span></span> <span data-ttu-id="527be-216">Toutefois, cela augmente le nombre de tuples en cours de vérification que le spout doit contenir, et par conséquent la quantité de mémoire requise par machine virtuelle Java.</span><span class="sxs-lookup"><span data-stu-id="527be-216">However, this increases the number of tuples in flight that the spout needs to hold, and therefore increases the amount of memory required per JVM.</span></span>

> [!NOTE]
<span data-ttu-id="527be-217">Les applications peuvent avoir l’obligation d’accuser réception des tuples plus fréquemment (à des tailles de données inférieures à 4 Mo) pour d’autres raisons non liées aux performances.</span><span class="sxs-lookup"><span data-stu-id="527be-217">Applications might have a requirement to acknowledge tuples more frequently (at data sizes less than 4 MB) for other non-performance reasons.</span></span> <span data-ttu-id="527be-218">Toutefois, cela peut affecter le débit d’E/S pour le serveur principal de stockage.</span><span class="sxs-lookup"><span data-stu-id="527be-218">However, that might affect the I/O throughput to the storage back end.</span></span> <span data-ttu-id="527be-219">Évaluez ce compromis par rapport aux performances d’E/S du Bolt.</span><span class="sxs-lookup"><span data-stu-id="527be-219">Carefully weigh this tradeoff against the bolt’s I/O performance.</span></span>

<span data-ttu-id="527be-220">Si le taux de tuples entrants n’est pas élevé, le remplissage de la mémoire tampon de 4 Mo s’effectue lentement, vous devez envisager de résoudre le problème en :</span><span class="sxs-lookup"><span data-stu-id="527be-220">If the incoming rate of tuples is not high, so the 4-MB buffer takes a long time to fill, consider mitigating this by:</span></span>
* <span data-ttu-id="527be-221">Réduisant le nombre de Bolts, pour qu’il y ait moins de tampons à remplir.</span><span class="sxs-lookup"><span data-stu-id="527be-221">Reducing the number of bolts, so there are fewer buffers to fill.</span></span>
* <span data-ttu-id="527be-222">Utilisant une stratégie basée sur le temps ou le décompte, avec un hflush() déclenché tous les x vidages ou toutes les y millisecondes, et un accusé de réception des tuples alors accumulés.</span><span class="sxs-lookup"><span data-stu-id="527be-222">Having a time-based or count-based policy, where an hflush() is triggered every x flushes or every y milliseconds, and the tuples accumulated so far are acknowledged back.</span></span>

<span data-ttu-id="527be-223">Notez que dans ce cas le débit est plus faible, mais avec un rythme d’événements faible, le débit maximal n’est de toute façon pas l’objectif principal.</span><span class="sxs-lookup"><span data-stu-id="527be-223">Note that the throughput in this case is lower, but with a slow rate of events, maximum throughput is not the biggest objective anyway.</span></span> <span data-ttu-id="527be-224">Ces solutions vous permettent de réduire le temps total nécessaire à un tuple pour circuler vers le magasin.</span><span class="sxs-lookup"><span data-stu-id="527be-224">These mitigations help you reduce the total time that it takes for a tuple to flow through to the store.</span></span> <span data-ttu-id="527be-225">Cela peut avoir une importance si vous souhaitez un pipeline en temps réel, même avec un taux d’événements faible.</span><span class="sxs-lookup"><span data-stu-id="527be-225">This might matter if you want a real-time pipeline even with a low event rate.</span></span> <span data-ttu-id="527be-226">Notez également que si votre débit entrant de tuples est faible, vous devrez ajuster le paramètre topology.message.timeout_secs pour que les tuples n’expirent pas pendant qu’ils sont mis en mémoire tampon ou traités.</span><span class="sxs-lookup"><span data-stu-id="527be-226">Also note that if your incoming tuple rate is low, you should adjust the topology.message.timeout_secs parameter, so the tuples don’t time out while they are getting buffered or processed.</span></span>

## <a name="monitor-your-topology-in-storm"></a><span data-ttu-id="527be-227">Surveiller votre topologie dans Storm</span><span class="sxs-lookup"><span data-stu-id="527be-227">Monitor your topology in Storm</span></span>  
<span data-ttu-id="527be-228">Lorsque votre topologie est en cours d’exécution, vous pouvez la surveiller dans l’interface utilisateur de Storm.</span><span class="sxs-lookup"><span data-stu-id="527be-228">While your topology is running, you can monitor it in the Storm user interface.</span></span> <span data-ttu-id="527be-229">Voici les principaux paramètres à examiner :</span><span class="sxs-lookup"><span data-stu-id="527be-229">Here are the main parameters to look at:</span></span>

* <span data-ttu-id="527be-230">**Total process execution latency (Latence totale de l’exécution du processus).**</span><span class="sxs-lookup"><span data-stu-id="527be-230">**Total process execution latency.**</span></span> <span data-ttu-id="527be-231">Il s’agit de la durée moyenne nécessaire à un tuple pour être émis par le Spout, traité par le Bolt et être accepté.</span><span class="sxs-lookup"><span data-stu-id="527be-231">This is the average time one tuple takes to be emitted by the spout, processed by the bolt, and acknowledged.</span></span>

* <span data-ttu-id="527be-232">**Total bolt process latency (Latence totale du processus Bolt).**</span><span class="sxs-lookup"><span data-stu-id="527be-232">**Total bolt process latency.**</span></span> <span data-ttu-id="527be-233">Il s’agit du temps moyen passé par le tuple sur le Bolt jusqu’à réception d’un accusé de réception.</span><span class="sxs-lookup"><span data-stu-id="527be-233">This is the average time spent by the tuple at the bolt until it receives an acknowledgement.</span></span>

* <span data-ttu-id="527be-234">**Total bolt execute latency (Latence totale d’exécution de Bolt).**</span><span class="sxs-lookup"><span data-stu-id="527be-234">**Total bolt execute latency.**</span></span> <span data-ttu-id="527be-235">Il s’agit du temps moyen passé par le Bolt dans la méthode execute.</span><span class="sxs-lookup"><span data-stu-id="527be-235">This is the average time spent by the bolt in the execute method.</span></span>

* <span data-ttu-id="527be-236">**Nombre d’échecs.**</span><span class="sxs-lookup"><span data-stu-id="527be-236">**Number of failures.**</span></span> <span data-ttu-id="527be-237">Cela fait référence au nombre de tuples qui n’ont pas pu être entièrement traités avant expiration.</span><span class="sxs-lookup"><span data-stu-id="527be-237">This refers to the number of tuples that failed to be fully processed before they timed out.</span></span>

* <span data-ttu-id="527be-238">**Capacité.**</span><span class="sxs-lookup"><span data-stu-id="527be-238">**Capacity.**</span></span> <span data-ttu-id="527be-239">Il s’agit d’une mesure du niveau d’activité de votre système.</span><span class="sxs-lookup"><span data-stu-id="527be-239">This is a measure of how busy your system is.</span></span> <span data-ttu-id="527be-240">Si ce nombre a la valeur 1, vos bolts fonctionnent aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="527be-240">If this number is 1, your bolts are working as fast as they can.</span></span> <span data-ttu-id="527be-241">S’il est inférieur à 1, augmentez le parallélisme.</span><span class="sxs-lookup"><span data-stu-id="527be-241">If it is less than 1, increase the parallelism.</span></span> <span data-ttu-id="527be-242">S’il est supérieur à 1, réduisez le parallélisme.</span><span class="sxs-lookup"><span data-stu-id="527be-242">If it is greater than 1, reduce the parallelism.</span></span>

## <a name="troubleshoot-common-problems"></a><span data-ttu-id="527be-243">Résoudre les problèmes courants</span><span class="sxs-lookup"><span data-stu-id="527be-243">Troubleshoot common problems</span></span>
<span data-ttu-id="527be-244">Voici quelques scénarios courants de résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="527be-244">Here are a few common troubleshooting scenarios.</span></span>
* <span data-ttu-id="527be-245">**Grand nombre de tuples expirés.**</span><span class="sxs-lookup"><span data-stu-id="527be-245">**Many tuples are timing out.**</span></span> <span data-ttu-id="527be-246">Examinez chaque nœud de la topologie pour déterminer où se trouve le goulet d’étranglement.</span><span class="sxs-lookup"><span data-stu-id="527be-246">Look at each node in the topology to determine where the bottleneck is.</span></span> <span data-ttu-id="527be-247">La raison la plus courante est que les Bolts ne sont pas en mesure de suivre le rythme des Spouts.</span><span class="sxs-lookup"><span data-stu-id="527be-247">The most common reason for this is that the bolts are not able to keep up with the spouts.</span></span> <span data-ttu-id="527be-248">La conséquence est que des tuples bouchent les mémoires tampon internes en attendant d’être traités.</span><span class="sxs-lookup"><span data-stu-id="527be-248">This leads to tuples clogging the internal buffers while waiting to be processed.</span></span> <span data-ttu-id="527be-249">Envisagez d’augmenter la valeur de délai d’attente ou de diminuer le nombre maximal de Spouts en attente.</span><span class="sxs-lookup"><span data-stu-id="527be-249">Consider increasing the timeout value or decreasing the max spout pending.</span></span>

* <span data-ttu-id="527be-250">**Latence totale d’exécution de processus élevée, mais latence de traitement des Bolts faible.**</span><span class="sxs-lookup"><span data-stu-id="527be-250">**There is a high total process execution latency, but a low bolt process latency.**</span></span> <span data-ttu-id="527be-251">Dans ce cas, il est possible que les tuples ne soient pas reconnus suffisamment vite.</span><span class="sxs-lookup"><span data-stu-id="527be-251">In this case, it is possible that the tuples are not being acknowledged fast enough.</span></span> <span data-ttu-id="527be-252">Vérifiez qu’il existe un nombre suffisant de validateurs.</span><span class="sxs-lookup"><span data-stu-id="527be-252">Check that there are a sufficient number of acknowledgers.</span></span> <span data-ttu-id="527be-253">Une autre possibilité est qu’ils restent en file d’attente trop longtemps avant que les Bolts lancent leur traitement.</span><span class="sxs-lookup"><span data-stu-id="527be-253">Another possibility is that they are waiting in the queue for too long before the bolts start processing them.</span></span> <span data-ttu-id="527be-254">Réduisez le nombre maximal de spouts en attente.</span><span class="sxs-lookup"><span data-stu-id="527be-254">Decrease the max spout pending.</span></span>

* <span data-ttu-id="527be-255">**Latence d’exécution des Bolts élevée.**</span><span class="sxs-lookup"><span data-stu-id="527be-255">**There is a high bolt execute latency.**</span></span> <span data-ttu-id="527be-256">Cela signifie que la méthode execute() de votre Bolt prend trop de temps.</span><span class="sxs-lookup"><span data-stu-id="527be-256">This means that the execute() method of your bolt is taking too long.</span></span> <span data-ttu-id="527be-257">Optimisez le code ou examinez le comportement de vidage et les tailles d’écriture.</span><span class="sxs-lookup"><span data-stu-id="527be-257">Optimize the code, or look at write sizes and flush behavior.</span></span>

### <a name="data-lake-store-throttling"></a><span data-ttu-id="527be-258">Limitation Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="527be-258">Data Lake Store throttling</span></span>
<span data-ttu-id="527be-259">Si vous atteignez les limites de la bande passante fournie par Data Lake Store, vous pouvez voir des échecs de tâche.</span><span class="sxs-lookup"><span data-stu-id="527be-259">If you hit the limits of bandwidth provided by Data Lake Store, you might see task failures.</span></span> <span data-ttu-id="527be-260">Consultez les journaux des tâches pour les erreurs de limitation.</span><span class="sxs-lookup"><span data-stu-id="527be-260">Check task logs for throttling errors.</span></span> <span data-ttu-id="527be-261">Vous pouvez réduire le parallélisme en augmentant la taille de conteneur.</span><span class="sxs-lookup"><span data-stu-id="527be-261">You can decrease the parallelism by increasing container size.</span></span>    

<span data-ttu-id="527be-262">Pour vérifier si une limitation est appliquée, activez la journalisation du débogage côté client :</span><span class="sxs-lookup"><span data-stu-id="527be-262">To check if you are getting throttled, enable the debug logging on the client side:</span></span>

1. <span data-ttu-id="527be-263">Dans **Ambari** > **Storm** > **Config** > **Avancé storm-worker-log4j**, remplacez **&lt;root level="info"&gt;** par **&lt;root level=”debug”&gt;**.</span><span class="sxs-lookup"><span data-stu-id="527be-263">In **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, change **&lt;root level="info"&gt;** to **&lt;root level=”debug”&gt;**.</span></span> <span data-ttu-id="527be-264">Redémarrez tous les nœuds/le service pour que la configuration prenne effet.</span><span class="sxs-lookup"><span data-stu-id="527be-264">Restart all the nodes/service for the configuration to take effect.</span></span>
2. <span data-ttu-id="527be-265">Surveillez les journaux de topologie Storm sur les nœuds Worker (sous /var/log/storm/worker-artifacts/&lt;NomTopologie&gt;/&lt;port&gt;/worker.log) pour les exceptions de limitation de Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="527be-265">Monitor the Storm topology logs on worker nodes (under /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) for Data Lake Store throttling exceptions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="527be-266">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="527be-266">Next steps</span></span>
<span data-ttu-id="527be-267">Pour optimiser davantage les performances, consultez [ce blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span><span class="sxs-lookup"><span data-stu-id="527be-267">Additional performance tuning for Storm can be referenced in [this blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span></span>

<span data-ttu-id="527be-268">Pour exécuter un exemple supplémentaire, consultez [celui-ci sur GitHub](https://github.com/hdinsight/storm-performance-automation).</span><span class="sxs-lookup"><span data-stu-id="527be-268">For an additional example to run, see [this one on GitHub](https://github.com/hdinsight/storm-performance-automation).</span></span>
