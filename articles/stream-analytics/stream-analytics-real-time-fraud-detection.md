# <a name="get-started-using-azure-stream-analytics-real-time-fraud-detection"></a><span data-ttu-id="375e2-101">Prise en main de l’utilisation d’Azure Stream Analytics : détection des fraudes en temps réel</span><span class="sxs-lookup"><span data-stu-id="375e2-101">Get started using Azure Stream Analytics: Real-time fraud detection</span></span>

<span data-ttu-id="375e2-102">Ce didacticiel illustre de bout en bout l’utilisation d’Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-102">This tutorial provides an end-to-end illustration of how to use Azure Stream Analytics.</span></span> <span data-ttu-id="375e2-103">Vous allez apprendre à effectuer les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="375e2-103">You learn how to:</span></span> 

* <span data-ttu-id="375e2-104">Insérer des événements de flux dans une instance d’Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="375e2-104">Bring streaming events into an instance of Azure Event Hubs.</span></span> <span data-ttu-id="375e2-105">Dans ce didacticiel, vous allez utiliser une application que nous fournissons pour simuler un flux d’enregistrements de métadonnées de téléphone mobile.</span><span class="sxs-lookup"><span data-stu-id="375e2-105">In this tutorial, you'll use an app that we provide that simulates a stream of mobile-phone metadata records.</span></span>

* <span data-ttu-id="375e2-106">Écrire des requêtes Stream Analytics de type SQL pour transformer des données, en agrégeant des informations ou en recherchant des modèles.</span><span class="sxs-lookup"><span data-stu-id="375e2-106">Write SQL-like Stream Analytics queries to transform data, aggregating information or looking for patterns.</span></span> <span data-ttu-id="375e2-107">Vous allez apprendre à utiliser une requête pour examiner le flux entrant et rechercher les appels pouvant être frauduleux.</span><span class="sxs-lookup"><span data-stu-id="375e2-107">You will see how to use a query to examine the incoming stream and look for calls that might be fraudulent.</span></span>

* <span data-ttu-id="375e2-108">Envoyer les résultats vers un récepteur de sortie (stockage) que vous pouvez analyser pour obtenir des informations supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="375e2-108">Send the results to an output sink (storage) that you can analyze for additional insights.</span></span> <span data-ttu-id="375e2-109">Dans ce cas, vous enverrez les données des appels suspects au stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-109">In this case, you'll send the suspicious call data to Azure Blob storage.</span></span>

<span data-ttu-id="375e2-110">Dans ce didacticiel, nous utilisons l’exemple de détection des fraudes en temps réel basée sur les données d’appels téléphoniques.</span><span class="sxs-lookup"><span data-stu-id="375e2-110">In  this tutorial, we use the example of real-time fraud detection based on phone-call data.</span></span> <span data-ttu-id="375e2-111">Cependant la technique que nous illustrons est également adaptée aux autres types de détection de fraude, comme l’usurpation d’identité ou la fraude à la carte de crédit.</span><span class="sxs-lookup"><span data-stu-id="375e2-111">But the technique we illustrate is also suited for other types of fraud detection, such as credit card fraud or identity theft.</span></span> 

## <a name="scenario-telecommunications-and-sim-fraud-detection-in-real-time"></a><span data-ttu-id="375e2-112">Scénario : détection des fraudes de télécommunication et SIM en temps réel</span><span class="sxs-lookup"><span data-stu-id="375e2-112">Scenario: Telecommunications and SIM fraud detection in real time</span></span>

<span data-ttu-id="375e2-113">Une société de télécommunication dispose d’un volume important de données pour les appels entrants.</span><span class="sxs-lookup"><span data-stu-id="375e2-113">A telecommunications company has a large volume of data for incoming calls.</span></span> <span data-ttu-id="375e2-114">La société souhaite détecter les appels frauduleux en temps réel afin de pouvoir informer ses clients ou arrêter un service à partir d’un nombre donné.</span><span class="sxs-lookup"><span data-stu-id="375e2-114">The company wants to detect fraudulent calls in real time so that they can notify customers or shut down service for a specific number.</span></span> <span data-ttu-id="375e2-115">Un type de fraude à la carte SIM implique plusieurs appels simultanés provenant d’une même identité, mais à des emplacements géographiquement distincts.</span><span class="sxs-lookup"><span data-stu-id="375e2-115">One type of SIM fraud involves multiple calls from the same identity around the same time but in geographically different locations.</span></span> <span data-ttu-id="375e2-116">Pour détecter ce type de fraude, la société doit examiner les enregistrements téléphoniques entrants et rechercher des modèles spécifiques, dans ce cas précis, des appels passés en même temps dans différents pays.</span><span class="sxs-lookup"><span data-stu-id="375e2-116">To detect this type of fraud, the company needs to examine incoming phone records and look for specific patterns—in this case, for calls made around the same time in different countries.</span></span> <span data-ttu-id="375e2-117">Tous les enregistrements téléphoniques qui s’inscrivent dans cette catégorie sont écrits dans l’espace de stockage en vue d’une analyse ultérieure.</span><span class="sxs-lookup"><span data-stu-id="375e2-117">Any phone records that fall into this category are written to storage for subsequent analysis.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="375e2-118">Composants requis</span><span class="sxs-lookup"><span data-stu-id="375e2-118">Prerequisites</span></span>

<span data-ttu-id="375e2-119">Dans ce didacticiel, vous allez simuler des données d’appels téléphoniques à l’aide d’une application cliente générant un exemple de métadonnées d’appel téléphonique.</span><span class="sxs-lookup"><span data-stu-id="375e2-119">In this tutorial, you'll simulate phone-call data by using a client app that generates sample phone call metadata.</span></span> <span data-ttu-id="375e2-120">Certains des enregistrements produits par l’application ressemblent à des appels frauduleux.</span><span class="sxs-lookup"><span data-stu-id="375e2-120">Some of the records that the app produces look like fraudulent calls.</span></span> 

<span data-ttu-id="375e2-121">Avant de commencer, veillez à disposer des éléments qui suivent :</span><span class="sxs-lookup"><span data-stu-id="375e2-121">Before you start, make sure you have the following:</span></span>

* <span data-ttu-id="375e2-122">Un compte Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-122">An Azure account.</span></span>
* <span data-ttu-id="375e2-123">L’application de génération d’événements d’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-123">The call-event generator app.</span></span> <span data-ttu-id="375e2-124">Pour l’obtenir, téléchargez le [fichier TelcoGenerator.zip](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) à partir du Centre de téléchargement Microsoft.</span><span class="sxs-lookup"><span data-stu-id="375e2-124">You can get this by downloading the [TelcoGenerator.zip file](http://download.microsoft.com/download/8/B/D/8BD50991-8D54-4F59-AB83-3354B69C8A7E/TelcoGenerator.zip) from the Microsoft Download Center.</span></span> <span data-ttu-id="375e2-125">Décompressez ce package dans un dossier de votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="375e2-125">Unzip this package into a folder on your computer.</span></span> <span data-ttu-id="375e2-126">Pour afficher le code source et exécuter l’application dans un débogueur, vous pouvez obtenir le code source de l’application dans [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span><span class="sxs-lookup"><span data-stu-id="375e2-126">If you want to see the source code and run the app in a debugger, you can get the app source code from [GitHub](https://aka.ms/azure-stream-analytics-telcogenerator).</span></span> 

    >[!NOTE]
    ><span data-ttu-id="375e2-127">Windows peut bloquer le fichier .zip téléchargé.</span><span class="sxs-lookup"><span data-stu-id="375e2-127">Windows might block the downloaded .zip file.</span></span> <span data-ttu-id="375e2-128">Si vous ne pouvez pas le décompresser, cliquez avec le bouton droit sur le fichier et sélectionnez **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="375e2-128">If you can't unzip it, right-click the file and select **Properties**.</span></span> <span data-ttu-id="375e2-129">Si le message « Ce fichier provient d’un autre ordinateur et peut éventuellement être bloqué pour protéger cet ordinateur. » est affiché, sélectionnez l’option **Débloquer**, puis cliquez sur **Appliquer**.</span><span class="sxs-lookup"><span data-stu-id="375e2-129">If you see the "This file came from another computer and might be blocked to help protect this computer" message, select the **Unblock** option and then click **Apply**.</span></span>

<span data-ttu-id="375e2-130">Si vous souhaitez examiner les résultats du travail Stream Analytics, vous avez également besoin d’un outil pour afficher le contenu d’un conteneur de stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-130">If you want to examine the results of the Streaming Analytics job, you also need a tool for viewing the contents of a Azure Blob Storage container.</span></span> <span data-ttu-id="375e2-131">Si vous utilisez Visual Studio, vous pouvez utiliser [Azure Tools pour Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) ou [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span><span class="sxs-lookup"><span data-stu-id="375e2-131">If you use Visual Studio, you can use [Azure Tools for Visual Studio](https://docs.microsoft.com/en-us/azure/vs-azure-tools-storage-resources-server-explorer-browse-manage) or [Visual Studio Cloud Explorer](https://docs.microsoft.com/en-us/azure/vs-azure-tools-resources-managing-with-cloud-explorer).</span></span> <span data-ttu-id="375e2-132">Vous pouvez également installer des outils autonomes comme [Explorateur de stockage Azure](http://storageexplorer.com/) ou [Explorateur Azure](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="375e2-132">Alternatively, you can install standalone tools like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

## <a name="create-an-azure-event-hubs-to-ingest-events"></a><span data-ttu-id="375e2-133">Créer un concentrateur Azure Event Hubs pour ingérer les événements</span><span class="sxs-lookup"><span data-stu-id="375e2-133">Create an Azure event hubs to ingest events</span></span>

<span data-ttu-id="375e2-134">Pour analyser un flux de données, *ingérez-le* dans Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-134">To analyze a data stream, you *ingest* it into Azure.</span></span> <span data-ttu-id="375e2-135">Pour ingérer des données, il est courant d’utiliser [Azure Event Hubs](../event-hubs/event-hubs-what-is-event-hubs.md), qui vous permet d’ingérer des millions d’événements par seconde, puis de traiter et de stocker les informations d’événement.</span><span class="sxs-lookup"><span data-stu-id="375e2-135">A typical way to ingest data is to use [Azure Event Hubs](../event-hubs/event-hubs-what-is-event-hubs.md), which lets you ingest millions of events per second and then process and store the event information.</span></span> <span data-ttu-id="375e2-136">Pour ce didacticiel, vous allez créer un concentrateur Event Hub, puis indiquer à l’application de génération d’événements d’appel d’envoyer des données d’appel à ce concentrateur.</span><span class="sxs-lookup"><span data-stu-id="375e2-136">For this tutorial, you create an event hub and then have the call-event generator app send call data to that event hub.</span></span> <span data-ttu-id="375e2-137">Pour plus d’informations sur les concentrateurs Event Hub, voir la [documentation Azure Service Bus](https://docs.microsoft.com/en-us/azure/service-bus/).</span><span class="sxs-lookup"><span data-stu-id="375e2-137">For more about event hubs, see the [Azure Service Bus documentation](https://docs.microsoft.com/en-us/azure/service-bus/).</span></span>

>[!NOTE]
><span data-ttu-id="375e2-138">Pour consulter une version plus détaillée de cette procédure, voir [Créer un espace de noms Event Hubs et un concentrateur d’événements avec le portail Azure](../event-hubs/event-hubs-create.md).</span><span class="sxs-lookup"><span data-stu-id="375e2-138">For a more detailed version of this procedure, see [Create an Event Hubs namespace and an event hub using the Azure portal](../event-hubs/event-hubs-create.md).</span></span> 

### <a name="create-a-namespace-and-event-hub"></a><span data-ttu-id="375e2-139">Créer un concentrateur Event Hub et un espace de noms</span><span class="sxs-lookup"><span data-stu-id="375e2-139">Create a namespace and event hub</span></span>
<span data-ttu-id="375e2-140">Dans cette procédure, vous allez commencer par créer un espace de noms Event Hub, puis ajouter un concentrateur Event Hub à cet espace de noms.</span><span class="sxs-lookup"><span data-stu-id="375e2-140">In this procedure, you first create an event hub namespace, and then you add an event hub to that namepsace.</span></span> <span data-ttu-id="375e2-141">Les espaces de noms Event Hub sont utilisés pour regrouper logiquement des instances Event Hub associées.</span><span class="sxs-lookup"><span data-stu-id="375e2-141">Event hub namespaces are used to logically group related event bus instances.</span></span> 

1. <span data-ttu-id="375e2-142">Connectez-vous au portail Azure, puis cliquez sur **Nouveau** > **Internet des objets** > **Event Hub**.</span><span class="sxs-lookup"><span data-stu-id="375e2-142">Log  into the Azure portal and click **New** > **Internet of Things** > **Event Hub**.</span></span> 

2. <span data-ttu-id="375e2-143">Dans le panneau **Créer un espace de noms**, entrez un nom d’espace de noms, par exemple `<yourname>-eh-ns-demo`.</span><span class="sxs-lookup"><span data-stu-id="375e2-143">In the **Create namespace** blade, enter a namespace name such as `<yourname>-eh-ns-demo`.</span></span> <span data-ttu-id="375e2-144">Vous pouvez utiliser n’importe quel nom pour l’espace de noms, mais il doit être valide pour une URL et unique dans Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-144">You can use any name for the namespace, but the name must be valid for a URL and it must be unique across Azure.</span></span> 
    
3. <span data-ttu-id="375e2-145">Sélectionnez un abonnement, créez ou choisissez un groupe de ressources, puis cliquez sur **Créer**.</span><span class="sxs-lookup"><span data-stu-id="375e2-145">Select a subscription and create or choose a resource group , then click **Create**.</span></span> 

    ![Créer un espace de noms Event Hub](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-namespace-new-portal.png)
 
4. <span data-ttu-id="375e2-147">Lorsque le déploiement de l’espace de noms est terminé, recherchez l’espace de noms Event Hub dans la liste de ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-147">When the namespace has finished deploying, find the event hub namespace in your list of Azure resources.</span></span> 

5. <span data-ttu-id="375e2-148">Cliquez sur le nouvel espace de noms, puis, dans le panneau d’espace de noms, cliquez sur **+&nbsp;Event Hub**.</span><span class="sxs-lookup"><span data-stu-id="375e2-148">Click the new namespace, and in the namespace blade, click **+&nbsp;Event Hub**.</span></span> 

    ![<span data-ttu-id="375e2-149">Bouton Ajouter un hub d’événements permettant de créer un concentrateur Event Hub</span><span class="sxs-lookup"><span data-stu-id="375e2-149">The Add Event Hub button for creating a new event hub</span></span> ](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-button-new-portal.png)    
 
6. <span data-ttu-id="375e2-150">Nommez le nouveau concentrateur Event Hub `sa-eh-frauddetection-demo`.</span><span class="sxs-lookup"><span data-stu-id="375e2-150">Name the new event hub `sa-eh-frauddetection-demo`.</span></span> <span data-ttu-id="375e2-151">Vous pouvez utiliser un autre nom.</span><span class="sxs-lookup"><span data-stu-id="375e2-151">You can use a different name.</span></span> <span data-ttu-id="375e2-152">Le cas échéant, prenez-en note, car vous devrez l’utiliser ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="375e2-152">If you do, make a note of it, because you need the name later.</span></span> <span data-ttu-id="375e2-153">Pour le moment, vous n’avez pas besoin de définir d’autres options pour le concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-153">You don't need to set any other options for the event hub right now.</span></span>

    ![Panneau de création d’un concentrateur Event Hub](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-eventhub-new-portal.png)
    
 
7. <span data-ttu-id="375e2-155">Cliquez sur **Create**.</span><span class="sxs-lookup"><span data-stu-id="375e2-155">Click **Create**.</span></span>
### <a name="grant-access-to-the-event-hub-and-get-a-connection-string"></a><span data-ttu-id="375e2-156">Accorder l’accès au concentrateur Event Hub et obtenir une chaîne de connexion</span><span class="sxs-lookup"><span data-stu-id="375e2-156">Grant access to the event hub and get a connection string</span></span>

<span data-ttu-id="375e2-157">Pour qu’un processus puisse envoyer des données à un concentrateur Event Hub, ce concentrateur doit disposer d’une stratégie autorisant un accès approprié.</span><span class="sxs-lookup"><span data-stu-id="375e2-157">Before a process can send data to an event hub, the event hub must have a policy that allows appropriate access.</span></span> <span data-ttu-id="375e2-158">La stratégie d’accès génère une chaîne de connexion qui inclut des informations d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="375e2-158">The access policy produces a connection string that includes authorization information.</span></span>

1.  <span data-ttu-id="375e2-159">Dans le panneau d’espace de noms, cliquez sur **Event Hubs**, puis sur le nom de votre nouveau concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-159">In the event namespace blade, click **Event Hubs** and then click the name of your new event hub.</span></span>

2.  <span data-ttu-id="375e2-160">Dans le panneau Event Hub, cliquez sur **Stratégies d’accès partagé**, puis sur **+&nbsp;Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="375e2-160">In the event hub blade, click **Shared access policies** and then click **+&nbsp;Add**.</span></span>

    >[!NOTE]
    ><span data-ttu-id="375e2-161">Veillez à utiliser le concentrateur Event Hub et pas l’espace de noms Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-161">Make sure you're working with the event hub, not the event hub namespace.</span></span>

3.  <span data-ttu-id="375e2-162">Ajoutez la stratégie nommée `sa-policy-manage-demo` et, pour **Revendication**, sélectionnez **Gérer**.</span><span class="sxs-lookup"><span data-stu-id="375e2-162">Add a policy named `sa-policy-manage-demo` and for **Claim**, select **Manage**.</span></span>

    ![Panneau de création d’une stratégie d’accès au concentrateur Event Hub](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-shared-access-policy-manage-new-portal.png)
 
4.  <span data-ttu-id="375e2-164">Cliquez sur **Create**.</span><span class="sxs-lookup"><span data-stu-id="375e2-164">Click **Create**.</span></span>

5.  <span data-ttu-id="375e2-165">Une fois la stratégie déployée, cliquez dessus dans la liste des stratégies d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="375e2-165">After the policy has been deployed, click it in the list of shared access policies.</span></span>

6.  <span data-ttu-id="375e2-166">Recherchez la zone intitulée **CHAÎNE DE CONNEXION-CLÉ PRIMAIRE**, puis cliquez sur le bouton de copie situé à côté de la chaine de connexion.</span><span class="sxs-lookup"><span data-stu-id="375e2-166">Find the box labeled **CONNECTION STRING-PRIMARY KEY** and click the copy button next to the connection string.</span></span> 
    
    ![Copie de la clé primaire de la chaîne de connexion à partir de la stratégie d’accès](./media/stream-analytics-real-time-fraud-detection/stream-analytics-shared-access-policy-copy-connection-string-new-portal.png)
 
7.  <span data-ttu-id="375e2-168">Collez la chaîne de connexion dans un éditeur de texte.</span><span class="sxs-lookup"><span data-stu-id="375e2-168">Paste the connection string into a text editor.</span></span> <span data-ttu-id="375e2-169">Vous aurez besoin de cette chaîne de connexion pour la section suivante, une fois que vous lui aurez apporté quelques légères modifications.</span><span class="sxs-lookup"><span data-stu-id="375e2-169">You need this connection string for the next section, after you make some small edits to it.</span></span>

    <span data-ttu-id="375e2-170">La chaîne de connexion ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-170">The connection string looks like this:</span></span>

        Endpoint=sb://YOURNAME-eh-ns-demo.servicebus.windows.net/;SharedAccessKeyName=sa-policy-manage-demo;SharedAccessKey=Gw2NFZwU1Di+rxA2T+6hJYAtFExKRXaC2oSQa0ZsPkI=;EntityPath=sa-eh-frauddetection-demo

    <span data-ttu-id="375e2-171">Notez que la chaîne de connexion contient plusieurs paires clé-valeur, séparées par des points-virgules : `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey` et `EntityPath`.</span><span class="sxs-lookup"><span data-stu-id="375e2-171">Notice that the connection string contains multiple key-value pairs, separated with semicolons: `Endpoint`, `SharedAccessKeyName`, `SharedAccessKey`, and `EntityPath`.</span></span>  

## <a name="configure-and-start-the-event-generator-application"></a><span data-ttu-id="375e2-172">Configuration et démarrage de l’application de génération d’événements</span><span class="sxs-lookup"><span data-stu-id="375e2-172">Configure and start the event generator application</span></span>

<span data-ttu-id="375e2-173">Avant de démarrer l’application TelcoGenerator, configurez-la afin qu’elle envoie des enregistrements d’appels au concentrateur Event Hub que vous venez de créer.</span><span class="sxs-lookup"><span data-stu-id="375e2-173">Before you start the TelcoGenerator app, you configure it so that it will send call records to the event hub you just created.</span></span>

### <a name="configure-the-telcogeneratorapp"></a><span data-ttu-id="375e2-174">Configurer l’application TelcoGenerator</span><span class="sxs-lookup"><span data-stu-id="375e2-174">Configure the TelcoGeneratorapp</span></span>

1.  <span data-ttu-id="375e2-175">Dans l’éditeur dans lequel vous avez copié la chaîne de connexion, prenez note de la valeur `EntityPath`, puis supprimez la paire `EntityPath` (n’oubliez pas de supprimer le point-virgule qui la précède).</span><span class="sxs-lookup"><span data-stu-id="375e2-175">In the editor where you copied the connection string, make a note of the `EntityPath` value, and then remove the `EntityPath` pair (don't forget to remove the semicolon that precedes it).</span></span> 

2.  <span data-ttu-id="375e2-176">Dans le dossier où vous avez décompressé le fichier TelcoGenerator.zip, ouvrez le fichier telcodatagen.exe.config dans un éditeur.</span><span class="sxs-lookup"><span data-stu-id="375e2-176">In the folder where you unzipped the TelcoGenerator.zip file, open the telcodatagen.exe.config file in an editor.</span></span> <span data-ttu-id="375e2-177">(Comme il existe plusieurs fichiers .config, veillez à ouvrir celui qui convient.)</span><span class="sxs-lookup"><span data-stu-id="375e2-177">(There is more than one .config file, so be sure that you open the right one.)</span></span>

3.  <span data-ttu-id="375e2-178">Dans l’élément `<appSettings>`, effectuez les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="375e2-178">In the `<appSettings>` element, do this:</span></span>

    * <span data-ttu-id="375e2-179">Définissez la valeur de la clé `EventHubName` sur le nom du concentrateur Event Hub (autrement dit, la valeur du chemin d’accès de l’entité).</span><span class="sxs-lookup"><span data-stu-id="375e2-179">Set the value of the `EventHubName` key to the event hub name (that is, to the value of the entity path).</span></span>
    * <span data-ttu-id="375e2-180">Définissez la valeur de la clé `Microsoft.ServiceBus.ConnectionString` sur la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="375e2-180">Set the value of the `Microsoft.ServiceBus.ConnectionString` key to the connection string.</span></span> 

    <span data-ttu-id="375e2-181">La section `<appSettings>` doit ressembler à l’exemple qui suit.</span><span class="sxs-lookup"><span data-stu-id="375e2-181">The `<appSettings>` section will look like the following example.</span></span> <span data-ttu-id="375e2-182">(Par souci de clarté, nous avons inséré des retours automatiques de ligne et supprimé des caractères dans le jeton d’autorisation.)</span><span class="sxs-lookup"><span data-stu-id="375e2-182">(For clarity, we wrapped the lines and removed some characters from the authorization token.)</span></span>

    ![Fichier de configuration de l’application TelcoGenerator affichant la chaîne de connexion et le nom du concentrateur Event Hub](./media/stream-analytics-real-time-fraud-detection/stream-analytics-telcogenerator-config-file-app-settings.png)
 
4.  <span data-ttu-id="375e2-184">Enregistrez le fichier .</span><span class="sxs-lookup"><span data-stu-id="375e2-184">Save the file.</span></span> 

### <a name="start-the-app"></a><span data-ttu-id="375e2-185">Démarrer l’application</span><span class="sxs-lookup"><span data-stu-id="375e2-185">Start the app</span></span>
1.  <span data-ttu-id="375e2-186">Ouvrez une fenêtre Commande et accédez au dossier dans lequel l’application TelcoGenerator est décompressée.</span><span class="sxs-lookup"><span data-stu-id="375e2-186">Open a command window and change to the folder where the TelcoGenerator app is unzipped.</span></span>
2.  <span data-ttu-id="375e2-187">Entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="375e2-187">Enter the following command:</span></span>

        telcodatagen.exe 1000 .2 2

    <span data-ttu-id="375e2-188">Les paramètres sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="375e2-188">The parameters are:</span></span> 

    * <span data-ttu-id="375e2-189">Nombre d’enregistrements des détails des appels par heure.</span><span class="sxs-lookup"><span data-stu-id="375e2-189">Number of CDRs per hour.</span></span> 
    * <span data-ttu-id="375e2-190">Probabilité de fraude à la carte SIM : fréquence, exprimée en pourcentage de l’ensemble des appels, à laquelle l’application doit simuler un appel frauduleux.</span><span class="sxs-lookup"><span data-stu-id="375e2-190">SIM Card Fraud Probability: How often, as a percentage of all calls, that the app should simulate a fraudulent call.</span></span> <span data-ttu-id="375e2-191">La valeur 0,2 signifie qu’environ 20 % des enregistrements d’appels semblent frauduleux.</span><span class="sxs-lookup"><span data-stu-id="375e2-191">The value .2 means that about 20% of the call records will look fraudulent.</span></span>
    * <span data-ttu-id="375e2-192">Durée en heures.</span><span class="sxs-lookup"><span data-stu-id="375e2-192">Duration in hours.</span></span> <span data-ttu-id="375e2-193">Nombre d’heures pendant lesquelles l’application doit s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="375e2-193">The number of hours that the app should run.</span></span> <span data-ttu-id="375e2-194">Vous pouvez également arrêter l’application à tout moment en appuyant sur Ctrl+C au niveau de la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="375e2-194">You can also stop the app any time by pressing Ctrl+C at the command line.</span></span>

    <span data-ttu-id="375e2-195">Après quelques secondes, l’application commence à afficher des enregistrements des appels téléphoniques à l’écran à mesure qu’elle les envoie au concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-195">After a few seconds, the app starts displaying phone call records on the screen as it sends them to the event hub.</span></span>

<span data-ttu-id="375e2-196">Voici certains champs clés que vous utiliserez dans cette application de détection des fraudes en temps réel :</span><span class="sxs-lookup"><span data-stu-id="375e2-196">Some of the key fields that you will be using in this real-time fraud detection application are the following:</span></span>

|<span data-ttu-id="375e2-197">**Enregistrement**</span><span class="sxs-lookup"><span data-stu-id="375e2-197">**Record**</span></span>|<span data-ttu-id="375e2-198">**Définition**</span><span class="sxs-lookup"><span data-stu-id="375e2-198">**Definition**</span></span>|
|----------|--------------|
|`CallrecTime`|<span data-ttu-id="375e2-199">Horodatage de l’heure de début d’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-199">The timestamp for the call start time.</span></span> |
|`SwitchNum`|<span data-ttu-id="375e2-200">Commutateur téléphonique utilisé pour connecter l’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-200">The telephone switch used to connect the call.</span></span> <span data-ttu-id="375e2-201">Pour cet exemple, les commutateurs sont des chaînes qui représentent le pays d’origine (États-Unis, Chine, Royaume-Uni, Allemagne ou Australie).</span><span class="sxs-lookup"><span data-stu-id="375e2-201">For this example, the switches are strings that represent the country of origin (US, China, UK, Germany, or Australia).</span></span> |
|`CallingNum`|<span data-ttu-id="375e2-202">Numéro de téléphone de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="375e2-202">The phone number of the caller.</span></span> |
|`CallingIMSI`|<span data-ttu-id="375e2-203">Identité de l’abonné mobile international (IMSI).</span><span class="sxs-lookup"><span data-stu-id="375e2-203">The International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="375e2-204">Il s’agit de l’identificateur unique de l’appelant.</span><span class="sxs-lookup"><span data-stu-id="375e2-204">This is the Unique identifier of the caller.</span></span> |
|`CalledNum`|<span data-ttu-id="375e2-205">Numéro de téléphone du destinataire de l’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-205">The phone number of the call recipient.</span></span> |
|`CalledIMSI`|<span data-ttu-id="375e2-206">Identité de l'abonné mobile international (IMSI).</span><span class="sxs-lookup"><span data-stu-id="375e2-206">International Mobile Subscriber Identity (IMSI).</span></span> <span data-ttu-id="375e2-207">Il s’agit de l’identificateur unique du destinataire de l’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-207">This is the unique identifier of the call recipient.</span></span> |


## <a name="create-a-stream-analytics-job-to-manage-streaming-data"></a><span data-ttu-id="375e2-208">Créer un travail Stream Analytics pour gérer les données de flux</span><span class="sxs-lookup"><span data-stu-id="375e2-208">Create a Stream Analytics job to manage streaming data</span></span>

<span data-ttu-id="375e2-209">Maintenant que vous disposez d’un flux des événements d’appel, vous pouvez configurer un travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-209">Now that you have a stream of call events, you can set up a Stream Analytics job.</span></span> <span data-ttu-id="375e2-210">Le travail lit les données à partir du concentrateur Event Hub que vous avez configuré.</span><span class="sxs-lookup"><span data-stu-id="375e2-210">The job will read data from the event hub that you set up.</span></span> 

### <a name="create-the-job"></a><span data-ttu-id="375e2-211">Créer le travail</span><span class="sxs-lookup"><span data-stu-id="375e2-211">Create the job</span></span> 

1. <span data-ttu-id="375e2-212">Dans le portail Azure, cliquez sur **Nouveau** > **Internet des objets** > **Travail Stream Analytics**.</span><span class="sxs-lookup"><span data-stu-id="375e2-212">In the Azure portal, click **New** > **Internet of Things** > **Stream Analytics job**.</span></span>

2. <span data-ttu-id="375e2-213">Nommez le travail `sa_frauddetection_job_demo`, puis spécifiez un abonnement, un groupe de ressources et un emplacement.</span><span class="sxs-lookup"><span data-stu-id="375e2-213">Name the job `sa_frauddetection_job_demo`, specify a subscription, resource group, and location.</span></span>

    <span data-ttu-id="375e2-214">Il est judicieux de placer le travail et le concentrateur Event Hub dans la même région afin d’optimiser les performances. Ce faisant, vous ne payez pas pour transférer des données entre les régions.</span><span class="sxs-lookup"><span data-stu-id="375e2-214">It's a good idea to place the job and the event hub in the same region for best performance and so that you don't pay to transfer data between regions.</span></span>

    ![Créer un travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-job-new-portal.png)

3. <span data-ttu-id="375e2-216">Cliquez sur **Create**.</span><span class="sxs-lookup"><span data-stu-id="375e2-216">Click **Create**.</span></span>

    <span data-ttu-id="375e2-217">Le travail est créé, et le portail en affiche les détails.</span><span class="sxs-lookup"><span data-stu-id="375e2-217">The job is created and the portal displays job details.</span></span> <span data-ttu-id="375e2-218">Rien n’est en cours d’exécution cependant. Vous devez configurer le travail pour qu’il puisse être démarré.</span><span class="sxs-lookup"><span data-stu-id="375e2-218">Nothing is running yet, though—you have to configure the job before it can be started.</span></span>

### <a name="configure-job-input"></a><span data-ttu-id="375e2-219">Configurer les entrées du travail</span><span class="sxs-lookup"><span data-stu-id="375e2-219">Configure job input</span></span>

1. <span data-ttu-id="375e2-220">Dans le tableau de bord ou dans le panneau **Toutes les ressources**, recherchez et sélectionnez le travail Stream Analytics `sa_frauddetection_job_demo`.</span><span class="sxs-lookup"><span data-stu-id="375e2-220">In the dashboard or the **All resources** blade, find and select the `sa_frauddetection_job_demo` Stream Analytics job.</span></span> 
2. <span data-ttu-id="375e2-221">Dans la section **Topologie de la tâche** du panneau du travail Stream Analytics, cliquez sur la zone **Entrée**.</span><span class="sxs-lookup"><span data-stu-id="375e2-221">In the **Job Topology** section of the Stream Analytics job blade, click the **Input** box.</span></span>

    ![Zone d’entrée sous Topologie dans le panneau du travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-input-box-new-portal.png)
 
3. <span data-ttu-id="375e2-223">Cliquez sur **+&nbsp;Ajouter**, puis renseignez le panneau avec les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="375e2-223">Click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="375e2-224">**Alias d’entrée** : utilisez le nom `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="375e2-224">**Input alias**: Use the name `CallStream`.</span></span> <span data-ttu-id="375e2-225">Si vous utilisez un autre nom, prenez-en note, car vous en aurez besoin ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="375e2-225">If you use a different name, make a note of it because you'll need it later.</span></span>
    * <span data-ttu-id="375e2-226">**Type de source** : sélectionnez **Flux de données**.</span><span class="sxs-lookup"><span data-stu-id="375e2-226">**Source type**: Select **Data stream**.</span></span> <span data-ttu-id="375e2-227">(La zone **Données de référence** désigne les données de recherches statiques, que vous n’utilisez pas dans ce didacticiel.)</span><span class="sxs-lookup"><span data-stu-id="375e2-227">(**Reference data** refers to static lookup data, which you won't use in this tutorial.)</span></span>
    * <span data-ttu-id="375e2-228">**Source** : sélectionnez **Event Hub**.</span><span class="sxs-lookup"><span data-stu-id="375e2-228">**Source**: Select **Event hub**.</span></span>
    * <span data-ttu-id="375e2-229">**Option d’importation** : sélectionnez **Utiliser le hub d’événements de l’abonnement actuel**.</span><span class="sxs-lookup"><span data-stu-id="375e2-229">**Import option**: Select **Use event hub from current subscription**.</span></span> 
    * <span data-ttu-id="375e2-230">**Espace de noms Service Bus** : sélectionnez l’espace de noms Event Hub que vous avez créé précédemment (`<yourname>-eh-ns-demo`).</span><span class="sxs-lookup"><span data-stu-id="375e2-230">**Service bus namespace**: Select the event hub namespace that you created earlier (`<yourname>-eh-ns-demo`).</span></span>
    * <span data-ttu-id="375e2-231">**Event Hub** : sélectionnez le concentrateur Event Hub que vous avez créé précédemment (`sa-eh-frauddetection-demo`).</span><span class="sxs-lookup"><span data-stu-id="375e2-231">**Event hub**: Select the event hub that you created earlier (`sa-eh-frauddetection-demo`).</span></span>
    * <span data-ttu-id="375e2-232">**Nom de la stratégie du hub d’événements** : sélectionnez la stratégie d’accès que vous avez créée précédemment (`sa-policy-manage-demo`).</span><span class="sxs-lookup"><span data-stu-id="375e2-232">**Event hub policy name**: Select the access policy that you created earlier (`sa-policy-manage-demo`).</span></span>

    ![Créer une entrée pour le travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sa-input-new-portal.png)

4. <span data-ttu-id="375e2-234">Cliquez sur **Create**.</span><span class="sxs-lookup"><span data-stu-id="375e2-234">Click **Create**.</span></span>

## <a name="create-queries-to-transform-real-time-data"></a><span data-ttu-id="375e2-235">Créer des requêtes pour transformer des données en temps réel</span><span class="sxs-lookup"><span data-stu-id="375e2-235">Create queries to transform real-time data</span></span>

<span data-ttu-id="375e2-236">À ce stade, vous disposez d’un travail Stream Analytics configuré pour lire un flux de données entrantes.</span><span class="sxs-lookup"><span data-stu-id="375e2-236">At this point, you have a Stream Analytics job set up to read an incoming data stream.</span></span> <span data-ttu-id="375e2-237">L’étape suivante consiste à créer une transformation qui analysera les données en temps réel.</span><span class="sxs-lookup"><span data-stu-id="375e2-237">The next step is to create a transformation that analyzes the data in real time.</span></span> <span data-ttu-id="375e2-238">Pour ce faire, créez une requête.</span><span class="sxs-lookup"><span data-stu-id="375e2-238">You do this by creating a query.</span></span> <span data-ttu-id="375e2-239">Stream Analytics prend en charge un modèle de requête simple et déclaratif pour la description des transformations dans le cadre du traitement en temps réel.</span><span class="sxs-lookup"><span data-stu-id="375e2-239">Stream Analytics supports a simple, declarative query model that describes transformations for real-time processing.</span></span> <span data-ttu-id="375e2-240">Les requêtes utilisent un langage de type SQL dont certaines extensions sont propres à Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-240">The queries use a SQL-like language that has some extensions specific to stream analytics.</span></span> 

<span data-ttu-id="375e2-241">Une requête très simple peut lire simplement toutes les données entrantes.</span><span class="sxs-lookup"><span data-stu-id="375e2-241">A very simple query might simply read all the incoming data.</span></span> <span data-ttu-id="375e2-242">Toutefois, vous créez souvent des requêtes qui recherchent des données spécifiques ou des relations dans les données.</span><span class="sxs-lookup"><span data-stu-id="375e2-242">However, you often create queries that look for specific data or for relationships in the data.</span></span> <span data-ttu-id="375e2-243">Dans cette section du didacticiel, vous allez créer et tester plusieurs requêtes pour découvrir quelques méthodes via lesquelles vous pouvez transformer un flux d’entrée pour l’analyse.</span><span class="sxs-lookup"><span data-stu-id="375e2-243">In this section of the tutorial, you will create and test several queries to learn a few ways in which you can transform an input stream for analysis.</span></span> 

<span data-ttu-id="375e2-244">Les requêtes que vous créez ici affichent uniquement les données transformées à l’écran.</span><span class="sxs-lookup"><span data-stu-id="375e2-244">The queries you create here will just display the transformed data to the screen.</span></span> <span data-ttu-id="375e2-245">Dans une section ultérieure, vous allez configurer un récepteur de sortie et une requête qui écriront les données transformées dans ce récepteur.</span><span class="sxs-lookup"><span data-stu-id="375e2-245">In a later section, you'll configure an output sink and a query that writes the transformed data to that sink.</span></span>

<span data-ttu-id="375e2-246">Pour plus d’informations sur ce langage, consultez la page [Références sur le langage des requêtes d’Azure Stream Analytics](https://msdn.microsoft.com/library/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="375e2-246">To learn more about the language, see the [Azure Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/dn834998.aspx).</span></span>

### <a name="get-sample-data-for-testing-queries"></a><span data-ttu-id="375e2-247">Obtenir des exemples de données pour tester des requêtes</span><span class="sxs-lookup"><span data-stu-id="375e2-247">Get sample data for testing queries</span></span>

<span data-ttu-id="375e2-248">L’application TelcoGenerator envoie des enregistrements d’appels au concentrateur Event Hub, et votre travail Stream Analytics est configuré pour la lecture d’un concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-248">The TelcoGenerator app is sending call records to the event hub, and your Stream Analytics job is configured to read from the event hub.</span></span> <span data-ttu-id="375e2-249">Vous pouvez utiliser une requête pour tester le travail afin de vous assurer qu’il lit correctement.</span><span class="sxs-lookup"><span data-stu-id="375e2-249">You can use a query to test the job to make sure that it's reading correctly.</span></span> <span data-ttu-id="375e2-250">Pour tester une requête dans la console Azure, vous avez besoin d’exemples de données.</span><span class="sxs-lookup"><span data-stu-id="375e2-250">To  test a query in the Azure console, you need sample data.</span></span> <span data-ttu-id="375e2-251">Pour cette procédure pas à pas, vous allez extraire des exemples de données à partir du flux entrant dans le concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-251">For this walkthrough, you'll extract sample data from the stream that's coming into the event hub.</span></span>

1. <span data-ttu-id="375e2-252">Assurez-vous que l’application TelcoGenerator s’exécute et qu’elle produit des enregistrements d’appels.</span><span class="sxs-lookup"><span data-stu-id="375e2-252">Make sure that the TelcoGenerator app is running and producing call records.</span></span>
2. <span data-ttu-id="375e2-253">Dans le portail, retournez dans le panneau du travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-253">In the portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="375e2-254">(Si vous avez fermé le panneau, recherchez `sa_frauddetection_job_demo` dans le panneau **Toutes les ressources**.)</span><span class="sxs-lookup"><span data-stu-id="375e2-254">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
3. <span data-ttu-id="375e2-255">Cliquez dans la zone **Requête**.</span><span class="sxs-lookup"><span data-stu-id="375e2-255">Click the **Query** box.</span></span> <span data-ttu-id="375e2-256">Azure répertorie les entrées et sorties qui sont configurées pour le travail. Vous pouvez également utiliser Azure pour créer une requête qui vous permettra de transformer le flux d’entrée lorsqu’il est envoyé vers la sortie.</span><span class="sxs-lookup"><span data-stu-id="375e2-256">Azure lists the inputs and outputs that are configured for the job, and lets you create a query that lets you transform the input stream as it is sent to the output.</span></span>
4. <span data-ttu-id="375e2-257">Dans le panneau **Requête**, cliquez sur les points situés à côté de l’entrée `CallStream`, puis sélectionnez **Exemple de données de l’entrée**.</span><span class="sxs-lookup"><span data-stu-id="375e2-257">In the **Query** blade, click the dots next to the `CallStream` input and then select **Sample data from input**.</span></span>

    ![Options du menu permettant d’utiliser des exemples de données pour l’entrée du travail Stream Analytics avec l’option Exemple de données de l’entrée sélectionnée](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-sample-data-from-input.png)

    <span data-ttu-id="375e2-259">Cette opération ouvre un panneau qui vous permet de spécifier la quantité d’exemples de données à obtenir, définie en termes de durée de lecture du flux d’entrée.</span><span class="sxs-lookup"><span data-stu-id="375e2-259">This opens a blade that lets you specify how much sample data to get, defined in terms of how long to read the input stream.</span></span>

5. <span data-ttu-id="375e2-260">Définissez l’option **Minutes** sur 3, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="375e2-260">Set **Minutes** to 3 and then click **OK**.</span></span> 
    
    ![Options d’échantillonnage du flux d’entrée, avec la valeur « 3 minutes » sélectionnée.](./media/stream-analytics-real-time-fraud-detection/stream-analytics-input-create-sample-data.png)

    <span data-ttu-id="375e2-262">À partir du flux d’entrée, Azure échantillonne les données pour une valeur correspondant à une durée de 3 minutes, et vous informe lorsque l’échantillon est prêt.</span><span class="sxs-lookup"><span data-stu-id="375e2-262">Azure samples 3 minutes' worth of data from the input stream and notifies you when the sample data is ready.</span></span> <span data-ttu-id="375e2-263">(Cette opération prend quelques instants.)</span><span class="sxs-lookup"><span data-stu-id="375e2-263">(This takes a short while.)</span></span> 

<span data-ttu-id="375e2-264">L’exemple de données est stocké temporairement et disponible tant que la fenêtre de requête est ouverte.</span><span class="sxs-lookup"><span data-stu-id="375e2-264">The sample data is stored temporarily and is available while you have the query window open.</span></span> <span data-ttu-id="375e2-265">Si vous la fermez, l’exemple de données est abandonné, et vous devez en créer un autre.</span><span class="sxs-lookup"><span data-stu-id="375e2-265">If you close the query window, the sample data is discarded, and you'll have to create a new set of sample data.</span></span> 

<span data-ttu-id="375e2-266">Vous pouvez également obtenir un fichier .json qui contient des exemples de données [de GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json), puis charger ce fichier .json dont vous pouvez utiliser les exemples de données pour l’entrée `CallStream`.</span><span class="sxs-lookup"><span data-stu-id="375e2-266">As an alternative, you can get a .json file that has sample data in it [from GitHub](https://github.com/Azure/azure-stream-analytics/blob/master/Sample%20Data/telco.json), and then upload that .json file to use as sample data for the `CallStream` input .</span></span> 

### <a name="test-using-a-pass-through-query"></a><span data-ttu-id="375e2-267">Procéder à un test à l’aide d’une requête directe</span><span class="sxs-lookup"><span data-stu-id="375e2-267">Test using a pass-through query</span></span>

<span data-ttu-id="375e2-268">Si vous voulez archiver tous les événements, vous pouvez utiliser une requête directe pour lire tous les champs dans la charge utile de l’événement.</span><span class="sxs-lookup"><span data-stu-id="375e2-268">If you want to archive every event, you can use a pass-through query to read all the fields in the payload of the event.</span></span>

1. <span data-ttu-id="375e2-269">Dans la fenêtre de requête, entrez la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="375e2-269">In the query window, enter this query:</span></span>

        SELECT 
            *
        FROM 
            CallStream

    >[!NOTE]
    ><span data-ttu-id="375e2-270">Comme dans SQL, les mots clés ne respectent pas la casse, et les espaces blancs ne sont pas significatifs.</span><span class="sxs-lookup"><span data-stu-id="375e2-270">As with SQL, keywords are not case sensitive, and whitespace is not significant.</span></span>

    <span data-ttu-id="375e2-271">Dans cette requête, `CallStream` est l’alias que vous avez spécifié lorsque vous avez créé l’entrée.</span><span class="sxs-lookup"><span data-stu-id="375e2-271">In this query, `CallStream` is the alias that you specified when you created the input.</span></span> <span data-ttu-id="375e2-272">Si vous en avez utilisé un autre, utilisez plutôt ce nom.</span><span class="sxs-lookup"><span data-stu-id="375e2-272">If you used a different alias, use that name instead.</span></span>

2. <span data-ttu-id="375e2-273">Cliquez sur **Test**.</span><span class="sxs-lookup"><span data-stu-id="375e2-273">Click **Test**.</span></span>

    <span data-ttu-id="375e2-274">Le travail Stream Analytics exécute la requête dans l’exemple de données et affiche la sortie au bas de la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="375e2-274">The Stream Analytics job runs the query against the sample data and displays the output at the bottom of the window.</span></span> <span data-ttu-id="375e2-275">Vous savez ainsi que le concentrateur Event Hub et le travail Stream Analytics sont correctement configurés.</span><span class="sxs-lookup"><span data-stu-id="375e2-275">This tells you that the event hub and the Streaming Analytics job are configured correctly.</span></span> <span data-ttu-id="375e2-276">(Comme indiqué, vous allez créer ultérieurement un récepteur de sortie dans lequel la requête pourra écrire des données.)</span><span class="sxs-lookup"><span data-stu-id="375e2-276">(As noted, later you'll create an output sink that the query can write data to.)</span></span>

    ![Sortie du travail Stream Analytics, affichant 73 enregistrements générés](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output.png)

    <span data-ttu-id="375e2-278">Le nombre exact d’enregistrements que vous pouvez observer dépend du nombre d’enregistrements qui ont été capturés dans votre échantillon de 3 minutes.</span><span class="sxs-lookup"><span data-stu-id="375e2-278">The exact number of records you see will depend on how many records were captured in your 3-minute sample.</span></span>
 
### <a name="reduce-the-number-of-fields-using-a-column-projection"></a><span data-ttu-id="375e2-279">Réduire le nombre de champs à l’aide d’une projection de colonne</span><span class="sxs-lookup"><span data-stu-id="375e2-279">Reduce the number of fields using a column projection</span></span>

<span data-ttu-id="375e2-280">Dans de nombreux cas, il n’est pas nécessaire d’insérer toutes les colonnes du flux d’entrée pour l’analyse.</span><span class="sxs-lookup"><span data-stu-id="375e2-280">In many cases, your analysis doesn't need all the columns from the input stream.</span></span> <span data-ttu-id="375e2-281">Vous pouvez utiliser une requête pour projeter moins de champs retournés que dans la requête directe.</span><span class="sxs-lookup"><span data-stu-id="375e2-281">You can use a query to project a smaller set of returned fields than in the pass-through query.</span></span>

1. <span data-ttu-id="375e2-282">Dans l’éditeur de code, modifiez la requête comme suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-282">Change the query in the code editor to the following:</span></span>

        SELECT CallRecTime, SwitchNum, CallingIMSI, CallingNum, CalledNum 
        FROM 
            CallStream

2. <span data-ttu-id="375e2-283">Cliquez de nouveau sur **Test**.</span><span class="sxs-lookup"><span data-stu-id="375e2-283">Click **Test** again.</span></span> 

    ![Sortie du travail Stream Analytics pour la projection, affichant 25 enregistrements générés](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-projection.png)
 
### <a name="count-incoming-calls-by-region-tumbling-window-with-aggregation"></a><span data-ttu-id="375e2-285">Compter les appels entrants par région : fenêtre bascule avec agrégation</span><span class="sxs-lookup"><span data-stu-id="375e2-285">Count incoming calls by region: Tumbling window with aggregation</span></span>

<span data-ttu-id="375e2-286">Supposons que vous souhaitiez compter le nombre d’appels entrants par région.</span><span class="sxs-lookup"><span data-stu-id="375e2-286">Suppose you want to count the number of incoming calls per region.</span></span> <span data-ttu-id="375e2-287">Dans les données de flux, lorsque vous souhaitez effectuer des fonctions d’agrégation telles que le comptage, vous devez segmenter le flux en unités temporelles (puisque le flux de données proprement dit est en réalité un nombre infini).</span><span class="sxs-lookup"><span data-stu-id="375e2-287">In streaming data, when you want to perform aggregate functions like counting, you need to segment the stream into temporal units (since the data stream itself is effectively endless).</span></span> <span data-ttu-id="375e2-288">Pour ce faire, utilisez une [fonction de fenêtre](stream-analytics-window-functions.md) Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-288">You do this using a Streaming Analytics [window function](stream-analytics-window-functions.md).</span></span> <span data-ttu-id="375e2-289">Vous pouvez alors utiliser les données contenues dans cette fenêtre comme unité.</span><span class="sxs-lookup"><span data-stu-id="375e2-289">You can then work with the data inside that window as a unit.</span></span>

<span data-ttu-id="375e2-290">Pour cette transformation, vous souhaitez une séquence de fenêtres temporelles ne se chevauchant pas ; chaque fenêtre contient un ensemble distinct de données que vous pouvez regrouper et agréger.</span><span class="sxs-lookup"><span data-stu-id="375e2-290">For this transformation, you want a sequence of temporal windows that don't overlap—each window will have a discrete set of data that you can group and aggregate.</span></span> <span data-ttu-id="375e2-291">Ce type de fenêtre est appelé *fenêtre bascule*.</span><span class="sxs-lookup"><span data-stu-id="375e2-291">This type of window is referred to as a *Tumbling window* .</span></span> <span data-ttu-id="375e2-292">Dans la fenêtre bascule, vous pouvez obtenir le nombre des appels entrants, regroupés par `SwitchNum`, qui représente le pays d’origine de l’appel.</span><span class="sxs-lookup"><span data-stu-id="375e2-292">Within the Tumbling window, you can get a count of the incoming calls grouped by `SwitchNum`, which represents the country where the call originated.</span></span> 

1. <span data-ttu-id="375e2-293">Dans l’éditeur de code, modifiez la requête comme suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-293">Change the query in the code editor to the following:</span></span>

        SELECT 
            System.Timestamp as WindowEnd, SwitchNum, COUNT(*) as CallCount 
        FROM
            CallStream TIMESTAMP BY CallRecTime 
        GROUP BY TUMBLINGWINDOW(s, 5), SwitchNum

    <span data-ttu-id="375e2-294">Cette requête utilise le mot-clé `Timestamp By` dans la clause `FROM` pour spécifier le champ d’horodatage à utiliser dans le flux d’entrée pour définir la fenêtre bascule.</span><span class="sxs-lookup"><span data-stu-id="375e2-294">This query uses the `Timestamp By` keyword in the `FROM` clause to specify which timestamp field in the input stream to use to define the Tumbling window.</span></span> <span data-ttu-id="375e2-295">Dans ce cas, la fenêtre divise les données en segments en fonction du champ `CallRecTime` dans chaque enregistrement.</span><span class="sxs-lookup"><span data-stu-id="375e2-295">In this case, the window divides the data into segments by the `CallRecTime` field in each record.</span></span> <span data-ttu-id="375e2-296">(Si aucun champ n’est spécifié, l’opération de fenêtrage utilise l’heure d’arrivée de chaque événement dans le concentrateur Event Hub.)</span><span class="sxs-lookup"><span data-stu-id="375e2-296">(If no field is specified, the windowing operation uses the time that each event arrives at the event hub.</span></span> <span data-ttu-id="375e2-297">Voir « Heure d’arrivée par rapport à l’heure de l’application » dans [Informations de référence sur le langage de requête Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span><span class="sxs-lookup"><span data-stu-id="375e2-297">See "Arrival Time Vs Application Time" in [Stream Analytics Query Language Reference](https://msdn.microsoft.com/library/azure/dn834998.aspx).</span></span> 

    <span data-ttu-id="375e2-298">La projection inclut `System.Timestamp`, qui retourne un horodatage pour la fin de chaque fenêtre.</span><span class="sxs-lookup"><span data-stu-id="375e2-298">The projection includes `System.Timestamp`, which returns a timestamp for the end of each window.</span></span> 

    <span data-ttu-id="375e2-299">Pour préciser que vous souhaitez utiliser une fenêtre bascule, utilisez la fonction [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) dans la clause `GROUP BY `.</span><span class="sxs-lookup"><span data-stu-id="375e2-299">To specify that you want to use a Tumbling window, you use the [TUMBLINGWINDOW](https://msdn.microsoft.com/library/dn835055.aspx) function in the `GROUP BY `clause.</span></span> <span data-ttu-id="375e2-300">Dans la fonction, indiquez une unité de temps (d’une microseconde à un jour) et une taille de fenêtre (nombre d’unités).</span><span class="sxs-lookup"><span data-stu-id="375e2-300">In the function, you specify a time unit (anywhere from a microsecond to a day) and a window size (how many units).</span></span> <span data-ttu-id="375e2-301">Dans cet exemple, comme la fenêtre bascule se compose d’intervalles de 5 secondes vous obtenez un nombre (par pays) d’appels d’une valeur de 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="375e2-301">In this example, the Tumbling window consists of 5-second intervals, so you will get a count by country for every 5 seconds' worth of calls.</span></span>

2. <span data-ttu-id="375e2-302">Cliquez de nouveau sur **Test**.</span><span class="sxs-lookup"><span data-stu-id="375e2-302">Click **Test** again.</span></span> <span data-ttu-id="375e2-303">Dans les résultats, notez que les horodatages indiqués sous **WindowEnd** sont exprimés par incréments de 5 secondes.</span><span class="sxs-lookup"><span data-stu-id="375e2-303">In the results, notice that the timestamps under **WindowEnd** are in 5-second increments.</span></span>

    ![Sortie du travail Stream Analytics pour l’agrégation, affichant 13 enregistrements générés](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-aggregation.png)
 
### <a name="detect-sim-fraud-using-a-self-join"></a><span data-ttu-id="375e2-305">Détecter une fraude à la carte SIM à l’aide d’une jointure réflexive</span><span class="sxs-lookup"><span data-stu-id="375e2-305">Detect SIM fraud using a self-join</span></span>

<span data-ttu-id="375e2-306">Pour cet exemple, nous pouvons envisager l’utilisation frauduleuse suivante : appels provenant d’un même utilisateur, mais à différents lieux, espacés de 5 secondes à chaque fois.</span><span class="sxs-lookup"><span data-stu-id="375e2-306">For this example, we can consider fraudulent usage to be calls that originate from the same user but in different locations within 5 seconds of one another.</span></span> <span data-ttu-id="375e2-307">Par exemple, un même utilisateur ne peut pas légitimement passer simultanément un appel depuis les États-Unis et l’Australie.</span><span class="sxs-lookup"><span data-stu-id="375e2-307">For example, the same user can't legitimately make a call from the US and Australia at the same time.</span></span> 

<span data-ttu-id="375e2-308">Pour ces cas, vous pouvez utiliser une jointure réflexive des données de flux pour joindre le flux à lui-même en fonction de la valeur `CallRecTime`.</span><span class="sxs-lookup"><span data-stu-id="375e2-308">To check for these cases, you can use a self-join of the streaming data to join the stream to itself based on the `CallRecTime` value.</span></span> <span data-ttu-id="375e2-309">Vous pouvez ensuite rechercher les enregistrements d’appels où la valeur `CallingIMSI` (numéro d’origine) est identique, contrairement à la valeur `SwitchNum` (pays d’origine).</span><span class="sxs-lookup"><span data-stu-id="375e2-309">You can then look for call records where the `CallingIMSI` value (the originating number) is the same, but the `SwitchNum` value (country of origin) is not the same.</span></span>

<span data-ttu-id="375e2-310">Si vous utilisez une jointure avec des données de flux, la jointure doit indiquer certaines limites relatives à l’intervalle pouvant séparer des lignes correspondantes dans le temps.</span><span class="sxs-lookup"><span data-stu-id="375e2-310">When you use a join with streaming data, the join must provide some limits on how far the matching rows can be separated in time.</span></span> <span data-ttu-id="375e2-311">(Comme indiqué précédemment, les données de flux sont effectivement sans fin.) Les limites temporelles de la relation sont spécifiées dans la clause `ON` de la jointure, à l’aide de la fonction `DATEDIFF`.</span><span class="sxs-lookup"><span data-stu-id="375e2-311">(As noted earlier, the streaming data is effectively endless.) The time bounds for the relationship are specified inside the `ON` clause of the join, using the `DATEDIFF` function .</span></span> <span data-ttu-id="375e2-312">Dans ce cas, la jointure est basée sur un intervalle de 5 secondes des données d’appels.</span><span class="sxs-lookup"><span data-stu-id="375e2-312">In this case, the join is based on a 5-second interval of call data .</span></span>

1. <span data-ttu-id="375e2-313">Dans l’éditeur de code, modifiez la requête comme suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-313">Change the query in the code editor to the following:</span></span> 

        SELECT  System.Timestamp as Time, 
            CS1.CallingIMSI, 
            CS1.CallingNum as CallingNum1, 
            CS2.CallingNum as CallingNum2, 
            CS1.SwitchNum as Switch1, 
            CS2.SwitchNum as Switch2 
        FROM CallStream CS1 TIMESTAMP BY CallRecTime 
            JOIN CallStream CS2 TIMESTAMP BY CallRecTime 
            ON CS1.CallingIMSI = CS2.CallingIMSI 
            AND DATEDIFF(ss, CS1, CS2) BETWEEN 1 AND 5 
        WHERE CS1.SwitchNum != CS2.SwitchNum

    <span data-ttu-id="375e2-314">Cette requête est semblable aux jointures SQL excepté pour la fonction `DATEDIFF` de la jointure.</span><span class="sxs-lookup"><span data-stu-id="375e2-314">This query is like any SQL join except for the `DATEDIFF` function in the join.</span></span> <span data-ttu-id="375e2-315">Il s’agit d’une version de `DATEDIFF` qui est propre à Stream Analytics et qui doit apparaître dans la clause `ON...BETWEEN`.</span><span class="sxs-lookup"><span data-stu-id="375e2-315">This is a version of `DATEDIFF` that's specific to Streaming Analytics, and it must appear in the `ON...BETWEEN` clause.</span></span> <span data-ttu-id="375e2-316">Les paramètres sont une unité de temps (des secondes dans cet exemple) et les alias des deux sources pour la jointure.</span><span class="sxs-lookup"><span data-stu-id="375e2-316">The parameters are a time unit (seconds in this example) and the aliases of the two sources for the join.</span></span> <span data-ttu-id="375e2-317">(Cela diffère de la fonction `DATEDIFF` SQL standard.)</span><span class="sxs-lookup"><span data-stu-id="375e2-317">(This is different from the standard SQL `DATEDIFF` function.)</span></span> 

    <span data-ttu-id="375e2-318">La clause `WHERE` inclut la condition qui marque l’appel frauduleux : les commutateurs d’origine ne sont pas identiques.</span><span class="sxs-lookup"><span data-stu-id="375e2-318">The `WHERE` clause includes the condition that flags the fraudulent call: the originating switches are not the same.</span></span> 

2. <span data-ttu-id="375e2-319">Cliquez de nouveau sur **Test**.</span><span class="sxs-lookup"><span data-stu-id="375e2-319">Click **Test** again.</span></span> 

    ![Sortie du travail Stream Analytics pour la jointure réflexive, affichant 6 enregistrements générés](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-sample-output-self-join.png)

3. <span data-ttu-id="375e2-321">Cliquez sur **Save**.</span><span class="sxs-lookup"><span data-stu-id="375e2-321">Click **Save**.</span></span> <span data-ttu-id="375e2-322">Cette opération enregistre la requête de jointure réflexive dans le cadre du travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-322">This saves the self-join query as part of the Streaming Analytics job.</span></span> <span data-ttu-id="375e2-323">(Elle n’enregistre pas l’exemple de données.)</span><span class="sxs-lookup"><span data-stu-id="375e2-323">(It doesn't save the sample data.)</span></span>

    ![Enregistrer un travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-query-editor-save-button-new-portal.png)

## <a name="create-an-output-sink-to-store-transformed-data"></a><span data-ttu-id="375e2-325">Créer un récepteur de sortie pour stocker les données transformées</span><span class="sxs-lookup"><span data-stu-id="375e2-325">Create an output sink to store transformed data</span></span>

<span data-ttu-id="375e2-326">Vous avez défini un flux d’événements, une entrée de concentrateur Event Hub pour ingérer des événements, et une requête pour effectuer une transformation sur le flux.</span><span class="sxs-lookup"><span data-stu-id="375e2-326">You've defined an event stream, an event hub input to ingest events, and a query to perform a transformation over the stream.</span></span> <span data-ttu-id="375e2-327">La dernière étape consiste à définir un récepteur de sortie pour le travail, c’est-à-dire un emplacement pour y écrire le flux transformé.</span><span class="sxs-lookup"><span data-stu-id="375e2-327">The last step is to define an output sink for the job—that is, a place to write the transformed stream to.</span></span> 

<span data-ttu-id="375e2-328">Vous pouvez utiliser de nombreuses ressources comme récepteurs de sortie : une base de données SQL Server, le stockage Table, le stockage Data Lake, Power BI et même un autre concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-328">You can use many resources as output sinks—a SQL Server database, table storage, Data Lake storage, Power BI, and even another event hub.</span></span> <span data-ttu-id="375e2-329">Pour ce didacticiel, vous allez écrire le flux dans Stockage Blob Azure, qui est le choix par défaut pour la collecte des informations sur les événements pour une analyse ultérieure, car il prend en charge les données non structurées.</span><span class="sxs-lookup"><span data-stu-id="375e2-329">For this tutorial, you'll write the stream to Azure Blob Storage, which is a typical choice for collecting event information for later analysis, since it accommodates unstructured data .</span></span>

<span data-ttu-id="375e2-330">Si vous possédez déjà un compte de stockage d’objets blob, vous pouvez l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="375e2-330">If you have an existing blob storage account, you can use that.</span></span> <span data-ttu-id="375e2-331">Nous allons vous montrer ici comment créer un compte de stockage destiné uniquement à ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="375e2-331">For this tutorial, we'll show you how to create a new storage account just for this tutorial.</span></span>

### <a name="create-an-azure-blob-storage-account"></a><span data-ttu-id="375e2-332">Créer un compte de stockage Blob Azure</span><span class="sxs-lookup"><span data-stu-id="375e2-332">Create an Azure Blob Storage account</span></span>

1. <span data-ttu-id="375e2-333">Dans le portail Azure, retournez dans le panneau du travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-333">In the Azure portal, return to the Streaming Analytics job blade.</span></span> <span data-ttu-id="375e2-334">(Si vous avez fermé le panneau, recherchez `sa_frauddetection_job_demo` dans le panneau **Toutes les ressources**.)</span><span class="sxs-lookup"><span data-stu-id="375e2-334">(If you closed the blade, search for `sa_frauddetection_job_demo` in the **All resources** blade.)</span></span>
2. <span data-ttu-id="375e2-335">Dans la section **Topologie de la tâche**, cliquez sur la zone **Sortie**.</span><span class="sxs-lookup"><span data-stu-id="375e2-335">In the **Job Topology** section, click the **Output** box.</span></span> 
3. <span data-ttu-id="375e2-336">Dans le panneau **Sorties**, cliquez sur **+&nbsp;Ajouter**, puis renseignez le panneau avec les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="375e2-336">In the **Outputs** blade, click **+&nbsp;Add** and then fill out the blade with these values:</span></span>

    * <span data-ttu-id="375e2-337">**Alias de sortie** : utilisez le nom `CallStream-FraudulentCalls`.</span><span class="sxs-lookup"><span data-stu-id="375e2-337">**Output alias**: Use the name `CallStream-FraudulentCalls`.</span></span> 
    * <span data-ttu-id="375e2-338">**Sink** : sélectionnez **Stockage d’objets blob**.</span><span class="sxs-lookup"><span data-stu-id="375e2-338">**Sink**: Select **Blob storage**.</span></span>
    * <span data-ttu-id="375e2-339">**Options d’importation** : sélectionnez **Utiliser l’objet blob de stockage de l’abonnement actuel**.</span><span class="sxs-lookup"><span data-stu-id="375e2-339">**Import options**: Select **Use blob storage from current subscription**.</span></span>
    * <span data-ttu-id="375e2-340">**Compte de stockage** :</span><span class="sxs-lookup"><span data-stu-id="375e2-340">**Storage account**.</span></span> <span data-ttu-id="375e2-341">sélectionnez **Créer un compte de stockage**.</span><span class="sxs-lookup"><span data-stu-id="375e2-341">Select **Create new storage account.**</span></span>
    * <span data-ttu-id="375e2-342">**Compte de stockage** (seconde zone) :</span><span class="sxs-lookup"><span data-stu-id="375e2-342">**Storage account** (second box).</span></span> <span data-ttu-id="375e2-343">entrez `YOURNAMEsademo`, où `YOURNAME` représente votre nom ou une autre chaîne unique.</span><span class="sxs-lookup"><span data-stu-id="375e2-343">Enter `YOURNAMEsademo`, where `YOURNAME` is your name or another unique string.</span></span> <span data-ttu-id="375e2-344">Le nom, qui doit être unique dans Azure, ne peut contenir que des lettres minuscules et des chiffres.</span><span class="sxs-lookup"><span data-stu-id="375e2-344">The name can use only lowercase letters and numbers, and it must be unique across Azure.</span></span> 
    * <span data-ttu-id="375e2-345">**Conteneur** :</span><span class="sxs-lookup"><span data-stu-id="375e2-345">**Container**.</span></span> <span data-ttu-id="375e2-346">Entrez `sa-fraudulentcalls-demo`.</span><span class="sxs-lookup"><span data-stu-id="375e2-346">Enter `sa-fraudulentcalls-demo`.</span></span>
    <span data-ttu-id="375e2-347">Le nom du compte de stockage et le nom du conteneur sont utilisés ensemble pour fournir un URI pour le stockage d’objets blob, comme suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-347">The storage account name and container name are used together to provide a URI for the blob storage, like this:</span></span> 

    `http://yournamesademo.blob.core.windows.net/sa-fraudulentcalls-demo/...`
    
    ![Panneau Nouvelle sortie pour le travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-create-output-blob-storage-new-console.png)
    
4. <span data-ttu-id="375e2-349">Cliquez sur **Create**.</span><span class="sxs-lookup"><span data-stu-id="375e2-349">Click **Create**.</span></span> 

    <span data-ttu-id="375e2-350">Azure crée le compte de stockage et génère une clé automatiquement.</span><span class="sxs-lookup"><span data-stu-id="375e2-350">Azure creates the storage account and generates a key automatically.</span></span> 

5. <span data-ttu-id="375e2-351">Fermez le panneau **Sorties**.</span><span class="sxs-lookup"><span data-stu-id="375e2-351">Close the **Outputs** blade.</span></span> 

## <a name="start-the-streaming-analytics-job"></a><span data-ttu-id="375e2-352">Démarrer le travail Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="375e2-352">Start the Streaming Analytics job</span></span>

<span data-ttu-id="375e2-353">Le travail est maintenant configuré.</span><span class="sxs-lookup"><span data-stu-id="375e2-353">The job is now configured.</span></span> <span data-ttu-id="375e2-354">Vous avez spécifié une entrée (le concentrateur Event Hub), une transformation (la requête pour rechercher des appels frauduleux) et une sortie (un stockage d’objets blob).</span><span class="sxs-lookup"><span data-stu-id="375e2-354">You've specified an input (the event hub), a transformation (the query to look for fraudulent calls), and an output (blob storage).</span></span> <span data-ttu-id="375e2-355">À présent, vous pouvez démarrer le travail.</span><span class="sxs-lookup"><span data-stu-id="375e2-355">You can now start the job.</span></span> 

1. <span data-ttu-id="375e2-356">Vérifiez que l’application TelcoGenerator est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="375e2-356">Make sure the TelcoGenerator app is running.</span></span>

2. <span data-ttu-id="375e2-357">Dans le panneau du travail, cliquez sur **Démarrer**.</span><span class="sxs-lookup"><span data-stu-id="375e2-357">In the job blade, click **Start**.</span></span>

    ![Démarrage de la tâche Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-output.png)

3. <span data-ttu-id="375e2-359">Dans le panneau **Démarrer le travail**, sélectionnez **Maintenant** pour l’option Heure de début de la sortie de la tâche.</span><span class="sxs-lookup"><span data-stu-id="375e2-359">In the **Start job** blade, for Job output start time, select **Now**.</span></span> 

4. <span data-ttu-id="375e2-360">Cliquez sur **Start**.</span><span class="sxs-lookup"><span data-stu-id="375e2-360">Click **Start**.</span></span> 

    ![Panneau Démarrer le travail pour le travail Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-start-job-blade.png)

    <span data-ttu-id="375e2-362">Azure vous avertit lorsque le travail a démarré. Dans le panneau du travail, l’état **En cours d’exécution** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="375e2-362">Azure notifies you when the job has started, and in the job blade, the status is displayed as **Running**.</span></span>

    ![État du travail Stream Analytics En cours d’exécution](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-running-status.png)
    

## <a name="examine-the-transformed-data"></a><span data-ttu-id="375e2-364">Examiner les données transformées</span><span class="sxs-lookup"><span data-stu-id="375e2-364">Examine the transformed data</span></span>

<span data-ttu-id="375e2-365">À présent, vous disposez d’un travail Stream Analytics complet.</span><span class="sxs-lookup"><span data-stu-id="375e2-365">You now have a complete Streaming Analytics job.</span></span> <span data-ttu-id="375e2-366">Le travail examine un flux de métadonnées d’appels téléphoniques, recherche les appels frauduleux en temps réel et écrit des informations liées à ces appels frauduleux dans un espace de stockage.</span><span class="sxs-lookup"><span data-stu-id="375e2-366">The job is examining a stream of phone call metadata, looking for fraudulent phone calls in real time, and writing information about those fraudulent calls to storage.</span></span> 

<span data-ttu-id="375e2-367">Pour terminer ce didacticiel, vous souhaiterez peut-être examiner les données capturées par le travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-367">To complete this tutorial, you might want to look at the data being captured by the Streaming Analytics job.</span></span> <span data-ttu-id="375e2-368">Les données sont écrites dans Stockage Blob Azure dans des segments (fichiers).</span><span class="sxs-lookup"><span data-stu-id="375e2-368">The data is being written to Azure Blog Storage in chunks (files).</span></span> <span data-ttu-id="375e2-369">Vous pouvez utiliser n’importe quel outil pour lire Stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="375e2-369">You can use any tool that reads Azure Blob Storage.</span></span> <span data-ttu-id="375e2-370">Comme indiqué dans la section Composants requis, vous pouvez utiliser des extensions Azure dans Visual Studio. Vous pouvez également utiliser un outil comme [Explorateur de stockage Azure](http://storageexplorer.com/) ou [Explorateur Azure](http://www.cerebrata.com/products/azure-explorer/introduction).</span><span class="sxs-lookup"><span data-stu-id="375e2-370">As noted in the Prerequisites section, you can use Azure extensions in Visual Studio, or you can use a tool like [Azure Storage Explorer](http://storageexplorer.com/) or [Azure Explorer](http://www.cerebrata.com/products/azure-explorer/introduction).</span></span> 

<span data-ttu-id="375e2-371">Lorsque vous examinez le contenu d’un fichier dans le stockage d’objets blob, ce que vous voyez ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-371">When you examine the contents of a file in blob storage, you see something like the following :</span></span>

![Stockage d’objets blob Azure avec sortie Stream Analytics](./media/stream-analytics-real-time-fraud-detection/stream-analytics-sa-job-blob-storage-view.png)
 

## <a name="clean-up-resources"></a><span data-ttu-id="375e2-373">Supprimer des ressources</span><span class="sxs-lookup"><span data-stu-id="375e2-373">Clean up resources</span></span>

<span data-ttu-id="375e2-374">Nous disposons d’articles supplémentaires sur les scénarios de détection des fraudes qui s’appuient sur les ressources que vous avez créées dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="375e2-374">We have additional articles that continue with the fraud-detection scenario and that use the resources that you've created in this tutorial.</span></span> <span data-ttu-id="375e2-375">Si vous souhaitez poursuivre, consultez les suggestions indiquées dans la section **Étapes suivantes** ci-après.</span><span class="sxs-lookup"><span data-stu-id="375e2-375">If you want to continue, see the suggestions under **Next steps** later.</span></span>

<span data-ttu-id="375e2-376">Toutefois, si vous en avez terminé et n’avez pas besoin des ressources que vous avez créées, vous pouvez les supprimer afin de n’encourir aucuns frais Azure inutiles.</span><span class="sxs-lookup"><span data-stu-id="375e2-376">However, if you're done and you don't need the resources you've created, you can delete them so that you don't incur unnecessary Azure charges.</span></span> <span data-ttu-id="375e2-377">Dans ce cas, nous vous suggérons de procéder comme suit :</span><span class="sxs-lookup"><span data-stu-id="375e2-377">In that case, we suggest that you do the following:</span></span>

1. <span data-ttu-id="375e2-378">Arrêtez le travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-378">Stop the Streaming Analytics job.</span></span> <span data-ttu-id="375e2-379">Dans le panneau **Travaux**, cliquez sur **Arrêter** en haut.</span><span class="sxs-lookup"><span data-stu-id="375e2-379">In the **Jobs** blade, click **Stop** at the top.</span></span>
2. <span data-ttu-id="375e2-380">Arrêtez l’application TelcoGenerator.</span><span class="sxs-lookup"><span data-stu-id="375e2-380">Stop the Telco Generator app.</span></span> <span data-ttu-id="375e2-381">Dans la fenêtre de commande où vous avez démarré l’application, appuyez sur Ctrl+C.</span><span class="sxs-lookup"><span data-stu-id="375e2-381">In the command window where you started the app, press Ctrl+C.</span></span>
3. <span data-ttu-id="375e2-382">Si vous avez créé un compte de stockage d’objets blob pour ce didacticiel, supprimez-le.</span><span class="sxs-lookup"><span data-stu-id="375e2-382">If you created a new blob storage account just for this tutorial, delete it.</span></span> 
4. <span data-ttu-id="375e2-383">Supprimez le travail Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="375e2-383">Delete the Streaming Analytics job.</span></span>
5. <span data-ttu-id="375e2-384">Supprimez le concentrateur Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-384">Delete the event hub.</span></span>
6. <span data-ttu-id="375e2-385">Supprimez l’espace de noms Event Hub.</span><span class="sxs-lookup"><span data-stu-id="375e2-385">Delete the event hub namespace.</span></span>

## <a name="get-support"></a><span data-ttu-id="375e2-386">Obtenir de l'aide</span><span class="sxs-lookup"><span data-stu-id="375e2-386">Get support</span></span>

<span data-ttu-id="375e2-387">Pour obtenir une assistance, consultez le [forum Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)</span><span class="sxs-lookup"><span data-stu-id="375e2-387">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="375e2-388">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="375e2-388">Next steps</span></span>

<span data-ttu-id="375e2-389">Vous pouvez poursuivre ce didacticiel en lisant les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="375e2-389">You can continue this tutorial with the following articles:</span></span>

* <span data-ttu-id="375e2-390">[Stream Analytics et Power BI : tableau de bord d’analyse en temps réel pour les données de streaming](stream-analytics-power-bi-dashboard.md).</span><span class="sxs-lookup"><span data-stu-id="375e2-390">[Stream Analytics and Power BI: A real-time analytics dashboard for streaming data](stream-analytics-power-bi-dashboard.md).</span></span> <span data-ttu-id="375e2-391">Cet article explique comment envoyer la sortie de l’application TelcoStreaming du travail Stream Analytics à Power BI pour l’analyse et la visualisation en temps réel.</span><span class="sxs-lookup"><span data-stu-id="375e2-391">This article shows you how to send the TelCo output of the Stream Analytics job to Power BI for real-time visualization and analysis.</span></span>
* <span data-ttu-id="375e2-392">[Comment stocker des données Azure Stream Analytics dans un Cache Redis Azure à l’aide d’Azure Functions](stream-analytics-functions-redis.md).</span><span class="sxs-lookup"><span data-stu-id="375e2-392">[How to store data from Azure Stream Analytics in an Azure Redis Cache using Azure Functions](stream-analytics-functions-redis.md).</span></span> <span data-ttu-id="375e2-393">Cet article explique comment utiliser Azure Functions pour écrire des appels frauduleux dans un Cache Redis Azure via une file d’attente Service Bus.</span><span class="sxs-lookup"><span data-stu-id="375e2-393">This article shows how to use Azure Functions to write fraudulent calls to an Azure Redis cache via a Service Bus queue.</span></span>

<span data-ttu-id="375e2-394">Pour plus d’informations sur Stream Analytics en général, consultez les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="375e2-394">For more information about Stream Analytics in general, try these articles:</span></span>

* [<span data-ttu-id="375e2-395">Présentation d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="375e2-395">Introduction to Azure Stream Analytics</span></span>](stream-analytics-introduction.md)
* [<span data-ttu-id="375e2-396">Mise à l'échelle des travaux Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="375e2-396">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="375e2-397">Références sur le langage des requêtes d'Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="375e2-397">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="375e2-398">Références sur l’API REST de gestion d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="375e2-398">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
