---
title: "aaaJob mise à l’échelle avec des fonctions d’Analytique de flux de données Azure & AzureML | Documents Microsoft"
description: "Découvrez comment tooproperly l’échelle des travaux de flux de données Analytique (partitionnement, SU la quantité et bien plus encore) lors de l’utilisation des fonctions d’Azure Machine Learning."
keywords: 
documentationcenter: 
services: stream-analytics
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 47ce7c5e-1de1-41ca-9a26-b5ecce814743
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: jeffstok
ms.openlocfilehash: 3fbdfaf7e8e86896c56f1d18bbde3a10bd3dca04
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="scale-your-stream-analytics-job-with-azure-machine-learning-functions"></a><span data-ttu-id="1599d-103">Mettre à l’échelle votre travail Stream Analytics avec des fonctions Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="1599d-103">Scale your Stream Analytics job with Azure Machine Learning functions</span></span>
<span data-ttu-id="1599d-104">Il est souvent très simple tooset d’une tâche de flux de données Analytique et exécuter des exemples de données par son biais.</span><span class="sxs-lookup"><span data-stu-id="1599d-104">It is often quite easy tooset up an Stream Analytics job and run some sample data through it.</span></span> <span data-ttu-id="1599d-105">Que devons-nous faire lorsque nous devons toorun hello même travail avec le plus grand volume de données ?</span><span class="sxs-lookup"><span data-stu-id="1599d-105">What should we do when we need toorun hello same job with higher data volume?</span></span> <span data-ttu-id="1599d-106">Elle nécessite toounderstand comment tooconfigure hello Analytique de flux de travail afin qu’il mettra à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="1599d-106">It requires us toounderstand how tooconfigure hello Stream Analytics job so that it will scale.</span></span> <span data-ttu-id="1599d-107">Dans ce document, nous nous concentrerons sur les aspects particuliers de hello de mise à l’échelle Analytique de flux de travaux avec des fonctions d’apprentissage.</span><span class="sxs-lookup"><span data-stu-id="1599d-107">In this document, we will focus on hello special aspects of scaling Stream Analytics jobs with Machine Learning functions.</span></span> <span data-ttu-id="1599d-108">Pour plus d’informations sur les tâches de flux de données Analytique tooscale voir en général l’article de hello [mise à l’échelle des travaux](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="1599d-108">For information on how tooscale Stream Analytics jobs in general see hello article [Scaling jobs](stream-analytics-scale-jobs.md).</span></span>

## <a name="what-is-an-azure-machine-learning-function-in-stream-analytics"></a><span data-ttu-id="1599d-109">Qu’est-ce qu’une fonction Azure Machine Learning dans Stream Analytics ?</span><span class="sxs-lookup"><span data-stu-id="1599d-109">What is an Azure Machine Learning function in Stream Analytics?</span></span>
<span data-ttu-id="1599d-110">Une fonction Machine Learning dans le flux de données Analytique peut être utilisée comme un appel de fonction normal Bonjour langage de requête Analytique de flux de données.</span><span class="sxs-lookup"><span data-stu-id="1599d-110">A Machine Learning function in Stream Analytics can be used like a regular function call in hello Stream Analytics query language.</span></span> <span data-ttu-id="1599d-111">Toutefois, derrière la scène de hello, appels de fonction hello sont en fait des demandes de Service Web de Azure Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="1599d-111">However, behind hello scene, hello function calls are actually Azure Machine Learning Web Service requests.</span></span> <span data-ttu-id="1599d-112">Web de la machine Learning services prennent en charge « traitement par lot » de plusieurs lignes, et qui est appelé mini- lot, Bonjour même web appel d’API de service, tooimprove débit global.</span><span class="sxs-lookup"><span data-stu-id="1599d-112">Machine Learning web services support “batching” multiple rows, which is called mini-batch, in hello same web service API call, tooimprove overall throughput.</span></span> <span data-ttu-id="1599d-113">Consultez hello suivant des articles pour plus de détails ; [Fonctions azure Machine Learning dans le flux de données Analytique](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) et [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span><span class="sxs-lookup"><span data-stu-id="1599d-113">Please see hello following articles for more details; [Azure Machine Learning functions in Stream Analytics](https://blogs.technet.microsoft.com/machinelearning/2015/12/10/azure-ml-now-available-as-a-function-in-azure-stream-analytics/) and [Azure Machine Learning Web Services](../machine-learning/machine-learning-consume-web-services.md).</span></span>

## <a name="configure-a-stream-analytics-job-with-machine-learning-functions"></a><span data-ttu-id="1599d-114">Configurer un travail Stream Analytics avec des fonctions Azure Machine Learning</span><span class="sxs-lookup"><span data-stu-id="1599d-114">Configure a Stream Analytics job with Machine Learning functions</span></span>
<span data-ttu-id="1599d-115">Lorsque vous configurez une fonction Machine Learning pour la tâche de flux de données Analytique, il y a deux paramètres tooconsider taille de lot hello des appels de fonction Machine Learning hello et hello unités (SUs) configurées pour la tâche de flux de données Analytique hello diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="1599d-115">When configuring a Machine Learning function for Stream Analytics job, there are two parameters tooconsider, hello batch size of hello Machine Learning function calls, and hello streaming units (SUs) provisioned for hello Stream Analytics job.</span></span> <span data-ttu-id="1599d-116">toodetermine hello les valeurs appropriées dans ce cas, tout d’abord une décision entre la latence et le débit, autrement dit, latence de la tâche de flux de données Analytique hello et le débit de chaque SU.</span><span class="sxs-lookup"><span data-stu-id="1599d-116">toodetermine hello appropriate values for these, first a decision must be made between latency and throughput, that is, latency of hello Stream Analytics job, and throughput of each SU.</span></span> <span data-ttu-id="1599d-117">SUs peuvent toujours être ajoutés tooa travail tooincrease de débit d’une requête Analytique de flux de données partitionnée correctement, bien que SUs supplémentaires augmente le coût hello du travail de hello en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="1599d-117">SUs may always be added tooa job tooincrease throughput of a well partitioned Stream Analytics query, although additional SUs increases hello cost of running hello job.</span></span>

<span data-ttu-id="1599d-118">Par conséquent, il est important de toodetermine hello *la tolérance de panne* de latence en cours d’une tâche de flux de données Analytique.</span><span class="sxs-lookup"><span data-stu-id="1599d-118">Therefore it is important toodetermine hello *tolerance* of latency in running a Stream Analytics job.</span></span> <span data-ttu-id="1599d-119">Une latence supplémentaire de l’exécution des demandes de service Azure Machine Learning naturellement augmente avec la taille de lot, qui est composée de latence hello de tâche de flux de données Analytique hello.</span><span class="sxs-lookup"><span data-stu-id="1599d-119">Additional latency from running Azure Machine Learning service requests will naturally increase with batch size, which will compound hello latency of hello Stream Analytics job.</span></span> <span data-ttu-id="1599d-120">Hello autre part, l’augmentation de taille de lot permet tooprocess de tâche de flux de données Analytique hello * davantage d’événements avec hello *même nombre* de l’apprentissage des demandes de service web.</span><span class="sxs-lookup"><span data-stu-id="1599d-120">On hello other hand, increasing batch size allows hello Stream Analytics job tooprocess *more events with hello *same number* of Machine Learning web service requests.</span></span> <span data-ttu-id="1599d-121">Fréquence à laquelle l’augmentation hello de latence de service web Machine Learning est augmentation linéaire inférieur toohello taille de lot par conséquent, il est important tooconsider hello plus rentable taille de lot pour un service web de Machine Learning dans toute situation donnée.</span><span class="sxs-lookup"><span data-stu-id="1599d-121">Often hello increase of Machine Learning web service latency is sub-linear toohello increase of batch size so it is important tooconsider hello most cost-efficient batch size for a Machine Learning web service in any given situation.</span></span> <span data-ttu-id="1599d-122">taille de lot Hello par défaut pour le service web de hello demande est comprise entre 1000 et peut être modifié à l’aide de hello [API REST de flux de données Analytique](https://msdn.microsoft.com/library/mt653706.aspx "API REST de flux de données Analytique") ou hello [client PowerShell pour les flux de données Analytique](stream-analytics-monitor-and-manage-jobs-use-powershell.md "client PowerShell pour les flux de données Analytique").</span><span class="sxs-lookup"><span data-stu-id="1599d-122">hello default batch size for hello web service requests is 1000 and may be modified either by using hello [Stream Analytics REST API](https://msdn.microsoft.com/library/mt653706.aspx "Stream Analytics REST API") or hello [PowerShell client for Stream Analytics](stream-analytics-monitor-and-manage-jobs-use-powershell.md "PowerShell client for Stream Analytics").</span></span>

<span data-ttu-id="1599d-123">Une fois qu’une taille de lot a été déterminée, quantité hello diffusion en continu d’unités (SUs) peuvent être déterminées, en fonction hello nombre d’événements que fonction hello doit tooprocess par seconde.</span><span class="sxs-lookup"><span data-stu-id="1599d-123">Once a batch size has been determined, hello amount of streaming units (SUs) can be determined, based on hello number of events that hello function needs tooprocess per second.</span></span> <span data-ttu-id="1599d-124">Pour plus d’informations sur les unités de diffusion en continu, voir [Mise à l’échelle des travaux Stream Analytics](stream-analytics-scale-jobs.md).</span><span class="sxs-lookup"><span data-stu-id="1599d-124">For more information about streaming units, see [Stream Analytics scale jobs](stream-analytics-scale-jobs.md).</span></span>

<span data-ttu-id="1599d-125">En règle générale, il existe 20 connexions simultanées toohello service de web Machine Learning pour chaque 6 SUs, sauf que les travaux de SU 1 et 3 SU obtenez 20 connexions simultanées également.</span><span class="sxs-lookup"><span data-stu-id="1599d-125">In general, there are 20 concurrent connections toohello Machine Learning web service for every 6 SUs, except that 1 SU jobs and 3 SU jobs will get 20 concurrent connections also.</span></span>  <span data-ttu-id="1599d-126">Par exemple, si le taux de données d’entrée hello est 200 000 événements par seconde et taille de lot hello est considérée par défaut de toohello 1000 hello résultant web service latence de traitement par lots de 1000 événements mini est 200 ms.</span><span class="sxs-lookup"><span data-stu-id="1599d-126">For example, if hello input data rate is 200,000 events per second and hello batch size is left toohello default of 1000 hello resulting web service latency with 1000 events mini-batch is 200ms.</span></span> <span data-ttu-id="1599d-127">Cela signifie que toutes les connexions peuvent envoyer des 5 demandes service web de Machine Learning toohello en une seconde.</span><span class="sxs-lookup"><span data-stu-id="1599d-127">This means every connection can make 5 requests toohello Machine Learning web service in a second.</span></span> <span data-ttu-id="1599d-128">Avec 20 connexions, la tâche de flux de données Analytique hello peut traiter 20 000 événements dans 200 ms et par conséquent de 100 000 événements en une seconde.</span><span class="sxs-lookup"><span data-stu-id="1599d-128">With 20 connections, hello Stream Analytics job can process 20,000 events in 200ms  and therefore 100,000 events in a second.</span></span> <span data-ttu-id="1599d-129">Par conséquent, tooprocess 200 000 événements par seconde tâche de flux de données Analytique hello doit 40 connexions simultanées, ce qui se présentent too12 SUs.</span><span class="sxs-lookup"><span data-stu-id="1599d-129">So tooprocess 200,000 events per second, hello Stream Analytics job needs 40 concurrent connections, which comes out too12 SUs.</span></span> <span data-ttu-id="1599d-130">diagramme de Hello ci-dessous illustre les demandes hello à partir de la terminaison de service web Machine Learning toohello de hello flux Analytique travail – toutes 6 SUs dispose de service web de 20 connexions simultanées tooMachine Learning au max.</span><span class="sxs-lookup"><span data-stu-id="1599d-130">hello diagram below illustrates hello requests from hello Stream Analytics job toohello Machine Learning web service endpoint – Every 6 SUs has 20 concurrent connections tooMachine Learning web service at max.</span></span>

<span data-ttu-id="1599d-131">![Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Exemple de 2 travaux](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Exemple de 2 travaux")</span><span class="sxs-lookup"><span data-stu-id="1599d-131">![Scale Stream Analytics with Machine Learning Functions 2 job example](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-00.png "Scale Stream Analytics with Machine Learning Functions 2 job example")</span></span>

<span data-ttu-id="1599d-132">En général, ***B*** pour la taille de lot, ***L*** hello web service avec une latence à la taille de lot B, en millisecondes, hello débit d’une tâche de flux de données Analytique avec ***N*** SUs est :</span><span class="sxs-lookup"><span data-stu-id="1599d-132">In general, ***B*** for batch size, ***L*** for hello web service latency at batch size B in milliseconds, hello throughput of an Stream Analytics job with ***N*** SUs is:</span></span>

<span data-ttu-id="1599d-133">![Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Formule](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Formule")</span><span class="sxs-lookup"><span data-stu-id="1599d-133">![Scale Stream Analytics with Machine Learning Functions Formula](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-02.png "Scale Stream Analytics with Machine Learning Functions Formula")</span></span>

<span data-ttu-id="1599d-134">Une considération supplémentaire peut être hello 'max d’appels simultanés » sur hello côté de service web Machine Learning, il est recommandé de tooset cette valeur maximale de toohello (200 actuellement).</span><span class="sxs-lookup"><span data-stu-id="1599d-134">An additional consideration may be hello 'max concurrent calls' on hello Machine Learning web service side, it’s recommended tooset this toohello maximum value (200 currently).</span></span>

<span data-ttu-id="1599d-135">Pour plus d’informations sur ce paramètre, consultez hello [article de mise à l’échelle pour les Services Web Machine Learning](../machine-learning/machine-learning-scaling-webservice.md).</span><span class="sxs-lookup"><span data-stu-id="1599d-135">For more information on this setting please review hello [Scaling article for Machine Learning Web Services](../machine-learning/machine-learning-scaling-webservice.md).</span></span>

## <a name="example--sentiment-analysis"></a><span data-ttu-id="1599d-136">Exemple – Analyse de sentiments</span><span class="sxs-lookup"><span data-stu-id="1599d-136">Example – Sentiment Analysis</span></span>
<span data-ttu-id="1599d-137">Hello exemple suivant inclut une tâche de flux Analytique avec analyse des sentiments hello fonction d’apprentissage automatique, comme décrit dans hello [didacticiel d’intégration de flux Analytique Machine Learning](stream-analytics-machine-learning-integration-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="1599d-137">hello following example includes a Stream Analytics job with hello sentiment analysis Machine Learning function, as described in hello [Stream Analytics Machine Learning integration tutorial](stream-analytics-machine-learning-integration-tutorial.md).</span></span>

<span data-ttu-id="1599d-138">Hello requête est une requête entièrement partitionnée simple suivie hello **sentiment** de fonction, comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="1599d-138">hello query is a simple fully partitioned query followed by hello **sentiment** function, as shown below:</span></span>

    WITH subquery AS (
        SELECT text, sentiment(text) as result from input
    )

    Select text, result.[Score]
    Into output
    From subquery

<span data-ttu-id="1599d-139">Envisagez de hello scénario ; avec un débit de 10 000 tweet par seconde, une tâche de flux de données Analytique doit être créée analyse des sentiments tooperform de tweets de hello (événements).</span><span class="sxs-lookup"><span data-stu-id="1599d-139">Consider hello following scenario; with a throughput of 10,000 tweets per second a Stream Analytics job must be created tooperform sentiment analysis of hello tweets (events).</span></span> <span data-ttu-id="1599d-140">1 SU, cette tâche de flux de données Analytique serait le trafic de hello en mesure de toohandle ?</span><span class="sxs-lookup"><span data-stu-id="1599d-140">Using 1 SU, could this Stream Analytics job be able toohandle hello traffic?</span></span> <span data-ttu-id="1599d-141">À l’aide de la taille de lot par défaut de hello de 1000 hello doit être en mesure de tookeep haut avec une entrée hello.</span><span class="sxs-lookup"><span data-stu-id="1599d-141">Using hello default batch size of 1000 hello job should be able tookeep up with hello input.</span></span> <span data-ttu-id="1599d-142">Hello supplémentaire ajouté la fonction d’apprentissage doit générer pas plus d’une seconde de latence, ce qui est la latence de générales par défaut hello d’analyse des sentiments hello service web Machine Learning (avec une taille de lot par défaut de 1000).</span><span class="sxs-lookup"><span data-stu-id="1599d-142">Further hello added Machine Learning function should generate no more than a second of latency, which is hello general default latency of hello sentiment analysis Machine Learning web service (with a default batch size of 1000).</span></span> <span data-ttu-id="1599d-143">la tâche de flux de données Analytique Hello **globale** ou de la latence de bout en bout est en général pas de quelques secondes.</span><span class="sxs-lookup"><span data-stu-id="1599d-143">hello Stream Analytics job’s **overall** or end-to-end latency would typically be a few seconds.</span></span> <span data-ttu-id="1599d-144">Tenir une présentation plus détaillée de cette tâche de flux de données Analytique, *particulièrement* hello des appels de fonction Machine Learning.</span><span class="sxs-lookup"><span data-stu-id="1599d-144">Take a more detailed look into this Stream Analytics job, *especially* hello Machine Learning function calls.</span></span> <span data-ttu-id="1599d-145">Taille de lot hello égal à 1000, un débit de 10 000 événements prendra environ 10 requêtes tooweb service.</span><span class="sxs-lookup"><span data-stu-id="1599d-145">Having hello batch size as 1000, a throughput of 10,000 events will take about 10 requests tooweb service.</span></span> <span data-ttu-id="1599d-146">Même avec 1 SU, il existe suffisamment tooaccommodate de connexions simultanées de saisie du trafic.</span><span class="sxs-lookup"><span data-stu-id="1599d-146">Even with 1 SU, there are enough concurrent connections tooaccommodate this input traffic.</span></span>

<span data-ttu-id="1599d-147">Mais que se passe-t-il si le taux d’événement d’entrée hello augmente de 100 x et tâche de flux de données Analytique hello doit maintenant tooprocess de 1 000 000 tweet par seconde ?</span><span class="sxs-lookup"><span data-stu-id="1599d-147">But what if hello input event rate increases by 100x and now hello Stream Analytics job needs tooprocess 1,000,000 tweets per second?</span></span> <span data-ttu-id="1599d-148">Nous avons deux options :</span><span class="sxs-lookup"><span data-stu-id="1599d-148">There are two options:</span></span>

1. <span data-ttu-id="1599d-149">Augmenter la taille de lot hello, ou</span><span class="sxs-lookup"><span data-stu-id="1599d-149">Increase hello batch size, or</span></span>
2. <span data-ttu-id="1599d-150">Événements hello tooprocess des flux d’entrée de hello de partition en parallèle</span><span class="sxs-lookup"><span data-stu-id="1599d-150">Partition hello input stream tooprocess hello events in parallel</span></span>

<span data-ttu-id="1599d-151">Avec l’option de première hello, hello travail **latence** augmente.</span><span class="sxs-lookup"><span data-stu-id="1599d-151">With hello first option, hello job **latency** will increase.</span></span>

<span data-ttu-id="1599d-152">Hello deuxième SUs plus seraient devez toobe mis en service et par conséquent générer des demandes de service web Machine Learning plus simultanées.</span><span class="sxs-lookup"><span data-stu-id="1599d-152">With hello second option, more SUs would need toobe provisioned and therefore generate more concurrent Machine Learning web service requests.</span></span> <span data-ttu-id="1599d-153">Cela signifie que le travail de hello **coût** augmente.</span><span class="sxs-lookup"><span data-stu-id="1599d-153">This means hello job **cost** will increase.</span></span>

<span data-ttu-id="1599d-154">Supposons latence hello d’analyse des sentiments hello service web Machine Learning est 200 ms pour les traitements d’événement 1000 ou en dessous, 250ms pour les lots de 5 000 événements, 300 millisecondes pour les lots de 10 000 événements ou 500 ms pour les lots de 25 000-event.</span><span class="sxs-lookup"><span data-stu-id="1599d-154">Assume hello latency of hello sentiment analysis Machine Learning web service is 200ms for 1000-event batches or below, 250ms for 5,000-event batches, 300ms for 10,000-event batches or 500ms for 25,000-event batches.</span></span>

1. <span data-ttu-id="1599d-155">À l’aide de la première option de hello, (**pas** configuration SUs plus), taille de lot hello peut être augmenté trop**25 000**.</span><span class="sxs-lookup"><span data-stu-id="1599d-155">Using hello first option, (**not** provisioning more SUs), hello batch size could be increased too**25,000**.</span></span> <span data-ttu-id="1599d-156">À son tour ainsi, hello travail tooprocess 1 000 000 événements avec 20 connexions simultanées toohello service web Machine Learning (avec une latence de 500 ms par appel).</span><span class="sxs-lookup"><span data-stu-id="1599d-156">This in turn would allow hello job tooprocess 1,000,000 events with 20 concurrent connections toohello Machine Learning web service (with a latency of 500ms per call).</span></span> <span data-ttu-id="1599d-157">Par conséquent, hello une latence supplémentaire de la tâche de flux de données Analytique hello en raison de requêtes à fonction toohello sentiment contre hello apprentissage passerait de demandes de service web **200 ms** trop**500 ms**.</span><span class="sxs-lookup"><span data-stu-id="1599d-157">So hello additional latency of hello Stream Analytics job due toohello sentiment function requests against hello Machine Learning web service requests would be increased from **200ms** too**500ms**.</span></span> <span data-ttu-id="1599d-158">Toutefois, notez que taille de lot **ne peut pas** être augmenté à l’infini en tant que services web Machine Learning hello nécessite taille de la charge hello d’une demande de 4 Mo ou plus petites web délai d’attente des demandes de service après 100 secondes de l’opération.</span><span class="sxs-lookup"><span data-stu-id="1599d-158">However, note that batch size **cannot** be increased infinitely as hello Machine Learning web services requires hello payload size of a request be 4MB or smaller web service requests timeout after 100 seconds of operation.</span></span>
2. <span data-ttu-id="1599d-159">À l’aide de la deuxième option de hello, taille de lot hello est laissée à 1 000, avec une latence de service web de 200 ms, chaque service web de toohello 20 connexions simultanées est en mesure de tooprocess 1 000 * 20 * 5 événements = 100 000 par seconde.</span><span class="sxs-lookup"><span data-stu-id="1599d-159">Using hello second option, hello batch size is left at 1000, with 200ms web service latency, every 20 concurrent connections toohello web service would be able tooprocess 1000 * 20 * 5 events = 100,000 per second.</span></span> <span data-ttu-id="1599d-160">Tooprocess de 1 000 000 événements par seconde, projet de hello serait donc 60 SUs.</span><span class="sxs-lookup"><span data-stu-id="1599d-160">So tooprocess 1,000,000 events per second, hello job would need 60 SUs.</span></span> <span data-ttu-id="1599d-161">Première option toohello comparés, Analytique de flux de travail serait alors plus web ensuite traiter les demandes de traitement par lots, génération d’une augmentation des coûts.</span><span class="sxs-lookup"><span data-stu-id="1599d-161">Compared toohello first option, Stream Analytics job would make more web service batch requests, in turn generating an increased cost.</span></span>

<span data-ttu-id="1599d-162">Voici une table pour le débit de la tâche de flux de données Analytique hello hello pour SUs différentes et des tailles de lot (en nombre d’événements par seconde).</span><span class="sxs-lookup"><span data-stu-id="1599d-162">Below is a table for hello throughput of hello Stream Analytics job for different SUs and batch sizes (in number of events per second).</span></span>

| <span data-ttu-id="1599d-163">Taille de lot (latence Machine Learning)</span><span class="sxs-lookup"><span data-stu-id="1599d-163">batch size (ML latency)</span></span> | <span data-ttu-id="1599d-164">500 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="1599d-164">500 (200ms)</span></span> | <span data-ttu-id="1599d-165">1 000 (200 ms)</span><span class="sxs-lookup"><span data-stu-id="1599d-165">1,000 (200ms)</span></span> | <span data-ttu-id="1599d-166">5 000 (250 ms)</span><span class="sxs-lookup"><span data-stu-id="1599d-166">5,000 (250ms)</span></span> | <span data-ttu-id="1599d-167">10 000 (300 ms)</span><span class="sxs-lookup"><span data-stu-id="1599d-167">10,000 (300ms)</span></span> | <span data-ttu-id="1599d-168">25 000 (500 ms)</span><span class="sxs-lookup"><span data-stu-id="1599d-168">25,000 (500ms)</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1599d-169">**1 unité de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-169">**1 SU**</span></span> |<span data-ttu-id="1599d-170">2 500</span><span class="sxs-lookup"><span data-stu-id="1599d-170">2,500</span></span> |<span data-ttu-id="1599d-171">5 000</span><span class="sxs-lookup"><span data-stu-id="1599d-171">5,000</span></span> |<span data-ttu-id="1599d-172">20 000</span><span class="sxs-lookup"><span data-stu-id="1599d-172">20,000</span></span> |<span data-ttu-id="1599d-173">30 000</span><span class="sxs-lookup"><span data-stu-id="1599d-173">30,000</span></span> |<span data-ttu-id="1599d-174">50 000</span><span class="sxs-lookup"><span data-stu-id="1599d-174">50,000</span></span> |
| <span data-ttu-id="1599d-175">**3 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-175">**3 SUs**</span></span> |<span data-ttu-id="1599d-176">2 500</span><span class="sxs-lookup"><span data-stu-id="1599d-176">2,500</span></span> |<span data-ttu-id="1599d-177">5 000</span><span class="sxs-lookup"><span data-stu-id="1599d-177">5,000</span></span> |<span data-ttu-id="1599d-178">20 000</span><span class="sxs-lookup"><span data-stu-id="1599d-178">20,000</span></span> |<span data-ttu-id="1599d-179">30 000</span><span class="sxs-lookup"><span data-stu-id="1599d-179">30,000</span></span> |<span data-ttu-id="1599d-180">50 000</span><span class="sxs-lookup"><span data-stu-id="1599d-180">50,000</span></span> |
| <span data-ttu-id="1599d-181">**6 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-181">**6 SUs**</span></span> |<span data-ttu-id="1599d-182">2 500</span><span class="sxs-lookup"><span data-stu-id="1599d-182">2,500</span></span> |<span data-ttu-id="1599d-183">5 000</span><span class="sxs-lookup"><span data-stu-id="1599d-183">5,000</span></span> |<span data-ttu-id="1599d-184">20 000</span><span class="sxs-lookup"><span data-stu-id="1599d-184">20,000</span></span> |<span data-ttu-id="1599d-185">30 000</span><span class="sxs-lookup"><span data-stu-id="1599d-185">30,000</span></span> |<span data-ttu-id="1599d-186">50 000</span><span class="sxs-lookup"><span data-stu-id="1599d-186">50,000</span></span> |
| <span data-ttu-id="1599d-187">**12 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-187">**12 SUs**</span></span> |<span data-ttu-id="1599d-188">5 000</span><span class="sxs-lookup"><span data-stu-id="1599d-188">5,000</span></span> |<span data-ttu-id="1599d-189">10 000</span><span class="sxs-lookup"><span data-stu-id="1599d-189">10,000</span></span> |<span data-ttu-id="1599d-190">40 000</span><span class="sxs-lookup"><span data-stu-id="1599d-190">40,000</span></span> |<span data-ttu-id="1599d-191">60 000</span><span class="sxs-lookup"><span data-stu-id="1599d-191">60,000</span></span> |<span data-ttu-id="1599d-192">100 000</span><span class="sxs-lookup"><span data-stu-id="1599d-192">100,000</span></span> |
| <span data-ttu-id="1599d-193">**18 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-193">**18 SUs**</span></span> |<span data-ttu-id="1599d-194">7 500</span><span class="sxs-lookup"><span data-stu-id="1599d-194">7,500</span></span> |<span data-ttu-id="1599d-195">15 000</span><span class="sxs-lookup"><span data-stu-id="1599d-195">15,000</span></span> |<span data-ttu-id="1599d-196">60 000</span><span class="sxs-lookup"><span data-stu-id="1599d-196">60,000</span></span> |<span data-ttu-id="1599d-197">90 000</span><span class="sxs-lookup"><span data-stu-id="1599d-197">90,000</span></span> |<span data-ttu-id="1599d-198">150 000</span><span class="sxs-lookup"><span data-stu-id="1599d-198">150,000</span></span> |
| <span data-ttu-id="1599d-199">**24 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-199">**24 SUs**</span></span> |<span data-ttu-id="1599d-200">10 000</span><span class="sxs-lookup"><span data-stu-id="1599d-200">10,000</span></span> |<span data-ttu-id="1599d-201">20 000</span><span class="sxs-lookup"><span data-stu-id="1599d-201">20,000</span></span> |<span data-ttu-id="1599d-202">80 000</span><span class="sxs-lookup"><span data-stu-id="1599d-202">80,000</span></span> |<span data-ttu-id="1599d-203">120 000</span><span class="sxs-lookup"><span data-stu-id="1599d-203">120,000</span></span> |<span data-ttu-id="1599d-204">200 000</span><span class="sxs-lookup"><span data-stu-id="1599d-204">200,000</span></span> |
| <span data-ttu-id="1599d-205">**…**</span><span class="sxs-lookup"><span data-stu-id="1599d-205">**…**</span></span> |<span data-ttu-id="1599d-206">…</span><span class="sxs-lookup"><span data-stu-id="1599d-206">…</span></span> |<span data-ttu-id="1599d-207">…</span><span class="sxs-lookup"><span data-stu-id="1599d-207">…</span></span> |<span data-ttu-id="1599d-208">…</span><span class="sxs-lookup"><span data-stu-id="1599d-208">…</span></span> |<span data-ttu-id="1599d-209">…</span><span class="sxs-lookup"><span data-stu-id="1599d-209">…</span></span> |<span data-ttu-id="1599d-210">…</span><span class="sxs-lookup"><span data-stu-id="1599d-210">…</span></span> |
| <span data-ttu-id="1599d-211">**60 unités de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="1599d-211">**60 SUs**</span></span> |<span data-ttu-id="1599d-212">25 000</span><span class="sxs-lookup"><span data-stu-id="1599d-212">25,000</span></span> |<span data-ttu-id="1599d-213">50 000</span><span class="sxs-lookup"><span data-stu-id="1599d-213">50,000</span></span> |<span data-ttu-id="1599d-214">200 000</span><span class="sxs-lookup"><span data-stu-id="1599d-214">200,000</span></span> |<span data-ttu-id="1599d-215">300 000</span><span class="sxs-lookup"><span data-stu-id="1599d-215">300,000</span></span> |<span data-ttu-id="1599d-216">500 000</span><span class="sxs-lookup"><span data-stu-id="1599d-216">500,000</span></span> |

<span data-ttu-id="1599d-217">À ce stade, vous devriez déjà avoir une bonne compréhension du mode de fonctionnement des fonctions Machine Learning dans Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="1599d-217">By now, you should already have a good understanding of how Machine Learning functions in Stream Analytics work.</span></span> <span data-ttu-id="1599d-218">Vous probablement également comprendre que les travaux de flux de données Analytique « collecte » des données à partir de sources de données et chaque « pull » renvoie un lot d’événements pour hello tooprocess de tâche de flux de données Analytique.</span><span class="sxs-lookup"><span data-stu-id="1599d-218">You likely also understand that Stream Analytics jobs “pull” data from data sources and each “pull” returns a batch of events for hello Stream Analytics job tooprocess.</span></span> <span data-ttu-id="1599d-219">Comment ce modèle d’extraction répercuter les demandes de service web Machine Learning hello ?</span><span class="sxs-lookup"><span data-stu-id="1599d-219">How does this pull model impact hello Machine Learning web service requests?</span></span>

<span data-ttu-id="1599d-220">En règle générale, nous avons défini pour les fonctions de l’apprentissage de la taille du lot hello sera exactement divisible par le nombre de hello d’événements retournés par chaque tâche de flux de données Analytique « pull ».</span><span class="sxs-lookup"><span data-stu-id="1599d-220">Normally, hello batch size we set for Machine Learning functions won’t exactly be divisible by hello number of events returned by each Stream Analytics job “pull”.</span></span> <span data-ttu-id="1599d-221">Lorsque cela se produit hello service web Machine Learning est appelée avec des lots « partielles ».</span><span class="sxs-lookup"><span data-stu-id="1599d-221">When this occurs hello Machine Learning web service will be called with “partial” batches.</span></span> <span data-ttu-id="1599d-222">Cette opération est effectuée toonot entraînent la latence du travail supplémentaire surcharge dans les événements de fusion à partir de toopull d’extraction.</span><span class="sxs-lookup"><span data-stu-id="1599d-222">This is done toonot incur additional job latency overhead in coalescing events from pull toopull.</span></span>

## <a name="new-function-related-monitoring-metrics"></a><span data-ttu-id="1599d-223">Nouvelles métriques de surveillance associées aux fonctions</span><span class="sxs-lookup"><span data-stu-id="1599d-223">New function-related monitoring metrics</span></span>
<span data-ttu-id="1599d-224">Dans la zone d’analyse d’une tâche de flux de données Analytique de hello, trois mesures liées à la fonction supplémentaires ont été ajoutés.</span><span class="sxs-lookup"><span data-stu-id="1599d-224">In hello Monitor area of a Stream Analytics job, three additional function-related metrics have been added.</span></span> <span data-ttu-id="1599d-225">Ils sont des demandes de fonctions, les événements de fonctions et les demandes de fonction a échoué, comme indiqué dans le graphique de hello ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1599d-225">They are FUNCTION REQUESTS, FUNCTION EVENTS and FAILED FUNCTION REQUESTS, as shown in hello graphic below.</span></span>

<span data-ttu-id="1599d-226">![Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Métriques](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Mettre à l’échelle Stream Analytics avec des fonctions Machine Learning - Métriques")</span><span class="sxs-lookup"><span data-stu-id="1599d-226">![Scale Stream Analytics with Machine Learning Functions Metrics](./media/stream-analytics-scale-with-ml-functions/stream-analytics-scale-with-ml-functions-01.png "Scale Stream Analytics with Machine Learning Functions Metrics")</span></span>

<span data-ttu-id="1599d-227">Hello sont définies comme suit :</span><span class="sxs-lookup"><span data-stu-id="1599d-227">hello are defined as follows:</span></span>

<span data-ttu-id="1599d-228">**DEMANDES de fonction**: hello du nombre de demandes de fonction.</span><span class="sxs-lookup"><span data-stu-id="1599d-228">**FUNCTION REQUESTS**: hello number of function requests.</span></span>

<span data-ttu-id="1599d-229">**ÉVÉNEMENTS de fonctions**: nombre d’événements hello Bonjour fonction des demandes.</span><span class="sxs-lookup"><span data-stu-id="1599d-229">**FUNCTION EVENTS**: hello number events in hello function requests.</span></span>

<span data-ttu-id="1599d-230">**ÉCHECS de demandes de fonction**: hello du nombre de demandes de fonction qui a échoué.</span><span class="sxs-lookup"><span data-stu-id="1599d-230">**FAILED FUNCTION REQUESTS**: hello number of failed function requests.</span></span>

## <a name="key-takeaways"></a><span data-ttu-id="1599d-231">Points clés</span><span class="sxs-lookup"><span data-stu-id="1599d-231">Key Takeaways</span></span>
<span data-ttu-id="1599d-232">toosummarize hello principaux points, dans l’ordre tooscale une tâche de flux Analytique avec des fonctions d’apprentissage, hello éléments suivants en considération :</span><span class="sxs-lookup"><span data-stu-id="1599d-232">toosummarize hello main points, in order tooscale an Stream Analytics job with Machine Learning functions, hello following items must be considered:</span></span>

1. <span data-ttu-id="1599d-233">taux d’événements d’entrée Hello</span><span class="sxs-lookup"><span data-stu-id="1599d-233">hello input event rate</span></span>
2. <span data-ttu-id="1599d-234">Hello au terme de latence pour hello exécute la tâche de flux de données Analytique (et donc de demande de taille de lot hello du service web de Machine Learning hello)</span><span class="sxs-lookup"><span data-stu-id="1599d-234">hello tolerated latency for hello running Stream Analytics job (and thus hello batch size of hello Machine Learning web service requests)</span></span>
3. <span data-ttu-id="1599d-235">Hello configuré SUs Analytique de flux de données et nombre de hello de demandes de service web Machine Learning (hello liés en fonction des frais supplémentaires)</span><span class="sxs-lookup"><span data-stu-id="1599d-235">hello provisioned Stream Analytics SUs and hello number of Machine Learning web service requests (hello additional function-related costs)</span></span>

<span data-ttu-id="1599d-236">Notre exemple portait sur une requête Stream Analytics entièrement partitionnée.</span><span class="sxs-lookup"><span data-stu-id="1599d-236">A fully partitioned Stream Analytics query was used as an example.</span></span> <span data-ttu-id="1599d-237">Si vous avez besoin d’une requête plus complexe hello [forum d’Analytique de flux de données Azure](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) est un bon point de départ pour obtenir une aide supplémentaire à partir de l’équipe de flux de données Analytique hello.</span><span class="sxs-lookup"><span data-stu-id="1599d-237">If a more complex query is needed hello [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics) is a great resource for getting additional help from hello Stream Analytics team.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1599d-238">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1599d-238">Next steps</span></span>
<span data-ttu-id="1599d-239">toolearn en savoir plus sur les flux de données Analytique, consultez :</span><span class="sxs-lookup"><span data-stu-id="1599d-239">toolearn more about Stream Analytics, see:</span></span>

* [<span data-ttu-id="1599d-240">Prise en main d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="1599d-240">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="1599d-241">Mise à l'échelle des travaux Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="1599d-241">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="1599d-242">Références sur le langage des requêtes d'Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="1599d-242">Azure Stream Analytics Query Language Reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="1599d-243">Références sur l’API REST de gestion d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="1599d-243">Azure Stream Analytics Management REST API Reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
