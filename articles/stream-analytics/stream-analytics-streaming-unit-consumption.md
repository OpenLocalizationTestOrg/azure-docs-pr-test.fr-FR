---
title: "Analytique de flux de données Azure : Optimiser vos unités de diffusion en continu de toouse travail efficacement | Documents Microsoft"
description: "Meilleures pratiques en matière de requêtes pour la mise à l’échelle et les performances dans Azure Stream Analytics."
keywords: "unité de streaming, performance des requêtes"
services: stream-analytics
documentationcenter: 
author: jeffstokes72
manager: jhubbard
editor: cgronlun
ms.assetid: 
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 04/20/2017
ms.author: jeffstok
ms.openlocfilehash: 5ad98b34d625190a879260f54c9eff0294e230cb
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-your-job-toouse-streaming-units-efficiently"></a><span data-ttu-id="37624-104">Optimiser vos unités de diffusion en continu de toouse travail efficacement</span><span class="sxs-lookup"><span data-stu-id="37624-104">Optimize your job toouse Streaming Units efficiently</span></span>

<span data-ttu-id="37624-105">Analytique de flux de données Azure regroupe les performances de hello « weight » de l’exécution d’un travail en unités de diffusion en continu (SUs).</span><span class="sxs-lookup"><span data-stu-id="37624-105">Azure Stream Analytics aggregates hello performance "weight" of running a job into Streaming Units (SUs).</span></span> <span data-ttu-id="37624-106">SUs représentent les ressources informatiques hello qui sont consommé tooexecute un travail.</span><span class="sxs-lookup"><span data-stu-id="37624-106">SUs represent hello computing resources that are consumed tooexecute a job.</span></span> <span data-ttu-id="37624-107">SUs fournissent un événement relatif hello toodescribe moyen en fonction de la mesure du processeur, mémoire, la capacité de traitement et lire et écrire des taux.</span><span class="sxs-lookup"><span data-stu-id="37624-107">SUs provide a way toodescribe hello relative event processing capacity based on a blended measure of CPU, memory, and read and write rates.</span></span> <span data-ttu-id="37624-108">Cette capacité vous pouvez vous concentrer sur la logique de requête de hello et supprime vous d’avoir tooknow stockage niveau considérations sur les performances, allocation de mémoire pour votre travail manuellement et approximative hello UC core-nombre nécessaire toorun votre travail en temps voulu.</span><span class="sxs-lookup"><span data-stu-id="37624-108">This capacity lets you focus on hello query logic and removes you from needing tooknow storage tier performance considerations, allocate memory for your job manually, and approximate hello CPU core-count needed toorun your job in a timely manner.</span></span>

## <a name="how-many-sus-are-required-for-a-job"></a><span data-ttu-id="37624-109">Combien d’unités de streaming sont requises pour un travail ?</span><span class="sxs-lookup"><span data-stu-id="37624-109">How many SUs are required for a job?</span></span>

<span data-ttu-id="37624-110">Nombre hello de SUs requis pour un travail particulier le choix dépend de la configuration de partitions hello pour les entrées de hello et une requête de hello est défini dans le travail de hello.</span><span class="sxs-lookup"><span data-stu-id="37624-110">Choosing hello number of required SUs for a particular job depends on hello partition configuration for hello inputs and hello query that's defined within hello job.</span></span> <span data-ttu-id="37624-111">Hello **échelle** panneau vous permet de tooset hello droite nombre de SUs.</span><span class="sxs-lookup"><span data-stu-id="37624-111">hello **Scale** blade allows you tooset hello right number of SUs.</span></span> <span data-ttu-id="37624-112">Il s’agit d’une meilleure pratique tooallocate SUs plus que nécessaire.</span><span class="sxs-lookup"><span data-stu-id="37624-112">It is a best practice tooallocate more SUs than needed.</span></span> <span data-ttu-id="37624-113">moteur de traitement de flux de données Analytique Hello optimise les demandes de latence et débit au coût hello d’allocation de mémoire supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="37624-113">hello Stream Analytics processing engine optimizes for latency and throughput at hello cost of allocating additional memory.</span></span>

<span data-ttu-id="37624-114">En règle générale, hello est préférable toostart avec 6 SUs pour les requêtes qui n’utilisent pas *PARTITION BY*.</span><span class="sxs-lookup"><span data-stu-id="37624-114">In general, hello best practice is toostart with 6 SUs for queries that don't use *PARTITION BY*.</span></span> <span data-ttu-id="37624-115">Puis déterminer hello idéale en utilisant une méthode d’évaluation et d’erreurs dans lequel vous modifiez le nombre de hello de SUs une fois que vous transmettez des quantités représentatives de données et examinez les métriques d’utilisation hello SU %.</span><span class="sxs-lookup"><span data-stu-id="37624-115">Then determine hello sweet spot by using a trial and error method in which you modify hello number of SUs after you pass representative amounts of data and examine hello SU %Utilization metric.</span></span>

<span data-ttu-id="37624-116">Analytique de flux de données Azure conserve les événements dans une fenêtre appelée hello « réorganiser les mémoires tampons » avant de commencer tout traitement.</span><span class="sxs-lookup"><span data-stu-id="37624-116">Azure Stream Analytics keeps events in a window called hello “reorder buffer” before it starts any processing.</span></span> <span data-ttu-id="37624-117">Les événements sont triés dans la fenêtre de commande hello par heure et les opérations suivantes sont effectuées sur les événements de hello rapprochée triée.</span><span class="sxs-lookup"><span data-stu-id="37624-117">Events are sorted within hello reorder window by time, and subsequent operations are performed on hello temporally sorted events.</span></span> <span data-ttu-id="37624-118">Réorganisation des événements par heure garantit cet opérateur hello a une visibilité dans tous les événements hello Bonjour stipulés laps de temps.</span><span class="sxs-lookup"><span data-stu-id="37624-118">Reordering events by time ensures that hello operator has visibility into all hello events in hello stipulated timeframe.</span></span> <span data-ttu-id="37624-119">Il permet également d’opérateur de hello effectuer le traitement requis de hello et produire une sortie.</span><span class="sxs-lookup"><span data-stu-id="37624-119">It also lets hello operator perform hello requisite processing and produce an output.</span></span> <span data-ttu-id="37624-120">Un effet secondaire de ce mécanisme est que le traitement est retardé par durée hello de fenêtre de commande hello.</span><span class="sxs-lookup"><span data-stu-id="37624-120">A side effect of this mechanism is that processing is delayed by hello duration of hello reorder window.</span></span> <span data-ttu-id="37624-121">encombrement de mémoire Hello du travail hello (qui affecte la consommation SU) est une fonction de la taille de hello de ce nombre réorganiser les fenêtres et hello d’événements qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="37624-121">hello memory footprint of hello job (which affects SU consumption) is a function of hello size of this reorder window and hello number of events contained within it.</span></span>

> [!NOTE]
> <span data-ttu-id="37624-122">Quand un nombre de lecteurs hello change pendant les mises à niveau de la tâche, avertissements temporaires sont écrits tooaudit journaux.</span><span class="sxs-lookup"><span data-stu-id="37624-122">When hello number of readers changes during job upgrades, transient warnings are written tooaudit logs.</span></span> <span data-ttu-id="37624-123">Les travaux Stream Analytics récupèrent automatiquement de ces problèmes temporaires.</span><span class="sxs-lookup"><span data-stu-id="37624-123">Stream Analytics jobs automatically recover from these transient issues.</span></span>

## <a name="common-high-memory-causes-for-high-su-usage-for-running-jobs"></a><span data-ttu-id="37624-124">Causes courantes d’une mémoire élevée pour une utilisation élevée des unités de streaming lors de l’exécution de travaux</span><span class="sxs-lookup"><span data-stu-id="37624-124">Common high-memory causes for high SU usage for running jobs</span></span>

### <a name="high-cardinality-for-group-by"></a><span data-ttu-id="37624-125">Cardinalité élevée pour GROUP BY</span><span class="sxs-lookup"><span data-stu-id="37624-125">High cardinality for GROUP BY</span></span>

<span data-ttu-id="37624-126">utilisation de la mémoire de travail de hello détermine la cardinalité Hello d’événements entrants.</span><span class="sxs-lookup"><span data-stu-id="37624-126">hello cardinality of incoming events dictates memory usage for hello job.</span></span>

<span data-ttu-id="37624-127">Par exemple, dans `SELECT count(*) from input group by clustered, tumblingwindow (minutes, 5)`, hello numéro associé **cluster** est cardinalité hello de requête de hello.</span><span class="sxs-lookup"><span data-stu-id="37624-127">For example, in `SELECT count(*) from input group by clustered, tumblingwindow (minutes, 5)`, hello number associated with **clustered** is hello cardinality of hello query.</span></span>

<span data-ttu-id="37624-128">toomitigate problèmes provoqués par une cardinalité élevée, monter en charge les requêtes hello en augmentant les partitions à l’aide de **PARTITION BY**.</span><span class="sxs-lookup"><span data-stu-id="37624-128">toomitigate issues that are caused by high cardinality, scale out hello query by increasing partitions using **PARTITION BY**.</span></span>

```
Select count(*) from input
Partition By clusterid
GROUP BY clustered tumblingwindow (minutes, 5)
```

<span data-ttu-id="37624-129">Hello nombre de *cluster* est cardinalité hello de GROUP BY ici.</span><span class="sxs-lookup"><span data-stu-id="37624-129">hello number of *clustered* is hello cardinality of GROUP BY here.</span></span>

<span data-ttu-id="37624-130">Une fois la requête de hello est partitionnée, il est réparti sur plusieurs nœuds.</span><span class="sxs-lookup"><span data-stu-id="37624-130">After hello query is partitioned, it is spread out over multiple nodes.</span></span> <span data-ttu-id="37624-131">Par conséquent, nombre de hello d’événements arrivant dans chaque nœud est réduit, ce qui réduit à son tour taille hello de mémoire tampon de commande hello.</span><span class="sxs-lookup"><span data-stu-id="37624-131">As a result, hello number of events coming into each node is reduced, which in turn reduces hello size of hello reorder buffer.</span></span> <span data-ttu-id="37624-132">Vous devez également partitionner les Event Hubs par partitionid.</span><span class="sxs-lookup"><span data-stu-id="37624-132">You should also partition event hub partitions by partitionid.</span></span>

### <a name="high-unmatched-event-count-for-join"></a><span data-ttu-id="37624-133">Nombre élevée d’événements sans correspondance pour JOIN</span><span class="sxs-lookup"><span data-stu-id="37624-133">High unmatched event count for JOIN</span></span>

<span data-ttu-id="37624-134">nombre Hello d’événements sans correspondance dans une jointure affecte l’utilisation de la mémoire de requête de hello hello.</span><span class="sxs-lookup"><span data-stu-id="37624-134">hello number of unmatched events in a JOIN affects hello memory utilization of hello query.</span></span> <span data-ttu-id="37624-135">Par exemple, effectuer une requête qui recherche nombre hello toofind d’impressions de publicités qui génère des clics :</span><span class="sxs-lookup"><span data-stu-id="37624-135">For example, take a query that is looking toofind hello number of ad impressions that generates clicks:</span></span>

```
SELECT id from clicks INNER JOIN,
impressions on impressions.id = clicks.id AND DATEDIFF(hour, impressions, clicks) between 0 AND 10
```

<span data-ttu-id="37624-136">Dans ce scénario, il se peut qu’il y ait de nombreuses annonces affichées et que peu de clics soient générés.</span><span class="sxs-lookup"><span data-stu-id="37624-136">In this scenario, it is possible that many ads are shown and few clicks are generated.</span></span> <span data-ttu-id="37624-137">Un de cet résultats nécessiterait hello travail tookeep tous les événements hello dans la fenêtre de temps hello.</span><span class="sxs-lookup"><span data-stu-id="37624-137">Such a result would require hello job tookeep all hello events within hello time window.</span></span> <span data-ttu-id="37624-138">quantité Hello de mémoire consommée est le taux de taille et les événements de fenêtre toohello proportionnel.</span><span class="sxs-lookup"><span data-stu-id="37624-138">hello amount of memory consumed is proportional toohello window size and event rate.</span></span> 

<span data-ttu-id="37624-139">toomitigate cette situation, la montée en puissance parallèle requête hello en augmentant les partitions à l’aide de PARTITION BY.</span><span class="sxs-lookup"><span data-stu-id="37624-139">toomitigate this situation, scale out hello query by increasing partitions by using PARTITION BY.</span></span> 

<span data-ttu-id="37624-140">Une fois la requête de hello est partitionnée, il est réparti sur plusieurs nœuds de traitement.</span><span class="sxs-lookup"><span data-stu-id="37624-140">After hello query is partitioned, it is spread out over multiple processing nodes.</span></span> <span data-ttu-id="37624-141">Par conséquent, nombre de hello d’événements arrivant dans chaque nœud est réduit, ce qui réduit à son tour taille hello de mémoire tampon de commande hello.</span><span class="sxs-lookup"><span data-stu-id="37624-141">As a result, hello number of events coming into each node is reduced, which in turn reduces hello size of hello reorder buffer.</span></span>

### <a name="large-number-of-out-of-order-events"></a><span data-ttu-id="37624-142">Nombre élevé d’événements en désordre</span><span class="sxs-lookup"><span data-stu-id="37624-142">Large number of out of order events</span></span> 

<span data-ttu-id="37624-143">Un grand nombre d’événements en désordre dans une fenêtre de temps de grande taille, taille de hello de hello « réorganiser les mémoires tampons » toobe supérieure.</span><span class="sxs-lookup"><span data-stu-id="37624-143">A large number of out of order events within a large time window causes hello size of hello "reorder buffer" toobe larger.</span></span> <span data-ttu-id="37624-144">toomitigate ce cas, la requête de hello échelle en augmentant les partitions à l’aide de PARTITION BY.</span><span class="sxs-lookup"><span data-stu-id="37624-144">toomitigate this situation, scale hello query by increasing partitions by using PARTITION BY.</span></span> <span data-ttu-id="37624-145">Une fois la requête de hello est partitionnée, il est réparti sur plusieurs nœuds.</span><span class="sxs-lookup"><span data-stu-id="37624-145">After hello query is partitioned, it is spread out over multiple nodes.</span></span> <span data-ttu-id="37624-146">Par conséquent, nombre de hello d’événements arrivant dans chaque nœud est réduit, ce qui réduit à son tour taille hello de mémoire tampon de commande hello.</span><span class="sxs-lookup"><span data-stu-id="37624-146">As a result, hello number of events coming into each node is reduced, which in turn reduces hello size of hello reorder buffer.</span></span> 


## <a name="get-help"></a><span data-ttu-id="37624-147">Obtenir de l’aide</span><span class="sxs-lookup"><span data-stu-id="37624-147">Get help</span></span>
<span data-ttu-id="37624-148">Pour obtenir une assistance, consultez le [forum Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics)</span><span class="sxs-lookup"><span data-stu-id="37624-148">For further assistance, try our [Azure Stream Analytics forum](https://social.msdn.microsoft.com/Forums/en-US/home?forum=AzureStreamAnalytics).</span></span>

## <a name="next-steps"></a><span data-ttu-id="37624-149">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="37624-149">Next steps</span></span>
* [<span data-ttu-id="37624-150">Introduction tooAzure Analytique de flux de données</span><span class="sxs-lookup"><span data-stu-id="37624-150">Introduction tooAzure Stream Analytics</span></span>](stream-analytics-introduction.md)
* [<span data-ttu-id="37624-151">Prise en main d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="37624-151">Get started using Azure Stream Analytics</span></span>](stream-analytics-real-time-fraud-detection.md)
* [<span data-ttu-id="37624-152">Mise à l'échelle des travaux Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="37624-152">Scale Azure Stream Analytics jobs</span></span>](stream-analytics-scale-jobs.md)
* [<span data-ttu-id="37624-153">Références sur le langage des requêtes Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="37624-153">Azure Stream Analytics query language reference</span></span>](https://msdn.microsoft.com/library/azure/dn834998.aspx)
* [<span data-ttu-id="37624-154">Références sur l’API REST de gestion d’Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="37624-154">Azure Stream Analytics Management REST API reference</span></span>](https://msdn.microsoft.com/library/azure/dn835031.aspx)
