---
title: "sortie d’aaaJSON pour les flux de données Analytique | Documents Microsoft"
description: "Découvrez comment Stream Analytics peut cibler Azure Cosmos DB pour la sortie JSON à des fins d’archivage des données et d’exécution de requêtes à faible latence sur des données JSON non structurées."
keywords: Sortie JSON
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="8ee10-104">Cibler Azure Cosmos DB pour la sortie JSON à partir de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="8ee10-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="8ee10-105">Stream Analytics peut cibler [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) pour la sortie JSON, ce qui permet d’archiver des données et d’exécuter des requêtes à faible latence sur des données JSON non structurées.</span><span class="sxs-lookup"><span data-stu-id="8ee10-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="8ee10-106">Ce document traite certaines meilleures pratiques recommandées pour l’implémentation de cette configuration.</span><span class="sxs-lookup"><span data-stu-id="8ee10-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="8ee10-107">Pour ceux qui ne sont pas familiarisés avec la base de données Cosmos, examinons [cursus Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget a démarré.</span><span class="sxs-lookup"><span data-stu-id="8ee10-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="8ee10-108">Remarque : L’API Mongo DB basée sur les collections Cosmos DB n’est pas prise en charge actuellement.</span><span class="sxs-lookup"><span data-stu-id="8ee10-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="8ee10-109">Principes de base de Cosmos DB en tant que cible de sortie</span><span class="sxs-lookup"><span data-stu-id="8ee10-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="8ee10-110">Hello sortie de base de données Azure Cosmos dans le flux de données Analytique qui permet d’écrire votre flux de traitement des résultats en tant que sortie JSON dans vos collections de base de données Cosmos.</span><span class="sxs-lookup"><span data-stu-id="8ee10-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="8ee10-111">Flux de données Analytique ne crée pas de collections dans votre base de données, au lieu de cela, vous êtes obligé toocreate les dès le départ.</span><span class="sxs-lookup"><span data-stu-id="8ee10-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="8ee10-112">Il s’agit des coûts de facturation hello des collections de base de données Cosmos sont tooyou transparent, et afin que vous pouvez régler les performances de hello, la cohérence et la capacité de vos collections directement à l’aide de hello [Cosmos DB API](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="8ee10-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="8ee10-113">Nous recommandons d’utiliser une base de données de base de données Cosmos par travail toologically distinct de diffusion en continu vos collections pour un travail de diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="8ee10-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="8ee10-114">Certaines des options de collection Cosmos DB hello sont détaillées ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="8ee10-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="8ee10-115">Régler la cohérence, la disponibilité et la latence</span><span class="sxs-lookup"><span data-stu-id="8ee10-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="8ee10-116">toomatch les exigences de votre application, base de données Cosmos vous permet de base de données toofine régler hello et de regroupements et de rendre des compromis entre la latence, la disponibilité et la cohérence.</span><span class="sxs-lookup"><span data-stu-id="8ee10-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="8ee10-117">Selon les niveaux de cohérence de lecture qui s’appliquent à votre scénario compte tenu de la latence de lecture et d’écriture, vous pouvez choisir un niveau de cohérence sur votre compte de base de données.</span><span class="sxs-lookup"><span data-stu-id="8ee10-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="8ee10-118">Par défaut, Cosmos DB permet également l’indexation synchrone sur chaque collection de tooyour opération CRUD.</span><span class="sxs-lookup"><span data-stu-id="8ee10-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="8ee10-119">Il s’agit d’un autre hello de toocontrol l’option performances dans la base de données Cosmos de lecture/écriture.</span><span class="sxs-lookup"><span data-stu-id="8ee10-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="8ee10-120">Pour plus d’informations sur cette rubrique, consultez hello [modifier votre niveau de cohérence de base de données et de requête](../documentdb/documentdb-consistency-levels.md) l’article.</span><span class="sxs-lookup"><span data-stu-id="8ee10-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="8ee10-121">Upserts à partir de Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="8ee10-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="8ee10-122">Intégration Analytique de flux de données avec la base de données Cosmos vous permet de tooinsert ou mise à jour des enregistrements dans votre collection de base de données Cosmos basée sur une colonne d’ID de Document donnée.</span><span class="sxs-lookup"><span data-stu-id="8ee10-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="8ee10-123">Il s’agit également tooas auxquels un *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="8ee10-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="8ee10-124">Flux de données Analytique utilise une approche Upsert optimiste, où les mises à jour sont effectuées uniquement lors de l’insertion échoue en raison de conflits d’ID de Document tooa.</span><span class="sxs-lookup"><span data-stu-id="8ee10-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="8ee10-125">Cette mise à jour est effectuée par flux de données Analytique comme un correctif logiciel, il permet de document toohello de mises à jour partielles, autrement dit, l’ajout de nouvelles propriétés ou de remplacement de qu'une propriété existante est effectuée de façon incrémentielle.</span><span class="sxs-lookup"><span data-stu-id="8ee10-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="8ee10-126">Notez que la raison d’une modification dans les valeurs de propriétés de tableau dans votre document JSON hello dans le tableau dans son intégralité hello obtention remplacé, autrement dit, le tableau de hello n’est pas fusionnée.</span><span class="sxs-lookup"><span data-stu-id="8ee10-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="8ee10-127">Partitionnement des données dans Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="8ee10-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="8ee10-128">COSMOS DB [partitionnée collections](../cosmos-db/partition-data.md) sont hello approche de partitionnement des données recommandée.</span><span class="sxs-lookup"><span data-stu-id="8ee10-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="8ee10-129">Pour les collections de base de données Cosmos uniques, flux Analytique permet toujours toopartition vos données en fonction des modèles de requête hello et les besoins de performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="8ee10-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="8ee10-130">Chaque collection peut contenir des too10GB de données (maximum) et, actuellement, qu'il n’existe aucun tooscale de façon des (ou de dépassement de capacité) une collection.</span><span class="sxs-lookup"><span data-stu-id="8ee10-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="8ee10-131">Pour la montée en puissance parallèle, Analytique de flux de données vous permet de collections de toomultiple toowrite avec un préfixe donné (voir les détails d’utilisation ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="8ee10-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="8ee10-132">Flux de données Analytique utilise hello cohérent [résolveur de Partition de hachage](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) stratégie basée sur l’utilisateur de hello fourni PartitionKey colonne toopartition ses enregistrements de sortie.</span><span class="sxs-lookup"><span data-stu-id="8ee10-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="8ee10-133">Hello nombre de collections avec hello doté du préfixe à l’heure de début du travail de diffusion en continu de hello est utilisé en tant que nombre de partitions de sortie hello, tâche de hello toowhich écrit tooin parallèle (Collections de base de données Cosmos = sortie Partitions).</span><span class="sxs-lookup"><span data-stu-id="8ee10-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="8ee10-134">Pour une collection unique utilisant une méthode d’indexation différée axée uniquement sur les insertions, vous pouvez vous attendre à un débit d’écriture de 0,4 Mo/s.</span><span class="sxs-lookup"><span data-stu-id="8ee10-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="8ee10-135">L’utilisation de plusieurs regroupements peut permettre de vous tooachieve un débit plus élevé et une capacité supérieure.</span><span class="sxs-lookup"><span data-stu-id="8ee10-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="8ee10-136">Si vous envisagez de nombre de partitions tooincrease hello Bonjour futures, vous devrez peut-être toostop votre travail, les données de salutation repartition à partir de vos collections existantes dans les nouvelles collections, puis redémarrer hello flux Analytique travail.</span><span class="sxs-lookup"><span data-stu-id="8ee10-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="8ee10-137">Nous publierons prochainement un article sur l’utilisation de PartitionResolver et sur le repartitionnement, avec des exemples de code.</span><span class="sxs-lookup"><span data-stu-id="8ee10-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="8ee10-138">article de Hello [de partitionnement et de mise à l’échelle dans la base de données Cosmos](../documentdb/documentdb-partition-data.md) fournit également des détails sur ce.</span><span class="sxs-lookup"><span data-stu-id="8ee10-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="8ee10-139">Paramètres de Cosmos DB pour la sortie JSON</span><span class="sxs-lookup"><span data-stu-id="8ee10-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="8ee10-140">Lorsque vous créez une sortie Cosmos DB dans Stream Analytics, vous devez fournir des informations supplémentaires, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="8ee10-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="8ee10-141">Cette section fournit une explication de la définition de propriétés hello.</span><span class="sxs-lookup"><span data-stu-id="8ee10-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="8ee10-142">Collection partitionnée</span><span class="sxs-lookup"><span data-stu-id="8ee10-142">Partitioned Collection</span></span> | <span data-ttu-id="8ee10-143">Collections « Partition unique » multiples</span><span class="sxs-lookup"><span data-stu-id="8ee10-143">Multiple “Single Partition” collections</span></span>
---|---
![écran de sortie documentdb stream analytics](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![écran de sortie documentdb stream analytics](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="8ee10-146">Hello **plusieurs collections de « Partition unique »** scénario nécessite une clé de partition et une configuration prise en charge.</span><span class="sxs-lookup"><span data-stu-id="8ee10-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="8ee10-147">**Alias de sortie** – un toorefer alias cette sortie dans votre requête ASA</span><span class="sxs-lookup"><span data-stu-id="8ee10-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="8ee10-148">**Nom de compte** – nom de hello ou point de terminaison de l’URI de hello Cosmos DB compte.</span><span class="sxs-lookup"><span data-stu-id="8ee10-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="8ee10-149">**Clé de compte** – clé d’accès partagé hello pour hello Cosmos DB compte.</span><span class="sxs-lookup"><span data-stu-id="8ee10-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="8ee10-150">**Base de données** – nom de base de données de base de données Cosmos hello.</span><span class="sxs-lookup"><span data-stu-id="8ee10-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="8ee10-151">**Modèle de nom de collection** – nom de la collection hello ou leur modèle pour hello collections toobe est utilisé.</span><span class="sxs-lookup"><span data-stu-id="8ee10-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="8ee10-152">format du nom de collection Hello peut être construite à l’aide de jeton {partition} facultatif de hello, où les partitions commencent à 0.</span><span class="sxs-lookup"><span data-stu-id="8ee10-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="8ee10-153">Voici des exemples d’entrées valides :</span><span class="sxs-lookup"><span data-stu-id="8ee10-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="8ee10-154">1\) MyCollection : il doit exister une collection nommée « MyCollection ».</span><span class="sxs-lookup"><span data-stu-id="8ee10-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="8ee10-155">2\) MyCollection{partition} : vous devez créer les collections « MyCollection0 », « MyCollection1 », « MyCollection2 », etc.</span><span class="sxs-lookup"><span data-stu-id="8ee10-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="8ee10-156">**Clé de partition** : facultative.</span><span class="sxs-lookup"><span data-stu-id="8ee10-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="8ee10-157">Nécessaire uniquement si vous utilisez un jeton {partition} dans votre modèle de nom de collection.</span><span class="sxs-lookup"><span data-stu-id="8ee10-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="8ee10-158">nom Hello du champ hello dans la clé de hello toospecify sortie événements utilisés pour le partitionnement de sortie entre les collections.</span><span class="sxs-lookup"><span data-stu-id="8ee10-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="8ee10-159">Pour une sortie de collection unique, une colonne de sortie arbitraire peut être utilisée (par exemple, PartitionId).</span><span class="sxs-lookup"><span data-stu-id="8ee10-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="8ee10-160">**ID de document** : facultatif.</span><span class="sxs-lookup"><span data-stu-id="8ee10-160">**Document ID** – Optional.</span></span> <span data-ttu-id="8ee10-161">nom de Hello du champ hello dans les événements de sortie utilisé clé primaire de toospecify hello basées sur les insert ou la mise à jour operations.</span><span class="sxs-lookup"><span data-stu-id="8ee10-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  
