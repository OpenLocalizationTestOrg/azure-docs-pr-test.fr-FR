---
title: "Optimiser le routage ExpressRoute : Azure | Microsoft Docs"
description: "Cette page fournit plus d’informations sur comment toooptimize routage lorsque vous avez plusieurs ExpressRoute des circuits qui se connecter entre Microsoft et votre réseau d’entreprise."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="25a91-103">Optimiser le routage ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="25a91-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="25a91-104">Lorsque vous avez plusieurs circuits ExpressRoute, vous avez plusieurs tooMicrosoft tooconnect de chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="25a91-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="25a91-105">Par conséquent, routage non optimaux peut se produire - autrement dit, le trafic peut prendre un tooreach de chemin d’accès plu Microsoft et Microsoft tooyour réseau.</span><span class="sxs-lookup"><span data-stu-id="25a91-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="25a91-106">Hello plu hello chemin d’accès réseau, une latence plus élevée hello hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="25a91-107">La latence a un impact direct sur les performances d’application ainsi que sur l’expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="25a91-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="25a91-108">Cet article illustrent ce problème et expliquent comment le routage à l’aide de toooptimize hello technologies standard de routage.</span><span class="sxs-lookup"><span data-stu-id="25a91-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="25a91-109">Non optimal de routage à partir du client tooMicrosoft</span><span class="sxs-lookup"><span data-stu-id="25a91-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="25a91-110">Jetons un œil fermer au problème de routage hello par un exemple.</span><span class="sxs-lookup"><span data-stu-id="25a91-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="25a91-111">Imaginez que vous disposez de deux bureaux dans hello des États-Unis, à Los Angeles et de New York.</span><span class="sxs-lookup"><span data-stu-id="25a91-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="25a91-112">Vos bureaux sont connectés sur un réseau étendu (WAN), qui peut être votre propre réseau principal ou le VPN IP de votre fournisseur de services.</span><span class="sxs-lookup"><span data-stu-id="25a91-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="25a91-113">Vous avez deux circuits ExpressRoute, un dans US West et l’autre dans US East, qui sont également connectés sur hello WAN.</span><span class="sxs-lookup"><span data-stu-id="25a91-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="25a91-114">Évidemment, vous avez deux chemins d’accès tooconnect toohello (Microsoft network).</span><span class="sxs-lookup"><span data-stu-id="25a91-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="25a91-115">Imaginez à présent que vous déployiez un service Azure (par exemple, Azure App Service) dans l’Ouest et dans l’Est des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="25a91-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="25a91-116">Votre intention est tooconnect vos utilisateurs à Los Angeles tooAzure région ouest des États-Unis et vos utilisateurs à New York tooAzure États-Unis, car votre administrateur de service publie que les utilisateurs dans chaque office access hello à proximité de services Windows Azure pour une expérience optimale.</span><span class="sxs-lookup"><span data-stu-id="25a91-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="25a91-117">Malheureusement, le plan de hello fonctionne bien pour les utilisateurs de hello côte est, mais pas pour les utilisateurs de côte ouest hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="25a91-118">Hello hello problème est dû de suivant de hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="25a91-119">Sur chaque circuit ExpressRoute, nous publier tooyou préfixe hello dans Azure US East (23.100.0.0/16) à la fois et le préfixe de hello dans Azure US West (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="25a91-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="25a91-120">Si vous ne connaissez pas le préfixe est à partir de la région, vous n’êtes pas en mesure de tootreat il différemment.</span><span class="sxs-lookup"><span data-stu-id="25a91-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="25a91-121">Le réseau WAN peut considérer les deux des préfixes de hello plus proche est tooUS à la région ouest des États-Unis, par conséquent, router les deux toohello d’utilisateurs office circuit ExpressRoute dans US East.</span><span class="sxs-lookup"><span data-stu-id="25a91-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="25a91-122">Final de hello, vous aurez nombreux utilisateurs mécontenter Bonjour Los Angeles office.</span><span class="sxs-lookup"><span data-stu-id="25a91-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problème de ExpressRoute cas 1 - non optimal de routage à partir du client tooMicrosoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="25a91-124">Solution : utilisez des communautés BGP</span><span class="sxs-lookup"><span data-stu-id="25a91-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="25a91-125">toooptimize routage pour les utilisateurs d’office, vous devez tooknow préfixe provient Azure région ouest des États-Unis et qui Azure États-Unis.</span><span class="sxs-lookup"><span data-stu-id="25a91-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="25a91-126">Nous encodons ces informations à l’aide des [valeurs de communauté BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="25a91-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="25a91-127">Nous avons attribué un tooeach de valeur unique BGP Communauté région Azure, par exemple « 12076:51004 » pour l’Est des États-Unis et « 12076:51006 » pour l’Ouest des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="25a91-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="25a91-128">À présent que vous savez à quelles régions Azure correspondent les préfixes, vous pouvez configurer les préférences de circuit ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="25a91-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="25a91-129">Étant donné que nous utilisons les informations de routage du tooexchange hello BGP, vous pouvez utiliser BGP préférence Local tooinfluence routage.</span><span class="sxs-lookup"><span data-stu-id="25a91-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="25a91-130">Dans notre exemple, vous pouvez affecter un supérieur préférence local valeur too13.100.0.0/16 dans US West que dans la région est des États-Unis, de la même manière, un supérieur préférence local valeur too23.100.0.0/16 dans US East que dans la région ouest des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="25a91-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="25a91-131">Cette configuration permet de garantir que, lorsque les deux tooMicrosoft de chemins d’accès sont disponibles, vos utilisateurs à Los Angeles prennent circuit ExpressRoute de hello dans la région ouest des États-Unis tooconnect tooAzure région ouest des États-Unis que vos utilisateurs à New York prennent hello ExpressRoute dans tooAzure de région est des États-Unis .</span><span class="sxs-lookup"><span data-stu-id="25a91-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="25a91-132">Le routage est optimisé des deux côtés.</span><span class="sxs-lookup"><span data-stu-id="25a91-132">Routing is optimized on both sides.</span></span> 

![Solution ExpressRoute n° 1 : utilisez des communautés BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="25a91-134">Hello même technique, à l’aide de préférence Local, peut être appliqué toorouting à partir du client tooAzure réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="25a91-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="25a91-135">Nous ne baliser des préfixes de toohello valeur BGP Communauté publiés à partir du réseau de tooyour Azure.</span><span class="sxs-lookup"><span data-stu-id="25a91-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="25a91-136">Toutefois, étant donné que vous savez qui du déploiement de votre réseau virtuel est toowhich fermeture de votre bureau, vous pouvez configurer vos routeurs en conséquence une tooanother de circuit ExpressRoute tooprefer.</span><span class="sxs-lookup"><span data-stu-id="25a91-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="25a91-137">Non optimal de routage à partir de Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="25a91-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="25a91-138">Voici un autre exemple dans lequel les connexions à partir de Microsoft prennent un tooreach de chemin d’accès plu votre réseau.</span><span class="sxs-lookup"><span data-stu-id="25a91-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="25a91-139">Dans ce cas, vous utilisez des serveurs Exchange locaux et Exchange Online dans un [environnement hybride](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="25a91-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="25a91-140">Vos sites sont connecté tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="25a91-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="25a91-141">Vous publiez des préfixes hello de vos serveurs locaux dans les deux de vos tooMicrosoft bureaux par le biais des circuits ExpressRoute hello deux.</span><span class="sxs-lookup"><span data-stu-id="25a91-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="25a91-142">Initie connexions toohello sur des serveurs locaux dans le cas par exemple, la migration des boîtes aux lettres Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="25a91-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="25a91-143">Malheureusement, hello connexion tooyour Los Angeles office est routé toohello circuit ExpressRoute dans US East avant d’entamer la côte ouest de toohello entière de retour continent hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="25a91-144">cause du problème de hello Hello est similaire toohello tout d’abord un.</span><span class="sxs-lookup"><span data-stu-id="25a91-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="25a91-145">Sans indicateur de n’importe quel réseau de Microsoft hello ne peut pas déterminer le préfixe de client est tooUS fermer et les fermer tooUS ouest.</span><span class="sxs-lookup"><span data-stu-id="25a91-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="25a91-146">Il produit office de tooyour toopick hello chemin d’accès incorrect à Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="25a91-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute cas N° 2 - non optimal de routage à partir de Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="25a91-148">Solution : ajoutez le préfixe AS PATH</span><span class="sxs-lookup"><span data-stu-id="25a91-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="25a91-149">Il existe deux problème toohello de solutions.</span><span class="sxs-lookup"><span data-stu-id="25a91-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="25a91-150">Hello tout d’abord une est que vous publiez simplement votre préfixe local à votre Bureau à Los Angeles, 177.2.0.0/31, sur le circuit ExpressRoute de hello dans US West et votre site de préfixe pour votre bureau de New York, 177.2.0.2/31, sur le circuit ExpressRoute de hello dans US East.</span><span class="sxs-lookup"><span data-stu-id="25a91-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="25a91-151">Par conséquent, il n'existe qu’un seul chemin pour tooeach tooconnect de Microsoft de vos bureaux.</span><span class="sxs-lookup"><span data-stu-id="25a91-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="25a91-152">Il n’existe aucune ambiguïté et le routage est optimisé.</span><span class="sxs-lookup"><span data-stu-id="25a91-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="25a91-153">Grâce à cette conception, vous devez toothink sur votre stratégie de basculement.</span><span class="sxs-lookup"><span data-stu-id="25a91-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="25a91-154">Bonjour événement hello tooMicrosoft de chemin d’accès via ExpressRoute est interrompue, vous devez toomake sûr qu’Exchange Online peuvent toujours se connecter tooyour sur des serveurs locaux.</span><span class="sxs-lookup"><span data-stu-id="25a91-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="25a91-155">solution de deuxième Hello est que vous continuer tooadvertise des préfixes de hello sur les deux circuits ExpressRoute ; en outre vous devez nous fournir une indication de préfixe est toowhich fermer un de vos bureaux.</span><span class="sxs-lookup"><span data-stu-id="25a91-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="25a91-156">Étant donné que nous prenons en charge le chemin d’accès de protocole BGP en ajoutant au début, vous pouvez configurer hello en tant que chemin pour votre préfixe tooinfluence le routage.</span><span class="sxs-lookup"><span data-stu-id="25a91-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="25a91-157">Dans cet exemple, vous pouvez augmenter hello en tant que chemin de 172.2.0.0/31 dans US East afin que nous préfèreront circuit ExpressRoute de hello dans la région ouest des États-Unis pour le trafic destiné à ce préfixe (comme notre réseau pense que préfixe de toothis hello chemin d’accès est plus court dans l’ouest de hello).</span><span class="sxs-lookup"><span data-stu-id="25a91-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="25a91-158">De même, vous pouvez augmenter hello en tant que chemin de 172.2.0.2/31 dans US West afin que nous allons préférez circuit ExpressRoute de hello dans US East.</span><span class="sxs-lookup"><span data-stu-id="25a91-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="25a91-159">Le routage est optimisé pour les deux bureaux.</span><span class="sxs-lookup"><span data-stu-id="25a91-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="25a91-160">Grâce à cette conception, si un circuit ExpressRoute est défaillant, Exchange Online peut toujours vous joindre via un autre circuit ExpressRoute ainsi que par le biais de votre réseau étendu.</span><span class="sxs-lookup"><span data-stu-id="25a91-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="25a91-161">Nous remove privé numéros Bonjour chemin d’accès en tant que pour les préfixes hello reçu sur Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="25a91-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="25a91-162">Vous devez tooappend publique sous forme de nombres dans tooinfluence hello en tant que chemin d’accès au routage pour Microsoft Peering.</span><span class="sxs-lookup"><span data-stu-id="25a91-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Solution ExpressRoute n° 2 : ajoutez le préfixe AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="25a91-164">Alors que les exemples hello sont destiné à Microsoft et homologations Public, nous prennent en charge hello les mêmes fonctionnalités pour l’homologation privée hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="25a91-165">En outre, ajoutant au début du chemin d’accès comme hello fonctionne dans un même circuit ExpressRoute, sélection de hello tooinfluence des chemins d’accès primaire et secondaire hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="25a91-166">Routage non optimal entre des réseaux virtuels</span><span class="sxs-lookup"><span data-stu-id="25a91-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="25a91-167">Grâce à ExpressRoute, vous pouvez activer le réseau virtuel tooVirtual réseau (qui est également appelé « Réseau virtuel ») communication en les liant circuit ExpressRoute de tooan.</span><span class="sxs-lookup"><span data-stu-id="25a91-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="25a91-168">Lorsque vous les liez des circuits ExpressRoute toomultiple, routage non optimaux peut se produire entre hello des réseaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="25a91-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="25a91-169">Prenons un exemple.</span><span class="sxs-lookup"><span data-stu-id="25a91-169">Let's consider an example.</span></span> <span data-ttu-id="25a91-170">Vous disposez de deux circuits ExpressRoute, l’un dans l’Ouest des États-Unis et l’autre dans l’Est des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="25a91-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="25a91-171">Dans chaque région, vous avez deux réseaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="25a91-171">In each region, you have two VNets.</span></span> <span data-ttu-id="25a91-172">Vos serveurs web sont déployés dans un réseau virtuel et les serveurs d’applications de hello autres.</span><span class="sxs-lookup"><span data-stu-id="25a91-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="25a91-173">Pour assurer la redondance, lien vous hello deux réseaux virtuels dans chaque circuit ExpressRoute région tooboth hello local et distant circuit ExpressRoute de hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="25a91-174">Comme indiqué ci-dessous, à partir de chaque réseau virtuel il existe deux chemins d’accès toohello autre réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="25a91-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="25a91-175">Hello réseaux virtuels ne connaissez pas le circuit ExpressRoute est local et celui qui est distant.</span><span class="sxs-lookup"><span data-stu-id="25a91-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="25a91-176">Par conséquent, comme ils le font égal-coût-Multi-Path (ECMP) routage tooload équilibrer inter-réseau virtuel trafic, certains flux de trafic hello chemin le plus long et acheminés au circuit ExpressRoute à distance de hello.</span><span class="sxs-lookup"><span data-stu-id="25a91-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Scénario ExpressRoute n° 3 : routage non optimal entre réseaux virtuels](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="25a91-178">Solution : affectez à une connexion de toolocal poids élevé</span><span class="sxs-lookup"><span data-stu-id="25a91-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="25a91-179">solution de Hello est simple.</span><span class="sxs-lookup"><span data-stu-id="25a91-179">hello solution is simple.</span></span> <span data-ttu-id="25a91-180">Étant donné que vous savez où circuits de réseaux virtuels et hello hello, vous pouvez nous indiquer le chemin d’accès, préférez chaque réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="25a91-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="25a91-181">Spécifiquement pour cet exemple, vous affectez supérieur poids toohello connexion locale à la connexion à distance de toohello (consultez l’exemple de configuration hello [ici](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="25a91-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="25a91-182">Lorsqu’un réseau virtuel reçoit le préfixe hello hello autre réseau virtuel sur plusieurs connexions il préfère connexion de hello avec hello plus élevé poids toosend le trafic destiné à ce préfixe.</span><span class="sxs-lookup"><span data-stu-id="25a91-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Solution de ExpressRoute cas 3 - affecter des poids élevé toolocal connexion](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="25a91-184">Vous pouvez également influer sur routage réseau virtuel tooyour sur un réseau local, si vous avez plusieurs circuits ExpressRoute, en configurant les poids hello d’une connexion au lieu d’appliquer le chemin d’accès en ajoutant le préfixe, une technique décrite dans le deuxième scénario hello ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="25a91-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="25a91-185">Pour chaque préfixe, nous allons toujours examiner poids de connexion hello avant hello longueur de chemin d’accès en tant que lorsque vous décidez comment le trafic de toosend.</span><span class="sxs-lookup"><span data-stu-id="25a91-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
