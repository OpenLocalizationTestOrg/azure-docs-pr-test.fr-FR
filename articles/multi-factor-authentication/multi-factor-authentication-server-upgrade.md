---
title: "Mise à niveau des serveurs Azure MFA | Microsoft Docs"
description: "Étapes et aide pour la mise à niveau du serveur Azure Multi-Factor Authentication vers une version plus récente."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 50bb8ac3-5559-4d8b-a96a-799a74978b14
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: 6e4e09f8539aad56f92ad9137f4a6b9eb0d82370
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="upgrade-to-the-latest-azure-multi-factor-authentication-server"></a><span data-ttu-id="5635e-103">Mise à niveau du serveur Azure Multi-Factor Authentication vers la dernière version</span><span class="sxs-lookup"><span data-stu-id="5635e-103">Upgrade to the latest Azure Multi-Factor Authentication Server</span></span>

<span data-ttu-id="5635e-104">Cet article vous guide dans le processus de mise à niveau du serveur Azure Multi-Factor Authentication (MFA) v6.0 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="5635e-104">This article walks you through the process of upgrading Azure Multi-Factor Authentication (MFA) Server v6.0 or higher.</span></span> <span data-ttu-id="5635e-105">Si vous avez besoin de mettre à niveau une ancienne version de l’Agent PhoneFactor, consultez la page [Mettre à niveau l’Agent PhoneFactor vers le serveur Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="5635e-105">If you need to upgrade an old version of the PhoneFactor Agent, refer to [Upgrade the PhoneFactor Agent to Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server-upgrade.md).</span></span>

<span data-ttu-id="5635e-106">Si vous passez de la v6.x ou d’une version antérieure à la version 7.x ou une version plus récente, tous les composants passent de .NET 2.0 à .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="5635e-106">If you're upgrading from v6.x or older to v7.x or newer, all components change from .NET 2.0 to .NET 4.5.</span></span> <span data-ttu-id="5635e-107">Tous les composants requièrent également Redistribuable Microsoft Visual C++ 2015 Update 1 ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="5635e-107">All components also require Microsoft Visual C++ 2015 Redistributable Update 1 or higher.</span></span> <span data-ttu-id="5635e-108">Le programme d’installation du serveur MFA installe à la fois la version x86 et la version x64 de ces composants s’ils ne sont pas encore installés.</span><span class="sxs-lookup"><span data-stu-id="5635e-108">The MFA Server installer installs both the x86 and x64 versions of these components if they aren't already installed.</span></span> <span data-ttu-id="5635e-109">Si le portail utilisateur et le service web de l’application mobile s’exécutent sur des serveurs distincts, vous devez installer ces packages avant de mettre à niveau ces composants.</span><span class="sxs-lookup"><span data-stu-id="5635e-109">If the User Portal and Mobile App Web Service run on separate servers, you need to install those packages before upgrading those components.</span></span> <span data-ttu-id="5635e-110">Vous pouvez rechercher la dernière mise à jour de Redistribuable Microsoft Visual C++ 2015 sur le [Centre de téléchargement Microsoft](https://www.microsoft.com/en-us/download/).</span><span class="sxs-lookup"><span data-stu-id="5635e-110">You can search for the latest Microsoft Visual C++ 2015 Redistributable update on the [Microsoft Download Center](https://www.microsoft.com/en-us/download/).</span></span> 

## <a name="install-the-latest-version-of-azure-mfa-server"></a><span data-ttu-id="5635e-111">Installer la dernière version du serveur Azure MFA</span><span class="sxs-lookup"><span data-stu-id="5635e-111">Install the latest version of Azure MFA Server</span></span>

1. <span data-ttu-id="5635e-112">Suivez les instructions de la page [Télécharger le serveur Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) pour obtenir la dernière version du serveur Azure MFA.</span><span class="sxs-lookup"><span data-stu-id="5635e-112">Use the instructions in [Download the Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md#download-the-azure-multi-factor-authentication-server) to get the latest version of the Azure MFA Server.</span></span>
2. <span data-ttu-id="5635e-113">Effectuez une sauvegarde du fichier de données du serveur MFA situé dans C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (emplacement d’installation par défaut) sur votre serveur MFA maître.</span><span class="sxs-lookup"><span data-stu-id="5635e-113">Make a backup of the MFA Server data file located at C:\Program Files\Multi-Factor Authentication Server\Data\PhoneFactor.pfdata (assuming the default install location) on your master MFA Server.</span></span>
3. <span data-ttu-id="5635e-114">Si vous exécutez plusieurs serveurs à des fins de haute disponibilité, modifiez les systèmes clients qui s’authentifient auprès du serveur MFA afin qu’ils arrêtent d’envoyer du trafic aux serveurs en cours de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="5635e-114">If you run multiple servers for high availability, change the client systems that authenticate to the MFA Server so that they stop sending traffic to the servers that are upgrading.</span></span> <span data-ttu-id="5635e-115">Si vous utilisez un équilibreur de charge, supprimez un serveur MFA de l’équilibreur de charge, effectuez la mise à niveau, puis rajoutez le serveur à la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="5635e-115">If you use a load balancer, remove a MFA Server from the load balancer, do the upgrade, and then add the server back into the farm.</span></span>
4. <span data-ttu-id="5635e-116">Exécutez le nouveau programme d’installation sur chaque serveur MFA.</span><span class="sxs-lookup"><span data-stu-id="5635e-116">Run the new installer on each MFA Server.</span></span> <span data-ttu-id="5635e-117">Mettez à niveau les serveurs subordonnés en premier, car ils peuvent lire l’ancien fichier de données que le maître est en train de répliquer.</span><span class="sxs-lookup"><span data-stu-id="5635e-117">Upgrade subordinate servers first because they can read the old data file being replicated by the master.</span></span> 

  <span data-ttu-id="5635e-118">Il est inutile de désinstaller votre serveur MFA actuel avant d’exécuter le programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="5635e-118">You do not need to uninstall your current MFA Server before running the installer.</span></span> <span data-ttu-id="5635e-119">Le programme d’installation effectue une mise à niveau sur place.</span><span class="sxs-lookup"><span data-stu-id="5635e-119">The installer performs an in-place upgrade.</span></span> <span data-ttu-id="5635e-120">Le chemin d’installation est récupéré à partir du Registre de l’installation précédente. L’installation se fait donc au même emplacement (par exemple, C:\Program Files\Multi-Factor Authentication Server).</span><span class="sxs-lookup"><span data-stu-id="5635e-120">The installation path is picked up from the registry from the previous installation, so it installs in the same location (for example, C:\Program Files\Multi-Factor Authentication Server).</span></span> 
  
5. <span data-ttu-id="5635e-121">Si vous êtes invité à installer un package de mise à jour Redistribuable Microsoft Visual C++ 2015, acceptez l’invite.</span><span class="sxs-lookup"><span data-stu-id="5635e-121">If you're prompted to install a Microsoft Visual C++ 2015 Redistributable update package, accept the prompt.</span></span> <span data-ttu-id="5635e-122">La version x86 et la version x64 du package sont toutes deux installées.</span><span class="sxs-lookup"><span data-stu-id="5635e-122">Both the x86 and x64 versions of the package are installed.</span></span>
5. <span data-ttu-id="5635e-123">Si vous utilisez le Kit de développement logiciel (SDK) du service web, vous êtes invité à installer le nouveau Kit de développement logiciel (SDK) du service web.</span><span class="sxs-lookup"><span data-stu-id="5635e-123">If you use the Web Service SDK, you are prompted to install the new Web Service SDK.</span></span> <span data-ttu-id="5635e-124">Lorsque vous installez le nouveau Kit SDK du service web, assurez-vous que le nom du répertoire virtuel correspond à celui du répertoire virtuel déjà installé (par exemple, MultiFactorAuthWebServiceSdk).</span><span class="sxs-lookup"><span data-stu-id="5635e-124">When you install the new Web Service SDK, make sure that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuthWebServiceSdk).</span></span>
6. <span data-ttu-id="5635e-125">Répétez les étapes sur tous les serveurs subordonnés.</span><span class="sxs-lookup"><span data-stu-id="5635e-125">Repeat the steps on all subordinate servers.</span></span> <span data-ttu-id="5635e-126">Promouvez l’un des subordonnés comme nouveau maître, puis mettez à niveau l’ancien serveur maître.</span><span class="sxs-lookup"><span data-stu-id="5635e-126">Promote one of the subordinates to be the new master, then upgrade the old master server.</span></span> 

## <a name="upgrade-the-user-portal"></a><span data-ttu-id="5635e-127">Mettre à niveau le portail utilisateur</span><span class="sxs-lookup"><span data-stu-id="5635e-127">Upgrade the User Portal</span></span>

1. <span data-ttu-id="5635e-128">Effectuez une sauvegarde du fichier web.config qui se trouve dans le répertoire virtuel de l’emplacement d’installation du portail utilisateur (par exemple, C:\inetpub\wwwroot\MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="5635e-128">Make a backup of the web.config file that is in the virtual directory of the User Portal installation location (for example, C:\inetpub\wwwroot\MultiFactorAuth).</span></span> <span data-ttu-id="5635e-129">Si des modifications ont été apportées au thème par défaut, effectuez également une sauvegarde du dossier App_Themes\Default.</span><span class="sxs-lookup"><span data-stu-id="5635e-129">If any changes were made to the default theme, make a backup of the App_Themes\Default folder as well.</span></span> <span data-ttu-id="5635e-130">Il est préférable d’effectuer une copie du dossier Default et de créer un nouveau thème plutôt que de modifier le thème Default.</span><span class="sxs-lookup"><span data-stu-id="5635e-130">It is better to create a copy of the Default folder and create a new theme than to change the Default theme.</span></span>
2. <span data-ttu-id="5635e-131">Si le portail utilisateur s’exécute sur le même serveur que les autres composants du serveur MFA, l’installation du serveur MFA vous invite à mettre à jour le portail utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5635e-131">If the User Portal runs on the same server as the other MFA Server components, the MFA Server installation prompts you to update the User Portal.</span></span> <span data-ttu-id="5635e-132">Acceptez l’invite et installez la mise à jour du portail utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5635e-132">Accept the prompt and install the User Portal update.</span></span> <span data-ttu-id="5635e-133">Veillez à ce que le nom du répertoire virtuel corresponde à celui du répertoire virtuel déjà installé (par exemple, MultiFactorAuth).</span><span class="sxs-lookup"><span data-stu-id="5635e-133">Check that the virtual directory name matches the previously installed virtual directory (for example, MultiFactorAuth).</span></span>
3. <span data-ttu-id="5635e-134">Si le portail utilisateur est sur son propre serveur, copiez le fichier MultiFactorAuthenticationUserPortalSetup64.msi dans l’emplacement d’installation de l’un des serveurs MFA et placez-le sur le serveur web du portail utilisateur.</span><span class="sxs-lookup"><span data-stu-id="5635e-134">If the User Portal is on its own server, copy the MultiFactorAuthenticationUserPortalSetup64.msi file from the install location of one of the MFA Servers and put it onto the User Portal web server.</span></span> <span data-ttu-id="5635e-135">Exécutez le programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="5635e-135">Run the installer.</span></span> 

  <span data-ttu-id="5635e-136">Si une erreur se produit, selon laquelle Redistribuable Microsoft Visual C++ 2015 Update 1 ou version ultérieure est requis, téléchargez et installez la dernière mise à jour disponible dans le [Centre de téléchargement Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="5635e-136">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="5635e-137">Installez à la fois la version x86 et la version x64.</span><span class="sxs-lookup"><span data-stu-id="5635e-137">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="5635e-138">Une fois le logiciel du portail utilisateur mis à jour installé, comparez la sauvegarde web.config effectuée à l’étape 1 au nouveau fichier web.config.</span><span class="sxs-lookup"><span data-stu-id="5635e-138">After the updated User Portal software is installed, compare the web.config backup you made in step 1 with the new web.config file.</span></span> <span data-ttu-id="5635e-139">Si le nouveau fichier web.config ne présente pas de nouvel attribut, copiez votre fichier web.config de sauvegarde dans le répertoire virtuel pour remplacer le nouveau.</span><span class="sxs-lookup"><span data-stu-id="5635e-139">If no new attributes exist in the new web.config, copy your backup web.config into the virtual directory to overwrite the new one.</span></span> <span data-ttu-id="5635e-140">Une autre option consiste à copier/coller les valeurs appSettings et l’URL du Kit SDK de service web du fichier de sauvegarde dans le nouveau fichier web.config.</span><span class="sxs-lookup"><span data-stu-id="5635e-140">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="5635e-141">Si le portail utilisateur fonctionne sur plusieurs serveurs, répétez l’installation sur chacun d’eux.</span><span class="sxs-lookup"><span data-stu-id="5635e-141">If you have the User Portal on multiple servers, repeat the installation on all of them.</span></span> 


## <a name="upgrade-the-mobile-app-web-service"></a><span data-ttu-id="5635e-142">Mettre à niveau le service web de l’application mobile</span><span class="sxs-lookup"><span data-stu-id="5635e-142">Upgrade the Mobile App Web Service</span></span>

1. <span data-ttu-id="5635e-143">Effectuez une sauvegarde du fichier web.config qui se trouve dans le répertoire virtuel de l’emplacement d’installation du service web de l’application mobile (par exemple, C:\inetpub\wwwroot\app ou C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span><span class="sxs-lookup"><span data-stu-id="5635e-143">Make a backup of the web.config file that is in the virtual directory of the Mobile App Web Service installation location (for example, C:\inetpub\wwwroot\app or C:\inetpub\wwwroot\MultiFactorAuthMobileAppWebService).</span></span>
2. <span data-ttu-id="5635e-144">Copiez le fichier MultiFactorAuthenticationMobileAppWebServiceSetup64.msi à partir de l’emplacement d’installation des serveurs MFA et placez-le sur le serveur web d’inscription de l’application mobile.</span><span class="sxs-lookup"><span data-stu-id="5635e-144">Copy the MultiFactorAuthenticationMobileAppWebServiceSetup64.msi file from the install location of the MFA Servers and put it onto the Mobile App registration web server.</span></span>
3. <span data-ttu-id="5635e-145">Exécutez le programme d’installation.</span><span class="sxs-lookup"><span data-stu-id="5635e-145">Run the installer.</span></span> 

  <span data-ttu-id="5635e-146">Si une erreur se produit, selon laquelle Redistribuable Microsoft Visual C++ 2015 Update 1 ou version ultérieure est requis, téléchargez et installez le dernier package de mise à jour sur le [Centre de téléchargement Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="5635e-146">If an error occurs stating that Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required, download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="5635e-147">Installez à la fois la version x86 et la version x64.</span><span class="sxs-lookup"><span data-stu-id="5635e-147">Install both the x86 and x64 versions.</span></span>

4. <span data-ttu-id="5635e-148">Une fois le logiciel du service web de l’application mobile mis à jour installé, comparez le fichier web.config sauvegardé à l’étape 1 avec le nouveau fichier web.config.</span><span class="sxs-lookup"><span data-stu-id="5635e-148">After the updated Mobile App Web Service software installs, compare the web.config file that was backed up in step 1 with the new web.config file.</span></span> <span data-ttu-id="5635e-149">Si le nouveau fichier web.config ne présente pas de nouvel attribut, vous pouvez copier votre fichier web.config sauvegardé dans le répertoire virtuel et remplacer le nouveau fichier.</span><span class="sxs-lookup"><span data-stu-id="5635e-149">If no new attributes exist in the new web.config, you can copy your saved web.config back into the virtual directory and overwrite the new one.</span></span> <span data-ttu-id="5635e-150">Une autre option consiste à copier/coller les valeurs appSettings et l’URL du Kit SDK de service web du fichier de sauvegarde dans le nouveau fichier web.config.</span><span class="sxs-lookup"><span data-stu-id="5635e-150">Another option is to copy/paste the appSettings values and the Web Service SDK URL from the backup file into the new web.config.</span></span>

<span data-ttu-id="5635e-151">Si le service web de l’application mobile fonctionne sur plusieurs serveurs, répétez l’installation sur chacun d’eux.</span><span class="sxs-lookup"><span data-stu-id="5635e-151">If you have the Mobile App Web Service on multiple servers, repeat the installation on all of them.</span></span> 

## <a name="upgrade-the-ad-fs-adapters"></a><span data-ttu-id="5635e-152">Mettre à niveau les adaptateurs AD FS</span><span class="sxs-lookup"><span data-stu-id="5635e-152">Upgrade the AD FS Adapters</span></span>


### <a name="if-mfa-runs-on-different-servers-than-ad-fs"></a><span data-ttu-id="5635e-153">Si MFA s’exécute sur d’autres serveurs qu’AD FS</span><span class="sxs-lookup"><span data-stu-id="5635e-153">If MFA runs on different servers than AD FS</span></span>

<span data-ttu-id="5635e-154">Ces instructions s’appliquent uniquement si vous exécutez le serveur Multi-Factor Authentication indépendamment de vos serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="5635e-154">These instructions only apply if you run Multi-Factor Authentication Server separately from your AD FS servers.</span></span> <span data-ttu-id="5635e-155">Si les deux services s’exécutent sur les mêmes serveurs, ignorez cette section et suivez les étapes d’installation.</span><span class="sxs-lookup"><span data-stu-id="5635e-155">If both services run on the same servers, skip this section and go to the installation steps.</span></span> 

1. <span data-ttu-id="5635e-156">Enregistrez une copie du fichier MultiFactorAuthenticationAdfsAdapter.config enregistrée dans AD FS, ou exportez la configuration à l’aide de la commande PowerShell suivante : `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span><span class="sxs-lookup"><span data-stu-id="5635e-156">Save a copy of the MultiFactorAuthenticationAdfsAdapter.config file that was registered in AD FS, or export the configuration using the following PowerShell command: `Export-AdfsAuthenticationProviderConfigurationData -Name [adapter name] -FilePath [path to config file]`.</span></span> <span data-ttu-id="5635e-157">Le nom de l’adaptateur est « WindowsAzureMultiFactorAuthentication » ou « AzureMfaServerAuthentication », selon la version précédemment installée.</span><span class="sxs-lookup"><span data-stu-id="5635e-157">The adapter name is either "WindowsAzureMultiFactorAuthentication" or "AzureMfaServerAuthentication" depending on the version previously installed.</span></span>
2. <span data-ttu-id="5635e-158">Copiez les fichiers suivants de l’emplacement d’installation du serveur MFA vers les serveurs AD FS :</span><span class="sxs-lookup"><span data-stu-id="5635e-158">Copy the following files from the MFA Server installation location to the AD FS servers:</span></span>

  - <span data-ttu-id="5635e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="5635e-159">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
  - <span data-ttu-id="5635e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="5635e-160">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="5635e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="5635e-161">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
  - <span data-ttu-id="5635e-162">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="5635e-162">MultiFactorAuthenticationAdfsAdapter.config</span></span>

3. <span data-ttu-id="5635e-163">Modifiez le script Register-MultiFactorAuthenticationAdfsAdapter.ps1 en ajoutant `-ConfigurationFilePath [path]` à la fin de la commande `Register-AdfsAuthenticationProvider`.</span><span class="sxs-lookup"><span data-stu-id="5635e-163">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding `-ConfigurationFilePath [path]` to the end of the `Register-AdfsAuthenticationProvider` command.</span></span> <span data-ttu-id="5635e-164">Remplacez *[path]* par le chemin complet vers le fichier MultiFactorAuthenticationAdfsAdapter.config ou le fichier config exporté à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="5635e-164">Replace *[path]* with the full path to the MultiFactorAuthenticationAdfsAdapter.config file or the configuration file exported in the previous step.</span></span> 

  <span data-ttu-id="5635e-165">Vérifiez les attributs de la nouvelle configuration MultiFactorAuthenticationAdfsAdapter.config, pour voir s’ils correspondent à l’ancien fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="5635e-165">Check the attributes in the new MultiFactorAuthenticationAdfsAdapter.config to see if they match the old config file.</span></span> <span data-ttu-id="5635e-166">Si des attributs ont été ajoutés ou supprimés dans la nouvelle version, copiez les valeurs des attributs de l’ancien fichier config vers le nouveau, ou bien modifiez l’ancien fichier config pour les faire correspondre.</span><span class="sxs-lookup"><span data-stu-id="5635e-166">If any attributes were added or removed in the new version, copy the attribute values from the old configuration file to the new one or modify the old configuration file to match.</span></span>

### <a name="install-new-ad-fs-adapters"></a><span data-ttu-id="5635e-167">Installer de nouveaux adaptateurs AD FS</span><span class="sxs-lookup"><span data-stu-id="5635e-167">Install new AD FS adapters</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="5635e-168">Les utilisateurs n’auront pas besoin d’effectuer la vérification en deux étapes entre les étapes 3 et 8 de cette section.</span><span class="sxs-lookup"><span data-stu-id="5635e-168">Your users will not be required to perform two-step verification during steps 3-8 of this section.</span></span> <span data-ttu-id="5635e-169">Si AD FS est configuré sur plusieurs clusters, vous pouvez supprimer, mettre à niveau et restaurer chaque cluster de la batterie de serveurs indépendamment des autres clusters afin d’éviter tout temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="5635e-169">If you have AD FS configured in multiple clusters, you can remove, upgrade, and restore each cluster in the farm independently of the other clusters to avoid downtime.</span></span>

1. <span data-ttu-id="5635e-170">Supprimez certains serveurs AD FS de la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="5635e-170">Remove some AD FS servers from the farm.</span></span> <span data-ttu-id="5635e-171">Mettez à jour ces serveurs tandis que les autres sont en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="5635e-171">Update these servers while the others are still running.</span></span>
2. <span data-ttu-id="5635e-172">Installez le nouvel adaptateur AD FS sur chaque serveur supprimé de la batterie de serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="5635e-172">Install the new AD FS adapter on each server removed from the AD FS farm.</span></span> <span data-ttu-id="5635e-173">Si le serveur MFA est installé sur chaque serveur AD FS, vous pouvez effectuer la mise à jour à partir de l’UX administrateur du serveur MFA.</span><span class="sxs-lookup"><span data-stu-id="5635e-173">If the MFA Server is installed on each AD FS server, you can update through the MFA Server admin UX.</span></span> <span data-ttu-id="5635e-174">Sinon, effectuez la mise à jour en exécutant MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="5635e-174">Otherwise, update by running MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span></span> 

  <span data-ttu-id="5635e-175">Si une erreur se produit, selon laquelle Redistribuable Microsoft Visual C++ 2015 Update 1 ou version ultérieure est requis, téléchargez et installez la dernière mise à jour disponible dans le [Centre de téléchargement Microsoft](https://www.microsoft.com/download/).</span><span class="sxs-lookup"><span data-stu-id="5635e-175">If an error occurs stating, "Microsoft Visual C++ 2015 Redistributable Update 1 or higher is required," download and install the latest update package from the [Microsoft Download Center](https://www.microsoft.com/download/).</span></span> <span data-ttu-id="5635e-176">Installez à la fois la version x86 et la version x64.</span><span class="sxs-lookup"><span data-stu-id="5635e-176">Install both the x86 and x64 versions.</span></span>

3. <span data-ttu-id="5635e-177">Accédez à **AD FS** > **Stratégies d’authentification** > **Modifier la stratégie Multi-Factor Authentication globale**.</span><span class="sxs-lookup"><span data-stu-id="5635e-177">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="5635e-178">Décochez **WindowsAzureMultiFactorAuthentication** ou **AzureMFAServerAuthentication** (selon la version actuellement installée).</span><span class="sxs-lookup"><span data-stu-id="5635e-178">Uncheck **WindowsAzureMultiFactorAuthentication** or **AzureMFAServerAuthentication** (depending on the current version installed).</span></span> 

  <span data-ttu-id="5635e-179">Une fois cette étape terminée, la vérification en deux étapes par le serveur MFA ne sera pas disponible dans ce cluster AD FS avant la fin de l’étape 8.</span><span class="sxs-lookup"><span data-stu-id="5635e-179">Once this step is complete, two-step verification through MFA Server is not available in this AD FS cluster until you complete step 8.</span></span>

4. <span data-ttu-id="5635e-180">Annulez l’enregistrement de l’ancienne version de l’adaptateur AD FS en exécutant le script PowerShell Unregister-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="5635e-180">Unregister the older version of the AD FS adapter by running the Unregister-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="5635e-181">Assurez-vous que le paramètre *-Name* (WindowsAzureMultiFactorAuthentication ou AzureMFAServerAuthentication) correspond à celui qui a été affiché à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="5635e-181">Ensure that the *-Name* parameter (either “WindowsAzureMultiFactorAuthentication” or "AzureMFAServerAuthentication") matches the name that was displayed in step 3.</span></span> <span data-ttu-id="5635e-182">Cela s’applique à tous les serveurs du même cluster AD FS, dans la mesure où il s’agit d’une configuration centrale.</span><span class="sxs-lookup"><span data-stu-id="5635e-182">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
5. <span data-ttu-id="5635e-183">Enregistrez le nouvel adaptateur AD FS en exécutant le script PowerShell Register-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="5635e-183">Register the new AD FS adapter by running the Register-MultiFactorAuthenticationAdfsAdapter.ps1 PowerShell script.</span></span> <span data-ttu-id="5635e-184">Cela s’applique à tous les serveurs du même cluster AD FS, dans la mesure où il s’agit d’une configuration centrale.</span><span class="sxs-lookup"><span data-stu-id="5635e-184">This applies to all servers in the same AD FS cluster since there is a central configuration.</span></span>
6. <span data-ttu-id="5635e-185">Redémarrez le service AD FS sur chaque serveur supprimé de la batterie de serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="5635e-185">Restart the AD FS service on each server removed from the AD FS farm.</span></span>
7. <span data-ttu-id="5635e-186">Rajoutez les serveurs mis à jour à la batterie de serveurs AD FS et supprimez les autres serveurs de la batterie.</span><span class="sxs-lookup"><span data-stu-id="5635e-186">Add the updated servers back to the AD FS farm and remove the other servers from the farm.</span></span>
8. <span data-ttu-id="5635e-187">Accédez à **AD FS** > **Stratégies d’authentification** > **Modifier la stratégie Multi-Factor Authentication globale**.</span><span class="sxs-lookup"><span data-stu-id="5635e-187">Go to **AD FS** > **Authentication Policies** > **Edit Global MultiFactor Authentication Policy**.</span></span> <span data-ttu-id="5635e-188">Cochez **AzureMfaServerAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="5635e-188">Check **AzureMfaServerAuthentication**.</span></span>
9. <span data-ttu-id="5635e-189">Répétez l’étape 2 pour mettre à jour les serveurs maintenant supprimés de la batterie de serveurs AD FS et redémarrez le service AD FS sur ces serveurs.</span><span class="sxs-lookup"><span data-stu-id="5635e-189">Repeat step 2 to update the servers now removed from the AD FS farm and restart the AD FS service on those servers.</span></span>
10. <span data-ttu-id="5635e-190">Rajoutez ces serveurs à la batterie de serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="5635e-190">Add those servers back into the AD FS farm.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5635e-191">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="5635e-191">Next steps</span></span>

- <span data-ttu-id="5635e-192">Consultez des exemples de [Scénarios avancés avec Azure Multi-Factor Authentication et des VPN tiers](multi-factor-authentication-advanced-vpn-configurations.md)</span><span class="sxs-lookup"><span data-stu-id="5635e-192">Get examples of [Advanced scenarios with Azure Multi-Factor Authentication and third-party VPNs](multi-factor-authentication-advanced-vpn-configurations.md)</span></span>

- [<span data-ttu-id="5635e-193">Synchronisez le serveur MFA avec Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="5635e-193">Synchronize MFA Server with Windows Server Active Directory</span></span>](multi-factor-authentication-get-started-server-dirint.md)

- <span data-ttu-id="5635e-194">[Configurez l’authentification Windows](multi-factor-authentication-get-started-server-windows.md) pour vos applications</span><span class="sxs-lookup"><span data-stu-id="5635e-194">[Configure Windows Authentication](multi-factor-authentication-get-started-server-windows.md) for your applications</span></span>
