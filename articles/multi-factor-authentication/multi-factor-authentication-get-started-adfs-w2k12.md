---
title: aaaMFA Server avec AD FS dans Windows Server | Documents Microsoft
description: "Cet article décrit comment tooget main d’Azure multi-Factor Authentication et AD FS dans Windows Server 2012 R2 et 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 656785abcc63a020add765a86670b488a3b84b51
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-toowork-with-ad-fs-in-windows-server"></a><span data-ttu-id="9ff38-103">Configurer le serveur Azure multi-Factor Authentication toowork avec AD FS dans Windows Server</span><span class="sxs-lookup"><span data-stu-id="9ff38-103">Configure Azure Multi-Factor Authentication Server toowork with AD FS in Windows Server</span></span>
<span data-ttu-id="9ff38-104">Si vous utilisez les Services de fédération Active Directory (AD FS) et que vous souhaitez toosecure les ressources cloud ou localement, vous pouvez configurer le serveur Azure multi-Factor Authentication toowork avec AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-104">If you use Active Directory Federation Services (AD FS) and want toosecure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server toowork with AD FS.</span></span> <span data-ttu-id="9ff38-105">Cette configuration active la vérification en deux étapes pour les points de terminaison de valeur élevée.</span><span class="sxs-lookup"><span data-stu-id="9ff38-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="9ff38-106">Cet article traite de l’utilisation du serveur Azure Multi-Factor Authentication avec AD FS dans Windows Server 2012 R2 ou Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="9ff38-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="9ff38-107">Pour plus d’informations, consultez les instructions trop[sécuriser les ressources de cloud et locales à l’aide du serveur Azure multi-Factor Authentication avec AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="9ff38-107">For more information, read about how too[secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="9ff38-108">Sécuriser Windows Server AD FS avec le serveur Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="9ff38-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="9ff38-109">Lorsque vous installez le serveur Azure multi-Factor Authentication, vous avez hello options suivantes :</span><span class="sxs-lookup"><span data-stu-id="9ff38-109">When you install Azure Multi-Factor Authentication Server, you have hello following options:</span></span>

* <span data-ttu-id="9ff38-110">Installer le serveur Azure multi-Factor Authentication localement sur hello même serveur que les services AD FS</span><span class="sxs-lookup"><span data-stu-id="9ff38-110">Install Azure Multi-Factor Authentication Server locally on hello same server as AD FS</span></span>
* <span data-ttu-id="9ff38-111">Installer localement de carte de l’authentification multifacteur Azure hello sur hello serveur AD FS, puis installez le serveur multi-Factor Authentication sur un autre ordinateur</span><span class="sxs-lookup"><span data-stu-id="9ff38-111">Install hello Azure Multi-Factor Authentication adapter locally on hello AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="9ff38-112">Avant de commencer, vous devez être conscient des hello informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="9ff38-112">Before you begin, be aware of hello following information:</span></span>

* <span data-ttu-id="9ff38-113">Vous n’êtes pas requis tooinstall serveur Azure multi-Factor Authentication sur votre serveur AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-113">You are not required tooinstall Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="9ff38-114">Toutefois, vous devez installer l’adaptateur multi-Factor Authentication hello pour AD FS sur Windows Server 2016 qui est en cours d’exécution AD FS de Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="9ff38-114">However, you must install hello Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="9ff38-115">S’il s’agit d’une version prise en charge et que vous installez hello adaptateur AD FS séparément sur votre serveur de fédération AD FS, vous pouvez installer le serveur de hello sur un autre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="9ff38-115">You can install hello server on a different computer if it is a supported version and you install hello AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="9ff38-116">Consultez hello suivant les procédures toolearn comment tooinstall hello carte séparément.</span><span class="sxs-lookup"><span data-stu-id="9ff38-116">See hello following procedures toolearn how tooinstall hello adapter separately.</span></span>
* <span data-ttu-id="9ff38-117">Si votre organisation utilise un message texte ou les méthodes de vérification des applications mobiles, les chaînes de hello définis dans les paramètres de la société contiennent un espace réservé, <$*application_name*$>.</span><span class="sxs-lookup"><span data-stu-id="9ff38-117">If your organization is using text message or mobile app verification methods, hello strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="9ff38-118">Dans le serveur MFA v7.1, vous pouvez fournir un nom d’application qui remplace cet espace réservé.</span><span class="sxs-lookup"><span data-stu-id="9ff38-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="9ff38-119">7.0 ou antérieure, cet espace réservé est remplacé pas automatiquement lorsque vous utilisez l’adaptateur hello AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-119">In v7.0 or older, this placeholder is not automatically replaced when you use hello AD FS adapter.</span></span> <span data-ttu-id="9ff38-120">Pour les versions antérieures, supprimez hello espace réservé sur les chaînes appropriées hello lorsque vous sécurisez AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-120">For those older versions, remove hello placeholder from hello appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="9ff38-121">compte de Hello que vous utilisez toosign dans doit avoir des groupes de sécurité utilisateur droits toocreate dans votre service Active Directory.</span><span class="sxs-lookup"><span data-stu-id="9ff38-121">hello account that you use toosign in must have user rights toocreate security groups in your Active Directory service.</span></span>
* <span data-ttu-id="9ff38-122">Assistant installation de l’adaptateur Hello l’authentification multifacteur AD FS crée un groupe de sécurité appelé PhoneFactor Admins dans votre instance d’Active Directory.</span><span class="sxs-lookup"><span data-stu-id="9ff38-122">hello Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="9ff38-123">Il ajoute ensuite le compte de service hello AD FS de votre groupe de toothis de service de fédération.</span><span class="sxs-lookup"><span data-stu-id="9ff38-123">It then adds hello AD FS service account of your federation service toothis group.</span></span> <span data-ttu-id="9ff38-124">Vérifier sur votre contrôleur de domaine que hello groupe PhoneFactor Admins est bien créé et que le compte de service hello AD FS est membre de ce groupe.</span><span class="sxs-lookup"><span data-stu-id="9ff38-124">Verify on your domain controller that hello PhoneFactor Admins group is indeed created and that hello AD FS service account is a member of this group.</span></span> <span data-ttu-id="9ff38-125">Si nécessaire, ajoutez manuellement toohello de compte de service AD FS de hello groupe PhoneFactor Admins sur votre contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="9ff38-125">If necessary, manually add hello AD FS service account toohello PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="9ff38-126">Pour plus d’informations sur l’installation hello SDK du Service Web avec le portail de l’utilisateur hello, en savoir plus sur [déploiement du portail de l’utilisateur hello pour le serveur Azure multi-Factor Authentication.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="9ff38-126">For information about installing hello Web Service SDK with hello user portal, read about [deploying hello user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-hello-ad-fs-server"></a><span data-ttu-id="9ff38-127">Installer le serveur Azure multi-Factor Authentication localement sur le serveur de hello AD FS</span><span class="sxs-lookup"><span data-stu-id="9ff38-127">Install Azure Multi-Factor Authentication Server locally on hello AD FS server</span></span>
1. <span data-ttu-id="9ff38-128">Téléchargez et installez le serveur Azure Multi-Factor Authentication sur votre serveur AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="9ff38-129">Pour plus d’informations concernant l’installation, consultez l’article sur la [prise en main du serveur Azure Multi-Factor Authentication](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="9ff38-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="9ff38-130">Dans la console de gestion du serveur Azure multi-Factor Authentication hello, cliquez sur hello **AD FS** icône.</span><span class="sxs-lookup"><span data-stu-id="9ff38-130">In hello Azure Multi-Factor Authentication Server management console, click hello **AD FS** icon.</span></span> <span data-ttu-id="9ff38-131">Sélectionnez les options de hello **autoriser l’inscription utilisateur** et **permettent aux utilisateurs tooselect méthode**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-131">Select hello options **Allow user enrollment** and **Allow users tooselect method**.</span></span>
3. <span data-ttu-id="9ff38-132">Sélectionnez les options supplémentaires que vous aimeriez toospecify pour votre organisation.</span><span class="sxs-lookup"><span data-stu-id="9ff38-132">Select any additional options you'd like toospecify for your organization.</span></span>
4. <span data-ttu-id="9ff38-133">Cliquez sur **Installer adaptateur AD FS**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="9ff38-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="9ff38-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="9ff38-135">Si la fenêtre d’Active Directory hello est affichée, cela signifie que deux choses.</span><span class="sxs-lookup"><span data-stu-id="9ff38-135">If hello Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="9ff38-136">Votre ordinateur est tooa joint à un domaine et configuration d’Active Directory hello pour sécuriser les communications entre l’adaptateur hello AD FS et le service d’authentification multifacteur hello est incomplète.</span><span class="sxs-lookup"><span data-stu-id="9ff38-136">Your computer is joined tooa domain, and hello Active Directory configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="9ff38-137">Cliquez sur **suivant** tooautomatically terminer cette configuration, ou sélectionnez hello **ignorer la configuration automatique d’Active Directory et configurer les paramètres manuellement** case à cocher.</span><span class="sxs-lookup"><span data-stu-id="9ff38-137">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="9ff38-138">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-138">Click **Next**.</span></span>
6. <span data-ttu-id="9ff38-139">Si windows du groupe Local hello est affiché, cela signifie que deux choses.</span><span class="sxs-lookup"><span data-stu-id="9ff38-139">If hello Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="9ff38-140">Votre ordinateur n’est pas tooa joint à un domaine, et la configuration du groupe local hello pour sécuriser les communications entre l’adaptateur hello AD FS et le service d’authentification multifacteur hello est incomplète.</span><span class="sxs-lookup"><span data-stu-id="9ff38-140">Your computer is not joined tooa domain, and hello local group configuration for securing communication between hello AD FS adapter and hello Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="9ff38-141">Cliquez sur **suivant** tooautomatically terminer cette configuration, ou sélectionnez hello **ignorer la configuration automatique du groupe Local et configurer les paramètres manuellement** case à cocher.</span><span class="sxs-lookup"><span data-stu-id="9ff38-141">Click **Next** tooautomatically complete this configuration, or select hello **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="9ff38-142">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-142">Click **Next**.</span></span>
7. <span data-ttu-id="9ff38-143">Dans l’Assistant installation de hello, cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-143">In hello installation wizard, click **Next**.</span></span> <span data-ttu-id="9ff38-144">Serveur Azure multi-Factor crée hello groupe PhoneFactor Admins et ajoute toohello de compte de service AD FS de hello groupe PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="9ff38-144">Azure Multi-Factor Authentication Server creates hello PhoneFactor Admins group and adds hello AD FS service account toohello PhoneFactor Admins group.</span></span>
   <span data-ttu-id="9ff38-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="9ff38-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="9ff38-146">Sur hello **lancer le programme d’installation** , cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-146">On hello **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="9ff38-147">Dans le programme d’installation de la carte hello l’authentification multifacteur AD FS, cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-147">In hello Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="9ff38-148">Cliquez sur **fermer** lorsque hello installation terminée.</span><span class="sxs-lookup"><span data-stu-id="9ff38-148">Click **Close** when hello installation is finished.</span></span>
11. <span data-ttu-id="9ff38-149">Lorsque l’adaptateur hello a été installé, vous devez l’inscrire avec AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-149">When hello adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="9ff38-150">Ouvrez Windows PowerShell et exécutez hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="9ff38-150">Open Windows PowerShell and run hello following command:</span></span><br><span data-ttu-id="9ff38-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="9ff38-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="9ff38-152">toouse votre adaptateur nouvellement inscrit, modifier la stratégie d’authentification globale hello dans AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-152">toouse your newly registered adapter, edit hello global authentication policy in AD FS.</span></span> <span data-ttu-id="9ff38-153">Dans la console de gestion hello AD FS, accédez toohello **des stratégies d’authentification** nœud.</span><span class="sxs-lookup"><span data-stu-id="9ff38-153">In hello AD FS management console, go toohello **Authentication Policies** node.</span></span> <span data-ttu-id="9ff38-154">Bonjour **multi-Factor Authentication** , cliquez sur hello **modifier** lien suivant toohello **paramètres globaux** section.</span><span class="sxs-lookup"><span data-stu-id="9ff38-154">In hello **Multi-factor Authentication** section, click hello **Edit** link next toohello **Global Settings** section.</span></span> <span data-ttu-id="9ff38-155">Bonjour **modifier la stratégie d’authentification globale** fenêtre, sélectionnez **multi-Factor Authentication** comme une méthode d’authentification supplémentaire, puis cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-155">In hello **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="9ff38-156">adaptateur de Hello est enregistré en tant que WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="9ff38-156">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="9ff38-157">Redémarrer hello AD FS pour effet de tootake hello d’inscription.</span><span class="sxs-lookup"><span data-stu-id="9ff38-157">Restart hello AD FS service for hello registration tootake effect.</span></span>

<span data-ttu-id="9ff38-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="9ff38-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="9ff38-159">À ce stade, serveur multi-Factor Authentication est configuré toobe un toouse de fournisseur d’authentification supplémentaires avec AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-159">At this point, Multi-Factor Authentication Server is set up toobe an additional authentication provider toouse with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-hello-ad-fs-adapter-by-using-hello-web-service-sdk"></a><span data-ttu-id="9ff38-160">Installer une instance autonome de l’adaptateur hello AD FS à l’aide de hello SDK du Service Web</span><span class="sxs-lookup"><span data-stu-id="9ff38-160">Install a standalone instance of hello AD FS adapter by using hello Web Service SDK</span></span>
1. <span data-ttu-id="9ff38-161">Installer hello SDK du Service Web sur serveur hello serveur multi-Factor Authentication est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9ff38-161">Install hello Web Service SDK on hello server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="9ff38-162">Suivant de hello copie les fichiers à partir de la hello \Program Files\Multi-facteur d’authentification Active toohello serveur sur lequel vous envisagez de l’adaptateur tooinstall hello AD FS :</span><span class="sxs-lookup"><span data-stu-id="9ff38-162">Copy hello following files from hello \Program Files\Multi-Factor Authentication Server directory toohello server on which you plan tooinstall hello AD FS adapter:</span></span>
   * <span data-ttu-id="9ff38-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="9ff38-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="9ff38-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="9ff38-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="9ff38-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="9ff38-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="9ff38-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="9ff38-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="9ff38-167">Exécutez le fichier d’installation MultiFactorAuthenticationAdfsAdapterSetup64.msi hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-167">Run hello MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="9ff38-168">Dans le programme d’installation de la carte hello l’authentification multifacteur AD FS, cliquez sur **suivant** installation de hello toostart.</span><span class="sxs-lookup"><span data-stu-id="9ff38-168">In hello Multi-Factor Authentication AD FS adapter installer, click **Next** toostart hello installation.</span></span>
5. <span data-ttu-id="9ff38-169">Cliquez sur **fermer** lorsque hello installation terminée.</span><span class="sxs-lookup"><span data-stu-id="9ff38-169">Click **Close** when hello installation is finished.</span></span>

## <a name="edit-hello-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="9ff38-170">Modifier le fichier MultiFactorAuthenticationAdfsAdapter.config de hello</span><span class="sxs-lookup"><span data-stu-id="9ff38-170">Edit hello MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="9ff38-171">Suivez ces fichiers de MultiFactorAuthenticationAdfsAdapter.config étapes tooedit hello :</span><span class="sxs-lookup"><span data-stu-id="9ff38-171">Follow these steps tooedit hello MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="9ff38-172">Ensemble hello **UseWebServiceSdk** nœud trop**true**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-172">Set hello **UseWebServiceSdk** node too**true**.</span></span>  
2. <span data-ttu-id="9ff38-173">La valeur hello pour **WebServiceSdkUrl** toohello des URL de hello Web Services SDK multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="9ff38-173">Set hello value for **WebServiceSdkUrl** toohello URL of hello Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="9ff38-174">Par exemple : *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, où *certificatename* est le nom hello de votre certificat.</span><span class="sxs-lookup"><span data-stu-id="9ff38-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is hello name of your certificate.</span></span>  
3. <span data-ttu-id="9ff38-175">Modifiez le script de hello Register-multifactorauthenticationadfsadapter.ps1 en ajoutant *- ConfigurationFilePath &lt;chemin d’accès&gt;*  fin toohello Hello `Register-AdfsAuthenticationProvider` commande, où  *&lt;chemin d’accès&gt;*  est le fichier de MultiFactorAuthenticationAdfsAdapter.config toohello hello chemin d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="9ff38-175">Edit hello Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* toohello end of hello `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is hello full path toohello MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="9ff38-176">Configurer hello SDK du Service Web avec un nom d’utilisateur et un mot de passe</span><span class="sxs-lookup"><span data-stu-id="9ff38-176">Configure hello Web Service SDK with a username and password</span></span>
<span data-ttu-id="9ff38-177">Il existe deux options de configuration hello SDK du Service Web.</span><span class="sxs-lookup"><span data-stu-id="9ff38-177">There are two options for configuring hello Web Service SDK.</span></span> <span data-ttu-id="9ff38-178">Hello est tout d’abord avec un nom d’utilisateur et un mot de passe, hello est ensuite avec un certificat client.</span><span class="sxs-lookup"><span data-stu-id="9ff38-178">hello first is with a username and password, hello second is with a client certificate.</span></span> <span data-ttu-id="9ff38-179">Suivez ces étapes pour la première option de hello, ou passez hello directement ensuite.</span><span class="sxs-lookup"><span data-stu-id="9ff38-179">Follow these steps for hello first option, or skip ahead for hello second.</span></span>  

1. <span data-ttu-id="9ff38-180">La valeur hello pour **WebServiceSdkUsername** tooan compte qui est membre du groupe de sécurité PhoneFactor Admins de hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-180">Set hello value for **WebServiceSdkUsername** tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="9ff38-181">Hello d’utilisation &lt;domaine&gt;&#92;&lt; nom d’utilisateur&gt; format.</span><span class="sxs-lookup"><span data-stu-id="9ff38-181">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="9ff38-182">La valeur hello pour **WebServiceSdkPassword** toohello mot de passe approprié.</span><span class="sxs-lookup"><span data-stu-id="9ff38-182">Set hello value for **WebServiceSdkPassword** toohello appropriate account password.</span></span>

### <a name="configure-hello-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="9ff38-183">Configurer hello SDK du Service Web avec un certificat client</span><span class="sxs-lookup"><span data-stu-id="9ff38-183">Configure hello Web Service SDK with a client certificate</span></span>
<span data-ttu-id="9ff38-184">Si vous ne souhaitez pas toouse un nom d’utilisateur et un mot de passe, suivez ces hello de tooconfigure étapes SDK du Service Web avec un certificat client.</span><span class="sxs-lookup"><span data-stu-id="9ff38-184">If you don't want toouse a username and password, follow these steps tooconfigure hello Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="9ff38-185">Obtenir un certificat client à partir d’une autorité de certification pour le serveur hello hello SDK du Service Web est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9ff38-185">Obtain a client certificate from a certificate authority for hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="9ff38-186">Découvrez comment trop[obtenir des certificats clients](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="9ff38-186">Learn how too[obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="9ff38-187">Importation hello toohello ordinateur local certificat personnel magasin de certificats client sur le serveur hello hello SDK du Service Web est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9ff38-187">Import hello client certificate toohello local computer personal certificate store on hello server that is running hello Web Service SDK.</span></span> <span data-ttu-id="9ff38-188">Assurez-vous que le certificat public de ce hello l’autorité de certification est dans le magasin de certificats des certificats racines approuvés.</span><span class="sxs-lookup"><span data-stu-id="9ff38-188">Make sure that hello certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="9ff38-189">Exporter les clés publiques et privées de hello hello client tooa .pfx du fichier de certificat.</span><span class="sxs-lookup"><span data-stu-id="9ff38-189">Export hello public and private keys of hello client certificate tooa .pfx file.</span></span>  
4. <span data-ttu-id="9ff38-190">Exporter la clé publique de hello dans fichier .cer tooa au format Base64.</span><span class="sxs-lookup"><span data-stu-id="9ff38-190">Export hello public key in Base64 format tooa .cer file.</span></span>  
5. <span data-ttu-id="9ff38-191">Dans le Gestionnaire de serveur, vérifiez que cette fonctionnalité de l’authentification du mappage de certificat Client \Web Server\Security\IIS hello serveur Web (IIS) est installée.</span><span class="sxs-lookup"><span data-stu-id="9ff38-191">In Server Manager, verify that hello Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="9ff38-192">S’il n’est pas installé, sélectionnez **Ajout de rôles et fonctionnalités** tooadd cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="9ff38-192">If it is not installed, select **Add Roles and Features** tooadd this feature.</span></span>  
6. <span data-ttu-id="9ff38-193">Dans le Gestionnaire des services Internet, double-cliquez sur **l’éditeur de Configuration** dans le site Web hello qui contient le répertoire virtuel du SDK du Service Web hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-193">In IIS Manager, double-click **Configuration Editor** in hello website that contains hello Web Service SDK virtual directory.</span></span> <span data-ttu-id="9ff38-194">Il est important tooselect site Web de hello, pas les répertoire virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-194">It is important tooselect hello website, not hello virtual directory.</span></span>  
7. <span data-ttu-id="9ff38-195">Accédez toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span><span class="sxs-lookup"><span data-stu-id="9ff38-195">Go toohello **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="9ff38-196">Définissez enabled trop**true**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-196">Set enabled too**true**.</span></span>  
9. <span data-ttu-id="9ff38-197">Définissez oneToOneCertificateMappingsEnabled trop**true**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-197">Set oneToOneCertificateMappingsEnabled too**true**.</span></span>  
10. <span data-ttu-id="9ff38-198">Cliquez sur hello **...**  bouton toooneToOneMappings suivant, puis cliquez sur hello **ajouter** lien.</span><span class="sxs-lookup"><span data-stu-id="9ff38-198">Click hello **...** button next toooneToOneMappings, and then click hello **Add** link.</span></span>  
11. <span data-ttu-id="9ff38-199">Ouvrez hello Base64 .cer fichier que précédemment exporté.</span><span class="sxs-lookup"><span data-stu-id="9ff38-199">Open hello Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="9ff38-200">Supprimez *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, ainsi que tous les sauts de ligne.</span><span class="sxs-lookup"><span data-stu-id="9ff38-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="9ff38-201">Copiez la chaîne résultante de hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-201">Copy hello resulting string.</span></span>  
12. <span data-ttu-id="9ff38-202">Jeu de certificats toohello chaîne copié hello précédant l’étape.</span><span class="sxs-lookup"><span data-stu-id="9ff38-202">Set certificate toohello string copied in hello preceding step.</span></span>  
13. <span data-ttu-id="9ff38-203">Définissez enabled trop**true**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-203">Set enabled too**true**.</span></span>  
14. <span data-ttu-id="9ff38-204">Définir le nom d’utilisateur tooan compte qui est membre du groupe de sécurité PhoneFactor Admins de hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-204">Set userName tooan account that is a member of hello PhoneFactor Admins security group.</span></span> <span data-ttu-id="9ff38-205">Hello d’utilisation &lt;domaine&gt;&#92;&lt; nom d’utilisateur&gt; format.</span><span class="sxs-lookup"><span data-stu-id="9ff38-205">Use hello &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="9ff38-206">Mot de passe hello mot de passe toohello compte approprié et puis fermez l’éditeur de Configuration.</span><span class="sxs-lookup"><span data-stu-id="9ff38-206">Set hello password toohello appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="9ff38-207">Cliquez sur hello **appliquer** lien.</span><span class="sxs-lookup"><span data-stu-id="9ff38-207">Click hello **Apply** link.</span></span>  
17. <span data-ttu-id="9ff38-208">Dans le répertoire virtuel SDK du Service Web de hello, double-cliquez sur **authentification**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-208">In hello Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="9ff38-209">Vérifiez que l’emprunt d’identité ASP.NET et l’authentification de base sont trop**activé**, et que tous les autres éléments sont trop**désactivé**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-209">Verify that ASP.NET Impersonation and Basic Authentication are set too**Enabled**, and that all other items are set too**Disabled**.</span></span>  
19. <span data-ttu-id="9ff38-210">Dans le répertoire virtuel SDK du Service Web de hello, double-cliquez sur **paramètres SSL**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-210">In hello Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="9ff38-211">Définissez les certificats clients trop**accepter**, puis cliquez sur **appliquer**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-211">Set Client Certificates too**Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="9ff38-212">Copier le fichier .pfx de hello vous exportées server toohello antérieures qui est en cours d’exécution hello adaptateur AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-212">Copy hello .pfx file you exported earlier toohello server that is running hello AD FS adapter.</span></span>  
22. <span data-ttu-id="9ff38-213">Importez le magasin de certificats personnel hello .pfx fichier toohello ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="9ff38-213">Import hello .pfx file toohello local computer personal certificate store.</span></span>  
23. <span data-ttu-id="9ff38-214">Avec le bouton droit et sélectionnez **gérer les clés privées**, puis accorder un accès en lecture toohello compte et vous avez utilisé toosign dans le service toohello AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-214">Right-click and select **Manage Private Keys**, and then grant read access toohello account you used toosign in toohello AD FS service.</span></span>  
24. <span data-ttu-id="9ff38-215">Ouvrez hello client certificat et copie hello l’empreinte numérique à partir de hello **détails** onglet.</span><span class="sxs-lookup"><span data-stu-id="9ff38-215">Open hello client certificate and copy hello thumbprint from hello **Details** tab.</span></span>  
25. <span data-ttu-id="9ff38-216">Dans le fichier MultiFactorAuthenticationAdfsAdapter.config de hello, définissez **WebServiceSdkCertificateThumbprint** toohello chaîne copiée à l’étape précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="9ff38-216">In hello MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** toohello string copied in hello previous step.</span></span>  

<span data-ttu-id="9ff38-217">Enfin, tooregister hello l’adaptateur, exécutez hello \Program Files\Multi-script Factor Authentication Server\Register-multifactorauthenticationadfsadapter.ps1 dans PowerShell.</span><span class="sxs-lookup"><span data-stu-id="9ff38-217">Finally, tooregister hello adapter, run hello \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="9ff38-218">adaptateur de Hello est enregistré en tant que WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="9ff38-218">hello adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="9ff38-219">Redémarrer hello AD FS pour effet de tootake hello d’inscription.</span><span class="sxs-lookup"><span data-stu-id="9ff38-219">Restart hello AD FS service for hello registration tootake effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="9ff38-220">Sécurisation des ressources Azure AD à l’aide d’AD FS</span><span class="sxs-lookup"><span data-stu-id="9ff38-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="9ff38-221">toosecure vos ressources de cloud, configurez une règle de revendication afin que les Services de fédération Active Directory émet hello multipleauthn revendication lorsqu’un utilisateur effectue une vérification en deux étapes avec succès.</span><span class="sxs-lookup"><span data-stu-id="9ff38-221">toosecure your cloud resource, set up a claims rule so that Active Directory Federation Services emits hello multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="9ff38-222">Cette revendication est passée sur tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="9ff38-222">This claim is passed on tooAzure AD.</span></span> <span data-ttu-id="9ff38-223">Suivez cette toowalk procédure étapes hello :</span><span class="sxs-lookup"><span data-stu-id="9ff38-223">Follow this procedure toowalk through hello steps:</span></span>

1. <span data-ttu-id="9ff38-224">Ouvrez Gestion AD FS.</span><span class="sxs-lookup"><span data-stu-id="9ff38-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="9ff38-225">Sur hello gauche, sélectionnez **confiance**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-225">On hello left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="9ff38-226">Cliquez avec le bouton droit sur **Plateforme d’identité Microsoft Office 365** et sélectionnez **Modifier les règles de revendication…**</span><span class="sxs-lookup"><span data-stu-id="9ff38-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="9ff38-228">Sous Règles de transformation d’émission, cliquez sur **Ajouter une règle**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="9ff38-230">On hello ajouter un Assistant de règle de revendication transformer, sélectionnez **passer ou filtrer une revendication entrante** dans hello de liste déroulante, puis cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-230">On hello Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from hello drop-down and click **Next**.</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="9ff38-232">Nommez votre règle.</span><span class="sxs-lookup"><span data-stu-id="9ff38-232">Give your rule a name.</span></span>
7. <span data-ttu-id="9ff38-233">Sélectionnez **références des méthodes d’authentification** comme hello entrants le type de revendication.</span><span class="sxs-lookup"><span data-stu-id="9ff38-233">Select **Authentication Methods References** as hello Incoming claim type.</span></span>
8. <span data-ttu-id="9ff38-234">Sélectionnez **Transférer toutes les valeurs de revendication**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="9ff38-235">![Assistant Ajouter une règle de revendication de transformation](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="9ff38-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="9ff38-236">Cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="9ff38-236">Click **Finish**.</span></span> <span data-ttu-id="9ff38-237">Fermez la console de gestion ADFS hello AD.</span><span class="sxs-lookup"><span data-stu-id="9ff38-237">Close hello AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="9ff38-238">Rubriques connexes</span><span class="sxs-lookup"><span data-stu-id="9ff38-238">Related topics</span></span>
<span data-ttu-id="9ff38-239">Pour la résolution des problèmes, consultez hello [FAQ de l’authentification multifacteur Azure](multi-factor-authentication-faq.md)</span><span class="sxs-lookup"><span data-stu-id="9ff38-239">For troubleshooting help, see hello [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>
