---
title: "itinéraires définis par l’aaaUser et le transfert IP dans Azure | Documents Microsoft"
description: "Découvrez comment tooconfigure les itinéraires définis par l’utilisateur (UDR) et le transfert IP de tooforward trafic toonetwork des équipements virtuels dans Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="c5cf2-103">Itinéraires définis par l’utilisateur et transfert IP</span><span class="sxs-lookup"><span data-stu-id="c5cf2-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="c5cf2-104">Lorsque vous ajoutez des machines virtuelles (VM) tooa réseau virtuel (VNet) dans Azure, vous remarquerez que les machines virtuelles de hello sont en mesure de toocommunicate entre eux sur le réseau de hello, automatiquement.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="c5cf2-105">Vous n’avez pas besoin de toospecify une passerelle, bien hello machines virtuelles sont dans des sous-réseaux différents.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="c5cf2-106">Hello vaut également pour la communication entre toohello de machines virtuelles hello Internet public et réseau de local tooyour même lorsqu’une connexion hybride à partir d’Azure tooyour propre centre de données est présente.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="c5cf2-107">Ce flux de communication est possible, car Azure utilise une série de toodefine d’itinéraires système le flux de trafic IP.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="c5cf2-108">Les itinéraires système contrôlent le flux de hello de communication Bonjour les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="c5cf2-109">Depuis hello même sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-109">From within hello same subnet.</span></span>
* <span data-ttu-id="c5cf2-110">À partir d’un sous-réseau tooanother au sein d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="c5cf2-111">À partir de machines virtuelles toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="c5cf2-112">À partir d’un réseau virtuel tooanother réseau virtuel via une passerelle VPN.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="c5cf2-113">À partir d’un réseau virtuel tooanother réseau virtuel via le réseau virtuel d’homologation (chaînage de Service).</span><span class="sxs-lookup"><span data-stu-id="c5cf2-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="c5cf2-114">Un réseau virtuel tooyour sur un réseau local via une passerelle VPN.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="c5cf2-115">Hello figure ci-dessous un paramétrage simple avec un réseau virtuel, deux sous-réseaux et quelques machines virtuelles, ainsi que de hello itinéraires système qui permettent de tooflow du trafic IP.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Itinéraires système dans Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="c5cf2-117">Bien que l’utilisation de hello d’itinéraires du système facilite le trafic automatiquement pour votre déploiement, il existe des cas dans lequel vous souhaitez toocontrol hello routage des paquets via un équipement virtuel.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="c5cf2-118">Vous pouvez donc en créant des itinéraires définis par l’utilisateur qui spécifier saut suivant de hello pour les paquets entrants à la place de l’appliance virtuelle tooa sous-réseau spécifique toogo tooyour, et activation IP transfert pour hello machine virtuelle en cours d’exécution en tant que l’appliance virtuelle hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="c5cf2-119">Hello figure ci-dessous illustre les itinéraires définis par l’utilisateur et transfert tooforce paquets IP envoyés tooone sous-réseau à partir d’un autre toogo via un équipement virtuel sur un troisième sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Itinéraires système dans Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="c5cf2-121">Itinéraires définis par l’utilisateur sont appliqué tootraffic quitter un sous-réseau à partir de n’importe quelle ressource (comme des interfaces réseau attachement tooVMs) dans le sous-réseau de hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="c5cf2-122">Vous ne pouvez pas créer des itinéraires toospecify comment le trafic entre un sous-réseau à partir d’Internet, de hello pour l’instance.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="c5cf2-123">équipement Hello vous transférez le trafic toocannot être Bonjour même sous-réseau que l’origine de trafic de hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="c5cf2-124">Créez toujours un sous-réseau distinct pour vos équipements.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="c5cf2-125">Ressources d’itinéraire</span><span class="sxs-lookup"><span data-stu-id="c5cf2-125">Route resource</span></span>
<span data-ttu-id="c5cf2-126">Routage des paquets sur un réseau TCP/IP basé sur une table d’itinéraires définie sur chaque nœud sur le réseau physique de hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="c5cf2-127">Une table de routage est qu'une collection d’itinéraires individuelles utilisées toodecide où les paquets tooforward basée sur la destination de hello adresse IP.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="c5cf2-128">Un itinéraire se compose des éléments suivants de hello :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-128">A route consists of hello following:</span></span>

| <span data-ttu-id="c5cf2-129">Propriété</span><span class="sxs-lookup"><span data-stu-id="c5cf2-129">Property</span></span> | <span data-ttu-id="c5cf2-130">Description</span><span class="sxs-lookup"><span data-stu-id="c5cf2-130">Description</span></span> | <span data-ttu-id="c5cf2-131">Contraintes</span><span class="sxs-lookup"><span data-stu-id="c5cf2-131">Constraints</span></span> | <span data-ttu-id="c5cf2-132">Considérations</span><span class="sxs-lookup"><span data-stu-id="c5cf2-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="c5cf2-133">Préfixe d’adresse</span><span class="sxs-lookup"><span data-stu-id="c5cf2-133">Address Prefix</span></span> |<span data-ttu-id="c5cf2-134">Hello destination CIDR toowhich hello itinéraire s’applique, comme 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="c5cf2-135">Doit être une plage CIDR valide représentant les adresses sur hello Internet public, réseau virtuel Azure ou centre de données local.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="c5cf2-136">Vérifiez que hello **préfixe d’adresse** ne contient pas d’adresse hello pour hello **adresse du saut suivant**, sinon votre paquets entrera dans une boucle allant de tronçon suivant de hello source toohello sans atteindre destination de Hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="c5cf2-137">Type de tronçon suivant</span><span class="sxs-lookup"><span data-stu-id="c5cf2-137">Next hop type</span></span> |<span data-ttu-id="c5cf2-138">type de Hello du paquet de hello tronçon Azure doit être envoyé à.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="c5cf2-139">Doit être une des valeurs suivantes de hello :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="c5cf2-140">**Réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-140">**Virtual Network**.</span></span> <span data-ttu-id="c5cf2-141">Représente un réseau virtuel local de hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-141">Represents hello local virtual network.</span></span> <span data-ttu-id="c5cf2-142">Par exemple, si vous avez deux sous-réseaux, 10.1.0.0/16 et 10.2.0.0/16 dans hello même réseau virtuel, itinéraire hello pour chaque sous-réseau dans la table d’itinéraires hello aura une valeur de saut suivante de *réseau virtuel*.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="c5cf2-143">**Passerelle de réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="c5cf2-144">Représente une passerelle VPN de site à site Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="c5cf2-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-145">**Internet**.</span></span> <span data-ttu-id="c5cf2-146">Représente la passerelle Internet de hello par défaut fournie par hello Infrastructure Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="c5cf2-147">**Appliance virtuelle**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-147">**Virtual Appliance**.</span></span> <span data-ttu-id="c5cf2-148">Représente une appliance virtuelle que vous avez ajouté tooyour réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="c5cf2-149">**None**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-149">**None**.</span></span> <span data-ttu-id="c5cf2-150">Représente un trou noir.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-150">Represents a black hole.</span></span> <span data-ttu-id="c5cf2-151">Paquets transférés tooa noires ne seront pas transmis du tout.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="c5cf2-152">Envisagez d’utiliser **Appliance virtuelle** toodirect tooa machine virtuelle ou équilibrage de charge Azure adresse IP interne du trafic.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="c5cf2-153">Ce type permet de spécifier de hello d’une adresse IP, comme décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="c5cf2-154">Envisagez d’utiliser un **aucun** toostop des paquets à partir de flux tooa donnée de destination de type.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="c5cf2-155">adresse de tronçon suivant</span><span class="sxs-lookup"><span data-stu-id="c5cf2-155">Next hop address</span></span> |<span data-ttu-id="c5cf2-156">adresse du tronçon suivant Hello contient adresse hello paquets doivent être transférés.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="c5cf2-157">Valeurs de tronçon suivant sont autorisés uniquement dans les itinéraires où le type de tronçon suivant hello est *Appliance virtuelle*.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="c5cf2-158">Doit être une adresse IP qui est accessible dans hello réseau virtuel où hello défini par l’utilisateur un itinéraire est appliquée, sans passer par un **passerelle de réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="c5cf2-159">adresse IP de Hello a toobe hello du réseau virtuel même lorsqu’elle est appliquée, ou sur un réseau virtuel de ressources.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="c5cf2-160">Si l’adresse IP de hello représente un ordinateur virtuel, veillez à activer [transfert IP](#IP-forwarding) dans Azure pour hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="c5cf2-161">Si hello représente hello interne adresse IP de l’équilibrage de charge Azure, assurez-vous que vous avez une règle pour chaque port d’équilibrage de charge correspondante solde de tooload vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="c5cf2-162">Dans Azure PowerShell certaines des valeurs de « Type de tronçon suivant » hello ont des noms différents :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="c5cf2-163">Le réseau virtuel est nommé VnetLocal</span><span class="sxs-lookup"><span data-stu-id="c5cf2-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="c5cf2-164">La passerelle de réseau virtuel est nommée VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="c5cf2-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="c5cf2-165">L’appliance virtuelle est nommée VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="c5cf2-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="c5cf2-166">Internet est nommé Internet</span><span class="sxs-lookup"><span data-stu-id="c5cf2-166">Internet is Internet</span></span>
* <span data-ttu-id="c5cf2-167">Aucun est nommé None</span><span class="sxs-lookup"><span data-stu-id="c5cf2-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="c5cf2-168">Itinéraires système</span><span class="sxs-lookup"><span data-stu-id="c5cf2-168">System routes</span></span>
<span data-ttu-id="c5cf2-169">Chaque sous-réseau créé dans un réseau virtuel est automatiquement associée à une table de routage qui contient hello suivant les règles de routage système :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="c5cf2-170">**Règle locale Vnet**: cette règle est automatiquement créée pour chaque sous-réseau d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="c5cf2-171">Il indique qu’il existe un lien direct entre les machines virtuelles de hello Bonjour réseau virtuel et il n’existe aucun saut suivant intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="c5cf2-172">**Règle local**: cette règle s’applique la plage d’adresses locales toohello tooall trafic à destination et utilise la passerelle VPN en tant que destination du saut suivante hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="c5cf2-173">**Règle Internet**: cette règle gère tout le trafic destiné toohello Internet public (préfixe d’adresse 0.0.0.0/0) et utilise hello infrastructure internet que la passerelle hello de tronçon suivant pour tout le trafic destiné toohello Internet.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="c5cf2-174">Itinéraires définis par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="c5cf2-174">User-defined routes</span></span>
<span data-ttu-id="c5cf2-175">Pour la plupart des environnements, vous devez uniquement les itinéraires de système hello déjà définis par Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="c5cf2-176">Toutefois, devez toocreate une table de routage, vous ajoutez un ou plusieurs itinéraires dans les cas spécifiques, telles que :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="c5cf2-177">Le tunneling forcé toohello Internet via votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="c5cf2-178">Utiliser des appliances virtuelles dans votre environnement Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="c5cf2-179">Dans les scénarios de hello ci-dessus, vous avez toocreate une table d’itinéraires et ajouter tooit d’itinéraires définis par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="c5cf2-180">Vous pouvez avoir plusieurs tables d’itinéraires et hello même table d’itinéraires peut être associé tooone ou autres sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="c5cf2-181">Et chaque sous-réseau ne peut être une table d’itinéraires unique tooa associé.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="c5cf2-182">Tous les ordinateurs virtuels et services de cloud computing dans un sous-réseau, utilisent hello itinéraire table associée toothat sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="c5cf2-183">Sous-réseaux s’appuient sur les itinéraires du système jusqu'à ce qu’une table de routage est associé toohello sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="c5cf2-184">Une fois que l’association existe, le routage se base sur la correspondance de préfixe la plus longue parmi les itinéraires définis par l’utilisateur et les itinéraires du système.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="c5cf2-185">S’il existe plusieurs itinéraires avec hello locales même correspond alors un itinéraire est sélectionné selon son origine dans hello suivant l’ordre :</span><span class="sxs-lookup"><span data-stu-id="c5cf2-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="c5cf2-186">Itinéraire défini par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="c5cf2-186">User defined route</span></span>
2. <span data-ttu-id="c5cf2-187">Itinéraire BGP (lorsque ExpressRoute est utilisé)</span><span class="sxs-lookup"><span data-stu-id="c5cf2-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="c5cf2-188">Itinéraire du système</span><span class="sxs-lookup"><span data-stu-id="c5cf2-188">System route</span></span>

<span data-ttu-id="c5cf2-189">toolearn itinéraires, défini par l’utilisateur de toocreate voir [comment tooCreate achemine et activer le transfert IP dans Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="c5cf2-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5cf2-190">Les itinéraires définis par l’utilisateur sont uniquement appliqué tooAzure de machines virtuelles et services de cloud computing.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="c5cf2-191">Par exemple, si vous souhaitez tooadd appliance virtuelle pare-feu entre votre réseau local et le Azure, vous devez toocreate un itinéraire défini par l’utilisateur pour vos tables d’itinéraires Azure qui transmet tout le trafic entrant toohello local adresse espace toohello virtuel équipement.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="c5cf2-192">Vous pouvez également ajouter un défini par l’utilisateur (UDR) d’itinéraire toohello GatewaySubnet tooforward tout le trafic local tooAzure via l’appliance virtuelle hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="c5cf2-193">Il s’agit d’un ajout récent.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="c5cf2-194">Itinéraires BGP</span><span class="sxs-lookup"><span data-stu-id="c5cf2-194">BGP routes</span></span>
<span data-ttu-id="c5cf2-195">Si vous avez une connexion ExpressRoute entre votre réseau local et le Azure, vous pouvez activer des itinéraires BGP toopropagate à partir de votre tooAzure de réseau local.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="c5cf2-196">Ces itinéraires BGP sont utilisés dans hello même façon que les itinéraires système et utilisateur défini des itinéraires dans chaque sous-réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="c5cf2-197">Pour plus d’informations, consultez la page [Présentation d’ExpressRoute](../expressroute/expressroute-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="c5cf2-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c5cf2-198">Vous pouvez configurer votre force de toouse environnement Azure le tunneling forcé via votre réseau local en créant un itinéraire défini par l’utilisateur pour 0.0.0.0/0 de sous-réseau qui utilise la passerelle VPN de hello en tant que tronçon suivant de hello.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="c5cf2-199">Toutefois, cela ne fonctionne que si vous utilisez une passerelle VPN, et non ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="c5cf2-200">Pour ExpressRoute, le tunneling forcé est configuré via BGP.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="c5cf2-201">Transfert IP</span><span class="sxs-lookup"><span data-stu-id="c5cf2-201">IP forwarding</span></span>
<span data-ttu-id="c5cf2-202">Comme décrit ci-dessus, un des hello principales raisons toocreate un itinéraire défini par l’utilisateur est l’appliance virtuelle tooforward trafic tooa.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="c5cf2-203">Une appliance virtuelle n’est rien de plus qu’une machine virtuelle qui exécute un application utilisée toohandle le trafic d’une certaine façon, tel qu’un pare-feu ou un périphérique NAT.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="c5cf2-204">Cet appareil virtuel que machine virtuelle doit être en mesure de tooreceive trafic entrant qui est ne traité pas tooitself.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="c5cf2-205">tooallow de trafic de machine virtuelle tooreceive adressé tooother destinations, vous devez activer le transfert IP pour hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="c5cf2-206">Il s’agit de configuration, n’est pas un paramètre dans le système d’exploitation de hello invité Azure.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c5cf2-207">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="c5cf2-207">Next steps</span></span>
* <span data-ttu-id="c5cf2-208">Découvrez comment trop[créer des itinéraires dans le modèle de déploiement du Gestionnaire de ressources hello](virtual-network-create-udr-arm-template.md) et les associer toosubnets.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="c5cf2-209">Découvrez comment trop[créer des itinéraires dans le modèle de déploiement classique hello](virtual-network-create-udr-classic-ps.md) et les associer toosubnets.</span><span class="sxs-lookup"><span data-stu-id="c5cf2-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>

