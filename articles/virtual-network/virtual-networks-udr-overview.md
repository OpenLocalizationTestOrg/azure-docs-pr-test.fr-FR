---
title: "Itinéraires définis par l’utilisateur et transfert IP dans Azure | Microsoft Docs"
description: "Apprenez à configurer les itinéraires définis des utilisateurs (UDR) et le transfert IP pour transférer le trafic vers des appliances virtuelles réseau dans Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6274e0101f6fb0864c8d1efaef7fcde78b8760c3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="36ccd-103">Itinéraires définis par l’utilisateur et transfert IP</span><span class="sxs-lookup"><span data-stu-id="36ccd-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="36ccd-104">Lorsque vous ajoutez des machines virtuelles à un réseau virtuel dans Microsoft Azure, notez que les machines sont en mesure d’interagir automatiquement entre elles sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="36ccd-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="36ccd-105">Il est inutile de spécifier une passerelle, bien que les machines virtuelles soient hébergées dans des sous-réseaux différents.</span><span class="sxs-lookup"><span data-stu-id="36ccd-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="36ccd-106">Cela vaut également pour la communication des machines virtuelles vers l’Internet public, et même vers votre réseau local en cas de connexion hybride de Microsoft Azure vers votre propre centre de données.</span><span class="sxs-lookup"><span data-stu-id="36ccd-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="36ccd-107">Ce flux de communications est rendu possible par l’utilisation, par Microsoft Azure, d’une série d’itinéraires système régulant le trafic IP.</span><span class="sxs-lookup"><span data-stu-id="36ccd-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="36ccd-108">Les itinéraires de système contrôlent le flux de communication dans les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="36ccd-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="36ccd-109">au sein d’un sous-réseau ;</span><span class="sxs-lookup"><span data-stu-id="36ccd-109">From within the same subnet.</span></span>
* <span data-ttu-id="36ccd-110">entre deux sous-réseaux d’un réseau virtuel ;</span><span class="sxs-lookup"><span data-stu-id="36ccd-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="36ccd-111">entre les machines virtuelles et Internet ;</span><span class="sxs-lookup"><span data-stu-id="36ccd-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="36ccd-112">entre deux réseaux virtuels via une passerelle VPN ;</span><span class="sxs-lookup"><span data-stu-id="36ccd-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="36ccd-113">entre deux réseaux virtuels par le biais de VNet Peering (chaînage de services) ;</span><span class="sxs-lookup"><span data-stu-id="36ccd-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="36ccd-114">entre un réseau virtuel et votre réseau local via une passerelle VPN.</span><span class="sxs-lookup"><span data-stu-id="36ccd-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="36ccd-115">La figure ci-dessous représente une configuration simple avec un réseau virtuel, deux sous-réseaux et quelques machines virtuelles, avec les itinéraires système qui prennent en charge le trafic IP.</span><span class="sxs-lookup"><span data-stu-id="36ccd-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![Itinéraires système dans Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="36ccd-117">Les itinéraires système permettent la circulation automatique du trafic lié au déploiement, mais il existe des cas où il peut s’avérer utile d’acheminer les paquets au moyen d’une appliance virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="36ccd-118">Pour ce faire, créez des itinéraires personnalisés qui redirigent le prochain tronçon de paquets circulant vers un sous-réseau spécifique vers votre appliance virtuelle, et activer le transfert d’adresses IP pour la machine virtuelle exécutée en tant qu’appliance virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="36ccd-119">La figure ci-dessous montre un exemple d’itinéraires définis par l’utilisateur et le transfert IP pour forcer les paquets envoyés d’un sous-réseau à un autre à passer par un équipement virtuel sur un troisième sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="36ccd-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![Itinéraires système dans Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="36ccd-121">Les itinéraires définis par l’utilisateur sont appliqués au trafic qui quitte un sous-réseau à partir de n’importe quelle ressource (par exemple, des interfaces réseau associées aux machines virtuelles) dans le sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="36ccd-121">User-defined routes are applied to traffic leaving a subnet from any resource (such as network interfaces attached to VMs) in the subnet.</span></span> <span data-ttu-id="36ccd-122">Vous ne pouvez pas créer d’itinéraires pour spécifier la façon dont le trafic entre dans un sous-réseau à partir d’Internet, par exemple.</span><span class="sxs-lookup"><span data-stu-id="36ccd-122">You cannot create routes to specify how traffic enters a subnet from the Internet, for instance.</span></span> <span data-ttu-id="36ccd-123">L’équipement vers lequel vous transférez le trafic ne peut pas se trouver dans le même sous-réseau que celui d’où provient le trafic.</span><span class="sxs-lookup"><span data-stu-id="36ccd-123">The appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="36ccd-124">Créez toujours un sous-réseau distinct pour vos équipements.</span><span class="sxs-lookup"><span data-stu-id="36ccd-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="36ccd-125">Ressources d’itinéraire</span><span class="sxs-lookup"><span data-stu-id="36ccd-125">Route resource</span></span>
<span data-ttu-id="36ccd-126">Les paquets sont acheminés via un réseau TCP/IP basé sur une table d’itinéraires définie sur chaque nœud du réseau physique.</span><span class="sxs-lookup"><span data-stu-id="36ccd-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="36ccd-127">Une table d’itinéraires est une collection d’itinéraires individuels permettant de déterminer où transférer les paquets en fonction de l’adresse IP de destination.</span><span class="sxs-lookup"><span data-stu-id="36ccd-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="36ccd-128">Un itinéraire se compose des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="36ccd-128">A route consists of the following:</span></span>

| <span data-ttu-id="36ccd-129">Propriété</span><span class="sxs-lookup"><span data-stu-id="36ccd-129">Property</span></span> | <span data-ttu-id="36ccd-130">Description</span><span class="sxs-lookup"><span data-stu-id="36ccd-130">Description</span></span> | <span data-ttu-id="36ccd-131">Contraintes</span><span class="sxs-lookup"><span data-stu-id="36ccd-131">Constraints</span></span> | <span data-ttu-id="36ccd-132">Considérations</span><span class="sxs-lookup"><span data-stu-id="36ccd-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="36ccd-133">Préfixe d’adresse</span><span class="sxs-lookup"><span data-stu-id="36ccd-133">Address Prefix</span></span> |<span data-ttu-id="36ccd-134">CIDR de destination auquel s’applique l’itinéraire, par exemple 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="36ccd-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="36ccd-135">Ceci doit être une plage CIDR valide représentant des adresses sur l’Internet public, le réseau virtuel Azure ou le centre de données local.</span><span class="sxs-lookup"><span data-stu-id="36ccd-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="36ccd-136">Assurez-vous que le **préfixe d’adresse** ne contient pas l’adresse de **l’adresse du tronçon suivant** ; dans le cas contraire, vos paquets entreront dans une boucle allant de la source au tronçon suivant sans jamais atteindre leur destination.</span><span class="sxs-lookup"><span data-stu-id="36ccd-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="36ccd-137">Type de tronçon suivant</span><span class="sxs-lookup"><span data-stu-id="36ccd-137">Next hop type</span></span> |<span data-ttu-id="36ccd-138">Type de tronçon Azure vers lequel le paquet doit être envoyé.</span><span class="sxs-lookup"><span data-stu-id="36ccd-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="36ccd-139">Il doit s’agir de l’une des valeurs suivantes : </span><span class="sxs-lookup"><span data-stu-id="36ccd-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="36ccd-140">**Réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-140">**Virtual Network**.</span></span> <span data-ttu-id="36ccd-141">Représente le réseau virtuel local.</span><span class="sxs-lookup"><span data-stu-id="36ccd-141">Represents the local virtual network.</span></span> <span data-ttu-id="36ccd-142">Par exemple, si vous avez deux sous-réseaux, 10.1.0.0/16 et 10.2.0.0/16 qui sont situés dans le même réseau virtuel, l’itinéraire de chaque sous-réseau de la table d’itinéraires a la valeur de tronçon suivant *Réseau virtuel*.</span><span class="sxs-lookup"><span data-stu-id="36ccd-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="36ccd-143">**Passerelle de réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="36ccd-144">Représente une passerelle VPN de site à site Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="36ccd-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-145">**Internet**.</span></span> <span data-ttu-id="36ccd-146">Représente la passerelle Internet par défaut fournie par l’infrastructure Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="36ccd-147">**Appliance virtuelle**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-147">**Virtual Appliance**.</span></span> <span data-ttu-id="36ccd-148">Représente une appliance virtuelle que vous avez ajoutée à votre réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="36ccd-149">**Aucun**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-149">**None**.</span></span> <span data-ttu-id="36ccd-150">Représente un trou noir.</span><span class="sxs-lookup"><span data-stu-id="36ccd-150">Represents a black hole.</span></span> <span data-ttu-id="36ccd-151">Les paquets transmis à un trou noir ne sont pas du tout transférés.</span><span class="sxs-lookup"><span data-stu-id="36ccd-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="36ccd-152">Envisagez d’utiliser une **Appliance virtuelle** pour diriger le trafic vers une machine virtuelle ou une adresse IP Azure Load Balancer interne.</span><span class="sxs-lookup"><span data-stu-id="36ccd-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="36ccd-153">Ce type permet de spécifier une adresse IP, comme décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="36ccd-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="36ccd-154">Envisagez d’utiliser un type **Aucun** afin de mettre fin au transit des paquets vers une destination donnée.</span><span class="sxs-lookup"><span data-stu-id="36ccd-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="36ccd-155">adresse de tronçon suivant</span><span class="sxs-lookup"><span data-stu-id="36ccd-155">Next hop address</span></span> |<span data-ttu-id="36ccd-156">L’adresse de tronçon suivant contient l’adresse IP vers laquelle les paquets doivent être transférés.</span><span class="sxs-lookup"><span data-stu-id="36ccd-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="36ccd-157">Les valeurs de tronçon suivant sont autorisées uniquement dans les itinéraires où le type de tronçon suivant est *Appliance virtuelle*.</span><span class="sxs-lookup"><span data-stu-id="36ccd-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="36ccd-158">Doit être une adresse IP accessible dans le réseau virtuel où s’applique l’itinéraire défini par l’utilisateur sans passer par une **passerelle de réseau virtuel**.</span><span class="sxs-lookup"><span data-stu-id="36ccd-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="36ccd-159">L’adresse IP doit se trouver sur le même réseau virtuel où il est appliqué, ou sur un réseau virtuel homologué.</span><span class="sxs-lookup"><span data-stu-id="36ccd-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="36ccd-160">Si l’adresse IP représente une machine virtuelle, veillez à activer le [transfert IP](#IP-forwarding) dans Azure pour la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="36ccd-161">Si l’adresse IP représente l’adresse IP interne d’Azure Load Balancer, assurez-vous que vous disposez d’une règle d’équilibrage correspondante pour chaque port dont vous souhaitez équilibrer la charge.</span><span class="sxs-lookup"><span data-stu-id="36ccd-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="36ccd-162">Dans Azure PowerShell, certaines valeurs « NextHopType » ont des noms différents :</span><span class="sxs-lookup"><span data-stu-id="36ccd-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="36ccd-163">Le réseau virtuel est nommé VnetLocal</span><span class="sxs-lookup"><span data-stu-id="36ccd-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="36ccd-164">La passerelle de réseau virtuel est nommée VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="36ccd-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="36ccd-165">L’appliance virtuelle est nommée VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="36ccd-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="36ccd-166">Internet est nommé Internet</span><span class="sxs-lookup"><span data-stu-id="36ccd-166">Internet is Internet</span></span>
* <span data-ttu-id="36ccd-167">Aucun est nommé None</span><span class="sxs-lookup"><span data-stu-id="36ccd-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="36ccd-168">Itinéraires système</span><span class="sxs-lookup"><span data-stu-id="36ccd-168">System routes</span></span>
<span data-ttu-id="36ccd-169">Chaque sous-réseau créé dans un réseau virtuel est automatiquement associé à une table de routage qui comporte les règles suivantes d’itinéraires du système :</span><span class="sxs-lookup"><span data-stu-id="36ccd-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="36ccd-170">**Règle locale Vnet**: cette règle est automatiquement créée pour chaque sous-réseau d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="36ccd-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="36ccd-171">Elle indique qu’il existe un lien direct entre les machines virtuelles et le réseau virtuel, et qu’aucun tronçon intermédiaire suivant n’est à signaler.</span><span class="sxs-lookup"><span data-stu-id="36ccd-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="36ccd-172">**Règle locale**: cette règle s’applique à tout le trafic destiné à la plage d’adresses locale et utilise une passerelle VPN en tant que tronçon suivant de destination.</span><span class="sxs-lookup"><span data-stu-id="36ccd-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="36ccd-173">**Règle Internet** : cette règle traite l’ensemble du trafic destiné à l’Internet public (préfixe d’adresse 0.0.0.0/0) et utilise la passerelle Internet d’infrastructure en tant que tronçon suivant pour l’ensemble du trafic destiné au réseau Internet.</span><span class="sxs-lookup"><span data-stu-id="36ccd-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="36ccd-174">Itinéraires définis par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="36ccd-174">User-defined routes</span></span>
<span data-ttu-id="36ccd-175">Pour la plupart des environnements, vous vous contenterez des itinéraires système définis par Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="36ccd-176">Toutefois, vous pouvez créer une table d’itinéraires et ajouter un ou plusieurs itinéraires dans des cas spécifiques, par exemple :</span><span class="sxs-lookup"><span data-stu-id="36ccd-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="36ccd-177">Forcer le tunneling vers Internet via votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="36ccd-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="36ccd-178">Utiliser des appliances virtuelles dans votre environnement Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="36ccd-179">Dans les scénarios ci-dessus, vous devez créer une table d’itinéraires et lui ajouter des itinéraires définis par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="36ccd-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="36ccd-180">Vous pouvez avoir plusieurs tables d’itinéraires et celles-ci peuvent être associées à un ou plusieurs sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="36ccd-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="36ccd-181">Chaque sous-réseau ne peut être associé qu’à une seule table d’itinéraires.</span><span class="sxs-lookup"><span data-stu-id="36ccd-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="36ccd-182">L’ensemble des machines virtuelles et services cloud d’un sous-réseau utilisent la table d’itinéraires associée à ce sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="36ccd-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="36ccd-183">Les sous-réseaux s’appuient sur des itinéraires système jusqu’à ce qu’une table de routage leur soit associée.</span><span class="sxs-lookup"><span data-stu-id="36ccd-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="36ccd-184">Une fois que l’association existe, le routage se base sur la correspondance de préfixe la plus longue parmi les itinéraires définis par l’utilisateur et les itinéraires du système.</span><span class="sxs-lookup"><span data-stu-id="36ccd-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="36ccd-185">S’il existe plusieurs itinéraires avec la même correspondance de préfixe la plus longue, un itinéraire est sélectionné en fonction de son origine dans l’ordre suivant :</span><span class="sxs-lookup"><span data-stu-id="36ccd-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="36ccd-186">Itinéraire défini par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="36ccd-186">User defined route</span></span>
2. <span data-ttu-id="36ccd-187">Itinéraire BGP (lorsque ExpressRoute est utilisé)</span><span class="sxs-lookup"><span data-stu-id="36ccd-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="36ccd-188">Itinéraire du système</span><span class="sxs-lookup"><span data-stu-id="36ccd-188">System route</span></span>

<span data-ttu-id="36ccd-189">Pour savoir comment créer des itinéraires personnalisés, consultez la section [Création d’itinéraires et activation du transfert IP dans Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="36ccd-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="36ccd-190">Les itinéraires définis par l’utilisateur sont appliqués uniquement aux machines virtuelles et services cloud Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="36ccd-191">Par exemple, si vous souhaitez ajouter une appliance virtuelle de pare-feu entre votre réseau local et Azure, vous devez créer un itinéraire défini par l’utilisateur pour vos tables d’itinéraires Azure qui transmettent tout le trafic allant vers l’espace d’adressage local à l’appliance virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="36ccd-192">Vous pouvez également ajouter un itinéraire défini par l’utilisateur au sous-réseau GatewaySubnet pour transférer tout le trafic provenant de la connexion locale vers Azure via l’appliance virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="36ccd-193">Il s’agit d’un ajout récent.</span><span class="sxs-lookup"><span data-stu-id="36ccd-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="36ccd-194">Itinéraires BGP</span><span class="sxs-lookup"><span data-stu-id="36ccd-194">BGP routes</span></span>
<span data-ttu-id="36ccd-195">Si vous avez une connexion ExpressRoute entre votre réseau local et Azure, vous pouvez activer BGP pour propager les itinéraires de votre réseau local vers Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="36ccd-196">Ces itinéraires BGP sont utilisés de la même façon que les itinéraires du système et les itinéraires définis par l’utilisateur dans chaque sous-réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="36ccd-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="36ccd-197">Pour plus d’informations, consultez la page [Présentation d’ExpressRoute](../expressroute/expressroute-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="36ccd-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="36ccd-198">Vous pouvez configurer votre environnement Azure de manière à ce qu’il utilise le tunneling forcé via votre réseau local en créant un itinéraire défini par l’utilisateur pour le sous-réseau 0.0.0.0/0 qui utilise la passerelle VPN comme tronçon suivant.</span><span class="sxs-lookup"><span data-stu-id="36ccd-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="36ccd-199">Toutefois, cela ne fonctionne que si vous utilisez une passerelle VPN, et non ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="36ccd-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="36ccd-200">Pour ExpressRoute, le tunneling forcé est configuré via BGP.</span><span class="sxs-lookup"><span data-stu-id="36ccd-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="36ccd-201">Transfert IP</span><span class="sxs-lookup"><span data-stu-id="36ccd-201">IP forwarding</span></span>
<span data-ttu-id="36ccd-202">Comme décrit ci-dessus, l’une des raisons principales pour créer un itinéraire défini par l’utilisateur est de transférer le trafic vers une appliance virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-202">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="36ccd-203">Une appliance virtuelle n’est rien de plus qu’une machine virtuelle qui exécute une application permettant de gérer le trafic réseau d’une certaine façon, comme un pare-feu ou un périphérique NAT.</span><span class="sxs-lookup"><span data-stu-id="36ccd-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="36ccd-204">La machine virtuelle d’appliance virtuelle doit être capable de recevoir le trafic entrant qui ne lui est pas adressé.</span><span class="sxs-lookup"><span data-stu-id="36ccd-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="36ccd-205">Pour permettre à une machine virtuelle de recevoir le trafic adressé à d’autres destinations, vous devez activer le transfert IP pour la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="36ccd-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="36ccd-206">Il s’agit d’un paramètre Azure, pas d’un paramètre du système d’exploitation invité.</span><span class="sxs-lookup"><span data-stu-id="36ccd-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="36ccd-207">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="36ccd-207">Next steps</span></span>
* <span data-ttu-id="36ccd-208">Découvrez comment [créer des itinéraires dans le modèle de déploiement du Gestionnaire de ressources](virtual-network-create-udr-arm-template.md) et les associer à des sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="36ccd-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="36ccd-209">Découvrez comment [créer des itinéraires dans le modèle de déploiement classique](virtual-network-create-udr-classic-ps.md) et les associer à des sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="36ccd-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>

