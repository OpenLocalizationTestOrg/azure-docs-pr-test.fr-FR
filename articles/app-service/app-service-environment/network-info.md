---
title: "Considérations relatives à la mise en réseau avec un environnement Azure App Service"
description: "Cet article présente le trafic réseau d’un environnement App Service Environment (ASE) et explique comment définir des groupes de sécurité réseau et des itinéraires définis par l’utilisateur (UDR) avec votre ASE."
services: app-service
documentationcenter: na
author: ccompy
manager: stefsch
ms.assetid: 955a4d84-94ca-418d-aa79-b57a5eb8cb85
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/08/2017
ms.author: ccompy
ms.openlocfilehash: 3be0d7a202ff53f5532fd7169a50a04cfaf88832
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="networking-considerations-for-an-app-service-environment"></a><span data-ttu-id="2dc04-103">Considérations relatives à la mise en réseau pour un environnement App Service</span><span class="sxs-lookup"><span data-stu-id="2dc04-103">Networking considerations for an App Service environment</span></span> #

## <a name="overview"></a><span data-ttu-id="2dc04-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="2dc04-104">Overview</span></span> ##

 <span data-ttu-id="2dc04-105">[App Service Environment Azure][Intro] est un déploiement d’Azure App Service dans un sous-réseau d’un réseau virtuel Azure (VNet).</span><span class="sxs-lookup"><span data-stu-id="2dc04-105">Azure [App Service Environment][Intro] is a deployment of Azure App Service into a subnet in your Azure virtual network (VNet).</span></span> <span data-ttu-id="2dc04-106">Il existe deux types de déploiement pour un environnement App Service (ASE) :</span><span class="sxs-lookup"><span data-stu-id="2dc04-106">There are two deployment types for an App Service environment (ASE):</span></span>

- <span data-ttu-id="2dc04-107">**ASE externe** : expose les applications hébergées dans l’ASE sur une adresse IP accessible via Internet.</span><span class="sxs-lookup"><span data-stu-id="2dc04-107">**External ASE**: Exposes the ASE-hosted apps on an internet-accessible IP address.</span></span> <span data-ttu-id="2dc04-108">Pour plus d’informations, consultez [Créer un environnement App Service externe][MakeExternalASE].</span><span class="sxs-lookup"><span data-stu-id="2dc04-108">For more information, see [Create an External ASE][MakeExternalASE].</span></span>
- <span data-ttu-id="2dc04-109">**ASE ILB** : expose les applications hébergées dans l’ASE sur une adresse IP à l’intérieur de votre réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="2dc04-109">**ILB ASE**: Exposes the ASE-hosted apps on an IP address inside your VNet.</span></span> <span data-ttu-id="2dc04-110">Le point de terminaison interne est un équilibreur de charge interne (ILB), d’où cette appellation d’ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2dc04-110">The internal endpoint is an internal load balancer (ILB), which is why it's called an ILB ASE.</span></span> <span data-ttu-id="2dc04-111">Pour plus d’informations, consultez [Create and use an ILB ASE][MakeILBASE] (Créer et utiliser un ASE ILB).</span><span class="sxs-lookup"><span data-stu-id="2dc04-111">For more information, see [Create and use an ILB ASE][MakeILBASE].</span></span>

<span data-ttu-id="2dc04-112">Il existe deux versions de l’application App Service : ASEv1 et ASEv2.</span><span class="sxs-lookup"><span data-stu-id="2dc04-112">There are now two versions of App Service Environment: ASEv1 and ASEv2.</span></span> <span data-ttu-id="2dc04-113">Pour plus d’informations sur ASEv1, consultez la [Présentation de l’environnement App Service v1][ASEv1Intro].</span><span class="sxs-lookup"><span data-stu-id="2dc04-113">For information on ASEv1, see [Introduction to App Service Environment v1][ASEv1Intro].</span></span> <span data-ttu-id="2dc04-114">Un ASEv1 peut être déployé dans un réseau virtuel classique ou Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2dc04-114">ASEv1 can be deployed in a classic or Resource Manager VNet.</span></span> <span data-ttu-id="2dc04-115">Un ASEv2 peut uniquement être déployé dans un réseau virtuel Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="2dc04-115">ASEv2 can only be deployed into a Resource Manager VNet.</span></span>

<span data-ttu-id="2dc04-116">Tous les appels d’un ASE à destination d’Internet quittent le réseau virtuel via une adresse IP virtuelle assignée à l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-116">All calls from an ASE that go to the internet leave the VNet through a VIP assigned for the ASE.</span></span> <span data-ttu-id="2dc04-117">L’adresse IP publique de cette adresse IP virtuelle constitue ensuite l’adresse IP source de tous les appels de l’ASE à destination d’Internet.</span><span class="sxs-lookup"><span data-stu-id="2dc04-117">The public IP of this VIP is then the source IP for all calls from the ASE that go to the internet.</span></span> <span data-ttu-id="2dc04-118">Si les applications hébergées dans votre environnement ASE appellent des ressources de votre réseau virtuel ou hébergées dans un VPN, l’adresse IP source sera l’une des adresses IP du sous-réseau utilisé par votre environnement ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-118">If the apps in your ASE make calls to resources in your VNet or across a VPN, the source IP is one of the IPs in the subnet used by your ASE.</span></span> <span data-ttu-id="2dc04-119">Comme l’ASE se trouve à l’intérieur du réseau virtuel, il peut également accéder aux ressources de celui-ci sans configuration supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="2dc04-119">Because the ASE is within the VNet, it can also access resources within the VNet without any additional configuration.</span></span> <span data-ttu-id="2dc04-120">Si le réseau virtuel est connecté à votre réseau local, les applications dans votre environnement ASE ont également accès aux ressources.</span><span class="sxs-lookup"><span data-stu-id="2dc04-120">If the VNet is connected to your on-premises network, apps in your ASE also have access to resources there.</span></span> <span data-ttu-id="2dc04-121">Vous n’avez pas besoin de configurer l’ASE ou votre application plus en avant.</span><span class="sxs-lookup"><span data-stu-id="2dc04-121">You don't need to configure the ASE or your app any further.</span></span>

![ASE externe][1] 

<span data-ttu-id="2dc04-123">Si vous avez un ASE externe, l’adresse IP virtuelle publique est également le point de terminaison que vos applications ASE peuvent résoudre :</span><span class="sxs-lookup"><span data-stu-id="2dc04-123">If you have an External ASE, the public VIP is also the endpoint that your ASE apps resolve to for:</span></span>

* <span data-ttu-id="2dc04-124">HTTP/S.</span><span class="sxs-lookup"><span data-stu-id="2dc04-124">HTTP/S.</span></span> 
* <span data-ttu-id="2dc04-125">FTP/S.</span><span class="sxs-lookup"><span data-stu-id="2dc04-125">FTP/S.</span></span> 
* <span data-ttu-id="2dc04-126">Déploiement Web.</span><span class="sxs-lookup"><span data-stu-id="2dc04-126">Web deployment.</span></span>
* <span data-ttu-id="2dc04-127">Débogage à distance.</span><span class="sxs-lookup"><span data-stu-id="2dc04-127">Remote debugging.</span></span>

![ASE ILB][2]

<span data-ttu-id="2dc04-129">Si vous possédez un ASE ILB, l’adresse IP de l’équilibreur de charge interne est le point de terminaison pour les protocoles HTTP/S et FTP/S, le déploiement Web et le débogage à distance.</span><span class="sxs-lookup"><span data-stu-id="2dc04-129">If you have an ILB ASE, the IP address of the ILB is the endpoint for HTTP/S, FTP/S, web deployment, and remote debugging.</span></span>

<span data-ttu-id="2dc04-130">Les ports d’accès normaux pour les applications sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="2dc04-130">The normal app access ports are:</span></span>

| <span data-ttu-id="2dc04-131">Utilisation</span><span class="sxs-lookup"><span data-stu-id="2dc04-131">Use</span></span> | <span data-ttu-id="2dc04-132">À partir</span><span class="sxs-lookup"><span data-stu-id="2dc04-132">From</span></span> | <span data-ttu-id="2dc04-133">À</span><span class="sxs-lookup"><span data-stu-id="2dc04-133">To</span></span> |
|----------|---------|-------------|
|  <span data-ttu-id="2dc04-134">HTTP/HTTPS</span><span class="sxs-lookup"><span data-stu-id="2dc04-134">HTTP/HTTPS</span></span>  | <span data-ttu-id="2dc04-135">Configurable par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="2dc04-135">User configurable</span></span> |  <span data-ttu-id="2dc04-136">80, 443</span><span class="sxs-lookup"><span data-stu-id="2dc04-136">80, 443</span></span> |
|  <span data-ttu-id="2dc04-137">FTP/FTPS</span><span class="sxs-lookup"><span data-stu-id="2dc04-137">FTP/FTPS</span></span>    | <span data-ttu-id="2dc04-138">Configurable par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="2dc04-138">User configurable</span></span> |  <span data-ttu-id="2dc04-139">21, 990, 10001-10020</span><span class="sxs-lookup"><span data-stu-id="2dc04-139">21, 990, 10001-10020</span></span> |
|  <span data-ttu-id="2dc04-140">Débogage distant de Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2dc04-140">Visual Studio remote debugging</span></span>  |  <span data-ttu-id="2dc04-141">Configurable par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="2dc04-141">User configurable</span></span> |  <span data-ttu-id="2dc04-142">4016, 4018, 4020, 4022</span><span class="sxs-lookup"><span data-stu-id="2dc04-142">4016, 4018, 4020, 4022</span></span> |

<span data-ttu-id="2dc04-143">Ces ports s’appliquent aussi bien pour un ASE externe que pour un ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2dc04-143">This is true if you're on an External ASE or on an ILB ASE.</span></span> <span data-ttu-id="2dc04-144">Si vous êtes dans un ASE externe, appuyez sur ces ports sur l’adresse IP virtuelle publique.</span><span class="sxs-lookup"><span data-stu-id="2dc04-144">If you're on an External ASE, you hit those ports on the public VIP.</span></span> <span data-ttu-id="2dc04-145">Si vous vous trouvez dans un ASE ILB, vous atteignez ces ports sur l’équilibreur de charge interne.</span><span class="sxs-lookup"><span data-stu-id="2dc04-145">If you're on an ILB ASE, you hit those ports on the ILB.</span></span> <span data-ttu-id="2dc04-146">Si vous verrouillez le port 443, certaines fonctionnalités exposées dans le portail peuvent être affectées.</span><span class="sxs-lookup"><span data-stu-id="2dc04-146">If you lock down port 443, there can be an effect on some features exposed in the portal.</span></span> <span data-ttu-id="2dc04-147">Pour plus d’informations, consultez la section [Dépendances du portail](#portaldep).</span><span class="sxs-lookup"><span data-stu-id="2dc04-147">For more information, see [Portal dependencies](#portaldep).</span></span>

## <a name="ase-dependencies"></a><span data-ttu-id="2dc04-148">Dépendances d’un ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-148">ASE dependencies</span></span> ##

<span data-ttu-id="2dc04-149">Un ASE présente la dépendance d’accès entrant suivante :</span><span class="sxs-lookup"><span data-stu-id="2dc04-149">An ASE inbound access dependency is:</span></span>

| <span data-ttu-id="2dc04-150">Utilisation</span><span class="sxs-lookup"><span data-stu-id="2dc04-150">Use</span></span> | <span data-ttu-id="2dc04-151">À partir</span><span class="sxs-lookup"><span data-stu-id="2dc04-151">From</span></span> | <span data-ttu-id="2dc04-152">À</span><span class="sxs-lookup"><span data-stu-id="2dc04-152">To</span></span> |
|-----|------|----|
| <span data-ttu-id="2dc04-153">Gestion</span><span class="sxs-lookup"><span data-stu-id="2dc04-153">Management</span></span> | <span data-ttu-id="2dc04-154">Adresses de gestion App Service</span><span class="sxs-lookup"><span data-stu-id="2dc04-154">App Service management addresses</span></span> | <span data-ttu-id="2dc04-155">Sous-réseau de l’ASE : 454, 455</span><span class="sxs-lookup"><span data-stu-id="2dc04-155">ASE subnet: 454, 455</span></span> |
|  <span data-ttu-id="2dc04-156">Communications internes de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-156">ASE internal communication</span></span> | <span data-ttu-id="2dc04-157">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-157">ASE subnet: All ports</span></span> | <span data-ttu-id="2dc04-158">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-158">ASE subnet: All ports</span></span>
|  <span data-ttu-id="2dc04-159">Autoriser le trafic entrant provenant d’Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="2dc04-159">Allow Azure load balancer inbound</span></span> | <span data-ttu-id="2dc04-160">Équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="2dc04-160">Azure load balancer</span></span> | <span data-ttu-id="2dc04-161">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-161">ASE subnet: All ports</span></span>
|  <span data-ttu-id="2dc04-162">Adresses IP affectées par l’application</span><span class="sxs-lookup"><span data-stu-id="2dc04-162">App assigned IP addresses</span></span> | <span data-ttu-id="2dc04-163">Adresses affectées par l’application</span><span class="sxs-lookup"><span data-stu-id="2dc04-163">App assigned addresses</span></span> | <span data-ttu-id="2dc04-164">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-164">ASE subnet: All ports</span></span>

<span data-ttu-id="2dc04-165">Le trafic entrant fournit la commande et le contrôle de l’ASE en plus de la surveillance du système.</span><span class="sxs-lookup"><span data-stu-id="2dc04-165">The inbound traffic provides command and control of the ASE in addition to system monitoring.</span></span> <span data-ttu-id="2dc04-166">Les adresses IP sources pour ce trafic sont répertoriées dans le document [Adresses de gestion App Service Environment][ASEManagement].</span><span class="sxs-lookup"><span data-stu-id="2dc04-166">The source IPs for this traffic are listed in the [ASE Management addresses][ASEManagement] document.</span></span> <span data-ttu-id="2dc04-167">Par conséquent, la configuration de la sécurité réseau doit autoriser l’accès sur les ports 454 et 455 à partir de toutes les adresses IP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-167">The network security configuration needs to allow access from all IPs on ports 454 and 455.</span></span>

<span data-ttu-id="2dc04-168">Le sous-réseau de l’ASE comprend divers ports utilisés pour la communication des composants internes ; ces ports peuvent changer.</span><span class="sxs-lookup"><span data-stu-id="2dc04-168">Within the ASE subnet there are many ports used for internal component communication and they can change.</span></span>  <span data-ttu-id="2dc04-169">Tous les ports du sous-réseau de l’ASE doivent être accessibles à partir du sous-réseau de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-169">This requires all of the ports in the ASE subnet to be accessible from the ASE subnet.</span></span> 

<span data-ttu-id="2dc04-170">Pour permettre la communication entre l’équilibreur de charge Azure et le sous-réseau de l’ASE, les ports 454, 455 et 16001 (au minimum) doivent être ouverts.</span><span class="sxs-lookup"><span data-stu-id="2dc04-170">For the communication between the Azure load balancer and the ASE subnet the minimum ports that need to be open are 454, 455 and 16001.</span></span> <span data-ttu-id="2dc04-171">Le port 16001 sert à maintenir le trafic entre l’équilibreur de charge et le sous-réseau de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-171">The 16001 port is used for keep alive traffic between the load balancer and the ASE.</span></span> <span data-ttu-id="2dc04-172">Si vous utilisez un ASE ILB, vous pouvez limiter le trafic aux ports 454, 455 et 16001.</span><span class="sxs-lookup"><span data-stu-id="2dc04-172">If you are using an ILB ASE then you can lock traffic down to just the 454, 455, 16001 ports.</span></span>  <span data-ttu-id="2dc04-173">Si vous utilisez un ASE externe, vous devez prendre en compte les ports d’accès application normaux.</span><span class="sxs-lookup"><span data-stu-id="2dc04-173">If you are using an External ASE then you need to take into account the normal app access ports.</span></span>  <span data-ttu-id="2dc04-174">Si vous utilisez des adresses affectées par l’application, vous devez les ouvrir à tous les ports.</span><span class="sxs-lookup"><span data-stu-id="2dc04-174">If you are using app assigned addresses you need to open it to all ports.</span></span>  <span data-ttu-id="2dc04-175">Quand une adresse est affectée à une application spécifique, l’équilibreur de charge utilise des ports qui ne sont pas connus à l’avance pour l’envoi du trafic HTTP et HTTPS à l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-175">When an address is assigned to a specific app, then the load balancer will use ports that are not known of in advance to send HTTP and HTTPS traffic to the ASE.</span></span>

<span data-ttu-id="2dc04-176">Si vous utilisez des adresses IP affectées par l’application, vous devez autoriser le trafic entre les adresses IP affectées à vos applications et le sous-réseau de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-176">If you are using app assigned IP addresses you need to allow traffic from the IPs assigned to your apps to the ASE subnet.</span></span>

<span data-ttu-id="2dc04-177">Pour l’accès sortant, un ASE dépend de plusieurs systèmes externes.</span><span class="sxs-lookup"><span data-stu-id="2dc04-177">For outbound access, an ASE depends on multiple external systems.</span></span> <span data-ttu-id="2dc04-178">Ces dépendances système sont définies avec des noms DNS et ne sont pas mappées à un ensemble fixe d’adresses IP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-178">Those system dependencies are defined with DNS names and don't map to a fixed set of IP addresses.</span></span> <span data-ttu-id="2dc04-179">Par conséquent, l’ASE requiert un accès sortant vers toutes les adresses IP sur divers ports à partir de son sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="2dc04-179">Thus, the ASE requires outbound access from the ASE subnet to all external IPs across a variety of ports.</span></span> <span data-ttu-id="2dc04-180">Un ASE présente les dépendances d’accès sortant suivantes :</span><span class="sxs-lookup"><span data-stu-id="2dc04-180">An ASE has the following outbound dependencies:</span></span>

| <span data-ttu-id="2dc04-181">Utilisation</span><span class="sxs-lookup"><span data-stu-id="2dc04-181">Use</span></span> | <span data-ttu-id="2dc04-182">À partir</span><span class="sxs-lookup"><span data-stu-id="2dc04-182">From</span></span> | <span data-ttu-id="2dc04-183">À</span><span class="sxs-lookup"><span data-stu-id="2dc04-183">To</span></span> |
|-----|------|----|
| <span data-ttu-id="2dc04-184">Azure Storage</span><span class="sxs-lookup"><span data-stu-id="2dc04-184">Azure Storage</span></span> | <span data-ttu-id="2dc04-185">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-185">ASE subnet</span></span> | <span data-ttu-id="2dc04-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net : 80, 443, 445 (le port 445 est requis uniquement pour ASEv1)</span><span class="sxs-lookup"><span data-stu-id="2dc04-186">table.core.windows.net, blob.core.windows.net, queue.core.windows.net, file.core.windows.net: 80, 443, 445 (445 is only needed for ASEv1.)</span></span> |
| <span data-ttu-id="2dc04-187">Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="2dc04-187">Azure SQL Database</span></span> | <span data-ttu-id="2dc04-188">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-188">ASE subnet</span></span> | <span data-ttu-id="2dc04-189">database.windows.net : 1433, 11000-11999, 14000-14999 (pour plus d’informations, consultez [Port utilisé par SQL Database V12](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span><span class="sxs-lookup"><span data-stu-id="2dc04-189">database.windows.net: 1433, 11000-11999, 14000-14999 (For more information, see [SQL Database V12 port usage](../../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).)</span></span>|
| <span data-ttu-id="2dc04-190">Gestion d’Azure</span><span class="sxs-lookup"><span data-stu-id="2dc04-190">Azure management</span></span> | <span data-ttu-id="2dc04-191">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-191">ASE subnet</span></span> | <span data-ttu-id="2dc04-192">management.core.windows.net, management.azure.com : 443</span><span class="sxs-lookup"><span data-stu-id="2dc04-192">management.core.windows.net, management.azure.com: 443</span></span> 
| <span data-ttu-id="2dc04-193">Vérification du certificat SSL</span><span class="sxs-lookup"><span data-stu-id="2dc04-193">SSL certificate verification</span></span> |  <span data-ttu-id="2dc04-194">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-194">ASE subnet</span></span>            |  <span data-ttu-id="2dc04-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com : 443</span><span class="sxs-lookup"><span data-stu-id="2dc04-195">ocsp.msocsp.com, mscrl.microsoft.com, crl.microsoft.com: 443</span></span>
| <span data-ttu-id="2dc04-196">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="2dc04-196">Azure Active Directory</span></span>        | <span data-ttu-id="2dc04-197">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-197">ASE subnet</span></span>            |  <span data-ttu-id="2dc04-198">Internet : 443</span><span class="sxs-lookup"><span data-stu-id="2dc04-198">Internet: 443</span></span>
| <span data-ttu-id="2dc04-199">Gestion d’App Service</span><span class="sxs-lookup"><span data-stu-id="2dc04-199">App Service management</span></span>        | <span data-ttu-id="2dc04-200">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-200">ASE subnet</span></span>            |  <span data-ttu-id="2dc04-201">Internet : 443</span><span class="sxs-lookup"><span data-stu-id="2dc04-201">Internet: 443</span></span>
| <span data-ttu-id="2dc04-202">DNS Azure</span><span class="sxs-lookup"><span data-stu-id="2dc04-202">Azure DNS</span></span>                     | <span data-ttu-id="2dc04-203">Sous-réseau de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-203">ASE subnet</span></span>            |  <span data-ttu-id="2dc04-204">Internet : 53</span><span class="sxs-lookup"><span data-stu-id="2dc04-204">Internet: 53</span></span>
| <span data-ttu-id="2dc04-205">Communications internes de l’ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-205">ASE internal communication</span></span>    | <span data-ttu-id="2dc04-206">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-206">ASE subnet: All ports</span></span> |  <span data-ttu-id="2dc04-207">Sous-réseau de l’ASE : tous les ports</span><span class="sxs-lookup"><span data-stu-id="2dc04-207">ASE subnet: All ports</span></span>

<span data-ttu-id="2dc04-208">Si l’ASE n’a plus accès à ces dépendances, il cesse de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="2dc04-208">If the ASE loses access to these dependencies, it stops working.</span></span> <span data-ttu-id="2dc04-209">Si cela dure plus d’un certain temps, l’ASE est suspendu.</span><span class="sxs-lookup"><span data-stu-id="2dc04-209">When that happens long enough, the ASE is suspended.</span></span>

### <a name="customer-dns"></a><span data-ttu-id="2dc04-210">DNS client</span><span class="sxs-lookup"><span data-stu-id="2dc04-210">Customer DNS</span></span> ###

<span data-ttu-id="2dc04-211">Si le réseau virtuel est configuré avec un serveur DNS défini par un client, les charges de travail du client l’utilisent.</span><span class="sxs-lookup"><span data-stu-id="2dc04-211">If the VNet is configured with a customer-defined DNS server, the tenant workloads use it.</span></span> <span data-ttu-id="2dc04-212">L’ASE a toujours besoin de communiquer avec le DNS Azure à des fins de gestion.</span><span class="sxs-lookup"><span data-stu-id="2dc04-212">The ASE still needs to communicate with Azure DNS for management purposes.</span></span> 

<span data-ttu-id="2dc04-213">Si le réseau virtuel est configuré avec un DNS client de l’autre côté d’un réseau VPN, le serveur DNS doit être accessible à partir du sous-réseau contenant l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-213">If the VNet is configured with a customer DNS on the other side of a VPN, the DNS server must be reachable from the subnet that contains the ASE.</span></span>

<a name="portaldep"></a>

## <a name="portal-dependencies"></a><span data-ttu-id="2dc04-214">Dépendances du portail</span><span class="sxs-lookup"><span data-stu-id="2dc04-214">Portal dependencies</span></span> ##

<span data-ttu-id="2dc04-215">Outre les dépendances fonctionnelles que présente un ASE, il existe quelques éléments supplémentaires liés à l’utilisation du portail.</span><span class="sxs-lookup"><span data-stu-id="2dc04-215">In addition to the ASE functional dependencies, there are a few extra items related to the portal experience.</span></span> <span data-ttu-id="2dc04-216">Certaines des fonctionnalités du portail Azure dépendent d’un accès direct au _site du Gestionnaire de contrôle des services (SCM)_.</span><span class="sxs-lookup"><span data-stu-id="2dc04-216">Some of the capabilities in the Azure portal depend on direct access to _SCM site_.</span></span> <span data-ttu-id="2dc04-217">Pour chaque application dans Azure App Service, il existe deux URL.</span><span class="sxs-lookup"><span data-stu-id="2dc04-217">For every app in Azure App Service, there are two URLs.</span></span> <span data-ttu-id="2dc04-218">La première URL sert à accéder à votre application.</span><span class="sxs-lookup"><span data-stu-id="2dc04-218">The first URL is to access your app.</span></span> <span data-ttu-id="2dc04-219">La seconde permet d’accéder au site SCM, également désigné sous le nom de _console Kudu_.</span><span class="sxs-lookup"><span data-stu-id="2dc04-219">The second URL is to access the SCM site, which is also called the _Kudu console_.</span></span> <span data-ttu-id="2dc04-220">Voici quelques-unes des fonctionnalités qui utilisent le site SCM :</span><span class="sxs-lookup"><span data-stu-id="2dc04-220">Features that use the SCM site include:</span></span>

-   <span data-ttu-id="2dc04-221">Tâches web</span><span class="sxs-lookup"><span data-stu-id="2dc04-221">Web jobs</span></span>
-   <span data-ttu-id="2dc04-222">Fonctions</span><span class="sxs-lookup"><span data-stu-id="2dc04-222">Functions</span></span>
-   <span data-ttu-id="2dc04-223">Diffusion de journaux</span><span class="sxs-lookup"><span data-stu-id="2dc04-223">Log streaming</span></span>
-   <span data-ttu-id="2dc04-224">Kudu</span><span class="sxs-lookup"><span data-stu-id="2dc04-224">Kudu</span></span>
-   <span data-ttu-id="2dc04-225">Extensions</span><span class="sxs-lookup"><span data-stu-id="2dc04-225">Extensions</span></span>
-   <span data-ttu-id="2dc04-226">Process Explorer</span><span class="sxs-lookup"><span data-stu-id="2dc04-226">Process Explorer</span></span>
-   <span data-ttu-id="2dc04-227">Console</span><span class="sxs-lookup"><span data-stu-id="2dc04-227">Console</span></span>

<span data-ttu-id="2dc04-228">Lorsque vous utilisez un ASE ILB, le site SCM n’est pas accessible depuis l’extérieur du réseau virtuel d’internet.</span><span class="sxs-lookup"><span data-stu-id="2dc04-228">When you use an ILB ASE, the SCM site isn't internet accessible from outside the VNet.</span></span> <span data-ttu-id="2dc04-229">Quand votre application est hébergée sur un ASE ILB, certaines fonctionnalités ne sont pas opérationnelles à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="2dc04-229">When your app is hosted on an ILB ASE, some capabilities will not work from the portal.</span></span>  

<span data-ttu-id="2dc04-230">La plupart des fonctionnalités qui dépendent du site SCM sont également disponibles dans la console Kudu.</span><span class="sxs-lookup"><span data-stu-id="2dc04-230">Many of those capabilities that depend upon the SCM site are also available directly in the Kudu console.</span></span> <span data-ttu-id="2dc04-231">Vous pouvez vous y connecter directement au lieu d’utiliser le portail.</span><span class="sxs-lookup"><span data-stu-id="2dc04-231">You can connect to it directly rather than by using the portal.</span></span> <span data-ttu-id="2dc04-232">Si votre application est hébergée dans un ASE ILB, vous devez vous connecter à l’aide de vos informations d’identification de publication.</span><span class="sxs-lookup"><span data-stu-id="2dc04-232">If your app is hosted in an ILB ASE, use your publishing credentials to sign in.</span></span> <span data-ttu-id="2dc04-233">L’URL d’une application hébergée dans un ASE ILB permettant d’accéder au site SCM présente le format suivant :</span><span class="sxs-lookup"><span data-stu-id="2dc04-233">The URL to access the SCM site of an app hosted in an ILB ASE has the following format:</span></span> 

```
<appname>.scm.<domain name the ILB ASE was created with> 
```

<span data-ttu-id="2dc04-234">Si votre ASE ILB est le nom de domaine *contoso.net* et le nom de votre application est *testapp*, l’application est atteinte sur *testapp.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="2dc04-234">If your ILB ASE is the domain name *contoso.net* and your app name is *testapp*, the app is reached at *testapp.contoso.net*.</span></span> <span data-ttu-id="2dc04-235">Le site SCM qui le suit est atteinte sur *testapp.scm.contoso.net*.</span><span class="sxs-lookup"><span data-stu-id="2dc04-235">The SCM site that goes with it is reached at *testapp.scm.contoso.net*.</span></span>

### <a name="functions-and-web-jobs"></a><span data-ttu-id="2dc04-236">Fonctions et tâches web</span><span class="sxs-lookup"><span data-stu-id="2dc04-236">Functions and Web jobs</span></span> ###

<span data-ttu-id="2dc04-237">Les fonctions et tâches web varient selon le site SCM mais elles sont prises en charge pour une utilisation dans le portail, même si vos applications sont dans un ASE ILB, tant que votre navigateur peut accéder au site SCM.</span><span class="sxs-lookup"><span data-stu-id="2dc04-237">Both Functions and Web jobs depend on the SCM site but are supported for use in the portal, even if your apps are in an ILB ASE, so long as your browser can reach the SCM site.</span></span>  <span data-ttu-id="2dc04-238">Si vous utilisez un certificat auto-signé avec votre ASE ILB, vous devez activer votre navigateur pour approuver ce certificat.</span><span class="sxs-lookup"><span data-stu-id="2dc04-238">If you are using a self-signed certificate with your ILB ASE, you will need to enable your browser to trust that certificate.</span></span>  <span data-ttu-id="2dc04-239">Pour Internet Explorer ou Edge, cela signifie que le certificat doit se trouver dans le magasin d’approbations de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="2dc04-239">For IE and Edge that means the certificate has to be in the computer trust store.</span></span>  <span data-ttu-id="2dc04-240">Si vous utilisez Chrome, cela signifie que vous avez préalablement accepté le certificat dans le navigateur, vraisemblablement en appuyant directement sur le site SCM.</span><span class="sxs-lookup"><span data-stu-id="2dc04-240">If you are using Chrome then that means you accepted the certificate in the browser earlier by presumably hitting the scm site directly.</span></span>  <span data-ttu-id="2dc04-241">La meilleure solution consiste à utiliser un certificat commercial qui se trouve dans la chaîne d’approbation du navigateur.</span><span class="sxs-lookup"><span data-stu-id="2dc04-241">The best solution is to use a commercial certificate that is in the browser chain of trust.</span></span>  

## <a name="ase-ip-addresses"></a><span data-ttu-id="2dc04-242">Adresses IP d’un ASE</span><span class="sxs-lookup"><span data-stu-id="2dc04-242">ASE IP addresses</span></span> ##

<span data-ttu-id="2dc04-243">Un ASE présente quelques adresses IP qu’il est important de connaître.</span><span class="sxs-lookup"><span data-stu-id="2dc04-243">An ASE has a few IP addresses to be aware of.</span></span> <span data-ttu-id="2dc04-244">Il s'agit de :</span><span class="sxs-lookup"><span data-stu-id="2dc04-244">They are:</span></span>

- <span data-ttu-id="2dc04-245">**Adresse IP entrante publique** : utilisée pour le trafic d’applications dans un ASE externe et pour le trafic de gestion aussi bien dans un ASE externe que dans un ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2dc04-245">**Public inbound IP address**: Used for app traffic in an External ASE, and management traffic in both an External ASE and an ILB ASE.</span></span>
- <span data-ttu-id="2dc04-246">**Adresse IP publique sortante**  : utilisée en tant qu’adresse IP source pour les connexions sortantes de l’ASE quittant le réseau virtuel, qui ne sont pas acheminées via un VPN.</span><span class="sxs-lookup"><span data-stu-id="2dc04-246">**Outbound public IP**: Used as the "from" IP for outbound connections from the ASE that leave the VNet, which aren't routed down a VPN.</span></span>
- <span data-ttu-id="2dc04-247">**Adresse IP ILB** : si vous utilisez un ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2dc04-247">**ILB IP address**: If you use an ILB ASE.</span></span>
- <span data-ttu-id="2dc04-248">**Adresse SSL basée sur IP attribuée par l’application** : uniquement possibles avec un ASE externe et lorsque le mode SSL basé sur IP est configuré.</span><span class="sxs-lookup"><span data-stu-id="2dc04-248">**App-assigned IP-based SSL addresses**: Only possible with an External ASE and when IP-based SSL is configured.</span></span>

<span data-ttu-id="2dc04-249">Toutes ces adresses IP sont facilement visibles pour un ASEv2 à partir de l’interface utilisateur de l’ASE dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="2dc04-249">All these IP addresses are easily visible in an ASEv2 in the Azure portal from the ASE UI.</span></span> <span data-ttu-id="2dc04-250">Si vous possédez un ASE ILB, l’adresse IP de l’ILB est répertoriée.</span><span class="sxs-lookup"><span data-stu-id="2dc04-250">If you have an ILB ASE, the IP for the ILB is listed.</span></span>

![Adresses IP][3]

### <a name="app-assigned-ip-addresses"></a><span data-ttu-id="2dc04-252">Adresses IP attribuées par l’application</span><span class="sxs-lookup"><span data-stu-id="2dc04-252">App-assigned IP addresses</span></span> ###

<span data-ttu-id="2dc04-253">Avec un ASE externe, vous pouvez assigner des adresses IP à des applications individuelles.</span><span class="sxs-lookup"><span data-stu-id="2dc04-253">With an External ASE, you can assign IP addresses to individual apps.</span></span> <span data-ttu-id="2dc04-254">Ce n’est pas possible avec un ASE ILB.</span><span class="sxs-lookup"><span data-stu-id="2dc04-254">You can't do that with an ILB ASE.</span></span> <span data-ttu-id="2dc04-255">Pour savoir comment configurer votre application de sorte qu’elle possède sa propre adresse IP, consultez [Lier un certificat SSL existant à des applications Web Azure](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span><span class="sxs-lookup"><span data-stu-id="2dc04-255">For more information on how to configure your app to have its own IP address, see [Bind an existing custom SSL certificate to Azure web apps](../../app-service-web/app-service-web-tutorial-custom-ssl.md).</span></span>

<span data-ttu-id="2dc04-256">Lorsqu’une application possède sa propre adresse SSL basée sur IP, l’ASE réserve deux ports pour le mappage à cette adresse IP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-256">When an app has its own IP-based SSL address, the ASE reserves two ports to map to that IP address.</span></span> <span data-ttu-id="2dc04-257">Un port est destiné au trafic HTTP et l’autre au trafic HTTPS.</span><span class="sxs-lookup"><span data-stu-id="2dc04-257">One port is for HTTP traffic, and the other port is for HTTPS.</span></span> <span data-ttu-id="2dc04-258">Ces ports sont répertoriés dans l’interface utilisateur de l’ASE, dans la section des adresses IP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-258">Those ports are listed in the ASE UI in the IP addresses section.</span></span> <span data-ttu-id="2dc04-259">Le trafic doit pouvoir atteindre ces ports à partir de l’adresse IP virtuelle. Sinon, les applications ne sont pas accessibles.</span><span class="sxs-lookup"><span data-stu-id="2dc04-259">Traffic must be able to reach those ports from the VIP or the apps are inaccessible.</span></span> <span data-ttu-id="2dc04-260">Il est important de ne pas oublier cela lorsque vous configurez des groupes de sécurité réseau (NSG).</span><span class="sxs-lookup"><span data-stu-id="2dc04-260">This requirement is important to remember when you configure Network Security Groups (NSGs).</span></span>

## <a name="network-security-groups"></a><span data-ttu-id="2dc04-261">Groupes de sécurité réseau</span><span class="sxs-lookup"><span data-stu-id="2dc04-261">Network Security Groups</span></span> ##

<span data-ttu-id="2dc04-262">Les [groupes de sécurité réseau][NSGs] permettent de contrôler l’accès réseau au sein d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="2dc04-262">[Network Security Groups][NSGs] provide the ability to control network access within a VNet.</span></span> <span data-ttu-id="2dc04-263">Lorsque vous utilisez le portail, il existe une règle de refus implicite au niveau de priorité le plus bas qui fait que tout accès est refusé.</span><span class="sxs-lookup"><span data-stu-id="2dc04-263">When you use the portal, there's an implicit deny rule at the lowest priority to deny everything.</span></span> <span data-ttu-id="2dc04-264">Ce que vous créez sont vos règles d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="2dc04-264">What you build are your allow rules.</span></span>

<span data-ttu-id="2dc04-265">Dans un ASE, vous n’avez pas accès aux machines virtuelles utilisées pour héberger l’ASE lui-même.</span><span class="sxs-lookup"><span data-stu-id="2dc04-265">In an ASE, you don't have access to the VMs used to host the ASE itself.</span></span> <span data-ttu-id="2dc04-266">Elles se trouvent dans un abonnement géré par Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2dc04-266">They're in a Microsoft-managed subscription.</span></span> <span data-ttu-id="2dc04-267">Si vous souhaitez restreindre l’accès aux applications dans l’ASE, définissez les groupes de sécurité réseau sur le sous-réseau de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-267">If you want to restrict access to the apps on the ASE, set NSGs on the ASE subnet.</span></span> <span data-ttu-id="2dc04-268">Ce faisant, vous devez prêter une attention particulière aux dépendances de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-268">In doing so, pay careful attention to the ASE dependencies.</span></span> <span data-ttu-id="2dc04-269">Si vous bloquez certaines dépendances, l’ASE cesse de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="2dc04-269">If you block any dependencies, the ASE stops working.</span></span>

<span data-ttu-id="2dc04-270">Les groupes de sécurité réseau peuvent être configurés à l’aide du portail Azure ou via PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2dc04-270">NSGs can be configured through the Azure portal or via PowerShell.</span></span> <span data-ttu-id="2dc04-271">Seul le portail Azure est illustré ici.</span><span class="sxs-lookup"><span data-stu-id="2dc04-271">The information here shows the Azure portal.</span></span> <span data-ttu-id="2dc04-272">Les groupes de sécurité réseau sont créés et gérés en tant que ressources de niveau supérieur dans la section **Mise en réseau** du portail.</span><span class="sxs-lookup"><span data-stu-id="2dc04-272">You create and manage NSGs in the portal as a top-level resource under **Networking**.</span></span>

<span data-ttu-id="2dc04-273">En tenant compte des exigences liées au trafic entrant et sortant, les groupes de sécurité réseau doivent se ressembler aux groupes de sécurité réseau présentés dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="2dc04-273">When the inbound and outbound requirements are taken into account, the NSGs should look similar to the NSGs shown in this example.</span></span> <span data-ttu-id="2dc04-274">La plage d’adresses du réseau virtuel est _192.168.250.0/16_ et le sous-réseau dans lequel l’ASE se trouve est _192.168.251.128/25_.</span><span class="sxs-lookup"><span data-stu-id="2dc04-274">The VNet address range is _192.168.250.0/16_, and the subnet that the ASE is in is _192.168.251.128/25_.</span></span>

<span data-ttu-id="2dc04-275">Les deux premières exigences liées au trafic entrant pour l’ASE figurent en haut de la liste dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="2dc04-275">The first two inbound requirements for the ASE to function are shown at the top of the list in this example.</span></span> <span data-ttu-id="2dc04-276">Elles permettent la gestion de l’ASE et autorisent l’ASE à communiquer avec lui-même.</span><span class="sxs-lookup"><span data-stu-id="2dc04-276">They enable ASE management and allow the ASE to communicate with itself.</span></span> <span data-ttu-id="2dc04-277">Les autres entrées sont toutes configurables par le client et peuvent régir l’accès réseau aux applications hébergées dans l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-277">The other entries are all tenant configurable and can govern network access to the ASE-hosted applications.</span></span> 

![Règles de sécurité de trafic entrant][4]

<span data-ttu-id="2dc04-279">Une règle par défaut permet la communication entre les adresses IP dans le réseau virtuel avec le sous-réseau ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-279">A default rule enables the IPs in the VNet to talk to the ASE subnet.</span></span> <span data-ttu-id="2dc04-280">Une autre règle par défaut permet la communication entre l’équilibrage de charges, également appelé l’adresse IP virtuelle publique, et l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-280">Another default rule enables the load balancer, also known as the public VIP, to communicate with the ASE.</span></span> <span data-ttu-id="2dc04-281">Vous pouvez afficher les règles par défaut en sélectionnant **Règles par défaut** en regard de l’icône **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-281">To see the default rules, select **Default rules** next to the **Add** icon.</span></span> <span data-ttu-id="2dc04-282">Si vous placez une règle de refus pour toute autre communication après les règles de groupes de sécurité réseau illustrées, vous empêchez le trafic entre l’adresse IP virtuelle et l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-282">If you put a deny everything else rule after the NSG rules shown, you prevent traffic between the VIP and the ASE.</span></span> <span data-ttu-id="2dc04-283">Pour éviter le trafic provenant de l’intérieur du réseau virtuel, ajoutez votre propre règle pour autoriser le trafic entrant.</span><span class="sxs-lookup"><span data-stu-id="2dc04-283">To prevent traffic coming from inside the VNet, add your own rule to allow inbound.</span></span> <span data-ttu-id="2dc04-284">Utilisez une source égale à AzureLoadBalancer avec une destination **Tout** et une plage de ports **\***.</span><span class="sxs-lookup"><span data-stu-id="2dc04-284">Use a source equal to AzureLoadBalancer with a destination of **Any** and a port range of **\***.</span></span> <span data-ttu-id="2dc04-285">Étant donné que la règle de groupes de sécurité réseau est appliquée au sous-réseau de l’ASE, vous n’avez pas besoin de définir une destination spécifique.</span><span class="sxs-lookup"><span data-stu-id="2dc04-285">Because the NSG rule is applied to the ASE subnet, you don't need to be specific in the destination.</span></span>

<span data-ttu-id="2dc04-286">Si vous avez attribué une adresse IP à votre application, assurez-vous que vous conservez les ports ouverts.</span><span class="sxs-lookup"><span data-stu-id="2dc04-286">If you assigned an IP address to your app, make sure you keep the ports open.</span></span> <span data-ttu-id="2dc04-287">Vous pouvez consulter les ports utilisés en sélectionnant **App Service Environment** > **Adresses IP**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-287">To see the ports, select **App Service Environment** > **IP addresses**.</span></span>  

<span data-ttu-id="2dc04-288">Tous les éléments affichés dans les règles de trafic sortant suivants sont nécessaires, à l’exception du dernier élément.</span><span class="sxs-lookup"><span data-stu-id="2dc04-288">All the items shown in the following outbound rules are needed, except for the last item.</span></span> <span data-ttu-id="2dc04-289">Ils autorisent l’accès réseau aux dépendances de l’ASE décrites plus haut dans ce document.</span><span class="sxs-lookup"><span data-stu-id="2dc04-289">They enable network access to the ASE dependencies that were noted earlier in this article.</span></span> <span data-ttu-id="2dc04-290">Si vous bloquez un d'entre eux, votre ASE cesse de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="2dc04-290">If you block any of them, your ASE stops working.</span></span> <span data-ttu-id="2dc04-291">Le dernier élément de la liste autorise votre ASE à communiquer avec les autres ressources de votre réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="2dc04-291">The last item in the list enables your ASE to communicate with other resources in your VNet.</span></span>

![Règles de sécurité de trafic entrant][5]

<span data-ttu-id="2dc04-293">Une fois vos groupes de sécurité réseau définis, vous devez les attribuer au sous-réseau dans lequel se trouve votre ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-293">After your NSGs are defined, assign them to the subnet that your ASE is on.</span></span> <span data-ttu-id="2dc04-294">Si vous ne connaissez pas le réseau virtuel ou le sous-réseau de l’ASE, vous pouvez l’afficher dans le portail de gestion de l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-294">If you don’t remember the ASE VNet or subnet, you can see it from the ASE management portal.</span></span> <span data-ttu-id="2dc04-295">Pour assigner le groupe de sécurité réseau à votre sous-réseau, accédez à l’interface utilisateur du sous-réseau et sélectionnez le groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="2dc04-295">To assign the NSG to your subnet, go to the subnet UI and select the NSG.</span></span>

## <a name="routes"></a><span data-ttu-id="2dc04-296">Itinéraires</span><span class="sxs-lookup"><span data-stu-id="2dc04-296">Routes</span></span> ##

<span data-ttu-id="2dc04-297">Les itinéraires posent le plus souvent problème lorsque vous configurez votre réseau virtuel avec Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2dc04-297">Routes become problematic most commonly when you configure your VNet with Azure ExpressRoute.</span></span> <span data-ttu-id="2dc04-298">Il existe trois types d’itinéraires dans un réseau virtuel :</span><span class="sxs-lookup"><span data-stu-id="2dc04-298">There are three types of routes in a VNet:</span></span>

-   <span data-ttu-id="2dc04-299">Itinéraires système</span><span class="sxs-lookup"><span data-stu-id="2dc04-299">System routes</span></span>
-   <span data-ttu-id="2dc04-300">Itinéraires BGP</span><span class="sxs-lookup"><span data-stu-id="2dc04-300">BGP routes</span></span>
-   <span data-ttu-id="2dc04-301">Itinéraires définis par l’utilisateur (UDR)</span><span class="sxs-lookup"><span data-stu-id="2dc04-301">User-defined routes (UDRs)</span></span>

<span data-ttu-id="2dc04-302">Les itinéraires BGP prennent le pas sur les itinéraires système.</span><span class="sxs-lookup"><span data-stu-id="2dc04-302">BGP routes override system routes.</span></span> <span data-ttu-id="2dc04-303">Les UDR prennent le pas sur les itinéraires BGP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-303">UDRs override BGP routes.</span></span> <span data-ttu-id="2dc04-304">Pour plus d’informations sur les itinéraires dans les réseaux virtuels Azure, consultez [Présentation des itinéraires définis par l’utilisateur][UDRs].</span><span class="sxs-lookup"><span data-stu-id="2dc04-304">For more information about routes in Azure virtual networks, see [User-defined routes overview][UDRs].</span></span>

<span data-ttu-id="2dc04-305">La base de données SQL Azure qu’utilise l’ASE pour gérer le système dispose d’un pare-feu.</span><span class="sxs-lookup"><span data-stu-id="2dc04-305">The Azure SQL database that the ASE uses to manage the system has a firewall.</span></span> <span data-ttu-id="2dc04-306">Il requiert une communication provenant de l’adresse IP virtuelle publique ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-306">It requires communication to originate from the ASE public VIP.</span></span> <span data-ttu-id="2dc04-307">Les connexions à la base de données SQL à partir de l’ASE sont refusées si elles sont envoyées via la connexion ExpressRoute et depuis une autre adresse IP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-307">Connections to the SQL database from the ASE will be denied if they are sent down the ExpressRoute connection and out another IP address.</span></span>

<span data-ttu-id="2dc04-308">Si les réponses aux requêtes de gestion entrantes sont envoyées via le circuit ExpressRoute, l’adresse de réponse est différente de celle de destination.</span><span class="sxs-lookup"><span data-stu-id="2dc04-308">If replies to incoming management requests are sent down the ExpressRoute, the reply address is different than the original destination.</span></span> <span data-ttu-id="2dc04-309">Cette incohérence interrompt la communication TCP.</span><span class="sxs-lookup"><span data-stu-id="2dc04-309">This mismatch breaks the TCP communication.</span></span>

<span data-ttu-id="2dc04-310">Pour que votre ASE fonctionne lorsque votre réseau virtuel est configuré avec un circuit ExpressRoute, le plus simple consiste à :</span><span class="sxs-lookup"><span data-stu-id="2dc04-310">For your ASE to work while your VNet is configured with an ExpressRoute, the easiest thing to do is:</span></span>

-   <span data-ttu-id="2dc04-311">Configurer ExpressRoute pour qu’il publie _0.0.0.0/0_.</span><span class="sxs-lookup"><span data-stu-id="2dc04-311">Configure ExpressRoute to advertise _0.0.0.0/0_.</span></span> <span data-ttu-id="2dc04-312">Par défaut, il tunnélise de force tout le trafic sortant local.</span><span class="sxs-lookup"><span data-stu-id="2dc04-312">By default, it force tunnels all outbound traffic on-premises.</span></span>
-   <span data-ttu-id="2dc04-313">Créer un UDR.</span><span class="sxs-lookup"><span data-stu-id="2dc04-313">Create a UDR.</span></span> <span data-ttu-id="2dc04-314">Appliquez l’UDR au sous-réseau qui contient l’ASE, avec le préfixe d’adresse _0.0.0.0/0_ et le type de tronçon suivant _Internet_.</span><span class="sxs-lookup"><span data-stu-id="2dc04-314">Apply it to the subnet that contains the ASE with an address prefix of _0.0.0.0/0_ and a next hop type of _Internet_.</span></span>

<span data-ttu-id="2dc04-315">Si vous apportez ces deux modifications, le trafic à destination d’Internet provenant du sous-réseau de l’ASE n’est plus acheminé de force via le circuit ExpressRoute et l’ASE peut fonctionner.</span><span class="sxs-lookup"><span data-stu-id="2dc04-315">If you make these two changes, internet-destined traffic that originates from the ASE subnet isn't forced down the ExpressRoute and the ASE works.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="2dc04-316">Les itinéraires définis dans un UDR doivent être suffisamment spécifiques pour avoir la priorité sur les itinéraires annoncés par la configuration ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2dc04-316">The routes defined in a UDR must be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="2dc04-317">L’exemple précédent utilise la plage d’adresses 0.0.0.0/0 large.</span><span class="sxs-lookup"><span data-stu-id="2dc04-317">The preceding example uses the broad 0.0.0.0/0 address range.</span></span> <span data-ttu-id="2dc04-318">Il peut potentiellement être remplacé accidentellement par des annonces de routage utilisant des plages d’adresses plus spécifiques.</span><span class="sxs-lookup"><span data-stu-id="2dc04-318">It can potentially be accidentally overridden by route advertisements that use more specific address ranges.</span></span>
>
> <span data-ttu-id="2dc04-319">Les ASE ne sont pas pris en charge avec les configurations ExpressRoute qui annoncent de façon croisée des itinéraires à partir du chemin d’accès d’homologation publique vers le chemin d’accès d’homologation privée.</span><span class="sxs-lookup"><span data-stu-id="2dc04-319">ASEs aren't supported with ExpressRoute configurations that cross-advertise routes from the public-peering path to the private-peering path.</span></span> <span data-ttu-id="2dc04-320">Les configurations ExpressRoute ayant une homologation publique configurée reçoivent les publications de routage de Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2dc04-320">ExpressRoute configurations with public peering configured receive route advertisements from Microsoft.</span></span> <span data-ttu-id="2dc04-321">Les publications contiennent un grand ensemble de plages d’adresses IP de Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="2dc04-321">The advertisements contain a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="2dc04-322">Si ces plages d’adresses sont publiées de façon croisée sur le chemin d’accès d’homologation privée, il en résulte que tous les paquets réseau sortants du sous-réseau de l’environnement App Service sont tunnélisés de force vers l’infrastructure réseau local d’un client.</span><span class="sxs-lookup"><span data-stu-id="2dc04-322">If the address ranges are cross-advertised on the private-peering path, all outbound network packets from the ASE's subnet are force tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="2dc04-323">Ce flux de réseau n’est actuellement pas pris en charge par les environnements App Service.</span><span class="sxs-lookup"><span data-stu-id="2dc04-323">This network flow is currently not supported with ASEs.</span></span> <span data-ttu-id="2dc04-324">L’une des solutions à ce problème consiste à arrêter les itinéraires croisés depuis le chemin d’accès d’homologation publique vers le chemin d’accès d’homologation privée.</span><span class="sxs-lookup"><span data-stu-id="2dc04-324">One solution to this problem is to stop cross-advertising routes from the public-peering path to the private-peering path.</span></span>

<span data-ttu-id="2dc04-325">Pour créer un UDR, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="2dc04-325">To create a UDR, follow these steps:</span></span>

1. <span data-ttu-id="2dc04-326">Accédez au portail Azure.</span><span class="sxs-lookup"><span data-stu-id="2dc04-326">Go to the Azure portal.</span></span> <span data-ttu-id="2dc04-327">Sélectionnez **Mise en réseau** > **Tables d’itinéraires**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-327">Select **Networking** > **Route Tables**.</span></span>

2. <span data-ttu-id="2dc04-328">Créez une nouvelle table d’itinéraires dans la même région que votre réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="2dc04-328">Create a new route table in the same region as your VNet.</span></span>

3. <span data-ttu-id="2dc04-329">À partir de l’interface utilisateur de votre table d’itinéraires, sélectionnez **Itinéraires** > **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-329">From within your route table UI, select **Routes** > **Add**.</span></span>

4. <span data-ttu-id="2dc04-330">Définissez le **Type de tronçon suivant** sur **Internet** et **Préfixe de l’adresse** sur **0.0.0.0/0**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-330">Set the **Next hop type** to **Internet** and the **Address prefix** to **0.0.0.0/0**.</span></span> <span data-ttu-id="2dc04-331">Sélectionnez **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="2dc04-331">Select **Save**.</span></span>

    <span data-ttu-id="2dc04-332">Le résultat suivant s’affiche :</span><span class="sxs-lookup"><span data-stu-id="2dc04-332">You then see something like the following:</span></span>

    ![Itinéraires fonctionnels][6]

5. <span data-ttu-id="2dc04-334">Après avoir créé la nouvelle table d’itinéraires, accédez au sous-réseau contenant votre ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-334">After you create the new route table, go to the subnet that contains your ASE.</span></span> <span data-ttu-id="2dc04-335">Dans la liste du portail, sélectionnez votre table d’itinéraires.</span><span class="sxs-lookup"><span data-stu-id="2dc04-335">Select your route table from the list in the portal.</span></span> <span data-ttu-id="2dc04-336">Une fois la modification enregistrée, les groupes de sécurité réseau et les itinéraires s’affichent dans les informations de votre sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="2dc04-336">After you save the change, you should then see the NSGs and routes noted with your subnet.</span></span>

    ![Itinéraires et groupes de sécurité réseau][7]

### <a name="deploy-into-existing-azure-virtual-networks-that-are-integrated-with-expressroute"></a><span data-ttu-id="2dc04-338">Déploiement dans des réseaux virtuels Azure existants intégrés à ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="2dc04-338">Deploy into existing Azure virtual networks that are integrated with ExpressRoute</span></span> ###

<span data-ttu-id="2dc04-339">Pour déployer votre ASE dans un réseau virtuel intégré à ExpressRoute, préconfigurez le sous-réseau dans lequel vous souhaitez que l’ASE soit déployé.</span><span class="sxs-lookup"><span data-stu-id="2dc04-339">To deploy your ASE into a VNet that's integrated with ExpressRoute, preconfigure the subnet where you want the ASE deployed.</span></span> <span data-ttu-id="2dc04-340">Utilisez alors un modèle Resource Manager pour le déployer.</span><span class="sxs-lookup"><span data-stu-id="2dc04-340">Then use a Resource Manager template to deploy it.</span></span> <span data-ttu-id="2dc04-341">Pour créer un ASE dans un réseau virtuel pour lequel ExpressRoute est déjà configuré :</span><span class="sxs-lookup"><span data-stu-id="2dc04-341">To create an ASE in a VNet that already has ExpressRoute configured:</span></span>

- <span data-ttu-id="2dc04-342">Créez un sous-réseau pour héberger l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-342">Create a subnet to host the ASE.</span></span>

    > [!NOTE]
    > <span data-ttu-id="2dc04-343">Le sous-réseau doit contenir uniquement l’ASE.</span><span class="sxs-lookup"><span data-stu-id="2dc04-343">Nothing else can be in the subnet but the ASE.</span></span> <span data-ttu-id="2dc04-344">Veillez à choisir un espace d’adressage qui permet une croissance future.</span><span class="sxs-lookup"><span data-stu-id="2dc04-344">Be sure to choose an address space that allows for future growth.</span></span> <span data-ttu-id="2dc04-345">Vous ne pouvez pas modifier ce paramètre par la suite.</span><span class="sxs-lookup"><span data-stu-id="2dc04-345">You can't change this setting later.</span></span> <span data-ttu-id="2dc04-346">Nous vous recommandons une taille de `/25` avec 128 adresses.</span><span class="sxs-lookup"><span data-stu-id="2dc04-346">We recommend a size of `/25` with 128 addresses.</span></span>

- <span data-ttu-id="2dc04-347">Créez des UDR (par exemple des tables d’itinéraires) en suivant la procédure décrite précédemment et définissez-les sur le sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="2dc04-347">Create UDRs (for example, route tables) as described earlier, and set that on the subnet.</span></span>
- <span data-ttu-id="2dc04-348">Créez l’ASE à l’aide d’un modèle Resource Manager en suivant la procédure décrite dans [Création d’un ASE à l’aide d’un modèle ARM][MakeASEfromTemplate].</span><span class="sxs-lookup"><span data-stu-id="2dc04-348">Create the ASE by using a Resource Manager template as described in [Create an ASE by using a Resource Manager template][MakeASEfromTemplate].</span></span>

<!--Image references-->
[1]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow.png
[2]: ./media/network_considerations_with_an_app_service_environment/networkase-overflow2.png
[3]: ./media/network_considerations_with_an_app_service_environment/networkase-ipaddresses.png
[4]: ./media/network_considerations_with_an_app_service_environment/networkase-inboundnsg.png
[5]: ./media/network_considerations_with_an_app_service_environment/networkase-outboundnsg.png
[6]: ./media/network_considerations_with_an_app_service_environment/networkase-udr.png
[7]: ./media/network_considerations_with_an_app_service_environment/networkase-subnet.png

<!--Links-->
[Intro]: ./intro.md
[MakeExternalASE]: ./create-external-ase.md
[MakeASEfromTemplate]: ./create-from-template.md
[MakeILBASE]: ./create-ilb-ase.md
[ASENetwork]: ./network-info.md
[ASEReadme]: ./readme.md
[UsingASE]: ./using-an-ase.md
[UDRs]: ../../virtual-network/virtual-networks-udr-overview.md
[NSGs]: ../../virtual-network/virtual-networks-nsg.md
[ConfigureASEv1]: ../../app-service-web/app-service-web-configure-an-app-service-environment.md
[ASEv1Intro]: ../../app-service-web/app-service-app-service-environment-intro.md
[webapps]: ../../app-service-web/app-service-web-overview.md
[mobileapps]: ../../app-service-mobile/app-service-mobile-value-prop.md
[APIapps]: ../../app-service-api/app-service-api-apps-why-best-platform.md
[Functions]: ../../azure-functions/index.yml
[Pricing]: http://azure.microsoft.com/pricing/details/app-service/
[ARMOverview]: ../../azure-resource-manager/resource-group-overview.md
[ConfigureSSL]: ../../app-service-web/web-sites-purchase-ssl-web-site.md
[Kudu]: http://azure.microsoft.com/resources/videos/super-secret-kudu-debug-console-for-azure-web-sites/
[AppDeploy]: ../../app-service-web/web-sites-deploy.md
[ASEWAF]: ../../app-service-web/app-service-app-service-environment-web-application-firewall.md
[AppGW]: ../../application-gateway/application-gateway-web-application-firewall-overview.md
[ASEManagement]: ./management-addresses.md
