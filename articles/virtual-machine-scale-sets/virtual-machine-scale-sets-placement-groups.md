---
title: Utilisation de grands groupes de machines virtuelles identiques Azure | Microsoft Docs
description: Tout ce que vous devez savoir pour utiliser de grands groupes de machines virtuelles identiques Azure
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 76ac7fd7-2e05-4762-88ca-3b499e87906e
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 2/7/2017
ms.author: guybo
ms.openlocfilehash: 9e9eae1623e55c1c05e97aa0b836819ce5dc16f9
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="working-with-large-virtual-machine-scale-sets"></a><span data-ttu-id="f22b1-103">Utilisation de grands groupes de machines virtuelles identiques</span><span class="sxs-lookup"><span data-stu-id="f22b1-103">Working with large virtual machine scale sets</span></span>
<span data-ttu-id="f22b1-104">Vous pouvez désormais créer des [groupes de machines virtuelles identiques](/azure/virtual-machine-scale-sets/) Azure d’une capacité maximum de 1 000 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-104">You can now create Azure [virtual machine scale sets](/azure/virtual-machine-scale-sets/) with a capacity of up to 1,000 VMs.</span></span> <span data-ttu-id="f22b1-105">Dans ce document, un _grand groupe de machines virtuelles identiques_ est défini comme un groupe identique pouvant contenir plus de 100 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-105">In this document, a _large virtual machine scale set_ is defined as a scale set capable of scaling to greater than 100 VMs.</span></span> <span data-ttu-id="f22b1-106">Cette fonctionnalité est définie par une propriété de groupe identique (_singlePlacementGroup=False_).</span><span class="sxs-lookup"><span data-stu-id="f22b1-106">This capability is set by a scale set property (_singlePlacementGroup=False_).</span></span> 

<span data-ttu-id="f22b1-107">Certains aspects des grands groupes identiques, tels que les domaines d’erreur et l’équilibrage de charge se comportent différemment d’un groupe identique standard.</span><span class="sxs-lookup"><span data-stu-id="f22b1-107">Certain aspects of large scale sets, such as load balancing and fault domains behave differently to a standard scale set.</span></span> <span data-ttu-id="f22b1-108">Ce document explique les caractéristiques des grands groupes identiques et décrit ce que vous devez savoir pour les utiliser correctement dans vos applications.</span><span class="sxs-lookup"><span data-stu-id="f22b1-108">This document explains the characteristics of large scale sets, and describes what you need to know to successfully use them in your applications.</span></span> 

<span data-ttu-id="f22b1-109">Une approche commune pour le déploiement d’une infrastructure cloud à grande échelle consiste à créer un ensemble d’_unités d'échelle_, par exemple, en créant plusieurs 	groupes de machines virtuelles identiques sur plusieurs réseaux virtuels et comptes de stockage.</span><span class="sxs-lookup"><span data-stu-id="f22b1-109">A common approach for deploying cloud infrastructure at large scale is to create a set of _scale units_, for example by creating multiple VMs scale sets across multiple VNETs and storage accounts.</span></span> <span data-ttu-id="f22b1-110">Cette approche offre une gestion facilitée par rapport aux machines virtuelles uniques, et plusieurs unités d’échelle sont utiles pour de nombreuses applications, notamment celles qui nécessitent d’autres composants empilables comme plusieurs réseaux virtuels et points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="f22b1-110">This approach provides easier management compared to single VMs, and multiple scale units are useful for many applications, particularly those that require other stackable components like multiple virtual networks and endpoints.</span></span> <span data-ttu-id="f22b1-111">Toutefois, si votre application nécessite un seul cluster de grande taille, il peut être plus simple de déployer un seul groupe identique contenant jusqu’à 1 000 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-111">If your application requires a single large cluster however, it can be more straightforward to deploy a single scale set of up to 1,000 VMs.</span></span> <span data-ttu-id="f22b1-112">Des exemples de scénarios incluent des déploiements de Big Data centralisés ou des grilles de calcul nécessitant la gestion simple d’un grand pool de nœuds de travail.</span><span class="sxs-lookup"><span data-stu-id="f22b1-112">Example scenarios include centralized big data deployments, or compute grids requiring simple management of a large pool of worker nodes.</span></span> <span data-ttu-id="f22b1-113">Combinés avec [des disques de données associés](virtual-machine-scale-sets-attached-disks.md) de groupes de machines virtuelles identiques, les grands groupes identiques vous permettent de déployer une infrastructure évolutive, composée de plusieurs milliers de cœurs et de plusieurs pétaoctets de stockage, en une seule opération.</span><span class="sxs-lookup"><span data-stu-id="f22b1-113">Combined with VM scale set [attached data disks](virtual-machine-scale-sets-attached-disks.md), large scale sets enable you to deploy a scalable infrastructure consisting of thousands of cores and petabytes of storage, as a single operation.</span></span>

## <a name="placement-groups"></a><span data-ttu-id="f22b1-114">Groupes de placement</span><span class="sxs-lookup"><span data-stu-id="f22b1-114">Placement groups</span></span> 
<span data-ttu-id="f22b1-115">Ce n’est pas le nombre de machines virtuelles qui rend un _grand_ groupe identique si spécial, mais plutôt le nombre de _groupes de placement_ qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="f22b1-115">What makes a _large_ scale set special is not the number of VMs, but the number of _placement groups_ it contains.</span></span> <span data-ttu-id="f22b1-116">Un groupe de placement est une construction similaire à une haute disponibilité Azure, avec ses propres domaines d’erreur et les domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f22b1-116">A placement group is a construct similar to an Azure availability set, with its own fault domains and upgrade domains.</span></span> <span data-ttu-id="f22b1-117">Par défaut, un groupe identique se compose d’un seul groupe de placement contenant au maximum 100 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-117">By default, a scale set consists of a single placement group with a maximum size of 100 VMs.</span></span> <span data-ttu-id="f22b1-118">Si une propriété de groupe identique appelée _singlePlacementGroup_ est définie sur _false_, le groupe identique peut se composer de plusieurs groupes de placement et présente une plage de 0 à 1 000 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-118">If a scale set property called _singlePlacementGroup_ is set to _false_, the scale set can be composed of multiple placement groups and has a range of 0-1,000 VMs.</span></span> <span data-ttu-id="f22b1-119">Lorsque la valeur par défaut est définie sur _true_, un groupe identique est composé d’un seul groupe de placement et présente une plage de 0 à 100 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-119">When set to the default value of _true_, a scale set is composed of a single placement group, and has a range of 0-100 VMs.</span></span>

## <a name="checklist-for-using-large-scale-sets"></a><span data-ttu-id="f22b1-120">Liste de contrôle pour l’utilisation de grands groupes identiques</span><span class="sxs-lookup"><span data-stu-id="f22b1-120">Checklist for using large scale sets</span></span>
<span data-ttu-id="f22b1-121">Pour déterminer si votre application peut utiliser efficacement de grands groupes identiques, voici quelques points à prendre en compte :</span><span class="sxs-lookup"><span data-stu-id="f22b1-121">To decide whether your application can make effective use of large scale sets, consider the following requirements:</span></span>

- <span data-ttu-id="f22b1-122">Les grands groupes identiques requièrent Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="f22b1-122">Large scale sets require Azure Managed Disks.</span></span> <span data-ttu-id="f22b1-123">Les groupes identiques qui ne sont pas créés avec Managed Disks nécessitent plusieurs comptes de stockage (un toutes les 20 machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="f22b1-123">Scale sets that are not created with Managed Disks require multiple storage accounts (one for every 20 VMs).</span></span> <span data-ttu-id="f22b1-124">Les grands groupes identiques sont conçus pour fonctionner exclusivement avec Managed Disks afin de réduire vos frais de gestion de stockage et d’éviter tout risque d’exécution dans les limites d’abonnement des comptes de stockage.</span><span class="sxs-lookup"><span data-stu-id="f22b1-124">Large scale sets are designed to work exclusively with Managed Disks to reduce your storage management overhead, and to avoid the risk of running into subscription limits for storage accounts.</span></span> <span data-ttu-id="f22b1-125">Si vous n’utilisez pas Managed Disks, votre groupe identique est limité à 100 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-125">If you do not use Managed Disks, your scale set is limited to 100 VMs.</span></span>
- <span data-ttu-id="f22b1-126">Les groupes identiques créés à partir d’images d’Azure Marketplace peuvent monter en puissance jusqu'à 1 000 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-126">Scale sets created from Azure Marketplace images can scale up to 1,000 VMs.</span></span>
- <span data-ttu-id="f22b1-127">Les groupes identiques créés à partir d’images personnalisées (images de machine virtuelle que vous créez et téléchargez vous-même) peuvent actuellement monter en puissance jusqu'à 100 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f22b1-127">Scale sets created from custom images (VM images you create and upload yourself) can currently scale up to 100 VMs.</span></span>
- <span data-ttu-id="f22b1-128">L’équilibrage de charge de type Couche 4 avec l’équilibrage de charge Azure n’est pas encore possible pour les groupes identiques composés de plusieurs groupes de placement.</span><span class="sxs-lookup"><span data-stu-id="f22b1-128">Layer-4 load balancing with the Azure Load Balancer is not yet supported for scale sets composed of multiple placement groups.</span></span> <span data-ttu-id="f22b1-129">Si vous devez utiliser Azure Load Balancer, veillez à ce que le groupe identique soit configuré pour utiliser un seul groupe de placement, ce qui est le paramètre par défaut.</span><span class="sxs-lookup"><span data-stu-id="f22b1-129">If you need to use the Azure Load Balancer make sure the scale set is configured to use a single placement group, which is the default setting.</span></span>
- <span data-ttu-id="f22b1-130">L’équilibrage de charge de type Couche 7 avec Azure Application Gateway est pris en charge pour tous les groupes identiques.</span><span class="sxs-lookup"><span data-stu-id="f22b1-130">Layer-7 load balancing with the Azure Application Gateway is supported for all scale sets.</span></span>
- <span data-ttu-id="f22b1-131">Un groupe identique est défini avec un seul sous-réseau. Vérifiez que votre sous-réseau dispose d’un espace d’adressage suffisamment grand pour toutes les machines virtuelles requises.</span><span class="sxs-lookup"><span data-stu-id="f22b1-131">A scale set is defined with a single subnet - make sure your subnet has an address space large enough for all the VMs you need.</span></span> <span data-ttu-id="f22b1-132">Par défaut, un groupe identique surprovisionne (c’est-à-dire qu’il crée des machines virtuelles supplémentaires au moment du déploiement ou de la montée en charge pour lesquelles vous n’êtes pas facturé) afin d’améliorer les performances et la fiabilité du déploiement.</span><span class="sxs-lookup"><span data-stu-id="f22b1-132">By default a scale set overprovisions (creates extra VMs at deployment time or when scaling out, which you are not charged for) to improve deployment reliability and performance.</span></span> <span data-ttu-id="f22b1-133">Prévoyez un espace d’adressage 20 % supérieur au nombre de machines virtuelles que vous envisagez d’atteindre.</span><span class="sxs-lookup"><span data-stu-id="f22b1-133">Allow for an address space 20% greater than the number of VMs you plan to scale to.</span></span>
- <span data-ttu-id="f22b1-134">Si vous prévoyez de déployer plusieurs machines virtuelles, il ne sera peut-être pas nécessaire d’augmenter vos limites de quota de cœur de calcul.</span><span class="sxs-lookup"><span data-stu-id="f22b1-134">If you are planning to deploy many VMs, your Compute core quota limits may need to be increased.</span></span>
- <span data-ttu-id="f22b1-135">Les domaines d’erreur et de mise à niveau sont cohérents uniquement au sein d’un groupe de placement.</span><span class="sxs-lookup"><span data-stu-id="f22b1-135">Fault domains and upgrade domains are only consistent within a placement group.</span></span> <span data-ttu-id="f22b1-136">Cette architecture ne modifie pas la disponibilité globale d’un groupe identique, car les machines virtuelles sont réparties uniformément sur une infrastructure physique distincte. Toutefois, si vous avez besoin de garantir deux machines virtuelles sur des infrastructures différentes, assurez-vous qu’elles se trouvent dans des domaines d’erreur différents au sein du même groupe de placement.</span><span class="sxs-lookup"><span data-stu-id="f22b1-136">This architecture does not change the overall availability of a scale set, as VMs are evenly distributed across distinct physical hardware, but it does means that if you need to guarantee two VMs are on different hardware, make sure they are in different fault domains in the same placement group.</span></span> <span data-ttu-id="f22b1-137">Les identifiants du groupe de placement et du domaine d’erreur sont indiqués dans la _vue d’instance_ d’une machine virtuelle de groupe identique.</span><span class="sxs-lookup"><span data-stu-id="f22b1-137">Fault domain and placement group ID are shown in the _instance view_ of a scale set VM.</span></span> <span data-ttu-id="f22b1-138">Vous pouvez afficher la vue d’instance d’un groupe de machines virtuelles identiques dans [Azure Resource Explorer](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="f22b1-138">You can view the instance view of a scale set VM in the [Azure Resource Explorer](https://resources.azure.com/).</span></span>


## <a name="creating-a-large-scale-set"></a><span data-ttu-id="f22b1-139">Création d’un grand groupe identique</span><span class="sxs-lookup"><span data-stu-id="f22b1-139">Creating a large scale set</span></span>
<span data-ttu-id="f22b1-140">Lorsque vous créez un groupe identique dans le portail Azure, vous pouvez l’autoriser à prendre en charge plusieurs groupes de placement en définissant l’option _Limit to a single placement group (Limiter à un seul groupe de placement)_ sur _False_ dans le panneau _Fonctions de base_.</span><span class="sxs-lookup"><span data-stu-id="f22b1-140">When you create a scale set in the Azure portal, you can allow it to scale to multiple placement groups by setting the _Limit to a single placement group_ option to _False_ in the _Basics_ blade.</span></span> <span data-ttu-id="f22b1-141">Lorsque cette option est définie sur _False_, vous pouvez spécifier une valeur _Nombre d’instances_ de 1 000 maximum.</span><span class="sxs-lookup"><span data-stu-id="f22b1-141">With this option set to _False_, you can specify an _Instance count_ value of up to 1,000.</span></span>

![](./media/virtual-machine-scale-sets-placement-groups/portal-large-scale.png)

<span data-ttu-id="f22b1-142">Vous pouvez créer un grand groupe de machines virtuelles identiques à l’aide de la commande [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_.</span><span class="sxs-lookup"><span data-stu-id="f22b1-142">You can create a large VM scale set using the [Azure CLI](https://github.com/Azure/azure-cli) _az vmss create_ command.</span></span> <span data-ttu-id="f22b1-143">Cette commande définit des valeurs par défaut intelligentes comme la taille du sous-réseau en fonction de l’argument _instance-count_ :</span><span class="sxs-lookup"><span data-stu-id="f22b1-143">This command sets intelligent defaults such as subnet size based on the _instance-count_ argument:</span></span>

```bash
az group create -l southcentralus -n biginfra
az vmss create -g biginfra -n bigvmss --image ubuntults --instance-count 1000
```
<span data-ttu-id="f22b1-144">Notez que la commande _vmss create_ inclut par défaut des valeurs de configuration si vous ne les spécifiez pas.</span><span class="sxs-lookup"><span data-stu-id="f22b1-144">Note that the _vmss create_ command defaults certain configuration values if you do not specify them.</span></span> <span data-ttu-id="f22b1-145">Pour voir les options disponibles que vous pouvez remplacer, essayez :</span><span class="sxs-lookup"><span data-stu-id="f22b1-145">To see the available options that you can override, try:</span></span>
```bash
az vmss create --help
```

<span data-ttu-id="f22b1-146">Si vous créez un grand groupe identique en composant un modèle Azure Resource Manager, assurez-vous que le modèle crée un groupe identique basé sur Azure Managed Disks.</span><span class="sxs-lookup"><span data-stu-id="f22b1-146">If you are creating a large scale set by composing an Azure Resource Manager template, make sure the template creates a scale set based on Azure Managed Disks.</span></span> <span data-ttu-id="f22b1-147">Vous pouvez définir la propriété _singlePlacementGroup_ sur _false_ dans la section _propriétés_ de la ressource _Microsoft.Compute/virtualMAchineScaleSets_.</span><span class="sxs-lookup"><span data-stu-id="f22b1-147">You can set the _singlePlacementGroup_ property to _false_ in the _properties_ section of the _Microsoft.Compute/virtualMAchineScaleSets_ resource.</span></span> <span data-ttu-id="f22b1-148">Le fragment JSON suivant présente le début d’un modèle de groupe identique, y compris la capacité de 1 000 machines virtuelles et le paramètre _"singlePlacementGroup" : false_ :</span><span class="sxs-lookup"><span data-stu-id="f22b1-148">The following JSON fragment shows the beginning of a scale set template, including the 1,000 VM capacity and the _"singlePlacementGroup" : false_ setting:</span></span>
```json
{
  "type": "Microsoft.Compute/virtualMachineScaleSets",
  "location": "australiaeast",
  "name": "bigvmss",
  "sku": {
    "name": "Standard_DS1_v2",
    "tier": "Standard",
    "capacity": 1000
  },
  "properties": {
    "singlePlacementGroup": false,
    "upgradePolicy": {
      "mode": "Automatic"
    }
```
<span data-ttu-id="f22b1-149">Pour obtenir un exemple complet d’un modèle de grand groupe identique, reportez-vous à [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span><span class="sxs-lookup"><span data-stu-id="f22b1-149">For a complete example of a large scale set template, refer to [https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json](https://github.com/gbowerman/azure-myriad/blob/master/bigtest/bigbottle.json).</span></span>

## <a name="converting-an-existing-scale-set-to-span-multiple-placement-groups"></a><span data-ttu-id="f22b1-150">Conversion d’un groupe identique existant afin qu’il couvre plusieurs groupes de placement</span><span class="sxs-lookup"><span data-stu-id="f22b1-150">Converting an existing scale set to span multiple placement groups</span></span>
<span data-ttu-id="f22b1-151">Pour faire en sorte qu’un groupe de machines virtuelles identiques existant puisse prendre en charge plus de 100 machines virtuelles, vous devez modifier la propriété _singlePlacementGroup_ sur _false_ dans le modèle de groupe identique.</span><span class="sxs-lookup"><span data-stu-id="f22b1-151">To make an existing VM scale set capable of scaling to more than 100 VMs, you need to change the _singplePlacementGroup_ property to _false_ in the scale set model.</span></span> <span data-ttu-id="f22b1-152">Vous pouvez tester la modification de cette propriété avec [Azure Resource Explorer](https://resources.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="f22b1-152">You can test changing this property with the [Azure Resource Explorer](https://resources.azure.com/).</span></span> <span data-ttu-id="f22b1-153">Pour rechercher un groupe identique existant, sélectionnez _Modifier_ et modifiez la propriété _singlePlacementGroup_.</span><span class="sxs-lookup"><span data-stu-id="f22b1-153">Find an existing scale set, select _Edit_ and change the _singlePlacementGroup_ property.</span></span> <span data-ttu-id="f22b1-154">Si vous ne voyez pas cette propriété, c’est peut-être parce que vous visionnez le groupe identique avec une version antérieure de l’API Microsoft.Compute.</span><span class="sxs-lookup"><span data-stu-id="f22b1-154">If you do not see this property, you may be viewing the scale set with an older version of the Microsoft.Compute API.</span></span>

>[!NOTE] 
<span data-ttu-id="f22b1-155">Vous pouvez modifier un groupe identique afin qu’il prenne en charge plusieurs groupes de placement au lieu d’un seul (le comportement par défaut), mais l’inverse n’est pas possible.</span><span class="sxs-lookup"><span data-stu-id="f22b1-155">You can change a scale set from supporting a single placement group only (the default behavior) to a supporting multiple placement groups, but you cannot convert the other way around.</span></span> <span data-ttu-id="f22b1-156">Par conséquent, assurez-vous de bien comprendre les propriétés des grands groupes identiques avant de procéder à la conversion.</span><span class="sxs-lookup"><span data-stu-id="f22b1-156">Therefore make sure you understand the properties of large scale sets before converting.</span></span> <span data-ttu-id="f22b1-157">En particulier, assurez-vous de ne pas avoir besoin d’un équilibrage de charge de type Couche 4 avec Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="f22b1-157">In particular, make sure you do not need layer-4 load balancing with the Azure Load Balancer.</span></span>


