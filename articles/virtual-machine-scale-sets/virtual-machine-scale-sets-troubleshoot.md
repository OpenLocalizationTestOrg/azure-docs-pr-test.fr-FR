---
title: "mise à l’échelle d’aaaTroubleshoot avec des machines virtuelles identiques | Documents Microsoft"
description: "Dépanner la mise à l’échelle automatique avec des jeux de mise à l’échelle de machine virtuelle Comprendre les problèmes courants rencontrés et comment tooresolve les."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="d8b7b-104">Dépannage de la mise à l’échelle automatique avec des jeux de mise à l’échelle de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="d8b7b-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="d8b7b-105">**Problème** : vous avez créé une infrastructure de l’échelle automatique dans Azure Resource Manager à l’aide de jeux de mise à l’échelle de machine virtuelle – par exemple par le déploiement d’un modèle comme suit : https://github.com/Azure/azure-quickstart-templates/tree/master/201- mise d’eau échelle – que vous avez vos règles de mise à l’échelle définies, et il fonctionne très bien, sauf que, quel que soit la quantité de charge vous placer sur hello machines virtuelles, il ne sera pas mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="d8b7b-106">Étapes de dépannage</span><span class="sxs-lookup"><span data-stu-id="d8b7b-106">Troubleshooting steps</span></span>
<span data-ttu-id="d8b7b-107">Tooconsider de certains éléments sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="d8b7b-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="d8b7b-108">Nombre de noyaux chaque machine virtuelle et vous chargez chaque cœur ? modèle de démarrage rapide d’Azure exemple Hello ci-dessus dispose d’un script de do_work.php, ce qui charge un seul cœur.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="d8b7b-109">Si vous utilisez une machine virtuelle supérieure à un seul cœur de taille de machine virtuelle comme Standard_A1 ou D1, vous devez toorun cette charge plusieurs fois.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="d8b7b-110">Vérifiez le nombre de cœurs de vos machines virtuelles en consultant [Tailles des machines virtuelles Windows dans Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="d8b7b-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="d8b7b-111">Le nombre de machines virtuelles dans hello ensemble d’échelle de machine virtuelle, vous effectuez travail sur chacun d’eux ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="d8b7b-112">Une montée en charge l’événement a lieu uniquement lorsque hello moyenne du processeur sur **tous les** hello machines virtuelles dans un ensemble d’échelle dépasse hello valeur de seuil, au fil du temps hello internes défini dans les règles de mise à l’échelle hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="d8b7b-113">Vous avez manqué un événement de mise à l’échelle ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="d8b7b-114">Vérifiez les journaux de d’audit de hello Bonjour portail Azure pour les événements de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="d8b7b-115">Peut-être qu’une mise à l’échelle vers le haut ou vers le bas a été ignorée.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="d8b7b-116">Vous pouvez filtrer sur « Mise à l’échelle ».</span><span class="sxs-lookup"><span data-stu-id="d8b7b-116">You can filter by “Scale”..</span></span>
  
    ![Journaux d’audit][audit]
* <span data-ttu-id="d8b7b-118">Les seuils d’augmentation et de diminution de la taille des instances sont-ils suffisamment différents ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="d8b7b-119">Supposons que vous définir un tooscale règle out lorsque l’UC moyenne est supérieure à 50 % plus de 5 minutes et tooscale dans lorsque la moyenne du processeur est inférieure à 50 %.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="d8b7b-120">Cela entraînerait un problème « battements » lors de l’utilisation du processeur est le seuil de fermer toothis, avec des actions de mise à l’échelle en permanence l’augmentation et diminution hello taille du jeu de hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="d8b7b-121">Pour cette raison, hello mise à l’échelle le service tente tooprevent « bagottement », ce qui peut se manifester par ne pas mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="d8b7b-122">Par conséquent, assurez-vous que votre montée en puissance parallèle et seuils d’échelle sont tooallow assez différent de l’espace entre la mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="d8b7b-123">Avez-vous écrit votre propre modèle JSON ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="d8b7b-124">Il est facile de toomake erreurs, par conséquent, démarrer avec un modèle comme hello celle ci-dessus qui s’avère toowork et apporter les modifications incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="d8b7b-125">Pouvez vous procéder manuellement à une augmentation ou à une diminution de la taille des instances ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="d8b7b-126">Essayez de redéploiement hello ensemble d’échelle de machine virtuelle de ressource avec un autre « capacity » définition toochange hello du nombre de machines virtuelles manuellement.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="d8b7b-127">Un toodo de modèle exemple il s’agit ici : https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – vous devrez peut-être tooedit hello modèle toomake qu’elle a hello même de taille de l’ordinateur qu’utilise votre ensemble d’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="d8b7b-128">Si vous pouvez modifier correctement manuellement de nombre hello d’ordinateurs virtuels, vous savez que problème de hello est tooautoscale isolé.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="d8b7b-129">Vérifiez votre Microsoft.Compute/virtualMachineScaleSet et les ressources Microsoft.Insights hello [Explorateur de ressources Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="d8b7b-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="d8b7b-130">Il s’agit d’une indispensable outil qui vous indique de dépannage hello l’état de vos ressources Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="d8b7b-131">Cliquez sur votre abonnement et examinez hello groupe de ressources de dépannage.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="d8b7b-132">Sous le fournisseur de ressources de calcul hello examiner hello ensemble d’échelle de machine virtuelle vous avez créé et vérifier hello vue d’Instance, qui vous indique l’état d’un déploiement de hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="d8b7b-133">Vérifiez également la vue d’instance hello de machines virtuelles dans hello ensemble d’échelle de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="d8b7b-134">Aller dans le fournisseur de ressources Microsoft.Insights hello, puis vérifiez les règles de mise à l’échelle hello bonnes.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="d8b7b-135">Hello extension Diagnostic fonctionne et l’émission de données de performances ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="d8b7b-136">**Mise à jour :** échelle automatique Azure a été améliorée toouse un ordinateur hôte en fonction de pipeline de mesures qui ne requiert plus un toobe d’extension de diagnostics installé.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="d8b7b-137">Cela signifie hello prochains paragraphes ne s’appliquent plus si vous créez une application de l’échelle automatique à l’aide du nouveau pipeline de hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="d8b7b-138">Est un exemple de modèles Azure auxquels ont été pipeline d’hôte toouse converti hello : https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="d8b7b-139">À l’aide de mesures de l’ordinateur hôte en fonction de mise à l’échelle est préférable pour hello suivant raisons :</span><span class="sxs-lookup"><span data-stu-id="d8b7b-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="d8b7b-140">Moins de pièces mobiles en tant qu’aucune extension de diagnostics doivent toobe installé.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="d8b7b-141">Les modèles sont plus simples.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-141">Simpler templates.</span></span> <span data-ttu-id="d8b7b-142">Ajoutez simplement le modèle de jeu d’insights échelle règles tooan existante mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="d8b7b-143">Reporting plus fiable et lancement plus rapide de nouvelles machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="d8b7b-144">Hello uniquement les raisons souhaité à l’aide d’une extension de diagnostic de tookeep serait si vous avez besoin de mémoire diagnostics reporting/mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="d8b7b-145">Les mesures basées sur l’hôte ne génèrent aucun rapport sur la mémoire.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="d8b7b-146">Dans cette optique, seulement suivez hello cet article si vous utilisez toujours des extensions de diagnostic pour votre échelle.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="d8b7b-147">Mise à l’échelle dans Azure Resource Manager peut fonctionner (mais n’a plus à) au moyen d’une extension de machine virtuelle appelée hello Extension des Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="d8b7b-148">Il émet un compte de stockage performances données tooa que vous définissez dans le modèle de hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="d8b7b-149">Ces données sont agrégées puis par service du moniteur de Windows Azure hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="d8b7b-150">Si hello service Insights ne peut pas lire les données à partir de machines virtuelles de hello, il est supposé toosend un message électronique, par exemple, si les machines virtuelles de hello ont été vers le bas, vérifiez votre adresse de messagerie (hello une vous avez spécifié lors de la création de hello compte Azure).</span><span class="sxs-lookup"><span data-stu-id="d8b7b-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="d8b7b-151">Vous pouvez également et consulter les données de hello vous-même.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="d8b7b-152">Examinez hello compte de stockage Azure à l’aide d’un Explorateur de cloud.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="d8b7b-153">Par exemple à l’aide de hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), connectez-vous et choisissez hello abonnement Azure que vous utilisez, et hello compte de stockage de Diagnostics nom référencé dans hello définition d’extension de Diagnostics dans votre déploiement modèle...</span><span class="sxs-lookup"><span data-stu-id="d8b7b-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Cloud Explorer][explorer]
    
    <span data-ttu-id="d8b7b-155">Ici, vous verrez un certain nombre de tables où les données hello à partir de chaque ordinateur virtuel sont stockées.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="d8b7b-156">Prenant Linux et hello métrique de l’UC par exemple, examinez de lignes les plus récentes hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="d8b7b-157">Hello Visual Studio cloud explorer prend en charge un langage de requête afin de pouvoir exécuter une requête semblable à « Timestamp gt datetime'2016-02-02T21:20:00Z » « toomake que vous obtenez les événements les plus récents hello (à supposer que heure est au format UTC).</span><span class="sxs-lookup"><span data-stu-id="d8b7b-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="d8b7b-158">Données hello que vous voyez dans il correspondent toohello évolue des règles définies ?</span><span class="sxs-lookup"><span data-stu-id="d8b7b-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="d8b7b-159">Dans l’exemple hello ci-dessous, hello du processeur pour l’ordinateur 20 démarrée augmente de too100 % dans hello 5 dernières minutes...</span><span class="sxs-lookup"><span data-stu-id="d8b7b-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Tables de stockage][tables]
    
    <span data-ttu-id="d8b7b-161">Si les données de salutation n’y ne figurent pas, il implique des problème de hello est avec extension de diagnostic hello en hello machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="d8b7b-162">Si les données de salutation n’y figure, il implique soit un problème avec vos règles de mise à l’échelle ou service de Insights hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="d8b7b-163">Vérifiez le [statut Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="d8b7b-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="d8b7b-164">Une fois que vous avez effectué ces étapes, si vous rencontrez toujours des problèmes de mise à l’échelle, vous pouvez essayer les forums hello [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), ou [débordement de pile](http://stackoverflow.com/questions/tagged/azure), ou un journal d’un appel de la prise en charge.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="d8b7b-165">Être modèle hello de tooshare préparée et une vue des données de performances hello.</span><span class="sxs-lookup"><span data-stu-id="d8b7b-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png
