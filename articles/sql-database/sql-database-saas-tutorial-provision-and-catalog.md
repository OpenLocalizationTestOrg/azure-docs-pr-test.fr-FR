---
title: "aaaProvision de nouveaux clients dans une application mutualisée qui utilise la base de données SQL Azure | Documents Microsoft"
description: "Découvrez comment tooprovision et catalogue nouveaux locataires dans hello application Wingtip SaaS"
keywords: "didacticiel sur les bases de données SQL"
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="fb445-104">Configurer les nouveaux clients et les enregistrer dans le catalogue de hello</span><span class="sxs-lookup"><span data-stu-id="fb445-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="fb445-105">Dans ce didacticiel, vous en savoir plus sur la fourniture de hello et catalogue SaaS modèles, et comment ils sont implémentés dans hello application Wingtip SaaS.</span><span class="sxs-lookup"><span data-stu-id="fb445-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="fb445-106">Vous créez et initialisez les nouvelles bases de données client et les enregistrez dans le catalogue de client de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="fb445-107">catalogue de Hello est une base de données qui maintient le mappage hello entre nombreux clients de l’application hello SaaS et de leurs données.</span><span class="sxs-lookup"><span data-stu-id="fb445-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="fb445-108">catalogue de Hello joue un rôle d’important dirigeant application demandes toohello bonne base de données.</span><span class="sxs-lookup"><span data-stu-id="fb445-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="fb445-109">Ce didacticiel vous montre comment effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="fb445-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="fb445-110">Approvisionner un nouveau client unique et découvrir comment il est implémenté</span><span class="sxs-lookup"><span data-stu-id="fb445-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="fb445-111">Approvisionner un lot de locataires supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fb445-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="fb445-112">toocomplete ce didacticiel, assurez-vous que hello est suivant des conditions préalables requises sont effectuées :</span><span class="sxs-lookup"><span data-stu-id="fb445-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="fb445-113">Hello Wingtip SaaS application est déployée.</span><span class="sxs-lookup"><span data-stu-id="fb445-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="fb445-114">toodeploy en moins de cinq minutes, consultez [déployer et Explorer hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="fb445-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="fb445-115">Azure PowerShell est installé.</span><span class="sxs-lookup"><span data-stu-id="fb445-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="fb445-116">Pour plus d’informations, consultez [Bien démarrer avec Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="fb445-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="fb445-117">Introduction toohello modèle de catalogue de SaaS</span><span class="sxs-lookup"><span data-stu-id="fb445-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="fb445-118">Dans une application reposant sur la base de données de SaaS mutualisée, il est important tooknow où sont stockées les informations pour chaque client.</span><span class="sxs-lookup"><span data-stu-id="fb445-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="fb445-119">Dans le modèle de catalogue hello SaaS, une base de données de catalogue est utilisé toohold hello et de mappage entre chaque client où leurs données sont stockées.</span><span class="sxs-lookup"><span data-stu-id="fb445-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="fb445-120">Hello Wingtip SaaS application utilise un locataire unique par l’architecture de base de données, mais le modèle de base hello de stocker le mappage de locataire à base de données dans un catalogue s’applique si une base de données de l’architecture mutualisée ou locataire unique est utilisé.</span><span class="sxs-lookup"><span data-stu-id="fb445-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="fb445-121">Chaque client est attribué à une clé qui identifie les dans le catalogue de hello et qui est mappé à emplacement toohello de base de données appropriée hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="fb445-122">Dans l’application de Wingtip SaaS hello, clé de hello est formé à partir d’un hachage du nom du locataire hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="fb445-123">Cela permet de partie de nom de client hello de hello application URL toobe utilisés clé de hello tooconstruct.</span><span class="sxs-lookup"><span data-stu-id="fb445-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="fb445-124">D’autres schémas de clé de client peuvent être utilisés.</span><span class="sxs-lookup"><span data-stu-id="fb445-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="fb445-125">catalogue de Hello permet hello nom ou son emplacement hello toobe de base de données modifiée avec un impact minimal sur l’application hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="fb445-126">Dans un modèle de base de données multiclient, il facilite également le « déplacement » d’un client entre les différentes bases de données.</span><span class="sxs-lookup"><span data-stu-id="fb445-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="fb445-127">catalogue de Hello peut également être utilisé tooindicate si un client ou la base de données est hors connexion pour maintenance ou d’autres actions.</span><span class="sxs-lookup"><span data-stu-id="fb445-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="fb445-128">Cela est exploré Bonjour [restaurer le didacticiel d’un seul locataire](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="fb445-129">En outre, catalogue hello, qui est en vigueur une base de données de gestion pour une application SaaS, peut stocker des métadonnées supplémentaires de client ou de la base de données, par exemple hello couche Édition ou une base de données, la version du schéma, le plan de service ou SLA offert tootenants et autres informations qui permet la gestion des applications, le support technique ou des processus de devops.</span><span class="sxs-lookup"><span data-stu-id="fb445-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="fb445-130">Au-delà de hello application SaaS, catalogue de hello peut activer les outils de base de données.</span><span class="sxs-lookup"><span data-stu-id="fb445-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="fb445-131">Dans l’exemple de Wingtip SaaS hello, catalogue de hello est tooenable utilisé entre locataires requête exploré Bonjour [didacticiel d’analytique ad hoc](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="fb445-132">Gestion des travaux de bases de données croisées est explorée Bonjour [gestion du schéma](sql-database-saas-tutorial-schema-management.md) et [locataire analytique](sql-database-saas-tutorial-tenant-analytics.md) didacticiels.</span><span class="sxs-lookup"><span data-stu-id="fb445-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="fb445-133">Dans l’application SaaS de Wingtip hello catalogue de hello est implémentée à l’aide des fonctionnalités de gestion de partition hello Hello [bibliothèque de Client élastique de base de données (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="fb445-134">Hello EDCL permet à une application toocreate, gérer et utiliser une carte de partitions de base de données sauvegardée.</span><span class="sxs-lookup"><span data-stu-id="fb445-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="fb445-135">Une carte de partitions contient une liste de partitions (bases de données) et de mappage hello entre les clés (clients) et les bases de données.</span><span class="sxs-lookup"><span data-stu-id="fb445-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="fb445-136">Les fonctions EDCL peuvent être utilisées par les applications ou scripts PowerShell pendant les entrées de hello toocreate dans la carte de partitions hello d’approvisionnement du client et à partir d’applications tooefficiently connecter toohello de base de données correct.</span><span class="sxs-lookup"><span data-stu-id="fb445-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="fb445-137">EDCL met en cache connexion informations toominimize hello trafic toohello catalogue base de données et de la vitesse de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="fb445-138">les données de mappage Hello sont accessibles dans la base de données du catalogue hello, mais *ne le modifiez pas*!</span><span class="sxs-lookup"><span data-stu-id="fb445-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="fb445-139">Modifiez les données de mappage des API Elastic Database Client Library uniquement.</span><span class="sxs-lookup"><span data-stu-id="fb445-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="fb445-140">Manipuler directement les données de mappage hello risques qui endommage hello catalogue et ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="fb445-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="fb445-141">Modèle de configuration de SaaS toohello introduction</span><span class="sxs-lookup"><span data-stu-id="fb445-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="fb445-142">Lors de l’intégration d’un nouveau client dans une application SaaS qui utilise un modèle de base de données à client unique, une nouvelle base de données client doit être approvisionnée.</span><span class="sxs-lookup"><span data-stu-id="fb445-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="fb445-143">Il doit être créé dans l’emplacement approprié de hello et niveau de service, initialisée avec les données de référence et le schéma approprié et puis enregistrée dans le catalogue de hello sous la clé de locataire approprié hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="fb445-144">Différentes approches peuvent être utilisée toodatabase mise en service, qui peut inclure l’exécution de scripts SQL, le déploiement d’un fichier bacpac ou copier une base de données de modèle 'or'.</span><span class="sxs-lookup"><span data-stu-id="fb445-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="fb445-145">Hello approche que vous utilisez l’approvisionnement doit être comprise dans votre stratégie de gestion de schéma global, qui doit s’assurer que les nouvelles bases de données sont configurés avec le schéma le plus récent hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="fb445-146">Cela est exploré Bonjour [didacticiel de gestion de schéma](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="fb445-147">Hello Wingtip SaaS application dispositions nouveaux clients en copiant une base de données finale nommé basetenantdb, déployé sur le serveur de catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="fb445-148">L’approvisionnement peut être intégré dans l’application hello dans le cadre d’une expérience d’inscription, et/ou pris en charge en mode hors connexion à l’aide de scripts.</span><span class="sxs-lookup"><span data-stu-id="fb445-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="fb445-149">Ce didacticiel décrit le processus d’approvisionnement à l’aide des scripts PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fb445-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="fb445-150">scripts de configuration Hello copier hello basetenantdb toocreate une base de données client dans un pool élastique, puis initialisent avec des informations spécifiques du client et l’inscrire dans la carte de partitions du catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="fb445-151">Dans l’exemple d’application hello, bases de données reçoivent des noms basés sur le nom de client hello, mais cela n’est pas un élément essentiel du modèle de hello : hello catalogue de hello permet de toute base de données nom toobe affecté toohello. +</span><span class="sxs-lookup"><span data-stu-id="fb445-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="fb445-152">Obtenir les scripts d’application hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="fb445-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="fb445-153">Hello Wingtip SaaS scripts et code source d’applications sont disponibles dans hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) référentiel github.</span><span class="sxs-lookup"><span data-stu-id="fb445-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="fb445-154">[Étapes de scripts de Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="fb445-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="fb445-155">Procédure pas à pas détaillée sur l’approvisionnement et l’inscription dans le catalogue</span><span class="sxs-lookup"><span data-stu-id="fb445-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="fb445-156">toounderstand comment hello Wingtip application met en œuvre d’approvisionnement du nouveau client, ajoutez un point d’arrêt et parcourir le flux de travail hello lors de la configuration d’un client :</span><span class="sxs-lookup"><span data-stu-id="fb445-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="fb445-157">Ouvrir... \\Modules d’apprentissage\\ProvisionAndCatalog\\_ProvisionAndCatalog.ps1 de démonstration_ et hello du jeu de paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="fb445-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="fb445-158">**$TenantName** = nom hello soit de nouveau hello (par exemple, *Bushwillow bleus*).</span><span class="sxs-lookup"><span data-stu-id="fb445-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="fb445-159">**$VenueType** = un des types de salle prédéfinis hello : *bleus*, classicalmusic, danse, jazz, judo, motorracing, polyvalent, opera, rockmusic, football.</span><span class="sxs-lookup"><span data-stu-id="fb445-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="fb445-160">**$DemoScenario** = **1**, définissez trop**1** trop*configurer un seul client*.</span><span class="sxs-lookup"><span data-stu-id="fb445-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="fb445-161">Ajouter un point d’arrêt en plaçant votre curseur n’importe où sur la ligne hello 48, ligne indiquant : *nouveau locataire '*, puis appuyez sur **F9**.</span><span class="sxs-lookup"><span data-stu-id="fb445-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![point d’arrêt](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="fb445-163">Appuyez sur la touche script hello toorun **F5**.</span><span class="sxs-lookup"><span data-stu-id="fb445-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="fb445-164">Une fois l’exécution du script hello s’arrête au point d’arrêt hello, appuyez sur **F11** toostep dans le code de hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![point d’arrêt](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="fb445-166">Tracer l’exécution du script hello en à l’aide de hello **déboguer** les options de menu - **F10** et **F11** toostep sur ou en hello appelées fonctions.</span><span class="sxs-lookup"><span data-stu-id="fb445-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="fb445-167">Pour plus d’informations sur le débogage des scripts PowerShell, consultez [Conseils sur l’utilisation et le débogage de scripts PowerShell](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="fb445-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="fb445-168">Hello Voici pas tooexplicitly suivre des étapes, mais une explication du flux de travail hello que parcourir lors du débogage de script de hello :</span><span class="sxs-lookup"><span data-stu-id="fb445-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="fb445-169">**Hello d’importation SubscriptionManagement.psm1** module qui contient les fonctions de signature dans tooAzure et en sélectionnant hello abonnement Azure que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="fb445-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="fb445-170">**Hello d’importation CatalogAndDatabaseManagement.psm1** module qui fournit un catalogue et l’abstraction de niveau de client sur hello [gestion de partition](sql-database-elastic-scale-shard-map-management.md) fonctions.</span><span class="sxs-lookup"><span data-stu-id="fb445-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="fb445-171">Il s’agit d’un module important qui encapsule la majeure partie du modèle de catalogue hello et est mérite d’être exploré.</span><span class="sxs-lookup"><span data-stu-id="fb445-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="fb445-172">**Accédez aux détails de configuration**.</span><span class="sxs-lookup"><span data-stu-id="fb445-172">**Get configuration details**.</span></span> <span data-ttu-id="fb445-173">Pas à pas détaillé Get-Configuration (F11) et voir comment la configuration de l’application hello est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="fb445-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="fb445-174">Noms de ressources et d’autres valeurs spécifiques à l’application sont définies ici, mais ne modifiez pas ces valeurs jusqu'à ce que vous êtes familiarisé avec les scripts hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="fb445-175">**Obtenir l’objet catalogue hello**.</span><span class="sxs-lookup"><span data-stu-id="fb445-175">**Get hello catalog object**.</span></span> <span data-ttu-id="fb445-176">Pas à pas détaillé Get-catalogue qui compose et retourne un objet de catalogue qui est utilisé dans le script de niveau supérieur hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="fb445-177">Cette fonction utilise les fonctions de gestion de partitions qui sont importées à partir de **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="fb445-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="fb445-178">l’objet catalogue Hello est composée de suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="fb445-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="fb445-179">$catalogServerFullyQualifiedName est construite à l’aide de stem standard de hello ainsi que votre nom d’utilisateur : _catalogue -\<utilisateur\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="fb445-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="fb445-180">$catalogDatabaseName sont récupérées à partir de la configuration de hello : *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="fb445-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="fb445-181">$shardMapManager objet est initialisé à partir de la base de données de catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="fb445-182">$shardMap objet est initialisé à partir de hello *tenantcatalog* carte de partitions dans la base de données de catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="fb445-183">Un objet de catalogue est composé retourné et utilisé dans le script de niveau supérieur hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="fb445-184">**Calculer la nouvelle clé de locataire hello**.</span><span class="sxs-lookup"><span data-stu-id="fb445-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="fb445-185">Une fonction de hachage est la clé de locataire hello toocreate utilisé à partir du nom de client hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="fb445-186">**Vérifiez si clé de locataire hello existe déjà**.</span><span class="sxs-lookup"><span data-stu-id="fb445-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="fb445-187">catalogue de Hello est vérifiée tooensure hello clé n’est disponible.</span><span class="sxs-lookup"><span data-stu-id="fb445-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="fb445-188">**base de données client Hello est doté de New-TenantDatabase.**</span><span class="sxs-lookup"><span data-stu-id="fb445-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="fb445-189">Utilisez **F11** toostep dans et voir comment la base de données hello est configuré à l’aide un [modèle Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="fb445-190">nom de base de données Hello est construit à partir de hello client nom toomake il effacer quelle partition appartient toowhich client.</span><span class="sxs-lookup"><span data-stu-id="fb445-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="fb445-191">(Autres stratégies d’affectation de noms de base de données peuvent être facilement utilisés.) + Un modèle de gestionnaire de ressources est utilisé toocreate une base de données client en copiant une base de données finale (baseTenantDB) sur le serveur de catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="fb445-192">Une autre approche pourrait être toocreate une base de données vide, puis initialisez-le en important un fichier bacpac ou tooexecute un script d’initialisation à partir d’un emplacement connu.</span><span class="sxs-lookup"><span data-stu-id="fb445-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="fb445-193">modèle de gestionnaire de ressources Hello est dans le dossier de hello ...\Learning Modules\Common\ : *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="fb445-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="fb445-194">Après la création de la base de données client hello, il est alors plu **initialisé avec le nom de la salle (locataire) hello et le type de lieu de hello**.</span><span class="sxs-lookup"><span data-stu-id="fb445-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="fb445-195">Une autre initialisation peut également être accomplie ici.</span><span class="sxs-lookup"><span data-stu-id="fb445-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="fb445-196">Hello **base de données est inscrit dans le catalogue de hello** avec *Add-TenantDatabaseToCatalog* à l’aide de la clé de locataire hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="fb445-197">Utilisez **F11** toostep dans les détails de hello :</span><span class="sxs-lookup"><span data-stu-id="fb445-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="fb445-198">base de données de catalogue Hello est ajouté carte de partitions toohello (liste hello des bases de données connus).</span><span class="sxs-lookup"><span data-stu-id="fb445-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="fb445-199">Hello mappage de cette partition toohello de liens hello valeur de clé est créée.</span><span class="sxs-lookup"><span data-stu-id="fb445-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="fb445-200">Métadonnées supplémentaires (nom de salle hello) sur le client de hello sont ajoutées table de clients toohello dans le catalogue de hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="fb445-201">table de clients Hello ne fait pas partie du schéma de ShardManagement hello et n’est pas installé par hello EDCL.</span><span class="sxs-lookup"><span data-stu-id="fb445-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="fb445-202">Le tableau suivant illustre comment hello catalogue peuvent être étendues toosupport des données supplémentaires spécifiques à l’application.</span><span class="sxs-lookup"><span data-stu-id="fb445-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="fb445-203">Après la configuration, l’exécution retourne toohello d’origine *ProvisionAndCatalog de démonstration* script, qui s’ouvre hello **événements** page pour le client dans le navigateur de hello hello :</span><span class="sxs-lookup"><span data-stu-id="fb445-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![événements](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="fb445-205">Approvisionner un lot de locataires</span><span class="sxs-lookup"><span data-stu-id="fb445-205">Provision a batch of tenants</span></span>

<span data-ttu-id="fb445-206">Cet exercice permet d’approvisionner un lot de 17 clients.</span><span class="sxs-lookup"><span data-stu-id="fb445-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="fb445-207">Il est recommandé de que configurer de ce lot de locataires avant de démarrer d’autres didacticiels Wingtip SaaS, par conséquent, il est plus de quelques toowork de bases de données avec.</span><span class="sxs-lookup"><span data-stu-id="fb445-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="fb445-208">Ouvrir... \\Modules d’apprentissage\\ProvisionAndCatalog\\*ProvisionAndCatalog.ps1 de démonstration* Bonjour *PowerShell ISE* et modifiez hello *$ DemoScenario* too3 de paramètre :</span><span class="sxs-lookup"><span data-stu-id="fb445-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="fb445-209">**$DemoScenario** = **3**, également modifier**3** trop*approvisionner un lot de locataires*.</span><span class="sxs-lookup"><span data-stu-id="fb445-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="fb445-210">Appuyez sur **F5** et exécutez le script de hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="fb445-211">script de Hello déploie un lot de clients supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="fb445-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="fb445-212">Il utilise un [modèle Azure Resource Manager](../azure-resource-manager/resource-manager-template-walkthrough.md) qui contrôle le traitement par lots hello et délègue ensuite la configuration de chaque modèle lié tooa de base de données.</span><span class="sxs-lookup"><span data-stu-id="fb445-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="fb445-213">À l’aide des modèles de cette façon permet à Azure Resource Manager toobroker hello est le processus de votre script de déploiement.</span><span class="sxs-lookup"><span data-stu-id="fb445-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="fb445-214">Configurer des modèles de bases de données en parallèle, où il peut et gère les nouvelles tentatives si nécessaire, optimisation des processus global de hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="fb445-215">script de Hello est idempotente par conséquent, si elle échoue ou s’arrête pour une raison quelconque, exécutez-le à nouveau.</span><span class="sxs-lookup"><span data-stu-id="fb445-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="fb445-216">Vérifiez que le lot hello de clients déployés avec succès</span><span class="sxs-lookup"><span data-stu-id="fb445-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="fb445-217">Ouvrez hello *tenants1* serveur en recherchant tooyour la liste des serveurs de hello [portail Azure](https://portal.azure.com), cliquez sur **bases de données SQL**et vérifiez que le lot de hello de 17 bases de données supplémentaires sont désormais dans la liste de hello :</span><span class="sxs-lookup"><span data-stu-id="fb445-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![liste de base de données](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="fb445-219">Autres modèles d’approvisionnement</span><span class="sxs-lookup"><span data-stu-id="fb445-219">Other provisioning patterns</span></span>

<span data-ttu-id="fb445-220">Voici les autres modèles d’approvisionnement non inclus dans ce tutoriel :</span><span class="sxs-lookup"><span data-stu-id="fb445-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="fb445-221">**Pré-approvisionnement des bases de données.**</span><span class="sxs-lookup"><span data-stu-id="fb445-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="fb445-222">Hello prédéployant le modèle exploite le fait de hello que bases de données dans un pool élastique n’ajoutent pas de frais supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="fb445-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="fb445-223">Est de facturation pour le pool élastique de hello, ne Hello pas les bases de données et ne consomment des bases de données inactives aucune ressource.</span><span class="sxs-lookup"><span data-stu-id="fb445-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="fb445-224">En pré-approvisionnant les bases de données d’un pool et en les allouant en cas de besoin, le délai d’intégration du client peut être considérablement réduit.</span><span class="sxs-lookup"><span data-stu-id="fb445-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="fb445-225">plusieurs Hello pré-configurés des bases de données peut être sont ajustées tookeep nécessaire une mémoire tampon appropriée pour hello anticipées de taux de configuration.</span><span class="sxs-lookup"><span data-stu-id="fb445-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="fb445-226">**Approvisionnement automatique.**</span><span class="sxs-lookup"><span data-stu-id="fb445-226">**Auto-provisioning.**</span></span> <span data-ttu-id="fb445-227">Dans le modèle de mise en service automatique hello, un service de mise en service dédié est utilisé tooprovision serveurs, les pools et les bases de données automatiquement en fonction des besoins, notamment les bases de données de configuration préalable dans les pools élastiques si vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="fb445-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="fb445-228">Et si la déduplication commandées et supprimés les bases de données, des écarts dans les pools élastiques peuvent être remplies par hello configuration service comme vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="fb445-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="fb445-229">Un tel service peut être simple ou complexe (par exemple, la gestion de l’approvisionnement sur plusieurs zones géographiques) et peut configurer la géoréplication automatiquement si cette stratégie est utilisée pour la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="fb445-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="fb445-230">Avec le modèle de mise en service automatique hello, une application cliente ou un script soumet un approvisionnement toobe de file d’attente de tooa demande traité par hello service de configuration et interrogerait puis achèvement de toodetermine service hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="fb445-231">Si la configuration anticipée est utilisé, les demandes seraient gérés rapidement avec service hello la gestion de l’approvisionnement d’une base de données de remplacement en cours d’exécution en arrière-plan de hello.</span><span class="sxs-lookup"><span data-stu-id="fb445-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="fb445-232">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="fb445-232">Next steps</span></span>

<span data-ttu-id="fb445-233">Dans ce tutoriel, vous avez appris à effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="fb445-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="fb445-234">Approvisionner un nouveau locataire unique</span><span class="sxs-lookup"><span data-stu-id="fb445-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="fb445-235">Approvisionner un lot de locataires supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fb445-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="fb445-236">Pas à pas détaillé détails hello de configuration des clients et de les inscrire dans le catalogue de hello</span><span class="sxs-lookup"><span data-stu-id="fb445-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="fb445-237">Essayez de hello [didacticiel analyse des performances](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="fb445-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="fb445-238">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="fb445-238">Additional Resources</span></span>

* <span data-ttu-id="fb445-239">Supplémentaires [didacticiels qui reposent sur hello application Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="fb445-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="fb445-240">Bibliothèque cliente de base de données élastique</span><span class="sxs-lookup"><span data-stu-id="fb445-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="fb445-241">Comment tooDebug des Scripts dans Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="fb445-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)
