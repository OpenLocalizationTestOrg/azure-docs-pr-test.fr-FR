---
title: "aaaOperating magasin de requêtes de base de données SQL Azure"
description: "Découvrez comment toooperate hello magasin de requêtes de base de données SQL Azure"
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: ab741e49685bf6df3bceab219aaf57ea51cdb25d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="operating-hello-query-store-in-azure-sql-database"></a><span data-ttu-id="bf44a-103">Fonctionnement hello magasin de requêtes de base de données SQL Azure</span><span class="sxs-lookup"><span data-stu-id="bf44a-103">Operating hello Query Store in Azure SQL Database</span></span>
<span data-ttu-id="bf44a-104">Le magasin de requêtes dans Azure est une fonctionnalité de base de données entièrement gérée qui recueille et présente des informations historiques détaillées sur toutes les requêtes.</span><span class="sxs-lookup"><span data-stu-id="bf44a-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="bf44a-105">Vous pouvez considérer le magasin de requêtes en tant que l’enregistreur de données de vol d’avion tooan similaire qui simplifie la résolution des problèmes à la fois pour le cloud de performances de requête et de façon considérable clients locaux.</span><span class="sxs-lookup"><span data-stu-id="bf44a-105">You can think about Query Store as similar tooan airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="bf44a-106">Cet article présente certains aspects de l’utilisation du magasin de requêtes dans Azure.</span><span class="sxs-lookup"><span data-stu-id="bf44a-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="bf44a-107">À l’aide des données de requête collectées au préalable, vous pouvez diagnostiquer et résoudre rapidement les problèmes de performances, ce qui vous permet de consacrer davantage de temps à vos activités.</span><span class="sxs-lookup"><span data-stu-id="bf44a-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="bf44a-108">Le magasin de requêtes est [disponible dans le monde entier](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) via la base de données SQL Azure depuis novembre 2015.</span><span class="sxs-lookup"><span data-stu-id="bf44a-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="bf44a-109">Magasin de requêtes est foundation hello pour l’analyse des performances et de réglage des fonctionnalités, telles que [Assistant de base de données SQL et le tableau de bord performances](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="bf44a-109">Query Store is hello foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="bf44a-110">Moment hello de publication de cet article, le magasin de requêtes est en cours d’exécution dans plus de 200 000 bases de données utilisateur dans Azure, collecte des informations liées à la requête depuis plusieurs mois, sans interruption.</span><span class="sxs-lookup"><span data-stu-id="bf44a-110">At hello moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bf44a-111">Microsoft est en cours de hello de l’activation du magasin de requêtes pour toutes les bases de données SQL Azure (existants et nouveaux).</span><span class="sxs-lookup"><span data-stu-id="bf44a-111">Microsoft is in hello process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="bf44a-112">Configuration optimale du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="bf44a-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="bf44a-113">Cette section décrit les valeurs par défaut de la configuration optimale qui sont conçus tooensure un fonctionnement fiable du magasin de requêtes hello et des composants dépendants, tels que [Assistant de base de données SQL et le tableau de bord performances](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="bf44a-113">This section describes optimal configuration defaults that are designed tooensure reliable operation of hello Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="bf44a-114">La configuration par défaut est optimisée pour la collecte des données en continu, c’est-à-dire pour passer le moins de temps possible aux états OFF/READ_ONLY.</span><span class="sxs-lookup"><span data-stu-id="bf44a-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="bf44a-115">Configuration</span><span class="sxs-lookup"><span data-stu-id="bf44a-115">Configuration</span></span> | <span data-ttu-id="bf44a-116">Description</span><span class="sxs-lookup"><span data-stu-id="bf44a-116">Description</span></span> | <span data-ttu-id="bf44a-117">Default</span><span class="sxs-lookup"><span data-stu-id="bf44a-117">Default</span></span> | <span data-ttu-id="bf44a-118">Commentaire</span><span class="sxs-lookup"><span data-stu-id="bf44a-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="bf44a-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="bf44a-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="bf44a-120">Spécifie la limite de hello pour l’espace de données hello magasin de requêtes peut prendre au sein de la base de données client z</span><span class="sxs-lookup"><span data-stu-id="bf44a-120">Specifies hello limit for hello data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="bf44a-121">100</span><span class="sxs-lookup"><span data-stu-id="bf44a-121">100</span></span> |<span data-ttu-id="bf44a-122">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-122">Enforced for new databases</span></span> |
| <span data-ttu-id="bf44a-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="bf44a-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="bf44a-124">Définit la durée pendant laquelle les statistiques d’exécution collectées pour les plans de requête sont agrégées et rendues persistantes.</span><span class="sxs-lookup"><span data-stu-id="bf44a-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="bf44a-125">Chaque plan de requête actif dispose au maximum d’une ligne pour une période définie avec cette configuration</span><span class="sxs-lookup"><span data-stu-id="bf44a-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="bf44a-126">60</span><span class="sxs-lookup"><span data-stu-id="bf44a-126">60</span></span> |<span data-ttu-id="bf44a-127">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-127">Enforced for new databases</span></span> |
| <span data-ttu-id="bf44a-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="bf44a-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="bf44a-129">Stratégie de nettoyage basée sur le temps qui contrôle la période de rétention de hello de statistiques d’exécution persistantes et des requêtes inactives</span><span class="sxs-lookup"><span data-stu-id="bf44a-129">Time-based cleanup policy that controls hello retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="bf44a-130">30</span><span class="sxs-lookup"><span data-stu-id="bf44a-130">30</span></span> |<span data-ttu-id="bf44a-131">Appliqué aux nouvelles bases de données et aux bases de données ayant la valeur par défaut précédente (367)</span><span class="sxs-lookup"><span data-stu-id="bf44a-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="bf44a-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="bf44a-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="bf44a-133">Spécifie si le nettoyage automatique des données a lieu lorsque la taille des données de magasin de requêtes est proche de limite de hello</span><span class="sxs-lookup"><span data-stu-id="bf44a-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches hello limit</span></span> |<span data-ttu-id="bf44a-134">AUTO</span><span class="sxs-lookup"><span data-stu-id="bf44a-134">AUTO</span></span> |<span data-ttu-id="bf44a-135">Appliqué à toutes les bases de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-135">Enforced for all databases</span></span> |
| <span data-ttu-id="bf44a-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="bf44a-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="bf44a-137">Indique si toutes les requêtes sont suivies, ou seulement un sous-ensemble de requêtes</span><span class="sxs-lookup"><span data-stu-id="bf44a-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="bf44a-138">AUTO</span><span class="sxs-lookup"><span data-stu-id="bf44a-138">AUTO</span></span> |<span data-ttu-id="bf44a-139">Appliqué à toutes les bases de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-139">Enforced for all databases</span></span> |
| <span data-ttu-id="bf44a-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="bf44a-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="bf44a-141">Spécifie la durée maximale pendant laquelle les statistiques d’exécution capturé sont conservées en mémoire, avant de vider les toodisk</span><span class="sxs-lookup"><span data-stu-id="bf44a-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing toodisk</span></span> |<span data-ttu-id="bf44a-142">900</span><span class="sxs-lookup"><span data-stu-id="bf44a-142">900</span></span> |<span data-ttu-id="bf44a-143">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="bf44a-144">Ces valeurs par défaut sont automatiquement appliquées dans hello dernière étape de l’activation du magasin de requêtes dans toutes les bases de données SQL Azure (voir la Remarque importante ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="bf44a-144">These defaults are automatically applied in hello final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="bf44a-145">Après cette alléger, base de données SQL Azure ne modifier les valeurs de configuration définies par les clients, sauf si elles un impact négatif sur les opérations fiables Hello magasin de requêtes ou charge de travail principale.</span><span class="sxs-lookup"><span data-stu-id="bf44a-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of hello Query Store.</span></span>
> 
> 

<span data-ttu-id="bf44a-146">Si vous souhaitez toostay avec vos paramètres personnalisés, utilisez [modifier la base de données avec les options du magasin de requêtes](https://msdn.microsoft.com/library/bb522682.aspx) état précédent de toorevert configuration toohello.</span><span class="sxs-lookup"><span data-stu-id="bf44a-146">If you want toostay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) toorevert configuration toohello previous state.</span></span> <span data-ttu-id="bf44a-147">Extraire [Best Practices with hello magasin de requêtes](https://msdn.microsoft.com/library/mt604821.aspx) dans l’ordre toolearn comment supérieur choisi des paramètres de configuration optimale.</span><span class="sxs-lookup"><span data-stu-id="bf44a-147">Check out [Best Practices with hello Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order toolearn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bf44a-148">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bf44a-148">Next steps</span></span>
[<span data-ttu-id="bf44a-149">Informations sur les performances des bases de données SQL</span><span class="sxs-lookup"><span data-stu-id="bf44a-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="bf44a-150">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="bf44a-150">Additional resources</span></span>
<span data-ttu-id="bf44a-151">Pour plus d’informations extraction hello suivant des articles :</span><span class="sxs-lookup"><span data-stu-id="bf44a-151">For more information check out hello following articles:</span></span>

* [<span data-ttu-id="bf44a-152">Un enregistreur de données pour votre base de données</span><span class="sxs-lookup"><span data-stu-id="bf44a-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="bf44a-153">Analyse des performances à l’aide de magasin de requêtes hello</span><span class="sxs-lookup"><span data-stu-id="bf44a-153">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="bf44a-154">Scénarios d’utilisation du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="bf44a-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="bf44a-155">Analyse des performances à l’aide de magasin de requêtes hello</span><span class="sxs-lookup"><span data-stu-id="bf44a-155">Monitoring Performance By Using hello Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

