---
title: "Utilisation du magasin de requêtes dans la base de données SQL Azure"
description: "Découvrez comment utiliser le magasin de requêtes dans la base de données SQL Azure"
keywords: 
services: sql-database
documentationcenter: 
author: bonova
manager: jhubbard
editor: 
ms.assetid: 0cccf6bd-1327-44f7-a6f9-8eff0c210463
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: sqldb-performance
ms.workload: data-management
ms.date: 11/08/2016
ms.author: bonova
ms.openlocfilehash: 4e13f265c32037abdba67a68ca5be81e167c01e4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="operating-the-query-store-in-azure-sql-database"></a><span data-ttu-id="55848-103">Utilisation du magasin de requêtes dans la base de données SQL Azure</span><span class="sxs-lookup"><span data-stu-id="55848-103">Operating the Query Store in Azure SQL Database</span></span>
<span data-ttu-id="55848-104">Le magasin de requêtes dans Azure est une fonctionnalité de base de données entièrement gérée qui recueille et présente des informations historiques détaillées sur toutes les requêtes.</span><span class="sxs-lookup"><span data-stu-id="55848-104">Query Store in Azure is a fully managed database feature that continuously collects and presents detailed historic information about all queries.</span></span> <span data-ttu-id="55848-105">Le magasin de requêtes peut être comparé à l’enregistreur de données de vol d’un avion, qui simplifie considérablement le dépannage des problèmes de performances des requêtes à la fois pour les clients cloud et pour les clients locaux.</span><span class="sxs-lookup"><span data-stu-id="55848-105">You can think about Query Store as similar to an airplane's flight data recorder that significantly simplifies query performance troubleshooting both for cloud and on-premises customers.</span></span> <span data-ttu-id="55848-106">Cet article présente certains aspects de l’utilisation du magasin de requêtes dans Azure.</span><span class="sxs-lookup"><span data-stu-id="55848-106">This article explains specific aspects of operating Query Store in Azure.</span></span> <span data-ttu-id="55848-107">À l’aide des données de requête collectées au préalable, vous pouvez diagnostiquer et résoudre rapidement les problèmes de performances, ce qui vous permet de consacrer davantage de temps à vos activités.</span><span class="sxs-lookup"><span data-stu-id="55848-107">Using this pre-collected query data, you can quickly diagnose and resolve performance problems and thus spend more time focusing on their business.</span></span> 

<span data-ttu-id="55848-108">Le magasin de requêtes est [disponible dans le monde entier](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) via la base de données SQL Azure depuis novembre 2015.</span><span class="sxs-lookup"><span data-stu-id="55848-108">Query Store has been [globally available](https://azure.microsoft.com/updates/general-availability-azure-sql-database-query-store/) in Azure SQL Database since November, 2015.</span></span> <span data-ttu-id="55848-109">Le magasin de requêtes constitue la base de l’analyse des performances et de l’ajustement des fonctionnalités, comme [SQL Database Advisor et le tableau de bord des performances](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="55848-109">Query Store is the foundation for performance analysis and tuning features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="55848-110">Au moment de la publication de cet article, le magasin de requêtes est en cours d’exécution sur plus de 200 000 bases de données utilisateur dans Azure, et recueille les informations liées aux requêtes depuis plusieurs mois sans interruption.</span><span class="sxs-lookup"><span data-stu-id="55848-110">At the moment of publishing this article, Query Store is running in more than 200,000 user databases in Azure, collecting query-related information for several months, without interruption.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="55848-111">Microsoft met actuellement en place le magasin de requêtes pour toutes les bases de données SQL Azure (existantes et nouvelles).</span><span class="sxs-lookup"><span data-stu-id="55848-111">Microsoft is in the process of activating Query Store for all Azure SQL databases (existing and new).</span></span> 
> 
> 

## <a name="optimal-query-store-configuration"></a><span data-ttu-id="55848-112">Configuration optimale du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="55848-112">Optimal Query Store Configuration</span></span>
<span data-ttu-id="55848-113">Cette section décrit les paramètres optimaux de configuration par défaut, conçus pour garantir un fonctionnement fiable du magasin de requêtes et des fonctionnalités liées, comme [SQL Database Advisor et le tableau de bord des performances](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span><span class="sxs-lookup"><span data-stu-id="55848-113">This section describes optimal configuration defaults that are designed to ensure reliable operation of the Query Store and dependent features, such as [SQL Database Advisor and Performance Dashboard](https://azure.microsoft.com/updates/sqldatabaseadvisorga/).</span></span> <span data-ttu-id="55848-114">La configuration par défaut est optimisée pour la collecte des données en continu, c’est-à-dire pour passer le moins de temps possible aux états OFF/READ_ONLY.</span><span class="sxs-lookup"><span data-stu-id="55848-114">Default configuration is optimized for continuous data collection, that is minimal time spent in OFF/READ_ONLY states.</span></span>

| <span data-ttu-id="55848-115">Configuration</span><span class="sxs-lookup"><span data-stu-id="55848-115">Configuration</span></span> | <span data-ttu-id="55848-116">Description</span><span class="sxs-lookup"><span data-stu-id="55848-116">Description</span></span> | <span data-ttu-id="55848-117">Default</span><span class="sxs-lookup"><span data-stu-id="55848-117">Default</span></span> | <span data-ttu-id="55848-118">Commentaire</span><span class="sxs-lookup"><span data-stu-id="55848-118">Comment</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="55848-119">MAX_STORAGE_SIZE_MB</span><span class="sxs-lookup"><span data-stu-id="55848-119">MAX_STORAGE_SIZE_MB</span></span> |<span data-ttu-id="55848-120">Spécifie la limite d’espace de données que le magasin de requêtes peut inclure dans une base de données client</span><span class="sxs-lookup"><span data-stu-id="55848-120">Specifies the limit for the data space that Query Store can take inside z customer database</span></span> |<span data-ttu-id="55848-121">100</span><span class="sxs-lookup"><span data-stu-id="55848-121">100</span></span> |<span data-ttu-id="55848-122">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="55848-122">Enforced for new databases</span></span> |
| <span data-ttu-id="55848-123">INTERVAL_LENGTH_MINUTES</span><span class="sxs-lookup"><span data-stu-id="55848-123">INTERVAL_LENGTH_MINUTES</span></span> |<span data-ttu-id="55848-124">Définit la durée pendant laquelle les statistiques d’exécution collectées pour les plans de requête sont agrégées et rendues persistantes.</span><span class="sxs-lookup"><span data-stu-id="55848-124">Defines size of time window during which collected runtime statistics for query plans are aggregated and persisted.</span></span> <span data-ttu-id="55848-125">Chaque plan de requête actif dispose au maximum d’une ligne pour une période définie avec cette configuration</span><span class="sxs-lookup"><span data-stu-id="55848-125">Every active query plan has at most one row for a period of time defined with this configuration</span></span> |<span data-ttu-id="55848-126">60</span><span class="sxs-lookup"><span data-stu-id="55848-126">60</span></span> |<span data-ttu-id="55848-127">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="55848-127">Enforced for new databases</span></span> |
| <span data-ttu-id="55848-128">STALE_QUERY_THRESHOLD_DAYS</span><span class="sxs-lookup"><span data-stu-id="55848-128">STALE_QUERY_THRESHOLD_DAYS</span></span> |<span data-ttu-id="55848-129">Stratégie de nettoyage basée sur la durée, et qui contrôle la période de rétention des statistiques d’exécution persistantes et des requêtes inactives</span><span class="sxs-lookup"><span data-stu-id="55848-129">Time-based cleanup policy that controls the retention period of persisted runtime statistics and inactive queries</span></span> |<span data-ttu-id="55848-130">30</span><span class="sxs-lookup"><span data-stu-id="55848-130">30</span></span> |<span data-ttu-id="55848-131">Appliqué aux nouvelles bases de données et aux bases de données ayant la valeur par défaut précédente (367)</span><span class="sxs-lookup"><span data-stu-id="55848-131">Enforced for new databases and databases with previous default (367)</span></span> |
| <span data-ttu-id="55848-132">SIZE_BASED_CLEANUP_MODE</span><span class="sxs-lookup"><span data-stu-id="55848-132">SIZE_BASED_CLEANUP_MODE</span></span> |<span data-ttu-id="55848-133">Indique si un nettoyage automatique des données a lieu lorsque la taille des données du magasin de requêtes approche de la limite</span><span class="sxs-lookup"><span data-stu-id="55848-133">Specifies whether automatic data cleanup takes place when Query Store data size approaches the limit</span></span> |<span data-ttu-id="55848-134">AUTO</span><span class="sxs-lookup"><span data-stu-id="55848-134">AUTO</span></span> |<span data-ttu-id="55848-135">Appliqué à toutes les bases de données</span><span class="sxs-lookup"><span data-stu-id="55848-135">Enforced for all databases</span></span> |
| <span data-ttu-id="55848-136">QUERY_CAPTURE_MODE</span><span class="sxs-lookup"><span data-stu-id="55848-136">QUERY_CAPTURE_MODE</span></span> |<span data-ttu-id="55848-137">Indique si toutes les requêtes sont suivies, ou seulement un sous-ensemble de requêtes</span><span class="sxs-lookup"><span data-stu-id="55848-137">Specifies whether all queries or only a subset of queries are tracked</span></span> |<span data-ttu-id="55848-138">AUTO</span><span class="sxs-lookup"><span data-stu-id="55848-138">AUTO</span></span> |<span data-ttu-id="55848-139">Appliqué à toutes les bases de données</span><span class="sxs-lookup"><span data-stu-id="55848-139">Enforced for all databases</span></span> |
| <span data-ttu-id="55848-140">FLUSH_INTERVAL_SECONDS</span><span class="sxs-lookup"><span data-stu-id="55848-140">FLUSH_INTERVAL_SECONDS</span></span> |<span data-ttu-id="55848-141">Indique la durée maximale pendant laquelle les statistiques d’exécution capturées sont conservées dans la mémoire, avant le vidage sur disque</span><span class="sxs-lookup"><span data-stu-id="55848-141">Specifies maximum period during which captured runtime statistics are kept in memory, before flushing to disk</span></span> |<span data-ttu-id="55848-142">900</span><span class="sxs-lookup"><span data-stu-id="55848-142">900</span></span> |<span data-ttu-id="55848-143">Appliqué aux nouvelles bases de données</span><span class="sxs-lookup"><span data-stu-id="55848-143">Enforced for new databases</span></span> |
|  | | | |

> [!IMPORTANT]
> <span data-ttu-id="55848-144">Ces paramètres par défaut sont automatiquement appliqués à l’étape finale de l’activation du magasin de requêtes dans toutes les bases de données SQL Azure (voir la remarque importante précédente).</span><span class="sxs-lookup"><span data-stu-id="55848-144">These defaults are automatically applied in the final stage of Query Store activation in all Azure SQL databases (see preceding important note).</span></span> <span data-ttu-id="55848-145">Après cela, la base de données SQL Azure ne modifiera pas les valeurs de configuration définies par les clients, à moins qu’elles aient un impact négatif sur les charges de travail principales ou sur la fiabilité des opérations du magasin de requêtes.</span><span class="sxs-lookup"><span data-stu-id="55848-145">After this light up, Azure SQL Database won’t be changing configuration values set by customers, unless they negatively impact primary workload or reliable operations of the Query Store.</span></span>
> 
> 

<span data-ttu-id="55848-146">Si vous souhaitez conserver vos paramètres personnalisés, utilisez [ALTER DATABASE avec les options du magasin de requêtes](https://msdn.microsoft.com/library/bb522682.aspx) pour rétablir la configuration à l’état précédent.</span><span class="sxs-lookup"><span data-stu-id="55848-146">If you want to stay with your custom settings, use [ALTER DATABASE with Query Store options](https://msdn.microsoft.com/library/bb522682.aspx) to revert configuration to the previous state.</span></span> <span data-ttu-id="55848-147">Découvrez les [meilleures pratiques liées au magasin de requêtes](https://msdn.microsoft.com/library/mt604821.aspx) pour savoir comment choisir des paramètres de configuration optimaux.</span><span class="sxs-lookup"><span data-stu-id="55848-147">Check out [Best Practices with the Query Store](https://msdn.microsoft.com/library/mt604821.aspx) in order to learn how top chose optimal configuration parameters.</span></span>

## <a name="next-steps"></a><span data-ttu-id="55848-148">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="55848-148">Next steps</span></span>
[<span data-ttu-id="55848-149">Informations sur les performances des bases de données SQL</span><span class="sxs-lookup"><span data-stu-id="55848-149">SQL Database Performance Insight</span></span>](sql-database-performance.md)

## <a name="additional-resources"></a><span data-ttu-id="55848-150">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="55848-150">Additional resources</span></span>
<span data-ttu-id="55848-151">Pour plus d’informations, consultez les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="55848-151">For more information check out the following articles:</span></span>

* [<span data-ttu-id="55848-152">Un enregistreur de données pour votre base de données</span><span class="sxs-lookup"><span data-stu-id="55848-152">A flight data recorder for your database</span></span>](https://azure.microsoft.com/blog/query-store-a-flight-data-recorder-for-your-database) 
* [<span data-ttu-id="55848-153">Analyse des performances à l’aide du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="55848-153">Monitoring Performance By Using the Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx)
* [<span data-ttu-id="55848-154">Scénarios d’utilisation du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="55848-154">Query Store Usage Scenarios</span></span>](https://msdn.microsoft.com/library/mt614796.aspx)
* [<span data-ttu-id="55848-155">Analyse des performances à l’aide du magasin de requêtes</span><span class="sxs-lookup"><span data-stu-id="55848-155">Monitoring Performance By Using the Query Store</span></span>](https://msdn.microsoft.com/library/dn817826.aspx) 

