---
title: "aaaFailover géo-réplication active - base de données SQL Azure et les groupes | Documents Microsoft"
description: "Groupes de basculement automatique avec la géo-réplication active permet toosetup 4 réplicas de base de données dans des centres de données Azure de hello et basculement autoomatically dans l’événement hello d’une indisponibilité."
services: sql-database
documentationcenter: na
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 2a29f657-82fb-4283-9a83-e14a144bfd93
ms.service: sql-database
ms.custom: business continuity
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: NA
ms.date: 07/10/2017
ms.author: sashan
ms.openlocfilehash: 7a39af8505624c0f19c5abccff051af836b1f9bc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="overview-failover-groups-and-active-geo-replication"></a>Vue d’ensemble : groupes de basculement et géo-réplication active
Géo-réplication Active vous permet de tooconfigure toofour lisible secondaire bases de données Bonjour emplacements (régions) du centre de données identiques ou différentes. Bases de données secondaires sont disponibles pour l’interrogation et de basculement en cas de hello de données center hello ou une interruption incapacité tooconnect toohello base de données primaire. Hello basculement doit être lancée manuellement par l’application hello d’utilisateur de hello. Après le basculement, primaire hello possède un point de terminaison de connexion différents. 

> [!NOTE]
> La géo-réplication active est disponible pour toutes les bases de données de tous les niveaux de service, dans toutes les régions.
>  

Groupes de basculement automatique de la base de données SQL Azure (en version préliminaire) est un tooautomatically fonctionnalité conçue de base de données SQL gérer la relation de géo-réplication, la connectivité et le basculement à l’échelle. Avec elle, hello clients gain hello capacité tooautomatically récupérer plusieurs bases de données associées dans la région secondaire hello après défaillance régional ou d’autres événements non planifiés qui entraînent une perte complète ou partielle de hello du service de base de données SQL disponibilité dans la région principale de hello. En outre, ils peuvent utiliser hello des bases de données secondaires lisibles toooffload en lecture seule les charges de travail.  Étant donné que les groupes de basculement automatique impliquant plusieurs bases de données que doivent être configurés sur le serveur principal de hello. Les serveurs principaux et secondaires doivent être Bonjour même abonnement. Groupes de basculement automatique prend en charge la réplication de toutes les bases de données dans hello groupe tooonly un serveur secondaire dans une autre région. Géo-réplication Active, sans les groupes de basculement automatique, permet des bases de données secondaires too4 dans n’importe quelle région.

Si vous utilisez la géo-réplication active et pour tout échec de la base de données primaire, ou simplement les toobe besoins mis hors connexion, vous pouvez lancer tooany de basculement de vos bases de données secondaire. Lorsque le basculement est activé tooone de bases de données secondaires hello, toutes les autres bases de données secondaires sont automatiquement lié toohello nouveau réplica principal. Si vous utilisez un basculement automatique regroupe toute coupure de courant qui a un impact sur une ou plusieurs des bases de données hello dans les résultats du groupe hello dans le basculement automatique et de récupération de base de données (en version préliminaire) toomanage. Vous pouvez configurer la stratégie de basculement automatique hello qui répond le mieux aux besoins de votre application, ou vous pouvez annuler l’abonnement et utiliser l’activation manuelle. D’autre part, les groupes de basculement automatique (en préversion) fournissent des points de terminaison d’écouteur de lecture-écriture et de lecture seule qui restent inchangés lors des basculements. Si vous utilisez l’activation du basculement manuel ou automatique, le basculement bascule toutes les bases de données secondaires dans hello groupe tooprimary. Une fois le basculement de base de données hello est terminée, un enregistrement DNS hello est automatiquement mis à jour tooredirect hello points d’arrêt toohello nouvelle zone de.

Vous pouvez gérer la réplication et le basculement d’une base de données individuelle ou d’un ensemble de bases de données sur un serveur ou dans un pool élastique à l’aide de la géo-réplication active. Vous pouvez effectuer à l’aide de ce hello [portail Azure](sql-database-geo-replication-portal.md), [PowerShell](sql-database-geo-replication-powershell.md), [Transact-SQL](sql-database-geo-replication-transact-sql.md), ou hello [API REST](https://msdn.microsoft.com/library/azure/mt163685.aspx). Après le basculement, vérifiez les conditions d’authentification hello pour votre serveur et de la base de données sont configurées sur le nouveau réplica principal de hello. Pour plus d’informations, consultez [Gestion de la sécurité de la base de données SQL Azure après la récupération d’urgence](sql-database-geo-replication-security-config.md). Cela s’applique les deux groupes de géo-réplication et le basculement automatique des tooactive (en version préliminaire).

Hello tire parti de géo-réplication Active [Always On](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server) technologie de SQL Server tooasynchronously répliquer les transactions validées sur hello principal de la base de données tooa base de données secondaire à l’aide d’isolement d’instantané de lecture validée (RCSI). Les groupes de basculement automatique fournissent une sémantique de groupe hello au-dessus de géo-réplication active mais hello même mécanisme de réplication asynchrone est utilisé. Tout en n’importe quel point donné, base de données secondaire hello peut être légèrement derrière la base de données primaire hello, hello de données secondaire est garantie toonever que les transactions partielles. La redondance entre régions permet de récupérer de tooquickly applications à partir d’une perte permanente d’un centre de données entière ou des parties d’un centre de données provoquée par des catastrophes naturelles, une erreur humaine grave ou un acte malveillant. données RPO Hello spécifiques, consultez [vue d’ensemble de continuité des activités](sql-database-business-continuity.md).

Hello figure suivante montre un exemple de géo-réplication active configurée avec un serveur principal dans la région de hello Amérique du Nord et secondaire dans la région de hello Amérique du Sud.

![Relation de géo-réplication](./media/sql-database-active-geo-replication/geo-replication-relationship.png)

Étant donné que les bases de données secondaires hello sont lisibles, ils peuvent être toooffload utilisé en lecture seule des charges de travail tels que travaux de création de rapports. Si vous utilisez la géo-réplication active, il est de base de données secondaire toocreate possible hello Bonjour même région avec hello principal, mais elle n’augmente pas de défaillances de l’application hello résilience toocatastrophic. Si vous utilisez des groupes de basculement automatique (en préversion), votre base de données secondaire est toujours créée dans une région différente.

En outre toodisaster récupération géo-réplication active est utilisable dans hello les scénarios suivants :

* **Migration de base de données**: vous pouvez utiliser la géo-réplication active toomigrate tooanother d’un serveur en ligne une base de données avec un temps mort minimal.
* **Mises à niveau de l’application**: vous pouvez créer une base de données secondaire supplémentaire faisant office de copie de restauration automatique lors des mises à niveau de l’application.

tooachieve véritable continuité, ajout d’une redondance de base de données entre les centres de données n'est qu’une partie de la solution de hello. Récupération d’une application (service) de bout en bout après qu’une défaillance catastrophique requiert la récupération de tous les composants qui constituent le service de hello et tous les services dépendants. Le logiciel client hello (par exemple, un navigateur avec un code JavaScript personnalisé), de serveurs web frontaux, stockage et DNS sont des exemples de ces composants. Il est essentiel que tous les composants sont résilient toohello mêmes défaillances et redeviennent disponibles dans hello temps de récupération (RTO) de votre application. Par conséquent, vous devez tooidentify tous les services dépendants et comprenez les garanties de hello et de fonctionnalités qu’ils fournissent. Puis, vous devez prendre les mesures appropriées tooensure que vos fonctions de service au cours de hello basculement des services hello dont il dépend. Pour plus d’informations sur la conception de solutions pour la récupération d’urgence, consultez la page [Designing Cloud Solutions for Disaster Recovery Using active geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md) (Conception de solutions cloud pour la récupération d’urgence à l’aide de la géo-réplication active).

## <a name="active-geo-replication-capabilities"></a>Fonctionnalités de la géo-réplication active
fonctionnalité de géo-réplication active Hello fournit hello suivant des fonctions essentielles :
* **Réplication asynchrone automatique**: vous ne pouvez créer une base de données secondaire en ajoutant tooan de base de données existante. Hello secondaire peut être créé dans n’importe quel serveur de base de données SQL Azure. Une fois créé, base de données secondaire hello est remplie avec les données hello copiées à partir de la base de données primaire hello. Ce processus est appelé amorçage. Une fois que la base de données secondaire a été créée et amorcée, mises à jour de la base de données primaire toohello sont en mode asynchrone répliquées automatiquement toohello de base de données secondaire. Réplication asynchrone signifie que les transactions sont validées sur la base de données primaire hello avant qu’elles soient répliquées toohello de base de données secondaire. 
* **Bases de données secondaires lisibles**: une application peut accéder à une base de données secondaire pour les opérations en lecture seule à l’aide de hello identiques ou différentes entités de sécurité utilisé pour accéder à la base de données primaire hello. Hello bases de données secondaires fonctionnent en isolement d’instantané en mode tooensure la réplication de mises à jour hello Hello principal (relecture du journal) n’est pas retardée par les requêtes exécutées sur hello secondaire.

   > [!NOTE]
   > la relecture du journal Hello est retardée sur une base de données secondaire hello s’il n’y met à jour de schéma qu’il reçoit de hello principal qui nécessitent un verrou de schéma sur la base de données secondaire hello. 
   > 

* **Plusieurs bases de données secondaires lisibles**: deux ou plusieurs bases de données secondaires augmentent la redondance et niveau de protection de la base de données primaire hello et application. Si plusieurs bases de données secondaire existent, application hello reste protégée, même si une des bases de données secondaires hello échoue. Si seule la base de données secondaire, et qu’il échoue, l’application hello est exposée risque toohigher avant la création d’une base de données secondaire.

   > [!NOTE]
   > Si vous utilisez toobuild de géo-réplication active une application distribuée globalement et besoin d’accès en lecture seule de tooprovide toodata dans des régions plus de 4, vous pouvez créer secondaire d’une base de données secondaire (processus appelé chaînage). De cette manière, vous pouvez assurer une mise à l’échelle quasiment illimitée pour la réplication de base de données. En outre, chaînage réduit la charge de hello de réplication à partir de la base de données primaire hello. trouver un compromis Hello est hello un retard de réplication plus important sur les bases de données secondaires hello la plupart de la feuille. . 
   >

* **Prise en charge des bases de données de pool élastique** : la géo-réplication active peut être configurée pour toute base de données faisant partie d’un pool élastique. base de données secondaire Hello peut être dans un autre pool élastique. Pour les bases de données normales, hello secondaire peut être un pool élastique et vice versa, que les niveaux de service hello sont hello même. 
* **Niveau de performance configurables de base de données secondaire hello**: une base de données secondaire peut être créée avec un niveau de performance inférieur à hello principal. Bases de données primaires et secondaire sont nécessaires toohave hello même niveau de service. Cette option n’est pas recommandée pour les applications avec l’activité d’écriture de la base de données haute, car le décalage de réplication plus important hello augmente le risque de hello de perte de données après un basculement. En outre, une fois les performances de l’application hello de basculement sont affectée tant que hello nouveau principal sont tooa mis à niveau des performances supérieures au niveau. graphique de pourcentage journal e/s sur le portail Azure Hello fournit un bon moyen tooestimate hello au niveau minimal de performances de hello secondaire qui est la charge de la réplication hello toosustain requis. Par exemple, si votre base de données primaire est P6 (1000 DTU) et son journal % d’e/s est hello 50 % secondaire a besoin au moins toobe P4 (DTU 500). Vous pouvez également récupérer les données d’à l’aide d’e/s hello journal [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) ou [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) des vues de base de données.  Pour plus d’informations sur les niveaux de performance de base de données SQL hello, consultez [les options de base de données SQL et les performances](sql-database-service-tiers.md). 
* **Contrôlée par l’utilisateur de basculement et de restauration**: une base de données secondaire peut être explicitement le rôle principal de toohello commuté à tout moment par application hello ou un utilisateur de hello. Pendant un Bonjour pannes réelles option « non planifiée » doit être utilisée, ce qui promeut immédiatement toobe secondaire hello principal. Lorsque les principal défaillant hello récupère et est disponible à nouveau, hello système automatiquement hello de marques récupérée principal comme un serveur secondaire et mettre à jour avec le nouveau réplica principal de hello. En raison de la nature asynchrone de toohello de réplication, une petite quantité de données peut être perdue lors des basculements non planifiés si un serveur principal échoue avant sa réplication toohello modifications hello plus récent secondaire. Lorsqu’un principal avec plusieurs serveurs secondaires et bascule, système de hello reconfigure automatiquement les relations de réplication hello et hello liens restant toohello de bases de données secondaires nouvellement promu principal sans aucune intervention de l’utilisateur. Une fois la panne hello qui a provoqué le basculement de hello est atténuée, il peut être région primaire du toohello application hello tooreturn souhaitable. toodo que, la commande de basculement hello doit être appelée avec hello option « planifié ». 
* **Synchronisation des informations d’identification et les règles de pare-feu**: nous vous recommandons d’utiliser [règles de pare-feu de base de données](sql-database-firewall-configure.md) pour les bases de données de géo-répliquées pour ces règles peuvent être répliquées avec tooensure de base de données hello toutes les bases de données secondaires ont Bonjour les mêmes règles de pare-feu que hello principal. Cette approche évite de hello pour les clients toomanually configurer et gérer des règles de pare-feu sur les serveurs hébergeant les bases de données primaire et secondaire hello. De même, à l’aide de [contenait des utilisateurs de base de données](sql-database-manage-logins.md) données accès garantit l’unicité de bases de données primaires et secondaire ont toujours hello même utilisateur des informations d’identification lors d’un basculement, il n’existe aucune interruption due toomismatches avec des connexions et mots de passe. Ajout de hello de [Azure Active Directory](../active-directory/active-directory-whatis.md), les clients peuvent gérer l’accès tooboth principaux et secondaires bases de données utilisateur et en éliminant hello besoin pour la gestion des informations d’identification dans les bases de données complètement.

## <a name="auto-failover-group-capabilities"></a>Fonctionnalités des groupes de basculement automatique

La fonction de groupes de basculement automatique fournit une abstraction puissante de la géo-réplication active en prenant en charge la réplication et le basculement automatique au niveau du groupe. En outre, il supprime chaîne de connexion SQL hello nécessité toochange hello après le basculement en fournissant des points de terminaison hello écouteur supplémentaire. 

* **Groupe de basculement** : un ou plusieurs groupes de basculement peuvent être créés entre deux serveurs situés dans des régions différentes (serveurs primaire et secondaire). Chaque groupe peut inclure un ou plusieurs bases de données qui sont récupérées en tant qu’unité dans le cas où toutes ou certaines bases de données primaires deviennent indisponibles en raison de la panne tooan dans la région principale de hello.  
* **Serveur principal**: un serveur qui héberge les bases de données primaires hello dans le groupe de basculement hello.
* **Serveur secondaire**: un serveur qui héberge les bases de données secondaires hello dans le groupe de basculement hello. serveur secondaire de Hello ne peut pas être Bonjour même région que le serveur principal de hello.
* **Ajout du groupe toofailover bases de données**: vous pouvez placer plusieurs bases de données au sein d’un serveur ou dans un élastique pool dans hello même groupe de basculement. Si vous ajoutez un groupe de toohello de base de données autonome, il crée automatiquement une base de données secondaire à l’aide de hello même niveau d’édition et les performances. Si la base de données primaire hello est dans un pool élastique, hello secondaire est automatiquement créé dans le pool élastique de hello avec hello même nom. Si vous ajoutez une base de données qui a déjà une base de données secondaire dans le serveur secondaire de hello, géo-réplication est héritée par groupe de hello.

   > [!NOTE]
   > Lorsque vous ajoutez une base de données qui a déjà une base de données secondaire sur un serveur qui ne fait pas partie du groupe de basculement hello, une nouvelle base de données secondaire est créée dans le serveur secondaire de hello. 
   >

* **Écouteur du groupe de basculement en lecture-écriture**: la forme d’enregistrement CNAME DNS  **&lt;basculement-group-name&gt;. database.windows.net** qui pointe l’URL de serveur principal actuel toohello. Il permet de hello en lecture-écriture d’applications SQL tootransparently reconnecter toohello la base de données principale lorsque hello principale est modifiée après le basculement. 
* **Écouteur de groupe de basculement en lecture seule**: la forme d’enregistrement CNAME DNS  **&lt;basculement-group-name&gt;. secondary.database.windows.net** qui pointe l’URL du serveur secondaire toohello. Il permet de hello en lecture seule des applications SQL tootransparently se connecter à l’aide de hello de la base de données toohello secondaire spécifiés les règles de l’équilibrage de charge. Si vous le souhaitez, vous pouvez spécifier si vous souhaitez hello en lecture seule le trafic toobe automatiquement redirigés vers les serveur principal toohello lorsque le serveur secondaire de hello n’est pas disponible.
* **Stratégie de basculement automatique**: par défaut, le groupe de basculement hello est configuré avec une stratégie de basculement automatique. Hello système déclencheurs basculement dès que hello défaillance est détectée. Si vous souhaitez que le flux de travail de toocontrol hello basculement à partir de l’application hello, vous pouvez désactiver le basculement automatique. 
* **Basculement manuel**: vous pouvez opérer le basculement manuellement à tout moment, quelle que soit la configuration du basculement automatique hello. Si la stratégie de basculement automatique n’est pas configuré le basculement manuel est requis toorecover des bases de données dans le groupe de basculement hello. Vous pouvez lancer un basculement forcé ou convivial (avec synchronisation complète des données). Hello ce dernier peut être utilisé toorelocate hello active toohello principal la région du serveur. Lorsque le basculement est effectué les enregistrements DNS hello sont automatiquement mis à jour tooensure connectivité toohello correcte du serveur.
* **Période de grâce avec perte de données**: étant donné que les bases de données hello principal et secondaire sont synchronisées à l’aide de la réplication asynchrone hello basculement peut entraîner une perte de données. Vous pouvez personnaliser tooreflect de stratégie de basculement automatique hello toodata une perte de la tolérance de panne de votre application. En configurant **GracePeriodWithDataLossHours**, vous pouvez contrôler la durée d’attente de système de hello avant de lancer le basculement de hello tooresult probablement une perte de données. 

   > [!NOTE]
   > Lorsque système détecte que hello bases de données hello groupe sont toujours en ligne (par exemple, panne de hello uniquement affectées plan de contrôle de service hello), il active immédiatement un basculement hello avec la synchronisation complète des données (basculement convivial), quelle que soit la valeur de hello définir **GracePeriodWithDataLossHours**. Ce comportement garantit qu’il n’existe aucune perte de données lors de la récupération de hello. période de grâce de Hello prend effet uniquement quand un basculement convivial n’est pas possible. Si la panne de hello est atténuée avant l’expiration de la période de grâce de hello, hello basculement n’est pas activée.
   >

* **Plusieurs groupes de basculement**: vous pouvez configurer plusieurs groupes de basculement pour hello même paire de mise à l’échelle de serveurs toocontrol hello des basculements. Chaque groupe bascule indépendamment. Si votre application mutualisée utilise des pools élastiques, vous pouvez utiliser cette fonctionnalité toomix principaux et secondaires bases de données dans chaque pool. Cette façon, vous pouvez réduire l’impact de hello d’une panne de tooonly la moitié des locataires de hello.

## <a name="best-practices-of-building-highly-available-service"></a>Meilleures pratiques de création de service hautement disponible

toobuild un service hautement disponible qui utilise des clients de hello de base de données SQL Azure doit respecter les informations suivantes :
- **Utiliser un groupe de basculement** : un ou plusieurs groupes de basculement peuvent être créés entre deux serveurs situés dans des régions différentes (serveurs primaires et secondaires). Chaque groupe peut inclure un ou plusieurs bases de données qui sont récupérées en tant qu’unité dans le cas où toutes ou certaines bases de données primaires deviennent indisponibles en raison de la panne tooan dans la région principale de hello. groupe de basculement Hello crée la base de données de géo-réplication secondaire par hello même objectif que hello principal de service. Si vous ajoutez qu'un existant géo-réplication relation toohello basculement groupe Vérifiez que hello géo-secondaire est configuré avec hello même comme objectif de niveau de service hello principal.
- **Utiliser le port d’écoute en lecture-écriture pour la charge de travail OLTP**: lorsque vous effectuez l’utilisation d’opérations OLTP  **&lt;basculement-group-name&gt;. database.windows.net** comme URL du serveur hello et les connexions hello seront toohello automatiquement dirigé principal. Cette URL n’est pas modifié après le basculement de hello.  
Remarque hello basculement implique la mise à jour hello d’enregistrement DNS pour que les connexions clientes hello soit redirigé toohello nouveau cache DNS principal uniquement après les client hello est actualisé.
- **Utilisez écouteur en lecture seule pour les charges de travail en lecture seule**: Si vous avez un logiquement isolée en lecture seule charge de travail péremption toocertain à tolérance de panne de données, vous pouvez utiliser la base de données secondaire hello dans l’application hello. Pour utilisent des sessions en lecture seule  **&lt;basculement-group-name&gt;. secondary.database.windows.net** comme URL du serveur hello et connexion de hello sera automatiquement dirigé toohello secondaire. Il est également recommandé d’indiquer dans la tentative de lecture de la chaîne de connexion à l’aide de **ApplicationIntent = ReadOnly**. 
- **Attendez-vous à une dégradation des performances**: la décision de basculement SQL est indépendante de rest hello d’application hello ou d’autres services utilisés. application Hello peut être « mixed » avec certains composants dans une région et d’autres dans un autre. dégradation de hello tooavoid, le déploiement redondant application hello dans la région de hello récupération d’urgence et suivez les instructions de hello dans cet article.  
Remarque hello application dans la région de récupération d’urgence hello n’a pas de toouse une chaîne de connexion différents.  
- **Préparer la perte de données**: si une panne est détectée, SQL déclenche automatiquement en lecture-écriture de basculement s’il existe zéro toohello de perte de données de notre base de connaissances. Dans le cas contraire, il attend hello délai vous **GracePeriodWithDataLossHours**. Si vous avez spécifié **GracePeriodWithDataLossHours**, attendez-vous à une perte de données. En général, en cas de panne, Azure favorise la disponibilité. Si vous ne pouvez pas vous permettre de perte de données, assurez-vous que tooset **GracePeriodWithDataLossHours** tooa suffisamment grand nombre, tels que des dernières 24 heures. 


## <a name="upgrading-or-downgrading-a-primary-database"></a>Mise à niveau ou rétrogradation d’une base de données primaire
Vous pouvez mettre à niveau ou rétrograder un niveau de performance différents de tooa de base de données primaire (dans hello même niveau de service) sans déconnecter toutes les bases de données secondaires. Lors de la mise à niveau, nous vous recommandons que vous mettre à niveau de base de données secondaire hello tout d’abord, puis mettez à niveau hello principal. Lorsque vous rétrogradez, inverser l’ordre de hello : rétrograder hello principal tout d’abord, puis passer hello secondaire. Lorsque vous mettez à niveau ou passer le niveau de service différents tooa hello cette recommandation est appliquée. 

> [!NOTE]
> Si vous avez créé la base de données secondaire dans le cadre de la configuration du groupe de basculement hello il n’est pas base de données secondaire toodowngrade recommandée hello. Il s’agit de tooensure votre couche données a suffisamment capacité tooprocess votre charge de travail normale après le basculement est activé. 
>

## <a name="preventing-hello-loss-of-critical-data"></a>Prévention des pertes de données critiques de hello
En raison de toohello une latence élevée des réseaux étendus, copie continue utilise un mécanisme de réplication asynchrone. La perte de certaines données reste donc inévitable en cas de défaillance. Or, pour certaines applications, une perte de données est inacceptable. tooprotect ces mises à jour critiques, un développeur d’applications peuvent appeler hello [sp_wait_for_database_copy_sync](https://msdn.microsoft.com/library/dn467644.aspx) procédure système immédiatement après avoir validé la transaction de hello. Appel de **sp_wait_for_database_copy_sync** hello blocs thread appelant jusqu'à ce que hello dernière transaction a été transmis toohello de base de données secondaire. Toutefois, il n’attend pas hello transmis transactions toobe relus et validée sur hello secondaire. **sp_wait_for_database_copy_sync** est le lien de copie continue spécifique tooa étendue. Tout utilisateur disposant de hello connexion droits toohello base de données primaire peut appeler cette procédure.

> [!NOTE]
> **sp_wait_for_database_copy_sync** empêchera la perte de données après un basculement, mais il ne garantira pas la synchronisation complète pour l’accès en lecture. Hello délai causé par une **sp_wait_for_database_copy_sync** appel de procédure peut être significatif et dépend de la taille de hello hello du journal des transactions au moment de l’appel de hello hello. 
> 

## <a name="programmatically-managing-failover-groups-and-active-geo-replication"></a>Gestion de la géo-réplication active et des groupes de basculement par programmation
Comme indiqué précédemment, les groupes de basculement automatique (en version préliminaire) et active géo-réplication peut également être gérée par programme à l’aide d’Azure PowerShell et hello API REST. Hello les tableaux suivants décrire ensemble hello des commandes disponibles.

**API de gestion de ressources Azure et en fonction du rôle de sécurité**: géo-réplication Active comprend un ensemble d’API du Gestionnaire de ressources Azure pour la gestion, y compris hello [API REST de Azure SQL Database](https://docs.microsoft.com/rest/api/sql/) et [Azure Applets de commande PowerShell](https://docs.microsoft.com/powershell/azure/overview). Ces API nécessite utilisation hello des groupes de ressources et prendre en charge la sécurité basée sur les rôles (RBAC). Pour plus d’informations sur la façon dont tooimplement accéder aux rôles, consultez [du contrôle d’accès](../active-directory/role-based-access-control-what-is.md).

> [!NOTE]
> Parmi les nouvelles fonctionnalités de géo-réplication active, plusieurs sont uniquement prises en charge avec [l’API REST de SQL Azure](https://msdn.microsoft.com/library/azure/mt163571.aspx) et les [applets de commande PowerShell d’Azure SQL Database](https://msdn.microsoft.com/library/azure/mt574084.aspx), basées sur [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md). Hello [(classique) REST API](https://msdn.microsoft.com/library/azure/dn505719.aspx) et [applets de commande de base de données SQL Azure (classique)](https://msdn.microsoft.com/library/azure/dn546723.aspx) sont pris en charge pour la compatibilité descendante à l’aide de hello API Azure Resource Manager sont recommandées. 
> 

## <a name="manage-sql-database-failover-using-using-transact-sql"></a>Gérer SQL de base de données de basculement à l’aide à l’aide de Transact-SQL

| Commande | Description |
| --- | --- |
| [ALTER DATABASE (Azure SQL Database)](https://msdn.microsoft.com/library/mt574871.aspx) |Utilisez Ajouter un serveur secondaire ON argument toocreate une base de données secondaire pour une base de données existante et démarre la réplication de données |
| [ALTER DATABASE (Azure SQL Database)](https://msdn.microsoft.com/library/mt574871.aspx) |Utiliser le basculement ou FORCE_FAILOVER_ALLOW_DATA_LOSS tooswitch un basculement de tooinitiate principal de base de données secondaire toobe |
| [ALTER DATABASE (Azure SQL Database)](https://msdn.microsoft.com/library/mt574871.aspx) |Utilisez tooterminate de supprimer le serveur secondaire sur une réplication de données entre une base de données SQL et de la base de données secondaire hello spécifié. |
| [sys.geo_replication_links (base de données SQL Azure)](https://msdn.microsoft.com/library/mt575501.aspx) |Retourne des informations sur tous les liens de réplication existante pour chaque base de données sur le serveur logique de base de données SQL Azure hello. |
| [sys.dm_geo_replication_link_status (base de données SQL Azure)](https://msdn.microsoft.com/library/mt575504.aspx) |Obtient hello dernière heure de la réplication, dernier décalage de réplication et autres informations sur le lien de réplication hello pour une base de données SQL. |
| [sys.dm_operation_status (base de données SQL Azure)](https://msdn.microsoft.com/library/dn270022.aspx) |Affiche l’état de hello pour toutes les opérations de base de données y compris l’état hello hello des liens de réplication. |
| [sp_wait_for_database_copy_sync (base de données SQL Azure)](https://msdn.microsoft.com/library/dn467644.aspx) |provoque la hello application toowait jusqu'à ce que toutes les transactions validées sont répliquées et acceptées par la base de données secondaire active hello. |
|  | |

## <a name="manage-sql-database-failover-using-using-powershell"></a>Gérer SQL de base de données de basculement à l’aide de l’aide de PowerShell

| Applet de commande | Description |
| --- | --- |
| [Get-AzureRmSqlDatabase](/powershell/module/azurerm.sql/get-azurermsqldatabase) |Obtient une ou plusieurs bases de données. |
| [New-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/new-azurermsqldatabasesecondary) |Crée une base de données secondaire pour une base de données existante puis lance la réplication des données. |
| [Set-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/set-azurermsqldatabasesecondary) |Bascule un basculement de principal tooinitiate toobe base de données secondaire. |
| [Remove-AzureRmSqlDatabaseSecondary](/powershell/module/azurerm.sql/remove-azurermsqldatabasesecondary) |Met fin à la réplication des données entre une base de données SQL et de la base de données secondaire hello spécifié. |
| [Get-AzureRmSqlDatabaseReplicationLink](/powershell/module/azurerm.sql/get-azurermsqldatabasereplicationlink) |Obtient les liens de géo-réplication hello entre une base de données SQL Azure et un groupe de ressources ou SQL Server. |
| [New-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   Cette commande crée un groupe de basculement et l’enregistre dans les serveurs primaire et secondaire|
| [Remove-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/remove-azurermsqldatabasefailovergroup) | Supprime le groupe de basculement hello à partir du serveur de hello, ainsi que tous les groupe hello de bases de données secondaires inclus |
| [Get-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/get-azurermsqldatabasefailovergroup) | Récupère la configuration du groupe de basculement hello |
| [Set-AzureRmSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/set-azurermsqldatabasefailovergroup) |   Modifie la configuration hello du groupe de basculement hello |
| [Switch-AzureRMSqlDatabaseFailoverGroup](/powershell/module/azurerm.sql/switch-azurermsqldatabasefailovergroup) | Basculement de déclencheurs de serveur secondaire toohello groupe de basculement hello |
|  | |

> [!IMPORTANT]
> Pour plus d’exemples de scripts, consultez [Configurer et basculer une base de données unique à l’aide de la géoréplication active](scripts/sql-database-setup-geodr-and-failover-database-powershell.md), [Configurer et basculer une base de données regroupée à l’aide de la géoréplication active](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md), et [Configurer et basculer un groupe de basculement pour une base de données unique (préversion)] (scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md.
>

## <a name="manage-sql-database-failover-using-hello-rest-api"></a>Gérer le basculement de base de données SQL à l’aide des API REST de hello
| API | Description |
| --- | --- |
| [.Créer ou mettre à jour la base de données (createMode=Restore)](/rest/api/sql/Databases/CreateOrUpdate) |Crée, met à jour ou restaure une base de données principale ou secondaire. |
| [Créer ou mettre à jour l’état de la base de données](/rest/api/sql/Databases/CreateOrUpdate) |État de hello retourne pendant une opération de création. |
| [Définir la base de données secondaire comme principale (basculement planifié)](https://docs.microsoft.com/rest/api/sql/replicationlinkss#ReplicationLinks_Failover) |Définit la base de données du réplica principal en basculant à partir de la base de données de réplica principal actuel hello. |
| [Définir la base de données secondaire comme principale (basculement non planifié)](https://docs.microsoft.com/rest/api/sql/replicationlinks#ReplicationLinks_FailoverAllowDataLoss) |Définit la base de données du réplica principal en basculant à partir de la base de données de réplica principal actuel hello. Cette opération peut entraîner une perte de données. |
| [Obtenir un lien de réplication](/rest/api/sql/replicationlinks/get) |Obtient un liens de réplication spécifique pour une base de données SQL particulière dans un partenariat de géo-réplication. Il récupère les informations de hello visibles dans la vue de catalogue sys.geo_replication_links hello. |
| [Liens de réplication - Liste par base de données](/rest/api/sql/replicationlinks/listbydatabase) | Obtient tous les liens de réplication pour une base de données SQL donnée dans un partenariat de géo-réplication. Il récupère les informations de hello visibles dans la vue de catalogue sys.geo_replication_links hello. |
| [Supprimer un lien de réplication](/rest/api/sql/databases/delete) | Supprime un lien de réplication de base de données. Opération impossible pendant le basculement. |
| [Créer ou mettre à jour un groupe de basculement]/rest/api/sql/failovergroups/createorupdate) | Crée ou met à jour un groupe de basculement |
| [Supprimer un groupe de basculement](/rest/api/sql/failovergroups/delete) | Supprime le groupe de basculement hello à partir du serveur de hello |
| [Basculement (planifié)](/rest/api/sql/failovergroups/failover) | Bascule du serveur toothis serveur principal actuel de hello. |
| [Forcer le basculement et autoriser la perte de données](/rest/api/sql/failovergroups/forcefailoverallowdataloss) |ails sur serveur toothis serveur principal actuel de hello. Cette opération peut entraîner une perte de données. |
| [Get Failover Group](/rest/api/sql/failovergroups/get) (Obtenir un groupe de basculement) | Obtient un groupe de basculement. |
| [Répertorier les groupes de basculement par serveur](/rest/api/sql/failovergroups/listbyserver) | Répertorie les groupes de basculement hello dans un serveur. |
| [Mettre à jour un groupe de basculement](/rest/api/sql/failovergroups/update) | Met à jour un groupe de basculement. |
|  | |

## <a name="next-steps"></a>Étapes suivantes
* Pour obtenir des exemples de scripts, consultez :
   - [Configurer et basculer une base de données unique à l’aide de la géoréplication active](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
   - [Configurer et basculer une base de données regroupée à l’aide de la géoréplication active](scripts/sql-database-setup-geodr-and-failover-pool-powershell.md)
   - [Configurer et basculer un groupe de basculement pour une base de données unique (préversion)](scripts/sql-database-setup-geodr-failover-database-failover-group-powershell.md)
* Pour une vue d’ensemble de la continuité des activités et des scénarios, consultez [Vue d’ensemble de la continuité des activités](sql-database-business-continuity.md)
* toolearn sur les sauvegardes de base de données SQL Azure automatisée, consultez [base de données SQL des sauvegardes automatisées](sql-database-automated-backups.md).
* toolearn sur l’utilisation des sauvegardes automatisées pour la récupération, consultez [restaurer une base de données à partir de sauvegardes de hello initiées par le service](sql-database-recovery-using-backups.md).
* toolearn sur les exigences d’authentification pour un nouveau serveur principal et de la base de données, consultez [sécurité de base de données SQL après la récupération d’urgence](sql-database-geo-replication-security-config.md).

