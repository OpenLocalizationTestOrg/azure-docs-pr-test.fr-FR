---
title: "requêtes d’analytique ad-hoc aaaRun entre plusieurs bases de données SQL Azure | Documents Microsoft"
description: "Exécuter des requêtes ad-hoc analytique sur plusieurs bases de données SQL dans l’application de hello Wingtip SaaS mutualisée."
keywords: "didacticiel sur les bases de données SQL"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="615ba-104">Exécuter des requêtes d’analyse ad hoc sur tous les SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="615ba-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="615ba-105">Dans ce didacticiel, vous exécutez des requêtes distribuées sur l’ensemble de hello de bases de données clientes tooenable ad-hoc analytique.</span><span class="sxs-lookup"><span data-stu-id="615ba-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="615ba-106">Requête élastique est utilisé tooenable distribué requêtes, ce qui nécessite une base de données analytique supplémentaires est déployé (serveur de catalogue toohello).</span><span class="sxs-lookup"><span data-stu-id="615ba-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="615ba-107">Ces requêtes peuvent extraire des informations utiles dans les données opérationnelles de hello quotidiennes d’application de Wingtip SaaS hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="615ba-108">Ce didacticiel vous apprend à effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="615ba-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="615ba-109">À propos des affichages globaux de hello dans chaque base de données, qui permettent l’interrogation efficace sur les clients</span><span class="sxs-lookup"><span data-stu-id="615ba-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="615ba-110">Comment toodeploy une base de données analytique ad hoc</span><span class="sxs-lookup"><span data-stu-id="615ba-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="615ba-111">Comment toorun les requêtes distribuées sur toutes les bases de données client</span><span class="sxs-lookup"><span data-stu-id="615ba-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="615ba-112">toocomplete ce didacticiel, assurez-vous que hello est suivant des conditions préalables requises sont effectuées :</span><span class="sxs-lookup"><span data-stu-id="615ba-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="615ba-113">Hello Wingtip SaaS application est déployée.</span><span class="sxs-lookup"><span data-stu-id="615ba-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="615ba-114">toodeploy en moins de cinq minutes, consultez [déployer et Explorer hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="615ba-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="615ba-115">Azure PowerShell est installé.</span><span class="sxs-lookup"><span data-stu-id="615ba-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="615ba-116">Pour plus d’informations, consultez [Bien démarrer avec Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="615ba-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="615ba-117">SQL Server Management Studio (SSMS) est installé.</span><span class="sxs-lookup"><span data-stu-id="615ba-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="615ba-118">toodownload et installez SSMS, consultez [télécharger SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="615ba-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="615ba-119">Modèle d’analyse ad hoc</span><span class="sxs-lookup"><span data-stu-id="615ba-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="615ba-120">Une des opportunités de hello avec les applications SaaS est toouse hello grande quantité de données client stockées de manière centralisée dans le cloud de hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="615ba-121">Utilisez cette insights toogain de données dans l’opération de hello et de l’utilisation de votre application, vos clients, leurs utilisateurs, les préférences, comportements, etc.. Ces analyses peuvent guider le développement des fonctionnalités, les améliorations de convivialité et les autres investissements dans vos applications et services.</span><span class="sxs-lookup"><span data-stu-id="615ba-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="615ba-122">L’accès à ces données dans une base de données mutualisée est facile, mais pas si simple lors d’une distribution à grande échelle sur des milliers de bases de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="615ba-123">Une approche consiste à toouse [requête élastique](sql-database-elastic-query-overview.md), ce qui permet l’interrogation sur un ensemble distribué de bases de données avec un schéma commun.</span><span class="sxs-lookup"><span data-stu-id="615ba-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="615ba-124">Requête élastique utilise un seul *head* base de données dans lequel les tables externes sont définies que les tables de mise en miroir ou des vues dans hello distribué bases de données (client).</span><span class="sxs-lookup"><span data-stu-id="615ba-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="615ba-125">Les requêtes envoyées toothis principal de base de données est compilée tooproduce un plan de requête distribuée, avec des parties de requête hello poussée vers le bas toohello bases de données client en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="615ba-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="615ba-126">Requête élastique utilise la carte de partitions hello dans emplacement du hello tooprovide hello catalogue de base de données de bases de données clientes hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="615ba-127">La configuration et les requêtes sont simples grâce à l’utilisation de [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference) standard, et les requêtes ad hoc sont compatibles avec des outils tels que Power BI et Excel.</span><span class="sxs-lookup"><span data-stu-id="615ba-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="615ba-128">En répartissant les requêtes sur les bases de données clientes hello, requête élastique fournit l’idée immédiate des données de production.</span><span class="sxs-lookup"><span data-stu-id="615ba-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="615ba-129">Toutefois, comme élastique requête extrait des données potentiellement de nombreuses bases de données, latence peut parfois être supérieure à celle des requêtes équivalentes de requête soumise tooa unique base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="615ba-130">Soyez vigilant lors de la conception interroge les données de hello toominimize qui sont retournées.</span><span class="sxs-lookup"><span data-stu-id="615ba-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="615ba-131">Requête élastique souvent convient pour l’interrogation de petites quantités de données en temps réel, rapports ou des requêtes complexes analytique ou opposition toobuilding fréquemment utilisés.</span><span class="sxs-lookup"><span data-stu-id="615ba-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="615ba-132">Si les requêtes ne fonctionne bien, regardez hello [plan d’exécution](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee quelle partie de la requête de hello ont été envoyée vers le bas de la base de données distante toohello et la quantité de données est retournée.</span><span class="sxs-lookup"><span data-stu-id="615ba-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="615ba-133">Les requêtes nécessitant un traitement d’analyse complexe renvoient parfois de meilleurs résultats si les données client sont extraites dans une base de données dédiée ou un entrepôt de données optimisé pour les requêtes d’analyse.</span><span class="sxs-lookup"><span data-stu-id="615ba-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="615ba-134">Ce modèle est expliqué dans hello [didacticiel d’analytique locataire](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="615ba-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="615ba-135">Obtenir les scripts d’application hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="615ba-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="615ba-136">Hello Wingtip SaaS scripts et code source d’applications sont disponibles dans hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) référentiel github.</span><span class="sxs-lookup"><span data-stu-id="615ba-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="615ba-137">[Étapes de scripts de Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="615ba-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="615ba-138">Créer des données sur des ventes de tickets</span><span class="sxs-lookup"><span data-stu-id="615ba-138">Create ticket sales data</span></span>

<span data-ttu-id="615ba-139">toorun de requêtes sur un jeu de données plus intéressant, de créer des données de ventes de ticket en exécutant le Générateur de ticket hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="615ba-140">Bonjour *PowerShell ISE*, ouvrez hello... \\Modules d’apprentissage\\Analytique opérationnelle\\ad hoc Analytique\\*AdhocAnalytics.ps1 de démonstration* de script et définir hello valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="615ba-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="615ba-141">**$DemoScenario** = 1, **Acheter des tickets pour des événements dans tous les lieux**.</span><span class="sxs-lookup"><span data-stu-id="615ba-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="615ba-142">Appuyez sur **F5** pour exécuter le script de hello et générer des ventes de ticket.</span><span class="sxs-lookup"><span data-stu-id="615ba-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="615ba-143">Lors de l’exécution du script hello, continuez les étapes de hello dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="615ba-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="615ba-144">interrogation des données de ticket Hello Bonjour *exécuter des requêtes distribuée ad hoc* section, par conséquent, attendez hello ticket générateur toocomplete si elle est en cours d’exécution lorsque vous obtenez toothat exercice.</span><span class="sxs-lookup"><span data-stu-id="615ba-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="615ba-145">Explorer les affichages globaux hello</span><span class="sxs-lookup"><span data-stu-id="615ba-145">Explore hello global views</span></span>

<span data-ttu-id="615ba-146">Hello application Wingtip SaaS est construit à l’aide d’un modèle client-base de données, schéma de base de données client hello est défini à partir d’un point de vue du locataire unique.</span><span class="sxs-lookup"><span data-stu-id="615ba-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="615ba-147">Les informations propres au client existent dans une table nommée *Venue*, qui comporte une seule ligne et qui apparaît sous forme de segment de mémoire sans clé primaire.</span><span class="sxs-lookup"><span data-stu-id="615ba-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="615ba-148">Autres tables dans le schéma de hello n’est pas nécessaire toobe lié toohello *lieu* de table, car en usage normal, il n’est jamais un doute sur les données de hello du client appartient à.</span><span class="sxs-lookup"><span data-stu-id="615ba-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="615ba-149">Toutefois, lors de l’interrogation sur toutes les bases de données, il est important que requête élastique peut traiter les données de salutation comme s’il fait partie d’une seule base de données logique partitionnée par le client.</span><span class="sxs-lookup"><span data-stu-id="615ba-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="615ba-150">tooachieve cela, un ensemble de vues 'globales' sont ajouté toohello client base de données de projet un id de client dans chacune des tables de hello sont interrogées globalement.</span><span class="sxs-lookup"><span data-stu-id="615ba-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="615ba-151">Par exemple, hello *VenueEvents* vue ajoute un calculée *VenueId* toohello colonnes projetées de hello *événements* table.</span><span class="sxs-lookup"><span data-stu-id="615ba-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="615ba-152">En définissant la table externe de hello dans la base de données principal hello sur *VenueEvents* (au lieu de hello sous-jacent *événements* table), requête élastique est en mesure de toopush vers le bas des jointures basées sur *VenueId* afin qu’ils peuvent être exécutés en parallèle sur chaque base de données distante (et non sur la base de données principal hello).</span><span class="sxs-lookup"><span data-stu-id="615ba-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="615ba-153">Cela réduit considérablement la quantité de hello de données qui sont retournées, ce qui entraîne une augmentation importante des performances pour de nombreuses requêtes.</span><span class="sxs-lookup"><span data-stu-id="615ba-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="615ba-154">Ces vues globales ont été créées au préalable dans toutes les bases de données client (et dans *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="615ba-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="615ba-155">Ouvrez SSMS et [connecter toohello tenants1 -&lt;utilisateur&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="615ba-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="615ba-156">Développez **Bases de données**, cliquez avec le bouton droit sur **contosoconcerthall**, puis sélectionnez **Nouvelle requête**.</span><span class="sxs-lookup"><span data-stu-id="615ba-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="615ba-157">Exécutez hello suivant la différence de hello tooexplore requêtes entre les tables de locataire unique de hello et les affichages globaux hello :</span><span class="sxs-lookup"><span data-stu-id="615ba-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="615ba-158">Dans ces modes, hello *VenueId* est calculée comme un hachage du nom de salle hello, mais une approche peut être utilisé toointroduce une valeur unique.</span><span class="sxs-lookup"><span data-stu-id="615ba-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="615ba-159">Cette approche est toohello comme clé de locataire hello est calculée pour une utilisation dans le catalogue de hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="615ba-160">définition de hello tooexamine Hello *lieux* vue :</span><span class="sxs-lookup"><span data-stu-id="615ba-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="615ba-161">Dans **Explorateur d’objets**, développez **contosoconcethall** > **Vues** :</span><span class="sxs-lookup"><span data-stu-id="615ba-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![vues](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="615ba-163">Cliquez avec le bouton droit sur **dbo.Venues**.</span><span class="sxs-lookup"><span data-stu-id="615ba-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="615ba-164">Sélectionnez **Générer un script de la vue en tant que** > **CRÉER vers** > **Nouvelle fenêtre d’éditeur de requête**</span><span class="sxs-lookup"><span data-stu-id="615ba-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="615ba-165">Générer un script des hello autres *lieu* vues toosee comment ils ajoutent hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="615ba-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="615ba-166">Déployer hello de base de données utilisé pour les requêtes distribuée ad hoc</span><span class="sxs-lookup"><span data-stu-id="615ba-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="615ba-167">Cet exercice déploie hello *adhocanalytics* base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="615ba-168">Il s’agit de hello principal base de données qui contiendra le schéma hello utilisé pour l’interrogation de toutes les bases de données client.</span><span class="sxs-lookup"><span data-stu-id="615ba-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="615ba-169">base de données Hello est déployé toohello existante du serveur de catalogue, qui est utilisé pour tous les liées à la gestion de bases de données dans l’exemple d’application hello hello le serveur.</span><span class="sxs-lookup"><span data-stu-id="615ba-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="615ba-170">Ouvrir... \\Modules d’apprentissage\\Analytique opérationnelle\\ad hoc Analytique\\*AdhocAnalytics.ps1 de démonstration* Bonjour *PowerShell ISE* et ensemble hello valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="615ba-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="615ba-171">**$DemoScenario** = 2, **Déployer la base de données d’analyse ad hoc**.</span><span class="sxs-lookup"><span data-stu-id="615ba-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="615ba-172">Appuyez sur **F5** toorun hello script et créer hello *adhocanalytics* base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="615ba-173">Dans la section suivante de hello, vous ajoutez de base de données de schéma toohello afin qu’il peut être utilisé toorun distribué requêtes.</span><span class="sxs-lookup"><span data-stu-id="615ba-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="615ba-174">Configurer hello de base de données pour l’exécution de requêtes distribuées</span><span class="sxs-lookup"><span data-stu-id="615ba-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="615ba-175">Cet exercice ajoute le schéma (source de données externe hello et définitions de table externe) toohello ad-hoc analytique de base de données qui permet l’interrogation de toutes les bases de données client.</span><span class="sxs-lookup"><span data-stu-id="615ba-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="615ba-176">Ouvrez SQL Server Management Studio et connectez-vous toohello créé à l’étape précédente de hello de la base de données ad hoc Analytique.</span><span class="sxs-lookup"><span data-stu-id="615ba-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="615ba-177">nom Hello de base de données hello sera adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="615ba-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="615ba-178">Ouvrez ...\Modules d’apprentissage\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* dans SSMS.</span><span class="sxs-lookup"><span data-stu-id="615ba-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="615ba-179">Passez en revue le script SQL de hello et notez hello suivantes :</span><span class="sxs-lookup"><span data-stu-id="615ba-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="615ba-180">Élastique la requête utilise un tooaccess étendue de base de données d’informations d’identification chaque des bases de données client hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="615ba-181">Ces informations d’identification doit toobe disponible dans toutes les bases de données hello et doivent normalement être accordée minimales hello requis tooenable ces requêtes ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="615ba-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![créer des informations d’identification](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="615ba-183">Hello source de données externe, qui est définie par carte de partitions toouse hello client dans la base de données de catalogue hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="615ba-184">Utilisez cette option en tant que source de données externe hello, les requêtes sont tooall distribuées de bases de données enregistrés dans le catalogue de hello lors de l’exécution de requête de hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="615ba-185">Étant donné que les noms de serveur sont différentes pour chaque déploiement, ce script d’initialisation obtient emplacement hello de base de données de catalogue hello en récupérant le serveur en cours de hello (@@servername) où le script de hello est exécutée.</span><span class="sxs-lookup"><span data-stu-id="615ba-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![créer une source de données externe](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="615ba-187">Hello des tables externes qui référencent des affichages globaux de hello décrites dans la section précédente de hello et défini avec **DISTRIBUTION = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="615ba-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="615ba-188">Étant donné que chaque *VenueId* mappe tooa de base de données unique, cela améliore les performances pour de nombreux scénarios comme indiqué dans la section suivante de hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![créer des tables externes](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="615ba-190">table locale de Hello *VenueTypes* qui est créé et rempli.</span><span class="sxs-lookup"><span data-stu-id="615ba-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="615ba-191">Cette table de données de référence étant courante dans toutes les bases de données client, il peut être représenté ici comme une table locale et remplis avec des données communes hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="615ba-192">Pour certaines requêtes, cela peut réduire hello quantité de données déplacées entre les bases de données clientes hello et hello *adhocanalytics* base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![créer une table](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="615ba-194">Si vous incluez des tables de référence de cette manière, être sûr de schéma de table tooupdate hello et les données chaque fois que vous mettez à jour les bases de données clientes hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="615ba-195">Appuyez sur **F5** toorun hello script et d’initialiser hello *adhocanalytics* base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="615ba-196">Vous pouvez à présent exécuter des requêtes distribuées et collecter des informations sur l’ensemble des clients !</span><span class="sxs-lookup"><span data-stu-id="615ba-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="615ba-197">Exécuter des requêtes distribuées ad hoc</span><span class="sxs-lookup"><span data-stu-id="615ba-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="615ba-198">Maintenant que hello *adhocanalytics* base de données est configurée, continuez et exécuter des requêtes distribuées.</span><span class="sxs-lookup"><span data-stu-id="615ba-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="615ba-199">Inclure le plan d’exécution hello pour mieux comprendre le fonctionnement d’où le traitement des requêtes hello se produit.</span><span class="sxs-lookup"><span data-stu-id="615ba-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="615ba-200">Lors de l’inspection de plan d’exécution de hello, pointez sur les icônes du plan hello pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="615ba-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="615ba-201">Toonote important, est le paramètre **DISTRIBUTION = SHARDED(VenueId)** quand nous avons défini la source de données externe hello, améliore les performances pour de nombreux scénarios.</span><span class="sxs-lookup"><span data-stu-id="615ba-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="615ba-202">Étant donné que chaque *VenueId* mappe tooa base de données unique, le filtrage est données facilement effectué à distance, qui retourne hello uniquement.</span><span class="sxs-lookup"><span data-stu-id="615ba-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="615ba-203">Ouvrir... \\Modules d’apprentissage\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* dans SSMS.</span><span class="sxs-lookup"><span data-stu-id="615ba-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="615ba-204">Assurez-vous que vous êtes connecté toohello **adhocanalytics** base de données.</span><span class="sxs-lookup"><span data-stu-id="615ba-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="615ba-205">Sélectionnez hello **requête** menu et cliquez sur **inclure le Plan d’exécution réel**</span><span class="sxs-lookup"><span data-stu-id="615ba-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="615ba-206">Mettez en surbrillance hello *les lieux actuellement inscrits ?* requête, puis appuyez sur **F5**.</span><span class="sxs-lookup"><span data-stu-id="615ba-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="615ba-207">requête de Hello renvoie la liste entière lieu hello, illustrant comment rapide et il est facile de tooquery sur tous les locataires et retourner des données de chaque client.</span><span class="sxs-lookup"><span data-stu-id="615ba-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="615ba-208">Inspecter le plan de hello et que la totalité des coûts hello est requête distante de hello, car nous sommes simplement continu tooeach base de données client et en sélectionnant des informations de lieu hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![SELECT * FROM dbo.Venues](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="615ba-210">Les requêtes suivant hello sélectionnez, puis appuyez sur **F5**.</span><span class="sxs-lookup"><span data-stu-id="615ba-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="615ba-211">Cette requête joint les données de bases de données clientes hello et hello local *VenueTypes* table (locale, tel qu’il est une table dans hello *adhocanalytics* base de données).</span><span class="sxs-lookup"><span data-stu-id="615ba-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="615ba-212">Inspecter le plan de hello et voir ce hello majorité des coûts est la requête distante de hello, car nous interroger les informations de lieu de chaque client (dbo. Salles), puis effectuez une jointure locale rapide avec hello local *VenueTypes* nom convivial de table toodisplay hello.</span><span class="sxs-lookup"><span data-stu-id="615ba-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Joindre des données locales et distantes](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="615ba-214">Sélectionnez à présent hello *jour ont été hello la plupart des tickets vendues ?* requête, puis appuyez sur **F5**.</span><span class="sxs-lookup"><span data-stu-id="615ba-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="615ba-215">Cette requête effectue une opération de jointure et d’agrégation un peu plus complexe.</span><span class="sxs-lookup"><span data-stu-id="615ba-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="615ba-216">Toonote important est que la plupart du traitement de hello est effectuée à distance, et une fois encore, nous récupérer uniquement les lignes hello que nous avons besoin, retourner une seule ligne pour le nombre de vente de chaque salle ticket d’agrégation par jour.</span><span class="sxs-lookup"><span data-stu-id="615ba-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="615ba-218">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="615ba-218">Next steps</span></span>

<span data-ttu-id="615ba-219">Dans ce didacticiel, vous avez appris à effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="615ba-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="615ba-220">Exécuter des requêtes distribuées sur toutes les bases de données client</span><span class="sxs-lookup"><span data-stu-id="615ba-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="615ba-221">Déployer une base de données analytique ad hoc et ajouter des requêtes de schéma tooit toorun distribué.</span><span class="sxs-lookup"><span data-stu-id="615ba-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="615ba-222">Essayez maintenant hello [didacticiel du locataire Analytique](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extraction tooa analytique distincts de données pour un traitement plus complexe analytique...</span><span class="sxs-lookup"><span data-stu-id="615ba-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="615ba-223">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="615ba-223">Additional resources</span></span>

* <span data-ttu-id="615ba-224">Supplémentaires [didacticiels qui reposent sur hello application Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="615ba-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="615ba-225">Requête élastique</span><span class="sxs-lookup"><span data-stu-id="615ba-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
