---
title: "Gérer le schéma Azure SQL Database dans une application mutualisée | Microsoft Docs"
description: "Gérer un schéma pour plusieurs locataires dans une application mutualisée qui utilise Azure SQL Database"
keywords: "didacticiel sur les bases de données SQL"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: billgib; sstein
ms.openlocfilehash: 78d76efb88bf11fa18a416b59e6f881539141232
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="manage-schema-for-multiple-tenants-in-the-wingtip-saas-application"></a><span data-ttu-id="1aeee-104">Gérer un schéma pour plusieurs clients dans l’application SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="1aeee-104">Manage schema for multiple tenants in the Wingtip SaaS application</span></span>

<span data-ttu-id="1aeee-105">Le [premier didacticiel SaaS Wingtip](sql-database-saas-tutorial.md) montre comment l’application peut approvisionner une base de données client et l’enregistrer dans le catalogue.</span><span class="sxs-lookup"><span data-stu-id="1aeee-105">The [first Wingtip SaaS tutorial](sql-database-saas-tutorial.md) shows how the app can provision a tenant database and register it in the catalog.</span></span> <span data-ttu-id="1aeee-106">Comme n’importe quelle application, l’application SaaS Wingtip évolue au fil du temps et nécessite parfois l’apport de modifications à la base de données.</span><span class="sxs-lookup"><span data-stu-id="1aeee-106">Like any application, the Wingtip SaaS app will evolve over time, and at times will require changes to the database.</span></span> <span data-ttu-id="1aeee-107">Ces modifications peuvent inclure un schéma nouveau ou modifié, des données de référence nouvelles ou modifiées et des tâches de maintenance de routine de la base de données pour garantir des performances optimales de l’application.</span><span class="sxs-lookup"><span data-stu-id="1aeee-107">Changes may include new or changed schema, new or changed reference data, and routine database maintenance tasks to ensure optimal app performance.</span></span> <span data-ttu-id="1aeee-108">Avec une application SaaS, ces modifications doivent être déployées de façon coordonnée dans un parc potentiellement immense de bases de données de locataire.</span><span class="sxs-lookup"><span data-stu-id="1aeee-108">With a SaaS application, these changes need to be deployed in a coordinated manner across a potentially massive fleet of tenant databases.</span></span> <span data-ttu-id="1aeee-109">Ces modifications doivent être incorporées au processus d’approvisionnement pour apparaître dans les futures bases de données client.</span><span class="sxs-lookup"><span data-stu-id="1aeee-109">For these changes to be in future tenant databases, they need to be incorporated into the provisioning process.</span></span>

<span data-ttu-id="1aeee-110">Ce didacticiel explore deux scénarios : le déploiement de mises à jour des données de référence pour tous les locataires et la reconstruction d’un index sur la table contenant les données de référence.</span><span class="sxs-lookup"><span data-stu-id="1aeee-110">This tutorial explores two scenarios - deploying reference data updates for all tenants, and retuning an index on the table containing the reference data.</span></span> <span data-ttu-id="1aeee-111">La fonctionnalité de [travaux élastiques](sql-database-elastic-jobs-overview.md) est utilisée pour exécuter ces opérations sur l’ensemble des clients et sur la base de données de client *principale* qui sert de modèle pour les nouvelles bases de données.</span><span class="sxs-lookup"><span data-stu-id="1aeee-111">The [Elastic jobs](sql-database-elastic-jobs-overview.md) feature is used to execute these operations across all tenants, and the *golden* tenant database that is used as a template for new databases.</span></span>

<span data-ttu-id="1aeee-112">Ce tutoriel vous montre comment effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="1aeee-112">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1aeee-113">Créer un compte de travail</span><span class="sxs-lookup"><span data-stu-id="1aeee-113">Create a job account</span></span>
> * <span data-ttu-id="1aeee-114">Interroger plusieurs clients</span><span class="sxs-lookup"><span data-stu-id="1aeee-114">Query across multiple tenants</span></span>
> * <span data-ttu-id="1aeee-115">Mettre à jour les données dans toutes les bases de données de locataire</span><span class="sxs-lookup"><span data-stu-id="1aeee-115">Update data in all tenant databases</span></span>
> * <span data-ttu-id="1aeee-116">Créer un index sur une table dans toutes les bases de données de locataire</span><span class="sxs-lookup"><span data-stu-id="1aeee-116">Create an index on a table in all tenant databases</span></span>


<span data-ttu-id="1aeee-117">Pour suivre ce didacticiel, vérifiez que les conditions préalables ci-dessous sont bien satisfaites :</span><span class="sxs-lookup"><span data-stu-id="1aeee-117">To complete this tutorial, make sure the following prerequisites are met:</span></span>

* <span data-ttu-id="1aeee-118">L’application SaaS Wingtip est déployée.</span><span class="sxs-lookup"><span data-stu-id="1aeee-118">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="1aeee-119">Pour procéder à un déploiement en moins de cinq minutes, consultez la page [Déployer et explorer une application SaaS Wingtip](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="1aeee-119">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="1aeee-120">Azure PowerShell est installé.</span><span class="sxs-lookup"><span data-stu-id="1aeee-120">Azure PowerShell is installed.</span></span> <span data-ttu-id="1aeee-121">Pour plus d’informations, consultez [Bien démarrer avec Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="1aeee-121">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="1aeee-122">La dernière version de SQL Server Management Studio (SSMS) est installée.</span><span class="sxs-lookup"><span data-stu-id="1aeee-122">The latest version of SQL Server Management Studio (SSMS) is installed.</span></span> [<span data-ttu-id="1aeee-123">Télécharger et installer SSMS</span><span class="sxs-lookup"><span data-stu-id="1aeee-123">Download and Install SSMS</span></span>](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)

<span data-ttu-id="1aeee-124">*Ce didacticiel utilise des fonctionnalités du service SQL Database en préversion limitée (travaux de base de données élastiques). Si vous souhaitez réaliser ce didacticiel, envoyez votre ID d’abonnement à SaaSFeedback@microsoft.com avec l’objet Préversion des travaux élastiques. Une fois que vous avez reçu la confirmation que votre abonnement a été activé, [téléchargez et installez les dernières applets de commande pour les travaux en version préliminaire](https://github.com/jaredmoo/azure-powershell/releases). Cette version préliminaire est limitée. Contactez SaaSFeedback@microsoft.com pour toute question ou demande de prise en charge associées.*</span><span class="sxs-lookup"><span data-stu-id="1aeee-124">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>


## <a name="introduction-to-saas-schema-management-patterns"></a><span data-ttu-id="1aeee-125">Présentation des modèles de gestion de schéma SaaS</span><span class="sxs-lookup"><span data-stu-id="1aeee-125">Introduction to SaaS Schema Management patterns</span></span>

<span data-ttu-id="1aeee-126">Le modèle SaaS de base de données à un seul locataire bénéficie à de nombreux égards de l’isolation des données qui en résulte, mais il s’accompagne également de la complexité associée à la maintenance et à la gestion d’un grand nombre de bases de données.</span><span class="sxs-lookup"><span data-stu-id="1aeee-126">The single tenant per database SaaS pattern benefits in many ways from the data isolation that results, but at the same time introduces the additional complexity of maintaining and managing many databases.</span></span> <span data-ttu-id="1aeee-127">Les [travaux élastiques](sql-database-elastic-jobs-overview.md) facilitent l’administration et la gestion de la couche de données SQL.</span><span class="sxs-lookup"><span data-stu-id="1aeee-127">[Elastic Jobs](sql-database-elastic-jobs-overview.md) facilitates administration and management of the SQL data tier.</span></span> <span data-ttu-id="1aeee-128">Les travaux vous permettent d’exécuter de manière sécurisée et fiable des tâches (scripts T-SQL) indépendantes des interactions ou des entrées des utilisateurs sur un groupe de bases de données.</span><span class="sxs-lookup"><span data-stu-id="1aeee-128">Jobs enable you to securely and reliably, run tasks (T-SQL scripts) independent of user interaction or input, against a group of databases.</span></span> <span data-ttu-id="1aeee-129">Cette méthode peut être utilisée pour déployer les modifications de schéma et de données de référence commune sur tous les locataires d’une application.</span><span class="sxs-lookup"><span data-stu-id="1aeee-129">This method can be used to deploy schema and common reference data changes across all tenants in an application.</span></span> <span data-ttu-id="1aeee-130">Les travaux élastiques permettent également de maintenir à jour une copie *principale* de la base de données utilisée pour créer de nouveaux locataires afin de s’assurer qu’elle contient en permanence le schéma et les données de référence les plus récents.</span><span class="sxs-lookup"><span data-stu-id="1aeee-130">Elastic Jobs can also be used to maintain a *golden* copy of the database used to create new tenants, ensuring it always has the latest schema and reference data.</span></span>

![Écran](media/sql-database-saas-tutorial-schema-management/schema-management.png)


## <a name="elastic-jobs-limited-preview"></a><span data-ttu-id="1aeee-132">Préversion limitée des travaux élastiques</span><span class="sxs-lookup"><span data-stu-id="1aeee-132">Elastic Jobs limited preview</span></span>

<span data-ttu-id="1aeee-133">Il existe une nouvelle version des travaux élastiques qui est désormais une fonctionnalité intégrée d’Azure SQL Database (qui ne nécessite pas de services ou de composants supplémentaires).</span><span class="sxs-lookup"><span data-stu-id="1aeee-133">There is a new version of Elastic Jobs that is now an integrated feature of Azure SQL Database (that requires no additional services or components).</span></span> <span data-ttu-id="1aeee-134">Cette nouvelle version des travaux élastiques est pour le moment en préversion limitée.</span><span class="sxs-lookup"><span data-stu-id="1aeee-134">This new version of Elastic Jobs is currently in limited preview.</span></span> <span data-ttu-id="1aeee-135">Cette préversion limitée prend actuellement en charge PowerShell pour créer des comptes de travail et T-SQL pour créer et gérer des travaux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-135">This limited preview currently supports PowerShell to create job accounts, and T-SQL to create and manage jobs.</span></span>

> [!NOTE]
> <span data-ttu-id="1aeee-136">*Ce didacticiel utilise des fonctionnalités du service SQL Database en préversion limitée (travaux de base de données élastiques). Si vous souhaitez réaliser ce didacticiel, envoyez votre ID d’abonnement à SaaSFeedback@microsoft.com avec l’objet Préversion des travaux élastiques. Une fois que vous avez reçu la confirmation que votre abonnement a été activé, [téléchargez et installez les dernières applets de commande pour les travaux en version préliminaire](https://github.com/jaredmoo/azure-powershell/releases). Cette version préliminaire est limitée. Contactez SaaSFeedback@microsoft.com pour toute question ou demande de prise en charge associées.*</span><span class="sxs-lookup"><span data-stu-id="1aeee-136">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="1aeee-137">Obtenir les scripts d’application Wingtip</span><span class="sxs-lookup"><span data-stu-id="1aeee-137">Get the Wingtip application scripts</span></span>

<span data-ttu-id="1aeee-138">Les scripts et le code source de l’application SaaS Wingtip sont disponibles dans le référentiel GitHub [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS).</span><span class="sxs-lookup"><span data-stu-id="1aeee-138">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="1aeee-139">[Procédure de téléchargement des scripts SaaS Wingtip](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="1aeee-139">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-a-job-account-database-and-new-job-account"></a><span data-ttu-id="1aeee-140">Créer une base de données de compte de travail et un compte de travail</span><span class="sxs-lookup"><span data-stu-id="1aeee-140">Create a job account database and new job account</span></span>

<span data-ttu-id="1aeee-141">Ce didacticiel nécessite l’utilisation de PowerShell pour créer la base de données de compte de travail et le compte de travail.</span><span class="sxs-lookup"><span data-stu-id="1aeee-141">This tutorial requires you use PowerShell to create the job account database and job account.</span></span> <span data-ttu-id="1aeee-142">Comme MSDB et SQL Agent, les travaux élastiques s’appuient sur une base de données SQL Azure pour stocker les définitions, l’état et l’historique des travaux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-142">Like MSDB and SQL Agent, Elastic Jobs uses an Azure SQL database to store job definitions, job status, and history.</span></span> <span data-ttu-id="1aeee-143">Une fois le compte de travail créé, vous pouvez immédiatement créer et surveiller des travaux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-143">Once the job account is created, you can create and monitor jobs immediately.</span></span>

1. <span data-ttu-id="1aeee-144">Ouvrez …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* dans **PowerShell ISE**.</span><span class="sxs-lookup"><span data-stu-id="1aeee-144">Open …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* in the **PowerShell ISE**.</span></span>
1. <span data-ttu-id="1aeee-145">Appuyez sur **F5** pour exécuter le script.</span><span class="sxs-lookup"><span data-stu-id="1aeee-145">Press **F5** to run the script.</span></span>

<span data-ttu-id="1aeee-146">Le script *Demo-SchemaManagement.ps1* appelle le script *Deploy-SchemaManagement.ps1* pour créer une base de données *S2* nommée **jobaccount** sur le serveur de catalogue.</span><span class="sxs-lookup"><span data-stu-id="1aeee-146">The *Demo-SchemaManagement.ps1* script calls the *Deploy-SchemaManagement.ps1* script to create an *S2* database named **jobaccount** on the catalog server.</span></span> <span data-ttu-id="1aeee-147">Il crée ensuite le compte de travail en transmettant la base de données jobaccount en tant que paramètre à l’appel de création du compte de travail.</span><span class="sxs-lookup"><span data-stu-id="1aeee-147">It then creates the job account, passing the jobaccount database as a parameter to the job account creation call.</span></span>

## <a name="create-a-job-to-deploy-new-reference-data-to-all-tenants"></a><span data-ttu-id="1aeee-148">Créer un travail pour déployer les nouvelles données de référence sur tous les locataires</span><span class="sxs-lookup"><span data-stu-id="1aeee-148">Create a job to deploy new reference data to all tenants</span></span>

<span data-ttu-id="1aeee-149">Chaque base de données de locataire inclut un ensemble de types de lieux qui définissent le type d’événements qui se déroulent dans chacun de ces lieux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-149">Each tenant database includes a set of venue types that define the kind of events that are hosted at a venue.</span></span> <span data-ttu-id="1aeee-150">Dans cet exercice, vous allez déployer une mise à jour dans toutes les bases de données de locataire afin d’ajouter deux types de lieux supplémentaires : *Motorcycle Racing* (Courses de moto) *Swimming Club* (Club de natation).</span><span class="sxs-lookup"><span data-stu-id="1aeee-150">In this exercise, you deploy an update to all the tenant databases to add two additional venue types: *Motorcycle Racing* and *Swimming Club*.</span></span> <span data-ttu-id="1aeee-151">Ces types de lieux correspondent à l’image d’arrière-plan visible dans l’application que s’affiche dans l’application Events.</span><span class="sxs-lookup"><span data-stu-id="1aeee-151">These venue types correspond to the background image you see in the tenant events app.</span></span>

<span data-ttu-id="1aeee-152">Cliquez sur le menu déroulant Venue Type (Type de lieu) et vérifiez que 10 options seulement sont disponibles, et en particulier que la liste ne contient pas les options « Motorcycle Racing » et « Swimming Club ».</span><span class="sxs-lookup"><span data-stu-id="1aeee-152">Click the Venue Type drop down menu and validate that only 10 venue type options are available, and specifically that ‘Motorcycle Racing’ and ‘Swimming Club’ are not included in the list.</span></span>

<span data-ttu-id="1aeee-153">Maintenant, nous allons créer un travail pour mettre à jour la table *VenueTypes* dans toutes les bases de données de locataire et ajouter les nouveaux types de lieux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-153">Now let’s create a job to update the *VenueTypes* table in all the tenant databases and add the new venue types.</span></span>

<span data-ttu-id="1aeee-154">Pour créer un travail, nous utilisons un ensemble de procédures stockées système dédiées aux travaux créées dans la base de données jobaccount lors de la création du compte de travail.</span><span class="sxs-lookup"><span data-stu-id="1aeee-154">To create a new job, we use a set of jobs system stored procedures created in the jobaccount database when the job account was created.</span></span>

1. <span data-ttu-id="1aeee-155">Ouvrez SSMS et connectez-vous au serveur de catalogue catalog-\<user\>.database.windows.net.</span><span class="sxs-lookup"><span data-stu-id="1aeee-155">Open SSMS and connect to the catalog server: catalog-\<user\>.database.windows.net server</span></span>
1. <span data-ttu-id="1aeee-156">Connectez-vous également au serveur de locataire tenants1-\<user\>.database.windows.net.</span><span class="sxs-lookup"><span data-stu-id="1aeee-156">Also connect to the tenant server: tenants1-\<user\>.database.windows.net</span></span>
1. <span data-ttu-id="1aeee-157">Accédez à la base de données *contosoconcerthall* sur le serveur *tenants1* et interrogez la table *VenueTypes* pour vérifier que *Motorcycle Racing* et *Swimming Club* **ne figurent pas** dans la liste des résultats.</span><span class="sxs-lookup"><span data-stu-id="1aeee-157">Browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are not** in the results list.</span></span>
1. <span data-ttu-id="1aeee-158">Ouvrez le fichier ...\\Learning Modules\\Schema Management\\DeployReferenceData.sql.</span><span class="sxs-lookup"><span data-stu-id="1aeee-158">Open the file …\\Learning Modules\\Schema Management\\DeployReferenceData.sql</span></span>
1. <span data-ttu-id="1aeee-159">Modifiez l’instruction : SET @wtpUser = &lt;utilisateur&gt; et remplacer la valeur de l’utilisateur utilisée lors du déploiement de l’application Wingtip</span><span class="sxs-lookup"><span data-stu-id="1aeee-159">Modify the statement: SET @wtpUser = &lt;user&gt; and substitute the User value used when you deployed the Wingtip app</span></span>
1. <span data-ttu-id="1aeee-160">Assurez-vous que vous êtes connecté à la base de données jobaccount, puis appuyez sur **F5** pour exécuter le script.</span><span class="sxs-lookup"><span data-stu-id="1aeee-160">Ensure you are connected to the jobaccount database and press **F5** to run the script</span></span>

* <span data-ttu-id="1aeee-161">**sp\_add\_target\_group** crée le nom de groupe cible DemoServerGroup. Nous devons à présent ajouter des membres cibles.</span><span class="sxs-lookup"><span data-stu-id="1aeee-161">**sp\_add\_target\_group** creates the target group name DemoServerGroup, now we need to add target members.</span></span>
* <span data-ttu-id="1aeee-162">**sp\_add\_target\_group\_member** ajoute un type de membre cible *server*, qui juge toutes les bases de données dans ce serveur (notez qu’il s’agit du serveur tenants1-&lt;User&gt; contenant les bases de données client) au moment de l’exécution du travail devant être incluses dans le travail ; la deuxième ajoute un type de membre cible *database*, plus précisément la base de données « or » (basetenantdb) qui réside sur le serveur catalog-&lt;Utilisateur&gt; et enfin un autre type de membre de groupe *database* permettant d’inclure la base de données adhocanalytics utilisée dans un prochain didacticiel.</span><span class="sxs-lookup"><span data-stu-id="1aeee-162">**sp\_add\_target\_group\_member** adds a *server* target member type, which deems all databases within that server (note this is the tenants1-&lt;User&gt; server containing the tenant databases) at time of job execution should be included in the job, the second is adding a *database* target member type, specifically the ‘golden’ database (basetenantdb) that resides on catalog-&lt;User&gt; server, and lastly another *database* target group member type to include the adhocanalytics database that is used in a later tutorial.</span></span>
* <span data-ttu-id="1aeee-163">**sp\_add\_job** crée une tâche appelée « Reference Data Deployment » (Déploiement des données de référence).</span><span class="sxs-lookup"><span data-stu-id="1aeee-163">**sp\_add\_job** creates a job called “Reference Data Deployment”</span></span>
* <span data-ttu-id="1aeee-164">**sp\_add\_jobstep** crée l’étape du travail contenant le texte de la commande T-SQL pour mettre à jour la table de référence, VenueTypes.</span><span class="sxs-lookup"><span data-stu-id="1aeee-164">**sp\_add\_jobstep** creates the job step containing T-SQL command text to update the reference table, VenueTypes</span></span>
* <span data-ttu-id="1aeee-165">Les autres vues dans le script indiquent l’existence des objets et contrôlent l’exécution du travail.</span><span class="sxs-lookup"><span data-stu-id="1aeee-165">The remaining views in the script display the existence of the objects and monitor job execution.</span></span> <span data-ttu-id="1aeee-166">Utilisez ces requêtes pour passer en revue la valeur d’état dans la colonne **cycle de vie** afin de déterminer le moment où la tâche a été terminée avec succès sur toutes les bases de données client et deux autres bases de données contenant la table de référence.</span><span class="sxs-lookup"><span data-stu-id="1aeee-166">Use these queries to review the status value in the **lifecycle** column to determine when the job has successfully finished on all tenant databases and the two additional databases containing the reference table.</span></span>

1. <span data-ttu-id="1aeee-167">Dans SSMS, accédez à la base de données *contosoconcerthall* sur le serveur *tenants1* et interrogez la table *VenueTypes* pour vérifier que *Motorcycle Racing* et *Swimming Club* **figurent** à présent dans la liste des résultats.</span><span class="sxs-lookup"><span data-stu-id="1aeee-167">In SSMS, browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are** now in the results list.</span></span>


## <a name="create-a-job-to-manage-the-reference-table-index"></a><span data-ttu-id="1aeee-168">Créer une tâche pour gérer l’index de la table de référence</span><span class="sxs-lookup"><span data-stu-id="1aeee-168">Create a job to manage the reference table index</span></span>

<span data-ttu-id="1aeee-169">De façon similaire à l’exercice précédent, cet exercice crée un travail pour reconstruire l’index sur la clé primaire de la table de référence, une opération de gestion de base de données classique qu’un administrateur peut être amené à exécuter après le chargement d’un grand volume de données dans une table.</span><span class="sxs-lookup"><span data-stu-id="1aeee-169">Similar to the previous exercise, this exercise creates a job to rebuild the index on the reference table primary key, a typical database management operation an administrator might perform after a large data load into a table.</span></span>

<span data-ttu-id="1aeee-170">Créez un travail en utilisant les mêmes procédures stockées « système » dédiées aux travaux.</span><span class="sxs-lookup"><span data-stu-id="1aeee-170">Create a job using the same jobs 'system' stored procedures.</span></span>

1. <span data-ttu-id="1aeee-171">Ouvrez SSMS et connectez-vous au serveur catalog-&lt;User&gt;.database.windows.net.</span><span class="sxs-lookup"><span data-stu-id="1aeee-171">Open SSMS and connect to the catalog-&lt;User&gt;.database.windows.net server</span></span>
1. <span data-ttu-id="1aeee-172">Ouvrez le fichier ...\\Learning Modules\\Schema Management\\OnlineReindex.sql.</span><span class="sxs-lookup"><span data-stu-id="1aeee-172">Open the file …\\Learning Modules\\Schema Management\\OnlineReindex.sql</span></span>
1. <span data-ttu-id="1aeee-173">Si vous n’êtes pas déjà connecté, cliquez avec le bouton droit, sélectionnez Connexion et connectez-vous au serveur de catalogue &lt;User&gt;.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="1aeee-173">Right click, select Connection, and connect to the catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="1aeee-174">Assurez-vous que vous êtes connecté à la base de données jobaccount, puis appuyez sur F5 pour exécuter le script.</span><span class="sxs-lookup"><span data-stu-id="1aeee-174">Ensure you are connected to the jobaccount database and press F5 to run the script</span></span>

* <span data-ttu-id="1aeee-175">sp\_add\_job crée un travail appelé « Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885 ».</span><span class="sxs-lookup"><span data-stu-id="1aeee-175">sp\_add\_job creates a new job called “Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”</span></span>
* <span data-ttu-id="1aeee-176">sp\_add\_jobstep crée l’étape du travail contenant le texte de la commande T-SQL pour mettre à jour l’index.</span><span class="sxs-lookup"><span data-stu-id="1aeee-176">sp\_add\_jobstep creates the job step containing T-SQL command text to update the index</span></span>




## <a name="next-steps"></a><span data-ttu-id="1aeee-177">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1aeee-177">Next steps</span></span>

<span data-ttu-id="1aeee-178">Dans ce didacticiel, vous avez appris à effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="1aeee-178">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="1aeee-179">Créer un compte de travail élastique pour interroger plusieurs locataires</span><span class="sxs-lookup"><span data-stu-id="1aeee-179">Create a job account to query across multiple tenants</span></span>
> * <span data-ttu-id="1aeee-180">Mettre à jour les données dans toutes les bases de données de locataire</span><span class="sxs-lookup"><span data-stu-id="1aeee-180">Update data in all tenant databases</span></span>
> * <span data-ttu-id="1aeee-181">Créer un index sur une table dans toutes les bases de données de locataire</span><span class="sxs-lookup"><span data-stu-id="1aeee-181">Create an index on a table in all tenant databases</span></span>

[<span data-ttu-id="1aeee-182">Didacticiel sur les analyses ad hoc</span><span class="sxs-lookup"><span data-stu-id="1aeee-182">Ad-hoc analytics tutorial</span></span>](sql-database-saas-tutorial-adhoc-analytics.md)


## <a name="additional-resources"></a><span data-ttu-id="1aeee-183">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="1aeee-183">Additional resources</span></span>

* [<span data-ttu-id="1aeee-184">Autres didacticiels reposant sur le déploiement de l’application SaaS Wingtip</span><span class="sxs-lookup"><span data-stu-id="1aeee-184">Additional tutorials that build upon the Wingtip SaaS application deployment</span></span>](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [<span data-ttu-id="1aeee-185">Gestion des bases de données cloud avec montée en charge</span><span class="sxs-lookup"><span data-stu-id="1aeee-185">Managing scaled-out cloud databases</span></span>](sql-database-elastic-jobs-overview.md)
* [<span data-ttu-id="1aeee-186">Créer et gérer des bases de données cloud avec montée en charge</span><span class="sxs-lookup"><span data-stu-id="1aeee-186">Create and manage scaled-out cloud databases</span></span>](sql-database-elastic-jobs-create-and-manage.md)
