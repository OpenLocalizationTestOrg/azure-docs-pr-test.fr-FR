---
title: "requêtes d’analytique aaaRun sur plusieurs bases de données SQL Azure | Documents Microsoft"
description: "Extraire des données à partir de bases de données du locataire dans une base de données d’analyse pour une analyse hors connexion"
keywords: "didacticiel sur les bases de données SQL"
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/16/2017
ms.author: billgib; sstein
ms.openlocfilehash: f2664e4aafd2fecc98d20d229342bca19b0b08c1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="extract-data-from-tenant-databases-into-an-analytics-database-for-offline-analysis"></a><span data-ttu-id="5560a-104">Extraire des données à partir de bases de données du locataire dans une base de données d’analyse pour une analyse hors connexion</span><span class="sxs-lookup"><span data-stu-id="5560a-104">Extract data from tenant databases into an analytics database for offline analysis</span></span>

<span data-ttu-id="5560a-105">Dans ce didacticiel, vous utilisez une tâche élastique toorun l’interrogation chaque base de données client.</span><span class="sxs-lookup"><span data-stu-id="5560a-105">In this tutorial, you use an elastic job toorun queries against each tenant database.</span></span> <span data-ttu-id="5560a-106">travail de Hello extrait des données de ventes de ticket et les charge dans une base de données analytique (ou l’entrepôt de données) pour l’analyse.</span><span class="sxs-lookup"><span data-stu-id="5560a-106">hello job extracts ticket sales data and loads it into an analytics database (or data warehouse) for analysis.</span></span> <span data-ttu-id="5560a-107">Hello base de données analytique est ensuite interrogée insights tooextract à partir de ces données opérationnelles quotidiennes de tous les locataires.</span><span class="sxs-lookup"><span data-stu-id="5560a-107">hello analytics database is then queried tooextract insights from this day-to-day operational data of all tenants.</span></span>


<span data-ttu-id="5560a-108">Ce didacticiel vous explique comment effectuer les opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="5560a-108">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="5560a-109">Créer la base de données analytique hello client</span><span class="sxs-lookup"><span data-stu-id="5560a-109">Create hello tenant analytics database</span></span>
> * <span data-ttu-id="5560a-110">Créer une tâche planifiée des données tooretrieve et remplir la base de données analytique hello</span><span class="sxs-lookup"><span data-stu-id="5560a-110">Create a scheduled job tooretrieve data and populate hello analytics database</span></span>

<span data-ttu-id="5560a-111">toocomplete ce didacticiel, assurez-vous que hello est suivant les conditions préalables sont remplies :</span><span class="sxs-lookup"><span data-stu-id="5560a-111">toocomplete this tutorial, make sure hello following prerequisites are met:</span></span>

* <span data-ttu-id="5560a-112">Hello Wingtip SaaS application est déployée.</span><span class="sxs-lookup"><span data-stu-id="5560a-112">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="5560a-113">toodeploy en moins de cinq minutes, consultez [déployer et Explorer hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="5560a-113">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="5560a-114">Azure PowerShell est installé.</span><span class="sxs-lookup"><span data-stu-id="5560a-114">Azure PowerShell is installed.</span></span> <span data-ttu-id="5560a-115">Pour plus d’informations, consultez [Bien démarrer avec Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="5560a-115">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="5560a-116">version la plus récente Hello de SQL Server Management Studio (SSMS) est installée.</span><span class="sxs-lookup"><span data-stu-id="5560a-116">hello latest version of SQL Server Management Studio (SSMS) is installed.</span></span> [<span data-ttu-id="5560a-117">Télécharger et installer SSMS</span><span class="sxs-lookup"><span data-stu-id="5560a-117">Download and Install SSMS</span></span>](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)

## <a name="tenant-operational-analytics-pattern"></a><span data-ttu-id="5560a-118">Modèle d’analyse opérationnelle du locataire</span><span class="sxs-lookup"><span data-stu-id="5560a-118">Tenant Operational Analytics pattern</span></span>

<span data-ttu-id="5560a-119">Une des opportunités de hello avec les applications SaaS donnée toouse hello client riche qui est stocké dans le cloud de hello.</span><span class="sxs-lookup"><span data-stu-id="5560a-119">One of hello great opportunities with SaaS applications is toouse hello rich tenant data that is stored in hello cloud.</span></span> <span data-ttu-id="5560a-120">Utilisez cette insights toogain de données dans l’opération de hello et l’utilisation de votre application et vos clients.</span><span class="sxs-lookup"><span data-stu-id="5560a-120">Use this data toogain insights into hello operation and usage of your application, and your tenants.</span></span> <span data-ttu-id="5560a-121">Ces données peuvent guide de développement des fonctionnalités, de facilité d’utilisation et autres investissements dans l’application hello et la plateforme.</span><span class="sxs-lookup"><span data-stu-id="5560a-121">This data can guide feature development, usability improvements, and other investments in hello app and platform.</span></span> <span data-ttu-id="5560a-122">Lorsqu’il se fait dans une seule base de données mutualisée, l’accès à ces données est facile, mais pas si simple lors d’une distribution à grande échelle sur des milliers de bases de données.</span><span class="sxs-lookup"><span data-stu-id="5560a-122">Accessing this data when it's in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="5560a-123">Une approche tooaccessing ces données sont les travaux élastique toouse, qui permettent des résultats de la requête retourne des résultats à partir de la tâche d’exécution toobe est capturée dans une base de données de sortie et de la table.</span><span class="sxs-lookup"><span data-stu-id="5560a-123">One approach tooaccessing this data is toouse Elastic jobs, which enable result-returning query results from job execution toobe captured in an output database and table.</span></span>

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="5560a-124">Obtenir les scripts d’application hello Wingtip</span><span class="sxs-lookup"><span data-stu-id="5560a-124">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="5560a-125">Hello Wingtip SaaS scripts et code source d’applications sont disponibles dans hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) référentiel github.</span><span class="sxs-lookup"><span data-stu-id="5560a-125">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="5560a-126">[Étapes de scripts de Wingtip SaaS hello toodownload](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="5560a-126">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="deploy-a-database-for-tenant-analytics-results"></a><span data-ttu-id="5560a-127">Déployer une base de données pour les résultats d’analyse du locataire</span><span class="sxs-lookup"><span data-stu-id="5560a-127">Deploy a database for tenant analytics results</span></span>

<span data-ttu-id="5560a-128">Ce didacticiel requiert que vous toohave qu'un Bonjour déployé toocapture de base de données résultant de l’exécution du travail de scripts, qui contiennent des requêtes retournant des résultats.</span><span class="sxs-lookup"><span data-stu-id="5560a-128">This tutorial requires you toohave a database deployed toocapture hello results from job execution of scripts, which contain results-returning queries.</span></span> <span data-ttu-id="5560a-129">À cet effet, nous allons créer une base de données appelée tenantanalytics.</span><span class="sxs-lookup"><span data-stu-id="5560a-129">Let's create a database called tenantanalytics for this purpose.</span></span>

1. <span data-ttu-id="5560a-130">Ouvrir... \\Modules d’apprentissage\\Analytique opérationnelle\\locataire Analytique\\*TenantAnalyticsDB.ps1 de démonstration* Bonjour *PowerShell ISE* et définissez Hello valeur suivante :</span><span class="sxs-lookup"><span data-stu-id="5560a-130">Open …\\Learning Modules\\Operational Analytics\\Tenant Analytics\\*Demo-TenantAnalyticsDB.ps1* in hello *PowerShell ISE* and set hello following value:</span></span>
   * <span data-ttu-id="5560a-131">**$DemoScenario** = **2***Déployer une base de données d’analyse opérationnelle*</span><span class="sxs-lookup"><span data-stu-id="5560a-131">**$DemoScenario** = **2** *Deploy operational analytics database*</span></span>
1. <span data-ttu-id="5560a-132">Appuyez sur **F5** script de démo hello toorun (ce hello appels *TenantAnalyticsDB.ps1 de déployer* script) qui crée la base de données analytique hello client.</span><span class="sxs-lookup"><span data-stu-id="5560a-132">Press **F5** toorun hello demo script (that calls hello *Deploy-TenantAnalyticsDB.ps1* script) which creates hello tenant analytics database.</span></span>

## <a name="create-some-data-for-hello-demo"></a><span data-ttu-id="5560a-133">Créer des données pour une démonstration de hello</span><span class="sxs-lookup"><span data-stu-id="5560a-133">Create some data for hello demo</span></span>

1. <span data-ttu-id="5560a-134">Ouvrir... \\Modules d’apprentissage\\Analytique opérationnelle\\locataire Analytique\\*TenantAnalyticsDB.ps1 de démonstration* Bonjour *PowerShell ISE* et définissez Hello valeur suivante :</span><span class="sxs-lookup"><span data-stu-id="5560a-134">Open …\\Learning Modules\\Operational Analytics\\Tenant Analytics\\*Demo-TenantAnalyticsDB.ps1* in hello *PowerShell ISE* and set hello following value:</span></span>
   * <span data-ttu-id="5560a-135">**$DemoScenario** = **1***Acheter des tickets pour des événements dans tous les lieux*</span><span class="sxs-lookup"><span data-stu-id="5560a-135">**$DemoScenario** = **1** *Purchase tickets for events at all venues*</span></span>
1. <span data-ttu-id="5560a-136">Appuyez sur **F5** toorun hello script et créer un ticket de l’historique des achats.</span><span class="sxs-lookup"><span data-stu-id="5560a-136">Press **F5** toorun hello script and create ticket purchasing history.</span></span>


## <a name="create-a-scheduled-job-tooretrieve-tenant-analytics-about-ticket-purchases"></a><span data-ttu-id="5560a-137">Créer un analytique de locataire tooretrieve tâche planifiée sur des achats de ticket</span><span class="sxs-lookup"><span data-stu-id="5560a-137">Create a scheduled job tooretrieve tenant analytics about ticket purchases</span></span>

<span data-ttu-id="5560a-138">Ce script crée une travail tooretrieve fournisseur des informations à partir de tous les clients.</span><span class="sxs-lookup"><span data-stu-id="5560a-138">This script creates a job tooretrieve ticket purchase information from all tenants.</span></span> <span data-ttu-id="5560a-139">Une fois agrégées en une seule table, vous pouvez obtenir des métriques instructif riches sur un ticket d’achat de modèles sur les locataires hello.</span><span class="sxs-lookup"><span data-stu-id="5560a-139">Once aggregated into a single table, you can gain rich insightful metrics about ticket purchasing patterns across hello tenants.</span></span>

1. <span data-ttu-id="5560a-140">Ouvrez SSMS et se connecter toohello catalogue -&lt;utilisateur&gt;. database.windows.net server</span><span class="sxs-lookup"><span data-stu-id="5560a-140">Open SSMS and connect toohello catalog-&lt;user&gt;.database.windows.net server</span></span>
1. <span data-ttu-id="5560a-141">Ouvrez ...\\Modules d’apprentissage\\Operational Analytics\\Tenant Analytics\\*TicketPurchasesfromAllTenants.sql*.</span><span class="sxs-lookup"><span data-stu-id="5560a-141">Open ...\\Learning Modules\\Operational Analytics\\Tenant Analytics\\*TicketPurchasesfromAllTenants.sql*</span></span>
1. <span data-ttu-id="5560a-142">Modifier &lt;utilisateur&gt;, nom d’utilisateur utilisez hello utilisé lorsque vous avez déployé l’application de Wingtip SaaS hello haut hello du script de hello, **sp\_ajouter\_cible\_groupe\_membre** et **sp\_ajouter\_jobstep**</span><span class="sxs-lookup"><span data-stu-id="5560a-142">Modify &lt;User&gt;, use hello user name used when you deployed hello Wingtip SaaS app at hello top of hello script, **sp\_add\_target\_group\_member** and **sp\_add\_jobstep**</span></span>
1. <span data-ttu-id="5560a-143">Avec le bouton droit sur, sélectionnez **connexion**et vous connecter toohello catalogue -&lt;utilisateur&gt;. database.windows.net server, si vous êtes pas déjà connecté</span><span class="sxs-lookup"><span data-stu-id="5560a-143">Right click, select **Connection**, and connect toohello catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="5560a-144">Assurez-vous que vous êtes connecté toohello **jobaccount** base de données, puis appuyez sur **F5** pour exécuter le script de hello</span><span class="sxs-lookup"><span data-stu-id="5560a-144">Ensure you are connected toohello **jobaccount** database and press **F5** to run hello script</span></span>

* <span data-ttu-id="5560a-145">**SP\_ajouter\_cible\_groupe** crée le nom du groupe cible hello *TenantGroup*, maintenant nous avons besoin de membres de cibles tooadd.</span><span class="sxs-lookup"><span data-stu-id="5560a-145">**sp\_add\_target\_group** creates hello target group name *TenantGroup*, now we need tooadd target members.</span></span>
* <span data-ttu-id="5560a-146">**SP\_ajouter\_cible\_groupe\_membre** ajoute un *server* cibler un type de membre qui juge toutes les bases de données dans le serveur (Notez il s’agit hello customer1 - &lt;Utilisateur&gt; serveur contenant les bases de données clientes hello) au moment du travail de l’exécution doit être incluse dans la tâche de hello.</span><span class="sxs-lookup"><span data-stu-id="5560a-146">**sp\_add\_target\_group\_member** adds a *server* target member type, which deems all databases within that server (note this is hello customer1-&lt;User&gt; server containing hello tenant databases) at time of job execution should be included in hello job.</span></span>
* <span data-ttu-id="5560a-147">**sp\_add\_job** crée un nouveau travail hebdomadaire planifié appelé « Achat de tickets par tous les locataires ».</span><span class="sxs-lookup"><span data-stu-id="5560a-147">**sp\_add\_job** creates a new weekly scheduled job called “Ticket Purchases from all Tenants”</span></span>
* <span data-ttu-id="5560a-148">**SP\_ajouter\_jobstep** crée de toutes les informations d’achat de ticket hello étape de travail hello contenant tooretrieve de texte de commande T-SQL à partir de tous les locataires et hello copie retourner le jeu de résultats dans une table appelée  *AllTicketsPurchasesfromAllTenants*</span><span class="sxs-lookup"><span data-stu-id="5560a-148">**sp\_add\_jobstep** creates hello job step containing T-SQL command text tooretrieve all hello ticket purchase information from all tenants and copy hello returning result set into a table called *AllTicketsPurchasesfromAllTenants*</span></span>
* <span data-ttu-id="5560a-149">vues restantes de Hello dans le script de hello affichent existence hello d’objets de hello et de surveiller l’exécution du travail.</span><span class="sxs-lookup"><span data-stu-id="5560a-149">hello remaining views in hello script display hello existence of hello objects and monitor job execution.</span></span> <span data-ttu-id="5560a-150">Passez en revue la valeur d’état hello de hello **cycle de vie** état de colonne toomonitor hello.</span><span class="sxs-lookup"><span data-stu-id="5560a-150">Review hello status value from hello **lifecycle** column toomonitor hello status.</span></span> <span data-ttu-id="5560a-151">Une seule fois, a réussi, hello travail a correctement terminé sur toutes les bases de données client et deux bases de données supplémentaires contenant hello hello référencent table.</span><span class="sxs-lookup"><span data-stu-id="5560a-151">Once, Succeeded, hello job has successfully finished on all tenant databases and hello two additional databases containing hello reference table.</span></span>

<span data-ttu-id="5560a-152">Script de hello en cours d’exécution doit entraîner des résultats similaires :</span><span class="sxs-lookup"><span data-stu-id="5560a-152">Successfully running hello script should result in similar results:</span></span>

![results](media/sql-database-saas-tutorial-tenant-analytics/ticket-purchases-job.png)

## <a name="create-a-job-tooretrieve-a-summary-count-of-ticket-purchases-from-all-tenants"></a><span data-ttu-id="5560a-154">Créer un tooretrieve de travail un récapitulatif du ticket des achats auprès de tous les locataires</span><span class="sxs-lookup"><span data-stu-id="5560a-154">Create a job tooretrieve a summary count of ticket purchases from all tenants</span></span>

<span data-ttu-id="5560a-155">Ce script crée une somme de tooretrieve de travail de tous les achats de ticket à partir de tous les clients.</span><span class="sxs-lookup"><span data-stu-id="5560a-155">This script creates a job tooretrieve sum of all ticket purchases from all tenants.</span></span>

1. <span data-ttu-id="5560a-156">Ouvrez SSMS et se connecter toohello *catalogue -&lt;utilisateur&gt;. database.windows.net* server</span><span class="sxs-lookup"><span data-stu-id="5560a-156">Open SSMS and connect toohello *catalog-&lt;User&gt;.database.windows.net* server</span></span>
1. <span data-ttu-id="5560a-157">Fichier ouvert hello... \\Modules d’apprentissage\\fourniture et catalogue\\Analytique opérationnelle\\locataire Analytique\\*TicketPurchasesfromAllTenants.sql de résultats*</span><span class="sxs-lookup"><span data-stu-id="5560a-157">Open hello file …\\Learning Modules\\Provision and Catalog\\Operational Analytics\\Tenant Analytics\\*Results-TicketPurchasesfromAllTenants.sql*</span></span>
1. <span data-ttu-id="5560a-158">Modifier &lt;utilisateur&gt;, nom d’utilisateur utilisez hello utilisé lorsque vous avez déployé l’application de Wingtip SaaS hello dans le script hello, Bonjour **sp\_ajouter\_jobstep** procédure stockée</span><span class="sxs-lookup"><span data-stu-id="5560a-158">Modify &lt;User&gt;, use hello user name used when you deployed hello Wingtip SaaS app in hello script, in hello **sp\_add\_jobstep** stored procedure</span></span>
1. <span data-ttu-id="5560a-159">Avec le bouton droit sur, sélectionnez **connexion**et vous connecter toohello catalogue -&lt;utilisateur&gt;. database.windows.net server, si vous êtes pas déjà connecté</span><span class="sxs-lookup"><span data-stu-id="5560a-159">Right click, select **Connection**, and connect toohello catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="5560a-160">Assurez-vous que vous êtes connecté toohello **tenantanalytics** base de données, puis appuyez sur **F5** pour exécuter le script de hello</span><span class="sxs-lookup"><span data-stu-id="5560a-160">Ensure you are connected toohello **tenantanalytics** database and press **F5** to run hello script</span></span>

<span data-ttu-id="5560a-161">Script de hello en cours d’exécution doit entraîner des résultats similaires :</span><span class="sxs-lookup"><span data-stu-id="5560a-161">Successfully running hello script should result in similar results:</span></span>

![results](media/sql-database-saas-tutorial-tenant-analytics/total-sales.png)



* <span data-ttu-id="5560a-163">**sp\_add\_job** crée un travail hebdomadaire planifié appelé « ResultsTicketsOrders ».</span><span class="sxs-lookup"><span data-stu-id="5560a-163">**sp\_add\_job** creates a new weekly scheduled job called “ResultsTicketsOrders”</span></span>

* <span data-ttu-id="5560a-164">**SP\_ajouter\_jobstep** crée de toutes les informations d’achat de ticket hello étape de travail hello contenant tooretrieve de texte de commande T-SQL à partir de tous les locataires et hello copie retourner le jeu de résultats dans une table appelée CountofTicketOrders</span><span class="sxs-lookup"><span data-stu-id="5560a-164">**sp\_add\_jobstep** creates hello job step containing T-SQL command text tooretrieve all hello ticket purchase information from all tenants and copy hello returning result set into a table called CountofTicketOrders</span></span>

* <span data-ttu-id="5560a-165">vues restantes de Hello dans le script de hello affichent existence hello d’objets de hello et de surveiller l’exécution du travail.</span><span class="sxs-lookup"><span data-stu-id="5560a-165">hello remaining views in hello script display hello existence of hello objects and monitor job execution.</span></span> <span data-ttu-id="5560a-166">Passez en revue la valeur d’état hello de hello **cycle de vie** état de colonne toomonitor hello.</span><span class="sxs-lookup"><span data-stu-id="5560a-166">Review hello status value from hello **lifecycle** column toomonitor hello status.</span></span> <span data-ttu-id="5560a-167">Une seule fois, a réussi, hello travail a correctement terminé sur toutes les bases de données client et deux bases de données supplémentaires contenant hello hello référencent table.</span><span class="sxs-lookup"><span data-stu-id="5560a-167">Once, Succeeded, hello job has successfully finished on all tenant databases and hello two additional databases containing hello reference table.</span></span>


## <a name="next-steps"></a><span data-ttu-id="5560a-168">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="5560a-168">Next steps</span></span>

<span data-ttu-id="5560a-169">Dans ce didacticiel, vous avez appris à :</span><span class="sxs-lookup"><span data-stu-id="5560a-169">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="5560a-170">Déployez une base de données d’analyse du locataire</span><span class="sxs-lookup"><span data-stu-id="5560a-170">Deploy a tenant analytics database</span></span>
> * <span data-ttu-id="5560a-171">Créer un travail planifié tooretrieve de données analytiques sur locataires</span><span class="sxs-lookup"><span data-stu-id="5560a-171">Create a scheduled job tooretrieve analytical data across tenants</span></span>

<span data-ttu-id="5560a-172">Félicitations !</span><span class="sxs-lookup"><span data-stu-id="5560a-172">Congratulations!</span></span>

## <a name="additional-resources"></a><span data-ttu-id="5560a-173">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="5560a-173">Additional resources</span></span>

* <span data-ttu-id="5560a-174">Supplémentaires [didacticiels qui reposent sur hello application Wingtip SaaS](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="5560a-174">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="5560a-175">Tâches élastiques</span><span class="sxs-lookup"><span data-stu-id="5560a-175">Elastic Jobs</span></span>](sql-database-elastic-jobs-overview.md)
