---
title: "aaaMonitoring des performances de base de données dans la base de données SQL Azure | Documents Microsoft"
description: "En savoir plus sur les options de hello pour l’analyse de votre base de données avec Azure tools et des vues de gestion dynamique."
keywords: "analyse de base de données, performances des bases de données du cloud"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="028ce-104">Analyse des performances d’une base de données dans une base de données SQL Azure</span><span class="sxs-lookup"><span data-stu-id="028ce-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="028ce-105">Analyse des performances hello d’une base de données SQL Azure démarre avec l’analyse de niveau de toohello relatif d’utilisation de ressources de hello des performances de base de données choisie.</span><span class="sxs-lookup"><span data-stu-id="028ce-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="028ce-106">Analyse vous permet de déterminer si votre base de données a une capacité excédentaire ou rencontre des problèmes, car les ressources sont surexploités et ensuite décider s’il s’agit de niveau de performance de temps tooadjust hello et [niveau de service](sql-database-service-tiers.md) de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="028ce-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="028ce-107">Vous pouvez surveiller votre base de données à l’aide des outils graphiques Bonjour [portail Azure](https://portal.azure.com) ou à l’aide de SQL [vues de gestion dynamique](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="028ce-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="028ce-108">Surveiller les bases de données à l’aide de hello portail Azure</span><span class="sxs-lookup"><span data-stu-id="028ce-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="028ce-109">Bonjour [portail Azure](https://portal.azure.com/), vous pouvez surveiller le taux d’utilisation de base de données unique en sélectionnant votre base de données en cliquant sur hello **analyse** graphique.</span><span class="sxs-lookup"><span data-stu-id="028ce-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="028ce-110">Ceci fait apparaître un **métrique** fenêtre que vous pouvez modifier en cliquant sur hello **modifier le graphique** bouton.</span><span class="sxs-lookup"><span data-stu-id="028ce-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="028ce-111">Ajoutez hello suivant des métriques :</span><span class="sxs-lookup"><span data-stu-id="028ce-111">Add hello following metrics:</span></span>

* <span data-ttu-id="028ce-112">Pourcentage UC</span><span class="sxs-lookup"><span data-stu-id="028ce-112">CPU percentage</span></span>
* <span data-ttu-id="028ce-113">Pourcentage DTU</span><span class="sxs-lookup"><span data-stu-id="028ce-113">DTU percentage</span></span>
* <span data-ttu-id="028ce-114">Pourcentage E/S des données</span><span class="sxs-lookup"><span data-stu-id="028ce-114">Data IO percentage</span></span>
* <span data-ttu-id="028ce-115">Pourcentage de la taille de la base de données</span><span class="sxs-lookup"><span data-stu-id="028ce-115">Database size percentage</span></span>

<span data-ttu-id="028ce-116">Une fois que vous avez ajouté ces métriques, vous pouvez continuer tooview dans hello **analyse** graphique avec plus de détails sur hello **métrique** fenêtre.</span><span class="sxs-lookup"><span data-stu-id="028ce-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="028ce-117">Toutes les métriques de quatre affichent hello utilisation moyenne du pourcentage relatif toohello **DTU** de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="028ce-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="028ce-118">Consultez hello [niveaux de service](sql-database-service-tiers.md) article pour plus d’informations sur les dtu.</span><span class="sxs-lookup"><span data-stu-id="028ce-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Surveillance des niveaux de service des performances de la base de données.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="028ce-120">Vous pouvez également configurer des alertes sur des métriques de performances hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="028ce-121">Cliquez sur hello **ajouter une alerte** bouton Bonjour **métrique** fenêtre.</span><span class="sxs-lookup"><span data-stu-id="028ce-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="028ce-122">Suivez hello Assistant tooconfigure votre alerte.</span><span class="sxs-lookup"><span data-stu-id="028ce-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="028ce-123">Vous avez hello option tooalert si les métriques hello dépassent un certain seuil ou si la métrique de hello tombe en dessous d’un certain seuil.</span><span class="sxs-lookup"><span data-stu-id="028ce-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="028ce-124">Par exemple, si vous pensez que la charge de travail hello sur toogrow de votre base de données, vous pouvez choisir tooconfigure une alerte par courrier électronique chaque fois que votre base de données atteint 80 % d’une des métriques de performances hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="028ce-125">Vous pouvez utiliser cela comme un toofigure avertissement précoce out lorsque vous disposez tooswitch toohello niveau de performance supérieur.</span><span class="sxs-lookup"><span data-stu-id="028ce-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="028ce-126">les mesures de performances Hello peuvent également vous aider à déterminer si vous êtes le niveau de performances inférieur en mesure de toodowngrade tooa.</span><span class="sxs-lookup"><span data-stu-id="028ce-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="028ce-127">Supposons que vous utilisez une base de données Standard S2 et tous les afficher de métriques de performances qui hello en moyenne de base de données n’utilise pas plus de 10 % à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="028ce-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="028ce-128">Il est probable que cette base de données hello fonctionne bien en Standard S1.</span><span class="sxs-lookup"><span data-stu-id="028ce-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="028ce-129">Toutefois, tenez compte des charges de travail qui connaissent des pics ou fluctuent avant d’apporter des tooa-niveau de performance inférieur hello décision toomove.</span><span class="sxs-lookup"><span data-stu-id="028ce-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="028ce-130">Analyser des bases de données à l’aide des vues de gestion dynamique</span><span class="sxs-lookup"><span data-stu-id="028ce-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="028ce-131">Hello mêmes métriques qui sont exposées dans le portail de hello sont également disponibles via des vues système : [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) Bonjour logique **master** base de données de votre serveur, et [sys.dm_db_ des statistiques des ressources](https://msdn.microsoft.com/library/dn800981.aspx) dans la base de données utilisateur hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="028ce-132">Utilisez **sys.resource_stats** si vous avez besoin toomonitor moins de données granulaires sur une période plus longue.</span><span class="sxs-lookup"><span data-stu-id="028ce-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="028ce-133">Utilisez **sys.dm_db_resource_stats** si vous avez besoin de toomonitor données plus granulaires sur un plus petit intervalle de temps.</span><span class="sxs-lookup"><span data-stu-id="028ce-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="028ce-134">Pour en savoir plus, consultez [Guide des performances de base de données SQL Azure](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="028ce-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="028ce-135">**sys.dm_db_resource_stats** retourne un résultat vide quand elle est utilisée dans les éditions de base de données Web et Business, qui sont supprimées.</span><span class="sxs-lookup"><span data-stu-id="028ce-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="028ce-136">Surveiller l’utilisation des ressources</span><span class="sxs-lookup"><span data-stu-id="028ce-136">Monitor resource use</span></span>

<span data-ttu-id="028ce-137">Vous pouvez surveiller l’utilisation des ressources à l’aide de [SQL Database Query Performance Insight](sql-database-query-performance.md) et du [magasin de requêtes](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="028ce-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="028ce-138">Vous pouvez également surveiller l’utilisation à l’aide de ces deux vues :</span><span class="sxs-lookup"><span data-stu-id="028ce-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="028ce-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="028ce-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="028ce-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="028ce-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="028ce-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="028ce-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="028ce-142">Vous pouvez utiliser hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) vue dans chaque base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="028ce-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="028ce-143">Hello **sys.dm_db_resource_stats** affiche le niveau de service récentes ressource utilisez données toohello relatif.</span><span class="sxs-lookup"><span data-stu-id="028ce-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="028ce-144">Les pourcentages moyens d’UC, d’E/S des données, d’écritures du journal et de mémoire sont enregistrés toutes les 15 secondes et conservés pendant une heure.</span><span class="sxs-lookup"><span data-stu-id="028ce-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="028ce-145">Étant donné que cette vue fournit un aperçu plus granulaire de l’utilisation des ressources, utilisez d’abord **sys.dm_db_resource_stats** pour n’importe quelle analyse d’état actuel ou pour la résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="028ce-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="028ce-146">Par exemple, cette requête affiche la moyenne de hello et maximale de ressources utilisent pour la base de données actuelle hello sur hello dernière heure :</span><span class="sxs-lookup"><span data-stu-id="028ce-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="028ce-147">Pour les autres requêtes, consultez les exemples de hello dans [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="028ce-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="028ce-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="028ce-148">sys.resource_stats</span></span>
<span data-ttu-id="028ce-149">Hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) vue Bonjour **master** base de données comporte des informations supplémentaires qui peuvent vous aider à surveiller les performances de hello de votre base de données SQL à son niveau de performances et de la couche de service spécifique .</span><span class="sxs-lookup"><span data-stu-id="028ce-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="028ce-150">les données de salutation sont collectées toutes les 5 minutes et sont conservées pendant environ 35 jours.</span><span class="sxs-lookup"><span data-stu-id="028ce-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="028ce-151">Cette vue est utile pour une analyse historique de plus long terme sur l’utilisation des ressources par votre base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="028ce-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="028ce-152">Hello graphique suivant illustre hello utilisation des ressources du processeur pour une base de données Premium avec hello niveau de performance P2 pour chaque heure de la semaine.</span><span class="sxs-lookup"><span data-stu-id="028ce-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="028ce-153">Ce graphique commence un lundi, affiche 5 journées de travail et affiche alors un week-end, cas moins importante sur l’application hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Utilisation des ressources de base de données SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="028ce-155">À partir des données de hello, cette base de données possède actuellement un pic de charge de l’UC simplement plus de 50 % processeur utiliser le niveau de performance relatif toohello P2 (MIDI le mardi).</span><span class="sxs-lookup"><span data-stu-id="028ce-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="028ce-156">Si l’UC est hello un facteur dominant dans le profil de ressource de l’application hello, vous pouvez décider que P2 est hello droit tooguarantee de niveau de performances qui hello toujours les charges de travail correspond à.</span><span class="sxs-lookup"><span data-stu-id="028ce-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="028ce-157">Si vous prévoyez une toogrow d’application au fil du temps, il est un toohave conseillé une mémoire tampon de ressources supplémentaire afin que l’application hello n’atteint jamais la limite du niveau de performance hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="028ce-158">Si vous augmentez le niveau de performance hello, vous pouvez éviter les erreurs visible par les clients qui peuvent se produire lorsqu’une base de données n’a suffisamment tooprocess les demandes d’alimentation efficacement, en particulier dans les environnements sensibles au temps de latence.</span><span class="sxs-lookup"><span data-stu-id="028ce-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="028ce-159">Un exemple est une base de données qui prend en charge une application qui peint les pages Web en fonction des résultats hello d’appels de base de données.</span><span class="sxs-lookup"><span data-stu-id="028ce-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="028ce-160">Autres types d’applications peuvent interpréter hello même graphique différemment.</span><span class="sxs-lookup"><span data-stu-id="028ce-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="028ce-161">Par exemple, si une application tente de données sur les salaires tooprocess chaque jour et a hello même graphique, ce type de modèle de « traitement par lot » peut faire correctement à un niveau de performance P1.</span><span class="sxs-lookup"><span data-stu-id="028ce-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="028ce-162">Hello niveau de performance P1 a 100 dtu too200 de dtu par rapport au niveau de performance P2 de hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="028ce-163">Hello niveau de performance P1 offre des performances de hello moitié de hello niveau de performance P2.</span><span class="sxs-lookup"><span data-stu-id="028ce-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="028ce-164">Par conséquent, 50 % d’utilisation de l’UC au niveau P2 correspond à 100 % d’utilisation de l’UC au niveau de performance P1.</span><span class="sxs-lookup"><span data-stu-id="028ce-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="028ce-165">Si l’application hello n’a pas de délais d’attente, il peut concerner pas si un travail prend 2 heures ou 2,5 heures toofinish, si elle obtient fait aujourd'hui.</span><span class="sxs-lookup"><span data-stu-id="028ce-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="028ce-166">Une application de cette catégorie peut probablement utiliser un niveau de performances P1.</span><span class="sxs-lookup"><span data-stu-id="028ce-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="028ce-167">Vous pouvez tirer parti des faits hello qu’il n’y a des périodes au cours de la journée hello lorsque l’utilisation des ressources est moindre, afin que toute « période de pointe » peut déborder sur dans une des creux de hello plus tard dans la journée de hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="028ce-168">Hello niveau de performance P1 peut être approprié pour ce type d’application (et économies) tant que les travaux hello peuvent terminer à temps chaque jour.</span><span class="sxs-lookup"><span data-stu-id="028ce-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="028ce-169">Azure SQL Database consommées informations sur les ressources pour chaque base de données active Bonjour **sys.resource_stats** vue Hello **master** dans chaque serveur de base de données.</span><span class="sxs-lookup"><span data-stu-id="028ce-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="028ce-170">données Hello dans la table de hello sont agrégées à des intervalles de 5 minutes.</span><span class="sxs-lookup"><span data-stu-id="028ce-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="028ce-171">Avec les niveaux de service des basique, Standard et Premium d’hello, hello données peut prendre plus de 5 minutes tooappear dans la table de hello, par conséquent, ces données sont plus pratique pour l’analyse historique au lieu d’analyse de la proximité en temps réel.</span><span class="sxs-lookup"><span data-stu-id="028ce-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="028ce-172">Hello de requête **sys.resource_stats** vue toosee hello historique récent d’une base de données et les toovalidate si réservation de hello choisis remis hello performances si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="028ce-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="028ce-173">Vous devez être connecté toohello **master** base de données de votre logique tooquery de serveur de base de données SQL **sys.resource_stats** Bonjour exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="028ce-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="028ce-174">Cet exemple vous montre comment les données hello dans cette vue sont exposées :</span><span class="sxs-lookup"><span data-stu-id="028ce-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![vue de catalogue sys.resource_stats Hello](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="028ce-176">Hello suivant montre différentes manières que vous pouvez utiliser hello **sys.resource_stats** catalogue vue tooget plus d’informations sur l’utilisation des ressources dans votre base de données SQL :</span><span class="sxs-lookup"><span data-stu-id="028ce-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="028ce-177">toolook à hello au-delà de ressource de la semaine utilisent pour userdb1 de base de données hello, vous pouvez exécuter cette requête :</span><span class="sxs-lookup"><span data-stu-id="028ce-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="028ce-178">tooevaluate degré de niveau de performance hello le mieux à votre charge de travail, vous avez besoin de toodrill vers le bas dans chaque aspect de métriques de ressources hello : UC, lectures, écritures, nombre de threads de travail et nombre de sessions.</span><span class="sxs-lookup"><span data-stu-id="028ce-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="028ce-179">Voici un révisée à l’aide de la requête **sys.resource_stats** tooreport hello valeurs moyennes et maximales de ces métriques de ressource :</span><span class="sxs-lookup"><span data-stu-id="028ce-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="028ce-180">Avec ces informations sur les valeurs moyennes et maximales hello de chaque métrique de ressource, vous pouvez évaluer le degré votre charge de travail s’adapte à niveau de performance hello choisi.</span><span class="sxs-lookup"><span data-stu-id="028ce-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="028ce-181">En règle générale, les valeurs moyennes de **sys.resource_stats** vous donner un toouse bonne ligne de base par rapport à la taille cible hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="028ce-182">Elles doivent constituer votre principale jauge de mesure.</span><span class="sxs-lookup"><span data-stu-id="028ce-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="028ce-183">Pour obtenir un exemple, vous utilisez peut-être niveau de service Standard hello avec niveau de performance S2.</span><span class="sxs-lookup"><span data-stu-id="028ce-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="028ce-184">moyenne de Hello utiliser des pourcentages pour les lectures d’e/s et UC écritures sont au-dessous de 40 %, nombre moyen de hello de threads de travail est inférieur à 50 et nombre moyen de hello de sessions est inférieur à 200.</span><span class="sxs-lookup"><span data-stu-id="028ce-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="028ce-185">Hello niveau de performance S1 soit adéquat pour votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="028ce-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="028ce-186">Il est facile toosee si votre base de données tient dans le processus de travail hello et les limites de session.</span><span class="sxs-lookup"><span data-stu-id="028ce-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="028ce-187">toosee indique si une base de données s’adapte à un niveau inférieur à ce qui concerne les tooCPU, les lectures et écritures, divisez le nombre DTU de hello du niveau de performance inférieur hello en hello valeur DTU du niveau de performance actuel, puis multiplier le résultat de hello par 100 :</span><span class="sxs-lookup"><span data-stu-id="028ce-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="028ce-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="028ce-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="028ce-189">résultat de Hello est la différence de performances relatives de hello entre deux niveaux de performance hello en pourcentage.</span><span class="sxs-lookup"><span data-stu-id="028ce-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="028ce-190">Si cette quantité ne dépasse pas votre utilisation des ressources, votre charge de travail peut-être s’ajuster à niveau de performance inférieur hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="028ce-191">Toutefois, vous devez toolook à toutes les plages de valeurs d’utilisation de ressources et déterminez, en pourcentage, la fréquence à laquelle votre charge de travail de base de données tiendrait au niveau de performance inférieur hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="028ce-192">Hello requête suivante génère hello ajuster le pourcentage par dimension de ressource, en fonction de seuil hello de 40 pour cent que nous avons calculé dans cet exemple :</span><span class="sxs-lookup"><span data-stu-id="028ce-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="028ce-193">Selon votre objectif de niveau de service (SLO) de base de données, vous pouvez décider si votre charge de travail s’adapte à niveau de performance inférieur hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="028ce-194">Si votre charge de travail de base de données SLO est 99,9 % et hello requête précédente retourne les valeurs supérieures à 99,9 % pour tous les trois dimensions de ressources, votre charge de travail susceptible de correspond au niveau de performance inférieur hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="028ce-195">Recherche hello ajuster le pourcentage vous donne également un aperçu de si vous devez déplacer les toomeet au niveau suivant supérieur performances de toohello vos objectifs du contrat.</span><span class="sxs-lookup"><span data-stu-id="028ce-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="028ce-196">Par exemple, userdb1 indique hello suivant l’utilisation du processeur pour hello semaine dernière :</span><span class="sxs-lookup"><span data-stu-id="028ce-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="028ce-197">Pourcentage moyen d’UC</span><span class="sxs-lookup"><span data-stu-id="028ce-197">Average CPU percent</span></span> | <span data-ttu-id="028ce-198">Pourcentage maximum d’UC</span><span class="sxs-lookup"><span data-stu-id="028ce-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="028ce-199">24,5</span><span class="sxs-lookup"><span data-stu-id="028ce-199">24.5</span></span> |<span data-ttu-id="028ce-200">100,00</span><span class="sxs-lookup"><span data-stu-id="028ce-200">100.00</span></span> |
   
    <span data-ttu-id="028ce-201">Hello moyenne du processeur est environ un quart de limite hello du niveau de performance hello, qui serait rentrent dans le niveau de performance hello de base de données hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="028ce-202">Toutefois, valeur maximale de hello montre que cette base de données hello atteint la limite de hello du niveau de performance hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="028ce-203">Avez-vous besoin de toomove toohello niveau de performance supérieur ?</span><span class="sxs-lookup"><span data-stu-id="028ce-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="028ce-204">Examiner le nombre de fois où votre charge de travail atteint 100 pour cent et comparez-le charge de travail de base de données tooyour objectifs du contrat.</span><span class="sxs-lookup"><span data-stu-id="028ce-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="028ce-205">Si cette requête retourne une valeur inférieure à 99,9 % pour une des dimensions de ressources hello trois, envisagez soit mobile toohello niveau de performance supérieur ou utiliser le paramétrage d’application techniques tooreduce hello charge sur la base de données SQL hello.</span><span class="sxs-lookup"><span data-stu-id="028ce-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="028ce-206">Cet exercice tient également compte de votre charge de travail prévue augmentation hello futures.</span><span class="sxs-lookup"><span data-stu-id="028ce-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="028ce-207">Pour les pools élastiques, vous pouvez surveiller les bases de données individuelles dans le pool de hello avec les techniques de hello décrites dans cette section.</span><span class="sxs-lookup"><span data-stu-id="028ce-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="028ce-208">Mais vous pouvez également surveiller pool hello dans sa globalité.</span><span class="sxs-lookup"><span data-stu-id="028ce-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="028ce-209">Pour plus d’informations, consultez l’article [Surveiller et gérer un pool élastique](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="028ce-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="028ce-210">Nombre maximal de requêtes simultanées</span><span class="sxs-lookup"><span data-stu-id="028ce-210">Maximum concurrent requests</span></span>
<span data-ttu-id="028ce-211">nombre de hello toosee de demandes simultanées, exécutez cette requête Transact-SQL sur votre base de données SQL :</span><span class="sxs-lookup"><span data-stu-id="028ce-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="028ce-212">la charge de travail hello tooanalyze d’une base de données SQL Server sur site, modifiez cette toofilter de requête sur la base de données spécifique hello souhaité tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="028ce-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="028ce-213">Par exemple, si vous avez une base de données locale nommée MyDatabase, cette requête Transact-SQL renvoie le nombre hello de demandes simultanées dans cette base de données :</span><span class="sxs-lookup"><span data-stu-id="028ce-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="028ce-214">Il s’agit simplement d’un instantané à un point unique dans le temps.</span><span class="sxs-lookup"><span data-stu-id="028ce-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="028ce-215">tooget une meilleure compréhension de votre charge de travail et les exigences de demandes simultanées, vous devez toocollect nombreux échantillons au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="028ce-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="028ce-216">Nombre maximal de connexions simultanées</span><span class="sxs-lookup"><span data-stu-id="028ce-216">Maximum concurrent logins</span></span>
<span data-ttu-id="028ce-217">Vous pouvez analyser vos modèles utilisateur et application tooget une idée de la fréquence de hello de connexions.</span><span class="sxs-lookup"><span data-stu-id="028ce-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="028ce-218">Vous pouvez également exécuter des charges réelles dans toomake d’un environnement test sûr que vous rencontrez pas cela ou autres limites sur que les sujets abordés dans cet article.</span><span class="sxs-lookup"><span data-stu-id="028ce-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="028ce-219">Il n’existe aucune requête ou vue de gestion dynamique qui peut vous indiquer le nombre de connexions simultanées ou un historique dédié.</span><span class="sxs-lookup"><span data-stu-id="028ce-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="028ce-220">Si plusieurs clients utilisent hello même chaîne de connexion, hello service s’authentifie à chaque connexion.</span><span class="sxs-lookup"><span data-stu-id="028ce-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="028ce-221">Si 10 utilisateurs à se connectent simultanément tooa de base de données à l’aide de hello le même nom d’utilisateur et mot de passe, il n’y a 10 connexions simultanées.</span><span class="sxs-lookup"><span data-stu-id="028ce-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="028ce-222">Cette limite s’applique uniquement toohello durée d’ouverture de session hello et d’authentification.</span><span class="sxs-lookup"><span data-stu-id="028ce-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="028ce-223">Si les utilisateurs de hello 10 même vous connecter toohello de base de données séquentiellement, nombre de hello de connexions simultanées ne serait jamais supérieure à 1.</span><span class="sxs-lookup"><span data-stu-id="028ce-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="028ce-224">Actuellement, cette limite ne s’applique pas toodatabases dans les pools élastiques.</span><span class="sxs-lookup"><span data-stu-id="028ce-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="028ce-225">Nombre maximal de sessions</span><span class="sxs-lookup"><span data-stu-id="028ce-225">Maximum sessions</span></span>
<span data-ttu-id="028ce-226">nombre de hello toosee de sessions actives en cours, exécutez cette requête Transact-SQL sur votre base de données SQL :</span><span class="sxs-lookup"><span data-stu-id="028ce-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="028ce-227">Si vous analysez une charge de travail de SQL Server sur site, modifiez toofocus de requête hello sur une base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="028ce-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="028ce-228">Cette requête permet de déterminer les besoins possibles d’une session de base de données hello si vous envisagez de déplacer tooAzure base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="028ce-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="028ce-229">Là encore, ces requêtes renvoient un nombre à un point dans le temps.</span><span class="sxs-lookup"><span data-stu-id="028ce-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="028ce-230">Si vous regroupez plusieurs échantillons au fil du temps, vous aurez hello meilleure connaissance de votre session utiliser.</span><span class="sxs-lookup"><span data-stu-id="028ce-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="028ce-231">Pour l’analyse de la base de données SQL, vous pouvez obtenir des statistiques d’historique sur les sessions en interrogeant hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) affichage et examen hello **active_session_count** colonne.</span><span class="sxs-lookup"><span data-stu-id="028ce-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 
