---
title: "mise en application aaaRolling - base de données SQL Azure | Documents Microsoft"
description: "Découvrez comment toouse géo-réplication de base de données SQL Azure toosupport en ligne les mises à niveau de votre application cloud."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="c8aac-103">Gestion des mises à niveau propagées d’applications cloud à l’aide d’une géoréplication active de SQL Database</span><span class="sxs-lookup"><span data-stu-id="c8aac-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="c8aac-104">La [géoréplication active](sql-database-geo-replication-overview.md) est désormais disponible pour toutes les bases de données de tous niveaux.</span><span class="sxs-lookup"><span data-stu-id="c8aac-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="c8aac-105">Découvrez comment toouse [géo-réplication](sql-database-geo-replication-overview.md) dans la base de données SQL tooenable enchaînée mises à niveau de votre application dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="c8aac-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="c8aac-106">Une mise à niveau est une opération qui entraîne une interruption de service ; il est donc recommandé de l’intégrer à votre conception et à votre planification de la continuité des activités.</span><span class="sxs-lookup"><span data-stu-id="c8aac-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="c8aac-107">Dans cet article, que nous examinons les deux méthodes de hello orchestrant ces opérations mise à niveau et présentent les avantages hello et compromis de chaque option.</span><span class="sxs-lookup"><span data-stu-id="c8aac-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="c8aac-108">Pour des raisons de hello de cet article, nous allons utiliser une application simple qui se compose d’un site web tooa connectée unique de base de données en tant que sa couche données.</span><span class="sxs-lookup"><span data-stu-id="c8aac-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="c8aac-109">Notre objectif est de tooupgrade version 1 de hello application tooversion 2 sans aucun impact significatif sur l’expérience utilisateur final hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="c8aac-110">Lors de l’évaluation des options de mise à niveau de hello, vous devez envisager hello suivant facteurs :</span><span class="sxs-lookup"><span data-stu-id="c8aac-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="c8aac-111">Impact sur la disponibilité de l’application au cours des mises à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="c8aac-112">La durée pendant laquelle les fonction de l’application hello peut être limitée ou détériorée.</span><span class="sxs-lookup"><span data-stu-id="c8aac-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="c8aac-113">Capacité tooroll sauvegarder en cas d’un échec de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="c8aac-114">Vulnérabilité de l’application hello si une défaillance catastrophique non liée se produit pendant la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="c8aac-115">Coût total du processus,</span><span class="sxs-lookup"><span data-stu-id="c8aac-115">Total dollar cost.</span></span>  <span data-ttu-id="c8aac-116">Cela inclut une redondance supplémentaire et des coûts incrémentiels des composants de hello temporaire utilisés par le processus de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="c8aac-117">Mise à niveau d’applications dont la récupération d’urgence repose sur des sauvegardes de base de données</span><span class="sxs-lookup"><span data-stu-id="c8aac-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="c8aac-118">Si votre application s’appuie sur les sauvegardes de base de données automatique et utilise la géo-restauration pour la récupération d’urgence, il est généralement déployé tooa une seule région Azure.</span><span class="sxs-lookup"><span data-stu-id="c8aac-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="c8aac-119">Dans ce cas les processus de mise à niveau hello implique la création d’un déploiement de tous les composants d’application de sauvegarde impliqués dans la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="c8aac-120">interruption de l’utilisateur final hello toominimize vous reposera sur Azure Traffic Manager (WATM) avec le profil de basculement hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="c8aac-121">Hello suivant schéma illustre la mise à niveau du précédent toohello hello environnement d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="c8aac-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="c8aac-122">point de terminaison de Hello <i>contoso-1.azurewebsites.net</i> représente un emplacement de production de l’application hello nécessitant toobe mis à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="c8aac-123">tooenable hello capacité tooroll précédent hello mise à niveau, vous devez créer un emplacement de l’étape avec une copie entièrement synchronisée de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="c8aac-124">Hello étapes suivantes sont à l’application hello tooprepare requis pour la mise à niveau hello :</span><span class="sxs-lookup"><span data-stu-id="c8aac-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="c8aac-125">Créez un emplacement de la phase de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="c8aac-126">toodo qui créent une base de données secondaire (1) et de déployer un site web identique Bonjour même région Azure.</span><span class="sxs-lookup"><span data-stu-id="c8aac-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="c8aac-127">Surveiller les toosee secondaire hello si hello amorçage le processus est terminé.</span><span class="sxs-lookup"><span data-stu-id="c8aac-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="c8aac-128">Création d’un profil de basculement dans WATM en utilisant <i>contoso-1.azurewebsites.net</i> comme point de terminaison en ligne et <i>contoso-2.azurewebsites.net</i> comme point de terminaison hors connexion.</span><span class="sxs-lookup"><span data-stu-id="c8aac-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="c8aac-129">Remarque Les étapes de préparation hello n’affectera pas application hello dans l’emplacement de production hello et il peut fonctionner en mode d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="c8aac-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![Configuration de la géoréplication d’une base de données SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="c8aac-132">Une fois les étapes de préparation hello terminés application hello est prête pour la mise à niveau réelle de hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="c8aac-133">Hello suivant schéma illustre les étapes de hello impliqués dans le processus de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="c8aac-134">Définir la base de données primaire hello hello emplacement tooread uniquement en mode de production (3).</span><span class="sxs-lookup"><span data-stu-id="c8aac-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="c8aac-135">Cela garantit que hello instance de production de l’application hello (V1) au cours de mise à niveau hello donc pas possible divergence des données hello entre hello V1 et instances de base de données V2 restera en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c8aac-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="c8aac-136">Déconnecter la base de données secondaire hello à l’aide du mode d’arrêt planifié hello (4).</span><span class="sxs-lookup"><span data-stu-id="c8aac-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="c8aac-137">Il créera une copie indépendante entièrement synchronisée de la base de données primaire hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="c8aac-138">Cette base de données est alors mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="c8aac-139">Activer le mode de tooread-écriture de base de données primaire hello et exécutez le script de mise à niveau de hello dans l’emplacement de phase hello (5).</span><span class="sxs-lookup"><span data-stu-id="c8aac-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="c8aac-142">Si la mise à niveau hello terminée, vous êtes maintenant prêt tooswitch hello fin utilisateurs toohello intermédiaire copie hello application.</span><span class="sxs-lookup"><span data-stu-id="c8aac-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="c8aac-143">Il deviendra maintenant l’emplacement de production hello de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="c8aac-144">Cela implique quelques étapes supplémentaires, comme illustré sur hello suivant schéma.</span><span class="sxs-lookup"><span data-stu-id="c8aac-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="c8aac-145">Commutateur de point de terminaison en ligne hello dans le profil WATM hello trop<i>contoso-2.azurewebsites.net</i>, version toohello V2 points du site web de hello (6).</span><span class="sxs-lookup"><span data-stu-id="c8aac-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="c8aac-146">Il devient alors l’emplacement de production hello avec hello application V2 et le trafic de l’utilisateur final hello est dirigée tooit.</span><span class="sxs-lookup"><span data-stu-id="c8aac-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="c8aac-147">Si vous n’avez plus besoin composants de l’application hello V1 et vous pouvez en toute sécurité les supprimer (7).</span><span class="sxs-lookup"><span data-stu-id="c8aac-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="c8aac-150">Si le processus de mise à niveau hello n’aboutit pas, par exemple en raison de l’erreur tooan dans le script de mise à niveau hello, emplacement de phase hello doit être considéré comme compromis.</span><span class="sxs-lookup"><span data-stu-id="c8aac-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="c8aac-151">tooroll sauvegarder hello toohello pré-mise à niveau état de l’application vous restaurez simplement application hello dans access toofull de hello production emplacement.</span><span class="sxs-lookup"><span data-stu-id="c8aac-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="c8aac-152">étapes Hello sont affichent sur le diagramme suivant de hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="c8aac-153">Définissez hello de base de données copie tooread-écriture en mode (8).</span><span class="sxs-lookup"><span data-stu-id="c8aac-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="c8aac-154">Cette opération restaure hello complète V1 fonctionnellement dans l’emplacement de production hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="c8aac-155">Effectuer l’analyse des causes hello et supprimer des composants de hello compromis dans l’emplacement de phase hello (9).</span><span class="sxs-lookup"><span data-stu-id="c8aac-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="c8aac-156">À ce stade application hello est entièrement fonctionnelle et les étapes de mise à niveau hello peuvent être répétés.</span><span class="sxs-lookup"><span data-stu-id="c8aac-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="c8aac-157">Hello rollback ne requiert pas les modifications dans le profil WATM comme il pointe déjà trop<i>contoso-1.azurewebsites.net</i> comme hello du point de terminaison actif.</span><span class="sxs-lookup"><span data-stu-id="c8aac-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="c8aac-160">clé de Hello **parti** de cette option est que vous pouvez mettre à niveau une application dans une seule région à l’aide d’un ensemble d’étapes simples.</span><span class="sxs-lookup"><span data-stu-id="c8aac-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="c8aac-161">coût global de mise à niveau hello Hello est relativement faible.</span><span class="sxs-lookup"><span data-stu-id="c8aac-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="c8aac-162">Hello principal **compromis** est que si une défaillance irrémédiable se produit au cours de l’état de pré-mise à niveau la récupération toohello mise à niveau hello hello implique redéploiement de l’application hello dans une autre région et la restauration de la base de données hello de sauvegarde à l’aide de géo-restauration.</span><span class="sxs-lookup"><span data-stu-id="c8aac-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="c8aac-163">Ce processus entraîne des interruptions de service importantes.</span><span class="sxs-lookup"><span data-stu-id="c8aac-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="c8aac-164">Mise à niveau d’applications dont la récupération d’urgence repose sur la géoréplication de la base de données</span><span class="sxs-lookup"><span data-stu-id="c8aac-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="c8aac-165">Si votre application utilise un géo-réplication pour la continuité d’activité, il est déployé tooat au moins deux des régions différentes avec un déploiement actif dans la région principale et un déploiement en attente dans la région de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="c8aac-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="c8aac-166">En outre les facteurs toohello mentionné précédemment, les processus de mise à niveau hello doivent garantir que :</span><span class="sxs-lookup"><span data-stu-id="c8aac-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="c8aac-167">application Hello reste protégée contre les pannes catastrophiques à tout moment pendant le processus de mise à niveau hello</span><span class="sxs-lookup"><span data-stu-id="c8aac-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="c8aac-168">composants de géo-redondant Hello de l’application hello sont mis à niveau en parallèle avec les composants active hello</span><span class="sxs-lookup"><span data-stu-id="c8aac-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="c8aac-169">tooachieve ces objectifs, vous allez exploiter Azure Traffic Manager (WATM) à l’aide de basculement de hello profil associé à une active et trois points de terminaison de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="c8aac-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="c8aac-170">Hello suivant schéma illustre la mise à niveau du précédent toohello hello environnement d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="c8aac-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="c8aac-171">Hello sites web <i>contoso-1.azurewebsites.net</i> et <i>contoso-dr.azurewebsites.net</i> représentent un emplacement de production de l’application hello avec redondance géographique complète.</span><span class="sxs-lookup"><span data-stu-id="c8aac-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="c8aac-172">tooenable hello capacité tooroll précédent hello mise à niveau, vous devez créer un emplacement de l’étape avec une copie entièrement synchronisée de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="c8aac-173">Étant donné que vous avez besoin de tooensure application hello permet de restaurer rapidement en cas d’une défaillance irrémédiable se produit pendant le processus de mise à niveau de hello, emplacement de phase hello a besoin toobe géo-redondant ainsi.</span><span class="sxs-lookup"><span data-stu-id="c8aac-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="c8aac-174">Hello étapes suivantes sont à l’application hello tooprepare requis pour la mise à niveau hello :</span><span class="sxs-lookup"><span data-stu-id="c8aac-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="c8aac-175">Créez un emplacement de la phase de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="c8aac-176">toodo qui créent une base de données secondaire (1) et de déployer une copie identique de site web de hello Bonjour même région Azure.</span><span class="sxs-lookup"><span data-stu-id="c8aac-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="c8aac-177">Surveiller les toosee secondaire hello si hello amorçage le processus est terminé.</span><span class="sxs-lookup"><span data-stu-id="c8aac-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="c8aac-178">Créer une base de données secondaire géo-redondant dans l’emplacement de phase hello par géo-réplication sauvegarde région hello de base de données secondaire toohello (appelée « chaînées géo-réplication »).</span><span class="sxs-lookup"><span data-stu-id="c8aac-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="c8aac-179">Analyse toosee secondaire de hello sauvegarde si hello amorçage le processus est terminé (3).</span><span class="sxs-lookup"><span data-stu-id="c8aac-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="c8aac-180">Créer une copie de secours du site web de hello dans la région de sauvegarde hello et le lier toohello redondante base de données secondaire (4).</span><span class="sxs-lookup"><span data-stu-id="c8aac-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="c8aac-181">Ajouter des points de terminaison supplémentaires hello <i>contoso-2.azurewebsites.net</i> et <i>contoso-3.azurewebsites.net</i> toohello profil de basculement dans WATM comme points de terminaison hors connexion (5).</span><span class="sxs-lookup"><span data-stu-id="c8aac-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="c8aac-182">Remarque Les étapes de préparation hello n’affectera pas application hello dans l’emplacement de production hello et il peut fonctionner en mode d’accès complet.</span><span class="sxs-lookup"><span data-stu-id="c8aac-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="c8aac-185">Une fois les étapes de préparation hello terminés, emplacement d’étape de hello est prêt pour la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="c8aac-186">Hello suivant schéma illustre les étapes de mise à niveau de hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="c8aac-187">Définir la base de données primaire hello hello emplacement tooread uniquement en mode de production (6).</span><span class="sxs-lookup"><span data-stu-id="c8aac-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="c8aac-188">Cela garantit que hello instance de production de l’application hello (V1) au cours de mise à niveau hello donc pas possible divergence des données hello entre hello V1 et instances de base de données V2 restera en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c8aac-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="c8aac-189">Déconnecter la base de données secondaire hello Bonjour même à l’aide de la région de hello mode d’arrêt planifié (7).</span><span class="sxs-lookup"><span data-stu-id="c8aac-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="c8aac-190">Il créera une copie d’indépendante entièrement synchronisée de hello base de données primaire, qui deviendra automatiquement un serveur principal après l’arrêt de hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="c8aac-191">Cette base de données est alors mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="c8aac-192">Activer la base de données primaire hello en hello étape emplacement tooread-écriture et exécuter le script de mise à niveau hello (8).</span><span class="sxs-lookup"><span data-stu-id="c8aac-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="c8aac-195">Si la mise à niveau hello terminée vous n’êtes désormais prêt tooswitch hello aux utilisateurs finaux toohello V2 version de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="c8aac-196">Hello suivant schéma illustre les étapes hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="c8aac-197">Commutateur de point de terminaison actif hello dans le profil WATM hello trop<i>contoso-2.azurewebsites.net</i>, qui maintenant pointe version toohello V2 de hello web site (9).</span><span class="sxs-lookup"><span data-stu-id="c8aac-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="c8aac-198">Il devient alors un emplacement de production avec hello application V2 et le trafic de l’utilisateur final est dirigé tooit.</span><span class="sxs-lookup"><span data-stu-id="c8aac-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="c8aac-199">Si vous n’avez plus besoin application V1 de hello par conséquent, vous pouvez supprimer en toute sécurité (10 et 11).</span><span class="sxs-lookup"><span data-stu-id="c8aac-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="c8aac-202">Si le processus de mise à niveau hello n’aboutit pas, par exemple en raison de l’erreur tooan dans le script de mise à niveau hello, emplacement de phase hello doit être considéré comme compromis.</span><span class="sxs-lookup"><span data-stu-id="c8aac-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="c8aac-203">tooroll sauvegarder hello toohello pré-mise à niveau état de l’application vous restaurez simplement application hello de toousing dans l’emplacement de production hello avec un accès complet.</span><span class="sxs-lookup"><span data-stu-id="c8aac-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="c8aac-204">étapes Hello sont affichent sur le diagramme suivant de hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="c8aac-205">Ensemble de la copie de base de données primaire hello hello emplacement tooread-écriture en mode de production (12).</span><span class="sxs-lookup"><span data-stu-id="c8aac-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="c8aac-206">Cette opération restaure hello complète V1 fonctionnellement dans l’emplacement de production hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="c8aac-207">Effectuer l’analyse des causes hello et supprimer des composants de hello compromis dans l’emplacement de phase hello (13 et 14).</span><span class="sxs-lookup"><span data-stu-id="c8aac-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="c8aac-208">À ce stade application hello est entièrement fonctionnelle et les étapes de mise à niveau hello peuvent être répétés.</span><span class="sxs-lookup"><span data-stu-id="c8aac-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="c8aac-209">Hello rollback ne requiert pas les modifications dans le profil WATM comme il pointe déjà trop <i>contoso-1.azurewebsites.net</i> comme hello du point de terminaison actif.</span><span class="sxs-lookup"><span data-stu-id="c8aac-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Configuration de la géoréplication de SQL Database.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="c8aac-212">clé de Hello **parti** de cette option est que vous pouvez mettre à niveau application hello et sa copie géo-redondant en parallèle sans pour autant compromettre votre continuité d’activité au cours de la mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="c8aac-213">Hello principal **compromis** est qu’il requiert de la redondance double de chaque composant d’application et par conséquent implique un coût plus élevé.</span><span class="sxs-lookup"><span data-stu-id="c8aac-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="c8aac-214">Elle implique également un flux de travail plus complexe.</span><span class="sxs-lookup"><span data-stu-id="c8aac-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="c8aac-215">Résumé</span><span class="sxs-lookup"><span data-stu-id="c8aac-215">Summary</span></span>
<span data-ttu-id="c8aac-216">diffère entre les méthodes de mise à niveau Hello deux décrits dans l’article hello dollar hello et de complexité de coût, mais ils sont tous deux se concentrent sur la réduction des temps hello lorsque hello utilisateur est limitées tooread les opérations de.</span><span class="sxs-lookup"><span data-stu-id="c8aac-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="c8aac-217">Cette heure est définie directement par durée hello du script de mise à niveau hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="c8aac-218">Il ne dépend pas de taille de base de données hello, hello de niveau de service vous choisissez, configuration du site web hello et vous ne pouvez pas facilement contrôler d’autres facteurs.</span><span class="sxs-lookup"><span data-stu-id="c8aac-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="c8aac-219">Il s’agit, car toutes les étapes de préparation hello sont découplées à partir des étapes de mise à niveau hello et peuvent être effectuées sans affecter l’application de production hello.</span><span class="sxs-lookup"><span data-stu-id="c8aac-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="c8aac-220">efficacité Hello du script de mise à niveau hello est un facteur clé hello qui détermine l’utilisateur final hello pendant les mises à niveau.</span><span class="sxs-lookup"><span data-stu-id="c8aac-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="c8aac-221">Vous pouvez l’améliorer mieux hello consiste à concentrer vos efforts sur la création de script de mise à niveau hello aussi efficaces que possible.</span><span class="sxs-lookup"><span data-stu-id="c8aac-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="c8aac-222">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="c8aac-222">Next steps</span></span>
* <span data-ttu-id="c8aac-223">Pour une vue d’ensemble de la continuité des activités et des scénarios, consultez [Vue d’ensemble de la continuité des activités](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="c8aac-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="c8aac-224">toolearn sur les sauvegardes de base de données SQL Azure automatisée, consultez [base de données SQL des sauvegardes automatisées](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="c8aac-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="c8aac-225">toolearn sur l’utilisation des sauvegardes automatisées pour la récupération, consultez [restaurer une base de données à partir de sauvegardes automatisées](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="c8aac-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="c8aac-226">toolearn sur les options de récupération plus rapides, consultez [géo-réplication active](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c8aac-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>


