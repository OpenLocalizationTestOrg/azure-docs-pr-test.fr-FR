---
title: "spécification de réception aaaAzure Media Services MP4 fragmenté live | Documents Microsoft"
description: "Cette spécification décrit le protocole de hello et format pour fragmentés basée sur des fichiers MP4 en diffusion en continu ingestion pour Azure Media Services. Vous pouvez utiliser des événements en direct toostream Azure Media Services et diffuser le contenu en temps réel en utilisant Azure comme plateforme de cloud hello. Ce document explique également les pratiques recommandées pour créer des mécanismes d’ingestion en direct extrêmement redondants et robustes."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="70504-105">Spécification d’ingestion en direct au format MP4 fragmenté Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="70504-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="70504-106">Cette spécification décrit le protocole de hello et format pour fragmentés basée sur des fichiers MP4 en diffusion en continu ingestion pour Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="70504-107">Media Services fournit un service de diffusion en continu live que les clients peuvent utiliser des événements en direct toostream et diffuser le contenu en temps réel en utilisant Azure comme plateforme de cloud hello.</span><span class="sxs-lookup"><span data-stu-id="70504-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="70504-108">Ce document explique également les pratiques recommandées pour créer des mécanismes d’ingestion en direct extrêmement redondants et robustes.</span><span class="sxs-lookup"><span data-stu-id="70504-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="70504-109">1. Notation de conformité</span><span class="sxs-lookup"><span data-stu-id="70504-109">1. Conformance notation</span></span>
<span data-ttu-id="70504-110">Hello mots clés « doit », « ne doit pas, » « Requis », « Devra », « ne devra pas, » « Devrait », « Ne doivent pas », « Recommandé », « Peut » et « OPTIONAL » dans ce document sont toobe interprété comme elles sont décrites dans la RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="70504-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="70504-111">2. Diagramme du service</span><span class="sxs-lookup"><span data-stu-id="70504-111">2. Service diagram</span></span>
<span data-ttu-id="70504-112">Hello diagramme suivant montre architecture de haut niveau hello Hello dynamique de diffusion en continu de service dans les Services de support :</span><span class="sxs-lookup"><span data-stu-id="70504-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="70504-113">Un encodeur en direct push toochannels de flux live qui sont créés et configurés via hello Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="70504-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="70504-114">Canaux, les programmes et les points de terminaison de diffusion en continu tous les hello diffusion en continu de fonctionnalités, notamment la réception, la mise en forme, du handle de Media Services de cloud computing magnétoscope numérique, sécurité, l’évolutivité et la redondance.</span><span class="sxs-lookup"><span data-stu-id="70504-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="70504-115">Le cas échéant, les clients peuvent choisir toodeploy une couche d’Azure Content Delivery Network entre hello de diffusion en continu de point de terminaison et les points de terminaison clients hello.</span><span class="sxs-lookup"><span data-stu-id="70504-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="70504-116">Flux de points de terminaison de client à partir de hello point de terminaison de diffusion en continu à l’aide de protocoles de diffusion en continu adaptative de HTTP.</span><span class="sxs-lookup"><span data-stu-id="70504-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="70504-117">Parmi les exemples citons Microsoft Smooth Streaming, Dynamic Adaptive Streaming sur HTTP (DASH ou MPEG-DASH) et Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="70504-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![Flux d’ingestion][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="70504-119">3. Format de flux binaire – MP4 fragmenté ISO 14496-12</span><span class="sxs-lookup"><span data-stu-id="70504-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="70504-120">Hello format de transmission pour la diffusion en continu de réception décrites dans ce document est basé sur [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="70504-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="70504-121">Pour obtenir une explication détaillée du format MP4 fragmenté et des extensions de fichiers vidéo à la demande et d’ingestion de streaming en direct, consultez [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="70504-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="70504-122">Définitions de format de réception en temps réel</span><span class="sxs-lookup"><span data-stu-id="70504-122">Live ingest format definitions</span></span>
<span data-ttu-id="70504-123">Hello listée ci-dessous format spécial définitions qui s’appliquent toolive de réception dans Azure Media Services :</span><span class="sxs-lookup"><span data-stu-id="70504-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="70504-124">Hello **ftyp**, **zone de manifeste de serveur Live**, et **moov** zones doivent être envoyés avec chaque demande (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="70504-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="70504-125">Ces zones doivent être envoyés au début de hello du flux de hello et n’importe quel moment encodeur de hello doit se reconnecter tooresume flux de réception.</span><span class="sxs-lookup"><span data-stu-id="70504-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="70504-126">Pour plus d’informations, consultez la section 6 dans [1].</span><span class="sxs-lookup"><span data-stu-id="70504-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="70504-127">La section 3.3.2 dans [1] définit une zone facultative appelée **StreamManifestBox** pour l’ingestion en direct.</span><span class="sxs-lookup"><span data-stu-id="70504-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="70504-128">En raison de la logique de routage toohello d’équilibrage de charge Azure hello, à l’aide de cette zone est déconseillée.</span><span class="sxs-lookup"><span data-stu-id="70504-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="70504-129">boîte de Hello ne doit pas être présent lors de la réception dans Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="70504-130">Si cette zone est présente, Media Services l’ignore en mode silencieux.</span><span class="sxs-lookup"><span data-stu-id="70504-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="70504-131">Hello **TrackFragmentExtendedHeaderBox** boîte définie dans 3.2.3.2 dans [1] doit être présent pour chaque fragment.</span><span class="sxs-lookup"><span data-stu-id="70504-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="70504-132">La version 2 de hello **TrackFragmentExtendedHeaderBox** case doit être utilisé toogenerate des segments de supports ayant des URL identiques dans plusieurs centres de données.</span><span class="sxs-lookup"><span data-stu-id="70504-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="70504-133">champ de l’index Hello fragment est requise pour le basculement entre centres de données basée sur les index de diffusion en continu formats de tels que Apple HLS et MPEG-DASH basés sur un index.</span><span class="sxs-lookup"><span data-stu-id="70504-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="70504-134">basculement entre centres de données de tooenable, hello fragment l’index doit être synchronisé entre plusieurs encodeurs et être augmenté de 1 pour chaque fragment multimédia successives, voire entre les redémarrages de l’encodeur ou d’échecs.</span><span class="sxs-lookup"><span data-stu-id="70504-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="70504-135">Section 3.3.6 dans [1] définit une zone appelée **MovieFragmentRandomAccessBox** (**mfra**) qui peut être envoyé à la fin hello de canal toohello de réception dynamique tooindicate fin de flux (fin du support).</span><span class="sxs-lookup"><span data-stu-id="70504-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="70504-136">Échéance toohello réception logique de Media Services, à l’aide de la fin du support est déconseillée et hello **mfra** boîte de réception dynamique ne doit pas être envoyée.</span><span class="sxs-lookup"><span data-stu-id="70504-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="70504-137">Si elle l’est, Media Services l’ignore en mode silencieux.</span><span class="sxs-lookup"><span data-stu-id="70504-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="70504-138">état de hello tooreset Hello de point de réception, nous vous recommandons d’utiliser [canal réinitialisé](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="70504-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="70504-139">Nous vous recommandons également d’utiliser [programme arrêter](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend une présentation et un flux de données.</span><span class="sxs-lookup"><span data-stu-id="70504-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="70504-140">durée du fragment Hello MP4 doit être constante, taille de hello tooreduce des manifestes de client hello.</span><span class="sxs-lookup"><span data-stu-id="70504-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="70504-141">Une durée de fragment MP4 constante améliore également l’heuristique du téléchargement client à l’aide de hello de balises de répétitions.</span><span class="sxs-lookup"><span data-stu-id="70504-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="70504-142">durée de Hello peut-être fluctuer toocompensate pour des fréquences d’images de type non entier.</span><span class="sxs-lookup"><span data-stu-id="70504-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="70504-143">durée du fragment Hello MP4 doit être comprise entre environ 2 et 6 secondes.</span><span class="sxs-lookup"><span data-stu-id="70504-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="70504-144">Les horodatages et index du fragment MP4 (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` et `fragment_index`) DOIVENT normalement arriver dans l’ordre croissant.</span><span class="sxs-lookup"><span data-stu-id="70504-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="70504-145">Bien que Media Services est résilient tooduplicate fragments, il a limité les fragments de tooreorder possibilité selon la chronologie du média toohello.</span><span class="sxs-lookup"><span data-stu-id="70504-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="70504-146">4. Format de protocole – HTTP</span><span class="sxs-lookup"><span data-stu-id="70504-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="70504-147">ISO fragmenté basée sur des fichiers MP4 en temps réel de réception pour Media Services utilise une longue HTTP POST demande tootransmit encodé media données standard qui sont empaquetées dans un service de toohello de format MP4 fragmenté.</span><span class="sxs-lookup"><span data-stu-id="70504-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="70504-148">Chaque requête HTTP POST envoie un fragmenté MP4 flux binaire (« stream »), à partir des zones d’en-tête à compter de hello (**ftyp**, **zone de manifeste de serveur Live**, et **moov** zones) et en continuant avec une séquence de fragments (**moof** et **mdat** boîtes).</span><span class="sxs-lookup"><span data-stu-id="70504-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="70504-149">Syntaxe d’URL pour la requête HTTP POST de hello, consultez la section 9.2 in [1].</span><span class="sxs-lookup"><span data-stu-id="70504-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="70504-150">Un exemple Hello poster une URL est :</span><span class="sxs-lookup"><span data-stu-id="70504-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="70504-151">Configuration requise</span><span class="sxs-lookup"><span data-stu-id="70504-151">Requirements</span></span>
<span data-ttu-id="70504-152">Voici hello exigences détaillées :</span><span class="sxs-lookup"><span data-stu-id="70504-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="70504-153">Hello encodeur doit démarrer hello de diffusion en envoyant une demande HTTP POST avec vide « corps » (longueur de contenu nulle) à l’aide de hello même URL de réception.</span><span class="sxs-lookup"><span data-stu-id="70504-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="70504-154">Cela permet d’encoder de hello rapidement détecter si le point de terminaison de réception dynamique hello est valide et s’il n’y aucune authentification ou autres conditions requises.</span><span class="sxs-lookup"><span data-stu-id="70504-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="70504-155">Par le protocole HTTP, les serveur hello ne peut pas renvoyer une réponse HTTP jusqu'à ce que hello entière, y compris le corps de publication hello, la demande.</span><span class="sxs-lookup"><span data-stu-id="70504-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="70504-156">Raison de la nature hello longue d’un événement en direct, sans cette étape, l’encodeur de hello peut-être pas en mesure de toodetect toute erreur jusqu'à ce qu’il termine l’envoi de toutes les données hello.</span><span class="sxs-lookup"><span data-stu-id="70504-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="70504-157">encodeur de Hello doit gérer les erreurs ou les demandes d’authentification en raison de (1).</span><span class="sxs-lookup"><span data-stu-id="70504-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="70504-158">Si (1) réussit avec une réponse 200, continuez.</span><span class="sxs-lookup"><span data-stu-id="70504-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="70504-159">encodeur de Hello doit commencer une nouvelle demande HTTP POST avec flux de fichiers MP4 hello fragmenté.</span><span class="sxs-lookup"><span data-stu-id="70504-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="70504-160">charge utile de Hello doit commencer par les zones d’en-tête hello, suivis par fragments.</span><span class="sxs-lookup"><span data-stu-id="70504-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="70504-161">Notez que hello **ftyp**, **zone de manifeste de serveur Live**, et **moov** cases (dans cet ordre) doivent être envoyés avec chaque demande, même si l’encodeur de hello doit se reconnecter car hello demande précédente a été interrompue fin toohello préalable du flux de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="70504-162">encodeur de Hello doit utiliser pour le téléchargement de codage de transfert mémorisé en bloc, car il est impossible toopredict hello contenu longueur totale de hello dynamique des événements.</span><span class="sxs-lookup"><span data-stu-id="70504-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="70504-163">Lors de l’événement de hello est, après l’envoi du dernier fragment de hello, encodeur de hello doit se terminer normalement le codage de séquence de message (la plupart des piles de client HTTP gérer automatiquement) de transfert hello mémorisé en bloc.</span><span class="sxs-lookup"><span data-stu-id="70504-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="70504-164">encodeur de Hello doit attendre le code de réponse finale hello service tooreturn hello, puis se ferme les connexions hello.</span><span class="sxs-lookup"><span data-stu-id="70504-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="70504-165">encodeur Hello ne doit pas utiliser hello `Events()` substantif comme décrit dans 9.2 [1] pour l’ingestion en direct dans Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="70504-166">Si de requête HTTP POST hello se termine ou heures out avec un TCP erreur toohello préalable de fin de flux de données hello, hello encodeur doit émettre une nouvelle demande POST à l’aide d’une nouvelle connexion et suivez hello exigences précédentes.</span><span class="sxs-lookup"><span data-stu-id="70504-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="70504-167">En outre, encodeur de hello doit renvoyer hello des fragments MP4 deux précédentes pour chaque piste de flux de données hello et reprendre sans introduire une discontinuité dans la chronologie du média hello.</span><span class="sxs-lookup"><span data-stu-id="70504-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="70504-168">Renvoi des deux derniers fragments MP4 pour chaque piste hello garantit qu’il n’existe aucune perte de données.</span><span class="sxs-lookup"><span data-stu-id="70504-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="70504-169">En d’autres termes, si un flux de données contient un audio et une piste vidéo, Échec de la demande POST en cours de hello, encodeur de hello doit se reconnecter et renvoyer hello dernière deux fragments de la piste audio de hello, qui ont été envoyées précédemment avec succès, et hello deux derniers fragments pour piste vidéo de Hello, qui ont été précédemment envoyé, tooensure qu’il n’existe aucune perte de données.</span><span class="sxs-lookup"><span data-stu-id="70504-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="70504-170">encodeur de Hello doit conserver une mémoire tampon de « avant » de fragments de média, il renvoie lorsqu’il se reconnecte.</span><span class="sxs-lookup"><span data-stu-id="70504-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="70504-171">5. Échelle de temps</span><span class="sxs-lookup"><span data-stu-id="70504-171">5. Timescale</span></span>
<span data-ttu-id="70504-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) décrit hello de l’utilisation de l’échelle de temps pour **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement**(Section 2.2.2.6), et **LiveSMIL** (Section 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="70504-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="70504-173">Si la valeur d’échelle de temps hello n’est pas présent, valeur par défaut de hello utilisée est 10 000 000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="70504-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="70504-174">Bien que la spécification de format de diffusion en continu de hello ne bloque pas l’utilisation d’autres valeurs de l’échelle de temps, la plupart des implémentations d’encodeur utilisent cette valeur par défaut toogenerate valeur (10 MHz) de diffusion en continu lisse les données de réception.</span><span class="sxs-lookup"><span data-stu-id="70504-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="70504-175">Échéance toohello [mise en package dynamique Azure Media](media-services-dynamic-packaging-overview.md) fonctionnalité, nous recommandons d’utiliser une échelle de temps 90 KHz des flux vidéo et 44,1 KHz KHz 48.1 pour les flux audio.</span><span class="sxs-lookup"><span data-stu-id="70504-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="70504-176">Si les valeurs de l’échelle de temps différents sont utilisés pour différents flux, l’échelle de temps hello au niveau du flux de données doit être envoyé.</span><span class="sxs-lookup"><span data-stu-id="70504-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="70504-177">Pour plus d’informations, consultez [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="70504-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="70504-178">6. Définition de « stream »</span><span class="sxs-lookup"><span data-stu-id="70504-178">6. Definition of “stream”</span></span>
<span data-ttu-id="70504-179">Flux de données est hello unité de base de l’opération de réception dynamique pour composer des présentations, la gestion des scénarios de redondance et de basculement de diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="70504-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="70504-180">Stream se définit comme un seul flux binaire MP4 fragmenté pouvant contenir une piste unique ou plusieurs pistes.</span><span class="sxs-lookup"><span data-stu-id="70504-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="70504-181">Une présentation en direct peut contenir un ou plusieurs flux, selon la configuration de hello des encodeurs en temps réel hello.</span><span class="sxs-lookup"><span data-stu-id="70504-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="70504-182">Hello suivant exemples illustre diverses options de l’utilisation de flux toocompose une présentation en direct.</span><span class="sxs-lookup"><span data-stu-id="70504-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="70504-183">**Exemple :**</span><span class="sxs-lookup"><span data-stu-id="70504-183">**Example:**</span></span> 

<span data-ttu-id="70504-184">Un client souhaite toocreate une présentation de diffusion en continu en direct qui inclut hello suivant les vitesses de transmission audio/vidéo :</span><span class="sxs-lookup"><span data-stu-id="70504-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="70504-185">Vidéo : 3000 Kbits/s, 1500 Kbits/s, 750 Kbits/s</span><span class="sxs-lookup"><span data-stu-id="70504-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="70504-186">Audio : 128 Kbits/s</span><span class="sxs-lookup"><span data-stu-id="70504-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="70504-187">Option 1 : toutes les pistes dans un seul flux</span><span class="sxs-lookup"><span data-stu-id="70504-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="70504-188">Dans cette option, un encodeur unique génère toutes les pistes audio/vidéo et les regroupe dans un flux binaire MP4 fragmenté.</span><span class="sxs-lookup"><span data-stu-id="70504-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="70504-189">Hello fragmenté MP4 flux binaire est ensuite envoyé via une connexion HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="70504-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="70504-190">Dans cet exemple, il existe un seul flux pour cette présentation en direct.</span><span class="sxs-lookup"><span data-stu-id="70504-190">In this example, there is only one stream for this live presentation.</span></span>

![Flux : une piste][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="70504-192">Option 2 : chaque piste dans un flux distinct</span><span class="sxs-lookup"><span data-stu-id="70504-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="70504-193">Dans cette option, encodeur de hello place d’une piste dans chaque flux binaire fragment MP4 et tous les flux hello publie ensuite sur les connexions HTTP distinctes.</span><span class="sxs-lookup"><span data-stu-id="70504-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="70504-194">Cette option est réalisable avec un seul encodeur ou plusieurs.</span><span class="sxs-lookup"><span data-stu-id="70504-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="70504-195">réception dynamique de Hello voit cette présentation dynamique comme composé de quatre flux.</span><span class="sxs-lookup"><span data-stu-id="70504-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Flux : pistes distinctes][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="70504-197">Option 3 : Regrouper une piste audio avec piste vidéo hello plus bas débit binaire dans un flux de données</span><span class="sxs-lookup"><span data-stu-id="70504-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="70504-198">Dans cette option, le client de hello choisit une piste audio de hello toobundle avec piste vidéo de la plus faible vitesse de transmission hello dans un flux binaire d’un fragment MP4, et laissez hello autres deux pistes vidéos en tant que flux distincts.</span><span class="sxs-lookup"><span data-stu-id="70504-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Flux : pistes audio et vidéo][image4]

### <a name="summary"></a><span data-ttu-id="70504-200">Résumé</span><span class="sxs-lookup"><span data-stu-id="70504-200">Summary</span></span>
<span data-ttu-id="70504-201">Cela ne constitue pas la liste exhaustive de toutes les options d’ingestion possibles pour cet exemple.</span><span class="sxs-lookup"><span data-stu-id="70504-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="70504-202">En fait, tous les regroupements de pistes dans des flux sont pris en charge par l’ingestion en direct.</span><span class="sxs-lookup"><span data-stu-id="70504-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="70504-203">Les clients et fournisseurs d'encodeurs peuvent choisir leurs propres implémentations selon la complexité d'ingénierie, la capacité de l'encodeur et les questions de redondance et de basculement.</span><span class="sxs-lookup"><span data-stu-id="70504-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="70504-204">Toutefois, dans la plupart des cas, il est uniquement une piste audio pour hello ensemble dynamique de la présentation.</span><span class="sxs-lookup"><span data-stu-id="70504-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="70504-205">Par conséquent, ses tooensure important hello santé Hello réception du flux qui contient la piste audio de hello. Cette considération souvent des résultats en plaçant la piste audio de hello dans son propre flux de données (comme dans l’Option 2) ou il regroupement avec piste vidéo de la plus faible vitesse de transmission hello (comme dans l’Option 3).</span><span class="sxs-lookup"><span data-stu-id="70504-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="70504-206">En outre, pour une meilleure redondance et la tolérance de panne, envoi hello même piste audio dans deux flux différents (Option 2 avec pistes audio redondant) ou regroupement piste audio hello avec au moins deux des pistes vidéo de la plus faible vitesse de transmission hello (Option 3 avec contenu audio à au moins deux flux vidéos) est fortement recommandée pour direct de réception dans Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="70504-207">7. Basculement du service</span><span class="sxs-lookup"><span data-stu-id="70504-207">7. Service failover</span></span>
<span data-ttu-id="70504-208">Compte tenu de la nature de hello de diffusion en continu, prise en charge du basculement de bon est essentielle pour garantir la disponibilité de hello du service de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="70504-209">Media Services est conçue toohandle différents types d’échecs, notamment des erreurs réseau, les erreurs de serveur et les problèmes de stockage.</span><span class="sxs-lookup"><span data-stu-id="70504-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="70504-210">Lorsqu’il est utilisé conjointement avec la logique de basculement approprié hello encodeur en temps réel côté, clients peuvent obtenir un service de diffusion en continu live hautement fiable du cloud de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="70504-211">Dans cette section, nous abordons les scénarios de basculement du service.</span><span class="sxs-lookup"><span data-stu-id="70504-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="70504-212">Dans ce cas, hello défaillance intervient quelque part dans le service de hello, et il se traduit par une erreur réseau.</span><span class="sxs-lookup"><span data-stu-id="70504-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="70504-213">Voici quelques recommandations pour l’implémentation d’encodeur hello pour gérer le basculement du service :</span><span class="sxs-lookup"><span data-stu-id="70504-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="70504-214">Utiliser un délai d’attente de 10 secondes pour établir la connexion TCP de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="70504-215">Si une connexion de hello tooestablish tentative prend plue de 10 secondes, hello opération d’abandon, puis réessayez.</span><span class="sxs-lookup"><span data-stu-id="70504-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="70504-216">Utiliser un délai d’expiration court pour l’envoi des blocs de message de demande hello HTTP.</span><span class="sxs-lookup"><span data-stu-id="70504-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="70504-217">Si la durée de fragment MP4 hello cible est N secondes, utiliser un délai d’attente d’envoi entre N et 2 N secondes ; par exemple, si la durée de fragment MP4 hello est de 6 secondes, utiliser un délai de 6 secondes too12.</span><span class="sxs-lookup"><span data-stu-id="70504-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="70504-218">Si un délai d’attente se produit, réinitialisation hello connexion, ouvrir une nouvelle connexion et reprendre le flux de données de réception sur une nouvelle connexion hello.</span><span class="sxs-lookup"><span data-stu-id="70504-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="70504-219">Mettre à jour un tampon propagée qui comporte des deux derniers fragments hello pour chaque piste qui ont été correctement et complètement toohello service envoyés.</span><span class="sxs-lookup"><span data-stu-id="70504-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="70504-220">Si hello requête HTTP POST pour un flux de données est arrêtée ou arrive à expiration fin toohello préalable du flux de hello, ouvrir une nouvelle connexion et commencer une autre demande HTTP POST, renvoyer des en-têtes de flux hello, renvoyer des fragments de deux derniers pour chaque piste hello et reprendre des flux hello sans introduire une discontinuité dans la chronologie du média hello.</span><span class="sxs-lookup"><span data-stu-id="70504-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="70504-221">Cela réduit les risques de hello de perte de données.</span><span class="sxs-lookup"><span data-stu-id="70504-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="70504-222">Nous vous recommandons de cet encodeur hello ne pas limiter le nombre de hello de nouvelles tentatives tooestablish une connexion ou reprendre après une erreur TCP de diffusion en continu.</span><span class="sxs-lookup"><span data-stu-id="70504-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="70504-223">Après une erreur TCP :</span><span class="sxs-lookup"><span data-stu-id="70504-223">After a TCP error:</span></span>
  
    <span data-ttu-id="70504-224">a.</span><span class="sxs-lookup"><span data-stu-id="70504-224">a.</span></span> <span data-ttu-id="70504-225">Hello en cours de connexion doit être fermée, et une nouvelle connexion doit être créée pour une nouvelle demande HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="70504-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="70504-226">b.</span><span class="sxs-lookup"><span data-stu-id="70504-226">b.</span></span> <span data-ttu-id="70504-227">Hello nouvelle HTTP POST URL doit être identique à celle de l’URL de la publication initiale de hello hello.</span><span class="sxs-lookup"><span data-stu-id="70504-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="70504-228">c.</span><span class="sxs-lookup"><span data-stu-id="70504-228">c.</span></span> <span data-ttu-id="70504-229">Hello nouvelle HTTP POST doit inclure les en-têtes de flux de données (**ftyp**, **zone de manifeste de serveur Live**, et **moov** cases) qui sont des en-têtes de flux de données identiques toohello Bonjour initiale POST.</span><span class="sxs-lookup"><span data-stu-id="70504-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="70504-230">d.</span><span class="sxs-lookup"><span data-stu-id="70504-230">d.</span></span> <span data-ttu-id="70504-231">fragments de deux derniers Hello envoyés pour chaque piste doivent être renvoyées et de diffusion en continu doit reprendre sans introduire une discontinuité dans la chronologie du média hello.</span><span class="sxs-lookup"><span data-stu-id="70504-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="70504-232">Hello horodateurs de fragments MP4 doit augmenter en permanence, même sur les requêtes HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="70504-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="70504-233">encodeur de Hello doit s’arrêter de requête HTTP POST hello si les données ne sont pas envoyées à un rythme adapté à la durée de fragment MP4 hello.</span><span class="sxs-lookup"><span data-stu-id="70504-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="70504-234">Une requête HTTP POST qui n’envoie pas de données peut empêcher le déconnecter rapidement les encodeur hello dans les cas de hello d’une mise à jour de service de Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="70504-235">Pour cette raison, hello HTTP POST pour éparses assure le suivi (un signal publicitaire) doit être courte, fin d’exécution dès que le fragment d’éparses hello est envoyé.</span><span class="sxs-lookup"><span data-stu-id="70504-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="70504-236">8. Basculement de l’encodeur</span><span class="sxs-lookup"><span data-stu-id="70504-236">8. Encoder failover</span></span>
<span data-ttu-id="70504-237">Basculement de l’encodeur est hello second type de scénario de basculement qui doit toobe traité pour la diffusion en continu en direct de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="70504-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="70504-238">Dans ce scénario, condition d’erreur hello se produit côté d’encodeur hello.</span><span class="sxs-lookup"><span data-stu-id="70504-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![Basculement de l’encodeur][image5]

<span data-ttu-id="70504-240">Hello suivant attentes s’appliquent à partir du point de terminaison de réception dynamique hello lors de l’encodeur basculement se produit :</span><span class="sxs-lookup"><span data-stu-id="70504-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="70504-241">Une nouvelle instance de l’encodeur doit être créée toocontinue de diffusion en continu, comme illustré dans le diagramme hello (flux de vidéo avec ligne en pointillés à 3000k).</span><span class="sxs-lookup"><span data-stu-id="70504-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="70504-242">Hello Nouvel encodeur doit utiliser hello même demande des URL pour HTTP POST comme hello Échec de l’instance.</span><span class="sxs-lookup"><span data-stu-id="70504-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="70504-243">Hello POST demande du nouvel encodeur doit inclure hello même fragmenté zones d’en-tête MP4 comme hello instance ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="70504-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="70504-244">Nouvel encodeur de Hello doit être synchronisé correctement avec tous les autres des encodeurs en cours d’exécution pour la même présentation live toogenerate hello synchronisés exemples audio/vidéo avec les limites des fragments alignés.</span><span class="sxs-lookup"><span data-stu-id="70504-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="70504-245">nouveau flux de données Hello doit être sémantiquement équivalente avec flux de données hello précédente et interchangeables à des niveaux d’en-tête et à fragment hello.</span><span class="sxs-lookup"><span data-stu-id="70504-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="70504-246">Nouvel encodeur de Hello essayez toominimize une perte de données.</span><span class="sxs-lookup"><span data-stu-id="70504-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="70504-247">Hello `fragment_absolute_time` et `fragment_index` du support de fragments doivent augmenter à partir du point hello où encodeur de hello dernier arrêt.</span><span class="sxs-lookup"><span data-stu-id="70504-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="70504-248">Hello `fragment_absolute_time` et `fragment_index` doit augmenter de façon continue, mais elle est autorisée toointroduce une discontinuité, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="70504-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="70504-249">Media Services ignore les fragments qu’il a déjà reçu et traité, il est mieux tooerr côté hello du renvoi de fragments à toointroduce des discontinuités dans la chronologie du média hello.</span><span class="sxs-lookup"><span data-stu-id="70504-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="70504-250">9. Redondance de l’encodeur</span><span class="sxs-lookup"><span data-stu-id="70504-250">9. Encoder redundancy</span></span>
<span data-ttu-id="70504-251">Les événements que plus grande disponibilité de la demande et la qualité d’expérience, nous avons recommandé d’utiliser les encodeurs redondants actif-actif tooachieve un basculement transparent sans perte de données en direct pour certaines critiques.</span><span class="sxs-lookup"><span data-stu-id="70504-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![Redondance de l’encodeur][image6]

<span data-ttu-id="70504-253">Comme illustré dans ce diagramme, deux groupes d’encodeurs push simultanément deux copies de chaque flux de données dans le service live hello.</span><span class="sxs-lookup"><span data-stu-id="70504-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="70504-254">Cette configuration est prise en charge, car Media Services peut filtrer les fragments en double en fonction de l’ID du flux et de l’horodatage des fragments.</span><span class="sxs-lookup"><span data-stu-id="70504-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="70504-255">Hello qui en résulte des flux live et archive est une copie unique de tous les flux hello agrégation possibles de hello meilleures de deux sources différentes hello.</span><span class="sxs-lookup"><span data-stu-id="70504-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="70504-256">Par exemple, dans un cas extrême hypothétique, tant qu’il existe un encodeur (il ne dispose pas toobe hello même) en cours d’exécution à un moment donné dans le temps pour chaque flux, hello qui résulte des flux live à partir du service de hello est continue sans perte de données.</span><span class="sxs-lookup"><span data-stu-id="70504-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="70504-257">exigences de Hello pour ce scénario sont même hello presque comme des spécifications hello dans les cas de « Basculement de l’encodeur » hello, avec l’exception de hello hello deuxième ensemble d’encodeurs s’exécutent au hello même moment que hello encodeurs principales.</span><span class="sxs-lookup"><span data-stu-id="70504-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="70504-258">10. Redondance du service</span><span class="sxs-lookup"><span data-stu-id="70504-258">10. Service redundancy</span></span>
<span data-ttu-id="70504-259">Parfois destinés à redondance élevée, vous devez avoir les sinistres régionaux toohandle de sauvegarde entre régions.</span><span class="sxs-lookup"><span data-stu-id="70504-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="70504-260">Développement de topologie de « Redondance encodeur » hello, clients peuvent choisir toohave un déploiement de service redondant dans une région différente est connectée avec hello deuxième ensemble d’encodeurs.</span><span class="sxs-lookup"><span data-stu-id="70504-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="70504-261">Les clients peuvent également travailler avec un toodeploy de fournisseur un gestionnaire de trafic Global devant hello deux déploiements tooseamlessly itinéraire client trafic du service de réseau de livraison de contenu.</span><span class="sxs-lookup"><span data-stu-id="70504-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="70504-262">configuration requise de Hello pour les encodeurs hello est identique hello cas de « Redondance encodeur » hello.</span><span class="sxs-lookup"><span data-stu-id="70504-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="70504-263">Hello seule exception est que hello deuxième ensemble d’encodeurs besoins toobe pointé live tooa autre point de terminaison de réception.</span><span class="sxs-lookup"><span data-stu-id="70504-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="70504-264">Hello diagramme suivant illustre cette configuration :</span><span class="sxs-lookup"><span data-stu-id="70504-264">hello following diagram shows this setup:</span></span>

![Redondance du service][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="70504-266">11. Types spéciaux de formats d’ingestion</span><span class="sxs-lookup"><span data-stu-id="70504-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="70504-267">Cette section traite des types particuliers de formats de réception dynamique toohandle conçu des scénarios spécifiques.</span><span class="sxs-lookup"><span data-stu-id="70504-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="70504-268">Piste partiellement allouée</span><span class="sxs-lookup"><span data-stu-id="70504-268">Sparse track</span></span>
<span data-ttu-id="70504-269">Lors de la remise d’une présentation de diffusion en continu en direct avec une expérience client riche, souvent qu’il est nécessaire tootransmit synchronisés à la fois les événements ou signale en intrabande avec les données de support principal hello.</span><span class="sxs-lookup"><span data-stu-id="70504-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="70504-270">L’insertion de publicités dynamiques en direct en est un exemple.</span><span class="sxs-lookup"><span data-stu-id="70504-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="70504-271">Ce type de signalisation d'événement diffère de la diffusion audio/vidéo en continu standard en raison de sa nature partiellement allouée.</span><span class="sxs-lookup"><span data-stu-id="70504-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="70504-272">En d’autres termes, hello signalisation données généralement ne pas se produisent en continu et l’intervalle de salutation peut être toopredict dur.</span><span class="sxs-lookup"><span data-stu-id="70504-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="70504-273">concept de Hello de piste partiellement a été conçue tooingest et les données de signalisation de diffusion en intrabande.</span><span class="sxs-lookup"><span data-stu-id="70504-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="70504-274">Hello étapes suivantes sont une implémentation recommandée pour la réception de piste partiellement :</span><span class="sxs-lookup"><span data-stu-id="70504-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="70504-275">Créez un flux binaire MP4 fragmenté distinct qui contient uniquement des pistes partiellement allouées, sans pistes audio/vidéo.</span><span class="sxs-lookup"><span data-stu-id="70504-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="70504-276">Bonjour **zone de manifeste de serveur Live** tel que défini dans la Section 6 de [1], utilisez hello *parentTrackName* toospecify hello nom suivi du parent hello. Pour plus d’informations, consultez la section 4.2.1.2.1.2 dans [1].</span><span class="sxs-lookup"><span data-stu-id="70504-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="70504-277">Bonjour **zone de manifeste de serveur Live**, **manifestOutput** doit être défini trop**true**.</span><span class="sxs-lookup"><span data-stu-id="70504-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="70504-278">Compte tenu de nature éparses hello Hello signalisation d’événement, nous vous recommandons suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="70504-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="70504-279">a.</span><span class="sxs-lookup"><span data-stu-id="70504-279">a.</span></span> <span data-ttu-id="70504-280">Au début de hello d’événement en direct hello, encodeur de hello envoie les zones d’en-tête initiale hello toohello service, ce qui permet de piste partiellement hello service tooregister hello manifeste hello du client.</span><span class="sxs-lookup"><span data-stu-id="70504-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="70504-281">b.</span><span class="sxs-lookup"><span data-stu-id="70504-281">b.</span></span> <span data-ttu-id="70504-282">encodeur de Hello doit s’arrêter de requête HTTP POST hello lorsque les données ne sont pas envoyées.</span><span class="sxs-lookup"><span data-stu-id="70504-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="70504-283">Une publication HTTP longue qui n’envoient pas de données peut empêcher le déconnecter rapidement les encodeur hello dans les cas de hello d’un redémarrage du serveur ou de mise à jour de service de Media Services.</span><span class="sxs-lookup"><span data-stu-id="70504-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="70504-284">Dans ces cas, serveur multimédia de hello est temporairement bloqué dans une opération de réception sur le socket de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="70504-285">c.</span><span class="sxs-lookup"><span data-stu-id="70504-285">c.</span></span> <span data-ttu-id="70504-286">Au moment de hello lorsque signalant des données n’est pas disponible, les encodeur hello doivent fermer de requête HTTP POST hello.</span><span class="sxs-lookup"><span data-stu-id="70504-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="70504-287">Lors de la demande POST de hello est actif, les encoder hello doit envoyer des données.</span><span class="sxs-lookup"><span data-stu-id="70504-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="70504-288">d.</span><span class="sxs-lookup"><span data-stu-id="70504-288">d.</span></span> <span data-ttu-id="70504-289">Lors de l’envoi des fragments éparses, encodeur de hello peut définir un en-tête content-length explicit, s’il est disponible.</span><span class="sxs-lookup"><span data-stu-id="70504-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="70504-290">e.</span><span class="sxs-lookup"><span data-stu-id="70504-290">e.</span></span> <span data-ttu-id="70504-291">Lors de l’envoi de fragments éparses à une nouvelle connexion, encodeur de hello doit commencer à envoyer à partir des zones d’en-tête hello, suivies de fragments de nouveau hello.</span><span class="sxs-lookup"><span data-stu-id="70504-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="70504-292">Il s’agit de cas dans lequel le basculement se produit entre ces et connexion éparses hello est établie tooa nouveau serveur qui n’a pas été trouvé avant de piste partiellement hello.</span><span class="sxs-lookup"><span data-stu-id="70504-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="70504-293">f.</span><span class="sxs-lookup"><span data-stu-id="70504-293">f.</span></span> <span data-ttu-id="70504-294">fragment de piste partiellement Hello devient disponible toohello client lors hello correspondant parent suivi fragment qui a une valeur supérieure ou égale timestamp disponible toohello client.</span><span class="sxs-lookup"><span data-stu-id="70504-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="70504-295">Par exemple, si le fragment d’éparses hello a un horodateur de t = 1000, il est probable qu’une fois que le client de hello voit horodatage 1000 du fragment « vidéo » (en supposant que nom de la piste hello parent est « vidéo ») ou version ultérieure, il peut télécharger hello fragment éparses t = 1000.</span><span class="sxs-lookup"><span data-stu-id="70504-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="70504-296">Notez que ce signal réel hello peut être utilisé pour une autre position dans la chronologie de présentation hello pour son objectif désigné.</span><span class="sxs-lookup"><span data-stu-id="70504-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="70504-297">Dans cet exemple, il s’agit de possibles qui hello éparse fragment de t = 1000 a une charge utile XML, ce qui concerne l’insertion d’une publicité dans une position qui est de quelques secondes plus tard.</span><span class="sxs-lookup"><span data-stu-id="70504-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="70504-298">g.</span><span class="sxs-lookup"><span data-stu-id="70504-298">g.</span></span> <span data-ttu-id="70504-299">charge utile de Hello de piste partiellement fragments peut être dans différents formats (par exemple, XML, texte ou binaire), selon le scénario de hello.</span><span class="sxs-lookup"><span data-stu-id="70504-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="70504-300">Piste audio redondante</span><span class="sxs-lookup"><span data-stu-id="70504-300">Redundant audio track</span></span>
<span data-ttu-id="70504-301">Dans un HTTP adaptative en continu scénario classique (par exemple, la diffusion en continu lisse ou tiret), il existe souvent qu’une piste audio dans l’ensemble de la présentation hello.</span><span class="sxs-lookup"><span data-stu-id="70504-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="70504-302">Contrairement aux pistes vidéo, qui ont plusieurs niveaux de qualité pour hello toochoose de client à partir de conditions d’erreur, piste audio de hello peut être un point de défaillance unique si hello ingestion du flux hello qui contient la piste audio de hello est interrompue.</span><span class="sxs-lookup"><span data-stu-id="70504-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="70504-303">toosolve ce problème, Media Services prend en charge live ingestion des pistes audio redondant.</span><span class="sxs-lookup"><span data-stu-id="70504-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="70504-304">Hello est que hello même piste audio peut être envoyé plusieurs fois dans les différents flux.</span><span class="sxs-lookup"><span data-stu-id="70504-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="70504-305">Bien que hello service inscrit uniquement piste audio de hello qu’une seule fois dans le manifeste du client hello, il peut utiliser des pistes audio redondant en tant que les sauvegardes pour récupérer les fragments audio si piste audio principale de hello présente des problèmes.</span><span class="sxs-lookup"><span data-stu-id="70504-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="70504-306">tooingest des pistes audio redondant, encodeur de hello doit :</span><span class="sxs-lookup"><span data-stu-id="70504-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="70504-307">Créez hello piste audio même dans plusieurs fragments MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="70504-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="70504-308">pistes redondant Hello doivent être sémantiquement équivalentes, par hello même fragment horodateurs et sont interchangeables à l’en-tête de hello et niveaux de fragment.</span><span class="sxs-lookup"><span data-stu-id="70504-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="70504-309">Vérifiez l’entrée « audio » hello Bonjour Live Server manifeste (Section 6 dans [1]) est hello même pour les pistes audio redondants.</span><span class="sxs-lookup"><span data-stu-id="70504-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="70504-310">Hello suivant l’implémentation est recommandée pour les pistes audio redondant :</span><span class="sxs-lookup"><span data-stu-id="70504-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="70504-311">Envoyez chaque piste audio unique dans un flux toute seule.</span><span class="sxs-lookup"><span data-stu-id="70504-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="70504-312">En outre, envoyer un flux de données redondante pour chacun de ces flux de la piste audio, où les flux deuxième hello différent hello tout d’abord uniquement par un identificateur hello Bonjour poster une URL HTTP : {protocole}  :// {adresse serveur} / {path}/Streams({identifier}) de point de publication.</span><span class="sxs-lookup"><span data-stu-id="70504-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="70504-313">Utiliser des flux distincts toosend hello deux le plus bas vidéo débits binaires.</span><span class="sxs-lookup"><span data-stu-id="70504-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="70504-314">Chacun de ces flux DOIT également contenir une copie de chaque piste audio unique. Par exemple, quand plusieurs langues sont prises en charge, ces flux DOIVENT contenir des pistes audio pour chaque langue.</span><span class="sxs-lookup"><span data-stu-id="70504-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="70504-315">Utiliser un serveur distinct (encodeur) instances tooencode et envoyer des flux de données redondantes hello mentionné dans (1) et (2).</span><span class="sxs-lookup"><span data-stu-id="70504-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="70504-316">Parcours d’apprentissage de Media Services</span><span class="sxs-lookup"><span data-stu-id="70504-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="70504-317">Fournir des commentaires</span><span class="sxs-lookup"><span data-stu-id="70504-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
