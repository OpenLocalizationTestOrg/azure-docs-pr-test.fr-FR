---
title: "CENC avec Multi-DRM et contrôle d’accès : une conception de référence et l’application sur Windows Azure et Azure Media Services | Microsoft Docs"
description: "En savoir plus sur la licence du kit de portage Smooth Streaming client Microsoft®."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 730917b6859f8dbd800ef2cb141062f45d7779ac
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="6b819-103">CENC avec Multi-DRM et contrôle d’accès : une conception de référence et l’application sur Windows Azure et Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="6b819-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="6b819-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="6b819-104">Introduction</span></span>
<span data-ttu-id="6b819-105">Il est bien connu que la conception et la mise en place d’un sous-système DRM pour une OTT ou une solution de diffusion en continu en ligne est une tâche complexe.</span><span class="sxs-lookup"><span data-stu-id="6b819-105">It is well known that it is a complex task to design and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="6b819-106">Et il est très courant que les fournisseurs/opérateurs de vidéo en ligne externalisent cette partie aux fournisseurs de services spécialisés DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-106">And it is a common practice for operators/online video providers to outsource this part to specialized DRM service providers.</span></span> <span data-ttu-id="6b819-107">L’objectif de ce document est de présenter la conception et l’implémentation d’un sous-système DRM de bout en bout dans OTT ou une solution de diffusion en ligne en continu de référence.</span><span class="sxs-lookup"><span data-stu-id="6b819-107">The goal of this document is to present a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="6b819-108">Les lecteurs ciblés de ce document sont des ingénieurs travaillant dans un sous-système DRM d’OTT ou des solutions de diffusion en ligne/à plusieurs écrans, ou tous les lecteurs intéressés par les sous-systèmes de gestion des droits numériques.</span><span class="sxs-lookup"><span data-stu-id="6b819-108">The targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="6b819-109">L’hypothèse est que les lecteurs sont familiers avec au moins une des technologies DRM sur le marché, notamment PlayReady, Widevine, FairPlay ou Adobe Access.</span><span class="sxs-lookup"><span data-stu-id="6b819-109">The assumption is that readers are familiar with at least one of the DRM technologies on the market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="6b819-110">Par DRM, nous entendons également CENC (chiffrement commun) avec multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="6b819-111">Une tendance majeure de l’industrie de la diffusion en continu en ligne et OTT consiste à utiliser CENC avec multi-DRM natif sur plusieurs plateformes clientes, ce qui représente une évolution par rapport à la tendance précédente, qui consistait à utiliser un seul DRM et son kit de développement logiciel client pour différentes plateformes clientes.</span><span class="sxs-lookup"><span data-stu-id="6b819-111">A major trend in online streaming and OTT industry is to use CENC with multi-native-DRM on various client platforms, which is a shift from the previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="6b819-112">Lors de l’utilisation de CENC avec DRM multi natif, PlayReady et Windevine sont chiffrés conformément à la spécification [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) .</span><span class="sxs-lookup"><span data-stu-id="6b819-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per the [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="6b819-113">Les avantages de CENC avec multi-DRM sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-113">The benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="6b819-114">réduction des frais de chiffrement dans la mesure où un seul traitement de chiffrement est utilisé, ciblant différentes plateformes avec ses DRM natifs ;</span><span class="sxs-lookup"><span data-stu-id="6b819-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="6b819-115">réduction du coût de la gestion des ressources chiffrées, car une seule copie de ces dernières est nécessaire ;</span><span class="sxs-lookup"><span data-stu-id="6b819-115">Reduces the cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="6b819-116">élimination les coûts de licence de client DRM natif, car ce dernier est généralement proposé gratuitement sur sa plate-forme d’origine.</span><span class="sxs-lookup"><span data-stu-id="6b819-116">Eliminates DRM client licensing cost since the native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="6b819-117">Microsoft a joué le rôle de promoteur actif de DASH et de CENC, tout comme d’autres acteurs majeurs du secteur.</span><span class="sxs-lookup"><span data-stu-id="6b819-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="6b819-118">Microsoft Azure Media Services offre la prise en charge de DASH et CENC.</span><span class="sxs-lookup"><span data-stu-id="6b819-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="6b819-119">Pour les dernières annonces, consultez les blogs de Mingfei : [Annonce d’une distribution de licence Google Widevine dans Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/) et [Azure Media Services ajoute un package Gooble Windevine pour la distribution de flux multi-DRM](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span><span class="sxs-lookup"><span data-stu-id="6b819-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="6b819-120">Présentation de cet article</span><span class="sxs-lookup"><span data-stu-id="6b819-120">Overview of this article</span></span>
<span data-ttu-id="6b819-121">L’objectif de cet article inclut les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-121">The goal of this article includes the following:</span></span>

1. <span data-ttu-id="6b819-122">fourniture d’une conception de référence du sous-système de gestion des droits numériques avec CENC multi-DRM ;</span><span class="sxs-lookup"><span data-stu-id="6b819-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="6b819-123">fourniture d’une implémentation de référence sur la plateforme Microsoft Azure/Azure Media Services ;</span><span class="sxs-lookup"><span data-stu-id="6b819-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="6b819-124">Commentaires de certaines rubriques relatives à la conception et l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="6b819-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="6b819-125">Dans cet article, « multi DRM » aborde les thèmes suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-125">In the article, “multi-DRM” covers the following:</span></span>

1. <span data-ttu-id="6b819-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="6b819-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="6b819-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="6b819-127">Google Widevine</span></span>
3. <span data-ttu-id="6b819-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="6b819-128">Apple FairPlay</span></span> 

<span data-ttu-id="6b819-129">Le tableau suivant résume l’application de la plateforme/application native et les navigateurs pris en charge pour chaque DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-129">The following table summarizes the native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="6b819-130">**Plateforme cliente**</span><span class="sxs-lookup"><span data-stu-id="6b819-130">**Client Platform**</span></span> | <span data-ttu-id="6b819-131">**Prise en charge native de DRM**</span><span class="sxs-lookup"><span data-stu-id="6b819-131">**Native DRM Support**</span></span> | <span data-ttu-id="6b819-132">**Navigateur/App**</span><span class="sxs-lookup"><span data-stu-id="6b819-132">**Browser/App**</span></span> | <span data-ttu-id="6b819-133">**Formats de diffusion en continu**</span><span class="sxs-lookup"><span data-stu-id="6b819-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6b819-134">**Téléviseurs intelligents, récepteurs d’opérateur, récepteurs OTT**</span><span class="sxs-lookup"><span data-stu-id="6b819-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="6b819-135">PlayReady principalement, et/ou Widevine, et/ou autres</span><span class="sxs-lookup"><span data-stu-id="6b819-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="6b819-136">Linux, Opera, WebKit, autre</span><span class="sxs-lookup"><span data-stu-id="6b819-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="6b819-137">Divers formats</span><span class="sxs-lookup"><span data-stu-id="6b819-137">Various formats</span></span> |
| <span data-ttu-id="6b819-138">**Appareils Windows 10 (PC Windows, tablettes Windows, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="6b819-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="6b819-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="6b819-139">PlayReady</span></span> |<span data-ttu-id="6b819-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="6b819-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="6b819-141">UWP</span><span class="sxs-lookup"><span data-stu-id="6b819-141">UWP</span></span> |<span data-ttu-id="6b819-142">DASH (pour HLS, PlayReady n’est pas pris en charge)</span><span class="sxs-lookup"><span data-stu-id="6b819-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="6b819-143">DASH, Smooth Streaming (pour HLS, PlayReady n’est pas pris en charge)</span><span class="sxs-lookup"><span data-stu-id="6b819-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="6b819-144">**Appareils Android (téléphone, tablette, TV)**</span><span class="sxs-lookup"><span data-stu-id="6b819-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="6b819-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="6b819-145">Widevine</span></span> |<span data-ttu-id="6b819-146">Chrome/EME</span><span class="sxs-lookup"><span data-stu-id="6b819-146">Chrome/EME</span></span> |<span data-ttu-id="6b819-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="6b819-147">DASH,HLS</span></span> |
| <span data-ttu-id="6b819-148">**iOS (iPhone, iPad), clients OS X et Apple TV**</span><span class="sxs-lookup"><span data-stu-id="6b819-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="6b819-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="6b819-149">FairPlay</span></span> |<span data-ttu-id="6b819-150">Safari 8+/EME</span><span class="sxs-lookup"><span data-stu-id="6b819-150">Safari 8+/EME</span></span> |<span data-ttu-id="6b819-151">HLS</span><span class="sxs-lookup"><span data-stu-id="6b819-151">HLS</span></span> |


<span data-ttu-id="6b819-152">Compte tenu de l'état actuel du déploiement de chaque DRM, un service mettra généralement en œuvre 2 ou 3 DRM pour s’assurer que vous gérez tous les types de points de terminaison de façon optimale.</span><span class="sxs-lookup"><span data-stu-id="6b819-152">Considering the current state of deployment for each DRM, a service will typically want to implement 2 or 3 DRMs to make sure you address all the types of endpoints in the best way.</span></span>

<span data-ttu-id="6b819-153">Il existe un compromis entre la complexité de la logique du service et la complexité côté client pour atteindre un certain niveau d'expérience utilisateur sur les différents clients.</span><span class="sxs-lookup"><span data-stu-id="6b819-153">There is a tradeoff between the complexity of the service logic and the complexity on the client side to reach a certain level of user experience on the various clients.</span></span>

<span data-ttu-id="6b819-154">Pour effectuer votre sélection, prenez en compte les faits suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-154">To make your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="6b819-155">PlayReady est implémenté en mode natif dans tous les appareils Windows, sur certains appareils Android, et est disponible via les kits de développement logiciel (SDK) sur pratiquement n'importe quelle plate-forme</span><span class="sxs-lookup"><span data-stu-id="6b819-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="6b819-156">Widevine est implémenté en mode natif dans chaque appareil Android, dans Chrome, et dans certains autres appareils</span><span class="sxs-lookup"><span data-stu-id="6b819-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="6b819-157">FairPlay est disponible uniquement sur iOS et les clients Mac OS ou via iTunes.</span><span class="sxs-lookup"><span data-stu-id="6b819-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="6b819-158">Par conséquent, une configuration multi-DRM standard serait :</span><span class="sxs-lookup"><span data-stu-id="6b819-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="6b819-159">Option 1 : PlayReady et Widevine</span><span class="sxs-lookup"><span data-stu-id="6b819-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="6b819-160">Option 2 : PlayReady, Widevine et FairPlay</span><span class="sxs-lookup"><span data-stu-id="6b819-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="6b819-161">Une conception de référence</span><span class="sxs-lookup"><span data-stu-id="6b819-161">A reference design</span></span>
<span data-ttu-id="6b819-162">Dans cette section, nous présenterons une conception de référence indépendante des technologies utilisées pour leur mise en œuvre.</span><span class="sxs-lookup"><span data-stu-id="6b819-162">In this section, we will present a reference design which is agnostic to technologies used to implement it.</span></span>

<span data-ttu-id="6b819-163">Un sous-système DRM peut contenir les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-163">A DRM subsystem may contain the following components:</span></span>

1. <span data-ttu-id="6b819-164">Gestion des clés</span><span class="sxs-lookup"><span data-stu-id="6b819-164">Key management</span></span>
2. <span data-ttu-id="6b819-165">Packaging DRM</span><span class="sxs-lookup"><span data-stu-id="6b819-165">DRM packaging</span></span>
3. <span data-ttu-id="6b819-166">Remise de licence DRM</span><span class="sxs-lookup"><span data-stu-id="6b819-166">DRM license delivery</span></span>
4. <span data-ttu-id="6b819-167">Vérification des droits</span><span class="sxs-lookup"><span data-stu-id="6b819-167">Entitlement check</span></span>
5. <span data-ttu-id="6b819-168">Authentification/autorisation</span><span class="sxs-lookup"><span data-stu-id="6b819-168">Authentication/authorization</span></span>
6. <span data-ttu-id="6b819-169">Lecteur</span><span class="sxs-lookup"><span data-stu-id="6b819-169">Player</span></span>
7. <span data-ttu-id="6b819-170">Origine/CDN</span><span class="sxs-lookup"><span data-stu-id="6b819-170">Origin/CDN</span></span>

<span data-ttu-id="6b819-171">Le diagramme suivant illustre l’interaction entre les composants d’un sous-système DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-171">The following diagram illustrates the high level interaction among the components in a DRM subsystem.</span></span>

![Sous-système de gestion des droits numériques avec CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="6b819-173">La conception compte trois couches de base :</span><span class="sxs-lookup"><span data-stu-id="6b819-173">There are three basic “layers” in the design:</span></span>

1. <span data-ttu-id="6b819-174">Couche back-office (en noir) qui n’est pas présentée à l’extérieur ;</span><span class="sxs-lookup"><span data-stu-id="6b819-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="6b819-175">Couche « DMZ » (en bleu) contenant tous les points de terminaison exposés au public ;</span><span class="sxs-lookup"><span data-stu-id="6b819-175">“DMZ” layer (blue) containing all the endpoints facing public;</span></span>
3. <span data-ttu-id="6b819-176">Couche Internet Public (en bleu clair) contenant les réseaux de diffusion en continu et des lecteurs avec le trafic transitant par l’Internet public.</span><span class="sxs-lookup"><span data-stu-id="6b819-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="6b819-177">Il doit exister un outil de gestion de contenu pour le contrôle de la protection DRM, que le chiffrement soit statique ou dynamique.</span><span class="sxs-lookup"><span data-stu-id="6b819-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="6b819-178">Les entrées de chiffrement de la gestion des droits numériques doivent inclure :</span><span class="sxs-lookup"><span data-stu-id="6b819-178">The inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="6b819-179">le contenu vidéo MBR ;</span><span class="sxs-lookup"><span data-stu-id="6b819-179">MBR video content;</span></span>
2. <span data-ttu-id="6b819-180">la clé de contenu ;</span><span class="sxs-lookup"><span data-stu-id="6b819-180">Content key;</span></span>
3. <span data-ttu-id="6b819-181">URL d’acquisition de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-181">License acquisition URLs.</span></span>

<span data-ttu-id="6b819-182">Pendant la lecture, le flux de haut niveau suit le déroulement suivant :</span><span class="sxs-lookup"><span data-stu-id="6b819-182">During playback time, the high level flow is:</span></span>

1. <span data-ttu-id="6b819-183">l’utilisateur est authentifié ;</span><span class="sxs-lookup"><span data-stu-id="6b819-183">User is authenticated;</span></span>
2. <span data-ttu-id="6b819-184">un jeton d’autorisation est créé pour l’utilisateur ;</span><span class="sxs-lookup"><span data-stu-id="6b819-184">Authorization token is created for the user;</span></span>
3. <span data-ttu-id="6b819-185">le contenu protégé par DRM (manifeste) est téléchargé sur le lecteur ;</span><span class="sxs-lookup"><span data-stu-id="6b819-185">DRM protected content (manifest) is downloaded to player;</span></span>
4. <span data-ttu-id="6b819-186">le joueur soumet la demande d’acquisition de licence pour les serveurs de licence avec l’ID de clé et le jeton d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="6b819-186">Player submits license acquisition request to license servers together with key ID and authorization token.</span></span>

<span data-ttu-id="6b819-187">Avant de passer à la rubrique suivante, quelques mots sur la conception de la gestion de clés.</span><span class="sxs-lookup"><span data-stu-id="6b819-187">Before moving to the next topic, a few words about the design of key management.</span></span>

| <span data-ttu-id="6b819-188">**ContentKey vers ressources**</span><span class="sxs-lookup"><span data-stu-id="6b819-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="6b819-189">**Scénario**</span><span class="sxs-lookup"><span data-stu-id="6b819-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="6b819-190">1 à 1</span><span class="sxs-lookup"><span data-stu-id="6b819-190">1–to-1</span></span> |<span data-ttu-id="6b819-191">Le cas le plus simple.</span><span class="sxs-lookup"><span data-stu-id="6b819-191">The simplest case.</span></span> <span data-ttu-id="6b819-192">Il offre le meilleur contrôle.</span><span class="sxs-lookup"><span data-stu-id="6b819-192">It provides the finest control.</span></span> <span data-ttu-id="6b819-193">Il génère en général le coût de licence le plus élevé.</span><span class="sxs-lookup"><span data-stu-id="6b819-193">But this generally results in the highest license delivery cost.</span></span> <span data-ttu-id="6b819-194">Chaque ressource protégée nécessite au moins une licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="6b819-195">1 à plusieurs</span><span class="sxs-lookup"><span data-stu-id="6b819-195">1–to-Many</span></span> |<span data-ttu-id="6b819-196">Vous pouvez utiliser la même clé de contenu pour plusieurs éléments multimédias.</span><span class="sxs-lookup"><span data-stu-id="6b819-196">You could use the same content key for multiple assets.</span></span> <span data-ttu-id="6b819-197">Par exemple, pour tous les éléments multimédias d’un groupe logique comme un genre ou un sous-ensemble de genre (ou séquence génétique), vous pouvez utiliser une clé de contenu unique.</span><span class="sxs-lookup"><span data-stu-id="6b819-197">For example, for all the assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="6b819-198">Plusieurs à 1</span><span class="sxs-lookup"><span data-stu-id="6b819-198">Many–to-1</span></span> |<span data-ttu-id="6b819-199">Plusieurs clés de contenu sont nécessaires pour chaque élément multimédia.</span><span class="sxs-lookup"><span data-stu-id="6b819-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="6b819-200">Par exemple, si vous devez appliquer la protection dynamique CENC avec multi-DRM à MPEG-DASH et le chiffrement AES-128 pour TLS, vous avez besoin de deux clés de contenu distinctes, chacune avec son propre ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="6b819-200">For example, if you need to apply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="6b819-201">(Concernant la clé de contenu utilisée pour la protection CENC dynamique, ContentKeyType.CommonEncryption doit être utilisée. Pour la clé de contenu servant au chiffrement dynamique AES-128, c’est la clé ContentKeyType.EnvelopeEncryption qui doit être utilisée.)</span><span class="sxs-lookup"><span data-stu-id="6b819-201">(For the content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for the content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="6b819-202">Autre exemple, pour la protection CENC du contenu DASH, en théorie, une clé de contenu peut être utilisée pour protéger les flux vidéo et une autre clé de contenu pour protéger des flux audio.</span><span class="sxs-lookup"><span data-stu-id="6b819-202">Another example, in CENC protection of DASH content, in theory, one content key can be used to protect video stream and another content key to protect audio stream.</span></span> |
| <span data-ttu-id="6b819-203">Plusieurs à plusieurs</span><span class="sxs-lookup"><span data-stu-id="6b819-203">Many – to - Many</span></span> |<span data-ttu-id="6b819-204">Combinaison des deux scénarios ci-dessus : un jeu de clés de contenu est utilisé pour chacun des éléments multimédia du même « groupe ».</span><span class="sxs-lookup"><span data-stu-id="6b819-204">Combination of the above two scenarios: one set of content keys are used for each of the multiple assets in the same asset “group”.</span></span> |

<span data-ttu-id="6b819-205">Autre facteur important à prendre en compte : l’utilisation des licences persistantes et non persistantes.</span><span class="sxs-lookup"><span data-stu-id="6b819-205">Another important factor to consider is the use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="6b819-206">Pourquoi ces considérations sont-elles importantes ?</span><span class="sxs-lookup"><span data-stu-id="6b819-206">Why are these considerations important?</span></span>

<span data-ttu-id="6b819-207">Elles ont un impact direct sur le coût de distribution de la licence si vous utilisez le cloud public pour la distribution de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-207">They have direct impact to license delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="6b819-208">Prenons deux cas différents pour illustrer le cas :</span><span class="sxs-lookup"><span data-stu-id="6b819-208">Let’s consider the following two different design cases to illustrate:</span></span>

1. <span data-ttu-id="6b819-209">Abonnement mensuel : utilisation d’une licence persistante et d’un mappage clé à ressource 1 à plusieurs.</span><span class="sxs-lookup"><span data-stu-id="6b819-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="6b819-210">Par exemple,</span><span class="sxs-lookup"><span data-stu-id="6b819-210">E.g.</span></span> <span data-ttu-id="6b819-211">pour tous les films pour enfant, nous utilisons une clé de contenu unique pour le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="6b819-211">for all the kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="6b819-212">Dans ce cas :</span><span class="sxs-lookup"><span data-stu-id="6b819-212">In this case:</span></span>

    <span data-ttu-id="6b819-213">Nombre total de licences requis pour tous les films/appareils = 1</span><span class="sxs-lookup"><span data-stu-id="6b819-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="6b819-214">Abonnement mensuel : utilisation d’une licence non persistante et du mappage 1 à 1 entre la clé de contenu et la ressource de contenu.</span><span class="sxs-lookup"><span data-stu-id="6b819-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="6b819-215">Dans ce cas :</span><span class="sxs-lookup"><span data-stu-id="6b819-215">In this case:</span></span>

    <span data-ttu-id="6b819-216">Nombre total de licences requis pour tous les films/appareils = [nombre de films # regardés] x [# de séances]</span><span class="sxs-lookup"><span data-stu-id="6b819-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="6b819-217">Comme vous pouvez le voir, ces deux conceptions différentes débouchent sur des modèles de demande de licence et, donc des frais de distribution de licence très différents si cette dernière est fournie par le cloud public (par exemple, Azure Media Services).</span><span class="sxs-lookup"><span data-stu-id="6b819-217">As you can easily see, the two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-to-technology-for-implementation"></a><span data-ttu-id="6b819-218">Correspondance entre conception et technologie pour la mise en œuvre</span><span class="sxs-lookup"><span data-stu-id="6b819-218">Mapping design to technology for implementation</span></span>
<span data-ttu-id="6b819-219">Nous allons ensuite associer notre conception générique aux technologies de plate-forme Microsoft Azure/Azure Media Services, en spécifiant la technologie à utiliser pour chaque bloc de construction.</span><span class="sxs-lookup"><span data-stu-id="6b819-219">Next, we map our generic design to technologies on Microsoft Azure/Azure Media Services platform, by specifying which technology to use for each building block.</span></span>

<span data-ttu-id="6b819-220">La table qui suit affiche le mappage :</span><span class="sxs-lookup"><span data-stu-id="6b819-220">The following table shows the mapping:</span></span>

| <span data-ttu-id="6b819-221">**Bloc de construction**</span><span class="sxs-lookup"><span data-stu-id="6b819-221">**Building Block**</span></span> | <span data-ttu-id="6b819-222">**Technology**</span><span class="sxs-lookup"><span data-stu-id="6b819-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="6b819-223">**Lecteur**</span><span class="sxs-lookup"><span data-stu-id="6b819-223">**Player**</span></span> |[<span data-ttu-id="6b819-224">Azure Media Player</span><span class="sxs-lookup"><span data-stu-id="6b819-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="6b819-225">**Fournisseur d’identité (IDP)**</span><span class="sxs-lookup"><span data-stu-id="6b819-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="6b819-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6b819-226">Azure Active Directory</span></span> |
| <span data-ttu-id="6b819-227">**Secure Token Service (Service d’émission de jeton de sécurité - STS)**</span><span class="sxs-lookup"><span data-stu-id="6b819-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="6b819-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6b819-228">Azure Active Directory</span></span> |
| <span data-ttu-id="6b819-229">**Flux de travail de Protection DRM**</span><span class="sxs-lookup"><span data-stu-id="6b819-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="6b819-230">Protection dynamique Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="6b819-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="6b819-231">**Distribution de licence DRM**</span><span class="sxs-lookup"><span data-stu-id="6b819-231">**DRM License Delivery**</span></span> |<span data-ttu-id="6b819-232">1. Distribution de licence Azure Media Services (PlayReady, Widevine, FairPlay) ou</span><span class="sxs-lookup"><span data-stu-id="6b819-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="6b819-233">2. Serveur de licences de Axinom,</span><span class="sxs-lookup"><span data-stu-id="6b819-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="6b819-234">3. Serveur de licences PlayReady personnalisé</span><span class="sxs-lookup"><span data-stu-id="6b819-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="6b819-235">**Origine**</span><span class="sxs-lookup"><span data-stu-id="6b819-235">**Origin**</span></span> |<span data-ttu-id="6b819-236">Point de terminaison des Services de diffusion multimédia en continu Azure</span><span class="sxs-lookup"><span data-stu-id="6b819-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="6b819-237">**Gestion des clés**</span><span class="sxs-lookup"><span data-stu-id="6b819-237">**Key Management**</span></span> |<span data-ttu-id="6b819-238">Inutile pour l’implémentation de référence</span><span class="sxs-lookup"><span data-stu-id="6b819-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="6b819-239">**Gestion de contenu**</span><span class="sxs-lookup"><span data-stu-id="6b819-239">**Content Management**</span></span> |<span data-ttu-id="6b819-240">Une application de console C#</span><span class="sxs-lookup"><span data-stu-id="6b819-240">A C# console application</span></span> |

<span data-ttu-id="6b819-241">En d’autres termes, le fournisseur d’identité (IDP) et du STS (Service d’émission de jeton de sécurité - Secure Token Services) sera AD Azure.</span><span class="sxs-lookup"><span data-stu-id="6b819-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="6b819-242">Nous utiliserons l’ [API de lecteur Azure Media](http://amp.azure.net/libs/amp/latest/docs/)comme lecteur.</span><span class="sxs-lookup"><span data-stu-id="6b819-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="6b819-243">Azure Media Services et le lecteur Azure Media prend en charge DASH et CENC avec multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="6b819-244">Le diagramme suivant affiche la structure et le flux d’ensemble avec le mappage technologique.</span><span class="sxs-lookup"><span data-stu-id="6b819-244">The following diagram shows the overall structure and flow with the above technology mapping.</span></span>

![CENC sur AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="6b819-246">Pour configurer le chiffrement dynamique de CENC, l’outil de gestion de contenu utilise les entrées suivantes :</span><span class="sxs-lookup"><span data-stu-id="6b819-246">In order to set up dynamic CENC encryption, the content management tool will use the following inputs:</span></span>

1. <span data-ttu-id="6b819-247">contenu ouvert ;</span><span class="sxs-lookup"><span data-stu-id="6b819-247">Open content;</span></span>
2. <span data-ttu-id="6b819-248">clé de contenu issue de la génération/la gestion de clé ;</span><span class="sxs-lookup"><span data-stu-id="6b819-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="6b819-249">URL d’acquisition de licence ;</span><span class="sxs-lookup"><span data-stu-id="6b819-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="6b819-250">liste d’informations fournie par Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="6b819-251">Le résultat de l’outil de gestion de contenu sera :</span><span class="sxs-lookup"><span data-stu-id="6b819-251">The output of the content management tool will be:</span></span>

1. <span data-ttu-id="6b819-252">ContentKeyAuthorizationPolicy, contenant la spécification de la distribution de licence vérifie un jeton JWT et les spécifications de licence DRM ;</span><span class="sxs-lookup"><span data-stu-id="6b819-252">ContentKeyAuthorizationPolicy containing the specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="6b819-253">AssetDeliveryPolicy contient des spécifications au format streaming, la protection DRM et les URL d’acquisition de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="6b819-254">Lors de l’exécution, le flux se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="6b819-254">During runtime, the flow is as below:</span></span>

1. <span data-ttu-id="6b819-255">au moment de l’authentification de l’utilisateur, un jeton JWT est généré ;</span><span class="sxs-lookup"><span data-stu-id="6b819-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="6b819-256">L’une des revendications contenues dans le jeton JWT est une revendication de type « groupes » qui contient l’ID d’objet de groupe de « EntitledUserGroup ».</span><span class="sxs-lookup"><span data-stu-id="6b819-256">One of the claims contained in the JWT token is “groups” claim containing the group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="6b819-257">Cette revendication sera utilisée pour le réussir la « vérification des droits ».</span><span class="sxs-lookup"><span data-stu-id="6b819-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="6b819-258">Le lecteur charge le manifeste client d’un contenu protégé CENC et « voit » le texte suivant :</span><span class="sxs-lookup"><span data-stu-id="6b819-258">Player downloads client manifest of a CENC protected content and “sees” the following:</span></span>

   1. <span data-ttu-id="6b819-259">ID de clé,</span><span class="sxs-lookup"><span data-stu-id="6b819-259">key ID,</span></span>
   2. <span data-ttu-id="6b819-260">le contenu est protégé par CENC</span><span class="sxs-lookup"><span data-stu-id="6b819-260">the content is CENC protected,</span></span>
   3. <span data-ttu-id="6b819-261">URL d’acquisition de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="6b819-262">Le lecteur effectue une demande d’acquisition de licence basée sur le navigateur/DRM pris en charge.</span><span class="sxs-lookup"><span data-stu-id="6b819-262">Player makes a license acquisition request based on the browser/DRM supported.</span></span> <span data-ttu-id="6b819-263">Dans la demande d’acquisition de clé, l’ID de clé et le jeton JWT sont eux aussi envoyés.</span><span class="sxs-lookup"><span data-stu-id="6b819-263">In the license acquisition request, key ID and the JWT token will also be submitted.</span></span> <span data-ttu-id="6b819-264">Le service de distribution de licence vérifie le jeton JWT et les revendications contenues avant la délivrance de la licence requise.</span><span class="sxs-lookup"><span data-stu-id="6b819-264">License delivery service will verify the JWT token and the claims contained before issuing the needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="6b819-265">Implémentation</span><span class="sxs-lookup"><span data-stu-id="6b819-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="6b819-266">Procédures de mise en œuvre</span><span class="sxs-lookup"><span data-stu-id="6b819-266">Implementation procedures</span></span>
<span data-ttu-id="6b819-267">La mise en œuvre comprend les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="6b819-267">The implementation will include the following steps:</span></span>

1. <span data-ttu-id="6b819-268">Préparer des ressources de test : coder/regrouper une vidéo de test dans un MP4 fragmenté à plusieurs vitesses dans Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="6b819-268">Prepare test asset(s): encode/package a test video to multi-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="6b819-269">Cet actif n’est pas protégé par DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="6b819-270">La protection DRM sera assurée par le biais d’une protection dynamique ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="6b819-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="6b819-271">Créez l’ID de clé et une clé de contenu (éventuellement à partir d’une amorce de clé).</span><span class="sxs-lookup"><span data-stu-id="6b819-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="6b819-272">Dans le cas présent, le système de gestion de clés n’est pas nécessaire dans la mesure où nous avons affaire à un seul ensemble d’ID de clés et de clé contenu pour plusieurs ressources de test ;</span><span class="sxs-lookup"><span data-stu-id="6b819-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="6b819-273">utilisez l’API AMS pour configurer les services de distribution de licence multi-DRM pour l’élément de test.</span><span class="sxs-lookup"><span data-stu-id="6b819-273">Use AMS API to configure multi-DRM license delivery services for the test asset.</span></span> <span data-ttu-id="6b819-274">Si vous utilisez des serveurs de licence personnalisés par le biais de votre société ou les fournisseurs de votre société et non les services de licence d’Azure Media Services, vous pouvez ignorer cette étape et spécifier les URL d’acquisition de licence lors de l’étape de configuration de la remise de la licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in the step for configuring license delivery.</span></span> <span data-ttu-id="6b819-275">L’API AMS sert à spécifier certaines configurations détaillées, comme la restriction de la stratégie d’autorisation, les modèles de réponse de licence des différents services de licence DRM, etc. À ce stade, le portail Azure ne fournit pas encore l’interface utilisateur nécessaire pour cette configuration.</span><span class="sxs-lookup"><span data-stu-id="6b819-275">AMS API is needed to specify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, the Azure portal does not yet provide the needed UI for this configuration.</span></span> <span data-ttu-id="6b819-276">Vous pouvez trouver des informations de niveau API et un exemple de code dans le document de Julia Kornich intitulé : [Utilisation du chiffrement commun dynamique PlayReady et/ou Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="6b819-277">Utilisez l’API AMS pour configurer une stratégie de distribution des éléments multimédia pour le test des éléments multimédia.</span><span class="sxs-lookup"><span data-stu-id="6b819-277">Use AMS API to configure asset delivery policy for the test asset.</span></span> <span data-ttu-id="6b819-278">Vous pouvez trouver des informations de niveau API et un exemple de code dans le document de Julia Kornich intitulé : [Utilisation du chiffrement commun dynamique PlayReady et/ou Widevine](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="6b819-279">créer et modifier un client Azure Active Directory dans Azure ;</span><span class="sxs-lookup"><span data-stu-id="6b819-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="6b819-280">créer plusieurs comptes d’utilisateurs et groupes dans votre client Azure Active Directory : vous devez créer au moins un groupe « EntitledUser » et ajouter un utilisateur à ce groupe.</span><span class="sxs-lookup"><span data-stu-id="6b819-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user to this group.</span></span> <span data-ttu-id="6b819-281">Les utilisateurs de ce groupe qui réussiront la vérification des droits lors de l’acquisition de licence et les utilisateurs n’appartenant pas à ce groupe échoueront au contrôle d’authentification et ne pourront pas acquérir de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail to pass authentication check and will not be able to acquire any license.</span></span> <span data-ttu-id="6b819-282">L’appartenance à un groupe « EntitledUser » est une revendication de « groupes » du jeton JWT délivré par AD Azure.</span><span class="sxs-lookup"><span data-stu-id="6b819-282">Being a member of this “EntitledUser” group is a required “groups” claim in the JWT token issued by Azure AD.</span></span> <span data-ttu-id="6b819-283">Cette exigence de revendication doit être spécifiée pendant l’opération de configuration de services de distribution de licence multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="6b819-284">Créez une application ASP.NET MVC qui hébergera votre lecteur vidéo.</span><span class="sxs-lookup"><span data-stu-id="6b819-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="6b819-285">Cette application ASP.NET sera protégée par le biais de l’authentification des utilisateurs par rapport au client Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6b819-285">This ASP.NET app will be protected with user authentication against the Azure Active Directory tenant.</span></span> <span data-ttu-id="6b819-286">Des revendications adéquates seront incluses dans les jetons d’accès obtenus après authentification de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6b819-286">Proper claims will be included in the access tokens obtained after user authentication.</span></span> <span data-ttu-id="6b819-287">L’API OpenID Connect est recommandée pour cette étape.</span><span class="sxs-lookup"><span data-stu-id="6b819-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="6b819-288">Vous devez installer les packages NuGet suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-288">You need to install the following NuGet packages:</span></span>
   * <span data-ttu-id="6b819-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="6b819-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="6b819-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="6b819-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="6b819-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="6b819-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="6b819-292">Install-Package Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="6b819-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="6b819-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="6b819-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="6b819-294">Créer un lecteur à l’aide d’ [API Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="6b819-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="6b819-295">[API ProtectionInfo d’Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/) vous permet de spécifier la technologie DRM à utiliser sur une autre plate-forme DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you to specify which DRM technology to use on different DRM platform.</span></span>
9. <span data-ttu-id="6b819-296">Matrice de test :</span><span class="sxs-lookup"><span data-stu-id="6b819-296">Test matrix:</span></span>

| <span data-ttu-id="6b819-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="6b819-297">**DRM**</span></span> | <span data-ttu-id="6b819-298">**Browser**</span><span class="sxs-lookup"><span data-stu-id="6b819-298">**Browser**</span></span> | <span data-ttu-id="6b819-299">**Résultat pour les utilisateurs autorisés**</span><span class="sxs-lookup"><span data-stu-id="6b819-299">**Result for Entitled User**</span></span> | <span data-ttu-id="6b819-300">**Résultat pour les utilisateurs non autorisés**</span><span class="sxs-lookup"><span data-stu-id="6b819-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="6b819-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="6b819-301">**PlayReady**</span></span> |<span data-ttu-id="6b819-302">MS Edge ou IE11 sous Windows 10</span><span class="sxs-lookup"><span data-stu-id="6b819-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="6b819-303">Réussite</span><span class="sxs-lookup"><span data-stu-id="6b819-303">Succeed</span></span> |<span data-ttu-id="6b819-304">Échec</span><span class="sxs-lookup"><span data-stu-id="6b819-304">Fail</span></span> |
| <span data-ttu-id="6b819-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="6b819-305">**Widevine**</span></span> |<span data-ttu-id="6b819-306">Chrome sous Windows 10</span><span class="sxs-lookup"><span data-stu-id="6b819-306">Chrome on Windows 10</span></span> |<span data-ttu-id="6b819-307">Réussite</span><span class="sxs-lookup"><span data-stu-id="6b819-307">Succeed</span></span> |<span data-ttu-id="6b819-308">Échec</span><span class="sxs-lookup"><span data-stu-id="6b819-308">Fail</span></span> |
| <span data-ttu-id="6b819-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="6b819-309">**FairPlay**</span></span> |<span data-ttu-id="6b819-310">TBD</span><span class="sxs-lookup"><span data-stu-id="6b819-310">TBD</span></span> | | |

<span data-ttu-id="6b819-311">George Trifonov, de l’équipe Azure Media Services, a écrit un blog fournissant la procédure détaillée de la configuration d’Azure Active Directory pour une application de lecteur MVC ASP.NET : [intégrer l’application Azure Media Services OWIN basée sur MVC avec Azure Active Directory et restreindre la distribution de clé de contenu en se fondant sur les revendications JWT](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="6b819-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="6b819-312">George a également écrit un blog concernant la page [Authentification des jetons JWT dans Azure Media Services et chiffrement dynamique](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="6b819-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="6b819-313">Et voici son [exemple sur l’intégration d’Azure AD avec remise de clé Azure Media Services](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="6b819-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="6b819-314">Pour plus d’informations, sur Azure Active Directory :</span><span class="sxs-lookup"><span data-stu-id="6b819-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="6b819-315">Vous pouvez trouver des informations pour les développeurs dans [Guide du développeur Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="6b819-316">Vous pouvez trouver des informations sur l’administrateur dans [Administrer votre annuaire Azure AD](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="6b819-317">Des problèmes de mise en œuvre</span><span class="sxs-lookup"><span data-stu-id="6b819-317">Some gotchas in implementation</span></span>
<span data-ttu-id="6b819-318">La mise en œuvre peut présenter certains « pièges ».</span><span class="sxs-lookup"><span data-stu-id="6b819-318">There are some “gotchas” in the implementation.</span></span> <span data-ttu-id="6b819-319">Nous espérons que la liste des « pièges » qui suit vous aidera à résoudre d’éventuels problèmes.</span><span class="sxs-lookup"><span data-stu-id="6b819-319">Hopefully the following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="6b819-320">**Issuer** : l’URL doit se terminer par **« / »**.</span><span class="sxs-lookup"><span data-stu-id="6b819-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="6b819-321">**Audience** : doit correspondre à l’ID client de l’application de lecteur. Vous devez également ajouter **« / »** à la fin de l’URL de l’émetteur.</span><span class="sxs-lookup"><span data-stu-id="6b819-321">**Audience** should be the player application client ID and you should also add **"/"** at the end of the issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="6b819-322">Dans le [décodeur JWT](http://jwt.calebb.net/), **aud** et **iss** doivent apparaître comme suit dans le jeton JWT :</span><span class="sxs-lookup"><span data-stu-id="6b819-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in the JWT token:</span></span>

    ![1er piège](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="6b819-324">Ajouter des autorisations à l’application dans AAD (sur l’onglet de configuration de l’application).</span><span class="sxs-lookup"><span data-stu-id="6b819-324">Add Permissions to the application in AAD (on Configure tab of the application).</span></span> <span data-ttu-id="6b819-325">Cette opération est obligatoire pour chaque application (versions locales et déployées).</span><span class="sxs-lookup"><span data-stu-id="6b819-325">This is required for each application (local and deployed versions).</span></span>

    ![2e piège](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="6b819-327">Utilisez le bon émetteur pour établir une protection CENC dynamique :</span><span class="sxs-lookup"><span data-stu-id="6b819-327">Use the right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="6b819-328">Ce qui suit ne fonctionnera pas :</span><span class="sxs-lookup"><span data-stu-id="6b819-328">The following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="6b819-329">Le GUID est l’ID du client AAD.</span><span class="sxs-lookup"><span data-stu-id="6b819-329">The GUID is the AAD tenant ID.</span></span> <span data-ttu-id="6b819-330">Il se trouve dans le menu contextuel des points de terminaison dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="6b819-330">The GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="6b819-331">Octroi des autorisations de revendications de membre de groupe.</span><span class="sxs-lookup"><span data-stu-id="6b819-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="6b819-332">Assurez-vous que vous avez bien ce qui suit dans le fichier de manifeste de l’application AAD</span><span class="sxs-lookup"><span data-stu-id="6b819-332">Make sure in AAD application manifest file, we have the following</span></span>

    <span data-ttu-id="6b819-333">« groupMembershipClaims » : « All » (la valeur par défaut est Null.)</span><span class="sxs-lookup"><span data-stu-id="6b819-333">"groupMembershipClaims": "All",    (the default value is null)</span></span>
5. <span data-ttu-id="6b819-334">Définition d’un TokenType approprié lors de la création de conditions de restriction.</span><span class="sxs-lookup"><span data-stu-id="6b819-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="6b819-335">Depuis l’ajout de la prise en charge de JWT (AAD) en plus des SWT (ACS), la valeur par défaut de TokenType est TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="6b819-335">Since adding support of JWT (AAD) in addition to SWT (ACS), the default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="6b819-336">Si vous utilisez SWT/ACS, vous devez la définir à TokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="6b819-336">If you use SWT/ACS, you must set to TokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="6b819-337">Rubriques supplémentaires pour l’implémentation</span><span class="sxs-lookup"><span data-stu-id="6b819-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="6b819-338">Ensuite, nous aborderons certaines rubriques supplémentaires de notre conception et de l’implémentation.</span><span class="sxs-lookup"><span data-stu-id="6b819-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="6b819-339">HTTP ou HTTPS ?</span><span class="sxs-lookup"><span data-stu-id="6b819-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="6b819-340">L’application de lecteur MVC ASP.NET que nous avons créée doit prendre en charge les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="6b819-340">The ASP.NET MVC player application we built must support the following:</span></span>

1. <span data-ttu-id="6b819-341">authentification des utilisateurs via Azure AD qui doit être sous HTTPS ;</span><span class="sxs-lookup"><span data-stu-id="6b819-341">User authentication through Azure AD which needs to be under HTTPS;</span></span>
2. <span data-ttu-id="6b819-342">échange de jeton JWT entre le client et Azure AD qui doit être sous HTTPS ;</span><span class="sxs-lookup"><span data-stu-id="6b819-342">JWT token exchange between client and Azure AD which needs to be under HTTPS;</span></span>
3. <span data-ttu-id="6b819-343">Acquisition de licence DRM par le client qui doit être sous HTTPS si la distribution de licences est fournie par Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="6b819-343">DRM license acquisition by the client which is required to be under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="6b819-344">Bien entendu, la suite de produits PlayReady n'impose pas le format HTTPS pour la distribution de licences.</span><span class="sxs-lookup"><span data-stu-id="6b819-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="6b819-345">Si votre serveur de licences PlayReady se trouve en dehors d'Azure Media Services, vous pouvez utiliser HTTP ou HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="6b819-346">C’est pour cette raison que l’application de lecteur d’ASP.NET utilise HTTPS comme une meilleure pratique.</span><span class="sxs-lookup"><span data-stu-id="6b819-346">Therefore, the ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="6b819-347">Cela signifie que le lecteur Azure Media se trouvera sur une page HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-347">This means the Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="6b819-348">Toutefois, pour la diffusion nous préférons HTTP, par conséquent, nous devons tenir compte des problèmes liés au contenu mixte.</span><span class="sxs-lookup"><span data-stu-id="6b819-348">However, for streaming we prefer HTTP, hence we need to consider mixed content issue.</span></span>

1. <span data-ttu-id="6b819-349">Le navigateur ne permet pas un contenu mixte.</span><span class="sxs-lookup"><span data-stu-id="6b819-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="6b819-350">Cependant, les plug-ins tels que Silverlight et OSMF pour Smooth et DASH le permettent.</span><span class="sxs-lookup"><span data-stu-id="6b819-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="6b819-351">Le contenu mixte est un problème de sécurité, en raison de la menace que constitue la possibilité d’injecter un logiciel JS malveillant, et risque de mettre en danger les données clientes.</span><span class="sxs-lookup"><span data-stu-id="6b819-351">Mixed content is a security concern - This is due to the threat of the ability to inject malicious JS which can cause the customer data to be at risk.</span></span>  <span data-ttu-id="6b819-352">Les navigateurs bloquent ces dernières par défaut et jusqu’à présent, le seul moyen de contourner ce problème est côté serveur (origine), et autoriser tous les domaines (quel que soit le protocole https ou http).</span><span class="sxs-lookup"><span data-stu-id="6b819-352">Browsers block this by default and so far the only way to work around it is on the server (origin) side, to allow all domains (regardless https or http).</span></span> <span data-ttu-id="6b819-353">Il ne s’agit probablement pas d’une idée judicieuse.</span><span class="sxs-lookup"><span data-stu-id="6b819-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="6b819-354">Il est préférable d’éviter les contenus mixtes : les deux doivent utiliser soit HTTP, soit utiliser HTTPS </span><span class="sxs-lookup"><span data-stu-id="6b819-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="6b819-355">Si du contenu mixte est lu, silverlightSS tech nécessite la suppression d’un avertissement de contenu mixte.</span><span class="sxs-lookup"><span data-stu-id="6b819-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="6b819-356">flashSS tech traite le contenu mixte sans aucun avertissement.</span><span class="sxs-lookup"><span data-stu-id="6b819-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="6b819-357">Si votre point de terminaison de diffusion a été créé avant août 2014, il ne prend pas en charge HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="6b819-358">Dans ce cas, créez et utilisez un nouveau point de terminaison pour le protocole HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="6b819-359">Dans l’implémentation de référence, dans le cas de contenu protégé DRM application et la diffusion en continu sont toutes les deux sous HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-359">In the reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="6b819-360">Pour les contenus ouverts, le lecteur n’a pas besoin d’authentification ou de licence. Vous pouvez au choix utiliser soit HTTP, soit HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6b819-360">For open contents, the player does not need authentication or license, so you have the liberty to use either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="6b819-361">Substitution de la clé de signature Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="6b819-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="6b819-362">Il s’agit d’un point important de votre implémentation à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="6b819-362">This is an important point to take into consideration of your implementation.</span></span> <span data-ttu-id="6b819-363">Si vous ne prenez pas cet élément pour l’implémentation, le système terminé risque de cesser de fonctionner complètement au bout de 6 semaines au maximum.</span><span class="sxs-lookup"><span data-stu-id="6b819-363">If you do not consider this in your implementation, the completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="6b819-364">Azure AD utilise une norme standard pour établir une relation de confiance entre lui-même et les applications à l’aide d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-364">Azure AD uses industry standard to establish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="6b819-365">Azure AD utilise plus particulièrement une clé de signature se composant d’une paire clé publique-clé privée.</span><span class="sxs-lookup"><span data-stu-id="6b819-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="6b819-366">Lorsqu’Azure AD crée un jeton de sécurité contenant des informations sur l’utilisateur, ce jeton est signé par Azure AD à l’aide de sa clé privée avant d’être renvoyé à l’application.</span><span class="sxs-lookup"><span data-stu-id="6b819-366">When Azure AD creates a security token that contains information about the user, this token is signed by Azure AD using its private key before it is sent back to the application.</span></span> <span data-ttu-id="6b819-367">Pour vérifier que le jeton est valide et provient bien d’Azure AD, l’application doit valider la signature du jeton à l’aide de la clé publique exposée par Azure AD contenue dans le document de métadonnées de fédération du client.</span><span class="sxs-lookup"><span data-stu-id="6b819-367">To verify that the token is valid and actually originated from Azure AD, the application must validate the token’s signature using the public key exposed by Azure AD that is contained in the tenant’s federation metadata document.</span></span> <span data-ttu-id="6b819-368">Cette clé publique (et la clé de signature d’où elle dérive) est la même que celle qui est utilisée pour tous les clients dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-368">This public key – and the signing key from which it derives – is the same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="6b819-369">Vous trouverez des informations détaillées sur la substitution de la clé Azure AD dans le document intitulé [Informations importantes sur la substitution des clés de signature dans Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-369">Detailed info on Azure AD key rollover can be found in the document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="6b819-370">Dans la [paire de clés publique-privée](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="6b819-370">Between the [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="6b819-371">la clé privée est utilisée par Azure Active Directory pour créer un jeton JWT ;</span><span class="sxs-lookup"><span data-stu-id="6b819-371">The private key is used by Azure Active Directory to generate a JWT token;</span></span>
* <span data-ttu-id="6b819-372">la clé publique est utilisée par une application telle que le service de distribution de licences DRM dans AMS pour vérifier le jeton JWT ;</span><span class="sxs-lookup"><span data-stu-id="6b819-372">The public key is used by an application such as DRM License Delivery Services in AMS to verify the JWT token;</span></span>

<span data-ttu-id="6b819-373">à des fins de sécurité, Azure Active Directory renouvelle ce certificat périodiquement (toutes les 6 semaines).</span><span class="sxs-lookup"><span data-stu-id="6b819-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="6b819-374">La substitution de clé peut survenir à tout moment en cas de violation de la sécurité.</span><span class="sxs-lookup"><span data-stu-id="6b819-374">In case of security breaches, the key rollover can occur any time.</span></span> <span data-ttu-id="6b819-375">Par conséquent, les services de distribution de licence dans AMS doivent mettre à jour la clé publique utilisée lorsqu’Azure AD renouvelle la paire de clés. S’il ne le fait pas, l’authentification des jetons dans AMS échouera et aucune licence ne sera émise.</span><span class="sxs-lookup"><span data-stu-id="6b819-375">Therefore, the license delivery services in AMS need to update the public key used as Azure AD rotates the key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="6b819-376">Pour ce faire, il faut définir TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument au moment de configurer les services de distribution de licence DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="6b819-377">Le flux de jeton JWT se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="6b819-377">The JWT token flow is as below:</span></span>

1. <span data-ttu-id="6b819-378">Azure AD émet le jeton JWT avec la clé privée en cours pour un utilisateur authentifié ;</span><span class="sxs-lookup"><span data-stu-id="6b819-378">Azure AD will issue the JWT token with the current private key for an authenticated user;</span></span>
2. <span data-ttu-id="6b819-379">Lorsqu’un joueur voit un CENC avec un contenu protégé par multi-DRM, il commence par localiser le jeton JWT émis par Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-379">When a player sees a CENC with multi-DRM protected content, it will first locate the JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="6b819-380">Le lecteur envoie la demande d’acquisition de licence avec le jeton JWT pour émettre des licences de services de distribution dans AMS ;</span><span class="sxs-lookup"><span data-stu-id="6b819-380">The player sends license acquisition request with the JWT token to license delivery services in AMS;</span></span>
4. <span data-ttu-id="6b819-381">les services de distribution de licence dans AMS utiliseront la clé publique de licence actuelle/valide depuis Azure AD pour vérifier le jeton JWT, avant d’émettre des licences.</span><span class="sxs-lookup"><span data-stu-id="6b819-381">The license delivery services in AMS will use the current/valid public key from Azure AD to verify the JWT token, before issuing licenses.</span></span>

<span data-ttu-id="6b819-382">Les services de distribution de licence DRM vérifieront systématiquement la clé publique actuelle/valide dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-382">DRM license delivery services will always be checking for the current/valid public key from Azure AD.</span></span> <span data-ttu-id="6b819-383">La clé publique présentée par Azure AD sera la clé utilisée pour vérifier un jeton JWT émis par Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-383">The public key presented by Azure AD will be the key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="6b819-384">Que se passe-t-il si la substitution de la clé a lieu après qu’AAD ait généré un jeton JWT, mais avant que le jeton JSON soit envoyé par les lecteurs aux services de distribution de licence DRM dans AMS pour vérification ?</span><span class="sxs-lookup"><span data-stu-id="6b819-384">What if the key rollover happens after AAD generates a JWT token but before the JWT token is sent by players to DRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="6b819-385">Une clé pouvant être substituée à tout moment, il y a toujours plusieurs clés publiques valides disponibles dans le document de métadonnées de la fédération.</span><span class="sxs-lookup"><span data-stu-id="6b819-385">Because a key may be rolled at any moment, there is always more than one valid public key available in the federation metadata document.</span></span> <span data-ttu-id="6b819-386">La distribution de licence Azure Media Services peut utiliser une des clés spécifiées dans le document, car une clé peut être substituée rapidement et une autre prise en remplacement, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="6b819-386">Azure Media Services license delivery can use any of the keys specified in the document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-the-access-token"></a><span data-ttu-id="6b819-387">Où se trouve le jeton d’accès ?</span><span class="sxs-lookup"><span data-stu-id="6b819-387">Where is the Access Token?</span></span>
<span data-ttu-id="6b819-388">Si vous regardez comment une application web appelle une application API sous [Identité d’application avec octroi d’informations d’identification client OAuth 2.0](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), le flux d’authentification est comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="6b819-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), the authentication flow is as below:</span></span>

1. <span data-ttu-id="6b819-389">Un utilisateur est connecté à Azure AD dans l’application web (voir la section [Navigateur web vers application web](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application)ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="6b819-389">A user is signed in to Azure AD in the web application (see the [Web Browser to Web Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="6b819-390">Le point de terminaison d’autorisation Azure AD redirige l’agent utilisateur vers l’application cliente avec un code d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="6b819-390">The Azure AD authorization endpoint redirects the user agent back to the client application with an authorization code.</span></span> <span data-ttu-id="6b819-391">L’agent utilisateur renvoie le code d’autorisation à l’URI de l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="6b819-391">The user agent returns authorization code to the client application’s redirect URI.</span></span>
3. <span data-ttu-id="6b819-392">L’application web doit obtenir un jeton d’accès pour pouvoir s’authentifier auprès de l’API web et extraire la ressource souhaitée.</span><span class="sxs-lookup"><span data-stu-id="6b819-392">The web application needs to acquire an access token so that it can authenticate to the web API and retrieve the desired resource.</span></span> <span data-ttu-id="6b819-393">Elle envoie une demande au point de terminaison de jeton d’Azure AD, avec les informations d’identification, l’ID client et  l’URI ID d’application de l’API web.</span><span class="sxs-lookup"><span data-stu-id="6b819-393">It makes a request to Azure AD’s token endpoint, providing the credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="6b819-394">Il présente le code d’autorisation permettra de prouver que l’utilisateur a donné son consentement.</span><span class="sxs-lookup"><span data-stu-id="6b819-394">It presents the authorization code to prove that the user has consented.</span></span>
4. <span data-ttu-id="6b819-395">Azure AD authentifie l’application et renvoie un jeton d’accès JWT, qui est utilisé pour appeler l’API web.</span><span class="sxs-lookup"><span data-stu-id="6b819-395">Azure AD authenticates the application and returns a JWT access token that is used to call the web API.</span></span>
5. <span data-ttu-id="6b819-396">Sur HTTPS, l’application web utilise le jeton d’accès JWT renvoyé pour ajouter la chaîne JWT avec la mention « porteur » dans l’en-tête d’autorisation de la demande adressée à l’API web.</span><span class="sxs-lookup"><span data-stu-id="6b819-396">Over HTTPS, the web application uses the returned JWT access token to add the JWT string with a “Bearer” designation in the Authorization header of the request to the web API.</span></span> <span data-ttu-id="6b819-397">L’API web valide ensuite le jeton JWT et, si la validation réussit, renvoie la ressource souhaitée.</span><span class="sxs-lookup"><span data-stu-id="6b819-397">The web API then validates the JWT token, and if validation is successful, returns the desired resource.</span></span>

<span data-ttu-id="6b819-398">Dans ce flux « Identité de l’application », l’API web suppose que l’application web a authentifié l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="6b819-398">In this “application identity” flow, the web API trusts that the web application authenticated the user.</span></span> <span data-ttu-id="6b819-399">C’est pour cette raison que ce modèle est appelé « sous-système approuvé ».</span><span class="sxs-lookup"><span data-stu-id="6b819-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="6b819-400">Le [diagramme sur cette page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) explique comment le flux relatif au code d’autorisation fonctionne.</span><span class="sxs-lookup"><span data-stu-id="6b819-400">The [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="6b819-401">Dans l’acquisition de licence avec restriction de jeton, nous suivons le même modèle de sous-système approuvé.</span><span class="sxs-lookup"><span data-stu-id="6b819-401">In license acquisition with token restriction, we are following the same trusted subsystem pattern.</span></span> <span data-ttu-id="6b819-402">Et le service de distribution de licences dans Azure Media Services est une ressource API web, la « Ressource backend » a besoin d’un accès.</span><span class="sxs-lookup"><span data-stu-id="6b819-402">And the license delivery service in Azure Media Services is the web API resource, the “backend resource” a web application needs to access.</span></span> <span data-ttu-id="6b819-403">Où se trouve le jeton d’accès ?</span><span class="sxs-lookup"><span data-stu-id="6b819-403">So where is the access token?</span></span>

<span data-ttu-id="6b819-404">Nous devons obtenir un jeton d’accès de la part d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="6b819-405">Une fois l’authentification utilisateur réussie, le code d’autorisation est renvoyé.</span><span class="sxs-lookup"><span data-stu-id="6b819-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="6b819-406">Il est ensuite utilisé avec l’ID client et la clé d’application pour l’échange d’un jeton d’accès.</span><span class="sxs-lookup"><span data-stu-id="6b819-406">The authorization code is then used, together with client ID and app key, to exchange for access token.</span></span> <span data-ttu-id="6b819-407">Le jeton d’accès sert à accéder à une application de « pointeur » qui pointe sur les services de distribution de licence Azure Media Services ou les représente.</span><span class="sxs-lookup"><span data-stu-id="6b819-407">And the access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="6b819-408">Nous devons inscrire et configurer l’application de « pointeur » dans Azure AD en suivant les étapes ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="6b819-408">We need to register and configure the “pointer” app in Azure AD by following the steps below:</span></span>

1. <span data-ttu-id="6b819-409">Dans le client Azure AD</span><span class="sxs-lookup"><span data-stu-id="6b819-409">In the Azure AD tenant</span></span>

   * <span data-ttu-id="6b819-410">ajouter une application (ressource) avec l’URL de connexion :</span><span class="sxs-lookup"><span data-stu-id="6b819-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="6b819-411">https://[nom_ressource].azurewebsites.net/ et</span><span class="sxs-lookup"><span data-stu-id="6b819-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="6b819-412">URL d’ID d’application :</span><span class="sxs-lookup"><span data-stu-id="6b819-412">app ID URL:</span></span>

   <span data-ttu-id="6b819-413">https://[nom_client_aad].onmicrosoft.com/[nom_ressource]</span><span class="sxs-lookup"><span data-stu-id="6b819-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="6b819-414">Ajoutez une clé à l’application de ressource ;</span><span class="sxs-lookup"><span data-stu-id="6b819-414">Add a new key for the resource app;</span></span>
3. <span data-ttu-id="6b819-415">Mettez à jour le fichier manifeste d’application afin que la propriété groupMembershipClaims se voie attribuer la valeur suivante : groupMembershipClaims » : « All »</span><span class="sxs-lookup"><span data-stu-id="6b819-415">Update the app manifest file so that the groupMembershipClaims property has the following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="6b819-416">Dans l’application Azure AD qui pointe vers l’application web de lecteur, dans la section « autorisations pour d’autres applications », ajoutez l’application de ressource ajoutée à l’étape 1 ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="6b819-416">In the Azure AD app pointing to the player web app, in the section “permissions to other applications”, add the resource app which was added in step 1 above.</span></span> <span data-ttu-id="6b819-417">Sous « autorisations déléguées », cliquez sur la coche « Accès [nom_ressource] ».</span><span class="sxs-lookup"><span data-stu-id="6b819-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="6b819-418">Cette opération donne à l’application web l’autorisation de créer des jetons d’accès pour accéder l’application de ressource.</span><span class="sxs-lookup"><span data-stu-id="6b819-418">This gives the web app permission to create access tokens for accessing the resource app.</span></span> <span data-ttu-id="6b819-419">Vous devez procéder ainsi à la fois pour la version locale et la version déployée de l’application web si vous procédez à un développement avec une application web Visual Studio et Azure.</span><span class="sxs-lookup"><span data-stu-id="6b819-419">You should do this for both local and deployed version of the web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="6b819-420">Le jeton JWT émis par Azure AD est donc le jeton d’accès servant à accéder à cette ressource de type « pointeur ».</span><span class="sxs-lookup"><span data-stu-id="6b819-420">Therefore, the JWT token issued by Azure AD is indeed the access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="6b819-421">Qu’en est-il de la diffusion en continu ?</span><span class="sxs-lookup"><span data-stu-id="6b819-421">What about Live Streaming?</span></span>
<span data-ttu-id="6b819-422">Dans l’exemple ci-dessus, notre propos était axé sur les éléments multimédias à la demande.</span><span class="sxs-lookup"><span data-stu-id="6b819-422">In the above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="6b819-423">Qu’en est-il de la diffusion en continu ?</span><span class="sxs-lookup"><span data-stu-id="6b819-423">What about live streaming?</span></span>

<span data-ttu-id="6b819-424">La bonne nouvelle est que vous pouvez utiliser exactement les mêmes présentation et implémentation de la protection de la diffusion en continu dans Azure Media Services, en traitant la ressource associée à un programme de type « élément multimédia VOD ».</span><span class="sxs-lookup"><span data-stu-id="6b819-424">The good news is that you can use exactly the same design and implementation for protecting live streaming in Azure Media Services, by treating the asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="6b819-425">Il est bien connu que pour diffuser en continu dans les Azure Media Services, vous devez créer un canal, puis un programme sous ce canal.</span><span class="sxs-lookup"><span data-stu-id="6b819-425">Specifically, it is well known that to do live streaming in Azure Media Services, you need to create a channel, then a program under the channel.</span></span> <span data-ttu-id="6b819-426">Pour créer le programme, vous devez créer un élément multimédia contenant le fichier en direct pour le programme.</span><span class="sxs-lookup"><span data-stu-id="6b819-426">To create the program, you need to create an asset which will contain the live archive for the program.</span></span> <span data-ttu-id="6b819-427">Pour pouvoir assurer la protection multi-DRM CENC, tout ce que vous avez à faire est d’appliquer le même programme d’installation/de traitement à l’élément multimédia, comme s’il s’agissait d’une « ressource VOD » avant de démarrer le programme.</span><span class="sxs-lookup"><span data-stu-id="6b819-427">In order to provide CENC with multi-DRM protection of the live content, all you need to do, is to apply the same setup/processing to the asset as if it was a “VOD asset” before you start the program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="6b819-428">Qu’en est-il des serveurs de licences hors Azure Media Services ?</span><span class="sxs-lookup"><span data-stu-id="6b819-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="6b819-429">Souvent, les clients investissent dans une batterie de serveurs qu’ils hébergent dans leur propre centre de données ou chez des fournisseurs de service DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="6b819-430">Heureusement, la protection de contenu Azure Media Services vous permet de fonctionner en mode hybride : le contenu est hébergé et dynamiquement protégé dans Azure Media Services, tandis que des licences DRM sont fournies par des serveurs en dehors d’Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="6b819-430">Fortunately, Azure Media Services Content Protection allows you to operate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="6b819-431">Dans ce cas, il faut envisager les modifications suivantes :</span><span class="sxs-lookup"><span data-stu-id="6b819-431">In this case, there are the following considerations of changes:</span></span>

1. <span data-ttu-id="6b819-432">Le service STS (Service d’émission de jeton de sécurité - Secure Token Service) doit émettre des jetons acceptables et pouvant être vérifiés par la batterie de serveurs de licence.</span><span class="sxs-lookup"><span data-stu-id="6b819-432">The Secure Token Service needs to issue tokens which are acceptable and can be verified by the license server farm.</span></span> <span data-ttu-id="6b819-433">Par exemple, les serveurs de licences Widevine fournis par Axinom exigent un jeton JWT spécifique contenant le message « message d’octroi de droit ».</span><span class="sxs-lookup"><span data-stu-id="6b819-433">For example, the Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="6b819-434">Par conséquent, vous devez disposer d’un STS pour émettre ce jeton JWT.</span><span class="sxs-lookup"><span data-stu-id="6b819-434">Therefore, you need to have an STS to issue such JWT token.</span></span> <span data-ttu-id="6b819-435">Les auteurs ont effectué cette implémentation. Vous pouvez trouver les détails dans le document suivant dans le [Centre de documentation Azure](https://azure.microsoft.com/documentation/) : [Utilisation d’Axinom pour fournir des licences Widevine à Azure Media Services](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="6b819-435">The authors have completed such an implementation and you can find the details in the following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom to deliver Widevine licenses to Azure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="6b819-436">Vous n’avez plus besoin de configurer le service de distribution de licence (ContentKeyAuthorizationPolicy) dans Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="6b819-436">You no longer need to configure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="6b819-437">Vous devez alors fournir les URL d’acquisition de la licence (pour PlayReady, Widevine et FairPlay) au moment où vous configurez AssetDeliveryPolicy dans Configuration CENC avec multi-DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-437">What you need to do is to provide the license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-to-use-a-custom-sts"></a><span data-ttu-id="6b819-438">Que se passe-t-il si je souhaite utiliser un STS personnalisé ?</span><span class="sxs-lookup"><span data-stu-id="6b819-438">What if I want to use a custom STS?</span></span>
<span data-ttu-id="6b819-439">Il existe plusieurs raisons pour qu’un client choisisse d’utiliser un STS personnalisé (Service d’émission de jeton de sécurité - Secure Token Service) pour fournir des jetons JWT,</span><span class="sxs-lookup"><span data-stu-id="6b819-439">There could be a few reasons that a customer may choose to use a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="6b819-440">parmi lesquelles :</span><span class="sxs-lookup"><span data-stu-id="6b819-440">Some of them are:</span></span>

1. <span data-ttu-id="6b819-441">Le fournisseur d’identité (IDP) utilisé par le client ne prend pas en charge STS.</span><span class="sxs-lookup"><span data-stu-id="6b819-441">The Identity Provider (IDP) used by the customer does not support STS.</span></span> <span data-ttu-id="6b819-442">Dans ce cas, un service STS pourrait être une option.</span><span class="sxs-lookup"><span data-stu-id="6b819-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="6b819-443">Le client peut avoir besoin d’un contrôle plus souple ou plus étroit pour l’intégration de STS avec le système de facturation client.</span><span class="sxs-lookup"><span data-stu-id="6b819-443">The customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="6b819-444">Par exemple, un opérateur MVPD peut proposer plusieurs packages d’abonné OTT, par exemple Premium, de base, sports, etc. L’opérateur peut appliquer les revendications d’un jeton avec le package d’un abonné afin que seul le contenu du package adéquat soit mis à disposition.</span><span class="sxs-lookup"><span data-stu-id="6b819-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. The operator may want to match the claims in a token with a subscriber’s package so that only contents in the right package is made available.</span></span> <span data-ttu-id="6b819-445">Dans ce cas, un STS personnalisé offre la souplesse et la maîtrise nécessaires.</span><span class="sxs-lookup"><span data-stu-id="6b819-445">In this case, a custom STS provides the needed flexibility and control.</span></span>

<span data-ttu-id="6b819-446">Deux modifications doivent être apportées lors de l’utilisation d’un STS personnalisé :</span><span class="sxs-lookup"><span data-stu-id="6b819-446">Two changes need to be made when using a custom STS:</span></span>

1. <span data-ttu-id="6b819-447">Lorsque vous configurez le service de distribution de licence pour un élément multimédia, vous devez spécifier la clé de sécurité utilisée par le STS personnalisé pour la vérification (plus de détails ci-dessous) et non la clé actuelle d’Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6b819-447">When configuring license delivery service for an asset, you need to specify the security key used for verification by the custom STS (more details below) instead of the current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="6b819-448">Une fois le jeton JTW généré, une clé de sécurité est spécifiée à la place de la clé privée du certificat X509 courant dans Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="6b819-448">When a JTW token is generated, a security key is specified instead of the private key of the current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="6b819-449">Il existe deux types de clés de sécurité :</span><span class="sxs-lookup"><span data-stu-id="6b819-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="6b819-450">Clé symétrique : la même clé est utilisée pour générer et vérifier un jeton JWT ;</span><span class="sxs-lookup"><span data-stu-id="6b819-450">Symmetric key: the same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="6b819-451">Clé asymétrique : une paire de clés publique-privée dans un certificat X 509 est utilisée avec une clé privée pour chiffrer/générer un jeton JWT et la clé publique pour vérifier le jeton.</span><span class="sxs-lookup"><span data-stu-id="6b819-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and the public key for verifying the token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="6b819-452">Note technique</span><span class="sxs-lookup"><span data-stu-id="6b819-452">Tech note</span></span>
<span data-ttu-id="6b819-453">Si vous utilisez .NET Framework / C# en tant que plate-forme de développement, le certificat X509 utilisé pour la clé de sécurité asymétrique doit avoir une clé d’une longueur d’au moins 2048 bits.</span><span class="sxs-lookup"><span data-stu-id="6b819-453">If you use .NET Framework/C# as your development platform, the X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="6b819-454">Il s’agit d’une exigence de la classe System.IdentityModel.Tokens.X509AsymmetricSecurityKey dans .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="6b819-454">This is a requirement of the class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="6b819-455">Dans le cas contraire, l’exception suivante est générée :</span><span class="sxs-lookup"><span data-stu-id="6b819-455">Otherwise, the following exception will be thrown:</span></span>

<span data-ttu-id="6b819-456">IDX10630 : la longueur de la signature « System.IdentityModel.Tokens.X509AsymmetricSecurityKey » ne peut pas être inférieure à « 2048 » bits.</span><span class="sxs-lookup"><span data-stu-id="6b819-456">IDX10630: The 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="the-completed-system-and-test"></a><span data-ttu-id="6b819-457">Le système et le test terminé</span><span class="sxs-lookup"><span data-stu-id="6b819-457">The completed system and test</span></span>
<span data-ttu-id="6b819-458">Nous allons examiner quelques scénarios dans le système achevé de bout en bout afin que les lecteurs puissent avoir une « image » générale du comportement avant d’obtenir un compte de connexion.</span><span class="sxs-lookup"><span data-stu-id="6b819-458">We will walk through a few scenarios in the completed end-to-end system so that readers can have a basic “picture” of the behavior before getting a login account.</span></span>

<span data-ttu-id="6b819-459">Vous trouverez l’application web de lecteur et ses informations de connexion [ici](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="6b819-459">The player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="6b819-460">Si vous avez besoin d’un scénario « non intégré », de ressources vidéo hébergées dans Azure Media Services non protégées ou protégées par DRM, mais sans authentification des jetons (avec émission d’une licence pour toute personne qui la demande), vous pouvez mener les tests hors connexion (en activant le HTTP si votre vidéo en temps réel fonctionne sous HTTP).</span><span class="sxs-lookup"><span data-stu-id="6b819-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license to whoever requesting it), you can test it without login (by switching to HTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="6b819-461">Si vous avez besoin d’un scénario intégré de bout en bout : les ressources vidéo sont sous protection DRM dynamique dans Azure Media Services, avec authentification du jeton généré par Azure AD, vous devez vous connecter.</span><span class="sxs-lookup"><span data-stu-id="6b819-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need to login.</span></span>

### <a name="user-login"></a><span data-ttu-id="6b819-462">Connexion utilisateur</span><span class="sxs-lookup"><span data-stu-id="6b819-462">User login</span></span>
<span data-ttu-id="6b819-463">Pour tester le système DRM intégré de bout en bout, vous devez disposer d’un « compte » créé ou ajouté.</span><span class="sxs-lookup"><span data-stu-id="6b819-463">In order to test the end-to-end integrated DRM system, you need to have an “account” created or added.</span></span>

<span data-ttu-id="6b819-464">Quel compte ?</span><span class="sxs-lookup"><span data-stu-id="6b819-464">What account?</span></span>

<span data-ttu-id="6b819-465">Même si Azure avait initialement autorisé l’accès aux utilisateurs de compte Microsoft uniquement, il autorise désormais l’accès aux utilisateurs des deux systèmes.</span><span class="sxs-lookup"><span data-stu-id="6b819-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="6b819-466">Ceci a été possible via l’approbation des propriétés Azure pour l’authentification Azure AD, l’authentification Azure AD des utilisateurs professionnels et la création d’une relation de fédération dans laquelle Azure AD approuve le système d’identité Microsoft de compte consommateur pour authentifier les utilisateurs consommateurs.</span><span class="sxs-lookup"><span data-stu-id="6b819-466">This was done by having all the Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts the Microsoft account consumer identity system to authenticate consumer users.</span></span> <span data-ttu-id="6b819-467">Par conséquent, Azure AD est en mesure d'authentifier les comptes « invités » de Microsoft, ainsi que les comptes Azure AD « natifs ».</span><span class="sxs-lookup"><span data-stu-id="6b819-467">As a result, Azure AD is able to authenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="6b819-468">Dans la mesure où Azure AD approuve le domaine de compte Microsoft (MSA), vous pouvez ajouter tous les comptes dans les domaines clients suivants d’Azure AD et utilisent le compte de connexion :</span><span class="sxs-lookup"><span data-stu-id="6b819-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of the following domains to the custom Azure AD tenant and use the account to login:</span></span>

| <span data-ttu-id="6b819-469">**Nom de domaine**</span><span class="sxs-lookup"><span data-stu-id="6b819-469">**Domain Name**</span></span> | <span data-ttu-id="6b819-470">**Domaine**</span><span class="sxs-lookup"><span data-stu-id="6b819-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="6b819-471">**Domaine client Azure AD personnalisé**</span><span class="sxs-lookup"><span data-stu-id="6b819-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="6b819-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="6b819-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="6b819-473">**Domaine d’entreprise**</span><span class="sxs-lookup"><span data-stu-id="6b819-473">**Corporate domain**</span></span> |<span data-ttu-id="6b819-474">microsoft.com</span><span class="sxs-lookup"><span data-stu-id="6b819-474">microsoft.com</span></span> |
| <span data-ttu-id="6b819-475">**Domaine de compte Microsoft (MSA)**</span><span class="sxs-lookup"><span data-stu-id="6b819-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="6b819-476">outlook.com, live.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="6b819-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="6b819-477">Vous pouvez contacter l’un des auteurs pour qu’un compte soit créé ou ajouté pour vous.</span><span class="sxs-lookup"><span data-stu-id="6b819-477">You may contact any of the authors to have an account created or added for you.</span></span>

<span data-ttu-id="6b819-478">Vous trouverez ci-dessous les captures d’écran de pages de connexion différentes utilisées par les différents comptes de domaine.</span><span class="sxs-lookup"><span data-stu-id="6b819-478">Below are the screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="6b819-479">Le **compte de domaine client Azure personnalisé** : dans ce cas, vous pouvez voir la page de connexion personnalisée du domaine client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-479">**Custom Azure AD tenant domain account**: In this case, you see the customized login page of the custom Azure AD tenant domain.</span></span>

![compte de domaine client Azure personnalisé](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="6b819-481">**Compte de domaine Microsoft avec carte à puce**: dans ce cas, vous voyez la page de connexion personnalisée par Microsoft corporate IT avec authentification à deux facteurs.</span><span class="sxs-lookup"><span data-stu-id="6b819-481">**Microsoft domain account with smart card**: In this case you see the login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![compte de domaine client Azure personnalisé](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="6b819-483">**Compte Microsoft (MSA)**: dans ce cas, vous allez voir la page de connexion de Microsoft Account pour les consommateurs.</span><span class="sxs-lookup"><span data-stu-id="6b819-483">**Microsoft Account (MSA)**: In this case, you see the login page of Microsoft Account for consumers.</span></span>

![compte de domaine client Azure personnalisé](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="6b819-485">Utilisation de Encrypted Media Extensions pour PlayReady</span><span class="sxs-lookup"><span data-stu-id="6b819-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="6b819-486">Sur un navigateur moderne prenant en charge Encrypted Media Extensions (EME) for PlayReady tel qu’Internet Explorer 11 sous Windows 8.1 et ultérieur, et le navigateur Microsoft Edge sous Windows 10, PlayReady sera la DRM sous-jacente d’EME.</span><span class="sxs-lookup"><span data-stu-id="6b819-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be the underlying DRM for EME.</span></span>

![Utilisation d’EME pour PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="6b819-488">La zone de lecteur foncée est due au fait que la protection PlayReady empêche d’effectuer une capture d’écran de la vidéo protégée.</span><span class="sxs-lookup"><span data-stu-id="6b819-488">The dark player area is due to the fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="6b819-489">L’écran suivant illustre les plug-ins du lecteur et la prise en charge MSE/EME.</span><span class="sxs-lookup"><span data-stu-id="6b819-489">The following screen shows the player plugins and MSE/EME support.</span></span>

![Utilisation d’EME pour PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="6b819-491">EME dans Microsoft Edge et IE 11 sur Windows 10 permet d’appeler [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) sur les appareils Windows 10 compatibles.</span><span class="sxs-lookup"><span data-stu-id="6b819-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="6b819-492">PlayReady SL3000 déverrouille le flux de contenu premium améliorées (4K, HDR, etc.) et les nouveaux modèles de distribution de contenu (première fenêtre de contenu amélioré).</span><span class="sxs-lookup"><span data-stu-id="6b819-492">PlayReady SL3000 unlocks the flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="6b819-493">Concentrez-vous sur les appareils Windows : PlayReady est le seul DRM dans le matériel disponible sur les appareils Windows (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="6b819-493">Focus on the Windows devices: PlayReady is the only DRM in the HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="6b819-494">Un service de diffusion en continu peut utiliser PlayReady via EME ou via une application UWP, et offrir ainsi une meilleure qualité vidéo à l'aide de PlayReady SL3000 par rapport à un autre DRM.</span><span class="sxs-lookup"><span data-stu-id="6b819-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="6b819-495">En règle générale, le contenu 2K transite via Chrome ou Firefox et le contenu 4K via Microsoft Edge/IE11 ou une application UWP sur le même appareil (selon les paramètres de service et l'implémentation).</span><span class="sxs-lookup"><span data-stu-id="6b819-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on the same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="6b819-496">Utilisation d’EME pour Widevine</span><span class="sxs-lookup"><span data-stu-id="6b819-496">Using EME for Widevine</span></span>
<span data-ttu-id="6b819-497">Sur un navigateur moderne doté de la prise en charge d’EME/Widevine, telle que Chrome 41 + sous Windows 10, Windows 8.1, Mac OSX Yosemite et Chrome sur Android 4.4.4, la gestion des droits numériques derrière EME est assurée par Google Widevine.</span><span class="sxs-lookup"><span data-stu-id="6b819-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is the DRM behind EME.</span></span>

![Utilisation d’EME pour Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="6b819-499">Notez que Widevine n’empêche pas d’effectuer une capture d’écran de la vidéo protégée.</span><span class="sxs-lookup"><span data-stu-id="6b819-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Utilisation d’EME pour Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="6b819-501">Utilisateurs sans intitulé</span><span class="sxs-lookup"><span data-stu-id="6b819-501">Not entitled users</span></span>
<span data-ttu-id="6b819-502">Si un utilisateur n’est pas membre du groupe « Utilisateurs autorisés », il n’est pas en mesure de réussir le « contrôle des droits » et le service de licence multi-DRM refusera d’émettre la licence requise comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="6b819-502">If a user is not a member of "Entitled Users" group, the user will not be able to pass “entitlement check” and the multi-DRM license service will refuse to issue the requested license as shown below.</span></span> <span data-ttu-id="6b819-503">La description détaillée est « L’acquisition de licence a échoué », ce qui correspond à la conception.</span><span class="sxs-lookup"><span data-stu-id="6b819-503">The detailed description is “License acquire failed”, which is as designed.</span></span>

![Utilisateurs non autorisés](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="6b819-505">Exécution d’un Service d’émission de jeton sécurisé personnalisé</span><span class="sxs-lookup"><span data-stu-id="6b819-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="6b819-506">Pour le scénario Secure Token Service (STS) personnalisé en cours, le jeton JWT est émis par le STS personnalisé à l’aide d’une clé symétrique ou asymétrique.</span><span class="sxs-lookup"><span data-stu-id="6b819-506">For the scenario of running custom Secure Token Service (STS), the JWT token will be issued by the custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="6b819-507">Cas d’utilisation de clé symétrique (avec Chrome) :</span><span class="sxs-lookup"><span data-stu-id="6b819-507">The case of using symmetric key (using Chrome):</span></span>

![Exécution de STS personnalisé](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="6b819-509">Cas d’utilisation d’une clé asymétrique via un certificat X509 (à l’aide d’un navigateur moderne Microsoft).</span><span class="sxs-lookup"><span data-stu-id="6b819-509">The case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Exécution de STS personnalisé](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="6b819-511">Dans les deux cas cités, l’authentification utilisateur reste la même via Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-511">In both of the above cases, user authentication stays the same – through Azure AD.</span></span> <span data-ttu-id="6b819-512">La seule différence est que les jetons JWT sont émis par le STS personnalisé et non par Azure AD.</span><span class="sxs-lookup"><span data-stu-id="6b819-512">The only difference is that JWT tokens are issued by the custom STS instead of Azure AD.</span></span> <span data-ttu-id="6b819-513">Évidemment, lorsque vous configurez la protection CENC dynamique, la restriction du service de distribution de licence spécifie le type de jeton Web JSON, avec clé symétrique ou asymétrique.</span><span class="sxs-lookup"><span data-stu-id="6b819-513">Of course, when configuring dynamic CENC protection, the restriction of license delivery service specifies the type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="6b819-514">Résumé</span><span class="sxs-lookup"><span data-stu-id="6b819-514">Summary</span></span>
<span data-ttu-id="6b819-515">Dans ce document, nous avons abordé les sujets des DRM natives multiples, et un contrôle d’authentification des jetons : sa conception et son implémentation à l’aide d’Azure, d’Azure Media Services et d’Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="6b819-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="6b819-516">Une conception de référence est présentée. Elle contient tous les composants nécessaires dans un sous-système DRM/CENC ;</span><span class="sxs-lookup"><span data-stu-id="6b819-516">A reference design is presented which contains all the necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="6b819-517">Une implémentation de référence sur Azure, Azure Media Services et Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="6b819-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="6b819-518">Certaines rubriques directement impliquées dans la conception et l’implémentation sont également abordées.</span><span class="sxs-lookup"><span data-stu-id="6b819-518">Some topics directly involved in the design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="6b819-519">Parcours d’apprentissage de Media Services</span><span class="sxs-lookup"><span data-stu-id="6b819-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="6b819-520">Fournir des commentaires</span><span class="sxs-lookup"><span data-stu-id="6b819-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 
