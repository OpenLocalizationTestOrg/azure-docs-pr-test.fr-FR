---
title: Solution Azure Key Vault dans Log Analytics | Microsoft Docs
description: "La solution Azure Key Vault dans Log Analytics permet de consulter les journaux d’Azure Key Vault."
services: log-analytics
documentationcenter: 
author: richrundmsft
manager: jochan
editor: 
ms.assetid: 5e25e6d6-dd20-4528-9820-6e2958a40dae
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/09/2017
ms.author: richrund
ms.openlocfilehash: 651586e0846ffb22a23e64b73c2cc614980d9b92
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="azure-key-vault-analytics-solution-in-log-analytics"></a><span data-ttu-id="8305a-103">Solution Azure Key Vault Analytics dans Log Analytics</span><span class="sxs-lookup"><span data-stu-id="8305a-103">Azure Key Vault Analytics solution in Log Analytics</span></span>

![Symbole de Key Vault](./media/log-analytics-azure-keyvault/key-vault-analytics-symbol.png)

<span data-ttu-id="8305a-105">Vous pouvez utiliser la solution Azure Key Vault dans Log Analytics pour consulter les journaux AuditEvent d’Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-105">You can use the Azure Key Vault solution in Log Analytics to review Azure Key Vault AuditEvent logs.</span></span>

<span data-ttu-id="8305a-106">Pour l’utiliser, vous devez activer la journalisation des diagnostics d’Azure Key Vault et diriger les diagnostics vers un espace de travail Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="8305a-106">To use the solution, you need to enable logging of Azure Key Vault diagnostics and direct the diagnostics to a Log Analytics workspace.</span></span> <span data-ttu-id="8305a-107">Il n’est pas nécessaire d’écrire les journaux dans le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="8305a-107">It is not necessary to write the logs to Azure Blob storage.</span></span>

> [!NOTE]
> <span data-ttu-id="8305a-108">En janvier 2017, le mode d’envoi des journaux de Key Vault vers Log Analytics a changé.</span><span class="sxs-lookup"><span data-stu-id="8305a-108">In January 2017, the supported way of sending logs from Key Vault to Log Analytics changed.</span></span> <span data-ttu-id="8305a-109">Si le titre de la solution Key Vault que vous utilisez comprend la mention *(déprécié)*, consultez la section [Migration à partir d’une ancienne version de Key Vault](#migrating-from-the-old-key-vault-solution) pour connaître la marche à suivre.</span><span class="sxs-lookup"><span data-stu-id="8305a-109">If the Key Vault solution you are using shows *(deprecated)* in the title, refer to [migrating from the old Key Vault solution](#migrating-from-the-old-key-vault-solution) for steps you need to follow.</span></span>
>
>

## <a name="install-and-configure-the-solution"></a><span data-ttu-id="8305a-110">Installer et configurer la solution</span><span class="sxs-lookup"><span data-stu-id="8305a-110">Install and configure the solution</span></span>
<span data-ttu-id="8305a-111">Suivez les instructions suivantes pour installer et configurer la solution Azure Key Vault :</span><span class="sxs-lookup"><span data-stu-id="8305a-111">Use the following instructions to install and configure the Azure Key Vault solution:</span></span>

1. <span data-ttu-id="8305a-112">Activez la solution Azure Key Vault depuis la [Place de marché Azure](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.KeyVaultAnalyticsOMS?tab=Overview) ou en procédant de la manière décrite dans [Ajouter des solutions Log Analytics à partir de la galerie de solutions](log-analytics-add-solutions.md).</span><span class="sxs-lookup"><span data-stu-id="8305a-112">Enable the Azure Key Vault solution from [Azure marketplace](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.KeyVaultAnalyticsOMS?tab=Overview) or by using the process described in [Add Log Analytics solutions from the Solutions Gallery](log-analytics-add-solutions.md).</span></span>
2. <span data-ttu-id="8305a-113">Activer la journalisation des diagnostics pour les ressources Key Vault à surveiller à l’aide du [portai](#enable-key-vault-diagnostics-in-the-portal) ou de [PowerShell](#enable-key-vault-diagnostics-using-powershell)</span><span class="sxs-lookup"><span data-stu-id="8305a-113">Enable diagnostics logging for the Key Vault resources to monitor, using either the [portal](#enable-key-vault-diagnostics-in-the-portal) or [PowerShell](#enable-key-vault-diagnostics-using-powershell)</span></span>

### <a name="enable-key-vault-diagnostics-in-the-portal"></a><span data-ttu-id="8305a-114">Activer les diagnostics Key Vault dans le portail</span><span class="sxs-lookup"><span data-stu-id="8305a-114">Enable Key Vault diagnostics in the portal</span></span>

1. <span data-ttu-id="8305a-115">Dans le portail Azure, accédez à la ressource Key Vault que vous voulez surveiller.</span><span class="sxs-lookup"><span data-stu-id="8305a-115">In the Azure portal, navigate to the Key Vault resource to monitor</span></span>
2. <span data-ttu-id="8305a-116">Sélectionnez *Journaux de diagnostic* pour ouvrir la page suivante.</span><span class="sxs-lookup"><span data-stu-id="8305a-116">Select *Diagnostics logs* to open the following page</span></span>

   ![Image de la vignette Azure Key Vault](./media/log-analytics-azure-keyvault/log-analytics-keyvault-enable-diagnostics01.png)
3. <span data-ttu-id="8305a-118">Cliquez sur *Activer les diagnostics* pour ouvrir la page suivante.</span><span class="sxs-lookup"><span data-stu-id="8305a-118">Click *Turn on diagnostics* to open the following page</span></span>

   ![Image de la vignette Azure Key Vault](./media/log-analytics-azure-keyvault/log-analytics-keyvault-enable-diagnostics02.png)
4. <span data-ttu-id="8305a-120">Pour activer les diagnostics, cliquez sur *Activé* sous *État*.</span><span class="sxs-lookup"><span data-stu-id="8305a-120">To turn on diagnostics, click *On* under *Status*</span></span>
5. <span data-ttu-id="8305a-121">Cochez la case à côté de l’option *Envoyer à Log Analytics*.</span><span class="sxs-lookup"><span data-stu-id="8305a-121">Click the checkbox for *Send to Log Analytics*</span></span>
6. <span data-ttu-id="8305a-122">Sélectionnez un espace de travail Log Analytics existant ou créez-en un.</span><span class="sxs-lookup"><span data-stu-id="8305a-122">Select an existing Log Analytics workspace, or create a workspace</span></span>
7. <span data-ttu-id="8305a-123">Pour activer les journaux *AuditEvent*, cochez la case située sous Journal.</span><span class="sxs-lookup"><span data-stu-id="8305a-123">To enable *AuditEvent* logs, click the checkbox under Log</span></span>
8. <span data-ttu-id="8305a-124">Cliquez sur *Enregistrer* pour activer la journalisation des diagnostics dans Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="8305a-124">Click *Save* to enable the logging of diagnostics to Log Analytics</span></span>

### <a name="enable-key-vault-diagnostics-using-powershell"></a><span data-ttu-id="8305a-125">Activer les diagnostics Key Vault avec PowerShell</span><span class="sxs-lookup"><span data-stu-id="8305a-125">Enable Key Vault diagnostics using PowerShell</span></span>
<span data-ttu-id="8305a-126">Le script PowerShell suivant fournit un exemple illustrant comment utiliser `Set-AzureRmDiagnosticSetting` pour activer la journalisation des diagnostics pour Key Vault :</span><span class="sxs-lookup"><span data-stu-id="8305a-126">The following PowerShell script provides an example of how to use `Set-AzureRmDiagnosticSetting` to enable diagnostic logging for Key Vault:</span></span>
```
$workspaceId = "/subscriptions/d2e37fee-1234-40b2-5678-0b2199de3b50/resourcegroups/oi-default-east-us/providers/microsoft.operationalinsights/workspaces/rollingbaskets"

$kv = Get-AzureRmKeyVault -VaultName 'ContosoKeyVault'

Set-AzureRmDiagnosticSetting -ResourceId $kv.ResourceId  -WorkspaceId $workspaceId -Enabled $true
```



## <a name="review-azure-key-vault-data-collection-details"></a><span data-ttu-id="8305a-127">Examiner les détails de la collecte de données par Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="8305a-127">Review Azure Key Vault data collection details</span></span>
<span data-ttu-id="8305a-128">La solution Azure Key Vault collecte des journaux de diagnostics directement à partir de Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-128">Azure Key Vault solution collects diagnostics logs directly from the Key Vault.</span></span>
<span data-ttu-id="8305a-129">Il n’est pas nécessaire d’écrire les journaux dans le stockage Blob Azure, et aucun agent n’est requis pour la collecte de données.</span><span class="sxs-lookup"><span data-stu-id="8305a-129">It is not necessary to write the logs to Azure Blob storage and no agent is required for data collection.</span></span>

<span data-ttu-id="8305a-130">Le tableau suivant présente les méthodes de collecte des données et d’autres détails sur le mode de collecte de données pour Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-130">The following table shows data collection methods and other details about how data is collected for Azure Key Vault.</span></span>

| <span data-ttu-id="8305a-131">Plateforme</span><span class="sxs-lookup"><span data-stu-id="8305a-131">Platform</span></span> | <span data-ttu-id="8305a-132">Agent direct</span><span class="sxs-lookup"><span data-stu-id="8305a-132">Direct agent</span></span> | <span data-ttu-id="8305a-133">Agent Systems Center Operations Manager</span><span class="sxs-lookup"><span data-stu-id="8305a-133">Systems Center Operations Manager agent</span></span> | <span data-ttu-id="8305a-134">Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="8305a-134">Azure</span></span> | <span data-ttu-id="8305a-135">Operations Manager requis ?</span><span class="sxs-lookup"><span data-stu-id="8305a-135">Operations Manager required?</span></span> | <span data-ttu-id="8305a-136">Données de l’agent Operations Manager envoyées via un groupe d’administration</span><span class="sxs-lookup"><span data-stu-id="8305a-136">Operations Manager agent data sent via management group</span></span> | <span data-ttu-id="8305a-137">Fréquence de collecte</span><span class="sxs-lookup"><span data-stu-id="8305a-137">Collection frequency</span></span> |
| --- | --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="8305a-138">Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="8305a-138">Azure</span></span> |  |  |<span data-ttu-id="8305a-139">&#8226;</span><span class="sxs-lookup"><span data-stu-id="8305a-139">&#8226;</span></span> |  |  | <span data-ttu-id="8305a-140">à l'arrivée</span><span class="sxs-lookup"><span data-stu-id="8305a-140">on arrival</span></span> |

## <a name="use-azure-key-vault"></a><span data-ttu-id="8305a-141">Utiliser Azure Key Vault</span><span class="sxs-lookup"><span data-stu-id="8305a-141">Use Azure Key Vault</span></span>
<span data-ttu-id="8305a-142">Une fois la [solution installée](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.KeyVaultAnalyticsOMS?tab=Overview), affichez les données Key Vault en cliquant sur la vignette **Azure Key Vault** située dans la page **Vue d’ensemble** de Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="8305a-142">After you [install the solution](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.KeyVaultAnalyticsOMS?tab=Overview), view the Key Vault data by clicking the **Azure Key Vault** tile from the **Overview** page of Log Analytics.</span></span>

![Image de la vignette Azure Key Vault](./media/log-analytics-azure-keyvault/log-analytics-keyvault-tile.png)

<span data-ttu-id="8305a-144">Après avoir cliqué sur la vignette **Vue d’ensemble**, vous pouvez consulter des récapitulatifs de vos journaux et en approfondir des détails pour les catégories suivantes :</span><span class="sxs-lookup"><span data-stu-id="8305a-144">After you click the **Overview** tile, you can view summaries of your logs and then drill in to details for the following categories:</span></span>

* <span data-ttu-id="8305a-145">Volume de toutes les opérations de Key Vault dans le temps</span><span class="sxs-lookup"><span data-stu-id="8305a-145">Volume of all key vault operations over time</span></span>
* <span data-ttu-id="8305a-146">Volumes des opérations en échec dans le temps</span><span class="sxs-lookup"><span data-stu-id="8305a-146">Failed operation volumes over time</span></span>
* <span data-ttu-id="8305a-147">Latence opérationnelle moyenne par opération</span><span class="sxs-lookup"><span data-stu-id="8305a-147">Average operational latency by operation</span></span>
* <span data-ttu-id="8305a-148">Qualité de service des opérations, avec le nombre d’opérations qui prennent plus de 1 000 ms et la liste de ces opérations</span><span class="sxs-lookup"><span data-stu-id="8305a-148">Quality of service for operations with the number of operations that take more than 1000 ms and a list of operations that take more than 1000 ms</span></span>

![Image du tableau de bord d’Azure Key Vault](./media/log-analytics-azure-keyvault/log-analytics-keyvault01.png)

![Image du tableau de bord d’Azure Key Vault](./media/log-analytics-azure-keyvault/log-analytics-keyvault02.png)

### <a name="to-view-details-for-any-operation"></a><span data-ttu-id="8305a-151">Pour afficher les détails d’une opération</span><span class="sxs-lookup"><span data-stu-id="8305a-151">To view details for any operation</span></span>
1. <span data-ttu-id="8305a-152">Dans la page **Vue d’ensemble**, cliquez sur la vignette **Azure Key Vault**.</span><span class="sxs-lookup"><span data-stu-id="8305a-152">On the **Overview** page, click the **Azure Key Vault** tile.</span></span>
2. <span data-ttu-id="8305a-153">Sur le tableau de bord **Azure Key Vault**, examinez les informations résumées dans l’un des panneaux, puis cliquez sur l’une d’elles pour afficher des informations détaillées dans la page Recherche de journal.</span><span class="sxs-lookup"><span data-stu-id="8305a-153">On the **Azure Key Vault** dashboard, review the summary information in one of the blades, and then click one to view detailed information about it in the log search page.</span></span>

    <span data-ttu-id="8305a-154">Sur l’une des pages de recherche de journal, vous pouvez afficher les résultats par date, les résultats détaillés et votre historique de recherches de journaux.</span><span class="sxs-lookup"><span data-stu-id="8305a-154">On any of the log search pages, you can view results by time, detailed results, and your log search history.</span></span> <span data-ttu-id="8305a-155">Vous pouvez également filtrer par facettes pour affiner les résultats.</span><span class="sxs-lookup"><span data-stu-id="8305a-155">You can also filter by facets to narrow the results.</span></span>

## <a name="log-analytics-records"></a><span data-ttu-id="8305a-156">Enregistrements Log Analytics</span><span class="sxs-lookup"><span data-stu-id="8305a-156">Log Analytics records</span></span>
<span data-ttu-id="8305a-157">La solution Azure Key Vault analyse les enregistrements de type **KeyVaults** qui sont collectés à partir des [journaux AuditEvent](../key-vault/key-vault-logging.md) dans les Diagnostics Azure.</span><span class="sxs-lookup"><span data-stu-id="8305a-157">The Azure Key Vault solution analyzes records that have a type of **KeyVaults** that are collected from [AuditEvent logs](../key-vault/key-vault-logging.md) in Azure Diagnostics.</span></span>  <span data-ttu-id="8305a-158">Les propriétés de ces enregistrements figurent dans le tableau suivant :</span><span class="sxs-lookup"><span data-stu-id="8305a-158">Properties for these records are in the following table:</span></span>  

| <span data-ttu-id="8305a-159">Propriété</span><span class="sxs-lookup"><span data-stu-id="8305a-159">Property</span></span> | <span data-ttu-id="8305a-160">Description</span><span class="sxs-lookup"><span data-stu-id="8305a-160">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="8305a-161">Type</span><span class="sxs-lookup"><span data-stu-id="8305a-161">Type</span></span> |<span data-ttu-id="8305a-162">*AzureDiagnostics*</span><span class="sxs-lookup"><span data-stu-id="8305a-162">*AzureDiagnostics*</span></span> |
| <span data-ttu-id="8305a-163">SourceSystem</span><span class="sxs-lookup"><span data-stu-id="8305a-163">SourceSystem</span></span> |<span data-ttu-id="8305a-164">*Microsoft Azure*</span><span class="sxs-lookup"><span data-stu-id="8305a-164">*Azure*</span></span> |
| <span data-ttu-id="8305a-165">callerIpAddress</span><span class="sxs-lookup"><span data-stu-id="8305a-165">CallerIpAddress</span></span> |<span data-ttu-id="8305a-166">Adresse IP du client qui a effectué la demande.</span><span class="sxs-lookup"><span data-stu-id="8305a-166">IP address of the client who made the request</span></span> |
| <span data-ttu-id="8305a-167">Catégorie</span><span class="sxs-lookup"><span data-stu-id="8305a-167">Category</span></span> | <span data-ttu-id="8305a-168">*AuditEvent*</span><span class="sxs-lookup"><span data-stu-id="8305a-168">*AuditEvent*</span></span> |
| <span data-ttu-id="8305a-169">CorrelationId</span><span class="sxs-lookup"><span data-stu-id="8305a-169">CorrelationId</span></span> |<span data-ttu-id="8305a-170">GUID facultatif que le client peut transférer pour mettre en corrélation les journaux côté client avec les journaux côté service (Key Vault).</span><span class="sxs-lookup"><span data-stu-id="8305a-170">An optional GUID that the client can pass to correlate client-side logs with service-side (Key Vault) logs.</span></span> |
| <span data-ttu-id="8305a-171">DurationMs</span><span class="sxs-lookup"><span data-stu-id="8305a-171">DurationMs</span></span> |<span data-ttu-id="8305a-172">Délai nécessaire pour répondre à la demande API REST, en millisecondes.</span><span class="sxs-lookup"><span data-stu-id="8305a-172">Time it took to service the REST API request, in milliseconds.</span></span> <span data-ttu-id="8305a-173">La latence du réseau n’étant pas incluse dans ce chiffre, le temps mesuré côté client peut ne pas correspondre à cette durée.</span><span class="sxs-lookup"><span data-stu-id="8305a-173">This time does not include network latency, so the time that you measure on the client side might not match this time.</span></span> |
| <span data-ttu-id="8305a-174">httpStatusCode_d</span><span class="sxs-lookup"><span data-stu-id="8305a-174">httpStatusCode_d</span></span> |<span data-ttu-id="8305a-175">Code d’état HTTP retourné par la demande (par exemple, *200*)</span><span class="sxs-lookup"><span data-stu-id="8305a-175">HTTP status code returned by the request (for example, *200*)</span></span> |
| <span data-ttu-id="8305a-176">id_s</span><span class="sxs-lookup"><span data-stu-id="8305a-176">id_s</span></span> |<span data-ttu-id="8305a-177">ID unique de la demande.</span><span class="sxs-lookup"><span data-stu-id="8305a-177">Unique ID of the request</span></span> |
| <span data-ttu-id="8305a-178">identity_claim_appid_g</span><span class="sxs-lookup"><span data-stu-id="8305a-178">identity_claim_appid_g</span></span> | <span data-ttu-id="8305a-179">GUID de l’ID d’application</span><span class="sxs-lookup"><span data-stu-id="8305a-179">GUID for the application id</span></span> |
| <span data-ttu-id="8305a-180">Nom d'opération</span><span class="sxs-lookup"><span data-stu-id="8305a-180">OperationName</span></span> |<span data-ttu-id="8305a-181">Nom de l’opération, comme décrit dans [journalisation d’Azure Key Vault](../key-vault/key-vault-logging.md)</span><span class="sxs-lookup"><span data-stu-id="8305a-181">Name of the operation, as documented in [Azure Key Vault Logging](../key-vault/key-vault-logging.md)</span></span> |
| <span data-ttu-id="8305a-182">operationVersion</span><span class="sxs-lookup"><span data-stu-id="8305a-182">OperationVersion</span></span> |<span data-ttu-id="8305a-183">Version d’API REST demandée par le client (par exemple *2015-06-01*)</span><span class="sxs-lookup"><span data-stu-id="8305a-183">REST API version requested by the client (for example *2015-06-01*)</span></span> |
| <span data-ttu-id="8305a-184">requestUri_s</span><span class="sxs-lookup"><span data-stu-id="8305a-184">requestUri_s</span></span> |<span data-ttu-id="8305a-185">URI de la demande.</span><span class="sxs-lookup"><span data-stu-id="8305a-185">Uri of the request</span></span> |
| <span data-ttu-id="8305a-186">Ressource</span><span class="sxs-lookup"><span data-stu-id="8305a-186">Resource</span></span> |<span data-ttu-id="8305a-187">Nom du Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-187">Name of the key vault</span></span> |
| <span data-ttu-id="8305a-188">ResourceGroup</span><span class="sxs-lookup"><span data-stu-id="8305a-188">ResourceGroup</span></span> |<span data-ttu-id="8305a-189">Groupe de ressources du Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-189">Resource group of the key vault</span></span> |
| <span data-ttu-id="8305a-190">ResourceId</span><span class="sxs-lookup"><span data-stu-id="8305a-190">ResourceId</span></span> |<span data-ttu-id="8305a-191">ID de ressource Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="8305a-191">Azure Resource Manager Resource ID.</span></span> <span data-ttu-id="8305a-192">Pour les journaux de coffre de clés, il s’agit de l’ID de ressource du coffre de clés.</span><span class="sxs-lookup"><span data-stu-id="8305a-192">For Key Vault logs, this is the Key Vault resource ID.</span></span> |
| <span data-ttu-id="8305a-193">ResourceProvider</span><span class="sxs-lookup"><span data-stu-id="8305a-193">ResourceProvider</span></span> |<span data-ttu-id="8305a-194">*MICROSOFT.KEYVAULT*</span><span class="sxs-lookup"><span data-stu-id="8305a-194">*MICROSOFT.KEYVAULT*</span></span> |
| <span data-ttu-id="8305a-195">ResourceType</span><span class="sxs-lookup"><span data-stu-id="8305a-195">ResourceType</span></span> | <span data-ttu-id="8305a-196">*VAULTS*</span><span class="sxs-lookup"><span data-stu-id="8305a-196">*VAULTS*</span></span> |
| <span data-ttu-id="8305a-197">ResultSignature</span><span class="sxs-lookup"><span data-stu-id="8305a-197">ResultSignature</span></span> |<span data-ttu-id="8305a-198">État HTTP (par exemple *OK*)</span><span class="sxs-lookup"><span data-stu-id="8305a-198">HTTP status (for example, *OK*)</span></span> |
| <span data-ttu-id="8305a-199">ResultType</span><span class="sxs-lookup"><span data-stu-id="8305a-199">ResultType</span></span> |<span data-ttu-id="8305a-200">Résultat de la demande de l’API REST (par exemple, *Réussite*)</span><span class="sxs-lookup"><span data-stu-id="8305a-200">Result of REST API request (for example, *Success*)</span></span> |
| <span data-ttu-id="8305a-201">SubscriptionId</span><span class="sxs-lookup"><span data-stu-id="8305a-201">SubscriptionId</span></span> |<span data-ttu-id="8305a-202">ID de l’abonnement Azure contenant le Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-202">Azure subscription ID of the subscription containing the Key Vault</span></span> |

## <a name="migrating-from-the-old-key-vault-solution"></a><span data-ttu-id="8305a-203">Migration à partir d’une ancienne version de Key Vault</span><span class="sxs-lookup"><span data-stu-id="8305a-203">Migrating from the old Key Vault solution</span></span>
<span data-ttu-id="8305a-204">En janvier 2017, le mode d’envoi des journaux de Key Vault vers Log Analytics a changé.</span><span class="sxs-lookup"><span data-stu-id="8305a-204">In January 2017, the supported way of sending logs from Key Vault to Log Analytics changed.</span></span> <span data-ttu-id="8305a-205">Ces modifications présentent les avantages suivants :</span><span class="sxs-lookup"><span data-stu-id="8305a-205">These changes provide the following advantages:</span></span>
+ <span data-ttu-id="8305a-206">Les journaux sont écrits directement dans Log Analytics sans avoir besoin d’utiliser un compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="8305a-206">Logs are written directly to Log Analytics without the need to use a storage account</span></span>
+ <span data-ttu-id="8305a-207">La durée de latence est plus courte entre le moment où les journaux sont générés et celui où ils deviennent disponibles dans Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="8305a-207">Less latency from the time when logs are generated to them being available in Log Analytics</span></span>
+ <span data-ttu-id="8305a-208">Le nombre d’étapes de configuration est réduit.</span><span class="sxs-lookup"><span data-stu-id="8305a-208">Fewer configuration steps</span></span>
+ <span data-ttu-id="8305a-209">Tous les types de diagnostics Azure sont au même format.</span><span class="sxs-lookup"><span data-stu-id="8305a-209">A common format for all types of Azure diagnostics</span></span>

<span data-ttu-id="8305a-210">Pour utiliser la solution mise à jour :</span><span class="sxs-lookup"><span data-stu-id="8305a-210">To use the updated solution:</span></span>

1. <span data-ttu-id="8305a-211">[Configurez les diagnostics pour qu’ils soient directement envoyés à Log Analytics à partir de Key Vault](#enable-key-vault-diagnostics-in-the-portal).</span><span class="sxs-lookup"><span data-stu-id="8305a-211">[Configure diagnostics to be sent directly to Log Analytics from Key Vault](#enable-key-vault-diagnostics-in-the-portal)</span></span>  
2. <span data-ttu-id="8305a-212">Activez la solution Azure Key Vault en procédant de la manière décrite dans [Ajouter des solutions Log Analytics à partir de la galerie de solutions](log-analytics-add-solutions.md).</span><span class="sxs-lookup"><span data-stu-id="8305a-212">Enable the Azure Key Vault solution by using the process described in [Add Log Analytics solutions from the Solutions Gallery](log-analytics-add-solutions.md)</span></span>
3. <span data-ttu-id="8305a-213">Mettez à jour les requêtes, les tableaux de bord et les alertes enregistrés pour qu’ils utilisent le nouveau type de données.</span><span class="sxs-lookup"><span data-stu-id="8305a-213">Update any saved queries, dashboards, or alerts to use the new data type</span></span>
  + <span data-ttu-id="8305a-214">Le type passe de KeyVaults à AzureDiagnostics.</span><span class="sxs-lookup"><span data-stu-id="8305a-214">Type is change from: KeyVaults to AzureDiagnostics.</span></span> <span data-ttu-id="8305a-215">Vous pouvez utiliser ResourceType pour filtrer les journaux Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-215">You can use the ResourceType to filter to Key Vault Logs.</span></span>
  - <span data-ttu-id="8305a-216">Au lieu de `Type=KeyVaults`, utilisez `Type=AzureDiagnostics ResourceType=VAULTS`.</span><span class="sxs-lookup"><span data-stu-id="8305a-216">Instead of: `Type=KeyVaults`, use `Type=AzureDiagnostics ResourceType=VAULTS`</span></span>
  + <span data-ttu-id="8305a-217">Champs : (les noms de champs respectent la casse)</span><span class="sxs-lookup"><span data-stu-id="8305a-217">Fields: (Field names are case-sensitive)</span></span>
  - <span data-ttu-id="8305a-218">Pour tous les champs dont le suffixe est \_s, \_d ou \_g, remplacez le premier caractère du nom par une lettre minuscule.</span><span class="sxs-lookup"><span data-stu-id="8305a-218">For any field that has a suffix of \_s, \_d, or \_g in the name, change the first character to lower case</span></span>
  - <span data-ttu-id="8305a-219">Pour tous les champs dont le suffixe est \_o, les données sont réparties sur plusieurs champs, selon les noms de champs imbriqués.</span><span class="sxs-lookup"><span data-stu-id="8305a-219">For any field that has a suffix of \_o in name, the data is split into individual fields based on the nested field names.</span></span> <span data-ttu-id="8305a-220">Par exemple, l’UPN de l’appelant est stocké dans un champ `identity_claim_http_schemas_xmlsoap_org_ws_2005_05_identity_claims_upn_s`.</span><span class="sxs-lookup"><span data-stu-id="8305a-220">For example, the UPN of the caller is stored in a field `identity_claim_http_schemas_xmlsoap_org_ws_2005_05_identity_claims_upn_s`</span></span>
   - <span data-ttu-id="8305a-221">Le champ CallerIpAddress est remplacé par CallerIPAddress</span><span class="sxs-lookup"><span data-stu-id="8305a-221">Field CallerIpAddress changed to CallerIPAddress</span></span>
   - <span data-ttu-id="8305a-222">Le champ RemoteIPCountry n’est plus présent</span><span class="sxs-lookup"><span data-stu-id="8305a-222">Field RemoteIPCountry is no longer present</span></span>
4. <span data-ttu-id="8305a-223">Supprimez la solution *Key Vault Analytics (déprécié)*.</span><span class="sxs-lookup"><span data-stu-id="8305a-223">Remove the *Key Vault Analytics (Deprecated)* solution.</span></span> <span data-ttu-id="8305a-224">Avec PowerShell, utilisez `Set-AzureOperationalInsightsIntelligencePack -ResourceGroupName <resource group that the workspace is in> -WorkspaceName <name of the log analytics workspace> -IntelligencePackName "KeyVault" -Enabled $false`.</span><span class="sxs-lookup"><span data-stu-id="8305a-224">If you are using PowerShell, use `Set-AzureOperationalInsightsIntelligencePack -ResourceGroupName <resource group that the workspace is in> -WorkspaceName <name of the log analytics workspace> -IntelligencePackName "KeyVault" -Enabled $false`</span></span>

<span data-ttu-id="8305a-225">Les données collectées avant la modification ne seront pas visibles dans la nouvelle solution.</span><span class="sxs-lookup"><span data-stu-id="8305a-225">Data collected before the change is not visible in the new solution.</span></span> <span data-ttu-id="8305a-226">Vous pouvez continuer à interroger ces données à l’aide de l’ancien type et des anciens noms de champs.</span><span class="sxs-lookup"><span data-stu-id="8305a-226">You can continue to query for this data using the old Type and field names.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="8305a-227">résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="8305a-227">Troubleshooting</span></span>
[!INCLUDE [log-analytics-troubleshoot-azure-diagnostics](../../includes/log-analytics-troubleshoot-azure-diagnostics.md)]

## <a name="next-steps"></a><span data-ttu-id="8305a-228">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="8305a-228">Next steps</span></span>
* <span data-ttu-id="8305a-229">Utilisez les [recherches dans les journaux dans Log Analytics](log-analytics-log-searches.md) pour afficher les données détaillées de Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="8305a-229">Use [Log searches in Log Analytics](log-analytics-log-searches.md) to view detailed Azure Key Vault data.</span></span>
