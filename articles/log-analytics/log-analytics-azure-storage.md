---
title: "Collecte des journaux et des métriques des services Azure pour Log Analytics | Microsoft Docs"
description: "Configuration des diagnostics sur les ressources Azure pour écrire des journaux et métriques dans Log Analytics."
services: log-analytics
documentationcenter: 
author: MGoedtel
manager: carmonm
editor: 
ms.assetid: 84105740-3697-4109-bc59-2452c1131bfe
ms.service: log-analytics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/12/2017
ms.author: magoedte
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 7a3785e39f0d1cf849dbbf0d83d89eaed58c5b0b
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="collect-azure-service-logs-and-metrics-for-use-in-log-analytics"></a><span data-ttu-id="50e78-103">Collecte des journaux et des métriques des services Azure à utiliser dans Log Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-103">Collect Azure service logs and metrics for use in Log Analytics</span></span>

<span data-ttu-id="50e78-104">Il existe quatre façons différentes de collecter des journaux et des métriques pour les services Azure :</span><span class="sxs-lookup"><span data-stu-id="50e78-104">There are four different ways of collecting logs and metrics for Azure services:</span></span>

1. <span data-ttu-id="50e78-105">Diagnostics Azure directement dans Log Analytics (*Diagnostics* dans le tableau suivant)</span><span class="sxs-lookup"><span data-stu-id="50e78-105">Azure diagnostics direct to Log Analytics (*Diagnostics* in the following table)</span></span>
2. <span data-ttu-id="50e78-106">Diagnostics Azure vers stockage Azure, puis vers Log Analytics (*Stockage* dans le tableau suivant)</span><span class="sxs-lookup"><span data-stu-id="50e78-106">Azure diagnostics to Azure storage to Log Analytics (*Storage* in the following table)</span></span>
3. <span data-ttu-id="50e78-107">Connecteurs pour les services Azure (*Connecteurs* dans le tableau suivant)</span><span class="sxs-lookup"><span data-stu-id="50e78-107">Connectors for Azure services (*Connectors* in the following table)</span></span>
4. <span data-ttu-id="50e78-108">Des scripts pour collecter puis publier les données dans Log Analytics (vide dans le tableau suivant et pour les services qui ne sont pas répertoriés)</span><span class="sxs-lookup"><span data-stu-id="50e78-108">Scripts to collect and then post data into Log Analytics (blanks in the following table and for services that are not listed)</span></span>


| <span data-ttu-id="50e78-109">Service</span><span class="sxs-lookup"><span data-stu-id="50e78-109">Service</span></span>                 | <span data-ttu-id="50e78-110">Type de ressource</span><span class="sxs-lookup"><span data-stu-id="50e78-110">Resource Type</span></span>                           | <span data-ttu-id="50e78-111">Journaux</span><span class="sxs-lookup"><span data-stu-id="50e78-111">Logs</span></span>        | <span data-ttu-id="50e78-112">Mesures</span><span class="sxs-lookup"><span data-stu-id="50e78-112">Metrics</span></span>     | <span data-ttu-id="50e78-113">Solution</span><span class="sxs-lookup"><span data-stu-id="50e78-113">Solution</span></span> |
| --- | --- | --- | --- | --- |
| <span data-ttu-id="50e78-114">Passerelles d’application</span><span class="sxs-lookup"><span data-stu-id="50e78-114">Application gateways</span></span>    | <span data-ttu-id="50e78-115">Microsoft.Network/applicationGateways</span><span class="sxs-lookup"><span data-stu-id="50e78-115">Microsoft.Network/applicationGateways</span></span>   | <span data-ttu-id="50e78-116">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-116">Diagnostics</span></span> | <span data-ttu-id="50e78-117">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-117">Diagnostics</span></span> | [<span data-ttu-id="50e78-118">Azure Application Gateway Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-118">Azure Application Gateway Analytics</span></span>](log-analytics-azure-networking-analytics.md#azure-application-gateway-analytics-solution-in-log-analytics) |
| <span data-ttu-id="50e78-119">Application Insights</span><span class="sxs-lookup"><span data-stu-id="50e78-119">Application insights</span></span>    |                                         | <span data-ttu-id="50e78-120">Connecteur</span><span class="sxs-lookup"><span data-stu-id="50e78-120">Connector</span></span>   | <span data-ttu-id="50e78-121">Connecteur</span><span class="sxs-lookup"><span data-stu-id="50e78-121">Connector</span></span>   | <span data-ttu-id="50e78-122">[Connecteur Application Insights](https://blogs.technet.microsoft.com/msoms/2016/09/26/application-insights-connector-in-oms/) (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-122">[Application Insights Connector](https://blogs.technet.microsoft.com/msoms/2016/09/26/application-insights-connector-in-oms/) (Preview)</span></span> |
| <span data-ttu-id="50e78-123">Comptes Automation</span><span class="sxs-lookup"><span data-stu-id="50e78-123">Automation accounts</span></span>     | <span data-ttu-id="50e78-124">Microsoft.Automation/AutomationAccounts</span><span class="sxs-lookup"><span data-stu-id="50e78-124">Microsoft.Automation/AutomationAccounts</span></span> | <span data-ttu-id="50e78-125">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-125">Diagnostics</span></span> |             | [<span data-ttu-id="50e78-126">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="50e78-126">More information</span></span>](../automation/automation-manage-send-joblogs-log-analytics.md)|
| <span data-ttu-id="50e78-127">Comptes Batch</span><span class="sxs-lookup"><span data-stu-id="50e78-127">Batch accounts</span></span>          | <span data-ttu-id="50e78-128">Microsoft.Batch/batchAccounts</span><span class="sxs-lookup"><span data-stu-id="50e78-128">Microsoft.Batch/batchAccounts</span></span>           | <span data-ttu-id="50e78-129">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-129">Diagnostics</span></span> | <span data-ttu-id="50e78-130">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-130">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-131">Services cloud classiques</span><span class="sxs-lookup"><span data-stu-id="50e78-131">Classic cloud services</span></span>  |                                         | <span data-ttu-id="50e78-132">Storage</span><span class="sxs-lookup"><span data-stu-id="50e78-132">Storage</span></span>     |             | [<span data-ttu-id="50e78-133">Plus d’informations</span><span class="sxs-lookup"><span data-stu-id="50e78-133">More information</span></span>](log-analytics-azure-storage-iis-table.md) |
| <span data-ttu-id="50e78-134">Cognitive services</span><span class="sxs-lookup"><span data-stu-id="50e78-134">Cognitive services</span></span>      | <span data-ttu-id="50e78-135">Microsoft.CognitiveServices/accounts</span><span class="sxs-lookup"><span data-stu-id="50e78-135">Microsoft.CognitiveServices/accounts</span></span>    |             | <span data-ttu-id="50e78-136">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-136">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-137">Data Lake analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-137">Data Lake analytics</span></span>     | <span data-ttu-id="50e78-138">Microsoft.DataLakeAnalytics/accounts</span><span class="sxs-lookup"><span data-stu-id="50e78-138">Microsoft.DataLakeAnalytics/accounts</span></span>    | <span data-ttu-id="50e78-139">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-139">Diagnostics</span></span> |             | |
| <span data-ttu-id="50e78-140">Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="50e78-140">Data Lake store</span></span>         | <span data-ttu-id="50e78-141">Microsoft.DataLakeStore/accounts</span><span class="sxs-lookup"><span data-stu-id="50e78-141">Microsoft.DataLakeStore/accounts</span></span>        | <span data-ttu-id="50e78-142">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-142">Diagnostics</span></span> |             | |
| <span data-ttu-id="50e78-143">Espace de noms Event Hub</span><span class="sxs-lookup"><span data-stu-id="50e78-143">Event Hub namespace</span></span>     | <span data-ttu-id="50e78-144">Microsoft.EventHub/namespaces</span><span class="sxs-lookup"><span data-stu-id="50e78-144">Microsoft.EventHub/namespaces</span></span>           | <span data-ttu-id="50e78-145">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-145">Diagnostics</span></span> | <span data-ttu-id="50e78-146">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-146">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-147">IoT Hubs</span><span class="sxs-lookup"><span data-stu-id="50e78-147">IoT Hubs</span></span>                | <span data-ttu-id="50e78-148">Microsoft.Devices/IotHubs</span><span class="sxs-lookup"><span data-stu-id="50e78-148">Microsoft.Devices/IotHubs</span></span>               |             | <span data-ttu-id="50e78-149">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-149">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-150">Key Vault</span><span class="sxs-lookup"><span data-stu-id="50e78-150">Key Vault</span></span>               | <span data-ttu-id="50e78-151">Microsoft.KeyVault/vaults</span><span class="sxs-lookup"><span data-stu-id="50e78-151">Microsoft.KeyVault/vaults</span></span>               | <span data-ttu-id="50e78-152">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-152">Diagnostics</span></span> |             | [<span data-ttu-id="50e78-153">KeyVault Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-153">KeyVault Analytics</span></span>](log-analytics-azure-key-vault.md) |
| <span data-ttu-id="50e78-154">Équilibreurs de charge</span><span class="sxs-lookup"><span data-stu-id="50e78-154">Load Balancers</span></span>          | <span data-ttu-id="50e78-155">Microsoft.Network/loadBalancers</span><span class="sxs-lookup"><span data-stu-id="50e78-155">Microsoft.Network/loadBalancers</span></span>         | <span data-ttu-id="50e78-156">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-156">Diagnostics</span></span> |             |  |
| <span data-ttu-id="50e78-157">Logic Apps</span><span class="sxs-lookup"><span data-stu-id="50e78-157">Logic Apps</span></span>              | <span data-ttu-id="50e78-158">Microsoft.Logic/workflows</span><span class="sxs-lookup"><span data-stu-id="50e78-158">Microsoft.Logic/workflows</span></span> <br> <span data-ttu-id="50e78-159">Microsoft.Logic/integrationAccounts</span><span class="sxs-lookup"><span data-stu-id="50e78-159">Microsoft.Logic/integrationAccounts</span></span> | <span data-ttu-id="50e78-160">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-160">Diagnostics</span></span> | <span data-ttu-id="50e78-161">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-161">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-162">Groupes de sécurité réseau</span><span class="sxs-lookup"><span data-stu-id="50e78-162">Network Security Groups</span></span> | <span data-ttu-id="50e78-163">Microsoft.Network/networksecuritygroups</span><span class="sxs-lookup"><span data-stu-id="50e78-163">Microsoft.Network/networksecuritygroups</span></span> | <span data-ttu-id="50e78-164">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-164">Diagnostics</span></span> |             | [<span data-ttu-id="50e78-165">Azure Network Security Group Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-165">Azure Network Security Group Analytics</span></span>](log-analytics-azure-networking-analytics.md#azure-network-security-group-analytics-solution-in-log-analytics) |
| <span data-ttu-id="50e78-166">Coffres de récupération</span><span class="sxs-lookup"><span data-stu-id="50e78-166">Recovery vaults</span></span>         | <span data-ttu-id="50e78-167">Microsoft.RecoveryServices/vaults</span><span class="sxs-lookup"><span data-stu-id="50e78-167">Microsoft.RecoveryServices/vaults</span></span>       |             |             | [<span data-ttu-id="50e78-168">Azure Recovery Services Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-168">Azure Recovery Services Analytics (Preview)</span></span>](https://github.com/krnese/AzureDeploy/blob/master/OMS/MSOMS/Solutions/recoveryservices/)|
| <span data-ttu-id="50e78-169">Services de recherche</span><span class="sxs-lookup"><span data-stu-id="50e78-169">Search services</span></span>         | <span data-ttu-id="50e78-170">Microsoft.Search/searchServices</span><span class="sxs-lookup"><span data-stu-id="50e78-170">Microsoft.Search/searchServices</span></span>         | <span data-ttu-id="50e78-171">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-171">Diagnostics</span></span> | <span data-ttu-id="50e78-172">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-172">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-173">Espace de noms Service Bus</span><span class="sxs-lookup"><span data-stu-id="50e78-173">Service Bus namespace</span></span>   | <span data-ttu-id="50e78-174">Microsoft.ServiceBus/namespaces</span><span class="sxs-lookup"><span data-stu-id="50e78-174">Microsoft.ServiceBus/namespaces</span></span>         | <span data-ttu-id="50e78-175">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-175">Diagnostics</span></span> | <span data-ttu-id="50e78-176">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-176">Diagnostics</span></span> | [<span data-ttu-id="50e78-177">Service Bus Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-177">Service Bus Analytics (Preview)</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/oms-servicebus-solution)|
| <span data-ttu-id="50e78-178">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="50e78-178">Service Fabric</span></span>          |                                         | <span data-ttu-id="50e78-179">Storage</span><span class="sxs-lookup"><span data-stu-id="50e78-179">Storage</span></span>     |             | [<span data-ttu-id="50e78-180">Service Fabric Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-180">Service Fabric Analytics (Preview)</span></span>](log-analytics-service-fabric.md) |
| <span data-ttu-id="50e78-181">SQL (v12)</span><span class="sxs-lookup"><span data-stu-id="50e78-181">SQL (v12)</span></span>               | <span data-ttu-id="50e78-182">Microsoft.Sql/servers/databases</span><span class="sxs-lookup"><span data-stu-id="50e78-182">Microsoft.Sql/servers/databases</span></span> <br> <span data-ttu-id="50e78-183">Microsoft.Sql/servers/elasticPools</span><span class="sxs-lookup"><span data-stu-id="50e78-183">Microsoft.Sql/servers/elasticPools</span></span> |             | <span data-ttu-id="50e78-184">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-184">Diagnostics</span></span> | [<span data-ttu-id="50e78-185">Azure SQL Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-185">Azure SQL Analytics (Preview)</span></span>](log-analytics-azure-sql.md) |
| <span data-ttu-id="50e78-186">Storage</span><span class="sxs-lookup"><span data-stu-id="50e78-186">Storage</span></span>                 |                                         |             | <span data-ttu-id="50e78-187">Script</span><span class="sxs-lookup"><span data-stu-id="50e78-187">Script</span></span>      | [<span data-ttu-id="50e78-188">Azure Storage Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-188">Azure Storage Analytics (Preview)</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/oms-azure-storage-analytics-solution) |
| <span data-ttu-id="50e78-189">Machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="50e78-189">Virtual Machines</span></span>        | <span data-ttu-id="50e78-190">Microsoft.Compute/virtualMachines</span><span class="sxs-lookup"><span data-stu-id="50e78-190">Microsoft.Compute/virtualMachines</span></span>       | <span data-ttu-id="50e78-191">Extension</span><span class="sxs-lookup"><span data-stu-id="50e78-191">Extension</span></span>   | <span data-ttu-id="50e78-192">Extension</span><span class="sxs-lookup"><span data-stu-id="50e78-192">Extension</span></span> <br> <span data-ttu-id="50e78-193">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-193">Diagnostics</span></span>  | |
| <span data-ttu-id="50e78-194">Groupes de machines virtuelles identiques</span><span class="sxs-lookup"><span data-stu-id="50e78-194">Virtual Machines scale sets</span></span> | <span data-ttu-id="50e78-195">Microsoft.Compute/virtualMachines</span><span class="sxs-lookup"><span data-stu-id="50e78-195">Microsoft.Compute/virtualMachines</span></span> <br> <span data-ttu-id="50e78-196">Microsoft.Compute/virtualMachineScaleSets/virtualMachines</span><span class="sxs-lookup"><span data-stu-id="50e78-196">Microsoft.Compute/virtualMachineScaleSets/virtualMachines</span></span> |             | <span data-ttu-id="50e78-197">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-197">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-198">Batteries de serveurs web</span><span class="sxs-lookup"><span data-stu-id="50e78-198">Web Server farms</span></span>        | <span data-ttu-id="50e78-199">Microsoft.Web/serverfarms</span><span class="sxs-lookup"><span data-stu-id="50e78-199">Microsoft.Web/serverfarms</span></span>               |             | <span data-ttu-id="50e78-200">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-200">Diagnostics</span></span> | |
| <span data-ttu-id="50e78-201">Sites web</span><span class="sxs-lookup"><span data-stu-id="50e78-201">Web Sites</span></span>               | <span data-ttu-id="50e78-202">Microsoft.Web/sites</span><span class="sxs-lookup"><span data-stu-id="50e78-202">Microsoft.Web/sites</span></span> <br> <span data-ttu-id="50e78-203">Microsoft.Web/sites/slots</span><span class="sxs-lookup"><span data-stu-id="50e78-203">Microsoft.Web/sites/slots</span></span> |             | <span data-ttu-id="50e78-204">Diagnostics</span><span class="sxs-lookup"><span data-stu-id="50e78-204">Diagnostics</span></span> | [<span data-ttu-id="50e78-205">Azure Web Apps Analytics (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="50e78-205">Azure Web Apps Analytics (Preview)</span></span>](https://azuremarketplace.microsoft.com/marketplace/apps/Microsoft.AzureWebAppsAnalyticsOMS?tab=Overview) |


> [!NOTE]
> <span data-ttu-id="50e78-206">Pour l’analyse des machines virtuelles (Linux et Windows), nous vous recommandons d’installer l’[extension de machine virtuelle Log Analytics](log-analytics-azure-vm-extension.md).</span><span class="sxs-lookup"><span data-stu-id="50e78-206">For monitoring Azure virtual machines (both Linux and Windows), we recommend installing the [Log Analytics VM extension](log-analytics-azure-vm-extension.md).</span></span> <span data-ttu-id="50e78-207">L’agent vous fournit les informations collectées à partir de vos machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="50e78-207">The agent provides you with insights collected from within your virtual machines.</span></span> <span data-ttu-id="50e78-208">Vous pouvez également utiliser l’extension pour les jeux de mise à l’échelle de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="50e78-208">You can also use the extension for Virtual machine scale sets.</span></span>
>
>

## <a name="azure-diagnostics-direct-to-log-analytics"></a><span data-ttu-id="50e78-209">Diagnostics Azure directement dans Log Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-209">Azure diagnostics direct to Log Analytics</span></span>
<span data-ttu-id="50e78-210">De nombreuses ressources Azure sont en mesure d’écrire des journaux de diagnostic et métriques directement dans Log Analytics, et il s’agit du moyen recommandé de collecter les données à analyser.</span><span class="sxs-lookup"><span data-stu-id="50e78-210">Many Azure resources are able to write diagnostic logs and metrics directly to Log Analytics and this is the preferred way of collecting the data for analysis.</span></span> <span data-ttu-id="50e78-211">Lorsque vous utilisez les diagnostics Azure, les données sont écrites immédiatement dans Log Analytics, et il est inutile d’écrire les données dans le stockage avant.</span><span class="sxs-lookup"><span data-stu-id="50e78-211">When using Azure diagnostics, data is written immediately to Log Analytics and there is no need to first write the data to storage.</span></span>

<span data-ttu-id="50e78-212">Mes ressources Azure qui prennent en charge [Azure Monitor](../monitoring-and-diagnostics/monitoring-overview.md) peuvent envoyer leurs journaux et métriques directement vers Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="50e78-212">Azure resources that support [Azure monitor](../monitoring-and-diagnostics/monitoring-overview.md) can send their logs and metrics directly to Log Analytics.</span></span>

* <span data-ttu-id="50e78-213">Pour plus d’informations sur les métriques disponibles, voir [Mesures prises en charge avec Azure Monitor](../monitoring-and-diagnostics/monitoring-supported-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="50e78-213">For the details of the available metrics, refer to [supported metrics with Azure Monitor](../monitoring-and-diagnostics/monitoring-supported-metrics.md).</span></span>
* <span data-ttu-id="50e78-214">Pour plus d’informations sur les journaux disponibles, voir [Schéma et services pris en charge pour les journaux de diagnostic](../monitoring-and-diagnostics/monitoring-diagnostic-logs-schema.md).</span><span class="sxs-lookup"><span data-stu-id="50e78-214">For the details of the available logs, refer to [supported services and schema for diagnostic logs](../monitoring-and-diagnostics/monitoring-diagnostic-logs-schema.md).</span></span>

### <a name="enable-diagnostics-with-powershell"></a><span data-ttu-id="50e78-215">Activer les diagnostics avec PowerShell</span><span class="sxs-lookup"><span data-stu-id="50e78-215">Enable diagnostics with PowerShell</span></span>
<span data-ttu-id="50e78-216">Vous devez disposer de la version de novembre 2016 (v2.3.0) ou d’une version ultérieure d’[Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="50e78-216">You need the November 2016 (v2.3.0) or later release of [Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="50e78-217">L’exemple PowerShell suivant montre comment utiliser [Set-AzureRmDiagnosticSetting](/powershell/module/azurerm.insights/set-azurermdiagnosticsetting) pour activer les diagnostics sur un groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="50e78-217">The following PowerShell example shows how to use [Set-AzureRmDiagnosticSetting](/powershell/module/azurerm.insights/set-azurermdiagnosticsetting) to enable diagnostics on a network security group.</span></span> <span data-ttu-id="50e78-218">La même approche fonctionne pour toutes les ressources prises en charge : définissez `$resourceId` sur l’ID de la ressource pour laquelle vous souhaitez activer les diagnostics.</span><span class="sxs-lookup"><span data-stu-id="50e78-218">The same approach works for all supported resources - set `$resourceId` to the resource id of the resource you want to enable diagnostics for.</span></span>

```powershell
$workspaceId = "/subscriptions/d2e37fee-1234-40b2-5678-0b2199de3b50/resourcegroups/oi-default-east-us/providers/microsoft.operationalinsights/workspaces/rollingbaskets"

$resourceId = "/SUBSCRIPTIONS/ec11ca60-1234-491e-5678-0ea07feae25c/RESOURCEGROUPS/DEMO/PROVIDERS/MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/DEMO"

Set-AzureRmDiagnosticSetting -ResourceId $ResourceId  -WorkspaceId $workspaceId -Enabled $true
```

### <a name="enable-diagnostics-with-resource-manager-templates"></a><span data-ttu-id="50e78-219">Activer les diagnostics avec des modèles Resource Manager</span><span class="sxs-lookup"><span data-stu-id="50e78-219">Enable diagnostics with Resource Manager templates</span></span>

<span data-ttu-id="50e78-220">Pour activer les diagnostics sur une ressource lors de sa création, et envoyer les diagnostics vers votre espace de travail Log Analytics, vous pouvez utiliser un modèle semblable à celui ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="50e78-220">To enable diagnostics on a resource when it is created, and have the diagnostics sent to your Log Analytics workspace you can use a template similar to the one below.</span></span> <span data-ttu-id="50e78-221">Cet exemple est destiné à un compte Automation, mais fonctionne pour tous les types de ressources pris en charge.</span><span class="sxs-lookup"><span data-stu-id="50e78-221">This example is for an Automation account but works for all supported resource types.</span></span>

```json
        {
            "type": "Microsoft.Automation/automationAccounts/providers/diagnosticSettings",
            "name": "[concat(parameters('omsAutomationAccountName'), '/', 'Microsoft.Insights/service')]",
            "apiVersion": "2015-07-01",
            "dependsOn": [
                "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'))]"
            ],
            "properties": {
                "workspaceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('omsWorkspaceName'))]",
                "logs": [
                    {
                        "category": "JobLogs",
                        "enabled": true
                    },
                    {
                        "category": "JobStreams",
                        "enabled": true
                    }
                ]
            }
        }
```

[!INCLUDE [log-analytics-troubleshoot-azure-diagnostics](../../includes/log-analytics-troubleshoot-azure-diagnostics.md)]

## <a name="azure-diagnostics-to-storage-then-to-log-analytics"></a><span data-ttu-id="50e78-222">Diagnostics Azure vers stockage, puis vers Log Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-222">Azure diagnostics to storage then to Log Analytics</span></span>

<span data-ttu-id="50e78-223">Pour la collecte des journaux sur certaines ressources, il est possible d’envoyer les journaux vers le stockage Azure, puis de configurer Log Analytics pour lire les journaux depuis le stockage.</span><span class="sxs-lookup"><span data-stu-id="50e78-223">For collecting logs from within some resources, it is possible to send the logs to Azure storage and then configure Log Analytics to read the logs from storage.</span></span>

<span data-ttu-id="50e78-224">Log Analytics peut utiliser cette approche pour collecter des diagnostics à partir du stockage Azure pour les journaux et les ressources qui suivent :</span><span class="sxs-lookup"><span data-stu-id="50e78-224">Log Analytics can use this approach to collect diagnostics from Azure storage for the following resources and logs:</span></span>

| <span data-ttu-id="50e78-225">Ressource</span><span class="sxs-lookup"><span data-stu-id="50e78-225">Resource</span></span> | <span data-ttu-id="50e78-226">Journaux</span><span class="sxs-lookup"><span data-stu-id="50e78-226">Logs</span></span> |
| --- | --- |
| <span data-ttu-id="50e78-227">Service Fabric</span><span class="sxs-lookup"><span data-stu-id="50e78-227">Service Fabric</span></span> |<span data-ttu-id="50e78-228">ETWEvent</span><span class="sxs-lookup"><span data-stu-id="50e78-228">ETWEvent</span></span> <br> <span data-ttu-id="50e78-229">Événement opérationnel</span><span class="sxs-lookup"><span data-stu-id="50e78-229">Operational Event</span></span> <br> <span data-ttu-id="50e78-230">Événement Reliable Actor</span><span class="sxs-lookup"><span data-stu-id="50e78-230">Reliable Actor Event</span></span> <br> <span data-ttu-id="50e78-231">Événement de service fiable</span><span class="sxs-lookup"><span data-stu-id="50e78-231">Reliable Service Event</span></span> |
| <span data-ttu-id="50e78-232">Machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="50e78-232">Virtual Machines</span></span> |<span data-ttu-id="50e78-233">Syslog Linux</span><span class="sxs-lookup"><span data-stu-id="50e78-233">Linux Syslog</span></span> <br> <span data-ttu-id="50e78-234">Événement Windows</span><span class="sxs-lookup"><span data-stu-id="50e78-234">Windows Event</span></span> <br> <span data-ttu-id="50e78-235">Journal IIS</span><span class="sxs-lookup"><span data-stu-id="50e78-235">IIS Log</span></span> <br> <span data-ttu-id="50e78-236">ETWEvent Windows</span><span class="sxs-lookup"><span data-stu-id="50e78-236">Windows ETWEvent</span></span> |
| <span data-ttu-id="50e78-237">Rôles web</span><span class="sxs-lookup"><span data-stu-id="50e78-237">Web Roles</span></span> <br> <span data-ttu-id="50e78-238">Rôles de travail</span><span class="sxs-lookup"><span data-stu-id="50e78-238">Worker Roles</span></span> |<span data-ttu-id="50e78-239">Syslog Linux</span><span class="sxs-lookup"><span data-stu-id="50e78-239">Linux Syslog</span></span> <br> <span data-ttu-id="50e78-240">Événement Windows</span><span class="sxs-lookup"><span data-stu-id="50e78-240">Windows Event</span></span> <br> <span data-ttu-id="50e78-241">Journal IIS</span><span class="sxs-lookup"><span data-stu-id="50e78-241">IIS Log</span></span> <br> <span data-ttu-id="50e78-242">ETWEvent Windows</span><span class="sxs-lookup"><span data-stu-id="50e78-242">Windows ETWEvent</span></span> |

> [!NOTE]
> <span data-ttu-id="50e78-243">Vous êtes facturé aux tarifs de données Azure normaux pour le stockage et les transactions lorsque vous envoyez des diagnostics à un compte de stockage et lorsque Log Analytics lit les données de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="50e78-243">You are charged normal Azure data rates for storage and transactions when you send diagnostics to a storage account and for when Log Analytics reads the data from your storage account.</span></span>
>
>

<span data-ttu-id="50e78-244">Consultez la page [Utiliser un Stockage Blob pour IIS et un Stockage Table pour les événements](log-analytics-azure-storage-iis-table.md) pour en savoir plus sur la façon dont Log Analytics peut collecter ces journaux.</span><span class="sxs-lookup"><span data-stu-id="50e78-244">See [Use blob storage for IIS and table storage for events](log-analytics-azure-storage-iis-table.md) to learn more about how Log Analytics can collect these logs.</span></span>

## <a name="connectors-for-azure-services"></a><span data-ttu-id="50e78-245">Connecteurs pour les services Azure</span><span class="sxs-lookup"><span data-stu-id="50e78-245">Connectors for Azure services</span></span>

<span data-ttu-id="50e78-246">Il existe un connecteur pour Application Insights qui permet aux données collectées par Application Insights d’être envoyées vers Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="50e78-246">There is a connector for Application Insights, which allows data collected by Application Insights to be sent to Log Analytics.</span></span>

<span data-ttu-id="50e78-247">En savoir plus sur le [connecteur Application Insights](https://blogs.technet.microsoft.com/msoms/2016/09/26/application-insights-connector-in-oms/).</span><span class="sxs-lookup"><span data-stu-id="50e78-247">Learn more about the [Application Insights connector](https://blogs.technet.microsoft.com/msoms/2016/09/26/application-insights-connector-in-oms/).</span></span>

## <a name="scripts-to-collect-and-post-data-to-log-analytics"></a><span data-ttu-id="50e78-248">Scripts pour collecter et publier des données sur Log Analytics</span><span class="sxs-lookup"><span data-stu-id="50e78-248">Scripts to collect and post data to Log Analytics</span></span>

<span data-ttu-id="50e78-249">Pour les services Azure qui ne fournissent pas de moyen direct d’envoyer les journaux et métriques vers Log Analytics, vous pouvez utiliser un script Azure Automation pour les collecter.</span><span class="sxs-lookup"><span data-stu-id="50e78-249">For Azure services that do not provide a direct way to send logs and metrics to Log Analytics you can use an Azure Automation script to collect the log and metrics.</span></span> <span data-ttu-id="50e78-250">Le script peut alors envoyer les données vers Log Analytics à l’aide de [l’API de collecte de données](log-analytics-data-collector-api.md)</span><span class="sxs-lookup"><span data-stu-id="50e78-250">The script can then send the data to Log Analytics using the [data collector API](log-analytics-data-collector-api.md)</span></span>

<span data-ttu-id="50e78-251">La galerie de modèles Azure propose des [exemples d’utilisation d’Azure Automation](https://azure.microsoft.com/en-us/resources/templates/?term=OMS) pour collecter des données à partir des services et en les envoyer à Log Analytics.</span><span class="sxs-lookup"><span data-stu-id="50e78-251">The Azure template gallery has [examples of using Azure Automation](https://azure.microsoft.com/en-us/resources/templates/?term=OMS) to collect data from services and sending it to Log Analytics.</span></span>

## <a name="next-steps"></a><span data-ttu-id="50e78-252">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="50e78-252">Next steps</span></span>

* <span data-ttu-id="50e78-253">[Utiliser un Stockage Blob pour IIS et un Stockage Table pour les événements](log-analytics-azure-storage-iis-table.md) afin de lire les journaux pour les services Azure qui écrivent des diagnostics dans Stockage Table ou les journaux IIS écrits dans le Stockage Blob.</span><span class="sxs-lookup"><span data-stu-id="50e78-253">[Use blob storage for IIS and table storage for events](log-analytics-azure-storage-iis-table.md) to read the logs for Azure services that write diagnostics to table storage or IIS logs written to blob storage.</span></span>
* <span data-ttu-id="50e78-254">[Activer les solutions](log-analytics-add-solutions.md) pour fournir des informations sur les données.</span><span class="sxs-lookup"><span data-stu-id="50e78-254">[Enable Solutions](log-analytics-add-solutions.md) to provide insight into the data.</span></span>
* <span data-ttu-id="50e78-255">[Utiliser les requêtes de recherche](log-analytics-log-searches.md) pour analyser les données.</span><span class="sxs-lookup"><span data-stu-id="50e78-255">[Use search queries](log-analytics-log-searches.md) to analyze the data.</span></span>
