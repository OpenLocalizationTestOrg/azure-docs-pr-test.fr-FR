---
title: "aaaCreate plusieurs modèles à partir d’une expérience | Documents Microsoft"
description: "Utilisez PowerShell toocreate plusieurs modèles d’apprentissage et de points de terminaison de service avec hello web même algorithme, mais les jeux de données d’apprentissage différentes."
services: machine-learning
documentationcenter: 
author: hning86
manager: jhubbard
editor: cgronlun
ms.assetid: 1076b8eb-5a0d-4ac5-8601-8654d9be229f
ms.service: machine-learning
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/04/2017
ms.author: garye;haining
ms.openlocfilehash: 4a258a8ab26395d4169a058520151c860e16e169
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="create-many-machine-learning-models-and-web-service-endpoints-from-one-experiment-using-powershell"></a><span data-ttu-id="2d2f7-103">Créer de nombreux modèles Machine Learning et points de terminaison de service web à partir d’une expérience à l’aide de PowerShell</span><span class="sxs-lookup"><span data-stu-id="2d2f7-103">Create many Machine Learning models and web service endpoints from one experiment using PowerShell</span></span>
<span data-ttu-id="2d2f7-104">Voici un problème d’apprentissage machine courant : vous souhaitez toocreate nombreux modèles qui ont hello même flux de travail de formation et utilisez hello même algorithme, mais ont des datasets différents d’apprentissage comme entrée.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-104">Here's a common machine learning problem: You want toocreate many models that have hello same training workflow and use hello same algorithm, but have different training datasets as input.</span></span> <span data-ttu-id="2d2f7-105">Cet article vous montre comment toodo cela à grande échelle dans Azure Machine Learning Studio à l’aide de simplement une expérience unique.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-105">This article shows you how toodo this at scale in Azure Machine Learning Studio using just a single experiment.</span></span>

<span data-ttu-id="2d2f7-106">Supposez par exemple que vous avez une franchise de location de vélos à l’échelle internationale.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-106">For example, let's say you own a global bike rental franchise business.</span></span> <span data-ttu-id="2d2f7-107">Vous souhaitez toobuild une demande de location de régression modèle toopredict hello basée sur des données historiques.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-107">You want toobuild a regression model toopredict hello rental demand based on historic data.</span></span> <span data-ttu-id="2d2f7-108">Vous avez des 1 000 emplacements de location sur Bonjour et que vous avez collecté un dataset pour chaque emplacement qui inclut des fonctionnalités importantes telles que date, heure, la météo et le trafic qui sont spécifiques tooeach emplacement.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-108">You have 1,000 rental locations across hello world and you've collected a dataset for each location that includes important features such as date, time, weather, and traffic that are specific tooeach location.</span></span>

<span data-ttu-id="2d2f7-109">Vous pouvez former le modèle une fois à l’aide d’une version fusionnée de tous les jeux de données hello sur tous les sites.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-109">You could train your model once using a merged version of all hello datasets across all locations.</span></span> <span data-ttu-id="2d2f7-110">Mais étant donné que chacun de vos magasins a un environnement unique, une meilleure approche serait être tootrain votre modèle de régression séparément à l’aide d’un jeu de données hello pour chaque emplacement.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-110">But because each of your locations has a unique environment, a better approach would be tootrain your regression model separately using hello dataset for each location.</span></span> <span data-ttu-id="2d2f7-111">De cette façon, chaque modèle formé peut tenir tailles de compte hello autre magasin, volume, geography, remplissage, environnement de vélo convivial trafic, *etc.*.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-111">That way, each trained model could take into account hello different store sizes, volume, geography, population, bike-friendly traffic environment, *etc.*.</span></span>

<span data-ttu-id="2d2f7-112">Qui peut être la meilleure approche de hello, mais vous ne souhaitez pas expériences d’apprentissage toocreate 1 000 dans Azure Machine Learning avec chacun d’eux représentant un emplacement unique.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-112">That may be hello best approach, but you don't want toocreate 1,000 training experiments in Azure Machine Learning with each one representing a unique location.</span></span> <span data-ttu-id="2d2f7-113">En plus de constituer une tâche écrasante, il est également semble très inefficace, car chaque expérience tous aurait hello les mêmes composants à l’exception du jeu de données d’apprentissage hello.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-113">Besides being an overwhelming task, it's also seems pretty inefficient since each experiment would have all hello same components except for hello training dataset.</span></span>

<span data-ttu-id="2d2f7-114">Heureusement, nous pouvons faire en utilisant hello [réapprentissage des API Azure Machine Learning](machine-learning-retrain-models-programmatically.md) et automatisation tâche hello avec [Azure Machine Learning PowerShell](machine-learning-powershell-module.md).</span><span class="sxs-lookup"><span data-stu-id="2d2f7-114">Fortunately, we can accomplish this by using hello [Azure Machine Learning retraining API](machine-learning-retrain-models-programmatically.md) and automating hello task with [Azure Machine Learning PowerShell](machine-learning-powershell-module.md).</span></span>

> [!NOTE]
> <span data-ttu-id="2d2f7-115">toomake notre exemple de s’exécuter plus rapidement, nous allons réduire nombre hello des emplacements à partir de 1 000 too10.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-115">toomake our sample run faster, we'll reduce hello number of locations from 1,000 too10.</span></span> <span data-ttu-id="2d2f7-116">Mais hello mêmes principes et procédures s’appliquent too1, 000 emplacements.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-116">But hello same principles and procedures apply too1,000 locations.</span></span> <span data-ttu-id="2d2f7-117">Hello seule différence est que si vous souhaitez que tootrain de 1 000 groupes de données vous souhaitez probablement toothink de l’exécution de hello suivant des scripts PowerShell en parallèle.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-117">hello only difference is that if you want tootrain from 1,000 datasets you probably want toothink of running hello following PowerShell scripts in parallel.</span></span> <span data-ttu-id="2d2f7-118">Comment toodo n’est pas abordée de hello de cet article, mais vous pouvez rechercher des exemples de PowerShell multi-threading sur hello Internet.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-118">How toodo that is beyond hello scope of this article, but you can find examples of PowerShell multi-threading on hello Internet.</span></span>  
> 
> 

## <a name="set-up-hello-training-experiment"></a><span data-ttu-id="2d2f7-119">Configurer expérience de formation hello</span><span class="sxs-lookup"><span data-stu-id="2d2f7-119">Set up hello training experiment</span></span>
<span data-ttu-id="2d2f7-120">Nous allons toouse exemple [expérience de formation](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Training-Experiment-1) que nous avons déjà créé dans hello [Cortana Intelligence galerie](http://gallery.cortanaintelligence.com).</span><span class="sxs-lookup"><span data-stu-id="2d2f7-120">We're going toouse an example [training experiment](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Training-Experiment-1) that we've already created in hello [Cortana Intelligence Gallery](http://gallery.cortanaintelligence.com).</span></span> <span data-ttu-id="2d2f7-121">Ouvrez cette expérience dans votre espace de travail [Azure Machine Learning Studio](https://studio.azureml.net) .</span><span class="sxs-lookup"><span data-stu-id="2d2f7-121">Open this experiment in your [Azure Machine Learning Studio](https://studio.azureml.net) workspace.</span></span>

> [!NOTE]
> <span data-ttu-id="2d2f7-122">Dans l’ordre des toofollow avec cet exemple, vous voudrez toouse un espace de travail standard au lieu d’un espace de travail disponible.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-122">In order toofollow along with this example, you may want toouse a standard workspace rather than a free workspace.</span></span> <span data-ttu-id="2d2f7-123">Nous allons créer un point de terminaison pour chaque client - pour un total de points de 10 terminaison - et qui nécessite un espace de travail standard, car un espace de travail gratuit est limité too3 de points de terminaison.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-123">We'll be creating one endpoint for each customer - for a total of 10 endpoints - and that will require a standard workspace since a free workspace is limited too3 endpoints.</span></span> <span data-ttu-id="2d2f7-124">Si vous disposez d’un espace de travail disponible, il suffit de modifier scripts hello ci-dessous tooallow pour les emplacements uniquement 3.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-124">If you only have a free workspace, just modify hello scripts below tooallow for only 3 locations.</span></span>
> 
> 

<span data-ttu-id="2d2f7-125">expérience de Hello utilise un **importer des données** dataset d’apprentissage de module tooimport hello *customer001.csv* à partir d’un compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-125">hello experiment uses an **Import Data** module tooimport hello training dataset *customer001.csv* from an Azure storage account.</span></span> <span data-ttu-id="2d2f7-126">Supposons que nous avons collecté des jeux de données d’apprentissage à partir de tous les emplacements de location de vélo et stockés dans hello même blob emplacement de stockage avec des noms de fichiers allant *rentalloc001.csv* trop*rentalloc10.csv* .</span><span class="sxs-lookup"><span data-stu-id="2d2f7-126">Let's assume we have collected training datasets from all bike rental locations and stored them in hello same blob storage location with file names ranging from *rentalloc001.csv* too*rentalloc10.csv*.</span></span>

![image](./media/machine-learning-create-models-and-endpoints-with-powershell/reader-module.png)

<span data-ttu-id="2d2f7-128">Notez qu’un **sortie du Service Web** module a été ajouté toohello **Train Model** module.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-128">Note that a **Web Service Output** module has been added toohello **Train Model** module.</span></span>
<span data-ttu-id="2d2f7-129">Lorsque cette expérience est déployée comme un service web, point de terminaison hello associé à cette sortie retournera formé hello au format hello d’un fichier .ilearner.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-129">When this experiment is deployed as a web service, hello endpoint associated with that output will return hello trained model in hello format of a .ilearner file.</span></span>

<span data-ttu-id="2d2f7-130">Notez également que nous allons configurer un paramètre de service web hello URL que hello **importer des données** module utilise.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-130">Also note that we set up a web service parameter for hello URL that hello **Import Data** module uses.</span></span> <span data-ttu-id="2d2f7-131">Cela nous permet toouse hello paramètre toospecify des jeux de données tootrain hello modèle d’apprentissage pour chaque emplacement.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-131">This allows us toouse hello parameter toospecify individual training datasets tootrain hello model for each location.</span></span>
<span data-ttu-id="2d2f7-132">Nous avons effectuées, par exemple à l’aide d’une requête SQL avec un web service paramètre tooget des données à partir d’une base de données SQL Azure, ou simplement à l’aide d’autres manières une **entrée du Service Web** toopass du module dans un toohello de jeu de données de service web.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-132">There are other ways we could have done this, such as using a SQL query with a web service parameter tooget data from a SQL Azure database, or simply using a  **Web Service Input** module toopass in a dataset toohello web service.</span></span>

![image](./media/machine-learning-create-models-and-endpoints-with-powershell/web-service-output.png)

<span data-ttu-id="2d2f7-134">Maintenant, nous allons exécuter cette expérience d’apprentissage à l’aide de la valeur par défaut de hello *rental001.csv* comme hello dataset d’apprentissage.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-134">Now, let's run this training experiment using hello default value *rental001.csv* as hello training dataset.</span></span> <span data-ttu-id="2d2f7-135">Si vous affichez la sortie de hello Hello **évaluer** module (cliquez sur la sortie de hello et sélectionnez **visualiser**), vous constatez que nous obtenons une performance acceptable de *AUC* = 0.91.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-135">If you view hello output of hello **Evaluate** module (click hello output and select **Visualize**), you can see we get a decent performance of *AUC* = 0.91.</span></span> <span data-ttu-id="2d2f7-136">À ce stade, nous sommes prêt toodeploy un service web en dehors de cette expérience d’apprentissage.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-136">At this point, we're ready toodeploy a web service out of this training experiment.</span></span>

## <a name="deploy-hello-training-and-scoring-web-services"></a><span data-ttu-id="2d2f7-137">Déployer la formation de hello et le score des services web</span><span class="sxs-lookup"><span data-stu-id="2d2f7-137">Deploy hello training and scoring web services</span></span>
<span data-ttu-id="2d2f7-138">toodeploy hello formation du service web, cliquez sur hello **configurer le Service Web** bouton ci-dessous canevas de l’expérience hello **déployer le Service Web**.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-138">toodeploy hello training web service, click hello **Set Up Web Service** button below hello experiment canvas and select **Deploy Web Service**.</span></span> <span data-ttu-id="2d2f7-139">Nommez ce service web « Bike Rental Training ».</span><span class="sxs-lookup"><span data-stu-id="2d2f7-139">Call this web service ""Bike Rental Training".</span></span>

<span data-ttu-id="2d2f7-140">Nous devons maintenant service web score de toodeploy hello.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-140">Now we need toodeploy hello scoring web service.</span></span>
<span data-ttu-id="2d2f7-141">toodo, nous pouvons cliquer sur **configurer le Service Web** ci-dessous hello canevas et sélectionnez **prédictive Service Web**.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-141">toodo this, we can click **Set Up Web Service** below hello canvas and select **Predictive Web Service**.</span></span> <span data-ttu-id="2d2f7-142">Une expérience de notation est créée.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-142">This creates a scoring experiment.</span></span>
<span data-ttu-id="2d2f7-143">Nous devrons toomake quelques légères toomake, il fonctionne comme un service web, telles que Supprimer colonne d’étiquette hello « cnt » hello, données d’entrée et de limiter les id d’instance hello sortie tooonly hello et hello correspondant a prédit valeur.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-143">We'll need toomake a few minor adjustments toomake it work as a web service, such as removing hello label column "cnt" from hello input data and limiting hello output tooonly hello instance id and hello corresponding predicted value.</span></span>

<span data-ttu-id="2d2f7-144">toosave vous-même qui fonctionnent, vous pouvez ouvrir simplement hello [expérience prédictive](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Predicative-Experiment-1) Bonjour galerie qui est déjà été préparée.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-144">toosave yourself that work, you can simply open hello [predictive experiment](https://gallery.cortanaintelligence.com/Experiment/Bike-Rental-Predicative-Experiment-1) in hello Gallery that's already been prepared.</span></span>

<span data-ttu-id="2d2f7-145">le service web toodeploy hello, exécutez l’expérience prédictive hello, puis cliquez sur hello **déployer le Service Web** situé sous la zone de dessin hello.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-145">toodeploy hello web service, run hello predictive experiment, then click hello **Deploy Web Service** button below hello canvas.</span></span> <span data-ttu-id="2d2f7-146">Hello nom du calcul du score du service web « Bike location de calcul de score » ».</span><span class="sxs-lookup"><span data-stu-id="2d2f7-146">Name hello scoring web service "Bike Rental Scoring"".</span></span>

## <a name="create-10-identical-web-service-endpoints-with-powershell"></a><span data-ttu-id="2d2f7-147">Créer 10 points de terminaison de service web identiques avec PowerShell</span><span class="sxs-lookup"><span data-stu-id="2d2f7-147">Create 10 identical web service endpoints with PowerShell</span></span>
<span data-ttu-id="2d2f7-148">Ce service web est fourni avec un point de terminaison par défaut.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-148">This web service comes with a default endpoint.</span></span> <span data-ttu-id="2d2f7-149">Mais nous n'intéresse pas comme point de terminaison par défaut hello, car il ne peut pas être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-149">But we're not as interested in hello default endpoint since it can't be updated.</span></span> <span data-ttu-id="2d2f7-150">Ce que nous devons toodo est toocreate 10 points de terminaison supplémentaires, une pour chaque emplacement.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-150">What we need toodo is toocreate 10 additional endpoints, one for each location.</span></span> <span data-ttu-id="2d2f7-151">Nous allons pour cela utiliser PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-151">We'll do this with PowerShell.</span></span>

<span data-ttu-id="2d2f7-152">Tout d’abord, nous allons configurer notre environnement PowerShell :</span><span class="sxs-lookup"><span data-stu-id="2d2f7-152">First, we set up our PowerShell environment:</span></span>

    Import-Module .\AzureMLPS.dll
    # Assume hello default configuration file exists and is properly set toopoint toohello valid Workspace.
    $scoringSvc = Get-AmlWebService | where Name -eq 'Bike Rental Scoring'
    $trainingSvc = Get-AmlWebService | where Name -eq 'Bike Rental Training'

<span data-ttu-id="2d2f7-153">Ensuite, exécutez hello suivant de commande PowerShell :</span><span class="sxs-lookup"><span data-stu-id="2d2f7-153">Then, run hello following PowerShell command:</span></span>

    # Create 10 endpoints on hello scoring web service.
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        Write-Host ('adding endpoint ' + $endpointName + '...')
        Add-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -Description $endpointName     
    }

<span data-ttu-id="2d2f7-154">Maintenant, nous avons créé 10 points de terminaison et tous les contiennent hello même modèle formé formé sur *customer001.csv*.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-154">Now we've created 10 endpoints and they all contain hello same trained model trained on *customer001.csv*.</span></span> <span data-ttu-id="2d2f7-155">Vous pouvez les afficher dans le portail de gestion de hello.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-155">You can view them in hello Azure Management Portal.</span></span>

![image](./media/machine-learning-create-models-and-endpoints-with-powershell/created-endpoints.png)

## <a name="update-hello-endpoints-toouse-separate-training-datasets-using-powershell"></a><span data-ttu-id="2d2f7-157">Mettre à jour hello points de terminaison toouse formation distincte des groupes de données à l’aide de PowerShell</span><span class="sxs-lookup"><span data-stu-id="2d2f7-157">Update hello endpoints toouse separate training datasets using PowerShell</span></span>
<span data-ttu-id="2d2f7-158">étape suivante de Hello est points de terminaison tooupdate hello avec des modèles de façon unique formés sur les données individuelles de chaque client.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-158">hello next step is tooupdate hello endpoints with models uniquely trained on each customer's individual data.</span></span> <span data-ttu-id="2d2f7-159">Mais tout d’abord nous devons tooproduce ces modèles à partir de hello **Bike location formation** service web.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-159">But first we need tooproduce these models from hello **Bike Rental Training** web service.</span></span> <span data-ttu-id="2d2f7-160">Passons arrière toohello **Bike location formation** service web.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-160">Let's go back toohello **Bike Rental Training** web service.</span></span> <span data-ttu-id="2d2f7-161">Nous avons besoin de son point de terminaison BES 10 fois avec 10 formation différents jeux de données dans les différents modèles de commande tooproduce 10 toocall.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-161">We need toocall its BES endpoint 10 times with 10 different training datasets in order tooproduce 10 different models.</span></span> <span data-ttu-id="2d2f7-162">Nous allons utiliser hello **InovkeAmlWebServiceBESEndpoint** toodo d’applet de commande PowerShell cela.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-162">We'll use hello **InovkeAmlWebServiceBESEndpoint** PowerShell cmdlet toodo this.</span></span>

<span data-ttu-id="2d2f7-163">Vous aurez également besoin des informations d’identification tooprovide pour votre compte de stockage d’objets blob dans `$configContent`, à savoir, les champs hello `AccountName`, `AccountKey` et `RelativeLocation`.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-163">You will also need tooprovide credentials for your blob storage account into `$configContent`, namely, at hello fields `AccountName`, `AccountKey` and `RelativeLocation`.</span></span> <span data-ttu-id="2d2f7-164">Hello `AccountName` peut prendre l’une de vos noms de compte, comme dans hello **portail de gestion classique Azure** (*stockage* onglet).</span><span class="sxs-lookup"><span data-stu-id="2d2f7-164">hello `AccountName` can be one of your account names, as seen in hello **Classic Azure Management Portal** (*Storage* tab).</span></span> <span data-ttu-id="2d2f7-165">Une fois que vous cliquez sur un compte de stockage, ses `AccountKey` sont accessibles en appuyant sur les hello **gérer les clés d’accès** bouton en bas de hello et copie hello *clé d’accès primaire*.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-165">Once you click on a storage account, its `AccountKey` can be found by pressing hello **Manage Access Keys** button at hello bottom and copying hello *Primary Access Key*.</span></span> <span data-ttu-id="2d2f7-166">Hello `RelativeLocation` est stockage de hello chemin d’accès relatif tooyour où un nouveau modèle sera stocké.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-166">hello `RelativeLocation` is hello path relative tooyour storage where a new model will be stored.</span></span> <span data-ttu-id="2d2f7-167">Par exemple, chemin d’accès de hello `hai/retrain/bike_rental/` dans le script hello sous le conteneur de tooa points nommé `hai`, et `/retrain/bike_rental/` des sous-dossiers.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-167">For instance, hello path `hai/retrain/bike_rental/` in hello script below points tooa container named `hai`, and `/retrain/bike_rental/` are subfolders.</span></span> <span data-ttu-id="2d2f7-168">Actuellement, vous ne pouvez pas créer des sous-dossiers via l’interface utilisateur du portail hello, mais il n’y [plusieurs explorateurs de stockage Azure](../storage/common/storage-explorers.md) qui permettent de toodo donc.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-168">Currently, you cannot create subfolders through hello portal UI, but there are [several Azure Storage Explorers](../storage/common/storage-explorers.md) that allow you toodo so.</span></span> <span data-ttu-id="2d2f7-169">Il est recommandé de créer un nouveau conteneur dans votre hello toostore de stockage nouveaux modèles formés (fichiers .ilearner) comme suit : à partir de votre page de stockage, cliquez sur hello **ajouter** bouton bas hello et nommez-le `retrain`.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-169">It is recommended that you create a new container in your storage toostore hello new trained models (.ilearner files) as follows: from your storage page, click on hello **Add** button at hello bottom and name it `retrain`.</span></span> <span data-ttu-id="2d2f7-170">En résumé, hello modifications nécessaires toohello le script ci-dessous se rapportent trop`AccountName`, `AccountKey` et `RelativeLocation` ( :`"retrain/model' + $seq + '.ilearner"`).</span><span class="sxs-lookup"><span data-stu-id="2d2f7-170">In summary, hello necassary changes toohello script below pertain too`AccountName`, `AccountKey` and `RelativeLocation` (:`"retrain/model' + $seq + '.ilearner"`).</span></span>

    # Invoke hello retraining API 10 times
    # This is hello default (and hello only) endpoint on hello training web service
    $trainingSvcEp = (Get-AmlWebServiceEndpoint -WebServiceId $trainingSvc.Id)[0];
    $submitJobRequestUrl = $trainingSvcEp.ApiLocation + '/jobs?api-version=2.0';
    $apiKey = $trainingSvcEp.PrimaryKey;
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $inputFileName = 'https://bostonmtc.blob.core.windows.net/hai/retrain/bike_rental/BikeRental' + $seq + '.csv';
        $configContent = '{ "GlobalParameters": { "URI": "' + $inputFileName + '" }, "Outputs": { "output1": { "ConnectionString": "DefaultEndpointsProtocol=https;AccountName=<myaccount>;AccountKey=<mykey>", "RelativeLocation": "hai/retrain/bike_rental/model' + $seq + '.ilearner" } } }';
        Write-Host ('training regression model on ' + $inputFileName + ' for rental location ' + $seq + '...');
        Invoke-AmlWebServiceBESEndpoint -JobConfigString $configContent -SubmitJobRequestUrl $submitJobRequestUrl -ApiKey $apiKey
    }

> [!NOTE]
> <span data-ttu-id="2d2f7-171">point de terminaison BES de Hello est hello pris en charge uniquement en mode pour cette opération.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-171">hello BES endpoint is hello only supported mode for this operation.</span></span> <span data-ttu-id="2d2f7-172">Vous ne pouvez pas utiliser RRE pour générer des modèles formés.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-172">RRS cannot be used for producing trained models.</span></span>
> 
> 

<span data-ttu-id="2d2f7-173">Comme vous pouvez le voir ci-dessus, au lieu de construire des 10 différents BES travail json fichiers de configuration, nous créer à la place de chaîne de configuration hello dynamiquement et toohello de flux *jobConfigString* paramètre Hello  **InvokeAmlWebServceBESEndpoint** applet de commande, car il n’existe réellement aucune tookeep besoin une copie sur le disque.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-173">As you can see above, instead of constructing 10 different BES job configuration json files, we dynamically create hello config string instead and feed it toohello *jobConfigString* parameter of hello **InvokeAmlWebServceBESEndpoint** cmdlet, since there is really no need tookeep a copy on disk.</span></span>

<span data-ttu-id="2d2f7-174">Si tout se passe bien, après un certain temps vous devez voir 10 fichiers .ilearner, à partir de *model001.ilearner* trop*model010.ilearner*, dans votre compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-174">If everything goes well, after a while you should see 10 .ilearner files, from *model001.ilearner* too*model010.ilearner*, in your Azure storage account.</span></span> <span data-ttu-id="2d2f7-175">Maintenant, nous sommes prêt tooupdate notre 10 score web des points de terminaison avec ces modèles à l’aide de hello **AmlWebServiceEndpoint-correctif** applet de commande PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-175">Now we're ready tooupdate our 10 scoring web service endpoints with these models using hello **Patch-AmlWebServiceEndpoint** PowerShell cmdlet.</span></span> <span data-ttu-id="2d2f7-176">N’oubliez pas à nouveau que nous pouvons correctif uniquement les points de terminaison par défaut hello que nous avons créé par programme.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-176">Remember again that we can only patch hello non-default endpoints we programmatically created earlier.</span></span>

    # Patch hello 10 endpoints with respective .ilearner models
    $baseLoc = 'http://bostonmtc.blob.core.windows.net/'
    $sasToken = '<my_blob_sas_token>'
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        $relativeLoc = 'hai/retrain/bike_rental/model' + $seq + '.ilearner';
        Write-Host ('Patching endpoint ' + $endpointName + '...');
        Patch-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -ResourceName 'Bike Rental [trained model]' -BaseLocation $baseLoc -RelativeLocation $relativeLoc -SasBlobToken $sasToken
    }

<span data-ttu-id="2d2f7-177">L’exécution devrait être assez rapide.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-177">This should run fairly quickly.</span></span> <span data-ttu-id="2d2f7-178">Une fois l’exécution de hello, nous allons ont été créés 10 points de terminaison de web prédictif service, chacune contenant un modèle formé identifie de façon unique une formation sur hello dataset tooa spécifique de location, à partir d’une expérience de formation unique.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-178">When hello execution finishes, we'll have successfully created 10 predictive web service endpoints, each containing a trained model uniquely trained on hello dataset specific tooa rental location, all from a single training experiment.</span></span> <span data-ttu-id="2d2f7-179">tooverify, vous pouvez essayer d’appeler ces points de terminaison à l’aide de hello **InvokeAmlWebServiceRRSEndpoint** applet de commande, en fournissant les avec hello même les données d’entrée, et vous devez vous attendre les résultats de prédiction différents de toosee étant donné que les modèles de hello sont formé avec les jeux d’apprentissage différentes.</span><span class="sxs-lookup"><span data-stu-id="2d2f7-179">tooverify this, you can try calling these endpoints using hello **InvokeAmlWebServiceRRSEndpoint** cmdlet, providing them with hello same input data, and you should expect toosee different prediction results since hello models are trained with different training sets.</span></span>

## <a name="full-powershell-script"></a><span data-ttu-id="2d2f7-180">Script PowerShell complet</span><span class="sxs-lookup"><span data-stu-id="2d2f7-180">Full PowerShell script</span></span>
<span data-ttu-id="2d2f7-181">Voici la liste de code source complet de hello hello :</span><span class="sxs-lookup"><span data-stu-id="2d2f7-181">Here's hello listing of hello full source code:</span></span>

    Import-Module .\AzureMLPS.dll
    # Assume hello default configuration file exists and properly set toopoint toohello valid workspace.
    $scoringSvc = Get-AmlWebService | where Name -eq 'Bike Rental Scoring'
    $trainingSvc = Get-AmlWebService | where Name -eq 'Bike Rental Training'

    # Create 10 endpoints on hello scoring web service
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        Write-Host ('adding endpoint ' + $endpontName + '...')
        Add-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -Description $endpointName     
    }

    # Invoke hello retraining API 10 times tooproduce 10 regression models in .ilearner format
    $trainingSvcEp = (Get-AmlWebServiceEndpoint -WebServiceId $trainingSvc.Id)[0];
    $submitJobRequestUrl = $trainingSvcEp.ApiLocation + '/jobs?api-version=2.0';
    $apiKey = $trainingSvcEp.PrimaryKey;
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $inputFileName = 'https://bostonmtc.blob.core.windows.net/hai/retrain/bike_rental/BikeRental' + $seq + '.csv';
        $configContent = '{ "GlobalParameters": { "URI": "' + $inputFileName + '" }, "Outputs": { "output1": { "ConnectionString": "DefaultEndpointsProtocol=https;AccountName=<myaccount>;AccountKey=<mykey>", "RelativeLocation": "hai/retrain/bike_rental/model' + $seq + '.ilearner" } } }';
        Write-Host ('training regression model on ' + $inputFileName + ' for rental location ' + $seq + '...');
        Invoke-AmlWebServiceBESEndpoint -JobConfigString $configContent -SubmitJobRequestUrl $submitJobRequestUrl -ApiKey $apiKey
    }

    # Patch hello 10 endpoints with respective .ilearner models
    $baseLoc = 'http://bostonmtc.blob.core.windows.net/'
    $sasToken = '?test'
    For ($i = 1; $i -le 10; $i++){
        $seq = $i.ToString().PadLeft(3, '0');
        $endpointName = 'rentalloc' + $seq;
        $relativeLoc = 'hai/retrain/bike_rental/model' + $seq + '.ilearner';
        Write-Host ('Patching endpoint ' + $endpointName + '...');
        Patch-AmlWebServiceEndpoint -WebServiceId $scoringSvc.Id -EndpointName $endpointName -ResourceName 'Bike Rental [trained model]' -BaseLocation $baseLoc -RelativeLocation $relativeLoc -SasBlobToken $sasToken
    }
