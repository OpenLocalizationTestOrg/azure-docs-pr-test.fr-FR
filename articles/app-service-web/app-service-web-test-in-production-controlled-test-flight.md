---
title: "déploiement aaaFlighting (bêta) dans Azure App Service"
description: "Découvrez comment tooflight de nouvelles fonctionnalités dans votre application ou une version bêta tester vos mises à jour dans ce didacticiel de bout en bout. Il réunit les fonctionnalités App Service comme la publication continue, les emplacements, le routage du trafic et l’intégration d’Application Insights."
services: app-service\web
documentationcenter: 
author: cephalin
manager: erikre
editor: 
ms.assetid: 17953c51-38f8-442d-bb0b-f69c1542f0e9
ms.service: app-service-web
ms.workload: web
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/02/2016
ms.author: cephalin
ms.openlocfilehash: e83477b1fe46be09e5baa7bc2bd239b840b05cf7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="flighting-deployment-beta-testing-in-azure-app-service"></a><span data-ttu-id="b2d0e-104">Déploiement avec distribution d’une version d’évaluation (test bêta) dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b2d0e-104">Flighting deployment (beta testing) in Azure App Service</span></span>
<span data-ttu-id="b2d0e-105">Ce didacticiel vous montre comment toodo *version d’évaluation des déploiements* en intégrant hello différentes fonctionnalités de [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) et [Azure Application Insights](/services/application-insights/).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-105">This tutorial shows you how toodo *flighting deployments* by integrating hello various capabilities of [Azure App Service](http://go.microsoft.com/fwlink/?LinkId=529714) and [Azure Application Insights](/services/application-insights/).</span></span>

<span data-ttu-id="b2d0e-106">La *distribution d’une version d’évaluation* est un processus de déploiement qui valide une nouvelle fonctionnalité ou une modification auprès d’un nombre limité de clients réels. Il s’agit d’un test majeur dans un scénario de production.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-106">*Flighting* is a deployment process that validates a new feature or change with a limited number of real customers, and is a major testing in production scenario.</span></span> <span data-ttu-id="b2d0e-107">Il s’agit d’analogues toobeta test et est parfois appelée « test contrôlé vol ».</span><span class="sxs-lookup"><span data-stu-id="b2d0e-107">It is akin toobeta testing and is sometimes known as "controlled test flight".</span></span> <span data-ttu-id="b2d0e-108">Beaucoup de grandes entreprises avec une présence web utilisent cette approche pour obtenir les premières validations de leurs mises à jour d’application dans leur pratique de [développement agile](https://en.wikipedia.org/wiki/Agile_software_development).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-108">Many large enterprises with a web presence use this approach to get early validation on their app updates in their practice of [agile development](https://en.wikipedia.org/wiki/Agile_software_development).</span></span> <span data-ttu-id="b2d0e-109">Azure App Service vous permet de test toointegrate en production avec la publication continue et Application Insights tooimplement hello même scénario DevOps.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-109">Azure App Service enables you toointegrate test in production with continous publishing and Application Insights tooimplement hello same DevOps scenario.</span></span> <span data-ttu-id="b2d0e-110">Avantages de cette approche :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-110">Benefits of this approach include:</span></span>

* <span data-ttu-id="b2d0e-111">**Obtenir des commentaires réel *avant* mises à jour sont publiée tooproduction** -hello uniquement mieux obtenir des commentaires dès que vous relâchez gagne commentaires avant de libérer.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-111">**Gain real feedback *before* updates are released tooproduction** - hello only thing better than gaining feedback as soon as you release is gaining feedback before you release.</span></span> <span data-ttu-id="b2d0e-112">Vous pouvez tester les mises à jour avec le trafic des utilisateurs réels et les comportements dès que vous le souhaitez dans le cycle de vie du produit hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-112">You can test updates with real user traffic and behaviors as early as you desire in hello product life cycle.</span></span>
* <span data-ttu-id="b2d0e-113">**Améliorer [ le développement continu piloté par les tests](https://en.wikipedia.org/wiki/Continuous_test-driven_development)** : en intégrant des tests en production avec une intégration et une instrumentation continues dans Application Insights, la validation utilisateur se produit automatiquement et très tôt dans le cycle de vie du produit.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-113">**Enhance [continuous test-driven development (CTDD)](https://en.wikipedia.org/wiki/Continuous_test-driven_development)** - By integrating test in production with continuous integration and instrumentation with Application Insights, user validation happens early and automatically in your product life cycle.</span></span> <span data-ttu-id="b2d0e-114">Cela contribue à réduire les investissements en temps dans l’exécution de tests manuels.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-114">This helps reduce time investments in manual test execution.</span></span>
* <span data-ttu-id="b2d0e-115">**Optimiser le flux de travail test** -grâce à l’automatisation de test en production avec l’instrumentation de surveillance continue, vous pouvez éventuellement atteindre les objectifs de hello différents types de tests dans un processus unique, tel que [intégration](https://en.wikipedia.org/wiki/Integration_testing), [régression](https://en.wikipedia.org/wiki/Regression_testing), [facilité d’utilisation](https://en.wikipedia.org/wiki/Usability_testing), accessibilité, la localisation, [performances](https://en.wikipedia.org/wiki/Software_performance_testing), [sécurité](https://en.wikipedia.org/wiki/Security_testing), et [ acceptation](https://en.wikipedia.org/wiki/Acceptance_testing).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-115">**Optimize test workflow** - By automating test in production with continuous monitoring instrumentation, you can potentially accomplish hello goals of various kinds of tests in a single process, such as [integration](https://en.wikipedia.org/wiki/Integration_testing), [regression](https://en.wikipedia.org/wiki/Regression_testing), [usability](https://en.wikipedia.org/wiki/Usability_testing), accessibility, localization, [performance](https://en.wikipedia.org/wiki/Software_performance_testing), [security](https://en.wikipedia.org/wiki/Security_testing), and [acceptance](https://en.wikipedia.org/wiki/Acceptance_testing).</span></span>

<span data-ttu-id="b2d0e-116">Un déploiement avec distribution d’une version d’évaluation ne se limite pas au routage du trafic en direct.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-116">A flighting deployment is not just about routing live traffic.</span></span> <span data-ttu-id="b2d0e-117">Dans un tel déploiement souhaitées toogain insight aussi rapidement que possible, qu’il s’agisse d’un bogue inattendu, une dégradation des performances, les problèmes d’expérience utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-117">In such a deployment you want toogain insight as quickly as possible, whether it be an unexpected bug, performance degradation, user experience issues.</span></span> <span data-ttu-id="b2d0e-118">N’oubliez pas : vous êtes confronté à des clients réels.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-118">Remember, you are dealing with real customers.</span></span> <span data-ttu-id="b2d0e-119">C’est le cas toodo il à droite, vous devez vous assurer que vous avez configuré votre version d’évaluation toogather de déploiement toutes les données hello vous devez pouvoir toomake une décision informée pour l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-119">So toodo it right, you must make sure that you have set up your flighting deployment toogather all hello data you need in order toomake an informed decision for your next step.</span></span> <span data-ttu-id="b2d0e-120">Ce didacticiel vous montre comment les données toocollect avec Application Insights, mais vous peuvent utiliser New Relic ou autres technologies qui correspond le mieux à votre scénario.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-120">This tutorial shows you how toocollect data with Application Insights, but you can use New Relic or other technologies that suits your scenario.</span></span>

## <a name="what-you-will-do"></a><span data-ttu-id="b2d0e-121">Procédure à suivre</span><span class="sxs-lookup"><span data-stu-id="b2d0e-121">What you will do</span></span>
<span data-ttu-id="b2d0e-122">Dans ce didacticiel, vous allez apprendre comment toobring hello suivant tootest ensemble de scénarios de votre application de Service de l’application en production :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-122">In this tutorial, you will learn how toobring hello following scenarios together tootest your App Service app in production:</span></span>

* <span data-ttu-id="b2d0e-123">[Acheminer le trafic de production](app-service-web-test-in-production-get-start.md) tooyour bêta application</span><span class="sxs-lookup"><span data-stu-id="b2d0e-123">[Route production traffic](app-service-web-test-in-production-get-start.md) tooyour beta app</span></span>
* <span data-ttu-id="b2d0e-124">[Instrumenter votre application](../application-insights/app-insights-web-track-usage.md) tooobtain des mesures utiles</span><span class="sxs-lookup"><span data-stu-id="b2d0e-124">[Instrument your app](../application-insights/app-insights-web-track-usage.md) tooobtain useful metrics</span></span>
* <span data-ttu-id="b2d0e-125">Déployer votre application bêta et suivre les mesures de l’application en direct en continu</span><span class="sxs-lookup"><span data-stu-id="b2d0e-125">Continuously deploy your beta app and track live app metrics</span></span>
* <span data-ttu-id="b2d0e-126">Métriques de comparaison entre application de production hello et hello bêta application toosee comment le code change traduire tooresults</span><span class="sxs-lookup"><span data-stu-id="b2d0e-126">Compare metrics between hello production app and hello beta app toosee how code changes translate tooresults</span></span>

## <a name="what-you-will-need"></a><span data-ttu-id="b2d0e-127">Éléments requis</span><span class="sxs-lookup"><span data-stu-id="b2d0e-127">What you will need</span></span>
* <span data-ttu-id="b2d0e-128">Un compte Azure</span><span class="sxs-lookup"><span data-stu-id="b2d0e-128">An Azure account</span></span>
* <span data-ttu-id="b2d0e-129">Un compte [GitHub](https://github.com/)</span><span class="sxs-lookup"><span data-stu-id="b2d0e-129">A [GitHub](https://github.com/) account</span></span>
* <span data-ttu-id="b2d0e-130">Vous pouvez télécharger Visual Studio 2015 - hello [Community edition](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-130">Visual Studio 2015 - you can download hello [Community edition](https://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx).</span></span>
* <span data-ttu-id="b2d0e-131">Interpréteur de commandes GIT (installé avec [GitHub pour Windows](https://windows.github.com/))-ainsi, vous toorun les deux commandes hello Git et PowerShell Bonjour même session</span><span class="sxs-lookup"><span data-stu-id="b2d0e-131">Git Shell (installed with [GitHub for Windows](https://windows.github.com/)) - this enables you toorun both hello Git and PowerShell commands in hello same session</span></span>
* <span data-ttu-id="b2d0e-132">Dernières informations [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi)</span><span class="sxs-lookup"><span data-stu-id="b2d0e-132">Latest [Azure PowerShell](https://github.com/Azure/azure-powershell/releases/download/v0.9.8-September2015/azure-powershell.0.9.8.msi) bits</span></span>
* <span data-ttu-id="b2d0e-133">Présentation de la base des éléments suivants de hello :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-133">Basic understanding of hello following:</span></span>
  * <span data-ttu-id="b2d0e-134">Déploiement de modèles [Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) (voir [Déployer une application complexe de manière prévisible dans Microsoft Azure](app-service-deploy-complex-application-predictably.md))</span><span class="sxs-lookup"><span data-stu-id="b2d0e-134">[Azure Resource Manager](../azure-resource-manager/resource-group-overview.md) template deployment (see [Deploy a complex application predictably in Azure](app-service-deploy-complex-application-predictably.md))</span></span>
  * [<span data-ttu-id="b2d0e-135">Git</span><span class="sxs-lookup"><span data-stu-id="b2d0e-135">Git</span></span>](http://git-scm.com/documentation)
  * [<span data-ttu-id="b2d0e-136">PowerShell</span><span class="sxs-lookup"><span data-stu-id="b2d0e-136">PowerShell</span></span>](https://technet.microsoft.com/library/bb978526.aspx)

> [!NOTE]
> <span data-ttu-id="b2d0e-137">Vous avez besoin une toocomplete compte Azure ce didacticiel :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-137">You need an Azure account toocomplete this tutorial:</span></span>
>
> * <span data-ttu-id="b2d0e-138">Vous pouvez [ouvrir un compte Azure gratuitement](https://azure.microsoft.com/pricing/free-trial/) -vous obtenez des crédits vous pouvez utiliser tootry à payer des services Azure et même après leur utilisation vous pouvez conserver le compte de hello et libérer de l’utilisation des services Azure, telles que les applications Web.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-138">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/) - You get credits you can use tootry out paid Azure services, and even after they're used up you can keep hello account and use free Azure services, such as Web Apps.</span></span>
> * <span data-ttu-id="b2d0e-139">Vous pouvez [activer les avantages de votre abonnement Visual Studio](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) : votre abonnement Visual Studio vous donne droit chaque mois à des crédits dont vous pouvez vous servir pour les services Azure payants.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-139">You can [activate Visual Studio subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) - Your Visual Studio subscription gives you credits every month that you can use for paid Azure services.</span></span>
>
> <span data-ttu-id="b2d0e-140">Si vous souhaitez tooget démarré avec le Service d’application Azure avant de s’inscrire pour un compte Azure, accédez trop[essayez du Service d’applications](https://azure.microsoft.com/try/app-service/), où vous pouvez créer une application web de courte durée de démarrage immédiatement dans le Service d’applications.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-140">If you want tooget started with Azure App Service before signing up for an Azure account, go too[Try App Service](https://azure.microsoft.com/try/app-service/), where you can immediately create a short-lived starter web app in App Service.</span></span> <span data-ttu-id="b2d0e-141">Aucune carte de crédit n’est requise ; vous ne prenez aucun engagement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-141">No credit cards required; no commitments.</span></span>
>
>

## <a name="set-up-your-production-web-app"></a><span data-ttu-id="b2d0e-142">Configurer votre application web de production</span><span class="sxs-lookup"><span data-stu-id="b2d0e-142">Set up your production web app</span></span>
> [!NOTE]
> <span data-ttu-id="b2d0e-143">script Hello utilisé dans ce didacticiel configure automatiquement la publication continue à partir de votre référentiel GitHub.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-143">hello script used in this tutorial will automatically configure continuous publishing from your GitHub repository.</span></span> <span data-ttu-id="b2d0e-144">Cela nécessite que vos informations d’identification GitHub sont déjà stockées dans Azure, sinon hello script va échouer lors de la tentative de paramètres de contrôle de code source tooconfigure pour les applications web hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-144">This requires that your GitHub credentials are already stored in Azure, otherwise hello scripted deployment will fail when attempting tooconfigure source control settings for hello web apps.</span></span>
>
> <span data-ttu-id="b2d0e-145">toostore informations d’identification de votre GitHub dans Azure, créez une application web Bonjour [Azure Portal](https://portal.azure.com/) et [configurer le déploiement de GitHub](app-service-continuous-deployment.md).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-145">toostore your GitHub credentials in Azure, create a web app in hello [Azure Portal](https://portal.azure.com/) and [configure GitHub deployment](app-service-continuous-deployment.md).</span></span> <span data-ttu-id="b2d0e-146">Vous ne devez toodo ce qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-146">You only need toodo this once.</span></span>
>
>

<span data-ttu-id="b2d0e-147">Dans un scénario classique de DevOps, vous avez une application qui est en cours d’exécution en direct dans Azure, et vous souhaitez tooit de modifications toomake via la publication continue.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-147">In a typical DevOps scenario, you have an application that’s running live in Azure, and you want toomake changes tooit through continuous publishing.</span></span> <span data-ttu-id="b2d0e-148">Dans ce scénario, vous allez déployer tooproduction un modèle que vous avez développé et testé.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-148">In this scenario, you will deploy tooproduction a template that you have developed and tested.</span></span>

1. <span data-ttu-id="b2d0e-149">Créer votre propre branchement de hello [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) référentiel.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-149">Create your own fork of hello [ToDoApp](https://github.com/azure-appservice-samples/ToDoApp) repository.</span></span> <span data-ttu-id="b2d0e-150">Pour plus d’informations sur la création de votre branchement, consultez [Branchement dans un référentiel](https://help.github.com/articles/fork-a-repo/).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-150">For information on creating your fork, see [Fork a Repo](https://help.github.com/articles/fork-a-repo/).</span></span> <span data-ttu-id="b2d0e-151">Une fois votre branchement créé, il est visible dans votre navigateur.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-151">Once your fork is created, you can see it in your browser.</span></span>

   ![](./media/app-service-agile-software-development/production-1-private-repo.png)
2. <span data-ttu-id="b2d0e-152">Ouvrez une session Git Shell.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-152">Open a Git Shell session.</span></span> <span data-ttu-id="b2d0e-153">Si vous n’avez pas encore Git Shell, installez [GitHub for Windows](https://windows.github.com/) .</span><span class="sxs-lookup"><span data-stu-id="b2d0e-153">If you don't have Git Shell yet, install [GitHub for Windows](https://windows.github.com/) now.</span></span>
3. <span data-ttu-id="b2d0e-154">Créer un clone local de votre branche en exécutant hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-154">Create a local clone of your fork by executing hello following command:</span></span>

     <span data-ttu-id="b2d0e-155">git clone https://github.com/<your_fork>/ToDoApp.git</span><span class="sxs-lookup"><span data-stu-id="b2d0e-155">git clone https://github.com/<your_fork>/ToDoApp.git</span></span>
4. <span data-ttu-id="b2d0e-156">Une fois que vous avez votre clone local, accédez trop*&lt;repository_root >*\ARMTemplates et exécution hello deploy.ps1 script avec un suffixe unique, comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-156">Once you have your local clone, navigate too*&lt;repository_root>*\ARMTemplates, and run hello deploy.ps1 script with a unique suffix, as shown below:</span></span>

     <span data-ttu-id="b2d0e-157">.\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git -ResourceGroupSuffix <your_suffix></span><span class="sxs-lookup"><span data-stu-id="b2d0e-157">.\deploy.ps1 –RepoUrl https://github.com/<your_fork>/todoapp.git -ResourceGroupSuffix <your_suffix></span></span>
5. <span data-ttu-id="b2d0e-158">Lorsque vous y êtes invité, tapez Bonjour voulue nom d’utilisateur et mot de passe pour l’accès de la base de données.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-158">When prompted, type in hello desired username and password for database access.</span></span> <span data-ttu-id="b2d0e-159">N’oubliez pas d’informations d’identification de votre base de données car vous en aurez besoin toospecify les à nouveau lorsque la mise à jour hello groupe de ressources.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-159">Remember your database credentials because you will need toospecify them again when updating hello resource group.</span></span>

   <span data-ttu-id="b2d0e-160">Vous devez voir hello mise en service de la progression de plusieurs ressources d’Azure.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-160">You should see hello provisioning progress of various Azure resources.</span></span> <span data-ttu-id="b2d0e-161">Lorsque le déploiement terminé, script de hello lancer l’application hello dans le navigateur de hello et vous donne un signal sonore convivial.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-161">When deployment completes, hello script will launch hello application in hello browser and give you a friendly beep.</span></span>
   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.1-app-in-browser.png)
6. <span data-ttu-id="b2d0e-162">De retour dans votre session Git Shell, exécutez :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-162">Back in your Git Shell session, run:</span></span>

     <span data-ttu-id="b2d0e-163">.\swap –Name ToDoApp<your_suffix></span><span class="sxs-lookup"><span data-stu-id="b2d0e-163">.\swap –Name ToDoApp<your_suffix></span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.2-swap-to-production.png)
7. <span data-ttu-id="b2d0e-164">Une fois le script de hello, revenez adresse du frontale toobrowse toohello (http://ToDoApp*&lt;your_suffix >*.azurewebsites.net/) toosee hello applications exécutent en production.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-164">When hello script finishes, go back toobrowse toohello frontend’s address (http://ToDoApp*&lt;your_suffix>*.azurewebsites.net/) toosee hello application running in production.</span></span>
8. <span data-ttu-id="b2d0e-165">Ouvrez une session sur hello [portail Azure](https://portal.azure.com/) et examiner ce qui est créé.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-165">Log into hello [Azure Portal](https://portal.azure.com/) and take a look at what’s created.</span></span>

   <span data-ttu-id="b2d0e-166">Vous devez être en mesure de toosee deux les applications web Bonjour même groupe de ressources, avec hello `Api` suffixe de nom de hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-166">You should be able toosee two web apps in hello same resource group, one with hello `Api` suffix in hello name.</span></span> <span data-ttu-id="b2d0e-167">Si vous examinez l’affichage hello du groupe de ressources, vous verrez également hello de base de données SQL, server, hello plan App Service et emplacements intermédiaires de hello pour les applications web hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-167">If you look at hello resource group view, you will also see hello SQL Database and server, hello App Service plan, and hello staging slots for hello web apps.</span></span> <span data-ttu-id="b2d0e-168">Parcourir les différentes ressources hello et de les comparer avec  *&lt;repository_root >*toosee \ARMTemplates\ProdAndStage.json comment ils sont configurés dans le modèle de hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-168">Browse through hello different resources and compare them with *&lt;repository_root>*\ARMTemplates\ProdAndStage.json toosee how they are configured in hello template.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/00.3-resource-group-view.png)

<span data-ttu-id="b2d0e-169">Vous avez configuré l’application de production hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-169">You have set up hello production app.</span></span>  <span data-ttu-id="b2d0e-170">À présent, imaginons que vous avez reçu des commentaires que la facilité d’utilisation est faible pour l’application hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-170">Now, let's imagine that you receive feedback that usability is poor for hello app.</span></span> <span data-ttu-id="b2d0e-171">Par conséquent, vous décidez de tooinvestigate.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-171">So you decide tooinvestigate.</span></span> <span data-ttu-id="b2d0e-172">Vous allez tooinstrument toogive de votre application vous commentaires.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-172">You're going tooinstrument your app toogive you feedback.</span></span>

## <a name="investigate-instrument-your-client-app-for-monitoringmetrics"></a><span data-ttu-id="b2d0e-173">Enquête : Instrumenter votre application cliente aux fins de surveillance/mesures</span><span class="sxs-lookup"><span data-stu-id="b2d0e-173">Investigate: Instrument your client app for monitoring/metrics</span></span>
1. <span data-ttu-id="b2d0e-174">Ouvrez *&lt;racine_référentiel>*\src\MultiChannelToDo.sln dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-174">Open *&lt;repository_root>*\src\MultiChannelToDo.sln in Visual Studio.</span></span>
2. <span data-ttu-id="b2d0e-175">Restaurez tous les packages Nuget en cliquant avec le bouton droit sur la solution > **Gérer les packages NuGet pour la solution** > **Restaurer**.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-175">Restore all Nuget packages by right-clicking solution > **Manage NuGet Packages for Solution** > **Restore**.</span></span>
3. <span data-ttu-id="b2d0e-176">Avec le bouton droit **MultiChannelToDo.Web** > **ajouter de télémétrie Application Insights** > **configurer les paramètres** > modifier le groupe de ressources tooToDoApp*&lt;your_suffix >* > **ajouter Application Insights tooProject**.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-176">Right-click **MultiChannelToDo.Web** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group tooToDoApp*&lt;your_suffix>* > **Add Application Insights tooProject**.</span></span>
4. <span data-ttu-id="b2d0e-177">Bonjour portail Azure, ouvrez le panneau de hello pour hello **MultiChannelToDo.Web** ressources d’Application Insight.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-177">In hello Azure Portal, open hello blade for hello **MultiChannelToDo.Web** Application Insight resource.</span></span> <span data-ttu-id="b2d0e-178">Puis Bonjour **contrôle d’intégrité de l’Application** partie, cliquez sur **apprendre comment charger des données par page de navigateur toocollect** > Copier le code.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-178">Then in hello **Application health** part, click **Learn how toocollect browser page load data** > copy code.</span></span>
5. <span data-ttu-id="b2d0e-179">Ajouter hello copié le code d’instrumentation JS trop*&lt;repository_root >*\src\MultiChannelToDo.Web\app\Index.cshtml, juste avant la fermeture de hello `<heading>` balise.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-179">Add hello copied JS instrumentation code too*&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, just before hello closing `<heading>` tag.</span></span> <span data-ttu-id="b2d0e-180">Elle doit contenir la clé d’instrumentation unique hello de votre ressource Application Insight.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-180">It should contain hello unique instrumentation key of your Application Insight resource.</span></span>

        <script type="text/javascript">
        var appInsights=window.appInsights||function(config){
            function s(config){t[config]=function(){var i=arguments;t.queue.push(function(){t[config].apply(t,i)})}}var t={config:config},r=document,f=window,e="script",o=r.createElement(e),i,u;for(o.src=config.url||"//az416426.vo.msecnd.net/scripts/a/ai.0.js",r.getElementsByTagName(e)[0].parentNode.appendChild(o),t.cookie=r.cookie,t.queue=[],i=["Event","Exception","Metric","PageView","Trace"];i.length;)s("track"+i.pop());return config.disableExceptionTracking||(i="onerror",s("_"+i),u=f[i],f[i]=function(config,r,f,e,o){var s=u&&u(config,r,f,e,o);return s!==!0&&t["_"+i](config,r,f,e,o),s}),t
        }({
            instrumentationKey:"<your_unique_instrumentation_key>"
        });

        window.appInsights=appInsights;
        appInsights.trackPageView();
        </script>
6. <span data-ttu-id="b2d0e-181">Envoyer des événements personnalisés Insights tooApplication clics de souris en ajoutant hello suivant en bas de toohello de code du corps :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-181">Send custom events tooApplication Insights for mouse clicks by adding hello following code toohello bottom of body:</span></span>

       <script>
           $(document.body).find("*").click(function(event) {

               appInsights.trackEvent(event.target.tagName + ": " + event.target.className);
           });
       </script>

   <span data-ttu-id="b2d0e-182">Cet extrait de code JavaScript envoie à une événement personnalisé de tooApplication Insights chaque fois qu’un utilisateur clique sur n’importe où dans l’application web hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-182">This JavaScript snippet sends a custom event tooApplication Insights every time a user clicks anywhere in hello web app.</span></span>
7. <span data-ttu-id="b2d0e-183">Dans l’interpréteur de commandes Git, validez et envoyez de votre branche tooyour de modifications dans GitHub.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-183">In Git Shell, commit and push your changes tooyour fork in GitHub.</span></span> <span data-ttu-id="b2d0e-184">Puis, attendez que le navigateur toorefresh de clients.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-184">Then, wait for clients toorefresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for client app"
       git push origin master
8. <span data-ttu-id="b2d0e-185">Échange tooproduction de modifications d’application hello déployé :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-185">Swap hello deployed app changes tooproduction:</span></span>

     <span data-ttu-id="b2d0e-186">.\swap –Name ToDoApp<your_suffix></span><span class="sxs-lookup"><span data-stu-id="b2d0e-186">.\swap –Name ToDoApp<your_suffix></span></span>
9. <span data-ttu-id="b2d0e-187">Parcourir la ressource Application Insights toohello que vous avez configuré.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-187">Browse toohello Application Insights resource that you configured.</span></span> <span data-ttu-id="b2d0e-188">Cliquez sur Événements personnalisés.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-188">Click Custom events.</span></span>

   ![](./media/app-service-web-test-in-production-controlled-test-flight/01-custom-events.png)

   <span data-ttu-id="b2d0e-189">Si vous ne voyez pas les mesures pour les événements personnalisés, attendez quelques minutes et cliquez sur **Actualiser**.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-189">If you don't see metrics for custom events, wait a few minutes and click **Refresh**.</span></span>

<span data-ttu-id="b2d0e-190">Supposons que vous voyiez un graphique comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-190">Suppose you see a chart like below:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/02-custom-events-chart-view.png)

<span data-ttu-id="b2d0e-191">Et la grille d’événement hello en dessous :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-191">And hello event grid below it:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/03-custom-event-grid-view.png)

<span data-ttu-id="b2d0e-192">Selon le code d’application tooyour ToDoApp, hello **bouton** événement correspond toohello bouton d’envoi et hello **entrée** événement correspond toohello la zone de texte.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-192">According tooyour ToDoApp application code, hello **BUTTON** event corresponds toohello submit button, and hello **INPUT** event corresponds toohello textbox.</span></span> <span data-ttu-id="b2d0e-193">Jusqu’à présent, tout est logique.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-193">So far, things make sense.</span></span> <span data-ttu-id="b2d0e-194">Toutefois, il semble y avoir une quantité importante de clics et très peu de clics sur les éléments d’action hello (hello **LI** événements).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-194">However, it looks like there's a good amount of clicks and very few clicks on hello to-do items (hello **LI** events).</span></span>

<span data-ttu-id="b2d0e-195">Basé sur ce formulaire vous votre hypothèse certains utilisateurs sont confondu quelle partie de hello l’interface utilisateur est interactif et c’est parce que le curseur de hello le style pour la sélection de texte lorsqu’il se trouve sur les éléments de liste hello et leurs icônes.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-195">Based on this, you form your hypothesis that some users are confused which part of hello UI is clickable and it is because hello cursor is styled for text selection when it hovers on hello list items and their icons.</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/04-to-do-list-item-ui.png)

<span data-ttu-id="b2d0e-196">Il peut s’agir d’un exemple fictif.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-196">This might be a contrived example.</span></span> <span data-ttu-id="b2d0e-197">Toutefois, vous êtes continu toomake une application de tooyour d’amélioration du produit, puis effectuez une commentaires de version d’évaluation déploiement tooget facilité d’utilisation à partir de clients en direct.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-197">Nevertheless, you're going toomake an improvement tooyour app, and then perform a flighting deployment tooget usability feedback from live customers.</span></span>

### <a name="instrument-your-server-app-for-monitoringmetrics"></a><span data-ttu-id="b2d0e-198">Instrumenter votre application serveur aux fins de surveillance/mesures</span><span class="sxs-lookup"><span data-stu-id="b2d0e-198">Instrument your server app for monitoring/metrics</span></span>
<span data-ttu-id="b2d0e-199">Il s’agit d’une tangente étant donné que le scénario hello présenté dans ce didacticiel porte uniquement sur hello client application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-199">This is a tangent since hello scenario demonstrated in this tutorial only deals with hello client app.</span></span> <span data-ttu-id="b2d0e-200">Toutefois, par souci d’exhaustivité, vous allez définir hello de l’application côté serveur.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-200">However, for completeness you will set up hello server-side app.</span></span>

1. <span data-ttu-id="b2d0e-201">Avec le bouton droit **MultiChannelToDo** > **ajouter de télémétrie Application Insights** > **configurer les paramètres** > modifier le groupe de ressources tooToDoApp*&lt;your_suffix >* > **ajouter Application Insights tooProject**.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-201">Right-click **MultiChannelToDo** > **Add Application Insights Telemetry** > **Configure Settings** > Change resource group tooToDoApp*&lt;your_suffix>* > **Add Application Insights tooProject**.</span></span>
2. <span data-ttu-id="b2d0e-202">Dans l’interpréteur de commandes Git, validez et envoyez de votre branche tooyour de modifications dans GitHub.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-202">In Git Shell, commit and push your changes tooyour fork in GitHub.</span></span> <span data-ttu-id="b2d0e-203">Puis, attendez que le navigateur toorefresh de clients.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-203">Then, wait for clients toorefresh browser.</span></span>

       git add -A :/
       git commit -m "add AI configuration for server app"
       git push origin master
3. <span data-ttu-id="b2d0e-204">Échange tooproduction de modifications d’application hello déployé :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-204">Swap hello deployed app changes tooproduction:</span></span>

     <span data-ttu-id="b2d0e-205">.\swap –Name ToDoApp<your_suffix></span><span class="sxs-lookup"><span data-stu-id="b2d0e-205">.\swap –Name ToDoApp<your_suffix></span></span>

<span data-ttu-id="b2d0e-206">Et voilà !</span><span class="sxs-lookup"><span data-stu-id="b2d0e-206">That's it!</span></span>

## <a name="investigate-add-slot-specific-tags-tooyour-client-app-metrics"></a><span data-ttu-id="b2d0e-207">Recherchez la cause : Ajouter des métriques de balises spécifiques à l’emplacement tooyour client application</span><span class="sxs-lookup"><span data-stu-id="b2d0e-207">Investigate: Add slot-specific tags tooyour client app metrics</span></span>
<span data-ttu-id="b2d0e-208">Dans cette section, vous allez configurer hello déploiement différents emplacements toosend spécifiques à l’emplacement de télémétrie toohello même ressource Application Insights.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-208">In this section, you will configure hello different deployment slots toosend slot-specific telemetry toohello same Application Insights resource.</span></span> <span data-ttu-id="b2d0e-209">De cette manière, vous pouvez comparer les données de télémétrie de données entre le trafic à partir de différents emplacements (environnements de déploiement) tooeasily consultez effet hello des modifications de votre application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-209">This way, you can compare telemetry data between traffic from different slots (deployment environments) tooeasily see hello effect of your app changes.</span></span> <span data-ttu-id="b2d0e-210">AT hello même temps, vous pouvez séparer le trafic de production hello hello reste pour pouvoir continuer toomonitor votre application de production en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-210">At hello same time, you can separate hello production traffic from hello rest so you can continue toomonitor your production app as needed.</span></span>

<span data-ttu-id="b2d0e-211">Étant donné que vous êtes collecte des données sur le comportement du client, vous allez [ajouter un tooyour d’initialiseur de télémétrie du code JavaScript](../application-insights/app-insights-api-filtering-sampling.md) dans index.cshtml.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-211">Since you're gathering data on client behavior, you will [add a telemetry initializer tooyour JavaScript code](../application-insights/app-insights-api-filtering-sampling.md) in index.cshtml.</span></span> <span data-ttu-id="b2d0e-212">Si vous souhaitez que les performances de tootest côté serveur, par exemple, vous pouvez également faire de même dans votre code serveur (consultez [API Application Insights pour les événements personnalisés et les métriques](../application-insights/app-insights-api-custom-events-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-212">If you want tootest server-side performance, for example, you can also do similarly in your server code (see [Application Insights API for custom events and metrics](../application-insights/app-insights-api-custom-events-metrics.md).</span></span>

1. <span data-ttu-id="b2d0e-213">Ajoutez d’abord hello 1re lettre des mots de code hello deux `//` commentaires ci-dessous dans le bloc de hello JavaScript que vous avez ajouté toohello `<heading>` balise précédemment.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-213">First, add hello code bewteen hello two `//` comments below in hello JavaScript block that you added toohello `<heading>` tag earlier.</span></span>

        window.appInsights = appInsights;

        // Begin new code
        appInsights.queue.push(function () {
            appInsights.context.addTelemetryInitializer(function (envelope) {
                var telemetryItem = envelope.data.baseData;
                telemetryItem.properties = telemetryItem.properties || {};
                telemetryItem.properties["Environment"] = "@System.Configuration.ConfigurationManager.AppSettings["environment"]";
            });
        });
        // End new code

        appInsights.trackPageView();

    <span data-ttu-id="b2d0e-214">Ce code d’initialiseur, Bonjour `appInsights` objet tooadd hello une propriété personnalisée nommée `Environment` pièce tooevery de télémétrie qu’il envoie.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-214">This initializer code causes hello `appInsights` object tooadd hello a custom property called `Environment` tooevery piece of telemetry it sends.</span></span>
2. <span data-ttu-id="b2d0e-215">Ensuite, ajoutez cette propriété personnalisée en tant que [paramètre d’emplacement](web-sites-staged-publishing.md#AboutConfiguration) pour votre application web dans Azure.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-215">Next, add this custom property as a [slot setting](web-sites-staged-publishing.md#AboutConfiguration) for your web app in Azure.</span></span> <span data-ttu-id="b2d0e-216">toodo, hello exécution suivant des commandes dans votre session d’interpréteur de commandes Git.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-216">toodo this, run hello following commands in your Git Shell session.</span></span>

        $app = Get-AzureWebsite -Name todoapp<your_suffix> -Slot production
        $app.AppSettings.Add("environment", "Production")
        $app.SlotStickyAppSettingNames.Add("environment")
        $app | Set-AzureWebsite -Name todoapp<your_suffix> -Slot production

    <span data-ttu-id="b2d0e-217">Hello Web.config dans votre projet définit déjà hello `environment` paramètre d’application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-217">hello Web.config in your project already defines hello `environment` app setting.</span></span> <span data-ttu-id="b2d0e-218">Avec ce paramètre, lorsque vous testez l’application hello localement, vos métriques seront marqués avec `VS Debugger`.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-218">With this setting, when you test hello app locally, your metrics will be tagged with `VS Debugger`.</span></span> <span data-ttu-id="b2d0e-219">Toutefois, lorsque vous appuyez sur votre tooAzure de modifications, Azure sera trouver et utiliser hello `environment` paramètre dans la configuration de l’application hello web d’application et vos métriques seront marqués avec `Production`.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-219">However, when you push your changes tooAzure, Azure will find and use hello `environment` app setting in hello web app's configuration instead, and your metrics will be tagged with `Production`.</span></span>
3. <span data-ttu-id="b2d0e-220">Valider push votre branche de tooyour de modifications de code sur GitHub et attendez que votre application nouveaux utilisateurs toouse hello (besoin toorefresh hello navigateur).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-220">Commit and push your code changes tooyour fork on GitHub, and then wait for your users toouse hello new app (need toorefresh hello browser).</span></span> <span data-ttu-id="b2d0e-221">Il prend environ 15 minutes pour hello nouvelle propriété tooshow dans votre Application Insights `MultiChannelToDo.Web` ressource.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-221">It takes about 15 minutes for hello new property tooshow up in your Application Insights `MultiChannelToDo.Web` resource.</span></span>

        git add -A :/
        git commit -m "add environment property tooAI events for client app"
        git push origin master
4. <span data-ttu-id="b2d0e-222">Passez maintenant toohello **événements personnalisés** panneau à nouveau et filtrer des mesures hello sur `Environment=Production`.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-222">Now, go toohello **Custom events** blade again and filter hello metrics on `Environment=Production`.</span></span> <span data-ttu-id="b2d0e-223">Vous devez maintenant être en mesure de toosee tous les événements personnalisés de hello en production de hello emplacement avec ce filtre.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-223">You should now be able toosee all hello new custom events in hello production slot with this filter.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/05-filter-on-production-environment.png)
5. <span data-ttu-id="b2d0e-224">Cliquez sur hello **favoris** telles que le bouton toosave hello actuel Metrics Explorer paramètres toosomething **événements personnalisés : Production**.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-224">Click hello **Favorites** button toosave hello current Metrics Explorer settings toosomething like **Custom events: Production**.</span></span> <span data-ttu-id="b2d0e-225">Vous pourrez facilement basculer entre cette vue et une vue d’emplacement de déploiement ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-225">You can easily switch between this view and a deployment slot view later.</span></span>

   > [!TIP]
   > <span data-ttu-id="b2d0e-226">Pour une analyse encore plus puissante, envisagez d’ [intégrer votre ressource Application Insights avec Power BI](../application-insights/app-insights-export-power-bi.md).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-226">For even more powerful analytics, consider [integrating your Application Insights resource with Power BI](../application-insights/app-insights-export-power-bi.md).</span></span>
   >
   >

### <a name="add-slot-specific-tags-tooyour-server-app-metrics"></a><span data-ttu-id="b2d0e-227">Ajouter des balises spécifiques à l’emplacement tooyour server application métriques</span><span class="sxs-lookup"><span data-stu-id="b2d0e-227">Add slot-specific tags tooyour server app metrics</span></span>
<span data-ttu-id="b2d0e-228">Là encore, par souci d’exhaustivité, vous allez définir hello de l’application côté serveur.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-228">Again, for completeness you will set up hello server-side app.</span></span> <span data-ttu-id="b2d0e-229">Contrairement aux application client hello instrumentée dans JavaScript, les balises spécifiques à l’emplacement pour l’application de serveur hello est instrumentée avec le code .NET.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-229">Unlike hello client app which is instrumented in JavaScript, slot-specific tags for hello server app is instrumented with .NET code.</span></span>

1. <span data-ttu-id="b2d0e-230">Ouvrez *&lt;racine_référentiel >*\src\MultiChannelToDo\Global.asax.cs.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-230">Open *&lt;repository_root>*\src\MultiChannelToDo\Global.asax.cs.</span></span> <span data-ttu-id="b2d0e-231">Ajoutez le bloc de code hello ci-dessous, juste avant l’accolade de l’espace de noms de fermeture de hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-231">Add hello code block below, just before hello closing namespace curly brace.</span></span>

        namespace MultiChannelToDo
        {
                ...

                // Begin new code
            public class ConfigInitializer
            : ITelemetryInitializer
            {
                void ITelemetryInitializer.Initialize(ITelemetry telemetry)
                {
                    telemetry.Context.Properties["Environment"] = System.Configuration.ConfigurationManager.AppSettings["environment"];
                }
            }
                // End new code
        }
2. <span data-ttu-id="b2d0e-232">Corriger les erreurs de résolution de nom hello en ajoutant hello `using` instructions ci-dessous toohello début du fichier de hello :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-232">Correct hello name resolution errors by adding hello `using` statements below toohello beginning of hello file:</span></span>

        using Microsoft.ApplicationInsights.Channel;
        using Microsoft.ApplicationInsights.Extensibility;
3. <span data-ttu-id="b2d0e-233">Ajoutez le code hello ci-dessous début toohello Hello `Application_Start()` méthode :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-233">Add hello code below toohello beginning of hello `Application_Start()` method:</span></span>

        TelemetryConfiguration.Active.TelemetryInitializers.Add(new ConfigInitializer());
4. <span data-ttu-id="b2d0e-234">Valider push votre branche de tooyour de modifications de code sur GitHub et attendez que votre application nouveaux utilisateurs toouse hello (besoin toorefresh hello navigateur).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-234">Commit and push your code changes tooyour fork on GitHub, and then wait for your users toouse hello new app (need toorefresh hello browser).</span></span> <span data-ttu-id="b2d0e-235">Il prend environ 15 minutes pour hello nouvelle propriété tooshow dans votre Application Insights `MultiChannelToDo` ressource.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-235">It takes about 15 minutes for hello new property tooshow up in your Application Insights `MultiChannelToDo` resource.</span></span>

        git add -A :/
        git commit -m "add environment property tooAI events for server app"
        git push origin master

## <a name="update-set-up-your-beta-branch"></a><span data-ttu-id="b2d0e-236">Mise à jour : Configurer votre branche bêta</span><span class="sxs-lookup"><span data-stu-id="b2d0e-236">Update: Set up your beta branch</span></span>
1. <span data-ttu-id="b2d0e-237">Ouvrez  *&lt;repository_root >*\ARMTemplates\ProdAndStagetest.json et trouver hello `appsettings` ressources (recherchez `"name": "appsettings"`).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-237">Open *&lt;repository_root>*\ARMTemplates\ProdAndStagetest.json and find hello `appsettings` resources (search for `"name": "appsettings"`).</span></span> <span data-ttu-id="b2d0e-238">Elles sont au nombre de 4, une pour chaque emplacement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-238">There are 4 of them, one for each slot.</span></span>
2. <span data-ttu-id="b2d0e-239">Pour chaque `appsettings` ressource, ajoutez une `"environment": "[parameters('slotName')]"` application paramétrage toohello de la fin de hello `properties` tableau.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-239">For each `appsettings` resource, add an  `"environment": "[parameters('slotName')]"` app setting toohello end of hello `properties` array.</span></span> <span data-ttu-id="b2d0e-240">N’oubliez pas ligne précédente de hello tooend par une virgule.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-240">Don't forget tooend hello previous line with a comma.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/06-arm-app-setting-with-slot-name.png)

    <span data-ttu-id="b2d0e-241">Vous venez d’ajouter hello `environment` application définissant des emplacements de hello tooall dans le modèle de hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-241">You have just added hello `environment` app setting tooall hello slots in hello template.</span></span>
3. <span data-ttu-id="b2d0e-242">Dans l’hello du même fichier, recherche hello `slotconfignames` ressources (recherchez `"name": "slotconfignames"`).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-242">In hello same file, find hello `slotconfignames` resources (search for `"name": "slotconfignames"`).</span></span> <span data-ttu-id="b2d0e-243">Elles sont au nombre de 2, une pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-243">There are 2 of them, one for each app.</span></span>
4. <span data-ttu-id="b2d0e-244">Pour chaque `slotconfignames` ressource, ajoutez `"environment"` fin toohello Hello `appSettingNames` tableau.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-244">For each `slotconfignames` resource, add `"environment"` toohello end of hello `appSettingNames` array.</span></span> <span data-ttu-id="b2d0e-245">N’oubliez pas ligne précédente de hello tooend par une virgule.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-245">Don't forget tooend hello previous line with a comma.</span></span>

    <span data-ttu-id="b2d0e-246">Vous venez d’apporter hello `environment` application paramètre tooits déploiement respectifs Stick pour les deux applications.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-246">You have just made hello `environment` app setting stick tooits respective deployment slot for both apps.</span></span>  
5. <span data-ttu-id="b2d0e-247">Dans votre session d’interpréteur de commandes Git, hello exécution commandes suivantes avec hello même suffixe de groupe de ressources que vous utilisiez auparavant.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-247">In your Git Shell session, run hello following commands with hello same resource group suffix that you used before.</span></span>

        git checkout -b beta
        git push origin beta
        .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch beta
6. <span data-ttu-id="b2d0e-248">Lorsque vous y êtes invité, spécifiez hello les mêmes informations d’identification de base de données SQL comme avant.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-248">When prompted, specify hello same SQL database credentials as before.</span></span> <span data-ttu-id="b2d0e-249">Ensuite, lorsque le groupe de ressources tooupdate hello, type de demande `Y`, puis `ENTER`.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-249">Then, when asked tooupdate hello resource group, type `Y`, then `ENTER`.</span></span>

    <span data-ttu-id="b2d0e-250">Une fois que la fin du script hello, toutes vos ressources dans le groupe de ressources hello d’origine sont conservés, mais un nouvel emplacement nommé « bêta » est créé avec hello même configuration que hello emplacement « Intermédiaire » qui a été créé à partir de l’hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-250">Once hello script finishes, all your resources in hello original resource group are retained, but a new slot named "beta" is created in it with hello same configuration as hello "Staging" slot that was created in hello beginning.</span></span>

   > [!NOTE]
   > <span data-ttu-id="b2d0e-251">Cette méthode de création de différents environnements de déploiement est différente de la méthode hello dans [développement Agile avec Azure App Service](app-service-agile-software-development.md).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-251">This method of creating different deployment environments is different from hello method in [Agile software development with Azure App Service](app-service-agile-software-development.md).</span></span> <span data-ttu-id="b2d0e-252">Ici, vous créez des environnements de déploiement avec des emplacements de déploiement, alors qu’avec l’autre méthode, vous créez des environnements de déploiement avec des groupes de ressources.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-252">Here, you create deployment environments with deployment slots, where as there you create deployment environments with resource groups.</span></span> <span data-ttu-id="b2d0e-253">La gestion des environnements de déploiement avec les groupes de ressources vous permet de tookeep hello production environnement hors des limites toodevelopers, mais il n’est pas facile toodo test en production, vous pouvez ainsi faire facilement avec les emplacements.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-253">Managing deployment environments with resource groups enables you tookeep hello production environment off-limits toodevelopers, but it's not easy toodo testing in production, which you can do easily with slots.</span></span>
   >
   >

<span data-ttu-id="b2d0e-254">Si vous le souhaitez, vous pouvez également créer une application alpha en exécutant la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-254">If you wish, you can also create an alpha app by running</span></span>

    git checkout -b alpha
    git push origin alpha
    .\deploy.ps1 -RepoUrl https://github.com/<your_fork>/ToDoApp.git -ResourceGroupSuffix <your_suffix> -SlotName beta -Branch alpha

<span data-ttu-id="b2d0e-255">Pour ce didacticiel, vous continuerez simplement à utiliser votre application bêta.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-255">For this tutorial, you will just keep using your beta app.</span></span>

## <a name="update-push-your-updates-toohello-beta-app"></a><span data-ttu-id="b2d0e-256">Mise à jour : Distribuer votre application de bêta toohello mises à jour</span><span class="sxs-lookup"><span data-stu-id="b2d0e-256">Update: Push your updates toohello beta app</span></span>
<span data-ttu-id="b2d0e-257">Sauvegarder l’application tooyour que vous souhaitez tooimprove.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-257">Back tooyour app that you want tooimprove.</span></span>

1. <span data-ttu-id="b2d0e-258">Vérifiez que vous êtes à présent dans votre branche bêta</span><span class="sxs-lookup"><span data-stu-id="b2d0e-258">Make sure you're now in your beta branch</span></span>

        git checkout beta
2. <span data-ttu-id="b2d0e-259">Dans  *&lt;repository_root >*\src\MultiChannelToDo.Web\app\Index.cshtml, rechercher hello `<li>` de balise et ajouter hello `style="cursor:pointer"` d’attribut, comme illustré ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-259">In *&lt;repository_root>*\src\MultiChannelToDo.Web\app\Index.cshtml, find hello `<li>` tag and add hello `style="cursor:pointer"` attribute, as shown below.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/07-change-cursor-style-on-li.png)
3. <span data-ttu-id="b2d0e-260">validez et envoyez tooAzure.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-260">commit and push tooAzure.</span></span>
4. <span data-ttu-id="b2d0e-261">Vérifiez que hello modification est maintenant répercutée dans l’emplacement de bêta hello en naviguant toohttp://todoapp*&lt;your_suffix >*-beta.azurewebsites.net/.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-261">Verify that hello change is now reflected in hello beta slot by navigating toohttp://todoapp*&lt;your_suffix>*-beta.azurewebsites.net/.</span></span> <span data-ttu-id="b2d0e-262">Si vous ne voyez pas hello modifier encore, actualisez votre navigateur tooget hello nouveau javascript code.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-262">If you don't see hello change yet, refresh your browser tooget hello new javascript code.</span></span>

    ![](./media/app-service-web-test-in-production-controlled-test-flight/08-verify-change-in-beta-site.png)

<span data-ttu-id="b2d0e-263">Maintenant que vous avez votre modification en cours d’exécution dans l’emplacement de bêta hello, vous êtes prêt tooperform un version d’évaluation du déploiement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-263">Now that you have your change running in hello beta slot, you are ready tooperform a flighting deployment.</span></span>

## <a name="validate-route-traffic-toohello-beta-app"></a><span data-ttu-id="b2d0e-264">Valider : Route le trafic toohello bêta application</span><span class="sxs-lookup"><span data-stu-id="b2d0e-264">Validate: Route traffic toohello beta app</span></span>
<span data-ttu-id="b2d0e-265">Dans cette section, vous achemine le trafic toohello bêta application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-265">In this section, you will route traffic toohello beta app.</span></span> <span data-ttu-id="b2d0e-266">Par souci de clarté, de démonstration, vous allez tooroute une partie significative de tooit de trafic utilisateur hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-266">For sake of clarity of demonstration, you're going tooroute a significant portion of hello user traffic tooit.</span></span> <span data-ttu-id="b2d0e-267">En réalité, hello quantité de trafic que vous souhaitez tooroute dépend de votre situation spécifique.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-267">In reality, hello amount of traffic you want tooroute will depend on your specific situation.</span></span> <span data-ttu-id="b2d0e-268">Par exemple, si votre site est à l’échelle de hello de microsoft.com, il vous faudra peut-être inférieur à un pour cent de votre total du trafic de données de commandes toogain utile.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-268">For example, if your site is at hello scale of microsoft.com, then you may need less than one percent of your total traffic in order toogain useful data.</span></span>

1. <span data-ttu-id="b2d0e-269">Dans votre session d’interpréteur de commandes Git, exécutez hello suivant de commandes tooroute la moitié de l’emplacement de hello production trafic toohello bêta :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-269">In your Git Shell session, run hello following commands tooroute half of hello production traffic toohello beta slot:</span></span>

        $siteName = "ToDoApp<your suffix>"
        $rule = New-Object Microsoft.WindowsAzure.Commands.Utilities.Websites.Services.WebEntities.RampUpRule
        $rule.ActionHostName = "$siteName-beta.azurewebsites.net"
        $rule.ReroutePercentage = 50
        $rule.Name = "beta"
        Set-AzureWebsite $siteName -Slot Production -RoutingRules $rule

   <span data-ttu-id="b2d0e-270">Hello `ReroutePercentage=50` propriété spécifie que 50 % du trafic de production hello est URL de l’application toohello routé bêta (spécifié par hello `ActionHostName` propriété).</span><span class="sxs-lookup"><span data-stu-id="b2d0e-270">hello `ReroutePercentage=50` property specifies that 50% of hello production traffic will be routed toohello beta app's URL (specified by hello `ActionHostName` property).</span></span>
2. <span data-ttu-id="b2d0e-271">Maintenant accédez toohttp://ToDoApp*&lt;your_suffix >*. azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-271">Now navigate toohttp://ToDoApp*&lt;your_suffix>*.azurewebsites.net.</span></span> <span data-ttu-id="b2d0e-272">50 % du trafic de hello doit maintenant être emplacement bêta de toohello redirigé.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-272">50% of hello traffic should now be redirected toohello beta slot.</span></span>
3. <span data-ttu-id="b2d0e-273">Dans votre ressource Application Insights, filtrer les métriques hello en environnement = « bêta ».</span><span class="sxs-lookup"><span data-stu-id="b2d0e-273">In your Application Insights resource, filter hello metrics by environment="beta".</span></span>

   > [!NOTE]
   > <span data-ttu-id="b2d0e-274">Si vous enregistrez cette vue filtrée en tant que favori d’un autre, vous pouvez facilement inverser hello explorer métrique entre les modes production et vues de la version bêta.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-274">If you save this filtered view as another favorite, then you can easily flip hello metric explorer views between production and beta views.</span></span>
   >
   >

<span data-ttu-id="b2d0e-275">Supposons que dans Application Insights, vous voyez quelque chose de similaire toohello suivantes :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-275">Suppose in Application Insights you see something similar toohello following:</span></span>

![](./media/app-service-web-test-in-production-controlled-test-flight/09-test-beta-site-in-production.png)

<span data-ttu-id="b2d0e-276">Non seulement cette affiche qu’il n’y a plus nombre de clics sur hello `<li>` balises, mais il semble toobe une hausse du nombre de clics sur `<li>` balises.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-276">Not only is this showing that there are many more clicks on hello `<li>` tags, but there seems toobe a surge of clicks on `<li>` tags.</span></span> <span data-ttu-id="b2d0e-277">Vous pouvez ensuite en conclure que les personnes ont découverts hello nouvelle `<li>` les étiquettes sont interactifs et effacez toutes leurs tâches précédemment s’est terminée dans l’application hello maintenant.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-277">You can then conclude that people have discovered hello new `<li>` tags are clickable and are now clearing all their previously-completed tasks in hello app.</span></span>

<span data-ttu-id="b2d0e-278">Des données hello du déploiement de votre version d’évaluation, vous décidez que votre nouvelle interface utilisateur est prête pour la production.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-278">Based on hello data of your flighting deployment, you decide that your new UI is ready for production.</span></span>

## <a name="go-live-move-your-new-code-into-production"></a><span data-ttu-id="b2d0e-279">Mise en ligne : Mettre votre nouveau code en production</span><span class="sxs-lookup"><span data-stu-id="b2d0e-279">Go live: Move your new code into production</span></span>
<span data-ttu-id="b2d0e-280">Vous êtes maintenant prêt toomove votre tooproduction de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-280">You're now ready toomove your update tooproduction.</span></span> <span data-ttu-id="b2d0e-281">Ce qui est élevée qui est maintenant, vous savez que votre mise à jour a déjà été validée *avant* tooproduction push est exécuté.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-281">What's great is that now you know that your update has already been validated *before* it is pushed tooproduction.</span></span> <span data-ttu-id="b2d0e-282">Vous pouvez donc la déployer en toute confiance.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-282">So now you can confidently deploy it.</span></span> <span data-ttu-id="b2d0e-283">Étant donné que vous avez apportées à une application de client de mise à jour toohello AngularJS, vous validé uniquement le code côté client de hello.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-283">Since you made an update toohello AngularJS client app, you only validated hello client-side code.</span></span> <span data-ttu-id="b2d0e-284">Si vous étiez toomake modifications toohello principal API Web app, vous pourriez valider vos modifications de la même façon et facilement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-284">If you were toomake changes toohello back-end Web API app, you could validate your changes similarly and easily.</span></span>

1. <span data-ttu-id="b2d0e-285">Dans l’interpréteur de commandes Git, supprimer la règle de routage de trafic hello en exécutant hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-285">In Git Shell, remove hello traffic routing rule by running hello following command:</span></span>

        Set-AzureWebsite $siteName -Slot Production -RoutingRules @()
2. <span data-ttu-id="b2d0e-286">Exécutez les commandes de Git hello :</span><span class="sxs-lookup"><span data-stu-id="b2d0e-286">Run hello Git commands:</span></span>

        git checkout master
        git pull origin master
        git merge beta
        git push origin master
3. <span data-ttu-id="b2d0e-287">Attendez quelques minutes pour hello nouveau code toohello toobe déployé staging emplacement, puis lancement http://ToDoApp*&lt;your_suffix >*-tooverify staging.azurewebsites.net qui hello nouvelle mise à jour est préparée intermédiaire de hello emplacement.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-287">Wait for a few minutes for hello new code toobe deployed toohello staging slot, then launch http://ToDoApp*&lt;your_suffix>*-staging.azurewebsites.net tooverify that hello new update is warmed up in hello staging slot.</span></span> <span data-ttu-id="b2d0e-288">Souvenez-vous que hello branche de principale de votre branche est lié toohello intermédiaire emplacement de votre application.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-288">Remember that hello your fork's master branch is linked toohello staging slot of your app.</span></span>
4. <span data-ttu-id="b2d0e-289">À présent, remplacez hello staging emplacement en production</span><span class="sxs-lookup"><span data-stu-id="b2d0e-289">Now, swap hello staging slot into production</span></span>

        cd <ROOT>\ToDoApp\ARMTemplates
        .\swap.ps1 -Name todoapp<your_suffix>

## <a name="summary"></a><span data-ttu-id="b2d0e-290">Résumé</span><span class="sxs-lookup"><span data-stu-id="b2d0e-290">Summary</span></span>
<span data-ttu-id="b2d0e-291">Azure App Service facilite pour les entreprises de taille petite toomedium tootest leurs applications côté client en production, un problème qui a été fait habituellement dans les grandes entreprises.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-291">Azure App Service makes it easy for small- toomedium-sized businesses tootest their customer-facing apps in production, something that has been traditionally done in big enterprises.</span></span> <span data-ttu-id="b2d0e-292">Nous espérons que ce didacticiel vous a donné hello connaissances nécessaires toobring ensemble App Service et Application Insights toomake version d’évaluation déploiement possible et même les autres scénarios de test de production, dans votre monde DevOps.</span><span class="sxs-lookup"><span data-stu-id="b2d0e-292">Hopefully, this tutorial has given you hello knowledge you need toobring together App Service and Application Insights toomake possible flighting deployment, and even other test-in-production scenarios, in your DevOps world.</span></span>

## <a name="more-resources"></a><span data-ttu-id="b2d0e-293">Autres ressources</span><span class="sxs-lookup"><span data-stu-id="b2d0e-293">More resources</span></span>
* [<span data-ttu-id="b2d0e-294">Développement logiciel agile avec Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b2d0e-294">Agile software development with Azure App Service</span></span>](app-service-agile-software-development.md)
* [<span data-ttu-id="b2d0e-295">Configurer des environnements intermédiaires pour les applications web dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b2d0e-295">Set up staging environments for web apps in Azure App Service</span></span>](web-sites-staged-publishing.md)
* [<span data-ttu-id="b2d0e-296">Déployer une application complexe de manière prévisible dans Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="b2d0e-296">Deploy a complex application predictably in Azure</span></span>](app-service-deploy-complex-application-predictably.md)
* [<span data-ttu-id="b2d0e-297">Création de modèles Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="b2d0e-297">Authoring Azure Resource Manager Templates</span></span>](../azure-resource-manager/resource-group-authoring-templates.md)
* [<span data-ttu-id="b2d0e-298">JSONLint - hello validateur JSON</span><span class="sxs-lookup"><span data-stu-id="b2d0e-298">JSONLint - hello JSON Validator</span></span>](http://jsonlint.com/)
* [<span data-ttu-id="b2d0e-299">Création de branches Git – Branchement et fusion basiques</span><span class="sxs-lookup"><span data-stu-id="b2d0e-299">Git Branching – Basic Branching and Merging</span></span>](http://www.git-scm.com/book/en/v2/Git-Branching-Basic-Branching-and-Merging)
* [<span data-ttu-id="b2d0e-300">Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="b2d0e-300">Azure PowerShell</span></span>](/powershell/azure/overview)
* [<span data-ttu-id="b2d0e-301">Projet Wiki Kudu</span><span class="sxs-lookup"><span data-stu-id="b2d0e-301">Project Kudu Wiki</span></span>](https://github.com/projectkudu/kudu/wiki)
