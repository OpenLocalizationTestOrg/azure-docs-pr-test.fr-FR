---
title: "Détails de la configuration réseau pour travailler avec ExpressRoute"
description: "Détails de la configuration réseau pour exécuter des environnements App Service sur des réseaux virtuels connectés à un circuit ExpressRoute."
services: app-service
documentationcenter: 
author: stefsch
manager: nirma
editor: 
ms.assetid: 34b49178-2595-4d32-9b41-110c96dde6bf
ms.service: app-service
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/14/2016
ms.author: stefsch
ms.openlocfilehash: de1d998ee86c127149dee18e9df577705054ddb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="network-configuration-details-for-app-service-environments-with-expressroute"></a><span data-ttu-id="22ba9-103">Détails de la configuration réseau pour les environnements App Service avec ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="22ba9-103">Network Configuration Details for App Service Environments with ExpressRoute</span></span>
## <a name="overview"></a><span data-ttu-id="22ba9-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="22ba9-104">Overview</span></span>
<span data-ttu-id="22ba9-105">Les clients peuvent connecter un circuit [Azure ExpressRoute][ExpressRoute] à leur infrastructure de réseau virtuel pour étendre leur réseau local à Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-105">Customers can connect an [Azure ExpressRoute][ExpressRoute] circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span>  <span data-ttu-id="22ba9-106">Vous pouvez créer un environnement App Service dans un sous-réseau de cette infrastructure de [réseau virtuel][virtualnetwork].</span><span class="sxs-lookup"><span data-stu-id="22ba9-106">An App Service Environment can  be created in a subnet of this [virtual network][virtualnetwork] infrastructure.</span></span>  <span data-ttu-id="22ba9-107">Les applications exécutées dans l'environnement App Service peuvent alors établir des connexions sécurisées à des ressources principales accessibles uniquement par le biais de la connexion ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-107">Apps running on the App Service Environment can then establish secure connections to back-end resources accessible only over the ExpressRoute connection.</span></span>  

<span data-ttu-id="22ba9-108">Un environnement App Service peut être créé **soit** dans un réseau virtuel Azure Resource Manager, **soit** dans un réseau virtuel de modèle de déploiement classique.</span><span class="sxs-lookup"><span data-stu-id="22ba9-108">An App Service Environment can be created in **either** an Azure Resource Manager virtual network, **or** a classic deployment model virtual network.</span></span>  <span data-ttu-id="22ba9-109">Grâce à une modification récente effectuée en juin 2016, les ASE peuvent désormais être déployés dans les réseaux virtuels qui utilisent soit des plages d’adresses publiques soit des espaces d’adressage RFC1918 (par exemple,</span><span class="sxs-lookup"><span data-stu-id="22ba9-109">With a recent change made in June 2016, ASEs can also now be deployed into virtual networks that use either public address ranges, or RFC1918 address spaces (i.e.</span></span> <span data-ttu-id="22ba9-110">des adresses privées).</span><span class="sxs-lookup"><span data-stu-id="22ba9-110">private addresses).</span></span> 

[!INCLUDE [app-service-web-to-api-and-mobile](../../includes/app-service-web-to-api-and-mobile.md)]

## <a name="required-network-connectivity"></a><span data-ttu-id="22ba9-111">Connectivité réseau requise</span><span class="sxs-lookup"><span data-stu-id="22ba9-111">Required Network Connectivity</span></span>
<span data-ttu-id="22ba9-112">Il existe des exigences de connectivité réseau pour les environnements App Service qui peuvent ne pas être initialement satisfaites dans un réseau virtuel connecté à ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-112">There are network connectivity requirements for App Service Environments that may not be initially met in a virtual network connected to an ExpressRoute.</span></span>  <span data-ttu-id="22ba9-113">Les environnements App Service requièrent tous les éléments suivants pour fonctionner correctement :</span><span class="sxs-lookup"><span data-stu-id="22ba9-113">App Service Environments require all of the following in order to function properly:</span></span>

* <span data-ttu-id="22ba9-114">Connectivité réseau sortante à des points de terminaison Azure Storage dans le monde entier sur les ports 80 et 443.</span><span class="sxs-lookup"><span data-stu-id="22ba9-114">Outbound network connectivity to Azure Storage endpoints worldwide on both ports 80 and 443.</span></span>  <span data-ttu-id="22ba9-115">Cela inclut les points de terminaison situés dans la même région que l’environnement App Service, ainsi que les points de terminaison de stockage situés dans d’ **autres** régions Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-115">This includes endpoints located in the same region as the App Service Environment, as well as storage endpoints located in **other** Azure regions.</span></span>  <span data-ttu-id="22ba9-116">Les points de terminaison Azure Storage se résolvent dans les domaines DNS suivants : *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* et *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="22ba9-116">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* and *file.core.windows.net*.</span></span>  
* <span data-ttu-id="22ba9-117">Connectivité réseau sortante au service de fichiers Azure sur le port 445.</span><span class="sxs-lookup"><span data-stu-id="22ba9-117">Outbound network connectivity to the Azure Files service on port 445.</span></span>
* <span data-ttu-id="22ba9-118">Connectivité réseau sortante à des points de terminaison BD SQL situés dans la même région que l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-118">Outbound network connectivity to Sql DB endpoints located in the same region as the App Service Environment.</span></span>  <span data-ttu-id="22ba9-119">Les points de terminaison de base de données SQL se résolvent dans le domaine suivant : *database.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="22ba9-119">Sql DB endpoints resolve under the following domain:  *database.windows.net*.</span></span>  <span data-ttu-id="22ba9-120">Cela suppose d’ouvrir l’accès aux ports 1433, 11000-11999 et 14000-14999.</span><span class="sxs-lookup"><span data-stu-id="22ba9-120">This requires opening access to ports 1433, 11000-11999 and 14000-14999.</span></span>  <span data-ttu-id="22ba9-121">Pour plus d’informations, consultez [cet article portant sur l’utilisation du port V12 de la base de données SQL](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).</span><span class="sxs-lookup"><span data-stu-id="22ba9-121">For more details see [this article on Sql Database V12 port usage](../sql-database/sql-database-develop-direct-route-ports-adonet-v12.md).</span></span>
* <span data-ttu-id="22ba9-122">Connectivité réseau sortante vers des points de terminaison du plan gestion Azure (points de terminaison ASM et ARM).</span><span class="sxs-lookup"><span data-stu-id="22ba9-122">Outbound network connectivity to the Azure management plane endpoints (both ASM and ARM endpoints).</span></span>  <span data-ttu-id="22ba9-123">Cela inclut la connexion sortante à *management.core.windows.net* et *management.azure.com*.</span><span class="sxs-lookup"><span data-stu-id="22ba9-123">This includes outbound connectivity to both *management.core.windows.net* and *management.azure.com*.</span></span> 
* <span data-ttu-id="22ba9-124">Connectivité réseau sortante à *ocsp.msocsp.com*, *mscrl.microsoft.com* et *crl.microsoft.com*.</span><span class="sxs-lookup"><span data-stu-id="22ba9-124">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com* and *crl.microsoft.com*.</span></span>  <span data-ttu-id="22ba9-125">Cela est nécessaire pour prendre en charge la fonctionnalité SSL.</span><span class="sxs-lookup"><span data-stu-id="22ba9-125">This is needed to support SSL functionality.</span></span>
* <span data-ttu-id="22ba9-126">La configuration DNS pour le réseau virtuel doit être capable de résoudre tous les points de terminaison et les domaines mentionnés dans les points précédents.</span><span class="sxs-lookup"><span data-stu-id="22ba9-126">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span>  <span data-ttu-id="22ba9-127">Si ces points de terminaison ne peuvent pas être résolus, les tentatives de création d'environnement App Service échoueront et les environnements App Service existants seront marqués comme non intègres.</span><span class="sxs-lookup"><span data-stu-id="22ba9-127">If these endpoints cannot be resolved, App Service Environment creation attempts will fail, and existing App Service Environments will be marked as unhealthy.</span></span>
* <span data-ttu-id="22ba9-128">L’accès sortant sur le port 53 est nécessaire pour la communication avec des serveurs DNS.</span><span class="sxs-lookup"><span data-stu-id="22ba9-128">Outbound access on port 53 is required for communication with DNS servers.</span></span>
* <span data-ttu-id="22ba9-129">S'il existe un serveur DNS personnalisé à l'autre extrémité d'une passerelle VPN, le serveur DNS doit être accessible depuis le sous-réseau contenant l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-129">If a custom DNS server exists on the other end of a VPN gateway, the DNS server must be reachable from the subnet containing the App Service Environment.</span></span> 
* <span data-ttu-id="22ba9-130">Le chemin d'accès réseau sortant ne peut pas traverser des proxys d'entreprise internes et il ne peut pas non plus être tunnelé de force en local.</span><span class="sxs-lookup"><span data-stu-id="22ba9-130">The outbound network path cannot travel through internal corporate proxies, nor can it be force tunneled to on-premises.</span></span>  <span data-ttu-id="22ba9-131">Ceci modifie l'adresse NAT réelle du trafic réseau sortant à partir de l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-131">Doing so changes the effective NAT address of outbound network traffic from the App Service Environment.</span></span>  <span data-ttu-id="22ba9-132">La modification de l'adresse NAT du trafic réseau sortant d'un environnement App Service entraînera des échecs de connectivité vers plusieurs des points de terminaison répertoriés ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="22ba9-132">Changing the NAT address of an App Service Environment's outbound network traffic will cause connectivity failures to many of the endpoints listed above.</span></span>  <span data-ttu-id="22ba9-133">Cela entraîne des échecs de création d'environnement App Service, ainsi que la désignation comme non intègres des environnements App Service précédemment considérés comme intègres.</span><span class="sxs-lookup"><span data-stu-id="22ba9-133">This results in failed App Service Environment creation attempts, as well as previously healthy App Service Environments being marked as unhealthy.</span></span>  
* <span data-ttu-id="22ba9-134">L’accès réseau entrant vers les ports nécessaires aux environnements App Service doit être autorisé, comme décrit dans cet [article][requiredports].</span><span class="sxs-lookup"><span data-stu-id="22ba9-134">Inbound network access to required ports for App Service Environments must be allowed as described in this [article][requiredports].</span></span>

<span data-ttu-id="22ba9-135">La configuration DNS requise peut être satisfaite en garantissant qu'une infrastructure DNS valide est configurée et gérée pour le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="22ba9-135">The DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>  <span data-ttu-id="22ba9-136">Si, pour une raison quelconque, la configuration DNS est modifiée après la création d'un environnement App Service, les développeurs peuvent forcer un environnement App Service à récupérer la nouvelle configuration DNS.</span><span class="sxs-lookup"><span data-stu-id="22ba9-136">If for any reason the DNS configuration is changed after an App Service Environment has been created, developers can force an App Service Environment to pick up the new DNS configuration.</span></span>  <span data-ttu-id="22ba9-137">Le déclenchement du redémarrage d’un environnement propagé à l’aide de l’icône « Redémarrer » située en haut du panneau de gestion de l’environnement App Service du [portail Azure][NewPortal] force l’environnement à récupérer la nouvelle configuration DNS.</span><span class="sxs-lookup"><span data-stu-id="22ba9-137">Triggering a rolling environment reboot using the "Restart" icon located at the top of the App Service Environment management blade in the [Azure portal][NewPortal] will cause the environment to pick up the new DNS configuration.</span></span>

<span data-ttu-id="22ba9-138">Les conditions d’accès au réseau entrant peuvent être remplies en configurant un [groupe de sécurité réseau][NetworkSecurityGroups] sur le sous-réseau de l’environnement App Service pour autoriser l’accès nécessaire, comme décrit dans cet [article][requiredports].</span><span class="sxs-lookup"><span data-stu-id="22ba9-138">The inbound network access requirements can be met by configuring a [network security group][NetworkSecurityGroups] on the App Service Environment's subnet to allow the required access as described in this [article][requiredports].</span></span>

## <a name="enabling-outbound-network-connectivity-for-an-app-service-environment"></a><span data-ttu-id="22ba9-139">Activation de la connectivité réseau sortante pour un environnement App Service</span><span class="sxs-lookup"><span data-stu-id="22ba9-139">Enabling Outbound Network Connectivity for an App Service Environment</span></span>
<span data-ttu-id="22ba9-140">Par défaut, un circuit ExpressRoute nouvellement créé publie un itinéraire par défaut qui autorise la connectivité Internet sortante.</span><span class="sxs-lookup"><span data-stu-id="22ba9-140">By default, a newly created ExpressRoute circuit advertises a default route that allows outbound Internet connectivity.</span></span>  <span data-ttu-id="22ba9-141">Avec cette configuration, un environnement App Service sera en mesure de se connecter à d'autres points de terminaison Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-141">With this configuration an App Service Environment will be able to connect to other Azure endpoints.</span></span>

<span data-ttu-id="22ba9-142">Toutefois, une configuration client courante consiste à définir un itinéraire par défaut (0.0.0.0/0), ce qui force le trafic Internet sortant à évoluer sur site.</span><span class="sxs-lookup"><span data-stu-id="22ba9-142">However a common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span>  <span data-ttu-id="22ba9-143">Ce flux de trafic décompose invariablement les environnements App Service, car le trafic sortant est soit bloqué sur site, soit fait l'objet d'une opération NAT sur un jeu d'adresses non reconnaissable qui ne fonctionne plus avec différents points de terminaison Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-143">This traffic flow invariably breaks App Service Environments because the outbound traffic is either blocked on-premises, or NAT'd to an unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span>

<span data-ttu-id="22ba9-144">La solution consiste à définir un (ou plusieurs) itinéraires définis par l'utilisateur (UDR) sur le sous-réseau qui contient l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-144">The solution is to define one (or more) user defined routes (UDRs) on the subnet that contains the App Service Environment.</span></span>  <span data-ttu-id="22ba9-145">Un itinéraire défini par l'utilisateur définit des itinéraires spécifiques au sous-réseau qui seront respectés au lieu de l'itinéraire par défaut.</span><span class="sxs-lookup"><span data-stu-id="22ba9-145">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="22ba9-146">Si possible, il est recommandé d'utiliser la configuration suivante :</span><span class="sxs-lookup"><span data-stu-id="22ba9-146">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="22ba9-147">La configuration ExpressRoute annonce 0.0.0.0/0 et par défaut, tunnelise de force tout le trafic sortant sur site.</span><span class="sxs-lookup"><span data-stu-id="22ba9-147">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="22ba9-148">L'UDR (itinéraire défini par l'utilisateur) appliqué au sous-réseau contenant l'environnement App Service définit 0.0.0.0/0 avec Internet de type saut suivant (un exemple de ceci est présenté plus bas dans cet article).</span><span class="sxs-lookup"><span data-stu-id="22ba9-148">The UDR applied to the subnet containing the App Service Environment defines 0.0.0.0/0 with a next hop type of Internet (an example of this is farther down in this article).</span></span>

<span data-ttu-id="22ba9-149">L'effet combiné de ces étapes est que l'UDR de niveau sous-réseau a la priorité sur le tunneling forcé ExpressRoute, garantissant ainsi un accès Internet sortant à partir de l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-149">The combined effect of these steps is that the subnet level UDR will take precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the App Service Environment.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="22ba9-150">Les itinéraires définis dans un UDR **doivent** être suffisamment spécifiques pour avoir la priorité sur les itinéraires annoncés par la configuration ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-150">The routes defined in a UDR **must** be specific enough to  take precedence over any routes advertised by the ExpressRoute configuration.</span></span>  <span data-ttu-id="22ba9-151">L'exemple ci-dessous utilise la plage d'adresses 0.0.0.0/0 étendue qui peut potentiellement être remplacée accidentellement par les annonces de routage à l'aide de plages d'adresses plus spécifiques.</span><span class="sxs-lookup"><span data-stu-id="22ba9-151">The example below uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>
> 
> <span data-ttu-id="22ba9-152">Les environnements App Service ne sont pas pris en charge avec les configurations ExpressRoute qui **publient de façon croisée des itinéraires à partir du chemin d’accès d’homologation publique vers le chemin d’accès d’homologation privée**.</span><span class="sxs-lookup"><span data-stu-id="22ba9-152">App Service Environments are not supported with ExpressRoute configurations that **cross-advertise routes from the public peering path to the private peering path**.</span></span>  <span data-ttu-id="22ba9-153">Les configurations ExpressRoute ayant une homologation publique configurée reçoivent les annonces de routage depuis Microsoft pour un grand ensemble de plages d'adresses IP Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-153">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span>  <span data-ttu-id="22ba9-154">Si ces plages d’adresses sont publiées de façon croisée sur le chemin d’accès d’homologation privée, il en résulte que tous les paquets réseau sortants du sous-réseau de l’environnement App Service seront acheminés de force vers l’infrastructure réseau sur site d’un client.</span><span class="sxs-lookup"><span data-stu-id="22ba9-154">If these address ranges are cross-advertised on the private peering path, the end result is that all outbound network packets from the App Service Environment's subnet will be force-tunneled to a customer's on-premises network infrastructure.</span></span>  <span data-ttu-id="22ba9-155">Ce flux de réseau n’est actuellement pas pris en charge par les environnements App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-155">This network flow is currently not supported with App Service Environments.</span></span>  <span data-ttu-id="22ba9-156">L’une des solutions à ce problème consiste à arrêter les itinéraires croisés depuis le chemin d’accès d’homologation publique vers le chemin d’accès d’homologation privée.</span><span class="sxs-lookup"><span data-stu-id="22ba9-156">One solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>
> 
> 

<span data-ttu-id="22ba9-157">Vous trouverez des informations générales sur les itinéraires définis par l'utilisateur dans cette [présentation][UDROverview].</span><span class="sxs-lookup"><span data-stu-id="22ba9-157">Background information on user defined routes is available in this [overview][UDROverview].</span></span>  

<span data-ttu-id="22ba9-158">Pour plus d’informations sur la création et la configuration d’itinéraires définis par l’utilisateur, consultez ce [Guide pratique][UDRHowTo].</span><span class="sxs-lookup"><span data-stu-id="22ba9-158">Details on creating and configuring user defined routes is available in this [How To Guide][UDRHowTo].</span></span>

## <a name="example-udr-configuration-for-an-app-service-environment"></a><span data-ttu-id="22ba9-159">Exemple de configuration d'itinéraire défini par l'utilisateur pour un environnement App Service</span><span class="sxs-lookup"><span data-stu-id="22ba9-159">Example UDR Configuration for an App Service Environment</span></span>
<span data-ttu-id="22ba9-160">**Conditions préalables**</span><span class="sxs-lookup"><span data-stu-id="22ba9-160">**Pre-requisites**</span></span>

1. <span data-ttu-id="22ba9-161">Installez Azure Powershell à partir de la [page Téléchargements Azure][AzureDownloads] (datant de juin 2015 ou plus récent).</span><span class="sxs-lookup"><span data-stu-id="22ba9-161">Install Azure Powershell from the [Azure Downloads page][AzureDownloads] (dated June 2015 or later).</span></span>  <span data-ttu-id="22ba9-162">Sous « Outils de ligne de commande », un lien « Installer » sous « Windows Powershell » permet d'installer les dernières applets de commande Powershell.</span><span class="sxs-lookup"><span data-stu-id="22ba9-162">Under "Command-line tools" there is an "Install" link under "Windows Powershell" that will install the latest Powershell cmdlets.</span></span>
2. <span data-ttu-id="22ba9-163">Nous vous recommandons de créer un sous-réseau unique pour un usage exclusif par un environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-163">It is recommended that a unique subnet is created for exclusive use by an App Service Environment.</span></span>  <span data-ttu-id="22ba9-164">Ceci garantit que les itinéraires définis par l'utilisateur appliqués au sous-réseau ouvriront uniquement le trafic sortant pour l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-164">This ensures that the UDRs applied to the subnet will only open outbound traffic for the App Service Environment.</span></span>
3. <span data-ttu-id="22ba9-165">**Important** : ne déployez pas l’environnement App Service **avant** d’avoir exécuté les étapes de configuration suivantes.</span><span class="sxs-lookup"><span data-stu-id="22ba9-165">**Important**:  do not deploy the App Service Environment until **after** the following configuration steps are followed.</span></span>  <span data-ttu-id="22ba9-166">Ceci garantit que la connectivité réseau sortante est disponible avant la tentative de déploiement d'un environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-166">This ensures that outbound network connectivity is available before attempting to deploy an App Service Environment.</span></span>

<span data-ttu-id="22ba9-167">**Étape 1 : Créer une table d’itinéraires nommée**</span><span class="sxs-lookup"><span data-stu-id="22ba9-167">**Step 1:  Create a named route table**</span></span>

<span data-ttu-id="22ba9-168">L'extrait de code suivant crée une table d'itinéraires appelée « DirectInternetRouteTable » dans la région Azure Ouest des États-Unis :</span><span class="sxs-lookup"><span data-stu-id="22ba9-168">The following snippet creates a route table called "DirectInternetRouteTable" in the West US Azure region:</span></span>

    New-AzureRouteTable -Name 'DirectInternetRouteTable' -Location uswest

<span data-ttu-id="22ba9-169">**Étape 2 : Créer un ou plusieurs itinéraires dans la table**</span><span class="sxs-lookup"><span data-stu-id="22ba9-169">**Step 2:  Create one or more routes in the route table**</span></span>

<span data-ttu-id="22ba9-170">Vous devrez ajouter un ou plusieurs itinéraires à la table afin d'activer l'accès Internet sortant.</span><span class="sxs-lookup"><span data-stu-id="22ba9-170">You will need to add one or more routes to the route table in order to enable outbound Internet access.</span></span>  

<span data-ttu-id="22ba9-171">L'approche recommandée pour la configuration d'un accès sortant à Internet consiste à définir un itinéraire pour 0.0.0.0/0 comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="22ba9-171">The recommended approach for configuring outbound access to the Internet is to define a route for 0.0.0.0/0 as shown below.</span></span>

    Get-AzureRouteTable -Name 'DirectInternetRouteTable' | Set-AzureRoute -RouteName 'Direct Internet Range 0' -AddressPrefix 0.0.0.0/0 -NextHopType Internet

<span data-ttu-id="22ba9-172">N’oubliez pas que 0.0.0.0/0 est une plage d’adresses étendue et, par conséquent, elle sera remplacée par les plages d’adresses plus spécifiques publiées par ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-172">Remember that 0.0.0.0/0 is a broad address range, and as such will be overridden by more specific address ranges advertised by the ExpressRoute.</span></span>  <span data-ttu-id="22ba9-173">Pour réitérer la recommandation antérieure, un UDR avec un itinéraire 0.0.0.0/0 doit être utilisé conjointement avec une configuration ExressRoute qui publie uniquement 0.0.0.0/0 également.</span><span class="sxs-lookup"><span data-stu-id="22ba9-173">To re-iterate the earlier recommendation, a UDR with a 0.0.0.0/0 route should be used in conjunction with an ExressRoute configuration that only advertises 0.0.0.0/0 as well.</span></span> 

<span data-ttu-id="22ba9-174">Comme alternative, vous pouvez télécharger une liste complète et mise à jour des plages CIDR utilisées par Azure.</span><span class="sxs-lookup"><span data-stu-id="22ba9-174">As an alternative, you can download a comprehensive and updated list of CIDR ranges in use by Azure.</span></span>  <span data-ttu-id="22ba9-175">Le fichier XML qui contient toutes les plages d’adresses IP Azure est disponible dans le [Centre de téléchargement Microsoft][DownloadCenterAddressRanges].</span><span class="sxs-lookup"><span data-stu-id="22ba9-175">The Xml file containing all of the Azure IP address ranges is available from the [Microsoft Download Center][DownloadCenterAddressRanges].</span></span>  

<span data-ttu-id="22ba9-176">Notez toutefois que ces plages changent au fil du temps, d’où la nécessité d’effectuer des mises à jour manuelles périodiques pour maintenir la synchronisation des itinéraires définis par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="22ba9-176">Note though that these ranges change over time, thus necessitating periodic manual updates to the user defined routes to keep in sync.</span></span>  <span data-ttu-id="22ba9-177">En outre, étant donné la limite maximale par défaut de 100 itinéraires dans un seul UDR, vous devrez « résumer » les plages d’adresses IP Azure pour respecter la limite de 100 itinéraires. N’oubliez pas que les itinéraires définis par UDR doivent être plus spécifiques que les itinéraires publiés par votre ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-177">Also, since there is a default upper limit of 100 routes in a single UDR, you will need to "summarize" the Azure IP address ranges to fit within the 100 route limit, keeping in mind that UDR defined routes need to be more specific than the routes advertised by your ExpressRoute.</span></span>  

<span data-ttu-id="22ba9-178">**Étape 3 : Associer la table d’itinéraires au sous-réseau contenant l’environnement App Service**</span><span class="sxs-lookup"><span data-stu-id="22ba9-178">**Step 3:  Associate the route table to the subnet containing the App Service Environment**</span></span>

<span data-ttu-id="22ba9-179">La dernière étape de configuration consiste à associer la table d’itinéraires au sous-réseau où l’environnement App Service sera déployé.</span><span class="sxs-lookup"><span data-stu-id="22ba9-179">The last  configuration step is to associate the route table to the subnet where the App Service Environment will be deployed.</span></span>  <span data-ttu-id="22ba9-180">La commande suivante associe « DirectInternetRouteTable » à « ASESubnet » qui contiendra un environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-180">The following command associates the "DirectInternetRouteTable" to the "ASESubnet" that will eventually contain an App Service Environment.</span></span>

    Set-AzureSubnetRouteTable -VirtualNetworkName 'YourVirtualNetworkNameHere' -SubnetName 'ASESubnet' -RouteTableName 'DirectInternetRouteTable'


<span data-ttu-id="22ba9-181">**Étape 4 : Étapes finales**</span><span class="sxs-lookup"><span data-stu-id="22ba9-181">**Step 4:  Final Steps**</span></span>

<span data-ttu-id="22ba9-182">Une fois que la table d'itinéraires est liée au sous-réseau, nous vous recommandons de tester et confirmer le résultat souhaité.</span><span class="sxs-lookup"><span data-stu-id="22ba9-182">Once the route table is bound to the subnet, it is recommended to first test and confirm the intended effect.</span></span>  <span data-ttu-id="22ba9-183">Par exemple, déployez une machine virtuelle sur le sous-réseau et vérifiez que :</span><span class="sxs-lookup"><span data-stu-id="22ba9-183">For example, deploy a virtual machine into the subnet and confirm that:</span></span>

* <span data-ttu-id="22ba9-184">Le trafic sortant vers des points de terminaison Azure et non Azure mentionné précédemment dans cet article n'est **pas** transmis vers le circuit ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="22ba9-184">Outbound traffic to both Azure and non-Azure endpoints mentioned earlier in this article is **not** flowing down the ExpressRoute circuit.</span></span>  <span data-ttu-id="22ba9-185">Il est très important de vérifier ce comportement, car si le trafic sortant à partir du sous-réseau est toujours tunnelisé de force sur site, la création d'un environnement App Service échouera toujours.</span><span class="sxs-lookup"><span data-stu-id="22ba9-185">It is very important to verify this behavior, since if outbound traffic from the subnet is still being forced tunneled on-premises, App Service Environment creation will always fail.</span></span> 
* <span data-ttu-id="22ba9-186">Les recherches DNS de points de terminaison mentionnées plus haut se résolvent toutes correctement.</span><span class="sxs-lookup"><span data-stu-id="22ba9-186">DNS lookups for the endpoints mentioned earlier are all resolving properly.</span></span> 

<span data-ttu-id="22ba9-187">Une fois les étapes ci-dessus confirmées, vous devrez supprimer la machine virtuelle car le sous-réseau doit être « vide » au moment de la création de l'environnement App Service.</span><span class="sxs-lookup"><span data-stu-id="22ba9-187">Once the above steps are confirmed, you will need to delete the virtual machine because the subnet needs to be "empty" at the time the App Service Environment is created.</span></span>

<span data-ttu-id="22ba9-188">Puis, passez à la création d'un environnement App Service !</span><span class="sxs-lookup"><span data-stu-id="22ba9-188">Then proceed with creating an App Service Environment!</span></span>

## <a name="getting-started"></a><span data-ttu-id="22ba9-189">Prise en main</span><span class="sxs-lookup"><span data-stu-id="22ba9-189">Getting started</span></span>
<span data-ttu-id="22ba9-190">Tous les articles et procédures concernant les environnements App Service sont disponibles dans le [fichier Lisez-moi des environnements App Service](../app-service/app-service-app-service-environments-readme.md).</span><span class="sxs-lookup"><span data-stu-id="22ba9-190">All articles and How-To's for App Service Environments are available in the [README for Application Service Environments](../app-service/app-service-app-service-environments-readme.md).</span></span>

<span data-ttu-id="22ba9-191">Pour bien démarrer avec les environnements App Service, consultez [Présentation de l’environnement App Service][IntroToAppServiceEnvironment]</span><span class="sxs-lookup"><span data-stu-id="22ba9-191">To get started with App Service Environments, see [Introduction to App Service Environment][IntroToAppServiceEnvironment]</span></span>

<span data-ttu-id="22ba9-192">Pour plus d’informations sur la plateforme Azure App Service, consultez la rubrique [Azure App Service][AzureAppService].</span><span class="sxs-lookup"><span data-stu-id="22ba9-192">For more information about the Azure App Service platform, see [Azure App Service][AzureAppService].</span></span>

<!-- LINKS -->
[virtualnetwork]: http://azure.microsoft.com/services/virtual-network/
[ExpressRoute]: http://azure.microsoft.com/services/expressroute/
[requiredports]: http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-control-inbound-traffic/
[NetworkSecurityGroups]: http://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[UDROverview]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-overview/
[UDRHowTo]: http://azure.microsoft.com/documentation/articles/virtual-networks-udr-how-to/
[HowToCreateAnAppServiceEnvironment]: http://azure.microsoft.com/documentation/articles/app-service-web-how-to-create-an-app-service-environment/
[AzureDownloads]: http://azure.microsoft.com/en-us/downloads/ 
[DownloadCenterAddressRanges]: http://www.microsoft.com/download/details.aspx?id=41653  
[NetworkSecurityGroups]: https://azure.microsoft.com/documentation/articles/virtual-networks-nsg/
[AzureAppService]: http://azure.microsoft.com/documentation/articles/app-service-value-prop-what-is/
[IntroToAppServiceEnvironment]:  http://azure.microsoft.com/documentation/articles/app-service-app-service-environment-intro/
[NewPortal]:  https://portal.azure.com


<!-- IMAGES -->
