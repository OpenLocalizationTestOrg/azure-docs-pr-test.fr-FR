---
title: aaaAzure, appareils IoT SDK pour C - IoTHubClient | Documents Microsoft
description: "La bibliothèque de IoTHubClient toouse hello dans le dispositif hello Azure IoT SDK des applications d’appareil toocreate C qui communiquent avec un hub IoT."
services: iot-hub
documentationcenter: 
author: olivierbloch
manager: timlt
editor: 
ms.assetid: 828cf2bf-999d-4b8a-8a28-c7c901629600
ms.service: iot-hub
ms.devlang: cpp
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 09/06/2016
ms.author: obloch
ms.openlocfilehash: d1ece79e9ba6d1e5fd45cabb8fca393b24052e07
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-iot-device-sdk-for-c--more-about-iothubclient"></a><span data-ttu-id="7e895-103">Kit de développement logiciel d’appareil Azure IoT pour C : en savoir plus sur IoTHubClient</span><span class="sxs-lookup"><span data-stu-id="7e895-103">Azure IoT device SDK for C – more about IoTHubClient</span></span>
<span data-ttu-id="7e895-104">Hello [tout d’abord l’article](iot-hub-device-sdk-c-intro.md) cette Bonjour série introduites **appareil Azure IoT SDK pour C**. Cet article explique qu’il existe deux couches architecturales dans le Kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="7e895-104">hello [first article](iot-hub-device-sdk-c-intro.md) in this series introduced hello **Azure IoT device SDK for C**. That article explained that there are two architectural layers in SDK.</span></span> <span data-ttu-id="7e895-105">À la base de hello est hello **IoTHubClient** bibliothèque qui gère la communication avec IoT Hub directement.</span><span class="sxs-lookup"><span data-stu-id="7e895-105">At hello base is hello **IoTHubClient** library which directly manages communication with IoT Hub.</span></span> <span data-ttu-id="7e895-106">Il est également hello **sérialiseur** bibliothèque qui génère tooprovide de services de sérialisation.</span><span class="sxs-lookup"><span data-stu-id="7e895-106">There's also hello **serializer** library that builds on top of that tooprovide serialization services.</span></span> <span data-ttu-id="7e895-107">Dans cet article, nous fournissons des détails supplémentaires sur hello **IoTHubClient** bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="7e895-107">In this article we'll provide additional detail on hello **IoTHubClient** library.</span></span>

<span data-ttu-id="7e895-108">Hello précédent article décrit comment toouse hello **IoTHubClient** bibliothèque toosend événements tooIoT Hub et recevoir des messages.</span><span class="sxs-lookup"><span data-stu-id="7e895-108">hello previous article described how toouse hello **IoTHubClient** library toosend events tooIoT Hub and receive messages.</span></span> <span data-ttu-id="7e895-109">Cet article étend cette discussion et explique comment gérer précisément toomore *lorsque* vous envoyer et recevoir des données, elle vous initiant toohello **API de niveau inférieur**.</span><span class="sxs-lookup"><span data-stu-id="7e895-109">This article extends that discussion by explaining how toomore precisely manage *when* you send and receive data, introducing you toohello **lower-level APIs**.</span></span> <span data-ttu-id="7e895-110">Nous allons également expliquer comment tooattach propriétés tooevents (et les récupérer à partir de messages) à l’aide de la propriété hello la gestion des fonctionnalités de hello **IoTHubClient** bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="7e895-110">We'll also explain how tooattach properties tooevents (and retrieve them from messages) using hello property handling features in hello **IoTHubClient** library.</span></span> <span data-ttu-id="7e895-111">Enfin, nous fournissons une explication supplémentaire de différentes façons toohandle messages reçus à partir de IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-111">Finally, we'll provide additional explanation of different ways toohandle messages received from IoT Hub.</span></span>

<span data-ttu-id="7e895-112">Hello article se termine en couvrant plusieurs rubriques divers, y compris les plus sur les informations d’identification de l’appareil et comment toochange hello comportement Hello **IoTHubClient** les options de configuration.</span><span class="sxs-lookup"><span data-stu-id="7e895-112">hello article concludes by covering a couple of miscellaneous topics, including more about device credentials and how toochange hello behavior of hello **IoTHubClient** through configuration options.</span></span>

<span data-ttu-id="7e895-113">Nous allons utiliser hello **IoTHubClient** SDK exemples tooexplain ces rubriques.</span><span class="sxs-lookup"><span data-stu-id="7e895-113">We'll use hello **IoTHubClient** SDK samples tooexplain these topics.</span></span> <span data-ttu-id="7e895-114">Si vous souhaitez toofollow le long, consultez hello **iothub\_client\_exemple\_http** et **iothub\_client\_exemple\_amqp** les applications qui sont incluses dans le dispositif de Azure IoT hello SDK pour C. tous les éléments décrits dans les sections suivantes de hello est illustré dans ces exemples.</span><span class="sxs-lookup"><span data-stu-id="7e895-114">If you want toofollow along, see hello **iothub\_client\_sample\_http** and **iothub\_client\_sample\_amqp** applications that are included in hello Azure IoT device SDK for C. Everything described in hello following sections is demonstrated in these samples.</span></span>

<span data-ttu-id="7e895-115">Vous pouvez trouver hello [ **appareil Azure IoT SDK pour C** ](https://github.com/Azure/azure-iot-sdk-c) GitHub référentiel et consulter les détails de hello API Bonjour [référence d’API C](https://azure.github.io/azure-iot-sdk-c/index.html).</span><span class="sxs-lookup"><span data-stu-id="7e895-115">You can find hello [**Azure IoT device SDK for C**](https://github.com/Azure/azure-iot-sdk-c) GitHub repository and view details of hello API in hello [C API reference](https://azure.github.io/azure-iot-sdk-c/index.html).</span></span>

## <a name="hello-lower-level-apis"></a><span data-ttu-id="7e895-116">Hello API de niveau inférieur</span><span class="sxs-lookup"><span data-stu-id="7e895-116">hello lower-level APIs</span></span>
<span data-ttu-id="7e895-117">article précédent de Hello décrit les opérations de base hello Hello **IotHubClient** au sein du contexte hello Hello **iothub\_client\_exemple\_amqp** application.</span><span class="sxs-lookup"><span data-stu-id="7e895-117">hello previous article described hello basic operation of hello **IotHubClient** within hello context of hello **iothub\_client\_sample\_amqp** application.</span></span> <span data-ttu-id="7e895-118">Par exemple, il explique comment tooinitialize hello bibliothèque à l’aide de ce code.</span><span class="sxs-lookup"><span data-stu-id="7e895-118">For example, it explained how tooinitialize hello library using this code.</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="7e895-119">Il décrit également comment les événements de toosend à l’aide de cette appel de fonction.</span><span class="sxs-lookup"><span data-stu-id="7e895-119">It also described how toosend events using this function call.</span></span>

```
IoTHubClient_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message);
```

<span data-ttu-id="7e895-120">article de Hello décrit également comment les messages tooreceive en inscrivant une fonction de rappel.</span><span class="sxs-lookup"><span data-stu-id="7e895-120">hello article also described how tooreceive messages by registering a callback function.</span></span>

```
int receiveContext = 0;
IoTHubClient_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext);
```

<span data-ttu-id="7e895-121">article de Hello a également montré comment toofree les ressources à l’aide de code tels que les suivants hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-121">hello article also showed how toofree resources using code such as hello following.</span></span>

```
IoTHubClient_Destroy(iotHubClientHandle);
```

<span data-ttu-id="7e895-122">Il existe toutefois des tooeach de fonctions d’accompagnement de ces API :</span><span class="sxs-lookup"><span data-stu-id="7e895-122">However there are companion functions tooeach of these APIs:</span></span>

* <span data-ttu-id="7e895-123">IoTHubClient\_LL\_CreateFromConnectionString</span><span class="sxs-lookup"><span data-stu-id="7e895-123">IoTHubClient\_LL\_CreateFromConnectionString</span></span>
* <span data-ttu-id="7e895-124">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="7e895-124">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="7e895-125">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="7e895-125">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="7e895-126">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="7e895-126">IoTHubClient\_LL\_Destroy</span></span>

<span data-ttu-id="7e895-127">Ces fonctions tous incluent « LL » dans le nom de l’API hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-127">These functions all include “LL” in hello API name.</span></span> <span data-ttu-id="7e895-128">Reste, paramètres hello de chacune de ces fonctions sont équivalents et de non-LL tootheir identiques.</span><span class="sxs-lookup"><span data-stu-id="7e895-128">Other than that, hello parameters of each of these functions are identical tootheir non-LL counterparts.</span></span> <span data-ttu-id="7e895-129">Toutefois, le comportement hello de ces fonctions est différent sur un point important.</span><span class="sxs-lookup"><span data-stu-id="7e895-129">However, hello behavior of these functions is different in one important way.</span></span>

<span data-ttu-id="7e895-130">Lorsque vous appelez **IoTHubClient\_CreateFromConnectionString**, les bibliothèques sous-jacentes hello créent un nouveau thread qui s’exécute en arrière-plan de hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-130">When you call **IoTHubClient\_CreateFromConnectionString**, hello underlying libraries create a new thread that runs in hello background.</span></span> <span data-ttu-id="7e895-131">Ce thread envoie les événements vers IoT Hub et reçoit les messages émanant d’IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-131">This thread sends events to, and receives messages from, IoT Hub.</span></span> <span data-ttu-id="7e895-132">Aucun thread n’est créé lorsque vous travaillez avec hello « LL » API.</span><span class="sxs-lookup"><span data-stu-id="7e895-132">No such thread is created when working with hello "LL" APIs.</span></span> <span data-ttu-id="7e895-133">la création du thread d’arrière-plan hello Hello est développeur toohello plus de commodité.</span><span class="sxs-lookup"><span data-stu-id="7e895-133">hello creation of hello background thread is a convenience toohello developer.</span></span> <span data-ttu-id="7e895-134">Vous n’avez pas tooworry sur l’envoi d’événements et la réception de messages à partir de IoT Hub--il se produit automatiquement en arrière-plan de hello explicitement.</span><span class="sxs-lookup"><span data-stu-id="7e895-134">You don’t have tooworry about explicitly sending events and receiving messages from IoT Hub -- it happens automatically in hello background.</span></span> <span data-ttu-id="7e895-135">En revanche, hello « LL » API vous donner un contrôle explicite sur la communication avec IoT Hub, si vous en avez besoin.</span><span class="sxs-lookup"><span data-stu-id="7e895-135">In contrast, hello "LL" APIs give you explicit control over communication with IoT Hub, if you need it.</span></span>

<span data-ttu-id="7e895-136">toounderstand cette favorable, examinons un exemple :</span><span class="sxs-lookup"><span data-stu-id="7e895-136">toounderstand this better, let’s look at an example:</span></span>

<span data-ttu-id="7e895-137">Lorsque vous appelez **IoTHubClient\_SendEventAsync**, ce que vous faites réellement pour placer des événements de hello dans une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="7e895-137">When you call **IoTHubClient\_SendEventAsync**, what you're actually doing is putting hello event in a buffer.</span></span> <span data-ttu-id="7e895-138">Hello thread d’arrière-plan créé quand vous appelez **IoTHubClient\_CreateFromConnectionString** continuellement surveille cette mémoire tampon et envoie des données qu’il contient tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-138">hello background thread created when you call **IoTHubClient\_CreateFromConnectionString** continually monitors this buffer and sends any data that it contains tooIoT Hub.</span></span> <span data-ttu-id="7e895-139">Dans ce cas en arrière-plan hello en hello en même temps que hello thread principal exécute un autre travail.</span><span class="sxs-lookup"><span data-stu-id="7e895-139">This happens in hello background at hello same time that hello main thread is performing other work.</span></span>

<span data-ttu-id="7e895-140">De même, lorsque vous enregistrez une fonction de rappel pour les messages à l’aide de **IoTHubClient\_SetMessageCallback**, vous êtes demandant d’arrière-plan de hello SDK toohave hello thread appeler la fonction de rappel hello lorsqu’un message reçu, indépendamment du thread principal de hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-140">Similarly, when you register a callback function for messages using **IoTHubClient\_SetMessageCallback**, you're instructing hello SDK toohave hello background thread invoke hello callback function when a message is received, independent of hello main thread.</span></span>

<span data-ttu-id="7e895-141">Hello « LL » API ne créez pas un thread d’arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="7e895-141">hello "LL" APIs don’t create a background thread.</span></span> <span data-ttu-id="7e895-142">Au lieu de cela, une nouvelle API doit être appelée tooexplicitly envoyer et recevoir des données à partir de IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-142">Instead, a new API must be called tooexplicitly send and receive data from IoT Hub.</span></span> <span data-ttu-id="7e895-143">Cela est illustré dans hello l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="7e895-143">This is demonstrated in hello following example.</span></span>

<span data-ttu-id="7e895-144">Hello **iothub\_client\_exemple\_http** application qui est incluse dans hello SDK montre hello API de niveau inférieur.</span><span class="sxs-lookup"><span data-stu-id="7e895-144">hello **iothub\_client\_sample\_http** application that’s included in hello SDK demonstrates hello lower-level APIs.</span></span> <span data-ttu-id="7e895-145">Dans cet exemple, nous envoyer des événements tooIoT concentrateur avec le code suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="7e895-145">In that sample, we send events tooIoT Hub with code such as hello following:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Message_%d_From_IoTHubClient_LL_Over_HTTP", i);
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));

IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="7e895-146">message de type hello créent Hello trois premières lignes et dernière ligne de hello envoie les événements hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-146">hello first three lines create hello message, and hello last line sends hello event.</span></span> <span data-ttu-id="7e895-147">Toutefois, comme mentionné précédemment, « envoi » les événements hello signifie que les données de salutation sont simplement placées dans une mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="7e895-147">However, as mentioned previously, "sending" hello event means that hello data is simply placed in a buffer.</span></span> <span data-ttu-id="7e895-148">Rien n’est transmis sur le réseau de hello lorsque nous appelons **IoTHubClient\_LL\_SendEventAsync**.</span><span class="sxs-lookup"><span data-stu-id="7e895-148">Nothing is transmitted on hello network when we call **IoTHubClient\_LL\_SendEventAsync**.</span></span> <span data-ttu-id="7e895-149">Dans l’ordre tooactually entrée hello données tooIoT Hub, vous devez appeler **IoTHubClient\_LL\_DoWork**, comme dans cet exemple :</span><span class="sxs-lookup"><span data-stu-id="7e895-149">In order tooactually ingress hello data tooIoT Hub, you must call **IoTHubClient\_LL\_DoWork**, as in this example:</span></span>

```
while (1)
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="7e895-150">Ce code (à partir de hello **iothub\_client\_exemple\_http** application) appelle à plusieurs reprises **IoTHubClient\_LL\_DoWork** .</span><span class="sxs-lookup"><span data-stu-id="7e895-150">This code (from hello **iothub\_client\_sample\_http** application) repeatedly calls **IoTHubClient\_LL\_DoWork**.</span></span> <span data-ttu-id="7e895-151">Chaque fois que **IoTHubClient\_LL\_DoWork** est appelé, il envoie certains événements de tooIoT de mémoire tampon hello Hub et il récupère un message en file d’attente envoyé toohello appareil.</span><span class="sxs-lookup"><span data-stu-id="7e895-151">Each time **IoTHubClient\_LL\_DoWork** is called, it sends some events from hello buffer tooIoT Hub and it retrieves a queued message being sent toohello device.</span></span> <span data-ttu-id="7e895-152">ce dernier cas de Hello signifie que si nous inscrit une fonction de rappel pour les messages, puis hello de rappel est appelée (en supposant que tous les messages sont la file d’attente).</span><span class="sxs-lookup"><span data-stu-id="7e895-152">hello latter case means that if we registered a callback function for messages, then hello callback is invoked (assuming any messages are queued up).</span></span> <span data-ttu-id="7e895-153">Nous serait inscrit une telle fonction de rappel avec le code suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="7e895-153">We would have registered such a callback function with code such as hello following:</span></span>

```
IoTHubClient_LL_SetMessageCallback(iotHubClientHandle, ReceiveMessageCallback, &receiveContext)
```

<span data-ttu-id="7e895-154">Hello raison pour laquelle **IoTHubClient\_LL\_DoWork** est souvent appelée dans une boucle est que chaque fois qu’elle est appelée, elle envoie *certains* mis en mémoire tampon des événements tooIoT Hub et récupère *hello ensuite* message de la file d’attente pour le périphérique de hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-154">hello reason that **IoTHubClient\_LL\_DoWork** is often called in a loop is that each time it’s called, it sends *some* buffered events tooIoT Hub and retrieves *hello next* message queued up for hello device.</span></span> <span data-ttu-id="7e895-155">Chaque appel n’est pas garanti que les toosend toutes les mises en mémoire tamponné les événements ou en file d’attente tooretrieve tous les messages.</span><span class="sxs-lookup"><span data-stu-id="7e895-155">Each call isn’t guaranteed toosend all buffered events or tooretrieve all queued messages.</span></span> <span data-ttu-id="7e895-156">Si vous souhaitez toosend tous les événements de hello de la mémoire tampon et poursuivez avec un autre traitement, vous pouvez remplacer cette boucle avec le code suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="7e895-156">If you want toosend all events in hello buffer and then continue on with other processing you can replace this loop with code such as hello following:</span></span>

```
IOTHUB_CLIENT_STATUS status;

while ((IoTHubClient_LL_GetSendStatus(iotHubClientHandle, &status) == IOTHUB_CLIENT_OK) && (status == IOTHUB_CLIENT_SEND_STATUS_BUSY))
{
    IoTHubClient_LL_DoWork(iotHubClientHandle);
    ThreadAPI_Sleep(1000);
}
```

<span data-ttu-id="7e895-157">Ce code appelle **IoTHubClient\_LL\_DoWork** jusqu'à ce que tous les événements dans la mémoire tampon de hello ont été envoyés tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-157">This code calls **IoTHubClient\_LL\_DoWork** until all events in hello buffer have been sent tooIoT Hub.</span></span> <span data-ttu-id="7e895-158">Notez que cela ne signifie pas non plus que tous les messages en file d’attente ont été reçus.</span><span class="sxs-lookup"><span data-stu-id="7e895-158">Note this does not also imply that all queued messages have been received.</span></span> <span data-ttu-id="7e895-159">Partie de raison hello est que la vérification des messages « tous » n’est pas déterministe comme une action.</span><span class="sxs-lookup"><span data-stu-id="7e895-159">Part of hello reason for this is that checking for "all" messages isn’t as deterministic an action.</span></span> <span data-ttu-id="7e895-160">Que se passe-t-il si vous récupérez « all » de messages hello, mais ensuite un autre est envoyé toohello appareil immédiatement après ?</span><span class="sxs-lookup"><span data-stu-id="7e895-160">What happens if you retrieve "all" of hello messages, but then another one is sent toohello device immediately after?</span></span> <span data-ttu-id="7e895-161">Une meilleure toodeal de façon avec qui est un délai d’attente programmée.</span><span class="sxs-lookup"><span data-stu-id="7e895-161">A better way toodeal with that is with a programmed timeout.</span></span> <span data-ttu-id="7e895-162">Par exemple, fonction de rappel de message hello pourrait réinitialiser un minuteur chaque fois qu’elle est appelée.</span><span class="sxs-lookup"><span data-stu-id="7e895-162">For example, hello message callback function could reset a timer every time it’s invoked.</span></span> <span data-ttu-id="7e895-163">Vous pouvez ensuite écrire le traitement de logique toocontinue si, par exemple, aucun message n’ont été reçus dans hello dernière *X* secondes.</span><span class="sxs-lookup"><span data-stu-id="7e895-163">You can then write logic toocontinue processing if, for example, no messages have been received in hello last *X* seconds.</span></span>

<span data-ttu-id="7e895-164">Lorsque vous les événements de la pénétration de molécules terminé et recevoir des messages, être toocall vraiment hello correspondant fonction tooclean des ressources.</span><span class="sxs-lookup"><span data-stu-id="7e895-164">When you’re finished ingressing events and receiving messages, be sure toocall hello corresponding function tooclean up resources.</span></span>

```
IoTHubClient_LL_Destroy(iotHubClientHandle);
```

<span data-ttu-id="7e895-165">En fait, il n'est qu’un ensemble d’API toosend et recevoir des données avec un thread d’arrière-plan et un autre ensemble d’API qui hello même chose sans thread d’arrière-plan hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-165">Basically there’s only one set of APIs toosend and receive data with a background thread and another set of APIs that does hello same thing without hello background thread.</span></span> <span data-ttu-id="7e895-166">De nombreux développeurs préfèrent hello non - LL API, mais hello API de niveau inférieur est utiles lorsque le développeur de hello veut contrôle explicite sur les transmissions réseau.</span><span class="sxs-lookup"><span data-stu-id="7e895-166">A lot of developers may prefer hello non-LL APIs, but hello lower-level APIs are useful when hello developer wants explicit control over network transmissions.</span></span> <span data-ttu-id="7e895-167">Par exemple, certains appareils recueillent des données au fil du temps et n’enregistrent que les événements à des intervalles spécifiés (par exemple, une fois par heure ou une fois par jour).</span><span class="sxs-lookup"><span data-stu-id="7e895-167">For example, some devices collect data over time and only ingress events at specified intervals (for example, once an hour or once a day).</span></span> <span data-ttu-id="7e895-168">Bonjour donnez aux API de niveau inférieur vous hello contrôle tooexplicitly de capacité lorsque vous envoyez et recevez des données à partir de IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-168">hello lower-level APIs give you hello ability tooexplicitly control when you send and receive data from IoT Hub.</span></span> <span data-ttu-id="7e895-169">D’autres préfèreront à plus de simplicité hello simplement que hello que fournit des API de niveau inférieur.</span><span class="sxs-lookup"><span data-stu-id="7e895-169">Others will simply prefer hello simplicity that hello lower-level APIs provide.</span></span> <span data-ttu-id="7e895-170">Tout se produit sur le thread principal de hello plutôt que certains se produise de travail en arrière-plan de hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-170">Everything happens on hello main thread rather than some work happening in hello background.</span></span>

<span data-ttu-id="7e895-171">Le modèle que vous choisissez, être vraiment toobe cohérente dans lesquelles API que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="7e895-171">Whichever model you choose, be sure toobe consistent in which APIs you use.</span></span> <span data-ttu-id="7e895-172">Si vous démarrez en appelant **IoTHubClient\_LL\_CreateFromConnectionString**, veillez à utiliser uniquement hello correspondant API de niveau inférieur pour tout travail de suivi :</span><span class="sxs-lookup"><span data-stu-id="7e895-172">If you start by calling **IoTHubClient\_LL\_CreateFromConnectionString**, be sure you only use hello corresponding lower-level APIs for any follow-up work:</span></span>

* <span data-ttu-id="7e895-173">IoTHubClient\_LL\_SendEventAsync</span><span class="sxs-lookup"><span data-stu-id="7e895-173">IoTHubClient\_LL\_SendEventAsync</span></span>
* <span data-ttu-id="7e895-174">IoTHubClient\_LL\_SetMessageCallback</span><span class="sxs-lookup"><span data-stu-id="7e895-174">IoTHubClient\_LL\_SetMessageCallback</span></span>
* <span data-ttu-id="7e895-175">IoTHubClient\_LL\_Destroy</span><span class="sxs-lookup"><span data-stu-id="7e895-175">IoTHubClient\_LL\_Destroy</span></span>
* <span data-ttu-id="7e895-176">IoTHubClient\_LL\_DoWork</span><span class="sxs-lookup"><span data-stu-id="7e895-176">IoTHubClient\_LL\_DoWork</span></span>

<span data-ttu-id="7e895-177">Hello inverse est vrai également.</span><span class="sxs-lookup"><span data-stu-id="7e895-177">hello opposite is true as well.</span></span> <span data-ttu-id="7e895-178">Si vous démarrez avec **IoTHubClient\_CreateFromConnectionString**, puis utilisez hello non - LL interfaces API pour un traitement supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="7e895-178">If you start with **IoTHubClient\_CreateFromConnectionString**, then use hello non-LL APIs for any additional processing.</span></span>

<span data-ttu-id="7e895-179">Dans l’appareil Azure IoT hello SDK pour C, consultez hello **iothub\_client\_exemple\_http** inférieur de niveau application pour obtenir un exemple complet de hello API.</span><span class="sxs-lookup"><span data-stu-id="7e895-179">In hello Azure IoT device SDK for C, see hello **iothub\_client\_sample\_http** application for a complete example of hello lower-level APIs.</span></span> <span data-ttu-id="7e895-180">Hello **iothub\_client\_exemple\_amqp** application peut être référencée pour obtenir un exemple complet de hello non - LL API.</span><span class="sxs-lookup"><span data-stu-id="7e895-180">hello **iothub\_client\_sample\_amqp** application can be referenced for a full example of hello non-LL APIs.</span></span>

## <a name="property-handling"></a><span data-ttu-id="7e895-181">Gestion des propriétés</span><span class="sxs-lookup"><span data-stu-id="7e895-181">Property handling</span></span>
<span data-ttu-id="7e895-182">Jusqu'à présent lorsque nous avons décrit l’envoi de données, nous avons été référence toohello des corps de message de type hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-182">So far when we've described sending data, we've been referring toohello body of hello message.</span></span> <span data-ttu-id="7e895-183">Considérez par exemple le code suivant :</span><span class="sxs-lookup"><span data-stu-id="7e895-183">For example, consider this code:</span></span>

```
EVENT_INSTANCE message;
sprintf_s(msgText, sizeof(msgText), "Hello World");
message.messageHandle = IoTHubMessage_CreateFromByteArray((const unsigned char*)msgText, strlen(msgText));
IoTHubClient_LL_SendEventAsync(iotHubClientHandle, message.messageHandle, SendConfirmationCallback, &message)
```

<span data-ttu-id="7e895-184">Cet exemple envoie un message de tooIoT concentrateur avec le texte hello « Hello World ».</span><span class="sxs-lookup"><span data-stu-id="7e895-184">This example sends a message tooIoT Hub with hello text "Hello World."</span></span> <span data-ttu-id="7e895-185">Toutefois, IoT Hub permet également de message de propriétés toobe tooeach attaché.</span><span class="sxs-lookup"><span data-stu-id="7e895-185">However, IoT Hub also allows properties toobe attached tooeach message.</span></span> <span data-ttu-id="7e895-186">Les propriétés sont des paires nom/valeur qui peuvent être attaché toohello message.</span><span class="sxs-lookup"><span data-stu-id="7e895-186">Properties are name/value pairs that can be attached toohello message.</span></span> <span data-ttu-id="7e895-187">Par exemple, nous pouvons modifier hello précédent code tooattach une propriété de message toohello :</span><span class="sxs-lookup"><span data-stu-id="7e895-187">For example, we can modify hello previous code tooattach a property toohello message:</span></span>

```
MAP_HANDLE propMap = IoTHubMessage_Properties(message.messageHandle);
sprintf_s(propText, sizeof(propText), "%d", i);
Map_AddOrUpdate(propMap, "SequenceNumber", propText);
```

<span data-ttu-id="7e895-188">Nous allons commencer par appeler **IoTHubMessage\_propriétés** et en lui passant hello handle de notre message.</span><span class="sxs-lookup"><span data-stu-id="7e895-188">We start by calling **IoTHubMessage\_Properties** and passing it hello handle of our message.</span></span> <span data-ttu-id="7e895-189">Ce que nous obtenons est un **carte\_gérer** référence qui nous permet de toostart Ajout de propriétés.</span><span class="sxs-lookup"><span data-stu-id="7e895-189">What we get back is a **MAP\_HANDLE** reference that enables us toostart adding properties.</span></span> <span data-ttu-id="7e895-190">Hello ce dernier s’effectue en appelant **carte\_AddOrUpdate**, qui accepte une référence de tooa carte\_HANDLE, nom de la propriété hello et valeur de la propriété hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-190">hello latter is accomplished by calling **Map\_AddOrUpdate**, which takes a reference tooa MAP\_HANDLE, hello property name, and hello property value.</span></span> <span data-ttu-id="7e895-191">Avec cette API, nous pouvons ajouter autant de propriétés que nous le souhaitons.</span><span class="sxs-lookup"><span data-stu-id="7e895-191">With this API we can add as many properties as we like.</span></span>

<span data-ttu-id="7e895-192">Lorsque les événements hello sont lu à partir de **concentrateurs d’événements**, récepteur de hello peut énumérer les propriétés hello et récupérer leurs valeurs correspondantes.</span><span class="sxs-lookup"><span data-stu-id="7e895-192">When hello event is read from **Event Hubs**, hello receiver can enumerate hello properties and retrieve their corresponding values.</span></span> <span data-ttu-id="7e895-193">Par exemple, dans .NET cela interviendrait en accédant à hello [collection de propriétés de l’objet de EventData hello](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e895-193">For example, in .NET this would be accomplished by accessing hello [Properties collection on hello EventData object](https://msdn.microsoft.com/library/azure/microsoft.servicebus.messaging.eventdata.properties.aspx).</span></span>

<span data-ttu-id="7e895-194">Dans l’exemple précédent de hello, nous allons attacher des événements de tooan de propriétés que nous envoyer tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-194">In hello previous example, we’re attaching properties tooan event that we send tooIoT Hub.</span></span> <span data-ttu-id="7e895-195">Propriétés peuvent également être attachés toomessages provenant du IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-195">Properties can also be attached toomessages received from IoT Hub.</span></span> <span data-ttu-id="7e895-196">Si nous voulons tooretrieve des propriétés d’un message, nous pouvons utiliser le code tel que hello suivant dans votre fonction de rappel de message :</span><span class="sxs-lookup"><span data-stu-id="7e895-196">If we want tooretrieve properties from a message, we can use code such as hello following in our message callback function:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .

    // Retrieve properties from hello message
    MAP_HANDLE mapProperties = IoTHubMessage_Properties(message);
    if (mapProperties != NULL)
    {
        const char*const* keys;
        const char*const* values;
        size_t propertyCount = 0;
        if (Map_GetInternals(mapProperties, &keys, &values, &propertyCount) == MAP_OK)
        {
            if (propertyCount > 0)
            {
                printf("Message Properties:\r\n");
                for (size_t index = 0; index < propertyCount; index++)
                {
                    printf("\tKey: %s Value: %s\r\n", keys[index], values[index]);
                }
                printf("\r\n");
            }
        }
    }

    . . .
}
```

<span data-ttu-id="7e895-197">Hello appel trop**IoTHubMessage\_propriétés** renvoie hello **carte\_gérer** référence.</span><span class="sxs-lookup"><span data-stu-id="7e895-197">hello call too**IoTHubMessage\_Properties** returns hello **MAP\_HANDLE** reference.</span></span> <span data-ttu-id="7e895-198">Nous avons ensuite passer cette référence trop**carte\_GetInternals** tooobtain un tableau de tooan de référence de nom/valeur de hello paires (ainsi que le nombre de propriétés de hello).</span><span class="sxs-lookup"><span data-stu-id="7e895-198">We then pass that reference too**Map\_GetInternals** tooobtain a reference tooan array of hello name/value pairs (as well as a count of hello properties).</span></span> <span data-ttu-id="7e895-199">À ce stade, il est très simple de l’énumération hello propriétés tooget toohello valeurs.</span><span class="sxs-lookup"><span data-stu-id="7e895-199">At that point it's a simple matter of enumerating hello properties tooget toohello values we want.</span></span>

<span data-ttu-id="7e895-200">Vous n’avez toouse propriétés dans votre application.</span><span class="sxs-lookup"><span data-stu-id="7e895-200">You don't have toouse properties in your application.</span></span> <span data-ttu-id="7e895-201">Toutefois, si vous avez besoin de tooset à des événements ou en extraire les messages, hello **IoTHubClient** bibliothèque facilite la tâche.</span><span class="sxs-lookup"><span data-stu-id="7e895-201">However, if you need tooset them on events or retrieve them from messages, hello **IoTHubClient** library makes it easy.</span></span>

## <a name="message-handling"></a><span data-ttu-id="7e895-202">Gestion des messages</span><span class="sxs-lookup"><span data-stu-id="7e895-202">Message handling</span></span>
<span data-ttu-id="7e895-203">Comme indiqué précédemment, lorsque les messages arrivent de hello de IoT Hub **IoTHubClient** bibliothèque répond en appelant une fonction de rappel enregistré.</span><span class="sxs-lookup"><span data-stu-id="7e895-203">As stated previously, when messages arrive from IoT Hub hello **IoTHubClient** library responds by invoking a registered callback function.</span></span> <span data-ttu-id="7e895-204">Un des paramètres de retour de cette fonction mérite cependant quelques explications supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="7e895-204">There is a return parameter of this function that deserves some additional explanation.</span></span> <span data-ttu-id="7e895-205">Voici un extrait de la fonction de rappel hello Bonjour **iothub\_client\_exemple\_http** exemple d’application :</span><span class="sxs-lookup"><span data-stu-id="7e895-205">Here’s an excerpt of hello callback function in hello **iothub\_client\_sample\_http** sample application:</span></span>

```
static IOTHUBMESSAGE_DISPOSITION_RESULT ReceiveMessageCallback(IOTHUB_MESSAGE_HANDLE message, void* userContextCallback)
{
    . . .
    return IOTHUBMESSAGE_ACCEPTED;
}
```

<span data-ttu-id="7e895-206">Notez que le type de retour hello est **IOTHUBMESSAGE\_DISPOSITION\_résultat** et dans ce cas particulier, nous renvoyons **IOTHUBMESSAGE\_accepté**.</span><span class="sxs-lookup"><span data-stu-id="7e895-206">Note that hello return type is **IOTHUBMESSAGE\_DISPOSITION\_RESULT** and in this particular case we return **IOTHUBMESSAGE\_ACCEPTED**.</span></span> <span data-ttu-id="7e895-207">Il existe d’autres valeurs que nous pouvons retourner à partir de cette fonction que modification hello comment **IoTHubClient** bibliothèque réagit toohello rappel du message.</span><span class="sxs-lookup"><span data-stu-id="7e895-207">There are other values we can return from this function that change how hello **IoTHubClient** library reacts toohello message callback.</span></span> <span data-ttu-id="7e895-208">Voici les options hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-208">Here are hello options.</span></span>

* <span data-ttu-id="7e895-209">**IOTHUBMESSAGE\_accepté** – message de salutation a été correctement traité.</span><span class="sxs-lookup"><span data-stu-id="7e895-209">**IOTHUBMESSAGE\_ACCEPTED** – hello message has been processed successfully.</span></span> <span data-ttu-id="7e895-210">Hello **IoTHubClient** bibliothèque n’appelle pas la fonction de rappel hello avec hello même message.</span><span class="sxs-lookup"><span data-stu-id="7e895-210">hello **IoTHubClient** library will not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="7e895-211">**IOTHUBMESSAGE\_rejeté** : message d’appel n’a pas été traité et existe dans aucun toodo désir ne hello futures.</span><span class="sxs-lookup"><span data-stu-id="7e895-211">**IOTHUBMESSAGE\_REJECTED** – hello message was not processed and there is no desire toodo so in hello future.</span></span> <span data-ttu-id="7e895-212">Hello **IoTHubClient** bibliothèque ne doit pas appeler de fonction de rappel hello avec hello même message.</span><span class="sxs-lookup"><span data-stu-id="7e895-212">hello **IoTHubClient** library should not invoke hello callback function again with hello same message.</span></span>
* <span data-ttu-id="7e895-213">**IOTHUBMESSAGE\_abandonné** : message d’appel n’a pas été traité avec succès, mais hello **IoTHubClient** bibliothèque doit appeler la fonction de rappel hello avec hello même message.</span><span class="sxs-lookup"><span data-stu-id="7e895-213">**IOTHUBMESSAGE\_ABANDONED** – hello message was not processed successfully, but hello **IoTHubClient** library should invoke hello callback function again with hello same message.</span></span>

<span data-ttu-id="7e895-214">Pourquoi tout d’abord deux codes de retour, hello **IoTHubClient** bibliothèque envoie un tooIoT message Hub indiquant ce message de type hello doit être supprimé de la file d’attente de hello et n’a pas remis à nouveau.</span><span class="sxs-lookup"><span data-stu-id="7e895-214">For hello first two return codes, hello **IoTHubClient** library sends a message tooIoT Hub indicating that hello message should be deleted from hello device queue and not delivered again.</span></span> <span data-ttu-id="7e895-215">effet net de Hello est hello même (message de type hello est supprimé à partir de la file d’attente de hello), mais si le message de salutation a été accepté ou rejeté est toujours enregistré.</span><span class="sxs-lookup"><span data-stu-id="7e895-215">hello net effect is hello same (hello message is deleted from hello device queue), but whether hello message was accepted or rejected is still recorded.</span></span>  <span data-ttu-id="7e895-216">L’enregistrement de cette distinction est utile toosenders de message de type hello qui peut écouter des commentaires et déterminer si un périphérique a accepté ou rejeté un message particulier.</span><span class="sxs-lookup"><span data-stu-id="7e895-216">Recording this distinction is useful toosenders of hello message who can listen for feedback and find out if a device has accepted or rejected a particular message.</span></span>

<span data-ttu-id="7e895-217">Dans le dernier cas de hello, un message est envoyé également tooIoT concentrateur, mais indique que message de type hello doit être de nouveau remis.</span><span class="sxs-lookup"><span data-stu-id="7e895-217">In hello last case a message is also sent tooIoT Hub, but it indicates that hello message should be redelivered.</span></span> <span data-ttu-id="7e895-218">En général, vous devez abandonner un message si vous rencontrez une erreur mais tootry tooprocess hello message à nouveau.</span><span class="sxs-lookup"><span data-stu-id="7e895-218">Typically you’ll abandon a message if you encounter some error but want tootry tooprocess hello message again.</span></span> <span data-ttu-id="7e895-219">En revanche, la rejeter un message est appropriée lorsque vous rencontrez une erreur irrécupérable (ou si vous décidez simplement vous ne souhaitez pas que message de type hello tooprocess).</span><span class="sxs-lookup"><span data-stu-id="7e895-219">In contrast, rejecting a message is appropriate when you encounter an unrecoverable error (or if you simply decide you don’t want tooprocess hello message).</span></span>

<span data-ttu-id="7e895-220">Dans tous les cas, tenez compte des codes de retour différents hello afin que vous pouvez provoquer le comportement de hello que vous souhaitez à partir de hello **IoTHubClient** bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="7e895-220">In any case, be aware of hello different return codes so that you can elicit hello behavior you want from hello **IoTHubClient** library.</span></span>

## <a name="alternate-device-credentials"></a><span data-ttu-id="7e895-221">Autres informations d’identification d’appareil</span><span class="sxs-lookup"><span data-stu-id="7e895-221">Alternate device credentials</span></span>
<span data-ttu-id="7e895-222">Comme expliqué précédemment, hello première toodo lorsque vous travaillez avec hello **IoTHubClient** bibliothèque est tooobtain un **IOTHUB\_CLIENT\_gérer** avec un appel de hello suivant :</span><span class="sxs-lookup"><span data-stu-id="7e895-222">As explained previously, hello first thing toodo when working with hello **IoTHubClient** library is tooobtain a **IOTHUB\_CLIENT\_HANDLE** with a call such as hello following:</span></span>

```
IOTHUB_CLIENT_HANDLE iotHubClientHandle;
iotHubClientHandle = IoTHubClient_CreateFromConnectionString(connectionString, AMQP_Protocol);
```

<span data-ttu-id="7e895-223">Hello arguments trop**IoTHubClient\_CreateFromConnectionString** sont une chaîne de connexion de périphérique hello et un paramètre qui indique le protocole hello nous utilisons toocommunicate avec IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-223">hello arguments too**IoTHubClient\_CreateFromConnectionString** are hello device connection string and a parameter that indicates hello protocol we use toocommunicate with IoT Hub.</span></span> <span data-ttu-id="7e895-224">chaîne de connexion de périphérique Hello a un format qui s’affiche comme suit :</span><span class="sxs-lookup"><span data-stu-id="7e895-224">hello device connection string has a format that appears as follows:</span></span>

```
HostName=IOTHUBNAME.IOTHUBSUFFIX;DeviceId=DEVICEID;SharedAccessKey=SHAREDACCESSKEY
```

<span data-ttu-id="7e895-225">Il existe ici quatre éléments d’information : le nom IoT Hub, le suffixe IoT Hub, l’ID d’appareil et la clé d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="7e895-225">There are four pieces of information in this string: IoT Hub name, IoT Hub suffix, device ID, and shared access key.</span></span> <span data-ttu-id="7e895-226">Vous obtenez le nom de domaine complet (FQDN) hello d’un hub IoT lorsque vous créez votre instance de hub IoT Bonjour portail Azure, cela vous donne nom de hub IoT hello (hello première partie du nom de domaine complet de hello) et le suffixe de hub IoT hello (hello rest nom de domaine complet de Hello).</span><span class="sxs-lookup"><span data-stu-id="7e895-226">You obtain hello fully qualified domain name (FQDN) of an IoT hub when you create your IoT hub instance in hello Azure portal — this gives you hello IoT hub name (hello first part of hello FQDN) and hello IoT hub suffix (hello rest of hello FQDN).</span></span> <span data-ttu-id="7e895-227">Vous obtenez les ID de périphérique hello et clé d’accès partagé hello lorsque vous inscrivez votre appareil avec IoT Hub (comme décrit dans hello [article précédent](iot-hub-device-sdk-c-intro.md)).</span><span class="sxs-lookup"><span data-stu-id="7e895-227">You get hello device ID and hello shared access key when you register your device with IoT Hub (as described in hello [previous article](iot-hub-device-sdk-c-intro.md)).</span></span>

<span data-ttu-id="7e895-228">**IoTHubClient\_CreateFromConnectionString** vous donne la bibliothèque de hello tooinitialize unidirectionnel.</span><span class="sxs-lookup"><span data-stu-id="7e895-228">**IoTHubClient\_CreateFromConnectionString** gives you one way tooinitialize hello library.</span></span> <span data-ttu-id="7e895-229">Si vous préférez, vous pouvez créer un nouveau **IOTHUB\_CLIENT\_gérer** à l’aide de ces paramètres individuels plutôt que de chaîne de connexion de périphérique hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-229">If you prefer, you can create a new **IOTHUB\_CLIENT\_HANDLE** by using these individual parameters rather than hello device connection string.</span></span> <span data-ttu-id="7e895-230">Cela est possible avec hello suivant de code :</span><span class="sxs-lookup"><span data-stu-id="7e895-230">This is achieved with hello following code:</span></span>

```
IOTHUB_CLIENT_CONFIG iotHubClientConfig;
iotHubClientConfig.iotHubName = "";
iotHubClientConfig.deviceId = "";
iotHubClientConfig.deviceKey = "";
iotHubClientConfig.iotHubSuffix = "";
iotHubClientConfig.protocol = HTTP_Protocol;
IOTHUB_CLIENT_HANDLE iotHubClientHandle = IoTHubClient_LL_Create(&iotHubClientConfig);
```

<span data-ttu-id="7e895-231">Ceci fait hello même chose que **IoTHubClient\_CreateFromConnectionString**.</span><span class="sxs-lookup"><span data-stu-id="7e895-231">This accomplishes hello same thing as **IoTHubClient\_CreateFromConnectionString**.</span></span>

<span data-ttu-id="7e895-232">Cela peut paraître évident que vous souhaitiez toouse **IoTHubClient\_CreateFromConnectionString** au lieu de cette méthode plus détaillée de l’initialisation.</span><span class="sxs-lookup"><span data-stu-id="7e895-232">It may seem obvious that you would want toouse **IoTHubClient\_CreateFromConnectionString** rather than this more verbose method of initialization.</span></span> <span data-ttu-id="7e895-233">Cependant, gardez à l’esprit que lorsque vous enregistrez un appareil dans IoT Hub, vous obtenez un ID d’appareil et une clé d’appareil (pas une chaîne de connexion).</span><span class="sxs-lookup"><span data-stu-id="7e895-233">Keep in mind, however, that when you register a device in IoT Hub what you get is a device ID and device key (not a connection string).</span></span> <span data-ttu-id="7e895-234">Hello *Explorateur de périphérique* outil du Kit de développement logiciel introduite dans hello [article précédent](iot-hub-device-sdk-c-intro.md) utilise les bibliothèques Bonjour **Azure IoT service SDK** toocreate hello appareil chaîne de connexion ID de périphérique Hello, la clé de périphérique et le nom d’hôte de IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="7e895-234">hello *device explorer* SDK tool introduced in hello [previous article](iot-hub-device-sdk-c-intro.md) uses libraries in hello **Azure IoT service SDK** toocreate hello device connection string from hello device ID, device key, and IoT Hub host name.</span></span> <span data-ttu-id="7e895-235">Ainsi, l’appel **IoTHubClient\_LL\_créer** peut être préférable, car elle permet d’étape hello de la génération d’une chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="7e895-235">So calling **IoTHubClient\_LL\_Create** may be preferable because it saves you hello step of generating a connection string.</span></span> <span data-ttu-id="7e895-236">Utilisez la méthode adéquate.</span><span class="sxs-lookup"><span data-stu-id="7e895-236">Use whichever method is convenient.</span></span>

## <a name="configuration-options"></a><span data-ttu-id="7e895-237">Options de configuration</span><span class="sxs-lookup"><span data-stu-id="7e895-237">Configuration options</span></span>
<span data-ttu-id="7e895-238">Jusqu'à présent tous les éléments décrits sur hello de façon hello **IoTHubClient** bibliothèque works reflète son comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="7e895-238">So far everything described about hello way hello **IoTHubClient** library works reflects its default behavior.</span></span> <span data-ttu-id="7e895-239">Toutefois, il existe quelques options que vous pouvez définir toochange fonctionne de la bibliothèque de hello.</span><span class="sxs-lookup"><span data-stu-id="7e895-239">However, there are a few options that you can set toochange how hello library works.</span></span> <span data-ttu-id="7e895-240">Cela est effectué en tirant parti de hello **IoTHubClient\_LL\_SetOption** API.</span><span class="sxs-lookup"><span data-stu-id="7e895-240">This is accomplished by leveraging hello **IoTHubClient\_LL\_SetOption** API.</span></span> <span data-ttu-id="7e895-241">Examinez cet exemple :</span><span class="sxs-lookup"><span data-stu-id="7e895-241">Consider this example:</span></span>

```
unsigned int timeout = 30000;
IoTHubClient_LL_SetOption(iotHubClientHandle, "timeout", &timeout);
```

<span data-ttu-id="7e895-242">Quelques options sont couramment utilisées :</span><span class="sxs-lookup"><span data-stu-id="7e895-242">There are a couple of options that are commonly used:</span></span>

* <span data-ttu-id="7e895-243">**SetBatching** (bool) – si **true**, alors les données envoyées tooIoT Hub est envoyé par lots.</span><span class="sxs-lookup"><span data-stu-id="7e895-243">**SetBatching** (bool) – If **true**, then data sent tooIoT Hub is sent in batches.</span></span> <span data-ttu-id="7e895-244">Si elle a la valeur **false**, les messages sont envoyés individuellement.</span><span class="sxs-lookup"><span data-stu-id="7e895-244">If **false**, then messages are sent individually.</span></span> <span data-ttu-id="7e895-245">valeur par défaut Hello est **false**.</span><span class="sxs-lookup"><span data-stu-id="7e895-245">hello default is **false**.</span></span> <span data-ttu-id="7e895-246">Notez que hello **SetBatching** option s’applique uniquement au protocole de toohello HTTP pas aux protocoles de toohello MQTT ou AMQP.</span><span class="sxs-lookup"><span data-stu-id="7e895-246">Note that hello **SetBatching** option only applies toohello HTTP protocol and not toohello MQTT or AMQP protocols.</span></span>
* <span data-ttu-id="7e895-247">**Timeout** (unsigned int) : cette valeur est exprimée en millisecondes.</span><span class="sxs-lookup"><span data-stu-id="7e895-247">**Timeout** (unsigned int) – This value is represented in milliseconds.</span></span> <span data-ttu-id="7e895-248">Si vous envoyez une demande HTTP ou recevoir une réponse dure plus longtemps que cette fois, puis hello connexion expire.</span><span class="sxs-lookup"><span data-stu-id="7e895-248">If sending an HTTP request or receiving a response takes longer than this time, then hello connection times out.</span></span>

<span data-ttu-id="7e895-249">option de traitement par lot de Hello est important.</span><span class="sxs-lookup"><span data-stu-id="7e895-249">hello batching option is important.</span></span> <span data-ttu-id="7e895-250">Par défaut, hello les événements d’une bibliothèque ingresses individuellement (un seul événement est tout ce que vous passez trop**IoTHubClient\_LL\_SendEventAsync**).</span><span class="sxs-lookup"><span data-stu-id="7e895-250">By default, hello library ingresses events individually (a single event is whatever you pass too**IoTHubClient\_LL\_SendEventAsync**).</span></span> <span data-ttu-id="7e895-251">Si l’option de traitement par lot de hello est **true**, bibliothèque de hello collecte les événements autant que possible à partir du tampon hello (haut toohello taille maximale du message qui accepte les IoT Hub).</span><span class="sxs-lookup"><span data-stu-id="7e895-251">If hello batching option is **true**, hello library collects as many events as it can from hello buffer (up toohello maximum message size that IoT Hub will accept).</span></span>  <span data-ttu-id="7e895-252">Hello lot d’événements est envoyé tooIoT concentrateur dans un seul appel HTTP (les événements individuels de hello sont regroupés dans un tableau JSON).</span><span class="sxs-lookup"><span data-stu-id="7e895-252">hello event batch is sent tooIoT Hub in a single HTTP call (hello individual events are bundled into a JSON array).</span></span> <span data-ttu-id="7e895-253">L’activation de l’option de traitement par lot permet d’obtenir des gains de performance, car vous réduisez le nombre d’allers-retours sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="7e895-253">Enabling batching typically results in big performance gains since you’re reducing network round-trips.</span></span> <span data-ttu-id="7e895-254">Elle réduit également considérablement la bande passante, car vous envoyez un seul ensemble d’en-têtes HTTP avec un lot d’événements plutôt qu’un ensemble d’en-têtes pour chaque événement individuel.</span><span class="sxs-lookup"><span data-stu-id="7e895-254">It also significantly reduces bandwidth since you are sending one set of HTTP headers with an event batch rather than a set of headers for each individual event.</span></span> <span data-ttu-id="7e895-255">En général, sauf si vous avez une raison spécifique de toodo dans le cas contraire, vous pouvez répondre tooenable de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="7e895-255">Unless you have a specific reason toodo otherwise, typically you’ll want tooenable batching.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7e895-256">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="7e895-256">Next steps</span></span>
<span data-ttu-id="7e895-257">Cet article décrit un comportement hello détail de hello **IoTHubClient** bibliothèque trouvé dans hello **appareil Azure IoT SDK pour C**. Avec cette information, doit avoir une bonne compréhension des fonctionnalités de hello Hello **IoTHubClient** bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="7e895-257">This article describes in detail hello behavior of hello **IoTHubClient** library found in hello **Azure IoT device SDK for C**. With this information, you should have a good understanding of hello capabilities of hello **IoTHubClient** library.</span></span> <span data-ttu-id="7e895-258">Hello [l’article suivant](iot-hub-device-sdk-c-serializer.md) fournit des détails similaires sur hello **sérialiseur** bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="7e895-258">hello [next article](iot-hub-device-sdk-c-serializer.md) provides similar detail on hello **serializer** library.</span></span>

<span data-ttu-id="7e895-259">toolearn plus sur le développement pour IoT Hub, consultez hello [kits de développement logiciel Azure IoT][lnk-sdks].</span><span class="sxs-lookup"><span data-stu-id="7e895-259">toolearn more about developing for IoT Hub, see hello [Azure IoT SDKs][lnk-sdks].</span></span>

<span data-ttu-id="7e895-260">toofurther Explorez les fonctionnalités de hello d’IoT Hub, consultez :</span><span class="sxs-lookup"><span data-stu-id="7e895-260">toofurther explore hello capabilities of IoT Hub, see:</span></span>

* <span data-ttu-id="7e895-261">[Simulation d’un appareil avec Azure IoT Edge][lnk-iotedge]</span><span class="sxs-lookup"><span data-stu-id="7e895-261">[Simulating a device with Azure IoT Edge][lnk-iotedge]</span></span>

[lnk-sdks]: iot-hub-devguide-sdks.md

[lnk-iotedge]: iot-hub-linux-iot-edge-simulated-device.md
