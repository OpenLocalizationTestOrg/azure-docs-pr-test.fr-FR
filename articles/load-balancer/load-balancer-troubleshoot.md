---
title: "Résoudre les problèmes liés à Azure Load Balancer | Microsoft Docs"
description: "Résoudre les problèmes connus liés à Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: RamanDhillon
manager: timlt
editor: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 07/10/2017
ms.author: kumud
ms.openlocfilehash: df5c836abbf09889f4859170359c0ee6c1b03378
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshoot-azure-load-balancer"></a><span data-ttu-id="bad87-103">Résoudre les problèmes liés à Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="bad87-103">Troubleshoot Azure Load Balancer</span></span>

<span data-ttu-id="bad87-104">Cette page contient des informations de résolution des problèmes liés aux questions courantes relatives à Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="bad87-104">This page provides troubleshooting information for common Azure Load Balancer questions.</span></span> <span data-ttu-id="bad87-105">Lorsque la connectivité de l’équilibreur de charge n’est pas disponible, les symptômes les plus courants sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="bad87-105">When the Load Balancer connectivity is unavailable, the most common symptoms are as follows:</span></span> 
- <span data-ttu-id="bad87-106">Les machines virtuelles situées derrière l’équilibreur de charge ne répondent pas aux sondes d’intégrité</span><span class="sxs-lookup"><span data-stu-id="bad87-106">VMs behind the Load Balancer are not responding to health probes</span></span> 
- <span data-ttu-id="bad87-107">Les machines virtuelles situées derrière l’équilibreur de charge ne répondent pas au trafic sur le port configuré</span><span class="sxs-lookup"><span data-stu-id="bad87-107">VMs behind the Load Balancer are not responding to the traffic on the configured port</span></span>

## <a name="symptom-vms-behind-the-load-balancer-are-not-responding-to-health-probes"></a><span data-ttu-id="bad87-108">Symptôme : les machines virtuelles situées derrière l’équilibreur de charge ne répondent pas aux sondes d’intégrité</span><span class="sxs-lookup"><span data-stu-id="bad87-108">Symptom: VMs behind the Load Balancer are not responding to health probes</span></span>
<span data-ttu-id="bad87-109">Pour que les serveurs principaux participent au jeu d’équilibrage de charge, ils doivent réussir la vérification de la sonde.</span><span class="sxs-lookup"><span data-stu-id="bad87-109">For the backend servers to participate in the load balancer set, they must pass the probe check.</span></span> <span data-ttu-id="bad87-110">Pour plus d’informations sur les sondes d’intégrité, consultez la page [Comprendre les sondes de l’équilibrage de charge](load-balancer-custom-probe-overview.md).</span><span class="sxs-lookup"><span data-stu-id="bad87-110">For more information about health probes, see [Understanding Load Balancer Probes](load-balancer-custom-probe-overview.md).</span></span> 

<span data-ttu-id="bad87-111">Les machines virtuelles du pool principal de l’équilibreur de charge peuvent ne pas répondre aux sondes en raison des raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="bad87-111">The Load Balancer backend pool VMs may not be responding to the probes due to any of the following reasons:</span></span> 
- <span data-ttu-id="bad87-112">Une machine virtuelle du pool principal de l’équilibreur de charge est défectueuse</span><span class="sxs-lookup"><span data-stu-id="bad87-112">Load Balancer backend pool VM is unhealthy</span></span> 
- <span data-ttu-id="bad87-113">Une machine virtuelle du pool principal de l’équilibreur de charge n’écoute pas sur le port de la sonde</span><span class="sxs-lookup"><span data-stu-id="bad87-113">Load Balancer backend pool VM is not listening on the probe port</span></span> 
- <span data-ttu-id="bad87-114">Un pare-feu ou un groupe de sécurité réseau bloque le port sur les machines virtuelles du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-114">Firewall, or a network security group is blocking the port on the Load Balancer backend pool VMs</span></span> 
- <span data-ttu-id="bad87-115">Autres erreurs de configuration de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-115">Other misconfigurations in Load Balancer</span></span>

### <a name="cause-1-load-balancer-backend-pool-vm-is-unhealthy"></a><span data-ttu-id="bad87-116">Cause 1 : une machine virtuelle du pool principal de l’équilibreur de charge est défectueuse</span><span class="sxs-lookup"><span data-stu-id="bad87-116">Cause 1: Load Balancer backend pool VM is unhealthy</span></span> 

<span data-ttu-id="bad87-117">**Validation et résolution**</span><span class="sxs-lookup"><span data-stu-id="bad87-117">**Validation and resolution**</span></span>

<span data-ttu-id="bad87-118">Pour résoudre ce problème, connectez-vous aux machines virtuelles participant et vérifiez si l’état de la machine virtuelle est sain et si elle peut répondre à la commande **PsPing** ou **TCPing** d’une autre machine virtuelle du pool.</span><span class="sxs-lookup"><span data-stu-id="bad87-118">To resolve this issue, log in to the participating VMs, and check if the VM state is healthy, and can respond to **PsPing** or **TCPing** from another VM in the pool.</span></span> <span data-ttu-id="bad87-119">Si la machine virtuelle est défectueuse ou si elle ne peut pas répondre à la sonde, vous devez corriger le problème et rétablir la machine virtuelle à un état sain pour qu’elle puisse faire partie de l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="bad87-119">If the VM is unhealthy, or is unable to respond to the probe, you must rectify the issue and get the VM back to a healthy state before it can participate in load balancing.</span></span>

### <a name="cause-2-load-balancer-backend-pool-vm-is-not-listening-on-the-probe-port"></a><span data-ttu-id="bad87-120">Cause 2 : une machine virtuelle du pool principal de l’équilibreur de charge n’écoute pas sur le port de la sonde</span><span class="sxs-lookup"><span data-stu-id="bad87-120">Cause 2: Load Balancer backend pool VM is not listening on the probe port</span></span>
<span data-ttu-id="bad87-121">Si la machine virtuelle est saine, mais ne répond pas à la sonde, il se peut que le port de la sonde ne soit pas ouvert sur la machine virtuelle participant ou que la machine virtuelle n’écoute pas sur ce port.</span><span class="sxs-lookup"><span data-stu-id="bad87-121">If the VM is healthy, but is not responding to the probe, then one possible reason could be that the probe port is not open on the participating VM, or the VM is not listening on that port.</span></span>

<span data-ttu-id="bad87-122">**Validation et résolution**</span><span class="sxs-lookup"><span data-stu-id="bad87-122">**Validation and resolution**</span></span>

1. <span data-ttu-id="bad87-123">Connectez-vous à la machine virtuelle principale.</span><span class="sxs-lookup"><span data-stu-id="bad87-123">Log in to the backend VM.</span></span> 
2. <span data-ttu-id="bad87-124">Ouvrez une invite de commandes et exécutez la commande suivante pour vérifier qu’une application écoute sur le port de la sonde :</span><span class="sxs-lookup"><span data-stu-id="bad87-124">Open a command prompt and run the following command to validate there is an application listening on the probe port:</span></span>   
            <span data-ttu-id="bad87-125">netstat -an</span><span class="sxs-lookup"><span data-stu-id="bad87-125">netstat -an</span></span>
3. <span data-ttu-id="bad87-126">Si l’état du port indiqué n’est pas **ÉCOUTE**, configurez le port approprié.</span><span class="sxs-lookup"><span data-stu-id="bad87-126">If the port state is not listed as **LISTENING**, configure the proper port.</span></span> 
4. <span data-ttu-id="bad87-127">Vous pouvez également sélectionner un autre port, qui indique **ÉCOUTE**, et mettre à jour en conséquence la configuration de l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="bad87-127">Alternatively, select another port, that is listed as **LISTENING**, and update load balancer configuration accordingly.</span></span>              

###<a name="cause-3-firewall-or-a-network-security-group-is-blocking-the-port-on-the-load-balancer-backend-pool-vms"></a><span data-ttu-id="bad87-128">Cause 3 : un pare-feu ou un groupe de sécurité réseau bloque le port sur les machines virtuelles du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-128">Cause 3: Firewall, or a network security group is blocking the port on the load balancer backend pool VMs</span></span>  
<span data-ttu-id="bad87-129">Si le pare-feu sur la machine virtuelle bloque le port de la sonde, ou un ou plusieurs groupes de sécurité réseau configurés sur le sous-réseau ou sur la machine virtuelle, ou n’autorise pas la sonde à atteindre le port, la machine virtuelle est incapable de répondre à la sonde d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="bad87-129">If the firewall on the VM is blocking the probe port, or one or more network security groups configured on the subnet or on the VM, is not allowing the probe to reach the port, the VM is unable to respond to the health probe.</span></span>          

<span data-ttu-id="bad87-130">**Validation et résolution**</span><span class="sxs-lookup"><span data-stu-id="bad87-130">**Validation and resolution**</span></span>

* <span data-ttu-id="bad87-131">Si le pare-feu est activé, vérifiez s’il est configuré pour autoriser le port de la sonde.</span><span class="sxs-lookup"><span data-stu-id="bad87-131">If the firewall is enabled, check if it is configured to allow the probe port.</span></span> <span data-ttu-id="bad87-132">Si tel n’est pas le cas, configurez le pare-feu pour autoriser le trafic sur le port de la sonde, puis procédez à un nouveau test.</span><span class="sxs-lookup"><span data-stu-id="bad87-132">If not, configure the firewall to allow traffic on the probe port, and test again.</span></span> 
* <span data-ttu-id="bad87-133">Dans la liste des groupes de sécurité réseau, vérifiez si le trafic entrant ou sortant sur le port de la sonde subit des interférences.</span><span class="sxs-lookup"><span data-stu-id="bad87-133">From the list of network security groups, check if the incoming or outgoing traffic on the probe port has interference.</span></span> 
* <span data-ttu-id="bad87-134">Vérifiez également si une règle **Refuser tout** des groupes de sécurité réseau sur la carte d’interface réseau de la machine virtuelle ou du sous-réseau a une priorité supérieure à celle de la règle par défaut qui autorise les sondes et le trafic de l’équilibreur de charge (les groupes de sécurité réseau doivent autoriser l’adresse IP 168.63.129.16 de l’équilibreur de charge).</span><span class="sxs-lookup"><span data-stu-id="bad87-134">Also, check if a **Deny All** network security groups rule on the NIC of the VM or the subnet that has a higher priority than the default rule that allows LB probes & traffic (network security groups must allow Load Balancer IP of 168.63.129.16).</span></span> 
* <span data-ttu-id="bad87-135">Si l’une de ces règles bloque le trafic de la sonde, supprimez et reconfigurez les règles pour autoriser le trafic de la sonde.</span><span class="sxs-lookup"><span data-stu-id="bad87-135">If any of these rules are blocking the probe traffic, remove and reconfigure the rules to allow the probe traffic.</span></span>  
* <span data-ttu-id="bad87-136">Vérifiez si la machine virtuelle répond à présent aux sondes d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="bad87-136">Test if the VM has now started responding to the health probes.</span></span> 

### <a name="cause-4-other-misconfigurations-in-load-balancer"></a><span data-ttu-id="bad87-137">Cause 4 : autres erreurs de configuration de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-137">Cause 4: Other misconfigurations in Load Balancer</span></span>
<span data-ttu-id="bad87-138">Si toutes les causes précédentes semblent vérifiées et résolues et si la machine virtuelle principale ne répond toujours pas à la sonde d’intégrité, testez manuellement la connectivité, puis collectez des traces pour comprendre la connectivité.</span><span class="sxs-lookup"><span data-stu-id="bad87-138">If all the preceding causes seem to be validated and resolved correctly, and the backend VM still does not respond to the health probe, then manually test for connectivity, and collect some traces to understand the connectivity.</span></span>

<span data-ttu-id="bad87-139">**Validation et résolution**</span><span class="sxs-lookup"><span data-stu-id="bad87-139">**Validation and resolution**</span></span>

* <span data-ttu-id="bad87-140">Utilisez **Psping** à partir d’une des autres machines virtuelles dans le réseau virtuel pour tester la réponse du port de la sonde (exemple : .\psping.exe -t 10.0.0.4:3389) et enregistrez les résultats.</span><span class="sxs-lookup"><span data-stu-id="bad87-140">Use **Psping** from one of the other VMs within the VNet to test the probe port response (example: .\psping.exe -t 10.0.0.4:3389) and record results.</span></span> 
* <span data-ttu-id="bad87-141">Utilisez **TCPing** à partir d’une des autres machines virtuelles dans le réseau virtuel pour tester la réponse du port de la sonde (exemple : .\tcping.exe 10.0.0.4 3389) et enregistrez les résultats.</span><span class="sxs-lookup"><span data-stu-id="bad87-141">Use **TCPing** from one of the other VMs within the VNet to test the probe port response (example: .\tcping.exe 10.0.0.4 3389) and record results.</span></span> 
* <span data-ttu-id="bad87-142">Si aucune réponse n’est reçue dans ces tests ping,</span><span class="sxs-lookup"><span data-stu-id="bad87-142">If no response is received in these ping tests, then</span></span>
    - <span data-ttu-id="bad87-143">exécutez une trace Netsh simultanée sur la machine virtuelle du pool principal cible et une autre machine virtuelle de test à partir du même réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="bad87-143">Run a simultaneous Netsh trace on the target backend pool VM and another test VM from the same VNet.</span></span> <span data-ttu-id="bad87-144">À présent, exécutez un test PsPing pendant un certain temps, collectez des traces réseau, puis arrêtez le test.</span><span class="sxs-lookup"><span data-stu-id="bad87-144">Now, run a PsPing test for some time, collect some network traces, and then stop the test.</span></span> 
    - <span data-ttu-id="bad87-145">Analysez la capture du réseau et vérifiez que des paquets entrants et sortants sont associés à la requête ping.</span><span class="sxs-lookup"><span data-stu-id="bad87-145">Analyze the network capture and see if there are both incoming and outgoing packets related to the ping query.</span></span> 
        - <span data-ttu-id="bad87-146">Si aucun paquet entrant n’est observé sur la machine virtuelle du pool principal, il se peut qu’une erreur de configuration des groupes de sécurité réseau ou UDR bloque le trafic.</span><span class="sxs-lookup"><span data-stu-id="bad87-146">If no incoming packets are observed on the backend pool VM, there is potentially a network security groups or UDR mis-configuration blocking the traffic.</span></span> 
        - <span data-ttu-id="bad87-147">Si aucun paquet sortant n’est observé sur la machine virtuelle du pool principal, celle-ci doit être vérifiée pour y rechercher les problèmes non liés (par exemple, application bloquant le port de la sonde).</span><span class="sxs-lookup"><span data-stu-id="bad87-147">If no outgoing packets are observed on the backend pool VM, the VM needs to be checked for any unrelated issues (for eample, Application blocking the probe port).</span></span> 
    - <span data-ttu-id="bad87-148">Vérifiez si les paquets de la sonde sont contraints d’atteindre une autre destination (probablement via les paramètres UDR) avant l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="bad87-148">Verify if the probe packets are being forced to another destination (possibly via UDR settings) before reaching the load balancer.</span></span> <span data-ttu-id="bad87-149">Ce faisant, le trafic peut ne jamais atteindre la machine virtuelle principale.</span><span class="sxs-lookup"><span data-stu-id="bad87-149">This can cause the traffic to never reach the backend VM.</span></span> 
* <span data-ttu-id="bad87-150">Modifiez le type de sonde (par exemple, remplacez HTTP par TCP) et configurez le port correspondant dans les listes de contrôle d’accès (ACL) des groupes de sécurité réseau et le pare-feu pour vérifier si le problème est lié à la configuration de la réponse de la sonde.</span><span class="sxs-lookup"><span data-stu-id="bad87-150">Change the probe type (for example, HTTP to TCP), and configure the corresponding port in network security groups ACLs and firewall to validate if the issue is with the configuration of probe response.</span></span> <span data-ttu-id="bad87-151">Pour plus d’informations sur la configuration de la sonde d’intégrité, consultez la page [Endpoint Load Balancing health probe configuration (Configuration d’une sonde d’intégrité pour l’équilibrage de charge des points de terminaison)](https://blogs.msdn.microsoft.com/mast/2016/01/26/endpoint-load-balancing-heath-probe-configuration-details/).</span><span class="sxs-lookup"><span data-stu-id="bad87-151">For more information about health probe configuration, see [Endpoint Load Balancing health probe configuration](https://blogs.msdn.microsoft.com/mast/2016/01/26/endpoint-load-balancing-heath-probe-configuration-details/).</span></span>

## <a name="symptom-vms-behind-load-balancer-are-not-responding-to-traffic-on-the-configured-data-port"></a><span data-ttu-id="bad87-152">Symptôme : les machines virtuelles situées derrière l’équilibreur de charge ne répondent pas au trafic sur le port de données configuré</span><span class="sxs-lookup"><span data-stu-id="bad87-152">Symptom: VMs behind Load Balancer are not responding to traffic on the configured data port</span></span>

<span data-ttu-id="bad87-153">Si une machine virtuelle d’un pool principal est répertoriée comme saine et répond aux sondes d’intégrité, mais ne participe toujours pas à l’équilibrage de charge ou ne répond pas au trafic de données, ce peut être dû à l’une des raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="bad87-153">If a backend pool VM is listed as healthy and responds to the health probes, but is still not participating in the Load Balancing, or is not responding to the data traffic, it may be due to any of the following reasons:</span></span> 
* <span data-ttu-id="bad87-154">Une machine virtuelle du pool principal de l’équilibreur de charge n’écoute pas sur le port de données</span><span class="sxs-lookup"><span data-stu-id="bad87-154">Load Balancer Backend pool VM is not listening on the data port</span></span> 
* <span data-ttu-id="bad87-155">Un groupe de sécurité réseau bloque le port sur la machine virtuelle du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-155">Network security group is blocking the port on the Load Balancer backend pool VM</span></span>  
* <span data-ttu-id="bad87-156">Accès à l’équilibreur de charge à partir des mêmes machine virtuelle et carte d’interface réseau</span><span class="sxs-lookup"><span data-stu-id="bad87-156">Accessing the Load Balancer from the same VM and NIC</span></span> 
* <span data-ttu-id="bad87-157">Accès à l’adresse IP virtuelle de l’équilibreur de charge Internet à partir de la machine virtuelle du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-157">Accessing the Internet Load Balancer VIP from the participating Load Balancer backend pool VM</span></span> 

### <a name="cause-1-load-balancer-backend-pool-vm-is-not-listening-on-the-data-port"></a><span data-ttu-id="bad87-158">Cause 1 : une machine virtuelle du pool principal de l’équilibreur de charge n’écoute pas sur le port de données</span><span class="sxs-lookup"><span data-stu-id="bad87-158">Cause 1: Load Balancer backend pool VM is not listening on the data port</span></span> 
<span data-ttu-id="bad87-159">Si une machine virtuelle ne répond pas au trafic de données, il se peut que le port cible ne soit pas ouvert sur la machine virtuelle participant ou que la machine virtuelle n’écoute pas sur ce port.</span><span class="sxs-lookup"><span data-stu-id="bad87-159">If a VM does not respond to the data traffic, it may be because either the target port is not open on the participating VM, or, the VM is not listening on that port.</span></span> 

<span data-ttu-id="bad87-160">**Validation et résolution**</span><span class="sxs-lookup"><span data-stu-id="bad87-160">**Validation and resolution**</span></span>

1. <span data-ttu-id="bad87-161">Connectez-vous à la machine virtuelle principale.</span><span class="sxs-lookup"><span data-stu-id="bad87-161">Log in to the backend VM.</span></span> 
2. <span data-ttu-id="bad87-162">Ouvrez une invite de commandes et exécutez la commande suivante pour vérifier qu’une application écoute sur le port de données :</span><span class="sxs-lookup"><span data-stu-id="bad87-162">Open a command prompt and run the following command to validate there is an application listening on the data port:</span></span>  
            <span data-ttu-id="bad87-163">netstat -an</span><span class="sxs-lookup"><span data-stu-id="bad87-163">netstat -an</span></span> 
3. <span data-ttu-id="bad87-164">Si l’état du port indiqué n’est pas « ÉCOUTE », configurez le port d’écoute approprié.</span><span class="sxs-lookup"><span data-stu-id="bad87-164">If the port is not listed with State “LISTENING”, configure the proper listener port</span></span> 
4. <span data-ttu-id="bad87-165">Si l’état du port est Écoute, recherchez dans l’application cible sur ce port des problèmes possibles.</span><span class="sxs-lookup"><span data-stu-id="bad87-165">If the port is marked as Listening, then check the target application on that port for any possible issues.</span></span> 

### <a name="cause-2-network-security-group-is-blocking-the-port-on-the-load-balancer-backend-pool-vm"></a><span data-ttu-id="bad87-166">Cause 2 : un groupe de sécurité réseau bloque le port sur la machine virtuelle du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-166">Cause 2: Network security group is blocking the port on the Load Balancer backend pool VM</span></span>  

<span data-ttu-id="bad87-167">Si un ou plusieurs groupes de sécurité réseau configurés sur le sous-réseau ou sur la machine virtuelle bloquent l’adresse IP source ou le port, alors la machine virtuelle ne peut pas répondre.</span><span class="sxs-lookup"><span data-stu-id="bad87-167">If one or more network security groups configured on the subnet or on the VM, is blocking the source IP or port, then the VM is unable to respond.</span></span>

* <span data-ttu-id="bad87-168">Répertoriez les groupes de sécurité réseau configurés sur la machine virtuelle du pool principal.</span><span class="sxs-lookup"><span data-stu-id="bad87-168">List the network security groups configured on the backend VM.</span></span> <span data-ttu-id="bad87-169">Pour plus d'informations, consultez les pages suivantes :</span><span class="sxs-lookup"><span data-stu-id="bad87-169">For more information, see:</span></span>
    -  [<span data-ttu-id="bad87-170">Gérer les groupes de sécurité réseau à l’aide du portail Azure</span><span class="sxs-lookup"><span data-stu-id="bad87-170">Manage network security groups using the Portal</span></span>](../virtual-network/virtual-network-manage-nsg-arm-portal.md)
    -  [<span data-ttu-id="bad87-171">Gérer des groupes de sécurité réseau à l’aide de PowerShell</span><span class="sxs-lookup"><span data-stu-id="bad87-171">Manage network security groups using PowerShell</span></span>](../virtual-network/virtual-network-manage-nsg-arm-ps.md)
* <span data-ttu-id="bad87-172">Dans la liste des groupes de sécurité réseau, vérifiez si :</span><span class="sxs-lookup"><span data-stu-id="bad87-172">From the list of network security groups, check if:</span></span>
    - <span data-ttu-id="bad87-173">le trafic entrant ou sortant sur le port de données subit des interférences ;</span><span class="sxs-lookup"><span data-stu-id="bad87-173">the incoming or outgoing traffic on the data port has interference.</span></span> 
    - <span data-ttu-id="bad87-174">une règle **Refuser tout** des groupes de sécurité réseau sur la carte d’interface réseau de la machine virtuelle ou du sous-réseau a une priorité supérieure à celle de la règle par défaut qui autorise les sondes et le trafic de l’équilibreur de charge (les groupes de sécurité réseau doivent autoriser l’adresse IP 168.63.129.16 de l’équilibreur de charge qui correspond au port de la sonde).</span><span class="sxs-lookup"><span data-stu-id="bad87-174">a **Deny All** network security group rule on the NIC of the VM or the subnet that has a higher priority that the default rule that allows Load Balancer probes and traffic (network security groups must allow Load Balancer IP of 168.63.129.16, that is probe port)</span></span> 
* <span data-ttu-id="bad87-175">Si l’une des règles bloque le trafic, supprimez et reconfigurez ces règles pour autoriser le trafic de données.</span><span class="sxs-lookup"><span data-stu-id="bad87-175">If any of the rules are blocking the traffic, remove and reconfigure those rules to allow the data traffic.</span></span>  
* <span data-ttu-id="bad87-176">Vérifiez si la machine virtuelle répond à présent aux sondes d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="bad87-176">Test if the VM has now started to respond to the health probes.</span></span>

### <a name="cause-3-accessing-the-load-balancer-from-the-same-vm-and-network-interface"></a><span data-ttu-id="bad87-177">Cause 3 : accès à l’équilibreur de charge à partir des mêmes machine virtuelle et interface réseau</span><span class="sxs-lookup"><span data-stu-id="bad87-177">Cause 3: Accessing the Load Balancer from the same VM and Network interface</span></span> 

<span data-ttu-id="bad87-178">Si l’application hébergée sur la machine virtuelle principale d’un équilibreur de charge essaie d’accéder à une autre application hébergée dans la même machine virtuelle principale via la même interface réseau, ce scénario n’est pas pris en charge et échoue.</span><span class="sxs-lookup"><span data-stu-id="bad87-178">If your application hosted in the backend VM of a Load Balancer is trying to access another application hosted in the same backend VM over the same Network Interface, it is an unsupported scenario and will fail.</span></span> 

<span data-ttu-id="bad87-179">**Résolution** : vous pouvez résoudre ce problème via l’une des méthodes suivantes :</span><span class="sxs-lookup"><span data-stu-id="bad87-179">**Resolution** You can resolve this issue via one of the following methods:</span></span>
* <span data-ttu-id="bad87-180">Configurez des machines virtuelles du pool principal distinctes par application.</span><span class="sxs-lookup"><span data-stu-id="bad87-180">Configure separate backend pool VMs per application.</span></span> 
* <span data-ttu-id="bad87-181">Configurez l’application dans les machines virtuelles à double carte d’interface réseau afin que chaque application utilise sa propre interface réseau et adresse IP.</span><span class="sxs-lookup"><span data-stu-id="bad87-181">Configure the application in dual NIC VMs so each application was using its own Network interface and IP address.</span></span> 

### <a name="cause-4-accessing-the-internal-load-balancer-vip-from-the-participating-load-balancer-backend-pool-vm"></a><span data-ttu-id="bad87-182">Cause 4 : accès à l’adresse IP virtuelle de l’équilibreur de charge interne à partir de la machine virtuelle participante du pool principal de l’équilibreur de charge</span><span class="sxs-lookup"><span data-stu-id="bad87-182">Cause 4: Accessing the Internal Load Balancer VIP from the participating Load Balancer backend pool VM</span></span>

<span data-ttu-id="bad87-183">Si une adresse IP virtuelle de l’équilibreur de charge interne est configurée dans un réseau virtuel et que l’une des machines virtuelles principales participantes essaie d’y accéder, cela entraîne une défaillance.</span><span class="sxs-lookup"><span data-stu-id="bad87-183">If an ILB VIP is configured inside a VNet, and one of the participant backend VMs is trying to access the Internal Load Balancer VIP, that results in failure.</span></span> <span data-ttu-id="bad87-184">Ce scénario n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="bad87-184">This is an unsupported scenario.</span></span>
<span data-ttu-id="bad87-185">**Résolution** : évaluez Application Gateway ou d’autres proxys (par exemple, nginx ou haproxy) pour prendre en charge ce type de scénario.</span><span class="sxs-lookup"><span data-stu-id="bad87-185">**Resolution** Evaluate Application Gateway or other proxies (for example, nginx or haproxy) to support that kind of scenario.</span></span> <span data-ttu-id="bad87-186">Pour plus d’informations sur Application Gateway, consultez la page [Vue d’ensemble de la passerelle Application Gateway](../application-gateway/application-gateway-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="bad87-186">For more information about Application Gateway, see [Overview of Application Gateway](../application-gateway/application-gateway-introduction.md)</span></span>

## <a name="additional-network-captures"></a><span data-ttu-id="bad87-187">Captures de réseau supplémentaires</span><span class="sxs-lookup"><span data-stu-id="bad87-187">Additional network captures</span></span>
<span data-ttu-id="bad87-188">Si vous décidez d’ouvrir un dossier de support, collectez les informations suivantes pour accélérer la résolution du problème.</span><span class="sxs-lookup"><span data-stu-id="bad87-188">If you decide to open a support case, collect the following information for a quicker resolution.</span></span> <span data-ttu-id="bad87-189">Choisissez une machine virtuelle principale unique pour effectuer les tests suivants :</span><span class="sxs-lookup"><span data-stu-id="bad87-189">Choose a single backend VM to perform the following tests:</span></span>
- <span data-ttu-id="bad87-190">Utilisez Psping à partir d’une des machines virtuelles principales dans le réseau virtuel pour tester la réponse du port de la sonde (exemple : psping 10.0.0.4:3389) et enregistrez les résultats.</span><span class="sxs-lookup"><span data-stu-id="bad87-190">Use Psping from one of the backend VMs within the VNet to test the probe port response (example: psping 10.0.0.4:3389) and record results.</span></span> 
- <span data-ttu-id="bad87-191">Utilisez TCPing à partir d’une des machines virtuelles principales dans le réseau virtuel pour tester la réponse du port de la sonde (exemple : tcping 10.0.0.4:3389) et enregistrez les résultats.</span><span class="sxs-lookup"><span data-stu-id="bad87-191">Use TCPing from one of the backend VMs within the VNet to test the probe port response (example: psping 10.0.0.4:3389) and record results.</span></span>
- <span data-ttu-id="bad87-192">Si aucune réponse n’est reçue dans ces tests Ping, exécutez une trace Netsh simultanée sur la machine virtuelle principale et la machine virtuelle de test du réseau virtuel tout en exécutant PsPing, puis arrêtez la trace Netsh.</span><span class="sxs-lookup"><span data-stu-id="bad87-192">If no response is received in these ping tests, run a simultaneous Netsh trace on the backend VM and the VNet test VM while you run PsPing then stop the Netsh trace.</span></span> 
  
## <a name="next-steps"></a><span data-ttu-id="bad87-193">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bad87-193">Next steps</span></span>

<span data-ttu-id="bad87-194">Si les étapes précédentes ne vous permettent pas de résoudre le problème, ouvrez un [ticket d’incident](https://azure.microsoft.com/support/options/).</span><span class="sxs-lookup"><span data-stu-id="bad87-194">If the preceding steps do not resolve the issue, open a [support ticket](https://azure.microsoft.com/support/options/).</span></span>

