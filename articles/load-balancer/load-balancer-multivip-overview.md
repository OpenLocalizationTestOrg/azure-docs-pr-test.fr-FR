---
title: Adresses IP virtuelles multiples pour Azure Load Balancer | Microsoft Docs
description: "Vue d’ensemble des adresses IP virtuelles multiples dans Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: d9e88b859020be2a96a57a01e5624052ed134b64
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="f9f73-103">Adresses IP virtuelles multiples pour Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="f9f73-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="f9f73-104">Azure Load Balancer vous permet d’équilibrer la charge des services sur plusieurs ports, plusieurs adresses IP ou les deux.</span><span class="sxs-lookup"><span data-stu-id="f9f73-104">Azure Load Balancer allows you to load balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="f9f73-105">Vous pouvez utiliser les définitions d’équilibrage de charge public et interne pour charger les flux équilibrés sur un ensemble de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-105">You can use public and internal load balancer definitions to load balance flows across a set of VMs.</span></span>

<span data-ttu-id="f9f73-106">Cet article décrit les principes de base de cette capacité, les concepts importants et les contraintes.</span><span class="sxs-lookup"><span data-stu-id="f9f73-106">This article describes the fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="f9f73-107">Si vous souhaitez uniquement exposer des services sur une adresse IP, des instructions simplifiées sont disponibles pour les configurations d’équilibreur de charge [publiques](load-balancer-get-started-internet-portal.md) ou [internes](load-balancer-get-started-ilb-arm-portal.md).</span><span class="sxs-lookup"><span data-stu-id="f9f73-107">If you only intend to expose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="f9f73-108">Les adresses IP virtuelles multiples s’ajoutent à une configuration d’adresse IP virtuelle unique.</span><span class="sxs-lookup"><span data-stu-id="f9f73-108">Adding Multiple VIPs is incremental to a single VIP configuration.</span></span> <span data-ttu-id="f9f73-109">À l’aide des concepts présentés dans cet article, vous pouvez étendre une configuration simplifiée à tout moment.</span><span class="sxs-lookup"><span data-stu-id="f9f73-109">Using the concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="f9f73-110">Lorsque vous définissez un équilibrage de charge Azure, une configuration frontale et une configuration principale sont connectées avec des règles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="f9f73-111">La sonde d’intégrité référencée par la règle est utilisée pour déterminer comment les nouveaux flux sont envoyés à un nœud du pool principal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-111">The health probe referenced by the rule is used to determine how new flows are sent to a node in the backend pool.</span></span> <span data-ttu-id="f9f73-112">Le serveur frontal est défini par une adresse IP virtuelle (VIP), qui est un élément à 3 tuples comprenant une adresse IP (publique ou interne), un protocole de transport (TCP ou UDP) et un numéro de port.</span><span class="sxs-lookup"><span data-stu-id="f9f73-112">The frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="f9f73-113">Une adresse IP dédiée (DIP) est une adresse IP sur une carte réseau virtuelle Azure attachée à une machine virtuelle du pool principal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-113">A DIP is an IP address on an Azure virtual NIC attached to a VM in the backend pool.</span></span>

<span data-ttu-id="f9f73-114">Le tableau suivant contient quelques exemples de configurations frontales :</span><span class="sxs-lookup"><span data-stu-id="f9f73-114">The following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="f9f73-115">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="f9f73-115">VIP</span></span> | <span data-ttu-id="f9f73-116">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="f9f73-116">IP address</span></span> | <span data-ttu-id="f9f73-117">protocol</span><span class="sxs-lookup"><span data-stu-id="f9f73-117">protocol</span></span> | <span data-ttu-id="f9f73-118">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f9f73-119">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-119">1</span></span> |<span data-ttu-id="f9f73-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-120">65.52.0.1</span></span> |<span data-ttu-id="f9f73-121">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-121">TCP</span></span> |<span data-ttu-id="f9f73-122">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-122">80</span></span> |
| <span data-ttu-id="f9f73-123">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-123">2</span></span> |<span data-ttu-id="f9f73-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-124">65.52.0.1</span></span> |<span data-ttu-id="f9f73-125">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-125">TCP</span></span> |<span data-ttu-id="f9f73-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="f9f73-126">*8080*</span></span> |
| <span data-ttu-id="f9f73-127">3</span><span class="sxs-lookup"><span data-stu-id="f9f73-127">3</span></span> |<span data-ttu-id="f9f73-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-128">65.52.0.1</span></span> |<span data-ttu-id="f9f73-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="f9f73-129">*UDP*</span></span> |<span data-ttu-id="f9f73-130">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-130">80</span></span> |
| <span data-ttu-id="f9f73-131">4</span><span class="sxs-lookup"><span data-stu-id="f9f73-131">4</span></span> |<span data-ttu-id="f9f73-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="f9f73-132">*65.52.0.2*</span></span> |<span data-ttu-id="f9f73-133">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-133">TCP</span></span> |<span data-ttu-id="f9f73-134">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-134">80</span></span> |

<span data-ttu-id="f9f73-135">Le tableau montre quatre serveurs frontaux différents.</span><span class="sxs-lookup"><span data-stu-id="f9f73-135">The table shows four different frontends.</span></span> <span data-ttu-id="f9f73-136">Les serveurs frontaux nº 1, 2 et 3 présentent une adresse IP virtuelle unique avec des règles multiples.</span><span class="sxs-lookup"><span data-stu-id="f9f73-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="f9f73-137">La même adresse IP est utilisée, mais le port ou le protocole est différent pour chaque serveur frontal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-137">The same IP address is used but the port or protocol is different for each frontend.</span></span> <span data-ttu-id="f9f73-138">Les serveurs frontaux nº 1 et 4 sont des exemples d’adresses IP virtuelles multiples, avec la réutilisation d’un protocole et d’un port frontaux identiques sur plusieurs adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-138">Frontends #1 and #4 are an example of Multiple VIPs, where the same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="f9f73-139">Azure Load Balancer offre une certaine flexibilité pour définir les règles d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f9f73-139">Azure Load Balancer provides flexibility in defining the load balancing rules.</span></span> <span data-ttu-id="f9f73-140">Une règle indique de quelle manière une adresse et un port du serveur frontal sont mappés à l’adresse et au port de destination du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-140">A rule declares how an address and port on the frontend is mapped to the destination address and port on the backend.</span></span> <span data-ttu-id="f9f73-141">La réutilisation ou non des ports principaux pour différentes règles dépend du type de la règle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-141">Whether or not backend ports are reused across rules depends on the type of the rule.</span></span> <span data-ttu-id="f9f73-142">Chaque type de règle présente des exigences spécifiques qui peuvent affecter la configuration de l’hôte et la conception de la sonde.</span><span class="sxs-lookup"><span data-stu-id="f9f73-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="f9f73-143">Il existe deux types de règle :</span><span class="sxs-lookup"><span data-stu-id="f9f73-143">There are two types of rules:</span></span>

1. <span data-ttu-id="f9f73-144">La règle par défaut, sans réutilisation des ports principaux</span><span class="sxs-lookup"><span data-stu-id="f9f73-144">The default rule with no backend port reuse</span></span>
2. <span data-ttu-id="f9f73-145">La règle d’adresse IP flottante, où les ports principaux sont réutilisés</span><span class="sxs-lookup"><span data-stu-id="f9f73-145">The Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="f9f73-146">Azure Load Balancer vous permet d’associer les deux types de règle sur la même configuration d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f9f73-146">Azure Load Balancer allows you to mix both rule types on the same load balancer configuration.</span></span> <span data-ttu-id="f9f73-147">L’équilibrage de charge peut les utiliser simultanément pour une machine virtuelle donnée, ou toute combinaison, tant que vous respectez les contraintes de la règle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-147">The load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by the constraints of the rule.</span></span> <span data-ttu-id="f9f73-148">Le choix du type de règle dépend des exigences de votre application et de la complexité de la prise en charge de cette configuration.</span><span class="sxs-lookup"><span data-stu-id="f9f73-148">Which rule type you choose depends on the requirements of your application and the complexity of supporting that configuration.</span></span> <span data-ttu-id="f9f73-149">Vous devez évaluer quels types de règle conviennent le mieux à votre scénario.</span><span class="sxs-lookup"><span data-stu-id="f9f73-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="f9f73-150">Nous examinons ces scénarios plus en détail en commençant par le comportement par défaut.</span><span class="sxs-lookup"><span data-stu-id="f9f73-150">We explore these scenarios further by starting with the default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="f9f73-151">Type de règle nº 1 : pas de réutilisation des ports principaux</span><span class="sxs-lookup"><span data-stu-id="f9f73-151">Rule type #1: No backend port reuse</span></span>

![Illustration d’adresses IP multiples](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="f9f73-153">Dans ce scénario, les adresses IP virtuelles frontales sont configurées comme suit :</span><span class="sxs-lookup"><span data-stu-id="f9f73-153">In this scenario, the frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="f9f73-154">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="f9f73-154">VIP</span></span> | <span data-ttu-id="f9f73-155">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="f9f73-155">IP address</span></span> | <span data-ttu-id="f9f73-156">protocol</span><span class="sxs-lookup"><span data-stu-id="f9f73-156">protocol</span></span> | <span data-ttu-id="f9f73-157">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-157">port</span></span> |
| --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-159">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-159">1</span></span> |<span data-ttu-id="f9f73-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-160">65.52.0.1</span></span> |<span data-ttu-id="f9f73-161">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-161">TCP</span></span> |<span data-ttu-id="f9f73-162">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-162">80</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-164">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-164">2</span></span> |<span data-ttu-id="f9f73-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="f9f73-165">*65.52.0.2*</span></span> |<span data-ttu-id="f9f73-166">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-166">TCP</span></span> |<span data-ttu-id="f9f73-167">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-167">80</span></span> |

<span data-ttu-id="f9f73-168">L’adresse IP dédiée est la destination du flux entrant.</span><span class="sxs-lookup"><span data-stu-id="f9f73-168">The DIP is the destination of the inbound flow.</span></span> <span data-ttu-id="f9f73-169">Dans le pool principal, chaque machine virtuelle expose le service souhaité sur un port unique sur une adresse IP dédiée.</span><span class="sxs-lookup"><span data-stu-id="f9f73-169">In the backend pool, each VM exposes the desired service on a unique port on a DIP.</span></span> <span data-ttu-id="f9f73-170">Ce service est associé avec le serveur frontal via une définition de règles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-170">This service is associated with the frontend through a rule definition.</span></span>

<span data-ttu-id="f9f73-171">Nous définissons deux règles :</span><span class="sxs-lookup"><span data-stu-id="f9f73-171">We define two rules:</span></span>

| <span data-ttu-id="f9f73-172">Règle</span><span class="sxs-lookup"><span data-stu-id="f9f73-172">Rule</span></span> | <span data-ttu-id="f9f73-173">Mapper le serveur frontal</span><span class="sxs-lookup"><span data-stu-id="f9f73-173">Map frontend</span></span> | <span data-ttu-id="f9f73-174">Au pool principal</span><span class="sxs-lookup"><span data-stu-id="f9f73-174">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f9f73-175">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-175">1</span></span> |![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="f9f73-177">VIP1:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="f9f73-179">DIP1:80,</span></span> ![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="f9f73-181">DIP2:80</span></span> |
| <span data-ttu-id="f9f73-182">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-182">2</span></span> |![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="f9f73-184">VIP2:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="f9f73-186">DIP1:81,</span></span> ![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="f9f73-188">DIP2:81</span></span> |

<span data-ttu-id="f9f73-189">Le mappage complet dans Azure Load Balancer se présente désormais comme suit :</span><span class="sxs-lookup"><span data-stu-id="f9f73-189">The complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="f9f73-190">Règle</span><span class="sxs-lookup"><span data-stu-id="f9f73-190">Rule</span></span> | <span data-ttu-id="f9f73-191">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="f9f73-191">VIP IP address</span></span> | <span data-ttu-id="f9f73-192">protocol</span><span class="sxs-lookup"><span data-stu-id="f9f73-192">protocol</span></span> | <span data-ttu-id="f9f73-193">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-193">port</span></span> | <span data-ttu-id="f9f73-194">Destination</span><span class="sxs-lookup"><span data-stu-id="f9f73-194">Destination</span></span> | <span data-ttu-id="f9f73-195">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-197">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-197">1</span></span> |<span data-ttu-id="f9f73-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-198">65.52.0.1</span></span> |<span data-ttu-id="f9f73-199">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-199">TCP</span></span> |<span data-ttu-id="f9f73-200">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-200">80</span></span> |<span data-ttu-id="f9f73-201">Adresse IP dédiée</span><span class="sxs-lookup"><span data-stu-id="f9f73-201">DIP IP Address</span></span> |<span data-ttu-id="f9f73-202">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-202">80</span></span> |
| ![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-204">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-204">2</span></span> |<span data-ttu-id="f9f73-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="f9f73-205">65.52.0.2</span></span> |<span data-ttu-id="f9f73-206">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-206">TCP</span></span> |<span data-ttu-id="f9f73-207">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-207">80</span></span> |<span data-ttu-id="f9f73-208">Adresse IP dédiée</span><span class="sxs-lookup"><span data-stu-id="f9f73-208">DIP IP Address</span></span> |<span data-ttu-id="f9f73-209">81</span><span class="sxs-lookup"><span data-stu-id="f9f73-209">81</span></span> |

<span data-ttu-id="f9f73-210">Chaque règle doit produire un flux avec une combinaison unique d’adresse IP de destination et de port de destination.</span><span class="sxs-lookup"><span data-stu-id="f9f73-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="f9f73-211">En modifiant le port de destination du flux, il est possible de fournir des flux à la même adresse IP dédiée sur différents ports avec plusieurs règles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-211">By varying the destination port of the flow, multiple rules can deliver flows to the same DIP on different ports.</span></span>

<span data-ttu-id="f9f73-212">Les sondes d’intégrité sont toujours dirigées vers l’adresse IP dédiée d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-212">Health probes are always directed to the DIP of a VM.</span></span> <span data-ttu-id="f9f73-213">Vous devez vous assurer que votre sonde reflète l’intégrité de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-213">You must ensure you that your probe reflects the health of the VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="f9f73-214">Type de règle nº 2 : réutilisation des ports principaux à l’aide d’une adresse IP flottante</span><span class="sxs-lookup"><span data-stu-id="f9f73-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="f9f73-215">Azure Load Balancer offre la possibilité de réutiliser le port frontal sur plusieurs adresses IP virtuelles, quel que soit le type de règle utilisé.</span><span class="sxs-lookup"><span data-stu-id="f9f73-215">Azure Load Balancer provides the flexibility to reuse the frontend port across multiple VIPs regardless of the rule type used.</span></span> <span data-ttu-id="f9f73-216">En outre, dans certains scénarios d’application, il est préférable ou nécessaire que plusieurs instances d’application utilisent le même port sur une machine virtuelle du pool principal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-216">Additionally, some application scenarios prefer or require the same port to be used by multiple application instances on a single VM in the backend pool.</span></span> <span data-ttu-id="f9f73-217">Des exemples courants de réutilisation de port incluent le clustering pour la haute disponibilité, les appliances réseau virtuelles, ainsi que l’exposition de plusieurs points de terminaison TLS sans nouveau chiffrement.</span><span class="sxs-lookup"><span data-stu-id="f9f73-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="f9f73-218">Si vous souhaitez réutiliser le port principal pour plusieurs règles, vous devez activer la fonctionnalité d’adresse IP flottante dans la définition des règles.</span><span class="sxs-lookup"><span data-stu-id="f9f73-218">If you want to reuse the backend port across multiple rules, you must enable Floating IP in the rule definition.</span></span>

<span data-ttu-id="f9f73-219">L’adresse IP flottante est une partie de ce que l’on appelle le « retour direct du serveur » (DSR).</span><span class="sxs-lookup"><span data-stu-id="f9f73-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="f9f73-220">Le DSR se compose de deux éléments : une topologie de flux et un schéma de mappage d’adresses IP.</span><span class="sxs-lookup"><span data-stu-id="f9f73-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="f9f73-221">Du point de vue de la plate-forme, Azure Load Balancer fonctionne toujours dans une topologie de flux DSR, que l’adresse IP flottante soit activée ou non.</span><span class="sxs-lookup"><span data-stu-id="f9f73-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="f9f73-222">Cela signifie que la partie sortante d’un flux est toujours correctement réécrite pour retourner directement à l’origine.</span><span class="sxs-lookup"><span data-stu-id="f9f73-222">This means that the outbound part of a flow is always correctly rewritten to flow directly back to the origin.</span></span>

<span data-ttu-id="f9f73-223">Avec le type de règle par défaut, Azure expose un schéma classique de mappage d’adresses IP à équilibrage de charge pour simplifier l’utilisation.</span><span class="sxs-lookup"><span data-stu-id="f9f73-223">With the default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="f9f73-224">L’activation de l’adresse IP flottante modifie le schéma de mappage d’adresses IP pour offrir davantage de flexibilité, comme expliqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="f9f73-224">Enabling Floating IP changes the IP address mapping scheme to allow for additional flexibility as explained below.</span></span>

<span data-ttu-id="f9f73-225">Le schéma suivant illustre cette configuration :</span><span class="sxs-lookup"><span data-stu-id="f9f73-225">The following diagram illustrates this configuration:</span></span>

![Illustration d’adresses IP multiples](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="f9f73-227">Pour ce scénario, chaque machine virtuelle du pool principal a trois interfaces réseau :</span><span class="sxs-lookup"><span data-stu-id="f9f73-227">For this scenario, every VM in the backend pool has three network interfaces:</span></span>

* <span data-ttu-id="f9f73-228">DIP : carte réseau virtuelle associée à la machine virtuelle (configuration IP de ressource de carte réseau d’Azure)</span><span class="sxs-lookup"><span data-stu-id="f9f73-228">DIP: a Virtual NIC associated with the VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="f9f73-229">VIP1 : interface de bouclage du SE invité qui est configurée avec l’adresse IP de VIP1</span><span class="sxs-lookup"><span data-stu-id="f9f73-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="f9f73-230">VIP2 : interface de bouclage du SE invité qui est configurée avec l’adresse IP de VIP2</span><span class="sxs-lookup"><span data-stu-id="f9f73-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f9f73-231">La configuration des interfaces logiques est effectuée dans le SE invité.</span><span class="sxs-lookup"><span data-stu-id="f9f73-231">The configuration of the logical interfaces is performed within the guest OS.</span></span> <span data-ttu-id="f9f73-232">Cette configuration n’est pas exécutée ou gérée par Azure.</span><span class="sxs-lookup"><span data-stu-id="f9f73-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="f9f73-233">Sans cette configuration, les règles ne fonctionneront pas.</span><span class="sxs-lookup"><span data-stu-id="f9f73-233">Without this configuration, the rules will not function.</span></span> <span data-ttu-id="f9f73-234">Les définitions de sonde d’intégrité utilisent l’adresse IP dédiée de la machine virtuelle plutôt que l’adresse IP virtuelle logique.</span><span class="sxs-lookup"><span data-stu-id="f9f73-234">Health probe definitions use the DIP of the VM rather than the logical VIP.</span></span> <span data-ttu-id="f9f73-235">Par conséquent, votre service doit fournir les réponses de sonde sur un port de l’adresse IP dédiée qui reflète l’état du service offert sur l’adresse IP virtuelle logique.</span><span class="sxs-lookup"><span data-stu-id="f9f73-235">Therefore, your service must provide probe responses on a DIP port that reflect the status of the service offered on the logical VIP.</span></span>

<span data-ttu-id="f9f73-236">Prenons pour exemple la même configuration frontale que dans le scénario précédent :</span><span class="sxs-lookup"><span data-stu-id="f9f73-236">Let's assume the same frontend configuration as in the previous scenario:</span></span>

| <span data-ttu-id="f9f73-237">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="f9f73-237">VIP</span></span> | <span data-ttu-id="f9f73-238">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="f9f73-238">IP address</span></span> | <span data-ttu-id="f9f73-239">protocol</span><span class="sxs-lookup"><span data-stu-id="f9f73-239">protocol</span></span> | <span data-ttu-id="f9f73-240">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-240">port</span></span> |
| --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-242">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-242">1</span></span> |<span data-ttu-id="f9f73-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-243">65.52.0.1</span></span> |<span data-ttu-id="f9f73-244">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-244">TCP</span></span> |<span data-ttu-id="f9f73-245">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-245">80</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-247">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-247">2</span></span> |<span data-ttu-id="f9f73-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="f9f73-248">*65.52.0.2*</span></span> |<span data-ttu-id="f9f73-249">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-249">TCP</span></span> |<span data-ttu-id="f9f73-250">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-250">80</span></span> |

<span data-ttu-id="f9f73-251">Nous définissons deux règles :</span><span class="sxs-lookup"><span data-stu-id="f9f73-251">We define two rules:</span></span>

| <span data-ttu-id="f9f73-252">Règle</span><span class="sxs-lookup"><span data-stu-id="f9f73-252">Rule</span></span> | <span data-ttu-id="f9f73-253">Mapper le serveur frontal</span><span class="sxs-lookup"><span data-stu-id="f9f73-253">Map frontend</span></span> | <span data-ttu-id="f9f73-254">Au pool principal</span><span class="sxs-lookup"><span data-stu-id="f9f73-254">To backend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="f9f73-255">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-255">1</span></span> |![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="f9f73-257">VIP1:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-259">VIP1:80 (dans les machines virtuelles 1 et 2)</span><span class="sxs-lookup"><span data-stu-id="f9f73-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="f9f73-260">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-260">2</span></span> |![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="f9f73-262">VIP2:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-264">VIP2:80 (dans les machines virtuelles 1 et 2)</span><span class="sxs-lookup"><span data-stu-id="f9f73-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="f9f73-265">Le tableau suivant présente le mappage complet de l’équilibrage de charge :</span><span class="sxs-lookup"><span data-stu-id="f9f73-265">The following table shows the complete mapping in the load balancer:</span></span>

| <span data-ttu-id="f9f73-266">Règle</span><span class="sxs-lookup"><span data-stu-id="f9f73-266">Rule</span></span> | <span data-ttu-id="f9f73-267">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="f9f73-267">VIP IP address</span></span> | <span data-ttu-id="f9f73-268">protocol</span><span class="sxs-lookup"><span data-stu-id="f9f73-268">protocol</span></span> | <span data-ttu-id="f9f73-269">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-269">port</span></span> | <span data-ttu-id="f9f73-270">Destination</span><span class="sxs-lookup"><span data-stu-id="f9f73-270">Destination</span></span> | <span data-ttu-id="f9f73-271">port</span><span class="sxs-lookup"><span data-stu-id="f9f73-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="f9f73-273">1</span><span class="sxs-lookup"><span data-stu-id="f9f73-273">1</span></span> |<span data-ttu-id="f9f73-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="f9f73-274">65.52.0.1</span></span> |<span data-ttu-id="f9f73-275">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-275">TCP</span></span> |<span data-ttu-id="f9f73-276">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-276">80</span></span> |<span data-ttu-id="f9f73-277">Identique à l’adresse IP virtuelle (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="f9f73-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="f9f73-278">Identique à l’adresse IP virtuelle (80)</span><span class="sxs-lookup"><span data-stu-id="f9f73-278">same as VIP (80)</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="f9f73-280">2</span><span class="sxs-lookup"><span data-stu-id="f9f73-280">2</span></span> |<span data-ttu-id="f9f73-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="f9f73-281">65.52.0.2</span></span> |<span data-ttu-id="f9f73-282">TCP</span><span class="sxs-lookup"><span data-stu-id="f9f73-282">TCP</span></span> |<span data-ttu-id="f9f73-283">80</span><span class="sxs-lookup"><span data-stu-id="f9f73-283">80</span></span> |<span data-ttu-id="f9f73-284">Identique à l’adresse IP virtuelle (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="f9f73-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="f9f73-285">Identique à l’adresse IP virtuelle (80)</span><span class="sxs-lookup"><span data-stu-id="f9f73-285">same as VIP (80)</span></span> |

<span data-ttu-id="f9f73-286">La destination du flux entrant est l’adresse IP virtuelle sur l’interface de bouclage de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-286">The destination of the inbound flow is the VIP address on the loopback interface in the VM.</span></span> <span data-ttu-id="f9f73-287">Chaque règle doit produire un flux avec une combinaison unique d’adresse IP de destination et de port de destination.</span><span class="sxs-lookup"><span data-stu-id="f9f73-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="f9f73-288">En modifiant l’adresse IP de destination du flux, la réutilisation de port est possible sur la même machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="f9f73-288">By varying the destination IP address of the flow, port reuse is possible on the same VM.</span></span> <span data-ttu-id="f9f73-289">Votre service est exposé à l’équilibrage de charge en le liant à l’adresse IP virtuelle et au port de l’interface de bouclage associée.</span><span class="sxs-lookup"><span data-stu-id="f9f73-289">Your service is exposed to the load balancer by binding it to the VIP’s IP address and port of the respective loopback interface.</span></span>

<span data-ttu-id="f9f73-290">Notez que cet exemple ne modifie pas le port de destination.</span><span class="sxs-lookup"><span data-stu-id="f9f73-290">Notice that this example does not change the destination port.</span></span> <span data-ttu-id="f9f73-291">Bien qu’il s’agisse d’un scénario d’adresse IP flottante, l’équilibrage de charge Azure prend également en charge la définition d’une règle pour réécrire le port de destination principal afin qu’il soit différent du port de destination frontal.</span><span class="sxs-lookup"><span data-stu-id="f9f73-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule to rewrite the backend destination port and to make it different from the frontend destination port.</span></span>

<span data-ttu-id="f9f73-292">Le type de règle faisant appel à l’adresse IP flottante constitue la base de plusieurs modèles de configuration d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f9f73-292">The Floating IP rule type is the foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="f9f73-293">Un exemple disponible actuellement est la configuration [SQL AlwaysOn avec plusieurs écouteurs](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) .</span><span class="sxs-lookup"><span data-stu-id="f9f73-293">One example that is currently available is the [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="f9f73-294">Au fil du temps, nous documenterons un plus grand nombre de ces scénarios.</span><span class="sxs-lookup"><span data-stu-id="f9f73-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="f9f73-295">Limitations</span><span class="sxs-lookup"><span data-stu-id="f9f73-295">Limitations</span></span>

* <span data-ttu-id="f9f73-296">Les configurations d’adresses IP virtuelles multiples sont uniquement prises en charge avec les machines virtuelles IaaS.</span><span class="sxs-lookup"><span data-stu-id="f9f73-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="f9f73-297">Avec la règle d’adresse IP flottante, votre application doit utiliser l’adresse IP dédiée pour les flux sortants.</span><span class="sxs-lookup"><span data-stu-id="f9f73-297">With the Floating IP rule, your application must use the DIP for outbound flows.</span></span> <span data-ttu-id="f9f73-298">Si votre application se lie à l’adresse IP virtuelle configurée sur l’interface de bouclage du SE invité, SNAT n’est pas disponible pour réécrire le flux sortant et le flux échoue.</span><span class="sxs-lookup"><span data-stu-id="f9f73-298">If your application binds to the VIP address configured on the loopback interface in the guest OS, then SNAT is not available to rewrite the outbound flow and the flow fails.</span></span>
* <span data-ttu-id="f9f73-299">Les adresses IP publiques ont une incidence sur la facturation.</span><span class="sxs-lookup"><span data-stu-id="f9f73-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="f9f73-300">Pour plus d’informations, voir la page [Tarification des adresses IP](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="f9f73-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="f9f73-301">Des limites d’abonnement s’appliquent.</span><span class="sxs-lookup"><span data-stu-id="f9f73-301">Subscription limits apply.</span></span> <span data-ttu-id="f9f73-302">Pour plus d’informations, voir les [limites de service](../azure-subscription-service-limits.md#networking-limits) .</span><span class="sxs-lookup"><span data-stu-id="f9f73-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
