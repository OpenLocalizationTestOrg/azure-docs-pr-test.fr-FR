---
title: "aaaMultiple VIP d’équilibrage de charge Azure | Documents Microsoft"
description: "Vue d’ensemble des adresses IP virtuelles multiples dans Azure Load Balancer"
services: load-balancer
documentationcenter: na
author: chkuhtz
manager: narayan
editor: 
ms.assetid: 748e50cd-3087-4c2e-a9e1-ac0ecce4f869
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/11/2016
ms.author: chkuhtz
ms.openlocfilehash: e186e1248e7d187e7efd0668dc3244465ce3e156
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="multiple-vips-for-azure-load-balancer"></a><span data-ttu-id="4bc70-103">Adresses IP virtuelles multiples pour Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="4bc70-103">Multiple VIPs for Azure Load Balancer</span></span>

<span data-ttu-id="4bc70-104">Équilibrage de charge Azure vous permet de services de solde tooload sur plusieurs ports, plusieurs adresses IP ou les deux.</span><span class="sxs-lookup"><span data-stu-id="4bc70-104">Azure Load Balancer allows you tooload balance services on multiple ports, multiple IP addresses, or both.</span></span> <span data-ttu-id="4bc70-105">Vous pouvez utiliser des flux équilibre de charge publics et internes équilibrage définitions tooload sur un ensemble de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="4bc70-105">You can use public and internal load balancer definitions tooload balance flows across a set of VMs.</span></span>

<span data-ttu-id="4bc70-106">Cet article décrit les notions de base hello de cette possibilité, les concepts importants et les contraintes.</span><span class="sxs-lookup"><span data-stu-id="4bc70-106">This article describes hello fundamentals of this ability, important concepts, and constraints.</span></span> <span data-ttu-id="4bc70-107">Si vous envisagez uniquement tooexpose services sur une seule adresse IP, vous trouverez des instructions simplifiées pour [public](load-balancer-get-started-internet-portal.md) ou [interne](load-balancer-get-started-ilb-arm-portal.md) configurations d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="4bc70-107">If you only intend tooexpose services on one IP address, you can find simplified instructions for [public](load-balancer-get-started-internet-portal.md) or [internal](load-balancer-get-started-ilb-arm-portal.md) load balancer configurations.</span></span> <span data-ttu-id="4bc70-108">Ajout de plusieurs adresses IP virtuelles est la configuration de l’adresse IP virtuelle unique tooa incrémentielle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-108">Adding Multiple VIPs is incremental tooa single VIP configuration.</span></span> <span data-ttu-id="4bc70-109">À l’aide des concepts de hello dans cet article, vous pouvez développer une configuration simplifiée à tout moment.</span><span class="sxs-lookup"><span data-stu-id="4bc70-109">Using hello concepts in this article, you can expand a simplified configuration at any time.</span></span>

<span data-ttu-id="4bc70-110">Lorsque vous définissez un équilibrage de charge Azure, une configuration frontale et une configuration principale sont connectées avec des règles.</span><span class="sxs-lookup"><span data-stu-id="4bc70-110">When you define an Azure Load Balancer, a frontend and a backend configuration are connected with rules.</span></span> <span data-ttu-id="4bc70-111">Sonde d’intégrité référencé par la règle de hello Hello est utilisé toodetermine nouveaux flux sont envoyées tooa nœud dans le pool principal d’hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-111">hello health probe referenced by hello rule is used toodetermine how new flows are sent tooa node in hello backend pool.</span></span> <span data-ttu-id="4bc70-112">serveur frontal de Hello est défini par une IP virtuelle (VIP), qui est un objet de 3 tuples constitué d’une adresse IP (publique ou interne), un protocole de transport (TCP ou UDP) et un numéro de port.</span><span class="sxs-lookup"><span data-stu-id="4bc70-112">hello frontend is defined by a Virtual IP (VIP), which is a 3-tuple comprised of an IP address (public or internal), a transport protocol (UDP or TCP), and a port number.</span></span> <span data-ttu-id="4bc70-113">Une adresse DIP est qu'une adresse IP sur une carte de réseau virtuel Azure attaché tooa machine virtuelle dans le pool principal d’hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-113">A DIP is an IP address on an Azure virtual NIC attached tooa VM in hello backend pool.</span></span>

<span data-ttu-id="4bc70-114">Hello tableau suivant contient quelques exemples de configuration de serveur frontal :</span><span class="sxs-lookup"><span data-stu-id="4bc70-114">hello following table contains some example frontend configurations:</span></span>

| <span data-ttu-id="4bc70-115">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="4bc70-115">VIP</span></span> | <span data-ttu-id="4bc70-116">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="4bc70-116">IP address</span></span> | <span data-ttu-id="4bc70-117">protocol</span><span class="sxs-lookup"><span data-stu-id="4bc70-117">protocol</span></span> | <span data-ttu-id="4bc70-118">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-118">port</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="4bc70-119">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-119">1</span></span> |<span data-ttu-id="4bc70-120">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-120">65.52.0.1</span></span> |<span data-ttu-id="4bc70-121">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-121">TCP</span></span> |<span data-ttu-id="4bc70-122">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-122">80</span></span> |
| <span data-ttu-id="4bc70-123">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-123">2</span></span> |<span data-ttu-id="4bc70-124">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-124">65.52.0.1</span></span> |<span data-ttu-id="4bc70-125">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-125">TCP</span></span> |<span data-ttu-id="4bc70-126">*8080*</span><span class="sxs-lookup"><span data-stu-id="4bc70-126">*8080*</span></span> |
| <span data-ttu-id="4bc70-127">3</span><span class="sxs-lookup"><span data-stu-id="4bc70-127">3</span></span> |<span data-ttu-id="4bc70-128">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-128">65.52.0.1</span></span> |<span data-ttu-id="4bc70-129">*UDP*</span><span class="sxs-lookup"><span data-stu-id="4bc70-129">*UDP*</span></span> |<span data-ttu-id="4bc70-130">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-130">80</span></span> |
| <span data-ttu-id="4bc70-131">4</span><span class="sxs-lookup"><span data-stu-id="4bc70-131">4</span></span> |<span data-ttu-id="4bc70-132">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="4bc70-132">*65.52.0.2*</span></span> |<span data-ttu-id="4bc70-133">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-133">TCP</span></span> |<span data-ttu-id="4bc70-134">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-134">80</span></span> |

<span data-ttu-id="4bc70-135">table de Hello montre quatre des serveurs frontaux différents.</span><span class="sxs-lookup"><span data-stu-id="4bc70-135">hello table shows four different frontends.</span></span> <span data-ttu-id="4bc70-136">Les serveurs frontaux nº 1, 2 et 3 présentent une adresse IP virtuelle unique avec des règles multiples.</span><span class="sxs-lookup"><span data-stu-id="4bc70-136">Frontends #1, #2 and #3 are a single VIP with multiple rules.</span></span> <span data-ttu-id="4bc70-137">Hello même adresse IP est utilisée mais hello port ou protocole est différent pour chaque serveur frontal.</span><span class="sxs-lookup"><span data-stu-id="4bc70-137">hello same IP address is used but hello port or protocol is different for each frontend.</span></span> <span data-ttu-id="4bc70-138">Les serveurs frontaux #1 et #4 constituent un exemple de plusieurs adresses IP virtuelles, dans laquelle hello même protocole de serveur frontal et le port sont réutilisées entre plusieurs adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="4bc70-138">Frontends #1 and #4 are an example of Multiple VIPs, where hello same frontend protocol and port are reused across multiple VIPs.</span></span>

<span data-ttu-id="4bc70-139">L’équilibrage de charge Azure fournit une grande souplesse dans la définition des règles d’équilibrage de charge hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-139">Azure Load Balancer provides flexibility in defining hello load balancing rules.</span></span> <span data-ttu-id="4bc70-140">Une règle déclare comment une adresse et un port sur le serveur frontal de hello adresse de destination de toohello mappé et le port sur hello principal.</span><span class="sxs-lookup"><span data-stu-id="4bc70-140">A rule declares how an address and port on hello frontend is mapped toohello destination address and port on hello backend.</span></span> <span data-ttu-id="4bc70-141">Ou non les ports du serveur principal sont réutilisés par ces règles dépend de type hello de règle de hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-141">Whether or not backend ports are reused across rules depends on hello type of hello rule.</span></span> <span data-ttu-id="4bc70-142">Chaque type de règle présente des exigences spécifiques qui peuvent affecter la configuration de l’hôte et la conception de la sonde.</span><span class="sxs-lookup"><span data-stu-id="4bc70-142">Each type of rule has specific requirements that can affect host configuration and probe design.</span></span> <span data-ttu-id="4bc70-143">Il existe deux types de règle :</span><span class="sxs-lookup"><span data-stu-id="4bc70-143">There are two types of rules:</span></span>

1. <span data-ttu-id="4bc70-144">réutilisation de la règle par défaut de Hello avec aucun port principal</span><span class="sxs-lookup"><span data-stu-id="4bc70-144">hello default rule with no backend port reuse</span></span>
2. <span data-ttu-id="4bc70-145">règle d’adresse IP flottante Hello dans laquelle les ports du serveur principal sont réutilisées</span><span class="sxs-lookup"><span data-stu-id="4bc70-145">hello Floating IP rule where backend ports are reused</span></span>

<span data-ttu-id="4bc70-146">L’équilibrage de charge Azure vous permet de toomix les deux types de règles sur hello même configuration d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="4bc70-146">Azure Load Balancer allows you toomix both rule types on hello same load balancer configuration.</span></span> <span data-ttu-id="4bc70-147">équilibrage de charge Hello peut les utiliser simultanément pour une machine virtuelle donnée, ou toute combinaison, tant que vous respectez des contraintes de la règle de hello hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-147">hello load balancer can use them simultaneously for a given VM, or any combination, as long as you abide by hello constraints of hello rule.</span></span> <span data-ttu-id="4bc70-148">Le type de règle que vous choisissez dépend de la configuration requise de hello de votre application et hello la complexité de prendre en charge cette configuration.</span><span class="sxs-lookup"><span data-stu-id="4bc70-148">Which rule type you choose depends on hello requirements of your application and hello complexity of supporting that configuration.</span></span> <span data-ttu-id="4bc70-149">Vous devez évaluer quels types de règle conviennent le mieux à votre scénario.</span><span class="sxs-lookup"><span data-stu-id="4bc70-149">You should evaluate which rule types are best for your scenario.</span></span>

<span data-ttu-id="4bc70-150">Nous explorons davantage ces scénarios en commençant par le comportement par défaut de hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-150">We explore these scenarios further by starting with hello default behavior.</span></span>

## <a name="rule-type-1-no-backend-port-reuse"></a><span data-ttu-id="4bc70-151">Type de règle nº 1 : pas de réutilisation des ports principaux</span><span class="sxs-lookup"><span data-stu-id="4bc70-151">Rule type #1: No backend port reuse</span></span>

![Illustration d’adresses IP multiples](./media/load-balancer-multivip-overview/load-balancer-multivip.png)

<span data-ttu-id="4bc70-153">Dans ce scénario, hello frontal adresses IP virtuelles sont configurées comme suit :</span><span class="sxs-lookup"><span data-stu-id="4bc70-153">In this scenario, hello frontend VIPs are configured as follows:</span></span>

| <span data-ttu-id="4bc70-154">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="4bc70-154">VIP</span></span> | <span data-ttu-id="4bc70-155">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="4bc70-155">IP address</span></span> | <span data-ttu-id="4bc70-156">protocol</span><span class="sxs-lookup"><span data-stu-id="4bc70-156">protocol</span></span> | <span data-ttu-id="4bc70-157">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-157">port</span></span> |
| --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-159">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-159">1</span></span> |<span data-ttu-id="4bc70-160">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-160">65.52.0.1</span></span> |<span data-ttu-id="4bc70-161">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-161">TCP</span></span> |<span data-ttu-id="4bc70-162">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-162">80</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-164">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-164">2</span></span> |<span data-ttu-id="4bc70-165">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="4bc70-165">*65.52.0.2*</span></span> |<span data-ttu-id="4bc70-166">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-166">TCP</span></span> |<span data-ttu-id="4bc70-167">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-167">80</span></span> |

<span data-ttu-id="4bc70-168">Hello DIP est destination hello hello flux entrant.</span><span class="sxs-lookup"><span data-stu-id="4bc70-168">hello DIP is hello destination of hello inbound flow.</span></span> <span data-ttu-id="4bc70-169">Dans le pool principal d’hello, chaque machine virtuelle expose service hello souhaité sur un port unique sur une adresse DIP.</span><span class="sxs-lookup"><span data-stu-id="4bc70-169">In hello backend pool, each VM exposes hello desired service on a unique port on a DIP.</span></span> <span data-ttu-id="4bc70-170">Ce service est associé à frontal hello via une définition de règle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-170">This service is associated with hello frontend through a rule definition.</span></span>

<span data-ttu-id="4bc70-171">Nous définissons deux règles :</span><span class="sxs-lookup"><span data-stu-id="4bc70-171">We define two rules:</span></span>

| <span data-ttu-id="4bc70-172">Règle</span><span class="sxs-lookup"><span data-stu-id="4bc70-172">Rule</span></span> | <span data-ttu-id="4bc70-173">Mapper le serveur frontal</span><span class="sxs-lookup"><span data-stu-id="4bc70-173">Map frontend</span></span> | <span data-ttu-id="4bc70-174">toobackend pool</span><span class="sxs-lookup"><span data-stu-id="4bc70-174">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4bc70-175">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-175">1</span></span> |![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-177">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="4bc70-177">VIP1:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-179">DIP1:80,</span><span class="sxs-lookup"><span data-stu-id="4bc70-179">DIP1:80,</span></span> ![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-181">DIP2:80</span><span class="sxs-lookup"><span data-stu-id="4bc70-181">DIP2:80</span></span> |
| <span data-ttu-id="4bc70-182">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-182">2</span></span> |![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-184">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="4bc70-184">VIP2:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-186">DIP1:81,</span><span class="sxs-lookup"><span data-stu-id="4bc70-186">DIP1:81,</span></span> ![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-188">DIP2:81</span><span class="sxs-lookup"><span data-stu-id="4bc70-188">DIP2:81</span></span> |

<span data-ttu-id="4bc70-189">mappage complet de Hello dans l’équilibrage de charge Azure est désormais comme suit :</span><span class="sxs-lookup"><span data-stu-id="4bc70-189">hello complete mapping in Azure Load Balancer is now as follows:</span></span>

| <span data-ttu-id="4bc70-190">Règle</span><span class="sxs-lookup"><span data-stu-id="4bc70-190">Rule</span></span> | <span data-ttu-id="4bc70-191">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="4bc70-191">VIP IP address</span></span> | <span data-ttu-id="4bc70-192">protocol</span><span class="sxs-lookup"><span data-stu-id="4bc70-192">protocol</span></span> | <span data-ttu-id="4bc70-193">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-193">port</span></span> | <span data-ttu-id="4bc70-194">Destination</span><span class="sxs-lookup"><span data-stu-id="4bc70-194">Destination</span></span> | <span data-ttu-id="4bc70-195">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-195">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-197">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-197">1</span></span> |<span data-ttu-id="4bc70-198">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-198">65.52.0.1</span></span> |<span data-ttu-id="4bc70-199">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-199">TCP</span></span> |<span data-ttu-id="4bc70-200">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-200">80</span></span> |<span data-ttu-id="4bc70-201">Adresse IP dédiée</span><span class="sxs-lookup"><span data-stu-id="4bc70-201">DIP IP Address</span></span> |<span data-ttu-id="4bc70-202">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-202">80</span></span> |
| ![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-204">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-204">2</span></span> |<span data-ttu-id="4bc70-205">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="4bc70-205">65.52.0.2</span></span> |<span data-ttu-id="4bc70-206">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-206">TCP</span></span> |<span data-ttu-id="4bc70-207">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-207">80</span></span> |<span data-ttu-id="4bc70-208">Adresse IP dédiée</span><span class="sxs-lookup"><span data-stu-id="4bc70-208">DIP IP Address</span></span> |<span data-ttu-id="4bc70-209">81</span><span class="sxs-lookup"><span data-stu-id="4bc70-209">81</span></span> |

<span data-ttu-id="4bc70-210">Chaque règle doit produire un flux avec une combinaison unique d’adresse IP de destination et de port de destination.</span><span class="sxs-lookup"><span data-stu-id="4bc70-210">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="4bc70-211">Par le port de destination hello variables du flux de hello, plusieurs règles peuvent offrir flux toohello DIP même sur des ports différents.</span><span class="sxs-lookup"><span data-stu-id="4bc70-211">By varying hello destination port of hello flow, multiple rules can deliver flows toohello same DIP on different ports.</span></span>

<span data-ttu-id="4bc70-212">Sondes d’intégrité sont toujours dirigée toohello DIP d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-212">Health probes are always directed toohello DIP of a VM.</span></span> <span data-ttu-id="4bc70-213">Vous devez vous assurer vous que votre analyse reflète intégrité hello hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-213">You must ensure you that your probe reflects hello health of hello VM.</span></span>

## <a name="rule-type-2-backend-port-reuse-by-using-floating-ip"></a><span data-ttu-id="4bc70-214">Type de règle nº 2 : réutilisation des ports principaux à l’aide d’une adresse IP flottante</span><span class="sxs-lookup"><span data-stu-id="4bc70-214">Rule type #2: backend port reuse by using Floating IP</span></span>

<span data-ttu-id="4bc70-215">Équilibrage de charge Azure souplesse hello port de serveur frontal hello tooreuse entre plusieurs adresses IP virtuelles, quelle que soit le type de règle hello utilisé.</span><span class="sxs-lookup"><span data-stu-id="4bc70-215">Azure Load Balancer provides hello flexibility tooreuse hello frontend port across multiple VIPs regardless of hello rule type used.</span></span> <span data-ttu-id="4bc70-216">En outre, certains scénarios d’application préfèrent ou requièrent des hello même port toobe utilisé par plusieurs instances d’application sur une seule machine virtuelle dans le pool principal d’hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-216">Additionally, some application scenarios prefer or require hello same port toobe used by multiple application instances on a single VM in hello backend pool.</span></span> <span data-ttu-id="4bc70-217">Des exemples courants de réutilisation de port incluent le clustering pour la haute disponibilité, les appliances réseau virtuelles, ainsi que l’exposition de plusieurs points de terminaison TLS sans nouveau chiffrement.</span><span class="sxs-lookup"><span data-stu-id="4bc70-217">Common examples of port reuse include clustering for high availability, network virtual appliances, and exposing multiple TLS endpoints without re-encryption.</span></span>

<span data-ttu-id="4bc70-218">Si vous souhaitez le port principal de hello tooreuse entre plusieurs règles, vous devez activer IP flottante dans la définition de règle hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-218">If you want tooreuse hello backend port across multiple rules, you must enable Floating IP in hello rule definition.</span></span>

<span data-ttu-id="4bc70-219">L’adresse IP flottante est une partie de ce que l’on appelle le « retour direct du serveur » (DSR).</span><span class="sxs-lookup"><span data-stu-id="4bc70-219">Floating IP is a portion of what is known as Direct Server Return (DSR).</span></span> <span data-ttu-id="4bc70-220">Le DSR se compose de deux éléments : une topologie de flux et un schéma de mappage d’adresses IP.</span><span class="sxs-lookup"><span data-stu-id="4bc70-220">DSR consists of two parts: a flow topology and an IP address mapping scheme.</span></span> <span data-ttu-id="4bc70-221">Du point de vue de la plate-forme, Azure Load Balancer fonctionne toujours dans une topologie de flux DSR, que l’adresse IP flottante soit activée ou non.</span><span class="sxs-lookup"><span data-stu-id="4bc70-221">At a platform level, Azure Load Balancer always operates in a DSR flow topology regardless of whether Floating IP is enabled or not.</span></span> <span data-ttu-id="4bc70-222">Cela signifie que hello sortant partie d’un flux est toujours correctement réécrite tooflow toohello directement arrière origine.</span><span class="sxs-lookup"><span data-stu-id="4bc70-222">This means that hello outbound part of a flow is always correctly rewritten tooflow directly back toohello origin.</span></span>

<span data-ttu-id="4bc70-223">Avec le type de règle par défaut hello, Azure expose une schéma de mappage d’adresse IP pour faciliter l’utilisation d’équilibrage de charge traditionnelle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-223">With hello default rule type, Azure exposes a traditional load balancing IP address mapping scheme for ease of use.</span></span> <span data-ttu-id="4bc70-224">L’activation d’adresse IP flottante modifie tooallow de schéma de mappage d’adresses IP hello pour une flexibilité supplémentaire comme expliqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="4bc70-224">Enabling Floating IP changes hello IP address mapping scheme tooallow for additional flexibility as explained below.</span></span>

<span data-ttu-id="4bc70-225">Hello suivant le diagramme illustre cette configuration :</span><span class="sxs-lookup"><span data-stu-id="4bc70-225">hello following diagram illustrates this configuration:</span></span>

![Illustration d’adresses IP multiples](./media/load-balancer-multivip-overview/load-balancer-multivip-dsr.png)

<span data-ttu-id="4bc70-227">Pour ce scénario, chaque machine virtuelle dans le pool principal d’hello a trois interfaces réseau :</span><span class="sxs-lookup"><span data-stu-id="4bc70-227">For this scenario, every VM in hello backend pool has three network interfaces:</span></span>

* <span data-ttu-id="4bc70-228">DIP : une carte réseau virtuelle associée hello VM (configuration IP de ressource des cartes réseau de Azure)</span><span class="sxs-lookup"><span data-stu-id="4bc70-228">DIP: a Virtual NIC associated with hello VM (IP configuration of Azure's NIC resource)</span></span>
* <span data-ttu-id="4bc70-229">VIP1 : interface de bouclage du SE invité qui est configurée avec l’adresse IP de VIP1</span><span class="sxs-lookup"><span data-stu-id="4bc70-229">VIP1: a loopback interface within guest OS that is configured with IP address of VIP1</span></span>
* <span data-ttu-id="4bc70-230">VIP2 : interface de bouclage du SE invité qui est configurée avec l’adresse IP de VIP2</span><span class="sxs-lookup"><span data-stu-id="4bc70-230">VIP2: a loopback interface within guest OS that is configured with IP address of VIP2</span></span>

> [!IMPORTANT]
> <span data-ttu-id="4bc70-231">configuration de Hello des interfaces logiques de hello est effectuée au sein du système d’exploitation invité de hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-231">hello configuration of hello logical interfaces is performed within hello guest OS.</span></span> <span data-ttu-id="4bc70-232">Cette configuration n’est pas exécutée ou gérée par Azure.</span><span class="sxs-lookup"><span data-stu-id="4bc70-232">This configuration is not performed or managed by Azure.</span></span> <span data-ttu-id="4bc70-233">Sans cette configuration, les règles de hello ne fonctionnera pas.</span><span class="sxs-lookup"><span data-stu-id="4bc70-233">Without this configuration, hello rules will not function.</span></span> <span data-ttu-id="4bc70-234">Définitions de sonde d’intégrité utilisent hello DIP Hello VM plutôt que hello VIP logique.</span><span class="sxs-lookup"><span data-stu-id="4bc70-234">Health probe definitions use hello DIP of hello VM rather than hello logical VIP.</span></span> <span data-ttu-id="4bc70-235">Par conséquent, votre service doit fournir des réponses de la sonde sur un port d’adresse DIP qui reflètent l’état hello hello du service de proposé sur l’adresse IP virtuelle de la logique hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-235">Therefore, your service must provide probe responses on a DIP port that reflect hello status of hello service offered on hello logical VIP.</span></span>

<span data-ttu-id="4bc70-236">Supposons que hello même configuration de serveur frontal comme dans le scénario précédent de hello :</span><span class="sxs-lookup"><span data-stu-id="4bc70-236">Let's assume hello same frontend configuration as in hello previous scenario:</span></span>

| <span data-ttu-id="4bc70-237">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="4bc70-237">VIP</span></span> | <span data-ttu-id="4bc70-238">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="4bc70-238">IP address</span></span> | <span data-ttu-id="4bc70-239">protocol</span><span class="sxs-lookup"><span data-stu-id="4bc70-239">protocol</span></span> | <span data-ttu-id="4bc70-240">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-240">port</span></span> |
| --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-242">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-242">1</span></span> |<span data-ttu-id="4bc70-243">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-243">65.52.0.1</span></span> |<span data-ttu-id="4bc70-244">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-244">TCP</span></span> |<span data-ttu-id="4bc70-245">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-245">80</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-247">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-247">2</span></span> |<span data-ttu-id="4bc70-248">*65.52.0.2*</span><span class="sxs-lookup"><span data-stu-id="4bc70-248">*65.52.0.2*</span></span> |<span data-ttu-id="4bc70-249">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-249">TCP</span></span> |<span data-ttu-id="4bc70-250">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-250">80</span></span> |

<span data-ttu-id="4bc70-251">Nous définissons deux règles :</span><span class="sxs-lookup"><span data-stu-id="4bc70-251">We define two rules:</span></span>

| <span data-ttu-id="4bc70-252">Règle</span><span class="sxs-lookup"><span data-stu-id="4bc70-252">Rule</span></span> | <span data-ttu-id="4bc70-253">Mapper le serveur frontal</span><span class="sxs-lookup"><span data-stu-id="4bc70-253">Map frontend</span></span> | <span data-ttu-id="4bc70-254">toobackend pool</span><span class="sxs-lookup"><span data-stu-id="4bc70-254">toobackend pool</span></span> |
| --- | --- | --- |
| <span data-ttu-id="4bc70-255">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-255">1</span></span> |![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-257">VIP1:80</span><span class="sxs-lookup"><span data-stu-id="4bc70-257">VIP1:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-259">VIP1:80 (dans les machines virtuelles 1 et 2)</span><span class="sxs-lookup"><span data-stu-id="4bc70-259">VIP1:80 (in VM1 and VM2)</span></span> |
| <span data-ttu-id="4bc70-260">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-260">2</span></span> |![Règle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-262">VIP2:80</span><span class="sxs-lookup"><span data-stu-id="4bc70-262">VIP2:80</span></span> |![Serveur principal](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-264">VIP2:80 (dans les machines virtuelles 1 et 2)</span><span class="sxs-lookup"><span data-stu-id="4bc70-264">VIP2:80 (in VM1 and VM2)</span></span> |

<span data-ttu-id="4bc70-265">Hello tableau suivant montre le mappage complet de hello dans l’équilibrage de charge hello :</span><span class="sxs-lookup"><span data-stu-id="4bc70-265">hello following table shows hello complete mapping in hello load balancer:</span></span>

| <span data-ttu-id="4bc70-266">Règle</span><span class="sxs-lookup"><span data-stu-id="4bc70-266">Rule</span></span> | <span data-ttu-id="4bc70-267">Adresse IP virtuelle</span><span class="sxs-lookup"><span data-stu-id="4bc70-267">VIP IP address</span></span> | <span data-ttu-id="4bc70-268">protocol</span><span class="sxs-lookup"><span data-stu-id="4bc70-268">protocol</span></span> | <span data-ttu-id="4bc70-269">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-269">port</span></span> | <span data-ttu-id="4bc70-270">Destination</span><span class="sxs-lookup"><span data-stu-id="4bc70-270">Destination</span></span> | <span data-ttu-id="4bc70-271">port</span><span class="sxs-lookup"><span data-stu-id="4bc70-271">port</span></span> |
| --- | --- | --- | --- | --- | --- |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-green.png) <span data-ttu-id="4bc70-273">1</span><span class="sxs-lookup"><span data-stu-id="4bc70-273">1</span></span> |<span data-ttu-id="4bc70-274">65.52.0.1</span><span class="sxs-lookup"><span data-stu-id="4bc70-274">65.52.0.1</span></span> |<span data-ttu-id="4bc70-275">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-275">TCP</span></span> |<span data-ttu-id="4bc70-276">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-276">80</span></span> |<span data-ttu-id="4bc70-277">Identique à l’adresse IP virtuelle (65.52.0.1)</span><span class="sxs-lookup"><span data-stu-id="4bc70-277">same as VIP (65.52.0.1)</span></span> |<span data-ttu-id="4bc70-278">Identique à l’adresse IP virtuelle (80)</span><span class="sxs-lookup"><span data-stu-id="4bc70-278">same as VIP (80)</span></span> |
| ![Adresse IP virtuelle](./media/load-balancer-multivip-overview/load-balancer-rule-purple.png) <span data-ttu-id="4bc70-280">2</span><span class="sxs-lookup"><span data-stu-id="4bc70-280">2</span></span> |<span data-ttu-id="4bc70-281">65.52.0.2</span><span class="sxs-lookup"><span data-stu-id="4bc70-281">65.52.0.2</span></span> |<span data-ttu-id="4bc70-282">TCP</span><span class="sxs-lookup"><span data-stu-id="4bc70-282">TCP</span></span> |<span data-ttu-id="4bc70-283">80</span><span class="sxs-lookup"><span data-stu-id="4bc70-283">80</span></span> |<span data-ttu-id="4bc70-284">Identique à l’adresse IP virtuelle (65.52.0.2)</span><span class="sxs-lookup"><span data-stu-id="4bc70-284">same as VIP (65.52.0.2)</span></span> |<span data-ttu-id="4bc70-285">Identique à l’adresse IP virtuelle (80)</span><span class="sxs-lookup"><span data-stu-id="4bc70-285">same as VIP (80)</span></span> |

<span data-ttu-id="4bc70-286">destination de Hello hello flux entrant est adresse hello VIP sur l’interface de boucle hello hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-286">hello destination of hello inbound flow is hello VIP address on hello loopback interface in hello VM.</span></span> <span data-ttu-id="4bc70-287">Chaque règle doit produire un flux avec une combinaison unique d’adresse IP de destination et de port de destination.</span><span class="sxs-lookup"><span data-stu-id="4bc70-287">Each rule must produce a flow with a unique combination of destination IP address and destination port.</span></span> <span data-ttu-id="4bc70-288">Par différents hello adresse IP de destination du flux de hello, la réutilisation de port est possible sur hello même machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="4bc70-288">By varying hello destination IP address of hello flow, port reuse is possible on hello same VM.</span></span> <span data-ttu-id="4bc70-289">Votre service est équilibrage de charge toohello exposé en le liant toohello de VIP adresse IP et port de l’interface de bouclage respectifs hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-289">Your service is exposed toohello load balancer by binding it toohello VIP’s IP address and port of hello respective loopback interface.</span></span>

<span data-ttu-id="4bc70-290">Notez que cet exemple ne modifie pas le port de destination hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-290">Notice that this example does not change hello destination port.</span></span> <span data-ttu-id="4bc70-291">Bien qu’il s’agit d’un scénario de l’adresse IP flottante, équilibrage de charge Azure prend également en charge définition d’un port de destination de règle toorewrite hello principal et le toomake il diffère de port de destination du serveur frontal hello.</span><span class="sxs-lookup"><span data-stu-id="4bc70-291">Even though this is a Floating IP scenario, Azure Load Balancer also supports defining a rule toorewrite hello backend destination port and toomake it different from hello frontend destination port.</span></span>

<span data-ttu-id="4bc70-292">Hello, type de règle d’adresse IP flottante est foundation hello des différents modèles de configuration d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="4bc70-292">hello Floating IP rule type is hello foundation of several load balancer configuration patterns.</span></span> <span data-ttu-id="4bc70-293">Un exemple qui est actuellement disponible est hello [SQL AlwaysOn avec plusieurs écouteurs](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span><span class="sxs-lookup"><span data-stu-id="4bc70-293">One example that is currently available is hello [SQL AlwaysOn with Multiple Listeners](../virtual-machines/windows/sql/virtual-machines-windows-portal-sql-ps-alwayson-int-listener.md) configuration.</span></span> <span data-ttu-id="4bc70-294">Au fil du temps, nous documenterons un plus grand nombre de ces scénarios.</span><span class="sxs-lookup"><span data-stu-id="4bc70-294">Over time, we will document more of these scenarios.</span></span>

## <a name="limitations"></a><span data-ttu-id="4bc70-295">Limitations</span><span class="sxs-lookup"><span data-stu-id="4bc70-295">Limitations</span></span>

* <span data-ttu-id="4bc70-296">Les configurations d’adresses IP virtuelles multiples sont uniquement prises en charge avec les machines virtuelles IaaS.</span><span class="sxs-lookup"><span data-stu-id="4bc70-296">Multiple VIP configurations are only supported with IaaS VMs.</span></span>
* <span data-ttu-id="4bc70-297">Règle d’adresse IP flottante hello, votre application doit utiliser hello DIP pour les flux sortants.</span><span class="sxs-lookup"><span data-stu-id="4bc70-297">With hello Floating IP rule, your application must use hello DIP for outbound flows.</span></span> <span data-ttu-id="4bc70-298">Si votre application lie l’adresse IP virtuelle de toohello configuré sur l’interface de bouclage hello dans le système d’exploitation invité de hello, puis SNAT n’est pas flux sortant de hello toorewrite disponibles et les flux hello échoue.</span><span class="sxs-lookup"><span data-stu-id="4bc70-298">If your application binds toohello VIP address configured on hello loopback interface in hello guest OS, then SNAT is not available toorewrite hello outbound flow and hello flow fails.</span></span>
* <span data-ttu-id="4bc70-299">Les adresses IP publiques ont une incidence sur la facturation.</span><span class="sxs-lookup"><span data-stu-id="4bc70-299">Public IP addresses have an effect on billing.</span></span> <span data-ttu-id="4bc70-300">Pour plus d’informations, voir la page [Tarification des adresses IP](https://azure.microsoft.com/pricing/details/ip-addresses/)</span><span class="sxs-lookup"><span data-stu-id="4bc70-300">For more information, see [IP Address pricing](https://azure.microsoft.com/pricing/details/ip-addresses/)</span></span>
* <span data-ttu-id="4bc70-301">Des limites d’abonnement s’appliquent.</span><span class="sxs-lookup"><span data-stu-id="4bc70-301">Subscription limits apply.</span></span> <span data-ttu-id="4bc70-302">Pour plus d’informations, voir les [limites de service](../azure-subscription-service-limits.md#networking-limits) .</span><span class="sxs-lookup"><span data-stu-id="4bc70-302">For more information, see [Service limits](../azure-subscription-service-limits.md#networking-limits) for details.</span></span>
