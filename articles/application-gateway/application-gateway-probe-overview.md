---
title: "Présentation de l’analyse du fonctionnement pour Azure Application Gateway | Microsoft Docs"
description: "En savoir plus sur les capacités d’analyse dans Azure Application Gateway"
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 7eeba328-bb2d-4d3e-bdac-7552e7900b7f
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 12/14/2016
ms.author: gwallace
ms.openlocfilehash: 899115d213e626f17e58c2e5f01313f760f9e7f4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="application-gateway-health-monitoring-overview"></a><span data-ttu-id="a76c0-103">Vue d’ensemble de l’analyse d’intégrité Application Gateway</span><span class="sxs-lookup"><span data-stu-id="a76c0-103">Application Gateway health monitoring overview</span></span>

<span data-ttu-id="a76c0-104">Azure Application Gateway analyse par défaut l’intégrité de toutes les ressources de son pool principal et supprime automatiquement du pool les ressources considérées comme défectueuses.</span><span class="sxs-lookup"><span data-stu-id="a76c0-104">Azure Application Gateway by default monitors the health of all resources in its back-end pool and automatically removes any resource considered unhealthy from the pool.</span></span> <span data-ttu-id="a76c0-105">Application Gateway continue de surveiller les instances défaillantes et les réintroduit dans le pool principal intègre une fois qu’elles redeviennent disponibles et répondent aux sondes d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="a76c0-105">Application Gateway continues to monitor the unhealthy instances and adds them back to the healthy back-end pool once they become available and respond to health probes.</span></span> <span data-ttu-id="a76c0-106">La passerelle d’application envoie les sondes d’intégrité avec le même port que celui défini dans les paramètres HTTP du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-106">Application gateway sends the health probes with the same port that is defined in the back-end HTTP settings.</span></span> <span data-ttu-id="a76c0-107">Cette configuration garantit que la sonde teste le même port que celui qu’utiliseraient les clients pour se connecter au serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-107">This configuration ensures that the probe is testing the same port that customers would be using to connect to the backend.</span></span>

![exemple de sonde application gateway][1]

<span data-ttu-id="a76c0-109">En plus d’utiliser la surveillance par sonde d’intégrité par défaut, vous pouvez aussi personnaliser la sonde d’intégrité pour répondre aux exigences de votre application.</span><span class="sxs-lookup"><span data-stu-id="a76c0-109">In addition to using default health probe monitoring, you can also customize the health probe to suit your application's requirements.</span></span> <span data-ttu-id="a76c0-110">Dans cet article, nous nous intéressons aux sondes d’intégrité par défaut et personnalisées.</span><span class="sxs-lookup"><span data-stu-id="a76c0-110">In this article, both default and custom health probes are covered.</span></span>

> [!NOTE]
> <span data-ttu-id="a76c0-111">Si le sous-réseau Application Gateway comporte un groupe de sécurité réseau, les plages de ports 65503-65534 doivent être ouvertes sur ce sous-réseau pour permettre l’arrivée du trafic entrant.</span><span class="sxs-lookup"><span data-stu-id="a76c0-111">If there is an NSG on Application Gateway subnet, port ranges 65503-65534 should be opened on the Application Gateway subnet for Inbound traffic.</span></span> <span data-ttu-id="a76c0-112">Ces ports sont requis pour permettre à l’API relative à l’intégrité du serveur principal de fonctionner correctement.</span><span class="sxs-lookup"><span data-stu-id="a76c0-112">These ports are required for the backend health API to work.</span></span>

## <a name="default-health-probe"></a><span data-ttu-id="a76c0-113">Sonde d’intégrité par défaut</span><span class="sxs-lookup"><span data-stu-id="a76c0-113">Default health probe</span></span>

<span data-ttu-id="a76c0-114">Une passerelle d’application configure automatiquement une sonde d’intégrité par défaut lorsque vous ne définissez pas de configuration de sonde personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a76c0-114">An application gateway automatically configures a default health probe when you don't set up any custom probe configuration.</span></span> <span data-ttu-id="a76c0-115">Le comportement d’analyse par défaut consiste à lancer une requête HTTP aux adresses IP configurées pour le pool principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-115">The monitoring behavior works by making an HTTP request to the IP addresses configured for the back-end pool.</span></span> <span data-ttu-id="a76c0-116">En ce qui concerne les sondes par défaut, si les paramètres HTTP du serveur principal sont configurés pour HTTPS, la sonde utilise également HTTPS pour tester l’intégrité des serveurs principaux.</span><span class="sxs-lookup"><span data-stu-id="a76c0-116">For default probes if the backend http settings are configured for HTTPS, the probe uses HTTPS as well to test health of the backends.</span></span>

<span data-ttu-id="a76c0-117">Par exemple : vous configurez votre passerelle d’application pour utiliser les serveurs principaux A, B et C, qui recevront le trafic réseau HTTP sur le port 80.</span><span class="sxs-lookup"><span data-stu-id="a76c0-117">For example: You configure your application gateway to use back-end servers A, B, and C to receive HTTP network traffic on port 80.</span></span> <span data-ttu-id="a76c0-118">Les contrôles de défaillance par défaut testent les trois serveurs toutes les 30 secondes pour obtenir une réponse HTTP correcte.</span><span class="sxs-lookup"><span data-stu-id="a76c0-118">The default health monitoring tests the three servers every 30 seconds for a healthy HTTP response.</span></span> <span data-ttu-id="a76c0-119">Le [code d’état](https://msdn.microsoft.com/library/aa287675.aspx) d’une réponse HTTP correcte est compris entre 200 et 399.</span><span class="sxs-lookup"><span data-stu-id="a76c0-119">A healthy HTTP response has a [status code](https://msdn.microsoft.com/library/aa287675.aspx) between 200 and 399.</span></span>

<span data-ttu-id="a76c0-120">Si l’analyse de la sonde par défaut échoue pour le serveur A, la passerelle d’application le retire de son pool principal et le trafic réseau cesse de passer par ce serveur.</span><span class="sxs-lookup"><span data-stu-id="a76c0-120">If the default probe check fails for server A, the application gateway removes it from its back-end pool, and network traffic stops flowing to this server.</span></span> <span data-ttu-id="a76c0-121">La sonde par défaut continue de contrôler le serveur A toutes les 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="a76c0-121">The default probe still continues to check for server A every 30 seconds.</span></span> <span data-ttu-id="a76c0-122">Dès que le serveur A répond avec succès à une requête de la sonde d’intégrité par défaut, il est réintroduit dans le pool principal en tant que serveur intègre et le trafic vers celui-ci reprend.</span><span class="sxs-lookup"><span data-stu-id="a76c0-122">When server A responds successfully to one request from a default health probe, it is added back as healthy to the back-end pool, and traffic starts flowing to the server again.</span></span>

### <a name="default-health-probe-settings"></a><span data-ttu-id="a76c0-123">Paramètres de sonde d’intégrité par défaut</span><span class="sxs-lookup"><span data-stu-id="a76c0-123">Default health probe settings</span></span>

| <span data-ttu-id="a76c0-124">Propriétés de la sonde</span><span class="sxs-lookup"><span data-stu-id="a76c0-124">Probe property</span></span> | <span data-ttu-id="a76c0-125">Valeur</span><span class="sxs-lookup"><span data-stu-id="a76c0-125">Value</span></span> | <span data-ttu-id="a76c0-126">Description</span><span class="sxs-lookup"><span data-stu-id="a76c0-126">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a76c0-127">URL de sonde</span><span class="sxs-lookup"><span data-stu-id="a76c0-127">Probe URL</span></span> |<span data-ttu-id="a76c0-128">http://127.0.0.1:\<port\>/</span><span class="sxs-lookup"><span data-stu-id="a76c0-128">http://127.0.0.1:\<port\>/</span></span> |<span data-ttu-id="a76c0-129">Chemin d'accès de l'URL</span><span class="sxs-lookup"><span data-stu-id="a76c0-129">URL path</span></span> |
| <span data-ttu-id="a76c0-130">Intervalle</span><span class="sxs-lookup"><span data-stu-id="a76c0-130">Interval</span></span> |<span data-ttu-id="a76c0-131">30</span><span class="sxs-lookup"><span data-stu-id="a76c0-131">30</span></span> |<span data-ttu-id="a76c0-132">Intervalle d’analyse en secondes</span><span class="sxs-lookup"><span data-stu-id="a76c0-132">Probe interval in seconds</span></span> |
| <span data-ttu-id="a76c0-133">Délai d’attente</span><span class="sxs-lookup"><span data-stu-id="a76c0-133">Time-out</span></span> |<span data-ttu-id="a76c0-134">30</span><span class="sxs-lookup"><span data-stu-id="a76c0-134">30</span></span> |<span data-ttu-id="a76c0-135">Délai d’expiration de l’analyse en secondes</span><span class="sxs-lookup"><span data-stu-id="a76c0-135">Probe time-out in seconds</span></span> |
| <span data-ttu-id="a76c0-136">Seuil de défaillance sur le plan de l’intégrité</span><span class="sxs-lookup"><span data-stu-id="a76c0-136">Unhealthy threshold</span></span> |<span data-ttu-id="a76c0-137">3</span><span class="sxs-lookup"><span data-stu-id="a76c0-137">3</span></span> |<span data-ttu-id="a76c0-138">Nombre de tentatives d’analyse</span><span class="sxs-lookup"><span data-stu-id="a76c0-138">Probe retry count.</span></span> <span data-ttu-id="a76c0-139">Le serveur principal est marqué comme étant défectueux après que le nombre d’échecs consécutifs a atteint le seuil de défaillance.</span><span class="sxs-lookup"><span data-stu-id="a76c0-139">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!NOTE]
> <span data-ttu-id="a76c0-140">Le port est le même que celui utilisé par les paramètres HTTP du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-140">The port is the same port as the back-end HTTP settings.</span></span>

<span data-ttu-id="a76c0-141">La sonde par défaut examine uniquement http://127.0.0.1:\<port\> pour déterminer l’état d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="a76c0-141">The default probe looks only at http://127.0.0.1:\<port\> to determine health status.</span></span> <span data-ttu-id="a76c0-142">Si vous devez configurer la sonde d’intégrité de sorte qu’elle accède à une URL personnalisée ou modifier d’autres paramètres, vous devez utiliser des sondes personnalisées comme décrit dans les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="a76c0-142">If you need to configure the health probe to go to a custom URL or modify any other settings, you must use custom probes as described in the following steps:</span></span>

## <a name="custom-health-probe"></a><span data-ttu-id="a76c0-143">Sonde d’intégrité personnalisée</span><span class="sxs-lookup"><span data-stu-id="a76c0-143">Custom health probe</span></span>

<span data-ttu-id="a76c0-144">Les sondes personnalisées vous permettent d’avoir un contrôle plus précis de l’analyse de l’intégrité.</span><span class="sxs-lookup"><span data-stu-id="a76c0-144">Custom probes allow you to have a more granular control over the health monitoring.</span></span> <span data-ttu-id="a76c0-145">En utilisant des sondes personnalisées, vous pouvez configurer l’intervalle d’analyse, l’URL et le chemin à tester et le nombre de réponses en échec autorisé avant que l’instance de pool principal soit marquée comme étant défectueuse.</span><span class="sxs-lookup"><span data-stu-id="a76c0-145">When using custom probes, you can configure the probe interval, the URL and path to test, and how many failed responses to accept before marking the back-end pool instance as unhealthy.</span></span>

### <a name="custom-health-probe-settings"></a><span data-ttu-id="a76c0-146">Paramètres de sonde d’intégrité personnalisée</span><span class="sxs-lookup"><span data-stu-id="a76c0-146">Custom health probe settings</span></span>

<span data-ttu-id="a76c0-147">Le tableau suivant fournit des définitions pour les propriétés d’une sonde d’intégrité personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a76c0-147">The following table provides definitions for the properties of a custom health probe.</span></span>

| <span data-ttu-id="a76c0-148">Propriétés de la sonde</span><span class="sxs-lookup"><span data-stu-id="a76c0-148">Probe property</span></span> | <span data-ttu-id="a76c0-149">Description</span><span class="sxs-lookup"><span data-stu-id="a76c0-149">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a76c0-150">Name</span><span class="sxs-lookup"><span data-stu-id="a76c0-150">Name</span></span> |<span data-ttu-id="a76c0-151">Nom de la sonde.</span><span class="sxs-lookup"><span data-stu-id="a76c0-151">Name of the probe.</span></span> <span data-ttu-id="a76c0-152">Ce nom est utilisé pour désigner la sonde dans les paramètres HTTP du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-152">This name is used to refer to the probe in back-end HTTP settings.</span></span> |
| <span data-ttu-id="a76c0-153">Protocole</span><span class="sxs-lookup"><span data-stu-id="a76c0-153">Protocol</span></span> |<span data-ttu-id="a76c0-154">Protocole utilisé pour envoyer la sonde.</span><span class="sxs-lookup"><span data-stu-id="a76c0-154">Protocol used to send the probe.</span></span> <span data-ttu-id="a76c0-155">La sonde utilise le protocole défini dans les paramètres HTTP du serveur principal</span><span class="sxs-lookup"><span data-stu-id="a76c0-155">The probe uses the protocol defined in the back-end HTTP settings</span></span> |
| <span data-ttu-id="a76c0-156">Host</span><span class="sxs-lookup"><span data-stu-id="a76c0-156">Host</span></span> |<span data-ttu-id="a76c0-157">Nom d’hôte pour l’envoi de la sonde.</span><span class="sxs-lookup"><span data-stu-id="a76c0-157">Host name to send the probe.</span></span> <span data-ttu-id="a76c0-158">S’applique uniquement lorsque plusieurs sites sont configurés sur Application Gateway, sinon utilisez '127.0.0.1'.</span><span class="sxs-lookup"><span data-stu-id="a76c0-158">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="a76c0-159">Cette valeur est différente du nom d’hôte de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="a76c0-159">This value is different from VM host name.</span></span> |
| <span data-ttu-id="a76c0-160">Chemin</span><span class="sxs-lookup"><span data-stu-id="a76c0-160">Path</span></span> |<span data-ttu-id="a76c0-161">Chemin relatif de la sonde.</span><span class="sxs-lookup"><span data-stu-id="a76c0-161">Relative path of the probe.</span></span> <span data-ttu-id="a76c0-162">Le chemin valide commence par « / ».</span><span class="sxs-lookup"><span data-stu-id="a76c0-162">The valid path starts from '/'.</span></span> |
| <span data-ttu-id="a76c0-163">Intervalle</span><span class="sxs-lookup"><span data-stu-id="a76c0-163">Interval</span></span> |<span data-ttu-id="a76c0-164">Intervalle d’analyse en secondes.</span><span class="sxs-lookup"><span data-stu-id="a76c0-164">Probe interval in seconds.</span></span> <span data-ttu-id="a76c0-165">Cette valeur est l’intervalle de temps qui s’écoule entre deux analyses consécutives.</span><span class="sxs-lookup"><span data-stu-id="a76c0-165">This value is the time interval between two consecutive probes.</span></span> |
| <span data-ttu-id="a76c0-166">Délai d’attente</span><span class="sxs-lookup"><span data-stu-id="a76c0-166">Time-out</span></span> |<span data-ttu-id="a76c0-167">Délai d’expiration de l’analyse en secondes.</span><span class="sxs-lookup"><span data-stu-id="a76c0-167">Probe time-out in seconds.</span></span> <span data-ttu-id="a76c0-168">Si aucune réponse valide n’est reçue dans le délai imparti, la sonde est marquée comme étant en échec.</span><span class="sxs-lookup"><span data-stu-id="a76c0-168">If a valid response is not received within this time-out period, the probe is marked as failed.</span></span>  |
| <span data-ttu-id="a76c0-169">Seuil de défaillance sur le plan de l’intégrité</span><span class="sxs-lookup"><span data-stu-id="a76c0-169">Unhealthy threshold</span></span> |<span data-ttu-id="a76c0-170">Nombre de tentatives d’analyse</span><span class="sxs-lookup"><span data-stu-id="a76c0-170">Probe retry count.</span></span> <span data-ttu-id="a76c0-171">Le serveur principal est marqué comme étant défectueux après que le nombre d’échecs consécutifs a atteint le seuil de défaillance.</span><span class="sxs-lookup"><span data-stu-id="a76c0-171">The back-end server is marked down after the consecutive probe failure count reaches the unhealthy threshold.</span></span> |

> [!IMPORTANT]
> <span data-ttu-id="a76c0-172">Si Application Gateway est configuré pour un seul site, le nom d’hôte par défaut doit être spécifié sous la forme « 127.0.0.1 », sauf s’il est configuré d’une autre manière dans la sonde personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a76c0-172">If Application Gateway is configured for a single site, by default the Host name should be specified as '127.0.0.1', unless otherwise configured in custom probe.</span></span>
> <span data-ttu-id="a76c0-173">Pour référence, une sonde personnalisée est envoyée à \<protocole\>://\<hôte\>:\<port\>\<chemin d’accès\>.</span><span class="sxs-lookup"><span data-stu-id="a76c0-173">For reference a custom probe is sent to \<protocol\>://\<host\>:\<port\>\<path\>.</span></span> <span data-ttu-id="a76c0-174">Le port utilisé est identique à celui défini dans les paramètres HTTP du serveur principal.</span><span class="sxs-lookup"><span data-stu-id="a76c0-174">The port used will be the same port as defined in the back-end HTTP settings.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a76c0-175">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a76c0-175">Next steps</span></span>
<span data-ttu-id="a76c0-176">Après vous être familiarisé avec l’analyse d’intégrité Application Gateway, vous pouvez configurer une [sonde d’intégrité personnalisée](application-gateway-create-probe-portal.md) dans le portail Azure ou une [sonde d’intégrité personnalisée](application-gateway-create-probe-ps.md) à l’aide de PowerShell et du modèle de déploiement Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="a76c0-176">After learning about Application Gateway health monitoring, you can configure a [custom health probe](application-gateway-create-probe-portal.md) in the Azure portal or a [custom health probe](application-gateway-create-probe-ps.md) using PowerShell and the Azure Resource Manager deployment model.</span></span>

[1]: ./media/application-gateway-probe-overview/appgatewayprobe.png
