---
title: "Créer une sonde personnalisée - Passerelle Application Gateway Azure - Portail Azure | Microsoft Docs"
description: "Découvrez comment créer une sonde personnalisée pour Application Gateway à l’aide du portail"
services: application-gateway
documentationcenter: na
author: georgewallace
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 33fd5564-43a7-4c54-a9ec-b1235f661f97
ms.service: application-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/26/2017
ms.author: gwallace
ms.openlocfilehash: 65e9bba4ce9ac41ae2a9a8c3fa7f661165fc1403
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="create-a-custom-probe-for-application-gateway-by-using-the-portal"></a><span data-ttu-id="7023d-103">Créer une sonde personnalisée pour Application Gateway à l’aide du portail</span><span class="sxs-lookup"><span data-stu-id="7023d-103">Create a custom probe for Application Gateway by using the portal</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="7023d-104">Portail Azure</span><span class="sxs-lookup"><span data-stu-id="7023d-104">Azure portal</span></span>](application-gateway-create-probe-portal.md)
> * [<span data-ttu-id="7023d-105">Commandes PowerShell pour Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="7023d-105">Azure Resource Manager PowerShell</span></span>](application-gateway-create-probe-ps.md)
> * [<span data-ttu-id="7023d-106">Azure Classic PowerShell</span><span class="sxs-lookup"><span data-stu-id="7023d-106">Azure Classic PowerShell</span></span>](application-gateway-create-probe-classic-ps.md)

<span data-ttu-id="7023d-107">Dans cet article, une sonde personnalisée est ajoutée à une passerelle d’application existante via le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="7023d-107">In this article, you add a custom probe to an existing application gateway through the Azure portal.</span></span> <span data-ttu-id="7023d-108">Les sondes personnalisées sont utiles pour les applications qui ont une page de contrôle d’intégrité spécifique ou pour les applications qui ne fournissent pas de réponse correcte dans l’application web par défaut.</span><span class="sxs-lookup"><span data-stu-id="7023d-108">Custom probes are useful for applications that have a specific health check page or for applications that do not provide a successful response on the default web application.</span></span>

## <a name="before-you-begin"></a><span data-ttu-id="7023d-109">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="7023d-109">Before you begin</span></span>

<span data-ttu-id="7023d-110">Si vous ne disposez pas déjà d’une passerelle d’application, consultez [Créer une passerelle d’application](application-gateway-create-gateway-portal.md) pour créer une passerelle d’application fonctionnelle.</span><span class="sxs-lookup"><span data-stu-id="7023d-110">If you do not already have an application gateway, visit [Create an Application Gateway](application-gateway-create-gateway-portal.md) to create an application gateway to work with.</span></span>

## <span data-ttu-id="7023d-111"><a name="createprobe"></a>Créer la sonde</span><span class="sxs-lookup"><span data-stu-id="7023d-111"><a name="createprobe"></a>Create the probe</span></span>

<span data-ttu-id="7023d-112">Les sondes sont configurées via un processus en deux étapes sur le portail.</span><span class="sxs-lookup"><span data-stu-id="7023d-112">Probes are configured in a two-step process through the portal.</span></span> <span data-ttu-id="7023d-113">La première étape consiste à créer la sonde.</span><span class="sxs-lookup"><span data-stu-id="7023d-113">The first step is to create the probe.</span></span> <span data-ttu-id="7023d-114">Dans la deuxième étape, vous allez ajouter la sonde aux paramètres http backend de la passerelle d’application.</span><span class="sxs-lookup"><span data-stu-id="7023d-114">In the second step, you add the probe to the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="7023d-115">Connectez-vous au [portail Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="7023d-115">Log in to the [Azure portal](https://portal.azure.com).</span></span> <span data-ttu-id="7023d-116">Si vous ne possédez pas encore de compte, vous pouvez vous inscrire pour bénéficier d’un [essai gratuit d’un mois](https://azure.microsoft.com/free).</span><span class="sxs-lookup"><span data-stu-id="7023d-116">If you don't already have an account, you can sign up for a [free one-month trial](https://azure.microsoft.com/free)</span></span>

1. <span data-ttu-id="7023d-117">Dans le volet Favoris du portail Azure, cliquez sur Toutes les ressources.</span><span class="sxs-lookup"><span data-stu-id="7023d-117">In the Azure portal Favorites pane, click All resources.</span></span> <span data-ttu-id="7023d-118">Cliquez sur la passerelle d’application dans le panneau Toutes les ressources.</span><span class="sxs-lookup"><span data-stu-id="7023d-118">Click the application gateway in the All resources blade.</span></span> <span data-ttu-id="7023d-119">Si l’abonnement que vous avez déjà sélectionné comporte déjà plusieurs ressources, vous pouvez entrer partners.contoso.net dans la zone Filtrer par nom…</span><span class="sxs-lookup"><span data-stu-id="7023d-119">If the subscription you selected already has several resources in it, you can enter partners.contoso.net in the Filter by name…</span></span> <span data-ttu-id="7023d-120">pour accéder facilement à la passerelle d’application.</span><span class="sxs-lookup"><span data-stu-id="7023d-120">box to easily access the application gateway.</span></span>

1. <span data-ttu-id="7023d-121">Cliquez sur **Sondes**, puis cliquez sur le bouton **Ajouter** pour ajouter une sonde.</span><span class="sxs-lookup"><span data-stu-id="7023d-121">Click **Probes** and click the **Add** button to add a probe.</span></span>

  ![Ajouter un panneau Sonde contenant toutes les informations][1]

1. <span data-ttu-id="7023d-123">Dans le panneau **Ajouter une sonde d’intégrité**, fournissez les informations nécessaires à la sonde, puis cliquez sur **OK** une fois que vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="7023d-123">On the **Add health probe** blade, fill out the required information for the probe, and when complete click **OK**.</span></span>

  |<span data-ttu-id="7023d-124">**Paramètre**</span><span class="sxs-lookup"><span data-stu-id="7023d-124">**Setting**</span></span> | <span data-ttu-id="7023d-125">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="7023d-125">**Value**</span></span> | <span data-ttu-id="7023d-126">**Détails**</span><span class="sxs-lookup"><span data-stu-id="7023d-126">**Details**</span></span>|
  |---|---|---|
  |<span data-ttu-id="7023d-127">**Nom**</span><span class="sxs-lookup"><span data-stu-id="7023d-127">**Name**</span></span>|<span data-ttu-id="7023d-128">customProbe</span><span class="sxs-lookup"><span data-stu-id="7023d-128">customProbe</span></span>|<span data-ttu-id="7023d-129">Cette valeur est le nom convivial de la sonde à laquelle vous pouvez accéder dans le portail.</span><span class="sxs-lookup"><span data-stu-id="7023d-129">This value is a friendly name to the probe that is accessible in the portal.</span></span>|
  |<span data-ttu-id="7023d-130">**Protocole**</span><span class="sxs-lookup"><span data-stu-id="7023d-130">**Protocol**</span></span>|<span data-ttu-id="7023d-131">HTTP ou HTTPS</span><span class="sxs-lookup"><span data-stu-id="7023d-131">HTTP or HTTPS</span></span> | <span data-ttu-id="7023d-132">Protocole utilisé par la sonde d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="7023d-132">The protocol that the health probe uses.</span></span>|
  |<span data-ttu-id="7023d-133">**Hôte**</span><span class="sxs-lookup"><span data-stu-id="7023d-133">**Host**</span></span>|<span data-ttu-id="7023d-134">Par exemple,</span><span class="sxs-lookup"><span data-stu-id="7023d-134">i.e</span></span> <span data-ttu-id="7023d-135">contoso.com</span><span class="sxs-lookup"><span data-stu-id="7023d-135">contoso.com</span></span>|<span data-ttu-id="7023d-136">Cette valeur est le nom d’hôte utilisé pour la sonde.</span><span class="sxs-lookup"><span data-stu-id="7023d-136">This value is the host name that is used for the probe.</span></span> <span data-ttu-id="7023d-137">S’applique uniquement lorsque plusieurs sites sont configurés sur Application Gateway, sinon utilisez '127.0.0.1'.</span><span class="sxs-lookup"><span data-stu-id="7023d-137">Applicable only when multi-site is configured on Application Gateway, otherwise use '127.0.0.1'.</span></span> <span data-ttu-id="7023d-138">Cette valeur est différente du nom d’hôte de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="7023d-138">This value is different from the VM host name.</span></span>|
  |<span data-ttu-id="7023d-139">**Chemin d’accès**</span><span class="sxs-lookup"><span data-stu-id="7023d-139">**Path**</span></span>|<span data-ttu-id="7023d-140">/ ou un autre chemin</span><span class="sxs-lookup"><span data-stu-id="7023d-140">/ or another path</span></span>|<span data-ttu-id="7023d-141">Reste de l’URL complète de la sonde personnalisée.</span><span class="sxs-lookup"><span data-stu-id="7023d-141">The remainder of the full url for the custom probe.</span></span> <span data-ttu-id="7023d-142">Un chemin valide commence par « / ».</span><span class="sxs-lookup"><span data-stu-id="7023d-142">A valid path starts with '/'.</span></span> <span data-ttu-id="7023d-143">Pour le chemin par défaut de http://contoso.com, utilisez simplement « / ».</span><span class="sxs-lookup"><span data-stu-id="7023d-143">For the default path of http://contoso.com just use '/'</span></span> |
  |<span data-ttu-id="7023d-144">**Intervalle (secondes)**</span><span class="sxs-lookup"><span data-stu-id="7023d-144">**Interval (secs)**</span></span>|<span data-ttu-id="7023d-145">30</span><span class="sxs-lookup"><span data-stu-id="7023d-145">30</span></span>|<span data-ttu-id="7023d-146">Fréquence d’exécution de la sonde pour le contrôle d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="7023d-146">How often the probe is run to check for health.</span></span> <span data-ttu-id="7023d-147">Il n’est pas recommandé de définir la valeur sur moins de 30 secondes.</span><span class="sxs-lookup"><span data-stu-id="7023d-147">It is not recommended to set the lower than 30 seconds.</span></span>|
  |<span data-ttu-id="7023d-148">**Délai d’expiration (secondes)**</span><span class="sxs-lookup"><span data-stu-id="7023d-148">**Timeout (secs)**</span></span>|<span data-ttu-id="7023d-149">30</span><span class="sxs-lookup"><span data-stu-id="7023d-149">30</span></span>|<span data-ttu-id="7023d-150">Intervalle de temps précédant l’expiration de la sonde.</span><span class="sxs-lookup"><span data-stu-id="7023d-150">The amount of time the probe waits before timing out.</span></span> <span data-ttu-id="7023d-151">L’intervalle de délai d’attente doit être suffisamment élevé pour qu’un appel HTTP puisse être envoyé afin de garantir que la page d’intégrité backend est disponible.</span><span class="sxs-lookup"><span data-stu-id="7023d-151">The timeout interval needs to be high enough that an http call can be made to ensure the backend health page is available.</span></span>|
  |<span data-ttu-id="7023d-152">**Seuil de défaillance sur le plan de l’intégrité**</span><span class="sxs-lookup"><span data-stu-id="7023d-152">**Unhealthy threshold**</span></span>|<span data-ttu-id="7023d-153">3</span><span class="sxs-lookup"><span data-stu-id="7023d-153">3</span></span>|<span data-ttu-id="7023d-154">Nombre d’échecs nécessaires pour marquer l’instance comme étant défaillante.</span><span class="sxs-lookup"><span data-stu-id="7023d-154">Number of failed attempts to be considered unhealthy.</span></span> <span data-ttu-id="7023d-155">Un seuil de 0 signifie qu’en cas d’échec de contrôle d’intégrité, le serveur principal est immédiatement identifié comme défaillant.</span><span class="sxs-lookup"><span data-stu-id="7023d-155">A threshold of 0 means that if a health check fails the back-end is determined unhealthy immediately.</span></span>|

  > [!IMPORTANT]
  > <span data-ttu-id="7023d-156">Le nom d’hôte n’est pas identique au nom du serveur.</span><span class="sxs-lookup"><span data-stu-id="7023d-156">The host name is not the same as server name.</span></span> <span data-ttu-id="7023d-157">Cette valeur est le nom de l’hôte virtuel en cours d’exécution sur le serveur d’application.</span><span class="sxs-lookup"><span data-stu-id="7023d-157">This value is the name of the virtual host running on the application server.</span></span> <span data-ttu-id="7023d-158">La sonde est envoyée à http://(nom d’hôte):(port des paramètres http)/urlPath</span><span class="sxs-lookup"><span data-stu-id="7023d-158">The probe is sent to http://(host name):(port from httpsetting)/urlPath</span></span>

## <a name="add-probe-to-the-gateway"></a><span data-ttu-id="7023d-159">Ajouter une sonde à la passerelle</span><span class="sxs-lookup"><span data-stu-id="7023d-159">Add probe to the gateway</span></span>

<span data-ttu-id="7023d-160">Maintenant que la sonde a été créée, il est temps de l’ajouter à la passerelle.</span><span class="sxs-lookup"><span data-stu-id="7023d-160">Now that the probe has been created, it is time to add it to the gateway.</span></span> <span data-ttu-id="7023d-161">Les paramètres de la sonde sont définis sur les paramètres http principaux de la passerelle d’application.</span><span class="sxs-lookup"><span data-stu-id="7023d-161">Probe settings are set on the backend http settings of the application gateway.</span></span>

1. <span data-ttu-id="7023d-162">Cliquez sur **Paramètres HTTP** dans la passerelle d’application pour afficher le panneau de configuration, puis cliquez sur les paramètres http backend actuels répertoriés dans la fenêtre.</span><span class="sxs-lookup"><span data-stu-id="7023d-162">Click **HTTP settings** on the application gateway, to bring up the configuration blade click the current backend http settings listed in the window.</span></span>

  ![fenêtre de paramètres https][2]

1. <span data-ttu-id="7023d-164">Dans le panneau des paramètres **appGatewayBackEndHttpSettings**, cochez la case **Utiliser la sonde personnalisée**, puis choisissez la sonde créée à la section [Créer la sonde](#createprobe) dans la liste déroulante **Sonde personnalisée**.</span><span class="sxs-lookup"><span data-stu-id="7023d-164">On the **appGatewayBackEndHttpSettings** settings blade, check the **Use custom probe** checkbox and choose the probe created in the [Create the probe](#createprobe) section on the **Custom probe** drop-down..</span></span>
<span data-ttu-id="7023d-165">Quand vous avez terminé, cliquez sur **Enregistrer** pour appliquer les paramètres.</span><span class="sxs-lookup"><span data-stu-id="7023d-165">When complete, click **Save** and the settings are applied.</span></span>

<span data-ttu-id="7023d-166">La sonde par défaut vérifie l’accès par défaut à l’application web.</span><span class="sxs-lookup"><span data-stu-id="7023d-166">The default probe checks the default access to the web application.</span></span> <span data-ttu-id="7023d-167">Maintenant qu’une sonde personnalisée a été créée, la passerelle d’application utilise le chemin personnalisé défini pour contrôler l’intégrité des serveurs backend.</span><span class="sxs-lookup"><span data-stu-id="7023d-167">Now that a custom probe has been created, the application gateway uses the custom path defined to monitor health for the backend servers.</span></span> <span data-ttu-id="7023d-168">En fonction des critères qui ont été définis, la passerelle d’application vérifie le chemin spécifié dans la sonde.</span><span class="sxs-lookup"><span data-stu-id="7023d-168">Based on the criteria that was defined, the application gateway checks the path specified in the probe.</span></span> <span data-ttu-id="7023d-169">Si l’appel à host:Port/path ne retourne pas de réponse d’état HTTP 200-399, le serveur est mis hors service après avoir atteint le seuil de défaillance sur le plan de l’intégrité.</span><span class="sxs-lookup"><span data-stu-id="7023d-169">If the call to host:Port/path does not return an HTTP 200-399 status response, the server is taken out of rotation after the unhealthy threshold is reached.</span></span> <span data-ttu-id="7023d-170">La détection continue sur l’instance défaillante pour déterminer quand elle sera rétablie.</span><span class="sxs-lookup"><span data-stu-id="7023d-170">Probing continues on the unhealthy instance to determine when it becomes healthy again.</span></span> <span data-ttu-id="7023d-171">Une fois l’instance ajoutée au pool de serveurs intègre, le trafic recommence à circuler vers elle et la détection de l’instance continue comme d’habitude en fonction des intervalles définis par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="7023d-171">Once the instance is added back to healthy server pool, traffic begins flowing to it again and probing to the instance continues at user specified interval as normal.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7023d-172">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="7023d-172">Next steps</span></span>

<span data-ttu-id="7023d-173">Pour découvrir comment configurer le déchargement SSL avec la passerelle Azure Application Gateway, consultez la [configuration du déchargement SSL](application-gateway-ssl-portal.md)</span><span class="sxs-lookup"><span data-stu-id="7023d-173">To learn how to configure SSL Offloading with Azure Application Gateway, see [Configure SSL Offload](application-gateway-ssl-portal.md)</span></span>

[1]: ./media/application-gateway-create-probe-portal/figure1.png
[2]: ./media/application-gateway-create-probe-portal/figure2.png

