---
title: "API d’utilisation des ressources de fournisseur | Microsoft Docs"
description: "Informations de référence sur l’utilisation de ressources API, lesquelles récupèrent des informations relatives à l’utilisation d’Azure Stack."
services: azure-stack
documentationcenter: 
author: AlfredoPizzirani
manager: byronr
editor: 
ms.assetid: b6055923-b6a6-45f0-8979-225b713150ae
ms.service: azure-stack
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: alfredop
ms.openlocfilehash: f43ec070e0269fad89b83c3075101e610a90ad96
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="provider-resource-usage-api"></a><span data-ttu-id="a8980-103">API d’utilisation des ressources de fournisseur</span><span class="sxs-lookup"><span data-stu-id="a8980-103">Provider Resource Usage API</span></span>
<span data-ttu-id="a8980-104">Le terme « fournisseur » s’applique à l’administrateur de services et à tous les fournisseurs délégués.</span><span class="sxs-lookup"><span data-stu-id="a8980-104">The term provider applies to the service administrator and to any delegated providers.</span></span> <span data-ttu-id="a8980-105">Administrateurs de service et les fournisseurs de délégué peuvent utiliser l’API de l’utilisation du fournisseur pour afficher l’utilisation de leurs clients directs.</span><span class="sxs-lookup"><span data-stu-id="a8980-105">Service admins and delegated providers can use the Provider Usage API to view the usage of their direct tenants.</span></span> <span data-ttu-id="a8980-106">Par exemple, P0 peut appeler l’API du fournisseur pour obtenir des informations sur l’utilisation directe de P1 et de P2, et P1 peut effectuer un appel pour obtenir des informations relatives à l’utilisation de P3 et P4.</span><span class="sxs-lookup"><span data-stu-id="a8980-106">For example, P0 can call the Provider API to get usage information on P1's and P2's direct usage, and P1 can call for usage information on P3 and P4.</span></span>

![Modèle conceptuel de la hiérarchie des fournisseurs](media/azure-stack-provider-resource-api/image1.png)

## <a name="api-call-reference"></a><span data-ttu-id="a8980-108">Référence de l’appel d’API</span><span class="sxs-lookup"><span data-stu-id="a8980-108">API call reference</span></span>
### <a name="request"></a><span data-ttu-id="a8980-109">Demande</span><span class="sxs-lookup"><span data-stu-id="a8980-109">Request</span></span>
<span data-ttu-id="a8980-110">La requête obtient les détails de la consommation pour les abonnements demandés et pour la période demandée.</span><span class="sxs-lookup"><span data-stu-id="a8980-110">The request gets consumption details for the requested subscriptions and for the requested time frame.</span></span> <span data-ttu-id="a8980-111">Il n’existe aucun corps de demande.</span><span class="sxs-lookup"><span data-stu-id="a8980-111">There is no request body.</span></span>

<span data-ttu-id="a8980-112">Cette API d’utilisation est une API de fournisseur. Un rôle Propriétaire, Collaborateur ou Lecteur doit donc être affecté à l’appelant dans l’abonnement du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="a8980-112">This usage API is a Provider API, so the caller must be assigned an Owner, Contributor, or Reader role in the provider’s subscription.</span></span>

| <span data-ttu-id="a8980-113">**Méthode**</span><span class="sxs-lookup"><span data-stu-id="a8980-113">**Method**</span></span> | <span data-ttu-id="a8980-114">**URI de la requête**</span><span class="sxs-lookup"><span data-stu-id="a8980-114">**Request URI**</span></span> |
| --- | --- |
| <span data-ttu-id="a8980-115">GET</span><span class="sxs-lookup"><span data-stu-id="a8980-115">GET</span></span> |<span data-ttu-id="a8980-116">https://{armendpoint}/subscriptions/{subId}/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime={reportedStartTime}&reportedEndTime={reportedEndTime}&aggregationGranularity={granularity}&subscriberId={sub1.1}&api-version=2015-06-01-preview&continuationToken={token-value}</span><span class="sxs-lookup"><span data-stu-id="a8980-116">https://{armendpoint}/subscriptions/{subId}/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime={reportedStartTime}&reportedEndTime={reportedEndTime}&aggregationGranularity={granularity}&subscriberId={sub1.1}&api-version=2015-06-01-preview&continuationToken={token-value}</span></span> |

### <a name="arguments"></a><span data-ttu-id="a8980-117">Arguments</span><span class="sxs-lookup"><span data-stu-id="a8980-117">Arguments</span></span>
| <span data-ttu-id="a8980-118">**Argument**</span><span class="sxs-lookup"><span data-stu-id="a8980-118">**Argument**</span></span> | <span data-ttu-id="a8980-119">**Description**</span><span class="sxs-lookup"><span data-stu-id="a8980-119">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="a8980-120">*armendpoint*</span><span class="sxs-lookup"><span data-stu-id="a8980-120">*armendpoint*</span></span> |<span data-ttu-id="a8980-121">Point de terminaison Azure Resource Manager de votre environnement Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="a8980-121">Azure Resource Manager endpoint of your Azure Stack environment.</span></span> <span data-ttu-id="a8980-122">La convention Azure Stack est que le nom du point de terminaison Azure Resource Manager soit au format `https://adminmanagement.{domain-name}`.</span><span class="sxs-lookup"><span data-stu-id="a8980-122">The Azure Stack convention is that the name of Azure Resource Manager endpoint is in the format `https://adminmanagement.{domain-name}`.</span></span> <span data-ttu-id="a8980-123">Par exemple, si le nom du domaine est local.azurestack.external, le point de terminaison Resource Manager est `https://adminmanagement.local.azurestack.external`.</span><span class="sxs-lookup"><span data-stu-id="a8980-123">For example, if the domain name is local.azurestack.external, then the Resource Manager endpoint is `https://adminmanagement.local.azurestack.external`.</span></span> |
| <span data-ttu-id="a8980-124">*subId*</span><span class="sxs-lookup"><span data-stu-id="a8980-124">*subId*</span></span> |<span data-ttu-id="a8980-125">ID d’abonnement de l’utilisateur qui effectue l’appel.</span><span class="sxs-lookup"><span data-stu-id="a8980-125">Subscription ID of the user who is making the call.</span></span> |
| <span data-ttu-id="a8980-126">*reportedStartTime*</span><span class="sxs-lookup"><span data-stu-id="a8980-126">*reportedStartTime*</span></span> |<span data-ttu-id="a8980-127">Heure de début de la requête.</span><span class="sxs-lookup"><span data-stu-id="a8980-127">Start time of the query.</span></span> <span data-ttu-id="a8980-128">La valeur de *DateTime* doit être au format UTC et indiquer le début de l’heure ; par exemple, 13:00.</span><span class="sxs-lookup"><span data-stu-id="a8980-128">The value for *DateTime* should be in UTC and at the beginning of the hour, for example, 13:00.</span></span> <span data-ttu-id="a8980-129">Pour l’agrégation quotidienne, définissez cette valeur sur minuit au format UTC.</span><span class="sxs-lookup"><span data-stu-id="a8980-129">For daily aggregation, set this value to UTC midnight.</span></span> <span data-ttu-id="a8980-130">Le format est l’ISO 8601 *échappé*, par exemple 2015-06-16T18%3a53%3a11%2b00%3a00Z, où les deux-points sont échappés avec %3a et le signe plus est échappé avec %2b afin qu’il soit adapté aux URI.</span><span class="sxs-lookup"><span data-stu-id="a8980-130">The format is *escaped* ISO 8601, for example, 2015-06-16T18%3a53%3a11%2b00%3a00Z, where colon is escaped to %3a and plus is escaped to %2b so that it is URI friendly.</span></span> |
| <span data-ttu-id="a8980-131">*reportedEndTime*</span><span class="sxs-lookup"><span data-stu-id="a8980-131">*reportedEndTime*</span></span> |<span data-ttu-id="a8980-132">Heure de fin de la requête.</span><span class="sxs-lookup"><span data-stu-id="a8980-132">End time of the query.</span></span> <span data-ttu-id="a8980-133">Les contraintes qui s’appliquent à *reportedStartTime* s’appliquent également à cet argument.</span><span class="sxs-lookup"><span data-stu-id="a8980-133">The constraints that apply to *reportedStartTime* also apply to this argument.</span></span> <span data-ttu-id="a8980-134">La valeur de *reportedEndTime* ne peut pas être la date actuelle ou ultérieure à la date actuelle.</span><span class="sxs-lookup"><span data-stu-id="a8980-134">The value for *reportedEndTime* cannot be in the future or the current date.</span></span> <span data-ttu-id="a8980-135">Dans ce cas, le résultat a la valeur « traitement non terminé ».</span><span class="sxs-lookup"><span data-stu-id="a8980-135">If it is, the result is set to "processing not complete."</span></span> |
| <span data-ttu-id="a8980-136">*aggregationGranularity*</span><span class="sxs-lookup"><span data-stu-id="a8980-136">*aggregationGranularity*</span></span> |<span data-ttu-id="a8980-137">Paramètre facultatif qui a deux valeurs potentielles discrètes : quotidienne et horaire.</span><span class="sxs-lookup"><span data-stu-id="a8980-137">Optional parameter that has two discrete potential values: daily and hourly.</span></span> <span data-ttu-id="a8980-138">Comme le suggèrent les valeurs, l’une retourne les données avec une granularité journalière, et l’autre est une résolution horaire.</span><span class="sxs-lookup"><span data-stu-id="a8980-138">As the values suggest, one returns the data in daily granularity, and the other is an hourly resolution.</span></span> <span data-ttu-id="a8980-139">L’option quotidienne est la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="a8980-139">The daily option is the default.</span></span> |
| <span data-ttu-id="a8980-140">*subscriberId*</span><span class="sxs-lookup"><span data-stu-id="a8980-140">*subscriberId*</span></span> |<span data-ttu-id="a8980-141">l'ID d'abonnement.</span><span class="sxs-lookup"><span data-stu-id="a8980-141">Subscription ID.</span></span> <span data-ttu-id="a8980-142">Pour obtenir des données filtrées, l’ID d’abonnement d’un locataire direct du fournisseur est exigé.</span><span class="sxs-lookup"><span data-stu-id="a8980-142">To get filtered data, the subscription ID of a direct tenant of the provider is required.</span></span> <span data-ttu-id="a8980-143">Si aucun paramètre d’ID d’abonnement n’est spécifié, l’appel retourne les données d’utilisation pour tous les locataires directs du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="a8980-143">If no subscription ID parameter is specified, the call returns usage data for all the provider’s direct tenants.</span></span> |
| <span data-ttu-id="a8980-144">*api-version*</span><span class="sxs-lookup"><span data-stu-id="a8980-144">*api-version*</span></span> |<span data-ttu-id="a8980-145">Version du protocole utilisé pour effectuer cette requête.</span><span class="sxs-lookup"><span data-stu-id="a8980-145">Version of the protocol that is used to make this request.</span></span> <span data-ttu-id="a8980-146">Cette valeur est définie sur 2015-06-01-preview.</span><span class="sxs-lookup"><span data-stu-id="a8980-146">This value is set to 2015-06-01-preview.</span></span> |
| <span data-ttu-id="a8980-147">*continuationToken*</span><span class="sxs-lookup"><span data-stu-id="a8980-147">*continuationToken*</span></span> |<span data-ttu-id="a8980-148">Jeton récupéré à partir du dernier appel au fournisseur d’API d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="a8980-148">Token retrieved from the last call to the Usage API provider.</span></span> <span data-ttu-id="a8980-149">Ce jeton est nécessaire quand une réponse comprend plus de 1 000 lignes. Il joue alors le rôle de signet pour la progression.</span><span class="sxs-lookup"><span data-stu-id="a8980-149">This token is needed when a response is greater than 1,000 lines and it acts as a bookmark for the progress.</span></span> <span data-ttu-id="a8980-150">En son absence, les données sont récupérées à partir du début de la journée ou de l’heure, en fonction de la granularité transmise.</span><span class="sxs-lookup"><span data-stu-id="a8980-150">If not present, the data is retrieved from the beginning of the day or hour, based on the granularity passed in.</span></span> |

### <a name="response"></a><span data-ttu-id="a8980-151">Réponse</span><span class="sxs-lookup"><span data-stu-id="a8980-151">Response</span></span>
<span data-ttu-id="a8980-152">GET /subscriptions/sub1/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime=reportedStartTime=2014-05-01T00%3a00%3a00%2b00%3a00&reportedEndTime=2015-06-01T00%3a00%3a00%2b00%3a00&aggregationGranularity=Daily&subscriberId=sub1.1&api-version=1.0</span><span class="sxs-lookup"><span data-stu-id="a8980-152">GET /subscriptions/sub1/providers/Microsoft.Commerce/subscriberUsageAggregates?reportedStartTime=reportedStartTime=2014-05-01T00%3a00%3a00%2b00%3a00&reportedEndTime=2015-06-01T00%3a00%3a00%2b00%3a00&aggregationGranularity=Daily&subscriberId=sub1.1&api-version=1.0</span></span>

<span data-ttu-id="a8980-153">{</span><span class="sxs-lookup"><span data-stu-id="a8980-153">{</span></span>

<span data-ttu-id="a8980-154">"value": \[</span><span class="sxs-lookup"><span data-stu-id="a8980-154">"value": \[</span></span>

<span data-ttu-id="a8980-155">{</span><span class="sxs-lookup"><span data-stu-id="a8980-155">{</span></span>

<span data-ttu-id="a8980-156">"id": "/subscriptions/sub1.1/providers/Microsoft.Commerce/UsageAggregate/sub1.1-</span><span class="sxs-lookup"><span data-stu-id="a8980-156">"id": "/subscriptions/sub1.1/providers/Microsoft.Commerce/UsageAggregate/sub1.1-</span></span>

<span data-ttu-id="a8980-157">meterID1",</span><span class="sxs-lookup"><span data-stu-id="a8980-157">meterID1",</span></span>

<span data-ttu-id="a8980-158">"name": "sub1.1-meterID1",</span><span class="sxs-lookup"><span data-stu-id="a8980-158">"name": "sub1.1-meterID1",</span></span>

<span data-ttu-id="a8980-159">"type": "Microsoft.Commerce/UsageAggregate",</span><span class="sxs-lookup"><span data-stu-id="a8980-159">"type": "Microsoft.Commerce/UsageAggregate",</span></span>

<span data-ttu-id="a8980-160">"properties": {</span><span class="sxs-lookup"><span data-stu-id="a8980-160">"properties": {</span></span>

<span data-ttu-id="a8980-161">"subscriptionId":"sub1.1",</span><span class="sxs-lookup"><span data-stu-id="a8980-161">"subscriptionId":"sub1.1",</span></span>

<span data-ttu-id="a8980-162">"usageStartTime": "2015-03-03T00:00:00+00:00",</span><span class="sxs-lookup"><span data-stu-id="a8980-162">"usageStartTime": "2015-03-03T00:00:00+00:00",</span></span>

<span data-ttu-id="a8980-163">"usageEndTime": "2015-03-04T00:00:00+00:00",</span><span class="sxs-lookup"><span data-stu-id="a8980-163">"usageEndTime": "2015-03-04T00:00:00+00:00",</span></span>

<span data-ttu-id="a8980-164">"instanceData":"{\\"Microsoft.Resources\\":{\\"resourceUri\\":\\"resourceUri1\\",\\"location\\</span><span class="sxs-lookup"><span data-stu-id="a8980-164">"instanceData":"{\\"Microsoft.Resources\\":{\\"resourceUri\\":\\"resourceUri1\\",\\"location\\</span></span>

<span data-ttu-id="a8980-165">":\\"Alaska\\",\\"tags\\":null,\\"additionalInfo\\":null}}",</span><span class="sxs-lookup"><span data-stu-id="a8980-165">":\\"Alaska\\",\\"tags\\":null,\\"additionalInfo\\":null}}",</span></span>

<span data-ttu-id="a8980-166">"quantity":2.4000000000,</span><span class="sxs-lookup"><span data-stu-id="a8980-166">"quantity":2.4000000000,</span></span>

<span data-ttu-id="a8980-167">"meterId":"meterID1"</span><span class="sxs-lookup"><span data-stu-id="a8980-167">"meterId":"meterID1"</span></span>

<span data-ttu-id="a8980-168">}</span><span class="sxs-lookup"><span data-stu-id="a8980-168">}</span></span>

<span data-ttu-id="a8980-169">},</span><span class="sxs-lookup"><span data-stu-id="a8980-169">},</span></span>

<span data-ttu-id="a8980-170">…</span><span class="sxs-lookup"><span data-stu-id="a8980-170">…</span></span>

### <a name="response-details"></a><span data-ttu-id="a8980-171">Détails de la réponse</span><span class="sxs-lookup"><span data-stu-id="a8980-171">Response details</span></span>
| <span data-ttu-id="a8980-172">**Argument**</span><span class="sxs-lookup"><span data-stu-id="a8980-172">**Argument**</span></span> | <span data-ttu-id="a8980-173">**Description**</span><span class="sxs-lookup"><span data-stu-id="a8980-173">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="a8980-174">*id*</span><span class="sxs-lookup"><span data-stu-id="a8980-174">*id*</span></span> |<span data-ttu-id="a8980-175">ID unique de l’agrégat d’utilisation</span><span class="sxs-lookup"><span data-stu-id="a8980-175">Unique ID of the usage aggregate</span></span> |
| <span data-ttu-id="a8980-176">*name*</span><span class="sxs-lookup"><span data-stu-id="a8980-176">*name*</span></span> |<span data-ttu-id="a8980-177">Nom de l’agrégat d’utilisation</span><span class="sxs-lookup"><span data-stu-id="a8980-177">Name of the usage aggregate</span></span> |
| <span data-ttu-id="a8980-178">*type*</span><span class="sxs-lookup"><span data-stu-id="a8980-178">*type*</span></span> |<span data-ttu-id="a8980-179">Définition de la ressource</span><span class="sxs-lookup"><span data-stu-id="a8980-179">Resource definition</span></span> |
| <span data-ttu-id="a8980-180">*subscriptionId*</span><span class="sxs-lookup"><span data-stu-id="a8980-180">*subscriptionId*</span></span> |<span data-ttu-id="a8980-181">Identificateur d’abonnement de l’utilisateur Azure Stack</span><span class="sxs-lookup"><span data-stu-id="a8980-181">Subscription identifier of the Azure Stack user</span></span> |
| <span data-ttu-id="a8980-182">*usageStartTime*</span><span class="sxs-lookup"><span data-stu-id="a8980-182">*usageStartTime*</span></span> |<span data-ttu-id="a8980-183">Heure de début, au format UTC, du compartiment d’utilisation auquel appartient cet agrégat d’utilisation</span><span class="sxs-lookup"><span data-stu-id="a8980-183">UTC start time of the usage bucket to which this usage aggregate belongs</span></span> |
| <span data-ttu-id="a8980-184">*usageEndTime*</span><span class="sxs-lookup"><span data-stu-id="a8980-184">*usageEndTime*</span></span> |<span data-ttu-id="a8980-185">Heure de fin, au format UTC, du compartiment d’utilisation auquel appartient cet agrégat d’utilisation</span><span class="sxs-lookup"><span data-stu-id="a8980-185">UTC end time of the usage bucket to which this usage aggregate belongs</span></span> |
| <span data-ttu-id="a8980-186">*instanceData*</span><span class="sxs-lookup"><span data-stu-id="a8980-186">*instanceData*</span></span> |<span data-ttu-id="a8980-187">Paires clé-valeur des détails de l’instance (dans un nouveau format) :</span><span class="sxs-lookup"><span data-stu-id="a8980-187">Key-value pairs of instance details (in a new format):</span></span><br> <span data-ttu-id="a8980-188">*resourceUri* : ID de ressource complet, qui inclut les groupes de ressources et le nom de l’instance</span><span class="sxs-lookup"><span data-stu-id="a8980-188">*resourceUri*: Fully qualified resource ID, which includes the resource groups and the instance name</span></span> <br> <span data-ttu-id="a8980-189">*location* : région dans laquelle ce service a été exécuté</span><span class="sxs-lookup"><span data-stu-id="a8980-189">*location*: Region in which this service was run</span></span> <br> <span data-ttu-id="a8980-190">*tags* : balises de ressources spécifiées par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="a8980-190">*tags*: Resource tags that are specified by the user</span></span> <br> <span data-ttu-id="a8980-191">*additionalInfo* : informations supplémentaires sur la ressource consommée, par exemple, la version du système d’exploitation ou le type d’image</span><span class="sxs-lookup"><span data-stu-id="a8980-191">*additionalInfo*: More details about the resource that was consumed, for example, OS version or image type</span></span> |
| <span data-ttu-id="a8980-192">*quantity*</span><span class="sxs-lookup"><span data-stu-id="a8980-192">*quantity*</span></span> |<span data-ttu-id="a8980-193">Quantité de ressources consommées au cours de cette période</span><span class="sxs-lookup"><span data-stu-id="a8980-193">Amount of resource consumption that occurred in this time frame</span></span> |
| <span data-ttu-id="a8980-194">*meterId*</span><span class="sxs-lookup"><span data-stu-id="a8980-194">*meterId*</span></span> |<span data-ttu-id="a8980-195">ID unique de la ressource consommée (également appelé *ResourceID*)</span><span class="sxs-lookup"><span data-stu-id="a8980-195">Unique ID for the resource that was consumed (also called *ResourceID*)</span></span> |

## <a name="next-steps"></a><span data-ttu-id="a8980-196">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a8980-196">Next steps</span></span>
[<span data-ttu-id="a8980-197">Informations de référence sur l’API d’utilisation des ressources de locataire</span><span class="sxs-lookup"><span data-stu-id="a8980-197">Tenant resource usage API reference</span></span>](azure-stack-tenant-resource-usage-api.md)

[<span data-ttu-id="a8980-198">Questions fréquentes (FAQ) relatives à l’utilisation</span><span class="sxs-lookup"><span data-stu-id="a8980-198">Usage-related FAQ</span></span>](azure-stack-usage-related-faq.md)

