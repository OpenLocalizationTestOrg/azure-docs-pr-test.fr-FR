---
title: "Gérer des machines virtuelles Windows Azure Pack à partir d’Azure Stack | Microsoft Docs"
description: "Découvrez comment gérer des machines virtuelles Windows Azure Pack à partir du portail utilisateur dans Azure Stack."
services: azure-stack
documentationcenter: 
author: walterov
manager: byronr
editor: 
ms.assetid: 213c2792-d404-4b44-8340-235adf3f8f0b
ms.service: azure-stack
ms.workload: na
pms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/10/2017
ms.author: walterov
ms.openlocfilehash: e00cf1c3f3d74b98e84b3d3f862e3a7b1b5b65f4
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="manage-windows-azure-pack-virtual-machines-from-azure-stack"></a><span data-ttu-id="1055a-103">Gérer des machines virtuelles Windows Azure Pack à partir d’Azure Stack</span><span class="sxs-lookup"><span data-stu-id="1055a-103">Manage Windows Azure Pack virtual machines from Azure Stack</span></span>
<span data-ttu-id="1055a-104">Dans le Kit de développement Azure Stack, vous pouvez activer l’accès aux machines virtuelles du locataire s’exécutant sur Windows Azure Pack à partir du portail utilisateur Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-104">In the Azure Stack Development Kit, you can enable access from the Azure Stack user portal to tenant virtual machines running on Windows Azure Pack.</span></span> <span data-ttu-id="1055a-105">Les locataires peuvent utiliser le portail Azure Stack pour gérer leurs réseaux virtuels et machines virtuelles IaaS existants.</span><span class="sxs-lookup"><span data-stu-id="1055a-105">Tenants can use the Azure Stack portal to manage their existing IaaS virtual machines and virtual networks.</span></span> <span data-ttu-id="1055a-106">Ces ressources sont disponibles sur Windows Azure Pack dans les composants SPF (Service Provider Foundation) et VMM (Virtual Machine Manager) sous-jacents.</span><span class="sxs-lookup"><span data-stu-id="1055a-106">These resources are made available on Windows Azure Pack through the underlying Service Provider Foundation (SPF) and Virtual Machine Manager (VMM) components.</span></span> <span data-ttu-id="1055a-107">Plus précisément, les locataires peuvent :</span><span class="sxs-lookup"><span data-stu-id="1055a-107">Specifically, tenants can:</span></span>

* <span data-ttu-id="1055a-108">Parcourir les ressources</span><span class="sxs-lookup"><span data-stu-id="1055a-108">Browse resources</span></span>
* <span data-ttu-id="1055a-109">Examiner les valeurs de configuration</span><span class="sxs-lookup"><span data-stu-id="1055a-109">Examine configuration values</span></span>
* <span data-ttu-id="1055a-110">Démarrer ou arrêter une machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="1055a-110">Stop or start a virtual machine</span></span>
* <span data-ttu-id="1055a-111">Se connecter à une machine virtuelle avec le protocole RDP (Remote Desktop Protocol)</span><span class="sxs-lookup"><span data-stu-id="1055a-111">Connect to a virtual machine through Remote Desktop Protocol (RDP)</span></span>
* <span data-ttu-id="1055a-112">Créer et gérer des points de contrôle</span><span class="sxs-lookup"><span data-stu-id="1055a-112">Create and manage checkpoints</span></span>
* <span data-ttu-id="1055a-113">Supprimer des réseaux virtuels et des machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="1055a-113">Delete virtual machines and virtual networks</span></span>

<span data-ttu-id="1055a-114">Cette fonctionnalité est fournie par le connecteur Windows Azure Pack pour Azure Stack (préversion).</span><span class="sxs-lookup"><span data-stu-id="1055a-114">This functionality is provided by the Windows Azure Pack Connector for Azure Stack (Preview).</span></span> <span data-ttu-id="1055a-115">Cet article explique comment configurer le connecteur pour un environnement Azure Stack à nœud unique.</span><span class="sxs-lookup"><span data-stu-id="1055a-115">This article shows how to configure the connector for a single-node Azure Stack environment.</span></span>

<span data-ttu-id="1055a-116">Pour cette préversion du connecteur, tenez compte des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="1055a-116">For this preview release of the connector, be aware of the following:</span></span>
* <span data-ttu-id="1055a-117">Utilisez le connecteur Windows Azure Pack uniquement dans des environnements de test (pour Azure Stack et Windows Azure Pack) et non dans des déploiements de production.</span><span class="sxs-lookup"><span data-stu-id="1055a-117">Use the Windows Azure Pack Connector only in test environments (for both Azure Stack and Windows Azure Pack), and not in production deployments.</span></span>
* <span data-ttu-id="1055a-118">Vous devez avoir Windows Azure Pack Update Rollup (UR) 9.1 ou ultérieur et System Center SPF et VMM UR 9 ou ultérieur.</span><span class="sxs-lookup"><span data-stu-id="1055a-118">You must have Windows Azure Pack Update Rollup (UR) 9.1 or later and System Center SPF and VMM UR 9 or later.</span></span>
* <span data-ttu-id="1055a-119">Les composants VMM et SPF peuvent être System Center 2012 R2 ou System Center 2016.</span><span class="sxs-lookup"><span data-stu-id="1055a-119">The VMM and SPF components can be either System Center 2012 R2 or System Center 2016.</span></span>
* <span data-ttu-id="1055a-120">Vous devez effectuer les étapes de configuration à la fois sur Azure Stack et sur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-120">You must perform configuration steps on both Azure Stack and on Windows Azure Pack.</span></span>
* <span data-ttu-id="1055a-121">Les instructions s’appliquent aux environnements non-CPS (Cloud Platform System).</span><span class="sxs-lookup"><span data-stu-id="1055a-121">The instructions apply to non-Cloud Platform System (CPS) environments.</span></span>
* <span data-ttu-id="1055a-122">Pour passer en revue les problèmes connus, consultez [Dépannage de Microsoft Azure Stack](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="1055a-122">To review the known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="architecture"></a><span data-ttu-id="1055a-123">Architecture</span><span class="sxs-lookup"><span data-stu-id="1055a-123">Architecture</span></span>
<span data-ttu-id="1055a-124">Le diagramme suivant montre les principaux composants du connecteur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-124">The following diagram shows the main components of the Windows Azure Pack Connector.</span></span>

![Composants du connecteur Windows Azure Pack](media/azure-stack-manage-wap/image1.png)

<span data-ttu-id="1055a-126">Notez les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="1055a-126">Notice the following details:</span></span>
* <span data-ttu-id="1055a-127">Le portail utilisateur Azure Stack accède aux informations de ressources à partir des deux clouds (Azure Stack et Windows Azure Pack).</span><span class="sxs-lookup"><span data-stu-id="1055a-127">The Azure Stack user portal accesses the resource information from both clouds (Azure Stack and Windows Azure Pack).</span></span>
* <span data-ttu-id="1055a-128">L’utilisateur doit disposer d’un compte valide dans les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="1055a-128">The user must have an account that is valid in both environments.</span></span>
* <span data-ttu-id="1055a-129">Le portail utilisateur Azure Stack doit avoir un accès réseau aux composants qui s’exécutent sur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-129">The Azure Stack user portal must have network access to the components running on Windows Azure Pack.</span></span>
* <span data-ttu-id="1055a-130">Dans la section **WAP** du diagramme, vous pouvez voir les nouveaux modules de connecteur Windows Azure Pack (connecteur et extension WAP) et l’API locataire Windows Azure Pack avec les composants SPF et VMM existants.</span><span class="sxs-lookup"><span data-stu-id="1055a-130">In the **WAP** section of the diagram, you can see the new Windows Azure Pack Connector modules (WAP Extension and Connector) and the existing Windows Azure Pack Tenant API with SPF and VMM components.</span></span>


## <a name="identity-management"></a><span data-ttu-id="1055a-131">Gestion des identités</span><span class="sxs-lookup"><span data-stu-id="1055a-131">Identity management</span></span>
<span data-ttu-id="1055a-132">L’API locataire Windows Azure Pack doit approuver le service d’émission de jeton de sécurité (STS) Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-132">The Windows Azure Pack Tenant API must trust the Azure Stack security token service (STS).</span></span>

<span data-ttu-id="1055a-133">Quand un utilisateur se sert du portail Azure Stack pour effectuer une action qui cible des ressources Windows Azure Pack, le portail utilise l’API locataire Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-133">When a user performs an action through the Azure Stack portal that targets Windows Azure Pack resources, the portal uses the Windows Azure Pack Tenant API.</span></span> <span data-ttu-id="1055a-134">C’est pourquoi le jeton d’authentification utilisateur fourni doit provenir d’un service STS approuvé.</span><span class="sxs-lookup"><span data-stu-id="1055a-134">Therefore, the provided user authentication token must come from a trusted STS.</span></span> <span data-ttu-id="1055a-135">Consultez le diagramme suivant :</span><span class="sxs-lookup"><span data-stu-id="1055a-135">See the following diagram:</span></span>

![Diagramme d’authentification du connecteur Windows Azure Pack](media/azure-stack-manage-wap/image2.png)

<span data-ttu-id="1055a-137">Dans l’environnement du Kit de développement, Windows Azure Pack et Azure Stack ont des fournisseurs d’identité indépendants.</span><span class="sxs-lookup"><span data-stu-id="1055a-137">In the development kit environment, Windows Azure Pack and Azure Stack have independent identity providers.</span></span> <span data-ttu-id="1055a-138">Les utilisateurs qui accèdent à ces deux environnements à partir du portail Azure Stack doivent avoir le même nom d’utilisateur principal (UPN) dans les deux fournisseurs d’identité.</span><span class="sxs-lookup"><span data-stu-id="1055a-138">Users who access both environments from the Azure Stack portal must have the same user principal name (UPN) name in both identity providers.</span></span> <span data-ttu-id="1055a-139">Par exemple, le compte *azurestackadmin@azurestack.local* doit également exister dans le service STS pour Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-139">For example, the account *azurestackadmin@azurestack.local* should also exist in the STS for Windows Azure Pack.</span></span> <span data-ttu-id="1055a-140">Là où les services AD FS ne sont pas configurés pour prendre en charge les relations d’approbation sortante, vous allez établir une approbation des composants Windows Azure Pack (API locataire) sur l’instance Azure Stack des services AD FS.</span><span class="sxs-lookup"><span data-stu-id="1055a-140">Where AD FS is not set up to support outbound trust relationships, you will establish trust from the Windows Azure Pack components (Tenant API) to the Azure Stack instance of AD FS.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="1055a-141">Composants requis</span><span class="sxs-lookup"><span data-stu-id="1055a-141">Prerequisites</span></span>

### <a name="download-the-windows-azure-pack-connector"></a><span data-ttu-id="1055a-142">Télécharger le connecteur Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="1055a-142">Download the Windows Azure Pack Connector</span></span>
<span data-ttu-id="1055a-143">Dans le [Centre de téléchargement Microsoft](https://aka.ms/wapconnectorazurestackdlc), téléchargez le fichier .exe et extrayez-le sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="1055a-143">On the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), download the .exe file and extract it to your local computer.</span></span> <span data-ttu-id="1055a-144">Ensuite, copiez le contenu sur un ordinateur pouvant accéder à votre environnement Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-144">Later, you copy the contents to a computer that can access your Windows Azure Pack environment.</span></span>

### <a name="deployment-option-requirement"></a><span data-ttu-id="1055a-145">Options de déploiement requises</span><span class="sxs-lookup"><span data-stu-id="1055a-145">Deployment option requirement</span></span>
<span data-ttu-id="1055a-146">Pour l’intégration à Windows Azure Pack, vous pouvez déployer Azure Stack à l’aide de l’option AD FS ou Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="1055a-146">To integrate with Windows Azure Pack, you can deploy Azure Stack by using the AD FS option or the Azure Active Directory option.</span></span>

### <a name="connectivity-requirements"></a><span data-ttu-id="1055a-147">Connectivité requise</span><span class="sxs-lookup"><span data-stu-id="1055a-147">Connectivity requirements</span></span>
1. <span data-ttu-id="1055a-148">À partir de l’ordinateur sur lequel vous accédez au portail utilisateur Azure Stack, vérifiez que vous pouvez accéder au portail de locataire Windows Azure Pack avec le navigateur web.</span><span class="sxs-lookup"><span data-stu-id="1055a-148">From the computer on which you access the Azure Stack user portal, make sure that you can access the Windows Azure Pack tenant portal through the web browser.</span></span>
2. <span data-ttu-id="1055a-149">La machine virtuelle AzS-WASP01 sur Azure Stack doit pouvoir se connecter à l’ordinateur du portail de locataire Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-149">The AzS-WASP01 virtual machine on Azure Stack must be able to connect to the Windows Azure Pack tenant portal computer.</span></span> <span data-ttu-id="1055a-150">Utilisez Ping.exe pour vérifier la connectivité réseau.</span><span class="sxs-lookup"><span data-stu-id="1055a-150">Use Ping.exe to verify network connectivity.</span></span> 
3.  <span data-ttu-id="1055a-151">Vous devez avoir des certificats valides pour les nouveaux services de connecteur.</span><span class="sxs-lookup"><span data-stu-id="1055a-151">You must have valid certificates for the new Connector services.</span></span> <span data-ttu-id="1055a-152">Ces certificats SSL doivent être émis par une autorité de certification approuvée.</span><span class="sxs-lookup"><span data-stu-id="1055a-152">These SSL certificates must be issued by a trusted certification authority (CA).</span></span> <span data-ttu-id="1055a-153">Vous ne pouvez pas utiliser de certificats auto-signés.</span><span class="sxs-lookup"><span data-stu-id="1055a-153">You can't use self-signed certificates.</span></span> <span data-ttu-id="1055a-154">Les certificats SSL doivent être approuvés par Azure Stack (plus spécifiquement la machine virtuelle AzS-WASP01) et par tout autre ordinateur que le locataire est susceptible d’utiliser pour accéder au portail utilisateur Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-154">The SSL certificates must be trusted by Azure Stack (specifically the AzS-WASP01 VM) and any other computer that the tenant may use to access the Azure Stack user portal.</span></span>
 
    >[!NOTE]
    <span data-ttu-id="1055a-155">Dans la mesure où AzS-WASP01 exécute Windows Server avec l’option d’installation Server Core, vous pouvez utiliser un outil en ligne de commande comme Certutil.ext pour importer le certificat.</span><span class="sxs-lookup"><span data-stu-id="1055a-155">Because AzS-WASP01 runs Windows Server with the Server Core installation option, you can use a command-line tool such as Certutil.ext to import the certificate.</span></span> <span data-ttu-id="1055a-156">Vous pouvez par exemple copier le fichier .cer dans c:\temp sur AzS-WASP01, puis exécuter la commande **certutil -addstore "CA" "c:\temp\certname.cer"**.</span><span class="sxs-lookup"><span data-stu-id="1055a-156">For example, you could copy the .cer file to c:\temp on AzS-WASP01, and then run the command **certutil -addstore "CA" "c:\temp\certname.cer"**.</span></span>

4.  <span data-ttu-id="1055a-157">Pour établir la connectivité RDP aux machines virtuelles du locataire Windows Azure Pack à partir du portail Azure Stack, il faut que l’environnement Windows Azure Pack autorise le trafic Bureau à distance sur les machines virtuelles du locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-157">To establish RDP connectivity to Windows Azure Pack tenant virtual machines through the Azure Stack portal, the Windows Azure Pack environment must allow Remote Desktop traffic to the tenant VMs.</span></span>
5.  <span data-ttu-id="1055a-158">Pour la connectivité entre les machines virtuelles du locataire Azure Stack et les machines virtuelles du locataire Windows Azure Pack, il faut que leurs adresses IP externes soient routables entre les deux environnements.</span><span class="sxs-lookup"><span data-stu-id="1055a-158">For connectivity between Azure Stack tenant virtual machines and Windows Azure Pack tenant virtual machines, their external IP addresses must be routable across the two environments.</span></span> <span data-ttu-id="1055a-159">Cette connectivité peut également inclure l’association d’un serveur DNS pour résoudre les noms des machines virtuelles entre les environnements.</span><span class="sxs-lookup"><span data-stu-id="1055a-159">This connectivity could also include associating a DNS server to resolve virtual machine names between the environments.</span></span>

### <a name="iis-requirements"></a><span data-ttu-id="1055a-160">Exigences relatives à IIS</span><span class="sxs-lookup"><span data-stu-id="1055a-160">IIS requirements</span></span>
<span data-ttu-id="1055a-161">L’extension IIS de réécriture d’URL doit être installée sur l’ordinateur qui héberge le portail de locataire Windows Azure Pack (qui peut être un hôte physique, une machine virtuelle ou plusieurs machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="1055a-161">The computer that hosts the Windows Azure Pack tenant portal (which may be a physical host, a virtual machine, or multiple virtual machines) must have the URL Rewrite IIS extension installed.</span></span> <span data-ttu-id="1055a-162">Si elle n’est pas encore installée, vous pouvez la télécharger à partir de [cette page](https://www.iis.net/downloads/microsoft/url-rewrite).</span><span class="sxs-lookup"><span data-stu-id="1055a-162">If it is not already installed, you can download it from [here](https://www.iis.net/downloads/microsoft/url-rewrite).</span></span> <span data-ttu-id="1055a-163">Si plusieurs machines virtuelles hébergent le portail du locataire, installez l’extension sur chaque machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="1055a-163">If multiple virtual machines host the tenant portal, install the extension on each virtual machine.</span></span>

## <a name="configure-azure-stack"></a><span data-ttu-id="1055a-164">Configurer Azure Stack</span><span class="sxs-lookup"><span data-stu-id="1055a-164">Configure Azure Stack</span></span>
<span data-ttu-id="1055a-165">Avant de configurer le connecteur Windows Azure Pack, vous devez activer le mode multicloud dans le portail utilisateur Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-165">Before you configure the Windows Azure Pack Connector, you must enable multi-cloud mode in the Azure Stack user portal.</span></span> <span data-ttu-id="1055a-166">Ce mode permet aux utilisateurs de sélectionner le cloud à partir duquel accéder aux ressources.</span><span class="sxs-lookup"><span data-stu-id="1055a-166">This mode enables users to select from which cloud to access resources.</span></span>

<span data-ttu-id="1055a-167">Pour activer le mode multicloud, vous devez exécuter le script Add-AzurePackConnector.ps1 après le déploiement d’Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-167">To enable multi-cloud mode, you must run the Add-AzurePackConnector.ps1 script after Azure Stack deployment.</span></span> <span data-ttu-id="1055a-168">Le tableau suivant décrit les paramètres du script.</span><span class="sxs-lookup"><span data-stu-id="1055a-168">The following table describes the script parameters.</span></span>


|  <span data-ttu-id="1055a-169">Paramètre</span><span class="sxs-lookup"><span data-stu-id="1055a-169">Parameter</span></span> | <span data-ttu-id="1055a-170">Description</span><span class="sxs-lookup"><span data-stu-id="1055a-170">Description</span></span> | <span data-ttu-id="1055a-171">Exemple</span><span class="sxs-lookup"><span data-stu-id="1055a-171">Example</span></span> |   
| -------- | ------------- | ------- |  
| <span data-ttu-id="1055a-172">AzurePackClouds</span><span class="sxs-lookup"><span data-stu-id="1055a-172">AzurePackClouds</span></span> | <span data-ttu-id="1055a-173">URI des connecteurs Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-173">URIs of the Windows Azure Pack Connectors.</span></span> <span data-ttu-id="1055a-174">Ces URI doivent correspondre aux portails du locataire Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-174">These URIs should correspond to the Windows Azure Pack tenant portals.</span></span> | <span data-ttu-id="1055a-175">@{CloudName = "AzurePack1"; CloudEndpoint = "https://waptenantportal1:40005"},@{CloudName = "AzurePack2"; CloudEndpoint = "https://waptenantportal2:40005"}</span><span class="sxs-lookup"><span data-stu-id="1055a-175">@{CloudName = "AzurePack1"; CloudEndpoint = "https://waptenantportal1:40005"},@{CloudName = "AzurePack2"; CloudEndpoint = "https://waptenantportal2:40005"}</span></span><br><br>  <span data-ttu-id="1055a-176">(Par défaut, la valeur du port est 40005.)</span><span class="sxs-lookup"><span data-stu-id="1055a-176">(By default, the port value is 40005.)</span></span> |  
| <span data-ttu-id="1055a-177">AzureStackCloudName</span><span class="sxs-lookup"><span data-stu-id="1055a-177">AzureStackCloudName</span></span> | <span data-ttu-id="1055a-178">Étiquette représentant le cloud Azure Stack local.</span><span class="sxs-lookup"><span data-stu-id="1055a-178">Label to represent the local Azure Stack cloud.</span></span>| <span data-ttu-id="1055a-179">"AzureStack"</span><span class="sxs-lookup"><span data-stu-id="1055a-179">"AzureStack"</span></span> |
| <span data-ttu-id="1055a-180">DisableMultiCloud</span><span class="sxs-lookup"><span data-stu-id="1055a-180">DisableMultiCloud</span></span> | <span data-ttu-id="1055a-181">Commutateur permettant de désactiver le mode multicloud.</span><span class="sxs-lookup"><span data-stu-id="1055a-181">A switch to disable multi-cloud mode.</span></span>| <span data-ttu-id="1055a-182">N/A</span><span class="sxs-lookup"><span data-stu-id="1055a-182">N/A</span></span> |
| | |

<span data-ttu-id="1055a-183">Vous pouvez exécuter le script Add-AzurePackConnector.ps1 immédiatement après le déploiement, ou plus tard.</span><span class="sxs-lookup"><span data-stu-id="1055a-183">You can run the Add-AzurePackConnector.ps1 script immediately after deployment, or later.</span></span> <span data-ttu-id="1055a-184">Pour exécuter le script immédiatement après le déploiement, utilisez la même session Windows PowerShell que celle où le déploiement d’Azure Stack s’est terminé.</span><span class="sxs-lookup"><span data-stu-id="1055a-184">To run the script immediately after deployment, use the same Windows PowerShell session where Azure Stack deployment completed.</span></span> <span data-ttu-id="1055a-185">Autrement, vous pouvez ouvrir une nouvelle session Windows PowerShell en tant qu’administrateur (connecté en tant que compte azurestackadmin).</span><span class="sxs-lookup"><span data-stu-id="1055a-185">Otherwise, you can open a new Windows PowerShell session as an administrator (signed in as the azurestackadmin account).</span></span>

1. <span data-ttu-id="1055a-186">Exécutez le script Add-AzurePackConnector.ps1 en utilisant les commandes suivantes (avec des valeurs propres à votre environnement).</span><span class="sxs-lookup"><span data-stu-id="1055a-186">Run the Add-AzurePackConnector.ps1 script by using the following commands (with values specific to your environment).</span></span> <span data-ttu-id="1055a-187">Notez que le script Add-AzurePackConnector vous permet d’ajouter plusieurs points de terminaison du connecteur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-187">Notice that the Add-AzurePackConnector script enables you to add more than one Windows Azure Pack Connector endpoint.</span></span>
 
 ```powershell
    $cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local", `
    (ConvertTo-SecureString -String "<password>" -AsPlainText -Force))
    $session = New-PSSession -ComputerName 'azs-ercs01' `
     -Credential $cred `
     -ConfigurationName PrivilegedEndpoint `
     -Authentication Credssp

    # Enable Multicloud
    Invoke-Command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
    @{CloudName = "AzurePack_1"; CloudEndpoint = "https://waptenantportal1:40005"},`
    @{CloudName = "AzurePack_2"; CloudEndpoint = "https://waptenantportal2:40005" } `
    -AzureStackCloudName "AzureStack" }

 ```
> [!NOTE]
> <span data-ttu-id="1055a-188">Dans la build actuelle, il existe un problème : une fois l’exécution du script Add-AzurePackConnector terminée, celui-ci reste dans une boucle d’interrogation pendant un certain temps (quelques minutes) jusqu’à ce qu’il se termine.</span><span class="sxs-lookup"><span data-stu-id="1055a-188">In the current build there is an issue where after the Add-AzurePackConnector script ends, it remains in a polling loop for an extended period of time (several minutes) until it ends.</span></span> <span data-ttu-id="1055a-189">Après l’affichage du message **VERBOSE : Étape « Configurer le connecteur Azure Pack » État : « Réussite »**, vous pouvez arrêter le script ou patienter jusqu’à ce qu’il s’arrête de lui-même.</span><span class="sxs-lookup"><span data-stu-id="1055a-189">After you see the message **VERBOSE: Step 'Configure Azure Pack Connector' status: 'Success'**, you can stop the script or wait until it stops by itself.</span></span> <span data-ttu-id="1055a-190">Cela ne fait aucune différence, car la configuration a déjà réussi.</span><span class="sxs-lookup"><span data-stu-id="1055a-190">It won’t make a difference because the configuration has already succeeded.</span></span>

2. <span data-ttu-id="1055a-191">Prenez note des fichiers de sortie générés par ce script, un pour chaque environnement Windows Azure Pack que vous avez spécifié.</span><span class="sxs-lookup"><span data-stu-id="1055a-191">Make note of the output files that are produced by this script, one for each Windows Azure Pack environment that you specified.</span></span> <span data-ttu-id="1055a-192">Les fichiers se trouvent à l’emplacement suivant : \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span><span class="sxs-lookup"><span data-stu-id="1055a-192">The files are located at:  \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput.</span></span> <span data-ttu-id="1055a-193">Ils contiennent les informations nécessaires pour configurer les environnements Windows Azure Pack cibles.</span><span class="sxs-lookup"><span data-stu-id="1055a-193">These files contain the information that is required to configure the target Windows Azure Pack environments.</span></span> <span data-ttu-id="1055a-194">Vous passerez ce fichier en tant que paramètre à un script plus loin dans ces instructions.</span><span class="sxs-lookup"><span data-stu-id="1055a-194">You pass this file as a parameter to a script later in these instructions.</span></span> <span data-ttu-id="1055a-195">Ce fichier contient les informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="1055a-195">This file contains the following information:</span></span>

    * <span data-ttu-id="1055a-196">**AzurePackConnectorEndpoint** : contient le point de terminaison au service du connecteur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-196">**AzurePackConnectorEndpoint**: Contains the endpoint to the Windows Azure Pack Connector service.</span></span>
    * <span data-ttu-id="1055a-197">**AuthenticationIdentityProviderPartner** : contient la paire de valeurs suivante :</span><span class="sxs-lookup"><span data-stu-id="1055a-197">**AuthenticationIdentityProviderPartner**: Contains the following value pair:</span></span>
        * <span data-ttu-id="1055a-198">Certificat de signature de jeton d’authentification que l’API locataire Windows Azure Pack doit approuver pour accepter les appels à partir de l’extension du portail Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-198">Authentication Token signing certificate that the Windows Azure Pack Tenant API needs to trust to accept calls from the Azure Stack portal extension.</span></span>

        * <span data-ttu-id="1055a-199">Paramètre « Realm » associé au certificat de signature.</span><span class="sxs-lookup"><span data-stu-id="1055a-199">The "Realm" associated with the signing certificate.</span></span> <span data-ttu-id="1055a-200">Par exemple : https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span><span class="sxs-lookup"><span data-stu-id="1055a-200">For example: https://adfs.local.azurestack.global.external/adfs/c1d72562-534e-4aa5-92aa-d65df289a107/.</span></span>

3.  <span data-ttu-id="1055a-201">Accédez au dossier qui contient les fichiers de sortie (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput), puis copiez les fichiers sur votre ordinateur local.</span><span class="sxs-lookup"><span data-stu-id="1055a-201">Browse to the folder that contains the output files (\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput), and copy the files to your local computer.</span></span> <span data-ttu-id="1055a-202">Les fichiers doivent ressembler à ceci : AzurePack-06-27-15-50.txt.</span><span class="sxs-lookup"><span data-stu-id="1055a-202">The files will look similar to this: AzurePack-06-27-15-50.txt.</span></span>

4.  <span data-ttu-id="1055a-203">Testez la configuration.</span><span class="sxs-lookup"><span data-stu-id="1055a-203">Test the configuration.</span></span>

    <span data-ttu-id="1055a-204">a.</span><span class="sxs-lookup"><span data-stu-id="1055a-204">a.</span></span> <span data-ttu-id="1055a-205">Ouvrez votre navigateur et connectez-vous au portail utilisateur Azure Stack (https://portal.local.azurestack.external/).</span><span class="sxs-lookup"><span data-stu-id="1055a-205">Open your browser and sign in to the Azure Stack user portal (https://portal.local.azurestack.external/).</span></span>
    
    <span data-ttu-id="1055a-206">b.</span><span class="sxs-lookup"><span data-stu-id="1055a-206">b.</span></span> <span data-ttu-id="1055a-207">Une fois que vous vous êtes connecté en tant que locataire et que le portail s’est chargé, des erreurs s’affichent pour signaler qu’il est impossible de récupérer des abonnements ou des extensions à partir du cloud Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-207">After you sign in as a tenant and the portal loads, you'll see errors about not being able to fetch subscriptions or extensions from the Azure Pack cloud.</span></span> <span data-ttu-id="1055a-208">Cliquez sur **OK** pour fermer ces messages.</span><span class="sxs-lookup"><span data-stu-id="1055a-208">Click **OK** to close these messages.</span></span> <span data-ttu-id="1055a-209">(Ces messages d’erreur disparaîtront une fois que vous aurez configuré Windows Azure Pack.)</span><span class="sxs-lookup"><span data-stu-id="1055a-209">(These error messages will go away after you configure Windows Azure Pack.)</span></span>

    <span data-ttu-id="1055a-210">c.</span><span class="sxs-lookup"><span data-stu-id="1055a-210">c.</span></span> <span data-ttu-id="1055a-211">Notez la liste déroulante **Cloud** en haut à gauche du portail.</span><span class="sxs-lookup"><span data-stu-id="1055a-211">Notice the **Cloud** drop-down list in the upper-left corner of the portal.</span></span>

    ![Sélecteur de cloud dans l’interface utilisateur d’Azure Stack](media/azure-stack-manage-wap/image3.png)

## <a name="configure-windows-azure-pack"></a><span data-ttu-id="1055a-213">Configurer Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="1055a-213">Configure Windows Azure Pack</span></span>
<span data-ttu-id="1055a-214">Pour cette préversion du connecteur uniquement, vous devez configurer Windows Azure Pack manuellement.</span><span class="sxs-lookup"><span data-stu-id="1055a-214">For this Connector preview release only, Windows Azure Pack requires manual configuration.</span></span>

>[!IMPORTANT]
<span data-ttu-id="1055a-215">Pour cette préversion, utilisez le connecteur Windows Azure Pack uniquement dans des environnements de test, et non dans des déploiements de production.</span><span class="sxs-lookup"><span data-stu-id="1055a-215">For this preview release, use the Windows Azure Pack Connector only in test environments, and not in production deployments.</span></span>

1.  <span data-ttu-id="1055a-216">Installez les fichiers MSI du connecteur sur la machine virtuelle du portail du locataire Windows Azure Pack et installez les certificats.</span><span class="sxs-lookup"><span data-stu-id="1055a-216">Install Connector MSI files on the Windows Azure Pack tenant portal virtual machine, and install certificates.</span></span> <span data-ttu-id="1055a-217">(Si vous avez plusieurs machines virtuelles dans le portail du locataire, vous devez effectuer cette étape sur chaque machine virtuelle.)</span><span class="sxs-lookup"><span data-stu-id="1055a-217">(If you have multiple tenant portal virtual machines, you must complete this step on each virtual machine.)</span></span>

    <span data-ttu-id="1055a-218">a.</span><span class="sxs-lookup"><span data-stu-id="1055a-218">a.</span></span> <span data-ttu-id="1055a-219">Dans l’Explorateur de fichiers, copiez le dossier **WAPConnector** (que vous avez téléchargé précédemment) dans un dossier nommé **c:\temp** sur la machine virtuelle du portail du locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-219">In File Explorer, copy the **WAPConnector** folder (what you downloaded earlier) to a folder named **c:\temp** in the tenant portal virtual machine.</span></span>

    <span data-ttu-id="1055a-220">b.</span><span class="sxs-lookup"><span data-stu-id="1055a-220">b.</span></span> <span data-ttu-id="1055a-221">Ouvrez une connexion Console ou RDP à la machine virtuelle du portail du locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-221">Open a Console or RDP connection to the tenant portal virtual machine.</span></span>

    <span data-ttu-id="1055a-222">c.</span><span class="sxs-lookup"><span data-stu-id="1055a-222">c.</span></span> <span data-ttu-id="1055a-223">Basculez vers le répertoire **c:\temp\wapconnector\setup\scripts** et exécutez le script **Install-Connector.ps1** pour installer trois fichiers MSI.</span><span class="sxs-lookup"><span data-stu-id="1055a-223">Change directories to **c:\temp\wapconnector\setup\scripts**, and run the **Install-Connector.ps1** script to install three MSI files.</span></span> <span data-ttu-id="1055a-224">Aucun paramètre n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="1055a-224">No parameters are required.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\scripts\

    .\Install-Connector.ps1
    ```
     <span data-ttu-id="1055a-225">d.</span><span class="sxs-lookup"><span data-stu-id="1055a-225">d.</span></span> <span data-ttu-id="1055a-226">Basculez vers le répertoire **c:\inetpub** et vérifiez que les trois nouveaux sites sont installés :</span><span class="sxs-lookup"><span data-stu-id="1055a-226">Change directories to **c:\inetpub** and verify that the three new sites are installed:</span></span>

       * <span data-ttu-id="1055a-227">MgmtSvc-Connector</span><span class="sxs-lookup"><span data-stu-id="1055a-227">MgmtSvc-Connector</span></span>

       * <span data-ttu-id="1055a-228">MgmtSvc-ConnectorExtension</span><span class="sxs-lookup"><span data-stu-id="1055a-228">MgmtSvc-ConnectorExtension</span></span>

       * <span data-ttu-id="1055a-229">MgmtSvc-ConnectorController</span><span class="sxs-lookup"><span data-stu-id="1055a-229">MgmtSvc-ConnectorController</span></span>

    <span data-ttu-id="1055a-230">e.</span><span class="sxs-lookup"><span data-stu-id="1055a-230">e.</span></span> <span data-ttu-id="1055a-231">À partir du même dossier **c:\temp\wapconnector\setup\scripts**, exécutez le script **Configure-Certificates.ps1** pour installer les certificats.</span><span class="sxs-lookup"><span data-stu-id="1055a-231">From the same **c:\temp\wapconnector\setup\scripts** folder, run the **Configure-Certificates.ps1** script to install certificates.</span></span> <span data-ttu-id="1055a-232">Par défaut, les certificats utilisés sont les mêmes que ceux qui sont disponibles pour le site Portail du locataire dans Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-232">By default, it will use the same certificate that is available for the Tenant Portal site in Windows Azure Pack.</span></span> <span data-ttu-id="1055a-233">Vérifiez qu’il s’agit d’un certificat valide (approuvé par la machine virtuelle Azure Stack AzS-WASP01 et par tout ordinateur client qui accède au portail Azure Stack).</span><span class="sxs-lookup"><span data-stu-id="1055a-233">Make sure this is a valid certificate (trusted by the Azure Stack AzS-WASP01 virtual machine and any client computer that accesses the Azure Stack portal).</span></span> <span data-ttu-id="1055a-234">Si ce n’est pas le cas, la communication ne fonctionnera pas.</span><span class="sxs-lookup"><span data-stu-id="1055a-234">Otherwise, communication won’t work.</span></span> <span data-ttu-id="1055a-235">(En guise d’alternative, vous pouvez transmettre explicitement une empreinte numérique du certificat en tant que paramètre à l’aide du paramètre -Thumbprint.)</span><span class="sxs-lookup"><span data-stu-id="1055a-235">(Alternatively, you can explicitly pass a certificate thumbprint as a parameter by using the -Thumbprint parameter.)</span></span>

     ```powershell
        cd C:\temp\wapconnector\setup\scripts\

        .\Configure-Certificates.ps1
    ```

    <span data-ttu-id="1055a-236">f.</span><span class="sxs-lookup"><span data-stu-id="1055a-236">f.</span></span> <span data-ttu-id="1055a-237">Pour terminer la configuration de ces trois services, exécutez le script **Configure-WapConnector.ps1** pour mettre à jour les paramètres du fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="1055a-237">To finish the configuration of these three services, run the **Configure-WapConnector.ps1** script to update the Web.config file parameters.</span></span>

    |  <span data-ttu-id="1055a-238">Paramètre</span><span class="sxs-lookup"><span data-stu-id="1055a-238">Parameter</span></span> | <span data-ttu-id="1055a-239">Description</span><span class="sxs-lookup"><span data-stu-id="1055a-239">Description</span></span> | <span data-ttu-id="1055a-240">Exemple</span><span class="sxs-lookup"><span data-stu-id="1055a-240">Example</span></span> |   
    | -------- | ------------- | ------- |  
    | <span data-ttu-id="1055a-241">TenantPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="1055a-241">TenantPortalFQDN</span></span> | <span data-ttu-id="1055a-242">Nom de domaine complet du portail du locataire Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="1055a-242">The Windows Azure Pack tenant portal FQDN.</span></span> | <span data-ttu-id="1055a-243">tenant.contoso.com</span><span class="sxs-lookup"><span data-stu-id="1055a-243">tenant.contoso.com</span></span> | 
    | <span data-ttu-id="1055a-244">TenantAPIFQDN</span><span class="sxs-lookup"><span data-stu-id="1055a-244">TenantAPIFQDN</span></span> | <span data-ttu-id="1055a-245">Nom de domaine complet de l’API locataire Windows Azure Pack</span><span class="sxs-lookup"><span data-stu-id="1055a-245">The Windows Azure Pack Tenant API FQDN.</span></span> | <span data-ttu-id="1055a-246">tenantapi.contoso.com</span><span class="sxs-lookup"><span data-stu-id="1055a-246">tenantapi.contoso.com</span></span>  |
    | <span data-ttu-id="1055a-247">AzureStackPortalFQDN</span><span class="sxs-lookup"><span data-stu-id="1055a-247">AzureStackPortalFQDN</span></span> | <span data-ttu-id="1055a-248">Nom de domaine complet du portail utilisateur Azure Stack</span><span class="sxs-lookup"><span data-stu-id="1055a-248">The Azure Stack user portal FQDN.</span></span> | <span data-ttu-id="1055a-249">portal.local.azurestack.external</span><span class="sxs-lookup"><span data-stu-id="1055a-249">portal.local.azurestack.external</span></span> |
    | | |
    
     ```powershell
    .\Configure-WapConnector.ps1 -TenantPortalFQDN "tenant.contoso.com" `
         -TenantAPIFQDN "tenantapi.contoso.com" `
         -AzureStackPortalFQDN "portal.local.azurestack.external"
    ```
    <span data-ttu-id="1055a-250">g.</span><span class="sxs-lookup"><span data-stu-id="1055a-250">g.</span></span> <span data-ttu-id="1055a-251">Si vous avez plusieurs machines virtuelles de portail du locataire, répétez l’étape 1 pour chacune de ces machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="1055a-251">If you have multiple tenant portal virtual machines, repeat step 1 for each of these virtual machines.</span></span>

2. <span data-ttu-id="1055a-252">Installez le nouveau fichier MSI d’API locataire sur chaque machine virtuelle d’API locataire Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-252">Install the new Tenant API MSI on each Windows Azure Pack Tenant API virtual machine.</span></span>

    <span data-ttu-id="1055a-253">a.</span><span class="sxs-lookup"><span data-stu-id="1055a-253">a.</span></span> <span data-ttu-id="1055a-254">Si un équilibreur de charge est en cours d’utilisation, il est peut-être souhaitable de marquer la machine virtuelle comme étant hors connexion.</span><span class="sxs-lookup"><span data-stu-id="1055a-254">If a load balancer is in use, you may want to mark the virtual machine as offline.</span></span>

    <span data-ttu-id="1055a-255">b.</span><span class="sxs-lookup"><span data-stu-id="1055a-255">b.</span></span> <span data-ttu-id="1055a-256">Dans l’Explorateur de fichiers, copiez le dossier **WAPConnector** dans un dossier nommé **c:\temp** sur chaque ordinateur d’API locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-256">In File Explorer, copy the **WAPConnector** folder to a folder named **c:\temp** on each Tenant API machine.</span></span>

    <span data-ttu-id="1055a-257">c.</span><span class="sxs-lookup"><span data-stu-id="1055a-257">c.</span></span> <span data-ttu-id="1055a-258">Copiez le fichier AzurePackConnectorOutput.txt que vous avez enregistré précédemment dans **c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="1055a-258">Copy the AzurePackConnectorOutput.txt file that you saved earlier, to **c:\temp\WAPConnector**.</span></span>

    <span data-ttu-id="1055a-259">d.</span><span class="sxs-lookup"><span data-stu-id="1055a-259">d.</span></span> <span data-ttu-id="1055a-260">Ouvrez une connexion Console ou RDP à la machine virtuelle d’API locataire sur laquelle vous avez copié les fichiers.</span><span class="sxs-lookup"><span data-stu-id="1055a-260">Open a Console or RDP connection to the Tenant API VM you copied the files to.</span></span>
    
    <span data-ttu-id="1055a-261">e.</span><span class="sxs-lookup"><span data-stu-id="1055a-261">e.</span></span> <span data-ttu-id="1055a-262">Basculez vers le répertoire **c:\temp\wapconnector\setup\scripts** et exécutez **Update-TenantAPI.ps1**.</span><span class="sxs-lookup"><span data-stu-id="1055a-262">Change directories to **c:\temp\wapconnector\setup\scripts**, and run **Update-TenantAPI.ps1**.</span></span> <span data-ttu-id="1055a-263">Cette nouvelle version de l’API locataire WAP présente un changement qui permet d’établir une relation d’approbation non seulement avec le service STS actuel, mais également avec l’instance AD FS dans Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-263">This new version of the WAP Tenant API contains a change to enable a trust relationship not only with the current STS, but also with the instance of AD FS in Azure Stack.</span></span>

     ```powershell
    cd C:\temp\wapconnector\setup\packages\

    .\Update-TenantAPI.ps1
    ```

    <span data-ttu-id="1055a-264">f.</span><span class="sxs-lookup"><span data-stu-id="1055a-264">f.</span></span>  <span data-ttu-id="1055a-265">Répétez l’étape 2 sur n’importe quelle autre machine virtuelle exécutant l’API locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-265">Repeat step 2 on any other virtual machine running the Tenant API.</span></span>
3. <span data-ttu-id="1055a-266">À partir d’**une seule** des machines virtuelles d’API locataire, exécutez le script Configure-TrustAzureStack.ps1 pour ajouter une relation d’approbation entre l’API locataire et l’instance AD FS sur Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-266">From **only one** of the Tenant API VMs, run the Configure-TrustAzureStack.ps1 script to add a trust relationship between the Tenant API and the AD FS instance on Azure Stack.</span></span> <span data-ttu-id="1055a-267">Vous devez utiliser un compte disposant d’un accès sysadmin à la base de données Microsoft.MgmtSvc.Store.</span><span class="sxs-lookup"><span data-stu-id="1055a-267">You must use an account with sysadmin access to the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="1055a-268">Le script a les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="1055a-268">This script has the following parameters:</span></span>

    | <span data-ttu-id="1055a-269">Paramètre</span><span class="sxs-lookup"><span data-stu-id="1055a-269">Parameter</span></span> | <span data-ttu-id="1055a-270">Description</span><span class="sxs-lookup"><span data-stu-id="1055a-270">Description</span></span> | <span data-ttu-id="1055a-271">Exemple</span><span class="sxs-lookup"><span data-stu-id="1055a-271">Example</span></span> |
    | --------- | ------------| ------- |
   | <span data-ttu-id="1055a-272">SqlServer</span><span class="sxs-lookup"><span data-stu-id="1055a-272">SqlServer</span></span> | <span data-ttu-id="1055a-273">Nom du serveur SQL qui contient la base de données Microsoft.MgmtSvc.Store.</span><span class="sxs-lookup"><span data-stu-id="1055a-273">The name of the SQL Server that contains the Microsoft.MgmtSvc.Store database.</span></span> <span data-ttu-id="1055a-274">Ce paramètre est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="1055a-274">This parameter is required.</span></span> | <span data-ttu-id="1055a-275">SQLServer</span><span class="sxs-lookup"><span data-stu-id="1055a-275">SQLServer</span></span> | 
   | <span data-ttu-id="1055a-276">DataFile</span><span class="sxs-lookup"><span data-stu-id="1055a-276">DataFile</span></span> | <span data-ttu-id="1055a-277">Fichier de sortie généré précédemment lors de la configuration du mode multicloud Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-277">The output file that was generated during the configuration of the Azure Stack multi-cloud mode earlier.</span></span> <span data-ttu-id="1055a-278">Ce paramètre est obligatoire.</span><span class="sxs-lookup"><span data-stu-id="1055a-278">This parameter is required.</span></span> | <span data-ttu-id="1055a-279">AzurePack-06-27-15-50.txt</span><span class="sxs-lookup"><span data-stu-id="1055a-279">AzurePack-06-27-15-50.txt</span></span> | 
   | <span data-ttu-id="1055a-280">PromptForSqlCredential</span><span class="sxs-lookup"><span data-stu-id="1055a-280">PromptForSqlCredential</span></span> | <span data-ttu-id="1055a-281">Indique que le script doit vous inviter de manière interactive à entrer des informations d’identification d’authentification SQL à utiliser lors de la connexion à l’instance SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1055a-281">Indicates that the script should prompt you interactively for a SQL Authentication credential to use when connecting to the SQL Server instance.</span></span> <span data-ttu-id="1055a-282">Les informations d’identification spécifiées doivent disposer des autorisations suffisantes pour désinstaller des bases de données et des schémas, et pour supprimer des connexions utilisateur.</span><span class="sxs-lookup"><span data-stu-id="1055a-282">The given credential must have sufficient permissions to uninstall databases, schemas, and delete user logins.</span></span> <span data-ttu-id="1055a-283">Si vous n’en spécifiez aucune, le script part du principe que le contexte d’utilisateur actuel a accès.</span><span class="sxs-lookup"><span data-stu-id="1055a-283">If none is provided, the script assumes that current user context has access.</span></span> | <span data-ttu-id="1055a-284">Aucune valeur n’est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="1055a-284">No value is needed.</span></span> |
   |  |  |

    <span data-ttu-id="1055a-285">Si vous ne connaissez pas le serveur SQL à utiliser, vous pouvez le découvrir.</span><span class="sxs-lookup"><span data-stu-id="1055a-285">If you don't know the SQL Server to use, you can discover it.</span></span> <span data-ttu-id="1055a-286">Connectez-vous à l’ordinateur de l’API locataire, utilisez la commande Unprotect-MgmtSvc pour ôter la protection du fichier Web.config de l’API locataire, puis recherchez le nom du serveur dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="1055a-286">Connect to the Tenant API computer, use the Unprotect-MgmtSvc command to unprotect the Tenant API Web.config file, and look for the server name in the connection string.</span></span> <span data-ttu-id="1055a-287">N’oubliez pas de réexécuter Protect-MgmtSvc pour protéger le fichier Web.config de l’API locataire.</span><span class="sxs-lookup"><span data-stu-id="1055a-287">Remember to run Protect-MgmtSvc again to protect the Tenant API Web.config file.</span></span>

  ```powershell
  cd C:\temp\wapconnector\setup\scripts\

 .\Configure-TrustAzureStack.ps1 -SqlServer "SQLServer" `
       -DataFile "C:\temp\wapconnector\AzurePackConnectorOutput.txt"
  ```

## <a name="example"></a><span data-ttu-id="1055a-288">Exemple</span><span class="sxs-lookup"><span data-stu-id="1055a-288">Example</span></span>
<span data-ttu-id="1055a-289">L’exemple suivant montre un déploiement complet du connecteur Windows Azure Pack sur une configuration Azure Stack à nœud unique et deux installations de Windows Azure Pack Express.</span><span class="sxs-lookup"><span data-stu-id="1055a-289">The following example shows a complete Windows Azure Pack Connector deployment on a single-node Azure Stack configuration and two Windows Azure Pack Express installations.</span></span> <span data-ttu-id="1055a-290">(Chaque installation Express se trouve sur un seul ordinateur, avec les exemples de noms *wapcomputer1* et *wapcomputer2*.)</span><span class="sxs-lookup"><span data-stu-id="1055a-290">(Each Express installation is on a single computer, with the example names *wapcomputer1* and*wapcomputer2*.)</span></span>

```powershell
# Run the following script on the Azure Stack host
$cred = New-Object System.Management.Automation.PSCredential("cloudadmin@azurestack.local",`
     (ConvertTo-SecureString -String "p@ssw0rd" -AsPlainText -Force))
$session = New-PSSession -ComputerName 'azs-ercs01' -Credential $cred `
     -ConfigurationName PrivilegedEndpoint -Authentication Credssp
 
# Enable Multicloud
invoke-command -Session $session -ScriptBlock { Add-AzurePackConnector -AzurePackClouds `
     @{CloudName = "AzurePack_1"; CloudEndpoint = "https://wapcomputer1.contoso.com:40005"},`
     @{CloudName = "AzurePack_2"; CloudEndpoint = "https://wapcomputer2.contoso.com:40005"}`
     -AzureStackCloudName "AzureStack" }  

```
<span data-ttu-id="1055a-291">Téléchargez le fichier .exe à partir du [Centre de téléchargement Microsoft](https://aka.ms/wapconnectorazurestackdlc), extrayez-le et copiez le dossier WAPConnector dans un dossier **c:\temp** sur l’ordinateur Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-291">Download the .exe file from the [Microsoft Download Center](https://aka.ms/wapconnectorazurestackdlc), extract it, and copy the WAPConnector folder to a **c:\temp** folder on the Windows Azure Pack computer.</span></span> <span data-ttu-id="1055a-292">Copiez les fichiers qui ont été générés comme sortie du script précédent (ils se trouvent dans \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) dans le dossier **c:\temp\WAPConnector**.</span><span class="sxs-lookup"><span data-stu-id="1055a-292">Copy the files that were generated as output in the previous script (located at \\\su1fileserver\SU1_Infrastructure_1\AzurePackConnectorOutput) to the **c:\temp\WAPConnector** folder.</span></span> <span data-ttu-id="1055a-293">(Les fichiers doivent ressembler à ceci : AzurePack-06-27-15-50.txt.) Ensuite, exécutez le script suivant une fois par instance de Windows Azure Pack :</span><span class="sxs-lookup"><span data-stu-id="1055a-293">(The files will looks similar to this: AzurePack-06-27-15-50.txt.) Then, run the following script, once per instance of Windows Azure Pack:</span></span>

 ```powershell
# Install Connector components
cd C:\temp\WAPConnector\Setup\Scripts
.\Install-Connector.ps1

# Configure Certificates for the new Connector services
.\Configure-Certificates.ps1

# Configure the Connector services
.\Configure-WapConnector.ps1 -TenantPortalFQDN "wapcomputer1.contoso.com" `
     -TenantAPIFQDN "wapcomputer1.contoso.com" `
     -AzureStackPortalFQDN "portal.local.azurestack.external"

# Install the updated TenantAPI
.\Update-TenantAPI.ps1

# Establish trust with the Azure Stack AD FS
.\Configure-TrustAzureStack.ps1 -SqlServer "wapcomputer1" `
     -DataFile "C:\temp\wapconnector\AzurePack-06-27-15-50.txt" 

```
## <a name="troubleshooting-tips"></a><span data-ttu-id="1055a-294">Conseils de dépannage</span><span class="sxs-lookup"><span data-stu-id="1055a-294">Troubleshooting tips</span></span>
1.  <span data-ttu-id="1055a-295">Vérifiez la connectivité réseau entre Azure Stack et Windows Azure Pack.</span><span class="sxs-lookup"><span data-stu-id="1055a-295">Ensure there is network connectivity between Azure Stack and Windows Azure Pack.</span></span> <span data-ttu-id="1055a-296">Cette connectivité doit exister entre tout ordinateur du locataire qui accède au portail Azure Stack et la machine virtuelle du portail du locataire Windows Azure Pack sur laquelle les nouveaux services de connecteur sont en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="1055a-296">This connectivity should be between any tenant computer that accesses the Azure Stack portal and the Windows Azure Pack tenant portal virtual machine where the new Connector services are running.</span></span>
2.  <span data-ttu-id="1055a-297">Vérifiez que tous les noms de domaine complets spécifiés sont corrects.</span><span class="sxs-lookup"><span data-stu-id="1055a-297">Ensure that all specified FQDNs are correct.</span></span>
3.  <span data-ttu-id="1055a-298">Vérifiez que les certificats SSL utilisés dans les nouveaux services de connecteur sont approuvés par Azure Stack (plus spécifiquement la machine virtuelle AzS-WASP01) et par tout autre ordinateur que le locataire est susceptible d’utiliser pour accéder au portail utilisateur Azure Stack.</span><span class="sxs-lookup"><span data-stu-id="1055a-298">Ensure that the SSL certificates used in the new Connector services are trusted by Azure Stack (specifically the AzS-WASP01 VM) and any other computer the tenant may use to access the Azure Stack user portal.</span></span>
4. <span data-ttu-id="1055a-299">Pour plus d’informations sur les problèmes connus, consultez [Dépannage de Microsoft Azure Stack](azure-stack-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="1055a-299">For known issues, see [Microsoft Azure Stack troubleshooting](azure-stack-troubleshooting.md).</span></span>


## <a name="next-steps"></a><span data-ttu-id="1055a-300">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1055a-300">Next steps</span></span>
[<span data-ttu-id="1055a-301">Utilisation des portails administrateur et utilisateur dans Azure Stack</span><span class="sxs-lookup"><span data-stu-id="1055a-301">Using the administrator and user portals in Azure Stack</span></span>](azure-stack-manage-portals.md)
