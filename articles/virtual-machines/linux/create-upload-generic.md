---
title: "aaaCreate et télécharger un VHD Linux dans Azure"
description: "En savoir plus toocreate et téléchargez un Azure disque dur virtuel (VHD) qui contient un système d’exploitation Linux."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: 208e15c035edb5520fc29ba8e4e71c42b041864d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="8d01f-103">Informations concernant les distributions non approuvées</span><span class="sxs-lookup"><span data-stu-id="8d01f-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="8d01f-104">contrat SLA de plateforme Windows Azure Hello applique machines toovirtual en cours d’exécution hello du système d’exploitation Linux uniquement lorsqu’un Hello [visé distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) est utilisé.</span><span class="sxs-lookup"><span data-stu-id="8d01f-104">hello Azure platform SLA applies toovirtual machines running hello Linux OS only when one of hello [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="8d01f-105">Toutes les distributions Linux qui sont fournis dans hello Azure Galerie d’images sont approuvées distributions avec la configuration requise de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-105">All Linux distributions that are provided in hello Azure image gallery are endorsed distributions with hello required configuration.</span></span>

* [<span data-ttu-id="8d01f-106">Linux sur Azure : Distributions approuvées</span><span class="sxs-lookup"><span data-stu-id="8d01f-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="8d01f-107">Prise en charge d’images Linux dans Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="8d01f-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="8d01f-108">Toutes les distributions en cours d’exécution sur Azure devez toomeet un certain nombre de conditions préalables toohave un tooproperly chance s’exécutent sur la plateforme de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-108">All distributions running on Azure will need toomeet a number of prerequisites toohave a chance tooproperly run on hello platform.</span></span>  <span data-ttu-id="8d01f-109">Cet article n’est pas complète comme chaque distribution est différente. et il est tout à fait possible que, même si vous répondez à tous les critères de hello ci-dessous que vous devez toujours toosignificantly ajuster votre tooensure système Linux lequel il s’exécute correctement sur la plateforme de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all hello criteria below you will still need toosignificantly tweak your Linux system tooensure that it properly runs on hello platform.</span></span>

<span data-ttu-id="8d01f-110">C'est pourquoi nous recommandons de commencer avec une de nos [distributions Linux approuvées sur Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) dans la mesure du possible.</span><span class="sxs-lookup"><span data-stu-id="8d01f-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="8d01f-111">Hello articles suivants vous guideront à travers comment tooprepare hello différents visé distributions Linux prises en charge sur Azure :</span><span class="sxs-lookup"><span data-stu-id="8d01f-111">hello following articles will guide you through how tooprepare hello various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="8d01f-112">**[Distributions CentOS](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="8d01f-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="8d01f-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="8d01f-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="8d01f-116">**[SLES et openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="8d01f-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="8d01f-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="8d01f-118">reste Hello de cet article traite des indications générales pour l’exécution de votre distribution Linux sur Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-118">hello rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="8d01f-119">Notes générales d'installation de Linux</span><span class="sxs-lookup"><span data-stu-id="8d01f-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="8d01f-120">format VHDX Hello n'est pas pris en charge dans Azure, uniquement **disque dur virtuel fixe**.</span><span class="sxs-lookup"><span data-stu-id="8d01f-120">hello VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="8d01f-121">Vous pouvez convertir le format de tooVHD hello disque à l’aide du Gestionnaire Hyper-V ou hello applet de commande convert-vhd.</span><span class="sxs-lookup"><span data-stu-id="8d01f-121">You can convert hello disk tooVHD format using Hyper-V Manager or hello convert-vhd cmdlet.</span></span> <span data-ttu-id="8d01f-122">Si vous utilisez VirtualBox, cela signifie en sélectionnant **une taille fixe** en tant qu’et non par défaut de toohello allouée dynamiquement lors de la création du disque de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-122">If you are using VirtualBox this means selecting **Fixed size** as opposed toohello default dynamically allocated when creating hello disk.</span></span>
* <span data-ttu-id="8d01f-123">Azure ne prend en charge que les machines virtuelles de la génération 1.</span><span class="sxs-lookup"><span data-stu-id="8d01f-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="8d01f-124">Vous pouvez convertir une disque de taille 1 machine virtuelle à partir du format de fichier de disque dur virtuel VHDX toohello et à partir de l’extension dynamique tooa fixée de génération.</span><span class="sxs-lookup"><span data-stu-id="8d01f-124">You can convert a generation 1 virtual machine from VHDX toohello VHD file format and from dynamically expanding tooa fixed sized disk.</span></span> <span data-ttu-id="8d01f-125">Mais vous ne pouvez pas modifier la génération d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="8d01f-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="8d01f-126">Pour plus d’informations, consultez [Dois-je créer une machine virtuelle de génération 1 ou 2 dans Hyper-V ?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="8d01f-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="8d01f-127">taille maximale de Hello autorisé pour hello que disque dur virtuel est de 1 023 go.</span><span class="sxs-lookup"><span data-stu-id="8d01f-127">hello maximum size allowed for hello VHD is 1,023 GB.</span></span>
* <span data-ttu-id="8d01f-128">Lorsque vous installez le système de Linux hello *recommandé* que vous utilisez les partitions standard au lieu du Gestionnaire de volume logique (souvent hello par défaut pour le nombre d’installations).</span><span class="sxs-lookup"><span data-stu-id="8d01f-128">When installing hello Linux system it is *recommended* that you use standard partitions rather than LVM (often hello default for many installations).</span></span> <span data-ttu-id="8d01f-129">Cela permet d’éviter Gestionnaire de volume logique nom est en conflit avec des ordinateurs virtuels ont, en particulier si un disque du système d’exploitation a besoin toobe jointe tooanother VM identiques pour le dépannage.</span><span class="sxs-lookup"><span data-stu-id="8d01f-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs toobe attached tooanother identical VM for troubleshooting.</span></span> <span data-ttu-id="8d01f-130">La technique [LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) ou [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) peut être utilisée sur les disques de données.</span><span class="sxs-lookup"><span data-stu-id="8d01f-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="8d01f-131">La prise en charge du noyau pour le montage de systèmes de fichiers UDF est requise.</span><span class="sxs-lookup"><span data-stu-id="8d01f-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="8d01f-132">Au premier démarrage sur Azure hello mise en service de configuration est passée toohello Linux VM via un support au format UDF qui est attaché toohello invité.</span><span class="sxs-lookup"><span data-stu-id="8d01f-132">At first boot on Azure hello provisioning configuration is passed toohello Linux VM via UDF-formatted media that is attached toohello guest.</span></span> <span data-ttu-id="8d01f-133">l’agent Azure Linux de Hello doit être en mesure de toomount hello UDF fichier système tooread sa configuration et configurer hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="8d01f-133">hello Azure Linux agent must be able toomount hello UDF file system tooread its configuration and provision hello VM.</span></span>
* <span data-ttu-id="8d01f-134">Les versions du noyau Linux antérieures à la version 2.6.37 ne prennent pas en charge NUMA sur Hyper-V avec des machines virtuelles de taille supérieure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="8d01f-135">Ce problème principalement les impacts de distributions antérieures à l’aide de hello en amont noyau de Red Hat 2.6.32 et a été corrigé dans RHEL 6.6 (noyau-2.6.32-504).</span><span class="sxs-lookup"><span data-stu-id="8d01f-135">This issue primarily impacts older distributions using hello upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="8d01f-136">Systèmes en cours d’exécution personnalisées noyaux antérieures à 2.6.37 ou les noyaux basée sur RHEL plus anciens que 2.6.32-504 doit définir hello paramètre démarrage `numa=off` sur noyau hello de ligne de commande dans grub.conf.</span><span class="sxs-lookup"><span data-stu-id="8d01f-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set hello boot parameter `numa=off` on hello kernel command-line in grub.conf.</span></span> <span data-ttu-id="8d01f-137">Pour plus d’informations, consultez l’article [KB 436883](https://access.redhat.com/solutions/436883) sur Red Hat.</span><span class="sxs-lookup"><span data-stu-id="8d01f-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="8d01f-138">Ne configurez pas une partition d’échange sur le disque du système d’exploitation hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-138">Do not configure a swap partition on hello OS disk.</span></span> <span data-ttu-id="8d01f-139">l’agent de Hello Linux peut être configuré toocreate un fichier d’échange sur le disque de ressources temporaires hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-139">hello Linux agent can be configured toocreate a swap file on hello temporary resource disk.</span></span>  <span data-ttu-id="8d01f-140">Vous trouverez plus d’informations à ce sujet dans les étapes de hello ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="8d01f-140">More information about this can be found in hello steps below.</span></span>
* <span data-ttu-id="8d01f-141">Tous les disques durs virtuels hello doivent avoir des tailles qui sont des multiples de 1 Mo.</span><span class="sxs-lookup"><span data-stu-id="8d01f-141">All of hello VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="8d01f-142">Installation de modules de noyau sans Hyper-V</span><span class="sxs-lookup"><span data-stu-id="8d01f-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="8d01f-143">Azure s’exécute sur un hyperviseur Hyper-V de hello, pour Linux nécessite l’installation de certains modules noyau dans l’ordre des toorun dans Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-143">Azure runs on hello Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order toorun in Azure.</span></span> <span data-ttu-id="8d01f-144">Si vous avez une machine virtuelle qui a été créée en dehors de Hyper-V, programmes d’installation de Linux hello ne comprennent pas les pilotes hello pour Hyper-V ramdisk initiale de hello (initrd ou initramfs), sauf si elle détecte qu’il s’exécute une un environnement Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="8d01f-144">If you have a VM that was created outside of Hyper-V, hello Linux installers may not include hello drivers for Hyper-V in hello initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="8d01f-145">Lorsque vous utilisez un tooprepare système (Virtualbox, KVM, etc.) de virtualisation différent de votre image Linux, vous devrez peut-être toorebuild hello initrd tooensure qui a au moins hello `hv_vmbus` et `hv_storvsc` modules de noyau sont disponibles sur ramdisk initiale de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) tooprepare your Linux image, you may need toorebuild hello initrd tooensure that at least hello `hv_vmbus` and `hv_storvsc` kernel modules are available on hello initial ramdisk.</span></span>  <span data-ttu-id="8d01f-146">Il s’agit au moins un problème connu sur les systèmes en fonction de distribution de Red Hat hello en amont.</span><span class="sxs-lookup"><span data-stu-id="8d01f-146">This is a known issue at least on systems based on hello upstream Red Hat distribution.</span></span>

<span data-ttu-id="8d01f-147">mécanisme Hello pour la reconstruction de l’image initrd ou initramfs hello peut varier en fonction de distribution de hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-147">hello mechanism for rebuilding hello initrd or initramfs image may vary depending on hello distribution.</span></span> <span data-ttu-id="8d01f-148">Veuillez à la documentation de votre distribution ou prend en charge de procédure de hello appropriée.</span><span class="sxs-lookup"><span data-stu-id="8d01f-148">Please consult your distribution's documentation or support for hello proper procedure.</span></span>  <span data-ttu-id="8d01f-149">Voici un exemple de comment toorebuild hello initrd à l’aide de hello `mkinitrd` utilitaire :</span><span class="sxs-lookup"><span data-stu-id="8d01f-149">Here is one example for how toorebuild hello initrd using hello `mkinitrd` utility:</span></span>

<span data-ttu-id="8d01f-150">Tout d’abord, sauvegardez les image initrd existante hello :</span><span class="sxs-lookup"><span data-stu-id="8d01f-150">First, back up hello existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="8d01f-151">Ensuite, régénérez initrd hello avec hello `hv_vmbus` et `hv_storvsc` modules de noyau :</span><span class="sxs-lookup"><span data-stu-id="8d01f-151">Next, rebuild hello initrd with hello `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="8d01f-152">Redimensionnement des disques durs virtuels</span><span class="sxs-lookup"><span data-stu-id="8d01f-152">Resizing VHDs</span></span>
<span data-ttu-id="8d01f-153">Les images de disque dur virtuel sur Azure doivent avoir un too1MB taille virtuelle alignée.</span><span class="sxs-lookup"><span data-stu-id="8d01f-153">VHD images on Azure must have a virtual size aligned too1MB.</span></span>  <span data-ttu-id="8d01f-154">En règle générale, les disques durs virtuels créés à l'aide d'Hyper-V sont déjà alignés correctement.</span><span class="sxs-lookup"><span data-stu-id="8d01f-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="8d01f-155">Si hello disque dur virtuel n’est pas correctement aligné, vous pouvez recevoir une erreur message similaire toohello suivant lorsque vous essayez de toocreate une *image* à partir de votre disque dur virtuel :</span><span class="sxs-lookup"><span data-stu-id="8d01f-155">If hello VHD is not aligned correctly then you may receive an error message similar toohello following when you attempt toocreate an *image* from your VHD:</span></span>

    "hello VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. hello size must be a whole number (in MBs).”

<span data-ttu-id="8d01f-156">tooremedy ce que vous pouvez redimensionner hello machine virtuelle à l’aide de la console du Gestionnaire Hyper-V hello ou hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) applet de commande Powershell.</span><span class="sxs-lookup"><span data-stu-id="8d01f-156">tooremedy this you can resize hello VM using either hello Hyper-V Manager console or hello [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="8d01f-157">Si vous n’exécutez pas dans un environnement Windows qu’il est recommandé de toouse qemu-img tooconvert (si nécessaire) et redimensionner hello disque dur virtuel.</span><span class="sxs-lookup"><span data-stu-id="8d01f-157">If you are not running in a Windows environment then it is recommended toouse qemu-img tooconvert (if needed) and resize hello VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="8d01f-158">Il existe un bogue connu dans la version 2.2.1 de qemu-img, qui entraîne un formatage incorrect de disque dur virtuel.</span><span class="sxs-lookup"><span data-stu-id="8d01f-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="8d01f-159">problème de Hello a été résolu dans QEMU 2.6.</span><span class="sxs-lookup"><span data-stu-id="8d01f-159">hello issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="8d01f-160">Il est recommandé de toouse qemu-img 2.2.0 ou inférieur ou too2.6 de mise à jour ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-160">It is recommended toouse either qemu-img 2.2.0 or lower, or update too2.6 or higher.</span></span> <span data-ttu-id="8d01f-161">Référence : https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="8d01f-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="8d01f-162">Redimensionnement hello VHD directement l’aide des outils tels que `qemu-img` ou `vbox-manage` peut entraîner un disque dur virtuel non démarrable.</span><span class="sxs-lookup"><span data-stu-id="8d01f-162">Resizing hello VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="8d01f-163">Il est donc recommandé toofirst convert hello image de disque dur virtuel tooa disque RAW.</span><span class="sxs-lookup"><span data-stu-id="8d01f-163">So it is recommended toofirst convert hello VHD tooa RAW disk image.</span></span>  <span data-ttu-id="8d01f-164">Si l’image de machine virtuelle hello a déjà été créé en tant qu’image de disque (valeur par défaut de hello pour certains hyperviseurs telles que KVM) vous pouvez ignorer cette étape :</span><span class="sxs-lookup"><span data-stu-id="8d01f-164">If hello VM image was already created as RAW disk image (hello default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="8d01f-165">Calculer hello requises de taille de tooensure d’image de disque hello qui hello taille virtuelle est alignée too1MB.</span><span class="sxs-lookup"><span data-stu-id="8d01f-165">Calculate hello required size of hello disk image tooensure that hello virtual size is aligned too1MB.</span></span>  <span data-ttu-id="8d01f-166">Hello bash shell script suivant peut aider à cela.</span><span class="sxs-lookup"><span data-stu-id="8d01f-166">hello following bash shell script can assist with this.</span></span>  <span data-ttu-id="8d01f-167">Hello script utilise «`qemu-img info`» toodetermine hello taille virtuelle de l’image de disque hello, puis il calcule hello taille toohello suivant 1 Mo :</span><span class="sxs-lookup"><span data-stu-id="8d01f-167">hello script uses "`qemu-img info`" toodetermine hello virtual size of hello disk image and then calculates hello size toohello next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="8d01f-168">Redimensionner le disque hello à l’aide de $rounded_size en tant qu’ensemble Bonjour au-dessus de script :</span><span class="sxs-lookup"><span data-stu-id="8d01f-168">Resize hello raw disk using $rounded_size as set in hello above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="8d01f-169">Maintenant, convertissez tooa arrière du disque RAW hello disque dur virtuel de taille fixe :</span><span class="sxs-lookup"><span data-stu-id="8d01f-169">Now, convert hello RAW disk back tooa fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="8d01f-170">Ou, avec la version de qemu **2.6 +** inclure hello `force_size` option :</span><span class="sxs-lookup"><span data-stu-id="8d01f-170">Or, with qemu version **2.6+** include hello `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="8d01f-171">Conditions requises pour le noyau Linux</span><span class="sxs-lookup"><span data-stu-id="8d01f-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="8d01f-172">Hello pilotes de Services d’intégration Linux (LIS) pour Hyper-V et Azure sont fournis directement toohello en amont noyau Linux.</span><span class="sxs-lookup"><span data-stu-id="8d01f-172">hello Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly toohello upstream Linux kernel.</span></span> <span data-ttu-id="8d01f-173">Ces pilotes sont déjà disponibles dans de nombreuses distributions qui comprennent une version récente du noyau Linux (3.x et supérieures). Sinon, ces distributions fournissent des versions rétroportées de ces pilotes avec leurs noyaux.</span><span class="sxs-lookup"><span data-stu-id="8d01f-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="8d01f-174">Ces pilotes sont constamment mis à jour dans le noyau de hello en amont avec les nouveaux correctifs et fonctionnalités, lorsque cela est possible, il est recommandé toorun un [visé distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) qui inclut ces correctifs et les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="8d01f-174">These drivers are constantly being updated in hello upstream kernel with new fixes and features, so when possible it is recommended toorun an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="8d01f-175">Si vous exécutez une variante de versions de Red Hat Enterprise Linux **6.0-6.3**, vous devez les pilotes les plus récents LIS tooinstall hello pour Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="8d01f-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need tooinstall hello latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="8d01f-176">Vous pouvez trouver les pilotes de Hello [à cet emplacement](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="8d01f-176">hello drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="8d01f-177">À compter de RHEL **6.4 +** (et dérivés) hello LIS pilotes sont déjà inclus avec le noyau de hello et par conséquent, aucune packages d’installation supplémentaires est nécessaire toorun ces systèmes dans Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-177">As of RHEL **6.4+** (and derivatives) hello LIS drivers are already included with hello kernel and so no additional installation packages are needed toorun those systems on Azure.</span></span>

<span data-ttu-id="8d01f-178">Si un noyau personnalisé est requis, il est recommandé d’une version plus récente de noyau toouse (c'est-à-dire **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="8d01f-178">If a custom kernel is required, it is recommended toouse a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="8d01f-179">Pour les distributions ou les fournisseurs qui gèrent leur propres noyau, des efforts seront requis tooregularly backport hello LIS pilotes du noyau de hello en amont noyau tooyour personnalisé.</span><span class="sxs-lookup"><span data-stu-id="8d01f-179">For those distributions or vendors who maintain their own kernel, some effort will be required tooregularly backport hello LIS drivers from hello upstream kernel tooyour custom kernel.</span></span>  <span data-ttu-id="8d01f-180">Même si vous exécutez déjà une version de noyau relativement récentes, il est recommandé de suivre tookeep de n’importe quel en amont correctifs dans backport et les pilotes LIS hello celles en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="8d01f-180">Even if you are already running a relatively recent kernel version, it is highly recommended tookeep track of any upstream fixes in hello LIS drivers and backport those as needed.</span></span> <span data-ttu-id="8d01f-181">emplacement de Hello hello LIS source de fichiers de pilote est disponible dans hello [chargés de maintenance](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) fichier dans l’arborescence des sources de noyau Linux hello :</span><span class="sxs-lookup"><span data-stu-id="8d01f-181">hello location of hello LIS driver source files is available in hello [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in hello Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="8d01f-182">Au minimum, absence hello Hello suivant les correctifs ont été problèmes toocause sur Azure, et par conséquent, ces doivent être inclus dans le noyau hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-182">At a very minimum, hello absence of hello following patches have been known toocause problems on Azure and so these must be included in hello kernel.</span></span> <span data-ttu-id="8d01f-183">Cette liste n’est pas exhaustive ni complète pour toutes les distributions :</span><span class="sxs-lookup"><span data-stu-id="8d01f-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="8d01f-184">ata_piix : différer les pilotes de disques toohello Hyper-V par défaut</span><span class="sxs-lookup"><span data-stu-id="8d01f-184">ata_piix: defer disks toohello Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="8d01f-185">storvsc : le compte pour les paquets de transit dans le chemin d’accès de hello réinitialisation</span><span class="sxs-lookup"><span data-stu-id="8d01f-185">storvsc: Account for in-transit packets in hello RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="8d01f-186">storvsc : éviter l’utilisation de WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="8d01f-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="8d01f-187">storvsc :désactiver WRITE_SAME pour RAID et les pilotes adaptateurs de l’hôte virtuel</span><span class="sxs-lookup"><span data-stu-id="8d01f-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="8d01f-188">storvsc : correctif de déréférence du pointeur NULL</span><span class="sxs-lookup"><span data-stu-id="8d01f-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="8d01f-189">storvsc : des défaillances de la mémoire tampon de l’anneau peuvent entraîner un gel des E/S</span><span class="sxs-lookup"><span data-stu-id="8d01f-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="8d01f-190">scsi_sysfs : se protéger contre une double exécution de __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="8d01f-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="hello-azure-linux-agent"></a><span data-ttu-id="8d01f-191">Hello Agent Linux Azure</span><span class="sxs-lookup"><span data-stu-id="8d01f-191">hello Azure Linux Agent</span></span>
<span data-ttu-id="8d01f-192">Hello [Linux Agent Azure](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) est requis tooproperly configurer une machine virtuelle de Linux dans Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-192">hello [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required tooproperly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="8d01f-193">Vous pouvez obtenir la version la plus récente hello, problèmes de fichiers ou envoyer des requêtes de tirage à hello [référentiel GitHub de l’Agent Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="8d01f-193">You can get hello latest version, file issues or submit pull requests at hello [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="8d01f-194">l’agent de Linux Hello est publié sous licence de hello Apache 2.0.</span><span class="sxs-lookup"><span data-stu-id="8d01f-194">hello Linux agent is released under hello Apache 2.0 license.</span></span> <span data-ttu-id="8d01f-195">De nombreuses distributions fournissent déjà RPM ou deb packages pour l’agent de hello, et par conséquent, dans certains cas cela peut être installé et mis à jour avec un minimum d’effort.</span><span class="sxs-lookup"><span data-stu-id="8d01f-195">Many distributions already provide RPM or deb packages for hello agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="8d01f-196">Hello Linux Agent Azure nécessite Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="8d01f-196">hello Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="8d01f-197">agent de Hello nécessite également un module de python-pyasn1 hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-197">hello agent also requires hello python-pyasn1 module.</span></span> <span data-ttu-id="8d01f-198">La plupart des distributions le fournissent sous la forme d'un package indépendant que vous pouvez installer.</span><span class="sxs-lookup"><span data-stu-id="8d01f-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="8d01f-199">Dans certains cas hello Linux Agent Azure n’est peut-être pas compatible avec NetworkManager.</span><span class="sxs-lookup"><span data-stu-id="8d01f-199">In some cases hello Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="8d01f-200">Nombre des packages RPM/Deb hello fournies par les distributions de configurer NetworkManager en tant que conflit toohello waagent package et par conséquent désinstallera NetworkManager lorsque vous installez le package de l’agent Linux hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-200">Many of hello RPM/Deb packages provided by distributions configure NetworkManager as a conflict toohello waagent package, and thus will uninstall NetworkManager when you install hello Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="8d01f-201">Configuration générale requise Linux</span><span class="sxs-lookup"><span data-stu-id="8d01f-201">General Linux System Requirements</span></span>

* <span data-ttu-id="8d01f-202">Modifier la ligne de démarrage de noyau de hello GRUB ou GRUB2 Bonjour tooinclude paramètres suivants.</span><span class="sxs-lookup"><span data-stu-id="8d01f-202">Modify hello kernel boot line in GRUB or GRUB2 tooinclude hello following parameters.</span></span> <span data-ttu-id="8d01f-203">Cela garantit également tous les messages de console sont envoyés toohello premier port série, qui peut aider Azure prise en charge avec les problèmes de débogage :</span><span class="sxs-lookup"><span data-stu-id="8d01f-203">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="8d01f-204">Cela garantit également tous les messages de console sont envoyés toohello premier port série, qui peut aider Azure prise en charge avec les problèmes de débogage.</span><span class="sxs-lookup"><span data-stu-id="8d01f-204">This will also ensure all console messages are sent toohello first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="8d01f-205">En outre toohello ci-dessus, il est recommandé de trop*supprimer* hello après les paramètres s’ils existent :</span><span class="sxs-lookup"><span data-stu-id="8d01f-205">In addition toohello above, it is recommended too*remove* hello following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="8d01f-206">Graphique et silencieuse de démarrage ne sont pas utiles dans un environnement de cloud que nous voulons tous les toobe de journaux hello envoyé toohello de port série.</span><span class="sxs-lookup"><span data-stu-id="8d01f-206">Graphical and quiet boot are not useful in a cloud environment where we want all hello logs toobe sent toohello serial port.</span></span> <span data-ttu-id="8d01f-207">Hello `crashkernel` option peut être gauche configuré si vous le souhaitez, mais notez que ce paramètre réduit hello de mémoire disponible dans hello VM à 128 Mo ou plus, qui peut être problématique sur les tailles de machine virtuelle plus petites hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-207">hello `crashkernel` option may be left configured if desired, but note that this parameter will reduce hello amount of available memory in hello VM by 128MB or more, which may be problematic on hello smaller VM sizes.</span></span>

* <span data-ttu-id="8d01f-208">Lors de l’installation hello Linux Agent Azure</span><span class="sxs-lookup"><span data-stu-id="8d01f-208">Installing hello Azure Linux Agent</span></span>
  
    <span data-ttu-id="8d01f-209">Hello Linux Agent Azure est requis pour la configuration d’une image Linux sur Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-209">hello Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="8d01f-210">Nombre de distributions fournit agent hello comme un package RPM ou Deb (package de hello est généralement appelée « WALinuxAgent » ou 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="8d01f-210">Many distributions provide hello agent as an RPM or Deb package (hello package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="8d01f-211">Hello agent peut également être installé manuellement en suivant les étapes de hello Bonjour [Guide de l’Agent Linux](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="8d01f-211">hello agent can also be installed manually by following hello steps in hello [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="8d01f-212">Vérifiez le serveur SSH hello est installé et configuré toostart au moment du démarrage.</span><span class="sxs-lookup"><span data-stu-id="8d01f-212">Ensure that hello SSH server is installed and configured toostart at boot time.</span></span>  <span data-ttu-id="8d01f-213">Cela est généralement hello par défaut.</span><span class="sxs-lookup"><span data-stu-id="8d01f-213">This is usually hello default.</span></span>

* <span data-ttu-id="8d01f-214">Ne créez pas d’espace d’échange sur le disque du système d’exploitation hello</span><span class="sxs-lookup"><span data-stu-id="8d01f-214">Do not create swap space on hello OS disk</span></span>
  
    <span data-ttu-id="8d01f-215">Hello Linux Agent Azure peut configurer automatiquement l’espace d’échange à l’aide du disque de ressources locales hello qui est attaché toohello machine virtuelle après le déploiement sur Azure.</span><span class="sxs-lookup"><span data-stu-id="8d01f-215">hello Azure Linux Agent can automatically configure swap space using hello local resource disk that is attached toohello VM after provisioning on Azure.</span></span> <span data-ttu-id="8d01f-216">Notez que le disque local de ressource hello un *temporaire* disque et peut être vidé lorsque hello machine virtuelle est déprovisionnée.</span><span class="sxs-lookup"><span data-stu-id="8d01f-216">Note that hello local resource disk is a *temporary* disk, and might be emptied when hello VM is deprovisioned.</span></span> <span data-ttu-id="8d01f-217">Après avoir installé hello Linux Agent Azure (voir l’étape précédente), modifier hello suivant correctement les paramètres dans /etc/waagent.conf :</span><span class="sxs-lookup"><span data-stu-id="8d01f-217">After installing hello Azure Linux Agent (see previous step), modify hello following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this toowhatever you need it toobe.

* <span data-ttu-id="8d01f-218">Dans la dernière étape, exécutez hello suivant la machine virtuelle de commandes toodeprovision hello :</span><span class="sxs-lookup"><span data-stu-id="8d01f-218">As a final step, run hello following commands toodeprovision hello virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="8d01f-219">Sur Virtualbox, vous pouvez voir l’erreur suivante après l’exécution de hello ' waagent-force - annuler le déploiement ' : `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="8d01f-219">On Virtualbox you may see hello following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="8d01f-220">Ce message d’erreur n’est pas critique et peut être ignoré.</span><span class="sxs-lookup"><span data-stu-id="8d01f-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="8d01f-221">Puis vous devez tooshut la machine virtuelle de hello et télécharger tooAzure de disque dur virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="8d01f-221">You will then need tooshut down hello virtual machine and upload hello VHD tooAzure.</span></span>

