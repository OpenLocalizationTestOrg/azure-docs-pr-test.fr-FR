---
title: Guide de sauvegarde pour SAP HANA sur Machines Virtuelles Azure | Microsoft Docs
description: "Le guide de sauvegarde pour SAP HANA couvre deux méthodes de sauvegarde clés pour SAP HANA sur machines virtuelles Azure"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 9e5b124643b753f404ba6012d3df998f567be59a
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="backup-guide-for-sap-hana-on-azure-virtual-machines"></a><span data-ttu-id="d220f-103">Guide de sauvegarde pour SAP HANA sur Machines Virtuelles Azure</span><span class="sxs-lookup"><span data-stu-id="d220f-103">Backup guide for SAP HANA on Azure Virtual Machines</span></span>

## <a name="getting-started"></a><span data-ttu-id="d220f-104">Mise en route</span><span class="sxs-lookup"><span data-stu-id="d220f-104">Getting Started</span></span>

<span data-ttu-id="d220f-105">Le guide de sauvegarde pour SAP HANA exécuté sur des machines virtuelles Azure aborde uniquement les sujets spécifiques à Azure.</span><span class="sxs-lookup"><span data-stu-id="d220f-105">The backup guide for SAP HANA running on Azure virtual Machines will only describe Azure-specific topics.</span></span> <span data-ttu-id="d220f-106">Pour ce qui concerne les éléments généraux associés à la sauvegarde SAP HANA, consultez la documentation sur SAP HANA (voir la section _Documentation sur la sauvegarde SAP HANA_ plus loin dans cet article).</span><span class="sxs-lookup"><span data-stu-id="d220f-106">For general SAP HANA backup related items, check the SAP HANA documentation (see _SAP HANA backup documentation_ later in this article).</span></span>

<span data-ttu-id="d220f-107">Cet article couvre deux méthodes de sauvegarde clés pour SAP HANA sur machines virtuelles Azure :</span><span class="sxs-lookup"><span data-stu-id="d220f-107">The focus of this article is on two major backup possibilities for SAP HANA on Azure virtual machines:</span></span>

- <span data-ttu-id="d220f-108">Sauvegarde HANA sur le système de fichiers dans une machine virtuelle Azure Linux (voir [Sauvegarde SAP HANA sur Azure au niveau fichier](sap-hana-backup-file-level.md))</span><span class="sxs-lookup"><span data-stu-id="d220f-108">HANA backup to the file system in an Azure Linux Virtual Machine (see [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md))</span></span>
- <span data-ttu-id="d220f-109">Sauvegarde HANA à partir de captures instantanées de stockage en utilisant la fonctionnalité de capture instantanée d’Azure Storage Blob manuellement ou le service Azure Backup (voir [Sauvegarde SAP HANA à partir de captures instantanées de stockage](sap-hana-backup-storage-snapshots.md))</span><span class="sxs-lookup"><span data-stu-id="d220f-109">HANA backup based on storage snapshots using the Azure storage blob snapshot feature manually or Azure Backup Service (see [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md))</span></span>

<span data-ttu-id="d220f-110">SAP HANA offre une API de sauvegarde qui permet l’intégration directe d’outils de sauvegarde tiers à SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-110">SAP HANA offers a backup API, which allows third-party backup tools to integrate directly with SAP HANA.</span></span> <span data-ttu-id="d220f-111">(Cet aspect n’est pas couvert dans ce guide.) Actuellement, il n’existe aucune intégration directe de SAP HANA au service Azure Backup basée sur cette API.</span><span class="sxs-lookup"><span data-stu-id="d220f-111">(That is not within the scope of this guide.) There is no direct integration of SAP HANA with Azure Backup service available right now based on this API.</span></span>

<span data-ttu-id="d220f-112">SAP HANA est officiellement pris en charge sur les machines virtuelles Azure de type GS5 en tant qu’instance unique avec une restriction supplémentaire pour les charges de travail OLAP (voir [Find Certified IaaS Platforms](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) (Trouver les plateformes IaaS certifiées) sur le site web SAP).</span><span class="sxs-lookup"><span data-stu-id="d220f-112">SAP HANA is officially supported on Azure VM type GS5 as single instance with an additional restriction to OLAP workloads (see [Find Certified IaaS Platforms](https://global.sap.com/community/ebook/2014-09-02-hana-hardware/enEN/iaas.html) on the SAP website).</span></span> <span data-ttu-id="d220f-113">Cet article sera mis à jour lors de la mise à disposition de nouvelles offres pour SAP HANA sur Azure.</span><span class="sxs-lookup"><span data-stu-id="d220f-113">This article will be updated as new offerings for SAP HANA on Azure become available.</span></span>

<span data-ttu-id="d220f-114">Une solution SAP HANA hybride est également disponible sur Azure. Dans le cadre de cette solution, SAP HANA s’exécute de façon non virtualisée sur des serveurs physiques.</span><span class="sxs-lookup"><span data-stu-id="d220f-114">There is also an SAP HANA hybrid solution available on Azure, where SAP HANA runs non-virtualized on physical servers.</span></span> <span data-ttu-id="d220f-115">Toutefois, ce guide de sauvegarde SAP HANA pour Azure couvre un environnement Azure pur où SAP HANA s’exécute dans une machine virtuelle Azure et non sur de &quot;grandes instances&quot;. Consultez l’article [Vue d’ensemble et architecture de SAP HANA (grandes instances) sur Azure](hana-overview-architecture.md) pour plus d’informations sur cette solution de sauvegarde sur de &quot;grandes instances&quot;, basée sur des captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="d220f-115">However, this SAP HANA Azure backup guide covers a pure Azure environment where SAP HANA runs in an Azure VM, not SAP HANA running on &quot;large instances.&quot; See [SAP HANA (large instances) overview and architecture on Azure](hana-overview-architecture.md) for more information about this backup solution on &quot;large instances&quot; based on storage snapshots.</span></span>

<span data-ttu-id="d220f-116">Vous trouverez des informations générales sur les produits SAP pris en charge par Azure dans la [note SAP 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span><span class="sxs-lookup"><span data-stu-id="d220f-116">General information about SAP products supported on Azure can be found in [SAP Note 1928533](https://launchpad.support.sap.com/#/notes/1928533).</span></span>

<span data-ttu-id="d220f-117">Les trois schémas suivants fournissent une vue d’ensemble des options de sauvegarde SAP HANA utilisant actuellement les fonctionnalités natives d’Azure. Ils montrent également les trois scénarios de sauvegarde futurs potentiels.</span><span class="sxs-lookup"><span data-stu-id="d220f-117">The following three figures give an overview of the SAP HANA backup options using native Azure capabilities currently, and also show three potential future backup scenarios.</span></span> <span data-ttu-id="d220f-118">Les articles connexes [Sauvegarde SAP HANA sur Azure au niveau fichier](sap-hana-backup-file-level.md) et [Sauvegarde SAP HANA à partir de captures instantanées de stockage](sap-hana-backup-storage-snapshots.md) décrivent ces options plus en détail et abordent notamment les considérations de taille et de performance des sauvegardes SAP HANA multi-téraoctets.</span><span class="sxs-lookup"><span data-stu-id="d220f-118">The related articles [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) and [SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describe these options in more detail, including size and performance considerations for SAP HANA backups that are multi-terabytes in size.</span></span>

![Ce schéma illustre deux possibilités d’enregistrement de l’état actuel de la machine virtuelle.](media/sap-hana-backup-guide/image001.png)

<span data-ttu-id="d220f-120">Ce schéma illustre la possibilité d’enregistrer l’état actuel de la machine virtuelle par le biais du service Azure Backup ou à l’aide d’une capture instantanée manuelle des disques de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d220f-120">This figure shows the possibility of saving the current VM state, either via Azure Backup service or manual snapshot of VM disks.</span></span> <span data-ttu-id="d220f-121">Cette approche permet de ne pas avoir à gérer les sauvegardes SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-121">With this approach, one doesn&#39;t have to manage SAP HANA backups.</span></span> <span data-ttu-id="d220f-122">Ce scénario impliquant des captures instantanées de disque pose les défis de la cohérence du système de fichiers et de l’état du disque cohérent au niveau applicatif.</span><span class="sxs-lookup"><span data-stu-id="d220f-122">The challenge of the disk snapshot scenario is file system consistency, and an application-consistent disk state.</span></span> <span data-ttu-id="d220f-123">L’aspect cohérence est couvert dans la section _Cohérence des données SAP HANA lors de la création de captures instantanées de stockage_ plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d220f-123">The consistency topic is discussed in the section _SAP HANA data consistency when taking storage snapshots_ later in this article.</span></span> <span data-ttu-id="d220f-124">Les fonctionnalités et restrictions du service Azure Backup liées aux sauvegardes SAP HANA sont également abordées plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d220f-124">Capabilities and restrictions of Azure Backup service related to SAP HANA backups are also discussed later in this article.</span></span>

![Ce schéma illustre les possibilités de sauvegarde de fichiers SAP HANA dans la machine virtuelle.](media/sap-hana-backup-guide/image002.png)

<span data-ttu-id="d220f-126">Ce schéma illustre les possibilités de sauvegarde de fichiers SAP HANA dans la machine virtuelle et de stockage des fichiers de sauvegarde HANA à un autre emplacement à l’aide de différents outils.</span><span class="sxs-lookup"><span data-stu-id="d220f-126">This figure shows options for taking an SAP HANA file backup inside the VM, and then storing it HANA backup files somewhere else using different tools.</span></span> <span data-ttu-id="d220f-127">Une sauvegarde HANA nécessite plus de temps qu’une solution de sauvegarde basée sur des captures instantanées. Cependant, elle présente certains avantages en termes d’intégrité et de cohérence.</span><span class="sxs-lookup"><span data-stu-id="d220f-127">Taking a HANA backup requires more time than a snapshot-based backup solution, but it has advantages regarding integrity and consistency.</span></span> <span data-ttu-id="d220f-128">Vous trouverez des informations plus détaillées à ce sujet plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d220f-128">More details are provided later in this article.</span></span>

![Ce schéma illustre un scénario de sauvegarde SAP HANA futur potentiel.](media/sap-hana-backup-guide/image003.png)

<span data-ttu-id="d220f-130">Ce schéma illustre un scénario de sauvegarde SAP HANA futur potentiel.</span><span class="sxs-lookup"><span data-stu-id="d220f-130">This figure shows a potential future SAP HANA backup scenario.</span></span> <span data-ttu-id="d220f-131">Si SAP HANA autorisait à effectuer des sauvegardes à partir d’une réplication secondaire, cela offrirait des possibilités supplémentaires en matière de stratégies de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d220f-131">If SAP HANA allowed taking backups from a replication secondary, it would add additional options for backup strategies.</span></span> <span data-ttu-id="d220f-132">D’après une publication dans le Wiki SAP HANA, cela n’est pas possible actuellement :</span><span class="sxs-lookup"><span data-stu-id="d220f-132">Currently it isn't possible according to a post in the SAP HANA Wiki:</span></span>

<span data-ttu-id="d220f-133">_&quot;Est-il est possible d’effectuer des sauvegardes du côté secondaire ?_</span><span class="sxs-lookup"><span data-stu-id="d220f-133">_&quot;Is it possible to take backups on the secondary side?_</span></span>

<span data-ttu-id="d220f-134">_Non, actuellement vous pouvez uniquement effectuer des sauvegardes de données et fichiers journaux du côté principal. Si la sauvegarde de fichier journal automatique est activée, après la prise de contrôle sur le côté secondaire, les sauvegardes de fichiers journaux sont automatiquement écrites ici.&quot;_</span><span class="sxs-lookup"><span data-stu-id="d220f-134">_No, currently you can only take data and log backups on the primary side. If automatic log backup is enabled, after takeover to the secondary side, the log backups will automatically be written there.&quot;_</span></span>

## <a name="sap-resources-for-hana-backup"></a><span data-ttu-id="d220f-135">Ressources SAP pour la sauvegarde HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-135">SAP resources for HANA backup</span></span>

### <a name="sap-hana-backup-documentation"></a><span data-ttu-id="d220f-136">Documentation sur la sauvegarde SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-136">SAP HANA backup documentation</span></span>

- <span data-ttu-id="d220f-137">[Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US) (Introduction à l’administration de HANA SAP)</span><span class="sxs-lookup"><span data-stu-id="d220f-137">[Introduction to SAP HANA Administration](https://help.sap.com/viewer/6b94445c94ae495c83a19646e7c3fd56/2.0.00/en-US)</span></span>
- <span data-ttu-id="d220f-138">[Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Planification de votre stratégie de sauvegarde et de récupération)</span><span class="sxs-lookup"><span data-stu-id="d220f-138">[Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)</span></span>
- <span data-ttu-id="d220f-139">[Schedule HANA Backup using ABAP DBACOCKPIT](http://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html) (Planifier la sauvegarde HANA avec ABAP DBACOCKPIT)</span><span class="sxs-lookup"><span data-stu-id="d220f-139">[Schedule HANA Backup using ABAP DBACOCKPIT](http://www.hanatutorials.com/p/schedule-hana-backup-using-abap.html)</span></span>
- <span data-ttu-id="d220f-140">[Schedule Data Backups (SAP HANA Cockpit)](http://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm) (Planifier des sauvegardes de données (cockpit SAP HANA))</span><span class="sxs-lookup"><span data-stu-id="d220f-140">[Schedule Data Backups (SAP HANA Cockpit)](http://help.sap.com/saphelp_hanaplatform/helpdata/en/6d/385fa14ef64a6bab2c97a3d3e40292/frameset.htm)</span></span>
- <span data-ttu-id="d220f-141">FAQ sur la sauvegarde SAP HANA dans la [note SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148)</span><span class="sxs-lookup"><span data-stu-id="d220f-141">FAQ about SAP HANA backup in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148)</span></span>
- <span data-ttu-id="d220f-142">FAQ sur les captures instantanées de base de données et de stockage SAP HANA dans la [note SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883)</span><span class="sxs-lookup"><span data-stu-id="d220f-142">FAQ about SAP HANA database and storage snapshots in [SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883)</span></span>
- <span data-ttu-id="d220f-143">Systèmes de fichiers en réseau inappropriés pour la sauvegarde et la récupération dans la [note SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529)</span><span class="sxs-lookup"><span data-stu-id="d220f-143">Unsuitable network file systems for backup and recovery in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529)</span></span>

### <a name="why-sap-hana-backup"></a><span data-ttu-id="d220f-144">Pourquoi utiliser la sauvegarde SAP HANA ?</span><span class="sxs-lookup"><span data-stu-id="d220f-144">Why SAP HANA backup?</span></span>

<span data-ttu-id="d220f-145">Le stockage Azure offre dès le départ des performances élevées en termes de disponibilité et de fiabilité (voir [Présentation du stockage Microsoft Azure](../../../storage/common/storage-introduction.md) pour plus d’informations sur le stockage Azure).</span><span class="sxs-lookup"><span data-stu-id="d220f-145">Azure storage offers availability and reliability out of the box (see [Introduction to Microsoft Azure Storage](../../../storage/common/storage-introduction.md) for more information about Azure storage).</span></span>

<span data-ttu-id="d220f-146">Pour la &quot;sauvegarde&quot;, il convient au minimum de s’appuyer sur les SLA Azure en conservant les fichiers journaux et données SAP HANA sur des VHD Azure attachés à la machine virtuelle du serveur SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-146">The minimum for &quot;backup&quot; is to rely on the Azure SLAs, keeping the SAP HANA data and log files on Azure VHDs attached to the SAP HANA server VM.</span></span> <span data-ttu-id="d220f-147">Cette approche couvre les échecs de la machine virtuelle, mais pas les dommages potentiellement occasionnés aux fichiers journaux et données SAP HANA, ni les erreurs logiques comme la suppression accidentelle de données ou de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d220f-147">This approach covers VM failures, but not potential damage to the SAP HANA data and log files, or logical errors like deleting data or files by accident.</span></span> <span data-ttu-id="d220f-148">Les sauvegardes sont également requises pour des raisons juridiques ou de conformité.</span><span class="sxs-lookup"><span data-stu-id="d220f-148">Backups are also required for compliance or legal reasons.</span></span> <span data-ttu-id="d220f-149">En bref, il est toujours nécessaire d’effectuer des sauvegardes SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-149">In short, there is always a need for SAP HANA backups.</span></span>

### <a name="how-to-verify-correctness-of-sap-hana-backup"></a><span data-ttu-id="d220f-150">Comment vérifier qu’une sauvegarde SAP HANA est correcte</span><span class="sxs-lookup"><span data-stu-id="d220f-150">How to verify correctness of SAP HANA backup</span></span>
<span data-ttu-id="d220f-151">Lorsque vous utilisez des captures instantanées de stockage, il est recommandé d’effectuer un test de restauration sur un autre système.</span><span class="sxs-lookup"><span data-stu-id="d220f-151">When using storage snapshots, running a test restore on a different system is recommended.</span></span> <span data-ttu-id="d220f-152">Cette approche permet de s’assurer qu’une sauvegarde est correcte et que les processus internes de sauvegarde et de restauration fonctionnent comme prévu.</span><span class="sxs-lookup"><span data-stu-id="d220f-152">This approach provides a way to ensure that a backup is correct, and internal processes for backup and restore work as expected.</span></span> <span data-ttu-id="d220f-153">S’il s’agit d’un obstacle majeur en local, il est beaucoup plus facile de procéder dans le cloud en fournissant temporairement les ressources nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d220f-153">While this is a significant hurdle on-premises, it is much easier to accomplish in the cloud by providing necessary resources temporarily for this purpose.</span></span>

<span data-ttu-id="d220f-154">Gardez à l’esprit qu’il ne suffit pas d’effectuer une simple restauration et de vérifier si HANA est opérationnel et en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="d220f-154">Keep in mind that doing a simple restore and checking if HANA is up and running is not sufficient.</span></span> <span data-ttu-id="d220f-155">Dans l’idéal, il convient d’exécuter une vérification de cohérence de table pour s’assurer que la base de données restaurée est correcte.</span><span class="sxs-lookup"><span data-stu-id="d220f-155">Ideally, one should run a table consistency check to be sure that the restored database is fine.</span></span> <span data-ttu-id="d220f-156">SAP HANA offre plusieurs types de vérifications de cohérence. Ceux-ci sont décrits dans la [note SAP 1977584](https://launchpad.support.sap.com/#/notes/1977584).</span><span class="sxs-lookup"><span data-stu-id="d220f-156">SAP HANA offers several kinds of consistency checks described in [SAP Note 1977584](https://launchpad.support.sap.com/#/notes/1977584).</span></span>

<span data-ttu-id="d220f-157">Vous trouverez également des informations sur la vérification de cohérence de table sur le site web SAP à la page [Table and Catalog Consistency Checks](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b) (Vérifications de cohérence de table et de catalogue).</span><span class="sxs-lookup"><span data-stu-id="d220f-157">Information about the table consistency check can also be found on the SAP website at [Table and Catalog Consistency Checks](http://help.sap.com/saphelp_hanaplatform/helpdata/en/25/84ec2e324d44529edc8221956359ea/content.htm#loio9357bf52c7324bee9567dca417ad9f8b).</span></span>

<span data-ttu-id="d220f-158">Pour les sauvegardes de fichiers standard, il n’est pas nécessaire d’effectuer un test de restauration.</span><span class="sxs-lookup"><span data-stu-id="d220f-158">For standard file backups, a test restore is not necessary.</span></span> <span data-ttu-id="d220f-159">Deux outils SAP HANA permettent de vérifier la sauvegarde qui peut être utilisée pour la restauration : hdbbackupdiag et hdbbackupcheck.</span><span class="sxs-lookup"><span data-stu-id="d220f-159">There are two SAP HANA tools that help to check which backup can be used for restore: hdbbackupdiag and hdbbackupcheck.</span></span> <span data-ttu-id="d220f-160">Consultez la page [Manually Checking Whether a Recovery is Possible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) (Vérifier manuellement si une récupération est possible) pour plus d’informations sur ces outils.</span><span class="sxs-lookup"><span data-stu-id="d220f-160">See [Manually Checking Whether a Recovery is Possible](https://help.sap.com/saphelp_hanaplatform/helpdata/en/77/522ef1e3cb4d799bab33e0aeb9c93b/content.htm) for more information about these tools.</span></span>

### <a name="pros-and-cons-of-hana-backup-versus-storage-snapshot"></a><span data-ttu-id="d220f-161">Avantages et inconvénients de la sauvegarde HANA par rapport à la capture instantanée de stockage</span><span class="sxs-lookup"><span data-stu-id="d220f-161">Pros and cons of HANA backup versus storage snapshot</span></span>

<span data-ttu-id="d220f-162">SAP ne privilégie pas la sauvegarde HANA par rapport à la capture instantanée de stockage.</span><span class="sxs-lookup"><span data-stu-id="d220f-162">SAP doesn&#39;t give preference to either HANA backup versus storage snapshot.</span></span> <span data-ttu-id="d220f-163">Il répertorie leurs avantages et inconvénients, et chacun peut ainsi déterminer la méthode à utiliser en fonction de la situation et de la technologie de stockage disponible (voir [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Planification de votre stratégie de sauvegarde et de récupération) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-163">It lists their pros and cons, so one can determine which to use depending on the situation and available storage technology (see [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm)).</span></span>

<span data-ttu-id="d220f-164">Sur Azure, tenez compte du fait que la fonctionnalité de capture instantanée d’objets blob Azure ne garantit pas la cohérence du système de fichiers (voir la page [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) (Utilisation des captures instantanées d’objets blob avec PowerShell) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-164">On Azure, be aware of the fact that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency (see [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/)).</span></span> <span data-ttu-id="d220f-165">La section suivante, _Cohérence des données SAP HANA lors de la création de captures instantanées de stockage_, aborde certaines considérations relatives à cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="d220f-165">The next section, _SAP HANA data consistency when taking storage snapshots_, discusses some considerations regarding this feature.</span></span>

<span data-ttu-id="d220f-166">Il faut également comprendre les implications liées à la facturation en cas d’utilisation fréquente de captures instantanées d’objets blob, comme décrit dans l’article : [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges) (Comment les captures instantanées augmentent les frais). Cet aspect n’est pas aussi évident que lors de l’utilisation des disques virtuels Azure.</span><span class="sxs-lookup"><span data-stu-id="d220f-166">In addition, one has to understand the billing implications when working frequently with blob snapshots as described in this article: [Understanding How Snapshots Accrue Charges](/rest/api/storageservices/understanding-how-snapshots-accrue-charges)—it isn&#39;t as obvious as using Azure virtual disks.</span></span>

### <a name="sap-hana-data-consistency-when-taking-storage-snapshots"></a><span data-ttu-id="d220f-167">Cohérence des données SAP HANA lors de la création de captures instantanées de stockage</span><span class="sxs-lookup"><span data-stu-id="d220f-167">SAP HANA data consistency when taking storage snapshots</span></span>

<span data-ttu-id="d220f-168">Dans le cadre de la création de captures instantanées de stockage, la cohérence du système de fichiers et des applications représente un problème complexe.</span><span class="sxs-lookup"><span data-stu-id="d220f-168">File system and application consistency is a complex issue when taking storage snapshots.</span></span> <span data-ttu-id="d220f-169">Pour éviter les problèmes, le plus simple consisterait à arrêter SAP HANA, voire la machine virtuelle entière.</span><span class="sxs-lookup"><span data-stu-id="d220f-169">The easiest way to avoid problems would be to shut down SAP HANA, or maybe even the whole virtual machine.</span></span> <span data-ttu-id="d220f-170">Un arrêt pourrait être effectué avec une démonstration ou un prototype, voire avec un système de développement. Cependant, ce procédé n’est pas envisageable avec un système de production.</span><span class="sxs-lookup"><span data-stu-id="d220f-170">A shutdown might be doable with a demo or prototype, or even a development system, but it is not an option for a production system.</span></span>

<span data-ttu-id="d220f-171">Sur Azure, gardez à l’esprit que la fonctionnalité de capture instantanée d’objets blob Azure ne garantit pas la cohérence du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d220f-171">On Azure, one has to keep in mind that the Azure blob snapshot feature doesn&#39;t guarantee file system consistency.</span></span> <span data-ttu-id="d220f-172">Toutefois, cela fonctionne correctement avec la fonctionnalité de capture instantanée SAP HANA lorsqu’un seul disque virtuel est impliqué.</span><span class="sxs-lookup"><span data-stu-id="d220f-172">It works fine however by using the SAP HANA snapshot feature, as long as there is only a single virtual disk involved.</span></span> <span data-ttu-id="d220f-173">Cependant, même avec un seul disque, des éléments supplémentaires doivent être vérifiés.</span><span class="sxs-lookup"><span data-stu-id="d220f-173">But even with a single disk, additional items have to be checked.</span></span> <span data-ttu-id="d220f-174">La [note SAP 2039883](https://launchpad.support.sap.com/#/notes/2039883) fournit des informations importantes sur les sauvegardes SAP HANA effectuées avec des captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="d220f-174">[SAP Note 2039883](https://launchpad.support.sap.com/#/notes/2039883) has important information about SAP HANA backups via storage snapshots.</span></span> <span data-ttu-id="d220f-175">Par exemple, elle mentionne qu’avec le système de fichiers XFS, il est nécessaire d’exécuter **xfs\_freeze** avant de démarrer une capture instantanée de stockage pour garantir la cohérence (voir la page [xfs\_freeze(8) - Linux man page](https://linux.die.net/man/8/xfs_freeze) pour plus d’informations sur **xfs\_freeze**).</span><span class="sxs-lookup"><span data-stu-id="d220f-175">For example, it mentions that, with the XFS file system, it is necessary to run **xfs\_freeze** before starting a storage snapshot to guarantee consistency (see [xfs\_freeze(8) - Linux man page](https://linux.die.net/man/8/xfs_freeze) for details on **xfs\_freeze**).</span></span>

<span data-ttu-id="d220f-176">Le problème de la cohérence devient encore plus complexe lorsqu’un système de fichiers unique s’étend sur plusieurs disques/volumes,</span><span class="sxs-lookup"><span data-stu-id="d220f-176">The topic of consistency becomes even more challenging in a case where a single file system spans multiple disks/volumes.</span></span> <span data-ttu-id="d220f-177">par exemple, lors de l’utilisation de mdadm ou de LVM et de l’entrelacement.</span><span class="sxs-lookup"><span data-stu-id="d220f-177">For example, by using mdadm or LVM and striping.</span></span> <span data-ttu-id="d220f-178">La note SAP mentionnée plus haut indique ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="d220f-178">The SAP Note mentioned above states:</span></span>

<span data-ttu-id="d220f-179">_&quot;N’oubliez pas que le système de stockage doit garantir la cohérence des E/S lors de la création d’une capture instantanée de stockage par volume de données SAP HANA. Ainsi, la création d’une capture instantanée d’un volume de données spécifique au service SAP HANA doit être une opération atomique.&quot;_</span><span class="sxs-lookup"><span data-stu-id="d220f-179">_&quot;But keep in mind that the storage system has to guarantee I/O consistency while creating a storage snapshot per SAP HANA data volume, i.e. snapshotting of an SAP HANA service-specific data volume must be an atomic operation.&quot;_</span></span>

<span data-ttu-id="d220f-180">En supposant qu’un système de fichiers XFS couvre quatre disques virtuels Azure, les étapes suivantes permettent d’obtenir une capture instantanée cohérente qui représente la zone de données HANA :</span><span class="sxs-lookup"><span data-stu-id="d220f-180">Assuming there is an XFS file system spanning four Azure virtual disks, the following steps provide a consistent snapshot that represents the HANA data area:</span></span>

- <span data-ttu-id="d220f-181">Préparer la capture instantanée HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-181">HANA snapshot prepare</span></span>
- <span data-ttu-id="d220f-182">Geler le système de fichiers (par exemple, à l’aide de **xfs\_freeze**)</span><span class="sxs-lookup"><span data-stu-id="d220f-182">Freeze the file system (for example, use **xfs\_freeze**)</span></span>
- <span data-ttu-id="d220f-183">Créer toutes les captures instantanées d’objets blob nécessaires sur Azure</span><span class="sxs-lookup"><span data-stu-id="d220f-183">Create all necessary blob snapshots on Azure</span></span>
- <span data-ttu-id="d220f-184">Dégeler le système de fichiers</span><span class="sxs-lookup"><span data-stu-id="d220f-184">Unfreeze the file system</span></span>
- <span data-ttu-id="d220f-185">Confirmer la capture instantanée HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-185">Confirm the HANA snapshot</span></span>

<span data-ttu-id="d220f-186">Pour des raisons de sécurité, il est recommandé d’utiliser la procédure ci-dessus dans tous les cas, quel que soit le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d220f-186">Recommendation is to use the procedure above in all cases to be on the safe side, no matter which file system.</span></span> <span data-ttu-id="d220f-187">S’il s’agit d’un seul disque ou d’un entrelacement, il convient d’utiliser mdadm ou LVM sur plusieurs disques.</span><span class="sxs-lookup"><span data-stu-id="d220f-187">Or if it is a single disk or striping, via mdadm or LVM across multiple disks.</span></span>

<span data-ttu-id="d220f-188">Il est important de confirmer la capture instantanée HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-188">It is important to confirm the HANA snapshot.</span></span> <span data-ttu-id="d220f-189">En raison de la &quot;copie pour écriture&quot;, il se peut que SAP HANA ne nécessite pas d’espace disque supplémentaire en mode de préparation de capture instantanée.</span><span class="sxs-lookup"><span data-stu-id="d220f-189">Due to the &quot;Copy-on-Write,&quot; SAP HANA might not require additional disk space while in this snapshot-prepare mode.</span></span> <span data-ttu-id="d220f-190">Par ailleurs, il n’est pas possible de démarrer de nouvelles sauvegardes tant que la capture instantanée SAP HANA n’a pas été confirmée.</span><span class="sxs-lookup"><span data-stu-id="d220f-190">It&#39;s also not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

<span data-ttu-id="d220f-191">Le service Azure Backup utilise des extensions de machine virtuelle Azure pour gérer la cohérence du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d220f-191">Azure Backup service uses Azure VM extensions to take care of the file system consistency.</span></span> <span data-ttu-id="d220f-192">Ces extensions de machine virtuelle ne sont pas disponibles pour une utilisation autonome.</span><span class="sxs-lookup"><span data-stu-id="d220f-192">These VM extensions are not available for standalone usage.</span></span> <span data-ttu-id="d220f-193">Il restera nécessaire de gérer la cohérence de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-193">One still has to manage SAP HANA consistency.</span></span> <span data-ttu-id="d220f-194">Consultez l’article connexe [Sauvegarde SAP HANA sur Azure au niveau fichier](sap-hana-backup-file-level.md) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="d220f-194">See the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) for more information.</span></span>

### <a name="sap-hana-backup-scheduling-strategy"></a><span data-ttu-id="d220f-195">Stratégie de planification de sauvegarde SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-195">SAP HANA backup scheduling strategy</span></span>

<span data-ttu-id="d220f-196">L’article SAP HANA [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) (Planification de votre stratégie de sauvegarde et de récupération) fournit un plan de base pour effectuer les sauvegardes :</span><span class="sxs-lookup"><span data-stu-id="d220f-196">The SAP HANA article [Planning Your Backup and Recovery Strategy](https://help.sap.com/saphelp_hanaplatform/helpdata/en/ef/085cd5949c40b788bba8fd3c65743e/content.htm) states a basic plan to do backups:</span></span>

- <span data-ttu-id="d220f-197">Capture instantanée de stockage (quotidienne)</span><span class="sxs-lookup"><span data-stu-id="d220f-197">Storage snapshot (daily)</span></span>
- <span data-ttu-id="d220f-198">Sauvegarde de données complète dans un fichier ou au format bacint (hebdomadaire)</span><span class="sxs-lookup"><span data-stu-id="d220f-198">Complete data backup using file or bacint format (once a week)</span></span>
- <span data-ttu-id="d220f-199">Sauvegardes de fichiers journaux automatiques</span><span class="sxs-lookup"><span data-stu-id="d220f-199">Automatic log backups</span></span>

<span data-ttu-id="d220f-200">Si vous le souhaitez, vous pouvez procéder sans captures instantanées de stockage. Celles-ci peuvent être remplacées par des sauvegardes HANA différentielles ou incrémentielles (voir [Delta Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm) (Sauvegardes différentielles) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-200">Optionally, one could go completely without storage snapshots; they could be replaced by HANA delta backups, like incremental or differential backups (see [Delta Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm)).</span></span>

<span data-ttu-id="d220f-201">Le guide d’administration HANA fournit un exemple de liste.</span><span class="sxs-lookup"><span data-stu-id="d220f-201">The HANA Administration guide provides an example list.</span></span> <span data-ttu-id="d220f-202">Il suggère de récupérer SAP HANA à un point spécifique dans le temps à l’aide de la séquence de sauvegardes suivante :</span><span class="sxs-lookup"><span data-stu-id="d220f-202">It suggests that one recover SAP HANA to a specific point in time using the following sequence of backups:</span></span>

1. <span data-ttu-id="d220f-203">Sauvegarde de données complète</span><span class="sxs-lookup"><span data-stu-id="d220f-203">Full data backup</span></span>
2. <span data-ttu-id="d220f-204">Sauvegarde différentielle</span><span class="sxs-lookup"><span data-stu-id="d220f-204">Differential backup</span></span>
3. <span data-ttu-id="d220f-205">Sauvegarde incrémentielle 1</span><span class="sxs-lookup"><span data-stu-id="d220f-205">Incremental backup 1</span></span>
4. <span data-ttu-id="d220f-206">Sauvegarde incrémentielle 2</span><span class="sxs-lookup"><span data-stu-id="d220f-206">Incremental backup 2</span></span>
5. <span data-ttu-id="d220f-207">Sauvegardes de fichiers journaux</span><span class="sxs-lookup"><span data-stu-id="d220f-207">Log backups</span></span>

<span data-ttu-id="d220f-208">Il n’est pas possible de fournir une recommandation générale quant à la planification exacte et à la fréquence d’un type de sauvegarde spécifique. Cela dépend beaucoup du client et du nombre de modifications de données se produisant sur le système.</span><span class="sxs-lookup"><span data-stu-id="d220f-208">Regarding an exact schedule as to when and how often a specific backup type should happen, it is not possible to give a general guideline—it is too customer-specific, and depends on how many data changes occur in the system.</span></span> <span data-ttu-id="d220f-209">SAP fournit cependant une recommandation de base pouvant être considérée comme une directive générale. Celle-ci consiste à créer une sauvegarde HANA complète une fois par semaine.</span><span class="sxs-lookup"><span data-stu-id="d220f-209">One basic recommendation from SAP side, which can be seen as general guidance, is to make one full HANA backup once a week.</span></span>
<span data-ttu-id="d220f-210">Pour ce qui concerne les sauvegardes de fichiers journaux, consultez la documentation SAP HANA [Log Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm) (Sauvegardes de fichiers journaux).</span><span class="sxs-lookup"><span data-stu-id="d220f-210">Regarding log backups, see the SAP HANA documentation [Log Backups](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/bb7e33bb571014a03eeabba4e37541/content.htm).</span></span>

<span data-ttu-id="d220f-211">SAP recommande également de nettoyer le catalogue de sauvegarde pour ne pas le laisser croître indéfiniment (voir [Housekeeping for Backup Catalog and Backup Storage](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm) (Nettoyage pour le catalogue et le stockage de sauvegarde) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-211">SAP also recommends doing some housekeeping of the backup catalog to keep it from growing infinitely (see [Housekeeping for Backup Catalog and Backup Storage](http://help.sap.com/saphelp_hanaplatform/helpdata/en/ca/c903c28b0e4301b39814ef41dbf568/content.htm)).</span></span>

### <a name="sap-hana-configuration-files"></a><span data-ttu-id="d220f-212">Fichiers de configuration SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-212">SAP HANA configuration files</span></span>

<span data-ttu-id="d220f-213">Comme indiqué dans le FAQ de la [note SAP 1642148](https://launchpad.support.sap.com/#/notes/1642148), les fichiers de configuration SAP HANA ne sont pas inclus dans une sauvegarde HANA standard.</span><span class="sxs-lookup"><span data-stu-id="d220f-213">As stated in the FAQ in [SAP Note 1642148](https://launchpad.support.sap.com/#/notes/1642148), the SAP HANA configuration files are not part of a standard HANA backup.</span></span> <span data-ttu-id="d220f-214">Ils ne sont pas essentiels à la restauration d’un système.</span><span class="sxs-lookup"><span data-stu-id="d220f-214">They are not essential to restore a system.</span></span> <span data-ttu-id="d220f-215">La configuration HANA peut être modifiée manuellement après la restauration.</span><span class="sxs-lookup"><span data-stu-id="d220f-215">The HANA configuration could be changed manually after the restore.</span></span> <span data-ttu-id="d220f-216">Si vous souhaitez obtenir la même configuration personnalisée pendant le processus de restauration, il est nécessaire de sauvegarder les fichiers de configuration HANA séparément.</span><span class="sxs-lookup"><span data-stu-id="d220f-216">In case one would like to get the same custom configuration during the restore process, it is necessary to back up the HANA configuration files separately.</span></span>

<span data-ttu-id="d220f-217">Si des sauvegardes HANA standard sont effectuées dans un système de fichiers HANA dédié, vous pouvez également copier les fichiers de configuration dans le même système de fichiers de sauvegarde, puis copier l’ensemble dans la destination de stockage finale, comme un Stockage Blob froid.</span><span class="sxs-lookup"><span data-stu-id="d220f-217">If standard HANA backups are going to a dedicated HANA backup file system, one could also copy the configuration files to the same backup filesystem, and then copy everything together to the final storage destination like cool blob storage.</span></span>

### <a name="sap-hana-cockpit"></a><span data-ttu-id="d220f-218">Cockpit SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-218">SAP HANA Cockpit</span></span>

<span data-ttu-id="d220f-219">Le cockpit SAP HANA offre la possibilité de surveiller et gérer SAP HANA via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="d220f-219">SAP HANA Cockpit offers the possibility of monitoring and managing SAP HANA via a browser.</span></span> <span data-ttu-id="d220f-220">Il permet également de gérer les sauvegardes SAP HANA et, par conséquent, peut être utilisé comme alternative à SAP HANA Studio et ABAP DBACOCKPIT (voir [SAP HANA Cockpit](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm) (Cockpit SAP HANA) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-220">It also allows handling of SAP HANA backups, and therefore can be used as an alternative to SAP HANA Studio and ABAP DBACOCKPIT (see [SAP HANA Cockpit](https://help.sap.com/saphelp_hanaplatform/helpdata/en/73/c37822444344f3973e0e976b77958e/content.htm) for more information).</span></span>

![Cette illustration montre l’écran d’administration de base de données du cockpit SAP HANA.](media/sap-hana-backup-guide/image004.png)

<span data-ttu-id="d220f-222">Cette illustration montre l’écran d’administration de base de données du cockpit SAP HANA, avec la vignette de sauvegarde sur la gauche.</span><span class="sxs-lookup"><span data-stu-id="d220f-222">This figure shows the SAP HANA Cockpit Database Administration Screen, and the backup tile on the left.</span></span> <span data-ttu-id="d220f-223">L’affichage de la vignette de sauvegarde requiert des autorisations utilisateur appropriées pour le compte de connexion.</span><span class="sxs-lookup"><span data-stu-id="d220f-223">Seeing the backup tile requires appropriate user permissions for login account.</span></span>

![Les sauvegardes peuvent être surveillées dans le cockpit SAP HANA lors de leur réalisation.](media/sap-hana-backup-guide/image005.png)

<span data-ttu-id="d220f-225">Les sauvegardes peuvent être surveillées dans le cockpit SAP HANA lors de leur réalisation. Toutes les informations de sauvegarde sont disponibles une fois celles-ci terminées.</span><span class="sxs-lookup"><span data-stu-id="d220f-225">Backups can be monitored in SAP HANA Cockpit while they are ongoing and, once it is finished, all the backup details are available.</span></span>

![Exemple utilisant Firefox sur une machine virtuelle Azure SLES 12 avec le bureau Gnome](media/sap-hana-backup-guide/image006.png)

<span data-ttu-id="d220f-227">Les captures d’écran précédentes ont été effectuées à partir d’une machine virtuelle Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="d220f-227">The previous screenshots were made from an Azure Windows VM.</span></span> <span data-ttu-id="d220f-228">Celle-ci illustre l’utilisation de Firefox sur une machine virtuelle Azure SLES 12 avec le bureau Gnome.</span><span class="sxs-lookup"><span data-stu-id="d220f-228">This one is an example using Firefox on an Azure SLES 12 VM with Gnome desktop.</span></span> <span data-ttu-id="d220f-229">Elle montre la possibilité de définir des planifications de sauvegarde SAP HANA dans le cockpit SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-229">It shows the option to define SAP HANA backup schedules in SAP HANA Cockpit.</span></span> <span data-ttu-id="d220f-230">La date et l’heure sont suggérées en tant que préfixes pour les fichiers de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d220f-230">As one can also see, it suggests date/time as a prefix for the backup files.</span></span> <span data-ttu-id="d220f-231">Dans SAP HANA Studio, le préfixe par défaut est &quot;COMPLETE\_DATA\_BACKUP&quot; en cas de sauvegarde de fichiers complète.</span><span class="sxs-lookup"><span data-stu-id="d220f-231">In SAP HANA Studio, the default prefix is &quot;COMPLETE\_DATA\_BACKUP&quot; when doing a full file backup.</span></span> <span data-ttu-id="d220f-232">L’utilisation d’un préfixe unique est recommandée.</span><span class="sxs-lookup"><span data-stu-id="d220f-232">Using a unique prefix is recommended.</span></span>

### <a name="sap-hana-backup-encryption"></a><span data-ttu-id="d220f-233">Chiffrement de sauvegarde SAP HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-233">SAP HANA backup encryption</span></span>

<span data-ttu-id="d220f-234">SAP HANA assure le chiffrement des données et du journal.</span><span class="sxs-lookup"><span data-stu-id="d220f-234">SAP HANA offers encryption of data and log.</span></span> <span data-ttu-id="d220f-235">Si le journal et les données SAP HANA ne sont pas chiffrés, les sauvegardes ne le sont pas non plus.</span><span class="sxs-lookup"><span data-stu-id="d220f-235">If SAP HANA data and log are not encrypted, then the backups are also not encrypted.</span></span> <span data-ttu-id="d220f-236">Il incombe au client d’utiliser une solution tierce pour chiffrer les sauvegardes SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-236">It is up to the customer to use some form of third-party solution to encrypt the SAP HANA backups.</span></span> <span data-ttu-id="d220f-237">Consultez la page [Data and Log Volume Encryption](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) (Chiffrement des volumes de journaux et de données) pour en savoir plus sur le chiffrement SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-237">See [Data and Log Volume Encryption](https://help.sap.com/saphelp_hanaplatform/helpdata/en/dc/01f36fbb5710148b668201a6e95cf2/content.htm) to find out more about SAP HANA encryption.</span></span>

<span data-ttu-id="d220f-238">Sur Microsoft Azure, un client peut utiliser la fonctionnalité de chiffrement de machine virtuelle IaaS pour réaliser le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="d220f-238">On Microsoft Azure, a customer could use the IaaS VM encryption feature to encrypt.</span></span> <span data-ttu-id="d220f-239">Par exemple, il peut utiliser des disques de données dédiés attachés à la machine virtuelle, qui sont exploités pour stocker les sauvegardes SAP HANA, puis effectuer des copies de ces disques.</span><span class="sxs-lookup"><span data-stu-id="d220f-239">For example, one could use dedicated data disks attached to the VM, which are used to store SAP HANA backups, then make copies of these disks.</span></span>

<span data-ttu-id="d220f-240">Le service Azure Backup peut gérer des machines virtuelles/disques chiffrés (voir [Guide pratique de sauvegarde et restauration des machines virtuelles chiffrées avec Azure Backup](../../../backup/backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="d220f-240">Azure Backup service can handle encrypted VMs/disks (see [How to back up and restore encrypted virtual machines with Azure Backup](../../../backup/backup-azure-vms-encryption.md)).</span></span>

<span data-ttu-id="d220f-241">Une autre option consiste à mettre à jour la machine virtuelle HANA SAP et ses disques sans chiffrement et à stocker les fichiers de sauvegarde SAP HANA dans un compte de stockage pour lequel le chiffrement a été activé (voir [Azure Storage Service Encryption pour les données au repos](../../../storage/common/storage-service-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="d220f-241">Another option would be to maintain the SAP HANA VM and its disks without encryption, and store the SAP HANA backup files in a storage account for which encryption was enabled (see [Azure Storage Service Encryption for Data at Rest](../../../storage/common/storage-service-encryption.md)).</span></span>

## <a name="test-setup"></a><span data-ttu-id="d220f-242">Configuration des tests</span><span class="sxs-lookup"><span data-stu-id="d220f-242">Test setup</span></span>

### <a name="test-virtual-machine-on-azure"></a><span data-ttu-id="d220f-243">Machine virtuelle de test sur Azure</span><span class="sxs-lookup"><span data-stu-id="d220f-243">Test Virtual Machine on Azure</span></span>

<span data-ttu-id="d220f-244">Une installation SAP HANA dans une machine virtuelle Azure GS5 a été utilisée pour les tests de sauvegarde/restauration suivants.</span><span class="sxs-lookup"><span data-stu-id="d220f-244">An SAP HANA installation in an Azure GS5 VM was used for the following backup/restore tests.</span></span>

![Cette illustration montre une partie de la vue d’ensemble du Portail Azure pour la machine virtuelle de test HANA.](media/sap-hana-backup-guide/image007.png)

<span data-ttu-id="d220f-246">Cette illustration montre une partie de la vue d’ensemble du Portail Azure pour la machine virtuelle de test HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-246">This figure shows part of the Azure portal overview for the HANA test VM.</span></span>

### <a name="test-backup-size"></a><span data-ttu-id="d220f-247">Taille de la sauvegarde de test</span><span class="sxs-lookup"><span data-stu-id="d220f-247">Test backup size</span></span>

![Cette illustration est une capture de la console de sauvegarde de HANA Studio. Elle montre la taille du fichier de sauvegarde de 229 Go pour le serveur d’indexation HANA.](media/sap-hana-backup-guide/image008.png)

<span data-ttu-id="d220f-249">Une table fictive a été remplie de façon à obtenir une taille totale de sauvegarde de données de plus de 200 Go et ainsi traiter des données de performance réalistes.</span><span class="sxs-lookup"><span data-stu-id="d220f-249">A dummy table was filled up with data to get a total data backup size of over 200 GB to derive realistic performance data.</span></span> <span data-ttu-id="d220f-250">Cette illustration est une capture de la console de sauvegarde de HANA Studio. Elle montre la taille du fichier de sauvegarde de 229 Go pour le serveur d’indexation HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-250">The figure was taken from the backup console in HANA Studio and shows the backup file size of 229 GB for the HANA index server.</span></span> <span data-ttu-id="d220f-251">Pour les tests, le préfixe de sauvegarde par défaut « COMPLETE_DATA_BACKUP » dans SAP HANA Studio a été utilisé.</span><span class="sxs-lookup"><span data-stu-id="d220f-251">For the tests, the default backup prefix "COMPLETE_DATA_BACKUP" in SAP HANA Studio was used.</span></span> <span data-ttu-id="d220f-252">Dans des systèmes de production réels, un préfixe plus utile doit être défini.</span><span class="sxs-lookup"><span data-stu-id="d220f-252">In real production systems, a more useful prefix should be defined.</span></span> <span data-ttu-id="d220f-253">Le cockpit SAP HANA suggère la date et l’heure.</span><span class="sxs-lookup"><span data-stu-id="d220f-253">SAP HANA Cockpit suggests date/time.</span></span>

### <a name="test-tool-to-copy-files-directly-to-azure-storage"></a><span data-ttu-id="d220f-254">Outil de test pour copier les fichiers directement dans le stockage Azure</span><span class="sxs-lookup"><span data-stu-id="d220f-254">Test tool to copy files directly to Azure storage</span></span>

<span data-ttu-id="d220f-255">L’outil blobxfer a été utilisé pour transférer des fichiers de sauvegarde SAP HANA directement dans le Stockage Blob Azure ou vers des partages de fichiers Azure. En effet, il prend en charge les deux cibles et peut être facilement intégré à des scripts d’automatisation grâce à son interface de ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="d220f-255">To transfer SAP HANA backup files directly to Azure blob storage, or Azure file shares, the blobxfer tool was used because it supports both targets and it can be easily integrated into automation scripts due to its command-line interface.</span></span> <span data-ttu-id="d220f-256">L’outil blobxfer est disponible sur [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="d220f-256">The blobxfer tool is available on [GitHub](https://github.com/Azure/blobxfer).</span></span>

### <a name="test-backup-size-estimation"></a><span data-ttu-id="d220f-257">Estimation de la taille de la sauvegarde de test</span><span class="sxs-lookup"><span data-stu-id="d220f-257">Test backup size estimation</span></span>

<span data-ttu-id="d220f-258">Il est important d’estimer la taille de la sauvegarde de SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-258">It is important to estimate the backup size of SAP HANA.</span></span> <span data-ttu-id="d220f-259">En raison du parallélisme lors d’une copie de fichiers, cette estimation permet d’améliorer les performances en définissant la taille maximale des fichiers de sauvegarde pour un certain nombre de fichiers de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d220f-259">This estimate helps to improve performance by defining the max backup file size for a number of backup files, due to parallelism during a file copy.</span></span> <span data-ttu-id="d220f-260">(Ces aspects particuliers sont expliqués plus loin dans cet article.) Il convient également de décider si la sauvegarde doit être complète ou si elle doit être différentielle ou incrémentielle.</span><span class="sxs-lookup"><span data-stu-id="d220f-260">(Those details are explained later in this article.) One must also decide whether to do a full backup or a delta backup (incremental or differential).</span></span>

<span data-ttu-id="d220f-261">Heureusement, il existe une instruction SQL simple qui estime la taille des fichiers de sauvegarde : **select \* from M\_BACKUP\_SIZE\_ESTIMATIONS** (voir [Estimate the Space Needed in the File System for a Data Backup](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm) (Estimer l’espace requis dans le système de fichiers pour une sauvegarde de données) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="d220f-261">Fortunately, there is a simple SQL statement that estimates the size of the backup files: **select \* from M\_BACKUP\_SIZE\_ESTIMATIONS** (see [Estimate the Space Needed in the File System for a Data Backup](https://help.sap.com/saphelp_hanaplatform/helpdata/en/7d/46337b7a9c4c708d965b65bc0f343c/content.htm)).</span></span>

![La sortie de cette instruction SQL correspond de façon quasiment identique à la taille réelle de la sauvegarde de données complète sur disque.](media/sap-hana-backup-guide/image009.png)

<span data-ttu-id="d220f-263">Pour le système de test, la sortie de cette instruction SQL correspond de façon quasiment identique à la taille réelle de la sauvegarde de données complète sur disque.</span><span class="sxs-lookup"><span data-stu-id="d220f-263">For the test system, the output of this SQL statement matches almost exactly the real size of the full data backup on disk.</span></span>

### <a name="test-hana-backup-file-size"></a><span data-ttu-id="d220f-264">Taille du fichier de la sauvegarde de test HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-264">Test HANA backup file size</span></span>

![La console de sauvegarde HANA Studio permet de limiter la taille maximale des fichiers de sauvegarde HANA.](media/sap-hana-backup-guide/image010.png)

<span data-ttu-id="d220f-266">La console de sauvegarde HANA Studio permet de limiter la taille maximale des fichiers de sauvegarde HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-266">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="d220f-267">Dans l’exemple d’environnement, cette fonctionnalité permet d’obtenir plusieurs fichiers de sauvegarde de taille inférieure au lieu d’un fichier de sauvegarde unique de 230 Go.</span><span class="sxs-lookup"><span data-stu-id="d220f-267">In the sample environment, that feature makes it possible to get multiple smaller backup files instead of one 230-GB backup file.</span></span> <span data-ttu-id="d220f-268">Cette taille de fichier inférieure a un impact significatif sur les performances (consultez l’article connexe [Sauvegarde SAP HANA sur Azure au niveau fichier](sap-hana-backup-file-level.md)).</span><span class="sxs-lookup"><span data-stu-id="d220f-268">Smaller file size has a significant impact on performance (see the related article [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md)).</span></span>

## <a name="summary"></a><span data-ttu-id="d220f-269">Résumé</span><span class="sxs-lookup"><span data-stu-id="d220f-269">Summary</span></span>

<span data-ttu-id="d220f-270">Les tableaux suivants s’appuient sur les résultats de test pour présenter les avantages et inconvénients des solutions permettant de sauvegarder une base de données SAP HANA s’exécutant sur des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="d220f-270">Based on the test results the following tables show pros and cons of solutions to back up an SAP HANA database running on Azure virtual machines.</span></span>

<span data-ttu-id="d220f-271">**Sauvegarder SAP HANA sur le système de fichiers, puis copier les fichiers de sauvegarde dans la destination de sauvegarde finale**</span><span class="sxs-lookup"><span data-stu-id="d220f-271">**Back up SAP HANA to the file system and copy backup files afterwards to the final backup destination**</span></span>

|<span data-ttu-id="d220f-272">Solution</span><span class="sxs-lookup"><span data-stu-id="d220f-272">Solution</span></span>                                           |<span data-ttu-id="d220f-273">Avantages</span><span class="sxs-lookup"><span data-stu-id="d220f-273">Pros</span></span>                                 |<span data-ttu-id="d220f-274">Inconvénients</span><span class="sxs-lookup"><span data-stu-id="d220f-274">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="d220f-275">Conservation des sauvegardes HANA sur des disques de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="d220f-275">Keep HANA backups on VM disks</span></span>                      |<span data-ttu-id="d220f-276">Aucun effort de gestion supplémentaire</span><span class="sxs-lookup"><span data-stu-id="d220f-276">No additional management efforts</span></span>     |<span data-ttu-id="d220f-277">Occupation d’espace sur le disque de machine virtuelle local</span><span class="sxs-lookup"><span data-stu-id="d220f-277">Eats up local VM disk space</span></span>           |
|<span data-ttu-id="d220f-278">Outil blobxfer pour copier les fichiers de sauvegarde dans le Stockage Blob</span><span class="sxs-lookup"><span data-stu-id="d220f-278">Blobxfer tool to copy backup files to blob storage</span></span> |<span data-ttu-id="d220f-279">Parallélisme pour copier plusieurs fichiers ; possibilité d’utiliser le Stockage Blob froid</span><span class="sxs-lookup"><span data-stu-id="d220f-279">Parallelism to copy multiple files, choice to use cool blob storage</span></span> | <span data-ttu-id="d220f-280">Maintenance de l’outil supplémentaire et scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="d220f-280">Additional tool maintenance and custom scripting</span></span> | 
|<span data-ttu-id="d220f-281">Copie d’objets blob avec Powershell ou l’interface CLI</span><span class="sxs-lookup"><span data-stu-id="d220f-281">Blob copy via Powershell or CLI</span></span>                    |<span data-ttu-id="d220f-282">Aucun outil supplémentaire nécessaire ; possibilité d’utiliser Azure Powershell ou l’interface CLI</span><span class="sxs-lookup"><span data-stu-id="d220f-282">No additional tool necessary, can be accomplished via Azure Powershell or CLI</span></span> |<span data-ttu-id="d220f-283">Processus manuel : le client doit gérer les scripts et les objets blob copiés pour la restauration</span><span class="sxs-lookup"><span data-stu-id="d220f-283">manual process, customer has to take care of scripting and management of copied blobs for restore</span></span>|
|<span data-ttu-id="d220f-284">Copie vers un partage NFS</span><span class="sxs-lookup"><span data-stu-id="d220f-284">Copy to NFS share</span></span>                                  |<span data-ttu-id="d220f-285">Post-traitement des fichiers de sauvegarde sur une autre machine virtuelle sans impact sur le serveur HANA</span><span class="sxs-lookup"><span data-stu-id="d220f-285">Post-processing of backup files on other VM without impact on the HANA server</span></span>|<span data-ttu-id="d220f-286">Lenteur du processus de copie</span><span class="sxs-lookup"><span data-stu-id="d220f-286">Slow copy process</span></span>|
|<span data-ttu-id="d220f-287">Copie avec blobxfer vers le service Azure File</span><span class="sxs-lookup"><span data-stu-id="d220f-287">Blobxfer copy to Azure File Service</span></span>                |<span data-ttu-id="d220f-288">Pas d’occupation d’espace sur les disques de machine virtuelle locaux</span><span class="sxs-lookup"><span data-stu-id="d220f-288">Doesn't eat up space on local VM disks</span></span>|<span data-ttu-id="d220f-289">Pas de prise en charge de l’écriture directe par la sauvegarde HANA ; restriction de la taille du partage de fichiers (actuellement 5 To)</span><span class="sxs-lookup"><span data-stu-id="d220f-289">No direct write support by HANA backup, size restriction of file share currently at 5 TB</span></span>|
|<span data-ttu-id="d220f-290">Agent Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d220f-290">Azure Backup Agent</span></span>                                 | <span data-ttu-id="d220f-291">Serait la solution privilégiée</span><span class="sxs-lookup"><span data-stu-id="d220f-291">Would be preferred solution</span></span>         | <span data-ttu-id="d220f-292">Actuellement non disponible sur Linux</span><span class="sxs-lookup"><span data-stu-id="d220f-292">Currently not available on Linux</span></span>    |



<span data-ttu-id="d220f-293">**Sauvegarde de SAP HANA à partir de captures instantanées de stockage**</span><span class="sxs-lookup"><span data-stu-id="d220f-293">**Backup SAP HANA based on storage snapshots**</span></span>

|<span data-ttu-id="d220f-294">Solution</span><span class="sxs-lookup"><span data-stu-id="d220f-294">Solution</span></span>                                           |<span data-ttu-id="d220f-295">Avantages</span><span class="sxs-lookup"><span data-stu-id="d220f-295">Pros</span></span>                                 |<span data-ttu-id="d220f-296">Inconvénients</span><span class="sxs-lookup"><span data-stu-id="d220f-296">Cons</span></span>                                  |
|---------------------------------------------------|-------------------------------------|--------------------------------------|
|<span data-ttu-id="d220f-297">Service Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d220f-297">Azure Backup Service</span></span>                               | <span data-ttu-id="d220f-298">Possibilité d’effectuer une sauvegarde de machine virtuelle à partir de captures instantanées d’objets blob</span><span class="sxs-lookup"><span data-stu-id="d220f-298">Allows VM backup based on blob snapshots</span></span> | <span data-ttu-id="d220f-299">Lorsque vous n’utilisez ne pas la restauration au niveau fichier, cette solution requiert la création d’une machine virtuelle pour le processus de restauration, ce qui nécessite une nouvelle clé de licence SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="d220f-299">When not using file level restore, it requires the creation of a new VM for the restore process, which then implies the need of a new SAP HANA license key</span></span>|
|<span data-ttu-id="d220f-300">Captures instantanées d’objets blob manuelles</span><span class="sxs-lookup"><span data-stu-id="d220f-300">Manual blob snapshots</span></span>                              | <span data-ttu-id="d220f-301">Flexibilité pour créer et restaurer des disques de machine virtuelle spécifiques sans modifier l’ID de machine virtuelle unique</span><span class="sxs-lookup"><span data-stu-id="d220f-301">Flexibility to create and restore specific VM disks without changing the unique VM ID</span></span>|<span data-ttu-id="d220f-302">Processus entièrement manuel qui doit être effectué par le client</span><span class="sxs-lookup"><span data-stu-id="d220f-302">All manual work, which has to be done by the customer</span></span>|

## <a name="next-steps"></a><span data-ttu-id="d220f-303">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="d220f-303">Next steps</span></span>
* <span data-ttu-id="d220f-304">L’article [Sauvegarde SAP HANA sur Azure au niveau fichier](sap-hana-backup-file-level.md) décrit l’option de sauvegarde basée sur des fichiers.</span><span class="sxs-lookup"><span data-stu-id="d220f-304">[SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) describes the file-based backup option.</span></span>
* <span data-ttu-id="d220f-305">L’article [Sauvegarde SAP HANA à partir de captures instantanées de stockage](sap-hana-backup-storage-snapshots.md) décrit l’option de sauvegarde à partir de captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="d220f-305">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="d220f-306">Pour savoir comment établir une haute disponibilité et planifier la récupération d’urgence de SAP HANA sur Azure (grandes instances), consultez [Haute disponibilité et récupération d’urgence de SAP HANA (grandes instances) sur Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="d220f-306">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
