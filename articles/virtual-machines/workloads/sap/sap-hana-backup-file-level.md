---
title: Sauvegarde SAP HANA sur Azure au niveau fichier | Microsoft Docs
description: "Il existe deux grandes méthodes permettant d’effectuer des sauvegardes SAP HANA sur des machines virtuelles Azure. Cet article aborde la sauvegarde SAP HANA sur Azure au niveau fichier."
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="416cb-103">Sauvegarde SAP HANA sur Azure au niveau fichier</span><span class="sxs-lookup"><span data-stu-id="416cb-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="416cb-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="416cb-104">Introduction</span></span>

<span data-ttu-id="416cb-105">Ce document fait partie d’une série d’articles connexes en trois parties dédiés à la sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="416cb-106">L’article [Guide de sauvegarde pour SAP HANA sur les machines virtuelles Azure](./sap-hana-backup-guide.md) fournit une vue d’ensemble et des informations sur la mise en route, et l’article [Sauvegarde SAP HANA à partir de captures instantanées de stockage](./sap-hana-backup-storage-snapshots.md) couvre l’option de sauvegarde à partir de captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="416cb-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="416cb-107">En étudiant les tailles de machine virtuelle Azure, vous pouvez voir qu’une machine virtuelle GS5 permet d’associer 64 disques de données.</span><span class="sxs-lookup"><span data-stu-id="416cb-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="416cb-108">Pour les grands systèmes SAP HANA, un nombre important de disques peut déjà être utilisé pour les données et les fichiers journaux, éventuellement en association avec un RAID logiciel pour un débit d’E/S de disque optimal.</span><span class="sxs-lookup"><span data-stu-id="416cb-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="416cb-109">Dans ce cas, la question est de savoir où stocker les fichiers de sauvegarde SAP HANA, qui risqueraient de saturer les disques de données attachés au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="416cb-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="416cb-110">Pour consulter les tableaux des tailles de machine virtuelle Azure, voir [Tailles des machines virtuelles Linux dans Azure](../../linux/sizes.md).</span><span class="sxs-lookup"><span data-stu-id="416cb-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="416cb-111">Aucune intégration de sauvegarde SAP HANA n’est disponible avec le service Azure Backup pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="416cb-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="416cb-112">La méthode standard pour gérer la sauvegarde/restauration au niveau fichier est d’utiliser une sauvegarde basée sur les fichiers via SAP HANA Studio ou via les instructions SQL SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="416cb-113">Pour plus d’informations, voir [SQL SAP HANA et référence des vues système](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf).</span><span class="sxs-lookup"><span data-stu-id="416cb-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![Cette illustration montre la boîte de dialogue de l’élément du menu de sauvegarde dans SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="416cb-115">Cette illustration montre la boîte de dialogue de l’élément du menu de sauvegarde dans SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="416cb-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="416cb-116">Lorsque vous choisissez le type &quot;fichier&quot;, vous devez indiquer le chemin d’accès de l’emplacement dans le système de fichiers où SAP HANA inscrit les fichiers de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="416cb-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="416cb-117">La restauration fonctionne de la même façon.</span><span class="sxs-lookup"><span data-stu-id="416cb-117">Restore works the same way.</span></span>

<span data-ttu-id="416cb-118">Bien que ce choix semble simple et direct, certains points doivent être pris en compte.</span><span class="sxs-lookup"><span data-stu-id="416cb-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="416cb-119">Comme indiqué précédemment, les machines virtuelles Azure ont une limite en termes de nombre de disques de données qui peuvent être liés.</span><span class="sxs-lookup"><span data-stu-id="416cb-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="416cb-120">Les systèmes de fichiers de la machine virtuelle ne disposent peut-être pas de la capacité nécessaire pour stocker les fichiers de sauvegarde SAP HANA, en fonction de la taille de la base de données et des contraintes de débit du disque. Cela peut nécessiter que le RAID logiciel utilise un système d’entrelacement de plusieurs disques de données.</span><span class="sxs-lookup"><span data-stu-id="416cb-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="416cb-121">Plus loin dans cet article, nous aborderons différentes options permettant de déplacer ces fichiers de sauvegarde et de gérer les restrictions concernant la taille des fichiers et les performances lors du traitement de plusieurs téraoctets de données.</span><span class="sxs-lookup"><span data-stu-id="416cb-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="416cb-122">Une autre possibilité, qui offre davantage de liberté en ce qui concerne la capacité totale, est le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="416cb-123">Bien que les objets blob soient également limités à 1 To, la capacité totale d’un conteneur d’objets blob unique est actuellement de 500 To.</span><span class="sxs-lookup"><span data-stu-id="416cb-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="416cb-124">En outre, cela offre également la possibilité aux clients de sélectionner ce que l’on appelle le stockage Blob &quot;froid&quot;, qui représente un avantage en termes de coût.</span><span class="sxs-lookup"><span data-stu-id="416cb-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="416cb-125">Pour plus d’informations sur le stockage Blob froid, voir [Stockage Blob Azure : niveaux de stockage chauds et froids](../../../storage/blobs/storage-blob-storage-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="416cb-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="416cb-126">Pour plus de sécurité, utilisez un compte de stockage géo-répliqué pour stocker les sauvegardes SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="416cb-127">Pour plus d’informations sur la réplication des comptes de stockage, voir [Réplication Azure Storage](../../../storage/common/storage-redundancy.md).</span><span class="sxs-lookup"><span data-stu-id="416cb-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="416cb-128">Vous pouvez placer des disques durs virtuels dédiés aux sauvegardes SAP HANA dans un compte de stockage de sauvegarde dédié géo-répliqué.</span><span class="sxs-lookup"><span data-stu-id="416cb-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="416cb-129">Vous pouvez également copier les disques durs virtuels sur lesquels sont enregistrées les sauvegardes SAP HANA vers un compte de stockage géo-répliqué, ou vers un compte de stockage qui se trouve dans une autre région.</span><span class="sxs-lookup"><span data-stu-id="416cb-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="416cb-130">Agent Azure Backup</span><span class="sxs-lookup"><span data-stu-id="416cb-130">Azure backup agent</span></span>

<span data-ttu-id="416cb-131">Azure Backup permet non seulement de sauvegarder les machines virtuelles dans leur intégralité, mais également les fichiers et répertoires via l’agent de sauvegarde, qui doit être installé sur le système d’exploitation invité.</span><span class="sxs-lookup"><span data-stu-id="416cb-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="416cb-132">Mais depuis décembre 2016, cet agent est uniquement pris en charge sous Windows (voir [Sauvegarder un client Windows ou un serveur Windows dans Azure à l’aide du modèle de déploiement Resource Manager](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="416cb-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="416cb-133">Une autre solution consiste à copier les fichiers de sauvegarde SAP HANA sur une machine virtuelle Windows dans Azure (par exemple, via le partage SAMBA) et à utiliser ensuite l’agent Azure Backup à partir de là.</span><span class="sxs-lookup"><span data-stu-id="416cb-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="416cb-134">Bien que ce soit techniquement possible, cela augmenterait la complexité et ralentirait la sauvegarde ou la restauration en raison de la copie entre Linux et la machine virtuelle Windows.</span><span class="sxs-lookup"><span data-stu-id="416cb-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="416cb-135">Il n’est donc pas recommandé d’opter pour cette approche.</span><span class="sxs-lookup"><span data-stu-id="416cb-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="416cb-136">Détails de l’utilitaire blobxfer Azure</span><span class="sxs-lookup"><span data-stu-id="416cb-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="416cb-137">Pour stocker les répertoires et les fichiers sur le stockage Azure, vous pouvez utiliser l’interface de ligne de commande ou PowerShell, ou encore développer un outil à l’aide d’un des [kits de développement logiciel (SDK) Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="416cb-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="416cb-138">Il existe également un utilitaire prêt à l’emploi, AzCopy, qui permet de copier des données vers le stockage Azure, mais il est uniquement compatible avec Windows (voir [Transfert de données avec l’utilitaire de ligne de commande AzCopy](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="416cb-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="416cb-139">Par conséquent, blobxfer a été utilisé pour copier les fichiers de sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="416cb-140">Il s’agit d’un outil Open Source utilisé par de nombreux clients dans leur environnement de production. Il est disponible sur [GitHub](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="416cb-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="416cb-141">Cet outil permet de copier des données directement sur le stockage Blob Azure ou sur le système de partage de fichiers Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="416cb-142">Il inclut également de nombreuses fonctionnalités utiles, telles que le code de hachage md5 ou le parallélisme automatique lors de la copie d’un répertoire contenant plusieurs fichiers.</span><span class="sxs-lookup"><span data-stu-id="416cb-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="416cb-143">Performances de sauvegarde SAP HANA</span><span class="sxs-lookup"><span data-stu-id="416cb-143">SAP HANA backup performance</span></span>

![Cette capture d’écran provient de la console de sauvegarde SAP HANA dans SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="416cb-145">Cette capture d’écran provient de la console de sauvegarde SAP HANA dans SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="416cb-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="416cb-146">Environ 42 minutes ont été nécessaires pour effectuer la sauvegarde de 230 Go sur un seul disque de stockage Azure standard attaché à la machine virtuelle HANA à l’aide du système de fichiers XFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![Cette capture d’écran provient de YaST sur la machine virtuelle de test SAP HANA](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="416cb-148">Cette capture d’écran provient de YaST sur la machine virtuelle de test SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="416cb-149">Vous pouvez voir le disque de 1 To utilisé pour la sauvegarde SAP HANA, comme indiqué précédemment.</span><span class="sxs-lookup"><span data-stu-id="416cb-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="416cb-150">Il a fallu environ 42 minutes pour sauvegarder 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="416cb-151">En outre, cinq disques de 200 Go ont été liés et le RAID logiciel md0 a été créé, avec un entrelacement sur ces cinq disques de données Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![Répétition de la même sauvegarde sur le RAID logiciel avec entrelacement sur cinq disques de données de stockage Azure standard liés](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="416cb-153">La répétition de la même sauvegarde sur le RAID logiciel avec entrelacement sur cinq disques de données de stockage Azure standard liés a fait passer le temps nécessaire à la sauvegarde de 42 minutes à 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="416cb-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="416cb-154">Les disques ont été liés sans mise en cache sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="416cb-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="416cb-155">L’importance du débit d’écriture sur le disque en matière de temps de sauvegarde est donc évidente.</span><span class="sxs-lookup"><span data-stu-id="416cb-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="416cb-156">Vous pouvez ensuite passer au stockage Azure Premium afin d’accélérer encore plus le processus, pour des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="416cb-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="416cb-157">En général, le stockage Azure Premium doit être utilisé pour les systèmes de production.</span><span class="sxs-lookup"><span data-stu-id="416cb-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="416cb-158">Copier les fichiers de sauvegarde SAP HANA vers le stockage Blob Azure</span><span class="sxs-lookup"><span data-stu-id="416cb-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="416cb-159">À compter de décembre 2016, la meilleure option pour stocker rapidement les fichiers de sauvegarde SAP HANA est le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="416cb-160">Un conteneur d’objets blob unique a une limite de 500 To, suffisante pour la plupart des systèmes SAP HANA s’exécutant sur une machine virtuelle GS5 dans Azure, afin de conserver les sauvegardes SAP HANA nécessaires.</span><span class="sxs-lookup"><span data-stu-id="416cb-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="416cb-161">Les clients ont le choix entre le stockage Blob &quot;chaud&quot; et &quot;froid&quot; (voir [Stockage Blob Azure : niveaux de stockage chauds et froids](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="416cb-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="416cb-162">Grâce à l’outil blobxfer, il est facile de copier les fichiers de sauvegarde SAP HANA directement dans le stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![Vous pouvez voir ici les fichiers d’une sauvegarde de fichiers SAP HANA complète](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="416cb-164">Vous pouvez voir ici les fichiers d’une sauvegarde de fichiers SAP HANA complète.</span><span class="sxs-lookup"><span data-stu-id="416cb-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="416cb-165">Il existe quatre fichiers, dont le plus gros fait environ 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![Il a fallu environ 3 000 secondes pour copier les 230 Go dans un conteneur d’objets blob du compte de stockage Azure standard](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="416cb-167">En n’utilisant pas le code de hachage md5 lors du premier test, il a fallu environ 3 000 secondes pour copier les 230 Go dans un conteneur d’objets blob du compte de stockage Azure standard.</span><span class="sxs-lookup"><span data-stu-id="416cb-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![Sur cette capture d’écran, vous pouvez voir son aspect sur le portail Azure](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="416cb-169">Sur cette capture d’écran, vous pouvez voir son aspect sur le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="416cb-170">Un conteneur d’objets blob nommé &quot;sap hana-backups&quot; a été créé et inclut les quatre objets blob, qui correspondent aux fichiers de sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="416cb-171">L’un d’eux fait environ 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="416cb-172">La console de sauvegarde HANA Studio permet de limiter la taille de fichier maximale des fichiers de sauvegarde HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="416cb-173">Dans l’environnement exemple, elle a amélioré les performances en permettant d’avoir plusieurs fichiers de sauvegarde plus petits, au lieu d’un gros fichier de 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![La définition de la limite de taille de fichier de sauvegarde côté HANA n’améliore pas le temps de sauvegarde](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="416cb-175">La définition de la limite de taille de fichier de sauvegarde côté HANA n’améliore pas le temps de sauvegarde, car les fichiers sont écrits de manière séquentielle, comme indiqué sur cette figure.</span><span class="sxs-lookup"><span data-stu-id="416cb-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="416cb-176">La limite de taille de fichier a été définie sur 60 Go, donc la sauvegarde a créé quatre fichiers de données volumineux au lieu d’un seul fichier de 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![Pour tester le parallélisme de l’outil blobxfer, la taille de fichier maximale pour les sauvegardes HANA a ensuite été définie sur 15 Go](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="416cb-178">Pour tester le parallélisme de l’outil blobxfer, la taille de fichier maximale pour les sauvegardes HANA a ensuite été définie sur 15 Go, ce qui a engendré la création de 19 fichiers de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="416cb-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="416cb-179">Cette configuration a fait passer le temps nécessaire pour que blobxfer copie les 230 Go sur le stockage Blob Azure de 3 000 secondes à 875 secondes.</span><span class="sxs-lookup"><span data-stu-id="416cb-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="416cb-180">Ce résultat est dû à la limite de 60 Mo/s pour l’écriture d’un objet blob Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="416cb-181">Le parallélisme via plusieurs objets blob élimine le goulot d’étranglement, mais présente un inconvénient : l’augmentation des performances de l’outil blobxfer pour copier tous ces fichiers de sauvegarde HANA vers le stockage Blob Azure implique une charge plus importante sur la machine virtuelle HANA et sur le réseau.</span><span class="sxs-lookup"><span data-stu-id="416cb-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="416cb-182">Le fonctionnement du système HANA s’en trouve affecté.</span><span class="sxs-lookup"><span data-stu-id="416cb-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="416cb-183">Copie blob des disques de données Azure dédiés dans le RAID logiciel de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="416cb-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="416cb-184">Contrairement à la sauvegarde manuelle de disque de données de machine virtuelle, cette approche ne nécessite pas de sauvegarder tous les disques de données sur une machine virtuelle pour enregistrer l’installation SAP dans son ensemble, y compris les données HANA, les fichiers journaux HANA et les fichiers de configuration.</span><span class="sxs-lookup"><span data-stu-id="416cb-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="416cb-185">Au lieu de cela, l’idée est de disposer de RAID logiciels dédiés avec entrelacement de plusieurs disques durs virtuels de données Azure pour stocker une sauvegarde de fichiers SAP HANA complète.</span><span class="sxs-lookup"><span data-stu-id="416cb-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="416cb-186">Il suffit alors de copier uniquement ces disques, qui contiennent la sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="416cb-187">Ils pourraient facilement être conservés dans un compte de stockage de sauvegarde HANA dédié, ou attachés à une &quot;machine virtuelle de gestion de sauvegarde&quot; dédiée pour traitement ultérieur.</span><span class="sxs-lookup"><span data-stu-id="416cb-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![Tous les disques durs virtuels impliqués ont été copiés à l’aide de la commande PowerShell **start-azurestorageblobcopy**](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="416cb-189">Une fois la sauvegarde du RAID logiciel local effectuée, tous les disques durs virtuels impliqués ont été copiés à l’aide de la commande PowerShell **start-azurestorageblobcopy** (voir [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="416cb-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="416cb-190">Dans la mesure où cela affecte uniquement le système de fichiers dédié à la conservation des fichiers de sauvegarde, il n’existe aucun problème de cohérence des fichiers journaux ou des données SAP HANA sur le disque.</span><span class="sxs-lookup"><span data-stu-id="416cb-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="416cb-191">L’avantage de cette commande est qu’elle fonctionne lorsque la machine virtuelle est en ligne.</span><span class="sxs-lookup"><span data-stu-id="416cb-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="416cb-192">Pour être certain qu’aucun processus n’écrit dans le groupe d’entrelacements de sauvegarde, veillez à le démonter avant la copie d’objets blob, puis à le remonter.</span><span class="sxs-lookup"><span data-stu-id="416cb-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="416cb-193">Vous pouvez également utiliser une méthode appropriée pour &quot;figer&quot; le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="416cb-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="416cb-194">Par exemple, via xfs\_freeze pour le système de fichiers XFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![Cette capture d’écran affiche la liste des objets blob dans le conteneur de disques durs virtuels sur le portail Azure](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="416cb-196">Cette capture d’écran affiche la liste des objets blob dans le conteneur de &quot;disques durs virtuels&quot; sur le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="416cb-197">La capture d’écran montre les cinq disques durs virtuels qui ont été connectés à la machine virtuelle du serveur SAP HANA pour servir de RAID logiciel pour la conservation des fichiers de sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="416cb-198">Elle montre également les cinq copies qui ont été effectuées à l’aide de la commande de copie d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="416cb-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![À des fins de test, les copies des disques RAID logiciels de sauvegarde SAP HANA étaient attachées à la machine virtuelle du serveur d’application](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="416cb-200">À des fins de test, les copies des disques RAID logiciels de sauvegarde SAP HANA étaient attachées à la machine virtuelle du serveur d’application.</span><span class="sxs-lookup"><span data-stu-id="416cb-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![La machine virtuelle du serveur d’application a été arrêtée pour attacher les copies du disque](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="416cb-202">La machine virtuelle du serveur d’application a été arrêtée pour attacher les copies du disque.</span><span class="sxs-lookup"><span data-stu-id="416cb-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="416cb-203">Après le démarrage de la machine virtuelle, les disques et le RAID ont été correctement détectés (montés via UUID).</span><span class="sxs-lookup"><span data-stu-id="416cb-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="416cb-204">Seul le point de montage qui a été créé via le partitionneur YaST est manquant.</span><span class="sxs-lookup"><span data-stu-id="416cb-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="416cb-205">Les copies du fichier de sauvegarde SAP HANA sont ensuite devenues visibles au niveau du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="416cb-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="416cb-206">Copier les fichiers de sauvegarde SAP HANA vers le partage NFS</span><span class="sxs-lookup"><span data-stu-id="416cb-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="416cb-207">Pour réduire l’impact potentiel sur le système SAP HANA en termes de performances ou d’espace disque, vous pouvez envisager de stocker les fichiers de sauvegarde SAP HANA sur un partage NFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="416cb-208">Techniquement, cela fonctionne, mais cela signifie que vous devez utiliser une deuxième machine virtuelle Azure en tant qu’hôte du partage NFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="416cb-209">La taille de la machine virtuelle ne doit pas être faible, en raison de la bande passante réseau de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="416cb-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="416cb-210">Il serait donc judicieux d’arrêter cette &quot;machine virtuelle de sauvegarde&quot; et de l’activer uniquement pour réaliser la sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="416cb-211">L’écriture sur un partage NFS augmente la charge sur le réseau et a un impact sur le système SAP HANA, tandis que la simple gestion des fichiers de sauvegarde par la suite sur la &quot;machine virtuelle de sauvegarde&quot; n’aurait aucune influence sur le système SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![Un partage NFS à partir d’une autre machine virtuelle Azure a été monté sur la machine virtuelle du serveur SAP HANA](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="416cb-213">Pour vérifier le cas d’utilisation NFS, un partage NFS à partir d’une autre machine virtuelle Azure a été monté sur la machine virtuelle du serveur SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="416cb-214">Aucun réglage NFS spécifique n’a été effectué.</span><span class="sxs-lookup"><span data-stu-id="416cb-214">There was no special NFS tuning applied.</span></span>

![Il a fallu 1 heure et 46 minutes pour procéder à la sauvegarde directe](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="416cb-216">Le partage NFS constituait un entrelacement rapide, comme celui sur le serveur SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="416cb-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="416cb-217">Néanmoins, il a fallu 1 heure et 46 minutes pour procéder à la sauvegarde directe sur le partage NFS au lieu de 10 minutes en cas d’écriture sur un entrelacement local.</span><span class="sxs-lookup"><span data-stu-id="416cb-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![L’alternative n’était pas beaucoup plus rapide : 1 heure et 43 minutes](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="416cb-219">La possibilité d’effectuer une sauvegarde vers un entrelacement local et de copier sur le partage NFS au niveau du système d’exploitation (une simple commande **cp -avr**) n’a pas été beaucoup plus rapide.</span><span class="sxs-lookup"><span data-stu-id="416cb-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="416cb-220">Elle a pris 1 heure et 43 minutes.</span><span class="sxs-lookup"><span data-stu-id="416cb-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="416cb-221">Cela fonctionne donc, mais les performances n’étaient pas bonnes pour le test de sauvegarde de 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="416cb-222">La situation serait encore pire pour plusieurs téraoctets.</span><span class="sxs-lookup"><span data-stu-id="416cb-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="416cb-223">Copier les fichiers de sauvegarde SAP HANA vers le service de fichiers Azure</span><span class="sxs-lookup"><span data-stu-id="416cb-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="416cb-224">Il est possible de monter un partage de fichiers Azure dans une machine virtuelle Linux Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="416cb-225">L’article [Utilisation du stockage de fichiers Azure avec Linux](../../../storage/files/storage-how-to-use-files-linux.md) fournit des détails sur la manière de procéder.</span><span class="sxs-lookup"><span data-stu-id="416cb-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="416cb-226">N’oubliez pas qu’il existe actuellement une limite de 5 To pour un partage de fichiers Azure, et une limite de taille de fichier de 1 To.</span><span class="sxs-lookup"><span data-stu-id="416cb-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="416cb-227">Pour plus d’informations sur les limites de stockage, voir [Objectifs de performance et évolutivité du stockage Azure](../../../storage/common/storage-scalability-targets.md).</span><span class="sxs-lookup"><span data-stu-id="416cb-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="416cb-228">Des tests ont toutefois démontré que la sauvegarde SAP HANA ne fonctionne pas directement avec ce type de montage CIFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="416cb-229">La [note SAP 1820529](https://launchpad.support.sap.com/#/notes/1820529) indique également que CIFS n’est pas recommandé.</span><span class="sxs-lookup"><span data-stu-id="416cb-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![Cette illustration montre une erreur dans la boîte de dialogue de sauvegarde dans SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="416cb-231">Cette illustration montre une erreur dans la boîte de dialogue de sauvegarde dans SAP HANA Studio lorsque vous tentez d’effectuer une sauvegarde directement sur un partage de fichiers Azure monté sur CIFS.</span><span class="sxs-lookup"><span data-stu-id="416cb-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="416cb-232">Par conséquent, vous devez d’abord effectuer une sauvegarde SAP HANA standard sur un système de fichiers de machine virtuelle, puis copier les fichiers de sauvegarde vers le service de fichiers Azure.</span><span class="sxs-lookup"><span data-stu-id="416cb-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![Cette illustration montre qu’il a fallu environ 929 secondes pour copier 19 fichiers de sauvegarde SAP HANA](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="416cb-234">Cette illustration montre qu’il a fallu environ 929 secondes pour copier vers le partage de fichiers Azure 19 fichiers de sauvegarde SAP HANA représentant une taille totale d’environ 230 Go.</span><span class="sxs-lookup"><span data-stu-id="416cb-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![La structure du répertoire source sur la machine virtuelle SAP HANA a été copiée dans le partage de fichiers Azure](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="416cb-236">Sur cette capture d’écran, vous pouvez voir que la structure du répertoire source sur la machine virtuelle SAP HANA a été copiée dans le partage de fichiers Azure : un répertoire (hana\_backup\_fsl\_15gb) et 19 fichiers de sauvegarde individuels.</span><span class="sxs-lookup"><span data-stu-id="416cb-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="416cb-237">Le stockage des fichiers de sauvegarde SAP HANA sur les fichiers Azure pourrait à l’avenir constituer une option intéressante, à partir du moment où les sauvegardes de fichiers SAP HANA le prendront en charge directement.</span><span class="sxs-lookup"><span data-stu-id="416cb-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="416cb-238">Ou lorsqu’il deviendra possible de monter des fichiers Azure via NFS et que la limite maximale sera nettement supérieure à 5 To.</span><span class="sxs-lookup"><span data-stu-id="416cb-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="416cb-239">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="416cb-239">Next steps</span></span>
* <span data-ttu-id="416cb-240">L’article [Guide de sauvegarde pour SAP HANA sur les machines virtuelles Azure](sap-hana-backup-guide.md) fournit une vue d’ensemble et des informations sur la mise en route.</span><span class="sxs-lookup"><span data-stu-id="416cb-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="416cb-241">L’article [Sauvegarde SAP HANA à partir de captures instantanées de stockage](sap-hana-backup-storage-snapshots.md) décrit l’option de sauvegarde à partir d’instantanés de stockage.</span><span class="sxs-lookup"><span data-stu-id="416cb-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="416cb-242">Pour savoir comment établir une haute disponibilité et planifier la récupération d’urgence de SAP HANA sur Azure (grandes instances), consultez [Haute disponibilité et récupération d’urgence de SAP HANA (grandes instances) sur Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="416cb-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
