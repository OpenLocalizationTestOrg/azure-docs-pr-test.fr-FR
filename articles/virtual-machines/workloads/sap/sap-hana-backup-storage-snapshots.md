---
title: "sauvegarde de HANA Azure aaaSAP basée sur des instantanés de stockage | Documents Microsoft"
description: "Il existe deux grandes méthodes permettant d’effectuer des sauvegardes SAP HANA sur des machines virtuelles Azure. Cet article aborde la sauvegarde SAP HANA à partir de captures instantanées de stockage"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="5a7f9-103">Sauvegarde SAP HANA à partir de captures instantanées de stockage</span><span class="sxs-lookup"><span data-stu-id="5a7f9-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="5a7f9-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="5a7f9-104">Introduction</span></span>

<span data-ttu-id="5a7f9-105">Ce document fait partie d’une série d’articles connexes en trois parties dédiés à la sauvegarde SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="5a7f9-106">[Guide de sauvegarde pour SAP HANA sur des Machines virtuelles Azure](sap-hana-backup-guide.md) fournit une vue d’ensemble et des informations sur la prise en main, et [SAP HANA Azure Backup au niveau du fichier](sap-hana-backup-file-level.md) couvre hello option basée sur le fichier de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="5a7f9-107">Lorsque vous utilisez une fonctionnalité de sauvegarde de machine virtuelle pour un système de démonstration de tout-en-un à instance unique, il doit considérer d’effectuer une sauvegarde de la machine virtuelle au lieu de la gestion des sauvegardes HANA à hello au niveau du système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="5a7f9-108">Une alternative consiste à tootake objets blob Azure instantanés toocreate des copies de disques virtuels individuels qui sont tooa joint l’ordinateur virtuel et conserver les fichiers de données HANA hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="5a7f9-109">Mais un point critique est la cohérence d’application lors de la création d’un instantané de sauvegarde ou de disque de machine virtuelle alors que le système de hello et en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="5a7f9-110">Consultez _la cohérence des données SAP HANA lors de la prise d’instantanés de stockage_ dans l’article hello [guide de sauvegarde pour SAP HANA sur des Machines virtuelles Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="5a7f9-111">SAP HANA dispose d’une fonction qui prend en charge ces types de captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="5a7f9-112">Captures instantanées de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="5a7f9-112">SAP HANA snapshots</span></span>

<span data-ttu-id="5a7f9-113">Il existe dans SAP HANA une fonctionnalité qui prend en charge la création de captures instantanées de stockage.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="5a7f9-114">Toutefois, à compter de 2016 de décembre, il existe une restriction des systèmes de toosingle-container.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="5a7f9-115">Les configurations de conteneur multitenant ne gèrent pas ce type de capture instantanée de la base de données (voir [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) [Créer une capture instantanée de stockage (SAP HANA Studio)]).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="5a7f9-116">Elle fonctionne de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-116">It works as follows:</span></span>

- <span data-ttu-id="5a7f9-117">Préparer un instantané du stockage en lançant l’instantané de SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="5a7f9-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="5a7f9-118">Exécuter hello capture instantanée de stockage (Azure blob capture instantanée, par exemple)</span><span class="sxs-lookup"><span data-stu-id="5a7f9-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="5a7f9-119">Confirmer l’instantané de SAP HANA hello</span><span class="sxs-lookup"><span data-stu-id="5a7f9-119">Confirm hello SAP HANA snapshot</span></span>

![Cette capture d’écran montre qu’une capture instantanée des données SAP HANA peut être créée via une instruction SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="5a7f9-121">Cette capture d’écran montre qu’une capture instantanée des données SAP HANA peut être créée via une instruction SQL.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Hello d’instantané puis apparaît également dans le catalogue de sauvegarde hello dans SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="5a7f9-123">Hello d’instantané puis apparaît également dans le catalogue de sauvegarde hello dans SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![Sur le disque, les instantanés hello s’affiche dans le répertoire de données SAP HANA hello](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="5a7f9-125">Sur le disque, les instantanés hello s’affiche dans le répertoire de données SAP HANA hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="5a7f9-126">L’un est tooensure fsck hello est également garantie avant d’exécuter la capture instantanée de stockage hello tandis que SAP HANA est en mode de préparation d’instantané hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="5a7f9-127">Consultez _la cohérence des données SAP HANA lors de la prise d’instantanés de stockage_ dans l’article hello [guide de sauvegarde pour SAP HANA sur des Machines virtuelles Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="5a7f9-128">Une fois l’instantané du stockage hello est terminé, il est instantané de SAP HANA hello tooconfirm critiques.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="5a7f9-129">Il existe un toorun d’instruction SQL correspondante : fermer instantané des données de sauvegarde (voir [sauvegarde données instantané clôturer (sauvegarde et récupération)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5a7f9-130">Confirmer la capture instantanée HANA hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="5a7f9-131">Échéance trop&quot;copie sur écriture&quot; SAP HANA peuvent nécessiter espace disque supplémentaire à instantané en mode de préparation, et il n’est pas possible de toostart nouvelles sauvegardes jusqu'à ce que l’instantané de SAP HANA hello est confirmée.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="5a7f9-132">Sauvegarde de machines virtuelles HANA via le service Azure Backup</span><span class="sxs-lookup"><span data-stu-id="5a7f9-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="5a7f9-133">À compter de 2016 de décembre, l’agent de sauvegarde hello Hello service Azure Backup n’est pas disponible pour les machines virtuelles Linux.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="5a7f9-134">utilisation de toomake de sauvegarde Azure au niveau fichier/répertoire hello, un serait copier les fichiers de sauvegarde de SAP HANA tooa machine virtuelle Windows et ensuite utiliser l’agent de sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="5a7f9-135">Dans le cas contraire, seule une sauvegarde complète de Linux VM est possible via le service de sauvegarde Azure hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="5a7f9-136">Consultez [fonctionnalités de la vue d’ensemble de hello dans Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="5a7f9-137">Hello service Azure Backup offre une option tooback jusqu'à et de restauration d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="5a7f9-138">Vous trouverez plus d’informations sur ce service et comment il fonctionne dans l’article de hello [planifier votre infrastructure de sauvegarde de machine virtuelle dans Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="5a7f9-139">Il existe deux considérations importantes en fonction de l’article de toothat :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="5a7f9-140">_&quot;Pour les ordinateurs virtuels Linux, uniquement des sauvegardes cohérentes de fichier sont possibles, car Linux n’a pas un tooVSS plate-forme équivalente.&quot;_</span><span class="sxs-lookup"><span data-stu-id="5a7f9-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="5a7f9-141">_&quot;Les applications doivent tooimplement leurs propres &quot;correction&quot; mécanisme sur hello restauré les données.&quot;_</span><span class="sxs-lookup"><span data-stu-id="5a7f9-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="5a7f9-142">Par conséquent, l’un est toomake que SAP HANA se trouve dans un état cohérent sur le disque lors du démarrage hello sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="5a7f9-143">Consultez _instantanés de SAP HANA_ décrit plus haut dans le document de hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="5a7f9-144">Mais le fait que SAP HANA reste dans ce mode de préparation de captures instantanées soulève un problème potentiel.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="5a7f9-145">Pour plus d’informations, consultez la page [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) [Créer une capture instantanée de stockage (SAP HANA Studio]).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="5a7f9-146">Cet article indique :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-146">That article states:</span></span>

<span data-ttu-id="5a7f9-147">_&quot;Il est fortement recommandé de tooconfirm ou abandonner une capture instantanée de stockage dès que possible après que qu’elle a été créée. Lors de la capture instantanée de stockage hello est en cours de préparation ou créé, hello données pertinentes de l’instantané sont figées. Alors que les données pertinentes de l’instantané hello restent figées, peut toujours être apportées dans la base de données hello. Ces modifications n’entraîne pas hello figée toobe pertinentes de l’instantané de données modifiée. Au lieu de cela, les modifications de hello sont écrites toopositions zone de données hello distinctes à partir de l’instantané du stockage hello. Modifications concernent également toohello journal. Toutefois, hello hello relatifs à la capture instantanée des données sont conservées figées, hello hello plus volume de données peut augmenter.&quot;_</span><span class="sxs-lookup"><span data-stu-id="5a7f9-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="5a7f9-148">Sauvegarde Azure s’occupe de la cohérence de système de fichier hello via les extensions de machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="5a7f9-149">Ces extensions ne sont pas disponibles sous une forme autonome et fonctionnent uniquement en association avec le service  Sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="5a7f9-150">Cependant, il est toujours un toomanage exigence une cohérence d’application SAP HANA instantané tooguarantee.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="5a7f9-151">Le service Sauvegarde Azure se décompose en deux grandes phases :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="5a7f9-152">Création d’une capture instantanée</span><span class="sxs-lookup"><span data-stu-id="5a7f9-152">Take Snapshot</span></span>
- <span data-ttu-id="5a7f9-153">Transfert de données toovault</span><span class="sxs-lookup"><span data-stu-id="5a7f9-153">Transfer data toovault</span></span>

<span data-ttu-id="5a7f9-154">Ainsi, confirmer l’instantané de SAP HANA hello issue de la phase de service de sauvegarde Azure hello d’une capture instantanée.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="5a7f9-155">Cela peut prendre plusieurs minutes toosee hello portail Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-155">It might take several minutes toosee in hello Azure portal.</span></span>

![Cette illustration montre une partie de la liste de sauvegarde hello d’un service Azure Backup](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="5a7f9-157">Cette illustration montre une partie de liste de tâche de sauvegarde hello d’un service Azure Backup, qui était utilisé tooback de machine virtuelle de test HANA hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![Détails de la tâche tooshow hello, cliquez sur le travail de sauvegarde hello Bonjour portail Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="5a7f9-159">Détails de la tâche hello tooshow, cliquez sur la tâche de sauvegarde de hello Bonjour portail Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="5a7f9-160">Ici, un peut voir hello deux phases.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="5a7f9-161">Il peut prendre quelques minutes jusqu'à ce qu’il indique la phase de capture instantanée hello comme terminée.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="5a7f9-162">La plupart du temps de hello est consacré à la phase de transfert de données hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="5a7f9-163">Automatisation des sauvegardes de machines virtuelles HANA via le service Azure Backup</span><span class="sxs-lookup"><span data-stu-id="5a7f9-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="5a7f9-164">Un confirmer manuellement instantané de SAP HANA hello une fois la phase de capture instantanée de sauvegarde Azure hello est terminée, comme décrit précédemment, mais il est utile de tooconsider automation, car un administrateur peut ne pas analyser la liste de sauvegarde hello Bonjour portail Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="5a7f9-165">Voici comment effectuer cette automatisation via des applets de commande Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Un service Azure Backup a été créé avec hello nom hana--coffre de sauvegarde](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="5a7f9-167">Un service Azure Backup a été créé avec le nom de hello &quot;hana-sauvegarde-coffre.&quot; hello commande PS **AzureRmRecoveryServicesVault de Get-nom du coffre de sauvegarde hana** récupère hello objet correspondant.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="5a7f9-168">Cet objet est ensuite utilisé tooset hello contexte sauvegarde, comme l’illustre la figure suivante hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![Consultez pour la tâche de sauvegarde hello actuellement en cours](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="5a7f9-170">Après le paramètre hello contexte un qui peut vérifier pour la tâche de sauvegarde hello est en cours et puis rechercher les détails de la tâche.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="5a7f9-171">liste des tâches subordonnées Hello montre si hello instantané phase de hello du travail de sauvegarde Azure est déjà terminée :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Valeur de hello d’interrogation dans une boucle jusqu'à ce qu’il s’avère tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="5a7f9-173">Une fois que les détails d’une tâche hello sont stockés dans une variable, il est simplement PS syntaxe tooget toohello première entrée de tableau et récupérer la valeur d’état hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="5a7f9-174">script d’automatisation toocomplete hello, valeur hello de sondage dans une boucle jusqu'à ce qu’il devient trop&quot;terminé.&quot;</span><span class="sxs-lookup"><span data-stu-id="5a7f9-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="5a7f9-175">Clé de licence HANA et restauration de machine virtuelle via le service Sauvegarde Azure</span><span class="sxs-lookup"><span data-stu-id="5a7f9-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="5a7f9-176">Hello service Azure Backup est conçue toocreate un nouvel ordinateur virtuel pendant la restauration.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="5a7f9-177">Il n’existe aucun plan pour le moment toodo un &quot;in situ&quot; restauration d’une machine virtuelle Azure existante.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Cette figure illustre l’option de restauration hello Hello service Azure Bonjour portail Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="5a7f9-179">Cette illustration montre l’option de restauration hello Hello service Azure Bonjour portail Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="5a7f9-180">Une peut choisir entre la création d’un ordinateur virtuel pendant la restauration ou la restauration des disques de hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="5a7f9-181">Après la restauration des disques hello, il est encore nécessaire toocreate par-dessus une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="5a7f9-182">Chaque fois qu’un nouvel ordinateur virtuel est créé sur les modifications d’ID de machine virtuelle uniques Azure hello (consultez [accès et l’ID Unique de la machine virtuelle Azure à l’aide de](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Cette figure illustre l’ID unique de machine virtuelle Azure hello avant et après la restauration de hello via le service de sauvegarde Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="5a7f9-184">Cette illustration montre l’ID unique de machine virtuelle Azure hello avant et après la restauration de hello via le service de sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="5a7f9-185">clé matérielle Hello SAP, qui est utilisé pour le Gestionnaire de licences de SAP, à l’aide de cet ID de machine virtuelle unique.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="5a7f9-186">Par conséquent, une nouvelle licence SAP a toobe installé après une restauration de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="5a7f9-187">Une nouvelle fonctionnalité Azure Backup a été présentée en mode aperçu lors de la création de hello de ce guide de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="5a7f9-188">Il permet une restauration au niveau du fichier en fonction de l’instantané d’ordinateur virtuel hello qui a été effectuée pour hello VM sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="5a7f9-189">Cela évite de hello besoin toodeploy un nouvel ordinateur virtuel et par conséquent reste d’ID de machine virtuelle unique hello hello même et aucune nouvelle clé de licence SAP HANA n’est requis.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="5a7f9-190">Vous trouverez plus d’informations sur cette fonctionnalité une fois qu’elle sera entièrement testée.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="5a7f9-191">Sauvegarde Azure sera finalement autoriser la sauvegarde de différents disques virtuels Azure, ainsi que les fichiers et répertoires à partir à l’intérieur de machine virtuelle hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="5a7f9-192">Un avantage majeur d’Azure Backup est sa gestion de toutes les sauvegardes de hello, l’enregistrement de client de hello de ne pas avoir de toodo il.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="5a7f9-193">Si une restauration s’avère nécessaire, Azure Backup sélectionne hello toouse de sauvegarde correcte.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="5a7f9-194">Sauvegarde de machine virtuelle SAP HANA via une capture instantanée manuelle du disque</span><span class="sxs-lookup"><span data-stu-id="5a7f9-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="5a7f9-195">Au lieu d’utiliser le service de sauvegarde Azure hello, un pu configurer une solution de sauvegarde individuelle en créant des instantanés d’objet blob de disques durs virtuels de Azure manuellement via PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="5a7f9-196">Consultez [instantanés d’objet blob à l’aide avec PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) pour obtenir une description des étapes de hello.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="5a7f9-197">Elle offre plus de souplesse, mais ne résout pas les problèmes de hello expliqués plus haut dans ce document :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="5a7f9-198">Il faut toujours veiller à ce que SAP HANA reste à l’état cohérent</span><span class="sxs-lookup"><span data-stu-id="5a7f9-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="5a7f9-199">Impossible de remplacer le disque du système d’exploitation Hello même si hello que machine virtuelle est libérée en raison d’une erreur indiquant qu’un bail existant.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="5a7f9-200">Il fonctionne uniquement après la suppression de hello machine virtuelle, ce qui signifierait tooa nouveau unique ID de machine virtuelle et hello besoin tooinstall une nouvelle licence SAP.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![Il est possible toorestore uniquement des disques de données hello d’une machine virtuelle Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="5a7f9-202">Il est possible toorestore uniquement les disques de données hello d’une machine virtuelle Azure, en évitant hello tout problème d’obtention d’un nouvel ID de machine virtuelle unique et invalidé par conséquent, des licences SAP hello :</span><span class="sxs-lookup"><span data-stu-id="5a7f9-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="5a7f9-203">Pour le test de hello, deux disques de données Azure ont été attachée tooa machine virtuelle et les volumes RAID logiciels a été défini sur les</span><span class="sxs-lookup"><span data-stu-id="5a7f9-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="5a7f9-204">La fonction de capture instantanée SAP HANA a permis de confirmer l’état cohérent de SAP HANA</span><span class="sxs-lookup"><span data-stu-id="5a7f9-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="5a7f9-205">Système de fichiers Figer (consultez _la cohérence des données SAP HANA lors de la prise d’instantanés de stockage_ dans l’article hello [guide de sauvegarde pour SAP HANA sur des Machines virtuelles Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="5a7f9-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="5a7f9-206">Des captures instantanées d’objets blob ont été créées à partir des deux disques de données</span><span class="sxs-lookup"><span data-stu-id="5a7f9-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="5a7f9-207">Déblocage du système de fichiers</span><span class="sxs-lookup"><span data-stu-id="5a7f9-207">File system unfreeze</span></span>
- <span data-ttu-id="5a7f9-208">Confirmation de la capture instantanée SAP HANA</span><span class="sxs-lookup"><span data-stu-id="5a7f9-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="5a7f9-209">les deux disques de détacher et de disques de données toorestore hello, hello machine virtuelle a été arrêté</span><span class="sxs-lookup"><span data-stu-id="5a7f9-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="5a7f9-210">Après le détachement des disques hello, ils ont été remplacés par des captures instantanées du blob ancien hello</span><span class="sxs-lookup"><span data-stu-id="5a7f9-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="5a7f9-211">Puis hello restauré les disques virtuels ont été attachés à nouveau toohello machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="5a7f9-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="5a7f9-212">Une fois que l’heure de début hello machine virtuelle, tous les éléments logiciels de hello RAID fonctionnait correctement et a été redéfini toohello blob capture instantanée</span><span class="sxs-lookup"><span data-stu-id="5a7f9-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="5a7f9-213">HANA a été redéfini instantané HANA toohello</span><span class="sxs-lookup"><span data-stu-id="5a7f9-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="5a7f9-214">S’il est possible tooshut vers le bas SAP HANA avant les instantanés d’objet blob hello, procédure de hello serait moins complexe.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="5a7f9-215">Dans ce cas, un peut ignorer la capture instantanée HANA hello et, si rien d’autre ne se passe dans le système de hello, également ignorer blocage hello du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="5a7f9-216">Complexité ajouté est fourni dans l’image de hello lorsqu’il est nécessaire de toodo instantanés si tout est en ligne.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="5a7f9-217">Consultez _la cohérence des données SAP HANA lors de la prise d’instantanés de stockage_ dans l’article hello [guide de sauvegarde pour SAP HANA sur des Machines virtuelles Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="5a7f9-218">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="5a7f9-218">Next steps</span></span>
* <span data-ttu-id="5a7f9-219">L’article [Guide de sauvegarde pour SAP HANA sur les machines virtuelles Azure](sap-hana-backup-guide.md) fournit une vue d’ensemble et des informations sur la mise en route.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="5a7f9-220">[Sauvegarde de SAP HANA en fonction de niveau fichier](sap-hana-backup-file-level.md) couvre hello option basée sur le fichier de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="5a7f9-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="5a7f9-221">toolearn comment tooestablish haute disponibilité et le plan de récupération d’urgence de SAP HANA sur Azure (instances de grande taille), consultez [SAP HANA (instances de grande taille) haute disponibilité et récupération d’urgence sur Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="5a7f9-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
