---
title: "aaaSQL groupes de disponibilité de serveur - des Machines virtuelles Azure - la récupération d’urgence | Documents Microsoft"
description: "Cet article explique comment regrouper des tooconfigure une disponibilité de SQL Server sur des machines virtuelles Azure avec un réplica dans une autre région."
services: virtual-machines
documentationCenter: na
authors: MikeRayMSFT
manager: jhubbard
editor: monicar
tags: azure-service-management
ms.assetid: 388c464e-a16e-4c9d-a0d5-bb7cf5974689
ms.service: virtual-machines-sql
ms.devlang: na
ms.custom: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/02/2017
ms.author: mikeray
ms.openlocfilehash: df6238dc61c5a56879c75c9bf7314c618f43c0ce
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="configure-an-always-on-availability-group-on-azure-virtual-machines-in-different-regions"></a><span data-ttu-id="1d812-103">Configurer un groupe de disponibilité AlwaysOn sur des machines virtuelles Azure dans des emplacements différents</span><span class="sxs-lookup"><span data-stu-id="1d812-103">Configure an Always On availability group on Azure virtual machines in different regions</span></span>

<span data-ttu-id="1d812-104">Cet article explique comment tooconfigure une disponibilité de SQL Server Always On groupe réplica sur des machines virtuelles dans un emplacement Azure distant.</span><span class="sxs-lookup"><span data-stu-id="1d812-104">This article explains how tooconfigure a SQL Server Always On availability group replica on Azure virtual machines in a remote Azure location.</span></span> <span data-ttu-id="1d812-105">Utilisez la récupération d’urgence toosupport de cette configuration.</span><span class="sxs-lookup"><span data-stu-id="1d812-105">Use this configuration toosupport disaster recovery.</span></span>

<span data-ttu-id="1d812-106">Cet article s’applique tooAzure Machines virtuelles en mode de gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="1d812-106">This article applies tooAzure Virtual Machines in Resource Manager mode.</span></span>

<span data-ttu-id="1d812-107">Hello image suivante montre un déploiement classique d’un groupe de disponibilité sur des machines virtuelles :</span><span class="sxs-lookup"><span data-stu-id="1d812-107">hello following image shows a common deployment of an availability group on Azure virtual machines:</span></span>

   ![Groupe de disponibilité](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic.png)

<span data-ttu-id="1d812-109">Dans ce déploiement, toutes les machines virtuelles sont dans une région Azure.</span><span class="sxs-lookup"><span data-stu-id="1d812-109">In this deployment, all virtual machines are in one Azure region.</span></span> <span data-ttu-id="1d812-110">réplicas de groupe de disponibilité Hello peuvent avoir une validation synchrone avec basculement automatique sur SQL-1 et 2 de SQL.</span><span class="sxs-lookup"><span data-stu-id="1d812-110">hello availability group replicas can have synchronous commit with automatic failover on SQL-1 and SQL-2.</span></span> <span data-ttu-id="1d812-111">toobuild cette architecture, consultez [modèle de groupe de disponibilité ou didacticiel](virtual-machines-windows-portal-sql-availability-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-111">toobuild this architecture, see [Availability Group template or tutorial](virtual-machines-windows-portal-sql-availability-group-overview.md).</span></span>

<span data-ttu-id="1d812-112">Cette architecture est vulnérable toodowntime si hello région Azure devient inaccessible.</span><span class="sxs-lookup"><span data-stu-id="1d812-112">This architecture is vulnerable toodowntime if hello Azure region becomes inaccessible.</span></span> <span data-ttu-id="1d812-113">tooovercome cette vulnérabilité, ajouter un réplica dans une région différente.</span><span class="sxs-lookup"><span data-stu-id="1d812-113">tooovercome this vulnerability, add a replica in a different Azure region.</span></span> <span data-ttu-id="1d812-114">Hello diagramme suivant montre comment la nouvelle architecture de hello ressemble :</span><span class="sxs-lookup"><span data-stu-id="1d812-114">hello following diagram shows how hello new architecture would look:</span></span>

   ![Récupération d’urgence du groupe de disponibilité](./media/virtual-machines-windows-portal-sql-availability-group-dr/00-availability-group-basic-dr.png)

<span data-ttu-id="1d812-116">Hello diagramme précédent illustre un nouvel ordinateur virtuel appelé SQL-3.</span><span class="sxs-lookup"><span data-stu-id="1d812-116">hello preceding diagram shows a new virtual machine called SQL-3.</span></span> <span data-ttu-id="1d812-117">SQL-3 se trouve dans une autre région Azure.</span><span class="sxs-lookup"><span data-stu-id="1d812-117">SQL-3 is in a different Azure region.</span></span> <span data-ttu-id="1d812-118">SQL-3 est ajouté toohello Cluster de basculement Windows Server.</span><span class="sxs-lookup"><span data-stu-id="1d812-118">SQL-3 is added toohello Windows Server Failover Cluster.</span></span> <span data-ttu-id="1d812-119">SQL-3 peut héberger un réplica de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="1d812-119">SQL-3 can host an availability group replica.</span></span> <span data-ttu-id="1d812-120">Enfin, notez que hello région Azure pour SQL-3 a un nouvel équilibrage de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="1d812-120">Finally, notice that hello Azure region for SQL-3 has a new Azure load balancer.</span></span>

>[!NOTE]
> <span data-ttu-id="1d812-121">Haute disponibilité Azure est requise lorsque plus d’une machine virtuelle est en hello même région.</span><span class="sxs-lookup"><span data-stu-id="1d812-121">An Azure availability set is required when more than one virtual machine is in hello same region.</span></span> <span data-ttu-id="1d812-122">Si seul un ordinateur virtuel est dans une région de hello, hello à haute disponibilité n’est pas requis.</span><span class="sxs-lookup"><span data-stu-id="1d812-122">If only one virtual machine is in hello region, then hello availability set is not required.</span></span> <span data-ttu-id="1d812-123">Vous ne pouvez placer une machine virtuelle dans un groupe à haute disponibilité que lors de la création.</span><span class="sxs-lookup"><span data-stu-id="1d812-123">You can only place a virtual machine in an availability set at creation time.</span></span> <span data-ttu-id="1d812-124">Si hello machine virtuelle est déjà dans un ensemble de disponibilité, vous pouvez ajouter un ordinateur virtuel pour un réplica supplémentaire ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="1d812-124">If hello virtual machine is already in an availability set, you can add a virtual machine for an additional replica later.</span></span>

<span data-ttu-id="1d812-125">Dans cette architecture, hello réplica dans la région de hello distant est normalement configuré avec le mode de disponibilité avec validation asynchrone et le mode de basculement manuel.</span><span class="sxs-lookup"><span data-stu-id="1d812-125">In this architecture, hello replica in hello remote region is normally configured with asynchronous commit availability mode and manual failover mode.</span></span>

<span data-ttu-id="1d812-126">Lorsque les réplicas du groupe de disponibilité se trouvent sur des machines virtuelles Azure dans différentes régions Azure, chaque région requiert :</span><span class="sxs-lookup"><span data-stu-id="1d812-126">When availability group replicas are on Azure virtual machines in different Azure regions, each region requires:</span></span>

* <span data-ttu-id="1d812-127">Une passerelle de réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="1d812-127">A virtual network gateway</span></span>
* <span data-ttu-id="1d812-128">Une connexion à la passerelle de réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="1d812-128">A virtual network gateway connection</span></span>

<span data-ttu-id="1d812-129">Hello diagramme suivant montre comment les réseaux hello communiquent entre les centres de données.</span><span class="sxs-lookup"><span data-stu-id="1d812-129">hello following diagram shows how hello networks communicate between data centers.</span></span>

   ![Groupe de disponibilité](./media/virtual-machines-windows-portal-sql-availability-group-dr/01-vpngateway-example.png)

>[!IMPORTANT]
><span data-ttu-id="1d812-131">Cette architecture facture les données sortantes des données répliquées entre des régions Azure.</span><span class="sxs-lookup"><span data-stu-id="1d812-131">This architecture incurs outbound data charges for data replicated between Azure regions.</span></span> <span data-ttu-id="1d812-132">Consultez [Détails de la tarification de la bande passante](http://azure.microsoft.com/pricing/details/bandwidth/).</span><span class="sxs-lookup"><span data-stu-id="1d812-132">See [Bandwidth Pricing](http://azure.microsoft.com/pricing/details/bandwidth/).</span></span>  

## <a name="create-remote-replica"></a><span data-ttu-id="1d812-133">Créer un réplica distant</span><span class="sxs-lookup"><span data-stu-id="1d812-133">Create remote replica</span></span>

<span data-ttu-id="1d812-134">toocreate un réplica dans un centre de données à distance, procédez comme hello comme suit :</span><span class="sxs-lookup"><span data-stu-id="1d812-134">toocreate a replica in a remote data center, do hello following steps:</span></span>

1. <span data-ttu-id="1d812-135">[Créer un réseau virtuel dans la nouvelle région de hello](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-135">[Create a virtual network in hello new region](../../../virtual-network/virtual-networks-create-vnet-arm-pportal.md).</span></span>

1. <span data-ttu-id="1d812-136">[Configurer une connexion au réseau à l’aide de hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-136">[Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-howto-vnet-vnet-resource-manager-portal.md).</span></span>

   >[!NOTE]
   ><span data-ttu-id="1d812-137">Dans certains cas, vous avez peut-être connexion au réseau de toouse PowerShell toocreate hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-137">In some cases, you may have toouse PowerShell toocreate hello VNet-to-VNet connection.</span></span> <span data-ttu-id="1d812-138">Par exemple, si vous utilisez des comptes Azure différents vous ne pouvez pas configurer la connexion de hello dans le portail de hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-138">For example, if you use different Azure accounts you cannot configure hello connection in hello portal.</span></span> <span data-ttu-id="1d812-139">Dans ce cas le voir, [configurer un réseau pour une connexion à l’aide de hello Azure portal](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-139">In this case see, [Configure a VNet-to-VNet connection using hello Azure portal](../../../vpn-gateway/vpn-gateway-vnet-vnet-rm-ps.md).</span></span>

1. <span data-ttu-id="1d812-140">[Créer un contrôleur de domaine dans la nouvelle région de hello](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-140">[Create a domain controller in hello new region](../../../active-directory/active-directory-new-forest-virtual-machine.md).</span></span>

   <span data-ttu-id="1d812-141">Ce contrôleur de domaine fournit l’authentification si le contrôleur de domaine hello dans le site principal de hello n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="1d812-141">This domain controller provides authentication if hello domain controller in hello primary site is not available.</span></span>

1. <span data-ttu-id="1d812-142">[Créer une machine virtuelle SQL Server dans la nouvelle région de hello](virtual-machines-windows-portal-sql-server-provision.md).</span><span class="sxs-lookup"><span data-stu-id="1d812-142">[Create a SQL Server virtual machine in hello new region](virtual-machines-windows-portal-sql-server-provision.md).</span></span>

1. <span data-ttu-id="1d812-143">[Créer un équilibrage de charge Azure réseau hello sur la nouvelle région de hello](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span><span class="sxs-lookup"><span data-stu-id="1d812-143">[Create an Azure load balancer in hello network on hello new region](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer).</span></span>

   <span data-ttu-id="1d812-144">Cet équilibrage de charge doit :</span><span class="sxs-lookup"><span data-stu-id="1d812-144">This load balancer must:</span></span>

   - <span data-ttu-id="1d812-145">Dans hello même réseau et le sous-réseau comme hello du nouvel ordinateur virtuel.</span><span class="sxs-lookup"><span data-stu-id="1d812-145">Be in hello same network and subnet as hello new virtual machine.</span></span>
   - <span data-ttu-id="1d812-146">Avoir une adresse IP statique pour l’écouteur du groupe de disponibilité hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-146">Have a static IP address for hello availability group listener.</span></span>
   - <span data-ttu-id="1d812-147">Inclure un pool principal constitué uniquement d’ordinateurs virtuels hello hello même région que hello d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="1d812-147">Include a backend pool consisting of only hello virtual machines in hello same region as hello load balancer.</span></span>
   - <span data-ttu-id="1d812-148">Utilisez une adresse IP spécifique toohello de sonde de port TCP.</span><span class="sxs-lookup"><span data-stu-id="1d812-148">Use a TCP port probe specific toohello IP address.</span></span>
   - <span data-ttu-id="1d812-149">Une charge de l’équilibrage de la règle spécifique toohello SQL Server Bonjour même région.</span><span class="sxs-lookup"><span data-stu-id="1d812-149">Have a load balancing rule specific toohello SQL Server in hello same region.</span></span>  

1. <span data-ttu-id="1d812-150">[Ajouter le Clustering de basculement des toohello fonctionnalité nouvelle de SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span><span class="sxs-lookup"><span data-stu-id="1d812-150">[Add Failover Clustering feature toohello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#add-failover-clustering-features-to-both-sql-server-vms).</span></span>

1. <span data-ttu-id="1d812-151">[Joindre hello nouveau SQL Server toohello domaine](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span><span class="sxs-lookup"><span data-stu-id="1d812-151">[Join hello new SQL Server toohello domain](virtual-machines-windows-portal-sql-availability-group-prereq.md#joinDomain).</span></span>

1. <span data-ttu-id="1d812-152">[Définissez toouse de compte de service hello nouveau SQL Server à un compte de domaine](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span><span class="sxs-lookup"><span data-stu-id="1d812-152">[Set hello new SQL Server service account toouse a domain account](virtual-machines-windows-portal-sql-availability-group-prereq.md#setServiceAccount).</span></span>

1. <span data-ttu-id="1d812-153">[Ajouter hello nouveau SQL Server toohello Cluster de basculement Windows Server](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span><span class="sxs-lookup"><span data-stu-id="1d812-153">[Add hello new SQL Server toohello Windows Server Failover Cluster](virtual-machines-windows-portal-sql-availability-group-tutorial.md#addNode).</span></span>

1. <span data-ttu-id="1d812-154">Créer une ressource d’adresse IP sur le cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-154">Create an IP address resource on hello cluster.</span></span>

   <span data-ttu-id="1d812-155">Vous pouvez créer la ressource adresse IP hello Gestionnaire du Cluster de basculement.</span><span class="sxs-lookup"><span data-stu-id="1d812-155">You can create hello IP address resource in Failover Cluster Manager.</span></span> <span data-ttu-id="1d812-156">Sur le rôle du groupe de disponibilité hello, cliquez **ajouter une ressource**, **plus de ressources**, puis cliquez sur **adresse IP**.</span><span class="sxs-lookup"><span data-stu-id="1d812-156">Right-click hello availability group role, click **Add Resource**, **More Resources**, and click **IP Address**.</span></span>

   ![Création d’une adresse IP](./media/virtual-machines-windows-portal-sql-availability-group-dr/20-add-ip-resource.png)

   <span data-ttu-id="1d812-158">Configurez cette adresse IP comme suit :</span><span class="sxs-lookup"><span data-stu-id="1d812-158">Configure this IP address as follows:</span></span>

   - <span data-ttu-id="1d812-159">Utiliser le réseau hello à partir du centre de données distant hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-159">Use hello network from hello remote data center.</span></span>
   - <span data-ttu-id="1d812-160">Attribuer l’adresse IP de hello à partir d’un équilibrage de charge Azure hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-160">Assign hello IP address from hello new Azure load balancer.</span></span> 

1. <span data-ttu-id="1d812-161">Sur hello nouveau SQL Server dans le Gestionnaire de Configuration SQL Server, [activer les groupes de disponibilité AlwaysOn](http://msdn.microsoft.com/library/ff878259.aspx).</span><span class="sxs-lookup"><span data-stu-id="1d812-161">On hello new SQL Server in SQL Server Configuration Manager, [enable Always On Availability Groups](http://msdn.microsoft.com/library/ff878259.aspx).</span></span>

1. <span data-ttu-id="1d812-162">[Ports de pare-feu ouvert hello nouveau SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span><span class="sxs-lookup"><span data-stu-id="1d812-162">[Open firewall ports on hello new SQL Server](virtual-machines-windows-portal-sql-availability-group-prereq.md#endpoint-firewall).</span></span>

   <span data-ttu-id="1d812-163">Vous devez tooopen les numéros de port Hello dépendent de votre environnement.</span><span class="sxs-lookup"><span data-stu-id="1d812-163">hello port numbers you need tooopen depend on your environment.</span></span> <span data-ttu-id="1d812-164">Ouvrir les ports pour hello Azure et point de terminaison de mise en miroir de charger sonde d’équilibrage de contrôle d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="1d812-164">Open ports for hello mirroring endpoint and Azure load balancer health probe.</span></span>

1. <span data-ttu-id="1d812-165">[Ajouter un groupe de disponibilité de réplica toohello sur hello nouveau SQL Server](http://msdn.microsoft.com/library/hh213239.aspx).</span><span class="sxs-lookup"><span data-stu-id="1d812-165">[Add a replica toohello availability group on hello new SQL Server](http://msdn.microsoft.com/library/hh213239.aspx).</span></span>

   <span data-ttu-id="1d812-166">Pour un réplica dans une région Azure distante, configurez-le pour une réplication asynchrone avec basculement manuel.</span><span class="sxs-lookup"><span data-stu-id="1d812-166">For a replica in a remote Azure region, set it for asynchronous replication with manual failover.</span></span>  

1. <span data-ttu-id="1d812-167">Ajoutez la ressource d’adresse IP hello en tant que dépendance pour hello écouteur client access point (nom réseau) le cluster.</span><span class="sxs-lookup"><span data-stu-id="1d812-167">Add hello IP address resource as a dependency for hello listener client access point (network name) cluster.</span></span>

   <span data-ttu-id="1d812-168">Hello capture d’écran suivante montre une ressource de cluster d’adresse IP configurée correctement :</span><span class="sxs-lookup"><span data-stu-id="1d812-168">hello following screenshot shows a properly configured IP address cluster resource:</span></span>

   ![Groupe de disponibilité](./media/virtual-machines-windows-portal-sql-availability-group-dr/50-configure-dependency-multiple-ip.png)

   >[!IMPORTANT]
   ><span data-ttu-id="1d812-170">groupe de ressources de cluster Hello inclut les deux adresses IP.</span><span class="sxs-lookup"><span data-stu-id="1d812-170">hello cluster resource group includes both IP addresses.</span></span> <span data-ttu-id="1d812-171">Les deux adresses IP sont des dépendances pour le point d’accès client hello écouteur.</span><span class="sxs-lookup"><span data-stu-id="1d812-171">Both IP addresses are dependencies for hello listener client access point.</span></span> <span data-ttu-id="1d812-172">Hello d’utilisation **ou** opérateur dans la configuration de dépendance hello cluster.</span><span class="sxs-lookup"><span data-stu-id="1d812-172">Use hello **OR** operator in hello cluster dependency configuration.</span></span>

1. <span data-ttu-id="1d812-173">[Définir les paramètres de cluster hello dans PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span><span class="sxs-lookup"><span data-stu-id="1d812-173">[Set hello cluster parameters in PowerShell](virtual-machines-windows-portal-sql-availability-group-tutorial.md#setparam).</span></span>

<span data-ttu-id="1d812-174">Exécuter le script PowerShell de hello avec le nom réseau du cluster hello, adresse IP et port de la sonde que vous avez configurés sur l’équilibrage de charge hello dans la nouvelle région de hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-174">Run hello PowerShell script with hello cluster network name, IP address, and probe port that you configured on hello load balancer in hello new region.</span></span>

   ```PowerShell
   $ClusterNetworkName = "<MyClusterNetworkName>" # hello cluster name for hello network in hello new region (Use Get-ClusterNetwork on Windows Server 2012 of higher toofind hello name).
   $IPResourceName = "<IPResourceName>" # hello cluster name for hello new IP Address resource.
   $ILBIP = “<n.n.n.n>” # hello IP Address of hello Internal Load Balancer (ILB) in hello new region. This is hello static IP address for hello load balancer you configured in hello Azure portal.
   [int]$ProbePort = <nnnnn> # hello probe port you set on hello ILB.

   Import-Module FailoverClusters

   Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$ILBIP";"ProbePort"=$ProbePort;"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"EnableDhcp"=0}
   ```

## <a name="set-connection-for-multiple-subnets"></a><span data-ttu-id="1d812-175">Configurer la connexion à plusieurs sous-réseaux</span><span class="sxs-lookup"><span data-stu-id="1d812-175">Set connection for multiple subnets</span></span>

<span data-ttu-id="1d812-176">la réplication Hello dans le centre de données distant hello fait partie du groupe de disponibilité hello, mais il est dans un sous-réseau différent.</span><span class="sxs-lookup"><span data-stu-id="1d812-176">hello replica in hello remote data center is part of hello availability group but it is in a different subnet.</span></span> <span data-ttu-id="1d812-177">Si ce réplica devienne le réplica principal de hello, les délais de connexion d’application peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="1d812-177">If this replica becomes hello primary replica, application connection time-outs may occur.</span></span> <span data-ttu-id="1d812-178">Ce comportement est hello identique à un groupe de disponibilité local dans un déploiement de sous-réseaux multiples.</span><span class="sxs-lookup"><span data-stu-id="1d812-178">This behavior is hello same as an on-premises availability group in a multi-subnet deployment.</span></span> <span data-ttu-id="1d812-179">tooallow des connexions à partir d’applications clientes, mettre à jour de la connexion du client hello ou configurer la résolution de nom sur la ressource de nom de réseau de clusters hello la mise en cache.</span><span class="sxs-lookup"><span data-stu-id="1d812-179">tooallow connections from client applications, either update hello client connection or configure name resolution caching on hello cluster network name resource.</span></span>

<span data-ttu-id="1d812-180">De préférence, mettre à jour tooset de chaînes de connexion de client hello `MultiSubnetFailover=Yes`.</span><span class="sxs-lookup"><span data-stu-id="1d812-180">Preferably, update hello client connection strings tooset `MultiSubnetFailover=Yes`.</span></span> <span data-ttu-id="1d812-181">Consultez [Connexion à MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span><span class="sxs-lookup"><span data-stu-id="1d812-181">See [Connecting With MultiSubnetFailover](http://msdn.microsoft.com/library/gg471494#Anchor_0).</span></span>

<span data-ttu-id="1d812-182">Si vous ne pouvez pas modifier les chaînes de connexion hello, vous pouvez configurer la mise en cache de résolution de nom.</span><span class="sxs-lookup"><span data-stu-id="1d812-182">If you cannot modify hello connection strings, you can configure name resolution caching.</span></span> <span data-ttu-id="1d812-183">Consultez [Connection Timeouts in Multi-subnet Availability Group (Délais d’expiration de la connexion dans le groupe de disponibilité de plusieurs sous-réseaux)](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/).</span><span class="sxs-lookup"><span data-stu-id="1d812-183">See [Connection Timeouts in Multi-subnet Availability Group](http://blogs.msdn.microsoft.com/alwaysonpro/2014/06/03/connection-timeouts-in-multi-subnet-availability-group/).</span></span>

## <a name="fail-over-tooremote-region"></a><span data-ttu-id="1d812-184">Basculer la région tooremote</span><span class="sxs-lookup"><span data-stu-id="1d812-184">Fail over tooremote region</span></span>

<span data-ttu-id="1d812-185">tootest écouteur connectivité toohello distant région, vous pouvez basculer région de hello réplica toohello à distance.</span><span class="sxs-lookup"><span data-stu-id="1d812-185">tootest listener connectivity toohello remote region, you can fail over hello replica toohello remote region.</span></span> <span data-ttu-id="1d812-186">Alors que le réplica de hello est asynchrone, le basculement est vulnérable toopotential une perte de données.</span><span class="sxs-lookup"><span data-stu-id="1d812-186">While hello replica is asynchronous, failover is vulnerable toopotential data loss.</span></span> <span data-ttu-id="1d812-187">toofail sur sans perte de données, modifiez toosynchronous de mode de disponibilité hello puis tooautomatic de mode de basculement hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-187">toofail over without data loss, change hello availability mode toosynchronous and set hello failover mode tooautomatic.</span></span> <span data-ttu-id="1d812-188">Utilisez hello comme suit :</span><span class="sxs-lookup"><span data-stu-id="1d812-188">Use hello following steps:</span></span>

1. <span data-ttu-id="1d812-189">Dans **l’Explorateur d’objets**, connectez-vous instance toohello de SQL Server qui héberge le réplica principal de hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-189">In **Object Explorer**, connect toohello instance of SQL Server that hosts hello primary replica.</span></span>
1. <span data-ttu-id="1d812-190">Sous **Groupes de disponibilité AlwaysOn**, **Groupes de disponibilité**, cliquez avec le bouton droit sur votre groupe de disponibilité, puis cliquez sur **Propriétés**.</span><span class="sxs-lookup"><span data-stu-id="1d812-190">Under **AlwaysOn Availability Groups**, **Availability Groups**, right-click your availability group and click **Properties**.</span></span>
1. <span data-ttu-id="1d812-191">Sur hello **général** sous **réplicas de disponibilité**, jeu de réplica de secondaire hello dans toouse de site de récupération d’urgence de hello **validation synchrone** mode de disponibilité et **Automatique** le mode de basculement.</span><span class="sxs-lookup"><span data-stu-id="1d812-191">On hello **General** page, under **Availability Replicas**, set hello secondary replica in hello DR site toouse **Synchronous Commit** availability mode and **Automatic** failover mode.</span></span>
1. <span data-ttu-id="1d812-192">Si vous avez un réplica secondaire dans le même site que votre réplica principal pour la haute disponibilité, définissez ce réplica trop**validation asynchrone** et **manuel**.</span><span class="sxs-lookup"><span data-stu-id="1d812-192">If you have a secondary replica in same site as your primary replica for high availability, set this replica too**Asynchronous Commit** and **Manual**.</span></span>
1. <span data-ttu-id="1d812-193">Cliquez sur OK.</span><span class="sxs-lookup"><span data-stu-id="1d812-193">Click OK.</span></span>
1. <span data-ttu-id="1d812-194">Dans **l’Explorateur d’objets**, cliquez sur le groupe de disponibilité hello, puis cliquez sur **afficher le tableau de bord**.</span><span class="sxs-lookup"><span data-stu-id="1d812-194">In **Object Explorer**, right-click hello availability group, and click **Show Dashboard**.</span></span>
1. <span data-ttu-id="1d812-195">Tableau de bord de hello, vérifiez que hello réplica sur le site de récupération d’urgence de hello est synchronisé.</span><span class="sxs-lookup"><span data-stu-id="1d812-195">On hello dashboard, verify that hello replica on hello DR site is synchronized.</span></span>
1. <span data-ttu-id="1d812-196">Dans **l’Explorateur d’objets**, cliquez sur le groupe de disponibilité hello, puis cliquez sur **basculement...** . SQL Server Management Studio s’ouvre un Assistant toofail sur SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1d812-196">In **Object Explorer**, right-click hello availability group, and click **Failover...**. SQL Server Management Studios opens a wizard toofail over SQL Server.</span></span>  
1. <span data-ttu-id="1d812-197">Cliquez sur **suivant**et l’instance de SQL Server hello select dans le site de récupération d’urgence de hello.</span><span class="sxs-lookup"><span data-stu-id="1d812-197">Click **Next**, and select hello SQL Server instance in hello DR site.</span></span> <span data-ttu-id="1d812-198">Cliquez à nouveau sur **Suivant** .</span><span class="sxs-lookup"><span data-stu-id="1d812-198">Click **Next** again.</span></span>
1. <span data-ttu-id="1d812-199">Connecter l’instance de SQL Server toohello dans le site de récupération d’urgence de hello et cliquez sur **suivant**.</span><span class="sxs-lookup"><span data-stu-id="1d812-199">Connect toohello SQL Server instance in hello DR site and click **Next**.</span></span>
1. <span data-ttu-id="1d812-200">Sur hello **Résumé** page, vérifiez les paramètres de hello et cliquez sur **Terminer**.</span><span class="sxs-lookup"><span data-stu-id="1d812-200">On hello **Summary** page, verify hello settings and click **Finish**.</span></span>

<span data-ttu-id="1d812-201">Après le test de connectivité, déplacez hello réplica principal précédent tooyour principal Datacenter et définir hello disponibilité mode retour tootheir des paramètres de fonctionnement normales.</span><span class="sxs-lookup"><span data-stu-id="1d812-201">After testing connectivity, move hello primary replica back tooyour primary data center and set hello availability mode back tootheir normal operating settings.</span></span> <span data-ttu-id="1d812-202">Hello tableau suivant montre les paramètres opérationnels normal hello pour architecture hello décrites dans ce document :</span><span class="sxs-lookup"><span data-stu-id="1d812-202">hello following table shows hello normal operational settings for hello architecture described in this document:</span></span>

| <span data-ttu-id="1d812-203">Lieu</span><span class="sxs-lookup"><span data-stu-id="1d812-203">Location</span></span> | <span data-ttu-id="1d812-204">Instance de serveur</span><span class="sxs-lookup"><span data-stu-id="1d812-204">Server Instance</span></span> | <span data-ttu-id="1d812-205">Rôle</span><span class="sxs-lookup"><span data-stu-id="1d812-205">Role</span></span> | <span data-ttu-id="1d812-206">Mode de disponibilité</span><span class="sxs-lookup"><span data-stu-id="1d812-206">Availability Mode</span></span> | <span data-ttu-id="1d812-207">Mode de basculement</span><span class="sxs-lookup"><span data-stu-id="1d812-207">Failover Mode</span></span>
| ----- | ----- | ----- | ----- | -----
| <span data-ttu-id="1d812-208">Centre de données principal</span><span class="sxs-lookup"><span data-stu-id="1d812-208">Primary data center</span></span> | <span data-ttu-id="1d812-209">SQL-1</span><span class="sxs-lookup"><span data-stu-id="1d812-209">SQL-1</span></span> | <span data-ttu-id="1d812-210">Primaire</span><span class="sxs-lookup"><span data-stu-id="1d812-210">Primary</span></span> | <span data-ttu-id="1d812-211">Synchrone</span><span class="sxs-lookup"><span data-stu-id="1d812-211">Synchronous</span></span> | <span data-ttu-id="1d812-212">Automatique</span><span class="sxs-lookup"><span data-stu-id="1d812-212">Automatic</span></span>
| <span data-ttu-id="1d812-213">Centre de données principal</span><span class="sxs-lookup"><span data-stu-id="1d812-213">Primary data center</span></span> | <span data-ttu-id="1d812-214">SQL-2</span><span class="sxs-lookup"><span data-stu-id="1d812-214">SQL-2</span></span> | <span data-ttu-id="1d812-215">Secondaire</span><span class="sxs-lookup"><span data-stu-id="1d812-215">Secondary</span></span> | <span data-ttu-id="1d812-216">Synchrone</span><span class="sxs-lookup"><span data-stu-id="1d812-216">Synchronous</span></span> | <span data-ttu-id="1d812-217">Automatique</span><span class="sxs-lookup"><span data-stu-id="1d812-217">Automatic</span></span>
| <span data-ttu-id="1d812-218">Centre de données secondaire ou distant</span><span class="sxs-lookup"><span data-stu-id="1d812-218">Secondary or remote data center</span></span> | <span data-ttu-id="1d812-219">SQL-3</span><span class="sxs-lookup"><span data-stu-id="1d812-219">SQL-3</span></span> | <span data-ttu-id="1d812-220">Secondaire</span><span class="sxs-lookup"><span data-stu-id="1d812-220">Secondary</span></span> | <span data-ttu-id="1d812-221">Asynchrone</span><span class="sxs-lookup"><span data-stu-id="1d812-221">Asynchronous</span></span> | <span data-ttu-id="1d812-222">Manuel</span><span class="sxs-lookup"><span data-stu-id="1d812-222">Manual</span></span>


### <a name="more-information-about-planned-and-forced-manual-failover"></a><span data-ttu-id="1d812-223">Plus d’informations sur le basculement manuel forcé et planifié</span><span class="sxs-lookup"><span data-stu-id="1d812-223">More information about planned and forced manual failover</span></span>

<span data-ttu-id="1d812-224">Pour plus d’informations, consultez hello rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="1d812-224">For more information, see hello following topics:</span></span>

- [<span data-ttu-id="1d812-225">Effectuer un basculement manuel planifié d'un groupe de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1d812-225">Perform a Planned Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/hh231018.aspx)
- [<span data-ttu-id="1d812-226">Effectuer un basculement manuel forcé d'un groupe de disponibilité (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="1d812-226">Perform a Forced Manual Failover of an Availability Group (SQL Server)</span></span>](http://msdn.microsoft.com/library/ff877957.aspx)

## <a name="additional-links"></a><span data-ttu-id="1d812-227">Liens supplémentaires</span><span class="sxs-lookup"><span data-stu-id="1d812-227">Additional Links</span></span>

* [<span data-ttu-id="1d812-228">Groupes de disponibilité AlwaysOn</span><span class="sxs-lookup"><span data-stu-id="1d812-228">Always On Availability Groups</span></span>](http://msdn.microsoft.com/library/hh510230.aspx)
* [<span data-ttu-id="1d812-229">Azure Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="1d812-229">Azure Virtual Machines</span></span>](http://docs.microsoft.com/azure/virtual-machines/windows/)
* [<span data-ttu-id="1d812-230">Équilibrages de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1d812-230">Azure Load Balancers</span></span>](virtual-machines-windows-portal-sql-availability-group-tutorial.md#configure-internal-load-balancer)
* [<span data-ttu-id="1d812-231">Groupes à haute disponibilité Azure</span><span class="sxs-lookup"><span data-stu-id="1d812-231">Azure Availability Sets</span></span>](../manage-availability.md)
