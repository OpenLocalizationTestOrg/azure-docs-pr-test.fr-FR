---
title: aaaAdd tooan de surveillance et de diagnostics machine virtuelle Azure | Documents Microsoft
description: "Utilisez un toocreate de modèle Azure resource manager une machine virtuelle Windows avec l’extension Azure diagnostics."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="9a91a-103">Utiliser la surveillance et les diagnostics avec une machine virtuelle Windows et des modèles Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="9a91a-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="9a91a-104">Hello Extension des Diagnostics Azure fournit de surveillance de hello et fonctionnalités des diagnostics sur un Windows basée sur machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="9a91a-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="9a91a-105">Vous pouvez activer ces fonctionnalités sur l’ordinateur virtuel de hello en incluant l’extension de hello en tant que partie du modèle de gestionnaire de Ressources azure hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="9a91a-106">Pour plus d’informations sur l’ajout d’une extension dans un modèle de machine virtuelle, consultez [Création de modèles Azure Resource Manager avec des extensions de machine virtuelle](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) .</span><span class="sxs-lookup"><span data-stu-id="9a91a-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="9a91a-107">Cet article décrit comment vous pouvez ajouter le modèle d’ordinateur virtuel windows hello Azure Diagnostics extension tooa.</span><span class="sxs-lookup"><span data-stu-id="9a91a-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="9a91a-108">Ajouter une définition de ressource de hello Azure Diagnostics extension toohello machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="9a91a-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="9a91a-109">extension de diagnostics tooenable hello sur une Machine virtuelle Windows vous avez besoin d’une extension de hello tooadd comme une ressource de machine virtuelle dans hello modèle de gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="9a91a-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="9a91a-110">Pour un gestionnaire de ressources simple basée sur Machine virtuelle ajouter hello extension configuration toohello *ressources* tableau hello Machine virtuelle :</span><span class="sxs-lookup"><span data-stu-id="9a91a-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="9a91a-111">Une autre convention commune est ajouter la configuration de l’extension hello au nœud de ressources hello racine du modèle hello au lieu de définir sous le nœud de ressources de l’ordinateur virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="9a91a-112">Avec cette approche vous avez tooexplicitly spécifier une relation hiérarchique entre les extension hello et ordinateur virtuel de hello avec hello *nom* et *type* valeurs.</span><span class="sxs-lookup"><span data-stu-id="9a91a-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="9a91a-113">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="9a91a-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="9a91a-114">Hello extension est toujours associée hello virtual machine, vous pouvez directement définir directement sous le nœud de la ressource d’ordinateur virtuel de hello ou définir au niveau de base hello et utiliser hello tooassociate d’une convention d’affectation de noms hiérarchique avec hello virtuel ordinateur.</span><span class="sxs-lookup"><span data-stu-id="9a91a-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="9a91a-115">Pour les extensions de machines virtuelles identiques hello configuration est spécifiée dans hello *extensionProfile* propriété Hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="9a91a-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="9a91a-116">Hello *publisher* propriété avec la valeur hello **Microsoft.Azure.Diagnostics** et hello *type* propriété avec la valeur hello **IaaSDiagnostics** identifier extension des Diagnostics Windows Azure hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="9a91a-117">Hello valeur Hello *nom* propriété peut avoir l’extension de toohello toorefer utilisés dans le groupe de ressources hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="9a91a-118">Paramètre spécifiquement trop**Microsoft.Insights.VMDiagnosticsSettings** Active toobe facilement identifié par hello garantissant portail Azure hello analyse graphiques qui s’affichent correctement dans hello portail Azure.</span><span class="sxs-lookup"><span data-stu-id="9a91a-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="9a91a-119">Hello *typeHandlerVersion* spécifie la version de hello d’extension de hello vous aimeriez toouse.</span><span class="sxs-lookup"><span data-stu-id="9a91a-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="9a91a-120">Paramètre *autoUpgradeMinorVersion* version mineure trop**true** permet de s’assurer que vous obtenez hello dernière version mineure du extension hello qui est disponible.</span><span class="sxs-lookup"><span data-stu-id="9a91a-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="9a91a-121">Il est fortement recommandé de toujours définir *autoUpgradeMinorVersion* tooalways être **true** afin que vous obtenez toujours toouse hello plus récente disponible extension diagnostics avec toutes les nouvelles fonctionnalités de hello et le bogue correctifs.</span><span class="sxs-lookup"><span data-stu-id="9a91a-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="9a91a-122">Hello *paramètres* élément contient des propriétés de configurations pour l’extension hello qui peut être défini et lire à partir de l’extension hello (parfois désignée tooas publique configuration).</span><span class="sxs-lookup"><span data-stu-id="9a91a-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="9a91a-123">Hello *xmlcfg* propriété contient la configuration basée sur xml pour les journaux de diagnostics hello, etc. qui seront collectées par l’agent de diagnostics hello les compteurs de performance.</span><span class="sxs-lookup"><span data-stu-id="9a91a-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="9a91a-124">Consultez [schéma de Configuration de Diagnostics](https://msdn.microsoft.com/library/azure/dn782207.aspx) pour plus d’informations sur le schéma xml de hello lui-même.</span><span class="sxs-lookup"><span data-stu-id="9a91a-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="9a91a-125">Une pratique courante consiste toostore hello réelle de configuration xml comme base64 de variable dans le modèle de gestionnaire de ressources Azure hello et puis concaténer les encoder valeur hello tooset *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="9a91a-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="9a91a-126">Consultez la section de hello sur [les variables de configuration de diagnostics](#diagnostics-configuration-variables) toounderstand plus en détail comment toostore hello xml dans des variables.</span><span class="sxs-lookup"><span data-stu-id="9a91a-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="9a91a-127">Hello *storageAccount* propriété spécifie le nom hello hello stockage compte toowhich des données de diagnostic est transférée.</span><span class="sxs-lookup"><span data-stu-id="9a91a-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="9a91a-128">Hello propriétés dans *protectedSettings* (parfois désignée tooas privé configuration) peut être définie, mais ne peut pas être lu à la suite en cours de définition.</span><span class="sxs-lookup"><span data-stu-id="9a91a-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="9a91a-129">Hello nature en écriture seule de *protectedSettings* permet de stocker des secrets, comme clé de compte de stockage hello où les données de diagnostic hello seront écrit.</span><span class="sxs-lookup"><span data-stu-id="9a91a-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="9a91a-130">Spécification du compte de stockage de diagnostics en tant que paramètres</span><span class="sxs-lookup"><span data-stu-id="9a91a-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="9a91a-131">Hello diagnostics extension json extrait de code ci-dessus suppose que deux paramètres *existingdiagnosticsStorageAccountName* et *existingdiagnosticsStorageResourceGroup* diagnostics de hello toospecify compte de stockage où les données de diagnostic seront stockées.</span><span class="sxs-lookup"><span data-stu-id="9a91a-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="9a91a-132">Spécification de compte de stockage de diagnostics hello comme un paramètre rend compte de stockage de diagnostics hello toochange facile entre les différents environnements par exemple, vous souhaiterez peut-être toouse un compte de stockage différents tests de diagnostic pour le test et une autre pour votre déploiement de production.</span><span class="sxs-lookup"><span data-stu-id="9a91a-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="9a91a-133">Il s’agit des meilleures pratiques toospecify un compte de stockage de diagnostics dans un autre groupe de ressources que le groupe de ressources hello pour la machine virtuelle de hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="9a91a-134">Un groupe de ressources peut être considéré comme une unité de déploiement avec sa propre durée de vie de toobe, un ordinateur virtuel peut être déployé et redéployé lors des nouvelles mises à jour des configurations il tooit, mais vous souhaiterez peut-être toocontinue le stockage des données de diagnostic hello Bonjour même compte de stockage dans les déploiements d’ordinateurs virtuels.</span><span class="sxs-lookup"><span data-stu-id="9a91a-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="9a91a-135">Avoir un compte de stockage hello dans un compte hello stockage de ressources différent Active tooaccept de données à partir de différents déploiements de machine virtuelle rend facile tootroubleshoot problèmes sur hello différentes versions.</span><span class="sxs-lookup"><span data-stu-id="9a91a-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="9a91a-136">Si vous créez un modèle d’ordinateur virtuel windows à partir de Visual Studio compte de stockage par défaut hello peut être défini toouse hello même compte de stockage où la machine virtuelle de hello disque dur virtuel est téléchargé.</span><span class="sxs-lookup"><span data-stu-id="9a91a-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="9a91a-137">Il s’agit de la configuration initiale toosimplify Hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9a91a-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="9a91a-138">Vous devez refactoriser hello modèle toouse un autre compte de stockage qui peut être passé comme un paramètre.</span><span class="sxs-lookup"><span data-stu-id="9a91a-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="9a91a-139">Variables de configuration des diagnostics</span><span class="sxs-lookup"><span data-stu-id="9a91a-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="9a91a-140">Hello diagnostics extension json extrait de code ci-dessus définit un *accountid* toosimplify variable mise en route de la clé de compte de stockage hello pour le stockage de diagnostics hello :</span><span class="sxs-lookup"><span data-stu-id="9a91a-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="9a91a-141">Hello *xmlcfg* propriété pour l’extension de diagnostics hello est définie à l’aide de plusieurs variables qui sont concaténées.</span><span class="sxs-lookup"><span data-stu-id="9a91a-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="9a91a-142">les valeurs Hello de ces variables sont en xml donc toobe échappé correctement lors de la définition des variables de json hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="9a91a-143">la section suivante de Hello décrit xml de configuration de diagnostics hello qui collecte des compteurs de performance au niveau système standard, ainsi que des journaux des événements windows et les journaux d’infrastructure de diagnostics.</span><span class="sxs-lookup"><span data-stu-id="9a91a-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="9a91a-144">Il a été échappé et mise en forme correctement afin que hello configuration peut directement être collée dans la section de variables hello de votre modèle.</span><span class="sxs-lookup"><span data-stu-id="9a91a-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="9a91a-145">Consultez hello [schéma de Configuration de Diagnostics](https://msdn.microsoft.com/library/azure/dn782207.aspx) pour obtenir un exemple plu lisible hello configuration XML.</span><span class="sxs-lookup"><span data-stu-id="9a91a-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="9a91a-146">nœud de xml de définition de métriques Hello Bonjour au-dessus de configuration est un élément de configuration importantes car elle définit la façon dont les compteurs de performance hello définis précédemment dans xml hello dans *PerformanceCounter* nœud est agrégé et stockées.</span><span class="sxs-lookup"><span data-stu-id="9a91a-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="9a91a-147">Ces mesures lecteur hello alertes Bonjour portail Azure et les graphiques d’analyse.</span><span class="sxs-lookup"><span data-stu-id="9a91a-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="9a91a-148">Hello **métriques** nœud avec hello *resourceID* et **MetricAggregation** doit être inclus dans la configuration des diagnostics hello pour votre machine virtuelle si vous souhaitez toosee hello machine virtuelle données d’analyse Bonjour portail Azure.</span><span class="sxs-lookup"><span data-stu-id="9a91a-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="9a91a-149">Hello Voici un exemple de code xml de hello pour les définitions de métriques :</span><span class="sxs-lookup"><span data-stu-id="9a91a-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="9a91a-150">Hello *resourceID* attribut identifie de façon unique machine virtuelle de hello dans votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="9a91a-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="9a91a-151">Assurez-vous que subscription() de hello toouse et resourceGroup() fonctions afin que hello modèle met automatiquement à jour ces valeurs basées sur le groupe d’abonnement et de ressources hello que vous effectuez le déploiement.</span><span class="sxs-lookup"><span data-stu-id="9a91a-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="9a91a-152">Si vous créez plusieurs Machines virtuelles dans une boucle, vous devez toopopulate hello *resourceID* valeur avec un toocorrectly de fonction copyIndex() différencier chaque machine virtuelle individuelle.</span><span class="sxs-lookup"><span data-stu-id="9a91a-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="9a91a-153">Hello *xmlCfg* valeur peut être mis à jour toosupport cela comme suit :</span><span class="sxs-lookup"><span data-stu-id="9a91a-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="9a91a-154">Hello valeur MetricAggregation *PT1H* et *PT1M* constitue une agrégation sur une minute et une agrégation sur une heure.</span><span class="sxs-lookup"><span data-stu-id="9a91a-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="9a91a-155">Tables WADMetrics dans le stockage</span><span class="sxs-lookup"><span data-stu-id="9a91a-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="9a91a-156">configuration des métriques Hello ci-dessus génère les tables dans votre compte de stockage de diagnostics avec hello suit les conventions d’affectation de noms :</span><span class="sxs-lookup"><span data-stu-id="9a91a-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="9a91a-157">**WADMetrics** : préfixe standard pour toutes les tables WADMetrics</span><span class="sxs-lookup"><span data-stu-id="9a91a-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="9a91a-158">**PT1H** ou **PT1M** : signifie que la table hello contient des données agrégées en 1 heure ou 1 minute</span><span class="sxs-lookup"><span data-stu-id="9a91a-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="9a91a-159">**P10D** : désigne la table de hello contiendra les données de 10 jours à partir de la table de hello démarrage de collecte de données</span><span class="sxs-lookup"><span data-stu-id="9a91a-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="9a91a-160">**V2S** : constante de chaîne</span><span class="sxs-lookup"><span data-stu-id="9a91a-160">**V2S** : String constant</span></span>
* <span data-ttu-id="9a91a-161">**AAAAMMJJ** : date hello à quels hello table démarré la collecte de données</span><span class="sxs-lookup"><span data-stu-id="9a91a-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="9a91a-162">Exemple : *WADMetricsPT1HP10DV2S20151108* contient les données de mesures agrégées pendant une heure et pour une période de 10 jours commençant le 11 novembre 2015</span><span class="sxs-lookup"><span data-stu-id="9a91a-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="9a91a-163">Chaque table WADMetrics contiendra hello suivant des colonnes :</span><span class="sxs-lookup"><span data-stu-id="9a91a-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="9a91a-164">**PartitionKey**: hello partitionkey est créée en fonction de hello *resourceID* valeur toouniquely identifier la ressource de machine virtuelle hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="9a91a-165">Par exemple : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="9a91a-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="9a91a-166">**RowKey** : format de hello suit <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="9a91a-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="9a91a-167">Hello décroissant réapprovisionnement graduation est graduations temps max moins de temps hello du début de hello de période de globalisation hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="9a91a-168">Par exemple,</span><span class="sxs-lookup"><span data-stu-id="9a91a-168">E.g.</span></span> <span data-ttu-id="9a91a-169">Si la période d’échantillonnage hello démarré novembre-10-2015 et calcul de UTC puis hello 00:00Hrs serait : DateTime.MaxValue.Ticks - (DateTime(2015,11,10,0,0,0,DateTimeKind.Utc) de nouveau. Graduations).</span><span class="sxs-lookup"><span data-stu-id="9a91a-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="9a91a-170">Pour la recherche de clé de ligne hello compteur de performance de hello mémoire octets disponibles telles que : 2519551871999999999__:005CMemory:005CAvailable:0020 octets</span><span class="sxs-lookup"><span data-stu-id="9a91a-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="9a91a-171">**CounterName** : nom hello hello du compteur de performance.</span><span class="sxs-lookup"><span data-stu-id="9a91a-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="9a91a-172">Cela correspond à hello *counterSpecifier* défini dans la configuration xml de hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="9a91a-173">**Maximale** : hello valeur maximale du compteur de performances hello période hello d’agrégation.</span><span class="sxs-lookup"><span data-stu-id="9a91a-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="9a91a-174">**Minimum** : hello valeur minimale hello du compteur de performance sur la période de globalisation hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="9a91a-175">**Total** : somme de hello de toutes les valeurs de compteur de performance hello indiquée sur la période de globalisation hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="9a91a-176">**Nombre** : nombre total de hello de valeurs signalées pour le compteur de performances hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="9a91a-177">**Moyenne** : hello valeur moyenne (total/nombre) hello du compteur de performance sur la période de globalisation hello.</span><span class="sxs-lookup"><span data-stu-id="9a91a-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9a91a-178">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9a91a-178">Next Steps</span></span>
* <span data-ttu-id="9a91a-179">Pour un exemple de modèle complet d’une machine virtuelle Windows avec l’extension Diagnostics, consultez [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="9a91a-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="9a91a-180">Déployer le modèle de gestionnaire de ressources hello avec [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) ou [ligne de commande Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="9a91a-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="9a91a-181">En savoir plus sur la [création de modèles Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="9a91a-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>

