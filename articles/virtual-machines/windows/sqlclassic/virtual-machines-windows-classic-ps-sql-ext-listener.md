---
title: "Configurer un écouteur externe pour des groupes de disponibilité Always On | Microsoft Docs"
description: "Ce didacticiel vous guide tout au long des étapes de création d’un écouteur de groupe de disponibilité Always On dans Azure qui est accessible en externe à l’aide de l’adresse IP virtuelle publique du service cloud associé."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 8e506be42aea4fb3c48c29b771a78dcf694f4518
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="73d94-103">Configurer un écouteur externe pour les groupes de disponibilité Always On dans Azure</span><span class="sxs-lookup"><span data-stu-id="73d94-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="73d94-104">Écouteur interne</span><span class="sxs-lookup"><span data-stu-id="73d94-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="73d94-105">Écouteur externe</span><span class="sxs-lookup"><span data-stu-id="73d94-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="73d94-106">Cette rubrique explique comment configurer un écouteur pour un groupe de disponibilité Always On accessible en externe sur Internet.</span><span class="sxs-lookup"><span data-stu-id="73d94-106">This topic shows you how to configure a listener for an Always On Availability Group that is externally accessible on the internet.</span></span> <span data-ttu-id="73d94-107">Il est possible d’associer l’ **adresse IP virtuelle publique** du service cloud à l’écouteur.</span><span class="sxs-lookup"><span data-stu-id="73d94-107">This is made possible by associating the cloud service's **public Virtual IP (VIP)** address with the listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="73d94-108">Azure dispose de deux modèles de déploiement différents pour créer et utiliser des ressources : [le déploiement Resource Manager et le déploiement classique](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="73d94-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="73d94-109">Cet article traite du modèle de déploiement classique.</span><span class="sxs-lookup"><span data-stu-id="73d94-109">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="73d94-110">Pour la plupart des nouveaux déploiements, Microsoft recommande d’utiliser le modèle Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="73d94-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="73d94-111">Votre groupe de disponibilité peut contenir des réplicas locaux uniquement, Azure uniquement, ou locaux et Azure pour les configurations hybrides.</span><span class="sxs-lookup"><span data-stu-id="73d94-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="73d94-112">Les réplicas Azure peuvent se trouver dans une même région ou dans plusieurs régions grâce à plusieurs réseaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="73d94-112">Azure replicas can reside within the same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="73d94-113">Les étapes suivantes supposent que vous avez déjà [configuré un groupe de disponibilité](../classic/portal-sql-alwayson-availability-groups.md), mais pas un écouteur.</span><span class="sxs-lookup"><span data-stu-id="73d94-113">The steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="73d94-114">Instructions et limitations pour les écouteurs externes</span><span class="sxs-lookup"><span data-stu-id="73d94-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="73d94-115">Notez que les instructions suivantes s'appliquent pour l'écouteur du groupe de disponibilité dans Azure lorsque vous effectuez un déploiement à l'aide de l'adresse IP virtuelle publique du service cloud :</span><span class="sxs-lookup"><span data-stu-id="73d94-115">Note the following guidelines about the availability group listener in Azure when you are deploying using the cloud service pubic VIP address:</span></span>

* <span data-ttu-id="73d94-116">L'écouteur du groupe de disponibilité est pris en charge sur Windows Server 2008 R2, Windows Server 2012 et Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="73d94-116">The availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="73d94-117">L'application cliente doit se trouver dans un service cloud différent de celui qui contient vos machines virtuelles de groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="73d94-117">The client application must reside on a different cloud service than the one that contains your availability group VMs.</span></span> <span data-ttu-id="73d94-118">Azure ne prend pas en charge le retour direct du serveur avec un client et un serveur se trouvant dans le même service cloud.</span><span class="sxs-lookup"><span data-stu-id="73d94-118">Azure does not support direct server return with client and server in the same cloud service.</span></span>
* <span data-ttu-id="73d94-119">Par défaut, les étapes décrites dans cet article montrent comment configurer un écouteur pour utiliser l'adresse IP virtuelle (VIP) du service cloud.</span><span class="sxs-lookup"><span data-stu-id="73d94-119">By default, the steps in this article show how to configure one listener to use the cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="73d94-120">Toutefois, il est possible de réserver et de créer plusieurs adresses IP virtuelles pour votre service cloud.</span><span class="sxs-lookup"><span data-stu-id="73d94-120">However, it is possible to reserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="73d94-121">Cela vous permet d'utiliser les étapes dans cet article pour créer plusieurs écouteurs associés à une adresse IP virtuelle différente.</span><span class="sxs-lookup"><span data-stu-id="73d94-121">This enables you to use the steps in this article to create multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="73d94-122">Pour plus d'informations sur la création de plusieurs adresses IP virtuelles, consultez la section [Plusieurs adresses IP virtuelles par service cloud](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="73d94-122">For information on how to create multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="73d94-123">Si vous créez un écouteur pour un environnement hybride, le réseau local doit disposer de la connectivité à l'Internet public en plus du VPN de site à site avec le réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="73d94-123">If you are creating a listener for a hybrid environment, the on-premises network must have connectivity to the public Internet in addition to the site-to-site VPN with the Azure virtual network.</span></span> <span data-ttu-id="73d94-124">Dans le sous-réseau Azure, l'écouteur du groupe de disponibilité est accessible uniquement par l'adresse IP publique du service cloud respectif.</span><span class="sxs-lookup"><span data-stu-id="73d94-124">When in the Azure subnet, the availability group listener is reachable only by the public IP address of the respective cloud service.</span></span>
* <span data-ttu-id="73d94-125">La création d’un écouteur externe dans un service cloud dans lequel vous avez également un écouteur interne n'est pas prise en charge avec l'équilibrage de charge interne.</span><span class="sxs-lookup"><span data-stu-id="73d94-125">It is not supported to create an external listener in the same cloud service where you also have an internal listener using the Internal Load Balancer (ILB).</span></span>

## <a name="determine-the-accessibility-of-the-listener"></a><span data-ttu-id="73d94-126">Déterminer l'accessibilité de l'écouteur</span><span class="sxs-lookup"><span data-stu-id="73d94-126">Determine the accessibility of the listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="73d94-127">Cet article se concentre sur la création d’un écouteur qui utilise un **équilibrage de charge externe**.</span><span class="sxs-lookup"><span data-stu-id="73d94-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="73d94-128">Si vous souhaitez un écouteur qui est privé sur votre réseau virtuel, consultez la version de cet article qui explique comment configurer un [écouteur avec équilibrage de charge interne](../classic/ps-sql-int-listener.md)</span><span class="sxs-lookup"><span data-stu-id="73d94-128">If you want a listener that is private to your virtual network, see the version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="73d94-129">Créer des points de terminaison de machine virtuelle à charge équilibrée avec retour direct du serveur</span><span class="sxs-lookup"><span data-stu-id="73d94-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="73d94-130">L'équilibrage de charge externe utilise l'adresse IP virtuelle publique du service cloud qui héberge vos machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="73d94-130">External load balancing uses the virtual the public Virtual IP address of the cloud service that hosts your VMs.</span></span> <span data-ttu-id="73d94-131">Par conséquent, vous n'avez besoin créer ou configurer l'équilibrage de charge dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="73d94-131">So you do not need to create or configure the load balancer in this case.</span></span>

<span data-ttu-id="73d94-132">Vous devez créer un point de terminaison avec équilibrage de charge pour chaque machine virtuelle qui héberge un réplica Azure.</span><span class="sxs-lookup"><span data-stu-id="73d94-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="73d94-133">Si vous avez des réplicas dans plusieurs régions, chaque réplica de cette région doit se trouver dans le même service cloud sur le même réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="73d94-133">If you have replicas in multiple regions, each replica for that region must be in the same cloud service in the same VNet.</span></span> <span data-ttu-id="73d94-134">La création de réplicas de groupe de disponibilité couvrant plusieurs régions Azure nécessite de configurer plusieurs réseaux virtuels.</span><span class="sxs-lookup"><span data-stu-id="73d94-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="73d94-135">Pour plus d’informations sur la configuration de la connectivité de réseau virtuel intersites, consultez [Configurer une connexion de réseau virtuel à réseau virtuel](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="73d94-135">For more information on configuring cross VNet connectivity, see  [Configure VNet to VNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="73d94-136">Dans le portail Azure, accédez à chaque machine virtuelle hébergeant un réplica et consultez les détails.</span><span class="sxs-lookup"><span data-stu-id="73d94-136">In the Azure portal, navigate to each VM hosting a replica and view the details.</span></span>
2. <span data-ttu-id="73d94-137">Cliquez sur l'onglet **Points de terminaison** de chacune des machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="73d94-137">Click the **Endpoints** tab for each of the VMs.</span></span>
3. <span data-ttu-id="73d94-138">Vérifiez que le **Nom** et le **Port public** du point de terminaison de l’écouteur ne sont pas déjà utilisés.</span><span class="sxs-lookup"><span data-stu-id="73d94-138">Verify that the **Name** and **Public Port** of the listener endpoint you want to use is not already in use.</span></span> <span data-ttu-id="73d94-139">Dans l'exemple ci-dessous, le nom est « MyEndpoint » et le port est « 1433 ».</span><span class="sxs-lookup"><span data-stu-id="73d94-139">In the example below, the name is “MyEndpoint” and the port is “1433”.</span></span>
4. <span data-ttu-id="73d94-140">Sur votre client local, téléchargez et installez [le dernier module PowerShell](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="73d94-140">On your local client, download and install [the latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="73d94-141">Lancez **Azure PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="73d94-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="73d94-142">Une nouvelle session PowerShell s'ouvre avec les modules d'administration Azure chargés.</span><span class="sxs-lookup"><span data-stu-id="73d94-142">A new PowerShell session is opened with the Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="73d94-143">Exécutez **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="73d94-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="73d94-144">Cette applet de commande vous dirige vers un navigateur de façon à télécharger un fichier de paramètres de publication dans un répertoire local.</span><span class="sxs-lookup"><span data-stu-id="73d94-144">This cmdlet directs you to a browser to download a publish settings file to a local directory.</span></span> <span data-ttu-id="73d94-145">Vous serez peut-être invité à entrer les informations d'identification de connexion de votre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="73d94-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="73d94-146">Exécutez la commande **Import-AzurePublishSettingsFile** avec le chemin d'accès du fichier de paramètres de publication que vous avez téléchargé :</span><span class="sxs-lookup"><span data-stu-id="73d94-146">Run the **Import-AzurePublishSettingsFile** command with the path of the publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="73d94-147">Une fois le fichier de paramètres de publication importé, vous pouvez gérer votre abonnement Azure dans la session PowerShell.</span><span class="sxs-lookup"><span data-stu-id="73d94-147">Once the publish settings file is imported, you can manage your Azure subscription in the PowerShell session.</span></span>
    
1. <span data-ttu-id="73d94-148">Copiez le script PowerShell ci-dessous dans un éditeur de texte et définissez des valeurs de variables adaptées à votre environnement (des valeurs par défaut ont été affectées à certains paramètres).</span><span class="sxs-lookup"><span data-stu-id="73d94-148">Copy the PowerShell script below into a text editor and set the variable values to suit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="73d94-149">Notez que, si votre groupe de disponibilité s'étend sur plusieurs régions Azure, vous devez exécuter le script une fois dans chaque centre de données pour le service cloud et les nœuds qui se trouvent dans ce centre de données.</span><span class="sxs-lookup"><span data-stu-id="73d94-149">Note that if your availability group spans Azure regions, you must run the script once in each datacenter for the cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # the name of the cloud service that contains the availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in the same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="73d94-150">Après avoir défini les variables, copiez le script de l'éditeur de texte dans votre session Azure PowerShell pour l'exécuter.</span><span class="sxs-lookup"><span data-stu-id="73d94-150">Once you have set the variables, copy the script from the text editor into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="73d94-151">Si l'invite affiche >>, appuyez sur Entrée pour vous assurer que le script s'exécute.</span><span class="sxs-lookup"><span data-stu-id="73d94-151">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="73d94-152">Vérifiez que KB2854082 est installé le cas échéant</span><span class="sxs-lookup"><span data-stu-id="73d94-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-the-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="73d94-153">Ouvrez les ports de pare-feu dans des nœuds de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="73d94-153">Open the firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-the-availability-group-listener"></a><span data-ttu-id="73d94-154">Créer l'écouteur de groupe de disponibilité</span><span class="sxs-lookup"><span data-stu-id="73d94-154">Create the availability group listener</span></span>

<span data-ttu-id="73d94-155">Créez l’écouteur de groupe de disponibilité en deux étapes.</span><span class="sxs-lookup"><span data-stu-id="73d94-155">Create the availability group listener in two steps.</span></span> <span data-ttu-id="73d94-156">Tout d’abord, créez la ressource de cluster de point d’accès client et configurez les dépendances.</span><span class="sxs-lookup"><span data-stu-id="73d94-156">First, create the client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="73d94-157">Ensuite, configurez les ressources de cluster avec PowerShell.</span><span class="sxs-lookup"><span data-stu-id="73d94-157">Second, configure the cluster resources with PowerShell.</span></span>

### <a name="create-the-client-access-point-and-configure-the-cluster-dependencies"></a><span data-ttu-id="73d94-158">Créez le point d’accès client et configurez les dépendances de cluster</span><span class="sxs-lookup"><span data-stu-id="73d94-158">Create the client access point and configure the cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-the-cluster-resources-in-powershell"></a><span data-ttu-id="73d94-159">Configurez les ressources de cluster dans PowerShell</span><span class="sxs-lookup"><span data-stu-id="73d94-159">Configure the cluster resources in PowerShell</span></span>
1. <span data-ttu-id="73d94-160">Pour l'équilibrage de charge externe, vous devrez obtenir l'adresse IP virtuelle publique du service cloud qui contient vos réplicas.</span><span class="sxs-lookup"><span data-stu-id="73d94-160">For external load balancing, you must obtain the public virtual IP address of the cloud service that contains your replicas.</span></span> <span data-ttu-id="73d94-161">Connectez-vous au portail Azure.</span><span class="sxs-lookup"><span data-stu-id="73d94-161">Log into the Azure portal.</span></span> <span data-ttu-id="73d94-162">Accédez au service cloud qui contient les machines virtuelles de votre groupe de disponibilité.</span><span class="sxs-lookup"><span data-stu-id="73d94-162">Navigate to the cloud service that contains your availability group VM.</span></span> <span data-ttu-id="73d94-163">Ouvrez le **Tableau de bord** .</span><span class="sxs-lookup"><span data-stu-id="73d94-163">Open the **Dashboard** view.</span></span>
2. <span data-ttu-id="73d94-164">Notez l'adresse affichée sous **Adresse IP virtuelle (VIP) publique**.</span><span class="sxs-lookup"><span data-stu-id="73d94-164">Note the address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="73d94-165">Si votre solution couvre des réseaux virtuels, répétez cette étape pour chaque service cloud contenant une machine virtuelle qui héberge un réplica.</span><span class="sxs-lookup"><span data-stu-id="73d94-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="73d94-166">Copiez le script PowerShell ci-dessous dans un éditeur de texte sur l'une des machines virtuelles et définissez les variables sur les valeurs notées précédemment.</span><span class="sxs-lookup"><span data-stu-id="73d94-166">On one of the VMs, copy the PowerShell script below into a text editor and set the variables to the values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # the cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher to find the name)
        $IPResourceName = "<IPResourceName>" # the IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use the Get-Cluster Resource command. If you are using Windows Server 2008 R2, use the cluster res command. Both commands are commented out. Choose the one applicable to your environment and remove the # at the beginning of the line to convert the comment to an executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="73d94-167">Une fois les variables définies, ouvrez une fenêtre Windows PowerShell avec élévation de privilèges, puis copiez le script de l'éditeur de texte et collez-le dans votre session Azure PowerShell pour l'exécuter.</span><span class="sxs-lookup"><span data-stu-id="73d94-167">Once you have set the variables, open an elevated Windows PowerShell window, then copy the script from the text editor and paste into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="73d94-168">Si l'invite affiche >>, appuyez sur Entrée pour vous assurer que le script s'exécute.</span><span class="sxs-lookup"><span data-stu-id="73d94-168">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>
5. <span data-ttu-id="73d94-169">Répétez cette procédure sur chaque machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="73d94-169">Repeat this on each VM.</span></span> <span data-ttu-id="73d94-170">Ce script configure la ressource Adresse IP avec l'adresse IP du service cloud et définit d'autres paramètres, tels que le port de la  sonde.</span><span class="sxs-lookup"><span data-stu-id="73d94-170">This script configures the IP Address resource with the IP address of the cloud service and sets other parameters like the probe port.</span></span> <span data-ttu-id="73d94-171">Lorsque la ressource d'adresse IP est mise en ligne, elle peut ensuite répondre à l'interrogation sur le port de la sonde du point de terminaison à équilibrage de charge créé précédemment dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="73d94-171">When the IP Address resource is brought online, it can then respond to the polling on the probe port from the load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-the-listener-online"></a><span data-ttu-id="73d94-172">Mettre l'écouteur en ligne</span><span class="sxs-lookup"><span data-stu-id="73d94-172">Bring the listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="73d94-173">Éléments de suivi</span><span class="sxs-lookup"><span data-stu-id="73d94-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-the-availability-group-listener-within-the-same-vnet"></a><span data-ttu-id="73d94-174">Tester l'écouteur du groupe de disponibilité (au sein du même réseau virtuel)</span><span class="sxs-lookup"><span data-stu-id="73d94-174">Test the availability group listener (within the same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-the-availability-group-listener-over-the-internet"></a><span data-ttu-id="73d94-175">Tester l'écouteur du groupe de disponibilité (sur Internet)</span><span class="sxs-lookup"><span data-stu-id="73d94-175">Test the availability group listener (over the internet)</span></span>
<span data-ttu-id="73d94-176">Pour accéder à l'écouteur depuis l'extérieur du réseau virtuel, vous devez utiliser l'équilibrage de charge externe/public (décrit dans cette rubrique) au lieu de l'équilibrage de charge interne, qui est accessible uniquement dans le même réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="73d94-176">In order to access the listener from outside the virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within the same VNet.</span></span> <span data-ttu-id="73d94-177">Dans la chaîne de connexion, vous spécifiez le nom du service cloud.</span><span class="sxs-lookup"><span data-stu-id="73d94-177">In the connection string, you specify the cloud service name.</span></span> <span data-ttu-id="73d94-178">Par exemple, si vous avez un service cloud nommé *mycloudservice*, l’instruction sqlcmd se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="73d94-178">For example, if you had a cloud service with the name *mycloudservice*, the sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="73d94-179">Contrairement à l'exemple précédent, l'authentification SQL est nécessaire, car l'appelant ne peut pas utiliser l'authentification Windows sur internet.</span><span class="sxs-lookup"><span data-stu-id="73d94-179">Unlike the previous example, SQL authentication must be used, because the caller cannot use windows authentication over the internet.</span></span> <span data-ttu-id="73d94-180">Pour plus d’informations, voir [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx)(Groupes de disponibilité Always On dans Azure VM : scénarios de connectivité client).</span><span class="sxs-lookup"><span data-stu-id="73d94-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="73d94-181">Lorsque vous utilisez l'authentification SQL, veillez à créer la même connexion sur les deux réplicas.</span><span class="sxs-lookup"><span data-stu-id="73d94-181">When using SQL authentication, make sure that you create the same login on both replicas.</span></span> <span data-ttu-id="73d94-182">Pour plus d’informations sur la résolution des problèmes de connexions avec des groupes de disponibilité, consultez la rubrique [Comment mapper des connexions ou utiliser des utilisateurs de base de données SQL à relation contenant-contenu pour se connecter à d’autres réplicas et mapper aux bases de données de disponibilité](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="73d94-182">For more information about troubleshooting logins with Availability Groups, see [How to map logins or use contained SQL database user to connect to other replicas and map to availability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="73d94-183">Si les réplicas Always On figurent dans des sous-réseaux distincts, les clients doivent spécifier **MultisubnetFailover=True** dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="73d94-183">If the Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in the connection string.</span></span> <span data-ttu-id="73d94-184">Cela entraîne des tentatives parallèles de connexion aux réplicas dans les différents sous-réseaux.</span><span class="sxs-lookup"><span data-stu-id="73d94-184">This results in parallel connection attempts to replicas in the different subnets.</span></span> <span data-ttu-id="73d94-185">Notez que ce scénario inclut un déploiement de groupe de disponibilité Always On dans plusieurs régions.</span><span class="sxs-lookup"><span data-stu-id="73d94-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="73d94-186">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="73d94-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]

