---
title: "mise à l’échelle aaaAutomatically nœuds de calcul dans un pool de traitement par lots Azure | Documents Microsoft"
description: "Activer l’échelle automatique sur un toodynamically de pool de cloud d’ajuster le nombre de hello de nœuds de calcul dans le pool de hello."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: b6d1e0c5d8e0e56e15a4d3588150f2466a689f19
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="a6979-103">Mettre automatiquement à l’échelle les nœuds de calcul dans un pool Azure Batch</span><span class="sxs-lookup"><span data-stu-id="a6979-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="a6979-104">Azure Batch peut automatiquement mettre à l’échelle des pools en fonction de paramètres que vous définissez.</span><span class="sxs-lookup"><span data-stu-id="a6979-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="a6979-105">Mise à l’échelle automatique, lot ajoute dynamiquement le pool tooa de nœuds en tant que tâche l’augmentation des demandes et supprime les nœuds de calcul car ils diminuent.</span><span class="sxs-lookup"><span data-stu-id="a6979-105">With automatic scaling, Batch dynamically adds nodes tooa pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="a6979-106">Vous pouvez enregistrer le temps et argent en réglant automatiquement le nombre de hello de nœuds de calcul utilisées par votre application de traitement par lots.</span><span class="sxs-lookup"><span data-stu-id="a6979-106">You can save both time and money by automatically adjusting hello number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="a6979-107">Pour activer la mise à l’échelle automatique sur un pool de nœuds de calcul, associez-lui une *formule de mise à l’échelle* définie par vos soins.</span><span class="sxs-lookup"><span data-stu-id="a6979-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="a6979-108">Hello service Batch utilise nombre de hello toodetermine formule hello mise à l’échelle de nœuds de calcul qui sont nécessaire tooexecute votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="a6979-108">hello Batch service uses hello autoscale formula toodetermine hello number of compute nodes that are needed tooexecute your workload.</span></span> <span data-ttu-id="a6979-109">Les nœuds de calcul peuvent être des nœuds dédiés ou des [nœuds de faible priorité](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="a6979-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="a6979-110">Lot répond tooservice les données de métriques sont collectées à intervalles réguliers.</span><span class="sxs-lookup"><span data-stu-id="a6979-110">Batch responds tooservice metrics data that is collected periodically.</span></span> <span data-ttu-id="a6979-111">À l’aide de ces données de métriques, lot ajuste nombre hello de nœuds de calcul dans le pool hello en fonction de votre formule et selon un intervalle configuré.</span><span class="sxs-lookup"><span data-stu-id="a6979-111">Using this metrics data, Batch adjusts hello number of compute nodes in hello pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="a6979-112">Vous pouvez activer la mise à l’échelle automatique lors de la création d’un pool ou dans un pool existant.</span><span class="sxs-lookup"><span data-stu-id="a6979-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="a6979-113">Vous pouvez également modifier une formule existante dans un pool dont la mise à l’échelle automatique est configurée.</span><span class="sxs-lookup"><span data-stu-id="a6979-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="a6979-114">Traitement par lots vous permet de tooevaluate vos formules avant de les assigner toopools et toomonitor état hello de mise à l’échelle automatique s’exécute.</span><span class="sxs-lookup"><span data-stu-id="a6979-114">Batch enables you tooevaluate your formulas before assigning them toopools and toomonitor hello status of automatic scaling runs.</span></span>

<span data-ttu-id="a6979-115">Cet article traite de hello diverses entités qui composent votre mise à l’échelle des formules, y compris les variables, les opérateurs, les opérations et les fonctions.</span><span class="sxs-lookup"><span data-stu-id="a6979-115">This article discusses hello various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="a6979-116">Nous expliquons comment tooobtain différentes métriques de ressource et de tâche dans un lot de calcul.</span><span class="sxs-lookup"><span data-stu-id="a6979-116">We discuss how tooobtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="a6979-117">Vous pouvez utiliser ces tooadjust mesures nombre de nœuds de votre pool en fonction de l’état de tâche et l’utilisation des ressources.</span><span class="sxs-lookup"><span data-stu-id="a6979-117">You can use these metrics tooadjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="a6979-118">Ensuite, nous décrire comment tooconstruct une formule et automatique de mise à l’échelle sur un pool à l’aide d’activer hello REST de traitement par lots et les API .NET.</span><span class="sxs-lookup"><span data-stu-id="a6979-118">We then describe how tooconstruct a formula and enable automatic scaling on a pool by using both hello Batch REST and .NET APIs.</span></span> <span data-ttu-id="a6979-119">Et nous terminerons par quelques exemples de formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6979-120">Lorsque vous créez un compte de traitement par lots, vous pouvez spécifier hello [configuration du compte](batch-api-basics.md#account), qui détermine si les pools sont répartis dans un abonnement au service de traitement par lots (valeur par défaut de hello), ou dans votre abonnement de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a6979-120">When you create a Batch account, you can specify hello [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (hello default), or in your user subscription.</span></span> <span data-ttu-id="a6979-121">Si vous avez créé votre compte Batch avec la configuration de Service Batch hello par défaut, votre compte est tooa limité le nombre maximal de cœurs qui peut être utilisé pour le traitement.</span><span class="sxs-lookup"><span data-stu-id="a6979-121">If you created your Batch account with hello default Batch Service configuration, then your account is limited tooa maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="a6979-122">Hello service Batch met à l’échelle des nœuds de calcul uniquement des toothat limite maximale du principal.</span><span class="sxs-lookup"><span data-stu-id="a6979-122">hello Batch service scales compute nodes only up toothat core limit.</span></span> <span data-ttu-id="a6979-123">Pour cette raison, hello service Batch ne peut-être pas atteint le numéro de cible hello de nœuds de calcul spécifié par une formule de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-123">For this reason, hello Batch service may not reach hello target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="a6979-124">Consultez [Quotas et limites pour hello service Azure Batch](batch-quota-limit.md) pour plus d’informations sur l’affichage et d’augmenter les quotas de votre compte.</span><span class="sxs-lookup"><span data-stu-id="a6979-124">See [Quotas and limits for hello Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="a6979-125">Si vous avez créé votre compte avec la configuration de l’abonnement de l’utilisateur hello, votre compte de partage dans le quota de cœurs hello pour l’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-125">If you created your account with hello User Subscription configuration, then your account shares in hello core quota for hello subscription.</span></span> <span data-ttu-id="a6979-126">Pour en savoir plus, consultez le paragraphe [Limites de machines virtuelles](../azure-subscription-service-limits.md#virtual-machines-limits) de la section [Abonnement Azure et limites, quotas et contraintes de service](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="a6979-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="a6979-127">Formules de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-127">Automatic scaling formulas</span></span>
<span data-ttu-id="a6979-128">Une formule de mise à l’échelle automatique est une valeur de chaîne définie par vos soins qui contient une ou plusieurs instructions.</span><span class="sxs-lookup"><span data-stu-id="a6979-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="a6979-129">formule de mise à l’échelle Hello est affectée du pool tooa [autoScaleFormula] [ rest_autoscaleformula] élément (lot REST) ou [CloudPool.AutoScaleFormula] [ net_cloudpool_autoscaleformula] propriété (lot .NET).</span><span class="sxs-lookup"><span data-stu-id="a6979-129">hello autoscale formula is assigned tooa pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="a6979-130">Hello service Batch utilise votre numéro de cible toodetermine formule hello de nœuds de calcul dans le pool de hello pour hello prochain intervalle de traitement.</span><span class="sxs-lookup"><span data-stu-id="a6979-130">hello Batch service uses your formula toodetermine hello target number of compute nodes in hello pool for hello next interval of processing.</span></span> <span data-ttu-id="a6979-131">chaîne de la formule Hello ne peut pas dépasser 8 Ko, peuvent inclure des instructions too100 qui sont séparées par des points-virgules et peuvent inclure des sauts de ligne et de commentaires.</span><span class="sxs-lookup"><span data-stu-id="a6979-131">hello formula string cannot exceed 8 KB, can include up too100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="a6979-132">Les formules de mise à l’échelle automatique reviennent en quelque sorte à utiliser un « langage » de mise à l’échelle Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="a6979-133">Les instructions formule sont des expressions de forme libre qui peuvent inclure des variables définies par le service (variables définies par le service de traitement par lots hello) et les variables définies par l’utilisateur (les variables que vous définissez).</span><span class="sxs-lookup"><span data-stu-id="a6979-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by hello Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="a6979-134">Elles peuvent effectuer différentes opérations sur ces valeurs à l’aide de types, d’opérateurs et de fonctions intégrés.</span><span class="sxs-lookup"><span data-stu-id="a6979-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="a6979-135">Par exemple, une instruction peut prendre hello suivant du formulaire :</span><span class="sxs-lookup"><span data-stu-id="a6979-135">For example, a statement might take hello following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="a6979-136">Les formules contiennent généralement plusieurs instructions qui effectuent des opérations sur les valeurs qui sont obtenues dans les instructions précédentes :</span><span class="sxs-lookup"><span data-stu-id="a6979-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="a6979-137">Par exemple, tout d’abord nous obtenir une valeur pour `variable1`, puis passez-le tooa fonction toopopulate `variable2`:</span><span class="sxs-lookup"><span data-stu-id="a6979-137">For example, first we obtain a value for `variable1`, then pass it tooa function toopopulate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="a6979-138">Inclure ces instructions dans votre tooarrive formule de mise à l’échelle à un nombre cible de nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="a6979-138">Include these statements in your autoscale formula tooarrive at a target number of compute nodes.</span></span> <span data-ttu-id="a6979-139">Les nœuds dédiés et les nœuds de faible priorité ont leurs propres paramètres cibles, afin que vous puissiez définir une cible pour chaque type de nœud.</span><span class="sxs-lookup"><span data-stu-id="a6979-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="a6979-140">Une formule de mise à l’échelle automatique peut inclure une valeur cible pour les nœuds dédiés, une valeur cible pour les nœuds de faible priorité, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="a6979-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="a6979-141">nombre de cible Hello de nœuds est supérieure, inférieure, ou même que le nombre actuel de hello de nœuds de ce type dans le pool de hello hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-141">hello target number of nodes may be higher, lower, or hello same as hello current number of nodes of that type in hello pool.</span></span> <span data-ttu-id="a6979-142">Le service Batch évalue la formule de mise à l’échelle automatique d’un pool à un intervalle spécifique (reportez-vous aux [intervalles de mise à l’échelle automatique](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="a6979-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="a6979-143">Traitement par lots ajuste le nombre cible de hello de chaque type de nœud dans le nombre de toohello pool hello indiquant votre formule de mise à l’échelle au moment de l’évaluation de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-143">Batch adjusts hello target number of each type of node in hello pool toohello number that your autoscale formula specifies at hello time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="a6979-144">Exemple de formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-144">Sample autoscale formula</span></span>

<span data-ttu-id="a6979-145">Voici un exemple d’une formule de mise à l’échelle peut être ajustée toowork pour la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="a6979-145">Here is an example of an autoscale formula that can be adjusted toowork for most scenarios.</span></span> <span data-ttu-id="a6979-146">Hello variables `startingNumberOfVMs` et `maxNumberofVMs` Bonjour formule de l’exemple peut être ajustée tooyour besoins.</span><span class="sxs-lookup"><span data-stu-id="a6979-146">hello variables `startingNumberOfVMs` and `maxNumberofVMs` in hello example formula can be adjusted tooyour needs.</span></span> <span data-ttu-id="a6979-147">Cette formule met à l’échelle des nœuds dédiés, mais peut être modifiée tooapply également les nœuds de faible priorité tooscale.</span><span class="sxs-lookup"><span data-stu-id="a6979-147">This formula scales dedicated nodes, but can be modified tooapply tooscale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="a6979-148">Avec cette formule de mise à l’échelle, hello pool est initialement créé avec une seule machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-148">With this autoscale formula, hello pool is initially created with a single VM.</span></span> <span data-ttu-id="a6979-149">Hello `$PendingTasks` métrique définit le nombre de hello de tâches qui sont en cours d’exécution ou en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="a6979-149">hello `$PendingTasks` metric defines hello number of tasks that are running or queued.</span></span> <span data-ttu-id="a6979-150">formule de Hello recherche hello moyenne d’attente de tâches Bonjour 180 dernières secondes et définit hello `$TargetDedicatedNodes` variable en conséquence.</span><span class="sxs-lookup"><span data-stu-id="a6979-150">hello formula finds hello average number of pending tasks in hello last 180 seconds and sets hello `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="a6979-151">formule de Hello garantit que le numéro de cible hello de nœuds dédiés ne dépasse jamais 25 ordinateurs virtuels.</span><span class="sxs-lookup"><span data-stu-id="a6979-151">hello formula ensures that hello target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="a6979-152">Comme les nouvelles tâches sont envoyés, pool de hello croît automatiquement.</span><span class="sxs-lookup"><span data-stu-id="a6979-152">As new tasks are submitted, hello pool automatically grows.</span></span> <span data-ttu-id="a6979-153">En tant que tâches se terminent, machines virtuelles deviennent libre un par un et formule d’échelle hello réduit le pool de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-153">As tasks complete, VMs become free one by one and hello autoscaling formula shrinks hello pool.</span></span>

## <a name="variables"></a><span data-ttu-id="a6979-154">variables</span><span class="sxs-lookup"><span data-stu-id="a6979-154">Variables</span></span>
<span data-ttu-id="a6979-155">Vous pouvez utiliser aussi bien des variables **définies par le service** que des variables **définies par l’utilisateur** dans les formules de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="a6979-156">variables de Hello défini par le service sont générés dans toohello service Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-156">hello service-defined variables are built in toohello Batch service.</span></span> <span data-ttu-id="a6979-157">Certaines variables définies par le service sont en lecture-écriture, tandis que d’autres sont en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="a6979-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="a6979-158">Les variables définies par l’utilisateur sont des variables que vous définissez.</span><span class="sxs-lookup"><span data-stu-id="a6979-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="a6979-159">Dans la formule de l’exemple hello indiqué dans la section précédente de hello, `$TargetDedicatedNodes` et `$PendingTasks` sont des variables définies par le service.</span><span class="sxs-lookup"><span data-stu-id="a6979-159">In hello example formula shown in hello previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="a6979-160">Les variables `startingNumberOfVMs` et `maxNumberofVMs` sont des variables définies par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a6979-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="a6979-161">Les variables définies par le service sont toujours précédées d’un signe dollar ($).</span><span class="sxs-lookup"><span data-stu-id="a6979-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="a6979-162">Pour les variables définies par l’utilisateur, le symbole dollar hello est facultative.</span><span class="sxs-lookup"><span data-stu-id="a6979-162">For user-defined variables, hello dollar sign is optional.</span></span>
>
>

<span data-ttu-id="a6979-163">Hello les tableaux suivants indiquent les deux en lecture-écriture et de variables en lecture seule qui sont définis par hello service Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-163">hello following tables show both read-write and read-only variables that are defined by hello Batch service.</span></span>

<span data-ttu-id="a6979-164">Vous pouvez obtenir et définir des nombre de hello toomanage de nœuds de calcul de valeurs hello de ces variables défini par le service dans un pool :</span><span class="sxs-lookup"><span data-stu-id="a6979-164">You can get and set hello values of these service-defined variables toomanage hello number of compute nodes in a pool:</span></span>

| <span data-ttu-id="a6979-165">Variables définies par le service en lecture-écriture</span><span class="sxs-lookup"><span data-stu-id="a6979-165">Read-write service-defined variables</span></span> | <span data-ttu-id="a6979-166">Description</span><span class="sxs-lookup"><span data-stu-id="a6979-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a6979-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="a6979-168">nœuds pour le pool de hello de calcul du nombre de cible de Hello de dédié.</span><span class="sxs-lookup"><span data-stu-id="a6979-168">hello target number of dedicated compute nodes for hello pool.</span></span> <span data-ttu-id="a6979-169">nombre de Hello de nœuds dédiés est spécifié en tant que cible, car un pool ne peut pas atteindre toujours nombre hello souhaité de nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-169">hello number of dedicated nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="a6979-170">Par exemple, si le nombre de cibles de hello de nœuds dédiés est modifié par une évaluation de mise à l’échelle avant hello pool a atteint cible initiale de hello, puis le pool de hello ne peut pas atteindre cible de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-170">For example, if hello target number of dedicated nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <br /><br /> <span data-ttu-id="a6979-171">Un pool dans un compte créé avec la configuration du Service de traitement par lots hello ne peut pas atteindre sa cible si la cible de hello dépasse un nœud ou core un quota de comptes Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-171">A pool in an account created with hello Batch Service configuration may not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="a6979-172">Un pool dans un compte créé avec la configuration de l’abonnement de l’utilisateur hello ne peut pas atteindre sa cible si la cible de hello dépasse le quota de cœur partagé hello pour l’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-172">A pool in an account created with hello User Subscription configuration may not achieve its target if hello target exceeds hello shared core quota for hello subscription.</span></span>|
| <span data-ttu-id="a6979-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="a6979-174">nœuds pour le pool de hello de calcul du nombre de cible de Hello de faible priorité.</span><span class="sxs-lookup"><span data-stu-id="a6979-174">hello target number of low-priority compute nodes for hello pool.</span></span> <span data-ttu-id="a6979-175">nombre de Hello de nœuds de faible priorité est spécifié en tant que cible, car un pool ne peut pas atteindre toujours nombre hello souhaité de nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-175">hello number of low-priority nodes is specified as a target because a pool may not always achieve hello desired number of nodes.</span></span> <span data-ttu-id="a6979-176">Par exemple, si le nombre de postes de faible priorité cibles de hello est modifiée par une évaluation de mise à l’échelle avant hello pool a atteint cible initiale de hello, puis le pool de hello ne peut pas atteindre cible de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-176">For example, if hello target number of low-priority nodes is modified by an autoscale evaluation before hello pool has reached hello initial target, then hello pool may not reach hello target.</span></span> <span data-ttu-id="a6979-177">Un pool peut également pas obtenir sa cible si la cible de hello dépasse un quota de comptes Batch nœud ou core.</span><span class="sxs-lookup"><span data-stu-id="a6979-177">A pool may also not achieve its target if hello target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="a6979-178">Pour plus d’informations sur les nœuds de calcul de faible priorité, consultez [Utiliser des machines virtuelles de faible priorité avec Batch (préversion)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="a6979-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="a6979-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="a6979-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="a6979-180">action Hello qui se produit lorsque les nœuds de calcul sont supprimés à partir d’un pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-180">hello action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="a6979-181">Les valeurs possibles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="a6979-181">Possible values are:</span></span><ul><li><span data-ttu-id="a6979-182">**remettre**--s’arrête immédiatement des tâches et les place en file d’attente de travail hello afin qu’elles soient replanifiées.</span><span class="sxs-lookup"><span data-stu-id="a6979-182">**requeue**--Terminates tasks immediately and puts them back on hello job queue so that they are rescheduled.</span></span><li><span data-ttu-id="a6979-183">**Terminer**--s’arrête immédiatement des tâches et les supprime de la file d’attente des travaux hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-183">**terminate**--Terminates tasks immediately and removes them from hello job queue.</span></span><li><span data-ttu-id="a6979-184">**taskcompletion**--attend en cours d’exécution des tâches toofinish et puis supprime le nœud de hello de pool de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-184">**taskcompletion**--Waits for currently running tasks toofinish and then removes hello node from hello pool.</span></span><li><span data-ttu-id="a6979-185">**retaineddata**--attend que toutes les hello conservés à la tâche données locales sur hello nœud toobe nettoyé avant de supprimer un nœud de hello à partir du pool de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-185">**retaineddata**--Waits for all hello local task-retained data on hello node toobe cleaned up before removing hello node from hello pool.</span></span></ul> |

<span data-ttu-id="a6979-186">Vous pouvez obtenir la valeur hello de ces réglages toomake défini par le service des variables qui sont basées sur les métriques à partir du service de traitement par lots hello :</span><span class="sxs-lookup"><span data-stu-id="a6979-186">You can get hello value of these service-defined variables toomake adjustments that are based on metrics from hello Batch service:</span></span>

| <span data-ttu-id="a6979-187">Variables définies par le service en lecture seule</span><span class="sxs-lookup"><span data-stu-id="a6979-187">Read-only service-defined variables</span></span> | <span data-ttu-id="a6979-188">Description</span><span class="sxs-lookup"><span data-stu-id="a6979-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a6979-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="a6979-189">$CPUPercent</span></span> |<span data-ttu-id="a6979-190">pourcentage moyen de Hello d’utilisation du processeur.</span><span class="sxs-lookup"><span data-stu-id="a6979-190">hello average percentage of CPU usage.</span></span> |
| <span data-ttu-id="a6979-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="a6979-191">$WallClockSeconds</span></span> |<span data-ttu-id="a6979-192">nombre de Hello de secondes consommées.</span><span class="sxs-lookup"><span data-stu-id="a6979-192">hello number of seconds consumed.</span></span> |
| <span data-ttu-id="a6979-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-193">$MemoryBytes</span></span> |<span data-ttu-id="a6979-194">Nombre moyen de Hello de mégaoctets consommés.</span><span class="sxs-lookup"><span data-stu-id="a6979-194">hello average number of megabytes used.</span></span> |
| <span data-ttu-id="a6979-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-195">$DiskBytes</span></span> |<span data-ttu-id="a6979-196">Nombre moyen de Hello de gigaoctets utilisés sur les disques locaux hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-196">hello average number of gigabytes used on hello local disks.</span></span> |
| <span data-ttu-id="a6979-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-197">$DiskReadBytes</span></span> |<span data-ttu-id="a6979-198">nombre de Hello d’octets lus.</span><span class="sxs-lookup"><span data-stu-id="a6979-198">hello number of bytes read.</span></span> |
| <span data-ttu-id="a6979-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-199">$DiskWriteBytes</span></span> |<span data-ttu-id="a6979-200">nombre de Hello d’octets écrits.</span><span class="sxs-lookup"><span data-stu-id="a6979-200">hello number of bytes written.</span></span> |
| <span data-ttu-id="a6979-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="a6979-201">$DiskReadOps</span></span> |<span data-ttu-id="a6979-202">nombre de Hello d’opérations de lecture sur disque est effectuée.</span><span class="sxs-lookup"><span data-stu-id="a6979-202">hello count of read disk operations performed.</span></span> |
| <span data-ttu-id="a6979-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="a6979-203">$DiskWriteOps</span></span> |<span data-ttu-id="a6979-204">nombre de Hello disque d’opérations d’écriture effectuées.</span><span class="sxs-lookup"><span data-stu-id="a6979-204">hello count of write disk operations performed.</span></span> |
| <span data-ttu-id="a6979-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-205">$NetworkInBytes</span></span> |<span data-ttu-id="a6979-206">nombre de Hello d’octets entrants.</span><span class="sxs-lookup"><span data-stu-id="a6979-206">hello number of inbound bytes.</span></span> |
| <span data-ttu-id="a6979-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-207">$NetworkOutBytes</span></span> |<span data-ttu-id="a6979-208">nombre de Hello d’octets sortants.</span><span class="sxs-lookup"><span data-stu-id="a6979-208">hello number of outbound bytes.</span></span> |
| <span data-ttu-id="a6979-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="a6979-209">$SampleNodeCount</span></span> |<span data-ttu-id="a6979-210">nombre de Hello de nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="a6979-210">hello count of compute nodes.</span></span> |
| <span data-ttu-id="a6979-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-211">$ActiveTasks</span></span> |<span data-ttu-id="a6979-212">nombre de Hello de tâches qui sont tooexecute prêt, mais pas l’exécution.</span><span class="sxs-lookup"><span data-stu-id="a6979-212">hello number of tasks that are ready tooexecute but are not yet executing.</span></span> <span data-ttu-id="a6979-213">nombre de Hello $ActiveTasks inclut toutes les tâches qui se trouvent dans un état actif de hello et dont les dépendances ont été satisfaites.</span><span class="sxs-lookup"><span data-stu-id="a6979-213">hello $ActiveTasks count includes all tasks that are in hello active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="a6979-214">Toutes les tâches qui se trouvent dans un état actif de hello mais dont les dépendances n’ont pas été satisfaites sont exclus du nombre de hello $ActiveTasks.</span><span class="sxs-lookup"><span data-stu-id="a6979-214">Any tasks that are in hello active state but whose dependencies have not been satisfied are excluded from hello $ActiveTasks count.</span></span>|
| <span data-ttu-id="a6979-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-215">$RunningTasks</span></span> |<span data-ttu-id="a6979-216">nombre de Hello de tâches en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="a6979-216">hello number of tasks in a running state.</span></span> |
| <span data-ttu-id="a6979-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-217">$PendingTasks</span></span> |<span data-ttu-id="a6979-218">somme de Hello de $ActiveTasks et $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="a6979-218">hello sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="a6979-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-219">$SucceededTasks</span></span> |<span data-ttu-id="a6979-220">nombre de Hello de tâches qui s’est correctement terminée.</span><span class="sxs-lookup"><span data-stu-id="a6979-220">hello number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="a6979-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-221">$FailedTasks</span></span> |<span data-ttu-id="a6979-222">nombre de Hello de tâches qui ont échoué.</span><span class="sxs-lookup"><span data-stu-id="a6979-222">hello number of tasks that failed.</span></span> |
| <span data-ttu-id="a6979-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="a6979-224">Nombre actuel de Hello de dédié des nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="a6979-224">hello current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="a6979-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="a6979-226">Nombre actuel de Hello de faible priorité des nœuds, y compris les nœuds qui ont été devancées de calcul.</span><span class="sxs-lookup"><span data-stu-id="a6979-226">hello current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="a6979-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="a6979-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="a6979-228">nombre de Hello de nœuds dans le pool de hello qui se trouvent dans un état devancée.</span><span class="sxs-lookup"><span data-stu-id="a6979-228">hello number of nodes in hello pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="a6979-229">Hello variables en lecture seule, défini par le service qui figurent dans le tableau précédent de hello sont *objets* qui fournissent diverses méthodes tooaccess les données associées à chaque.</span><span class="sxs-lookup"><span data-stu-id="a6979-229">hello read-only, service-defined variables that are shown in hello previous table are *objects* that provide various methods tooaccess data associated with each.</span></span> <span data-ttu-id="a6979-230">Pour plus d’informations, consultez la section [Obtenir des échantillons de données](#getsampledata) dans la suite de cet article.</span><span class="sxs-lookup"><span data-stu-id="a6979-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="a6979-231">Types</span><span class="sxs-lookup"><span data-stu-id="a6979-231">Types</span></span>
<span data-ttu-id="a6979-232">Ces types sont pris en charge dans une formule :</span><span class="sxs-lookup"><span data-stu-id="a6979-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="a6979-233">double</span><span class="sxs-lookup"><span data-stu-id="a6979-233">double</span></span>
* <span data-ttu-id="a6979-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-234">doubleVec</span></span>
* <span data-ttu-id="a6979-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="a6979-235">doubleVecList</span></span>
* <span data-ttu-id="a6979-236">string</span><span class="sxs-lookup"><span data-stu-id="a6979-236">string</span></span>
* <span data-ttu-id="a6979-237">timestamp--timestamp est une structure composée contient hello suivant des membres :</span><span class="sxs-lookup"><span data-stu-id="a6979-237">timestamp--timestamp is a compound structure that contains hello following members:</span></span>

  * <span data-ttu-id="a6979-238">year</span><span class="sxs-lookup"><span data-stu-id="a6979-238">year</span></span>
  * <span data-ttu-id="a6979-239">mois (1-12)</span><span class="sxs-lookup"><span data-stu-id="a6979-239">month (1-12)</span></span>
  * <span data-ttu-id="a6979-240">jour (1-31)</span><span class="sxs-lookup"><span data-stu-id="a6979-240">day (1-31)</span></span>
  * <span data-ttu-id="a6979-241">jour de la semaine (au format hello du numéro de ; par exemple, 1 pour lundi)</span><span class="sxs-lookup"><span data-stu-id="a6979-241">weekday (in hello format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="a6979-242">heure (au format 24 heures, par exemple, 13 signifie 1 PM)</span><span class="sxs-lookup"><span data-stu-id="a6979-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="a6979-243">minute (00-59)</span><span class="sxs-lookup"><span data-stu-id="a6979-243">minute (00-59)</span></span>
  * <span data-ttu-id="a6979-244">seconde (00-59)</span><span class="sxs-lookup"><span data-stu-id="a6979-244">second (00-59)</span></span>
* <span data-ttu-id="a6979-245">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-245">timeinterval</span></span>

  * <span data-ttu-id="a6979-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="a6979-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="a6979-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="a6979-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="a6979-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="a6979-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="a6979-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="a6979-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="a6979-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="a6979-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="a6979-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="a6979-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="a6979-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="a6979-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="a6979-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="a6979-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="a6979-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="a6979-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="a6979-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="a6979-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="a6979-256">Opérations</span><span class="sxs-lookup"><span data-stu-id="a6979-256">Operations</span></span>
<span data-ttu-id="a6979-257">Ces opérations sont autorisées sur les types de hello qui sont répertoriées dans la section précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-257">These operations are allowed on hello types that are listed in hello previous section.</span></span>

| <span data-ttu-id="a6979-258">Opération</span><span class="sxs-lookup"><span data-stu-id="a6979-258">Operation</span></span> | <span data-ttu-id="a6979-259">Opérateurs pris en charge</span><span class="sxs-lookup"><span data-stu-id="a6979-259">Supported operators</span></span> | <span data-ttu-id="a6979-260">Type de résultat</span><span class="sxs-lookup"><span data-stu-id="a6979-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a6979-261">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="a6979-261">double *operator* double</span></span> |<span data-ttu-id="a6979-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="a6979-262">+, -, *, /</span></span> |<span data-ttu-id="a6979-263">double</span><span class="sxs-lookup"><span data-stu-id="a6979-263">double</span></span> |
| <span data-ttu-id="a6979-264">double *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="a6979-265">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-265">timeinterval</span></span> |
| <span data-ttu-id="a6979-266">doubleVec *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="a6979-266">doubleVec *operator* double</span></span> |<span data-ttu-id="a6979-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="a6979-267">+, -, *, /</span></span> |<span data-ttu-id="a6979-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-268">doubleVec</span></span> |
| <span data-ttu-id="a6979-269">doubleVec *opérateur* doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="a6979-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="a6979-270">+, -, *, /</span></span> |<span data-ttu-id="a6979-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-271">doubleVec</span></span> |
| <span data-ttu-id="a6979-272">timeinterval *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="a6979-272">timeinterval *operator* double</span></span> |<span data-ttu-id="a6979-273">*, /</span><span class="sxs-lookup"><span data-stu-id="a6979-273">*, /</span></span> |<span data-ttu-id="a6979-274">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-274">timeinterval</span></span> |
| <span data-ttu-id="a6979-275">timeinterval *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="a6979-276">+, -</span><span class="sxs-lookup"><span data-stu-id="a6979-276">+, -</span></span> |<span data-ttu-id="a6979-277">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-277">timeinterval</span></span> |
| <span data-ttu-id="a6979-278">timeinterval *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="a6979-279">timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-279">timestamp</span></span> |
| <span data-ttu-id="a6979-280">timestamp *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="a6979-281">timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-281">timestamp</span></span> |
| <span data-ttu-id="a6979-282">timestamp *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="a6979-283">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-283">timeinterval</span></span> |
| <span data-ttu-id="a6979-284">*opérateur*double</span><span class="sxs-lookup"><span data-stu-id="a6979-284">*operator*double</span></span> |<span data-ttu-id="a6979-285">-, !</span><span class="sxs-lookup"><span data-stu-id="a6979-285">-, !</span></span> |<span data-ttu-id="a6979-286">double</span><span class="sxs-lookup"><span data-stu-id="a6979-286">double</span></span> |
| <span data-ttu-id="a6979-287">*opérateur*timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="a6979-288">timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-288">timeinterval</span></span> |
| <span data-ttu-id="a6979-289">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="a6979-289">double *operator* double</span></span> |<span data-ttu-id="a6979-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="a6979-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="a6979-291">double</span><span class="sxs-lookup"><span data-stu-id="a6979-291">double</span></span> |
| <span data-ttu-id="a6979-292">string *opérateur* string</span><span class="sxs-lookup"><span data-stu-id="a6979-292">string *operator* string</span></span> |<span data-ttu-id="a6979-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="a6979-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="a6979-294">double</span><span class="sxs-lookup"><span data-stu-id="a6979-294">double</span></span> |
| <span data-ttu-id="a6979-295">timestamp *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="a6979-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="a6979-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="a6979-297">double</span><span class="sxs-lookup"><span data-stu-id="a6979-297">double</span></span> |
| <span data-ttu-id="a6979-298">timeinterval *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="a6979-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="a6979-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="a6979-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="a6979-300">double</span><span class="sxs-lookup"><span data-stu-id="a6979-300">double</span></span> |
| <span data-ttu-id="a6979-301">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="a6979-301">double *operator* double</span></span> |<span data-ttu-id="a6979-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="a6979-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="a6979-303">double</span><span class="sxs-lookup"><span data-stu-id="a6979-303">double</span></span> |

<span data-ttu-id="a6979-304">Quand vous testez un double avec un opérateur ternaire (`double ? statement1 : statement2`), la valeur différente de zéro est **true** et zéro est **false**.</span><span class="sxs-lookup"><span data-stu-id="a6979-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="a6979-305">Fonctions</span><span class="sxs-lookup"><span data-stu-id="a6979-305">Functions</span></span>
<span data-ttu-id="a6979-306">Ces paramètres prédéfinis **fonctions** sont disponibles pour vous toouse dans la définition d’une formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-306">These predefined **functions** are available for you toouse in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="a6979-307">Fonction</span><span class="sxs-lookup"><span data-stu-id="a6979-307">Function</span></span> | <span data-ttu-id="a6979-308">Type de retour</span><span class="sxs-lookup"><span data-stu-id="a6979-308">Return type</span></span> | <span data-ttu-id="a6979-309">Description</span><span class="sxs-lookup"><span data-stu-id="a6979-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="a6979-310">avg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-310">avg(doubleVecList)</span></span> |<span data-ttu-id="a6979-311">double</span><span class="sxs-lookup"><span data-stu-id="a6979-311">double</span></span> |<span data-ttu-id="a6979-312">Retourne hello valeur moyenne de toutes les valeurs dans doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-312">Returns hello average value for all values in hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-313">len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-313">len(doubleVecList)</span></span> |<span data-ttu-id="a6979-314">double</span><span class="sxs-lookup"><span data-stu-id="a6979-314">double</span></span> |<span data-ttu-id="a6979-315">Retourne hello longueur du vecteur de hello est créé à partir de doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-315">Returns hello length of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-316">lg(double)</span><span class="sxs-lookup"><span data-stu-id="a6979-316">lg(double)</span></span> |<span data-ttu-id="a6979-317">double</span><span class="sxs-lookup"><span data-stu-id="a6979-317">double</span></span> |<span data-ttu-id="a6979-318">Retourne hello logarithme base 2 de hello double.</span><span class="sxs-lookup"><span data-stu-id="a6979-318">Returns hello log base 2 of hello double.</span></span> |
| <span data-ttu-id="a6979-319">lg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-319">lg(doubleVecList)</span></span> |<span data-ttu-id="a6979-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-320">doubleVec</span></span> |<span data-ttu-id="a6979-321">Retourne hello component-wise logarithme base 2 de hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="a6979-321">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="a6979-322">Un vec (double) doit être explicitement transmis pour le paramètre hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-322">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="a6979-323">Sinon, la version double LG (double) de hello est supposée.</span><span class="sxs-lookup"><span data-stu-id="a6979-323">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="a6979-324">ln(double)</span><span class="sxs-lookup"><span data-stu-id="a6979-324">ln(double)</span></span> |<span data-ttu-id="a6979-325">double</span><span class="sxs-lookup"><span data-stu-id="a6979-325">double</span></span> |<span data-ttu-id="a6979-326">Retourne hello logarithme naturel de hello en double.</span><span class="sxs-lookup"><span data-stu-id="a6979-326">Returns hello natural log of hello double.</span></span> |
| <span data-ttu-id="a6979-327">ln(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-327">ln(doubleVecList)</span></span> |<span data-ttu-id="a6979-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-328">doubleVec</span></span> |<span data-ttu-id="a6979-329">Retourne hello component-wise logarithme base 2 de hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="a6979-329">Returns hello component-wise log base 2 of hello doubleVecList.</span></span> <span data-ttu-id="a6979-330">Un vec (double) doit être explicitement transmis pour le paramètre hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-330">A vec(double) must be explicitly passed for hello parameter.</span></span> <span data-ttu-id="a6979-331">Sinon, la version double LG (double) de hello est supposée.</span><span class="sxs-lookup"><span data-stu-id="a6979-331">Otherwise, hello double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="a6979-332">log(double)</span><span class="sxs-lookup"><span data-stu-id="a6979-332">log(double)</span></span> |<span data-ttu-id="a6979-333">double</span><span class="sxs-lookup"><span data-stu-id="a6979-333">double</span></span> |<span data-ttu-id="a6979-334">Retourne hello base 10 de hello double.</span><span class="sxs-lookup"><span data-stu-id="a6979-334">Returns hello log base 10 of hello double.</span></span> |
| <span data-ttu-id="a6979-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-335">log(doubleVecList)</span></span> |<span data-ttu-id="a6979-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="a6979-336">doubleVec</span></span> |<span data-ttu-id="a6979-337">Retourne hello component-wise base 10 de hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="a6979-337">Returns hello component-wise log base 10 of hello doubleVecList.</span></span> <span data-ttu-id="a6979-338">Un vec (double) doit être explicitement transmis pour le paramètre de type double unique hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-338">A vec(double) must be explicitly passed for hello single double parameter.</span></span> <span data-ttu-id="a6979-339">Sinon, la version de log(double) double hello est supposée.</span><span class="sxs-lookup"><span data-stu-id="a6979-339">Otherwise, hello double log(double) version is assumed.</span></span> |
| <span data-ttu-id="a6979-340">max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-340">max(doubleVecList)</span></span> |<span data-ttu-id="a6979-341">double</span><span class="sxs-lookup"><span data-stu-id="a6979-341">double</span></span> |<span data-ttu-id="a6979-342">Retourne hello valeur maximale dans doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-342">Returns hello maximum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-343">min(doubleVecList)</span></span> |<span data-ttu-id="a6979-344">double</span><span class="sxs-lookup"><span data-stu-id="a6979-344">double</span></span> |<span data-ttu-id="a6979-345">Retourne hello valeur minimale dans doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-345">Returns hello minimum value in hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-346">norm(doubleVecList)</span></span> |<span data-ttu-id="a6979-347">double</span><span class="sxs-lookup"><span data-stu-id="a6979-347">double</span></span> |<span data-ttu-id="a6979-348">Retourne hello norme deux du vecteur de hello est créé à partir de doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-348">Returns hello two-norm of hello vector that is created from hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-349">percentile(doubleVec v, double p)</span><span class="sxs-lookup"><span data-stu-id="a6979-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="a6979-350">double</span><span class="sxs-lookup"><span data-stu-id="a6979-350">double</span></span> |<span data-ttu-id="a6979-351">Retourne hello élément percentile du vecteur de hello v.</span><span class="sxs-lookup"><span data-stu-id="a6979-351">Returns hello percentile element of hello vector v.</span></span> |
| <span data-ttu-id="a6979-352">rand()</span><span class="sxs-lookup"><span data-stu-id="a6979-352">rand()</span></span> |<span data-ttu-id="a6979-353">double</span><span class="sxs-lookup"><span data-stu-id="a6979-353">double</span></span> |<span data-ttu-id="a6979-354">Retourne une valeur aléatoire comprise entre 0,0 et 1,0.</span><span class="sxs-lookup"><span data-stu-id="a6979-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="a6979-355">range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-355">range(doubleVecList)</span></span> |<span data-ttu-id="a6979-356">double</span><span class="sxs-lookup"><span data-stu-id="a6979-356">double</span></span> |<span data-ttu-id="a6979-357">Retourne la différence hello hello valeurs minimale et maximales dans doubleVecList de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-357">Returns hello difference between hello min and max values in hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-358">std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-358">std(doubleVecList)</span></span> |<span data-ttu-id="a6979-359">double</span><span class="sxs-lookup"><span data-stu-id="a6979-359">double</span></span> |<span data-ttu-id="a6979-360">Retourne hello exemple d’écart des valeurs hello hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="a6979-360">Returns hello sample standard deviation of hello values in hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-361">stop()</span><span class="sxs-lookup"><span data-stu-id="a6979-361">stop()</span></span> | |<span data-ttu-id="a6979-362">Arrête l’évaluation d’expression d’échelle hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-362">Stops evaluation of hello autoscaling expression.</span></span> |
| <span data-ttu-id="a6979-363">sum(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="a6979-363">sum(doubleVecList)</span></span> |<span data-ttu-id="a6979-364">double</span><span class="sxs-lookup"><span data-stu-id="a6979-364">double</span></span> |<span data-ttu-id="a6979-365">Retourne hello somme de tous les composants hello de hello doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="a6979-365">Returns hello sum of all hello components of hello doubleVecList.</span></span> |
| <span data-ttu-id="a6979-366">time(string dateTime="")</span><span class="sxs-lookup"><span data-stu-id="a6979-366">time(string dateTime="")</span></span> |<span data-ttu-id="a6979-367">timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-367">timestamp</span></span> |<span data-ttu-id="a6979-368">Retourne les hello horodatage de hello heure actuelle, si aucun paramètre est passés ou hello horodatage de la chaîne de date/heure hello s’il est passé.</span><span class="sxs-lookup"><span data-stu-id="a6979-368">Returns hello time stamp of hello current time if no parameters are passed, or hello time stamp of hello dateTime string if it is passed.</span></span> <span data-ttu-id="a6979-369">Les formats dateTime pris en charge sont W3C-DTF et RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="a6979-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="a6979-370">val(doubleVec v, double i)</span><span class="sxs-lookup"><span data-stu-id="a6979-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="a6979-371">double</span><span class="sxs-lookup"><span data-stu-id="a6979-371">double</span></span> |<span data-ttu-id="a6979-372">Retourne la valeur hello d’élément hello qui est à l’emplacement i dans le vecteur v, avec un index de départ de zéro.</span><span class="sxs-lookup"><span data-stu-id="a6979-372">Returns hello value of hello element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="a6979-373">Certaines fonctions hello qui sont décrites dans le tableau précédent de hello peuvent accepter une liste en tant qu’argument.</span><span class="sxs-lookup"><span data-stu-id="a6979-373">Some of hello functions that are described in hello previous table can accept a list as an argument.</span></span> <span data-ttu-id="a6979-374">liste séparée par des virgules de Hello est n’importe quelle combinaison de *double* et *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="a6979-374">hello comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="a6979-375">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a6979-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="a6979-376">Hello *doubleVecList* valeur est convertie tooa unique *doubleVec* avant d’évaluation.</span><span class="sxs-lookup"><span data-stu-id="a6979-376">hello *doubleVecList* value is converted tooa single *doubleVec* before evaluation.</span></span> <span data-ttu-id="a6979-377">Par exemple, si `v = [1,2,3]`, puis en appelant `avg(v)` est équivalent toocalling `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="a6979-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent toocalling `avg(1,2,3)`.</span></span> <span data-ttu-id="a6979-378">Appel de `avg(v, 7)` est équivalent toocalling `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="a6979-378">Calling `avg(v, 7)` is equivalent toocalling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="a6979-379"><a name="getsampledata"></a>Obtenir des échantillons de données</span><span class="sxs-lookup"><span data-stu-id="a6979-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="a6979-380">Formules de mise à l’échelle agissent sur les données de métrique (exemples) qui sont fournies par hello service Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-380">Autoscale formulas act on metrics data (samples) that is provided by hello Batch service.</span></span> <span data-ttu-id="a6979-381">Une formule augmente ou diminue la taille du pool en fonction des valeurs hello qu’il obtient de service de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-381">A formula grows or shrinks pool size based on hello values that it obtains from hello service.</span></span> <span data-ttu-id="a6979-382">Hello service défini les variables qui ont été décrites précédemment sont des objets qui fournissent diverses méthodes données tooaccess qui sont associées à cet objet.</span><span class="sxs-lookup"><span data-stu-id="a6979-382">hello service-defined variables that were described previously are objects that provide various methods tooaccess data that is associated with that object.</span></span> <span data-ttu-id="a6979-383">Par exemple, hello expression suivante montre un Bonjour de tooget demande cinq dernières minutes d’utilisation du processeur :</span><span class="sxs-lookup"><span data-stu-id="a6979-383">For example, hello following expression shows a request tooget hello last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="a6979-384">Méthode</span><span class="sxs-lookup"><span data-stu-id="a6979-384">Method</span></span> | <span data-ttu-id="a6979-385">Description</span><span class="sxs-lookup"><span data-stu-id="a6979-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a6979-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="a6979-386">GetSample()</span></span> |<span data-ttu-id="a6979-387">Hello `GetSample()` méthode retourne un vecteur d’exemples de données.</span><span class="sxs-lookup"><span data-stu-id="a6979-387">hello `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="a6979-388">Un échantillon correspond à 30 secondes de données de métrique.</span><span class="sxs-lookup"><span data-stu-id="a6979-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="a6979-389">En d’autres termes, des échantillons sont obtenus toutes les 30 secondes,</span><span class="sxs-lookup"><span data-stu-id="a6979-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="a6979-390">Mais comme indiqué ci-dessous, il existe un décalage entre quand un échantillon est collecté et lorsqu’il est disponible tooa formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-390">But as noted below, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="a6979-391">Par conséquent, tous les échantillons pour une période donnée ne sont pas forcément disponibles pour évaluation par une formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="a6979-392">Spécifie le nombre hello de tooobtain exemples à partir d’échantillons les plus récents hello qui ont été collectés.</span><span class="sxs-lookup"><span data-stu-id="a6979-392">Specifies hello number of samples tooobtain from hello most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="a6979-393">`GetSample(1)`Retourne la dernière hello, exemple disponible.</span><span class="sxs-lookup"><span data-stu-id="a6979-393">`GetSample(1)` returns hello last available sample.</span></span> <span data-ttu-id="a6979-394">Pour les métriques tels que `$CPUPercent`, toutefois, cela pas doit être utilisé, car il est impossible tooknow *lorsque* hello échantillon a été collecté.</span><span class="sxs-lookup"><span data-stu-id="a6979-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible tooknow *when* hello sample was collected.</span></span> <span data-ttu-id="a6979-395">Il peut s’agir d’un événement récent ou plus ancien en raison de problèmes système.</span><span class="sxs-lookup"><span data-stu-id="a6979-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="a6979-396">Il est préférable, dans ce cas de toouse un intervalle de temps, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="a6979-396">It is better in such cases toouse a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="a6979-397">Spécifie le délai d’exécution de la collecte des exemples de données.</span><span class="sxs-lookup"><span data-stu-id="a6979-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="a6979-398">Si vous le souhaitez, il spécifie également pourcentage d’échantillons qui doivent être disponibles dans hello hello demandé laps de temps.</span><span class="sxs-lookup"><span data-stu-id="a6979-398">Optionally, it also specifies hello percentage of samples that must be available in hello requested time frame.</span></span><br/><br/><span data-ttu-id="a6979-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)`Renvoie 20 échantillons si tous les échantillons pour hello les 10 dernières minutes sont présentes dans l’historique de CPUPercent hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for hello last 10 minutes are present in hello CPUPercent history.</span></span> <span data-ttu-id="a6979-400">Toutefois, si hello dernière minute de l’historique n’était pas disponible, exemples uniquement 18 sont retournées.</span><span class="sxs-lookup"><span data-stu-id="a6979-400">If hello last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="a6979-401">Dans ce cas :</span><span class="sxs-lookup"><span data-stu-id="a6979-401">In this case:</span></span><br/><br/><span data-ttu-id="a6979-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)`échoue, car seuls 90 pour cent d’échantillons de hello sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="a6979-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of hello samples are available.</span></span><br/><br/><span data-ttu-id="a6979-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` aboutirait.</span><span class="sxs-lookup"><span data-stu-id="a6979-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="a6979-404">Spécifie le délai d’exécution de la collecte des données avec une heure de début et une heure de fin.</span><span class="sxs-lookup"><span data-stu-id="a6979-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="a6979-405">Comme indiqué ci-dessus, il existe un décalage entre quand un échantillon est collecté et lorsqu’il est disponible tooa formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-405">As mentioned above, there is a delay between when a sample is collected and when it is available tooa formula.</span></span> <span data-ttu-id="a6979-406">Envisagez ce délai lorsque vous utilisez hello `GetSample` (méthode).</span><span class="sxs-lookup"><span data-stu-id="a6979-406">Consider this delay when you use hello `GetSample` method.</span></span> <span data-ttu-id="a6979-407">Consultez `GetSamplePercent` ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="a6979-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="a6979-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="a6979-408">GetSamplePeriod()</span></span> |<span data-ttu-id="a6979-409">Retourne la période hello d’échantillons qui ont été effectuées dans un jeu de données exemple historiques.</span><span class="sxs-lookup"><span data-stu-id="a6979-409">Returns hello period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="a6979-410">Count()</span><span class="sxs-lookup"><span data-stu-id="a6979-410">Count()</span></span> |<span data-ttu-id="a6979-411">Retourne hello nombre total d’échantillons dans l’historique de la métrique de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-411">Returns hello total number of samples in hello metric history.</span></span> |
| <span data-ttu-id="a6979-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="a6979-412">HistoryBeginTime()</span></span> |<span data-ttu-id="a6979-413">Retourne hello horodatage de hello plus ancien disponible échantillon de données de mesure de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-413">Returns hello time stamp of hello oldest available data sample for hello metric.</span></span> |
| <span data-ttu-id="a6979-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="a6979-414">GetSamplePercent()</span></span> |<span data-ttu-id="a6979-415">Retourne hello pourcentage des exemples qui sont disponibles pour un intervalle de temps donné.</span><span class="sxs-lookup"><span data-stu-id="a6979-415">Returns hello percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="a6979-416">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a6979-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="a6979-417">Étant donné que hello `GetSample` méthode échoue si le pourcentage d’échantillons retourné hello est inférieur à hello `samplePercent` spécifié, vous pouvez utiliser hello `GetSamplePercent` méthode toocheck première.</span><span class="sxs-lookup"><span data-stu-id="a6979-417">Because hello `GetSample` method fails if hello percentage of samples returned is less than hello `samplePercent` specified, you can use hello `GetSamplePercent` method toocheck first.</span></span> <span data-ttu-id="a6979-418">Ensuite, vous pouvez effectuer une autre action si exemples insuffisantes sont présentes, sans arrêter l’évaluation de mise à l’échelle automatique hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-418">Then you can perform an alternate action if insufficient samples are present, without halting hello automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-hello-getsample-method"></a><span data-ttu-id="a6979-419">Exemples et pourcentage de l’exemple hello *GetSample()* (méthode)</span><span class="sxs-lookup"><span data-stu-id="a6979-419">Samples, sample percentage, and hello *GetSample()* method</span></span>
<span data-ttu-id="a6979-420">fonctionnement de base Hello d’une formule de mise à l’échelle est données métriques tooobtain tâches et les ressources et ajustez ensuite la taille du pool basé sur ces données.</span><span class="sxs-lookup"><span data-stu-id="a6979-420">hello core operation of an autoscale formula is tooobtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="a6979-421">Par conséquent, il est important toohave conscience de l’interagissent entre les formules de mise à l’échelle avec les données de métriques (exemples).</span><span class="sxs-lookup"><span data-stu-id="a6979-421">As such, it is important toohave a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="a6979-422">**Exemples**</span><span class="sxs-lookup"><span data-stu-id="a6979-422">**Samples**</span></span>

<span data-ttu-id="a6979-423">Hello service Batch régulièrement tire les exemples de tâches et les ressources des métriques et les formules de mise à l’échelle tooyour disponibles.</span><span class="sxs-lookup"><span data-stu-id="a6979-423">hello Batch service periodically takes samples of task and resource metrics and makes them available tooyour autoscale formulas.</span></span> <span data-ttu-id="a6979-424">Ces exemples sont enregistrées toutes les 30 secondes par hello service Batch.</span><span class="sxs-lookup"><span data-stu-id="a6979-424">These samples are recorded every 30 seconds by hello Batch service.</span></span> <span data-ttu-id="a6979-425">Toutefois, il y a généralement un délai entre lorsque ces exemples ont été enregistrés et lorsqu’elles sont rendues disponibles trop (et peuvent être lu par) vos formules de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-425">However, there is typically a delay between when those samples were recorded and when they are made available too(and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="a6979-426">En outre, en raison de facteurs tels que le réseau ou d’autres problèmes d’infrastructure toovarious échantillons ne soient pas enregistrées pour un intervalle donné.</span><span class="sxs-lookup"><span data-stu-id="a6979-426">Additionally, due toovarious factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="a6979-427">**Pourcentage d’échantillonnage**</span><span class="sxs-lookup"><span data-stu-id="a6979-427">**Sample percentage**</span></span>

<span data-ttu-id="a6979-428">Lorsque `samplePercent` est passé toohello `GetSample()` méthode ou hello `GetSamplePercent()` méthode est appelée, _%_ fait référence tooa comparer le nombre possible de hello total d’exemples qui sont enregistrées par hello service Batch et nombre de Hello d’exemples qui sont la formule de mise à l’échelle tooyour disponibles.</span><span class="sxs-lookup"><span data-stu-id="a6979-428">When `samplePercent` is passed toohello `GetSample()` method or hello `GetSamplePercent()` method is called, _percent_ refers tooa comparison between hello total possible number of samples that are recorded by hello Batch service and hello number of samples that are available tooyour autoscale formula.</span></span>

<span data-ttu-id="a6979-429">Prenons l’exemple d’un intervalle de 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="a6979-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="a6979-430">Étant donné que les exemples sont enregistrées toutes les 30 secondes dans un intervalle de temps de 10 minutes, hello maximale nombre total d’exemples qui sont enregistrés par le traitement par lots serait 20 échantillons (2 par minute).</span><span class="sxs-lookup"><span data-stu-id="a6979-430">Because samples are recorded every 30 seconds within a 10-minute timespan, hello maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="a6979-431">Toutefois, en raison de la latence inhérente de toohello Hello reporting mécanisme et autres problèmes dans Azure, il peut être uniquement 15 échantillons sont la formule de mise à l’échelle tooyour disponibles pour la lecture.</span><span class="sxs-lookup"><span data-stu-id="a6979-431">However, due toohello inherent latency of hello reporting mechanism and other issues within Azure, there may be only 15 samples that are available tooyour autoscale formula for reading.</span></span> <span data-ttu-id="a6979-432">Par conséquent, par exemple, pendant cette période de 10 minutes, qu’à 75 % du nombre total de hello d’échantillons enregistré peut être tooyour disponibles formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-432">So, for example, for that 10-minute period, only 75% of hello total number of samples recorded may be available tooyour formula.</span></span>

<span data-ttu-id="a6979-433">**Méthode GetSample() et plages d’échantillons**</span><span class="sxs-lookup"><span data-stu-id="a6979-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="a6979-434">Vos formules de mise à l’échelle sont augmente de toobe continu et la réduction de vos pools &mdash; Ajout de nœuds ou la suppression de nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-434">Your autoscale formulas are going toobe growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="a6979-435">Étant donné que les nœuds de coûtent pour vous, vous souhaitez tooensure vos formules utilisent une méthode intelligente d’analyse est basée sur des données suffisantes.</span><span class="sxs-lookup"><span data-stu-id="a6979-435">Because nodes cost you money, you want tooensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="a6979-436">Par conséquent, nous vous recommandons d’utiliser une analyse des types de tendance dans vos formules.</span><span class="sxs-lookup"><span data-stu-id="a6979-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="a6979-437">Ce type augmente ou réduit vos pools en fonction d’une plage d’échantillons collectés.</span><span class="sxs-lookup"><span data-stu-id="a6979-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="a6979-438">toodo donc utiliser `GetSample(interval look-back start, interval look-back end)` tooreturn un vecteur d’échantillons :</span><span class="sxs-lookup"><span data-stu-id="a6979-438">toodo so, use `GetSample(interval look-back start, interval look-back end)` tooreturn a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="a6979-439">Hello au-dessus de la ligne est évaluée par lot, il renvoie une plage d’échantillons comme un vecteur de valeurs.</span><span class="sxs-lookup"><span data-stu-id="a6979-439">When hello above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="a6979-440">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a6979-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="a6979-441">Une fois que vous avez collecté vecteur hello d’échantillons, vous pouvez ensuite utiliser des fonctions telles que `min()`, `max()`, et `avg()` tooderive des valeurs significatives à partir de hello collectées plage.</span><span class="sxs-lookup"><span data-stu-id="a6979-441">Once you've collected hello vector of samples, you can then use functions like `min()`, `max()`, and `avg()` tooderive meaningful values from hello collected range.</span></span>

<span data-ttu-id="a6979-442">Pour renforcer la sécurité, vous pouvez forcer une toofail d’évaluation de formule si inférieur à un certain pourcentage de l’exemple est disponible pour une période donnée.</span><span class="sxs-lookup"><span data-stu-id="a6979-442">For additional security, you can force a formula evaluation toofail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="a6979-443">Lorsque vous forcez une toofail d’évaluation de formule, vous indiquez à toocease lot davantage l’évaluation de la formule de hello si hello spécifié pourcentage d’échantillons n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="a6979-443">When you force a formula evaluation toofail, you instruct Batch toocease further evaluation of hello formula if hello specified percentage of samples is not available.</span></span> <span data-ttu-id="a6979-444">Dans ce cas, aucune modification n’est apportée toohello taille du pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-444">In this case, no change is made toohello pool size.</span></span> <span data-ttu-id="a6979-445">toospecify un pourcentage obligatoire d’échantillons pour hello évaluation toosucceed, spécifiez-le comme hello troisième paramètre trop`GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="a6979-445">toospecify a required percentage of samples for hello evaluation toosucceed, specify it as hello third parameter too`GetSample()`.</span></span> <span data-ttu-id="a6979-446">Dans l’exemple ci-dessous, une exigence de 75 pour cent d’échantillons est spécifiée :</span><span class="sxs-lookup"><span data-stu-id="a6979-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="a6979-447">Car il peut y avoir un délai dans la disponibilité d’exemple, il est important de tooalways spécifier une plage de temps avec une heure de début de l’aspect différée est antérieure à une minute.</span><span class="sxs-lookup"><span data-stu-id="a6979-447">Because there may be a delay in sample availability, it is important tooalways specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="a6979-448">Il prend environ une minute pour toopropagate exemples via le système de hello, par conséquent, des exemples dans la plage de hello `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` ne peuvent pas être disponibles.</span><span class="sxs-lookup"><span data-stu-id="a6979-448">It takes approximately one minute for samples toopropagate through hello system, so samples in hello range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="a6979-449">Là encore, vous pouvez utiliser le paramètre de pourcentage hello de `GetSample()` tooforce une exigence de pourcentage exemple spécifique.</span><span class="sxs-lookup"><span data-stu-id="a6979-449">Again, you can use hello percentage parameter of `GetSample()` tooforce a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a6979-450">Nous vous **conseillons fortement** **d’éviter de vous appuyer *uniquement* sur `GetSample(1)` dans vos formules de mise à l’échelle automatique**,</span><span class="sxs-lookup"><span data-stu-id="a6979-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="a6979-451">C’est parce que `GetSample(1)` essentiellement indique que le service de traitement par lots toohello, « Donnent me hello dernier échantillon avoir, quel que soit le temps écoulé de récupérer. »</span><span class="sxs-lookup"><span data-stu-id="a6979-451">This is because `GetSample(1)` essentially says toohello Batch service, "Give me hello last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="a6979-452">Dans la mesure où il est uniquement un échantillon unique, et il peut être un exemple plus anciens, peut-être pas représentatif d’image hello des tâches récentes ou l’état de la ressource.</span><span class="sxs-lookup"><span data-stu-id="a6979-452">Since it is only a single sample, and it may be an older sample, it may not be representative of hello larger picture of recent task or resource state.</span></span> <span data-ttu-id="a6979-453">Si vous utilisez `GetSample(1)`, assurez-vous qu’il fait partie d’une instruction supérieure et pas hello seul point de données qui dépend de votre formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not hello only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="a6979-454">Mesures</span><span class="sxs-lookup"><span data-stu-id="a6979-454">Metrics</span></span>
<span data-ttu-id="a6979-455">Vous pouvez utiliser à la fois les mesures de ressources et de tâches quand vous définissez une formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="a6979-456">Vous ajustez le nombre de cible de hello de nœuds dédiés dans le pool hello en fonction des données de métriques hello vous procurer et d’évaluez.</span><span class="sxs-lookup"><span data-stu-id="a6979-456">You adjust hello target number of dedicated nodes in hello pool based on hello metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="a6979-457">Consultez hello [Variables](#variables) section ci-dessus pour plus d’informations sur chaque métrique.</span><span class="sxs-lookup"><span data-stu-id="a6979-457">See hello [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="a6979-458">Mesure</span><span class="sxs-lookup"><span data-stu-id="a6979-458">Metric</span></span></th>
    <th><span data-ttu-id="a6979-459">Description</span><span class="sxs-lookup"><span data-stu-id="a6979-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="a6979-460"><b>Ressource</b></span><span class="sxs-lookup"><span data-stu-id="a6979-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="a6979-461">Métriques de ressources sont basés sur hello UC, la bande passante hello, utilisation de la mémoire hello de nœuds de calcul et hello du nombre de nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-461">Resource metrics are based on hello CPU, hello bandwidth, hello memory usage of compute nodes, and hello number of nodes.</span></span></p>
        <p> <span data-ttu-id="a6979-462">Ces variables définies par le service sont utiles pour effectuer des ajustements en fonction du nombre de nœuds :</span><span class="sxs-lookup"><span data-stu-id="a6979-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="a6979-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="a6979-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="a6979-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="a6979-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="a6979-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="a6979-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="a6979-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="a6979-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="a6979-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="a6979-469">Ces variables définies par le service sont utilisées pour effectuer des ajustements en fonction de l’utilisation des ressources du nœud :</span><span class="sxs-lookup"><span data-stu-id="a6979-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="a6979-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="a6979-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="a6979-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="a6979-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="a6979-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="a6979-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="a6979-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="a6979-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="a6979-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="a6979-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="a6979-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="a6979-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="a6979-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="a6979-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="a6979-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="a6979-480"><b>Tâche</b></span><span class="sxs-lookup"><span data-stu-id="a6979-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="a6979-481">Métriques de tâche sont basés sur l’état de hello de tâches, comme actif, en attente et s’est terminées.</span><span class="sxs-lookup"><span data-stu-id="a6979-481">Task metrics are based on hello status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="a6979-482">Hello défini par le service variables suivantes sont utiles pour effectuer les modifications de taille de pool basées sur les mesures de tâche :</span><span class="sxs-lookup"><span data-stu-id="a6979-482">hello following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="a6979-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="a6979-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="a6979-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="a6979-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="a6979-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="a6979-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="a6979-488">Écrire une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-488">Write an autoscale formula</span></span>
<span data-ttu-id="a6979-489">Vous générez une formule de mise à l’échelle par formation d’instructions qui utilisent hello au-dessus de composants, puis combinez ces instructions dans une formule complète.</span><span class="sxs-lookup"><span data-stu-id="a6979-489">You build an autoscale formula by forming statements that use hello above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="a6979-490">Dans cette section, nous allons créer un exemple de formule capable de prendre des décisions concrètes en matière de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="a6979-491">Tout d’abord, nous allons définir les exigences de hello pour notre nouvelle formule de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-491">First, let's define hello requirements for our new autoscale formula.</span></span> <span data-ttu-id="a6979-492">formule de Hello doit :</span><span class="sxs-lookup"><span data-stu-id="a6979-492">hello formula should:</span></span>

1. <span data-ttu-id="a6979-493">Augmenter le nombre de cibles de hello dédié de nœuds de calcul dans un pool si l’utilisation du processeur est élevée.</span><span class="sxs-lookup"><span data-stu-id="a6979-493">Increase hello target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="a6979-494">Réduire le nombre de cibles de hello dédié de nœuds de calcul dans un pool lors de l’utilisation du processeur est faible.</span><span class="sxs-lookup"><span data-stu-id="a6979-494">Decrease hello target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="a6979-495">Toujours limiter nombre maximal de hello de nœuds dédié too400.</span><span class="sxs-lookup"><span data-stu-id="a6979-495">Always restrict hello maximum number of dedicated nodes too400.</span></span>

<span data-ttu-id="a6979-496">nombre de hello tooincrease de nœuds lors de l’utilisation élevée du processeur, définir l’instruction hello qui remplit une variable définie par l’utilisateur (`$totalDedicatedNodes`) avec une valeur qui est de 110 % de hello cible nombre actuel de nœuds dédiés, mais uniquement si hello minimale utilisation moyenne du processeur au cours de hello les 10 dernières minutes était supérieure à 70 %.</span><span class="sxs-lookup"><span data-stu-id="a6979-496">tooincrease hello number of nodes during high CPU usage, define hello statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of hello current target number of dedicated nodes, but only if hello minimum average CPU usage during hello last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="a6979-497">Sinon, utilisez hello valeur pour le nombre actuel de hello de nœuds dédiés.</span><span class="sxs-lookup"><span data-stu-id="a6979-497">Otherwise, use hello value for hello current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="a6979-498">trop*diminuer* hello du nombre de nœuds dédiés lors de l’utilisation du processeur basse, hello l’instruction suivante dans notre hello de jeux de formules même `$totalDedicatedNodes` % too90 variable de hello cible nombre actuel de nœuds dédiés si hello utilisation moyenne du processeur Bonjour dernières minutes 60 a été sous 20 pour cent.</span><span class="sxs-lookup"><span data-stu-id="a6979-498">too*decrease* hello number of dedicated nodes during low CPU usage, hello next statement in our formula sets hello same `$totalDedicatedNodes` variable too90 percent of hello current target number of dedicated nodes if hello average CPU usage in hello past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="a6979-499">Sinon, utilisez la valeur actuelle de hello de `$totalDedicatedNodes` que nous avons rempli dans l’instruction hello ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="a6979-499">Otherwise, use hello current value of `$totalDedicatedNodes` that we populated in hello statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="a6979-500">Maintenant limite hello cible le nombre maximum de tooa de nœuds de calcul dédié de 400 :</span><span class="sxs-lookup"><span data-stu-id="a6979-500">Now limit hello target number of dedicated compute nodes tooa maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="a6979-501">Voici la formule complète de hello :</span><span class="sxs-lookup"><span data-stu-id="a6979-501">Here's hello complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="a6979-502">Créer un pool avec mise à l’échelle automatique dans .NET</span><span class="sxs-lookup"><span data-stu-id="a6979-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="a6979-503">toocreate un pool avec l’échelle automatique activée dans .NET, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="a6979-503">toocreate a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="a6979-504">Créer le pool hello avec [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="a6979-504">Create hello pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="a6979-505">Ensemble hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) propriété trop`true`.</span><span class="sxs-lookup"><span data-stu-id="a6979-505">Set hello [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property too`true`.</span></span>
3. <span data-ttu-id="a6979-506">Ensemble hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) propriété avec la formule de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-506">Set hello [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="a6979-507">(Facultatif) Ensemble hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) propriété (valeur par défaut est 15 minutes).</span><span class="sxs-lookup"><span data-stu-id="a6979-507">(Optional) Set hello [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="a6979-508">Valider le pool hello avec [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) ou [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="a6979-508">Commit hello pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="a6979-509">Hello extrait de code suivant crée un pool de mise à l’échelle dans .NET.</span><span class="sxs-lookup"><span data-stu-id="a6979-509">hello following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="a6979-510">Hello formule de mise à l’échelle du pool définit nombre cible de hello de too5 nœuds dédié lundi et 1 sur tous les jours de semaine de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-510">hello pool's autoscale formula sets hello target number of dedicated nodes too5 on Mondays, and 1 on every other day of hello week.</span></span> <span data-ttu-id="a6979-511">Hello [intervalle de mise à l’échelle automatique](#automatic-scaling-interval) est définie too30 minutes.</span><span class="sxs-lookup"><span data-stu-id="a6979-511">hello [automatic scaling interval](#automatic-scaling-interval) is set too30 minutes.</span></span> <span data-ttu-id="a6979-512">Dans ce et hello autres extraits de code c# dans cet article, `myBatchClient` est une instance initialisée correctement de hello [BatchClient] [ net_batchclient] classe.</span><span class="sxs-lookup"><span data-stu-id="a6979-512">In this and hello other C# snippets in this article, `myBatchClient` is a properly initialized instance of hello [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="a6979-513">Lorsque vous créez un pool de mise à l’échelle, ne spécifiez pas hello _targetDedicatedComputeNodes_ paramètre ou hello _targetLowPriorityComputeNodes_ paramètre sur hello appeler trop **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="a6979-513">When you create an autoscale-enabled pool, do not specify hello _targetDedicatedComputeNodes_ parameter or hello _targetLowPriorityComputeNodes_ parameter on hello call too**CreatePool**.</span></span> <span data-ttu-id="a6979-514">Au lieu de cela, spécifiez hello **AutoScaleEnabled** et **AutoScaleFormula** propriétés sur le pool de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-514">Instead, specify hello **AutoScaleEnabled** and **AutoScaleFormula** properties on hello pool.</span></span> <span data-ttu-id="a6979-515">valeurs Hello pour ces propriétés déterminent le nombre de cible de hello de chaque type de nœud.</span><span class="sxs-lookup"><span data-stu-id="a6979-515">hello values for these properties determine hello target number of each type of node.</span></span> <span data-ttu-id="a6979-516">En outre, toomanually redimensionner un pool de mise à l’échelle (par exemple, avec [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), d’abord **désactiver** mise à l’échelle automatique sur Hello pool, puis redimensionnez-le.</span><span class="sxs-lookup"><span data-stu-id="a6979-516">Also, toomanually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on hello pool, then resize it.</span></span>
>
>

<span data-ttu-id="a6979-517">En outre tooBatch .NET, vous pouvez utiliser une des hello autres [kits de développement logiciel lot](batch-apis-tools.md#azure-accounts-for-batch-development), [lot reste](https://docs.microsoft.com/rest/api/batchservice/), [applets de commande PowerShell de lot](batch-powershell-cmdlets-get-started.md)et hello [lot CLI](batch-cli-get-started.md)tooconfigure échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-517">In addition tooBatch .NET, you can use any of hello other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and hello [Batch CLI](batch-cli-get-started.md) tooconfigure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="a6979-518">Intervalle de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-518">Automatic scaling interval</span></span>
<span data-ttu-id="a6979-519">Par défaut, hello service Batch ajuste la taille d’un pool en fonction de tooits formule de mise à l’échelle toutes les 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="a6979-519">By default, hello Batch service adjusts a pool's size according tooits autoscale formula every 15 minutes.</span></span> <span data-ttu-id="a6979-520">Cet intervalle est configurable à l’aide de hello pool propriétés suivantes :</span><span class="sxs-lookup"><span data-stu-id="a6979-520">This interval is configurable by using hello following pool properties:</span></span>

* <span data-ttu-id="a6979-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="a6979-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="a6979-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (API REST)</span><span class="sxs-lookup"><span data-stu-id="a6979-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="a6979-523">intervalle minimal de Hello est de cinq minutes et hello maximale est 168 heures.</span><span class="sxs-lookup"><span data-stu-id="a6979-523">hello minimum interval is five minutes, and hello maximum is 168 hours.</span></span> <span data-ttu-id="a6979-524">Si un intervalle en dehors de cette plage est spécifié, hello service Batch retourne une erreur demande incorrecte (400).</span><span class="sxs-lookup"><span data-stu-id="a6979-524">If an interval outside this range is specified, hello Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="a6979-525">Échelle n’est pas actuellement prévue toorespond toochanges en moins d’une minute, mais au lieu de cela est prévu taille de hello tooadjust de votre pool progressivement lorsque vous exécutez une charge de travail.</span><span class="sxs-lookup"><span data-stu-id="a6979-525">Autoscaling is not currently intended toorespond toochanges in less than a minute, but rather is intended tooadjust hello size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="a6979-526">Activer la mise à l’échelle automatique sur un pool existant</span><span class="sxs-lookup"><span data-stu-id="a6979-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="a6979-527">Chaque lot fournit une échelle tooenable de façon automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-527">Each Batch SDK provides a way tooenable autoscaling.</span></span> <span data-ttu-id="a6979-528">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="a6979-528">For example:</span></span>

* <span data-ttu-id="a6979-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="a6979-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="a6979-530">[Activer la mise à l’échelle automatique sur un pool][rest_enableautoscale] (API REST)</span><span class="sxs-lookup"><span data-stu-id="a6979-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="a6979-531">Lorsque vous activez l’échelle sur un pool existant, gardez Bonjour l’esprit les points suivants :</span><span class="sxs-lookup"><span data-stu-id="a6979-531">When you enable autoscaling on an existing pool, keep in mind hello following points:</span></span>

* <span data-ttu-id="a6979-532">Si la mise à l’échelle automatique est actuellement désactivée sur le pool de hello lorsque vous émettez hello demande tooenable échelle, vous devez spécifier une formule de mise à l’échelle valide lors de l’exécution de la demande de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-532">If automatic scaling is currently disabled on hello pool when you issue hello request tooenable autoscaling, you must specify a valid autoscale formula when you issue hello request.</span></span> <span data-ttu-id="a6979-533">Vous pouvez éventuellement spécifier un intervalle d’évaluation de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="a6979-534">Si vous ne spécifiez pas un intervalle, la valeur par défaut de hello de 15 minutes est utilisé.</span><span class="sxs-lookup"><span data-stu-id="a6979-534">If you do not specify an interval, hello default value of 15 minutes is used.</span></span>
* <span data-ttu-id="a6979-535">Si l’échelle automatique est actuellement activée sur hello pool, vous pouvez spécifier une formule de mise à l’échelle, un intervalle d’évaluation ou les deux.</span><span class="sxs-lookup"><span data-stu-id="a6979-535">If autoscale is currently enabled on hello pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="a6979-536">Vous devez spécifier au moins l’une de ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="a6979-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="a6979-537">Si vous spécifiez un nouvel intervalle d’évaluation de mise à l’échelle, puis le calendrier d’évaluation existant de hello est arrêté et une planification est démarrée.</span><span class="sxs-lookup"><span data-stu-id="a6979-537">If you specify a new autoscale evaluation interval, then hello existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="a6979-538">du Hello nouvelle planification démarrage hello time est à quels hello demande tooenable échelle a été émis.</span><span class="sxs-lookup"><span data-stu-id="a6979-538">hello new schedule's start time is hello time at which hello request tooenable autoscaling was issued.</span></span>
  * <span data-ttu-id="a6979-539">Si vous omettez soit intervalle de formule ou d’évaluation de la mise à l’échelle hello, hello service Batch continue la valeur actuelle de hello toouse de ce paramètre.</span><span class="sxs-lookup"><span data-stu-id="a6979-539">If you omit either hello autoscale formula or evaluation interval, hello Batch service continues toouse hello current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="a6979-540">Si vous avez spécifié des valeurs pour hello *targetDedicatedComputeNodes* ou *targetLowPriorityComputeNodes* paramètres Hello **CreatePool** lorsque vous avez créé hello (méthode) pool dans .NET, ou pour les paramètres de comparables hello dans une autre langue, alors ces valeurs sont ignorées lorsque hello automatique de mise à l’échelle de formule est évaluée.</span><span class="sxs-lookup"><span data-stu-id="a6979-540">If you specified values for hello *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of hello **CreatePool** method when you created hello pool in .NET, or for hello comparable parameters in another language, then those values are ignored when hello automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="a6979-541">Cet extrait de code c# utilise hello [Batch .NET] [ net_api] échelle tooenable de bibliothèque sur un pool existant :</span><span class="sxs-lookup"><span data-stu-id="a6979-541">This C# code snippet uses hello [Batch .NET][net_api] library tooenable autoscaling on an existing pool:</span></span>

```csharp
// Define hello autoscaling formula. This formula sets hello target number of nodes
// too5 on Mondays, and 1 on every other day of hello week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set hello autoscale formula on hello existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="a6979-542">Mettre à jour une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-542">Update an autoscale formula</span></span>

<span data-ttu-id="a6979-543">formule de hello tooupdate sur un activée à la mise à l’échelle pool existant, appel hello opération tooenable échelle à nouveau avec la nouvelle formule de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-543">tooupdate hello formula on an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new formula.</span></span> <span data-ttu-id="a6979-544">Par exemple, si l’échelle automatique est déjà activé sur `myexistingpool` lorsque hello suivant le code .NET est exécuté, sa formule de mise à l’échelle est remplacé par contenu hello de `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="a6979-544">For example, if autoscaling is already enabled on `myexistingpool` when hello following .NET code is executed, its autoscale formula is replaced with hello contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-hello-autoscale-interval"></a><span data-ttu-id="a6979-545">Intervalle de mise à l’échelle hello mise à jour</span><span class="sxs-lookup"><span data-stu-id="a6979-545">Update hello autoscale interval</span></span>

<span data-ttu-id="a6979-546">intervalle d’évaluation mise à l’échelle tooupdate hello d’un activée à la mise à l’échelle pool existant, appel hello opération tooenable échelle à nouveau avec le nouvel intervalle de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-546">tooupdate hello autoscale evaluation interval of an existing autoscale-enabled pool, call hello operation tooenable autoscaling again with hello new interval.</span></span> <span data-ttu-id="a6979-547">Par exemple, tooset hello mise à l’échelle d’évaluation intervalle too60 minutes pour un pool est déjà activé mise à l’échelle dans .NET :</span><span class="sxs-lookup"><span data-stu-id="a6979-547">For example, tooset hello autoscale evaluation interval too60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="a6979-548">Évaluer une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="a6979-549">Vous pouvez évaluer une formule avant de l’appliquer tooa pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-549">You can evaluate a formula before applying it tooa pool.</span></span> <span data-ttu-id="a6979-550">De cette façon, vous pouvez tester les toosee formule hello comment ses instructions évaluent avant de passer de la formule de hello en production.</span><span class="sxs-lookup"><span data-stu-id="a6979-550">In this way, you can test hello formula toosee how its statements evaluate before you put hello formula into production.</span></span>

<span data-ttu-id="a6979-551">tooevaluate une formule de mise à l’échelle, vous devez d’abord activer l’échelle sur pool hello avec une formule valide.</span><span class="sxs-lookup"><span data-stu-id="a6979-551">tooevaluate an autoscale formula, you must first enable autoscaling on hello pool with a valid formula.</span></span> <span data-ttu-id="a6979-552">tootest une formule sur un pool qui ne dispose pas encore échelle automatique est activée, une ligne hello utiliser une formule `$TargetDedicatedNodes = 0` lorsque vous activez pour la première échelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-552">tootest a formula on a pool that doesn't yet have autoscaling enabled, use hello one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="a6979-553">Ensuite, utilisez une des hello suivant tooevaluate hello formule tootest :</span><span class="sxs-lookup"><span data-stu-id="a6979-553">Then, use one of hello following tooevaluate hello formula you want tootest:</span></span>

* <span data-ttu-id="a6979-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) ou [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="a6979-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="a6979-555">Ces méthodes de traitement par lots .NET requièrent des ID de hello d’un pool existant et une chaîne contenant tooevaluate formule de mise à l’échelle hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-555">These Batch .NET methods require hello ID of an existing pool and a string containing hello autoscale formula tooevaluate.</span></span>

* [<span data-ttu-id="a6979-556">Évaluer une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="a6979-557">Dans cette demande d’API REST, spécifiez l’ID du pool hello Bonjour URI et hello formule de mise à l’échelle Bonjour *autoScaleFormula* élément hello du corps de demande.</span><span class="sxs-lookup"><span data-stu-id="a6979-557">In this REST API request, specify hello pool ID in hello URI, and hello autoscale formula in hello *autoScaleFormula* element of hello request body.</span></span> <span data-ttu-id="a6979-558">réponse Hello d’opération de hello contient toutes les informations d’erreur qui peuvent être associées toohello formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-558">hello response of hello operation contains any error information that might be related toohello formula.</span></span>

<span data-ttu-id="a6979-559">Dans cet extrait de code [Batch .NET][net_api], nous évaluons une formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="a6979-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="a6979-560">Si le pool de hello n’a pas l’échelle automatique activée, nous activez-la tout d’abord.</span><span class="sxs-lookup"><span data-stu-id="a6979-560">If hello pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference tooan existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on hello pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula tooenable autoscaling on the
    // pool. This formula is valid, but won't resize hello pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls tooonce every 30 seconds.
    // Because we want tooapply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here tooensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh hello properties of hello pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on hello pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // hello formula tooevaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform hello autoscale formula evaluation. Note that this code does not
    // actually apply hello formula toohello pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print hello results of hello AutoScaleRun.
        // This will display hello values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply hello formula toohello pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output hello message associated with hello error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="a6979-561">Évaluation réussie de formule hello indiqué dans cet extrait de code produit des résultats similaires à :</span><span class="sxs-lookup"><span data-stu-id="a6979-561">Successful evaluation of hello formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="a6979-562">Obtenir des informations sur les exécutions de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-562">Get information about autoscale runs</span></span>

<span data-ttu-id="a6979-563">tooensure l’exécution de votre formule comme prévu, nous vous recommandons de vérifier régulièrement les résultats hello des exécutions d’échelle hello qui effectue le traitement par lots dans votre pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-563">tooensure that your formula is performing as expected, we recommend that you periodically check hello results of hello autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="a6979-564">toodo, get (ou Actualiser) un toohello de référence du pool, puis examinez les propriétés hello de mise à l’échelle de sa dernière exécution.</span><span class="sxs-lookup"><span data-stu-id="a6979-564">toodo so, get (or refresh) a reference toohello pool, and examine hello properties of its last autoscale run.</span></span>

<span data-ttu-id="a6979-565">Dans .NET de lot, hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) propriété possède plusieurs propriétés qui fournissent des informations sur hello dernière l’échelle automatique exécuter effectuées sur le pool de hello :</span><span class="sxs-lookup"><span data-stu-id="a6979-565">In Batch .NET, hello [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about hello latest automatic scaling run performed on hello pool:</span></span>

* [<span data-ttu-id="a6979-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="a6979-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="a6979-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="a6979-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="a6979-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="a6979-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="a6979-569">Bonjour API REST, hello [obtenir des informations sur un pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) demande retourne des informations sur le pool de hello, qui inclut hello dernière l’échelle automatique, exécutez informations Bonjour [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) propriété.</span><span class="sxs-lookup"><span data-stu-id="a6979-569">In hello REST API, hello [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about hello pool, which includes hello latest automatic scaling run information in hello [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="a6979-570">Hello extrait de code c# suivant utilise hello Batch .NET bibliothèque tooprint plus d’informations sur l’échelle automatique dernière hello s’exécutent sur le pool _monpool_:</span><span class="sxs-lookup"><span data-stu-id="a6979-570">hello following C# code snippet uses hello Batch .NET library tooprint information about hello last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="a6979-571">Résultat de l’exemple Hello précédant l’extrait de code :</span><span class="sxs-lookup"><span data-stu-id="a6979-571">Sample output of hello preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="a6979-572">Exemples de formules de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="a6979-572">Example autoscale formulas</span></span>
<span data-ttu-id="a6979-573">Examinons quelques formules qui montrent différentes manières tooadjust hello quantité des ressources de calcul dans un pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-573">Let's look at a few formulas that show different ways tooadjust hello amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="a6979-574">Exemple 1 : ajustement en fonction du temps</span><span class="sxs-lookup"><span data-stu-id="a6979-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="a6979-575">Supposons que vous souhaitez que la taille du pool hello tooadjust en fonction de la journée hello de la semaine de hello et d’une heure.</span><span class="sxs-lookup"><span data-stu-id="a6979-575">Suppose you want tooadjust hello pool size based on hello day of hello week and time of day.</span></span> <span data-ttu-id="a6979-576">Cet exemple montre comment les tooincrease ou diminuer nombre de hello de nœuds Bonjour pool en conséquence.</span><span class="sxs-lookup"><span data-stu-id="a6979-576">This example shows how tooincrease or decrease hello number of nodes in hello pool accordingly.</span></span>

<span data-ttu-id="a6979-577">formule de Hello obtient d’abord hello heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="a6979-577">hello formula first obtains hello current time.</span></span> <span data-ttu-id="a6979-578">S’il s’agit d’un jour de la semaine (1-5) et les heures de travail (too6 de 8 h 00 PM), taille de pool hello cible a la valeur too20 nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-578">If it's a weekday (1-5) and within working hours (8 AM too6 PM), hello target pool size is set too20 nodes.</span></span> <span data-ttu-id="a6979-579">Sinon, il a la valeur too10 nœuds.</span><span class="sxs-lookup"><span data-stu-id="a6979-579">Otherwise, it's set too10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="a6979-580">Exemple 2 : ajustement en fonction de la tâche</span><span class="sxs-lookup"><span data-stu-id="a6979-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="a6979-581">Dans cet exemple, la taille du pool hello est ajustée en fonction nombre hello de tâches dans la file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-581">In this example, hello pool size is adjusted based on hello number of tasks in hello queue.</span></span> <span data-ttu-id="a6979-582">Les commentaires et les sauts de ligne sont acceptés dans les chaînes de formule.</span><span class="sxs-lookup"><span data-stu-id="a6979-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for hello past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use hello last sample point,
// otherwise we use hello maximum of last sample point and hello history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM toopending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// hello pool size is capped at 20, if target VM value is more than that, set it
// too20. This value should be adjusted according tooyour use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="a6979-583">Exemple 3 : comptabilisation des tâches parallèles</span><span class="sxs-lookup"><span data-stu-id="a6979-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="a6979-584">Cet exemple modifie la taille de pool de hello en fonction du nombre de hello de tâches.</span><span class="sxs-lookup"><span data-stu-id="a6979-584">This example adjusts hello pool size based on hello number of tasks.</span></span> <span data-ttu-id="a6979-585">Cette formule prend également en hello de compte [MaxTasksPerComputeNode] [ net_maxtasks] valeur a été définie pour le pool de hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-585">This formula also takes into account hello [MaxTasksPerComputeNode][net_maxtasks] value that has been set for hello pool.</span></span> <span data-ttu-id="a6979-586">Cette approche est particulièrement utile dans les situations où [l’exécution parallèle de tâches](batch-parallel-node-tasks.md) a été activée sur votre pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of hello samples have been recorded in hello past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set hello number of nodes tooadd tooone-fourth hello number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set too4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt toogrow hello number of compute nodes toomatch hello number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep hello nodes active until hello tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="a6979-587">Exemple 4 : définition d’une taille de pool initiale</span><span class="sxs-lookup"><span data-stu-id="a6979-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="a6979-588">Cet exemple montre d’extrait de code dans une formule de mise à l’échelle qui définit le code c# hello tooa de taille de pool spécifié le nombre de nœuds pour une période initiale.</span><span class="sxs-lookup"><span data-stu-id="a6979-588">This example shows a C# code snippet with an autoscale formula that sets hello pool size tooa specified number of nodes for an initial time period.</span></span> <span data-ttu-id="a6979-589">Puis il ajuste la taille du pool hello en fonction du nombre de hello en cours d’exécution et les tâches actives après hello initiale laps de temps écoulé.</span><span class="sxs-lookup"><span data-stu-id="a6979-589">Then it adjusts hello pool size based on hello number of running and active tasks after hello initial time period has elapsed.</span></span>

<span data-ttu-id="a6979-590">formule Hello Bonjour suivant extrait de code :</span><span class="sxs-lookup"><span data-stu-id="a6979-590">hello formula in hello following code snippet:</span></span>

* <span data-ttu-id="a6979-591">Définit le pool initial de hello nœuds toofour de taille.</span><span class="sxs-lookup"><span data-stu-id="a6979-591">Sets hello initial pool size toofour nodes.</span></span>
* <span data-ttu-id="a6979-592">N’ajuste pas taille du pool hello dans hello 10 premières minutes de cycle de vie du pool hello.</span><span class="sxs-lookup"><span data-stu-id="a6979-592">Does not adjust hello pool size within hello first 10 minutes of hello pool's lifecycle.</span></span>
* <span data-ttu-id="a6979-593">Après 10 minutes, obtient la valeur max hello hello active et du numéro de l’exécution tâches au sein de hello dernières de 60 minutes.</span><span class="sxs-lookup"><span data-stu-id="a6979-593">After 10 minutes, obtains hello max value of hello number of running and active tasks within hello past 60 minutes.</span></span>
  * <span data-ttu-id="a6979-594">Si les deux valeurs sont 0 (ce qui indique qu’aucune tâche n’étaient en cours d’exécution ou active Bonjour 60 dernières minutes), taille du pool hello a la valeur too0.</span><span class="sxs-lookup"><span data-stu-id="a6979-594">If both values are 0 (indicating that no tasks were running or active in hello last 60 minutes), hello pool size is set too0.</span></span>
  * <span data-ttu-id="a6979-595">Si l’une des valeurs est supérieure à zéro, aucune modification n’est apportée.</span><span class="sxs-lookup"><span data-stu-id="a6979-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="a6979-596">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a6979-596">Next steps</span></span>
* <span data-ttu-id="a6979-597">[Optimiser l’utilisation des ressources calcul Azure Batch avec les tâches simultanées nœud](batch-parallel-node-tasks.md) contient des détails sur la façon dont vous pouvez exécuter plusieurs tâches simultanément sur les nœuds de calcul hello dans votre pool.</span><span class="sxs-lookup"><span data-stu-id="a6979-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on hello compute nodes in your pool.</span></span> <span data-ttu-id="a6979-598">En outre tooautoscaling, cette fonctionnalité peut aider à durée du travail toolower pour certaines charges de travail, vous épargner.</span><span class="sxs-lookup"><span data-stu-id="a6979-598">In addition tooautoscaling, this feature may help toolower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="a6979-599">Pour une autre amélioration de l’efficacité, assurez-vous que votre application, des requêtes par lots hello service Batch Bonjour la plupart de façon optimale.</span><span class="sxs-lookup"><span data-stu-id="a6979-599">For another efficiency booster, ensure that your Batch application queries hello Batch service in hello most optimal way.</span></span> <span data-ttu-id="a6979-600">Consultez [interroger le service de traitement par lots Azure hello efficacement](batch-efficient-list-queries.md) toolearn comment toolimit hello la quantité de données qui transitent par câble de hello lorsque vous interrogez l’état hello de milliers de calcul nœuds ou des tâches.</span><span class="sxs-lookup"><span data-stu-id="a6979-600">See [Query hello Azure Batch service efficiently](batch-efficient-list-queries.md) toolearn how toolimit hello amount of data that crosses hello wire when you query hello status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
