---
title: "Mettre automatiquement à l’échelle les nœuds de calcul dans un pool Azure Batch | Microsoft Docs"
description: "Activer la mise à l’échelle automatique sur un pool de cloud pour ajuster dynamiquement le nombre de nœuds de calcul dans le pool."
services: batch
documentationcenter: 
author: tamram
manager: timlt
editor: tysonn
ms.assetid: c624cdfc-c5f2-4d13-a7d7-ae080833b779
ms.service: batch
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: multiple
ms.date: 06/20/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f0e49cd8a64a48c53f5b6104703164a597c797f0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="create-an-automatic-scaling-formula-for-scaling-compute-nodes-in-a-batch-pool"></a><span data-ttu-id="56435-103">Mettre automatiquement à l’échelle les nœuds de calcul dans un pool Azure Batch</span><span class="sxs-lookup"><span data-stu-id="56435-103">Create an automatic scaling formula for scaling compute nodes in a Batch pool</span></span>

<span data-ttu-id="56435-104">Azure Batch peut automatiquement mettre à l’échelle des pools en fonction de paramètres que vous définissez.</span><span class="sxs-lookup"><span data-stu-id="56435-104">Azure Batch can automatically scale pools based on parameters that you define.</span></span> <span data-ttu-id="56435-105">Grâce à la mise à l’échelle automatique, Batch ajoute dynamiquement des nœuds à un pool à mesure que les demandes de tâches augmentent, et supprime les nœuds de calcul lorsqu’elles diminuent.</span><span class="sxs-lookup"><span data-stu-id="56435-105">With automatic scaling, Batch dynamically adds nodes to a pool as task demands increase, and removes compute nodes as they decrease.</span></span> <span data-ttu-id="56435-106">Vous gagnez à la fois du temps et de l’argent en ajustant automatiquement le nombre de nœuds de calcul utilisés par votre application Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-106">You can save both time and money by automatically adjusting the number of compute nodes used by your Batch application.</span></span> 

<span data-ttu-id="56435-107">Pour activer la mise à l’échelle automatique sur un pool de nœuds de calcul, associez-lui une *formule de mise à l’échelle* définie par vos soins.</span><span class="sxs-lookup"><span data-stu-id="56435-107">You enable automatic scaling on a pool of compute nodes by associating with it an *autoscale formula* that you define.</span></span> <span data-ttu-id="56435-108">Le service Batch utilise la formule de mise à l’échelle automatique pour déterminer le nombre de nœuds de calcul nécessaires à l’exécution de votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="56435-108">The Batch service uses the autoscale formula to determine the number of compute nodes that are needed to execute your workload.</span></span> <span data-ttu-id="56435-109">Les nœuds de calcul peuvent être des nœuds dédiés ou des [nœuds de faible priorité](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="56435-109">Compute nodes may be dedicated nodes or [low-priority nodes](batch-low-pri-vms.md).</span></span> <span data-ttu-id="56435-110">Batch répond aux données des mesures de service collectées à intervalles réguliers.</span><span class="sxs-lookup"><span data-stu-id="56435-110">Batch responds to service metrics data that is collected periodically.</span></span> <span data-ttu-id="56435-111">Avec ces données de mesures, Batch ajuste le nombre de nœuds de calcul dans le pool en fonction de votre formule et à intervalles configurables.</span><span class="sxs-lookup"><span data-stu-id="56435-111">Using this metrics data, Batch adjusts the number of compute nodes in the pool based on your formula and at a configurable interval.</span></span>

<span data-ttu-id="56435-112">Vous pouvez activer la mise à l’échelle automatique lors de la création d’un pool ou dans un pool existant.</span><span class="sxs-lookup"><span data-stu-id="56435-112">You can enable automatic scaling either when a pool is created, or on an existing pool.</span></span> <span data-ttu-id="56435-113">Vous pouvez également modifier une formule existante dans un pool dont la mise à l’échelle automatique est configurée.</span><span class="sxs-lookup"><span data-stu-id="56435-113">You can also change an existing formula on a pool that is configured for autoscaling.</span></span> <span data-ttu-id="56435-114">Batch permet d’évaluer vos formules avant de les assigner à des pools et de surveiller l’état de l’exécution des mises à l’échelle automatiques.</span><span class="sxs-lookup"><span data-stu-id="56435-114">Batch enables you to evaluate your formulas before assigning them to pools and to monitor the status of automatic scaling runs.</span></span>

<span data-ttu-id="56435-115">Cet article décrit les différentes entités qui composent vos formules de mise à l’échelle automatique, à savoir les variables, les opérateurs, les opérations et les fonctions.</span><span class="sxs-lookup"><span data-stu-id="56435-115">This article discusses the various entities that make up your autoscale formulas, including variables, operators, operations, and functions.</span></span> <span data-ttu-id="56435-116">Nous allons expliquer comment obtenir différentes mesures de ressources et de tâches de calcul au sein de Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-116">We discuss how to obtain various compute resource and task metrics within Batch.</span></span> <span data-ttu-id="56435-117">Vous pouvez utiliser ces mesures pour ajuster votre nombre de nœuds de calcul en fonction de l’utilisation des ressources et de l’état des tâches.</span><span class="sxs-lookup"><span data-stu-id="56435-117">You can use these metrics to adjust your pool's node count based on resource usage and task status.</span></span> <span data-ttu-id="56435-118">Nous vous indiquerons ensuite comment construire une formule et activer la mise à l’échelle automatique dans un pool à l’aide des API REST et .NET de Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-118">We then describe how to construct a formula and enable automatic scaling on a pool by using both the Batch REST and .NET APIs.</span></span> <span data-ttu-id="56435-119">Et nous terminerons par quelques exemples de formule.</span><span class="sxs-lookup"><span data-stu-id="56435-119">Finally, we finish up with a few example formulas.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="56435-120">Lorsque vous créez un compte Batch, vous pouvez spécifier la [configuration du compte](batch-api-basics.md#account), qui détermine si les pools sont alloués dans un abonnement au service Batch (par défaut), ou dans votre abonnement utilisateur.</span><span class="sxs-lookup"><span data-stu-id="56435-120">When you create a Batch account, you can specify the [account configuration](batch-api-basics.md#account), which determines whether pools are allocated in a Batch service subscription (the default), or in your user subscription.</span></span> <span data-ttu-id="56435-121">Si vous avez créé votre compte Batch avec la configuration de service Batch par défaut, votre compte est limité à un nombre maximal de cœurs utilisables pour le traitement.</span><span class="sxs-lookup"><span data-stu-id="56435-121">If you created your Batch account with the default Batch Service configuration, then your account is limited to a maximum number of cores that can be used for processing.</span></span> <span data-ttu-id="56435-122">Le service Batch met à l’échelle des nœuds uniquement jusqu’à cette limite de cœurs.</span><span class="sxs-lookup"><span data-stu-id="56435-122">The Batch service scales compute nodes only up to that core limit.</span></span> <span data-ttu-id="56435-123">C’est pourquoi le service Batch peut ne pas atteindre le nombre cible de nœuds de calcul spécifié par une formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-123">For this reason, the Batch service may not reach the target number of compute nodes specified by an autoscale formula.</span></span> <span data-ttu-id="56435-124">Consultez [Quotas et limites du service Azure Batch](batch-quota-limit.md) pour obtenir des instructions sur l’affichage et l’augmentation des quotas de votre compte.</span><span class="sxs-lookup"><span data-stu-id="56435-124">See [Quotas and limits for the Azure Batch service](batch-quota-limit.md) for information on viewing and increasing your account quotas.</span></span>
>
><span data-ttu-id="56435-125">Si vous avez créé votre compte avec la configuration d’abonnement utilisateur, votre compte partage le quota de cœurs associé à l’abonnement.</span><span class="sxs-lookup"><span data-stu-id="56435-125">If you created your account with the User Subscription configuration, then your account shares in the core quota for the subscription.</span></span> <span data-ttu-id="56435-126">Pour en savoir plus, consultez le paragraphe [Limites de machines virtuelles](../azure-subscription-service-limits.md#virtual-machines-limits) de la section [Abonnement Azure et limites, quotas et contraintes de service](../azure-subscription-service-limits.md).</span><span class="sxs-lookup"><span data-stu-id="56435-126">For more information, see [Virtual Machines limits](../azure-subscription-service-limits.md#virtual-machines-limits) in [Azure subscription and service limits, quotas, and constraints](../azure-subscription-service-limits.md).</span></span>
>
>

## <a name="automatic-scaling-formulas"></a><span data-ttu-id="56435-127">Formules de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-127">Automatic scaling formulas</span></span>
<span data-ttu-id="56435-128">Une formule de mise à l’échelle automatique est une valeur de chaîne définie par vos soins qui contient une ou plusieurs instructions.</span><span class="sxs-lookup"><span data-stu-id="56435-128">An automatic scaling formula is a string value that you define that contains one or more statements.</span></span> <span data-ttu-id="56435-129">La formule de mise à l’échelle automatique est affectée à l’élément [autoScaleFormula][rest_autoscaleformula] d’un pool (Batch REST) ou la propriété [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] (Batch .NET).</span><span class="sxs-lookup"><span data-stu-id="56435-129">The autoscale formula is assigned to a pool's [autoScaleFormula][rest_autoscaleformula] element (Batch REST) or [CloudPool.AutoScaleFormula][net_cloudpool_autoscaleformula] property (Batch .NET).</span></span> <span data-ttu-id="56435-130">Le service Batch utilise votre formule pour déterminer le nombre de nœuds de calcul cibles d’un pool pour le prochain intervalle de traitement.</span><span class="sxs-lookup"><span data-stu-id="56435-130">The Batch service uses your formula to determine the target number of compute nodes in the pool for the next interval of processing.</span></span> <span data-ttu-id="56435-131">La chaîne de formule ne peut pas dépasser 8 Ko. Elle peut inclure jusqu’à 100 instructions séparées par des points-virgules, et peut comprendre des sauts de ligne et des commentaires.</span><span class="sxs-lookup"><span data-stu-id="56435-131">The formula string cannot exceed 8 KB, can include up to 100 statements that are separated by semicolons, and can include line breaks and comments.</span></span>

<span data-ttu-id="56435-132">Les formules de mise à l’échelle automatique reviennent en quelque sorte à utiliser un « langage » de mise à l’échelle Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-132">You can think of automatic scaling formulas as a Batch autoscale "language."</span></span> <span data-ttu-id="56435-133">Les instructions de formules sont des expressions de forme libre qui peuvent inclure des variables définies par le service (variables définies par le service Batch) et des variables définies par l’utilisateur (variables que vous définissez).</span><span class="sxs-lookup"><span data-stu-id="56435-133">Formula statements are free-formed expressions that can include both service-defined variables (variables defined by the Batch service) and user-defined variables (variables that you define).</span></span> <span data-ttu-id="56435-134">Elles peuvent effectuer différentes opérations sur ces valeurs à l’aide de types, d’opérateurs et de fonctions intégrés.</span><span class="sxs-lookup"><span data-stu-id="56435-134">They can perform various operations on these values by using built-in types, operators, and functions.</span></span> <span data-ttu-id="56435-135">Par exemple, une instruction peut prendre la forme suivante :</span><span class="sxs-lookup"><span data-stu-id="56435-135">For example, a statement might take the following form:</span></span>

```
$myNewVariable = function($ServiceDefinedVariable, $myCustomVariable);
```

<span data-ttu-id="56435-136">Les formules contiennent généralement plusieurs instructions qui effectuent des opérations sur les valeurs qui sont obtenues dans les instructions précédentes :</span><span class="sxs-lookup"><span data-stu-id="56435-136">Formulas generally contain multiple statements that perform operations on values that are obtained in previous statements.</span></span> <span data-ttu-id="56435-137">Par exemple, nous obtenons tout d’abord une valeur pour `variable1`, puis la transmettons à une fonction pour renseigner `variable2` :</span><span class="sxs-lookup"><span data-stu-id="56435-137">For example, first we obtain a value for `variable1`, then pass it to a function to populate `variable2`:</span></span>

```
$variable1 = function1($ServiceDefinedVariable);
$variable2 = function2($OtherServiceDefinedVariable, $variable1);
```

<span data-ttu-id="56435-138">Incluez ces instructions dans votre formule de mise à l’échelle pour arriver à un nombre cible de nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="56435-138">Include these statements in your autoscale formula to arrive at a target number of compute nodes.</span></span> <span data-ttu-id="56435-139">Les nœuds dédiés et les nœuds de faible priorité ont leurs propres paramètres cibles, afin que vous puissiez définir une cible pour chaque type de nœud.</span><span class="sxs-lookup"><span data-stu-id="56435-139">Dedicated nodes and low-priority nodes each have their own target settings, so that you can define a target for each type of node.</span></span> <span data-ttu-id="56435-140">Une formule de mise à l’échelle automatique peut inclure une valeur cible pour les nœuds dédiés, une valeur cible pour les nœuds de faible priorité, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="56435-140">An autoscale formula can include a target value for dedicated nodes, a target value for low-priority nodes, or both.</span></span>

<span data-ttu-id="56435-141">Le nombre cible de nœuds peut être supérieur, inférieur ou égal au nombre actuel de nœuds de ce type dans le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-141">The target number of nodes may be higher, lower, or the same as the current number of nodes of that type in the pool.</span></span> <span data-ttu-id="56435-142">Le service Batch évalue la formule de mise à l’échelle automatique d’un pool à un intervalle spécifique (reportez-vous aux [intervalles de mise à l’échelle automatique](#automatic-scaling-interval)).</span><span class="sxs-lookup"><span data-stu-id="56435-142">Batch evaluates a pool's autoscale formula at a specific interval (see [automatic scaling intervals](#automatic-scaling-interval)).</span></span> <span data-ttu-id="56435-143">Batch ajuste ensuite le nombre cible de chaque type de nœud dans le pool en fonction du nombre spécifié par votre formule de mise à l’échelle automatique au moment de l’évaluation.</span><span class="sxs-lookup"><span data-stu-id="56435-143">Batch adjusts the target number of each type of node in the pool to the number that your autoscale formula specifies at the time of evaluation.</span></span>

### <a name="sample-autoscale-formula"></a><span data-ttu-id="56435-144">Exemple de formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-144">Sample autoscale formula</span></span>

<span data-ttu-id="56435-145">Voici un exemple de formule de mise à l’échelle automatique qui peut être adapté pour convenir à la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="56435-145">Here is an example of an autoscale formula that can be adjusted to work for most scenarios.</span></span> <span data-ttu-id="56435-146">Les variables `startingNumberOfVMs` et `maxNumberofVMs` dans l’exemple de formule peuvent être ajustées en fonction de vos besoins.</span><span class="sxs-lookup"><span data-stu-id="56435-146">The variables `startingNumberOfVMs` and `maxNumberofVMs` in the example formula can be adjusted to your needs.</span></span> <span data-ttu-id="56435-147">Cette formule met à l’échelle des nœuds dédiés, mais elle peut être modifiée pour s’appliquer également aux nœuds de faible priorité.</span><span class="sxs-lookup"><span data-stu-id="56435-147">This formula scales dedicated nodes, but can be modified to apply to scale low-priority nodes as well.</span></span> 

```
startingNumberOfVMs = 1;
maxNumberofVMs = 25;
pendingTaskSamplePercent = $PendingTasks.GetSamplePercent(180 * TimeInterval_Second);
pendingTaskSamples = pendingTaskSamplePercent < 70 ? startingNumberOfVMs : avg($PendingTasks.GetSample(180 * TimeInterval_Second));
$TargetDedicatedNodes=min(maxNumberofVMs, pendingTaskSamples);
```

<span data-ttu-id="56435-148">Avec cette formule de mise à l’échelle automatique, le pool est à l’origine créé avec une seule machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="56435-148">With this autoscale formula, the pool is initially created with a single VM.</span></span> <span data-ttu-id="56435-149">La mesure `$PendingTasks` définit le nombre de tâches en cours d’exécution ou en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="56435-149">The `$PendingTasks` metric defines the number of tasks that are running or queued.</span></span> <span data-ttu-id="56435-150">Cette formule recherche le nombre moyen de tâches en attente au cours des 180 dernières secondes et définit la variable `$TargetDedicatedNodes` en conséquence.</span><span class="sxs-lookup"><span data-stu-id="56435-150">The formula finds the average number of pending tasks in the last 180 seconds and sets the `$TargetDedicatedNodes` variable accordingly.</span></span> <span data-ttu-id="56435-151">La formule garantit que le nombre cible de nœuds dédiés ne dépasse jamais 25 machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="56435-151">The formula ensures that the target number of dedicated nodes never exceeds 25 VMs.</span></span> <span data-ttu-id="56435-152">À mesure que de nouvelles tâches sont envoyées, le pool s’accroît automatiquement.</span><span class="sxs-lookup"><span data-stu-id="56435-152">As new tasks are submitted, the pool automatically grows.</span></span> <span data-ttu-id="56435-153">Lorsque les tâches se terminent, les machines virtuelles se libèrent une par une, et la formule de mise à l’échelle automatique réduit le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-153">As tasks complete, VMs become free one by one and the autoscaling formula shrinks the pool.</span></span>

## <a name="variables"></a><span data-ttu-id="56435-154">variables</span><span class="sxs-lookup"><span data-stu-id="56435-154">Variables</span></span>
<span data-ttu-id="56435-155">Vous pouvez utiliser aussi bien des variables **définies par le service** que des variables **définies par l’utilisateur** dans les formules de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-155">You can use both **service-defined** and **user-defined** variables in your autoscale formulas.</span></span> <span data-ttu-id="56435-156">Les variables définies par le service sont intégrées dans le service Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-156">The service-defined variables are built in to the Batch service.</span></span> <span data-ttu-id="56435-157">Certaines variables définies par le service sont en lecture-écriture, tandis que d’autres sont en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="56435-157">Some service-defined variables are read-write, and some are read-only.</span></span> <span data-ttu-id="56435-158">Les variables définies par l’utilisateur sont des variables que vous définissez.</span><span class="sxs-lookup"><span data-stu-id="56435-158">User-defined variables are variables that you define.</span></span> <span data-ttu-id="56435-159">Dans l’exemple de formule illustré dans la section précédente, `$TargetDedicatedNodes` et `$PendingTasks` sont des variables définies par le service.</span><span class="sxs-lookup"><span data-stu-id="56435-159">In the example formula shown in the previous section, `$TargetDedicatedNodes` and `$PendingTasks` are service-defined variables.</span></span> <span data-ttu-id="56435-160">Les variables `startingNumberOfVMs` et `maxNumberofVMs` sont des variables définies par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="56435-160">Variables `startingNumberOfVMs` and `maxNumberofVMs` are user-defined variables.</span></span>

> [!NOTE]
> <span data-ttu-id="56435-161">Les variables définies par le service sont toujours précédées d’un signe dollar ($).</span><span class="sxs-lookup"><span data-stu-id="56435-161">Service-defined variables are always preceded by a dollar sign ($).</span></span> <span data-ttu-id="56435-162">Pour les variables définies par l’utilisateur, le signe dollar est facultatif.</span><span class="sxs-lookup"><span data-stu-id="56435-162">For user-defined variables, the dollar sign is optional.</span></span>
>
>

<span data-ttu-id="56435-163">Les tableaux suivants montrent des variables en lecture-écriture et en lecture seule, définies par le service Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-163">The following tables show both read-write and read-only variables that are defined by the Batch service.</span></span>

<span data-ttu-id="56435-164">Vous pouvez obtenir et définir les valeurs de ces variables définies par le service pour gérer le nombre de nœuds de calcul dans un pool :</span><span class="sxs-lookup"><span data-stu-id="56435-164">You can get and set the values of these service-defined variables to manage the number of compute nodes in a pool:</span></span>

| <span data-ttu-id="56435-165">Variables définies par le service en lecture-écriture</span><span class="sxs-lookup"><span data-stu-id="56435-165">Read-write service-defined variables</span></span> | <span data-ttu-id="56435-166">Description</span><span class="sxs-lookup"><span data-stu-id="56435-166">Description</span></span> |
| --- | --- |
| <span data-ttu-id="56435-167">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="56435-167">$TargetDedicatedNodes</span></span> |<span data-ttu-id="56435-168">Nombre cible de nœuds de calcul dédiés pour le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-168">The target number of dedicated compute nodes for the pool.</span></span> <span data-ttu-id="56435-169">Le nombre de nœuds dédiés est spécifié en tant que cible, car un pool peut ne pas toujours atteindre le nombre de nœuds souhaité.</span><span class="sxs-lookup"><span data-stu-id="56435-169">The number of dedicated nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="56435-170">Par exemple, si le nombre cible de nœuds dédiés est modifié par une évaluation de la mise à l’échelle automatique avant que le pool n’ait atteint la cible initiale, le pool risque de ne pas atteindre la cible.</span><span class="sxs-lookup"><span data-stu-id="56435-170">For example, if the target number of dedicated nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <br /><br /> <span data-ttu-id="56435-171">Un pool dans un compte créé avec la configuration de service Batch peut ne pas atteindre sa cible si la cible dépasse un quota de nœuds ou de cœurs défini pour le compte Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-171">A pool in an account created with the Batch Service configuration may not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <span data-ttu-id="56435-172">Un pool dans un compte créé avec la configuration d’abonnement utilisateur peut ne pas atteindre sa cible si la cible dépasse le quota de nœuds partagé pour l’abonnement.</span><span class="sxs-lookup"><span data-stu-id="56435-172">A pool in an account created with the User Subscription configuration may not achieve its target if the target exceeds the shared core quota for the subscription.</span></span>|
| <span data-ttu-id="56435-173">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="56435-173">$TargetLowPriorityNodes</span></span> |<span data-ttu-id="56435-174">Nombre cible de nœuds de calcul de faible priorité pour le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-174">The target number of low-priority compute nodes for the pool.</span></span> <span data-ttu-id="56435-175">Le nombre de nœuds de faible priorité est spécifié en tant que cible, car un pool peut ne pas toujours atteindre le nombre de nœuds souhaité.</span><span class="sxs-lookup"><span data-stu-id="56435-175">The number of low-priority nodes is specified as a target because a pool may not always achieve the desired number of nodes.</span></span> <span data-ttu-id="56435-176">Par exemple, si le nombre cible de nœuds de faible priorité est modifié par une évaluation de la mise à l’échelle automatique avant que le pool n’ait atteint la cible initiale, le pool risque de ne pas atteindre la cible.</span><span class="sxs-lookup"><span data-stu-id="56435-176">For example, if the target number of low-priority nodes is modified by an autoscale evaluation before the pool has reached the initial target, then the pool may not reach the target.</span></span> <span data-ttu-id="56435-177">Un pool peut également ne pas atteindre sa cible si la cible dépasse un quota de nœuds ou de cœurs défini pour le compte Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-177">A pool may also not achieve its target if the target exceeds a Batch account node or core quota.</span></span> <br /><br /> <span data-ttu-id="56435-178">Pour plus d’informations sur les nœuds de calcul de faible priorité, consultez [Utiliser des machines virtuelles de faible priorité avec Batch (préversion)](batch-low-pri-vms.md).</span><span class="sxs-lookup"><span data-stu-id="56435-178">For more information on low-priority compute nodes, see [Use low-priority VMs with Batch (Preview)](batch-low-pri-vms.md).</span></span> |
| <span data-ttu-id="56435-179">$NodeDeallocationOption</span><span class="sxs-lookup"><span data-stu-id="56435-179">$NodeDeallocationOption</span></span> |<span data-ttu-id="56435-180">Action exécutée lorsque des nœuds de calcul sont supprimés d’un pool.</span><span class="sxs-lookup"><span data-stu-id="56435-180">The action that occurs when compute nodes are removed from a pool.</span></span> <span data-ttu-id="56435-181">Les valeurs possibles sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="56435-181">Possible values are:</span></span><ul><li><span data-ttu-id="56435-182">**requeue** : arrête immédiatement les tâches et les replace dans la file d’attente des travaux pour qu’elles soient replanifiées.</span><span class="sxs-lookup"><span data-stu-id="56435-182">**requeue**--Terminates tasks immediately and puts them back on the job queue so that they are rescheduled.</span></span><li><span data-ttu-id="56435-183">**terminate** : arrête immédiatement les tâches et les supprime de la file d’attente des travaux.</span><span class="sxs-lookup"><span data-stu-id="56435-183">**terminate**--Terminates tasks immediately and removes them from the job queue.</span></span><li><span data-ttu-id="56435-184">**taskcompletion** : attend la fin des tâches en cours d’exécution, puis supprime le nœud du pool.</span><span class="sxs-lookup"><span data-stu-id="56435-184">**taskcompletion**--Waits for currently running tasks to finish and then removes the node from the pool.</span></span><li><span data-ttu-id="56435-185">**retaineddata** : attend que toutes les données de tâche locales conservées sur le nœud aient été nettoyées avant de supprimer le nœud du pool.</span><span class="sxs-lookup"><span data-stu-id="56435-185">**retaineddata**--Waits for all the local task-retained data on the node to be cleaned up before removing the node from the pool.</span></span></ul> |

<span data-ttu-id="56435-186">Vous pouvez obtenir la valeur des variables définies par le service ci-après pour effectuer des ajustements basés sur les mesures à partir du service Batch :</span><span class="sxs-lookup"><span data-stu-id="56435-186">You can get the value of these service-defined variables to make adjustments that are based on metrics from the Batch service:</span></span>

| <span data-ttu-id="56435-187">Variables définies par le service en lecture seule</span><span class="sxs-lookup"><span data-stu-id="56435-187">Read-only service-defined variables</span></span> | <span data-ttu-id="56435-188">Description</span><span class="sxs-lookup"><span data-stu-id="56435-188">Description</span></span> |
| --- | --- |
| <span data-ttu-id="56435-189">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="56435-189">$CPUPercent</span></span> |<span data-ttu-id="56435-190">Pourcentage moyen d’utilisation du processeur.</span><span class="sxs-lookup"><span data-stu-id="56435-190">The average percentage of CPU usage.</span></span> |
| <span data-ttu-id="56435-191">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="56435-191">$WallClockSeconds</span></span> |<span data-ttu-id="56435-192">Nombre de secondes consommées.</span><span class="sxs-lookup"><span data-stu-id="56435-192">The number of seconds consumed.</span></span> |
| <span data-ttu-id="56435-193">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="56435-193">$MemoryBytes</span></span> |<span data-ttu-id="56435-194">Nombre moyen de mégaoctets utilisés.</span><span class="sxs-lookup"><span data-stu-id="56435-194">The average number of megabytes used.</span></span> |
| <span data-ttu-id="56435-195">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="56435-195">$DiskBytes</span></span> |<span data-ttu-id="56435-196">Nombre moyen de gigaoctets utilisés sur les disques locaux.</span><span class="sxs-lookup"><span data-stu-id="56435-196">The average number of gigabytes used on the local disks.</span></span> |
| <span data-ttu-id="56435-197">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="56435-197">$DiskReadBytes</span></span> |<span data-ttu-id="56435-198">Nombre d’octets lus.</span><span class="sxs-lookup"><span data-stu-id="56435-198">The number of bytes read.</span></span> |
| <span data-ttu-id="56435-199">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="56435-199">$DiskWriteBytes</span></span> |<span data-ttu-id="56435-200">Nombre d’octets écrits.</span><span class="sxs-lookup"><span data-stu-id="56435-200">The number of bytes written.</span></span> |
| <span data-ttu-id="56435-201">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="56435-201">$DiskReadOps</span></span> |<span data-ttu-id="56435-202">Nombre d’opérations de lecture sur disque effectuées.</span><span class="sxs-lookup"><span data-stu-id="56435-202">The count of read disk operations performed.</span></span> |
| <span data-ttu-id="56435-203">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="56435-203">$DiskWriteOps</span></span> |<span data-ttu-id="56435-204">Nombre d’opérations d’écriture sur disque effectuées.</span><span class="sxs-lookup"><span data-stu-id="56435-204">The count of write disk operations performed.</span></span> |
| <span data-ttu-id="56435-205">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="56435-205">$NetworkInBytes</span></span> |<span data-ttu-id="56435-206">Nombre d’octets entrants.</span><span class="sxs-lookup"><span data-stu-id="56435-206">The number of inbound bytes.</span></span> |
| <span data-ttu-id="56435-207">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="56435-207">$NetworkOutBytes</span></span> |<span data-ttu-id="56435-208">Nombre d’octets sortants.</span><span class="sxs-lookup"><span data-stu-id="56435-208">The number of outbound bytes.</span></span> |
| <span data-ttu-id="56435-209">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="56435-209">$SampleNodeCount</span></span> |<span data-ttu-id="56435-210">Nombre de nœuds de calcul.</span><span class="sxs-lookup"><span data-stu-id="56435-210">The count of compute nodes.</span></span> |
| <span data-ttu-id="56435-211">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="56435-211">$ActiveTasks</span></span> |<span data-ttu-id="56435-212">Nombre de tâches prêtes à être exécutées, mais pas encore en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="56435-212">The number of tasks that are ready to execute but are not yet executing.</span></span> <span data-ttu-id="56435-213">La valeur $ActiveTasks inclut toutes les tâches qui se trouvent dans un état actif et dont les dépendances ont été satisfaites.</span><span class="sxs-lookup"><span data-stu-id="56435-213">The $ActiveTasks count includes all tasks that are in the active state and whose dependencies have been satisfied.</span></span> <span data-ttu-id="56435-214">Toutes les tâches qui se trouvent dans un état actif mais dont les dépendances n’ont pas été satisfaites sont exclues de la valeur $ActiveTasks.</span><span class="sxs-lookup"><span data-stu-id="56435-214">Any tasks that are in the active state but whose dependencies have not been satisfied are excluded from the $ActiveTasks count.</span></span>|
| <span data-ttu-id="56435-215">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="56435-215">$RunningTasks</span></span> |<span data-ttu-id="56435-216">Nombre de tâches en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="56435-216">The number of tasks in a running state.</span></span> |
| <span data-ttu-id="56435-217">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="56435-217">$PendingTasks</span></span> |<span data-ttu-id="56435-218">Somme de $ActiveTasks et de $RunningTasks.</span><span class="sxs-lookup"><span data-stu-id="56435-218">The sum of $ActiveTasks and $RunningTasks.</span></span> |
| <span data-ttu-id="56435-219">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="56435-219">$SucceededTasks</span></span> |<span data-ttu-id="56435-220">Nombre de tâches ayant abouti.</span><span class="sxs-lookup"><span data-stu-id="56435-220">The number of tasks that finished successfully.</span></span> |
| <span data-ttu-id="56435-221">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="56435-221">$FailedTasks</span></span> |<span data-ttu-id="56435-222">Nombre de tâches ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="56435-222">The number of tasks that failed.</span></span> |
| <span data-ttu-id="56435-223">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="56435-223">$CurrentDedicatedNodes</span></span> |<span data-ttu-id="56435-224">Nombre actuel de nœuds de calcul dédiés.</span><span class="sxs-lookup"><span data-stu-id="56435-224">The current number of dedicated compute nodes.</span></span> |
| <span data-ttu-id="56435-225">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="56435-225">$CurrentLowPriorityNodes</span></span> |<span data-ttu-id="56435-226">Nombre actuel de nœuds de calcul de faible priorité, y compris tous les nœuds réalloués.</span><span class="sxs-lookup"><span data-stu-id="56435-226">The current number of low-priority compute nodes, including any nodes that have been pre-empted.</span></span> |
| <span data-ttu-id="56435-227">$PreemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="56435-227">$PreemptedNodeCount</span></span> | <span data-ttu-id="56435-228">Nombre de nœuds dans le pool qui sont à l’état Réalloué.</span><span class="sxs-lookup"><span data-stu-id="56435-228">The number of nodes in the pool that are in a pre-empted state.</span></span> |

> [!TIP]
> <span data-ttu-id="56435-229">Les variables en lecture seule qui sont définies par le service et illustrées dans le tableau précédent sont des *objets* fournissant diverses méthodes pour accéder aux données qui leur sont associées.</span><span class="sxs-lookup"><span data-stu-id="56435-229">The read-only, service-defined variables that are shown in the previous table are *objects* that provide various methods to access data associated with each.</span></span> <span data-ttu-id="56435-230">Pour plus d’informations, consultez la section [Obtenir des échantillons de données](#getsampledata) dans la suite de cet article.</span><span class="sxs-lookup"><span data-stu-id="56435-230">For more information, see [Obtain sample data](#getsampledata) later in this article.</span></span>
>
>

## <a name="types"></a><span data-ttu-id="56435-231">Types</span><span class="sxs-lookup"><span data-stu-id="56435-231">Types</span></span>
<span data-ttu-id="56435-232">Ces types sont pris en charge dans une formule :</span><span class="sxs-lookup"><span data-stu-id="56435-232">These types are supported in a formula:</span></span>

* <span data-ttu-id="56435-233">double</span><span class="sxs-lookup"><span data-stu-id="56435-233">double</span></span>
* <span data-ttu-id="56435-234">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-234">doubleVec</span></span>
* <span data-ttu-id="56435-235">doubleVecList</span><span class="sxs-lookup"><span data-stu-id="56435-235">doubleVecList</span></span>
* <span data-ttu-id="56435-236">string</span><span class="sxs-lookup"><span data-stu-id="56435-236">string</span></span>
* <span data-ttu-id="56435-237">timestamp : structure composée qui inclut les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="56435-237">timestamp--timestamp is a compound structure that contains the following members:</span></span>

  * <span data-ttu-id="56435-238">year</span><span class="sxs-lookup"><span data-stu-id="56435-238">year</span></span>
  * <span data-ttu-id="56435-239">mois (1-12)</span><span class="sxs-lookup"><span data-stu-id="56435-239">month (1-12)</span></span>
  * <span data-ttu-id="56435-240">jour (1-31)</span><span class="sxs-lookup"><span data-stu-id="56435-240">day (1-31)</span></span>
  * <span data-ttu-id="56435-241">jour de la semaine (sous forme de chiffre, par exemple 1 pour lundi)</span><span class="sxs-lookup"><span data-stu-id="56435-241">weekday (in the format of number; for example, 1 for Monday)</span></span>
  * <span data-ttu-id="56435-242">heure (au format 24 heures, par exemple, 13 signifie 1 PM)</span><span class="sxs-lookup"><span data-stu-id="56435-242">hour (in 24-hour number format; for example, 13 means 1 PM)</span></span>
  * <span data-ttu-id="56435-243">minute (00-59)</span><span class="sxs-lookup"><span data-stu-id="56435-243">minute (00-59)</span></span>
  * <span data-ttu-id="56435-244">seconde (00-59)</span><span class="sxs-lookup"><span data-stu-id="56435-244">second (00-59)</span></span>
* <span data-ttu-id="56435-245">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-245">timeinterval</span></span>

  * <span data-ttu-id="56435-246">TimeInterval_Zero</span><span class="sxs-lookup"><span data-stu-id="56435-246">TimeInterval_Zero</span></span>
  * <span data-ttu-id="56435-247">TimeInterval_100ns</span><span class="sxs-lookup"><span data-stu-id="56435-247">TimeInterval_100ns</span></span>
  * <span data-ttu-id="56435-248">TimeInterval_Microsecond</span><span class="sxs-lookup"><span data-stu-id="56435-248">TimeInterval_Microsecond</span></span>
  * <span data-ttu-id="56435-249">TimeInterval_Millisecond</span><span class="sxs-lookup"><span data-stu-id="56435-249">TimeInterval_Millisecond</span></span>
  * <span data-ttu-id="56435-250">TimeInterval_Second</span><span class="sxs-lookup"><span data-stu-id="56435-250">TimeInterval_Second</span></span>
  * <span data-ttu-id="56435-251">TimeInterval_Minute</span><span class="sxs-lookup"><span data-stu-id="56435-251">TimeInterval_Minute</span></span>
  * <span data-ttu-id="56435-252">TimeInterval_Hour</span><span class="sxs-lookup"><span data-stu-id="56435-252">TimeInterval_Hour</span></span>
  * <span data-ttu-id="56435-253">TimeInterval_Day</span><span class="sxs-lookup"><span data-stu-id="56435-253">TimeInterval_Day</span></span>
  * <span data-ttu-id="56435-254">TimeInterval_Week</span><span class="sxs-lookup"><span data-stu-id="56435-254">TimeInterval_Week</span></span>
  * <span data-ttu-id="56435-255">TimeInterval_Year</span><span class="sxs-lookup"><span data-stu-id="56435-255">TimeInterval_Year</span></span>

## <a name="operations"></a><span data-ttu-id="56435-256">Opérations</span><span class="sxs-lookup"><span data-stu-id="56435-256">Operations</span></span>
<span data-ttu-id="56435-257">Les opérations autorisées sur les types répertoriés dans la section précédente sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="56435-257">These operations are allowed on the types that are listed in the previous section.</span></span>

| <span data-ttu-id="56435-258">Opération</span><span class="sxs-lookup"><span data-stu-id="56435-258">Operation</span></span> | <span data-ttu-id="56435-259">Opérateurs pris en charge</span><span class="sxs-lookup"><span data-stu-id="56435-259">Supported operators</span></span> | <span data-ttu-id="56435-260">Type de résultat</span><span class="sxs-lookup"><span data-stu-id="56435-260">Result type</span></span> |
| --- | --- | --- |
| <span data-ttu-id="56435-261">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="56435-261">double *operator* double</span></span> |<span data-ttu-id="56435-262">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="56435-262">+, -, *, /</span></span> |<span data-ttu-id="56435-263">double</span><span class="sxs-lookup"><span data-stu-id="56435-263">double</span></span> |
| <span data-ttu-id="56435-264">double *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-264">double *operator* timeinterval</span></span> |* |<span data-ttu-id="56435-265">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-265">timeinterval</span></span> |
| <span data-ttu-id="56435-266">doubleVec *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="56435-266">doubleVec *operator* double</span></span> |<span data-ttu-id="56435-267">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="56435-267">+, -, *, /</span></span> |<span data-ttu-id="56435-268">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-268">doubleVec</span></span> |
| <span data-ttu-id="56435-269">doubleVec *opérateur* doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-269">doubleVec *operator* doubleVec</span></span> |<span data-ttu-id="56435-270">+, -, *, /</span><span class="sxs-lookup"><span data-stu-id="56435-270">+, -, *, /</span></span> |<span data-ttu-id="56435-271">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-271">doubleVec</span></span> |
| <span data-ttu-id="56435-272">timeinterval *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="56435-272">timeinterval *operator* double</span></span> |<span data-ttu-id="56435-273">*, /</span><span class="sxs-lookup"><span data-stu-id="56435-273">*, /</span></span> |<span data-ttu-id="56435-274">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-274">timeinterval</span></span> |
| <span data-ttu-id="56435-275">timeinterval *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-275">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="56435-276">+, -</span><span class="sxs-lookup"><span data-stu-id="56435-276">+, -</span></span> |<span data-ttu-id="56435-277">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-277">timeinterval</span></span> |
| <span data-ttu-id="56435-278">timeinterval *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-278">timeinterval *operator* timestamp</span></span> |+ |<span data-ttu-id="56435-279">timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-279">timestamp</span></span> |
| <span data-ttu-id="56435-280">timestamp *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-280">timestamp *operator* timeinterval</span></span> |+ |<span data-ttu-id="56435-281">timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-281">timestamp</span></span> |
| <span data-ttu-id="56435-282">timestamp *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-282">timestamp *operator* timestamp</span></span> |- |<span data-ttu-id="56435-283">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-283">timeinterval</span></span> |
| <span data-ttu-id="56435-284">*opérateur*double</span><span class="sxs-lookup"><span data-stu-id="56435-284">*operator*double</span></span> |<span data-ttu-id="56435-285">-, !</span><span class="sxs-lookup"><span data-stu-id="56435-285">-, !</span></span> |<span data-ttu-id="56435-286">double</span><span class="sxs-lookup"><span data-stu-id="56435-286">double</span></span> |
| <span data-ttu-id="56435-287">*opérateur*timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-287">*operator*timeinterval</span></span> |- |<span data-ttu-id="56435-288">timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-288">timeinterval</span></span> |
| <span data-ttu-id="56435-289">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="56435-289">double *operator* double</span></span> |<span data-ttu-id="56435-290"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="56435-290"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="56435-291">double</span><span class="sxs-lookup"><span data-stu-id="56435-291">double</span></span> |
| <span data-ttu-id="56435-292">string *opérateur* string</span><span class="sxs-lookup"><span data-stu-id="56435-292">string *operator* string</span></span> |<span data-ttu-id="56435-293"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="56435-293"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="56435-294">double</span><span class="sxs-lookup"><span data-stu-id="56435-294">double</span></span> |
| <span data-ttu-id="56435-295">timestamp *opérateur* timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-295">timestamp *operator* timestamp</span></span> |<span data-ttu-id="56435-296"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="56435-296"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="56435-297">double</span><span class="sxs-lookup"><span data-stu-id="56435-297">double</span></span> |
| <span data-ttu-id="56435-298">timeinterval *opérateur* timeinterval</span><span class="sxs-lookup"><span data-stu-id="56435-298">timeinterval *operator* timeinterval</span></span> |<span data-ttu-id="56435-299"><, <=, ==, >=, >, !=</span><span class="sxs-lookup"><span data-stu-id="56435-299"><, <=, ==, >=, >, !=</span></span> |<span data-ttu-id="56435-300">double</span><span class="sxs-lookup"><span data-stu-id="56435-300">double</span></span> |
| <span data-ttu-id="56435-301">double *opérateur* double</span><span class="sxs-lookup"><span data-stu-id="56435-301">double *operator* double</span></span> |<span data-ttu-id="56435-302">&&, &#124;&#124;</span><span class="sxs-lookup"><span data-stu-id="56435-302">&&, &#124;&#124;</span></span> |<span data-ttu-id="56435-303">double</span><span class="sxs-lookup"><span data-stu-id="56435-303">double</span></span> |

<span data-ttu-id="56435-304">Quand vous testez un double avec un opérateur ternaire (`double ? statement1 : statement2`), la valeur différente de zéro est **true** et zéro est **false**.</span><span class="sxs-lookup"><span data-stu-id="56435-304">When testing a double with a ternary operator (`double ? statement1 : statement2`), nonzero is **true**, and zero is **false**.</span></span>

## <a name="functions"></a><span data-ttu-id="56435-305">Fonctions</span><span class="sxs-lookup"><span data-stu-id="56435-305">Functions</span></span>
<span data-ttu-id="56435-306">Les **fonctions** prédéfinies disponibles pour la définition d’une formule de mise à l’échelle automatique sont les suivantes.</span><span class="sxs-lookup"><span data-stu-id="56435-306">These predefined **functions** are available for you to use in defining an automatic scaling formula.</span></span>

| <span data-ttu-id="56435-307">Fonction</span><span class="sxs-lookup"><span data-stu-id="56435-307">Function</span></span> | <span data-ttu-id="56435-308">Type de retour</span><span class="sxs-lookup"><span data-stu-id="56435-308">Return type</span></span> | <span data-ttu-id="56435-309">Description</span><span class="sxs-lookup"><span data-stu-id="56435-309">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="56435-310">avg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-310">avg(doubleVecList)</span></span> |<span data-ttu-id="56435-311">double</span><span class="sxs-lookup"><span data-stu-id="56435-311">double</span></span> |<span data-ttu-id="56435-312">Retourne la valeur moyenne de toutes les valeurs de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-312">Returns the average value for all values in the doubleVecList.</span></span> |
| <span data-ttu-id="56435-313">len(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-313">len(doubleVecList)</span></span> |<span data-ttu-id="56435-314">double</span><span class="sxs-lookup"><span data-stu-id="56435-314">double</span></span> |<span data-ttu-id="56435-315">Retourne la longueur du vecteur créé à partir de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-315">Returns the length of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="56435-316">lg(double)</span><span class="sxs-lookup"><span data-stu-id="56435-316">lg(double)</span></span> |<span data-ttu-id="56435-317">double</span><span class="sxs-lookup"><span data-stu-id="56435-317">double</span></span> |<span data-ttu-id="56435-318">Retourne la base logarithmique 2 de l’élément double.</span><span class="sxs-lookup"><span data-stu-id="56435-318">Returns the log base 2 of the double.</span></span> |
| <span data-ttu-id="56435-319">lg(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-319">lg(doubleVecList)</span></span> |<span data-ttu-id="56435-320">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-320">doubleVec</span></span> |<span data-ttu-id="56435-321">Retourne la base logarithmique 2 au niveau composant de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-321">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="56435-322">Un élément vec(double) doit être explicitement transmis pour le paramètre.</span><span class="sxs-lookup"><span data-stu-id="56435-322">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="56435-323">Dans le cas contraire, la version double lg(double) est prise en compte.</span><span class="sxs-lookup"><span data-stu-id="56435-323">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="56435-324">ln(double)</span><span class="sxs-lookup"><span data-stu-id="56435-324">ln(double)</span></span> |<span data-ttu-id="56435-325">double</span><span class="sxs-lookup"><span data-stu-id="56435-325">double</span></span> |<span data-ttu-id="56435-326">Retourne le logarithme naturel de l’élément double.</span><span class="sxs-lookup"><span data-stu-id="56435-326">Returns the natural log of the double.</span></span> |
| <span data-ttu-id="56435-327">ln(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-327">ln(doubleVecList)</span></span> |<span data-ttu-id="56435-328">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-328">doubleVec</span></span> |<span data-ttu-id="56435-329">Retourne la base logarithmique 2 au niveau composant de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-329">Returns the component-wise log base 2 of the doubleVecList.</span></span> <span data-ttu-id="56435-330">Un élément vec(double) doit être explicitement transmis pour le paramètre.</span><span class="sxs-lookup"><span data-stu-id="56435-330">A vec(double) must be explicitly passed for the parameter.</span></span> <span data-ttu-id="56435-331">Dans le cas contraire, la version double lg(double) est prise en compte.</span><span class="sxs-lookup"><span data-stu-id="56435-331">Otherwise, the double lg(double) version is assumed.</span></span> |
| <span data-ttu-id="56435-332">log(double)</span><span class="sxs-lookup"><span data-stu-id="56435-332">log(double)</span></span> |<span data-ttu-id="56435-333">double</span><span class="sxs-lookup"><span data-stu-id="56435-333">double</span></span> |<span data-ttu-id="56435-334">Retourne la base logarithmique 10 de l’élément double.</span><span class="sxs-lookup"><span data-stu-id="56435-334">Returns the log base 10 of the double.</span></span> |
| <span data-ttu-id="56435-335">log(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-335">log(doubleVecList)</span></span> |<span data-ttu-id="56435-336">doubleVec</span><span class="sxs-lookup"><span data-stu-id="56435-336">doubleVec</span></span> |<span data-ttu-id="56435-337">Retourne la base logarithmique 10 au niveau composant de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-337">Returns the component-wise log base 10 of the doubleVecList.</span></span> <span data-ttu-id="56435-338">Un élément vec(double) doit être explicitement transmis pour le paramètre de type double unique.</span><span class="sxs-lookup"><span data-stu-id="56435-338">A vec(double) must be explicitly passed for the single double parameter.</span></span> <span data-ttu-id="56435-339">Dans le cas contraire, la version double log(double) est prise en compte.</span><span class="sxs-lookup"><span data-stu-id="56435-339">Otherwise, the double log(double) version is assumed.</span></span> |
| <span data-ttu-id="56435-340">max(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-340">max(doubleVecList)</span></span> |<span data-ttu-id="56435-341">double</span><span class="sxs-lookup"><span data-stu-id="56435-341">double</span></span> |<span data-ttu-id="56435-342">Retourne la valeur maximale de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-342">Returns the maximum value in the doubleVecList.</span></span> |
| <span data-ttu-id="56435-343">min(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-343">min(doubleVecList)</span></span> |<span data-ttu-id="56435-344">double</span><span class="sxs-lookup"><span data-stu-id="56435-344">double</span></span> |<span data-ttu-id="56435-345">Retourne la valeur minimale de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-345">Returns the minimum value in the doubleVecList.</span></span> |
| <span data-ttu-id="56435-346">norm(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-346">norm(doubleVecList)</span></span> |<span data-ttu-id="56435-347">double</span><span class="sxs-lookup"><span data-stu-id="56435-347">double</span></span> |<span data-ttu-id="56435-348">Retourne la double norme du vecteur créé à partir de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-348">Returns the two-norm of the vector that is created from the doubleVecList.</span></span> |
| <span data-ttu-id="56435-349">percentile(doubleVec v, double p)</span><span class="sxs-lookup"><span data-stu-id="56435-349">percentile(doubleVec v, double p)</span></span> |<span data-ttu-id="56435-350">double</span><span class="sxs-lookup"><span data-stu-id="56435-350">double</span></span> |<span data-ttu-id="56435-351">Retourne l’élément de percentile du vecteur v.</span><span class="sxs-lookup"><span data-stu-id="56435-351">Returns the percentile element of the vector v.</span></span> |
| <span data-ttu-id="56435-352">rand()</span><span class="sxs-lookup"><span data-stu-id="56435-352">rand()</span></span> |<span data-ttu-id="56435-353">double</span><span class="sxs-lookup"><span data-stu-id="56435-353">double</span></span> |<span data-ttu-id="56435-354">Retourne une valeur aléatoire comprise entre 0,0 et 1,0.</span><span class="sxs-lookup"><span data-stu-id="56435-354">Returns a random value between 0.0 and 1.0.</span></span> |
| <span data-ttu-id="56435-355">range(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-355">range(doubleVecList)</span></span> |<span data-ttu-id="56435-356">double</span><span class="sxs-lookup"><span data-stu-id="56435-356">double</span></span> |<span data-ttu-id="56435-357">Retourne la différence entre les valeurs minimale et maximale de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-357">Returns the difference between the min and max values in the doubleVecList.</span></span> |
| <span data-ttu-id="56435-358">std(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-358">std(doubleVecList)</span></span> |<span data-ttu-id="56435-359">double</span><span class="sxs-lookup"><span data-stu-id="56435-359">double</span></span> |<span data-ttu-id="56435-360">Retourne l’écart type de l’échantillon des valeurs dans l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-360">Returns the sample standard deviation of the values in the doubleVecList.</span></span> |
| <span data-ttu-id="56435-361">stop()</span><span class="sxs-lookup"><span data-stu-id="56435-361">stop()</span></span> | |<span data-ttu-id="56435-362">Arrête l’évaluation de l’expression de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-362">Stops evaluation of the autoscaling expression.</span></span> |
| <span data-ttu-id="56435-363">sum(doubleVecList)</span><span class="sxs-lookup"><span data-stu-id="56435-363">sum(doubleVecList)</span></span> |<span data-ttu-id="56435-364">double</span><span class="sxs-lookup"><span data-stu-id="56435-364">double</span></span> |<span data-ttu-id="56435-365">Retourne la somme de tous les composants de l’élément doubleVecList.</span><span class="sxs-lookup"><span data-stu-id="56435-365">Returns the sum of all the components of the doubleVecList.</span></span> |
| <span data-ttu-id="56435-366">time(string dateTime="")</span><span class="sxs-lookup"><span data-stu-id="56435-366">time(string dateTime="")</span></span> |<span data-ttu-id="56435-367">timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-367">timestamp</span></span> |<span data-ttu-id="56435-368">Retourne l’horodatage de l’heure actuelle si aucun paramètre n’est transmis, ou l’horodatage de la chaîne dateTime dans le cas contraire.</span><span class="sxs-lookup"><span data-stu-id="56435-368">Returns the time stamp of the current time if no parameters are passed, or the time stamp of the dateTime string if it is passed.</span></span> <span data-ttu-id="56435-369">Les formats dateTime pris en charge sont W3C-DTF et RFC 1123.</span><span class="sxs-lookup"><span data-stu-id="56435-369">Supported dateTime formats are W3C-DTF and RFC 1123.</span></span> |
| <span data-ttu-id="56435-370">val(doubleVec v, double i)</span><span class="sxs-lookup"><span data-stu-id="56435-370">val(doubleVec v, double i)</span></span> |<span data-ttu-id="56435-371">double</span><span class="sxs-lookup"><span data-stu-id="56435-371">double</span></span> |<span data-ttu-id="56435-372">Retourne la valeur de l’élément qui est à l’emplacement i du vecteur v avec un index de départ de zéro.</span><span class="sxs-lookup"><span data-stu-id="56435-372">Returns the value of the element that is at location i in vector v, with a starting index of zero.</span></span> |

<span data-ttu-id="56435-373">Certaines des fonctions décrites dans le tableau précédent peuvent accepter une liste en tant qu’argument.</span><span class="sxs-lookup"><span data-stu-id="56435-373">Some of the functions that are described in the previous table can accept a list as an argument.</span></span> <span data-ttu-id="56435-374">La liste séparée par des virgules se compose de n’importe quelle combinaison d’éléments *double* et *doubleVec*.</span><span class="sxs-lookup"><span data-stu-id="56435-374">The comma-separated list is any combination of *double* and *doubleVec*.</span></span> <span data-ttu-id="56435-375">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="56435-375">For example:</span></span>

`doubleVecList := ( (double | doubleVec)+(, (double | doubleVec) )* )?`

<span data-ttu-id="56435-376">La valeur *doubleVecList* est convertie en un seul paramètre *doubleVec* avant l’évaluation.</span><span class="sxs-lookup"><span data-stu-id="56435-376">The *doubleVecList* value is converted to a single *doubleVec* before evaluation.</span></span> <span data-ttu-id="56435-377">Par exemple, si `v = [1,2,3]`, alors appeler `avg(v)` revient à appeler `avg(1,2,3)`.</span><span class="sxs-lookup"><span data-stu-id="56435-377">For example, if `v = [1,2,3]`, then calling `avg(v)` is equivalent to calling `avg(1,2,3)`.</span></span> <span data-ttu-id="56435-378">Appeler `avg(v, 7)` équivaut à appeler `avg(1,2,3,7)`.</span><span class="sxs-lookup"><span data-stu-id="56435-378">Calling `avg(v, 7)` is equivalent to calling `avg(1,2,3,7)`.</span></span>

## <span data-ttu-id="56435-379"><a name="getsampledata"></a>Obtenir des échantillons de données</span><span class="sxs-lookup"><span data-stu-id="56435-379"><a name="getsampledata"></a>Obtain sample data</span></span>
<span data-ttu-id="56435-380">Les formules de mise à l’échelle automatique agissent sur les données métriques (échantillons) qui sont fournies par le service Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-380">Autoscale formulas act on metrics data (samples) that is provided by the Batch service.</span></span> <span data-ttu-id="56435-381">Une formule augmente ou réduit la taille du pool en fonction des valeurs obtenues à partir du service.</span><span class="sxs-lookup"><span data-stu-id="56435-381">A formula grows or shrinks pool size based on the values that it obtains from the service.</span></span> <span data-ttu-id="56435-382">Les variables qui sont définies par le service et illustrées ci-dessus sont des objets qui fournissent diverses méthodes pour accéder aux données associées à chaque objet.</span><span class="sxs-lookup"><span data-stu-id="56435-382">The service-defined variables that were described previously are objects that provide various methods to access data that is associated with that object.</span></span> <span data-ttu-id="56435-383">Par exemple, l’expression ci-après présente une requête visant à obtenir les cinq dernières minutes de l’utilisation du processeur :</span><span class="sxs-lookup"><span data-stu-id="56435-383">For example, the following expression shows a request to get the last five minutes of CPU usage:</span></span>

```
$CPUPercent.GetSample(TimeInterval_Minute * 5)
```

| <span data-ttu-id="56435-384">Méthode</span><span class="sxs-lookup"><span data-stu-id="56435-384">Method</span></span> | <span data-ttu-id="56435-385">Description</span><span class="sxs-lookup"><span data-stu-id="56435-385">Description</span></span> |
| --- | --- |
| <span data-ttu-id="56435-386">GetSample()</span><span class="sxs-lookup"><span data-stu-id="56435-386">GetSample()</span></span> |<span data-ttu-id="56435-387">La méthode `GetSample()` retourne un vecteur d’échantillons de données.</span><span class="sxs-lookup"><span data-stu-id="56435-387">The `GetSample()` method returns a vector of data samples.</span></span><br/><br/><span data-ttu-id="56435-388">Un échantillon correspond à 30 secondes de données de métrique.</span><span class="sxs-lookup"><span data-stu-id="56435-388">A sample is 30 seconds worth of metrics data.</span></span> <span data-ttu-id="56435-389">En d’autres termes, des échantillons sont obtenus toutes les 30 secondes,</span><span class="sxs-lookup"><span data-stu-id="56435-389">In other words, samples are obtained every 30 seconds.</span></span> <span data-ttu-id="56435-390">mais comme noté ci-dessus, il existe un délai entre le moment où un échantillon est collecté et le moment où il est disponible pour une formule.</span><span class="sxs-lookup"><span data-stu-id="56435-390">But as noted below, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="56435-391">Par conséquent, tous les échantillons pour une période donnée ne sont pas forcément disponibles pour évaluation par une formule.</span><span class="sxs-lookup"><span data-stu-id="56435-391">As such, not all samples for a given time period may be available for evaluation by a formula.</span></span><ul><li>`doubleVec GetSample(double count)`<br/><span data-ttu-id="56435-392">Spécifie le nombre d’échantillons à obtenir à partir des échantillons collectés les plus récents.</span><span class="sxs-lookup"><span data-stu-id="56435-392">Specifies the number of samples to obtain from the most recent samples that were collected.</span></span><br/><br/><span data-ttu-id="56435-393">`GetSample(1)` retourne le dernier échantillon disponible.</span><span class="sxs-lookup"><span data-stu-id="56435-393">`GetSample(1)` returns the last available sample.</span></span> <span data-ttu-id="56435-394">Toutefois, pour les métriques comme `$CPUPercent`, cette fonction ne doit pas être utilisée, car il est impossible de savoir *quand* l’échantillon a été collecté.</span><span class="sxs-lookup"><span data-stu-id="56435-394">For metrics like `$CPUPercent`, however, this should not be used because it is impossible to know *when* the sample was collected.</span></span> <span data-ttu-id="56435-395">Il peut s’agir d’un événement récent ou plus ancien en raison de problèmes système.</span><span class="sxs-lookup"><span data-stu-id="56435-395">It might be recent, or, because of system issues, it might be much older.</span></span> <span data-ttu-id="56435-396">Dans ce cas de figure, il est préférable d’utiliser un intervalle de temps, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="56435-396">It is better in such cases to use a time interval as shown below.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime [, double samplePercent])`<br/><span data-ttu-id="56435-397">Spécifie le délai d’exécution de la collecte des exemples de données.</span><span class="sxs-lookup"><span data-stu-id="56435-397">Specifies a time frame for gathering sample data.</span></span> <span data-ttu-id="56435-398">Elle spécifie éventuellement le pourcentage d’échantillons qui doivent être disponibles dans le délai d’exécution demandé.</span><span class="sxs-lookup"><span data-stu-id="56435-398">Optionally, it also specifies the percentage of samples that must be available in the requested time frame.</span></span><br/><br/><span data-ttu-id="56435-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` doit retourner 20 échantillons si tous les échantillons des 10 dernières minutes sont présents dans l’historique CPUPercent.</span><span class="sxs-lookup"><span data-stu-id="56435-399">`$CPUPercent.GetSample(TimeInterval_Minute * 10)` would return 20 samples if all samples for the last 10 minutes are present in the CPUPercent history.</span></span> <span data-ttu-id="56435-400">Cependant, si la dernière minute de l’historique n’est pas disponible, seuls 18 échantillons seraient renvoyés,</span><span class="sxs-lookup"><span data-stu-id="56435-400">If the last minute of history was not available, however, only 18 samples would be returned.</span></span> <span data-ttu-id="56435-401">Dans ce cas :</span><span class="sxs-lookup"><span data-stu-id="56435-401">In this case:</span></span><br/><br/><span data-ttu-id="56435-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` échouerait, car seuls 90 % des échantillons sont disponibles ;</span><span class="sxs-lookup"><span data-stu-id="56435-402">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 95)` would fail because only 90 percent of the samples are available.</span></span><br/><br/><span data-ttu-id="56435-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` aboutirait.</span><span class="sxs-lookup"><span data-stu-id="56435-403">`$CPUPercent.GetSample(TimeInterval_Minute * 10, 80)` would succeed.</span></span><li>`doubleVec GetSample((timestamp or timeinterval) startTime, (timestamp or timeinterval) endTime [, double samplePercent])`<br/><span data-ttu-id="56435-404">Spécifie le délai d’exécution de la collecte des données avec une heure de début et une heure de fin.</span><span class="sxs-lookup"><span data-stu-id="56435-404">Specifies a time frame for gathering data, with both a start time and an end time.</span></span><br/><br/><span data-ttu-id="56435-405">Comme indiqué ci-dessus, il existe un délai entre le moment où un échantillon est collecté et le moment où il est disponible pour une formule.</span><span class="sxs-lookup"><span data-stu-id="56435-405">As mentioned above, there is a delay between when a sample is collected and when it is available to a formula.</span></span> <span data-ttu-id="56435-406">Envisagez ce délai lorsque vous utilisez la méthode `GetSample`.</span><span class="sxs-lookup"><span data-stu-id="56435-406">Consider this delay when you use the `GetSample` method.</span></span> <span data-ttu-id="56435-407">Consultez `GetSamplePercent` ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="56435-407">See `GetSamplePercent` below.</span></span> |
| <span data-ttu-id="56435-408">GetSamplePeriod()</span><span class="sxs-lookup"><span data-stu-id="56435-408">GetSamplePeriod()</span></span> |<span data-ttu-id="56435-409">Retourne la période des échantillons considérés dans un jeu de données d’échantillon historiques.</span><span class="sxs-lookup"><span data-stu-id="56435-409">Returns the period of samples that were taken in a historical sample data set.</span></span> |
| <span data-ttu-id="56435-410">Count()</span><span class="sxs-lookup"><span data-stu-id="56435-410">Count()</span></span> |<span data-ttu-id="56435-411">Renvoie le nombre total d’échantillons dans l’historique des métriques.</span><span class="sxs-lookup"><span data-stu-id="56435-411">Returns the total number of samples in the metric history.</span></span> |
| <span data-ttu-id="56435-412">HistoryBeginTime()</span><span class="sxs-lookup"><span data-stu-id="56435-412">HistoryBeginTime()</span></span> |<span data-ttu-id="56435-413">Retourne l’horodateur du plus ancien échantillon de données disponible pour la métrique.</span><span class="sxs-lookup"><span data-stu-id="56435-413">Returns the time stamp of the oldest available data sample for the metric.</span></span> |
| <span data-ttu-id="56435-414">GetSamplePercent()</span><span class="sxs-lookup"><span data-stu-id="56435-414">GetSamplePercent()</span></span> |<span data-ttu-id="56435-415">Retourne le pourcentage d’échantillons disponibles pour un intervalle de temps donné.</span><span class="sxs-lookup"><span data-stu-id="56435-415">Returns the percentage of samples that are available for a given time interval.</span></span> <span data-ttu-id="56435-416">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="56435-416">For example:</span></span><br/><br/>`doubleVec GetSamplePercent( (timestamp or timeinterval) startTime [, (timestamp or timeinterval) endTime] )`<br/><br/><span data-ttu-id="56435-417">Comme la méthode `GetSample` échoue si le pourcentage d’échantillons retourné est inférieur au `samplePercent` spécifié, vous pouvez utiliser la méthode `GetSamplePercent` pour procéder d’abord à une vérification.</span><span class="sxs-lookup"><span data-stu-id="56435-417">Because the `GetSample` method fails if the percentage of samples returned is less than the `samplePercent` specified, you can use the `GetSamplePercent` method to check first.</span></span> <span data-ttu-id="56435-418">Vous pouvez ensuite effectuer une autre action si des échantillons insuffisants sont présents, sans arrêter l’évaluation de la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-418">Then you can perform an alternate action if insufficient samples are present, without halting the automatic scaling evaluation.</span></span> |

### <a name="samples-sample-percentage-and-the-getsample-method"></a><span data-ttu-id="56435-419">Échantillons, pourcentage d’échantillonnage et méthode *GetSample()*</span><span class="sxs-lookup"><span data-stu-id="56435-419">Samples, sample percentage, and the *GetSample()* method</span></span>
<span data-ttu-id="56435-420">La principale opération d’une formule de mise à l’échelle automatique vise à obtenir des données métriques des tâches et des ressources, puis à ajuster la taille du pool en fonction de ces données.</span><span class="sxs-lookup"><span data-stu-id="56435-420">The core operation of an autoscale formula is to obtain task and resource metric data and then adjust pool size based on that data.</span></span> <span data-ttu-id="56435-421">Par conséquent, il est important de comprendre clairement comment les formules de mise à l’échelle automatique interagissent avec les données de mesures (échantillons).</span><span class="sxs-lookup"><span data-stu-id="56435-421">As such, it is important to have a clear understanding of how autoscale formulas interact with metrics data (samples).</span></span>

<span data-ttu-id="56435-422">**Exemples**</span><span class="sxs-lookup"><span data-stu-id="56435-422">**Samples**</span></span>

<span data-ttu-id="56435-423">Le service Batch prélève régulièrement des échantillons de mesures de tâches et de ressources pour les mettre à la disposition de vos formules de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-423">The Batch service periodically takes samples of task and resource metrics and makes them available to your autoscale formulas.</span></span> <span data-ttu-id="56435-424">Ces échantillons sont enregistrés toutes les 30 secondes par le service Batch.</span><span class="sxs-lookup"><span data-stu-id="56435-424">These samples are recorded every 30 seconds by the Batch service.</span></span> <span data-ttu-id="56435-425">Cependant, un retard est généralement constaté entre l’enregistrement de ces échantillons et leur mise à disposition (en lecture) pour vos formules de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-425">However, there is typically a delay between when those samples were recorded and when they are made available to (and can be read by) your autoscale formulas.</span></span> <span data-ttu-id="56435-426">De plus, en raison de différents facteurs tels que les problèmes de réseau ou d’autres problèmes d’infrastructure, il arrive que des échantillons ne soient pas enregistrés pendant un intervalle donné.</span><span class="sxs-lookup"><span data-stu-id="56435-426">Additionally, due to various factors such as network or other infrastructure issues, samples may not be recorded for a particular interval.</span></span>

<span data-ttu-id="56435-427">**Pourcentage d’échantillonnage**</span><span class="sxs-lookup"><span data-stu-id="56435-427">**Sample percentage**</span></span>

<span data-ttu-id="56435-428">Quand `samplePercent` est transmis à la méthode `GetSample()` ou que la méthode `GetSamplePercent()` est appelée, le terme _pourcentage_ désigne une comparaison entre le nombre total possible d’échantillons enregistrés par le service Batch et le nombre d’échantillons effectivement disponibles pour la formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-428">When `samplePercent` is passed to the `GetSample()` method or the `GetSamplePercent()` method is called, _percent_ refers to a comparison between the total possible number of samples that are recorded by the Batch service and the number of samples that are available to your autoscale formula.</span></span>

<span data-ttu-id="56435-429">Prenons l’exemple d’un intervalle de 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="56435-429">Let's look at a 10-minute timespan as an example.</span></span> <span data-ttu-id="56435-430">Comme les échantillons sont enregistrés toutes les 30 secondes, au cours d’un intervalle de 10 minutes, le nombre total maximal d’échantillons enregistrés par Batch devrait être de 20 échantillons (soit 2 par minute).</span><span class="sxs-lookup"><span data-stu-id="56435-430">Because samples are recorded every 30 seconds within a 10-minute timespan, the maximum total number of samples that are recorded by Batch would be 20 samples (2 per minute).</span></span> <span data-ttu-id="56435-431">Toutefois, en raison de la latence inhérente au mécanisme de création de rapports, ou d’un autre problème au sein d’Azure, il se peut que 15 échantillons seulement soient disponibles en lecture pour votre formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-431">However, due to the inherent latency of the reporting mechanism and other issues within Azure, there may be only 15 samples that are available to your autoscale formula for reading.</span></span> <span data-ttu-id="56435-432">Ainsi, pour cette période de 10 minutes, seuls 75 % du nombre total d’échantillons enregistrés seraient réellement disponibles pour votre formule.</span><span class="sxs-lookup"><span data-stu-id="56435-432">So, for example, for that 10-minute period, only 75% of the total number of samples recorded may be available to your formula.</span></span>

<span data-ttu-id="56435-433">**Méthode GetSample() et plages d’échantillons**</span><span class="sxs-lookup"><span data-stu-id="56435-433">**GetSample() and sample ranges**</span></span>

<span data-ttu-id="56435-434">Vos formules de mise à l’échelle automatique vont agrandir et réduire vos pools &mdash; avec l’ajout ou la suppression de nœuds.</span><span class="sxs-lookup"><span data-stu-id="56435-434">Your autoscale formulas are going to be growing and shrinking your pools &mdash; adding nodes or removing nodes.</span></span> <span data-ttu-id="56435-435">Comme les nœuds vous coûtent de l’argent, vous souhaitez vous assurer que vos formules utiliseront une méthode d’analyse intelligente basée sur des données suffisantes.</span><span class="sxs-lookup"><span data-stu-id="56435-435">Because nodes cost you money, you want to ensure that your formulas use an intelligent method of analysis that is based on sufficient data.</span></span> <span data-ttu-id="56435-436">Par conséquent, nous vous recommandons d’utiliser une analyse des types de tendance dans vos formules.</span><span class="sxs-lookup"><span data-stu-id="56435-436">Therefore, we recommend that you use a trending-type analysis in your formulas.</span></span> <span data-ttu-id="56435-437">Ce type augmente ou réduit vos pools en fonction d’une plage d’échantillons collectés.</span><span class="sxs-lookup"><span data-stu-id="56435-437">This type grows and shrinks your pools based on a range of collected samples.</span></span>

<span data-ttu-id="56435-438">Pour ce faire, utilisez `GetSample(interval look-back start, interval look-back end)` pour retourner un vecteur d’échantillons :</span><span class="sxs-lookup"><span data-stu-id="56435-438">To do so, use `GetSample(interval look-back start, interval look-back end)` to return a vector of samples:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(1 * TimeInterval_Minute, 6 * TimeInterval_Minute);
```

<span data-ttu-id="56435-439">Lorsque Batch évalue la ligne ci-dessus, il retourne une plage d’exemples sous la forme d’un vecteur de valeurs.</span><span class="sxs-lookup"><span data-stu-id="56435-439">When the above line is evaluated by Batch, it returns a range of samples as a vector of values.</span></span> <span data-ttu-id="56435-440">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="56435-440">For example:</span></span>

```
$runningTasksSample=[1,1,1,1,1,1,1,1,1,1];
```

<span data-ttu-id="56435-441">Une fois que vous avez collecté le vecteur d’échantillons, vous pouvez utiliser des fonctions telles que `min()`, `max()` et `avg()` pour dériver des valeurs significatives à partir de la plage collectée.</span><span class="sxs-lookup"><span data-stu-id="56435-441">Once you've collected the vector of samples, you can then use functions like `min()`, `max()`, and `avg()` to derive meaningful values from the collected range.</span></span>

<span data-ttu-id="56435-442">Pour plus de sécurité, vous pouvez forcer l’échec d’une évaluation de formule si le pourcentage d’échantillons disponible pendant une période donnée est inférieur à un certain seuil.</span><span class="sxs-lookup"><span data-stu-id="56435-442">For additional security, you can force a formula evaluation to fail if less than a certain sample percentage is available for a particular time period.</span></span> <span data-ttu-id="56435-443">Lorsque vous forcez l’échec d’une évaluation de formule, Batch reçoit l’instruction de cesser toute nouvelle évaluation de la formule si le pourcentage d’exemples spécifié n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="56435-443">When you force a formula evaluation to fail, you instruct Batch to cease further evaluation of the formula if the specified percentage of samples is not available.</span></span> <span data-ttu-id="56435-444">Dans ce cas, aucune modification n’est apportée à la taille du pool.</span><span class="sxs-lookup"><span data-stu-id="56435-444">In this case, no change is made to the pool size.</span></span> <span data-ttu-id="56435-445">Pour spécifier un pourcentage d’échantillons à respecter pour que l’évaluation aboutisse, spécifiez ce pourcentage en tant que troisième paramètre de `GetSample()`.</span><span class="sxs-lookup"><span data-stu-id="56435-445">To specify a required percentage of samples for the evaluation to succeed, specify it as the third parameter to `GetSample()`.</span></span> <span data-ttu-id="56435-446">Dans l’exemple ci-dessous, une exigence de 75 pour cent d’échantillons est spécifiée :</span><span class="sxs-lookup"><span data-stu-id="56435-446">Here, a requirement of 75 percent of samples is specified:</span></span>

```
$runningTasksSample = $RunningTasks.GetSample(60 * TimeInterval_Second, 120 * TimeInterval_Second, 75);
```

<span data-ttu-id="56435-447">Étant donné qu’il peut y avoir un délai de disponibilité des exemples, il est important de toujours spécifier un intervalle de temps avec une heure de début différé antérieure à une minute.</span><span class="sxs-lookup"><span data-stu-id="56435-447">Because there may be a delay in sample availability, it is important to always specify a time range with a look-back start time that is older than one minute.</span></span> <span data-ttu-id="56435-448">Il faut environ une minute aux exemples pour se propager dans le système, ce qui signifie que les exemples situés dans la plage `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` ne sont pas toujours disponibles.</span><span class="sxs-lookup"><span data-stu-id="56435-448">It takes approximately one minute for samples to propagate through the system, so samples in the range `(0 * TimeInterval_Second, 60 * TimeInterval_Second)` may not be available.</span></span> <span data-ttu-id="56435-449">Là encore, vous pouvez utiliser le paramètre pourcentage de `GetSample()` pour forcer une exigence de pourcentage d’échantillon particulière.</span><span class="sxs-lookup"><span data-stu-id="56435-449">Again, you can use the percentage parameter of `GetSample()` to force a particular sample percentage requirement.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="56435-450">Nous vous **conseillons fortement** **d’éviter de vous appuyer *uniquement* sur `GetSample(1)` dans vos formules de mise à l’échelle automatique**,</span><span class="sxs-lookup"><span data-stu-id="56435-450">We **strongly recommend** that you **avoid relying *only* on `GetSample(1)` in your autoscale formulas**.</span></span> <span data-ttu-id="56435-451">car la méthode `GetSample(1)` dit globalement au service Batch : « Donne-moi le dernier exemple disponible, quelle que soit son ancienneté ».</span><span class="sxs-lookup"><span data-stu-id="56435-451">This is because `GetSample(1)` essentially says to the Batch service, "Give me the last sample you have, no matter how long ago you retrieved it."</span></span> <span data-ttu-id="56435-452">Dans la mesure où il s’agit uniquement d’un simple échantillon (potentiellement ancien), il risque de ne pas être représentatif de l’état récent de la tâche ou de la ressource.</span><span class="sxs-lookup"><span data-stu-id="56435-452">Since it is only a single sample, and it may be an older sample, it may not be representative of the larger picture of recent task or resource state.</span></span> <span data-ttu-id="56435-453">Si vous utilisez tout de même `GetSample(1)`, veillez à l’intégrer dans une instruction plus générale pour éviter de l’utiliser comme unique point de données sur lequel reposera votre formule.</span><span class="sxs-lookup"><span data-stu-id="56435-453">If you do use `GetSample(1)`, make sure that it's part of a larger statement and not the only data point that your formula relies on.</span></span>
>
>

## <a name="metrics"></a><span data-ttu-id="56435-454">Mesures</span><span class="sxs-lookup"><span data-stu-id="56435-454">Metrics</span></span>
<span data-ttu-id="56435-455">Vous pouvez utiliser à la fois les mesures de ressources et de tâches quand vous définissez une formule.</span><span class="sxs-lookup"><span data-stu-id="56435-455">You can use both resource and task metrics when you're defining a formula.</span></span> <span data-ttu-id="56435-456">Vous ajustez le nombre cible de nœuds dédiés dans le pool en fonction des données métriques que vous obtenez et évaluez.</span><span class="sxs-lookup"><span data-stu-id="56435-456">You adjust the target number of dedicated nodes in the pool based on the metrics data that you obtain and evaluate.</span></span> <span data-ttu-id="56435-457">Consultez la section [Variables](#variables) ci-dessus pour plus d’informations sur chaque métrique.</span><span class="sxs-lookup"><span data-stu-id="56435-457">See the [Variables](#variables) section above for more information on each metric.</span></span>

<table>
  <tr>
    <th><span data-ttu-id="56435-458">Mesure</span><span class="sxs-lookup"><span data-stu-id="56435-458">Metric</span></span></th>
    <th><span data-ttu-id="56435-459">Description</span><span class="sxs-lookup"><span data-stu-id="56435-459">Description</span></span></th>
  </tr>
  <tr>
    <td><span data-ttu-id="56435-460"><b>Ressource</b></span><span class="sxs-lookup"><span data-stu-id="56435-460"><b>Resource</b></span></span></td>
    <td><p><span data-ttu-id="56435-461">Les mesures de ressources sont basées sur l’utilisation du processeur, de la bande passante et de la mémoire par les nœuds de calcul, ainsi que sur le nombre de nœuds.</span><span class="sxs-lookup"><span data-stu-id="56435-461">Resource metrics are based on the CPU, the bandwidth, the memory usage of compute nodes, and the number of nodes.</span></span></p>
        <p> <span data-ttu-id="56435-462">Ces variables définies par le service sont utiles pour effectuer des ajustements en fonction du nombre de nœuds :</span><span class="sxs-lookup"><span data-stu-id="56435-462">These service-defined variables are useful for making adjustments based on node count:</span></span></p>
    <p><ul>
            <li><span data-ttu-id="56435-463">$TargetDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="56435-463">$TargetDedicatedNodes</span></span></li>
            <li><span data-ttu-id="56435-464">$TargetLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="56435-464">$TargetLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="56435-465">$CurrentDedicatedNodes</span><span class="sxs-lookup"><span data-stu-id="56435-465">$CurrentDedicatedNodes</span></span></li>
            <li><span data-ttu-id="56435-466">$CurrentLowPriorityNodes</span><span class="sxs-lookup"><span data-stu-id="56435-466">$CurrentLowPriorityNodes</span></span></li>
            <li><span data-ttu-id="56435-467">$preemptedNodeCount</span><span class="sxs-lookup"><span data-stu-id="56435-467">$preemptedNodeCount</span></span></li>
            <li><span data-ttu-id="56435-468">$SampleNodeCount</span><span class="sxs-lookup"><span data-stu-id="56435-468">$SampleNodeCount</span></span></li>
    </ul></p>
    <p><span data-ttu-id="56435-469">Ces variables définies par le service sont utilisées pour effectuer des ajustements en fonction de l’utilisation des ressources du nœud :</span><span class="sxs-lookup"><span data-stu-id="56435-469">These service-defined variables are useful for making adjustments based on node resource usage:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="56435-470">$CPUPercent</span><span class="sxs-lookup"><span data-stu-id="56435-470">$CPUPercent</span></span></li>
      <li><span data-ttu-id="56435-471">$WallClockSeconds</span><span class="sxs-lookup"><span data-stu-id="56435-471">$WallClockSeconds</span></span></li>
      <li><span data-ttu-id="56435-472">$MemoryBytes</span><span class="sxs-lookup"><span data-stu-id="56435-472">$MemoryBytes</span></span></li>
      <li><span data-ttu-id="56435-473">$DiskBytes</span><span class="sxs-lookup"><span data-stu-id="56435-473">$DiskBytes</span></span></li>
      <li><span data-ttu-id="56435-474">$DiskReadBytes</span><span class="sxs-lookup"><span data-stu-id="56435-474">$DiskReadBytes</span></span></li>
      <li><span data-ttu-id="56435-475">$DiskWriteBytes</span><span class="sxs-lookup"><span data-stu-id="56435-475">$DiskWriteBytes</span></span></li>
      <li><span data-ttu-id="56435-476">$DiskReadOps</span><span class="sxs-lookup"><span data-stu-id="56435-476">$DiskReadOps</span></span></li>
      <li><span data-ttu-id="56435-477">$DiskWriteOps</span><span class="sxs-lookup"><span data-stu-id="56435-477">$DiskWriteOps</span></span></li>
      <li><span data-ttu-id="56435-478">$NetworkInBytes</span><span class="sxs-lookup"><span data-stu-id="56435-478">$NetworkInBytes</span></span></li>
      <li><span data-ttu-id="56435-479">$NetworkOutBytes</span><span class="sxs-lookup"><span data-stu-id="56435-479">$NetworkOutBytes</span></span></li></ul></p>
  </tr>
  <tr>
    <td><span data-ttu-id="56435-480"><b>Task</b></span><span class="sxs-lookup"><span data-stu-id="56435-480"><b>Task</b></span></span></td>
    <td><p><span data-ttu-id="56435-481">Les mesures de tâches sont basées sur l’état des tâches (Active, En attente et Terminée).</span><span class="sxs-lookup"><span data-stu-id="56435-481">Task metrics are based on the status of tasks, such as Active, Pending, and Completed.</span></span> <span data-ttu-id="56435-482">Les variables suivantes définies par le service sont utiles pour ajuster la taille du pool en fonction des métriques de tâche :</span><span class="sxs-lookup"><span data-stu-id="56435-482">The following service-defined variables are useful for making pool-size adjustments based on task metrics:</span></span></p>
    <p><ul>
      <li><span data-ttu-id="56435-483">$ActiveTasks</span><span class="sxs-lookup"><span data-stu-id="56435-483">$ActiveTasks</span></span></li>
      <li><span data-ttu-id="56435-484">$RunningTasks</span><span class="sxs-lookup"><span data-stu-id="56435-484">$RunningTasks</span></span></li>
      <li><span data-ttu-id="56435-485">$PendingTasks</span><span class="sxs-lookup"><span data-stu-id="56435-485">$PendingTasks</span></span></li>
      <li><span data-ttu-id="56435-486">$SucceededTasks</span><span class="sxs-lookup"><span data-stu-id="56435-486">$SucceededTasks</span></span></li>
            <li><span data-ttu-id="56435-487">$FailedTasks</span><span class="sxs-lookup"><span data-stu-id="56435-487">$FailedTasks</span></span></li></ul></p>
        </td>
  </tr>
</table>

## <a name="write-an-autoscale-formula"></a><span data-ttu-id="56435-488">Écrire une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-488">Write an autoscale formula</span></span>
<span data-ttu-id="56435-489">Vous générez une formule de mise à l’échelle automatique en formant des instructions qui utilisent les composants ci-dessus, puis vous combinez ces instructions dans une formule complète.</span><span class="sxs-lookup"><span data-stu-id="56435-489">You build an autoscale formula by forming statements that use the above components, then combine those statements into a complete formula.</span></span> <span data-ttu-id="56435-490">Dans cette section, nous allons créer un exemple de formule capable de prendre des décisions concrètes en matière de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-490">In this section, we create an example autoscale formula that can perform some real-world scaling decisions.</span></span>

<span data-ttu-id="56435-491">Commençons par définir les exigences de notre nouvelle formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-491">First, let's define the requirements for our new autoscale formula.</span></span> <span data-ttu-id="56435-492">La formule doit :</span><span class="sxs-lookup"><span data-stu-id="56435-492">The formula should:</span></span>

1. <span data-ttu-id="56435-493">Augmenter le nombre cible de nœuds de calcul dédiés dans un pool si l’utilisation du processeur est intensive.</span><span class="sxs-lookup"><span data-stu-id="56435-493">Increase the target number of dedicated compute nodes in a pool if CPU usage is high.</span></span>
2. <span data-ttu-id="56435-494">Réduire le nombre cible de nœuds de calcul dédiés dans un pool si l’utilisation du processeur est faible.</span><span class="sxs-lookup"><span data-stu-id="56435-494">Decrease the target number of dedicated compute nodes in a pool when CPU usage is low.</span></span>
3. <span data-ttu-id="56435-495">Toujours limiter le nombre maximal de nœuds dédiés à 400.</span><span class="sxs-lookup"><span data-stu-id="56435-495">Always restrict the maximum number of dedicated nodes to 400.</span></span>

<span data-ttu-id="56435-496">Pour augmenter le nombre de nœuds en cas d’utilisation intensive du processeur, définissez l’instruction qui renseigne une variable définie par l’utilisateur (`$totalDedicatedNodes`) en utilisant une valeur équivalente à 110 % du nombre cible actuel de nœuds dédiés si l’utilisation moyenne du processeur minimale au cours des 10 dernières minutes est supérieure à 70 %.</span><span class="sxs-lookup"><span data-stu-id="56435-496">To increase the number of nodes during high CPU usage, define the statement that populates a user-defined variable (`$totalDedicatedNodes`) with a value that is 110 percent of the current target number of dedicated nodes, but only if the minimum average CPU usage during the last 10 minutes was above 70 percent.</span></span> <span data-ttu-id="56435-497">Sinon, utilisez la valeur du nombre actuel de nœuds dédiés.</span><span class="sxs-lookup"><span data-stu-id="56435-497">Otherwise, use the value for the current number of dedicated nodes.</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
```

<span data-ttu-id="56435-498">Pour *réduire* le nombre de nœuds dédiés en cas de faible utilisation du processeur, la prochaine instruction dans notre formule affecte à la même variable `$totalDedicatedNodes` 90 % du nombre cible actuel de nœuds dédiés si l’utilisation moyenne du processeur au cours des 60 dernières minutes est inférieure à 20 %.</span><span class="sxs-lookup"><span data-stu-id="56435-498">To *decrease* the number of dedicated nodes during low CPU usage, the next statement in our formula sets the same `$totalDedicatedNodes` variable to 90 percent of the current target number of dedicated nodes if the average CPU usage in the past 60 minutes was under 20 percent.</span></span> <span data-ttu-id="56435-499">Sinon, nous utilisons la valeur actuelle de `$totalDedicatedNodes` que nous avons renseigné dans l’instruction ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="56435-499">Otherwise, use the current value of `$totalDedicatedNodes` that we populated in the statement above.</span></span>

```
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
```

<span data-ttu-id="56435-500">Cet exemple définit le nombre cible de nœuds de calcul dédiés sur un maximum de 400 :</span><span class="sxs-lookup"><span data-stu-id="56435-500">Now limit the target number of dedicated compute nodes to a maximum of 400:</span></span>

```
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

<span data-ttu-id="56435-501">Voici la formule complète :</span><span class="sxs-lookup"><span data-stu-id="56435-501">Here's the complete formula:</span></span>

```
$totalDedicatedNodes =
    (min($CPUPercent.GetSample(TimeInterval_Minute * 10)) > 0.7) ?
    ($CurrentDedicatedNodes * 1.1) : $CurrentDedicatedNodes;
$totalDedicatedNodes =
    (avg($CPUPercent.GetSample(TimeInterval_Minute * 60)) < 0.2) ?
    ($CurrentDedicatedNodes * 0.9) : $totalDedicatedNodes;
$TargetDedicatedNodes = min(400, $totalDedicatedNodes)
```

## <a name="create-an-autoscale-enabled-pool-with-net"></a><span data-ttu-id="56435-502">Créer un pool avec mise à l’échelle automatique dans .NET</span><span class="sxs-lookup"><span data-stu-id="56435-502">Create an autoscale-enabled pool with .NET</span></span>

<span data-ttu-id="56435-503">Pour créer un pool avec mise à l’échelle automatique dans .NET, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="56435-503">To create a pool with autoscaling enabled in .NET, follow these steps:</span></span>

1. <span data-ttu-id="56435-504">Créez le pool avec [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span><span class="sxs-lookup"><span data-stu-id="56435-504">Create the pool with [BatchClient.PoolOperations.CreatePool](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.createpool).</span></span>
2. <span data-ttu-id="56435-505">Affectez à la propriété [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="56435-505">Set the [CloudPool.AutoScaleEnabled](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleenabled) property to `true`.</span></span>
3. <span data-ttu-id="56435-506">Affectez à la propriété [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) votre formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-506">Set the [CloudPool.AutoScaleFormula](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula) property with your autoscale formula.</span></span>
4. <span data-ttu-id="56435-507">(Facultatif) Définissez la propriété [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) (la valeur par défaut est de 15 minutes).</span><span class="sxs-lookup"><span data-stu-id="56435-507">(Optional) Set the [CloudPool.AutoScaleEvaluationInterval](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval) property (default is 15 minutes).</span></span>
5. <span data-ttu-id="56435-508">Validez le pool avec [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) ou [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span><span class="sxs-lookup"><span data-stu-id="56435-508">Commit the pool with [CloudPool.Commit](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commit) or [CommitAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.commitasync).</span></span>

<span data-ttu-id="56435-509">L’extrait de code suivant crée un pool avec mise à l’échelle automatique dans .NET.</span><span class="sxs-lookup"><span data-stu-id="56435-509">The following code snippet creates an autoscale-enabled pool in .NET.</span></span> <span data-ttu-id="56435-510">La formule de mise à l’échelle automatique du pool définit le nombre cible de nœuds dédiés comme suit : 5 les lundis et 1 les autres jours de la semaine.</span><span class="sxs-lookup"><span data-stu-id="56435-510">The pool's autoscale formula sets the target number of dedicated nodes to 5 on Mondays, and 1 on every other day of the week.</span></span> <span data-ttu-id="56435-511">L’[intervalle de mise à l’échelle automatique](#automatic-scaling-interval) est de 30 minutes.</span><span class="sxs-lookup"><span data-stu-id="56435-511">The [automatic scaling interval](#automatic-scaling-interval) is set to 30 minutes.</span></span> <span data-ttu-id="56435-512">Dans cet extrait de code #C et les autres extraits de cet article, `myBatchClient` est une instance entièrement initialisée de la classe [BatchClient][net_batchclient].</span><span class="sxs-lookup"><span data-stu-id="56435-512">In this and the other C# snippets in this article, `myBatchClient` is a properly initialized instance of the [BatchClient][net_batchclient] class.</span></span>

```csharp
CloudPool pool = myBatchClient.PoolOperations.CreatePool(
                    poolId: "mypool",
                    virtualMachineSize: "small", // single-core, 1.75 GB memory, 225 GB disk
                    cloudServiceConfiguration: new CloudServiceConfiguration(osFamily: "5"));    
pool.AutoScaleEnabled = true;
pool.AutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";
pool.AutoScaleEvaluationInterval = TimeSpan.FromMinutes(30);
await pool.CommitAsync();
```

> [!IMPORTANT]
> <span data-ttu-id="56435-513">Lorsque vous créez un pool avec mise à l’échelle automatique, ne spécifiez pas le paramètre _targetDedicatedComputeNodes_ ni le paramètre _targetLowPriorityComputeNodes_ sur l’appel à **CreatePool**.</span><span class="sxs-lookup"><span data-stu-id="56435-513">When you create an autoscale-enabled pool, do not specify the _targetDedicatedComputeNodes_ parameter or the _targetLowPriorityComputeNodes_ parameter on the call to **CreatePool**.</span></span> <span data-ttu-id="56435-514">Au lieu de cela, spécifiez les propriétés **AutoScaleEnabled** et **AutoScaleFormula** sur le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-514">Instead, specify the **AutoScaleEnabled** and **AutoScaleFormula** properties on the pool.</span></span> <span data-ttu-id="56435-515">Les valeurs de ces propriétés déterminent le nombre cible de chaque type de nœud.</span><span class="sxs-lookup"><span data-stu-id="56435-515">The values for these properties determine the target number of each type of node.</span></span> <span data-ttu-id="56435-516">De même, pour redimensionner manuellement un pool avec mise à l’échelle automatique (par exemple, avec [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), vous devez dans un premier temps **désactiver** la mise à l’échelle automatique dans le pool avant de le redimensionner.</span><span class="sxs-lookup"><span data-stu-id="56435-516">Also, to manually resize an autoscale-enabled pool (for example, with [BatchClient.PoolOperations.ResizePoolAsync][net_poolops_resizepoolasync]), first **disable** automatic scaling on the pool, then resize it.</span></span>
>
>

<span data-ttu-id="56435-517">En plus de Batch .NET, vous pouvez utiliser d’autres [SDK Batch](batch-apis-tools.md#azure-accounts-for-batch-development), des [API Batch REST](https://docs.microsoft.com/rest/api/batchservice/), des [applets de commande Batch PowerShell](batch-powershell-cmdlets-get-started.md) et l’[interface CLI Batch](batch-cli-get-started.md) afin de configurer la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-517">In addition to Batch .NET, you can use any of the other [Batch SDKs](batch-apis-tools.md#azure-accounts-for-batch-development), [Batch REST](https://docs.microsoft.com/rest/api/batchservice/), [Batch PowerShell cmdlets](batch-powershell-cmdlets-get-started.md), and the [Batch CLI](batch-cli-get-started.md) to configure autoscaling.</span></span>


### <a name="automatic-scaling-interval"></a><span data-ttu-id="56435-518">Intervalle de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-518">Automatic scaling interval</span></span>
<span data-ttu-id="56435-519">Par défaut, le service Batch ajuste la taille d’un pool en fonction de sa formule de mise à l’échelle toutes les 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="56435-519">By default, the Batch service adjusts a pool's size according to its autoscale formula every 15 minutes.</span></span> <span data-ttu-id="56435-520">Cet intervalle peut être configuré à l’aide des propriétés de pool suivantes :</span><span class="sxs-lookup"><span data-stu-id="56435-520">This interval is configurable by using the following pool properties:</span></span>

* <span data-ttu-id="56435-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="56435-521">[CloudPool.AutoScaleEvaluationInterval][net_cloudpool_autoscaleevalinterval] (Batch .NET)</span></span>
* <span data-ttu-id="56435-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (API REST)</span><span class="sxs-lookup"><span data-stu-id="56435-522">[autoScaleEvaluationInterval][rest_autoscaleinterval] (REST API)</span></span>

<span data-ttu-id="56435-523">L’intervalle doit être compris entre cinq minutes et 168 heures.</span><span class="sxs-lookup"><span data-stu-id="56435-523">The minimum interval is five minutes, and the maximum is 168 hours.</span></span> <span data-ttu-id="56435-524">Si un intervalle en dehors de cette plage est spécifié, le service Batch renvoie une erreur de demande incorrecte (400).</span><span class="sxs-lookup"><span data-stu-id="56435-524">If an interval outside this range is specified, the Batch service returns a Bad Request (400) error.</span></span>

> [!NOTE]
> <span data-ttu-id="56435-525">La mise à l’échelle automatique ne peut pas actuellement répondre aux modifications en moins d’une minute, mais vise plutôt à ajuster progressivement la taille de votre pool pendant l’exécution d’une charge de travail.</span><span class="sxs-lookup"><span data-stu-id="56435-525">Autoscaling is not currently intended to respond to changes in less than a minute, but rather is intended to adjust the size of your pool gradually as you run a workload.</span></span>
>
>

## <a name="enable-autoscaling-on-an-existing-pool"></a><span data-ttu-id="56435-526">Activer la mise à l’échelle automatique sur un pool existant</span><span class="sxs-lookup"><span data-stu-id="56435-526">Enable autoscaling on an existing pool</span></span>

<span data-ttu-id="56435-527">Chaque SDK Batch fournit un moyen d’activer la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-527">Each Batch SDK provides a way to enable autoscaling.</span></span> <span data-ttu-id="56435-528">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="56435-528">For example:</span></span>

* <span data-ttu-id="56435-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span><span class="sxs-lookup"><span data-stu-id="56435-529">[BatchClient.PoolOperations.EnableAutoScaleAsync][net_enableautoscaleasync] (Batch .NET)</span></span>
* <span data-ttu-id="56435-530">[Activer la mise à l’échelle automatique sur un pool][rest_enableautoscale] (API REST)</span><span class="sxs-lookup"><span data-stu-id="56435-530">[Enable automatic scaling on a pool][rest_enableautoscale] (REST API)</span></span>

<span data-ttu-id="56435-531">Quand vous activez la mise à l’échelle automatique sur un pool existant, n’oubliez pas les points suivants :</span><span class="sxs-lookup"><span data-stu-id="56435-531">When you enable autoscaling on an existing pool, keep in mind the following points:</span></span>

* <span data-ttu-id="56435-532">Si la mise à l’échelle automatique est actuellement désactivée sur le pool au moment de l’émission de la requête d’activation, vous devez spécifier une formule de mise à l’échelle automatique valide quand vous émettez la requête.</span><span class="sxs-lookup"><span data-stu-id="56435-532">If automatic scaling is currently disabled on the pool when you issue the request to enable autoscaling, you must specify a valid autoscale formula when you issue the request.</span></span> <span data-ttu-id="56435-533">Vous pouvez éventuellement spécifier un intervalle d’évaluation de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-533">You can optionally specify an autoscale evaluation interval.</span></span> <span data-ttu-id="56435-534">Si aucun intervalle n’est spécifié, la valeur par défaut de 15 minutes est utilisée.</span><span class="sxs-lookup"><span data-stu-id="56435-534">If you do not specify an interval, the default value of 15 minutes is used.</span></span>
* <span data-ttu-id="56435-535">Si la mise à l’échelle automatique est actuellement activée sur le pool, vous pouvez spécifier une formule de mise à l’échelle automatique, un intervalle d’évaluation, ou les deux.</span><span class="sxs-lookup"><span data-stu-id="56435-535">If autoscale is currently enabled on the pool, you can specify an autoscale formula, an evaluation interval, or both.</span></span> <span data-ttu-id="56435-536">Vous devez spécifier au moins l’une de ces propriétés.</span><span class="sxs-lookup"><span data-stu-id="56435-536">You must specify at least one of these properties.</span></span>

  * <span data-ttu-id="56435-537">Si vous spécifiez un nouvel intervalle d’évaluation de mise à l’échelle automatique, la planification d’évaluation existante est arrêtée, puis une nouvelle planification est démarrée.</span><span class="sxs-lookup"><span data-stu-id="56435-537">If you specify a new autoscale evaluation interval, then the existing evaluation schedule is stopped and a new schedule is started.</span></span> <span data-ttu-id="56435-538">L’heure de début de la nouvelle planification est l’heure à laquelle la requête d’activation de mise à l’échelle automatique a été émise.</span><span class="sxs-lookup"><span data-stu-id="56435-538">The new schedule's start time is the time at which the request to enable autoscaling was issued.</span></span>
  * <span data-ttu-id="56435-539">Si vous omettez la formule de mise à l’échelle automatique ou l’intervalle d’évaluation, le service Batch continue d’utiliser la valeur actuelle de ce paramètre.</span><span class="sxs-lookup"><span data-stu-id="56435-539">If you omit either the autoscale formula or evaluation interval, the Batch service continues to use the current value of that setting.</span></span>

> [!NOTE]
> <span data-ttu-id="56435-540">Si vous avez spécifié des valeurs pour les paramètres *targetDedicatedComputeNodes* ou *targetLowPriorityComputeNodes* de la méthode **CreatePool** lorsque vous avez créé le pool dans .NET, ou pour les paramètres comparables dans un autre langage, ces valeurs sont ignorées lors de l’évaluation de la formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-540">If you specified values for the *targetDedicatedComputeNodes* or *targetLowPriorityComputeNodes* parameters of the **CreatePool** method when you created the pool in .NET, or for the comparable parameters in another language, then those values are ignored when the automatic scaling formula is evaluated.</span></span>
>
>

<span data-ttu-id="56435-541">Cet extrait de code en C# utilise la bibliothèque [Batch .NET][net_api] pour activer la mise à l’échelle automatique sur un pool existant :</span><span class="sxs-lookup"><span data-stu-id="56435-541">This C# code snippet uses the [Batch .NET][net_api] library to enable autoscaling on an existing pool:</span></span>

```csharp
// Define the autoscaling formula. This formula sets the target number of nodes
// to 5 on Mondays, and 1 on every other day of the week
string myAutoScaleFormula = "$TargetDedicatedNodes = (time().weekday == 1 ? 5:1);";

// Set the autoscale formula on the existing pool
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myAutoScaleFormula);
```

### <a name="update-an-autoscale-formula"></a><span data-ttu-id="56435-542">Mettre à jour une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-542">Update an autoscale formula</span></span>

<span data-ttu-id="56435-543">Pour mettre à jour la formule sur un pool existant avec mise à l’échelle automatique, appelez l’opération pour réactiver la mise à l’échelle automatique à l’aide de la nouvelle formule.</span><span class="sxs-lookup"><span data-stu-id="56435-543">To update the formula on an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new formula.</span></span> <span data-ttu-id="56435-544">Par exemple, si la mise à l’échelle automatique est déjà activée sur `myexistingpool` quand le code .NET suivant est exécuté, la formule de mise à l’échelle automatique est remplacée par le contenu de `myNewFormula`.</span><span class="sxs-lookup"><span data-stu-id="56435-544">For example, if autoscaling is already enabled on `myexistingpool` when the following .NET code is executed, its autoscale formula is replaced with the contents of `myNewFormula`.</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleFormula: myNewFormula);
```

### <a name="update-the-autoscale-interval"></a><span data-ttu-id="56435-545">Mettre à jour l’intervalle de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-545">Update the autoscale interval</span></span>

<span data-ttu-id="56435-546">Pour mettre à jour l’intervalle d’évaluation de mise à l’échelle d’un pool existant avec mise à l’échelle automatique, appelez l’opération afin de réactiver la mise à l’échelle automatique à l’aide du nouvel intervalle.</span><span class="sxs-lookup"><span data-stu-id="56435-546">To update the autoscale evaluation interval of an existing autoscale-enabled pool, call the operation to enable autoscaling again with the new interval.</span></span> <span data-ttu-id="56435-547">Par exemple, si vous souhaitez définir un intervalle d’évaluation de 60 minutes pour un pool avec mise à l’échelle automatique dans .NET :</span><span class="sxs-lookup"><span data-stu-id="56435-547">For example, to set the autoscale evaluation interval to 60 minutes for a pool that's already autoscale-enabled in .NET:</span></span>

```csharp
await myBatchClient.PoolOperations.EnableAutoScaleAsync(
    "myexistingpool",
    autoscaleEvaluationInterval: TimeSpan.FromMinutes(60));
```

## <a name="evaluate-an-autoscale-formula"></a><span data-ttu-id="56435-548">Évaluer une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-548">Evaluate an autoscale formula</span></span>

<span data-ttu-id="56435-549">Vous pouvez évaluer une formule avant de l’appliquer à un pool.</span><span class="sxs-lookup"><span data-stu-id="56435-549">You can evaluate a formula before applying it to a pool.</span></span> <span data-ttu-id="56435-550">De cette façon, vous pouvez tester la formule pour évaluer ses instructions avant de l’utiliser en production.</span><span class="sxs-lookup"><span data-stu-id="56435-550">In this way, you can test the formula to see how its statements evaluate before you put the formula into production.</span></span>

<span data-ttu-id="56435-551">Pour évaluer une formule de mise à l’échelle automatique, vous devez d’abord activer la mise à l’échelle automatique sur le pool à l’aide d’une formule valide.</span><span class="sxs-lookup"><span data-stu-id="56435-551">To evaluate an autoscale formula, you must first enable autoscaling on the pool with a valid formula.</span></span> <span data-ttu-id="56435-552">Pour tester une formule sur un pool dont la mise à l’échelle automatique n’est pas encore activée, utilisez la formule à une ligne `$TargetDedicatedNodes = 0` lors de l’activation initiale de la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-552">To test a formula on a pool that doesn't yet have autoscaling enabled, use the one-line formula `$TargetDedicatedNodes = 0` when you first enable autoscaling.</span></span> <span data-ttu-id="56435-553">Ensuite, utilisez l’une des méthodes suivantes pour évaluer la formule à tester :</span><span class="sxs-lookup"><span data-stu-id="56435-553">Then, use one of the following to evaluate the formula you want to test:</span></span>

* <span data-ttu-id="56435-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) ou [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span><span class="sxs-lookup"><span data-stu-id="56435-554">[BatchClient.PoolOperations.EvaluateAutoScale](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscale) or [EvaluateAutoScaleAsync](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.evaluateautoscaleasync)</span></span>

    <span data-ttu-id="56435-555">Ces méthodes Batch .NET nécessitent l’ID d’un pool existant et une chaîne contenant la formule de mise à l’échelle automatique à évaluer.</span><span class="sxs-lookup"><span data-stu-id="56435-555">These Batch .NET methods require the ID of an existing pool and a string containing the autoscale formula to evaluate.</span></span>

* [<span data-ttu-id="56435-556">Évaluer une formule de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-556">Evaluate an automatic scaling formula</span></span>](https://docs.microsoft.com/rest/api/batchservice/evaluate-an-automatic-scaling-formula)

    <span data-ttu-id="56435-557">Dans cette requête API REST, spécifiez l’ID du pool dans l’URI et la formule de mise à l’échelle automatique dans l’élément *autoScaleFormula* du corps de la requête.</span><span class="sxs-lookup"><span data-stu-id="56435-557">In this REST API request, specify the pool ID in the URI, and the autoscale formula in the *autoScaleFormula* element of the request body.</span></span> <span data-ttu-id="56435-558">La réponse de l’opération contient les éventuelles informations d’erreur associées à la formule.</span><span class="sxs-lookup"><span data-stu-id="56435-558">The response of the operation contains any error information that might be related to the formula.</span></span>

<span data-ttu-id="56435-559">Dans cet extrait de code [Batch .NET][net_api], nous évaluons une formule de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-559">In this [Batch .NET][net_api] code snippet, we evaluate an autoscale formula.</span></span> <span data-ttu-id="56435-560">Si la mise à l’échelle automatique n’est pas activée sur le pool, la première chose que nous faisons est de l’activer.</span><span class="sxs-lookup"><span data-stu-id="56435-560">If the pool does not have autoscaling enabled, we enable it first.</span></span>

```csharp
// First obtain a reference to an existing pool
CloudPool pool = await batchClient.PoolOperations.GetPoolAsync("myExistingPool");

// If autoscaling isn't already enabled on the pool, enable it.
// You can't evaluate an autoscale formula on non-autoscale-enabled pool.
if (pool.AutoScaleEnabled == false)
{
    // We need a valid autoscale formula to enable autoscaling on the
    // pool. This formula is valid, but won't resize the pool:
    await pool.EnableAutoScaleAsync(
        autoscaleFormula: "$TargetDedicatedNodes = {pool.CurrentDedicatedNodes};",
        autoscaleEvaluationInterval: TimeSpan.FromMinutes(5));

    // Batch limits EnableAutoScaleAsync calls to once every 30 seconds.
    // Because we want to apply our new autoscale formula below if it
    // evaluates successfully, and we *just* enabled autoscaling on
    // this pool, we pause here to ensure we pass that threshold.
    Thread.Sleep(TimeSpan.FromSeconds(31));

    // Refresh the properties of the pool so that we've got the
    // latest value for AutoScaleEnabled
    await pool.RefreshAsync();
}

// We must ensure that autoscaling is enabled on the pool prior to
// evaluating a formula
if (pool.AutoScaleEnabled == true)
{
    // The formula to evaluate - adjusts target number of nodes based on
    // day of week and time of day
    string myFormula = @"
        $curTime = time();
        $workHours = $curTime.hour >= 8 && $curTime.hour < 18;
        $isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
        $isWorkingWeekdayHour = $workHours && $isWeekday;
        $TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
    ";

    // Perform the autoscale formula evaluation. Note that this code does not
    // actually apply the formula to the pool.
    AutoScaleRun eval =
        await batchClient.PoolOperations.EvaluateAutoScaleAsync(pool.Id, myFormula);

    if (eval.Error == null)
    {
        // Evaluation success - print the results of the AutoScaleRun.
        // This will display the values of each variable as evaluated by the
        // autoscale formula.
        Console.WriteLine("AutoScaleRun.Results: " +
            eval.Results.Replace("$", "\n    $"));

        // Apply the formula to the pool since it evaluated successfully
        await batchClient.PoolOperations.EnableAutoScaleAsync(pool.Id, myFormula);
    }
    else
    {
        // Evaluation failed, output the message associated with the error
        Console.WriteLine("AutoScaleRun.Error.Message: " +
            eval.Error.Message);
    }
}
```

<span data-ttu-id="56435-561">Une évaluation réussie de la formule indiquée dans cet extrait de code produit des résultats du type suivant :</span><span class="sxs-lookup"><span data-stu-id="56435-561">Successful evaluation of the formula shown in this code snippet produces results similar to:</span></span>

```
AutoScaleRun.Results:
    $TargetDedicatedNodes=10;
    $NodeDeallocationOption=requeue;
    $curTime=2016-10-13T19:18:47.805Z;
    $isWeekday=1;
    $isWorkingWeekdayHour=0;
    $workHours=0
```

## <a name="get-information-about-autoscale-runs"></a><span data-ttu-id="56435-562">Obtenir des informations sur les exécutions de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-562">Get information about autoscale runs</span></span>

<span data-ttu-id="56435-563">Pour vérifier que votre formule fonctionne comme prévu, nous vous recommandons d’examiner régulièrement les résultats des exécutions de mise à l’échelle automatique effectuées par Batch sur votre pool.</span><span class="sxs-lookup"><span data-stu-id="56435-563">To ensure that your formula is performing as expected, we recommend that you periodically check the results of the autoscaling runs that Batch performs on your pool.</span></span> <span data-ttu-id="56435-564">Pour ce faire, obtenez (ou actualisez) une référence au pool et examinez les propriétés de la dernière exécution de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="56435-564">To do so, get (or refresh) a reference to the pool, and examine the properties of its last autoscale run.</span></span>

<span data-ttu-id="56435-565">Dans Batch .NET, la propriété [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) comprend plusieurs propriétés qui fournissent des informations sur la dernière exécution de mise à l’échelle automatique effectuée sur le pool :</span><span class="sxs-lookup"><span data-stu-id="56435-565">In Batch .NET, the [CloudPool.AutoScaleRun](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscalerun) property has several properties that provide information about the latest automatic scaling run performed on the pool:</span></span>

* [<span data-ttu-id="56435-566">AutoScaleRun.Timestamp</span><span class="sxs-lookup"><span data-stu-id="56435-566">AutoScaleRun.Timestamp</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.timestamp)
* [<span data-ttu-id="56435-567">AutoScaleRun.Results</span><span class="sxs-lookup"><span data-stu-id="56435-567">AutoScaleRun.Results</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.results)
* [<span data-ttu-id="56435-568">AutoScaleRun.Error</span><span class="sxs-lookup"><span data-stu-id="56435-568">AutoScaleRun.Error</span></span>](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.autoscalerun.error)

<span data-ttu-id="56435-569">Dans l’API REST, la requête [Obtenir des informations sur un pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) retourne des informations sur le pool, notamment des détails sur la dernière exécution de mise à l’échelle automatique dans la propriété [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun).</span><span class="sxs-lookup"><span data-stu-id="56435-569">In the REST API, the [Get information about a pool](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool) request returns information about the pool, which includes the latest automatic scaling run information in the [autoScaleRun](https://docs.microsoft.com/rest/api/batchservice/get-information-about-a-pool#bk_autrun) property.</span></span>

<span data-ttu-id="56435-570">L’extrait de code C# suivant utilise la bibliothèque Batch .NET pour imprimer des informations sur la dernière exécution de mise à l’échelle automatique sur le pool _myPool_ :</span><span class="sxs-lookup"><span data-stu-id="56435-570">The following C# code snippet uses the Batch .NET library to print information about the last autoscaling run on pool _myPool_:</span></span>

```csharp
await Cloud pool = myBatchClient.PoolOperations.GetPoolAsync("myPool");
Console.WriteLine("Last execution: " + pool.AutoScaleRun.Timestamp);
Console.WriteLine("Result:" + pool.AutoScaleRun.Results.Replace("$", "\n  $"));
Console.WriteLine("Error: " + pool.AutoScaleRun.Error);
```

<span data-ttu-id="56435-571">Exemple de sortie de l’extrait de code précédent :</span><span class="sxs-lookup"><span data-stu-id="56435-571">Sample output of the preceding snippet:</span></span>

```
Last execution: 10/14/2016 18:36:43
Result:
  $TargetDedicatedNodes=10;
  $NodeDeallocationOption=requeue;
  $curTime=2016-10-14T18:36:43.282Z;
  $isWeekday=1;
  $isWorkingWeekdayHour=0;
  $workHours=0
Error:
```

## <a name="example-autoscale-formulas"></a><span data-ttu-id="56435-572">Exemples de formules de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="56435-572">Example autoscale formulas</span></span>
<span data-ttu-id="56435-573">Passons en revue quelques formules illustrant les différentes façons d’ajuster la quantité de ressources de calcul dans un pool.</span><span class="sxs-lookup"><span data-stu-id="56435-573">Let's look at a few formulas that show different ways to adjust the amount of compute resources in a pool.</span></span>

### <a name="example-1-time-based-adjustment"></a><span data-ttu-id="56435-574">Exemple 1 : ajustement en fonction du temps</span><span class="sxs-lookup"><span data-stu-id="56435-574">Example 1: Time-based adjustment</span></span>
<span data-ttu-id="56435-575">Supposons que vous souhaitiez ajuster la taille du pool selon le jour et l’heure.</span><span class="sxs-lookup"><span data-stu-id="56435-575">Suppose you want to adjust the pool size based on the day of the week and time of day.</span></span> <span data-ttu-id="56435-576">Cet exemple montre comment augmenter ou diminuer le nombre de nœuds dans le pool en conséquence.</span><span class="sxs-lookup"><span data-stu-id="56435-576">This example shows how to increase or decrease the number of nodes in the pool accordingly.</span></span>

<span data-ttu-id="56435-577">Cette formule obtient dans un premier temps l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="56435-577">The formula first obtains the current time.</span></span> <span data-ttu-id="56435-578">S’il s’agit d’un jour de la semaine (1 à 5) et des heures de travail (8 heures à 18 heures), la taille du pool cible est définie sur 20 nœuds.</span><span class="sxs-lookup"><span data-stu-id="56435-578">If it's a weekday (1-5) and within working hours (8 AM to 6 PM), the target pool size is set to 20 nodes.</span></span> <span data-ttu-id="56435-579">Sinon, elle est définie sur 10 nœuds.</span><span class="sxs-lookup"><span data-stu-id="56435-579">Otherwise, it's set to 10 nodes.</span></span>

```
$curTime = time();
$workHours = $curTime.hour >= 8 && $curTime.hour < 18;
$isWeekday = $curTime.weekday >= 1 && $curTime.weekday <= 5;
$isWorkingWeekdayHour = $workHours && $isWeekday;
$TargetDedicatedNodes = $isWorkingWeekdayHour ? 20:10;
```

### <a name="example-2-task-based-adjustment"></a><span data-ttu-id="56435-580">Exemple 2 : ajustement en fonction de la tâche</span><span class="sxs-lookup"><span data-stu-id="56435-580">Example 2: Task-based adjustment</span></span>
<span data-ttu-id="56435-581">Dans cet exemple, la taille du pool est ajustée en fonction du nombre de tâches présentes dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="56435-581">In this example, the pool size is adjusted based on the number of tasks in the queue.</span></span> <span data-ttu-id="56435-582">Les commentaires et les sauts de ligne sont acceptés dans les chaînes de formule.</span><span class="sxs-lookup"><span data-stu-id="56435-582">Both comments and line breaks are acceptable in formula strings.</span></span>

```csharp
// Get pending tasks for the past 15 minutes.
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
// If we have fewer than 70 percent data points, we use the last sample point,
// otherwise we use the maximum of last sample point and the history average.
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1), avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// If number of pending tasks is not 0, set targetVM to pending tasks, otherwise
// half of current dedicated.
$targetVMs = $tasks > 0? $tasks:max(0, $TargetDedicatedNodes/2);
// The pool size is capped at 20, if target VM value is more than that, set it
// to 20. This value should be adjusted according to your use case.
$TargetDedicatedNodes = max(0, min($targetVMs, 20));
// Set node deallocation mode - keep nodes active only until tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-3-accounting-for-parallel-tasks"></a><span data-ttu-id="56435-583">Exemple 3 : comptabilisation des tâches parallèles</span><span class="sxs-lookup"><span data-stu-id="56435-583">Example 3: Accounting for parallel tasks</span></span>
<span data-ttu-id="56435-584">Cet exemple montre l’ajustement de la taille du pool en fonction du nombre de tâches.</span><span class="sxs-lookup"><span data-stu-id="56435-584">This example adjusts the pool size based on the number of tasks.</span></span> <span data-ttu-id="56435-585">Cette formule prend également en compte la valeur [MaxTasksPerComputeNode][net_maxtasks] qui a été définie pour le pool.</span><span class="sxs-lookup"><span data-stu-id="56435-585">This formula also takes into account the [MaxTasksPerComputeNode][net_maxtasks] value that has been set for the pool.</span></span> <span data-ttu-id="56435-586">Cette approche est particulièrement utile dans les situations où [l’exécution parallèle de tâches](batch-parallel-node-tasks.md) a été activée sur votre pool.</span><span class="sxs-lookup"><span data-stu-id="56435-586">This approach is useful in situations where [parallel task execution](batch-parallel-node-tasks.md) has been enabled on your pool.</span></span>

```csharp
// Determine whether 70 percent of the samples have been recorded in the past
// 15 minutes; if not, use last sample
$samples = $ActiveTasks.GetSamplePercent(TimeInterval_Minute * 15);
$tasks = $samples < 70 ? max(0,$ActiveTasks.GetSample(1)) : max( $ActiveTasks.GetSample(1),avg($ActiveTasks.GetSample(TimeInterval_Minute * 15)));
// Set the number of nodes to add to one-fourth the number of active tasks (the
// MaxTasksPerComputeNode property on this pool is set to 4, adjust this number
// for your use case)
$cores = $TargetDedicatedNodes * 4;
$extraVMs = (($tasks - $cores) + 3) / 4;
$targetVMs = ($TargetDedicatedNodes + $extraVMs);
// Attempt to grow the number of compute nodes to match the number of active
// tasks, with a maximum of 3
$TargetDedicatedNodes = max(0,min($targetVMs,3));
// Keep the nodes active until the tasks finish
$NodeDeallocationOption = taskcompletion;
```

### <a name="example-4-setting-an-initial-pool-size"></a><span data-ttu-id="56435-587">Exemple 4 : définition d’une taille de pool initiale</span><span class="sxs-lookup"><span data-stu-id="56435-587">Example 4: Setting an initial pool size</span></span>
<span data-ttu-id="56435-588">Cet exemple montre un extrait de code C# avec une formule de mise à l’échelle automatique qui définit la taille du pool sur un certain nombre de nœuds pour une période initiale.</span><span class="sxs-lookup"><span data-stu-id="56435-588">This example shows a C# code snippet with an autoscale formula that sets the pool size to a specified number of nodes for an initial time period.</span></span> <span data-ttu-id="56435-589">La taille du pool est ensuite ajustée en fonction du nombre de tâches en cours d’exécution et actives une fois la période initiale écoulée.</span><span class="sxs-lookup"><span data-stu-id="56435-589">Then it adjusts the pool size based on the number of running and active tasks after the initial time period has elapsed.</span></span>

<span data-ttu-id="56435-590">Dans l’extrait de code suivant, la formule :</span><span class="sxs-lookup"><span data-stu-id="56435-590">The formula in the following code snippet:</span></span>

* <span data-ttu-id="56435-591">Définit la taille initiale du pool sur quatre nœuds.</span><span class="sxs-lookup"><span data-stu-id="56435-591">Sets the initial pool size to four nodes.</span></span>
* <span data-ttu-id="56435-592">N’ajuste pas la taille du pool dans les 10 premières minutes de cycle de vie du pool.</span><span class="sxs-lookup"><span data-stu-id="56435-592">Does not adjust the pool size within the first 10 minutes of the pool's lifecycle.</span></span>
* <span data-ttu-id="56435-593">Après 10 minutes, obtient la valeur maximale du nombre de tâches en cours d’exécution et actives au cours des 60 dernières minutes.</span><span class="sxs-lookup"><span data-stu-id="56435-593">After 10 minutes, obtains the max value of the number of running and active tasks within the past 60 minutes.</span></span>
  * <span data-ttu-id="56435-594">Si les deux valeurs sont égales à 0 (ce qui indique qu’aucune tâche n’était en cours d’exécution ni active au cours des 60 dernières minutes), la taille du pool est définie sur 0.</span><span class="sxs-lookup"><span data-stu-id="56435-594">If both values are 0 (indicating that no tasks were running or active in the last 60 minutes), the pool size is set to 0.</span></span>
  * <span data-ttu-id="56435-595">Si l’une des valeurs est supérieure à zéro, aucune modification n’est apportée.</span><span class="sxs-lookup"><span data-stu-id="56435-595">If either value is greater than zero, no change is made.</span></span>

```csharp
string now = DateTime.UtcNow.ToString("r");
string formula = string.Format(@"
    $TargetDedicatedNodes = {1};
    lifespan         = time() - time(""{0}"");
    span             = TimeInterval_Minute * 60;
    startup          = TimeInterval_Minute * 10;
    ratio            = 50;

    $TargetDedicatedNodes = (lifespan > startup ? (max($RunningTasks.GetSample(span, ratio), $ActiveTasks.GetSample(span, ratio)) == 0 ? 0 : $TargetDedicatedNodes) : {1});
    ", now, 4);
```

## <a name="next-steps"></a><span data-ttu-id="56435-596">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="56435-596">Next steps</span></span>
* <span data-ttu-id="56435-597">[Optimiser l’utilisation des ressources de calcul Azure Batch avec des tâches de nœud simultanées](batch-parallel-node-tasks.md) contient des informations sur la façon dont vous pouvez effectuer plusieurs tâches simultanément sur les nœuds de calcul de votre pool.</span><span class="sxs-lookup"><span data-stu-id="56435-597">[Maximize Azure Batch compute resource usage with concurrent node tasks](batch-parallel-node-tasks.md) contains details about how you can execute multiple tasks simultaneously on the compute nodes in your pool.</span></span> <span data-ttu-id="56435-598">En plus de la mise à l’échelle automatique, cette fonctionnalité peut aider à réduire la durée du travail pour certaines charges de travail et vous permettre d’économiser de l’argent.</span><span class="sxs-lookup"><span data-stu-id="56435-598">In addition to autoscaling, this feature may help to lower job duration for some workloads, saving you money.</span></span>
* <span data-ttu-id="56435-599">Afin d’améliorer encore l’efficacité, assurez-vous que votre application Batch interroge le service Batch de la manière la plus optimale qui soit.</span><span class="sxs-lookup"><span data-stu-id="56435-599">For another efficiency booster, ensure that your Batch application queries the Batch service in the most optimal way.</span></span> <span data-ttu-id="56435-600">Consultez [Interroger efficacement le service Azure Batch](batch-efficient-list-queries.md) pour découvrir comment limiter la quantité de données qui transitent par le réseau lorsque vous interrogez l’état des milliers de nœuds de calcul ou de tâches potentiels.</span><span class="sxs-lookup"><span data-stu-id="56435-600">See [Query the Azure Batch service efficiently](batch-efficient-list-queries.md) to learn how to limit the amount of data that crosses the wire when you query the status of potentially thousands of compute nodes or tasks.</span></span>

[net_api]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch
[net_batchclient]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.batchclient
[net_cloudpool_autoscaleformula]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleformula
[net_cloudpool_autoscaleevalinterval]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.autoscaleevaluationinterval
[net_enableautoscaleasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.enableautoscaleasync
[net_maxtasks]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudpool.maxtaskspercomputenode
[net_poolops_resizepoolasync]: https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.pooloperations.resizepoolasync

[rest_api]: https://docs.microsoft.com/rest/api/batchservice/
[rest_autoscaleformula]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_autoscaleinterval]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
[rest_enableautoscale]: https://docs.microsoft.com/rest/api/batchservice/enable-automatic-scaling-on-a-pool
