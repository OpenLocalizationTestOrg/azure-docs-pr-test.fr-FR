---
title: "aaaStart création de solutions de lot avec les modèles de projet Visual Studio - Azure | Documents Microsoft"
description: "Découvrez comment des modèles de projet Visual Studio peuvent vous aider à implémenter et à exécuter vos charges de travail nécessitant beaucoup de ressources sur Azure Batch."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: a61c480ddc4dffd66c01220a137a3e852e39c338
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="use-visual-studio-project-templates-toojump-start-batch-solutions"></a><span data-ttu-id="c21ea-103">Utiliser des solutions de lot de Visual Studio projet modèles toojump-Démarrer</span><span class="sxs-lookup"><span data-stu-id="c21ea-103">Use Visual Studio project templates toojump-start Batch solutions</span></span>

<span data-ttu-id="c21ea-104">Hello **Gestionnaire de travaux** et **modèles Visual Studio de tâche processeur** pour le traitement par lots fournissent le code toohelp vous tooimplement et exécuter vos charges de travail de calcul intensif sur le traitement par lots avec hello moins quantité de travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-104">hello **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code toohelp you tooimplement and run your compute-intensive workloads on Batch with hello least amount of effort.</span></span> <span data-ttu-id="c21ea-105">Ce document décrit ces modèles et fournit des conseils sur la façon de toouse les.</span><span class="sxs-lookup"><span data-stu-id="c21ea-105">This document describes these templates and provides guidance for how toouse them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c21ea-106">Cet article traite uniquement les modèles applicables toothese deux informations et part du principe que vous êtes familiarisé avec le service de traitement par lots hello et tooit connexes des concepts clés : calcul de pools, nœuds, travaux et tâches, le Gestionnaire des tâches, les variables d’environnement et autres informations pertinentes.</span><span class="sxs-lookup"><span data-stu-id="c21ea-106">This article discusses only information applicable toothese two templates, and assumes that you are familiar with hello Batch service and key concepts related tooit: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="c21ea-107">Vous trouverez plus d’informations dans [principes de base d’Azure Batch](batch-technical-overview.md), [vue d’ensemble de lot pour les développeurs](batch-api-basics.md), et [démarrer avec la bibliothèque de traitement par lots Azure hello pour .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="c21ea-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with hello Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="c21ea-108">Vue d’ensemble globale</span><span class="sxs-lookup"><span data-stu-id="c21ea-108">High-level overview</span></span>
<span data-ttu-id="c21ea-109">modèles de gestionnaire de travaux et tâches processeur Hello peuvent être toocreate utilisés de deux composants utiles :</span><span class="sxs-lookup"><span data-stu-id="c21ea-109">hello Job Manager and Task Processor templates can be used toocreate two useful components:</span></span>

* <span data-ttu-id="c21ea-110">Une tâche du gestionnaire de travaux qui permet de fractionner un travail afin de le découper en plusieurs tâches pouvant être exécutées indépendamment, en parallèle.</span><span class="sxs-lookup"><span data-stu-id="c21ea-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="c21ea-111">Un processeur de tâches qui peut être pré-traitement tooperform utilisés et post-traitement autour d’une ligne de commande d’application.</span><span class="sxs-lookup"><span data-stu-id="c21ea-111">A task processor that can be used tooperform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="c21ea-112">Par exemple, dans un scénario de rendu vidéo, fractionnées de travail hello activer un travail de séquence unique dans des centaines, voire des milliers de tâches distinctes qui seraient traitent des frames individuels séparément.</span><span class="sxs-lookup"><span data-stu-id="c21ea-112">For example, in a movie rendering scenario, hello job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="c21ea-113">En conséquence, processeur de tâches hello serait appeler hello rendu application et tous les processus dépendants qui sont nécessaire toorender chaque frame, ainsi qu’exécuter toute action supplémentaire (par exemple, copie hello rendu frame tooa emplacement de stockage).</span><span class="sxs-lookup"><span data-stu-id="c21ea-113">Correspondingly, hello task processor would invoke hello rendering application and all dependent processes that are needed toorender each frame, as well as perform any additional actions (for example, copying hello rendered frame tooa storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="c21ea-114">modèles de gestionnaire de travaux et tâches processeur Hello sont indépendantes des autres, vous pouvez donc choisir toouse à la fois, ou uniquement un d’eux selon les spécifications de hello de votre travail de calcul et de vos préférences.</span><span class="sxs-lookup"><span data-stu-id="c21ea-114">hello Job Manager and Task Processor templates are independent of each other, so you can choose toouse both, or only one of them, depending on hello requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="c21ea-115">Comme indiqué dans le schéma hello ci-dessous, un travail de calcul qui utilise ces modèles passe par trois étapes :</span><span class="sxs-lookup"><span data-stu-id="c21ea-115">As shown in hello diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="c21ea-116">le code Hello client (par exemple, application, service web, etc.) soumet un toohello de la tâche service de traitement par lots sur Azure, en spécifiant en tant que son programme Gestionnaire de travail manager tâche hello travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-116">hello client code (e.g., application, web service, etc.) submits a job toohello Batch service on Azure, specifying as its job manager task hello job manager program.</span></span>
2. <span data-ttu-id="c21ea-117">service de traitement par lots Hello exécute la tâche du gestionnaire hello sur un nœud de calcul et hello travail fractionnées lance hello spécifiée nombre de tâches du processeur de tâches, si plusieurs nœuds de calcul en fonction des besoins, selon les paramètres de hello et les spécifications dans le code de fractionnement de tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-117">hello Batch service runs hello job manager task on a compute node and hello job splitter launches hello specified number of task processor tasks, on as many compute nodes as required, based on hello parameters and specifications in hello job splitter code.</span></span>
3. <span data-ttu-id="c21ea-118">Hello tâche processeur tâches s’exécutent indépendamment, en parallèle, tooprocess les données d’entrée hello et génèrent des données de sortie hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-118">hello task processor tasks run independently, in parallel, tooprocess hello input data and generate hello output data.</span></span>

![Diagramme montrant comment le code client interagit avec hello service Batch][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="c21ea-120">Composants requis</span><span class="sxs-lookup"><span data-stu-id="c21ea-120">Prerequisites</span></span>
<span data-ttu-id="c21ea-121">modèles de lot toouse hello, vous devrez suivant de hello :</span><span class="sxs-lookup"><span data-stu-id="c21ea-121">toouse hello Batch templates, you will need hello following:</span></span>

* <span data-ttu-id="c21ea-122">Un ordinateur où Visual Studio 2015 est installé.</span><span class="sxs-lookup"><span data-stu-id="c21ea-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="c21ea-123">Les modèles Batch sont actuellement pris en charge seulement pour Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="c21ea-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="c21ea-124">modèles de lot Hello, qui sont disponibles à partir de hello [galerie Visual Studio] [ vs_gallery] en tant qu’extensions de Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c21ea-124">hello Batch templates, which are available from hello [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="c21ea-125">Il existe deux façons de modèles de hello tooget :</span><span class="sxs-lookup"><span data-stu-id="c21ea-125">There are two ways tooget hello templates:</span></span>
  
  * <span data-ttu-id="c21ea-126">Installer les modèles hello à l’aide de hello **Extensions et mises à jour** boîte de dialogue dans Visual Studio (pour plus d’informations, consultez [recherche et utilisation des Extensions Visual Studio][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="c21ea-126">Install hello templates using hello **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="c21ea-127">Bonjour **Extensions et mises à jour** boîte de dialogue, la recherche et le téléchargement hello suivant deux extensions :</span><span class="sxs-lookup"><span data-stu-id="c21ea-127">In hello **Extensions and Updates** dialog box, search and download hello following two extensions:</span></span>
    
    * <span data-ttu-id="c21ea-128">Le gestionnaire de travaux Azure Batch avec l’outil de fractionnement du travail</span><span class="sxs-lookup"><span data-stu-id="c21ea-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="c21ea-129">Le processeur de tâches Azure Batch</span><span class="sxs-lookup"><span data-stu-id="c21ea-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="c21ea-130">Télécharger des modèles de hello à partir de la galerie en ligne de hello pour Visual Studio : [modèles de projet Microsoft Azure Batch][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="c21ea-130">Download hello templates from hello online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="c21ea-131">Si vous envisagez de toouse hello [les Packages d’applications](batch-application-packages.md) Gestionnaire de travaux de fonctionnalité toodeploy hello et toohello de processeur de tâches par lots des nœuds de calcul, vous devez toolink un tooyour de compte de stockage du compte Batch.</span><span class="sxs-lookup"><span data-stu-id="c21ea-131">If you plan toouse hello [Application Packages](batch-application-packages.md) feature toodeploy hello job manager and task processor toohello Batch compute nodes, you need toolink a storage account tooyour Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="c21ea-132">Préparation</span><span class="sxs-lookup"><span data-stu-id="c21ea-132">Preparation</span></span>
<span data-ttu-id="c21ea-133">Nous vous recommandons de créer une solution peut contenir votre gestionnaire de travaux, ainsi que votre processeur de tâches, car cela peut rendre plus facile code tooshare entre votre gestionnaire de travaux et les programmes de traitement de tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier tooshare code between your job manager and task processor programs.</span></span> <span data-ttu-id="c21ea-134">toocreate cette solution, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-134">toocreate this solution, follow these steps:</span></span>

1. <span data-ttu-id="c21ea-135">Ouvrez Visual Studio et sélectionnez **Fichier** > **Nouveau** > **Projet**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="c21ea-136">Sous **Modèles**, développez **Autres Types de projets**, cliquez sur **Solutions Visual Studio**, puis sélectionnez **Nouvelle Solution**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="c21ea-137">Tapez un nom qui décrit votre objet application et hello de cette solution (par exemple, « LitwareBatchTaskPrograms »).</span><span class="sxs-lookup"><span data-stu-id="c21ea-137">Type a name that describes your application and hello purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="c21ea-138">toocreate hello nouvelle solution, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-138">toocreate hello new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="c21ea-139">Modèle du gestionnaire de travaux</span><span class="sxs-lookup"><span data-stu-id="c21ea-139">Job Manager template</span></span>
<span data-ttu-id="c21ea-140">modèle de gestionnaire de travaux Hello permet de vous tooimplement une tâche du gestionnaire qui peut effectuer hello suivant des actions :</span><span class="sxs-lookup"><span data-stu-id="c21ea-140">hello Job Manager template helps you tooimplement a job manager task that can perform hello following actions:</span></span>

* <span data-ttu-id="c21ea-141">Fractionner un travail en plusieurs tâches.</span><span class="sxs-lookup"><span data-stu-id="c21ea-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="c21ea-142">Envoyer ces toorun de tâches sur le lot.</span><span class="sxs-lookup"><span data-stu-id="c21ea-142">Submit those tasks toorun on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="c21ea-143">Pour plus d’informations sur le gestionnaire de travaux, consultez [Présentation des fonctionnalités du service Batch pour les développeurs](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="c21ea-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-hello-template"></a><span data-ttu-id="c21ea-144">Créer un gestionnaire de travaux à l’aide du modèle de hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-144">Create a Job Manager using hello template</span></span>
<span data-ttu-id="c21ea-145">tooadd une solution de toohello de gestionnaire de travail que vous avez créé précédemment, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-145">tooadd a job manager toohello solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="c21ea-146">Ouvrez votre solution existante dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c21ea-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="c21ea-147">Dans l’Explorateur de solutions de hello avec le bouton droit, cliquez sur **ajouter** > **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-147">In Solution Explorer, right-click hello solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="c21ea-148">Sous **Visual C#**, cliquez sur **Cloud**, puis sur **Azure Batch Job Manager with Job Splitter** (Gestionnaire de travaux Azure Batch avec outil de fractionnement du travail).</span><span class="sxs-lookup"><span data-stu-id="c21ea-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="c21ea-149">Tapez un nom qui décrit votre application, ce projet en tant que gestionnaire de travaux hello (par exemple) « GestionnaireTravauxLitware »).</span><span class="sxs-lookup"><span data-stu-id="c21ea-149">Type a name that describes your application and identifies this project as hello job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="c21ea-150">projet de hello toocreate, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-150">toocreate hello project, click **OK**.</span></span>
6. <span data-ttu-id="c21ea-151">Enfin, build hello projet tooforce Visual Studio tooload tous les référencé les packages NuGet et tooverify qui hello du projet n’est valide avant de commencer à modifier.</span><span class="sxs-lookup"><span data-stu-id="c21ea-151">Finally, build hello project tooforce Visual Studio tooload all referenced NuGet packages and tooverify that hello project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="c21ea-152">Les fichiers du modèle du gestionnaire de travaux et leur objectif</span><span class="sxs-lookup"><span data-stu-id="c21ea-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="c21ea-153">Lorsque vous créez un projet à l’aide du modèle de gestionnaire de travaux hello, il génère trois groupes de fichiers de code :</span><span class="sxs-lookup"><span data-stu-id="c21ea-153">When you create a project using hello Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="c21ea-154">fichier de programme principal Hello (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="c21ea-154">hello main program file (Program.cs).</span></span> <span data-ttu-id="c21ea-155">Il contient le point d’entrée de programme de hello et la gestion des exceptions de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c21ea-155">This contains hello program entry point and top-level exception handling.</span></span> <span data-ttu-id="c21ea-156">Vous ne devez pas normalement besoin toomodify.</span><span class="sxs-lookup"><span data-stu-id="c21ea-156">You shouldn't normally need toomodify this.</span></span>
* <span data-ttu-id="c21ea-157">répertoire du Framework Hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-157">hello Framework directory.</span></span> <span data-ttu-id="c21ea-158">Il contient des fichiers de hello responsables hello 'standard' travailler par programme de gestionnaire de travaux hello – décompression des paramètres, ajouter des lots de tâches toohello, etc.. Vous ne devez pas normalement besoin toomodify ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="c21ea-158">This contains hello files responsible for hello 'boilerplate' work done by hello job manager program – unpacking parameters, adding tasks toohello Batch job, etc. You shouldn't normally need toomodify these files.</span></span>
* <span data-ttu-id="c21ea-159">fichier de fractionnement de travail Hello (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="c21ea-159">hello job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="c21ea-160">C’est là que vous allez placer la logique spécifique à votre application pour le fractionnement d’un travail en tâches.</span><span class="sxs-lookup"><span data-stu-id="c21ea-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="c21ea-161">Bien sûr vous pouvez ajouter des fichiers supplémentaires comme toosupport requis votre code de fractionnement travail, selon la complexité hello du travail hello séparation logique.</span><span class="sxs-lookup"><span data-stu-id="c21ea-161">Of course you can add additional files as required toosupport your job splitter code, depending on hello complexity of hello job splitting logic.</span></span>

<span data-ttu-id="c21ea-162">modèle de Hello génère également des fichiers de projet .NET standards comme un fichier .csproj app.config, packages.config, etc..</span><span class="sxs-lookup"><span data-stu-id="c21ea-162">hello template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="c21ea-163">reste Hello de cette section décrit les différents fichiers de hello et leur structure de code et explique ce que fait chaque classe.</span><span class="sxs-lookup"><span data-stu-id="c21ea-163">hello rest of this section describes hello different files and their code structure, and explains what each class does.</span></span>

![Explorateur de solutions Visual Studio affichant des solutions de modèle de gestionnaire de travaux hello][solution_explorer01]

<span data-ttu-id="c21ea-165">**Fichiers Framework**</span><span class="sxs-lookup"><span data-stu-id="c21ea-165">**Framework files**</span></span>

* <span data-ttu-id="c21ea-166">`Configuration.cs`: Encapsule chargement hello travail de données de configuration telles que les détails du compte Batch, informations d’identification du compte de stockage liés, les informations de projet et la tâche et paramètres de la tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-166">`Configuration.cs`: Encapsulates hello loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="c21ea-167">Il fournit également accès aux variables d’environnement de définis par le tooBatch (voir les paramètres d’environnement pour les tâches, dans la documentation de lot hello) via la classe de Configuration.EnvironmentVariable hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-167">It also provides access tooBatch-defined environment variables (see Environment settings for tasks, in hello Batch documentation) via hello Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="c21ea-168">`IConfiguration.cs`: Résumés hello implémentation de classe de Configuration de hello, afin que vous puissiez de test unitaire votre séparateur de travail à l’aide d’un objet de configuration faux ou fictive.</span><span class="sxs-lookup"><span data-stu-id="c21ea-168">`IConfiguration.cs`: Abstracts hello implementation of hello Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="c21ea-169">`JobManager.cs`: Orchestre des composants de programme de gestion du travail hello hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-169">`JobManager.cs`: Orchestrates hello components of hello job manager program.</span></span> <span data-ttu-id="c21ea-170">Il est chargé de hello l’initialisation du séparateur de travail hello, appel de séparateur de travail hello, et la distribution des tâches de hello retourné par le soumissionnaire tâche toohello hello travail fractionnées.</span><span class="sxs-lookup"><span data-stu-id="c21ea-170">It is responsible for hello initializing hello job splitter, invoking hello job splitter, and dispatching hello tasks returned by hello job splitter toohello task submitter.</span></span>
* <span data-ttu-id="c21ea-171">`JobManagerException.cs`Représente une erreur qui nécessite hello travail manager tooterminate.</span><span class="sxs-lookup"><span data-stu-id="c21ea-171">`JobManagerException.cs`: Represents an error that requires hello job manager tooterminate.</span></span> <span data-ttu-id="c21ea-172">JobManagerException est utilisé toowrap les erreurs 'attendu' où les informations de diagnostic spécifiques peuvent être fournies dans le cadre de l’arrêt.</span><span class="sxs-lookup"><span data-stu-id="c21ea-172">JobManagerException is used toowrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="c21ea-173">`TaskSubmitter.cs`: Cette classe est retournées par lots hello projet fractionnées toohello des tâches tooadding responsable.</span><span class="sxs-lookup"><span data-stu-id="c21ea-173">`TaskSubmitter.cs`: This class is responsible tooadding tasks returned by hello job splitter toohello Batch job.</span></span> <span data-ttu-id="c21ea-174">classe de JobManager Hello agrège séquence hello de tâches dans des lots de travail de toohello plus efficace mais en temps voulu, puis appelle TaskSubmitter.SubmitTasks sur un thread d’arrière-plan pour chaque lot.</span><span class="sxs-lookup"><span data-stu-id="c21ea-174">hello JobManager class aggregates hello sequence of tasks into batches for efficient but timely addition toohello job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="c21ea-175">**Outil de fractionnement du travail**</span><span class="sxs-lookup"><span data-stu-id="c21ea-175">**Job Splitter**</span></span>

<span data-ttu-id="c21ea-176">`JobSplitter.cs`: Cette classe contient la logique pour fractionner le travail de hello en tâches spécifiques à l’application.</span><span class="sxs-lookup"><span data-stu-id="c21ea-176">`JobSplitter.cs`: This class contains application-specific logic for splitting hello job into tasks.</span></span> <span data-ttu-id="c21ea-177">Hello framework appelle hello JobSplitter.Split méthode tooobtain une séquence de tâches, qu’elle ajoute travail toohello en tant que méthode hello les retourne.</span><span class="sxs-lookup"><span data-stu-id="c21ea-177">hello framework invokes hello JobSplitter.Split method tooobtain a sequence of tasks, which it adds toohello job as hello method returns them.</span></span> <span data-ttu-id="c21ea-178">Il s’agit d’hello classe où vous serez injecter la logique de hello de votre travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-178">This is hello class where you will inject hello logic of your job.</span></span> <span data-ttu-id="c21ea-179">Implémenter hello fractionnement méthode tooreturn une séquence d’instances CloudTask représentant les tâches hello dans lequel vous souhaitez le travail de hello toopartition.</span><span class="sxs-lookup"><span data-stu-id="c21ea-179">Implement hello Split method tooreturn a sequence of CloudTask instances representing hello tasks into which you want toopartition hello job.</span></span>

<span data-ttu-id="c21ea-180">**Fichiers de projet de ligne de commande .NET standard**</span><span class="sxs-lookup"><span data-stu-id="c21ea-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="c21ea-181">`App.config`: Fichier de configuration d’application .NET standard.</span><span class="sxs-lookup"><span data-stu-id="c21ea-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="c21ea-182">`Packages.config`: Fichier de dépendance de package NuGet standard.</span><span class="sxs-lookup"><span data-stu-id="c21ea-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="c21ea-183">`Program.cs`: Contient le point d’entrée de programme de hello et la gestion des exceptions de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c21ea-183">`Program.cs`: Contains hello program entry point and top-level exception handling.</span></span>

### <a name="implementing-hello-job-splitter"></a><span data-ttu-id="c21ea-184">Implémentation de fractionnement de tâche hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-184">Implementing hello job splitter</span></span>
<span data-ttu-id="c21ea-185">Lorsque vous ouvrez le projet de modèle de gestionnaire de travaux hello, hello projet possède fichier JobSplitter.cs de hello ouverte par défaut.</span><span class="sxs-lookup"><span data-stu-id="c21ea-185">When you open hello Job Manager template project, hello project will have hello JobSplitter.cs file open by default.</span></span> <span data-ttu-id="c21ea-186">Vous pouvez implémenter hello fractionner logique pour les tâches de hello dans votre charge de travail à l’aide d’afficher de méthode hello Split() ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="c21ea-186">You can implement hello split logic for hello tasks in your workload by using hello Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets hello tasks into which toosplit hello job. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello job manager framework invokes hello Split method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and hello "yield return" statement; this allows tasks toobe added
/// and toostart running while splitting is still in progress.
/// </summary>
/// <returns>hello tasks toobe added toohello job. Tasks are added automatically
/// by hello job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for hello split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="c21ea-187">Hello annoté section Bonjour `Split()` méthode est section uniquement hello hello code de modèle de gestionnaire de travaux qui est destiné à vous toomodify en ajoutant hello logique toosplit vos travaux de différentes tâches.</span><span class="sxs-lookup"><span data-stu-id="c21ea-187">hello annotated section in hello `Split()` method is hello only section of hello Job Manager template code that is intended for you toomodify by adding hello logic toosplit your jobs into different tasks.</span></span> <span data-ttu-id="c21ea-188">Si vous souhaitez toomodify une autre section du modèle de hello, vérifiez que vous sont être familiarisé avec le fonctionne de lot et essayer de quelques exemples de hello [traiter par lot des exemples de code][github_samples].</span><span class="sxs-lookup"><span data-stu-id="c21ea-188">If you want toomodify a different section of hello template, please ensure you are familiarized with how Batch works, and try out a few of hello [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="c21ea-189">Votre implémentation Split() a accès :</span><span class="sxs-lookup"><span data-stu-id="c21ea-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="c21ea-190">Hello paramètres du travail, via hello `_parameters` champ.</span><span class="sxs-lookup"><span data-stu-id="c21ea-190">hello job parameters, via hello `_parameters` field.</span></span>
* <span data-ttu-id="c21ea-191">Hello CloudJob de l’objet travail représentant hello via hello `_job` champ.</span><span class="sxs-lookup"><span data-stu-id="c21ea-191">hello CloudJob object representing hello job, via hello `_job` field.</span></span>
* <span data-ttu-id="c21ea-192">Hello CloudTask de l’objet représentant hello tâche du gestionnaire, via hello `_jobManagerTask` champ.</span><span class="sxs-lookup"><span data-stu-id="c21ea-192">hello CloudTask object representing hello job manager task, via hello `_jobManagerTask` field.</span></span>

<span data-ttu-id="c21ea-193">Votre `Split()` implémentation n’a pas besoin travail de toohello tooadd tâches directement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-193">Your `Split()` implementation does not need tooadd tasks toohello job directly.</span></span> <span data-ttu-id="c21ea-194">Au lieu de cela, votre code doit retourner une séquence d’objets de CloudTask, et ils seront ajoutés toohello travail automatiquement par les classes de framework hello qui appellent le séparateur de travail hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-194">Instead, your code should return a sequence of CloudTask objects, and these will be added toohello job automatically by hello framework classes that invoke hello job splitter.</span></span> <span data-ttu-id="c21ea-195">Il est commun toouse C# itérateur (`yield return`) tooimplement les séparateurs de travail de fonctionnalité car cela permet de hello toostart de tâches en cours d’exécution dès que possible, plutôt que d’attendre que toutes les tâches toobe calculés.</span><span class="sxs-lookup"><span data-stu-id="c21ea-195">It's common toouse C#'s iterator (`yield return`) feature tooimplement job splitters as this allows hello tasks toostart running as soon as possible rather than waiting for all tasks toobe calculated.</span></span>

<span data-ttu-id="c21ea-196">**Échec du fractionnement du travail**</span><span class="sxs-lookup"><span data-stu-id="c21ea-196">**Job splitter failure**</span></span>

<span data-ttu-id="c21ea-197">Si votre outil de fractionnement du travail rencontre une erreur, il doit soit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="c21ea-198">Mettre fin à la séquence de hello à l’aide de hello c# `yield break` instruction, dans lequel le Gestionnaire de travaux hello cas est considéré comme réussi ; ou</span><span class="sxs-lookup"><span data-stu-id="c21ea-198">Terminate hello sequence using hello C# `yield break` statement, in which case hello job manager will be treated as successful; or</span></span>
* <span data-ttu-id="c21ea-199">Une exception, dans laquelle le Gestionnaire de travaux hello cas est considéré comme ayant échoué et peut être retentée selon la client de hello a la configuration).</span><span class="sxs-lookup"><span data-stu-id="c21ea-199">Throw an exception, in which case hello job manager will be treated as failed and may be retried depending on how hello client has configured it).</span></span>

<span data-ttu-id="c21ea-200">Dans les deux cas, toutes les tâches déjà retourné par le séparateur de travail hello et toohello ajouté par lots seront toorun éligible.</span><span class="sxs-lookup"><span data-stu-id="c21ea-200">In both cases, any tasks already returned by hello job splitter and added toohello Batch job will be eligible toorun.</span></span> <span data-ttu-id="c21ea-201">Si vous ne souhaitez pas cette toohappen, vous pouvez :</span><span class="sxs-lookup"><span data-stu-id="c21ea-201">If you don't want this toohappen, then you could:</span></span>

* <span data-ttu-id="c21ea-202">Arrêter le travail de hello avant le renvoi d’un fractionnement de tâche hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-202">Terminate hello job before returning from hello job splitter</span></span>
* <span data-ttu-id="c21ea-203">Collection d’ensemble de la tâche hello avant de le renvoyer de formuler (autrement dit, retourner un `ICollection<CloudTask>` ou `IList<CloudTask>` au lieu d’implémenter le séparateur de travail à l’aide d’un itérateur c#)</span><span class="sxs-lookup"><span data-stu-id="c21ea-203">Formulate hello entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="c21ea-204">Utilisez toomake de dépendances de tâche toutes les tâches dépendent de la réussite de hello du Gestionnaire de travaux hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-204">Use task dependencies toomake all tasks depend on hello successful completion of hello job manager</span></span>

<span data-ttu-id="c21ea-205">**Nouvelles tentatives du gestionnaire de travaux**</span><span class="sxs-lookup"><span data-stu-id="c21ea-205">**Job manager retries**</span></span>

<span data-ttu-id="c21ea-206">Si le Gestionnaire de travaux hello échoue, il peut être retentée par le service de traitement par lots hello en fonction des paramètres de nouvelle tentative hello client.</span><span class="sxs-lookup"><span data-stu-id="c21ea-206">If hello job manager fails, it may be retried by hello Batch service depending on hello client retry settings.</span></span> <span data-ttu-id="c21ea-207">En règle générale, il s’agit-safe, car lors de l’infrastructure de hello ajoute le travail de toohello de tâches, il ignore toutes les tâches qui existent déjà.</span><span class="sxs-lookup"><span data-stu-id="c21ea-207">In general, this is safe, because when hello framework adds tasks toohello job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="c21ea-208">Toutefois, si le calcul de tâches est coûteux, vous pouvez de pas coût de hello tooincur de recalcul des tâches qui ont déjà été ajoutés toohello travail ; à l’inverse, si vous exécutez de nouveau hello est toogenerate non garanti hello même ID de tâche, puis le comportement d’ignorer les doublons hello ne se lancera pas.</span><span class="sxs-lookup"><span data-stu-id="c21ea-208">However, if calculating tasks is expensive, you may not wish tooincur hello cost of recalculating tasks that have already been added toohello job; conversely, if hello re-run is not guaranteed toogenerate hello same task IDs then hello 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="c21ea-209">Dans ce cas, vous devez concevoir votre travail fractionnées toodetect hello le travail a déjà été effectué et se répète pas, par exemple en effectuant un CloudJob.ListTasks avant de démarrer des tâches de tooyield.</span><span class="sxs-lookup"><span data-stu-id="c21ea-209">In these cases you should design your job splitter toodetect hello work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting tooyield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-hello-job-manager-template"></a><span data-ttu-id="c21ea-210">Quitter les codes et les exceptions dans le modèle de gestionnaire de travaux hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-210">Exit codes and exceptions in hello Job Manager template</span></span>
<span data-ttu-id="c21ea-211">Codes de sortie et les exceptions fournissent un résultat de hello toodetermine mécanisme d’exécution d’un programme, et elles peuvent aider à tooidentify tous les problèmes de l’exécution de hello du programme de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-211">Exit codes and exceptions provide a mechanism toodetermine hello outcome of running a program, and they can help tooidentify any problems with hello execution of hello program.</span></span> <span data-ttu-id="c21ea-212">modèle de gestionnaire de travaux Hello implémente les codes de sortie hello et exceptions décrites dans cette section.</span><span class="sxs-lookup"><span data-stu-id="c21ea-212">hello Job Manager template implements hello exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="c21ea-213">Une tâche du gestionnaire qui est implémentée avec un modèle de gestionnaire de travaux hello peut retourner trois codes de sortie possibles :</span><span class="sxs-lookup"><span data-stu-id="c21ea-213">A job manager task that is implemented with hello Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="c21ea-214">Code</span><span class="sxs-lookup"><span data-stu-id="c21ea-214">Code</span></span> | <span data-ttu-id="c21ea-215">Description</span><span class="sxs-lookup"><span data-stu-id="c21ea-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="c21ea-216">0</span><span class="sxs-lookup"><span data-stu-id="c21ea-216">0</span></span> |<span data-ttu-id="c21ea-217">Gestionnaire de travaux Hello s’est terminé correctement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-217">hello job manager completed successfully.</span></span> <span data-ttu-id="c21ea-218">Votre code de fractionnement du travail exécuté toocompletion et toutes les tâches ont été ajoutées toohello travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-218">Your job splitter code ran toocompletion, and all tasks were added toohello job.</span></span> |
| <span data-ttu-id="c21ea-219">1</span><span class="sxs-lookup"><span data-stu-id="c21ea-219">1</span></span> |<span data-ttu-id="c21ea-220">Échec de la tâche du gestionnaire Hello avec une exception dans une partie 'attendue' du programme de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-220">hello job manager task failed with an exception in an 'expected' part of hello program.</span></span> <span data-ttu-id="c21ea-221">exception de Hello a été traduit tooa JobManagerException avec des informations de diagnostic et, si possible, des suggestions de résolution hello échec.</span><span class="sxs-lookup"><span data-stu-id="c21ea-221">hello exception was translated tooa JobManagerException with diagnostic information and, where possible, suggestions for resolving hello failure.</span></span> |
| <span data-ttu-id="c21ea-222">2</span><span class="sxs-lookup"><span data-stu-id="c21ea-222">2</span></span> |<span data-ttu-id="c21ea-223">Échec de la tâche du gestionnaire Hello avec une exception « inattendue ».</span><span class="sxs-lookup"><span data-stu-id="c21ea-223">hello job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="c21ea-224">exception Hello était connecté toostandard de sortie, mais le Gestionnaire de travaux hello tooadd Impossible de toutes les informations de diagnostic ou de mise à jour supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="c21ea-224">hello exception was logged toostandard output, but hello job manager was unable tooadd any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="c21ea-225">Dans les cas de hello Échec de tâche de Gestionnaire des tâches, certaines tâches peuvent toujours ont été ajoutées toohello service avant hello erreur s’est produite.</span><span class="sxs-lookup"><span data-stu-id="c21ea-225">In hello case of job manager task failure, some tasks may still have been added toohello service before hello error occurred.</span></span> <span data-ttu-id="c21ea-226">Ces tâches s’exécutent normalement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-226">These tasks will run as normal.</span></span> <span data-ttu-id="c21ea-227">Pour plus d’informations sur ce chemin de code, consultez la rubrique « Échec du fractionnement du travail » ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="c21ea-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="c21ea-228">Toutes les informations de hello retournées par les exceptions sont écrites dans les fichiers stdout.txt et stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="c21ea-228">All hello information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="c21ea-229">Pour plus d’informations, consultez la rubrique [Gestion des erreurs](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="c21ea-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="c21ea-230">Considérations du client</span><span class="sxs-lookup"><span data-stu-id="c21ea-230">Client considerations</span></span>
<span data-ttu-id="c21ea-231">Cette section présente certaines exigences d’implémentation du client lors de l’appel d’un gestionnaire de travaux basé sur ce modèle.</span><span class="sxs-lookup"><span data-stu-id="c21ea-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="c21ea-232">Consultez [comment toopass paramètres et variables d’environnement à partir de hello code client](#pass-environment-settings) pour plus d’informations sur le passage des paramètres et des paramètres d’environnement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-232">See [How toopass parameters and environment variables from hello client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="c21ea-233">**Informations d’identification obligatoires**</span><span class="sxs-lookup"><span data-stu-id="c21ea-233">**Mandatory credentials**</span></span>

<span data-ttu-id="c21ea-234">Dans l’ordre tooadd tâches toohello Azure par lots, tâche hello du gestionnaire requiert votre URL de compte Azure Batch et la clé.</span><span class="sxs-lookup"><span data-stu-id="c21ea-234">In order tooadd tasks toohello Azure Batch job, hello job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="c21ea-235">Vous devez les transmettre en tant que variables d’environnement appelées YOUR_BATCH_URL et YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="c21ea-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="c21ea-236">Vous pouvez définir dans le Gestionnaire de travaux de hello paramètres d’environnement de tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-236">You can set these in hello Job Manager task environment settings.</span></span> <span data-ttu-id="c21ea-237">Par exemple, dans un client C# :</span><span class="sxs-lookup"><span data-stu-id="c21ea-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="c21ea-238">**Informations d’identification de stockage**</span><span class="sxs-lookup"><span data-stu-id="c21ea-238">**Storage credentials**</span></span>

<span data-ttu-id="c21ea-239">En règle générale, hello client n’a pas besoin tooprovide hello stockage compte informations d’identification toohello tâche du gestionnaire, car (a) la plupart des responsables de projet n’est pas nécessaire de compte de stockage tooexplicitly accès hello lié et (b) hello compte de stockage lié est souvent fournie tâches tooall comme un paramètre d’environnement courant pour le travail de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-239">Typically, hello client does not need tooprovide hello linked storage account credentials toohello job manager task because (a) most job managers do not need tooexplicitly access hello linked storage account and (b) hello linked storage account is often provided tooall tasks as a common environment setting for hello job.</span></span> <span data-ttu-id="c21ea-240">Si vous ne fournissez pas hello lié compte de stockage via les paramètres d’environnement commun hello, le Gestionnaire de travaux hello nécessite un accès toolinked stockage, puis vous devez fournir des informations d’identification du stockage hello lié comme suit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-240">If you are not providing hello linked storage account via hello common environment settings, and hello job manager requires access toolinked storage, then you should supply hello linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="c21ea-241">**Paramètres de tâche du gestionnaire de travaux**</span><span class="sxs-lookup"><span data-stu-id="c21ea-241">**Job manager task settings**</span></span>

<span data-ttu-id="c21ea-242">client de Hello doit définir le Gestionnaire de travaux hello *killJobOnCompletion* indicateur trop**false**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-242">hello client should set hello job manager *killJobOnCompletion* flag too**false**.</span></span>

<span data-ttu-id="c21ea-243">Il est plus sûr pour hello client tooset *runExclusive* trop**false**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-243">It is usually safe for hello client tooset *runExclusive* too**false**.</span></span>

<span data-ttu-id="c21ea-244">Hello client doit utiliser un hello *resourceFiles* ou *applicationPackageReferences* collection toohave hello le Gestionnaire de travaux exécutable (et ses DLL requises) déployé toohello de nœud de calcul.</span><span class="sxs-lookup"><span data-stu-id="c21ea-244">hello client should use hello *resourceFiles* or *applicationPackageReferences* collection toohave hello job manager executable (and its required DLLs) deployed toohello compute node.</span></span>

<span data-ttu-id="c21ea-245">Par défaut, le Gestionnaire de travaux hello ne sera pas relancée en cas d’échec.</span><span class="sxs-lookup"><span data-stu-id="c21ea-245">By default, hello job manager will not be retried if it fails.</span></span> <span data-ttu-id="c21ea-246">Selon votre logique du Gestionnaire de travail, les clients hello souhaitant tentatives tooenable via *contraintes*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="c21ea-246">Depending on your job manager logic, hello client may want tooenable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="c21ea-247">**Paramètres du travail**</span><span class="sxs-lookup"><span data-stu-id="c21ea-247">**Job settings**</span></span>

<span data-ttu-id="c21ea-248">Si le séparateur de travail hello émet des tâches avec des dépendances, client de hello doit définir des tootrue usesTaskDependencies de la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-248">If hello job splitter emits tasks with dependencies, hello client must set hello job's usesTaskDependencies tootrue.</span></span>

<span data-ttu-id="c21ea-249">Dans le modèle de séparateur de travail hello, il est rare pour les clients toowish tooadd tâches toojobs au-delà le fractionnement de la tâche hello crée.</span><span class="sxs-lookup"><span data-stu-id="c21ea-249">In hello job splitter model, it is unusual for clients toowish tooadd tasks toojobs over and above what hello job splitter creates.</span></span> <span data-ttu-id="c21ea-250">client de Hello doit par conséquent normalement définie de la tâche hello *onAllTasksComplete* trop**terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-250">hello client should therefore normally set hello job's *onAllTasksComplete* too**terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="c21ea-251">Modèle du processeur de tâches</span><span class="sxs-lookup"><span data-stu-id="c21ea-251">Task Processor template</span></span>
<span data-ttu-id="c21ea-252">Un modèle de tâche vous permet de tooimplement un processeur de tâches que peut effectuer hello suit les actions suivantes :</span><span class="sxs-lookup"><span data-stu-id="c21ea-252">A Task Processor template helps you tooimplement a task processor that can perform hello following actions:</span></span>

* <span data-ttu-id="c21ea-253">Définir les informations de hello requises par chaque toorun de tâche de traitement par lots.</span><span class="sxs-lookup"><span data-stu-id="c21ea-253">Set up hello information required by each Batch task toorun.</span></span>
* <span data-ttu-id="c21ea-254">Exécuter toutes les actions requises par chaque tâche Batch.</span><span class="sxs-lookup"><span data-stu-id="c21ea-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="c21ea-255">Enregistrez les sorties de tâche toopersistent stockage.</span><span class="sxs-lookup"><span data-stu-id="c21ea-255">Save task outputs toopersistent storage.</span></span>

<span data-ttu-id="c21ea-256">Bien que le processeur de tâches n’est pas requis toorun des tâches sur le lot, hello principal avantage de l’utilisation du processeur de tâches est qu’il fournit un wrapper tooimplement toutes les actions de l’exécution de tâches dans un seul emplacement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-256">Although a task processor is not required toorun tasks on Batch, hello key advantage of using a task processor is that it provides a wrapper tooimplement all task execution actions in one location.</span></span> <span data-ttu-id="c21ea-257">Par exemple, si vous devez toorun plusieurs applications dans le contexte de hello de chaque tâche, ou si vous avez besoin de toocopy toopersistent stockage après la fin de chaque tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-257">For example, if you need toorun several applications in hello context of each task, or if you need toocopy data toopersistent storage after completing each task.</span></span>

<span data-ttu-id="c21ea-258">les actions Hello effectuées par le processeur de tâche hello peuvent être simple ou complexe et autant ou aussi peu, comme requis par votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-258">hello actions performed by hello task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="c21ea-259">En outre, en mettant en œuvre toutes les actions de tâches dans un processeur de tâches, vous pouvez facilement mettre à jour ou ajouter des actions en fonction des exigences de tooapplications ou de la charge de travail des modifications.</span><span class="sxs-lookup"><span data-stu-id="c21ea-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes tooapplications or workload requirements.</span></span> <span data-ttu-id="c21ea-260">Toutefois, dans certains cas un processeur de tâches peut-être pas idéal de hello pour votre implémentation comme il peut ajouter une complexité inutile, par exemple lors de l’exécution de travaux peut être démarré rapidement à partir d’une ligne de commande simple.</span><span class="sxs-lookup"><span data-stu-id="c21ea-260">However, in some cases a task processor might not be hello optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-hello-template"></a><span data-ttu-id="c21ea-261">Créer un processeur de tâches à l’aide du modèle de hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-261">Create a Task Processor using hello template</span></span>
<span data-ttu-id="c21ea-262">tooadd une solution de toohello de processeur de tâches que vous avez créé précédemment, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-262">tooadd a task processor toohello solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="c21ea-263">Ouvrez votre solution existante dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c21ea-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="c21ea-264">Dans l’Explorateur de solutions de hello avec le bouton droit, cliquez sur **ajouter**, puis cliquez sur **nouveau projet**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-264">In Solution Explorer, right-click hello solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="c21ea-265">Sous **Visual C#**, cliquez sur **Cloud**, puis sur **Azure Batch Task Processor** (Processeur de tâches Azure Batch).</span><span class="sxs-lookup"><span data-stu-id="c21ea-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="c21ea-266">Tapez un nom qui décrit votre application et identifie ce projet comme hello processeur de tâches (par exemple) « ProcesseurLitwareTask »).</span><span class="sxs-lookup"><span data-stu-id="c21ea-266">Type a name that describes your application and identifies this project as hello task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="c21ea-267">projet de hello toocreate, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="c21ea-267">toocreate hello project, click **OK**.</span></span>
6. <span data-ttu-id="c21ea-268">Enfin, build hello projet tooforce Visual Studio tooload tous les référencé les packages NuGet et tooverify qui hello du projet n’est valide avant de commencer à modifier.</span><span class="sxs-lookup"><span data-stu-id="c21ea-268">Finally, build hello project tooforce Visual Studio tooload all referenced NuGet packages and tooverify that hello project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="c21ea-269">Les fichiers du modèle du processeur de tâches et leur objectif</span><span class="sxs-lookup"><span data-stu-id="c21ea-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="c21ea-270">Lorsque vous créez un projet à l’aide du modèle de traitement de tâche hello, il génère trois groupes de fichiers de code :</span><span class="sxs-lookup"><span data-stu-id="c21ea-270">When you create a project using hello task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="c21ea-271">fichier de programme principal Hello (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="c21ea-271">hello main program file (Program.cs).</span></span> <span data-ttu-id="c21ea-272">Il contient le point d’entrée de programme de hello et la gestion des exceptions de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c21ea-272">This contains hello program entry point and top-level exception handling.</span></span> <span data-ttu-id="c21ea-273">Vous ne devez pas normalement besoin toomodify.</span><span class="sxs-lookup"><span data-stu-id="c21ea-273">You shouldn't normally need toomodify this.</span></span>
* <span data-ttu-id="c21ea-274">répertoire du Framework Hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-274">hello Framework directory.</span></span> <span data-ttu-id="c21ea-275">Il contient des fichiers de hello responsables hello 'standard' travailler par programme de gestionnaire de travaux hello – décompression des paramètres, ajouter des lots de tâches toohello, etc.. Vous ne devez pas normalement besoin toomodify ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="c21ea-275">This contains hello files responsible for hello 'boilerplate' work done by hello job manager program – unpacking parameters, adding tasks toohello Batch job, etc. You shouldn't normally need toomodify these files.</span></span>
* <span data-ttu-id="c21ea-276">fichier du processeur tâche Hello (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="c21ea-276">hello task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="c21ea-277">Il s’agit dans lequel vous placerez votre logique spécifique à l’application pour l’exécution d’une tâche (en général en appelant exécutable existant de tooan).</span><span class="sxs-lookup"><span data-stu-id="c21ea-277">This is where you will put your application-specific logic for executing a task (typically by calling out tooan existing executable).</span></span> <span data-ttu-id="c21ea-278">C’est aussi là que se trouve le code de pré et de post-traitement, tel que le téléchargement de données supplémentaires ou de fichiers de résultats.</span><span class="sxs-lookup"><span data-stu-id="c21ea-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="c21ea-279">Bien sûr vous pouvez ajouter des fichiers supplémentaires comme toosupport requis votre code de processeur tâche, en fonction de la complexité hello du travail hello séparation logique.</span><span class="sxs-lookup"><span data-stu-id="c21ea-279">Of course you can add additional files as required toosupport your task processor code, depending on hello complexity of hello job splitting logic.</span></span>

<span data-ttu-id="c21ea-280">modèle de Hello génère également des fichiers de projet .NET standards comme un fichier .csproj app.config, packages.config, etc..</span><span class="sxs-lookup"><span data-stu-id="c21ea-280">hello template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="c21ea-281">reste Hello de cette section décrit les différents fichiers de hello et leur structure de code et explique ce que fait chaque classe.</span><span class="sxs-lookup"><span data-stu-id="c21ea-281">hello rest of this section describes hello different files and their code structure, and explains what each class does.</span></span>

![Explorateur de solutions Visual Studio affichant des solutions de modèle de processeur de la tâche hello][solution_explorer02]

<span data-ttu-id="c21ea-283">**Fichiers Framework**</span><span class="sxs-lookup"><span data-stu-id="c21ea-283">**Framework files**</span></span>

* <span data-ttu-id="c21ea-284">`Configuration.cs`: Encapsule chargement hello travail de données de configuration telles que les détails du compte Batch, informations d’identification du compte de stockage liés, les informations de projet et la tâche et paramètres de la tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-284">`Configuration.cs`: Encapsulates hello loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="c21ea-285">Il fournit également accès aux variables d’environnement de définis par le tooBatch (voir les paramètres d’environnement pour les tâches, dans la documentation de lot hello) via la classe de Configuration.EnvironmentVariable hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-285">It also provides access tooBatch-defined environment variables (see Environment settings for tasks, in hello Batch documentation) via hello Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="c21ea-286">`IConfiguration.cs`: Résumés hello implémentation de classe de Configuration de hello, afin que vous puissiez de test unitaire votre séparateur de travail à l’aide d’un objet de configuration faux ou fictive.</span><span class="sxs-lookup"><span data-stu-id="c21ea-286">`IConfiguration.cs`: Abstracts hello implementation of hello Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="c21ea-287">`TaskProcessorException.cs`Représente une erreur qui nécessite hello travail manager tooterminate.</span><span class="sxs-lookup"><span data-stu-id="c21ea-287">`TaskProcessorException.cs`: Represents an error that requires hello job manager tooterminate.</span></span> <span data-ttu-id="c21ea-288">TaskProcessorException est utilisé toowrap les erreurs 'attendu' où les informations de diagnostic spécifiques peuvent être fournies dans le cadre de l’arrêt.</span><span class="sxs-lookup"><span data-stu-id="c21ea-288">TaskProcessorException is used toowrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="c21ea-289">**Processeur de tâches**</span><span class="sxs-lookup"><span data-stu-id="c21ea-289">**Task Processor**</span></span>

* <span data-ttu-id="c21ea-290">`TaskProcessor.cs`: Exécute la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-290">`TaskProcessor.cs`: Runs hello task.</span></span> <span data-ttu-id="c21ea-291">framework de Hello appelle la méthode TaskProcessor.Run de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-291">hello framework invokes hello TaskProcessor.Run method.</span></span> <span data-ttu-id="c21ea-292">Il s’agit d’hello classe où vous serez injecter la logique de spécifiques à l’application de hello de votre tâche.</span><span class="sxs-lookup"><span data-stu-id="c21ea-292">This is hello class where you will inject hello application-specific logic of your task.</span></span> <span data-ttu-id="c21ea-293">Implémentez la méthode Run hello :</span><span class="sxs-lookup"><span data-stu-id="c21ea-293">Implement hello Run method to:</span></span>
  * <span data-ttu-id="c21ea-294">Analyser et valider les paramètres de n’importe quelle tâche</span><span class="sxs-lookup"><span data-stu-id="c21ea-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="c21ea-295">Composer la ligne de commande hello pour n’importe quel programme externe, vous souhaitez tooinvoke</span><span class="sxs-lookup"><span data-stu-id="c21ea-295">Compose hello command line for any external program you want tooinvoke</span></span>
  * <span data-ttu-id="c21ea-296">Enregistrer des informations de diagnostic qui peuvent vous être utiles pour le débogage</span><span class="sxs-lookup"><span data-stu-id="c21ea-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="c21ea-297">Démarrer un processus à l’aide de cette ligne de commande</span><span class="sxs-lookup"><span data-stu-id="c21ea-297">Start a process using that command line</span></span>
  * <span data-ttu-id="c21ea-298">Attendez que hello processus tooexit</span><span class="sxs-lookup"><span data-stu-id="c21ea-298">Wait for hello process tooexit</span></span>
  * <span data-ttu-id="c21ea-299">Capturer le code de sortie hello hello processus toodetermine si elle a réussi ou a échoué</span><span class="sxs-lookup"><span data-stu-id="c21ea-299">Capture hello exit code of hello process toodetermine if it succeeded or failed</span></span>
  * <span data-ttu-id="c21ea-300">Enregistrer tous les fichiers de sortie que vous souhaitez tookeep toopersistent stockage</span><span class="sxs-lookup"><span data-stu-id="c21ea-300">Save any output files you want tookeep toopersistent storage</span></span>

<span data-ttu-id="c21ea-301">**Fichiers de projet de ligne de commande .NET standard**</span><span class="sxs-lookup"><span data-stu-id="c21ea-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="c21ea-302">`App.config`: Fichier de configuration d’application .NET standard.</span><span class="sxs-lookup"><span data-stu-id="c21ea-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="c21ea-303">`Packages.config`: Fichier de dépendance de package NuGet standard.</span><span class="sxs-lookup"><span data-stu-id="c21ea-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="c21ea-304">`Program.cs`: Contient le point d’entrée de programme de hello et la gestion des exceptions de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="c21ea-304">`Program.cs`: Contains hello program entry point and top-level exception handling.</span></span>

## <a name="implementing-hello-task-processor"></a><span data-ttu-id="c21ea-305">Implémentation du processeur de tâches hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-305">Implementing hello task processor</span></span>
<span data-ttu-id="c21ea-306">Lorsque vous ouvrez le projet de modèle de processeur de tâches hello, hello projet possède fichier TaskProcessor.cs de hello ouverte par défaut.</span><span class="sxs-lookup"><span data-stu-id="c21ea-306">When you open hello Task Processor template project, hello project will have hello TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="c21ea-307">Vous pouvez implémenter la logique hello exécuter des tâches de hello dans votre charge de travail à l’aide de méthode de Run() hello indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="c21ea-307">You can implement hello run logic for hello tasks in your workload by using hello Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs hello task processing logic. This is where you inject
/// your application-specific logic for decomposing hello job into tasks.
///
/// hello task processor framework invokes hello Run method for you; you need
/// only tooimplement it, not toocall it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check hello exit code of that program and
/// save output files toopersistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for hello task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="c21ea-308">Hello annotée section hello méthode Run() est section uniquement de hello hello processeur de tâches du code de modèle qui est destiné à vous toomodify en ajoutant une logique pour les tâches de hello hello exécuter dans votre charge de travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-308">hello annotated section in hello Run() method is hello only section of hello Task Processor template code that is intended for you toomodify by adding hello run logic for hello tasks in your workload.</span></span> <span data-ttu-id="c21ea-309">Si vous souhaitez toomodify une autre section du modèle de hello, Veuillez tout d’abord Familiarisez-vous avec le fonctionnement de lot en consultant la documentation du lot hello et essayer de quelques exemples de code de lot hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-309">If you want toomodify a different section of hello template, please first familiarize yourself with how Batch works by reviewing hello Batch documentation and trying out a few of hello Batch code samples.</span></span>
> 
> 

<span data-ttu-id="c21ea-310">Hello méthode Run() est chargé de lancer la ligne de commande hello, à partir d’un ou plusieurs processus, en attente pour tous les processus toocomplete, l’enregistrement des résultats de hello et enfin retour avec un code de sortie.</span><span class="sxs-lookup"><span data-stu-id="c21ea-310">hello Run() method is responsible for launching hello command line, starting one or more processes, waiting for all process toocomplete, saving hello results, and finally returning with an exit code.</span></span> <span data-ttu-id="c21ea-311">Hello méthode Run() est où vous implémentez hello logique pour vos tâches de traitement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-311">hello Run() method is where you implement hello processing logic for your tasks.</span></span> <span data-ttu-id="c21ea-312">infrastructure de processeur Hello tâches appelle la méthode de Run() de hello pour vous. vous n’avez pas besoin de toocall il vous-même.</span><span class="sxs-lookup"><span data-stu-id="c21ea-312">hello task processor framework invokes hello Run() method for you; you do not need toocall it yourself.</span></span>

<span data-ttu-id="c21ea-313">Votre implémentation Run() a accès :</span><span class="sxs-lookup"><span data-stu-id="c21ea-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="c21ea-314">Hello des paramètres de la tâche via hello `_parameters` champ.</span><span class="sxs-lookup"><span data-stu-id="c21ea-314">hello task parameters, via hello `_parameters` field.</span></span>
* <span data-ttu-id="c21ea-315">Hello ID de projet et la tâche via hello `_jobId` et `_taskId` champs.</span><span class="sxs-lookup"><span data-stu-id="c21ea-315">hello job and task ids, via hello `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="c21ea-316">configuration de la tâche Hello, via hello `_configuration` champ.</span><span class="sxs-lookup"><span data-stu-id="c21ea-316">hello task configuration, via hello `_configuration` field.</span></span>

<span data-ttu-id="c21ea-317">**Échec de la tâche**</span><span class="sxs-lookup"><span data-stu-id="c21ea-317">**Task failure**</span></span>

<span data-ttu-id="c21ea-318">En cas de défaillance, vous pouvez quitter la méthode Run() de hello en levant une exception, mais cela laisse un gestionnaire d’exceptions de niveau supérieur hello dans le contrôle de code de sortie de tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-318">In case of failure, you can exit hello Run() method by throwing an exception, but this leaves hello top level exception handler in control of hello task exit code.</span></span> <span data-ttu-id="c21ea-319">Si vous avez besoin de code de sortie hello toocontrol afin que vous pouvez distinguer les différents types d’échec, par exemple pour établir un diagnostic ou parce que certains modes d’échec doivent s’arrêter les travaux hello et autres ne doivent pas, puis vous devez quitter la méthode Run() de hello en retournant un code de sortie différent de zéro.</span><span class="sxs-lookup"><span data-stu-id="c21ea-319">If you need toocontrol hello exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate hello job and others should not, then you should exit hello Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="c21ea-320">Cela devient le code de sortie de tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-320">This becomes hello task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-hello-task-processor-template"></a><span data-ttu-id="c21ea-321">Quitter les codes et les exceptions dans le modèle de processeur de la tâche hello</span><span class="sxs-lookup"><span data-stu-id="c21ea-321">Exit codes and exceptions in hello Task Processor template</span></span>
<span data-ttu-id="c21ea-322">Codes de sortie et les exceptions fournissent un résultat de hello toodetermine mécanisme d’exécution d’un programme, et elles peuvent aider à identifier les problèmes avec l’exécution de hello du programme de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-322">Exit codes and exceptions provide a mechanism toodetermine hello outcome of running a program, and they can help identify any problems with hello execution of hello program.</span></span> <span data-ttu-id="c21ea-323">modèle de processeur de tâches Hello implémente les codes de sortie hello et exceptions décrites dans cette section.</span><span class="sxs-lookup"><span data-stu-id="c21ea-323">hello Task Processor template implements hello exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="c21ea-324">Une tâche de processeur qui est implémentée avec un modèle de tâche hello peut retourner trois codes de sortie possibles :</span><span class="sxs-lookup"><span data-stu-id="c21ea-324">A task processor task that is implemented with hello Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="c21ea-325">Code</span><span class="sxs-lookup"><span data-stu-id="c21ea-325">Code</span></span> | <span data-ttu-id="c21ea-326">Description</span><span class="sxs-lookup"><span data-stu-id="c21ea-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="c21ea-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="c21ea-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="c21ea-328">processeur de tâches Hello toocompletion s’est produite.</span><span class="sxs-lookup"><span data-stu-id="c21ea-328">hello task processor ran toocompletion.</span></span> <span data-ttu-id="c21ea-329">Notez que cela ne signifie pas ce programme hello que l’appel a réussi : uniquement ce processeur de la tâche hello a été appelée et effectuer tout traitement sans exceptions.</span><span class="sxs-lookup"><span data-stu-id="c21ea-329">Note that this does not imply that hello program you invoked was successful – only that hello task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="c21ea-330">sens de Hello du code de sortie hello dépend de programme de hello appelé : en général, le code de sortie 0 signifie a réussi le programme de hello et tout autre code de sortie signifie que le programme hello a échoué.</span><span class="sxs-lookup"><span data-stu-id="c21ea-330">hello meaning of hello exit code depends on hello invoked program – typically exit code 0 means hello program succeeded and any other exit code means hello program failed.</span></span> |
| <span data-ttu-id="c21ea-331">1</span><span class="sxs-lookup"><span data-stu-id="c21ea-331">1</span></span> |<span data-ttu-id="c21ea-332">processeur de tâches Hello a échoué avec une exception dans une partie 'attendue' du programme de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-332">hello task processor failed with an exception in an 'expected' part of hello program.</span></span> <span data-ttu-id="c21ea-333">Hello exception a été traduit tooa `TaskProcessorException` avec des informations de diagnostic et, si possible, des suggestions de résolution hello échec.</span><span class="sxs-lookup"><span data-stu-id="c21ea-333">hello exception was translated tooa `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving hello failure.</span></span> |
| <span data-ttu-id="c21ea-334">2</span><span class="sxs-lookup"><span data-stu-id="c21ea-334">2</span></span> |<span data-ttu-id="c21ea-335">processeur de tâches Hello a échoué avec une exception « inattendue ».</span><span class="sxs-lookup"><span data-stu-id="c21ea-335">hello task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="c21ea-336">exception Hello était connecté toostandard de sortie, mais processeur de tâches hello tooadd Impossible de toutes les informations de diagnostic ou de mise à jour supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="c21ea-336">hello exception was logged toostandard output, but hello task processor was unable tooadd any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="c21ea-337">Si le programme hello que vous appelez utilise des modes d’échec spécifique tooindicate exit codes 1 et 2, puis à l’aide de codes de sortie 1 et 2 pour les erreurs de processeur de tâche est ambigu.</span><span class="sxs-lookup"><span data-stu-id="c21ea-337">If hello program you invoke uses exit codes 1 and 2 tooindicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="c21ea-338">Vous pouvez modifier ces codes de sortie de tâche processeur erreur codes toodistinctive en modifiant les cas d’exception hello dans le fichier Program.cs de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-338">You can change these task processor error codes toodistinctive exit codes by editing hello exception cases in hello Program.cs file.</span></span>
> 
> 

<span data-ttu-id="c21ea-339">Toutes les informations de hello retournées par les exceptions sont écrites dans les fichiers stdout.txt et stderr.txt.</span><span class="sxs-lookup"><span data-stu-id="c21ea-339">All hello information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="c21ea-340">Pour plus d’informations, voir gestion d’erreurs, Bonjour documentation du lot.</span><span class="sxs-lookup"><span data-stu-id="c21ea-340">For more information, see Error Handling, in hello Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="c21ea-341">Considérations du client</span><span class="sxs-lookup"><span data-stu-id="c21ea-341">Client considerations</span></span>
<span data-ttu-id="c21ea-342">**Informations d’identification de stockage**</span><span class="sxs-lookup"><span data-stu-id="c21ea-342">**Storage credentials**</span></span>

<span data-ttu-id="c21ea-343">Si votre processeur de tâches utilise des sorties de toopersist de stockage blob Azure, par exemple à l’aide de la bibliothèque d’assistance de hello fichier conventions, puis il a besoin d’accéder trop*soit* hello des informations d’identification de compte de stockage cloud *ou* une URL de conteneur d’objets blob qui inclut une signature d’accès partagé (SAS).</span><span class="sxs-lookup"><span data-stu-id="c21ea-343">If your task processor uses Azure blob storage toopersist outputs, for example using hello file conventions helper library, then it needs access too*either* hello cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="c21ea-344">modèle de Hello prend en charge en fournissant des informations d’identification via des variables d’environnement courantes.</span><span class="sxs-lookup"><span data-stu-id="c21ea-344">hello template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="c21ea-345">Votre client peut transmettre des informations d’identification du stockage hello comme suit :</span><span class="sxs-lookup"><span data-stu-id="c21ea-345">Your client can pass hello storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="c21ea-346">compte de stockage Hello est ensuite disponible dans hello classe TaskProcessor via hello `_configuration.StorageAccount` propriété.</span><span class="sxs-lookup"><span data-stu-id="c21ea-346">hello storage account is then available in hello TaskProcessor class via hello `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="c21ea-347">Si vous préférez toouse une URL de conteneur de SAP, vous pouvez également passer ce via un paramètre d’environnement courantes de travail, mais les modèle de traitement de tâche hello n’inclut pas actuellement prise en charge intégrée pour ce.</span><span class="sxs-lookup"><span data-stu-id="c21ea-347">If you prefer toouse a container URL with SAS, you can also pass this via an job common environment setting, but hello task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="c21ea-348">**Paramétrage du stockage**</span><span class="sxs-lookup"><span data-stu-id="c21ea-348">**Storage setup**</span></span>

<span data-ttu-id="c21ea-349">Il est recommandé de cette tâche de gestionnaire de client ou de la tâche hello créer n’importe quel conteneur requis par les tâches avant d’ajouter le travail de toohello tâches hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-349">It is recommended that hello client or job manager task create any containers required by tasks before adding hello tasks toohello job.</span></span> <span data-ttu-id="c21ea-350">Ce champ est obligatoire que si vous utilisez une URL de conteneur de SAP, par conséquent une URL n’inclut pas autorisation toocreate hello conteneur.</span><span class="sxs-lookup"><span data-stu-id="c21ea-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission toocreate hello container.</span></span> <span data-ttu-id="c21ea-351">Il est recommandé de même si vous transmettez des informations d’identification du compte de stockage, qu’il enregistre toutes les tâches ayant toocall CloudBlobContainer.CreateIfNotExistsAsync sur le conteneur de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-351">It is recommended even if you pass storage account credentials, as it saves every task having toocall CloudBlobContainer.CreateIfNotExistsAsync on hello container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="c21ea-352">Transmettre des paramètres et des variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="c21ea-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="c21ea-353">Transmettre des paramètres d’environnement</span><span class="sxs-lookup"><span data-stu-id="c21ea-353">Pass environment settings</span></span>
<span data-ttu-id="c21ea-354">Un client peut transmettre des informations toohello tâche du gestionnaire sous forme de hello de paramètres d’environnement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-354">A client can pass information toohello job manager task in hello form of environment settings.</span></span> <span data-ttu-id="c21ea-355">Ces informations peuvent ensuite être utilisées par la tâche du gestionnaire hello lors de la tâche de calcul de génération tâches processeur hello tâche qui seront exécute dans le cadre de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-355">This information can then be used by hello job manager task when generating hello task processor tasks that will run as part of hello compute job.</span></span> <span data-ttu-id="c21ea-356">Exemples d’informations hello que vous pouvez passer en tant que paramètres d’environnement sont :</span><span class="sxs-lookup"><span data-stu-id="c21ea-356">Examples of hello information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="c21ea-357">Clés d’accès et nom du compte de stockage</span><span class="sxs-lookup"><span data-stu-id="c21ea-357">Storage account name and account keys</span></span>
* <span data-ttu-id="c21ea-358">URL du compte Batch</span><span class="sxs-lookup"><span data-stu-id="c21ea-358">Batch account URL</span></span>
* <span data-ttu-id="c21ea-359">Clé du compte Batch</span><span class="sxs-lookup"><span data-stu-id="c21ea-359">Batch account key</span></span>

<span data-ttu-id="c21ea-360">Hello service Batch possède une mécanisme simple toopass environnement paramètres tooa tâche du gestionnaire à l’aide de hello `EnvironmentSettings` propriété dans [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="c21ea-360">hello Batch service has a simple mechanism toopass environment settings tooa job manager task by using hello `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="c21ea-361">Par exemple, tooget hello `BatchClient` instance pour un compte de traitement par lots, vous pouvez passer comme variables d’environnement à partir du client de hello code hello URL et partagé des informations d’identification de clé pour le compte de traitement par lots hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-361">For example, tooget hello `BatchClient` instance for a Batch account, you can pass as environment variables from hello client code hello URL and shared key credentials for hello Batch account.</span></span> <span data-ttu-id="c21ea-362">De même, compte de stockage tooaccess hello est lié toohello du compte Batch, vous pouvez passer le nom de compte de stockage hello et clé de compte de stockage hello en tant que variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="c21ea-362">Likewise, tooaccess hello storage account that is linked toohello Batch account, you can pass hello storage account name and hello storage account key as environment variables.</span></span>

### <a name="pass-parameters-toohello-job-manager-template"></a><span data-ttu-id="c21ea-363">Passez le modèle de gestionnaire de travaux toohello de paramètres</span><span class="sxs-lookup"><span data-stu-id="c21ea-363">Pass parameters toohello Job Manager template</span></span>
<span data-ttu-id="c21ea-364">Dans de nombreux cas, il est utile toopass par travail paramètres toohello tâche du gestionnaire, des travaux hello toocontrol divisant processus ou tâches hello tooconfigure hello travail.</span><span class="sxs-lookup"><span data-stu-id="c21ea-364">In many cases, it's useful toopass per-job parameters toohello job manager task, either toocontrol hello job splitting process or tooconfigure hello tasks for hello job.</span></span> <span data-ttu-id="c21ea-365">Pour cela, en téléchargeant un fichier JSON nommé parameters.json comme fichier de ressources pour la tâche du gestionnaire hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-365">You can do this by uploading a JSON file named parameters.json as a resource file for hello job manager task.</span></span> <span data-ttu-id="c21ea-366">paramètres de Hello peuvent ensuite devenir disponibles Bonjour `JobSplitter._parameters` champ dans le modèle de gestionnaire de travaux hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-366">hello parameters can then become available in hello `JobSplitter._parameters` field in hello Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="c21ea-367">Gestionnaire de paramètres prédéfinis de Hello prend en charge uniquement les dictionnaires de chaîne en chaîne.</span><span class="sxs-lookup"><span data-stu-id="c21ea-367">hello built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="c21ea-368">Si vous souhaitez que les valeurs JSON complexes toopass comme valeurs de paramètre, serez toopass ces sous forme de chaînes et les analyser dans un fractionnement de tâche hello ou que vous modifiez du framework hello `Configuration.GetJobParameters` (méthode).</span><span class="sxs-lookup"><span data-stu-id="c21ea-368">If you want toopass complex JSON values as parameter values, you will need toopass these as strings and parse them in hello job splitter, or modify hello framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-toohello-task-processor-template"></a><span data-ttu-id="c21ea-369">Passer des paramètres toohello tâche modèle de traitement</span><span class="sxs-lookup"><span data-stu-id="c21ea-369">Pass parameters toohello Task Processor template</span></span>
<span data-ttu-id="c21ea-370">Vous pouvez également transmettre des paramètres tooindividual tâches implémentée à l’aide du modèle de tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-370">You can also pass parameters tooindividual tasks implemented using hello Task Processor template.</span></span> <span data-ttu-id="c21ea-371">Tout comme avec le modèle de gestionnaire de tâche hello, modèle de traitement de tâche hello recherche un fichier de ressources nommé</span><span class="sxs-lookup"><span data-stu-id="c21ea-371">Just as with hello job manager template, hello task processor template looks for a resource file named</span></span>

<span data-ttu-id="c21ea-372">Parameters.JSON et s’il a déterminé qu’il charge en tant que dictionnaire de paramètres hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-372">parameters.json, and if found it loads it as hello parameters dictionary.</span></span> <span data-ttu-id="c21ea-373">Il existe deux options pour la toopass paramètres toohello tâches processeur de tâches :</span><span class="sxs-lookup"><span data-stu-id="c21ea-373">There are a couple of options for how toopass parameters toohello task processor tasks:</span></span>

* <span data-ttu-id="c21ea-374">Réutiliser les paramètres de la tâche hello JSON.</span><span class="sxs-lookup"><span data-stu-id="c21ea-374">Reuse hello job parameters JSON.</span></span> <span data-ttu-id="c21ea-375">Cela fonctionne bien si seuls les paramètres hello sont ceux qui sont à l’échelle de la tâche (par exemple, un rendu hauteur et largeur).</span><span class="sxs-lookup"><span data-stu-id="c21ea-375">This works well if hello only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="c21ea-376">toodo, lors de la création d’un CloudTask de fractionnement de tâche hello, ajouter un objet de fichier de référence toohello parameters.json resource de ResourceFiles de hello tâche du gestionnaire (`JobSplitter._jobManagerTask.ResourceFiles`) collecte des ResourceFiles de toohello CloudTask.</span><span class="sxs-lookup"><span data-stu-id="c21ea-376">toodo this, when creating a CloudTask in hello job splitter, add a reference toohello parameters.json resource file object from hello job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) toohello CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="c21ea-377">Générer et télécharger un document parameters.json de tâches spécifiques dans le cadre de l’exécution du travail fractionnées et faire référence à cet objet blob dans la collection de fichiers de ressources de la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in hello task's resource files collection.</span></span> <span data-ttu-id="c21ea-378">Cela est nécessaire si des tâches différentes ont des paramètres différents.</span><span class="sxs-lookup"><span data-stu-id="c21ea-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="c21ea-379">Un exemple peut être un scénario de rendu 3D dans lequel les index de trame hello est passé toohello tâche en tant que paramètre.</span><span class="sxs-lookup"><span data-stu-id="c21ea-379">An example might be a 3D rendering scenario where hello frame index is passed toohello task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="c21ea-380">Gestionnaire de paramètres prédéfinis de Hello prend en charge uniquement les dictionnaires de chaîne en chaîne.</span><span class="sxs-lookup"><span data-stu-id="c21ea-380">hello built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="c21ea-381">Si vous souhaitez que les valeurs JSON complexes toopass comme valeurs de paramètre, serez toopass ces sous forme de chaînes et les analyser dans le processeur de tâche hello ou que vous modifiez du framework hello `Configuration.GetTaskParameters` (méthode).</span><span class="sxs-lookup"><span data-stu-id="c21ea-381">If you want toopass complex JSON values as parameter values, you will need toopass these as strings and parse them in hello task processor, or modify hello framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="c21ea-382">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="c21ea-382">Next steps</span></span>
### <a name="persist-job-and-task-output-tooazure-storage"></a><span data-ttu-id="c21ea-383">Conserver les travaux et les tâches de sortie tooAzure stockage</span><span class="sxs-lookup"><span data-stu-id="c21ea-383">Persist job and task output tooAzure Storage</span></span>
<span data-ttu-id="c21ea-384">Les [conventions de fichiers Azure Batch][nuget_package] sont également utiles au développement de solutions Batch.</span><span class="sxs-lookup"><span data-stu-id="c21ea-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="c21ea-385">Utilisez cette bibliothèque de classes .NET (actuellement en version préliminaire) dans votre magasin de tooeasily d’applications .NET de lot et récupérer des tooand des sorties de tâche depuis le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="c21ea-385">Use this .NET class library (currently in preview) in your Batch .NET applications tooeasily store and retrieve task outputs tooand from Azure Storage.</span></span> <span data-ttu-id="c21ea-386">[Conserver la sortie de projet et la tâche de traitement par lots Azure](batch-task-output.md) contient une description complète de la bibliothèque de hello et son utilisation.</span><span class="sxs-lookup"><span data-stu-id="c21ea-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of hello library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="c21ea-387">Forum Azure Batch</span><span class="sxs-lookup"><span data-stu-id="c21ea-387">Batch Forum</span></span>
<span data-ttu-id="c21ea-388">Hello [Forum de traitement par lots Azure] [ forum] sur MSDN est une bonne placer toodiscuss lot et poser des questions sur le service de hello.</span><span class="sxs-lookup"><span data-stu-id="c21ea-388">hello [Azure Batch Forum][forum] on MSDN is a great place toodiscuss Batch and ask questions about hello service.</span></span> <span data-ttu-id="c21ea-389">Consultez le forum pour obtenir des publications « permanentes » utiles et publiez les questions que vous vous posez pendant la création de vos solutions Batch.</span><span class="sxs-lookup"><span data-stu-id="c21ea-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
