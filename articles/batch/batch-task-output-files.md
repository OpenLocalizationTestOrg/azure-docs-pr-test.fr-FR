---
title: "aaaPersist projet et la tâche de sortie tooAzure stockage avec hello API de service de traitement par lots Azure | Documents Microsoft"
description: "Découvrez comment des tooAzure stockage de sortie de projet et la tâche de traitement par lots toopersist toouse API de service de traitement par lots."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="fb387-103">Conserver des tâches données tooAzure stockage avec hello API de service de traitement par lots</span><span class="sxs-lookup"><span data-stu-id="fb387-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="fb387-104">Depuis la version 2017-05-01, hello API de service de traitement par lots prend en charge la persistance tooAzure de données de sortie stockage pour les tâches et le Gestionnaire des tâches qui s’exécutent sur les pools de configuration d’ordinateur virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="fb387-105">Lorsque vous ajoutez une tâche, vous pouvez spécifier un conteneur dans le stockage Azure en tant que destination hello pour la sortie de la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="fb387-106">service de traitement par lots Hello écrit ensuite n’importe quel conteneur de toothat de données de sortie lors de la tâche hello est terminée.</span><span class="sxs-lookup"><span data-stu-id="fb387-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="fb387-107">Un hello de toousing parti par lots de la sortie de la tâche service API toopersist est que vous n’avez pas besoin d’application hello toomodify hello tâche est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="fb387-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="fb387-108">Au lieu de cela, avec une application cliente quelques modifications simples tooyour, vous pouvez conserver la sortie de la tâche hello de code hello qui crée la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="fb387-109">Quand utiliser le résultat de la tâche toopersist hello API de lot ?</span><span class="sxs-lookup"><span data-stu-id="fb387-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="fb387-110">Traitement par lots Azure fournit plusieurs méthodes toopersist sortie de la tâche.</span><span class="sxs-lookup"><span data-stu-id="fb387-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="fb387-111">À l’aide de hello API de service de traitement par lots est une approche pratique est meilleure toothese adapté aux scénarios :</span><span class="sxs-lookup"><span data-stu-id="fb387-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="fb387-112">Vous souhaitez sortie de tâche toowrite code toopersist d’au sein de votre application cliente, sans modifier l’application hello votre tâche est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="fb387-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="fb387-113">Vous souhaitez toopersist de la sortie des tâches de traitement par lots et le gestionnaire tâches dans des pools créés avec la configuration d’ordinateur virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="fb387-114">Vous souhaitez que le conteneur de stockage Azure tooan toopersist sortie avec un nom quelconque.</span><span class="sxs-lookup"><span data-stu-id="fb387-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="fb387-115">Vous souhaitez que le conteneur de stockage Azure toopersist sortie tooan nommé toohello conformément [standard de Conventions pour les fichiers Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="fb387-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="fb387-116">Si votre scénario diffère de celles répertoriées ci-dessus, vous devrez peut-être tooconsider une approche différente.</span><span class="sxs-lookup"><span data-stu-id="fb387-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="fb387-117">Par exemple, API de lot hello ne prend pas en charge tooAzure de sortie en continu stockage pendant l’exécution de la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="fb387-118">toostream de sortie, envisagez d’utiliser la bibliothèque Conventions pour les fichiers Batch pour .NET hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="fb387-119">Pour d’autres langues, vous devez tooimplement votre propre solution.</span><span class="sxs-lookup"><span data-stu-id="fb387-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="fb387-120">Pour plus d’informations sur les autres options pour la sortie de tâche persistantes, consultez [tooAzure stockage de sortie de projet de la persistance et la tâche](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="fb387-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="fb387-121">Créer un conteneur dans le stockage Azure</span><span class="sxs-lookup"><span data-stu-id="fb387-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="fb387-122">sortie de la tâche de toopersist tooAzure de stockage, vous devez toocreate un conteneur qui sert de destination hello pour vos fichiers de sortie.</span><span class="sxs-lookup"><span data-stu-id="fb387-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="fb387-123">Créer le conteneur de hello avant d’exécuter la tâche, de préférence avant d’envoyer votre travail.</span><span class="sxs-lookup"><span data-stu-id="fb387-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="fb387-124">conteneur de hello toocreate, utilisez hello approprié Azure Storage client library ou kit de développement logiciel.</span><span class="sxs-lookup"><span data-stu-id="fb387-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="fb387-125">Pour plus d’informations sur les API de stockage Azure, consultez hello [documentation Azure Storage](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="fb387-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="fb387-126">Par exemple, si vous écrivez votre application en c#, utilisez hello [bibliothèque cliente de stockage Azure pour .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="fb387-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="fb387-127">Hello suivant montre l’exemple de comment toocreate un conteneur :</span><span class="sxs-lookup"><span data-stu-id="fb387-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="fb387-128">Obtenir une signature d’accès partagé pour le conteneur de hello</span><span class="sxs-lookup"><span data-stu-id="fb387-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="fb387-129">Après avoir créé le conteneur de hello, obtenir une signature d’accès partagé (SAS) avec un accès en écriture toohello conteneur.</span><span class="sxs-lookup"><span data-stu-id="fb387-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="fb387-130">Une SAP fournit un conteneur de toohello accès délégué.</span><span class="sxs-lookup"><span data-stu-id="fb387-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="fb387-131">Hello SAP accorde un accès avec un jeu spécifié d’autorisations et sur un intervalle de temps spécifié.</span><span class="sxs-lookup"><span data-stu-id="fb387-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="fb387-132">Hello service Batch doit une SAP de conteneur de toohello écriture autorisations toowrite tâche sortie.</span><span class="sxs-lookup"><span data-stu-id="fb387-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="fb387-133">Pour plus d’informations sur les signatures d’accès partagé, consultez [Utilisation des signatures d’accès partagé \(SAP\) dans le stockage Azure](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="fb387-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="fb387-134">Lorsque vous obtenez une SAP à l’aide des API de stockage Azure de hello, hello API renvoie une chaîne de jeton SAS.</span><span class="sxs-lookup"><span data-stu-id="fb387-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="fb387-135">Cette chaîne de jeton inclut tous les paramètres de hello SAP, y compris les autorisations de hello et intervalle de salutation pendant le hello SAS est valide.</span><span class="sxs-lookup"><span data-stu-id="fb387-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="fb387-136">toouse hello SAS tooaccess un conteneur dans le stockage Azure, vous devez les URI de ressource de toohello de chaîne de jeton SAS de tooappend hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="fb387-137">Hello URI de ressource, ainsi que de hello ajouté de jeton SAS, fournit un accès authentifié tooAzure stockage.</span><span class="sxs-lookup"><span data-stu-id="fb387-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="fb387-138">Hello exemple suivant montre comment la chaîne pour le conteneur de hello du jeton tooget un SAS en écriture seule, puis ajoute l’URI du conteneur toohello hello SAS :</span><span class="sxs-lookup"><span data-stu-id="fb387-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="fb387-139">Spécifier les fichiers de sortie pour le résultat de la tâche</span><span class="sxs-lookup"><span data-stu-id="fb387-139">Specify output files for task output</span></span>

<span data-ttu-id="fb387-140">toospecify des fichiers de sortie d’une tâche, créer une collection de [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) des objets et affecter toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) propriété lorsque vous créez la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="fb387-141">exemple de code .NET Hello crée une tâche qui écrit le fichier tooa de nombres aléatoires nommé `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="fb387-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="fb387-142">exemple de Hello crée un fichier de sortie pour `output.txt` toobe écrit toohello conteneur.</span><span class="sxs-lookup"><span data-stu-id="fb387-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="fb387-143">exemple de Hello crée également des fichiers de sortie pour les fichiers journaux qui correspondent au modèle de fichier hello `std*.txt` (_par exemple,_, `stdout.txt` et `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="fb387-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="fb387-144">URL du conteneur Hello requiert hello SAS qui a été créé précédemment pour le conteneur de hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="fb387-145">Hello service Batch utilise le conteneur toohello accès hello SAS tooauthenticate :</span><span class="sxs-lookup"><span data-stu-id="fb387-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="fb387-146">Spécifier un modèle de fichier pour la correspondance</span><span class="sxs-lookup"><span data-stu-id="fb387-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="fb387-147">Lorsque vous spécifiez un fichier de sortie, vous pouvez utiliser hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) propriété toospecify un modèle de fichier pour la correspondance.</span><span class="sxs-lookup"><span data-stu-id="fb387-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="fb387-148">modèle de fichier Hello peut correspondent aux fichiers de zéro, un seul fichier ou un ensemble de fichiers qui sont créés par la tâche hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="fb387-149">Hello **FilePattern** propriété prend en charge les caractères génériques de système de fichiers standard telles que `*` (pour non récursives correspond à) et `**` (pour récursive correspond à).</span><span class="sxs-lookup"><span data-stu-id="fb387-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="fb387-150">Par exemple, exemple de code hello ci-dessus spécifie hello fichier modèle toomatch `std*.txt` de manière non récursive :</span><span class="sxs-lookup"><span data-stu-id="fb387-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="fb387-151">tooupload un seul fichier, spécifiez un modèle de fichier sans caractères génériques.</span><span class="sxs-lookup"><span data-stu-id="fb387-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="fb387-152">Par exemple, exemple de code hello ci-dessus spécifie hello fichier modèle toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="fb387-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="fb387-153">Spécifier une condition de chargement</span><span class="sxs-lookup"><span data-stu-id="fb387-153">Specify an upload condition</span></span>

<span data-ttu-id="fb387-154">Hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) propriété autorise conditionnelle de téléchargement des fichiers de sortie.</span><span class="sxs-lookup"><span data-stu-id="fb387-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="fb387-155">Un scénario courant consiste à tooupload un ensemble de fichiers si la tâche hello réussit et un autre ensemble de fichiers en cas d’échec.</span><span class="sxs-lookup"><span data-stu-id="fb387-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="fb387-156">Par exemple, vous souhaiterez des fichiers journaux détaillés tooupload uniquement lorsque la tâche hello échoue et se termine avec un code de sortie différent de zéro.</span><span class="sxs-lookup"><span data-stu-id="fb387-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="fb387-157">De même, vous pouvez choisir les fichiers de résultats tooupload uniquement si la tâche hello réussit, que ces fichiers peuvent être manquantes ou incomplètes si hello tâche échoue.</span><span class="sxs-lookup"><span data-stu-id="fb387-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="fb387-158">exemple de code ci-dessus Hello définit hello **UploadCondition** propriété trop**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="fb387-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="fb387-159">Ce paramètre spécifie que si le fichier hello est toobe téléchargé une fois les tâches hello terminée, quelle que soit la valeur hello du code de sortie hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="fb387-160">Pour les autres paramètres, consultez hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span><span class="sxs-lookup"><span data-stu-id="fb387-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="fb387-161">Lever l’ambiguïté de fichiers avec hello même nom</span><span class="sxs-lookup"><span data-stu-id="fb387-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="fb387-162">tâches Hello dans un travail peuvent produire des fichiers qui ont hello même nom.</span><span class="sxs-lookup"><span data-stu-id="fb387-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="fb387-163">Par exemple, `stdout.txt` et `stderr.txt` sont créés pour chaque tâche qui s’exécute dans un travail.</span><span class="sxs-lookup"><span data-stu-id="fb387-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="fb387-164">Étant donné que chaque tâche s’exécute dans son propre contexte, ces fichiers ne sont en conflit sur le système de fichiers du nœud hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="fb387-165">Toutefois, lorsque vous téléchargez des fichiers à partir de plusieurs conteneurs partagé tooa de tâches, vous devez les fichiers toodisambiguate avec hello même nom.</span><span class="sxs-lookup"><span data-stu-id="fb387-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="fb387-166">Hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) propriété spécifie l’objet blob de destination hello ou un répertoire virtuel pour les fichiers de sortie.</span><span class="sxs-lookup"><span data-stu-id="fb387-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="fb387-167">Vous pouvez utiliser hello **chemin d’accès** objet blob de propriété tooname hello ou un répertoire virtuel de telle sorte que les fichiers de sortie avec hello même nom sont nommées de manière unique dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="fb387-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="fb387-168">À l’aide des ID de tâche : hello dans le chemin d’accès hello est un bon moyen tooensure les noms uniques et identifier facilement les fichiers.</span><span class="sxs-lookup"><span data-stu-id="fb387-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="fb387-169">Si hello **FilePattern** propriété a la valeur tooa génériques expression, puis tous les fichiers qui correspondent au modèle de hello sont téléchargées toohello répertoire virtuel spécifié par hello **chemin d’accès** propriété.</span><span class="sxs-lookup"><span data-stu-id="fb387-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="fb387-170">Par exemple, si hello conteneur est `mycontainer`, tâche hello ID est `mytask`, et le modèle de fichier hello est `..\std*.txt`, puis hello absolue URI toohello les fichiers de sortie dans le stockage Azure doit être similaires à :</span><span class="sxs-lookup"><span data-stu-id="fb387-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="fb387-171">Si hello **FilePattern** propriété ensemble toomatch un seul nom de fichier, ce qui signifie qu’il ne contienne pas de caractères génériques, hello ensuite la valeur de hello **chemin d’accès** propriété spécifie le nom d’objet blob complet hello .</span><span class="sxs-lookup"><span data-stu-id="fb387-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="fb387-172">Si vous prévoyez d’affectation de noms est en conflit avec un seul fichier à partir de plusieurs tâches, puis intégrer hello nom du répertoire virtuel de hello de toodisambiguate de nom de fichier hello ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="fb387-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="fb387-173">Par exemple, set hello **chemin d’accès** ID de tâche : hello propriété tooinclude, caractère de délimiteur hello (en général, une barre oblique) et nom de fichier hello :</span><span class="sxs-lookup"><span data-stu-id="fb387-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="fb387-174">Hello absolus fichiers de sortie URI toohello pour un ensemble de tâches sera semblables à :</span><span class="sxs-lookup"><span data-stu-id="fb387-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="fb387-175">Pour plus d’informations sur les répertoires virtuels dans le stockage Azure, consultez [répertorier les objets BLOB de hello dans un conteneur](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="fb387-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="fb387-176">Diagnostiquer les erreurs de chargement de fichier</span><span class="sxs-lookup"><span data-stu-id="fb387-176">Diagnose file upload errors</span></span>

<span data-ttu-id="fb387-177">Si la sortie de téléchargement de fichiers tooAzure stockage échoue, puis tâche hello déplace toohello **terminé** état et hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) est définie.</span><span class="sxs-lookup"><span data-stu-id="fb387-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="fb387-178">Examinez hello **FailureInformation** toodetermine de propriété d’indiquer l’erreur s’est produite.</span><span class="sxs-lookup"><span data-stu-id="fb387-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="fb387-179">Voici, par exemple, une erreur se produit lors du téléchargement du fichier si le conteneur de hello est introuvable :</span><span class="sxs-lookup"><span data-stu-id="fb387-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="fb387-180">Sur chaque téléchargement du fichier, lot écrit deux connecter à nœud de calcul fichiers toohello, `fileuploadout.txt` et `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="fb387-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="fb387-181">Vous pouvez examiner ces toolearn de fichiers journaux plus d’informations sur un échec spécifique.</span><span class="sxs-lookup"><span data-stu-id="fb387-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="fb387-182">Dans les cas où hello fichier jamais tentative de chargement, par exemple, car il est impossible d’exécuter la tâche hello lui-même, puis ces fichiers journaux n’existent pas.</span><span class="sxs-lookup"><span data-stu-id="fb387-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="fb387-183">Diagnostiquer les performances de chargement de fichier</span><span class="sxs-lookup"><span data-stu-id="fb387-183">Diagnose file upload performance</span></span>

<span data-ttu-id="fb387-184">Hello `fileuploadout.txt` fichier enregistre la progression du téléchargement.</span><span class="sxs-lookup"><span data-stu-id="fb387-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="fb387-185">Vous pouvez examiner cette toolearn fichier prennent plus d’informations sur la durée pendant laquelle les téléchargements de votre fichier.</span><span class="sxs-lookup"><span data-stu-id="fb387-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="fb387-186">N’oubliez pas qu’il existe plusieurs facteurs des performances tooupload, y compris la taille de hello du nœud hello, autre activité sur le nœud de hello au moment de hello de téléchargement de hello, si le conteneur cible de hello est Bonjour est de même région que le pool de traitement par lots hello, le nombre de nœuds téléchargement de compte de stockage toohello hello en même temps et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="fb387-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="fb387-187">Utiliser les API de service de traitement par lots hello avec hello Conventions pour les fichiers Batch standard</span><span class="sxs-lookup"><span data-stu-id="fb387-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="fb387-188">Lorsque vous rendez persistante de sortie de la tâche avec hello API de service de traitement par lots, vous pouvez nommer votre conteneur de destination et les objets BLOB comme vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="fb387-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="fb387-189">Vous pouvez également choisir tooname leur selon toohello [standard de Conventions pour les fichiers Batch](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="fb387-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="fb387-190">standard de Conventions pour les fichiers Hello détermine les noms de hello du conteneur de destination hello et d’objet blob dans le stockage Azure pour un fichier de sortie donnée en fonction du nom hello de hello projet et la tâche.</span><span class="sxs-lookup"><span data-stu-id="fb387-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="fb387-191">Si vous utilisez hello Conventions standard pour les fichiers de nommer les fichiers de sortie, vos fichiers de sortie sont disponibles pour l’affichage dans hello [portail Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="fb387-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="fb387-192">Si vous développez en c#, vous pouvez utiliser les méthodes de hello intégrées hello [bibliothèque Conventions pour les fichiers Batch pour .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="fb387-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="fb387-193">Cette bibliothèque crée hello nommé correctement les conteneurs et les chemins d’accès de l’objet blob pour vous.</span><span class="sxs-lookup"><span data-stu-id="fb387-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="fb387-194">Par exemple, vous pouvez appeler hello API tooget hello correct nom hello conteneur, selon le nom de la tâche hello :</span><span class="sxs-lookup"><span data-stu-id="fb387-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="fb387-195">Vous pouvez utiliser hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) méthode tooreturn une URL de signature (SAP) d’accès partagé qui est utilisé toowrite toohello conteneur.</span><span class="sxs-lookup"><span data-stu-id="fb387-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="fb387-196">Vous pouvez ensuite passer cette toohello SAS [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructeur.</span><span class="sxs-lookup"><span data-stu-id="fb387-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="fb387-197">Si vous développez dans une langue autre que c#, vous devez standard de Conventions pour les fichiers tooimplement hello vous-même.</span><span class="sxs-lookup"><span data-stu-id="fb387-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="fb387-198">Exemple de code</span><span class="sxs-lookup"><span data-stu-id="fb387-198">Code sample</span></span>

<span data-ttu-id="fb387-199">Hello [PersistOutputs] [ github_persistoutputs] exemple de projet est un des hello [exemples de code Azure Batch] [ github_samples] sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="fb387-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="fb387-200">Cette solution Visual Studio montre comment toouse bibliothèque cliente de lot hello pour les tâches de toopersist .NET sortie toodurable stockage.</span><span class="sxs-lookup"><span data-stu-id="fb387-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="fb387-201">toorun hello exemple, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="fb387-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="fb387-202">Projet ouvert hello dans **Visual Studio 2015 ou plus récente**.</span><span class="sxs-lookup"><span data-stu-id="fb387-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="fb387-203">Ajouter votre lot et un stockage **informations d’identification de compte** trop**AccountSettings.settings** dans le projet de Microsoft.Azure.Batch.Samples.Common hello.</span><span class="sxs-lookup"><span data-stu-id="fb387-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="fb387-204">**Build** (mais ne s’exécutent pas) hello solution.</span><span class="sxs-lookup"><span data-stu-id="fb387-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="fb387-205">Restaurez les packages NuGet si vous y êtes invité.</span><span class="sxs-lookup"><span data-stu-id="fb387-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="fb387-206">Hello d’utilisation tooupload portail Azure un [package d’application](batch-application-packages.md) pour **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="fb387-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="fb387-207">Inclure hello `PersistOutputsTask.exe` et ses assemblys dépendants dans le package .zip de hello, ID de l’application hello ensemble trop « PersistOutputsTask » et application hello version du package trop « 1.0 ».</span><span class="sxs-lookup"><span data-stu-id="fb387-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="fb387-208">**Démarrer** hello (exécution) **PersistOutputs** projet.</span><span class="sxs-lookup"><span data-stu-id="fb387-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="fb387-209">Lorsque toochoose demandées hello persistance technologie toouse pour l’exemple hello, entrez **2** toorun hello exemple à l’aide de la sortie de la tâche toopersist hello API de service de traitement par lots.</span><span class="sxs-lookup"><span data-stu-id="fb387-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="fb387-210">Si vous le souhaitez, réexécutez exemple hello entrant **3** sortie toopersist hello API de lot, mais aussi tooname hello conteneur et l’objet blob de chemin de destination en fonction de toohello Conventions standard pour les fichiers.</span><span class="sxs-lookup"><span data-stu-id="fb387-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="fb387-211">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="fb387-211">Next steps</span></span>

- <span data-ttu-id="fb387-212">Pour plus d’informations sur la sortie de la tâche persistantes avec la bibliothèque de Conventions pour les fichiers hello pour .NET, consultez [conserver les travaux et des tâches données tooAzure stockage avec bibliothèque de Conventions pour les fichiers Batch hello pour .NET toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="fb387-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="fb387-213">Pour plus d’informations sur les autres approches pour la persistance des données de sortie dans le traitement par lots Azure, consultez [tooAzure stockage de sortie de projet de la persistance et la tâche](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="fb387-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples
