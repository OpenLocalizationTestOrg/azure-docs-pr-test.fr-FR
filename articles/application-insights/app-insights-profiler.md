---
title: Profilage des applications web dynamiques sur Azure avec Application Insights | Microsoft Docs
description: "Identifiez le chemin réactif dans le code de votre serveur web avec un profileur de faible encombrement."
services: application-insights
documentationcenter: 
author: CFreemanwa
manager: carmonm
ms.service: application-insights
ms.workload: tbd
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 05/04/2017
ms.author: bwren
ms.openlocfilehash: ff39f9a84b86c14859aaee50ee368643fb2848ea
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="profiling-live-azure-web-apps-with-application-insights"></a><span data-ttu-id="573f9-103">Profilage des applications web dynamiques Azure avec Application Insights</span><span class="sxs-lookup"><span data-stu-id="573f9-103">Profiling live Azure web apps with Application Insights</span></span>

<span data-ttu-id="573f9-104">*Cette fonctionnalité d’Application Insights est disponible pour les App Services, et disponible en aperçu pour Compute.*</span><span class="sxs-lookup"><span data-stu-id="573f9-104">*This feature of Application Insights is GA for App Services and in preview for Compute.*</span></span>

<span data-ttu-id="573f9-105">Découvrez combien de temps vous consacrez à chaque méthode dans votre application web dynamique à l’aide de l’outil de profilage [d’Azure Application Insights](app-insights-overview.md).</span><span class="sxs-lookup"><span data-stu-id="573f9-105">Find out how much time is spent in each method in your live web application by using the profiling tool of [Azure Application Insights](app-insights-overview.md).</span></span> <span data-ttu-id="573f9-106">Cet outil vous montre les profils détaillés des requêtes dynamiques qui ont été traitées par votre application et met en évidence le « chemin réactif » qui est le plus souvent utilisé.</span><span class="sxs-lookup"><span data-stu-id="573f9-106">It shows you detailed profiles of live requests that were served by your app, and highlights the 'hot path' that is using the most time.</span></span> <span data-ttu-id="573f9-107">Il sélectionne automatiquement des exemples associés à des temps de réponse différents.</span><span class="sxs-lookup"><span data-stu-id="573f9-107">It automatically selects examples that have different response times.</span></span> <span data-ttu-id="573f9-108">Le profileur utilise diverses techniques pour réduire la charge.</span><span class="sxs-lookup"><span data-stu-id="573f9-108">The profiler uses various techniques to minimize overhead.</span></span>

<span data-ttu-id="573f9-109">Le profileur fonctionne actuellement pour les applications web ASP.NET s’exécutant sur Azure App Services, au moins au niveau tarifaire de base.</span><span class="sxs-lookup"><span data-stu-id="573f9-109">The profiler currently works for ASP.NET web apps running on Azure App Services, in at least the Basic pricing tier.</span></span> 

<a id="installation"></a>
## <a name="enable-the-profiler"></a><span data-ttu-id="573f9-110">Activer le profileur</span><span class="sxs-lookup"><span data-stu-id="573f9-110">Enable the profiler</span></span>

<span data-ttu-id="573f9-111">[Installez Application Insights](app-insights-asp-net.md) dans votre code.</span><span class="sxs-lookup"><span data-stu-id="573f9-111">[Install Application Insights](app-insights-asp-net.md) in your code.</span></span> <span data-ttu-id="573f9-112">S’il est déjà installé, assurez-vous que vous disposez de la version la plus récente.</span><span class="sxs-lookup"><span data-stu-id="573f9-112">If it's already installed, make sure you have the latest version.</span></span> <span data-ttu-id="573f9-113">(Pour ce faire, cliquez avec le bouton droit sur votre projet dans l'Explorateur de solutions, puis sélectionnez Gérer les packages NuGet.</span><span class="sxs-lookup"><span data-stu-id="573f9-113">(To do this, right-click your project in Solution Explorer, and choose Manage NuGet packages.</span></span> <span data-ttu-id="573f9-114">Sélectionnez Mises à jour et mettez à jour tous les packages.) Redéployez votre application.</span><span class="sxs-lookup"><span data-stu-id="573f9-114">Select Updates and update all packages.) Re-deploy your app.</span></span>

<span data-ttu-id="573f9-115">*Vous utilisez ASP.NET Core ? [Cliquez ici](#aspnetcore).*</span><span class="sxs-lookup"><span data-stu-id="573f9-115">*Using ASP.NET Core? [Check here](#aspnetcore).*</span></span>

<span data-ttu-id="573f9-116">Dans [https://portal.azure.com](https://portal.azure.com), ouvrez la ressource Application Insights correspondant à votre application web.</span><span class="sxs-lookup"><span data-stu-id="573f9-116">In [https://portal.azure.com](https://portal.azure.com), open the Application Insights resource for your web app.</span></span> <span data-ttu-id="573f9-117">Ouvrez **Performances** et cliquez sur **Activer Application Insights Profiler...**.</span><span class="sxs-lookup"><span data-stu-id="573f9-117">Open **Performance** and click **Enable Application Insights Profiler...**.</span></span>

![Cliquez sur la bannière « Activer le profileur »][enable-profiler-banner]

<span data-ttu-id="573f9-119">Sinon, vous pouvez toujours cliquer sur **Configurer** pour afficher l’état de Profiler, pour l’activer ou le désactiver.</span><span class="sxs-lookup"><span data-stu-id="573f9-119">Alternatively, you can always click **Configure** to view status, enable, or disable the Profiler.</span></span>

![Dans le panneau Performances, cliquez sur Configurer.][performance-blade]

<span data-ttu-id="573f9-121">Les applications web configurées avec Application Insights sont listées dans le panneau Configurer.</span><span class="sxs-lookup"><span data-stu-id="573f9-121">Web apps that are configured with Application Insights are listed on Configure blade.</span></span> <span data-ttu-id="573f9-122">Suivez les instructions pour installer l’agent profileur si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="573f9-122">Follow instructions to install the Profiler agent if needed.</span></span> <span data-ttu-id="573f9-123">Si aucune application web n’est encore configurée avec Application Insights, cliquez sur *Ajouter des applications liées*.</span><span class="sxs-lookup"><span data-stu-id="573f9-123">If no web app is configured with Application Insights yet, click *Add Linked Apps*.</span></span>

<span data-ttu-id="573f9-124">Utilisez les boutons *Activer le profileur* ou *Désactiver le profileur* dans le panneau Configurer pour contrôler le profileur dans toutes vos applications web liées.</span><span class="sxs-lookup"><span data-stu-id="573f9-124">Use the *Enable Profiler* or *Disable Profiler* buttons in the Configure blade to control the Profiler on all your linked web apps.</span></span>



![Panneau Configurer][linked app services]

<span data-ttu-id="573f9-126">Pour arrêter ou redémarrer le profileur pour une App Service individuelle, vous devez vous rendre **dans la ressource App Service**, sous **Tâches web**.</span><span class="sxs-lookup"><span data-stu-id="573f9-126">To stop or restart the profiler for an individual App Service instance, you'll find it **in the App Service resource**, in **Web Jobs**.</span></span> <span data-ttu-id="573f9-127">Pour le supprimer, allez dans **Extensions**.</span><span class="sxs-lookup"><span data-stu-id="573f9-127">To delete it, look under **Extensions**.</span></span>

![Désactiver le profileur pour des tâches web][disable-profiler-webjob]

<span data-ttu-id="573f9-129">Nous vous recommandons d’activer, dès que possible, le profileur sur toutes vos applications web afin de découvrir d’éventuels problèmes de performance.</span><span class="sxs-lookup"><span data-stu-id="573f9-129">We recommend that you have the Profiler enabled on all your web apps to discover any performance issues as soon as possible.</span></span>

<span data-ttu-id="573f9-130">Si vous utilisez WebDeploy pour déployer des modifications sur votre application web, veillez à ne pas supprimer le dossier **App_Data** lors du déploiement.</span><span class="sxs-lookup"><span data-stu-id="573f9-130">If you use WebDeploy to deploy changes to your web application, ensure that you exclude the **App_Data** folder from being deleted during deployment.</span></span> <span data-ttu-id="573f9-131">Dans le cas contraire, les fichiers de l’extension du profileur seront supprimés lorsque vous déploierez ensuite l’application web dans Azure.</span><span class="sxs-lookup"><span data-stu-id="573f9-131">Otherwise, the profiler extension's files will be deleted when you next deploy the web application to Azure.</span></span>

### <a name="using-profiler-with-azure-vms-and-compute-resources-preview"></a><span data-ttu-id="573f9-132">En utilisant le profileur avec les machines virtuelles Azure et les ressources de calcul (version préliminaire)</span><span class="sxs-lookup"><span data-stu-id="573f9-132">Using profiler with Azure VMs and Compute resources (preview)</span></span>

<span data-ttu-id="573f9-133">Lorsque vous [activez Application Insights pour les services d’application Azure en cours d’exécution](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), le profileur est automatiquement disponible.</span><span class="sxs-lookup"><span data-stu-id="573f9-133">When you [enable Application Insights for Azure app services at run time](app-insights-azure-web-apps.md#run-time-instrumentation-with-application-insights), Profiler is automatically available.</span></span> <span data-ttu-id="573f9-134">(Si vous avez déjà activé Application Insights pour la ressource, vous devrez peut-être mettre à jour vers la dernière version disponible via l’Assistant **Configuration**).</span><span class="sxs-lookup"><span data-stu-id="573f9-134">(If you already enabled Application Insights for the resource, you might need to update to the lates version through the **Configure** wizard.)</span></span>

<span data-ttu-id="573f9-135">Il existe une [version préliminaire du profileur pour les ressources de calcul Azure](https://go.microsoft.com/fwlink/?linkid=848155).</span><span class="sxs-lookup"><span data-stu-id="573f9-135">There is a [preview version of the Profiler for Azure Compute resources](https://go.microsoft.com/fwlink/?linkid=848155).</span></span>


## <a name="limits"></a><span data-ttu-id="573f9-136">Limites</span><span class="sxs-lookup"><span data-stu-id="573f9-136">Limits</span></span>

<span data-ttu-id="573f9-137">Par défaut, la durée de rétention des données est de 5 jours.</span><span class="sxs-lookup"><span data-stu-id="573f9-137">The default data retention is 5 days.</span></span> <span data-ttu-id="573f9-138">10 Go maximum reçus par jour.</span><span class="sxs-lookup"><span data-stu-id="573f9-138">Maximum 10 GB ingested per day.</span></span>

<span data-ttu-id="573f9-139">Aucuns frais ne s’appliquent pour le service de profileur.</span><span class="sxs-lookup"><span data-stu-id="573f9-139">There is no charge for the profiler service.</span></span> <span data-ttu-id="573f9-140">Votre application web doit être hébergée au moins au niveau de base de App Services.</span><span class="sxs-lookup"><span data-stu-id="573f9-140">Your web app must be hosted in at least the Basic tier of App Services.</span></span>

## <a name="viewing-profiler-data"></a><span data-ttu-id="573f9-141">Affichage des données du profileur</span><span class="sxs-lookup"><span data-stu-id="573f9-141">Viewing profiler data</span></span>

<span data-ttu-id="573f9-142">Ouvrez le panneau Performances et faites défiler jusqu’à la liste des opérations.</span><span class="sxs-lookup"><span data-stu-id="573f9-142">Open the Performance blade and scroll down to the operation list.</span></span>




![Colonne Exemples du panneau Performances d’Application Insights][performance-blade-examples]

<span data-ttu-id="573f9-144">Le tableau contient les colonnes suivantes :</span><span class="sxs-lookup"><span data-stu-id="573f9-144">The columns in the table are:</span></span>

* <span data-ttu-id="573f9-145">**Nombre** : le nombre de ces requêtes dans l’intervalle de temps du panneau.</span><span class="sxs-lookup"><span data-stu-id="573f9-145">**Count** - The number of these requests in the time range of the blade.</span></span>
* <span data-ttu-id="573f9-146">**Médiane** : délai standard de votre application pour répondre à une requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-146">**Median** - The typical time your app takes to respond to a request.</span></span> <span data-ttu-id="573f9-147">La moitié de toutes les réponses étaient plus rapides que cela.</span><span class="sxs-lookup"><span data-stu-id="573f9-147">Half of all responses were faster than this.</span></span>
* <span data-ttu-id="573f9-148">**95e centile** : 95 % des réponses étaient plus rapides que cela.</span><span class="sxs-lookup"><span data-stu-id="573f9-148">**95th percentile** 95% of responses were faster than this.</span></span> <span data-ttu-id="573f9-149">Si ce chiffre est très différent de la valeur médiane, il existe peut-être un problème intermittent au niveau de votre application.</span><span class="sxs-lookup"><span data-stu-id="573f9-149">If this figure is very different from the median, there might be an intermittent problem with your app.</span></span> <span data-ttu-id="573f9-150">(Cette différence peut aussi s’expliquer par une fonctionnalité de conception, telle que la mise en cache.)</span><span class="sxs-lookup"><span data-stu-id="573f9-150">(Or it might be explained by a design feature such as caching.)</span></span>
* <span data-ttu-id="573f9-151">**Exemples** : une icône indique que le profileur a capturé des arborescences d’appels de procédure pour cette opération.</span><span class="sxs-lookup"><span data-stu-id="573f9-151">**Examples** - an icon indicates that the profiler has captured stack traces for this operation.</span></span>

<span data-ttu-id="573f9-152">Cliquez sur l’icône Exemples pour ouvrir l’Explorateur de trace.</span><span class="sxs-lookup"><span data-stu-id="573f9-152">Click the Examples icon to open the trace explorer.</span></span> <span data-ttu-id="573f9-153">L’Explorateur affiche plusieurs exemples que le profileur a capturés, classés par temps de réponse.</span><span class="sxs-lookup"><span data-stu-id="573f9-153">The explorer shows several samples that the profiler has captured, classified by response time.</span></span>

<span data-ttu-id="573f9-154">Sélectionnez un exemple pour afficher, au niveau du code, une répartition du temps d’exécution de la requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-154">Select a sample to show a code-level breakdown of time spent executing the request.</span></span>

![Explorateur de trace d’Application Insights][trace-explorer]

<span data-ttu-id="573f9-156">**Afficher le chemin réactif** : ouvre le plus grand nœud feuille, ou du moins un élément qui s’en rapproche.</span><span class="sxs-lookup"><span data-stu-id="573f9-156">**Show hot path** opens the biggest leaf node, or at least something close.</span></span> <span data-ttu-id="573f9-157">Dans la plupart des cas, ce nœud est adjacent à un goulot d’étranglement.</span><span class="sxs-lookup"><span data-stu-id="573f9-157">In most cases this node will be adjacent to a performance bottleneck.</span></span>



* <span data-ttu-id="573f9-158">**Étiquette** : nom de la fonction ou de l’événement.</span><span class="sxs-lookup"><span data-stu-id="573f9-158">**Label**: The name of the function or event.</span></span> <span data-ttu-id="573f9-159">L’arborescence affiche une combinaison des codes et des événements qui se sont produits (par exemple, des événements SQL et http).</span><span class="sxs-lookup"><span data-stu-id="573f9-159">The tree shows a mix of code and events that occurred (such as SQL and http events).</span></span> <span data-ttu-id="573f9-160">L’événement supérieur représente la durée globale de la requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-160">The top event represents the overall request duration.</span></span>
* <span data-ttu-id="573f9-161">**Métrique** : intervalle de temps entre le début de l’opération et la fin.</span><span class="sxs-lookup"><span data-stu-id="573f9-161">**Elapsed**: The time interval between the start of the operation and the end.</span></span>
* <span data-ttu-id="573f9-162">**Quand** : indique à quel moment la fonction/l’événement était en cours d’exécution par rapport à d’autres fonctions.</span><span class="sxs-lookup"><span data-stu-id="573f9-162">**When**: Shows when the function/event was running in relation to other functions.</span></span>

## <a name="how-to-read-performance-data"></a><span data-ttu-id="573f9-163">Comment lire les données de performances</span><span class="sxs-lookup"><span data-stu-id="573f9-163">How to read performance data</span></span>

<span data-ttu-id="573f9-164">Le profileur de service Microsoft utilise à la fois une méthode d’échantillonnage et une instrumentation pour analyser les performances de votre application.</span><span class="sxs-lookup"><span data-stu-id="573f9-164">Microsoft service profiler uses a combination of sampling method and instrumentation to analyze the performance of your application.</span></span>
<span data-ttu-id="573f9-165">Lorsque la collecte détaillée est en cours, le profileur de service échantillonne le pointeur d’instruction de chaque processeur de l’ordinateur à chaque milliseconde.</span><span class="sxs-lookup"><span data-stu-id="573f9-165">When detailed collection is in progress, service profiler samples the instruction pointer of each of the machine's CPU in every millisecond.</span></span>
<span data-ttu-id="573f9-166">Chaque exemple capture la pile des appels complète du thread en cours d’exécution, en donnant des informations utiles et détaillées sur l’activité du thread à des niveaux d’abstraction faibles et élevés.</span><span class="sxs-lookup"><span data-stu-id="573f9-166">Each sample captures the complete call stack of the thread currently executing, giving detailed and useful information about what that thread was doing at both high and low levels of abstraction.</span></span> <span data-ttu-id="573f9-167">Le profileur de service collecte également d’autres événements tels que les événements de changement de contexte, les événements TPL et les événements de pool de threads afin de suivre la corrélation et la causalité des activités.</span><span class="sxs-lookup"><span data-stu-id="573f9-167">Service profiler also collects other events such as context switching events, TPL events, and thread-pool events to track activity correlation and causality.</span></span>

<span data-ttu-id="573f9-168">La pile des appels présentée dans l’affichage chronologique est le résultat de l’échantillonnage et de l’instrumentation décrits ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="573f9-168">The call stack shown in the timeline view is the result of the above sampling and instrumentation.</span></span> <span data-ttu-id="573f9-169">Étant donné que chaque échantillon capture la pile des appels complète du thread, il inclut le code du framework .NET, ainsi que les autres infrastructures que vous référencez.</span><span class="sxs-lookup"><span data-stu-id="573f9-169">Because each sample captures the complete call stack of the thread, it includes code from the .NET framework, as well as other frameworks you reference.</span></span>

### <span data-ttu-id="573f9-170"><a id="jitnewobj"></a>Allocation d’objets (`clr!JIT\_New or clr!JIT\_Newarr1`)</span><span class="sxs-lookup"><span data-stu-id="573f9-170"><a id="jitnewobj"></a>Object Allocation (`clr!JIT\_New or clr!JIT\_Newarr1`)</span></span>
<span data-ttu-id="573f9-171">Les fonctions d’assistance `clr!JIT\_New and clr!JIT\_Newarr1` intégrées au framework .NET allouent la mémoire à partir du segment de mémoire géré.</span><span class="sxs-lookup"><span data-stu-id="573f9-171">`clr!JIT\_New and clr!JIT\_Newarr1` are helper functions inside .NET framework that allocates memory from managed heap.</span></span> <span data-ttu-id="573f9-172">`clr!JIT\_New` est appelé lorsqu’un objet est alloué.</span><span class="sxs-lookup"><span data-stu-id="573f9-172">`clr!JIT\_New` is invoked when an object is allocated.</span></span> <span data-ttu-id="573f9-173">`clr!JIT\_Newarr1` est appelé lorsqu’un tableau d’objets est alloué.</span><span class="sxs-lookup"><span data-stu-id="573f9-173">`clr!JIT\_Newarr1` is invoked when an object array is allocated.</span></span> <span data-ttu-id="573f9-174">Ces deux fonctions sont généralement très rapides et s’exécutent en relativement peu de temps.</span><span class="sxs-lookup"><span data-stu-id="573f9-174">These two functions are typically very fast and should take relatively small amount of time.</span></span> <span data-ttu-id="573f9-175">Si vous constatez que `clr!JIT\_New` ou `clr!JIT\_Newarr1` prend un certain temps dans votre scénario, cela indique que le code alloue peut-être de nombreux objets et qu’il consomme une quantité importante de mémoire.</span><span class="sxs-lookup"><span data-stu-id="573f9-175">If you see `clr!JIT\_New` or `clr!JIT\_Newarr1` take a substantial amount of time in your timeline, it's an indication that the code may be allocating many objects and consuming significant amount of memory.</span></span>

### <span data-ttu-id="573f9-176"><a id="theprestub"></a>Code de chargement (`clr!ThePreStub`)</span><span class="sxs-lookup"><span data-stu-id="573f9-176"><a id="theprestub"></a>Loading Code (`clr!ThePreStub`)</span></span>
<span data-ttu-id="573f9-177">`clr!ThePreStub` est une fonction d’assistance intégrée au framework .NET qui prépare le code en vue de sa première exécution.</span><span class="sxs-lookup"><span data-stu-id="573f9-177">`clr!ThePreStub` is a helper function inside .NET framework that prepares the code to execute for the first time.</span></span> <span data-ttu-id="573f9-178">Elle implique en général au moins une compilation JIT (juste à temps).</span><span class="sxs-lookup"><span data-stu-id="573f9-178">This typically includes, but not limited to, JIT (Just In Time) compilation.</span></span> <span data-ttu-id="573f9-179">Pour chaque méthode C#, `clr!ThePreStub` doit être appelé au maximum une fois pendant la durée de vie d’un processus.</span><span class="sxs-lookup"><span data-stu-id="573f9-179">For each C# method, `clr!ThePreStub` should be invoked at most once during the lifetime of a process.</span></span>

<span data-ttu-id="573f9-180">Si vous constatez que `clr!ThePreStub` prend beaucoup de temps pour le traitement d’une requête, cela indique que cette requête est la première à exécuter cette méthode, et que le runtime du framework .NET prend beaucoup de temps pour charger cette méthode.</span><span class="sxs-lookup"><span data-stu-id="573f9-180">If you see `clr!ThePreStub` takes significant amount of time for a request, it indicates that request is the first one that executes that method, and the time for .NET framework runtime to load that method is significant.</span></span> <span data-ttu-id="573f9-181">Vous pouvez envisager un processus de mise en route qui exécute cette partie du code avant que vos utilisateurs y accèdent, ou encore envisager d’exécuter NGen sur vos assemblys.</span><span class="sxs-lookup"><span data-stu-id="573f9-181">You can consider a warm-up process that executes that portion of the code before your users access it, or consider running NGen on your assemblies.</span></span>

### <span data-ttu-id="573f9-182"><a id="lockcontention"></a>Contention de verrouillage (`clr!JITutil\_MonContention` ou `clr!JITutil\_MonEnterWorker`)</span><span class="sxs-lookup"><span data-stu-id="573f9-182"><a id="lockcontention"></a>Lock Contention (`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker`)</span></span>
<span data-ttu-id="573f9-183">`clr!JITutil\_MonContention` ou `clr!JITutil\_MonEnterWorker` indique que le thread actuel attend qu’un verrou soit libéré.</span><span class="sxs-lookup"><span data-stu-id="573f9-183">`clr!JITutil\_MonContention` or `clr!JITutil\_MonEnterWorker` indicate the current thread is waiting for a lock to be released.</span></span> <span data-ttu-id="573f9-184">Cela se produit généralement lors de l’exécution d’une instruction lock C#, lors de l’appel de méthode Monitor.Enter, ou encore lors de l’appel d’une méthode avec l’attribut MethodImplOptions.Synchronized.</span><span class="sxs-lookup"><span data-stu-id="573f9-184">This typically shows up when executing a C# lock statement, invoking Monitor.Enter method, or invoking a method with MethodImplOptions.Synchronized attribute.</span></span> <span data-ttu-id="573f9-185">La contention de verrouillage se produit généralement lorsque le thread A acquiert un verrou et que le thread B tente d’acquérir le même verrou avant qu’il ne soit libéré par le thread A.</span><span class="sxs-lookup"><span data-stu-id="573f9-185">Lock contention typically happens when thread A acquires a lock, and thread B tries to acquire the same lock before thread A releases it.</span></span>

### <span data-ttu-id="573f9-186"><a id="ngencold"></a>Code de chargement (`[COLD]`)</span><span class="sxs-lookup"><span data-stu-id="573f9-186"><a id="ngencold"></a>Loading code (`[COLD]`)</span></span>
<span data-ttu-id="573f9-187">Si le nom de la méthode contient `[COLD]`, par exemple `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, cela signifie que le runtime du framework .NET exécute pour la première fois du code qui n’utilise pas une <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">optimisation guidée par profil</a>.</span><span class="sxs-lookup"><span data-stu-id="573f9-187">If the method name contains `[COLD]`, such as `mscorlib.ni![COLD]System.Reflection.CustomAttribute.IsDefined`, it means that the .NET framework runtime is executing code that is not optimized by <a href="https://msdn.microsoft.com/library/e7k32f4k.aspx">profile-guided optimization</a> for the first time.</span></span> <span data-ttu-id="573f9-188">Pour chaque méthode, il doit s’afficher au maximum une fois pendant la durée de vie du processus.</span><span class="sxs-lookup"><span data-stu-id="573f9-188">For each method, it should show up at most once during the lifetime of the process.</span></span>

<span data-ttu-id="573f9-189">Si le code de chargement de code prend beaucoup de temps pour traiter une requête, cela indique que cette requête est la première à exécuter la partie non optimisée de la méthode.</span><span class="sxs-lookup"><span data-stu-id="573f9-189">If loading code takes significant amount of time for a request, it indicates that request is the first one to execute the unoptimized portion of the method.</span></span> <span data-ttu-id="573f9-190">Vous pouvez envisager un processus de mise en route qui exécute cette partie du code avant que vos utilisateurs y accèdent.</span><span class="sxs-lookup"><span data-stu-id="573f9-190">You can consider a warm up process that executes that portion of the code before your users access it.</span></span>

### <span data-ttu-id="573f9-191"><a id="httpclientsend"></a>Envoyer une requête HTTP</span><span class="sxs-lookup"><span data-stu-id="573f9-191"><a id="httpclientsend"></a>Send HTTP Request</span></span>
<span data-ttu-id="573f9-192">Les méthodes telles que `HttpClient.Send` indiquent que le code attend l’exécution d’une requête HTTP.</span><span class="sxs-lookup"><span data-stu-id="573f9-192">Methods such as `HttpClient.Send` indicate the code is waiting for a HTTP request to complete.</span></span>

### <span data-ttu-id="573f9-193"><a id="sqlcommand"></a>Opération de base de données</span><span class="sxs-lookup"><span data-stu-id="573f9-193"><a id="sqlcommand"></a>Database Operation</span></span>
<span data-ttu-id="573f9-194">Une méthode telle que SqlCommand.Execute indique que le code attend l’exécution d’une opération de base de données.</span><span class="sxs-lookup"><span data-stu-id="573f9-194">Method such as SqlCommand.Execute indicates the code is waiting for a database operation to complete.</span></span>

### <span data-ttu-id="573f9-195"><a id="await"></a>En attente (`AWAIT\_TIME`)</span><span class="sxs-lookup"><span data-stu-id="573f9-195"><a id="await"></a>Waiting (`AWAIT\_TIME`)</span></span>
<span data-ttu-id="573f9-196">`AWAIT\_TIME` indique que le code attend la fin de l’exécution d’une autre tâche.</span><span class="sxs-lookup"><span data-stu-id="573f9-196">`AWAIT\_TIME` indicates the code is waiting for another task to complete.</span></span> <span data-ttu-id="573f9-197">Cela se produit généralement avec l’instruction C# « await ».</span><span class="sxs-lookup"><span data-stu-id="573f9-197">This typically happens with C# 'await' statement.</span></span> <span data-ttu-id="573f9-198">Lorsque le code exécute une instruction C# « await », le thread se déroule et redonne le contrôle au pool de threads : aucun thread n’est bloqué en attendant la fin de l’exécution de l’instruction « await ».</span><span class="sxs-lookup"><span data-stu-id="573f9-198">When the code does a C# 'await', the thread unwinds and returns control to the thread-pool, and there is no thread that is blocked waiting for the 'await' to finish.</span></span> <span data-ttu-id="573f9-199">Toutefois, le thread qui a exécuté l’instruction « await » est logiquement « bloqué » en attendant que l’opération se termine.</span><span class="sxs-lookup"><span data-stu-id="573f9-199">However, logically the thread that did the await is 'blocked' waiting for the operation to complete.</span></span> <span data-ttu-id="573f9-200">`AWAIT\_TIME` indique le temps de blocage dans l’attente d’exécution de la tâche.</span><span class="sxs-lookup"><span data-stu-id="573f9-200">The `AWAIT\_TIME` indicates the blocked time waiting for the task to complete.</span></span>

### <span data-ttu-id="573f9-201"><a id="block"></a>Temps de blocage</span><span class="sxs-lookup"><span data-stu-id="573f9-201"><a id="block"></a>Blocked Time</span></span>
<span data-ttu-id="573f9-202">`BLOCKED_TIME` indique que le code attend qu’une autre ressource soit disponible ; c’est le cas par exemple d’une attente d’un objet de synchronisation, d’une attente de disponibilité d’un thread ou d’une attente de fin d’exécution d’une requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-202">`BLOCKED_TIME` indicates the code is waiting for another resource to be available, such as waiting for a synchronization object, waiting for a thread to be available, or waiting for a request to finish.</span></span>

### <span data-ttu-id="573f9-203"><a id="cpu"></a>Temps processeur</span><span class="sxs-lookup"><span data-stu-id="573f9-203"><a id="cpu"></a>CPU Time</span></span>
<span data-ttu-id="573f9-204">Le processeur est occupé à exécuter les instructions.</span><span class="sxs-lookup"><span data-stu-id="573f9-204">The CPU is busy executing the instructions.</span></span>

### <span data-ttu-id="573f9-205"><a id="disk"></a>Temps du disque</span><span class="sxs-lookup"><span data-stu-id="573f9-205"><a id="disk"></a>Disk Time</span></span>
<span data-ttu-id="573f9-206">L’application effectue les opérations de disque.</span><span class="sxs-lookup"><span data-stu-id="573f9-206">The application is performing disk operations.</span></span>

### <span data-ttu-id="573f9-207"><a id="network"></a>Temps réseau</span><span class="sxs-lookup"><span data-stu-id="573f9-207"><a id="network"></a>Network Time</span></span>
<span data-ttu-id="573f9-208">L’application effectue les opérations réseau.</span><span class="sxs-lookup"><span data-stu-id="573f9-208">The application is performing network operations.</span></span>

### <span data-ttu-id="573f9-209"><a id="when"></a>Colonne « When » (Quand)</span><span class="sxs-lookup"><span data-stu-id="573f9-209"><a id="when"></a>When column</span></span>
<span data-ttu-id="573f9-210">Cette colonne permet de voir comment les exemples INCLUSIFS collectés pour un nœud varient au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="573f9-210">This is a visualization of how the INCLUSIVE samples collected for a node vary over time.</span></span> <span data-ttu-id="573f9-211">La plage totale de la requête est divisée en 32 compartiments de temps et les exemples inclusifs pour ce nœud sont accumulés dans ces 32 compartiments.</span><span class="sxs-lookup"><span data-stu-id="573f9-211">The total range of the request is divided into 32 time buckets and the inclusive samples for that node are accumulated into those 32 buckets.</span></span> <span data-ttu-id="573f9-212">Chaque compartiment est ensuite représenté par une barre dont la hauteur reflète une valeur à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="573f9-212">Each bucket is then represented as a bar whose height represents a scaled value.</span></span> <span data-ttu-id="573f9-213">Pour les nœuds marqués de `CPU_TIME` ou `BLOCKED_TIME`, ou lorsqu’il existe une relation évidente de consommation d’une ressource (processeur, disque, thread), la barre représente la consommation d’une de ces ressources pendant la période de temps de ce compartiment.</span><span class="sxs-lookup"><span data-stu-id="573f9-213">For nodes marked `CPU_TIME` or `BLOCKED_TIME`, or where there is an obvious relationship of consuming a resource (cpu, disk, thread), the bar represents consuming one of those resources for the period of time of that bucket.</span></span> <span data-ttu-id="573f9-214">Pour ces mesures, vous pouvez dépasser le seuil de 100 % en consommant plusieurs ressources.</span><span class="sxs-lookup"><span data-stu-id="573f9-214">For these metrics you can get greater than 100% by consuming multiple resources.</span></span> <span data-ttu-id="573f9-215">Par exemple, si vous utilisez en moyenne deux processeurs sur un intervalle donné, vous obtenez 200 %.</span><span class="sxs-lookup"><span data-stu-id="573f9-215">For example, if on average you use two CPUs over an interval then you get 200%.</span></span>


## <span data-ttu-id="573f9-216"><a id="troubleshooting"></a>Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="573f9-216"><a id="troubleshooting"></a>Troubleshooting</span></span>

### <a name="how-can-i-know-whether-application-insights-profiler-is-running"></a><span data-ttu-id="573f9-217">Comment savoir si le profileur d’Application Insights est en cours d’exécution ?</span><span class="sxs-lookup"><span data-stu-id="573f9-217">How can I know whether Application Insights profiler is running?</span></span>

<span data-ttu-id="573f9-218">Le profileur s’exécute comme une tâche web en continu dans Web App.</span><span class="sxs-lookup"><span data-stu-id="573f9-218">The profiler runs as a continuous web job in Web App.</span></span> <span data-ttu-id="573f9-219">Vous pouvez ouvrir la ressource Web App dans https://portal.azure.com et vérifier l’état « ApplicationInsightsProfiler » dans le panneau Tâches Web.</span><span class="sxs-lookup"><span data-stu-id="573f9-219">You can open the Web App resource in https://portal.azure.com and check "ApplicationInsightsProfiler" status in the WebJobs blade.</span></span> <span data-ttu-id="573f9-220">S’il n’est pas en cours d’exécution, ouvrez les **Journaux** pour en savoir plus.</span><span class="sxs-lookup"><span data-stu-id="573f9-220">If it isn't running, open **Logs** to find out more.</span></span>

### <a name="why-cant-i-find-any-stack-examples-even-though-the-profiler-is-running"></a><span data-ttu-id="573f9-221">Pourquoi aucun exemple de pile ne s’affiche même si le profileur est en cours d’exécution ?</span><span class="sxs-lookup"><span data-stu-id="573f9-221">Why can't I find any stack examples even though the profiler is running?</span></span>

<span data-ttu-id="573f9-222">Vous pouvez vérifier plusieurs points.</span><span class="sxs-lookup"><span data-stu-id="573f9-222">Here are a few things you can check.</span></span>

1. <span data-ttu-id="573f9-223">Assurez-vous que votre plan Web App Service est au moins au niveau tarifaire De base.</span><span class="sxs-lookup"><span data-stu-id="573f9-223">Make sure your Web App Service Plan is Basic tier and above.</span></span>
2. <span data-ttu-id="573f9-224">Assurez-vous que le SDK Application Insights 2.2 Bêta ou version supérieure est activé sur votre application web.</span><span class="sxs-lookup"><span data-stu-id="573f9-224">Make sure your Web App has Application Insights SDK 2.2 Beta and above enabled.</span></span>
3. <span data-ttu-id="573f9-225">Vérifiez dans votre application web que le paramètre APPINSIGHTS_INSTRUMENTATIONKEY utilise la même clé d’instrumentation que celle utilisée par le SDK Application Insights.</span><span class="sxs-lookup"><span data-stu-id="573f9-225">Make sure your Web App has the APPINSIGHTS_INSTRUMENTATIONKEY setting with the same instrumentation key used by Application Insights SDK.</span></span>
4. <span data-ttu-id="573f9-226">Assurez-vous que votre application web s’exécute sur .Net Framework 4.6.</span><span class="sxs-lookup"><span data-stu-id="573f9-226">Make sure your Web App is running on .Net Framework 4.6.</span></span>
5. <span data-ttu-id="573f9-227">S’il s’agit d’une application ASP.NET Core, vérifiez également [les dépendances requises](#aspnetcore).</span><span class="sxs-lookup"><span data-stu-id="573f9-227">If it's an ASP.NET Core application, please also check [the required dependencies](#aspnetcore).</span></span>

<span data-ttu-id="573f9-228">Après le démarrage du profileur, vous devez vous attendre à une courte période de mise en route au cours de laquelle le profileur collecte activement plusieurs traces de performances.</span><span class="sxs-lookup"><span data-stu-id="573f9-228">After the profiler is started, there is a short warm-up period when the profiler actively collects several performance traces.</span></span> <span data-ttu-id="573f9-229">Après cela, le profileur collecte des traces de performances pendant deux minutes, toutes les heures.</span><span class="sxs-lookup"><span data-stu-id="573f9-229">After that, the profiler collects performance traces for two minutes in every hour.</span></span>  

### <a name="i-was-using-azure-service-profiler-what-happened-to-it"></a><span data-ttu-id="573f9-230">J’utilisais avant l’agent Azure Service Profiler.</span><span class="sxs-lookup"><span data-stu-id="573f9-230">I was using Azure Service Profiler.</span></span> <span data-ttu-id="573f9-231">Qu’est-il devenu ?</span><span class="sxs-lookup"><span data-stu-id="573f9-231">What happened to it?</span></span>  

<span data-ttu-id="573f9-232">Lorsque vous activez le profileur d’Application Insights, l’agent Azure Service Profiler est désactivé.</span><span class="sxs-lookup"><span data-stu-id="573f9-232">When you enable Application Insights Profiler, Azure Service Profiler agent is disabled.</span></span>

### <span data-ttu-id="573f9-233"><a id="double-counting"></a>Double comptage dans des threads parallèles</span><span class="sxs-lookup"><span data-stu-id="573f9-233"><a id="double-counting"></a>Double counting in parallel threads</span></span>

<span data-ttu-id="573f9-234">Dans certains cas, la mesure du temps total dans la visionneuse de pile est supérieure à la durée réelle de la requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-234">In some cases the total time metric in the stack viewer is more than the actual duration of the request.</span></span>

<span data-ttu-id="573f9-235">Cela peut se produire lorsque deux threads au moins sont associés à une requête et qu’ils s’exécutent en parallèle.</span><span class="sxs-lookup"><span data-stu-id="573f9-235">This can happen when there are two or more threads associated with a request, operating in parallel.</span></span> <span data-ttu-id="573f9-236">Le temps total de threads est alors supérieur au temps écoulé.</span><span class="sxs-lookup"><span data-stu-id="573f9-236">The total thread time is then more than the elapsed time.</span></span> <span data-ttu-id="573f9-237">Dans de nombreux cas, un thread peut être en attente le temps que l’autre se termine.</span><span class="sxs-lookup"><span data-stu-id="573f9-237">In many cases one thread may be waiting on the other to complete.</span></span> <span data-ttu-id="573f9-238">La visionneuse tente de détecter et d’omettre les attentes sans intérêt, mais se trompe en affichant trop d’informations plutôt qu’en omettant ce qui pourrait être des informations critiques.</span><span class="sxs-lookup"><span data-stu-id="573f9-238">The viewer tries to detect this and omit the uninteresting wait, but errs on the side of showing too much rather than omitting what may be critical information.</span></span>  

<span data-ttu-id="573f9-239">Lorsque vous voyez des threads parallèles dans vos traces, vous devez identifier les threads en attente afin de déterminer le chemin critique pour la requête.</span><span class="sxs-lookup"><span data-stu-id="573f9-239">When you see parallel threads in your traces, you need to determine which threads are waiting so you can determine the critical path for the request.</span></span> <span data-ttu-id="573f9-240">Dans la plupart des cas, le thread qui passe rapidement à un état d’attente attend simplement les autres threads.</span><span class="sxs-lookup"><span data-stu-id="573f9-240">In most cases, the thread that quickly goes into a wait state is simply waiting on the other threads.</span></span> <span data-ttu-id="573f9-241">Concentrez-vous sur ces autres threads et ignorez le temps dans les threads en attente.</span><span class="sxs-lookup"><span data-stu-id="573f9-241">Concentrate on the others and ignore the time in the waiting threads.</span></span>

### <span data-ttu-id="573f9-242"><a id="issue-loading-trace-in-viewer"></a>Aucune donnée de profilage</span><span class="sxs-lookup"><span data-stu-id="573f9-242"><a id="issue-loading-trace-in-viewer"></a>No profiling data</span></span>

1. <span data-ttu-id="573f9-243">Si les données que vous essayez d’afficher datent d’il y a plus de deux semaines, essayez de limiter votre filtre de temps puis réessayez.</span><span class="sxs-lookup"><span data-stu-id="573f9-243">If the data you are trying to view is older than a couple of weeks, try limiting your time filter and try again.</span></span>

2. <span data-ttu-id="573f9-244">Vérifiez que votre proxy ou pare-feu n’a pas bloqué l’accès à https://gateway.azureserviceprofiler.net.</span><span class="sxs-lookup"><span data-stu-id="573f9-244">Check that proxies or a firewall have not blocked access to https://gateway.azureserviceprofiler.net.</span></span>

3. <span data-ttu-id="573f9-245">Vérifiez que la clé d’instrumentation Application Insights que vous utilisez dans votre application est identique à celle de la ressource Application Insights avec laquelle vous avez activé le profilage.</span><span class="sxs-lookup"><span data-stu-id="573f9-245">Check that the Application Insights instrumentation key you are using in your app is the same as the Application Insights resource you've enabled profiling with.</span></span> <span data-ttu-id="573f9-246">La clé figure généralement dans ApplicationInsights.config, mais vous pouvez également la trouver dans le fichier web.config ou app.config.</span><span class="sxs-lookup"><span data-stu-id="573f9-246">The key is usually in ApplicationInsights.config but can also be found in web.config or app.config.</span></span>

### <a name="error-report-in-the-profiling-viewer"></a><span data-ttu-id="573f9-247">Rapport d’erreurs dans la visionneuse de profilage</span><span class="sxs-lookup"><span data-stu-id="573f9-247">Error report in the profiling viewer</span></span>

<span data-ttu-id="573f9-248">Émettez un ticket de support à partir du portail.</span><span class="sxs-lookup"><span data-stu-id="573f9-248">File a support ticket from the portal.</span></span> <span data-ttu-id="573f9-249">Pensez à indiquer l’ID de corrélation du message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="573f9-249">Please include the correlation ID from the error message.</span></span>

## <a name="manual-installation"></a><span data-ttu-id="573f9-250">Installation manuelle</span><span class="sxs-lookup"><span data-stu-id="573f9-250">Manual installation</span></span>

<span data-ttu-id="573f9-251">Lorsque vous configurez le profileur, les mises à jour suivantes sont appliquées aux paramètres de Web App.</span><span class="sxs-lookup"><span data-stu-id="573f9-251">When you configure the profiler, the following updates are made to the Web App's settings.</span></span> <span data-ttu-id="573f9-252">Vous pouvez les effectuer manuellement par vous-même si votre environnement le requiert, par exemple, si votre application s’exécute dans l’environnement Azure App Service (ASE) :</span><span class="sxs-lookup"><span data-stu-id="573f9-252">You can do them yourself manually if your environment requires, for example, if your application runs in Azure App Service Environment (ASE):</span></span>

1. <span data-ttu-id="573f9-253">Dans le panneau de contrôle de l’application web, ouvrez Paramètres.</span><span class="sxs-lookup"><span data-stu-id="573f9-253">In the web app control blade, open Settings.</span></span>
2. <span data-ttu-id="573f9-254">Définissez « Version du .NET Framework » sur 4.6.</span><span class="sxs-lookup"><span data-stu-id="573f9-254">Set ".Net Framework version" to v4.6.</span></span>
3. <span data-ttu-id="573f9-255">Activez l’option « Toujours actif ».</span><span class="sxs-lookup"><span data-stu-id="573f9-255">Set "Always On" to On.</span></span>
4. <span data-ttu-id="573f9-256">Ajoutez le paramètre d’application « __APPINSIGHTS_INSTRUMENTATIONKEY__ » et définissez la valeur sur la même clé d’instrumentation que celle utilisée par le Kit de développement logiciel (SDK).</span><span class="sxs-lookup"><span data-stu-id="573f9-256">Add app setting "__APPINSIGHTS_INSTRUMENTATIONKEY__" and set the value to the same instrumentation key used by the SDK.</span></span>
5. <span data-ttu-id="573f9-257">Ouvrez Outils avancés.</span><span class="sxs-lookup"><span data-stu-id="573f9-257">Open Advanced Tools.</span></span>
6. <span data-ttu-id="573f9-258">Cliquez sur « Go » pour ouvrir le site web Kudu.</span><span class="sxs-lookup"><span data-stu-id="573f9-258">Click "Go" to open the Kudu website.</span></span>
7. <span data-ttu-id="573f9-259">Sur le site web Kudu, sélectionnez « Site extensions » (Extensions de site).</span><span class="sxs-lookup"><span data-stu-id="573f9-259">In the Kudu website, select "Site extensions".</span></span>
8. <span data-ttu-id="573f9-260">Installez « __Application Insights__ »à partir de la galerie.</span><span class="sxs-lookup"><span data-stu-id="573f9-260">Install "__Application Insights__" from Gallery.</span></span>
9. <span data-ttu-id="573f9-261">Redémarrez l’application web.</span><span class="sxs-lookup"><span data-stu-id="573f9-261">Restart the web app.</span></span>

## <span data-ttu-id="573f9-262"><a id="aspnetcore"></a>Prise en charge d’ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="573f9-262"><a id="aspnetcore"></a>ASP.NET Core Support</span></span>

<span data-ttu-id="573f9-263">L’application ASP.NET Core doit installer le package Nuget Microsoft.ApplicationInsights.AspNetCore 2.1.0-beta6 ou une version supérieure pour fonctionner avec le profileur.</span><span class="sxs-lookup"><span data-stu-id="573f9-263">ASP.NET Core application needs to install Microsoft.ApplicationInsights.AspNetCore Nuget package 2.1.0-beta6 or higher to work with the Profiler.</span></span> <span data-ttu-id="573f9-264">Les versions antérieures au 27/06/2017 ne sont plus prises en charge.</span><span class="sxs-lookup"><span data-stu-id="573f9-264">We no longer support the lower versions after 6/27/2017.</span></span>

## <a name="next-steps"></a><span data-ttu-id="573f9-265">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="573f9-265">Next steps</span></span>

* [<span data-ttu-id="573f9-266">Utilisation d’Application Insights dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="573f9-266">Working with Application Insights in Visual Studio</span></span>](https://docs.microsoft.com/azure/application-insights/app-insights-visual-studio)

[performance-blade]: ./media/app-insights-profiler/performance-blade.png
[performance-blade-examples]: ./media/app-insights-profiler/performance-blade-examples.png
[trace-explorer]: ./media/app-insights-profiler/trace-explorer.png
[trace-explorer-toolbar]: ./media/app-insights-profiler/trace-explorer-toolbar.png
[trace-explorer-hint-tip]: ./media/app-insights-profiler/trace-explorer-hint-tip.png
[trace-explorer-hot-path]: ./media/app-insights-profiler/trace-explorer-hot-path.png
[enable-profiler-banner]: ./media/app-insights-profiler/enable-profiler-banner.png
[disable-profiler-webjob]: ./media/app-insights-profiler/disable-profiler-webjob.png
[linked app services]: ./media/app-insights-profiler/linked-app-services.png
