---
title: "Activer l’accès distant à SharePoint avec le proxy d’application Azure AD | Microsoft Docs"
description: "Aborde les notions de base relatives à l’intégration d’un serveur SharePoint local au proxy d’application Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/21/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: it-pro
ms.openlocfilehash: 97eeec3b3936bcbef6ac3966b890332901bcb153
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="enable-remote-access-to-sharepoint-with-azure-ad-application-proxy"></a><span data-ttu-id="00d4d-103">Activer l’accès distant à SharePoint avec le proxy d’application Azure AD</span><span class="sxs-lookup"><span data-stu-id="00d4d-103">Enable remote access to SharePoint with Azure AD Application Proxy</span></span>

<span data-ttu-id="00d4d-104">Cet article explique comment intégrer un serveur SharePoint local au proxy d’application Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="00d4d-104">This article discusses how to integrate an on-premises SharePoint server with Azure Active Directory (Azure AD) Application Proxy.</span></span>

<span data-ttu-id="00d4d-105">Pour activer l’accès à distance à SharePoint avec le proxy d’application Azure AD, suivez les sections de cet article étape par étape.</span><span class="sxs-lookup"><span data-stu-id="00d4d-105">To enable remote access to SharePoint with Azure AD Application Proxy, follow the sections in this article step by step.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="00d4d-106">Composants requis</span><span class="sxs-lookup"><span data-stu-id="00d4d-106">Prerequisites</span></span>

<span data-ttu-id="00d4d-107">Cet article suppose que vous avez déjà SharePoint 2013 ou une version plus récente dans votre environnement.</span><span class="sxs-lookup"><span data-stu-id="00d4d-107">This article assumes that you already have SharePoint 2013 or newer in your environment.</span></span> <span data-ttu-id="00d4d-108">En outre, prenez en compte les conditions préalables suivantes :</span><span class="sxs-lookup"><span data-stu-id="00d4d-108">In addition, consider the following prerequisites:</span></span>

* <span data-ttu-id="00d4d-109">SharePoint comprend la prise en charge native de Kerberos.</span><span class="sxs-lookup"><span data-stu-id="00d4d-109">SharePoint includes native Kerberos support.</span></span> <span data-ttu-id="00d4d-110">Ainsi, les utilisateurs qui accèdent à des sites internes à distance à l’aide du proxy d’application Azure AD peuvent s’attendre à une expérience d’authentification unique (SSO).</span><span class="sxs-lookup"><span data-stu-id="00d4d-110">Therefore, users who are accessing internal sites remotely through Azure AD Application Proxy can assume to have a single sign-on (SSO) experience.</span></span>

* <span data-ttu-id="00d4d-111">Vous devez apporter quelques modifications de configuration sur votre serveur SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-111">You need to make a few configuration changes to your SharePoint server.</span></span> <span data-ttu-id="00d4d-112">Nous vous recommandons d’utiliser un environnement intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="00d4d-112">We recommend using a staging environment.</span></span> <span data-ttu-id="00d4d-113">Ainsi, vous pouvez d’abord mettre à jour votre serveur de test, puis faciliter un cycle de test avant de passer en production.</span><span class="sxs-lookup"><span data-stu-id="00d4d-113">This way, you can make updates to your staging server first, and then facilitate a testing cycle before going into production.</span></span>

* <span data-ttu-id="00d4d-114">Nous partons du principe que vous avez déjà configuré SSL pour SharePoint, car nous exigeons SSL sur l’URL publiée.</span><span class="sxs-lookup"><span data-stu-id="00d4d-114">We assume that you have already set up SSL for SharePoint, because we require SSL on the published URL.</span></span> <span data-ttu-id="00d4d-115">SSL doit être activé sur votre site interne, afin de garantir que les liens sont envoyés/mappés correctement.</span><span class="sxs-lookup"><span data-stu-id="00d4d-115">You need to have SSL enabled on your internal site, to ensure that links are sent/mapped correctly.</span></span> <span data-ttu-id="00d4d-116">Si vous n’avez pas configuré SSL, consultez le blog [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) pour obtenir des instructions.</span><span class="sxs-lookup"><span data-stu-id="00d4d-116">If you haven't configured SSL, see [Configure SSL for SharePoint 2013](https://blogs.msdn.microsoft.com/fabdulwahab/2013/01/20/configure-ssl-for-sharepoint-2013) for instructions.</span></span> <span data-ttu-id="00d4d-117">En outre, assurez-vous que l’ordinateur du connecteur approuve le certificat que vous émettez.</span><span class="sxs-lookup"><span data-stu-id="00d4d-117">Also, make sure that the connector machine trusts the certificate that you issue.</span></span> <span data-ttu-id="00d4d-118">(Ce certificat doit pas nécessairement être émis publiquement.)</span><span class="sxs-lookup"><span data-stu-id="00d4d-118">(The certificate does not need to be publicly issued.)</span></span>

## <a name="step-1-set-up-single-sign-on-to-sharepoint"></a><span data-ttu-id="00d4d-119">Étape 1 : Configurer l’authentification unique auprès de SharePoint</span><span class="sxs-lookup"><span data-stu-id="00d4d-119">Step 1: Set up single sign-on to SharePoint</span></span>

<span data-ttu-id="00d4d-120">Nos clients veulent bénéficier de la meilleure expérience SSO pour leurs applications principales, un serveur SharePoint dans le cas présent.</span><span class="sxs-lookup"><span data-stu-id="00d4d-120">Our customers want the best SSO experience for their back-end applications, SharePoint server in this case.</span></span> <span data-ttu-id="00d4d-121">Dans ce scénario Azure AD courant, l’utilisateur est authentifié une seule fois, car il ne sera pas invité à le faire à nouveau.</span><span class="sxs-lookup"><span data-stu-id="00d4d-121">In this common Azure AD scenario, the user is authenticated only once, because they will not be prompted for authentication again.</span></span>

<span data-ttu-id="00d4d-122">Pour les applications locales qui exigent ou utilisent l’authentification Windows, vous pouvez obtenir l’authentification unique (SSO) à l’aide du protocole d’authentification Kerberos et d’une fonctionnalité appelée « délégation Kerberos contrainte (KCD) ».</span><span class="sxs-lookup"><span data-stu-id="00d4d-122">For on-premises applications that require or use Windows authentication, you can achieve SSO by using the Kerberos authentication protocol and a feature called Kerberos constrained delegation (KCD).</span></span> <span data-ttu-id="00d4d-123">Quand elle est configurée, la délégation KCD permet au connecteur de proxy d’application d’obtenir un ticket/jeton Windows pour un utilisateur, même si ce dernier ne s’est pas connecté directement à Windows.</span><span class="sxs-lookup"><span data-stu-id="00d4d-123">KCD, when configured, allows the Application Proxy connector to obtain a windows ticket/token for a user, even if the user hasn’t signed in to Windows directly.</span></span> <span data-ttu-id="00d4d-124">Pour en savoir plus sur la KCD, consultez [Présentation de la délégation Kerberos contrainte](https://technet.microsoft.com/library/jj553400.aspx).</span><span class="sxs-lookup"><span data-stu-id="00d4d-124">To learn more about KCD, see [Kerberos Constrained Delegation Overview](https://technet.microsoft.com/library/jj553400.aspx).</span></span>

<span data-ttu-id="00d4d-125">Pour configurer la délégation KCD pour un serveur SharePoint, utilisez les procédures décrites dans les sections séquentielles suivantes :</span><span class="sxs-lookup"><span data-stu-id="00d4d-125">To set up KCD for a SharePoint server, use the procedures in the following sequential sections:</span></span>

### <a name="ensure-that-sharepoint-is-running-under-a-service-account"></a><span data-ttu-id="00d4d-126">Vérifier que SharePoint s’exécute sous un compte de service</span><span class="sxs-lookup"><span data-stu-id="00d4d-126">Ensure that SharePoint is running under a service account</span></span>

<span data-ttu-id="00d4d-127">Tout d’abord, vérifiez que SharePoint s’exécute sous un compte de service défini, et non sous le système local, le service local ou le service réseau.</span><span class="sxs-lookup"><span data-stu-id="00d4d-127">First, make sure that SharePoint is running under a defined service account--not local system, local service, or network service.</span></span> <span data-ttu-id="00d4d-128">Effectuez cette opération afin de pouvoir attacher les noms de principal de service (SPN) à un compte valide.</span><span class="sxs-lookup"><span data-stu-id="00d4d-128">Do this so that you can attach service principal names (SPNs) to a valid account.</span></span> <span data-ttu-id="00d4d-129">Les SPN sont la façon dont le protocole Kerberos identifie les différents services.</span><span class="sxs-lookup"><span data-stu-id="00d4d-129">SPNs are how the Kerberos protocol identifies different services.</span></span> <span data-ttu-id="00d4d-130">De plus, vous aurez besoin de ce compte plus tard pour configurer la délégation KCD.</span><span class="sxs-lookup"><span data-stu-id="00d4d-130">And you will need the account later to configure the KCD.</span></span>

<span data-ttu-id="00d4d-131">Pour vous assurer que vos sites sont en cours d’exécution sous un compte de service défini, effectuez les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="00d4d-131">To ensure that your sites are running under a defined service account, perform the following steps:</span></span>

1. <span data-ttu-id="00d4d-132">Ouvrez le site **Administration centrale de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-132">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="00d4d-133">Accédez à **Sécurité**, puis sélectionnez **Configurer les comptes de service**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-133">Go to **Security** and select **Configure service accounts**.</span></span>
3. <span data-ttu-id="00d4d-134">Sélectionnez **Pool d’applications web - SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-134">Select **Web Application Pool - SharePoint - 80**.</span></span> <span data-ttu-id="00d4d-135">Les options peuvent être légèrement différentes en fonction du nom de votre pool web, ou si le pool web utilise SSL par défaut.</span><span class="sxs-lookup"><span data-stu-id="00d4d-135">The options may be slightly different based on the name of your web pool, or if the web pool uses SSL by default.</span></span>

  ![Choix disponibles pour configurer un compte de service](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-web-application.png)

4. <span data-ttu-id="00d4d-137">Si **Sélectionnez un compte pour ce composant** a la valeur **Service local** ou **Service réseau**, vous devez créer un compte.</span><span class="sxs-lookup"><span data-stu-id="00d4d-137">If **Select an account for this component** is **Local Service** or **Network Service**, you need to create an account.</span></span> <span data-ttu-id="00d4d-138">Si ce n’est pas le cas, vous avez terminé et pouvez passer à la section suivante.</span><span class="sxs-lookup"><span data-stu-id="00d4d-138">If not, you're finished and can move to the next section.</span></span>
5. <span data-ttu-id="00d4d-139">Choisissez **Enregistrer le nouveau compte géré**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-139">Select **Register new managed account**.</span></span> <span data-ttu-id="00d4d-140">Une fois votre compte créé, vous devez définir l’option **Pool d’applications web** pour pouvoir utiliser le compte.</span><span class="sxs-lookup"><span data-stu-id="00d4d-140">After your account is created, you must set **Web Application Pool** before you can use the account.</span></span>

> [!NOTE]
<span data-ttu-id="00d4d-141">Vous devez disposer d’un compte Azure AD précédemment créé pour le service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-141">You need to have a previously created Azure AD account for the service.</span></span> <span data-ttu-id="00d4d-142">Nous vous suggérons d’autoriser une modification de mot de passe automatique.</span><span class="sxs-lookup"><span data-stu-id="00d4d-142">We suggest that you allow for an automatic password change.</span></span> <span data-ttu-id="00d4d-143">Pour plus d’informations sur l’ensemble des étapes et la résolution des problèmes, consultez [Configurer la modification automatique de mot de passe dans SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span><span class="sxs-lookup"><span data-stu-id="00d4d-143">For more information about the full set of steps and troubleshooting issues, see [Configure automatic password change in SharePoint 2013](https://technet.microsoft.com/library/ff724280.aspx).</span></span>

### <a name="configure-sharepoint-for-kerberos"></a><span data-ttu-id="00d4d-144">Configurer SharePoint pour Kerberos</span><span class="sxs-lookup"><span data-stu-id="00d4d-144">Configure SharePoint for Kerberos</span></span>

<span data-ttu-id="00d4d-145">Vous utilisez la délégation KCD pour effectuer l’authentification unique auprès du serveur SharePoint, et cela fonctionne uniquement avec le protocole Kerberos.</span><span class="sxs-lookup"><span data-stu-id="00d4d-145">You use KCD to perform single sign-on to the SharePoint server, and this works only with Kerberos.</span></span>

<span data-ttu-id="00d4d-146">Pour configurer votre site SharePoint pour l’authentification Kerberos :</span><span class="sxs-lookup"><span data-stu-id="00d4d-146">To configure your SharePoint site for Kerberos authentication:</span></span>

1. <span data-ttu-id="00d4d-147">Ouvrez le site **Administration centrale de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-147">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="00d4d-148">Accédez à **Gestion des applications**, sélectionnez **Gérer les applications web**, puis sélectionnez votre site SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-148">Go to **Application Management**, select **Manage web applications**, and select your SharePoint site.</span></span> <span data-ttu-id="00d4d-149">Dans cet exemple, il s’agit de **SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-149">In this example, it is **SharePoint - 80**.</span></span>

  ![Sélection du site SharePoint](./media/application-proxy-remote-sharepoint/remote-sharepoint-manage-web-applications.png)

3. <span data-ttu-id="00d4d-151">Cliquez sur **Fournisseurs d’authentification** dans la barre d’outils.</span><span class="sxs-lookup"><span data-stu-id="00d4d-151">Click **Authentication Providers** on the toolbar.</span></span>
4. <span data-ttu-id="00d4d-152">Dans la zone **Fournisseurs d’authentification**, cliquez sur **Zone par défaut** pour afficher les paramètres.</span><span class="sxs-lookup"><span data-stu-id="00d4d-152">In the **Authentication Providers** box, click **Default Zone** to view the settings.</span></span>
5. <span data-ttu-id="00d4d-153">Dans la boîte de dialogue **Modifier l’authentification**, faites défiler l’affichage vers le bas jusqu’à ce que vous voyiez **Types d’authentification basée sur les revendications**, puis vérifiez que les deux options **Activer l’authentification Windows** et **Authentification Windows intégrée** sont sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="00d4d-153">In the **Edit Authentication** dialog box, scroll down until you see **Claims Authentication Types** and ensure that both **Enable Windows Authentication** and **Integrated Windows Authentication** are selected.</span></span>
6. <span data-ttu-id="00d4d-154">Dans la zone de liste déroulante, vérifiez que l’option **Négocier (Kerberos)** est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="00d4d-154">In the drop-down box, make sure that **Negotiate (Kerberos)** is selected.</span></span>

  ![Boîte de dialogue Modifier l’authentification](./media/application-proxy-remote-sharepoint/remote-sharepoint-service-edit-authentication.png)

7. <span data-ttu-id="00d4d-156">En bas de la boîte de dialogue **Modifier l’authentification**, cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-156">At the bottom of the **Edit Authentication** dialog box, click **Save**.</span></span>

### <a name="set-a-service-principal-name-for-the-sharepoint-service-account"></a><span data-ttu-id="00d4d-157">Définir un nom de principal de service pour le compte de service SharePoint</span><span class="sxs-lookup"><span data-stu-id="00d4d-157">Set a service principal name for the SharePoint service account</span></span>

<span data-ttu-id="00d4d-158">Avant de configurer la délégation KCD, vous devez identifier le service SharePoint en cours d’exécution comme compte de service que vous avez configuré.</span><span class="sxs-lookup"><span data-stu-id="00d4d-158">Before you configure the KCD, you need to identify the SharePoint service running as the service account that you've configured.</span></span> <span data-ttu-id="00d4d-159">Pour cela, définissez un nom de principal de service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-159">You do this by setting an SPN.</span></span> <span data-ttu-id="00d4d-160">Pour plus d'informations, consultez la page [Noms de principal de service](https://technet.microsoft.com/library/cc961723.aspx).</span><span class="sxs-lookup"><span data-stu-id="00d4d-160">For more information, see [Service Principal Names](https://technet.microsoft.com/library/cc961723.aspx).</span></span>

<span data-ttu-id="00d4d-161">Le format du nom de principal de service est :</span><span class="sxs-lookup"><span data-stu-id="00d4d-161">The SPN format is:</span></span>

```
<service class>/<host>:<port>
```

<span data-ttu-id="00d4d-162">Dans le format du nom de principal de service :</span><span class="sxs-lookup"><span data-stu-id="00d4d-162">In the SPN format:</span></span>

* <span data-ttu-id="00d4d-163">_service class_ est un nom unique pour le service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-163">_service class_ is a unique name for the service.</span></span> <span data-ttu-id="00d4d-164">Pour SharePoint, vous utilisez **HTTP**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-164">For SharePoint, you use **HTTP**.</span></span>

* <span data-ttu-id="00d4d-165">_host_ est le nom de domaine complet ou le nom NetBIOS de l’hôte sur lequel le service est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="00d4d-165">_host_ is the fully qualified domain or NetBIOS name of the host that the service is running on.</span></span> <span data-ttu-id="00d4d-166">Pour un site SharePoint, ce texte peut devoir être l’URL du site, en fonction de la version d’IIS que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="00d4d-166">For a SharePoint site, this text might need to be the URL of the site, depending on the version of IIS that you're using.</span></span>

* <span data-ttu-id="00d4d-167">_port_ est facultatif.</span><span class="sxs-lookup"><span data-stu-id="00d4d-167">_port_ is optional.</span></span>

<span data-ttu-id="00d4d-168">Si le nom de domaine complet du serveur SharePoint est :</span><span class="sxs-lookup"><span data-stu-id="00d4d-168">If the FQDN of the SharePoint server is:</span></span>

```
sharepoint.demo.o365identity.us
```

<span data-ttu-id="00d4d-169">Le nom de principal de service est alors :</span><span class="sxs-lookup"><span data-stu-id="00d4d-169">Then the SPN is:</span></span>

```
HTTP/ sharepoint.demo.o365identity.us demo
```

<span data-ttu-id="00d4d-170">Vous devrez peut-être également définir des noms de principal de service pour des sites spécifiques sur votre serveur.</span><span class="sxs-lookup"><span data-stu-id="00d4d-170">You might also need to set SPNs for specific sites on your server.</span></span> <span data-ttu-id="00d4d-171">Pour plus d’informations, consultez [Configurer l’authentification Kerberos](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span><span class="sxs-lookup"><span data-stu-id="00d4d-171">For more information, see [Configure Kerberos authentication](https://technet.microsoft.com/library/cc263449(v=office.12).aspx).</span></span> <span data-ttu-id="00d4d-172">Prêtez une attention particulière à la section « Créer des noms de principal de service pour vos applications web à l’aide de l’authentification Kerberos ».</span><span class="sxs-lookup"><span data-stu-id="00d4d-172">Pay close attention to the section "Create Service Principal Names for your Web applications using Kerberos authentication."</span></span>

<span data-ttu-id="00d4d-173">Le moyen le plus simple pour définir des noms de principal de service (SPN) consiste à suivre les formats de SPN qui peuvent déjà être présents pour votre site.</span><span class="sxs-lookup"><span data-stu-id="00d4d-173">The easiest way for you to set SPNs is to follow the SPN formats that may already be present for your sites.</span></span> <span data-ttu-id="00d4d-174">Copiez ces SPN pour les inscrire dans le compte de service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-174">Copy those SPNs to register against the service account.</span></span> <span data-ttu-id="00d4d-175">Pour ce faire :</span><span class="sxs-lookup"><span data-stu-id="00d4d-175">To do this:</span></span>

1. <span data-ttu-id="00d4d-176">Accédez au site avec le SPN à partir d’un autre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="00d4d-176">Browse to the site with the SPN from another machine.</span></span>
 <span data-ttu-id="00d4d-177">L’ensemble des tickets Kerberos pertinents sont alors mis en cache sur l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="00d4d-177">When you do, the relevant set of Kerberos tickets is cached on the machine.</span></span> <span data-ttu-id="00d4d-178">Ces tickets contiennent le SPN du site cible auquel vous avez accédé.</span><span class="sxs-lookup"><span data-stu-id="00d4d-178">These tickets contain the SPN of the target site that you browsed to.</span></span>

2. <span data-ttu-id="00d4d-179">Vous pouvons extraire le SPN pour ce site à l’aide d’un outil appelé [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span><span class="sxs-lookup"><span data-stu-id="00d4d-179">You can pull the SPN for that site by using a tool called [Klist](http://web.mit.edu/kerberos/krb5-devel/doc/user/user_commands/klist.html).</span></span> <span data-ttu-id="00d4d-180">Dans une fenêtre de commande en cours d’exécution dans le même contexte que l’utilisateur qui a accédé au site dans le navigateur, exécutez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="00d4d-180">In a command window that's running in the same context as the user who accessed the site in the browser, run the following command:</span></span>
```
Klist
```
<span data-ttu-id="00d4d-181">Klist renvoie alors l’ensemble des SPN cibles.</span><span class="sxs-lookup"><span data-stu-id="00d4d-181">Klist then returns the set of target SPNs.</span></span> <span data-ttu-id="00d4d-182">Dans cet exemple, la valeur en surbrillance est le SPN nécessaire :</span><span class="sxs-lookup"><span data-stu-id="00d4d-182">In this example, the highlighted value is the SPN that's needed:</span></span>

  ![Exemples de résultats de l’outil Klist](./media/application-proxy-remote-sharepoint/remote-sharepoint-target-service.png)

4. <span data-ttu-id="00d4d-184">Maintenant que vous avez le SPN, vous devez vérifier qu’il est correctement configuré sur le compte de service que vous avez précédemment défini pour l’application web.</span><span class="sxs-lookup"><span data-stu-id="00d4d-184">Now that you have the SPN, you need to make sure that it's configured correctly on the service account that you set up for the web application earlier.</span></span> <span data-ttu-id="00d4d-185">Exécutez la commande suivante à partir de l’invite de commandes en tant qu’administrateur du domaine :</span><span class="sxs-lookup"><span data-stu-id="00d4d-185">Run the following command from the command prompt as an administrator of the domain:</span></span>

 ```
 setspn -S http/sharepoint.demo.o365identity.us demo\sp_svc
 ```

 <span data-ttu-id="00d4d-186">Cette commande définit le SPN pour le compte de service SharePoint en cours d’exécution en tant que _demo\sp_svc_.</span><span class="sxs-lookup"><span data-stu-id="00d4d-186">This command sets the SPN for the SharePoint service account running as _demo\sp_svc_.</span></span>

 <span data-ttu-id="00d4d-187">Remplacez _http/sharepoint.demo.o365identity.us_ par le nom de principal de service pour votre serveur et _demo\sp_svc_ par le compte de service dans votre environnement.</span><span class="sxs-lookup"><span data-stu-id="00d4d-187">Replace _http/sharepoint.demo.o365identity.us_ with the SPN for your server and _demo\sp_svc_ with the service account in your environment.</span></span> <span data-ttu-id="00d4d-188">La commande Setspn recherche le SPN avant de l’ajouter.</span><span class="sxs-lookup"><span data-stu-id="00d4d-188">The Setspn command searches for the SPN before it adds it.</span></span> <span data-ttu-id="00d4d-189">Dans le cas présent, l’erreur **Valeur de SPN dupliquée** peut s’afficher.</span><span class="sxs-lookup"><span data-stu-id="00d4d-189">In this case, you might see a **Duplicate SPN Value** error.</span></span> <span data-ttu-id="00d4d-190">Si vous voyez cette erreur, assurez-vous que la valeur est associée au compte de service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-190">If you see this error, make sure that the value is associated with the service account.</span></span>

<span data-ttu-id="00d4d-191">Vous pouvez vérifier que le SPN a été ajouté en exécutant la commande Setspn avec l’option -l.</span><span class="sxs-lookup"><span data-stu-id="00d4d-191">You can verify that the SPN was added by running the Setspn command with the -l option.</span></span> <span data-ttu-id="00d4d-192">Pour en savoir plus sur cette commande, consultez [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span><span class="sxs-lookup"><span data-stu-id="00d4d-192">To learn more about this command, see [Setspn](https://technet.microsoft.com/library/cc731241.aspx).</span></span>

### <a name="ensure-that-the-connector-is-set-as-a-trusted-delegate-to-sharepoint"></a><span data-ttu-id="00d4d-193">Vérifier que le connecteur est défini comme délégué approuvé sur SharePoint</span><span class="sxs-lookup"><span data-stu-id="00d4d-193">Ensure that the connector is set as a trusted delegate to SharePoint</span></span>

<span data-ttu-id="00d4d-194">Configurez la délégation KCD afin que le service de proxy d’application Azure AD puisse déléguer des identités d’utilisateur au service SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-194">Configure the KCD so that the Azure AD Application Proxy service can delegate user identities to the SharePoint service.</span></span> <span data-ttu-id="00d4d-195">Pour cela, vous activez le connecteur de proxy d’application pour récupérer les tickets Kerberos pour les utilisateurs qui ont été authentifiés dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="00d4d-195">You do this by enabling the Application Proxy connector to retrieve Kerberos tickets for your users who have been authenticated in Azure AD.</span></span> <span data-ttu-id="00d4d-196">Puis ce serveur transmet le contexte à l’application cible, ou SharePoint dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="00d4d-196">Then that server passes the context to the target application, or SharePoint in this case.</span></span>

<span data-ttu-id="00d4d-197">Pour configurer la délégation KCD, répétez les étapes suivantes pour chaque ordinateur connecteur :</span><span class="sxs-lookup"><span data-stu-id="00d4d-197">To configure the KCD, repeat the following steps for each connector machine:</span></span>

1. <span data-ttu-id="00d4d-198">Connectez-vous en tant qu’administrateur de domaine à un centre de données, puis ouvrez **Utilisateurs et ordinateurs Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-198">Log in as a domain administrator to a DC, and then open **Active Directory Users and Computers**.</span></span>
2. <span data-ttu-id="00d4d-199">Trouvez l’ordinateur sur lequel le connecteur est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="00d4d-199">Find the computer that the connector is running on.</span></span> <span data-ttu-id="00d4d-200">Dans cet exemple, il s’agit du même ordinateur que le serveur SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-200">In this example, it's the same SharePoint server.</span></span>
3. <span data-ttu-id="00d4d-201">Double-cliquez sur l’ordinateur, puis cliquez sur l’onglet **Délégation**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-201">Double-click the computer, and then click the **Delegation** tab.</span></span>
4. <span data-ttu-id="00d4d-202">Vérifiez que les paramètres des délégation sont définis sur **N’approuver cet ordinateur que pour la délégation aux services spécifiés**, puis sélectionnez **Utiliser tout protocole d’authentification**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-202">Ensure that the delegation settings are set to **Trust this computer for delegation to the specified services only**, and then select **Use any authentication protocol**.</span></span>

  ![Paramètres de délégation](./media/application-proxy-remote-sharepoint/remote-sharepoint-delegation-box.png)

5. <span data-ttu-id="00d4d-204">Cliquez sur le bouton **Ajouter**, cliquez sur **Utilisateurs et ordinateurs**, puis recherchez le compte de service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-204">Click the **Add** button, click **Users or Computers**, and locate the service account.</span></span>

  ![Ajout du SPN pour le compte de service](./media/application-proxy-remote-sharepoint/remote-sharepoint-users-computers.png)

6. <span data-ttu-id="00d4d-206">Dans la liste des noms de principal de service, sélectionnez celui que vous avez créé précédemment pour le compte de service.</span><span class="sxs-lookup"><span data-stu-id="00d4d-206">In the list of SPNs, select the one that you created earlier for the service account.</span></span>
7. <span data-ttu-id="00d4d-207">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-207">Click **OK**.</span></span> <span data-ttu-id="00d4d-208">Cliquez à nouveau sur **OK** pour enregistrer les modifications apportées.</span><span class="sxs-lookup"><span data-stu-id="00d4d-208">Click **OK** again to save the changes.</span></span>

## <a name="step-2-enable-remote-access-to-sharepoint"></a><span data-ttu-id="00d4d-209">Étape 2 : Activer l’accès à distance à SharePoint</span><span class="sxs-lookup"><span data-stu-id="00d4d-209">Step 2: Enable remote access to SharePoint</span></span>

<span data-ttu-id="00d4d-210">Maintenant que vous avez activé SharePoint pour Kerberos et configuré la délégation KCD, vous pouvez configurer l’authentification unique auprès de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-210">Now that you’ve enabled SharePoint for Kerberos and configured KCD, you're ready to set up single sign-on to SharePoint.</span></span> <span data-ttu-id="00d4d-211">Ensuite, à partir du connecteur, vous pouvez publier la batterie de serveurs SharePoint pour l’accès à distance à l’aide du proxy d’application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="00d4d-211">Then from the connector, you can publish the SharePoint farm for remote access through Azure AD Application Proxy.</span></span>

<span data-ttu-id="00d4d-212">Pour effectuer les étapes suivantes, vous devez être membre du rôle Administrateur global dans un compte Azure Active Directory de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="00d4d-212">To perform the following steps, you need to be a member of the Global Administrator Role in your organization's Azure Active Directory account.</span></span>

1. <span data-ttu-id="00d4d-213">Connectez-vous au [portail Azure](https://manage.windowsazure.com), puis recherchez votre client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="00d4d-213">Sign in to the [Azure portal](https://manage.windowsazure.com) and find your Azure AD tenant.</span></span>
2. <span data-ttu-id="00d4d-214">Cliquez sur **Applications**, puis sur **Ajouter**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-214">Click **Applications**, and then click **Add**.</span></span>
3. <span data-ttu-id="00d4d-215">Sélectionnez **Publier une application qui sera accessible depuis l’extérieur de votre réseau**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-215">Select **Publish an application that will be accessible from outside your network**.</span></span> <span data-ttu-id="00d4d-216">Si vous ne voyez pas cette option, assurez-vous qu’un compte Azure AD De base ou Premium est configuré dans le client.</span><span class="sxs-lookup"><span data-stu-id="00d4d-216">If you don’t see this option, make sure that you have Azure AD Basic or Premium set up in the tenant.</span></span>
4. <span data-ttu-id="00d4d-217">Renseignez chacune des options comme suit :</span><span class="sxs-lookup"><span data-stu-id="00d4d-217">Complete each of the options as follows:</span></span>
 * <span data-ttu-id="00d4d-218">**Nom** : utilisez la valeur de votre choix, par exemple **SharePoint**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-218">**Name**: Use any value that you want--for example, **SharePoint**.</span></span>
 * <span data-ttu-id="00d4d-219">**URL interne** : il s’agit de l’URL du site SharePoint en interne, par exemple **https://SharePoint/**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-219">**Internal URL**: This is the URL of the SharePoint site internally, such as **https://SharePoint/**.</span></span> <span data-ttu-id="00d4d-220">Dans cet exemple, veillez à utiliser le protocole **https**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-220">In this example, make sure to use **https**.</span></span>
 * <span data-ttu-id="00d4d-221">**Méthode de préauthentification** : sélectionnez **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-221">**Preauthentication Method**: Select **Azure Active Directory**.</span></span>

  ![Options d’ajout d’une application](./media/application-proxy-remote-sharepoint/remote-sharepoint-add-application.png)

5. <span data-ttu-id="00d4d-223">Une fois l’application publiée, cliquez sur l’onglet **Configurer**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-223">After the app is published, click the **Configure** tab.</span></span>
6. <span data-ttu-id="00d4d-224">Faites défiler jusqu'à l’option **Traduire l'URL dans les en-têtes**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-224">Scroll down to the option **Translate URL in Headers**.</span></span> <span data-ttu-id="00d4d-225">La valeur par défaut est **OUI**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-225">The default value is **YES**.</span></span> <span data-ttu-id="00d4d-226">Remplacez-la par **NON**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-226">Change it to **NO**.</span></span>

 <span data-ttu-id="00d4d-227">SharePoint utilise la valeur _En-tête d’hôte_ pour rechercher le site.</span><span class="sxs-lookup"><span data-stu-id="00d4d-227">SharePoint uses the _Host Header_ value to look up the site.</span></span> <span data-ttu-id="00d4d-228">Il génère également des liens en fonction de cette valeur.</span><span class="sxs-lookup"><span data-stu-id="00d4d-228">It also generates links based on this value.</span></span> <span data-ttu-id="00d4d-229">L’effet immédiat est de vérifier que tout lien généré par SharePoint est une URL publiée correctement définie pour utiliser l’URL externe.</span><span class="sxs-lookup"><span data-stu-id="00d4d-229">The net effect is to make sure that any link that SharePoint generates is a published URL that is correctly set to use the external URL.</span></span> <span data-ttu-id="00d4d-230">Définir la valeur sur **OUI** permet également au connecteur de transférer la demande à l’application principale.</span><span class="sxs-lookup"><span data-stu-id="00d4d-230">Setting the value to **YES** also enables the connector to forward the request to the back-end application.</span></span> <span data-ttu-id="00d4d-231">Toutefois, la valeur **NON** signifie que le connecteur n’envoie pas le nom d’hôte interne.</span><span class="sxs-lookup"><span data-stu-id="00d4d-231">However, setting the value to **NO** means that the connector will not send the internal host name.</span></span> <span data-ttu-id="00d4d-232">Au lieu de cela, il envoie l’en-tête d’hôte comme URL publiée à l’application principale.</span><span class="sxs-lookup"><span data-stu-id="00d4d-232">Instead, the connector sends the host header as the published URL to the back-end application.</span></span>

 <span data-ttu-id="00d4d-233">En outre, pour vous assurer que SharePoint accepte cette URL, vous devez effectuer une configuration supplémentaire sur le serveur SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-233">Also, to ensure that SharePoint accepts this URL, you need to complete one more configuration on the SharePoint server.</span></span> <span data-ttu-id="00d4d-234">Vous le ferez dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="00d4d-234">You'll do that in the next section.</span></span>

7. <span data-ttu-id="00d4d-235">Définissez **Méthode d’authentification interne** sur **Authentification Windows intégrée**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-235">Change **Internal Authentication Method** to **Integrated Windows Authentication**.</span></span> <span data-ttu-id="00d4d-236">Si votre client Azure AD utilise un nom d’utilisateur principal (UPN) dans le cloud différent de l’UPN local, n’oubliez pas de mettre également à jour **Identité de connexion déléguée**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-236">If your Azure AD tenant uses a UPN in the cloud that's different from the UPN on-premises, remember to update **Delegated Login Identity** as well.</span></span>
8. <span data-ttu-id="00d4d-237">Définissez l’option **SPN d’application interne** sur la valeur que vous avez définie précédemment.</span><span class="sxs-lookup"><span data-stu-id="00d4d-237">Set **Internal Application SPN** to the value that you set earlier.</span></span> <span data-ttu-id="00d4d-238">Par exemple, utilisez **http/sharepoint.demo.o365identity.us**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-238">For example, use **http/sharepoint.demo.o365identity.us**.</span></span>
9. <span data-ttu-id="00d4d-239">Affectez l’application à vos utilisateurs cibles.</span><span class="sxs-lookup"><span data-stu-id="00d4d-239">Assign the application to your target users.</span></span>

<span data-ttu-id="00d4d-240">Votre application doit ressembler à l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="00d4d-240">Your application should look similar to the following example:</span></span>

  ![Application achevée](./media/application-proxy-remote-sharepoint/remote-sharepoint-internal-application-spn.png)

## <a name="step-3-ensure-that-sharepoint-knows-about-the-external-url"></a><span data-ttu-id="00d4d-242">Étape 3 : Garantir que SharePoint connaît l’URL externe</span><span class="sxs-lookup"><span data-stu-id="00d4d-242">Step 3: Ensure that SharePoint knows about the external URL</span></span>

<span data-ttu-id="00d4d-243">La dernière étape à effectuer consiste à garantir que SharePoint peut trouver le site basé sur l’URL externe, afin qu’il génère des liens basés sur cette URL externe.</span><span class="sxs-lookup"><span data-stu-id="00d4d-243">Your last step to ensure that SharePoint can find the site based on the external URL, so that it will render links based on that external URL.</span></span> <span data-ttu-id="00d4d-244">Pour cela, configurez des mappages des accès de substitution pour le site SharePoint.</span><span class="sxs-lookup"><span data-stu-id="00d4d-244">You do this by configuring alternate access mappings for the SharePoint site.</span></span>

1. <span data-ttu-id="00d4d-245">Ouvrez le site **Administration centrale de SharePoint 2013**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-245">Open the **SharePoint 2013 Central Administration** site.</span></span>
2. <span data-ttu-id="00d4d-246">Sous **Paramètres système**, sélectionnez **Configurer des mappages d’accès alternatifs**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-246">Under **System Settings**, select **Configure Alternate Access Mappings**.</span></span>

 <span data-ttu-id="00d4d-247">Cela ouvre la zone **Mappages d’accès alternatif**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-247">This opens the **Alternate Access Mappings** box.</span></span>

  ![Zone Mappages des accès de substitution](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access1.png)

3. <span data-ttu-id="00d4d-249">Dans la liste déroulante à côté de **Collection de mappages des accès de substitution**, sélectionnez **Modifier la collection de mappages des accès de substitution**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-249">In the drop-down list beside **Alternate Access Mapping Collection**, select **Change Alternate Access Mapping Collection**.</span></span>
4. <span data-ttu-id="00d4d-250">Sélectionnez votre site, par exemple **SharePoint - 80**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-250">Select your site--for example, **SharePoint - 80**.</span></span>

  ![Sélection d’un site](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access2.png)

5. <span data-ttu-id="00d4d-252">Vous pouvez choisir d’ajouter l’URL publiée comme URL interne ou URL publique.</span><span class="sxs-lookup"><span data-stu-id="00d4d-252">You can choose to add the published URL as either an internal URL or a public URL.</span></span> <span data-ttu-id="00d4d-253">Cet exemple utilise une URL publique comme extranet.</span><span class="sxs-lookup"><span data-stu-id="00d4d-253">This example uses a public URL as the extranet.</span></span>
6. <span data-ttu-id="00d4d-254">Cliquez sur **Modifier les URL publiques** dans le chemin **Extranet**, puis entrez le chemin de l’application publiée, comme dans l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="00d4d-254">Click **Edit Public URLs** in the **Extranet** path, and then enter the path for the published application, as in the previous step.</span></span> <span data-ttu-id="00d4d-255">Par exemple, entrez **https://sharepoint-iddemo.msappproxy.net**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-255">For example, enter **https://sharepoint-iddemo.msappproxy.net**.</span></span>

  ![Saisie du chemin](./media/application-proxy-remote-sharepoint/remote-sharepoint-alternate-access3.png)

7. <span data-ttu-id="00d4d-257">Cliquez sur **Save**.</span><span class="sxs-lookup"><span data-stu-id="00d4d-257">Click **Save**.</span></span>

 <span data-ttu-id="00d4d-258">Vous pouvez maintenant accéder au site SharePoint en externe par l’intermédiaire du proxy d’application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="00d4d-258">You can now access the SharePoint site externally via Azure AD Application Proxy.</span></span>

## <a name="next-steps"></a><span data-ttu-id="00d4d-259">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="00d4d-259">Next steps</span></span>

- [<span data-ttu-id="00d4d-260">Offrir un accès à distance sécurisé aux applications locales</span><span class="sxs-lookup"><span data-stu-id="00d4d-260">How to provide secure remote access to on-premises applications</span></span>](active-directory-application-proxy-get-started.md)
- [<span data-ttu-id="00d4d-261">Présentation des connecteurs de proxy d’application Azure AD</span><span class="sxs-lookup"><span data-stu-id="00d4d-261">Understand Azure AD Application Proxy connectors</span></span>](application-proxy-understand-connectors.md)
- [<span data-ttu-id="00d4d-262">Publication de SharePoint 2016 et d’Office Online Server avec le proxy d’application Azure AD</span><span class="sxs-lookup"><span data-stu-id="00d4d-262">Publishing SharePoint 2016 and Office Online Server with Azure AD Application Proxy</span></span>](https://blogs.technet.microsoft.com/dawiese/2016/06/09/publishing-sharepoint-2016-and-office-online-server-with-azure-ad-application-proxy/)
