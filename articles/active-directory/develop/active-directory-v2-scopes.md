---
title: "Étendues, autorisations et consentement Azure Active Directory v2.0 | Microsoft Docs"
description: "Une description de l’autorisation dans le point de terminaison v2.0 Azure AD, relative notamment aux étendues, aux autorisations et aux consentements."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="de1b5-103">Étendues, autorisations et consentement dans le point de terminaison Azure Active Directory v2.0</span><span class="sxs-lookup"><span data-stu-id="de1b5-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="de1b5-104">Les applications intégrées à Azure Active Directory (Azure AD) suivent un modèle d’autorisation, qui permet aux utilisateurs de contrôler le mode d’accès d’une application à leurs données.</span><span class="sxs-lookup"><span data-stu-id="de1b5-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="de1b5-105">L’implémentation v2.0 de ce modèle d’autorisation a été mise à jour, et elle modifie la façon dont une application doit interagir avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="de1b5-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="de1b5-106">Cet article aborde les concepts de base de ce modèle d’autorisation, notamment les étendues, les autorisations et le consentement.</span><span class="sxs-lookup"><span data-stu-id="de1b5-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="de1b5-107">Le point de terminaison v2.0 ne prend pas en charge l’intégralité des scénarios et fonctionnalités d’Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="de1b5-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="de1b5-108">Pour déterminer si vous devez utiliser le point de terminaison v2.0, consultez les [limitations de v2.0](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="de1b5-109">Étendues et autorisations</span><span class="sxs-lookup"><span data-stu-id="de1b5-109">Scopes and permissions</span></span>
<span data-ttu-id="de1b5-110">Azure AD implémente le protocole d’autorisation [OAuth 2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="de1b5-111">OAuth 2.0 est une méthode par le biais de laquelle une application tierce peut accéder aux ressources hébergées sur le web au nom d’un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="de1b5-112">Les ressources hébergées sur le web qui s’intègrent à Azure AD présentent un identificateur de ressource, également appelé *URI d’ID d’application*.</span><span class="sxs-lookup"><span data-stu-id="de1b5-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="de1b5-113">Voici, par exemple, quelques-unes des ressources hébergées sur le Web de Microsoft :</span><span class="sxs-lookup"><span data-stu-id="de1b5-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="de1b5-114">L’API de messagerie unifiée Office 365 : `https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="de1b5-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="de1b5-115">L’API Graph Azure AD : `https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="de1b5-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="de1b5-116">Microsoft Graph : `https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="de1b5-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="de1b5-117">Cela s’applique également aux ressources tierces intégrées à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="de1b5-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="de1b5-118">Ces ressources peuvent également définir un ensemble d’autorisations à utiliser pour diviser la fonctionnalité de cette ressource en fragments plus réduits.</span><span class="sxs-lookup"><span data-stu-id="de1b5-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="de1b5-119">Par exemple, [Microsoft Graph](https://graph.microsoft.io) a défini des autorisations pour effectuer les tâches suivantes, entre autres :</span><span class="sxs-lookup"><span data-stu-id="de1b5-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="de1b5-120">Lire le calendrier d’un utilisateur</span><span class="sxs-lookup"><span data-stu-id="de1b5-120">Read a user's calendar</span></span>
* <span data-ttu-id="de1b5-121">Écrire dans le calendrier d’un utilisateur</span><span class="sxs-lookup"><span data-stu-id="de1b5-121">Write to a user's calendar</span></span>
* <span data-ttu-id="de1b5-122">Envoi de messages en tant qu’utilisateur</span><span class="sxs-lookup"><span data-stu-id="de1b5-122">Send mail as a user</span></span>

<span data-ttu-id="de1b5-123">En définissant ces types d’autorisation, la ressource dispose d’un contrôle affiné sur ses données et sur leur exposition.</span><span class="sxs-lookup"><span data-stu-id="de1b5-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="de1b5-124">Une application tierce peut demander ces autorisations à un utilisateur d’application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="de1b5-125">L’utilisateur d’application doit approuver les autorisations pour que l’application puisse agir pour le compte de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="de1b5-126">En fragmentant les fonctionnalités de la ressource en ensembles plus réduits d’autorisations, il est possible de créer des applications tierces pour qu’elles demandent uniquement les autorisations nécessaires à leur fonctionnement.</span><span class="sxs-lookup"><span data-stu-id="de1b5-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="de1b5-127">Les utilisateurs de l’application savent avec précision la manière dont les applications utilisent leurs données, et s’inquiètent moins de leur éventuelle intention malveillante.</span><span class="sxs-lookup"><span data-stu-id="de1b5-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="de1b5-128">Dans Azure AD et OAuth, ces types d’autorisation sont appelés des *étendues*.</span><span class="sxs-lookup"><span data-stu-id="de1b5-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="de1b5-129">Ils sont également parfois désignés sous le nom *d’autorisations oAuth2*.</span><span class="sxs-lookup"><span data-stu-id="de1b5-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="de1b5-130">Une étendue est représentée dans Azure AD en tant que valeur de chaîne.</span><span class="sxs-lookup"><span data-stu-id="de1b5-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="de1b5-131">Toujours dans l’exemple Microsoft Graph, la valeur d’étendue pour chaque autorisation est la suivante :</span><span class="sxs-lookup"><span data-stu-id="de1b5-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="de1b5-132">Lire le calendrier d’un utilisateur en utilisant `Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="de1b5-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="de1b5-133">Écrire dans le calendrier d’un utilisateur en utilisant `Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="de1b5-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="de1b5-134">Envoi de messages en tant qu’utilisateur en utilisant `Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="de1b5-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="de1b5-135">Une application peut demander ces autorisations en spécifiant les étendues dans les requêtes dirigées vers le point de terminaison v2.0.</span><span class="sxs-lookup"><span data-stu-id="de1b5-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="de1b5-136">Étendues OpenId Connect</span><span class="sxs-lookup"><span data-stu-id="de1b5-136">OpenID Connect scopes</span></span>
<span data-ttu-id="de1b5-137">L’implémentation v2.0 d’OpenID Connect comprend quelques étendues bien définies qui ne s’appliquent pas à une ressource particulière : `openid`, `email`, `profile` et `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="de1b5-138">openid</span><span class="sxs-lookup"><span data-stu-id="de1b5-138">openid</span></span>
<span data-ttu-id="de1b5-139">Si une application exécute la connexion à l’aide [d’OpenID Connect](active-directory-v2-protocols.md), elle doit solliciter l’étendue `openid`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="de1b5-140">L’étendue `openid` s’affiche sur la page de consentement du compte professionnel, en tant qu’autorisation de connexion, et sur la page de consentement du compte Microsoft personnel en tant qu’autorisation « Afficher votre profil et se connecter aux applications et aux services à l’aide de votre compte Microsoft ».</span><span class="sxs-lookup"><span data-stu-id="de1b5-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="de1b5-141">Avec cette autorisation, une application peut recevoir un identifiant utilisateur unique sous la forme de la revendication `sub`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="de1b5-142">Elle permet également à l’application d’accéder au point de terminaison des informations utilisateur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="de1b5-143">L’étendue `openid` peut être utilisée sur le point de terminaison de jeton v2.0 afin d’acquérir des jetons d’ID, qui peuvent être sollicités pour sécuriser les appels HTTP entre différents composants d’une application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="de1b5-144">email</span><span class="sxs-lookup"><span data-stu-id="de1b5-144">email</span></span>
<span data-ttu-id="de1b5-145">L’étendue `email` peut être utilisée avec l’étendue `openid` ainsi que d’autres.</span><span class="sxs-lookup"><span data-stu-id="de1b5-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="de1b5-146">Elle permet à l’application d’accéder à l’adresse de messagerie principale de l’utilisateur sous la forme de la revendication `email`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="de1b5-147">La revendication `email` est incluse dans un jeton uniquement si une adresse de messagerie est associée au compte d’utilisateur, ce qui n’est pas toujours le cas.</span><span class="sxs-lookup"><span data-stu-id="de1b5-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="de1b5-148">Si elle utilise l’étendue `email`, votre application doit être préparée à faire face à l’éventualité où la revendication `email` n’existerait pas dans le jeton.</span><span class="sxs-lookup"><span data-stu-id="de1b5-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="de1b5-149">Profil</span><span class="sxs-lookup"><span data-stu-id="de1b5-149">profile</span></span>
<span data-ttu-id="de1b5-150">L’étendue `profile` peut être utilisée avec l’étendue `openid` ainsi que d’autres.</span><span class="sxs-lookup"><span data-stu-id="de1b5-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="de1b5-151">Elle permet à l’application d’accéder à une quantité d’informations importante sur l’utilisateur,</span><span class="sxs-lookup"><span data-stu-id="de1b5-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="de1b5-152">notamment le prénom de l’utilisateur, son nom de famille, son nom d’utilisateur privilégié et l’ID d’objet.</span><span class="sxs-lookup"><span data-stu-id="de1b5-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="de1b5-153">Pour obtenir la liste complète des revendications de profil disponibles dans le paramètre id_token pour un utilisateur donné, consultez la page [de référence sur les jetons v2.0](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="de1b5-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="de1b5-154">offline_access</span></span>
<span data-ttu-id="de1b5-155">[L’étendue `offline_access`](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) permet à votre application d’accéder aux ressources pour le compte de l’utilisateur pendant une période prolongée.</span><span class="sxs-lookup"><span data-stu-id="de1b5-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="de1b5-156">Dans la page de consentement du compte professionnel, cette étendue apparaît en tant qu’autorisation « Accéder à vos données à tout moment ».</span><span class="sxs-lookup"><span data-stu-id="de1b5-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="de1b5-157">Dans la page de consentement du compte Microsoft personnel, elle apparaît en tant qu’autorisation « Accéder à vos informations à tout moment ».</span><span class="sxs-lookup"><span data-stu-id="de1b5-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="de1b5-158">Lorsqu’un utilisateur approuve l’étendue `offline_access`, votre application peut recevoir les jetons d’actualisation du point de terminaison des jetons v2.0.</span><span class="sxs-lookup"><span data-stu-id="de1b5-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="de1b5-159">Les jetons d’actualisation sont de longue durée.</span><span class="sxs-lookup"><span data-stu-id="de1b5-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="de1b5-160">Votre application peut obtenir de nouveaux jetons d’accès lorsque les plus anciens arrivent à expiration.</span><span class="sxs-lookup"><span data-stu-id="de1b5-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="de1b5-161">Si votre application ne sollicite pas l’étendue `offline_access`, elle ne reçoit pas de jetons d’actualisation.</span><span class="sxs-lookup"><span data-stu-id="de1b5-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="de1b5-162">Ainsi, lorsque vous échangez un code d’autorisation dans le [flux de code d’autorisation OAuth 2.0](active-directory-v2-protocols.md), vous recevez uniquement un jeton d’accès du point de terminaison `/token`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="de1b5-163">Le jeton d’accès est valide pendant une courte durée :</span><span class="sxs-lookup"><span data-stu-id="de1b5-163">The access token is valid for a short time.</span></span> <span data-ttu-id="de1b5-164">il arrive généralement à expiration en une heure.</span><span class="sxs-lookup"><span data-stu-id="de1b5-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="de1b5-165">À ce stade, votre application doit rediriger l’utilisateur vers le point de terminaison `/authorize` afin de récupérer un nouveau code d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="de1b5-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="de1b5-166">Pendant ce réacheminement, en fonction du type d’application, l’utilisateur peut devoir entrer à nouveau ses informations d’identification ou accepter une nouvelle fois les autorisations.</span><span class="sxs-lookup"><span data-stu-id="de1b5-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="de1b5-167">Pour en savoir plus sur la récupération et l’utilisation des jetons d’actualisation, consultez la page de [référence sur les protocoles v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="de1b5-168">Demande de consentement d’utilisateur individuel</span><span class="sxs-lookup"><span data-stu-id="de1b5-168">Requesting individual user consent</span></span>
<span data-ttu-id="de1b5-169">Dans une demande d’autorisation [OpenID Connect ou OAuth 2.0](active-directory-v2-protocols.md), une application peut demander les autorisations nécessaires à l’aide du paramètre de requête `scope`.</span><span class="sxs-lookup"><span data-stu-id="de1b5-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="de1b5-170">Par exemple, lorsqu’un utilisateur se connecte à une application, cette dernière envoie une requête semblable à l’exemple ci-dessous (avec des sauts de ligne ajoutés pour une meilleure lisibilité) :</span><span class="sxs-lookup"><span data-stu-id="de1b5-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="de1b5-171">Le paramètre `scope` est une liste d’étendues séparées par des espaces, demandées par l’application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="de1b5-172">Chaque étendue est indiquée par l’ajout de la valeur correspondante à l’identificateur de la ressource (URI d’ID d’application).</span><span class="sxs-lookup"><span data-stu-id="de1b5-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="de1b5-173">Dans l’exemple de requête, l’application nécessite l’autorisation de lecture du calendrier de l’utilisateur et d’envoi de messages au nom de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="de1b5-174">Une fois que l’utilisateur a entré ses informations d’identification, le point de terminaison v2.0 recherche un enregistrement correspondant de *consentement d’utilisateur*.</span><span class="sxs-lookup"><span data-stu-id="de1b5-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="de1b5-175">Si l’utilisateur n’a accepté aucune des autorisations sollicitées par le passé, le point de terminaison v2.0 demande à l’utilisateur d’octroyer les autorisations demandées.</span><span class="sxs-lookup"><span data-stu-id="de1b5-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Consentement dans le compte professionnel](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="de1b5-177">Lorsque l’utilisateur approuve l’autorisation, le consentement est enregistré de manière à ce que l’utilisateur ne doive pas le fournir à nouveau lors des connexions suivantes au compte.</span><span class="sxs-lookup"><span data-stu-id="de1b5-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="de1b5-178">Demande de consentement d’un client entier</span><span class="sxs-lookup"><span data-stu-id="de1b5-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="de1b5-179">Souvent, lorsqu’une organisation achète une licence ou un abonnement à une application, elle souhaite la configurer entièrement pour ses employés.</span><span class="sxs-lookup"><span data-stu-id="de1b5-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="de1b5-180">Dans le cadre de cette procédure, un administrateur peut autoriser l’application à agir au nom de n’importe quel employé.</span><span class="sxs-lookup"><span data-stu-id="de1b5-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="de1b5-181">Si l’administrateur donne son consentement pour le client entier, les employés de l’organisation ne voient pas de page de consentement pour l’application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="de1b5-182">Pour demander le consentement pour tous les utilisateurs d’un client, votre application peut utiliser le point de terminaison de consentement de l’administrateur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="de1b5-183">Étendues limitées aux administrateurs</span><span class="sxs-lookup"><span data-stu-id="de1b5-183">Admin-restricted scopes</span></span>
<span data-ttu-id="de1b5-184">Certaines autorisations à privilège élevé de l’écosystème Microsoft peuvent être définies sur *restreintes aux administrateurs*.</span><span class="sxs-lookup"><span data-stu-id="de1b5-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="de1b5-185">Des exemples de ces types d’étendue incluent les autorisations suivantes :</span><span class="sxs-lookup"><span data-stu-id="de1b5-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="de1b5-186">Lire le répertoire d’une organisation à l’aide de `Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="de1b5-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="de1b5-187">Écrire des données dans le répertoire d’une organisation à l’aide de `Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="de1b5-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="de1b5-188">Lire des groupes de sécurité dans le répertoire d’une organisation à l’aide de `Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="de1b5-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="de1b5-189">Si un utilisateur consommateur peut accorder à une application l’accès à ce type de données, les utilisateurs d’organisation sont limités lorsqu’il s’agit d’octroyer l’accès au même jeu de données d’entreprise sensibles.</span><span class="sxs-lookup"><span data-stu-id="de1b5-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="de1b5-190">Si votre application requiert l’accès à l’une de ces autorisations d’un utilisateur de l’organisation, ce dernier recevra un message erreur indiquant qu’il n’est pas autorisé à donner son consentement pour les autorisations de votre application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="de1b5-191">Si votre application requiert l’accès aux étendues restreintes aux administrateurs pour les organisations, vous devez demander l’autorisation directement à un administrateur d’entreprise également à l’aide du point de terminaison de consentement de l’administrateur, décrit ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="de1b5-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="de1b5-192">Lorsqu’un administrateur accorde ces autorisations via le point de terminaison de consentement de l’administrateur, le consentement est accordé à tous les utilisateurs dans le client.</span><span class="sxs-lookup"><span data-stu-id="de1b5-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="de1b5-193">Utilisation du point de terminaison de consentement administrateur</span><span class="sxs-lookup"><span data-stu-id="de1b5-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="de1b5-194">Si vous suivez ces étapes, votre application peut rassembler les autorisations pour tous les utilisateurs dans un client, notamment les étendues restreintes aux administrateurs.</span><span class="sxs-lookup"><span data-stu-id="de1b5-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="de1b5-195">Pour voir un exemple de code qui implémente les étapes, consultez [l’exemple d’étendues restreintes aux administrateurs](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="de1b5-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="de1b5-196">Demander les autorisations dans le portail d’inscription de l’application</span><span class="sxs-lookup"><span data-stu-id="de1b5-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="de1b5-197">Accédez à votre application dans le [portail d’inscription des applications](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) ou [créez une application](active-directory-v2-app-registration.md) si ce n’est déjà fait.</span><span class="sxs-lookup"><span data-stu-id="de1b5-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="de1b5-198">Recherchez la section **Autorisations pour Microsoft Graph**, puis ajoutez les autorisations nécessaires à votre application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="de1b5-199">Veillez à **enregistrer** l’inscription de l’application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="de1b5-200">Recommandé : connecter l’utilisateur à votre application</span><span class="sxs-lookup"><span data-stu-id="de1b5-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="de1b5-201">En général, lorsque vous créez une application qui utilise le point de terminaison de consentement de l’administrateur, l’application doit disposer d’une page ou vue dans laquelle l’administrateur peut approuver ses autorisations.</span><span class="sxs-lookup"><span data-stu-id="de1b5-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="de1b5-202">Cette page peut faire partie du flux d’inscription de l’application, des paramètres de l’application, ou ce peut être un flux de connexion dédié.</span><span class="sxs-lookup"><span data-stu-id="de1b5-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="de1b5-203">Dans de nombreux cas, il est judicieux pour l’application d’afficher la vue de « connexion » uniquement après qu’un utilisateur se soit connecté avec un compte Microsoft professionnel ou scolaire.</span><span class="sxs-lookup"><span data-stu-id="de1b5-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="de1b5-204">Lorsque vous connectez l’utilisateur à votre application, vous pouvez identifier l’organisation à laquelle l’administrateur appartient, avant de lui demander d’approuver les autorisations nécessaires.</span><span class="sxs-lookup"><span data-stu-id="de1b5-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="de1b5-205">Même si cela n’est pas strictement nécessaire, cela peut vous aider à créer une expérience plus intuitive pour les utilisateurs de l’organisation.</span><span class="sxs-lookup"><span data-stu-id="de1b5-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="de1b5-206">Pour connecter l’utilisateur, suivez nos [didacticiels sur le protocole v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="de1b5-207">Demander les autorisations à un administrateur d’annuaire</span><span class="sxs-lookup"><span data-stu-id="de1b5-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="de1b5-208">Lorsque vous êtes prêt à demander les autorisations à l’administrateur de votre organisation, vous pouvez rediriger l’utilisateur vers le *point de terminaison de consentement de l’administrateur* v2.0.</span><span class="sxs-lookup"><span data-stu-id="de1b5-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="de1b5-209">Paramètre</span><span class="sxs-lookup"><span data-stu-id="de1b5-209">Parameter</span></span> | <span data-ttu-id="de1b5-210">Condition</span><span class="sxs-lookup"><span data-stu-id="de1b5-210">Condition</span></span> | <span data-ttu-id="de1b5-211">Description</span><span class="sxs-lookup"><span data-stu-id="de1b5-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de1b5-212">locataire</span><span class="sxs-lookup"><span data-stu-id="de1b5-212">tenant</span></span> |<span data-ttu-id="de1b5-213">Requis</span><span class="sxs-lookup"><span data-stu-id="de1b5-213">Required</span></span> |<span data-ttu-id="de1b5-214">Le client d’annuaire auquel vous souhaitez demander l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="de1b5-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="de1b5-215">Peut être fourni au format GUID ou sous forme de nom convivial.</span><span class="sxs-lookup"><span data-stu-id="de1b5-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="de1b5-216">client_id</span><span class="sxs-lookup"><span data-stu-id="de1b5-216">client_id</span></span> |<span data-ttu-id="de1b5-217">Requis</span><span class="sxs-lookup"><span data-stu-id="de1b5-217">Required</span></span> |<span data-ttu-id="de1b5-218">ID d’application que le [portail d’inscription des applications](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) a affecté à votre application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="de1b5-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="de1b5-219">redirect_uri</span></span> |<span data-ttu-id="de1b5-220">Requis</span><span class="sxs-lookup"><span data-stu-id="de1b5-220">Required</span></span> |<span data-ttu-id="de1b5-221">URI de redirection où vous souhaitez que la réponse soit envoyée pour être gérée par votre application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="de1b5-222">Il doit correspondre exactement à l’un des URI de redirection que vous avez inscrits dans le portail d’inscription des applications.</span><span class="sxs-lookup"><span data-stu-id="de1b5-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="de1b5-223">state</span><span class="sxs-lookup"><span data-stu-id="de1b5-223">state</span></span> |<span data-ttu-id="de1b5-224">Recommandé</span><span class="sxs-lookup"><span data-stu-id="de1b5-224">Recommended</span></span> |<span data-ttu-id="de1b5-225">Une valeur incluse dans la requête, qui sera également renvoyée dans la réponse de jeton.</span><span class="sxs-lookup"><span data-stu-id="de1b5-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="de1b5-226">Il peut s’agir d’une chaîne du contenu de votre choix.</span><span class="sxs-lookup"><span data-stu-id="de1b5-226">It can be a string of any content you want.</span></span> <span data-ttu-id="de1b5-227">Utilisez l’état pour encoder les informations sur l’état de l’utilisateur dans l’application avant la requête d’authentification, comme la page ou la vue sur laquelle ou laquelle il était positionné.</span><span class="sxs-lookup"><span data-stu-id="de1b5-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="de1b5-228">À ce stade, Azure AD nécessite qu’un administrateur client se connecte pour terminer la demande.</span><span class="sxs-lookup"><span data-stu-id="de1b5-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="de1b5-229">L’administrateur est invité à approuver toutes les autorisations que vous avez demandées pour votre application dans le portail d’inscription.</span><span class="sxs-lookup"><span data-stu-id="de1b5-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="de1b5-230">Réponse correcte</span><span class="sxs-lookup"><span data-stu-id="de1b5-230">Successful response</span></span>
<span data-ttu-id="de1b5-231">Si l’administrateur approuve les autorisations pour votre application, la réponse correcte ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="de1b5-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="de1b5-232">Paramètre</span><span class="sxs-lookup"><span data-stu-id="de1b5-232">Parameter</span></span> | <span data-ttu-id="de1b5-233">Description</span><span class="sxs-lookup"><span data-stu-id="de1b5-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de1b5-234">locataire</span><span class="sxs-lookup"><span data-stu-id="de1b5-234">tenant</span></span> |<span data-ttu-id="de1b5-235">Client d’annuaire ayant accordé à votre application les autorisations demandées au format GUID.</span><span class="sxs-lookup"><span data-stu-id="de1b5-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="de1b5-236">state</span><span class="sxs-lookup"><span data-stu-id="de1b5-236">state</span></span> |<span data-ttu-id="de1b5-237">Valeur incluse dans la requête qui sera également retournée dans la réponse de jeton.</span><span class="sxs-lookup"><span data-stu-id="de1b5-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="de1b5-238">Il peut s’agir d’une chaîne du contenu de votre choix.</span><span class="sxs-lookup"><span data-stu-id="de1b5-238">It can be a string of any content you want.</span></span> <span data-ttu-id="de1b5-239">La valeur d’état est utilisée pour coder les informations sur l’état de l’utilisateur dans l’application avant la requête d’authentification, comme la page ou l’écran sur lequel ou laquelle il était positionné.</span><span class="sxs-lookup"><span data-stu-id="de1b5-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="de1b5-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="de1b5-240">admin_consent</span></span> |<span data-ttu-id="de1b5-241">Est défini sur **true**.</span><span class="sxs-lookup"><span data-stu-id="de1b5-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="de1b5-242">Réponse d’erreur</span><span class="sxs-lookup"><span data-stu-id="de1b5-242">Error response</span></span>
<span data-ttu-id="de1b5-243">Si l’administrateur n’approuve pas les autorisations pour votre application, la réponse d’échec ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="de1b5-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="de1b5-244">Paramètre</span><span class="sxs-lookup"><span data-stu-id="de1b5-244">Parameter</span></span> | <span data-ttu-id="de1b5-245">Description</span><span class="sxs-lookup"><span data-stu-id="de1b5-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="de1b5-246">error</span><span class="sxs-lookup"><span data-stu-id="de1b5-246">error</span></span> |<span data-ttu-id="de1b5-247">Une chaîne de code d’erreur pouvant être utilisée pour classer les types d’erreur se produisant, et pouvant être utilisée pour intervenir face aux erreurs.</span><span class="sxs-lookup"><span data-stu-id="de1b5-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="de1b5-248">error_description</span><span class="sxs-lookup"><span data-stu-id="de1b5-248">error_description</span></span> |<span data-ttu-id="de1b5-249">Un message d’erreur spécifique qui peut aider un développeur à identifier la cause principale d’une erreur.</span><span class="sxs-lookup"><span data-stu-id="de1b5-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="de1b5-250">Une fois que vous avez reçu une réponse correcte du point de terminaison de consentement de l’administrateur, votre application a acquis les autorisations qu’elle avait demandées.</span><span class="sxs-lookup"><span data-stu-id="de1b5-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="de1b5-251">Vous pouvez alors demander un jeton pour la ressource souhaitée.</span><span class="sxs-lookup"><span data-stu-id="de1b5-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="de1b5-252">Utilisation des autorisations</span><span class="sxs-lookup"><span data-stu-id="de1b5-252">Using permissions</span></span>
<span data-ttu-id="de1b5-253">Une fois que l’utilisateur accepte les autorisations pour votre application, cette dernière peut acquérir des jetons d’accès représentant l’autorisation de votre application à accéder, dans une certaine capacité, à une ressource.</span><span class="sxs-lookup"><span data-stu-id="de1b5-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="de1b5-254">Un jeton d’accès peut être utilisé pour une ressource uniquement, mais l’encodage de ce jeton comporte les informations relatives à toutes les autorisations octroyées pour cette ressource à votre application.</span><span class="sxs-lookup"><span data-stu-id="de1b5-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="de1b5-255">Pour acquérir un jeton d’accès, votre application peut transmettre une requête au point de terminaison de jeton v2.0 :</span><span class="sxs-lookup"><span data-stu-id="de1b5-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="de1b5-256">Vous pouvez utiliser le jeton d’accès obtenu dans les requêtes HTTP transmises à la ressource.</span><span class="sxs-lookup"><span data-stu-id="de1b5-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="de1b5-257">Il indique de façon fiable à la ressource que votre application dispose de l’autorisation appropriée pour effectuer une tâche spécifique.</span><span class="sxs-lookup"><span data-stu-id="de1b5-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="de1b5-258">Pour en savoir plus sur le protocole OAuth 2.0 et sur le mode d’obtention des jetons d’accès, consultez la page de [référence sur les protocoles du point de terminaison v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="de1b5-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
