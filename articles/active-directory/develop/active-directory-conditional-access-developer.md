---
title: "aaaDeveloper des conseils pour l’accès conditionnel Azure Active Directory | Documents Microsoft"
description: "Guide du développeur et scénarios pour l’accès conditionnel à Azure AD"
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: 589393f5d084d64872b372d895dc889f300592bf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="e7330-103">Guide du développeur pour l’accès conditionnel à Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e7330-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="e7330-104">Azure Active Directory (AD) offre plusieurs façons toosecure votre application et protéger un service.</span><span class="sxs-lookup"><span data-stu-id="e7330-104">Azure Active Directory (AD) offers several ways toosecure your app and protect a service.</span></span>  <span data-ttu-id="e7330-105">Une de ces fonctionnalités uniques est l’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="e7330-106">Accès conditionnel permet aux développeurs et des services tooprotect de clients d’entreprise dans une multitude de façons, notamment :</span><span class="sxs-lookup"><span data-stu-id="e7330-106">Conditional access enables developers and enterprise customers tooprotect services in a multitude of ways including:</span></span>

* <span data-ttu-id="e7330-107">Authentification multifacteur</span><span class="sxs-lookup"><span data-stu-id="e7330-107">Multi-factor authentication</span></span>
* <span data-ttu-id="e7330-108">Autoriser uniquement Intune inscrit des services spécifiques de périphériques tooaccess</span><span class="sxs-lookup"><span data-stu-id="e7330-108">Allowing only Intune enrolled devices tooaccess specific services</span></span>
* <span data-ttu-id="e7330-109">Restriction des plages IP et emplacements utilisateur</span><span class="sxs-lookup"><span data-stu-id="e7330-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="e7330-110">Pour plus d’informations sur les fonctionnalités complètes hello de l’accès conditionnel, consultez [l’accès conditionnel dans hello portail Azure classic](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-110">For more information on hello full capabilities of conditional access, see [Conditional access in hello Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="e7330-111">Dans cet article, nous nous concentrer sur les accès conditionnel signifie toodevelopers génération d’applications pour Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e7330-111">In this article, we focus on what conditional access means toodevelopers building apps for Azure AD.</span></span>  <span data-ttu-id="e7330-112">Il suppose des connaissances [d’applications uniques](active-directory-integrating-applications.md) et [mutualisées](active-directory-devhowto-multi-tenant-overview.md) et [des modèles courants d’authentification](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="e7330-113">Nous allons approfondir impact hello de l’accès aux ressources que vous ne contrôlez pas et qui peuvent avoir des stratégies d’accès conditionnel appliquées.</span><span class="sxs-lookup"><span data-stu-id="e7330-113">We'll dive into hello impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="e7330-114">En outre, nous explorons hello implications en matière d’accès conditionnel dans le flux de la part de hello, des applications web, l’accès hello Microsoft Graph et appeler des API.</span><span class="sxs-lookup"><span data-stu-id="e7330-114">Moreover, we explore hello implications of conditional access in hello on-behalf-of flow, web apps, accessing hello Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="e7330-115">Comment l’accès conditionnel impacte-t-il une application ?</span><span class="sxs-lookup"><span data-stu-id="e7330-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="e7330-116">Topologies d’application affectées</span><span class="sxs-lookup"><span data-stu-id="e7330-116">App topologies impacted</span></span>

<span data-ttu-id="e7330-117">Dans les scénarios les plus courants, l’accès conditionnel ne modifie pas le comportement d’une application ou nécessite des modifications du développeur de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-117">In most common cases, conditional access does not change an app's behavior or requires any changes from hello developer.</span></span>  <span data-ttu-id="e7330-118">Que dans certains cas lorsqu’une application en mode silencieux ou indirectement demande un jeton pour un service, une application requiert des modifications de code défis « toohandle accès conditionnel ».</span><span class="sxs-lookup"><span data-stu-id="e7330-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes toohandle conditional access "challenges".</span></span>  <span data-ttu-id="e7330-119">Cela peut être aussi simple que l’exécution d’une demande de connexion interactive.</span><span class="sxs-lookup"><span data-stu-id="e7330-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="e7330-120">Plus particulièrement, hello scénarios suivants requièrent accès conditionnel du code toohandle « défis » :</span><span class="sxs-lookup"><span data-stu-id="e7330-120">Specifically, hello following scenarios require code toohandle conditional access "challenges":</span></span> 

* <span data-ttu-id="e7330-121">Applications qui accèdent au hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e7330-121">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="e7330-122">Applications effectuant hello sur à la place de flux</span><span class="sxs-lookup"><span data-stu-id="e7330-122">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="e7330-123">Applications accédant à plusieurs services/ressources</span><span class="sxs-lookup"><span data-stu-id="e7330-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="e7330-124">Applications à page unique en utilisant ADAL.js</span><span class="sxs-lookup"><span data-stu-id="e7330-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="e7330-125">Stratégies d’accès conditionnel peut être appliqué toohello application, mais peut également être appliqué tooa web API votre application accède.</span><span class="sxs-lookup"><span data-stu-id="e7330-125">Conditional access policies can be applied toohello app, but also can be applied tooa web API your app accesses.</span></span> <span data-ttu-id="e7330-126">toolearn savoir plus sur comment tooconfigure une stratégie d’accès conditionnel, consultez [mise en route avec un accès conditionnel Azure Active Directory](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="e7330-126">toolearn more about how tooconfigure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="e7330-127">Selon le scénario de hello, un client d’entreprise peut appliquer et supprimer des stratégies d’accès conditionnel à tout moment.</span><span class="sxs-lookup"><span data-stu-id="e7330-127">Depending on hello scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="e7330-128">Votre application toocontinue de fonctionnement lorsqu’une nouvelle stratégie est appliquée, vous devez la gestion de stimulation « tooimplement hello ».</span><span class="sxs-lookup"><span data-stu-id="e7330-128">In order for your app toocontinue functioning when a new policy is applied, you need tooimplement hello "challenge" handling.</span></span> <span data-ttu-id="e7330-129">Hello exemple suivant illustre la gestion de la demande d’accès.</span><span class="sxs-lookup"><span data-stu-id="e7330-129">hello following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="e7330-130">Exemples d’accès conditionnel</span><span class="sxs-lookup"><span data-stu-id="e7330-130">Conditional access examples</span></span>

<span data-ttu-id="e7330-131">Certains scénarios requièrent code change toohandle l’accès conditionnel, tandis que d’autres en l’état du travail.</span><span class="sxs-lookup"><span data-stu-id="e7330-131">Some scenarios require code changes toohandle conditional access whereas others work as is.</span></span>  <span data-ttu-id="e7330-132">Voici quelques scénarios à l’aide de l’authentification multifacteur accès conditionnel toodo qui donne une idée de la différence de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-132">Here are a few scenarios using conditional access toodo multi-factor authentication that gives some insight into hello difference.</span></span>

* <span data-ttu-id="e7330-133">Vous générez une application iOS de client unique et appliquez une stratégie d’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="e7330-134">application Hello se connecte un utilisateur et ne demande l’accès tooan API.</span><span class="sxs-lookup"><span data-stu-id="e7330-134">hello app signs in a user and doesn't request access tooan API.</span></span>  <span data-ttu-id="e7330-135">Lorsque hello utilisateur se connecte, hello stratégie est automatiquement appelée et l’utilisateur hello doit tooperform l’authentification multifacteur (MFA).</span><span class="sxs-lookup"><span data-stu-id="e7330-135">When hello user signs in, hello policy is automatically invoked and hello user needs tooperform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="e7330-136">Vous générez une application web d’architecture mutualisée qui utilise hello Microsoft Graph tooaccess Exchange, entre autres services.</span><span class="sxs-lookup"><span data-stu-id="e7330-136">You are building a multi-tenant web app that uses hello Microsoft Graph tooaccess Exchange, among other services.</span></span>  <span data-ttu-id="e7330-137">Un client d’entreprise qui adopte cette application définit une stratégie sur SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="e7330-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="e7330-138">Lorsque l’application hello web demande un jeton MS Graph, une stratégie sur tous les services Microsoft est appliquée (en particulier les services qui sont accessibles via le graphique).</span><span class="sxs-lookup"><span data-stu-id="e7330-138">When hello web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="e7330-139">Cet utilisateur final est invité à fournir l’authentification multifacteur.</span><span class="sxs-lookup"><span data-stu-id="e7330-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="e7330-140">Dans les cas de hello, l’utilisateur final hello est connecté avec des jetons valides, un défi « revendications » est renvoyé à l’application web toohello.</span><span class="sxs-lookup"><span data-stu-id="e7330-140">In hello case, hello end-user is signed in with valid tokens, a claims "challenge" is returned toohello web app.</span></span>  
* <span data-ttu-id="e7330-141">Vous générez une application native qui utilise un Bonjour de tooaccess de service de couche intermédiaire Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-141">You are building a native app that uses a middle tier service tooaccess hello Microsoft Graph.</span></span>  <span data-ttu-id="e7330-142">Un client d’entreprise au niveau de l’entreprise hello à l’aide de cette application s’applique à un tooExchange de stratégie en ligne.</span><span class="sxs-lookup"><span data-stu-id="e7330-142">An enterprise customer at hello company using this app applies a policy tooExchange Online.</span></span>  <span data-ttu-id="e7330-143">Lorsqu’un utilisateur final se connecte à la couche intermédiaire toohello d’accès aux demandes hello application native et envoie le jeton de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-143">When an end-user signs in, hello native app requests access toohello middle tier and sends hello token.</span></span>  <span data-ttu-id="e7330-144">niveau intermédiaire de Hello effectue sur la part de flux toorequest accès toohello MS Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-144">hello middle tier performs on-behalf-of flow toorequest access toohello MS Graph.</span></span>  <span data-ttu-id="e7330-145">À ce stade, un défi « revendications » est présenté intermédiaire toohello.</span><span class="sxs-lookup"><span data-stu-id="e7330-145">At this point, a claims "challenge" is presented toohello middle tier.</span></span> <span data-ttu-id="e7330-146">niveau intermédiaire de Hello envoie hello stimulation toohello arrière application native, qui doit toocomply avec la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-146">hello middle tier sends hello challenge back toohello native app, which needs toocomply with hello conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="e7330-147">Conformité à une stratégie d’accès conditionnel</span><span class="sxs-lookup"><span data-stu-id="e7330-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="e7330-148">Pour plusieurs topologies d’application différents, une stratégie d’accès conditionnel est évaluée lors de la session de hello est établie.</span><span class="sxs-lookup"><span data-stu-id="e7330-148">For several different app topologies, a conditional access policy is evaluated when hello session is established.</span></span>  <span data-ttu-id="e7330-149">Comme une stratégie d’accès conditionnel fonctionne à l’échelle de hello d’applications et services, point hello à laquelle elle est appelée dépend fortement sur le scénario de hello que vous essayez de tooaccomplish.</span><span class="sxs-lookup"><span data-stu-id="e7330-149">As a conditional access policy operates on hello granularity of apps and services, hello point at which it is invoked depends heavily on hello scenario you're trying tooaccomplish.</span></span>

<span data-ttu-id="e7330-150">Quand votre application tente de tooaccess un service avec une stratégie d’accès conditionnel, il peut rencontrer une vérification d’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-150">When your app attempts tooaccess a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="e7330-151">Cette demande est encodée dans hello `claims` paramètre qui est fourni dans la réponse d’Azure AD ou hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-151">This challenge is encoded in hello `claims` parameter that comes in a response from Azure AD or hello Microsoft Graph.</span></span>  <span data-ttu-id="e7330-152">Voici un exemple de ce paramètre de défi :</span><span class="sxs-lookup"><span data-stu-id="e7330-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="e7330-153">Les développeurs peuvent prendre ce défi et l’ajouter dans une nouvelle tooAzure de requête AD.</span><span class="sxs-lookup"><span data-stu-id="e7330-153">Developers can take this challenge and append it onto a new request tooAzure AD.</span></span>  <span data-ttu-id="e7330-154">Passer l’état de cet demande tooperform de l’utilisateur final hello tout toocomply nécessaire d’action avec la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-154">Passing this state prompts hello end-user tooperform any action necessary toocomply with hello conditional access policy.</span></span> <span data-ttu-id="e7330-155">Bonjour les scénarios suivants, les détails de l’erreur de hello et comment tooextract hello paramètre sont expliqués.</span><span class="sxs-lookup"><span data-stu-id="e7330-155">In hello following scenarios, specifics of hello error and how tooextract hello parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="e7330-156">Scénarios</span><span class="sxs-lookup"><span data-stu-id="e7330-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="e7330-157">Composants requis</span><span class="sxs-lookup"><span data-stu-id="e7330-157">Prerequisites</span></span>

<span data-ttu-id="e7330-158">L’accès conditionnel Azure AD est une fonctionnalité inclue dans [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="e7330-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="e7330-159">Des informations complémentaires sur les licences requises Bonjour [rapport d’utilisation sans licence](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-159">You can learn more about licensing requirements in hello [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="e7330-160">Les développeurs peuvent joindre hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), qui inclut un toohello abonnement gratuit Enterprise Mobility Suite, qui inclut Azure AD Premium.</span><span class="sxs-lookup"><span data-stu-id="e7330-160">Developers can join hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription toohello Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="e7330-161">Considérations pour des scénarios spécifiques</span><span class="sxs-lookup"><span data-stu-id="e7330-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="e7330-162">Hello uniquement les informations suivantes s’appliquent dans ces scénarios d’accès conditionnel :</span><span class="sxs-lookup"><span data-stu-id="e7330-162">hello following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="e7330-163">Applications qui accèdent au hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e7330-163">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="e7330-164">Applications effectuant hello sur à la place de flux</span><span class="sxs-lookup"><span data-stu-id="e7330-164">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="e7330-165">Applications accédant à plusieurs services/ressources</span><span class="sxs-lookup"><span data-stu-id="e7330-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="e7330-166">Applications à page unique en utilisant ADAL.js</span><span class="sxs-lookup"><span data-stu-id="e7330-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="e7330-167">Bonjour les sections suivantes, nous aborderons commun scénarios dans lesquels sont plus complexes.</span><span class="sxs-lookup"><span data-stu-id="e7330-167">In hello following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="e7330-168">core Hello principe de fonctionnement est l’accès conditionnel, les stratégies sont évaluées au moment de hello hello jeton est demandé pour le service hello qui comporte une stratégie de l’accès conditionnel, sauf si elle est accessible via hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-168">hello core operating principle is conditional access policies are evaluated at hello time hello token is requested for hello service that has a conditional access policy applied unless it's being accessed through hello Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-hello-microsoft-graph"></a><span data-ttu-id="e7330-169">Scénario : Application accéder à hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="e7330-169">Scenario: App accessing hello Microsoft Graph</span></span>

<span data-ttu-id="e7330-170">Dans ce scénario, nous guider les cas de hello lorsqu’une application web demande accès toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-170">In this scenario, we walk through hello case when a web app requests access toohello Microsoft Graph.</span></span> <span data-ttu-id="e7330-171">stratégie d’accès conditionnel Hello dans ce cas peut être attribuée tooSharePoint, Exchange ou un autre service qui est accessible en tant qu’une charge de travail via hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-171">hello conditional access policy in this case could be assigned tooSharePoint, Exchange, or some other service that is accessed as a workload through hello Microsoft Graph.</span></span>  <span data-ttu-id="e7330-172">Dans cet exemple, supposons qu’il existe une stratégie d’accès conditionnel sur Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="e7330-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![Diagramme de flux Microsoft Graph hello de l’accès à des applications](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="e7330-174">application Hello demande d’autorisation toohello Microsoft Graph qui nécessite l’accès à une charge de travail en aval sans accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-174">hello app first requests authorization toohello Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="e7330-175">demande de Hello aboutit sans appeler n’importe quelle stratégie et application hello reçoit les jetons de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="e7330-175">hello request succeeds without invoking any policy and hello app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="e7330-176">À ce stade, application hello peut utiliser le jeton d’accès hello dans une demande de support pour le point de terminaison hello demandé.</span><span class="sxs-lookup"><span data-stu-id="e7330-176">At this point, hello app may use hello access token in a bearer request for hello endpoint requested.</span></span> <span data-ttu-id="e7330-177">Maintenant, hello application a besoin tooaccess un point de terminaison Sharepoint Online de Microsoft Graph, par exemple :`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="e7330-177">Now, hello app needs tooaccess a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="e7330-178">application Hello possède déjà un jeton valide pour hello Microsoft Graph, afin d’exécuter nouvelle demande de hello sans un nouveau jeton émis.</span><span class="sxs-lookup"><span data-stu-id="e7330-178">hello app already has a valid token for hello Microsoft Graph, so it can perform hello new request without being issued a new token.</span></span> <span data-ttu-id="e7330-179">Cette demande échoue et un défi de revendications est émis à partir de Microsoft Graph sous forme de hello d’un HTTP 403 Interdit avec un ```WWW-Authenticate``` défi.</span><span class="sxs-lookup"><span data-stu-id="e7330-179">This request fails and a claims challenge is issued from Microsoft Graph in hello form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="e7330-180">Voici un exemple de réponse de hello :</span><span class="sxs-lookup"><span data-stu-id="e7330-180">Here's an example of hello response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="e7330-181">Hello revendications défi consiste à l’intérieur de hello ```WWW-Authenticate``` en-tête qui peut être analysé tooextract hello revendications paramètre pour la prochaine demande de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-181">hello claims challenge is inside hello ```WWW-Authenticate``` header, which can be parsed tooextract hello claims parameter for hello next request.</span></span>  <span data-ttu-id="e7330-182">Une fois ajouté toohello nouvelle demande, Azure AD connaît stratégie d’accès conditionnel tooevaluate hello lors de l’ouverture de session utilisateur de hello et application hello est désormais conforme à la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-182">Once it's appended toohello new request, Azure AD knows tooevaluate hello conditional access policy when signing in hello user and hello app is now in compliance with hello conditional access policy.</span></span>  <span data-ttu-id="e7330-183">Point de terminaison extensible toohello de demande hello Sharepoint Online réussit.</span><span class="sxs-lookup"><span data-stu-id="e7330-183">Repeating hello request toohello Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="e7330-184">Pour des exemples de code qui montrent comment toohandle hello revendications défi, consultez toohello [exemple de code .NET Desktop](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) ADAL .NET ou hello [exemple de code de la part de](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) pour .NET de la bibliothèque ADAL.</span><span class="sxs-lookup"><span data-stu-id="e7330-184">For code samples that demonstrate how toohandle hello claims challenge, refer toohello [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or hello [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-hello-on-behalf-of-flow"></a><span data-ttu-id="e7330-185">Scénario : Application exécution hello sur à la place de flux</span><span class="sxs-lookup"><span data-stu-id="e7330-185">Scenario: App performing hello on-behalf-of flow</span></span>

<span data-ttu-id="e7330-186">Dans ce scénario, nous guider cas hello dans laquelle une application native appelle une API du service web /.</span><span class="sxs-lookup"><span data-stu-id="e7330-186">In this scenario, we walk through hello case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="e7330-187">À son tour, fait de ce service [hello « de la part de » flux](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall un service en aval.</span><span class="sxs-lookup"><span data-stu-id="e7330-187">In turn, this service does [hello "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall a downstream service.</span></span>  <span data-ttu-id="e7330-188">Dans notre cas, nous avoir appliqué à notre service en aval accès conditionnel stratégie toohello (API Web 2) et utilisez une application native, plutôt qu’une application démon/serveur.</span><span class="sxs-lookup"><span data-stu-id="e7330-188">In our case, we've applied our conditional access policy toohello downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![Application effectuant hello sur à la place de diagramme de flux](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="e7330-190">demande de jeton initial Hello pour API Web 1 n’affiche aucune invite l’utilisateur final hello pour l’authentification multifacteur que l’API Web 1 ne peut pas atteindre toujours les API en aval hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-190">hello initial token request for Web API 1 does not prompt hello end-user for multi-factor authentication as Web API 1 may not always hit hello downstream API.</span></span>  <span data-ttu-id="e7330-191">Une fois que l’API Web 1 tente de toorequest un utilisateur d’émission de jeton de la part de hello pour API Web 2, demande de hello échoue, car l’utilisateur de hello n’a pas été signé avec l’authentification multifacteur.</span><span class="sxs-lookup"><span data-stu-id="e7330-191">Once Web API 1 tries toorequest a token on-behalf-of hello user for Web API 2, hello request fails since hello user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="e7330-192">Azure AD renvoie une réponse HTTP avec des données intéressantes :</span><span class="sxs-lookup"><span data-stu-id="e7330-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="e7330-193">Dans ce cas, il est une description d’erreur de l’authentification multifacteur, mais il existe une large gamme de `interaction_required` accès tooconditional correspondantes.</span><span class="sxs-lookup"><span data-stu-id="e7330-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining tooconditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="e7330-194">Dans notre API Web 1, nous interceptons l’erreur de hello `error=interaction_required`et envoyer hello arrière `claims` application de bureau toohello défi.</span><span class="sxs-lookup"><span data-stu-id="e7330-194">In our Web API 1, we catch hello error `error=interaction_required`, and send back hello `claims` challenge toohello desktop app.</span></span>  <span data-ttu-id="e7330-195">À ce stade, l’application de bureau hello faire une nouvelle `acquireToken()` appeler et ajouter hello `claims`défi comme un paramètre de chaîne de requête supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="e7330-195">At that point, hello desktop app can make a new `acquireToken()` call and append hello `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="e7330-196">Cette nouvelle demande requiert une authentification multifacteur de hello utilisateur toodo, puis envoyer ce nouveau jeton précédent tooWeb API 1 et le hello complète de la part de flux.</span><span class="sxs-lookup"><span data-stu-id="e7330-196">This new request requires hello user toodo multi-factor authentication and then send this new token back tooWeb API 1 and complete hello on-behalf-of flow.</span></span>

<span data-ttu-id="e7330-197">tootry ce scénario, consultez notre [exemple de code .NET](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="e7330-197">tootry out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="e7330-198">Il montre comment toopass hello défi de revendications de l’application native de toohello API Web 1 et construire une nouvelle demande au sein de l’application cliente de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-198">It demonstrates how toopass hello claims challenge back from Web API 1 toohello native app and construct a new request inside hello client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="e7330-199">Scénario : applications accédant à plusieurs services</span><span class="sxs-lookup"><span data-stu-id="e7330-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="e7330-200">Dans ce scénario, nous guider les cas de hello dans lequel une application web accède aux deux services dont a affectée une stratégie d’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-200">In this scenario, we walk through hello case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="e7330-201">En fonction de votre logique d’application, il peut exister un chemin d’accès dans lequel votre application ne nécessite pas d’accès tooboth web services.</span><span class="sxs-lookup"><span data-stu-id="e7330-201">Depending on your app logic, there may exist a path in which your app does not require access tooboth web services.</span></span>  <span data-ttu-id="e7330-202">Dans ce scénario, commande hello dans lequel vous demandez un jeton joue un rôle important dans l’expérience de l’utilisateur final hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-202">In this scenario, hello order in which you request a token plays an important role in hello end-user experience.</span></span>

<span data-ttu-id="e7330-203">Supposons que nous disposons d’un service Web A et B et que le service Web B applique notre stratégie d’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="e7330-204">Lors de la demande d’authentification interactive initiale hello requiert le consentement pour les deux services, la stratégie d’accès conditionnel hello n’est pas nécessaire dans tous les cas.</span><span class="sxs-lookup"><span data-stu-id="e7330-204">While hello initial interactive auth request requires consent for both services, hello conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="e7330-205">Si l’application hello demande un jeton pour le service web B, puis hello stratégie est appelée et les demandes suivantes pour le service web A réussit également comme suit.</span><span class="sxs-lookup"><span data-stu-id="e7330-205">If hello app requests a token for web service B, then hello policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![Application accédant à un diagramme de flux multi-services](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="e7330-207">Ou bien, si l’application hello demande initialement un jeton d’un service web, l’utilisateur final hello n’appelle pas la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-207">Alternatively, if hello app initially requests a token for web service A, hello end-user does not invoke hello conditional access policy.</span></span>  <span data-ttu-id="e7330-208">Cela permet à l’utilisateur final toocontrol hello développeur d’application hello et ne force pas toobe de stratégie d’accès conditionnel hello appelée dans tous les cas.</span><span class="sxs-lookup"><span data-stu-id="e7330-208">This allows hello app developer toocontrol hello end-user experience and not force hello conditional access policy toobe invoked in all cases.</span></span> <span data-ttu-id="e7330-209">les cas délicate Hello sont si hello application demande ensuite un jeton pour le service web B. À ce stade, l’utilisateur final hello doit toocomply avec la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-209">hello tricky case is if hello app subsequently requests a token for web service B. At this point, hello end-user needs toocomply with hello conditional access policy.</span></span>  <span data-ttu-id="e7330-210">Lorsque l’application hello tente trop`acquireToken`, il peut générer hello (illustrée dans hello suivant schéma) de l’erreur suivante :</span><span class="sxs-lookup"><span data-stu-id="e7330-210">When hello app tries too`acquireToken`, it may generate hello following error (illustrated in hello following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![Application accédant à plusieurs services demandant un nouveau jeton](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="e7330-212">Si l’application hello utilise la bibliothèque ADAL de hello, un jeton de hello tooacquire échec est toujours une nouvelle tentative interactivement.</span><span class="sxs-lookup"><span data-stu-id="e7330-212">If hello app is using hello ADAL library, a failure tooacquire hello token is always retried interactively.</span></span>  <span data-ttu-id="e7330-213">Lorsque cette requête se produit, l’utilisateur final hello a toocomply d’opportunité hello avec l’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-213">When this interactive request occurs, hello end-user has hello opportunity toocomply with hello conditional access.</span></span>  <span data-ttu-id="e7330-214">Cela est vrai, sauf si la demande de hello est un `AcquireTokenSilentAsync` ou `PromptBehavior.Never` dans ce cas application hello doit tooperform interactif ```AcquireToken``` demande toogive hello utilisations hello opportunité toocomply avec la stratégie de hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-214">This is true unless hello request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case hello app needs tooperform an interactive ```AcquireToken``` request toogive hello end use hello opportunity toocomply with hello policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="e7330-215">Scénario : application à page unique (SPA) en utilisant ADAL.js</span><span class="sxs-lookup"><span data-stu-id="e7330-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="e7330-216">Dans ce scénario, nous décrivons les cas de hello lorsque nous avons une application à page unique (SPA), à l’aide de ADAL.js toocall un accès conditionnel protégées API web.</span><span class="sxs-lookup"><span data-stu-id="e7330-216">In this scenario, we walk through hello case when we have a single page app (SPA), using ADAL.js toocall a conditional access protected web API.</span></span>  <span data-ttu-id="e7330-217">Ceci est une architecture simple mais a des nuances qui doivent toobe pris en compte lors du développement autour de l’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-217">This is a simple architecture but has some nuances that need toobe taken into account when developing around conditional access.</span></span>

<span data-ttu-id="e7330-218">Dans ADAL.js, il existe quelques fonctions qui obtiennent des jetons : `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, et `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="e7330-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="e7330-219">`login()`Obtient un jeton d’ID via une demande de connexion interactive, mais n’obtient pas les jetons d’accès pour n’importe quel service (y compris une API Web protégée par l’accès conditionnel).</span><span class="sxs-lookup"><span data-stu-id="e7330-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="e7330-220">`acquireToken(…)`peut ensuite être toosilently utilisé obtenir un jeton d’accès c'est-à-dire qu’il n’affiche pas l’interface utilisateur dans les cas.</span><span class="sxs-lookup"><span data-stu-id="e7330-220">`acquireToken(…)` can then be used toosilently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="e7330-221">`acquireTokenPopup(…)`et `acquireTokenRedirect(…)` sont les deux toointeractively utilisé demander un jeton pour une ressource, c'est-à-dire qu’ils affichent toujours l’authentification dans l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e7330-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used toointeractively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="e7330-222">Lorsqu’une application a besoin d’un toocall de jeton d’accès une API Web, il tente une `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="e7330-222">When an app needs an access token toocall a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="e7330-223">Si la session de jeton hello a expiré ou que nous devons toocomply avec une stratégie d’accès conditionnel, puis hello *acquireToken* la fonction échoue et hello application utilise `acquireTokenPopup()` ou `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="e7330-223">If hello token session is expired or we need toocomply with a conditional access policy, then hello *acquireToken* function fails and hello app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![Application à page unique en utilisant le diagramme de flux ADAL](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="e7330-225">Examinons un exemple avec notre scénario d’accès conditionnel.</span><span class="sxs-lookup"><span data-stu-id="e7330-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="e7330-226">l’utilisateur final Hello simplement étant récupérées sur le site de hello et qu’il n’a pas une session.</span><span class="sxs-lookup"><span data-stu-id="e7330-226">hello end-user just landed on hello site and doesn’t have a session.</span></span>  <span data-ttu-id="e7330-227">Nous effectuons un appel `login()` et obtenons un jeton d’ID sans authentification multifacteur.</span><span class="sxs-lookup"><span data-stu-id="e7330-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="e7330-228">Puis utilisateur de hello appuie sur un bouton qui requiert des données de toorequest hello application à partir d’une API web.</span><span class="sxs-lookup"><span data-stu-id="e7330-228">Then hello user hits a button that requires hello app toorequest data from a web API.</span></span>  <span data-ttu-id="e7330-229">application Hello tente toodo un `acquireToken()` appel échoue, mais étant donné que l’utilisateur de hello n’a pas effectué l’authentification multifacteur encore et a besoin de toocomply avec la stratégie d’accès conditionnel hello.</span><span class="sxs-lookup"><span data-stu-id="e7330-229">hello app tries toodo an `acquireToken()` call but fails since hello user has not performed multi-factor authentication yet and needs toocomply with hello conditional access policy.</span></span>

<span data-ttu-id="e7330-230">Azure AD envoie hello différé suivant la réponse HTTP :</span><span class="sxs-lookup"><span data-stu-id="e7330-230">Azure AD sends back hello following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
```

<span data-ttu-id="e7330-231">Notre application a besoin toocatch hello `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="e7330-231">Our app needs toocatch hello `error=interaction_required`.</span></span>  <span data-ttu-id="e7330-232">Hello application peut utiliser ensuite soit `acquireTokenPopup()` ou `acquireTokenRedirect()` sur hello même ressource.</span><span class="sxs-lookup"><span data-stu-id="e7330-232">hello application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on hello same resource.</span></span>  <span data-ttu-id="e7330-233">l’utilisateur Hello est forcé toodo une authentification multifacteur.</span><span class="sxs-lookup"><span data-stu-id="e7330-233">hello user is forced toodo a multi-factor authentication.</span></span> <span data-ttu-id="e7330-234">Utilisateur de hello après l’authentification multifacteur hello, application hello est émise une nouvelle ressource de jeton d’accès pour hello demandée.</span><span class="sxs-lookup"><span data-stu-id="e7330-234">After hello user completes hello multi-factor authentication, hello app is issued a fresh access token for hello requested resource.</span></span>

<span data-ttu-id="e7330-235">tootry ce scénario, consultez notre [exemple de code de la part de JS SPA](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="e7330-235">tootry out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="e7330-236">Cet exemple de code utilise la stratégie d’accès conditionnel hello et web API vous précédemment inscrites avec un toodemonstrate JS SPA ce scénario.</span><span class="sxs-lookup"><span data-stu-id="e7330-236">This code sample uses hello conditional access policy and web API you registered earlier with a JS SPA toodemonstrate this scenario.</span></span> <span data-ttu-id="e7330-237">Il montre comment tooproperly handle hello revendications stimulation et obtient un jeton d’accès qui peut être utilisé pour votre API Web.</span><span class="sxs-lookup"><span data-stu-id="e7330-237">It shows how tooproperly handle hello claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="e7330-238">Vous pouvez également les hello extraction général [exemple de code Angular.js](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) pour obtenir des conseils sur une SPA angulaire</span><span class="sxs-lookup"><span data-stu-id="e7330-238">Alternatively, checkout hello general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="e7330-239">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e7330-239">See also</span></span>

* <span data-ttu-id="e7330-240">toolearn en savoir plus sur les fonctionnalités de hello, consultez [accès conditionnel dans Azure AD](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-240">toolearn more about hello capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="e7330-241">Pour obtenir plus d’exemples de code Azure AD, consultez [Référentiel Github d’exemples de code](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="e7330-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="e7330-242">Pour plus d’informations sur hello une documentation de référence du Kit de développement ADAL et l’accès hello, consultez [guide de la bibliothèque](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-242">For more info on hello ADAL SDK's and access hello reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="e7330-243">toolearn en savoir plus sur les scénarios mutualisés, consultez [comment toosign les utilisateurs à l’aide du modèle d’architecture mutualisée hello](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e7330-243">toolearn more about multi-tenant scenarios, see [How toosign in users using hello multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>
