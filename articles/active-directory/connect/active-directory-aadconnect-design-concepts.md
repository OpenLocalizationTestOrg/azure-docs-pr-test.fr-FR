---
title: "Azure AD Connect : principes de conception | Microsoft Docs"
description: "Cette rubrique détaille certains aspects de la conception de l’implémentation"
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: 
ms.assetid: 4114a6c0-f96a-493c-be74-1153666ce6c9
ms.service: active-directory
ms.custom: azure-ad-connect
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/13/2017
ms.author: billmath
ms.openlocfilehash: f23443d438c95a784f655fb9a5f20dfcf37be189
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-design-concepts"></a><span data-ttu-id="a9ff5-103">Principes de conception Azure AD Connect</span><span class="sxs-lookup"><span data-stu-id="a9ff5-103">Azure AD Connect: Design concepts</span></span>
<span data-ttu-id="a9ff5-104">L’objectif de cette rubrique est de décrire les principes qui doivent présider à la conception de l’implémentation d’Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-104">The purpose of this topic is to describe areas that must be thought through during the implementation design of Azure AD Connect.</span></span> <span data-ttu-id="a9ff5-105">Il s’agit d’une exploration approfondie de certains aspects. Ces concepts sont également décrits brièvement dans d’autres rubriques.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-105">This topic is a deep dive on certain areas and these concepts are briefly described in other topics as well.</span></span>

## <a name="sourceanchor"></a><span data-ttu-id="a9ff5-106">sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="a9ff5-106">sourceAnchor</span></span>
<span data-ttu-id="a9ff5-107">L’attribut sourceAnchor est défini en tant qu’ *attribut immuable pendant la durée de vie d’un objet*.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-107">The sourceAnchor attribute is defined as *an attribute immutable during the lifetime of an object*.</span></span> <span data-ttu-id="a9ff5-108">Il identifie de façon univoque un objet comme étant le même objet local et dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-108">It uniquely identifies an object as being the same object on-premises and in Azure AD.</span></span> <span data-ttu-id="a9ff5-109">L’attribut est également appelé **immutableId** et les deux noms sont interchangeables.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-109">The attribute is also called **immutableId** and the two names are used interchangeable.</span></span>

<span data-ttu-id="a9ff5-110">Le mot « immuable », signifiant « qui ne peut pas être changé », est important dans cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-110">The word immutable, that is "cannot be changed", is important to this topic.</span></span> <span data-ttu-id="a9ff5-111">Étant donné que la valeur de cet attribut ne peut pas être changée une fois qu’elle a été définie, il est important de choisir une conception qui prend en charge votre scénario.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-111">Since this attribute’s value cannot be changed after it has been set, it is important to pick a design that supports your scenario.</span></span>

<span data-ttu-id="a9ff5-112">L’attribut est utilisé pour les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-112">The attribute is used for the following scenarios:</span></span>

* <span data-ttu-id="a9ff5-113">Quand un nouveau serveur de moteur de synchronisation est créé ou recréé après un scénario de récupération d’urgence, cet attribut lie les objets existants dans Azure AD à des objets locaux.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-113">When a new sync engine server is built, or rebuilt after a disaster recovery scenario, this attribute links existing objects in Azure AD with objects on-premises.</span></span>
* <span data-ttu-id="a9ff5-114">Si vous passez d’une identité de cloud uniquement à un modèle d’identité synchronisé, alors cet attribut permet une correspondance exacte et concrète des objets existants dans Azure AD avec des objets locaux.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-114">If you move from a cloud-only identity to a synchronized identity model, then this attribute allows objects to "hard match" existing objects in Azure AD with on-premises objects.</span></span>
* <span data-ttu-id="a9ff5-115">Si vous utilisez la fédération, alors cet attribut est utilisé avec **userPrincipalName** dans la revendication pour identifier un utilisateur de façon univoque.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-115">If you use federation, then this attribute together with the **userPrincipalName** is used in the claim to uniquely identify a user.</span></span>

<span data-ttu-id="a9ff5-116">Cette rubrique traite de sourceAnchor seulement par rapport aux utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-116">This topic only talks about sourceAnchor as it relates to users.</span></span> <span data-ttu-id="a9ff5-117">Les mêmes règles s’appliquent à tous les types d’objets, mais le problème ne se pose généralement que pour des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-117">The same rules apply to all object types, but it is only for users this problem usually is a concern.</span></span>

### <a name="selecting-a-good-sourceanchor-attribute"></a><span data-ttu-id="a9ff5-118">Sélection d’un attribut sourceAnchor approprié</span><span class="sxs-lookup"><span data-stu-id="a9ff5-118">Selecting a good sourceAnchor attribute</span></span>
<span data-ttu-id="a9ff5-119">La valeur de l’attribut doit respecter les règles suivantes :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-119">The attribute value must follow the following rules:</span></span>

* <span data-ttu-id="a9ff5-120">sa longueur doit être inférieure à 60 caractères</span><span class="sxs-lookup"><span data-stu-id="a9ff5-120">Be less than 60 characters in length</span></span>
  * <span data-ttu-id="a9ff5-121">les caractères autres que a-z, A-Z ou 0-9 sont codés et comptabilisés comme 3 caractères</span><span class="sxs-lookup"><span data-stu-id="a9ff5-121">Characters not being a-z, A-Z, or 0-9 are encoded and counted as 3 characters</span></span>
* <span data-ttu-id="a9ff5-122">elle ne doit pas contenir les caractères spéciaux suivants : &#92; !</span><span class="sxs-lookup"><span data-stu-id="a9ff5-122">Not contain a special character: &#92; !</span></span> <span data-ttu-id="a9ff5-123"># $ % & * + / = ?</span><span class="sxs-lookup"><span data-stu-id="a9ff5-123"># $ % & * + / = ?</span></span> <span data-ttu-id="a9ff5-124">^ &#96; { } | ~ < > ( ) ’ ; : , [ ] " @ _</span><span class="sxs-lookup"><span data-stu-id="a9ff5-124">^ &#96; { } | ~ < > ( ) ' ; : , [ ] " @ _</span></span>
* <span data-ttu-id="a9ff5-125">elle doit être globalement unique</span><span class="sxs-lookup"><span data-stu-id="a9ff5-125">Must be globally unique</span></span>
* <span data-ttu-id="a9ff5-126">elle doit être une chaîne, un entier ou une valeur binaire</span><span class="sxs-lookup"><span data-stu-id="a9ff5-126">Must be either a string, integer, or binary</span></span>
* <span data-ttu-id="a9ff5-127">elle ne doit pas être basée sur le nom de l’utilisateur, celui-ci est susceptible de changer</span><span class="sxs-lookup"><span data-stu-id="a9ff5-127">Should not be based on user's name, these changes</span></span>
* <span data-ttu-id="a9ff5-128">elle ne doit pas respecter la casse et doit éviter les valeurs qui peuvent varier selon la casse</span><span class="sxs-lookup"><span data-stu-id="a9ff5-128">Should not be case-sensitive and avoid values that may vary by case</span></span>
* <span data-ttu-id="a9ff5-129">elle doit être assignée lorsque l’objet est créé.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-129">Should be assigned when the object is created</span></span>

<span data-ttu-id="a9ff5-130">Si le sourceAnchor sélectionné n’est pas de type chaîne, alors Azure AD Connect encode la valeur de l’attribut en base 64 pour garantir qu’aucun caractère spécial n’apparaît.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-130">If the selected sourceAnchor is not of type string, then Azure AD Connect Base64Encode the attribute value to ensure no special characters appear.</span></span> <span data-ttu-id="a9ff5-131">Si vous utilisez un serveur de fédération autre qu’ADFS, assurez-vous que votre serveur a également la capacité d’encoder la valeur de l’attribut en base 64.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-131">If you use another federation server than ADFS, make sure your server can also Base64Encode the attribute.</span></span>

<span data-ttu-id="a9ff5-132">L’attribut sourceAnchor respecte la casse.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-132">The sourceAnchor attribute is case-sensitive.</span></span> <span data-ttu-id="a9ff5-133">La valeur « JohnDoe » n’est pas le même que « johndoe ».</span><span class="sxs-lookup"><span data-stu-id="a9ff5-133">A value of “JohnDoe” is not the same as “johndoe”.</span></span> <span data-ttu-id="a9ff5-134">Mais vous ne devez pas avoir deux objets différents avec uniquement une différence de casse.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-134">But you should not have two different objects with only a difference in case.</span></span>

<span data-ttu-id="a9ff5-135">Si vous avez une seule forêt locale, alors l’attribut que vous devez utiliser est **objectGUID**.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-135">If you have a single forest on-premises, then the attribute you should use is **objectGUID**.</span></span> <span data-ttu-id="a9ff5-136">C’est également l’attribut utilisé quand vous utilisez la configuration rapide dans Azure AD Connect, ainsi que l’attribut utilisé par DirSync.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-136">This is also the attribute used when you use express settings in Azure AD Connect and also the attribute used by DirSync.</span></span>

<span data-ttu-id="a9ff5-137">Si vous avez plusieurs forêts et que vous ne déplacez pas d’utilisateurs entre les forêts et les domaines , alors **objectGUID** est un attribut approprié à utiliser même dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-137">If you have multiple forests and do not move users between forests and domains, then **objectGUID** is a good attribute to use even in this case.</span></span>

<span data-ttu-id="a9ff5-138">Si vous déplacez des utilisateurs entre des forêts et des domaines, alors vous devez trouver un attribut qui ne change pas ou qui peut être déplacé en même temps que les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-138">If you move users between forests and domains, then you must find an attribute that does not change or can be moved with the users during the move.</span></span> <span data-ttu-id="a9ff5-139">Une approche recommandée est d'introduire un attribut synthétique.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-139">A recommended approach is to introduce a synthetic attribute.</span></span> <span data-ttu-id="a9ff5-140">Un attribut qui peut contenir quelque chose qui ressemble à un GUID serait approprié.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-140">An attribute that could hold something that looks like a GUID would be suitable.</span></span> <span data-ttu-id="a9ff5-141">Lors de la création d’un objet, un nouveau GUID est créé et affecté à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-141">During object creation, a new GUID is created and stamped on the user.</span></span> <span data-ttu-id="a9ff5-142">Une règle de synchronisation personnalisée peut être créée dans le serveur du moteur de synchronisation pour générer cette valeur selon **objectGUID** et mettre à jour l’attribut sélectionné dans ADDS.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-142">A custom sync rule can be created in the sync engine server to create this value based on the **objectGUID** and update the selected attribute in ADDS.</span></span> <span data-ttu-id="a9ff5-143">Quand vous déplacez l’objet, veillez à copier également le contenu de cette valeur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-143">When you move the object, make sure to also copy the content of this value.</span></span>

<span data-ttu-id="a9ff5-144">Une autre solution consiste à choisir un attribut existant, dont vous êtes sûr qu’il ne changera pas.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-144">Another solution is to pick an existing attribute you know does not change.</span></span> <span data-ttu-id="a9ff5-145">**employeeID**est un des attributs couramment utilisés.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-145">Commonly used attributes include **employeeID**.</span></span> <span data-ttu-id="a9ff5-146">Si vous envisagez d’opter pour un attribut contenant des lettres, assurez-vous qu’il n’y a aucun risque de changement de la casse (majuscule ou minuscule) pour la valeur de l’attribut.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-146">If you consider an attribute that contains letters, make sure there is no chance the case (upper case vs. lower case) can change for the attribute's value.</span></span> <span data-ttu-id="a9ff5-147">Des attributs inappropriés qui ne doivent pas être utilisés sont notamment ceux qui ont le nom de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-147">Bad attributes that should not be used include those attributes with the name of the user.</span></span> <span data-ttu-id="a9ff5-148">En cas de mariage ou de divorce, le nom risque de changer, ce qui n’est pas autorisé pour cet attribut.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-148">In a marriage or divorce, the name is expected to change, which is not allowed for this attribute.</span></span> <span data-ttu-id="a9ff5-149">C'est également une raison pour laquelle il n'est même pas possible de sélectionner des attributs comme **userPrincipalName**, **mail** et **targetAddress** dans l'Assistant Installation d'Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-149">This is also one reason why attributes such as **userPrincipalName**, **mail**, and **targetAddress** are not even possible to select in the Azure AD Connect installation wizard.</span></span> <span data-ttu-id="a9ff5-150">Ces attributs contiennent également le caractère « @ », qui n’est pas autorisé dans sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-150">Those attributes also contain the "@" character, which is not allowed in the sourceAnchor.</span></span>

### <a name="changing-the-sourceanchor-attribute"></a><span data-ttu-id="a9ff5-151">Changement de l’attribut sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="a9ff5-151">Changing the sourceAnchor attribute</span></span>
<span data-ttu-id="a9ff5-152">La valeur de l’attribut sourceAnchor ne peut pas être changée une fois que l’objet a été créé dans Azure AD et que l’identité est synchronisée.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-152">The sourceAnchor attribute value cannot be changed after the object has been created in Azure AD and the identity is synchronized.</span></span>

<span data-ttu-id="a9ff5-153">Pour cette raison, les restrictions suivantes s’appliquent à Azure AD Connect :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-153">For this reason, the following restrictions apply to Azure AD Connect:</span></span>

* <span data-ttu-id="a9ff5-154">L’attribut sourceAnchor peut être défini seulement lors de l’installation initiale.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-154">The sourceAnchor attribute can only be set during initial installation.</span></span> <span data-ttu-id="a9ff5-155">Si vous exécutez une nouvelle fois l’Assistant Installation, cette option est en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-155">If you rerun the installation wizard, this option is read-only.</span></span> <span data-ttu-id="a9ff5-156">Si vous devez changer ce paramètre, alors vous devez effectuer une désinstallation et une réinstallation.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-156">If you need to change this setting, then you must uninstall and reinstall.</span></span>
* <span data-ttu-id="a9ff5-157">Si vous installez un autre serveur Azure AD Connect, vous devez sélectionner le même attribut sourceAnchor que celui qui a été précédemment utilisé.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-157">If you install another Azure AD Connect server, then you must select the same sourceAnchor attribute as previously used.</span></span> <span data-ttu-id="a9ff5-158">Si vous avez précédemment utilisé DirSync et que vous passez à Azure AD Connect, vous devez utiliser **objectGUID** , car il s'agit de l’attribut utilisé par DirSync.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-158">If you have earlier been using DirSync and move to Azure AD Connect, then you must use **objectGUID** since that is the attribute used by DirSync.</span></span>
* <span data-ttu-id="a9ff5-159">Si la valeur de sourceAnchor est changée après que l’objet a été exporté vers Azure AD, alors Azure AD Connect Sync génère une erreur et n’autorise plus de modifications sur cet objet avant que le problème ait été résolu et que sourceAnchor soit replacé à sa valeur précédente dans le répertoire source.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-159">If the value for sourceAnchor is changed after the object has been exported to Azure AD, then Azure AD Connect sync throws an error and does not allow any more changes on that object before the issue has been fixed and the sourceAnchor is changed back in the source directory.</span></span>

## <a name="using-msds-consistencyguid-as-sourceanchor"></a><span data-ttu-id="a9ff5-160">Utilisation de msDS-ConsistencyGuid en tant que sourceAnchor</span><span class="sxs-lookup"><span data-stu-id="a9ff5-160">Using msDS-ConsistencyGuid as sourceAnchor</span></span>
<span data-ttu-id="a9ff5-161">Par défaut, Azure AD Connect (version 1.1.486.0 ou antérieure) utilise objectGUID comme attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-161">By default, Azure AD Connect (version 1.1.486.0 and older) uses objectGUID as the sourceAnchor attribute.</span></span> <span data-ttu-id="a9ff5-162">ObjectGUID est généré par le système.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-162">ObjectGUID is system-generated.</span></span> <span data-ttu-id="a9ff5-163">Vous ne pouvez pas spécifier sa valeur lors de la création d’objets Active Directory locaux.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-163">You cannot specify its value when creating on-premises AD objects.</span></span> <span data-ttu-id="a9ff5-164">Comme expliqué dans la section [sourceAnchor](#sourceanchor), il existe des scénarios où vous devez spécifier la valeur sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-164">As explained in section [sourceAnchor](#sourceanchor), there are scenarios where you need to specify the sourceAnchor value.</span></span> <span data-ttu-id="a9ff5-165">Si les scénarios ne s’appliquent pas à vous, vous devez utiliser un attribut AD configurable (par exemple, msDS-ConsistencyGuid) en tant qu’attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-165">If the scenarios are applicable to you, you must use a configurable AD attribute (for example, msDS-ConsistencyGuid) as the sourceAnchor attribute.</span></span>

<span data-ttu-id="a9ff5-166">Azure AD Connect (version 1.1.524.0 ou ultérieure) facilite l’utilisation de l’attribut msDS-ConsistencyGuid en tant qu’attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-166">Azure AD Connect (version 1.1.524.0 and after) now facilitates the use of msDS-ConsistencyGuid as sourceAnchor attribute.</span></span> <span data-ttu-id="a9ff5-167">Lorsque vous utilisez cette fonctionnalité, Azure AD Connect configure automatiquement les règles de synchronisation pour :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-167">When using this feature, Azure AD Connect automatically configures the synchronization rules to:</span></span>

1. <span data-ttu-id="a9ff5-168">Utiliser msDS-ConsistencyGuid en tant qu’attribut sourceAnchor pour les objets utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-168">Use msDS-ConsistencyGuid as the sourceAnchor attribute for User objects.</span></span> <span data-ttu-id="a9ff5-169">ObjectGUID est utilisé pour d’autres types d’objets.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-169">ObjectGUID is used for other object types.</span></span>

2. <span data-ttu-id="a9ff5-170">Pour tout objet utilisateur AD local dont l’attribut msDS-ConsistencyGuid n’est pas spécifié, Azure AD Connect réécrit sa valeur objectGUID dans l’attribut msDS-ConsistencyGuid dans l’Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-170">For any given on-premises AD User object whose msDS-ConsistencyGuid attribute isn't populated, Azure AD Connect writes its objectGUID value back to the msDS-ConsistencyGuid attribute in on-premises Active Directory.</span></span> <span data-ttu-id="a9ff5-171">Une fois l’attribut msDS-ConsistencyGuid spécifié, Azure AD Connect exporte l’objet vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-171">After the msDS-ConsistencyGuid attribute is populated, Azure AD Connect then exports the object to Azure AD.</span></span>

>[!NOTE]
> <span data-ttu-id="a9ff5-172">Une fois qu’un objet Active Directory local est importé dans Azure AD Connect (c’est-à-dire, importé dans l’espace de connecteur AD et projeté dans le Metaverse), vous ne pouvez plus modifier sa valeur sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-172">Once an on-premises AD object is imported into Azure AD Connect (that is, imported into the AD Connector Space and projected into the Metaverse), you cannot change its sourceAnchor value anymore.</span></span> <span data-ttu-id="a9ff5-173">Pour spécifier la valeur de sourceAnchor pour un objet AD local donné, configurez son attribut msDS-ConsistencyGuid avant son importation dans Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-173">To specify the sourceAnchor value for a given on-premises AD object, configure its msDS-ConsistencyGuid attribute before it is imported into Azure AD Connect.</span></span>

### <a name="permission-required"></a><span data-ttu-id="a9ff5-174">Autorisation requise</span><span class="sxs-lookup"><span data-stu-id="a9ff5-174">Permission required</span></span>
<span data-ttu-id="a9ff5-175">Pour que cette fonctionnalité opère, le compte AD DS utilisé pour effectuer la synchronisation avec l’Active Directory local doit disposer d’une autorisation en écriture sur l’attribut msDS-ConsistencyGuid dans l’Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-175">For this feature to work, the AD DS account used to synchronize with on-premises Active Directory must be granted write permission to the msDS-ConsistencyGuid attribute in on-premises Active Directory.</span></span>

### <a name="how-to-enable-the-consistencyguid-feature---new-installation"></a><span data-ttu-id="a9ff5-176">Comment activer la fonctionnalité ConsistencyGuid - nouvelle installation</span><span class="sxs-lookup"><span data-stu-id="a9ff5-176">How to enable the ConsistencyGuid feature - New installation</span></span>
<span data-ttu-id="a9ff5-177">Vous pouvez activer l’utilisation de ConsistencyGuid en tant que sourceAnchor pendant une nouvelle installation.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-177">You can enable the use of ConsistencyGuid as sourceAnchor during new installation.</span></span> <span data-ttu-id="a9ff5-178">Cette section décrit en détail l’installation rapide et l’installation personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-178">This section covers both Express and Custom installation in details.</span></span>

  >[!NOTE]
  > <span data-ttu-id="a9ff5-179">Seules les versions plus récentes d’Azure AD Connect (1.1.524.0 et ultérieures) prennent en charge l’utilisation de ConsistencyGuid en tant que sourceAnchor lors d’une nouvelle installation.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-179">Only newer versions of Azure AD Connect (1.1.524.0 and after) supports the use of ConsistencyGuid as sourceAnchor during new installation.</span></span>

### <a name="how-to-enable-the-consistencyguid-feature"></a><span data-ttu-id="a9ff5-180">Comment activer la fonctionnalité ConsistencyGuid</span><span class="sxs-lookup"><span data-stu-id="a9ff5-180">How to enable the ConsistencyGuid feature</span></span>
<span data-ttu-id="a9ff5-181">Actuellement, cette fonctionnalité ne peut être activée que durant une nouvelle installation d’Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-181">Currently, the feature can only be enabled during new Azure AD Connect installation only.</span></span>

#### <a name="express-installation"></a><span data-ttu-id="a9ff5-182">Installation rapide</span><span class="sxs-lookup"><span data-stu-id="a9ff5-182">Express Installation</span></span>
<span data-ttu-id="a9ff5-183">Lorsque vous installez Azure AD Connect en mode Express, l’Assistant Azure AD Connect détermine automatiquement l’attribut AD le plus approprié à utiliser en tant qu’attribut sourceAnchor à l’aide de la logique suivante :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-183">When installing Azure AD Connect with Express mode, the Azure AD Connect wizard automatically determines the most appropriate AD attribute to use as the sourceAnchor attribute using the following logic:</span></span>

* <span data-ttu-id="a9ff5-184">Tout d’abord, l’Assistant Azure AD Connect interroge votre client Azure AD pour extraire l’attribut Active Directory utilisé comme attribut sourceAnchor lors de la précédente installation d’Azure AD Connect (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="a9ff5-184">First, the Azure AD Connect wizard queries your Azure AD tenant to retrieve the AD attribute used as the sourceAnchor attribute in the previous Azure AD Connect installation (if any).</span></span> <span data-ttu-id="a9ff5-185">Si cette information est disponible, Azure AD Connect utilise le même attribut AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-185">If this information is available, Azure AD Connect uses the same AD attribute.</span></span>

  >[!NOTE]
  > <span data-ttu-id="a9ff5-186">Seules les versions plus récentes d’Azure AD Connect (1.1.524.0 et ultérieures) stockent des informations dans votre locataire Azure AD concernant l’attribut sourceAnchor utilisé pendant l’installation.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-186">Only newer versions of Azure AD Connect (1.1.524.0 and after) stores information in your Azure AD tenant about the sourceAnchor attribute used during installation.</span></span> <span data-ttu-id="a9ff5-187">Les versions antérieures d’Azure AD Connect ne le font pas.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-187">Older versions of Azure AD Connect do not.</span></span>

* <span data-ttu-id="a9ff5-188">Si des informations sur l’attribut sourceAnchor utilisé ne sont pas disponibles, l’Assistant vérifie l’état de l’attribut msDS-ConsistencyGuid dans votre annuaire Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-188">If information about the sourceAnchor attribute used isn't available, the wizard checks the state of the msDS-ConsistencyGuid attribute in your on-premises Active Directory.</span></span> <span data-ttu-id="a9ff5-189">Si l’attribut n’est configuré sur aucun objet dans l’annuaire, l’Assistant utilise l’attribut msDS-ConsistencyGuid en tant qu’attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-189">If the attribute isn't configured on any object in the directory, the wizard uses the msDS-ConsistencyGuid as the sourceAnchor attribute.</span></span> <span data-ttu-id="a9ff5-190">Si l’attribut est configuré sur un ou plusieurs objets dans l’annuaire, l’Assistant en déduit que l’attribut est utilisé par d’autres applications et n’est pas adapté en tant qu’attribut sourceAnchor...</span><span class="sxs-lookup"><span data-stu-id="a9ff5-190">If the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by other applications and is not suitable as sourceAnchor attribute...</span></span>

* <span data-ttu-id="a9ff5-191">Dans ce cas, l’Assistant revient à l’utilisation d’objectGUID comme attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-191">In which case, the wizard falls back to using objectGUID as the sourceAnchor attribute.</span></span>

* <span data-ttu-id="a9ff5-192">Une fois l’attribut sourceAnchor choisi, l’Assistant stocke les informations dans votre client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-192">Once the sourceAnchor attribute is decided, the wizard stores the information in your Azure AD tenant.</span></span> <span data-ttu-id="a9ff5-193">Les informations seront utilisées dans le cadre d’une installation future d’Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-193">The information will be used by future installation of Azure AD Connect.</span></span>

<span data-ttu-id="a9ff5-194">Une fois l’installation rapide terminée, l’Assistant vous informe concernant l’attribut sélectionné comme attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-194">Once Express installation completes, the wizard informs you which attribute has been picked as the Source Anchor attribute.</span></span>

![L’Assistant informe concernant attribut AD choisi pour sourceAnchor](./media/active-directory-aadconnect-design-concepts/consistencyGuid-01.png)

#### <a name="custom-installation"></a><span data-ttu-id="a9ff5-196">Installation personnalisée</span><span class="sxs-lookup"><span data-stu-id="a9ff5-196">Custom installation</span></span>
<span data-ttu-id="a9ff5-197">Lorsque vous installez Azure AD Connect en mode personnalisé, l’Assistant Azure AD Connect fournit deux options lorsque vous configurez l’attribut sourceAnchor :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-197">When installing Azure AD Connect with Custom mode, the Azure AD Connect wizard provides two options when configuring sourceAnchor attribute:</span></span>

![Installation personnalisée - Configuration de sourceAnchor](./media/active-directory-aadconnect-design-concepts/consistencyGuid-02.png)

| <span data-ttu-id="a9ff5-199">Paramètre</span><span class="sxs-lookup"><span data-stu-id="a9ff5-199">Setting</span></span> | <span data-ttu-id="a9ff5-200">Description</span><span class="sxs-lookup"><span data-stu-id="a9ff5-200">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a9ff5-201">Let Azure manage the source anchor for me (Laisser Azure gérer l’ancre source pour moi)</span><span class="sxs-lookup"><span data-stu-id="a9ff5-201">Let Azure manage the source anchor for me</span></span> | <span data-ttu-id="a9ff5-202">Sélectionnez cette option si vous souhaitez qu’Azure AD choisissez l’attribut pour vous.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-202">Select this option if you want Azure AD to pick the attribute for you.</span></span> <span data-ttu-id="a9ff5-203">Si vous sélectionnez cette option, l’Assistant Azure AD Connect applique la même [logique de sélection de l’attribut sourceAnchor que celle utilisée lors de l’installation rapide](#express-installation).</span><span class="sxs-lookup"><span data-stu-id="a9ff5-203">If you select this option, Azure AD Connect wizard applies the same [sourceAnchor attribute selection logic used during Express installation](#express-installation).</span></span> <span data-ttu-id="a9ff5-204">Comme pour l’installation rapide, L’Assistant vous indique quel attribut a été sélectionné comme attribut sourcAnchor une fois l’installation personnalisée terminée.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-204">Similar to Express installation, the wizard informs you which attribute has been picked as the Source Anchor attribute after Custom installation completes.</span></span> |
| <span data-ttu-id="a9ff5-205">Un attribut spécifique</span><span class="sxs-lookup"><span data-stu-id="a9ff5-205">A specific attribute</span></span> | <span data-ttu-id="a9ff5-206">Sélectionnez cette option si vous souhaitez spécifier un attribut AD existant comme attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-206">Select this option if you wish to specify an existing AD attribute as the sourceAnchor attribute.</span></span> |

### <a name="how-to-enable-the-consistencyguid-feature---existing-deployment"></a><span data-ttu-id="a9ff5-207">Comment activer la fonctionnalité ConsistencyGuid - déploiement existant</span><span class="sxs-lookup"><span data-stu-id="a9ff5-207">How to enable the ConsistencyGuid feature - Existing deployment</span></span>
<span data-ttu-id="a9ff5-208">Si vous avez un déploiement Azure AD Connect existant qui utilise objectGUID comme attribut Source Anchor, vous pouvez faire en sorte qu’il utilise ConsistencyGuid à la place.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-208">If you have an existing Azure AD Connect deployment which is using objectGUID as the Source Anchor attribute, you can switch it to using ConsistencyGuid instead.</span></span>

>[!NOTE]
> <span data-ttu-id="a9ff5-209">Seules les versions plus récentes d’Azure AD Connect (1.1.552.0 et ultérieures) prennent en charge le passage d’ObjectGuid à ConsistencyGuid en tant qu’attribut Ancre source.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-209">Only newer versions of Azure AD Connect (1.1.552.0 and after) supports switching from ObjectGuid to ConsistencyGuid as the Source Anchor attribute.</span></span>

<span data-ttu-id="a9ff5-210">Pour passer d’objectGUID à ConsistencyGuid en tant qu’attribut Ancre source :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-210">To switch from objectGUID to ConsistencyGuid as the Source Anchor attribute:</span></span>

1. <span data-ttu-id="a9ff5-211">Démarrez l’Assistant Azure AD Connect et cliquez sur **Configurer** pour accéder à l’écran Tâches.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-211">Start the Azure AD Connect wizard and click **Configure** to go to the Tasks screen.</span></span>

2. <span data-ttu-id="a9ff5-212">Sélectionnez l’option de tâche **Configurer l’ancre source** et cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-212">Select the **Configure Source Anchor** task option and click **Next**.</span></span>

   ![Activer ConsistencyGuid pour un déploiement existant - Étape 2](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment01.png)

3. <span data-ttu-id="a9ff5-214">Entrez vos informations d’identification d’administrateur Azure AD et cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-214">Enter your Azure AD Administrator credentials and click **Next**.</span></span>

4. <span data-ttu-id="a9ff5-215">L’Assistant Azure AD Connect vérifie l’état de l’attribut msDS-ConsistencyGuid dans votre annuaire Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-215">Azure AD Connect wizard analyzes the state of the msDS-ConsistencyGuid attribute in your on-premises Active Directory.</span></span> <span data-ttu-id="a9ff5-216">Si l’attribut n’est configuré sur aucun objet de l’annuaire, Azure AD Connect conclut qu’aucune autre application n’utilise actuellement l’attribut et qu’il peut être utilisé comme attribut Ancre Source en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-216">If the attribute isn't configured on any object in the directory, Azure AD Connect concludes that no other application is currently using the attribute and is safe to use it as the Source Anchor attribute.</span></span> <span data-ttu-id="a9ff5-217">Cliquez sur **Suivant** pour continuer.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-217">Click **Next** to continue.</span></span>

   ![Activer ConsistencyGuid pour un déploiement existant - Étape 4](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment02.png)

5. <span data-ttu-id="a9ff5-219">Dans l’écran **Prêt à configurer**, cliquez sur **Configurer** pour modifier la configuration.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-219">In the **Ready to Configure** screen, click **Configure** to make the configuration change.</span></span>

   ![Activer ConsistencyGuid pour un déploiement existant - Étape 5](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment03.png)

6. <span data-ttu-id="a9ff5-221">Une fois la configuration terminée, l’Assistant indique que msDS-ConsistencyGuid est maintenant utilisé en tant qu’attribut Ancre source.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-221">Once the configuration completes, the wizard indicates that msDS-ConsistencyGuid is now being used as the Source Anchor attribute.</span></span>

   ![Activer ConsistencyGuid pour un déploiement existant - Étape 6](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeployment04.png)

<span data-ttu-id="a9ff5-223">Pendant l’analyse (étape 4), si l’attribut est configuré sur un ou plusieurs objets de l’annuaire, l’Assistant en déduit que l’attribut est utilisé par une autre application et retourne une erreur, comme illustré dans le diagramme ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-223">During the analysis (step 4), if the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by another application and returns an error as illustrated in the diagram below.</span></span> <span data-ttu-id="a9ff5-224">Si vous êtes certain qu’attribut n’est pas utilisé par des applications existantes, contactez le Support technique pour plus d’informations sur la manière de supprimer l’erreur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-224">If you are certain that the attribute isn't used by existing applications, you need to contact Support for information on how to suppress the error.</span></span>

![Activer ConsistencyGuid pour un déploiement existant - Erreur](./media/active-directory-aadconnect-design-concepts/consistencyguidexistingdeploymenterror.png)

### <a name="impact-on-ad-fs-or-third-party-federation-configuration"></a><span data-ttu-id="a9ff5-226">Impact sur AD FS d’une configuration de fédération tierce</span><span class="sxs-lookup"><span data-stu-id="a9ff5-226">Impact on AD FS or third-party federation configuration</span></span>
<span data-ttu-id="a9ff5-227">Si vous utilisez Azure AD Connect pour gérer un déploiement d’AD FS local, Azure AD Connect met automatiquement à jour les règles de revendication pour utiliser le même attribut AD en tant qu’attribut sourceAnchor.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-227">If you are using Azure AD Connect to manage on-premises AD FS deployment, the Azure AD Connect automatically updates the claim rules to use the same AD attribute as sourceAnchor.</span></span> <span data-ttu-id="a9ff5-228">Cela garantit que la revendication ImmutableID générée par ADFS est cohérente avec les valeurs de sourceAnchor exportées vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-228">This ensures that the ImmutableID claim generated by ADFS is consistent with the sourceAnchor values exported to Azure AD.</span></span>

<span data-ttu-id="a9ff5-229">Si vous gérez AD FS en dehors d’Azure AD Connect ou si vous utilisez des serveurs de fédération tiers pour l’authentification, vous devez mettre à jour manuellement les règles de revendication pour que la revendication ImmutableID soit cohérente avec les valeurs de sourceAnchor exportées vers Azure AD, comme décrit dans la section [Modifier les règles de revendication AD FS](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-federation-management#modclaims) de l’article.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-229">If you are managing AD FS outside of Azure AD Connect or you are using third-party federation servers for authentication, you must manually update the claim rules for ImmutableID claim to be consistent with the sourceAnchor values exported to Azure AD as described in article section [Modify AD FS claim rules](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-federation-management#modclaims).</span></span> <span data-ttu-id="a9ff5-230">Une fois l’installation terminée, L’Assistant renvoie l’avertissement suivant :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-230">The wizard returns the following warning after installation completes:</span></span>

![Configuration de fédération tierce](./media/active-directory-aadconnect-design-concepts/consistencyGuid-03.png)

### <a name="adding-new-directories-to-existing-deployment"></a><span data-ttu-id="a9ff5-232">Ajout d’annuaires à un déploiement existant</span><span class="sxs-lookup"><span data-stu-id="a9ff5-232">Adding new directories to existing deployment</span></span>
<span data-ttu-id="a9ff5-233">Supposons que vous avez déployé Azure AD Connect avec la fonctionnalité ConsistencyGuid activée, et que vous souhaitez ajouter un annuaire au déploiement.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-233">Suppose you have deployed Azure AD Connect with the ConsistencyGuid feature enabled, and now you would like to add another directory to the deployment.</span></span> <span data-ttu-id="a9ff5-234">Lorsque vous tentez d’ajouter l’annuaire, Assistant Azure AD Connect vérifie l’état de l’attribut mSDS-ConsistencyGuid dans l’annuaire.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-234">When you try to add the directory, Azure AD Connect wizard checks the state of the mSDS-ConsistencyGuid attribute in the directory.</span></span> <span data-ttu-id="a9ff5-235">Si l’attribut est configuré sur un ou plusieurs objets dans l’annuaire, l’Assistant en déduit que l’attribut est utilisé par d’autres applications et retourne une erreur, comme illustré dans la diagramme ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-235">If the attribute is configured on one or more objects in the directory, the wizard concludes the attribute is being used by other applications and returns an error as illustrated in the diagram below.</span></span> <span data-ttu-id="a9ff5-236">Si vous êtes certain qu’attribut n’est pas utilisé par des applications existantes, contactez le Support technique pour plus d’informations sur la manière de supprimer l’erreur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-236">If you are certain that the attribute isn't used by existing applications, you need to contact Support for information on how to suppress the error.</span></span>

![Ajout d’annuaires à un déploiement existant](./media/active-directory-aadconnect-design-concepts/consistencyGuid-04.png)

## <a name="azure-ad-sign-in"></a><span data-ttu-id="a9ff5-238">Authentification dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9ff5-238">Azure AD sign-in</span></span>
<span data-ttu-id="a9ff5-239">Lorsque vous intégrez votre annuaire local à Azure AD, il est important de bien comprendre comment les paramètres de synchronisation peuvent affecter la manière dont les utilisateurs s’authentifient.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-239">While integrating your on-premises directory with Azure AD, it is important to understand how the synchronization settings can affect the way user authenticates.</span></span> <span data-ttu-id="a9ff5-240">Azure AD utilise userPrincipalName (UPN) pour authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-240">Azure AD uses userPrincipalName (UPN) to authenticate the user.</span></span> <span data-ttu-id="a9ff5-241">Toutefois, lorsque vous synchronisez vos utilisateurs, vous devez choisir avec soin l’attribut à utiliser pour la valeur de userPrincipalName.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-241">However, when you synchronize your users, you must choose the attribute to be used for value of userPrincipalName carefully.</span></span>

### <a name="choosing-the-attribute-for-userprincipalname"></a><span data-ttu-id="a9ff5-242">Choix de l’attribut de userPrincipalName</span><span class="sxs-lookup"><span data-stu-id="a9ff5-242">Choosing the attribute for userPrincipalName</span></span>
<span data-ttu-id="a9ff5-243">Lorsque vous sélectionnez l’attribut fournissant la valeur d’UPN à utiliser dans Azure, vous devez vous assurer que :</span><span class="sxs-lookup"><span data-stu-id="a9ff5-243">When you are selecting the attribute for providing the value of UPN to be used in Azure one should ensure</span></span>

* <span data-ttu-id="a9ff5-244">Les valeurs de l’attribut sont conformes à la syntaxe UPN (RFC 822), c’est-à-dire au format username@domain</span><span class="sxs-lookup"><span data-stu-id="a9ff5-244">The attribute values conform to the UPN syntax (RFC 822), that is it should be of the format username@domain</span></span>
* <span data-ttu-id="a9ff5-245">Le suffixe des valeurs correspond à l’un des domaines personnalisés vérifiés dans Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9ff5-245">The suffix in the values matches to one of the verified custom domains in Azure AD</span></span>

<span data-ttu-id="a9ff5-246">Dans la configuration rapide, le choix supposé de l’attribut est userPrincipalName.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-246">In express settings, the assumed choice for the attribute is userPrincipalName.</span></span> <span data-ttu-id="a9ff5-247">Si l’attribut userPrincipalName ne contient pas la valeur que vous souhaitez que vos utilisateurs utilisent pour se connecter à Azure, alors choisissez **Installation personnalisée**.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-247">If the userPrincipalName attribute does not contain the value you want your users to sign in to Azure, then you must choose **Custom Installation**.</span></span>

### <a name="custom-domain-state-and-upn"></a><span data-ttu-id="a9ff5-248">État du domaine personnalisé et UPN</span><span class="sxs-lookup"><span data-stu-id="a9ff5-248">Custom domain state and UPN</span></span>
<span data-ttu-id="a9ff5-249">Il est important de s’assurer qu’il existe un domaine vérifié pour le suffixe UPN.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-249">It is important to ensure that there is a verified domain for the UPN suffix.</span></span>

<span data-ttu-id="a9ff5-250">John est un utilisateur de contoso.com.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-250">John is a user in contoso.com.</span></span> <span data-ttu-id="a9ff5-251">Vous souhaitez que John utilise l’UPN local john@contoso.com pour se connecter à Azure une fois que vous avez synchronisé les utilisateurs sur votre répertoire Azure AD contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-251">You want John to use the on-premises UPN john@contoso.com to sign in to Azure after you have synced users to your Azure AD directory contoso.onmicrosoft.com.</span></span> <span data-ttu-id="a9ff5-252">Pour ce faire, vous devez ajouter et vérifier contoso.com comme domaine personnalisé dans Azure AD avant de commencer la synchronisation des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-252">To do so, you need to add and verify contoso.com as a custom domain in Azure AD before you can start syncing the users.</span></span> <span data-ttu-id="a9ff5-253">Si le suffixe UPN de John, par exemple contoso.com, ne correspond pas à un domaine vérifié dans Azure AD, alors Azure AD remplace le suffixe UPN par contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-253">If the UPN suffix of John, for example contoso.com, does not match a verified domain in Azure AD, then Azure AD replaces the UPN suffix with contoso.onmicrosoft.com.</span></span>

### <a name="non-routable-on-premises-domains-and-upn-for-azure-ad"></a><span data-ttu-id="a9ff5-254">Domaines locaux non routables et UPN pour Azure AD</span><span class="sxs-lookup"><span data-stu-id="a9ff5-254">Non-routable on-premises domains and UPN for Azure AD</span></span>
<span data-ttu-id="a9ff5-255">Certaines organisations ont des domaines non routables, comme contoso.local, ou de simples domaines à étiquette unique, comme contoso.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-255">Some organizations have non-routable domains, like contoso.local, or simple single label domains like contoso.</span></span> <span data-ttu-id="a9ff5-256">Dans Azure AD, vous n’êtes pas en mesure de vérifier un domaine non routable.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-256">You are not able to verify a non-routable domain in Azure AD.</span></span> <span data-ttu-id="a9ff5-257">Azure AD Connect peut uniquement se synchroniser sur un domaine vérifié dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-257">Azure AD Connect can sync to only a verified domain in Azure AD.</span></span> <span data-ttu-id="a9ff5-258">Lorsque vous créez un répertoire Azure AD, il crée un domaine routable qui devient le domaine par défaut de votre Azure AD, par exemple contoso.onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-258">When you create an Azure AD directory, it creates a routable domain that becomes default domain for your Azure AD for example, contoso.onmicrosoft.com.</span></span> <span data-ttu-id="a9ff5-259">Par conséquent, il devient nécessaire de vérifier tous les autres domaines routables dans un scénario de ce type, si vous ne souhaitez pas effectuer de synchronisation avec le domaine par défaut onmicrosoft.com.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-259">Therefore, it becomes necessary to verify any other routable domain in such a scenario in case you don't want to sync to the default onmicrosoft.com domain.</span></span>

<span data-ttu-id="a9ff5-260">Pour plus d’informations sur l’ajout et la vérification de domaines, consultez [Ajouter un nom de domaine personnalisé à Azure Active Directory](../active-directory-add-domain.md) .</span><span class="sxs-lookup"><span data-stu-id="a9ff5-260">Read [Add your custom domain name to Azure Active Directory](../active-directory-add-domain.md) for more info on adding and verifying domains.</span></span>

<span data-ttu-id="a9ff5-261">Azure AD Connect détecte si vous exécutez un environnement de domaine non routable et vous avertit en temps utile si vous tentez de poursuivre la configuration rapide.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-261">Azure AD Connect detects if you are running in a non-routable domain environment and would appropriately warn you from going ahead with express settings.</span></span> <span data-ttu-id="a9ff5-262">Si votre domaine n’est pas routable, il est probable que les UPN des utilisateurs aient également des suffixes non routables.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-262">If you are operating in a non-routable domain, then it is likely that the UPN of the users have non-routable suffixes too.</span></span> <span data-ttu-id="a9ff5-263">Par exemple, si votre domaine est contoso.local, Azure AD Connect vous propose d’utiliser des paramètres personnalisés plutôt que la configuration rapide.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-263">For example, if you are running under contoso.local, Azure AD Connect suggests you to use custom settings rather than using express settings.</span></span> <span data-ttu-id="a9ff5-264">Avec les paramètres personnalisés, vous êtes en mesure de spécifier l’attribut à utiliser comme UPN pour la connexion à Azure une fois les utilisateurs synchronisés avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a9ff5-264">Using custom settings, you are able to specify the attribute that should be used as UPN to sign in to Azure after the users are synced to Azure AD.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a9ff5-265">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a9ff5-265">Next steps</span></span>
<span data-ttu-id="a9ff5-266">En savoir plus sur l’ [intégration de vos identités locales avec Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="a9ff5-266">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
