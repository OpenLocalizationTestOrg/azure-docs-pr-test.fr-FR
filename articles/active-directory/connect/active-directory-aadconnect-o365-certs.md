---
title: "Renouvellement des certificats pour les utilisateurs d’Office 365 et d’Azure AD. | Microsoft Docs"
description: "Cet article explique aux utilisateurs d’Office 365 comment procéder s’ils reçoivent un e-mail les invitant à renouveler un certificat."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 7f1a3303eff9c413602e745b702baa659343eba6
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="fba88-103">Renouvellement des certificats de fédération pour Office 365 et Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="fba88-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="fba88-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="fba88-104">Overview</span></span>
<span data-ttu-id="fba88-105">Afin d’assurer la fédération réussie entre Azure Active Directory (Azure AD) et Active Directory Federation Services (AD FS), les certificats utilisés par AD FS pour signer les jetons de sécurité destinés à Azure AD doivent correspondre à la configuration d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fba88-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), the certificates used by AD FS to sign security tokens to Azure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="fba88-106">Toute incompatibilité peut entraîner une rupture de l’approbation.</span><span class="sxs-lookup"><span data-stu-id="fba88-106">Any mismatch can lead to broken trust.</span></span> <span data-ttu-id="fba88-107">Azure AD garantit la synchronisation de ces informations lorsque vous déployez AD FS et le proxy d’application web (pour l’accès extranet).</span><span class="sxs-lookup"><span data-stu-id="fba88-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="fba88-108">Cet article fournit des informations supplémentaires pour gérer vos certificats de signature de jetons et les maintenir synchronisés avec Azure AD dans les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="fba88-108">This article provides you additional information to manage your token signing certificates and keep them in sync with Azure AD, in the following cases:</span></span>

* <span data-ttu-id="fba88-109">Vous ne déployez pas le proxy d’application web ; les métadonnées de fédération ne sont donc pas disponibles dans l’extranet.</span><span class="sxs-lookup"><span data-stu-id="fba88-109">You are not deploying the Web Application Proxy, and therefore the federation metadata is not available in the extranet.</span></span>
* <span data-ttu-id="fba88-110">Vous n’utilisez pas la configuration par défaut d’AD FS pour les certificats de signature de jetons.</span><span class="sxs-lookup"><span data-stu-id="fba88-110">You are not using the default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="fba88-111">Vous utilisez un fournisseur d’identité tiers.</span><span class="sxs-lookup"><span data-stu-id="fba88-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="fba88-112">Configuration par défaut d’AD FS pour les certificats de signature de jetons</span><span class="sxs-lookup"><span data-stu-id="fba88-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="fba88-113">Les certificats de signature et de déchiffrement de jetons sont généralement des certificats auto-signés, valables pendant un an.</span><span class="sxs-lookup"><span data-stu-id="fba88-113">The token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="fba88-114">Par défaut, AD FS inclut un processus de renouvellement automatique appelé **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="fba88-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="fba88-115">Si vous utilisez AD FS 2.0 ou une version ultérieure, Office 365 et Azure AD mettent automatiquement à jour votre certificat avant qu’il n’arrive à expiration.</span><span class="sxs-lookup"><span data-stu-id="fba88-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-the-office-365-portal-or-an-email"></a><span data-ttu-id="fba88-116">Notification de renouvellement par courrier électronique ou via le portail Office 365</span><span class="sxs-lookup"><span data-stu-id="fba88-116">Renewal notification from the Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="fba88-117">Si vous avez reçu un e-mail ou une notification du portail vous invitant à renouveler votre certificat pour Office, consultez [Gestion des modifications apportées aux certificats de signature de jeton](#managecerts) pour savoir si une action est requise de votre part.</span><span class="sxs-lookup"><span data-stu-id="fba88-117">If you received an email or a portal notification asking you to renew your certificate for Office, see [Managing changes to token signing certificates](#managecerts) to check if you need to take any action.</span></span> <span data-ttu-id="fba88-118">Microsoft est conscient d’un problème pouvant générer l’envoi de notifications invitant l’utilisateur à renouveler le certificat, même si aucune action n’est requise.</span><span class="sxs-lookup"><span data-stu-id="fba88-118">Microsoft is aware of a possible issue that can lead to notifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="fba88-119">Azure AD tente d’analyser les métadonnées de fédération et de mettre à jour les certificats de signature de jeton, comme indiqué par ces métadonnées.</span><span class="sxs-lookup"><span data-stu-id="fba88-119">Azure AD attempts to monitor the federation metadata, and update the token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="fba88-120">Pour vérifier la disponibilité de nouveaux certificats, Azure AD interroge les métadonnées de fédération 30 jours avant l’expiration des certificats de signature de jeton.</span><span class="sxs-lookup"><span data-stu-id="fba88-120">30 days before the expiration of the token signing certificates, Azure AD checks if new certificates are available by polling the federation metadata.</span></span>

* <span data-ttu-id="fba88-121">Aucune notification n’est envoyée par e-mail ou ne s’affiche dans le portail Office 365 si Azure AD réussit à récupérer les nouveaux certificats après interrogation des métadonnées de fédération.</span><span class="sxs-lookup"><span data-stu-id="fba88-121">If it can successfully poll the federation metadata and retrieve the new certificates, no email notification or warning in the Office 365 portal is issued to the user.</span></span>
* <span data-ttu-id="fba88-122">Si, en revanche, les nouveaux certificats de signature de jetons ne peuvent être récupérés (les métadonnées de fédération étant inaccessibles ou la substitution automatique des certificats étant inactivée), Azure AD enverra une notification par e-mail et affichera également une annonce dans le portail Office 365.</span><span class="sxs-lookup"><span data-stu-id="fba88-122">If it cannot retrieve the new token signing certificates, either because the federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in the Office 365 portal.</span></span>

![Notification du portail Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="fba88-124">Si vous utilisez AD FS, vérifiez que vos serveurs possèdent les mises à jour suivantes afin d’éviter les échecs d’authentification pour les problèmes connus ; la continuité des activités est ainsi assurée.</span><span class="sxs-lookup"><span data-stu-id="fba88-124">If you are using AD FS, to ensure business continuity, please verify that your servers have the following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="fba88-125">Cela limite les problèmes connus du serveur proxy AD FS pour ce renouvellement ainsi que pour les périodes de renouvellement suivantes :</span><span class="sxs-lookup"><span data-stu-id="fba88-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="fba88-126">Server 2012 R2 - [Windows Server : correctif cumulatif de mai 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="fba88-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="fba88-127">Server 2008 R2 et 2012 [Échec de l’authentification par proxy dans Windows Server 2008 R2 SP1 ou dans Windows Server 2012](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="fba88-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="fba88-128">Vérifiez si les certificats doivent être mis à jour <a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="fba88-128">Check if the certificates need to be updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-the-autocertificaterollover-state"></a><span data-ttu-id="fba88-129">Étape 1 : vérifier l’état de AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="fba88-129">Step 1: Check the AutoCertificateRollover state</span></span>
<span data-ttu-id="fba88-130">Sur votre serveur AD FS, ouvrez Powershell.</span><span class="sxs-lookup"><span data-stu-id="fba88-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="fba88-131">Vérifiez que la valeur de AutoCertificateRollover est définie sur True.</span><span class="sxs-lookup"><span data-stu-id="fba88-131">Check that the AutoCertificateRollover value is set to True.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="fba88-133">Si vous utilisez AD FS 2.0, commencez par exécuter Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="fba88-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="fba88-134">Étape 2 : vérifier que les services AD FS et Azure AD sont synchronisés</span><span class="sxs-lookup"><span data-stu-id="fba88-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="fba88-135">Sur votre serveur AD FS, ouvrez l’invite de commandes Azure AD Powershell et connectez-vous à Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fba88-135">On your AD FS server, open the Azure AD PowerShell prompt, and connect to Azure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="fba88-136">Vous pouvez télécharger Azure AD PowerShell [ici](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="fba88-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="fba88-137">Vérifiez les certificats configurés dans les propriétés d’approbation d’AD FS et d’Azure AD pour le domaine spécifié.</span><span class="sxs-lookup"><span data-stu-id="fba88-137">Check the certificates configured in AD FS and Azure AD trust properties for the specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="fba88-139">Si les Thumbprints des deux sorties correspondent, vos certificats sont synchronisés avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="fba88-139">If the thumbprints in both the outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-to-expire"></a><span data-ttu-id="fba88-140">Étape 3 : vérifier si votre certificat est sur le point d’expirer</span><span class="sxs-lookup"><span data-stu-id="fba88-140">Step 3: Check if your certificate is about to expire</span></span>
<span data-ttu-id="fba88-141">Dans la sortie de Get-MsolFederationProperty ou Get-AdfsCertificate, vérifiez la date sous « Not after ».</span><span class="sxs-lookup"><span data-stu-id="fba88-141">In the output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for the date under "Not After."</span></span> <span data-ttu-id="fba88-142">Si la date indiquée est fixée à moins de 30 jours restants, vous devez agir en conséquence.</span><span class="sxs-lookup"><span data-stu-id="fba88-142">If the date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="fba88-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="fba88-143">AutoCertificateRollover</span></span> | <span data-ttu-id="fba88-144">Certificats synchronisés avec Azure AD</span><span class="sxs-lookup"><span data-stu-id="fba88-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="fba88-145">Les métadonnées de fédération sont accessibles publiquement</span><span class="sxs-lookup"><span data-stu-id="fba88-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="fba88-146">Validité</span><span class="sxs-lookup"><span data-stu-id="fba88-146">Validity</span></span> | <span data-ttu-id="fba88-147">Action</span><span class="sxs-lookup"><span data-stu-id="fba88-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="fba88-148">Oui</span><span class="sxs-lookup"><span data-stu-id="fba88-148">Yes</span></span> |<span data-ttu-id="fba88-149">Oui</span><span class="sxs-lookup"><span data-stu-id="fba88-149">Yes</span></span> |<span data-ttu-id="fba88-150">Oui</span><span class="sxs-lookup"><span data-stu-id="fba88-150">Yes</span></span> |- |<span data-ttu-id="fba88-151">Aucune action n'est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="fba88-151">No action needed.</span></span> <span data-ttu-id="fba88-152">Voir [Renouveler le certificat de signature de jetons automatiquement](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="fba88-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="fba88-153">Oui</span><span class="sxs-lookup"><span data-stu-id="fba88-153">Yes</span></span> |<span data-ttu-id="fba88-154">Non</span><span class="sxs-lookup"><span data-stu-id="fba88-154">No</span></span> |- |<span data-ttu-id="fba88-155">Moins de 15 jours</span><span class="sxs-lookup"><span data-stu-id="fba88-155">Less than 15 days</span></span> |<span data-ttu-id="fba88-156">Renouvelez immédiatement.</span><span class="sxs-lookup"><span data-stu-id="fba88-156">Renew immediately.</span></span> <span data-ttu-id="fba88-157">Voir [Renouveler le certificat de signature de jetons manuellement](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="fba88-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="fba88-158">Non</span><span class="sxs-lookup"><span data-stu-id="fba88-158">No</span></span> |- |- |<span data-ttu-id="fba88-159">Moins de 30 jours</span><span class="sxs-lookup"><span data-stu-id="fba88-159">Less than 30 days</span></span> |<span data-ttu-id="fba88-160">Renouvelez immédiatement.</span><span class="sxs-lookup"><span data-stu-id="fba88-160">Renew immediately.</span></span> <span data-ttu-id="fba88-161">Voir [Renouveler le certificat de signature de jetons manuellement](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="fba88-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="fba88-162">\[-]  N’a pas d’importance</span><span class="sxs-lookup"><span data-stu-id="fba88-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="fba88-163">Renouveler le certificat de signature de jetons automatiquement (recommandé) <a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="fba88-163">Renew the token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="fba88-164">Vous n’avez pas besoin de suivre de procédure manuelle si les deux affirmations suivantes sont vraies :</span><span class="sxs-lookup"><span data-stu-id="fba88-164">You don't need to perform any manual steps if both of the following are true:</span></span>

* <span data-ttu-id="fba88-165">Vous avez déployé le proxy d’application Web, qui permet d’accéder aux métadonnées de fédération à partir de l’extranet.</span><span class="sxs-lookup"><span data-stu-id="fba88-165">You have deployed Web Application Proxy, which can enable access to the federation metadata from the extranet.</span></span>
* <span data-ttu-id="fba88-166">Vous utilisez la configuration AD FS par défaut (AutoCertificateRollover est activé).</span><span class="sxs-lookup"><span data-stu-id="fba88-166">You are using the AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="fba88-167">Vérifiez les points suivants pour confirmer que le certificat peut être mis à jour automatiquement.</span><span class="sxs-lookup"><span data-stu-id="fba88-167">Check the following to confirm that the certificate can be automatically updated.</span></span>

<span data-ttu-id="fba88-168">**1. La propriété AutoCertificateRollover d’AD FS doit être définie sur True.**</span><span class="sxs-lookup"><span data-stu-id="fba88-168">**1. The AD FS property AutoCertificateRollover must be set to True.**</span></span> <span data-ttu-id="fba88-169">Cela indique qu’AD FS génère automatiquement de nouveaux certificats de signature de jetons et de déchiffrement de jeton avant que les anciens certificats n’arrivent à expiration.</span><span class="sxs-lookup"><span data-stu-id="fba88-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before the old ones expire.</span></span>

<span data-ttu-id="fba88-170">**2. Les métadonnées de fédération AD FS sont accessibles publiquement.**</span><span class="sxs-lookup"><span data-stu-id="fba88-170">**2. The AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="fba88-171">Vérifiez que vos métadonnées de fédération sont publiquement accessibles en accédant à l’URL ci-dessous à partir d’un ordinateur relié au réseau Internet public (en dehors du réseau de l’entreprise) :</span><span class="sxs-lookup"><span data-stu-id="fba88-171">Check that your federation metadata is publicly accessible by navigating to the following URL from a computer on the public internet (off of the corporate network):</span></span>

<span data-ttu-id="fba88-172">https://(votre_nom_FS)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="fba88-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="fba88-173">où `(your_FS_name) `est remplacé par le nom d’hôte du service de fédération utilisé par votre organisation, tel que fs.contoso.com.</span><span class="sxs-lookup"><span data-stu-id="fba88-173">where `(your_FS_name) `is replaced with the federation service host name your organization uses, such as fs.contoso.com.</span></span>  <span data-ttu-id="fba88-174">Si vous êtes parvenu à vérifier la présence de ces deux paramètres, vous n’avez rien d’autre à faire.</span><span class="sxs-lookup"><span data-stu-id="fba88-174">If you are able to verify both of these settings successfully, you do not have to do anything else.</span></span>  

<span data-ttu-id="fba88-175">Exemple : https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="fba88-175">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="fba88-176">Renouveler le certificat de signature de jetons manuellement <a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="fba88-176">Renew the token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="fba88-177">Vous pouvez choisir le renouvellement manuel des certificats de signature de jeton.</span><span class="sxs-lookup"><span data-stu-id="fba88-177">You may choose to renew the token signing certificates manually.</span></span> <span data-ttu-id="fba88-178">Par exemple, il se peut que les scénarios fonctionnent mieux pour le renouvellement manuel :</span><span class="sxs-lookup"><span data-stu-id="fba88-178">For example, the following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="fba88-179">Les certificats de signature de jeton ne sont pas auto-signés.</span><span class="sxs-lookup"><span data-stu-id="fba88-179">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="fba88-180">Le plus souvent, ceci s’explique par le fait que votre organisation gère les certificats AD FS inscrits auprès d’une autorité de certification d’organisation.</span><span class="sxs-lookup"><span data-stu-id="fba88-180">The most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="fba88-181">La sécurité réseau ne permet pas de rendre publiques les métadonnées de fédération.</span><span class="sxs-lookup"><span data-stu-id="fba88-181">Network security does not allow the federation metadata to be publicly available.</span></span>

<span data-ttu-id="fba88-182">Dans ces scénarios, vous devez mettre à jour votre domaine Office 365 à l’aide de la commande PowerShell Update-MsolFederatedDomain à chaque fois que vous mettez à jour les certificats de signature de jeton.</span><span class="sxs-lookup"><span data-stu-id="fba88-182">In these scenarios, every time you update the token signing certificates, you must also update your Office 365 domain by using the PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="fba88-183">Étape 1 : s’assurer qu’AD FS dispose de nouveaux certificats de signature de jetons</span><span class="sxs-lookup"><span data-stu-id="fba88-183">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="fba88-184">**Configuration différente de la configuration par défaut**</span><span class="sxs-lookup"><span data-stu-id="fba88-184">**Non-default configuration**</span></span>

<span data-ttu-id="fba88-185">Si vous êtes dans une configuration différente de la configuration par défaut d’AD FS, dans laquelle **AutoCertificateRollover** est défini sur **False**, vous utilisez probablement des certificats personnalisés (pas auto-signés).</span><span class="sxs-lookup"><span data-stu-id="fba88-185">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set to **False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="fba88-186">Pour en savoir plus sur la manière de renouveler les certificats de signature de jeton AD FS, consultez [Conseils pour les clients qui n’utilisent pas de certificats auto-signés AD FS](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="fba88-186">For more information about how to renew the AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="fba88-187">**Les métadonnées de fédération ne sont pas disponibles publiquement**</span><span class="sxs-lookup"><span data-stu-id="fba88-187">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="fba88-188">En revanche, si **AutoCertificateRollover** est défini sur **True** sans que vos métadonnées de fédération ne soient disponibles publiquement, assurez-vous que les nouveaux certificats de signature de jetons ont été générés par AD FS.</span><span class="sxs-lookup"><span data-stu-id="fba88-188">On the other hand, if **AutoCertificateRollover** is set to **True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="fba88-189">Confirmez que vous disposez des nouveaux certificats de signature de jeton en suivant les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="fba88-189">Confirm you have new token signing certificates by taking the following steps:</span></span>

1. <span data-ttu-id="fba88-190">Vérifiez que vous êtes connecté au serveur AD FS principal.</span><span class="sxs-lookup"><span data-stu-id="fba88-190">Verify that you are logged on to the primary AD FS server.</span></span>
2. <span data-ttu-id="fba88-191">Vérifiez les certificats de signature actuels dans AD FS en ouvrant une fenêtre de commande PowerShell et en exécutant la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="fba88-191">Check the current signing certificates in AD FS by opening a PowerShell command window, and running the following command:</span></span>

    <span data-ttu-id="fba88-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="fba88-192">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="fba88-193">Si vous utilisez AD FS 2.0, vous devez commencer par exécuter Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="fba88-193">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="fba88-194">Examinez les certificats répertoriés dans la sortie de la commande.</span><span class="sxs-lookup"><span data-stu-id="fba88-194">Look at the command output at any certificates listed.</span></span> <span data-ttu-id="fba88-195">Si AD FS a généré un nouveau certificat, vous devez voir deux certificats dans la sortie : l’un dont la valeur **IsPrimary** est définie sur **True** et dont la date **NotAfter** correspond à 5 jours, et l’autre avec une valeur **IsPrimary** définie sur **False** et une valeur **NotAfter** correspondant à environ un an après la date du jour.</span><span class="sxs-lookup"><span data-stu-id="fba88-195">If AD FS has generated a new certificate, you should see two certificates in the output: one for which the **IsPrimary** value is **True** and the **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in the future.</span></span>
4. <span data-ttu-id="fba88-196">Si vous ne voyez qu’un seul certificat et que la date **NotAfter** est définie sur 5 jours, vous devez générer un nouveau certificat.</span><span class="sxs-lookup"><span data-stu-id="fba88-196">If you only see one certificate, and the **NotAfter** date is within 5 days, you need to generate a new certificate.</span></span>
5. <span data-ttu-id="fba88-197">Pour générer un nouveau certificat, exécutez la commande ci-dessous au niveau d’une invite de commande PowerShell : `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="fba88-197">To generate a new certificate, execute the following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="fba88-198">Vérifiez la mise à jour en ré-exécutant la commande suivante : PS C:\>>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="fba88-198">Verify the update by running the following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="fba88-199">Vous devez alors voir apparaître deux certificats, dont l’un présente une date **NotAfter** correspondant à environ un an après la date du jour et dont la valeur **IsPrimary** est définie sur **False**.</span><span class="sxs-lookup"><span data-stu-id="fba88-199">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in the future, and for which the **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-the-new-token-signing-certificates-for-the-office-365-trust"></a><span data-ttu-id="fba88-200">Étape 2 : mettre à jour les nouveaux certificats de signature de jeton pour l’approbation d’Office 365</span><span class="sxs-lookup"><span data-stu-id="fba88-200">Step 2: Update the new token signing certificates for the Office 365 trust</span></span>
<span data-ttu-id="fba88-201">Mettez Office 365 à jour avec les nouveaux certificats de signature de jeton devant être utilisés pour l’approbation en suivant la procédure ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="fba88-201">Update Office 365 with the new token signing certificates to be used for the trust, as follows.</span></span>

1. <span data-ttu-id="fba88-202">Ouvrez le Module Microsoft Azure Active Directory pour Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="fba88-202">Open the Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="fba88-203">Exécutez la commande $cred=Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="fba88-203">Run $cred=Get-Credential.</span></span> <span data-ttu-id="fba88-204">Lorsque cette applet de commande vous demande des informations d’identification, tapez vos informations d’identification de compte administrateur de services cloud.</span><span class="sxs-lookup"><span data-stu-id="fba88-204">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="fba88-205">Exécutez la commande Connect-MsolService –Credential $cred.</span><span class="sxs-lookup"><span data-stu-id="fba88-205">Run Connect-MsolService –Credential $cred.</span></span> <span data-ttu-id="fba88-206">Cette applet de commande vous connecte au service cloud.</span><span class="sxs-lookup"><span data-stu-id="fba88-206">This cmdlet connects you to the cloud service.</span></span> <span data-ttu-id="fba88-207">Avant d’exécuter l’une des applets de commande supplémentaires installées par l’outil, vous devez créer un contexte qui vous connecte au service cloud.</span><span class="sxs-lookup"><span data-stu-id="fba88-207">Creating a context that connects you to the cloud service is required before running any of the additional cmdlets installed by the tool.</span></span>
4. <span data-ttu-id="fba88-208">Si vous exécutez ces commandes sur un ordinateur autre que le serveur de fédération principal AD FS, exécutez Set-MSOLAdfscontext -Computer <AD FS primary server>, où <AD FS primary server> est le nom de domaine complet interne du serveur AD FS principal.</span><span class="sxs-lookup"><span data-stu-id="fba88-208">If you are running these commands on a computer that is not the AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is the internal FQDN name of the primary AD FS server.</span></span> <span data-ttu-id="fba88-209">Cette applet de commande crée un contexte qui vous connecte à AD FS.</span><span class="sxs-lookup"><span data-stu-id="fba88-209">This cmdlet creates a context that connects you to AD FS.</span></span>
5. <span data-ttu-id="fba88-210">Exécutez Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="fba88-210">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="fba88-211">Cette applet de commande met à jour les paramètres d’AD FS dans le service cloud et configure la relation d’approbation entre les deux.</span><span class="sxs-lookup"><span data-stu-id="fba88-211">This cmdlet updates the settings from AD FS into the cloud service, and configures the trust relationship between the two.</span></span>

> [!NOTE]
> <span data-ttu-id="fba88-212">Si vous avez besoin de prendre en charge plusieurs domaines de premier niveau, par exemple contoso.com et fabrikam.com, vous devez utiliser le commutateur **SupportMultipleDomain** avec les applets de commande.</span><span class="sxs-lookup"><span data-stu-id="fba88-212">If you need to support multiple top-level domains, such as contoso.com and fabrikam.com, you must use the **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="fba88-213">Pour plus d’informations, consultez [Prise en charge de plusieurs domaines de premier niveau](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="fba88-213">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="fba88-214">Réparer l’approbation Azure AD à l’aide d’Azure AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="fba88-214">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="fba88-215">Si vous avez configuré votre batterie de serveurs AD FS et l’approbation Azure AD à l’aide d’Azure AD Connect, vous pouvez utiliser Azure AD Connect afin de vérifier si vous devez agir ou non pour vos certificats de signature de jeton.</span><span class="sxs-lookup"><span data-stu-id="fba88-215">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect to detect if you need to take any action for your token signing certificates.</span></span> <span data-ttu-id="fba88-216">Si vous devez renouveler les certificats, vous pouvez le faire à l’aide d’Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="fba88-216">If you need to renew the certificates, you can use Azure AD Connect to do so.</span></span>

<span data-ttu-id="fba88-217">Pour plus d’informations, consultez [Réparation de l’approbation](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="fba88-217">For more information, see [Repairing the trust](active-directory-aadconnect-federation-management.md).</span></span>
