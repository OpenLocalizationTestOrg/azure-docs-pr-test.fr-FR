---
title: renouvellement aaaCertificate pour les utilisateurs Office 365 et Azure AD | Documents Microsoft
description: "Cet article explique les 365 utilisateurs tooOffice comment tooresolve problèmes avec des courriers électroniques qui les informer de renouvellement d’un certificat."
services: active-directory
documentationcenter: 
author: billmath
manager: femila
editor: curtand
ms.assetid: 543b7dc1-ccc9-407f-85a1-a9944c0ba1be
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: b9b309e06949dc5488cd628650be413f366ed347
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="renew-federation-certificates-for-office-365-and-azure-active-directory"></a><span data-ttu-id="b7d32-103">Renouvellement des certificats de fédération pour Office 365 et Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="b7d32-103">Renew federation certificates for Office 365 and Azure Active Directory</span></span>
## <a name="overview"></a><span data-ttu-id="b7d32-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="b7d32-104">Overview</span></span>
<span data-ttu-id="b7d32-105">Pour la fédération réussie entre Azure Active Directory (Azure AD) et les Services de fédération Active Directory (AD FS), les certificats de hello utilisés par AD FS toosign sécurité jetons tooAzure AD doivent correspondre à ce qui est configuré dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7d32-105">For successful federation between Azure Active Directory (Azure AD) and Active Directory Federation Services (AD FS), hello certificates used by AD FS toosign security tokens tooAzure AD should match what is configured in Azure AD.</span></span> <span data-ttu-id="b7d32-106">Une incompatibilité peut provoquer des toobroken approbation.</span><span class="sxs-lookup"><span data-stu-id="b7d32-106">Any mismatch can lead toobroken trust.</span></span> <span data-ttu-id="b7d32-107">Azure AD garantit la synchronisation de ces informations lorsque vous déployez AD FS et le proxy d’application web (pour l’accès extranet).</span><span class="sxs-lookup"><span data-stu-id="b7d32-107">Azure AD ensures that this information is kept in sync when you deploy AD FS and Web Application Proxy (for extranet access).</span></span>

<span data-ttu-id="b7d32-108">Cet article fournit les toomanage des informations supplémentaires vous vos certificats de signature de jetons et maintenir synchronisés avec Azure AD, Bonjour suivant le cas :</span><span class="sxs-lookup"><span data-stu-id="b7d32-108">This article provides you additional information toomanage your token signing certificates and keep them in sync with Azure AD, in hello following cases:</span></span>

* <span data-ttu-id="b7d32-109">Vous ne déployez pas hello Proxy d’Application Web, et par conséquent, les métadonnées de fédération hello ne sont pas disponible dans hello extranet.</span><span class="sxs-lookup"><span data-stu-id="b7d32-109">You are not deploying hello Web Application Proxy, and therefore hello federation metadata is not available in hello extranet.</span></span>
* <span data-ttu-id="b7d32-110">Vous n’utilisez pas la configuration par défaut de hello d’AD FS pour les certificats de signature de jetons.</span><span class="sxs-lookup"><span data-stu-id="b7d32-110">You are not using hello default configuration of AD FS for token signing certificates.</span></span>
* <span data-ttu-id="b7d32-111">Vous utilisez un fournisseur d’identité tiers.</span><span class="sxs-lookup"><span data-stu-id="b7d32-111">You are using a third-party identity provider.</span></span>

## <a name="default-configuration-of-ad-fs-for-token-signing-certificates"></a><span data-ttu-id="b7d32-112">Configuration par défaut d’AD FS pour les certificats de signature de jetons</span><span class="sxs-lookup"><span data-stu-id="b7d32-112">Default configuration of AD FS for token signing certificates</span></span>
<span data-ttu-id="b7d32-113">certificats de déchiffrement de jeton et de signature de jetons Hello sont généralement des certificats auto-signés et sont adaptés pour un an.</span><span class="sxs-lookup"><span data-stu-id="b7d32-113">hello token signing and token decrypting certificates are usually self-signed certificates, and are good for one year.</span></span> <span data-ttu-id="b7d32-114">Par défaut, AD FS inclut un processus de renouvellement automatique appelé **AutoCertificateRollover**.</span><span class="sxs-lookup"><span data-stu-id="b7d32-114">By default, AD FS includes an auto-renewal process called **AutoCertificateRollover**.</span></span> <span data-ttu-id="b7d32-115">Si vous utilisez AD FS 2.0 ou une version ultérieure, Office 365 et Azure AD mettent automatiquement à jour votre certificat avant qu’il n’arrive à expiration.</span><span class="sxs-lookup"><span data-stu-id="b7d32-115">If you are using AD FS 2.0 or later, Office 365 and Azure AD automatically update your certificate before it expires.</span></span>

### <a name="renewal-notification-from-hello-office-365-portal-or-an-email"></a><span data-ttu-id="b7d32-116">Notification de renouvellement de portail de hello Office 365 ou un message électronique</span><span class="sxs-lookup"><span data-stu-id="b7d32-116">Renewal notification from hello Office 365 portal or an email</span></span>
> [!NOTE]
> <span data-ttu-id="b7d32-117">Reportez-vous à votre certificat pour Office, si vous avez reçu un message électronique ou une notification de portail vous demandant de toorenew [gestion des modifications tootoken certificats de signature](#managecerts) toocheck si vous avez besoin de tootake n’importe quelle action.</span><span class="sxs-lookup"><span data-stu-id="b7d32-117">If you received an email or a portal notification asking you toorenew your certificate for Office, see [Managing changes tootoken signing certificates](#managecerts) toocheck if you need tootake any action.</span></span> <span data-ttu-id="b7d32-118">Microsoft a connaissance d’un éventuel problème pouvant conduire toonotifications pour le renouvellement du certificat est envoyé, même si aucune action n’est requise.</span><span class="sxs-lookup"><span data-stu-id="b7d32-118">Microsoft is aware of a possible issue that can lead toonotifications for certificate renewal being sent, even when no action is required.</span></span>
>
>

<span data-ttu-id="b7d32-119">Azure Active Directory tente de métadonnées de fédération toomonitor hello et le jeton de hello de mise à jour de certificats de signature, comme indiqué par ces métadonnées.</span><span class="sxs-lookup"><span data-stu-id="b7d32-119">Azure AD attempts toomonitor hello federation metadata, and update hello token signing certificates as indicated by this metadata.</span></span> <span data-ttu-id="b7d32-120">30 jours avant l’expiration hello des certificats de signature de jeton de hello Azure AD vérifie si les nouveaux certificats sont disponibles en interrogeant les métadonnées de fédération hello.</span><span class="sxs-lookup"><span data-stu-id="b7d32-120">30 days before hello expiration of hello token signing certificates, Azure AD checks if new certificates are available by polling hello federation metadata.</span></span>

* <span data-ttu-id="b7d32-121">Si elle peut correctement interroger les métadonnées de fédération hello et récupérer les certificats nouveaux hello, aucune notification par courrier électronique ou un avertissement dans le portail de hello Office 365 n’est émise toohello utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b7d32-121">If it can successfully poll hello federation metadata and retrieve hello new certificates, no email notification or warning in hello Office 365 portal is issued toohello user.</span></span>
* <span data-ttu-id="b7d32-122">Si elle ne peut pas extraire hello nouveau jeton certificats de signature, soit parce que les métadonnées de fédération hello ne sont pas accessible ou la substitution de certificat automatique n’est pas activée, Azure AD émet une notification par courrier électronique et un avertissement dans le portail de hello Office 365.</span><span class="sxs-lookup"><span data-stu-id="b7d32-122">If it cannot retrieve hello new token signing certificates, either because hello federation metadata is not reachable or automatic certificate rollover is not enabled, Azure AD issues an email notification and a warning in hello Office 365 portal.</span></span>

![Notification du portail Office 365](./media/active-directory-aadconnect-o365-certs/notification.png)

> [!IMPORTANT]
> <span data-ttu-id="b7d32-124">Si vous utilisez AD FS, continuité des activités tooensure, vérifiez que vos serveurs possèdent hello après les mises à jour afin que les échecs d’authentification pour les problèmes connus n’apparaissent pas.</span><span class="sxs-lookup"><span data-stu-id="b7d32-124">If you are using AD FS, tooensure business continuity, please verify that your servers have hello following updates so that authentication failures for known issues do not occur.</span></span> <span data-ttu-id="b7d32-125">Cela limite les problèmes connus du serveur proxy AD FS pour ce renouvellement ainsi que pour les périodes de renouvellement suivantes :</span><span class="sxs-lookup"><span data-stu-id="b7d32-125">This mitigates known AD FS proxy server issues for this renewal and future renewal periods:</span></span>
>
> <span data-ttu-id="b7d32-126">Server 2012 R2 - [Windows Server : correctif cumulatif de mai 2014](http://support.microsoft.com/kb/2955164)</span><span class="sxs-lookup"><span data-stu-id="b7d32-126">Server 2012 R2 - [Windows Server May 2014 rollup](http://support.microsoft.com/kb/2955164)</span></span>
>
> <span data-ttu-id="b7d32-127">Server 2008 R2 et 2012 [Échec de l’authentification par proxy dans Windows Server 2008 R2 SP1 ou dans Windows Server 2012](http://support.microsoft.com/kb/3094446)</span><span class="sxs-lookup"><span data-stu-id="b7d32-127">Server 2008 R2 and 2012 - [Authentication through proxy fails in Windows Server 2012 or Windows 2008 R2 SP1](http://support.microsoft.com/kb/3094446)</span></span>
>
>

## <span data-ttu-id="b7d32-128">Vérifier si les certificats hello doivent toobe mis à jour<a name="managecerts"></a></span><span class="sxs-lookup"><span data-stu-id="b7d32-128">Check if hello certificates need toobe updated <a name="managecerts"></a></span></span>
### <a name="step-1-check-hello-autocertificaterollover-state"></a><span data-ttu-id="b7d32-129">Étape 1 : Vérifier l’état de AutoCertificateRollover hello</span><span class="sxs-lookup"><span data-stu-id="b7d32-129">Step 1: Check hello AutoCertificateRollover state</span></span>
<span data-ttu-id="b7d32-130">Sur votre serveur AD FS, ouvrez Powershell.</span><span class="sxs-lookup"><span data-stu-id="b7d32-130">On your AD FS server, open PowerShell.</span></span> <span data-ttu-id="b7d32-131">Vérifiez que hello AutoCertificateRollover a la valeur tooTrue.</span><span class="sxs-lookup"><span data-stu-id="b7d32-131">Check that hello AutoCertificateRollover value is set tooTrue.</span></span>

    Get-Adfsproperties

![AutoCertificateRollover](./media/active-directory-aadconnect-o365-certs/autocertrollover.png)

>[!NOTE] 
><span data-ttu-id="b7d32-133">Si vous utilisez AD FS 2.0, commencez par exécuter Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="b7d32-133">If you are using AD FS 2.0, first run Add-Pssnapin Microsoft.Adfs.Powershell.</span></span>

### <a name="step-2-confirm-that-ad-fs-and-azure-ad-are-in-sync"></a><span data-ttu-id="b7d32-134">Étape 2 : vérifier que les services AD FS et Azure AD sont synchronisés</span><span class="sxs-lookup"><span data-stu-id="b7d32-134">Step 2: Confirm that AD FS and Azure AD are in sync</span></span>
<span data-ttu-id="b7d32-135">Sur votre serveur AD FS, ouvrir l’invite de commandes PowerShell Azure AD hello et se connecter tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="b7d32-135">On your AD FS server, open hello Azure AD PowerShell prompt, and connect tooAzure AD.</span></span>

> [!NOTE]
> <span data-ttu-id="b7d32-136">Vous pouvez télécharger Azure AD PowerShell [ici](https://technet.microsoft.com/library/jj151815.aspx).</span><span class="sxs-lookup"><span data-stu-id="b7d32-136">You can download Azure AD PowerShell [here](https://technet.microsoft.com/library/jj151815.aspx).</span></span>
>
>

    Connect-MsolService

<span data-ttu-id="b7d32-137">Vérifiez les certificats hello configuré dans AD FS et les propriétés d’approbation de Azure AD pour hello de domaine spécifiant.</span><span class="sxs-lookup"><span data-stu-id="b7d32-137">Check hello certificates configured in AD FS and Azure AD trust properties for hello specified domain.</span></span>

    Get-MsolFederationProperty -DomainName <domain.name> | FL Source, TokenSigningCertificate

![Get-MsolFederationProperty](./media/active-directory-aadconnect-o365-certs/certsync.png)

<span data-ttu-id="b7d32-139">Si les empreintes numériques de hello dans les deux hello sorties correspondance, vos certificats sont synchronisés avec Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b7d32-139">If hello thumbprints in both hello outputs match, your certificates are in sync with Azure AD.</span></span>

### <a name="step-3-check-if-your-certificate-is-about-tooexpire"></a><span data-ttu-id="b7d32-140">Étape 3 : Vérifier si votre certificat est sur tooexpire</span><span class="sxs-lookup"><span data-stu-id="b7d32-140">Step 3: Check if your certificate is about tooexpire</span></span>
<span data-ttu-id="b7d32-141">Dans la sortie de hello de Get-MsolFederationProperty ou Get-AdfsCertificate, recherchez date hello sous « Pas After ».</span><span class="sxs-lookup"><span data-stu-id="b7d32-141">In hello output of either Get-MsolFederationProperty or Get-AdfsCertificate, check for hello date under "Not After."</span></span> <span data-ttu-id="b7d32-142">Si la date de hello est inférieure à 30 jours, vous devez prendre la mesure.</span><span class="sxs-lookup"><span data-stu-id="b7d32-142">If hello date is less than 30 days away, you should take action.</span></span>

| <span data-ttu-id="b7d32-143">AutoCertificateRollover</span><span class="sxs-lookup"><span data-stu-id="b7d32-143">AutoCertificateRollover</span></span> | <span data-ttu-id="b7d32-144">Certificats synchronisés avec Azure AD</span><span class="sxs-lookup"><span data-stu-id="b7d32-144">Certificates in sync with Azure AD</span></span> | <span data-ttu-id="b7d32-145">Les métadonnées de fédération sont accessibles publiquement</span><span class="sxs-lookup"><span data-stu-id="b7d32-145">Federation metadata is publicly accessible</span></span> | <span data-ttu-id="b7d32-146">Validité</span><span class="sxs-lookup"><span data-stu-id="b7d32-146">Validity</span></span> | <span data-ttu-id="b7d32-147">Action</span><span class="sxs-lookup"><span data-stu-id="b7d32-147">Action</span></span> |
|:---:|:---:|:---:|:---:|:---:|
| <span data-ttu-id="b7d32-148">Oui</span><span class="sxs-lookup"><span data-stu-id="b7d32-148">Yes</span></span> |<span data-ttu-id="b7d32-149">Oui</span><span class="sxs-lookup"><span data-stu-id="b7d32-149">Yes</span></span> |<span data-ttu-id="b7d32-150">Oui</span><span class="sxs-lookup"><span data-stu-id="b7d32-150">Yes</span></span> |- |<span data-ttu-id="b7d32-151">Aucune action n'est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="b7d32-151">No action needed.</span></span> <span data-ttu-id="b7d32-152">Voir [Renouveler le certificat de signature de jetons automatiquement](#autorenew).</span><span class="sxs-lookup"><span data-stu-id="b7d32-152">See [Renew token signing certificate automatically](#autorenew).</span></span> |
| <span data-ttu-id="b7d32-153">Oui</span><span class="sxs-lookup"><span data-stu-id="b7d32-153">Yes</span></span> |<span data-ttu-id="b7d32-154">Non</span><span class="sxs-lookup"><span data-stu-id="b7d32-154">No</span></span> |- |<span data-ttu-id="b7d32-155">Moins de 15 jours</span><span class="sxs-lookup"><span data-stu-id="b7d32-155">Less than 15 days</span></span> |<span data-ttu-id="b7d32-156">Renouvelez immédiatement.</span><span class="sxs-lookup"><span data-stu-id="b7d32-156">Renew immediately.</span></span> <span data-ttu-id="b7d32-157">Voir [Renouveler le certificat de signature de jetons manuellement](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="b7d32-157">See [Renew token signing certificate manually](#manualrenew).</span></span> |
| <span data-ttu-id="b7d32-158">Non</span><span class="sxs-lookup"><span data-stu-id="b7d32-158">No</span></span> |- |- |<span data-ttu-id="b7d32-159">Moins de 30 jours</span><span class="sxs-lookup"><span data-stu-id="b7d32-159">Less than 30 days</span></span> |<span data-ttu-id="b7d32-160">Renouvelez immédiatement.</span><span class="sxs-lookup"><span data-stu-id="b7d32-160">Renew immediately.</span></span> <span data-ttu-id="b7d32-161">Voir [Renouveler le certificat de signature de jetons manuellement](#manualrenew).</span><span class="sxs-lookup"><span data-stu-id="b7d32-161">See [Renew token signing certificate manually](#manualrenew).</span></span> |

<span data-ttu-id="b7d32-162">\[-]  N’a pas d’importance</span><span class="sxs-lookup"><span data-stu-id="b7d32-162">\[-]  Does not matter</span></span>

## <span data-ttu-id="b7d32-163">Renouveler automatiquement des certificats de signature de jetons de hello (recommandé)<a name="autorenew"></a></span><span class="sxs-lookup"><span data-stu-id="b7d32-163">Renew hello token signing certificate automatically (recommended) <a name="autorenew"></a></span></span>
<span data-ttu-id="b7d32-164">Vous n’avez pas besoin tooperform toutes les étapes manuelles si les deux éléments suivants de hello sont vraies :</span><span class="sxs-lookup"><span data-stu-id="b7d32-164">You don't need tooperform any manual steps if both of hello following are true:</span></span>

* <span data-ttu-id="b7d32-165">Vous avez déployé le Proxy d’Application Web, qui permet d’accéder aux métadonnées de fédération toohello de hello extranet.</span><span class="sxs-lookup"><span data-stu-id="b7d32-165">You have deployed Web Application Proxy, which can enable access toohello federation metadata from hello extranet.</span></span>
* <span data-ttu-id="b7d32-166">Vous utilisez la configuration par défaut de hello AD FS (AutoCertificateRollover est activé).</span><span class="sxs-lookup"><span data-stu-id="b7d32-166">You are using hello AD FS default configuration (AutoCertificateRollover is enabled).</span></span>

<span data-ttu-id="b7d32-167">Vérifiez que hello suivant tooconfirm qui hello certificat peut être mis à jour automatiquement.</span><span class="sxs-lookup"><span data-stu-id="b7d32-167">Check hello following tooconfirm that hello certificate can be automatically updated.</span></span>

<span data-ttu-id="b7d32-168">**1. tooTrue doit être définie à hello propriété d’AD FS AutoCertificateRollover.**</span><span class="sxs-lookup"><span data-stu-id="b7d32-168">**1. hello AD FS property AutoCertificateRollover must be set tooTrue.**</span></span> <span data-ttu-id="b7d32-169">Cela indique que AD FS génère automatiquement nouvelle signature de jetons et des certificats de déchiffrement de jeton, avant de hello ancien ceux expirent.</span><span class="sxs-lookup"><span data-stu-id="b7d32-169">This indicates that AD FS will automatically generate new token signing and token decryption certificates, before hello old ones expire.</span></span>

<span data-ttu-id="b7d32-170">**2. métadonnées de fédération hello AD FS sont accessible publiquement.**</span><span class="sxs-lookup"><span data-stu-id="b7d32-170">**2. hello AD FS federation metadata is publicly accessible.**</span></span> <span data-ttu-id="b7d32-171">Vérifiez que vos métadonnées de fédération sont accessible publiquement en naviguant toohello suivant l’URL à partir d’un ordinateur de hello internet public (sur le réseau d’entreprise hello) :</span><span class="sxs-lookup"><span data-stu-id="b7d32-171">Check that your federation metadata is publicly accessible by navigating toohello following URL from a computer on hello public internet (off of hello corporate network):</span></span>

<span data-ttu-id="b7d32-172">https://(votre_nom_FS)/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="b7d32-172">https://(your_FS_name)/federationmetadata/2007-06/federationmetadata.xml</span></span>

<span data-ttu-id="b7d32-173">où `(your_FS_name) `est remplacé par le nom d’hôte du service de fédération hello votre organisation utilise, tel que fs.contoso.com.  Si vous êtes en mesure de tooverify les deux de ces paramètres avec succès, vous n’avez pas toodo autre chose.</span><span class="sxs-lookup"><span data-stu-id="b7d32-173">where `(your_FS_name) `is replaced with hello federation service host name your organization uses, such as fs.contoso.com.  If you are able tooverify both of these settings successfully, you do not have toodo anything else.</span></span>  

<span data-ttu-id="b7d32-174">Exemple : https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span><span class="sxs-lookup"><span data-stu-id="b7d32-174">Example: https://fs.contoso.com/federationmetadata/2007-06/federationmetadata.xml</span></span>

## <span data-ttu-id="b7d32-175">Renouveler manuellement le certificat de signature de jeton de hello<a name="manualrenew"></a></span><span class="sxs-lookup"><span data-stu-id="b7d32-175">Renew hello token signing certificate manually <a name="manualrenew"></a></span></span>
<span data-ttu-id="b7d32-176">Vous pouvez choisir toorenew certificats de signature de jeton hello manuellement.</span><span class="sxs-lookup"><span data-stu-id="b7d32-176">You may choose toorenew hello token signing certificates manually.</span></span> <span data-ttu-id="b7d32-177">Par exemple, hello scénarios suivants fonctionnent mieux pour le renouvellement manuel :</span><span class="sxs-lookup"><span data-stu-id="b7d32-177">For example, hello following scenarios might work better for manual renewal:</span></span>

* <span data-ttu-id="b7d32-178">Les certificats de signature de jeton ne sont pas auto-signés.</span><span class="sxs-lookup"><span data-stu-id="b7d32-178">Token signing certificates are not self-signed certificates.</span></span> <span data-ttu-id="b7d32-179">Hello plus souvent, cela est que votre organisation gère les certificats AD FS inscrits à partir d’une autorité de certification d’organisation.</span><span class="sxs-lookup"><span data-stu-id="b7d32-179">hello most common reason for this is that your organization manages AD FS certificates enrolled from an organizational certificate authority.</span></span>
* <span data-ttu-id="b7d32-180">Sécurité du réseau n’autorise pas toobe de métadonnées de fédération hello publiquement disponible.</span><span class="sxs-lookup"><span data-stu-id="b7d32-180">Network security does not allow hello federation metadata toobe publicly available.</span></span>

<span data-ttu-id="b7d32-181">Dans ces scénarios, chaque fois que vous mettez à jour les certificats de signature de jeton de hello vous devez également mettre à jour votre domaine à Office 365 à l’aide de la commande PowerShell hello Update-MsolFederatedDomain.</span><span class="sxs-lookup"><span data-stu-id="b7d32-181">In these scenarios, every time you update hello token signing certificates, you must also update your Office 365 domain by using hello PowerShell command, Update-MsolFederatedDomain.</span></span>

### <a name="step-1-ensure-that-ad-fs-has-new-token-signing-certificates"></a><span data-ttu-id="b7d32-182">Étape 1 : s’assurer qu’AD FS dispose de nouveaux certificats de signature de jetons</span><span class="sxs-lookup"><span data-stu-id="b7d32-182">Step 1: Ensure that AD FS has new token signing certificates</span></span>
<span data-ttu-id="b7d32-183">**Configuration différente de la configuration par défaut**</span><span class="sxs-lookup"><span data-stu-id="b7d32-183">**Non-default configuration**</span></span>

<span data-ttu-id="b7d32-184">Si vous utilisez une configuration par défaut des services AD FS (où **AutoCertificateRollover** est défini trop**False**), vous utilisez probablement les certificats personnalisés (ne pas auto-signé).</span><span class="sxs-lookup"><span data-stu-id="b7d32-184">If you are using a non-default configuration of AD FS (where **AutoCertificateRollover** is set too**False**), you are probably using custom certificates (not self-signed).</span></span> <span data-ttu-id="b7d32-185">Pour plus d’informations sur l’utilisation des certificats toorenew hello AD FS de signature de jetons, consultez [conseils pour les clients n’utilisez ne pas AD FS des certificats auto-signés](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span><span class="sxs-lookup"><span data-stu-id="b7d32-185">For more information about how toorenew hello AD FS token signing certificates, see [Guidance for customers not using AD FS self-signed certificates](https://msdn.microsoft.com/library/azure/JJ933264.aspx#BKMK_NotADFSCert).</span></span>

<span data-ttu-id="b7d32-186">**Les métadonnées de fédération ne sont pas disponibles publiquement**</span><span class="sxs-lookup"><span data-stu-id="b7d32-186">**Federation metadata is not publicly available**</span></span>

<span data-ttu-id="b7d32-187">Hello d’autre part, si **AutoCertificateRollover** est défini trop**True**, mais les métadonnées de fédération ne sont pas accessible publiquement, d’abord vous assurer que les nouveaux certificats de signature de jeton ont été générées par Active Directory FS.</span><span class="sxs-lookup"><span data-stu-id="b7d32-187">On hello other hand, if **AutoCertificateRollover** is set too**True**, but your federation metadata is not publicly accessible, first make sure that new token signing certificates have been generated by AD FS.</span></span> <span data-ttu-id="b7d32-188">Confirmez que nouveau jeton de signature des certificats par hello en prenant comme suit :</span><span class="sxs-lookup"><span data-stu-id="b7d32-188">Confirm you have new token signing certificates by taking hello following steps:</span></span>

1. <span data-ttu-id="b7d32-189">Vérifiez que vous êtes connecté sur le serveur de toohello principal AD FS.</span><span class="sxs-lookup"><span data-stu-id="b7d32-189">Verify that you are logged on toohello primary AD FS server.</span></span>
2. <span data-ttu-id="b7d32-190">Vérifier les certificats de signature actuelle hello dans AD FS en ouvrant une fenêtre de commande PowerShell et en cours d’exécution hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="b7d32-190">Check hello current signing certificates in AD FS by opening a PowerShell command window, and running hello following command:</span></span>

    <span data-ttu-id="b7d32-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span><span class="sxs-lookup"><span data-stu-id="b7d32-191">PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

   > [!NOTE]
   > <span data-ttu-id="b7d32-192">Si vous utilisez AD FS 2.0, vous devez commencer par exécuter Add-Pssnapin Microsoft.Adfs.Powershell.</span><span class="sxs-lookup"><span data-stu-id="b7d32-192">If you are using AD FS 2.0, you should run Add-Pssnapin Microsoft.Adfs.Powershell first.</span></span>
   >
   >
3. <span data-ttu-id="b7d32-193">Examinez la sortie de la commande hello à tous les certificats répertoriés.</span><span class="sxs-lookup"><span data-stu-id="b7d32-193">Look at hello command output at any certificates listed.</span></span> <span data-ttu-id="b7d32-194">Si AD FS a généré un nouveau certificat, vous devez voir deux certificats dans la sortie de hello : une pour le hello **IsPrimary** valeur est **True** et hello **NotAfter** date est dans les 5 jours et pour lequel **IsPrimary** est **False** et **NotAfter** est sur une année dans hello futures.</span><span class="sxs-lookup"><span data-stu-id="b7d32-194">If AD FS has generated a new certificate, you should see two certificates in hello output: one for which hello **IsPrimary** value is **True** and hello **NotAfter** date is within 5 days, and one for which **IsPrimary** is **False** and **NotAfter** is about a year in hello future.</span></span>
4. <span data-ttu-id="b7d32-195">Si vous consultez un seul certificat et hello **NotAfter** date est comprise dans les 5 jours, vous devez toogenerate un nouveau certificat.</span><span class="sxs-lookup"><span data-stu-id="b7d32-195">If you only see one certificate, and hello **NotAfter** date is within 5 days, you need toogenerate a new certificate.</span></span>
5. <span data-ttu-id="b7d32-196">toogenerate un nouveau certificat, exécutez hello commande à une invite de commande PowerShell suivante : `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span><span class="sxs-lookup"><span data-stu-id="b7d32-196">toogenerate a new certificate, execute hello following command at a PowerShell command prompt: `PS C:\>Update-ADFSCertificate –CertificateType token-signing`.</span></span>
6. <span data-ttu-id="b7d32-197">Vérifier la mise à jour hello en exécutant la commande suivante à nouveau de hello : PS C:\>signature de jetons Get-ADFSCertificate – CertificateType</span><span class="sxs-lookup"><span data-stu-id="b7d32-197">Verify hello update by running hello following command again: PS C:\>Get-ADFSCertificate –CertificateType token-signing</span></span>

<span data-ttu-id="b7d32-198">Deux certificats doivent apparaître maintenant, un d'entre eux possède un **NotAfter** date environ un an dans hello futures et pour quels hello **IsPrimary** valeur est **False**.</span><span class="sxs-lookup"><span data-stu-id="b7d32-198">Two certificates should be listed now, one of which has a **NotAfter** date of approximately one year in hello future, and for which hello **IsPrimary** value is **False**.</span></span>

### <a name="step-2-update-hello-new-token-signing-certificates-for-hello-office-365-trust"></a><span data-ttu-id="b7d32-199">Étape 2 : Mettre à jour hello nouvelle signature de jetons des certificats de confiance de hello Office 365</span><span class="sxs-lookup"><span data-stu-id="b7d32-199">Step 2: Update hello new token signing certificates for hello Office 365 trust</span></span>
<span data-ttu-id="b7d32-200">Mettre à jour d’Office 365 avec hello nouveau jeton signature certificats toobe utilisée pour l’approbation de hello, comme suit.</span><span class="sxs-lookup"><span data-stu-id="b7d32-200">Update Office 365 with hello new token signing certificates toobe used for hello trust, as follows.</span></span>

1. <span data-ttu-id="b7d32-201">Ouvrez hello Microsoft Azure Module Active Directory pour Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b7d32-201">Open hello Microsoft Azure Active Directory Module for Windows PowerShell.</span></span>
2. <span data-ttu-id="b7d32-202">Exécutez la commande $cred=Get-Credential.</span><span class="sxs-lookup"><span data-stu-id="b7d32-202">Run $cred=Get-Credential.</span></span> <span data-ttu-id="b7d32-203">Lorsque cette applet de commande vous demande des informations d’identification, tapez vos informations d’identification de compte administrateur de services cloud.</span><span class="sxs-lookup"><span data-stu-id="b7d32-203">When this cmdlet prompts you for credentials, type your cloud service administrator account credentials.</span></span>
3. <span data-ttu-id="b7d32-204">Exécutez la commande Connect-MsolService –Credential $cred. Cette applet de commande vous connecte toohello le service cloud.</span><span class="sxs-lookup"><span data-stu-id="b7d32-204">Run Connect-MsolService –Credential $cred. This cmdlet connects you toohello cloud service.</span></span> <span data-ttu-id="b7d32-205">Création d’un contexte de connexion vous toohello le service cloud est requis avant d’exécuter une des autres applets de commande hello installé par l’outil de hello.</span><span class="sxs-lookup"><span data-stu-id="b7d32-205">Creating a context that connects you toohello cloud service is required before running any of hello additional cmdlets installed by hello tool.</span></span>
4. <span data-ttu-id="b7d32-206">Si vous exécutez ces commandes sur un ordinateur qui n’est pas serveur de fédération principal hello AD FS, exécutez la cmdlet Set-MSOLAdfscontext-ordinateur <AD FS primary server>, où <AD FS primary server> est le nom de domaine complet interne hello du serveur de hello principal AD FS.</span><span class="sxs-lookup"><span data-stu-id="b7d32-206">If you are running these commands on a computer that is not hello AD FS primary federation server, run Set-MSOLAdfscontext -Computer <AD FS primary server>, where <AD FS primary server> is hello internal FQDN name of hello primary AD FS server.</span></span> <span data-ttu-id="b7d32-207">Cette applet de commande crée un contexte qui vous connecte tooAD FS.</span><span class="sxs-lookup"><span data-stu-id="b7d32-207">This cmdlet creates a context that connects you tooAD FS.</span></span>
5. <span data-ttu-id="b7d32-208">Exécutez Update-MSOLFederatedDomain –DomainName <domain>.</span><span class="sxs-lookup"><span data-stu-id="b7d32-208">Run Update-MSOLFederatedDomain –DomainName <domain>.</span></span> <span data-ttu-id="b7d32-209">Cette applet de commande met à jour les paramètres de hello d’AD FS dans le service de cloud computing hello et configure la relation d’approbation hello entre hello deux.</span><span class="sxs-lookup"><span data-stu-id="b7d32-209">This cmdlet updates hello settings from AD FS into hello cloud service, and configures hello trust relationship between hello two.</span></span>

> [!NOTE]
> <span data-ttu-id="b7d32-210">Si vous avez besoin de toosupport plusieurs domaines de premier niveau, par exemple contoso.com et fabrikam.com, vous devez utiliser hello **SupportMultipleDomain** commutateur avec les applets de commande.</span><span class="sxs-lookup"><span data-stu-id="b7d32-210">If you need toosupport multiple top-level domains, such as contoso.com and fabrikam.com, you must use hello **SupportMultipleDomain** switch with any cmdlets.</span></span> <span data-ttu-id="b7d32-211">Pour plus d’informations, consultez [Prise en charge de plusieurs domaines de premier niveau](active-directory-aadconnect-multiple-domains.md).</span><span class="sxs-lookup"><span data-stu-id="b7d32-211">For more information, see [Support for Multiple Top Level Domains](active-directory-aadconnect-multiple-domains.md).</span></span>
>
>

## <span data-ttu-id="b7d32-212">Réparer l’approbation Azure AD à l’aide d’Azure AD Connect <a name="connectrenew"></a></span><span class="sxs-lookup"><span data-stu-id="b7d32-212">Repair Azure AD trust by using Azure AD Connect <a name="connectrenew"></a></span></span>
<span data-ttu-id="b7d32-213">Si vous avez configuré votre batterie de serveurs AD FS et la confiance Azure AD à l’aide d’Azure AD Connect, vous pouvez utiliser Azure AD Connect toodetect si vous avez besoin tootake toute action pour vos certificats de signature de jetons.</span><span class="sxs-lookup"><span data-stu-id="b7d32-213">If you configured your AD FS farm and Azure AD trust by using Azure AD Connect, you can use Azure AD Connect toodetect if you need tootake any action for your token signing certificates.</span></span> <span data-ttu-id="b7d32-214">Si vous avez besoin de certificats de hello toorenew, vous pouvez utiliser Azure AD Connect toodo donc.</span><span class="sxs-lookup"><span data-stu-id="b7d32-214">If you need toorenew hello certificates, you can use Azure AD Connect toodo so.</span></span>

<span data-ttu-id="b7d32-215">Pour plus d’informations, consultez [réparation d’approbation de hello](active-directory-aadconnect-federation-management.md).</span><span class="sxs-lookup"><span data-stu-id="b7d32-215">For more information, see [Repairing hello trust](active-directory-aadconnect-federation-management.md).</span></span>
