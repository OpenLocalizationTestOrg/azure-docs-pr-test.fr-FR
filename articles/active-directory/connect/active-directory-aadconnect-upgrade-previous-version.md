---
title: "Azure AD Connect : effectuer une mise à niveau depuis une version précédente | Microsoft Docs"
description: "Explique les différentes méthodes de mise à niveau vers la dernière version d’Azure Active Directory Connect, y compris la mise à niveau sur place et la migration « swing »."
services: active-directory
documentationcenter: 
author: AndKjell
manager: femila
editor: 
ms.assetid: 31f084d8-2b89-478c-9079-76cf92e6618f
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: Identity
ms.date: 07/12/2017
ms.author: billmath
ms.openlocfilehash: 52fd9375c71c42feaf87f4a0f4220e1cb3889e63
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-upgrade-from-a-previous-version-to-the-latest"></a><span data-ttu-id="a2260-103">Azure AD Connect : effectuer une mise à niveau vers la dernière version</span><span class="sxs-lookup"><span data-stu-id="a2260-103">Azure AD Connect: Upgrade from a previous version to the latest</span></span>
<span data-ttu-id="a2260-104">Cette rubrique décrit les différentes méthodes que vous pouvez utiliser pour mettre à niveau votre installation Azure Active Directory (Azure AD) Connect vers la dernière version.</span><span class="sxs-lookup"><span data-stu-id="a2260-104">This topic describes the different methods that you can use to upgrade your Azure Active Directory (Azure AD) Connect installation to the latest release.</span></span> <span data-ttu-id="a2260-105">Nous vous recommandons d’utiliser systématiquement les dernières versions d’Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a2260-105">We recommend that you keep yourself current with the releases of Azure AD Connect.</span></span> <span data-ttu-id="a2260-106">Vous pouvez également suivre les étapes décrites dans la section [Migration « swing »](#swing-migration) lorsque vous appliquez une modification importante à la configuration.</span><span class="sxs-lookup"><span data-stu-id="a2260-106">You also use the steps in the [Swing migration](#swing-migration) section when you make a substantial configuration change.</span></span>

<span data-ttu-id="a2260-107">Si vous souhaitez effectuer une mise à niveau à partir de DirSync, consultez plutôt [Effectuer une mise à niveau à partir de l’outil de synchronisation Azure AD (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) .</span><span class="sxs-lookup"><span data-stu-id="a2260-107">If you want to upgrade from DirSync, see [Upgrade from Azure AD sync tool (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md) instead.</span></span>

<span data-ttu-id="a2260-108">Il existe plusieurs stratégies que vous pouvez utiliser pour mettre à niveau Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a2260-108">There are a few different strategies that you can use to upgrade Azure AD Connect.</span></span>

| <span data-ttu-id="a2260-109">Méthode</span><span class="sxs-lookup"><span data-stu-id="a2260-109">Method</span></span> | <span data-ttu-id="a2260-110">Description</span><span class="sxs-lookup"><span data-stu-id="a2260-110">Description</span></span> |
| --- | --- |
| [<span data-ttu-id="a2260-111">Mise à niveau automatique</span><span class="sxs-lookup"><span data-stu-id="a2260-111">Automatic upgrade</span></span>](active-directory-aadconnect-feature-automatic-upgrade.md) |<span data-ttu-id="a2260-112">Pour les clients avec une installation rapide, il s’agit de la méthode la plus simple.</span><span class="sxs-lookup"><span data-stu-id="a2260-112">This is the easiest method for customers with an express installation.</span></span> |
| [<span data-ttu-id="a2260-113">Mise à niveau sur place</span><span class="sxs-lookup"><span data-stu-id="a2260-113">In-place upgrade</span></span>](#in-place-upgrade) |<span data-ttu-id="a2260-114">Si vous avez un seul serveur, vous pouvez mettre à niveau l’installation sur place sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="a2260-114">If you have a single server, you can upgrade the installation in-place on the same server.</span></span> |
| [<span data-ttu-id="a2260-115">Migration « swing »</span><span class="sxs-lookup"><span data-stu-id="a2260-115">Swing migration</span></span>](#swing-migration) |<span data-ttu-id="a2260-116">Avec deux serveurs, vous pouvez en préparer un avec la nouvelle version ou configuration, et changer de serveur actif quand vous êtes prêt.</span><span class="sxs-lookup"><span data-stu-id="a2260-116">With two servers, you can prepare one of the servers with the new release or configuration, and change the active server when you're ready.</span></span> |

<span data-ttu-id="a2260-117">Pour plus d’informations sur les autorisations, reportez-vous aux [autorisations requises pour une mise à niveau](active-directory-aadconnect-accounts-permissions.md#upgrade).</span><span class="sxs-lookup"><span data-stu-id="a2260-117">For permissions information, see the [permissions required for an upgrade](active-directory-aadconnect-accounts-permissions.md#upgrade).</span></span>

> [!NOTE]
> <span data-ttu-id="a2260-118">Une fois que vous avez activé votre nouveau serveur Azure AD Connect pour démarrer la synchronisation des modifications avec Azure AD, vous ne devez pas revenir à l’utilisation de DirSync ou Azure AD Sync.</span><span class="sxs-lookup"><span data-stu-id="a2260-118">After you've enabled your new Azure AD Connect server to start synchronizing changes to Azure AD, you must not roll back to using DirSync or Azure AD Sync.</span></span> <span data-ttu-id="a2260-119">La rétrogradation à partir d’Azure AD Connect vers des clients hérités, notamment DirSync et Azure AD Sync, n’est pas prise en charge et peut entraîner des problèmes tels que la perte de données dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a2260-119">Downgrading from Azure AD Connect to legacy clients, including DirSync and Azure AD Sync, isn't supported and can lead to issues such as data loss in Azure AD.</span></span>

## <a name="in-place-upgrade"></a><span data-ttu-id="a2260-120">Mise à niveau sur place</span><span class="sxs-lookup"><span data-stu-id="a2260-120">In-place upgrade</span></span>
<span data-ttu-id="a2260-121">Une mise à niveau sur place fonctionne à partir d’Azure AD Sync ou d’Azure AD Connect,</span><span class="sxs-lookup"><span data-stu-id="a2260-121">An in-place upgrade works for moving from Azure AD Sync or Azure AD Connect.</span></span> <span data-ttu-id="a2260-122">Elle ne fonctionne pas pour la migration à partir de DirSync ou pour une solution avec Forefront Identity Manager (FIM) + connecteur Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a2260-122">It doesn't work for moving from DirSync or for a solution with Forefront Identity Manager (FIM) + Azure AD Connector.</span></span>

<span data-ttu-id="a2260-123">Nous vous recommandons cette méthode si vous avez un seul serveur et moins de 100 000 objets environ.</span><span class="sxs-lookup"><span data-stu-id="a2260-123">This method is preferred when you have a single server and less than about 100,000 objects.</span></span> <span data-ttu-id="a2260-124">Après la mise à niveau, une importation et une synchronisation complètes se produisent si des modifications ont été apportées aux règles de synchronisation out-of-box,</span><span class="sxs-lookup"><span data-stu-id="a2260-124">If there are any changes to the out-of-box sync rules, a full import and full synchronization occur after the upgrade.</span></span> <span data-ttu-id="a2260-125">pour que la nouvelle configuration s’applique à tous les objets existants dans le système.</span><span class="sxs-lookup"><span data-stu-id="a2260-125">This method ensures that the new configuration is applied to all existing objects in the system.</span></span> <span data-ttu-id="a2260-126">Cette opération peut prendre plusieurs heures selon le nombre d’objets figurant dans l’étendue du moteur de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="a2260-126">This run might take a few hours, depending on the number of objects that are in scope of the sync engine.</span></span> <span data-ttu-id="a2260-127">La synchronisation différentielle normale planifiée (par défaut toutes les 30 minutes) est suspendue, mais la synchronisation des mots de passe continue.</span><span class="sxs-lookup"><span data-stu-id="a2260-127">The normal delta synchronization scheduler (which synchronizes every 30 minutes by default) is suspended, but password synchronization continues.</span></span> <span data-ttu-id="a2260-128">Vous pouvez envisager une mise à niveau sur place pendant le week-end.</span><span class="sxs-lookup"><span data-stu-id="a2260-128">You might consider doing the in-place upgrade during a weekend.</span></span> <span data-ttu-id="a2260-129">S’il n’y a aucune modification de la configuration par défaut avec la nouvelle version d’Azure AD Connect, une importation/synchronisation différentielle normale démarre à la place.</span><span class="sxs-lookup"><span data-stu-id="a2260-129">If there are no changes to the out-of-box configuration with the new Azure AD Connect release, then a normal delta import/sync starts instead.</span></span>  
![Mise à niveau sur place](./media/active-directory-aadconnect-upgrade-previous-version/inplaceupgrade.png)

<span data-ttu-id="a2260-131">Si vous avez apporté des modifications aux règles de synchronisation par défaut, celles-ci retrouvent leur configuration par défaut au moment de la mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="a2260-131">If you've made changes to the out-of-box synchronization rules, then these rules are set back to the default configuration on upgrade.</span></span> <span data-ttu-id="a2260-132">Pour conserver votre configuration d’une mise à niveau à l’autre, vérifiez que les modifications sont effectuées conformément aux [meilleures pratiques pour modifier la configuration par défaut](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="a2260-132">To make sure that your configuration is kept between upgrades, make sure that you make changes as they're described in [Best practices for changing the default configuration](active-directory-aadconnectsync-best-practices-changing-default-configuration.md).</span></span>

<span data-ttu-id="a2260-133">Pendant la mise à niveau sur place, des modifications introduites peuvent nécessiter l’exécution d’activités de synchronisation spécifiques (notamment les étapes d’importation complète et de synchronisation complète) une fois la mise à niveau terminée.</span><span class="sxs-lookup"><span data-stu-id="a2260-133">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed after upgrade completes.</span></span> <span data-ttu-id="a2260-134">Pour différer ces activités, consultez la section [Comment différer la synchronisation complète après la mise à niveau](#how-to-defer-full-synchronization-after-upgrade).</span><span class="sxs-lookup"><span data-stu-id="a2260-134">To defer such activities, refer to section [How to defer full synchronization after upgrade](#how-to-defer-full-synchronization-after-upgrade).</span></span>

## <a name="swing-migration"></a><span data-ttu-id="a2260-135">Migration « swing »</span><span class="sxs-lookup"><span data-stu-id="a2260-135">Swing migration</span></span>
<span data-ttu-id="a2260-136">Si vous avez un déploiement complexe ou un nombre d’objets élevé, il peut être difficile d’effectuer une mise à niveau sur place sur le système réel.</span><span class="sxs-lookup"><span data-stu-id="a2260-136">If you have a complex deployment or many objects, it might be impractical to do an in-place upgrade on the live system.</span></span> <span data-ttu-id="a2260-137">Pour certains clients, ce processus peut prendre plusieurs jours pendant lesquels aucune modification différentielle n’est traitée.</span><span class="sxs-lookup"><span data-stu-id="a2260-137">For some customers, this process might take multiple days--and during this time, no delta changes are processed.</span></span> <span data-ttu-id="a2260-138">Vous pouvez également utiliser cette méthode lorsque vous envisagez d’apporter des modifications importantes à votre configuration et que vous souhaitez les tester avant de les envoyer dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="a2260-138">You can also use this method when you plan to make substantial changes to your configuration and you want to try them out before they're pushed to the cloud.</span></span>

<span data-ttu-id="a2260-139">La méthode recommandée pour ces scénarios consiste à utiliser une migration « swing ».</span><span class="sxs-lookup"><span data-stu-id="a2260-139">The recommended method for these scenarios is to use a swing migration.</span></span> <span data-ttu-id="a2260-140">Vous devez avoir (au moins) deux serveurs : un serveur actif et un serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-140">You need (at least) two servers--one active server and one staging server.</span></span> <span data-ttu-id="a2260-141">Le serveur actif (représenté par des lignes bleues continues dans l’image ci-dessous) est responsable de la charge de production active.</span><span class="sxs-lookup"><span data-stu-id="a2260-141">The active server (shown with solid blue lines in the following picture) is responsible for the active production load.</span></span> <span data-ttu-id="a2260-142">Le serveur intermédiaire (représenté par des lignes violettes en pointillé) est préparé avec la nouvelle version ou configuration.</span><span class="sxs-lookup"><span data-stu-id="a2260-142">The staging server (shown with dashed purple lines) is prepared with the new release or configuration.</span></span> <span data-ttu-id="a2260-143">Lorsqu’il est prêt, ce serveur devient actif.</span><span class="sxs-lookup"><span data-stu-id="a2260-143">When it's fully ready, this server is made active.</span></span> <span data-ttu-id="a2260-144">Le serveur actif précédent, sur lequel est désormais installée l’ancienne version ou configuration, devient le serveur intermédiaire et est mis à niveau.</span><span class="sxs-lookup"><span data-stu-id="a2260-144">The previous active server, which now has the old version or configuration installed, is made into the staging server and is upgraded.</span></span>

<span data-ttu-id="a2260-145">Les deux serveurs peuvent utiliser différentes versions.</span><span class="sxs-lookup"><span data-stu-id="a2260-145">The two servers can use different versions.</span></span> <span data-ttu-id="a2260-146">Par exemple, le serveur actif que vous projetez de désactiver peut utiliser Azure AD Sync et le nouveau serveur intermédiaire peut utiliser Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="a2260-146">For example, the active server that you plan to decommission can use Azure AD Sync, and the new staging server can use Azure AD Connect.</span></span> <span data-ttu-id="a2260-147">Si vous utilisez la migration « swing » pour développer une nouvelle configuration, il est judicieux d’installer les mêmes versions sur les deux serveurs.</span><span class="sxs-lookup"><span data-stu-id="a2260-147">If you use swing migration to develop a new configuration, it's a good idea to have the same versions on the two servers.</span></span>  
![Serveur de test](./media/active-directory-aadconnect-upgrade-previous-version/stagingserver1.png)

> [!NOTE]
> <span data-ttu-id="a2260-149">Certains clients préfèrent avoir trois ou quatre serveurs pour ce scénario.</span><span class="sxs-lookup"><span data-stu-id="a2260-149">Some customers prefer to have three or four servers for this scenario.</span></span> <span data-ttu-id="a2260-150">Pendant la mise à niveau du serveur intermédiaire, vous n’avez pas de serveur de sauvegarde pour la [récupération d’urgence](active-directory-aadconnectsync-operations.md#disaster-recovery).</span><span class="sxs-lookup"><span data-stu-id="a2260-150">When the staging server is upgraded, you don't have a backup server for [disaster recovery](active-directory-aadconnectsync-operations.md#disaster-recovery).</span></span> <span data-ttu-id="a2260-151">Avec trois ou quatre serveurs, vous pouvez préparer un ensemble de serveurs principaux/de secours disposant de la nouvelle version. Ainsi, un serveur intermédiaire est toujours prêt à prendre le relais.</span><span class="sxs-lookup"><span data-stu-id="a2260-151">With three or four servers, you can prepare one set of primary/standby servers with the new version, which ensures that there is always a staging server that's ready to take over.</span></span>

<span data-ttu-id="a2260-152">Ces étapes fonctionnent également pour la migration à partir d’Azure AD Sync ou d’une solution avec FIM + connecteur Azure AD.</span><span class="sxs-lookup"><span data-stu-id="a2260-152">These steps also work to move from Azure AD Sync or a solution with FIM + Azure AD Connector.</span></span> <span data-ttu-id="a2260-153">En revanche, elles ne fonctionnent pas pour DirSync, mais on trouve cette même méthode de migration « swing » (également appelée déploiement parallèle) pour DirSync dans [Azure AD Connect : Mise à niveau à partir de DirSync](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="a2260-153">These steps don't work for DirSync, but the same swing migration method (also called parallel deployment) with steps for DirSync is in [Upgrade Azure Active Directory sync (DirSync)](active-directory-aadconnect-dirsync-upgrade-get-started.md).</span></span>

### <a name="use-a-swing-migration-to-upgrade"></a><span data-ttu-id="a2260-154">Utiliser une migration « swing » pour effectuer la mise à niveau</span><span class="sxs-lookup"><span data-stu-id="a2260-154">Use a swing migration to upgrade</span></span>
1. <span data-ttu-id="a2260-155">Si vous utilisez Azure AD Connect sur les deux serveurs et que vous prévoyez uniquement de modifier la configuration, assurez-vous que votre serveur actif et votre serveur intermédiaire utilisent tous deux la même version.</span><span class="sxs-lookup"><span data-stu-id="a2260-155">If you use Azure AD Connect on both servers and plan to only make a configuration change, make sure that your active server and staging server are both using the same version.</span></span> <span data-ttu-id="a2260-156">Il sera plus facile de comparer ensuite les différences.</span><span class="sxs-lookup"><span data-stu-id="a2260-156">That makes it easier to compare differences later.</span></span> <span data-ttu-id="a2260-157">Si vous effectuez une mise à niveau à partir d’Azure AD Sync, ces serveurs auront des versions différentes.</span><span class="sxs-lookup"><span data-stu-id="a2260-157">If you're upgrading from Azure AD Sync, then these servers have different versions.</span></span> <span data-ttu-id="a2260-158">Si vous effectuez une mise à niveau à partir d’une ancienne version d’Azure AD Connect, il est judicieux, mais pas obligatoire, de commencer avec les deux serveurs qui utilisent la même version.</span><span class="sxs-lookup"><span data-stu-id="a2260-158">If you're upgrading from an older version of Azure AD Connect, it's a good idea to start with the two servers that are using the same version, but it's not required.</span></span>
2. <span data-ttu-id="a2260-159">Si vous avez effectué une configuration personnalisée et que votre serveur intermédiaire ne l’a pas, suivez les étapes décrites dans [Déplacer une configuration personnalisée depuis le serveur actif vers le serveur intermédiaire](#move-custom-configuration-from-active-to-staging-server).</span><span class="sxs-lookup"><span data-stu-id="a2260-159">If you've made a custom configuration and your staging server doesn't have it, follow the steps under [Move a custom configuration from the active server to the staging server](#move-custom-configuration-from-active-to-staging-server).</span></span>
3. <span data-ttu-id="a2260-160">Si vous mettez à niveau depuis une version antérieure d’Azure AD Connect, mettez à niveau le serveur intermédiaire vers la dernière version.</span><span class="sxs-lookup"><span data-stu-id="a2260-160">If you're upgrading from an earlier release of Azure AD Connect, upgrade the staging server to the latest version.</span></span> <span data-ttu-id="a2260-161">Si vous migrez à partir d’Azure AD Sync, installez Azure AD Connect sur votre serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-161">If you're moving from Azure AD Sync, then install Azure AD Connect on your staging server.</span></span>
4. <span data-ttu-id="a2260-162">Laissez le moteur de synchronisation effectuer une importation et une synchronisation complètes sur votre serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-162">Let the sync engine run full import and full synchronization on your staging server.</span></span>
5. <span data-ttu-id="a2260-163">Vérifiez que la nouvelle configuration n’a pas entraîné de modifications inattendues à l’aide de la procédure indiquée sous « Vérifier » dans [Vérifiez la configuration d’un serveur](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="a2260-163">Verify that the new configuration didn't cause any unexpected changes by using the steps under "Verify" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span> <span data-ttu-id="a2260-164">Si quelque chose n’est pas comme prévu, corrigez le problème, exécutez l’importation et la synchronisation et vérifiez les données jusqu’à ce qu’elles vous conviennent en suivant les étapes.</span><span class="sxs-lookup"><span data-stu-id="a2260-164">If something isn't as expected, correct it, run the import and sync, and verify the data until it looks good, by following the steps.</span></span>
6. <span data-ttu-id="a2260-165">Convertissez le serveur de test en serveur actif.</span><span class="sxs-lookup"><span data-stu-id="a2260-165">Switch the staging server to be the active server.</span></span> <span data-ttu-id="a2260-166">C’est la dernière étape, « Changer de serveur actif », de la procédure [Vérifiez la configuration d’un serveur](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span><span class="sxs-lookup"><span data-stu-id="a2260-166">This is the final step "Switch active server" in [Verify the configuration of a server](active-directory-aadconnectsync-operations.md#verify-the-configuration-of-a-server).</span></span>
7. <span data-ttu-id="a2260-167">Si vous mettez à niveau Azure AD Connect, mettez à niveau le serveur actuellement en mode intermédiaire vers la dernière version.</span><span class="sxs-lookup"><span data-stu-id="a2260-167">If you're upgrading Azure AD Connect, upgrade the server that's now in staging mode to the latest release.</span></span> <span data-ttu-id="a2260-168">Suivez la même procédure pour mettre à niveau les données et la configuration.</span><span class="sxs-lookup"><span data-stu-id="a2260-168">Follow the same steps as before to get the data and configuration upgraded.</span></span> <span data-ttu-id="a2260-169">Si vous avez effectué une mise à niveau à partir d’Azure AD Sync, vous pouvez maintenant désactiver et retirer votre ancien serveur.</span><span class="sxs-lookup"><span data-stu-id="a2260-169">If you upgraded from Azure AD Sync, you can now turn off and decommission your old server.</span></span>

### <a name="move-a-custom-configuration-from-the-active-server-to-the-staging-server"></a><span data-ttu-id="a2260-170">Déplacer une configuration personnalisée depuis le serveur actif vers le serveur intermédiaire</span><span class="sxs-lookup"><span data-stu-id="a2260-170">Move a custom configuration from the active server to the staging server</span></span>
<span data-ttu-id="a2260-171">Si vous avez apporté des modifications à la configuration du serveur actif, vous devez vérifier que les mêmes modifications sont appliquées au serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-171">If you've made configuration changes to the active server, you need to make sure that the same changes are applied to the staging server.</span></span> <span data-ttu-id="a2260-172">Pour faciliter ce déplacement, vous pouvez utiliser la [documentation de configuration d’Azure AD Connect](https://github.com/Microsoft/AADConnectConfigDocumenter).</span><span class="sxs-lookup"><span data-stu-id="a2260-172">To help with this move, you can use the [Azure AD Connect configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter).</span></span>

<span data-ttu-id="a2260-173">Vous pouvez migrer les règles de synchronisation personnalisées que vous avez créées à l’aide de PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a2260-173">You can move the custom sync rules that you've created by using PowerShell.</span></span> <span data-ttu-id="a2260-174">Vous devez appliquer d’autres modifications de la même manière sur les deux systèmes, et vous ne pouvez pas migrer les modifications.</span><span class="sxs-lookup"><span data-stu-id="a2260-174">You must apply other changes the same way on both systems, and you can't migrate the changes.</span></span> <span data-ttu-id="a2260-175">La [documentation de configuration](https://github.com/Microsoft/AADConnectConfigDocumenter) peut vous aider à comparer les deux systèmes pour vérifier qu’ils sont identiques.</span><span class="sxs-lookup"><span data-stu-id="a2260-175">The [configuration documenter](https://github.com/Microsoft/AADConnectConfigDocumenter) can help you comparing the two systems to make sure they are identical.</span></span> <span data-ttu-id="a2260-176">L’outil peut également vous aider à automatiser les étapes indiquées dans cette section.</span><span class="sxs-lookup"><span data-stu-id="a2260-176">The tool can also help in automating the steps found in this section.</span></span>

<span data-ttu-id="a2260-177">Vous devez configurer ce qui suit de la même façon sur les deux serveurs :</span><span class="sxs-lookup"><span data-stu-id="a2260-177">You need to configure the following things the same way on both servers:</span></span>

* <span data-ttu-id="a2260-178">Connexion aux mêmes forêts</span><span class="sxs-lookup"><span data-stu-id="a2260-178">Connection to the same forests</span></span>
* <span data-ttu-id="a2260-179">Tout filtrage de domaine et d’unité organisationnelle</span><span class="sxs-lookup"><span data-stu-id="a2260-179">Any domain and OU filtering</span></span>
* <span data-ttu-id="a2260-180">Fonctionnalités facultatives identiques, telles que la synchronisation de mot de passe et l’écriture différée du mot de passe</span><span class="sxs-lookup"><span data-stu-id="a2260-180">The same optional features, such as password sync and password writeback</span></span>

<span data-ttu-id="a2260-181">**Migrer les règles de synchronisation personnalisées**</span><span class="sxs-lookup"><span data-stu-id="a2260-181">**Move custom synchronization rules**</span></span>  
<span data-ttu-id="a2260-182">Pour déplacer des règles de synchronisation personnalisées, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="a2260-182">To move custom synchronization rules, do the following:</span></span>

1. <span data-ttu-id="a2260-183">Ouvrez l’ **Éditeur de règles de synchronisation** sur votre serveur actif.</span><span class="sxs-lookup"><span data-stu-id="a2260-183">Open **Synchronization Rules Editor** on your active server.</span></span>
2. <span data-ttu-id="a2260-184">Sélectionnez une règle personnalisée.</span><span class="sxs-lookup"><span data-stu-id="a2260-184">Select a custom rule.</span></span> <span data-ttu-id="a2260-185">Cliquez sur **Exporter**.</span><span class="sxs-lookup"><span data-stu-id="a2260-185">Click **Export**.</span></span> <span data-ttu-id="a2260-186">Une fenêtre Bloc-notes apparaît.</span><span class="sxs-lookup"><span data-stu-id="a2260-186">This brings up a Notepad window.</span></span> <span data-ttu-id="a2260-187">Enregistrez le fichier temporaire avec une extension PS1.</span><span class="sxs-lookup"><span data-stu-id="a2260-187">Save the temporary file with a PS1 extension.</span></span> <span data-ttu-id="a2260-188">Le fichier devient un script PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a2260-188">This makes it a PowerShell script.</span></span> <span data-ttu-id="a2260-189">Copiez le fichier PS1 sur le serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-189">Copy the PS1 file to the staging server.</span></span>  
   <span data-ttu-id="a2260-190">![Exportation des règles de synchronisation](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span><span class="sxs-lookup"><span data-stu-id="a2260-190">![Sync rule export](./media/active-directory-aadconnect-upgrade-previous-version/exportrule.png)</span></span>
3. <span data-ttu-id="a2260-191">Le GUID du connecteur est différent sur le serveur intermédiaire et doit être modifié.</span><span class="sxs-lookup"><span data-stu-id="a2260-191">The Connector GUID is different on the staging server, and you must change it.</span></span> <span data-ttu-id="a2260-192">Pour obtenir le GUID, démarrez **l’Éditeur de règles de synchronisation**, sélectionnez une des règles par défaut représentant le même système connecté, puis cliquez sur **Exporter**.</span><span class="sxs-lookup"><span data-stu-id="a2260-192">To get the GUID, start **Synchronization Rules Editor**, select one of the out-of-box rules that represent the same connected system, and click **Export**.</span></span> <span data-ttu-id="a2260-193">Remplacez le GUID dans votre fichier PS1 par le GUID se trouvant sur le serveur de test.</span><span class="sxs-lookup"><span data-stu-id="a2260-193">Replace the GUID in your PS1 file with the GUID from the staging server.</span></span>
4. <span data-ttu-id="a2260-194">Dans une invite de PowerShell, exécutez le fichier PS1.</span><span class="sxs-lookup"><span data-stu-id="a2260-194">In a PowerShell prompt, run the PS1 file.</span></span> <span data-ttu-id="a2260-195">Cette action crée la règle de synchronisation personnalisée sur le serveur intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="a2260-195">This creates the custom synchronization rule on the staging server.</span></span>
5. <span data-ttu-id="a2260-196">Répétez cette procédure pour toutes vos règles personnalisées.</span><span class="sxs-lookup"><span data-stu-id="a2260-196">Repeat this for all your custom rules.</span></span>

## <a name="how-to-defer-full-synchronization-after-upgrade"></a><span data-ttu-id="a2260-197">Comment différer la synchronisation complète après la mise à niveau</span><span class="sxs-lookup"><span data-stu-id="a2260-197">How to defer full synchronization after upgrade</span></span>
<span data-ttu-id="a2260-198">Pendant la mise à niveau sur place, des modifications introduites peuvent nécessiter l’exécution d’activités de synchronisation spécifiques (notamment les étapes d’importation complète et de synchronisation complète).</span><span class="sxs-lookup"><span data-stu-id="a2260-198">During in-place upgrade, there may be changes introduced that require specific synchronization activities (including Full Import step and Full Synchronization step) to be executed.</span></span> <span data-ttu-id="a2260-199">Par exemple, les modifications du schéma de connecteur nécessitent l’exécution de l’étape **Importation complète**, et les modifications des règles de synchronisation par défaut nécessitent l’exécution de l’étape **Synchronisation complète** sur les connecteurs affectés.</span><span class="sxs-lookup"><span data-stu-id="a2260-199">For example, connector schema changes require **full import** step and out-of-box synchronization rule changes require **full synchronization** step to be executed on affected connectors.</span></span> <span data-ttu-id="a2260-200">Pendant la mise à niveau, Azure AD Connect détermine les activités de synchronisation requises et les enregistre en tant qu’*actions prioritaires*.</span><span class="sxs-lookup"><span data-stu-id="a2260-200">During upgrade, Azure AD Connect determines what synchronization activities are required and records them as *overrides*.</span></span> <span data-ttu-id="a2260-201">Dans le cycle de synchronisation suivant, le planificateur de synchronisation récupère ces actions prioritaires et les exécute.</span><span class="sxs-lookup"><span data-stu-id="a2260-201">In the following synchronization cycle, the synchronization scheduler picks up these overrides and executes them.</span></span> <span data-ttu-id="a2260-202">Dès qu’une action prioritaire a été exécutée avec succès, elle est supprimée.</span><span class="sxs-lookup"><span data-stu-id="a2260-202">Once an override is successfully executed, it is removed.</span></span>

<span data-ttu-id="a2260-203">Il peut arriver que vous ne souhaitiez pas que ces actions prioritaires aient lieu immédiatement après la mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="a2260-203">There may be situations where you do not want these overrides to take place immediately after upgrade.</span></span> <span data-ttu-id="a2260-204">Par exemple, vous avez de nombreux objets synchronisés et vous souhaitez que ces étapes de synchronisation aient lieu après les heures de bureau.</span><span class="sxs-lookup"><span data-stu-id="a2260-204">For example, you have numerous synchronized objects and you would like these synchronization steps to occur after business hours.</span></span> <span data-ttu-id="a2260-205">Pour supprimer ces actions prioritaires :</span><span class="sxs-lookup"><span data-stu-id="a2260-205">To remove these overrides:</span></span>

1. <span data-ttu-id="a2260-206">Pendant la mise à niveau, **désactivez** l’option **Démarrez le processus de synchronisation une fois la configuration terminée**.</span><span class="sxs-lookup"><span data-stu-id="a2260-206">During upgrade, **uncheck** the option **Start the synchronization process when configuration completes**.</span></span> <span data-ttu-id="a2260-207">Cela désactive le planificateur de synchronisation et empêche l’exécution automatique du cycle de synchronisation avant la suppression des actions prioritaires.</span><span class="sxs-lookup"><span data-stu-id="a2260-207">This disables the synchronization scheduler and prevents synchronization cycle from taking place automatically before the overrides are removed.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync01.png)

2. <span data-ttu-id="a2260-209">Une fois la mise à niveau terminée, exécutez l’applet de commande suivante pour connaître les actions prioritaires qui ont été ajoutées : `Get-ADSyncSchedulerConnectorOverride | fl`</span><span class="sxs-lookup"><span data-stu-id="a2260-209">After upgrade completes, run the following cmdlet to find out what overrides have been added: `Get-ADSyncSchedulerConnectorOverride | fl`</span></span>

   >[!NOTE]
   > <span data-ttu-id="a2260-210">Les actions prioritaires sont propres au connecteur.</span><span class="sxs-lookup"><span data-stu-id="a2260-210">The overrides are connector-specific.</span></span> <span data-ttu-id="a2260-211">Dans l’exemple suivant, les étapes d’importation complète et de synchronisation complète ont été ajoutées au connecteur Active Directory et au connecteur Azure AD locaux.</span><span class="sxs-lookup"><span data-stu-id="a2260-211">In the following example, Full Import step and Full Synchronization step have been added to both the on-premises AD Connector and Azure AD Connector.</span></span>

   ![DisableFullSyncAfterUpgrade](./media/active-directory-aadconnect-upgrade-previous-version/disablefullsync02.png)

3. <span data-ttu-id="a2260-213">Prenez note des actions prioritaires existantes qui ont été ajoutées.</span><span class="sxs-lookup"><span data-stu-id="a2260-213">Note down the existing overrides that have been added.</span></span>
   
4. <span data-ttu-id="a2260-214">Pour supprimer les actions prioritaires pour l’importation complète et la synchronisation complète sur un connecteur arbitraire, exécutez l’applet de commande suivante : `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span><span class="sxs-lookup"><span data-stu-id="a2260-214">To remove the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet: `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid-of-ConnectorIdentifier> -FullImportRequired $false -FullSyncRequired $false`</span></span>

   <span data-ttu-id="a2260-215">Pour supprimer les actions prioritaires sur tous les connecteurs, exécutez le script PowerShell suivant :</span><span class="sxs-lookup"><span data-stu-id="a2260-215">To remove the overrides on all connectors, execute the following PowerShell script:</span></span>

   ```
   foreach ($connectorOverride in Get-ADSyncSchedulerConnectorOverride)
   {
       Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier $connectorOverride.ConnectorIdentifier.Guid -FullSyncRequired $false -FullImportRequired $false
   }
   ```

5. <span data-ttu-id="a2260-216">Pour redémarrer le planificateur, exécutez l’applet de commande suivante : `Set-ADSyncScheduler -SyncCycleEnabled $true`</span><span class="sxs-lookup"><span data-stu-id="a2260-216">To resume the scheduler, run the following cmdlet: `Set-ADSyncScheduler -SyncCycleEnabled $true`</span></span>

   >[!IMPORTANT]
   > <span data-ttu-id="a2260-217">N’oubliez pas d’exécuter les étapes de synchronisation requises dès que vous le pourrez.</span><span class="sxs-lookup"><span data-stu-id="a2260-217">Remember to execute the required synchronization steps at your earliest convenience.</span></span> <span data-ttu-id="a2260-218">Vous pouvez exécuter ces étapes manuellement à l’aide de Synchronization Service Manager ou rajouter les actions prioritaires à l’aide de l’applet de commande Set-ADSyncSchedulerConnectorOverride.</span><span class="sxs-lookup"><span data-stu-id="a2260-218">You can either manually execute these steps using the Synchronization Service Manager or add the overrides back using the Set-ADSyncSchedulerConnectorOverride cmdlet.</span></span>

<span data-ttu-id="a2260-219">Pour ajouter les actions prioritaires pour l’importation complète et la synchronisation complète sur un connecteur arbitraire, exécutez l’applet de commande suivante : `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span><span class="sxs-lookup"><span data-stu-id="a2260-219">To add the overrides for both full import and full synchronization on an arbitrary connector, run the following cmdlet:  `Set-ADSyncSchedulerConnectorOverride -ConnectorIdentifier <Guid> -FullImportRequired $true -FullSyncRequired $true`</span></span>

## <a name="next-steps"></a><span data-ttu-id="a2260-220">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a2260-220">Next steps</span></span>
<span data-ttu-id="a2260-221">En savoir plus sur [l’intégration de vos identités locales avec Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="a2260-221">Learn more about [integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
