---
title: "Azure AD Connect : Comment limiter toorecover à partir de la base de données locale 10 Go problème | Documents Microsoft"
description: "Cette rubrique décrit comment toorecover synchronisation d’Azure AD Connect de Service lorsqu’il rencontre LocalDB 10 Go limiter le problème."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="aada9-103">Azure AD Connect : Comment toorecover à partir de la limite de 10 Go de base de données locale</span><span class="sxs-lookup"><span data-stu-id="aada9-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="aada9-104">Azure AD Connect requiert une données d’identité de base de données SQL Server toostore.</span><span class="sxs-lookup"><span data-stu-id="aada9-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="aada9-105">Vous pouvez utiliser SQL Server 2012 Express LocalDB installé avec Azure AD Connect de la valeur par défaut hello ou utiliser votre propre SQL complète.</span><span class="sxs-lookup"><span data-stu-id="aada9-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="aada9-106">SQL Server Express impose une limite de taille de 10 Go.</span><span class="sxs-lookup"><span data-stu-id="aada9-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="aada9-107">Lorsque vous utilisez la base de données locale et que cette limite est atteinte, le service de synchronisation Azure AD Connect ne peut plus démarrer ou se synchroniser correctement.</span><span class="sxs-lookup"><span data-stu-id="aada9-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="aada9-108">Cet article fournit des étapes de récupération hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="aada9-109">Symptômes</span><span class="sxs-lookup"><span data-stu-id="aada9-109">Symptoms</span></span>
<span data-ttu-id="aada9-110">Il existe deux symptômes courants :</span><span class="sxs-lookup"><span data-stu-id="aada9-110">There are two common symptoms:</span></span>

* <span data-ttu-id="aada9-111">Service Azure AD Connect synchronisation **est en cours d’exécution** , mais échoue toosynchronize avec *« s’est arrêté-base de données-disque plein »* erreur.</span><span class="sxs-lookup"><span data-stu-id="aada9-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="aada9-112">Service Azure AD Connect synchronisation **est impossible de toostart**.</span><span class="sxs-lookup"><span data-stu-id="aada9-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="aada9-113">Lorsque vous essayez de service de hello toostart, elle échoue avec l’événement 6323 et le message d’erreur *« hello serveur a rencontré une erreur, car SQL Server est en dehors de l’espace disque. »*</span><span class="sxs-lookup"><span data-stu-id="aada9-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="aada9-114">Étapes de récupération à court terme</span><span class="sxs-lookup"><span data-stu-id="aada9-114">Short-term recovery steps</span></span>
<span data-ttu-id="aada9-115">Cette section fournit un espace de tooreclaim DB hello étapes requise pour l’opération de Service Azure AD Connect synchronisation tooresume.</span><span class="sxs-lookup"><span data-stu-id="aada9-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="aada9-116">Hello étapes :</span><span class="sxs-lookup"><span data-stu-id="aada9-116">hello steps include:</span></span>
1. [<span data-ttu-id="aada9-117">Déterminer l’état du Service de synchronisation hello</span><span class="sxs-lookup"><span data-stu-id="aada9-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="aada9-118">Réduire la base de données hello</span><span class="sxs-lookup"><span data-stu-id="aada9-118">Shrink hello database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="aada9-119">Supprimer les données d’historique d’exécution</span><span class="sxs-lookup"><span data-stu-id="aada9-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="aada9-120">Réduire la période de rétention des données d’historique d’exécution</span><span class="sxs-lookup"><span data-stu-id="aada9-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="aada9-121">Déterminer l’état du Service de synchronisation hello</span><span class="sxs-lookup"><span data-stu-id="aada9-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="aada9-122">Tout d’abord, déterminez si hello Service de synchronisation est en cours d’exécution ou non :</span><span class="sxs-lookup"><span data-stu-id="aada9-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="aada9-123">Ouvrez une session dans tooyour Azure AD Connect serveur en tant qu’administrateur.</span><span class="sxs-lookup"><span data-stu-id="aada9-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="aada9-124">Accédez trop**Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="aada9-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="aada9-125">Vérifier l’état de hello de **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="aada9-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="aada9-126">Si elle est en cours d’exécution, arrêter ou redémarrer le service de hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="aada9-127">Ignorer [base de données réduction hello](#shrink-the-database) étape et passez trop[supprimer exécuter les données d’historique](#delete-run-history-data) étape.</span><span class="sxs-lookup"><span data-stu-id="aada9-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="aada9-128">Si elle n’est pas en cours d’exécution, essayez de service de hello toostart.</span><span class="sxs-lookup"><span data-stu-id="aada9-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="aada9-129">Si hello service démarre correctement, passez [base de données réduction hello](#shrink-the-database) étape et passez trop[supprimer exécuter les données d’historique](#delete-run-history-data) étape.</span><span class="sxs-lookup"><span data-stu-id="aada9-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="aada9-130">Sinon, continuez [base de données réduction hello](#shrink-the-database) étape.</span><span class="sxs-lookup"><span data-stu-id="aada9-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="aada9-131">Réduire la base de données hello</span><span class="sxs-lookup"><span data-stu-id="aada9-131">Shrink hello database</span></span>
<span data-ttu-id="aada9-132">Utilisez toofree d’opération de réduction hello des suffisamment hello de toostart DB espace Service de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="aada9-133">Elle libère de l’espace de base de données en supprimant les espaces blancs dans la base de données hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="aada9-134">Il s’agit de l’étape recommandée, mais elle ne constitue pas la garantie que vous pouvez toujours récupérer de l’espace.</span><span class="sxs-lookup"><span data-stu-id="aada9-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="aada9-135">toolearn en savoir plus sur l’opération de réduction, lisez cet article [réduire une base de données](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="aada9-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="aada9-136">Ignorez cette étape si vous pouvez obtenir toorun du Service de synchronisation hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="aada9-137">Il est déconseillé tooshrink hello base de données SQL car elle peut entraîner des performances toopoor en raison de la fragmentation de tooincreased.</span><span class="sxs-lookup"><span data-stu-id="aada9-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="aada9-138">le nom de base de données hello créé pour Azure AD Connect Hello est **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="aada9-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="aada9-139">tooperform une opération de réduction, vous devez vous connecter en tant que hello sysadmin ou le propriétaire de la base de données hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="aada9-140">Pendant l’installation d’Azure AD Connect, hello suivant comptes bénéficient de droits d’administrateur système :</span><span class="sxs-lookup"><span data-stu-id="aada9-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="aada9-141">Administrateurs locaux</span><span class="sxs-lookup"><span data-stu-id="aada9-141">Local Administrators</span></span>
* <span data-ttu-id="aada9-142">compte d’utilisateur Hello qui était utilisé toorun Azure AD Connect installation.</span><span class="sxs-lookup"><span data-stu-id="aada9-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="aada9-143">Hello compte de Service de synchronisation qui est utilisé comme hello fonctionne le contexte de Service Azure AD Connect synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="aada9-144">groupe local Hello ADSyncAdmins qui a été créé pendant l’installation.</span><span class="sxs-lookup"><span data-stu-id="aada9-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="aada9-145">Base de données de hello en copiant **ADSync.mdf** et **ADSync_log.ldf** fichiers situés sous `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa les emplacement sûr.</span><span class="sxs-lookup"><span data-stu-id="aada9-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="aada9-146">Démarrez une nouvelle session PowerShell.</span><span class="sxs-lookup"><span data-stu-id="aada9-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="aada9-147">Accédez toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="aada9-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="aada9-148">Démarrer **sqlcmd** utilitaire en exécutant la commande hello `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, à l’aide des informations d’identification de hello d’un administrateur système ou hello DBO de la base de données.</span><span class="sxs-lookup"><span data-stu-id="aada9-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="aada9-149">base de données du hello tooshrink, à l’invite de sqlcmd hello (1 >), entrez `DBCC Shrinkdatabase(ADSync,1);`, suivi par `GO` dans la ligne suivante de hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="aada9-150">Si l’opération de hello est réussie, réessayez toostart hello Service de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="aada9-151">Si vous pouvez démarrer le Service de synchronisation de hello, accédez trop[supprimer exécuter les données d’historique](#delete-run-history-data) étape.</span><span class="sxs-lookup"><span data-stu-id="aada9-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="aada9-152">Sinon, contactez le support.</span><span class="sxs-lookup"><span data-stu-id="aada9-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="aada9-153">Supprimer les données d’historique d’exécution</span><span class="sxs-lookup"><span data-stu-id="aada9-153">Delete run history data</span></span>
<span data-ttu-id="aada9-154">Par défaut, Azure AD Connect conserve des tooseven jours de données de l’historique d’exécution.</span><span class="sxs-lookup"><span data-stu-id="aada9-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="aada9-155">Dans cette étape, nous supprimons hello espace de tooreclaim base de données de l’historique des données d’exécution afin que le Service Azure AD Connect synchronisation peut démarrer la synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="aada9-156">Démarrer **Synchronization Service Manager** par → de tooSTART va Service de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="aada9-157">Accédez toohello **Operations** onglet.</span><span class="sxs-lookup"><span data-stu-id="aada9-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="aada9-158">Sous **Actions**, sélectionnez **Clear Runs... (Effacer les exécutions)**.</span><span class="sxs-lookup"><span data-stu-id="aada9-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="aada9-159">Vous pouvez choisir l’option **Clear all runs (Effacer toutes les exécutions)** ou **Clear runs before… (Effacer les exécutions avant)<date>**.</span><span class="sxs-lookup"><span data-stu-id="aada9-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="aada9-160">Il est recommandé de commencer par désactiver les données d’historique d’exécution présentes depuis plus de deux jours.</span><span class="sxs-lookup"><span data-stu-id="aada9-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="aada9-161">Si vous continuez toorun problème de taille de base de données, puis choisissez hello **effacer toutes les séries** option.</span><span class="sxs-lookup"><span data-stu-id="aada9-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="aada9-162">Réduire la période de rétention des données d’historique d’exécution</span><span class="sxs-lookup"><span data-stu-id="aada9-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="aada9-163">Cette étape est la probabilité de hello tooreduce des problème de limite de 10 Go hello après plusieurs cycles de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="aada9-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="aada9-164">Ouvrez une nouvelle session PowerShell.</span><span class="sxs-lookup"><span data-stu-id="aada9-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="aada9-165">Exécutez `Get-ADSyncScheduler` et prenez note de hello propriété PurgeRunHistoryInterval, qui spécifie la période de rétention actuelle hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="aada9-166">Exécutez `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` jours tootwo période de conservation des tooset hello.</span><span class="sxs-lookup"><span data-stu-id="aada9-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="aada9-167">Ajuster la période de rétention hello comme il convient.</span><span class="sxs-lookup"><span data-stu-id="aada9-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="aada9-168">Solution à long terme – migration toofull SQL</span><span class="sxs-lookup"><span data-stu-id="aada9-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="aada9-169">En règle générale, problème de hello n’indique que la taille de base de données de 10 Go n’est plus suffisante pour Azure AD Connect toosynchronize votre tooAzure d’Active Directory sur site Active Directory.</span><span class="sxs-lookup"><span data-stu-id="aada9-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="aada9-170">Il est conseillé de passer toousing hello complète de SQL server.</span><span class="sxs-lookup"><span data-stu-id="aada9-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="aada9-171">Vous ne peut pas remplacer directement hello LocalDB d’un déploiement d’Azure AD Connect existant avec base de données hello de la version complète de hello de SQL.</span><span class="sxs-lookup"><span data-stu-id="aada9-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="aada9-172">Au lieu de cela, vous devez déployer un nouveau serveur Azure AD Connect avec la version complète de hello de SQL.</span><span class="sxs-lookup"><span data-stu-id="aada9-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="aada9-173">Il est recommandé d’effectuer une migration de basculement où le nouveau serveur de Azure AD Connect hello (avec la base de données SQL) est déployé comme un serveur de test suivant toohello existant Azure AD Connect serveur (avec LocalDB).</span><span class="sxs-lookup"><span data-stu-id="aada9-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="aada9-174">Pour obtenir des instructions sur comment tooconfigure SQL à distance avec Azure AD Connect, consultez tooarticle [installation personnalisée d’Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="aada9-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="aada9-175">Pour obtenir des instructions sur la migration de basculement pour la mise à niveau Azure AD Connect, consultez tooarticle [Azure AD Connect : mise à niveau à partir d’une précédente toohello de version plus récente](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="aada9-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="aada9-176">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="aada9-176">Next steps</span></span>
<span data-ttu-id="aada9-177">En savoir plus sur l’ [intégration de vos identités locales avec Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="aada9-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
