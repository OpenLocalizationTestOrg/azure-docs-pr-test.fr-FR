---
title: "Authentification unique avec le proxy d’application | Microsoft Docs"
description: "Explique comment fournir l’authentification unique à l’aide du proxy d’application Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 149af1f68e574f78127a9c2de8a0e79ed8774d29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-to-your-apps-with-application-proxy"></a><span data-ttu-id="4e00d-103">Délégation contrainte Kerberos pour l’authentification unique à vos applications avec le proxy d’application</span><span class="sxs-lookup"><span data-stu-id="4e00d-103">Kerberos Constrained Delegation for single sign-on to your apps with Application Proxy</span></span>

<span data-ttu-id="4e00d-104">Vous pouvez fournir l’authentification unique pour les applications locales publiées via le proxy d’application et sécurisées avec l’authentification Windows intégrée.</span><span class="sxs-lookup"><span data-stu-id="4e00d-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="4e00d-105">L’accès à ces applications nécessitent un ticket Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4e00d-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="4e00d-106">Le proxy d’application utilise la délégation Kerberos contrainte(KCD) pour prendre en charge ces applications.</span><span class="sxs-lookup"><span data-stu-id="4e00d-106">Application Proxy uses Kerberos Constrained Delegation (KCD) to support these applications.</span></span> 

<span data-ttu-id="4e00d-107">Vous pouvez activer l’authentification unique pour vos applications avec l’authentification Windows intégrée en attribuant aux connecteurs du proxy d’application dans Active Directory l’autorisation d’emprunter l’identité des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4e00d-107">You can enable single sign-on to your applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory to impersonate users.</span></span> <span data-ttu-id="4e00d-108">Les connecteurs utilisent cette autorisation pour envoyer et recevoir des jetons en leur nom.</span><span class="sxs-lookup"><span data-stu-id="4e00d-108">The connectors use this permission to send and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="4e00d-109">Fonctionnement de l’authentification unique avec KCD</span><span class="sxs-lookup"><span data-stu-id="4e00d-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="4e00d-110">Ce diagramme explique le flux quand un utilisateur tente d’accéder à une application locale qui utilise I’authentification Windows intégrée.</span><span class="sxs-lookup"><span data-stu-id="4e00d-110">This diagram explains the flow when a user attempts to access an on-prem application that uses IWA.</span></span>

![Diagramme de flux de l’authentification Microsoft AAD](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="4e00d-112">L’utilisateur entre l’URL pour accéder à l’application locale via le proxy d’application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-112">The user enters the URL to access the on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="4e00d-113">Le proxy d’application redirige la demande vers les services d’authentification d’Azure AD pour effectuer la préauthentification.</span><span class="sxs-lookup"><span data-stu-id="4e00d-113">Application Proxy redirects the request to Azure AD authentication services to preauthenticate.</span></span> <span data-ttu-id="4e00d-114">À ce stade, Azure AD applique les stratégies d’authentification et d’autorisation applicables, comme l’authentification multifacteur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="4e00d-115">Si l’utilisateur est validé, Azure AD crée un jeton et l’envoie à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-115">If the user is validated, Azure AD creates a token and sends it to the user.</span></span>
3. <span data-ttu-id="4e00d-116">L’utilisateur transmet le jeton au proxy d’application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-116">The user passes the token to Application Proxy.</span></span>
4. <span data-ttu-id="4e00d-117">Le proxy d’application valide le jeton et y récupère le nom d’utilisateur principal (UPN), puis envoie la demande, l’UPN et le nom de principal du service (SPN) au connecteur via un canal sécurisé doublement authentifié.</span><span class="sxs-lookup"><span data-stu-id="4e00d-117">Application Proxy validates the token and retrieves the User Principal Name (UPN) from it, and then sends the request, the UPN, and the Service Principal Name (SPN) to the Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="4e00d-118">Le connecteur effectue une négociation de délégation Kerberos contrainte avec Active Directory local, en empruntant l’identité de l’utilisateur pour obtenir un jeton Kerberos pour l’application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-118">The Connector performs Kerberos Constrained Delegation (KCD) negotiation with the on-prem AD, impersonating the user to get a Kerberos token to the application.</span></span>
6. <span data-ttu-id="4e00d-119">Active Directory envoie le jeton Kerberos de l’application au connecteur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-119">Active Directory sends the Kerberos token for the application to the Connector.</span></span>
7. <span data-ttu-id="4e00d-120">Le connecteur envoie la demande d’origine au serveur d’applications, en utilisant le jeton Kerberos reçu d’Active Directory.</span><span class="sxs-lookup"><span data-stu-id="4e00d-120">The Connector sends the original request to the application server, using the Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="4e00d-121">L’application envoie la réponse au connecteur, qui est ensuite retournée au service de proxy d’application et enfin à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-121">The application sends the response to the Connector, which is then returned to the Application Proxy service and finally to the user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="4e00d-122">Composants requis</span><span class="sxs-lookup"><span data-stu-id="4e00d-122">Prerequisites</span></span>
<span data-ttu-id="4e00d-123">Avant de commencer avec l’authentification unique pour les applications IWA, assurez-vous que votre environnement est prêt à l’aide des configurations et paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="4e00d-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with the following settings and configurations:</span></span>

* <span data-ttu-id="4e00d-124">Vos applications, comme les applications web SharePoint, sont configurées pour utiliser l’authentification Windows intégrée.</span><span class="sxs-lookup"><span data-stu-id="4e00d-124">Your apps, like SharePoint Web apps, are set to use Integrated Windows Authentication.</span></span> <span data-ttu-id="4e00d-125">Pour plus d’informations, consultez [Activer la prise en charge de l’authentification Kerberos](https://technet.microsoft.com/library/dd759186.aspx) ou, pour SharePoint, consultez [Planifier l’authentification Kerberos dans SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="4e00d-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="4e00d-126">Toutes vos applications disposent de [Noms de principal du service](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="4e00d-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="4e00d-127">Le serveur exécutant le connecteur et le serveur exécutant l’application sont joints au domaine et font partie du même domaine ou de domaines sécurisés.</span><span class="sxs-lookup"><span data-stu-id="4e00d-127">The server running the Connector and the server running the app are domain joined and part of the same domain or trusting domains.</span></span> <span data-ttu-id="4e00d-128">Pour plus d’informations sur la jonction à un domaine, consultez [Joindre un ordinateur à un domaine](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="4e00d-128">For more information on domain join, see [Join a Computer to a Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="4e00d-129">Le serveur exécutant le connecteur est autorisé à lire l’attribut TokenGroupsGlobalAndUniversal pour les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4e00d-129">The server running the Connector has access to read the TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="4e00d-130">Ce paramètre par défaut peut avoir été affecté par la sécurisation renforcée de l’environnement.</span><span class="sxs-lookup"><span data-stu-id="4e00d-130">This default setting might have been impacted by security hardening the environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="4e00d-131">Configurer Active Directory</span><span class="sxs-lookup"><span data-stu-id="4e00d-131">Configure Active Directory</span></span>
<span data-ttu-id="4e00d-132">La configuration d’Active Directory varie selon que votre connecteur de proxy d’application et le serveur d’application sont dans le même domaine ou non.</span><span class="sxs-lookup"><span data-stu-id="4e00d-132">The Active Directory configuration varies, depending on whether your Application Proxy connector and the application server are in the same domain or not.</span></span>

#### <a name="connector-and-application-server-in-the-same-domain"></a><span data-ttu-id="4e00d-133">Le connecteur et le serveur d’application sont dans le même domaine</span><span class="sxs-lookup"><span data-stu-id="4e00d-133">Connector and application server in the same domain</span></span>
1. <span data-ttu-id="4e00d-134">Dans Active Directory, accédez à **Outils** > **Utilisateurs et ordinateurs**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-134">In Active Directory, go to **Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="4e00d-135">Sélectionnez le serveur exécutant le connecteur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-135">Select the server running the connector.</span></span>
3. <span data-ttu-id="4e00d-136">Cliquez avec le bouton droit, puis sélectionnez **Properties** > **Délégation**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="4e00d-137">Sélectionnez **N’approuver cet ordinateur que pour la délégation aux services spécifiés**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-137">Select **Trust this computer for delegation to specified services only**.</span></span> 
5. <span data-ttu-id="4e00d-138">Sous **Services auxquels ce compte peut présenter des informations d’identification déléguées**, ajoutez la valeur de l’identité du nom de principal du service (SPN) du serveur d’applications.</span><span class="sxs-lookup"><span data-stu-id="4e00d-138">Under **Services to which this account can present delegated credentials** add the value for the SPN identity of the application server.</span></span> <span data-ttu-id="4e00d-139">Ceci permet au connecteur de proxy d’application d’emprunter l’identité des utilisateurs dans Active Directory pour les applications définies dans la liste.</span><span class="sxs-lookup"><span data-stu-id="4e00d-139">This enables the Application Proxy Connector to impersonate users in AD against the applications defined in the list.</span></span>

   ![Capture d’écran de la fenêtre Propriétés du connecteur-SVR](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="4e00d-141">Le connecteur et le serveur d’application sont dans des domaines différents</span><span class="sxs-lookup"><span data-stu-id="4e00d-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="4e00d-142">Pour obtenir la liste des conditions préalables à l’utilisation de la délégation Kerberos contrainte entre domaines, consultez [Délégation Kerberos contrainte entre domaines](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="4e00d-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="4e00d-143">Utilisez la propriété `principalsallowedtodelegateto` du serveur de connecteur pour activer le proxy d’application à déléguer pour le serveur de connecteur.</span><span class="sxs-lookup"><span data-stu-id="4e00d-143">Use the `principalsallowedtodelegateto` property on the Connector server to enable the Application Proxy to delegate for the Connector server.</span></span> <span data-ttu-id="4e00d-144">Le serveur d’application est `sharepointserviceaccount` et le serveur qui délègue est `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="4e00d-144">The application server is `sharepointserviceaccount` and the delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="4e00d-145">Pour Windows 2012 R2, utilisez ce code comme exemple :</span><span class="sxs-lookup"><span data-stu-id="4e00d-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="4e00d-146">Le Sharepointserviceaccount peut être le compte de la machine SPS ou un compte de service dans lequel s’exécute le pool d’applications SPS.</span><span class="sxs-lookup"><span data-stu-id="4e00d-146">Sharepointserviceaccount can be the SPS machine account or a service account under which the SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="4e00d-147">Configurer l’authentification unique</span><span class="sxs-lookup"><span data-stu-id="4e00d-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="4e00d-148">Publiez votre application en suivant les instructions décrites dans [Publier des applications avec le proxy d’application](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="4e00d-148">Publish your application according to the instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="4e00d-149">Veillez à sélectionner **Azure Active Directory** comme **méthode de préauthentification**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-149">Make sure to select **Azure Active Directory** as the **Preauthentication Method**.</span></span>
2. <span data-ttu-id="4e00d-150">Dès que votre application apparaît dans la liste des applications d’entreprise, sélectionnez-la, puis cliquez sur **Authentification unique**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-150">After your application appears in the list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="4e00d-151">Définissez le mode d’authentification unique sur **Authentification Windows intégrée**.</span><span class="sxs-lookup"><span data-stu-id="4e00d-151">Set the single sign-on mode to **Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="4e00d-152">Entrez le **SPN d’application interne** du serveur d’applications.</span><span class="sxs-lookup"><span data-stu-id="4e00d-152">Enter the **Internal Application SPN** of the application server.</span></span> <span data-ttu-id="4e00d-153">Dans cet exemple, le nom de principal du service pour notre application publiée est http/www.contoso.com. Ce SPN doit se trouver dans la liste des services auxquels le connecteur peut présenter des informations d’identification déléguées.</span><span class="sxs-lookup"><span data-stu-id="4e00d-153">In this example, the SPN for our published application is http/www.contoso.com. This SPN needs to be in the list of services to which the connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="4e00d-154">Choisissez l’**Identité de connexion déléguée** pour le connecteur à utiliser pour le compte de vos utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="4e00d-154">Choose the **Delegated Login Identity** for the connector to use on behalf of your users.</span></span> <span data-ttu-id="4e00d-155">Pour plus d’informations, consultez [Utilisation d’identités cloud et locales différentes](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="4e00d-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Configuration avancée des applications](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="4e00d-157">Authentification unique pour les applications non Windows</span><span class="sxs-lookup"><span data-stu-id="4e00d-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="4e00d-158">Le flux de délégation Kerberos dans le proxy d’application Azure AD démarre quand Azure AD authentifie l’utilisateur dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="4e00d-158">The Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates the user in the cloud.</span></span> <span data-ttu-id="4e00d-159">Une fois que la demande est disponible localement, le connecteur du proxy d’application AD Azure émet un ticket Kerberos pour le compte de l’utilisateur en interagissant avec le répertoire Active Directory local.</span><span class="sxs-lookup"><span data-stu-id="4e00d-159">Once the request arrives on-premises, the Azure AD Application Proxy connector issues a Kerberos ticket on behalf of the user by interacting with the local Active Directory.</span></span> <span data-ttu-id="4e00d-160">Ce processus est appelé délégation Kerberos contrainte (KCD).</span><span class="sxs-lookup"><span data-stu-id="4e00d-160">This process is referred to as Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="4e00d-161">Au cours de la phase suivante, une demande est envoyée à l’application principale avec ce ticket Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4e00d-161">In the next phase, a request is sent to the backend application with this Kerberos ticket.</span></span> <span data-ttu-id="4e00d-162">Plusieurs protocoles définissent la manière d’envoyer ces demandes.</span><span class="sxs-lookup"><span data-stu-id="4e00d-162">There are several protocols that define how to send such requests.</span></span> <span data-ttu-id="4e00d-163">La plupart des serveurs non Windows supposent qu’il s’agit de Negotiate/SPNego, qui est maintenant pris en charge sur le proxy d’application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="4e00d-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="4e00d-164">Pour plus d’informations sur Kerberos, consultez la page [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd) (Tout ce que vous voulez savoir sur Kerberos Constrained Delegation (KCD)).</span><span class="sxs-lookup"><span data-stu-id="4e00d-164">For more information about Kerberos, see [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="4e00d-165">Les applications non Windows utilisent en général les noms d’utilisateur ou les noms de compte SAM au lieu des adresses e-mail de domaine.</span><span class="sxs-lookup"><span data-stu-id="4e00d-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="4e00d-166">Si cette situation s’applique à vos applications, vous devez configurer le champ d’identité de connexion déléguée pour connecter vos identités cloud à vos identités d’application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-166">If that situation applies to your applications, you need to configure the delegated login identity field to connect your cloud identities to your application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="4e00d-167">Utilisation d’identités cloud et locales différentes</span><span class="sxs-lookup"><span data-stu-id="4e00d-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="4e00d-168">Le proxy d’application suppose que les utilisateurs ont exactement la même identité dans le cloud et localement.</span><span class="sxs-lookup"><span data-stu-id="4e00d-168">Application Proxy assumes that users have exactly the same identity in the cloud and on-premises.</span></span> <span data-ttu-id="4e00d-169">Dans le cas contraire, vous pouvez toujours utiliser KCD pour l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="4e00d-169">If that's not the case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="4e00d-170">Configurez une **Identité de connexion déléguée** pour chaque application afin de spécifier l’identité qui doit être utilisée pendant l’exécution d’une authentification unique.</span><span class="sxs-lookup"><span data-stu-id="4e00d-170">Configure a **Delegated login identity** for each application to specify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="4e00d-171">Grâce à cette fonctionnalité, de nombreuses organisations disposant d’identités locales et cloud différentes peuvent mettre en œuvre l’authentification unique des applications cloud aux applications locales sans contraindre les utilisateurs à entrer des noms d’utilisateur et des mots de passe différents.</span><span class="sxs-lookup"><span data-stu-id="4e00d-171">This capability allows many organizations that have different on-premises and cloud identities to have SSO from the cloud to on-premises apps without requiring the users to enter different usernames and passwords.</span></span> <span data-ttu-id="4e00d-172">Cela inclut les organisations qui :</span><span class="sxs-lookup"><span data-stu-id="4e00d-172">This includes organizations that:</span></span>

* <span data-ttu-id="4e00d-173">disposent de plusieurs domaines en interne (joe@us.contoso.com, joe@eu.contoso.com) et d’un domaine unique dans le cloud (joe@contoso.com) ;</span><span class="sxs-lookup"><span data-stu-id="4e00d-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in the cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="4e00d-174">disposent d’un nom de domaine non routable en interne (joe@contoso.usa) et d’un nom de domaine légal dans le cloud ;</span><span class="sxs-lookup"><span data-stu-id="4e00d-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in the cloud.</span></span>
* <span data-ttu-id="4e00d-175">n’utilisent pas de noms de domaine en interne (joe) ;</span><span class="sxs-lookup"><span data-stu-id="4e00d-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="4e00d-176">utilisent différents alias localement et dans le cloud,</span><span class="sxs-lookup"><span data-stu-id="4e00d-176">Use different aliases on-prem and in the cloud.</span></span> <span data-ttu-id="4e00d-177">Par exemple, joe-johns@contoso.com et joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="4e00d-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="4e00d-178">Avec le proxy d’application, vous pouvez sélectionner l’identité à utiliser pour obtenir le ticket Kerberos.</span><span class="sxs-lookup"><span data-stu-id="4e00d-178">With Application Proxy, you can select which identity to use to obtain the Kerberos ticket.</span></span> <span data-ttu-id="4e00d-179">Ce paramètre est à configurer application par application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-179">This setting is per application.</span></span> <span data-ttu-id="4e00d-180">Certaines de ces options sont adaptées pour les systèmes qui n’acceptent pas le format d’adresse de messagerie, tandis que d’autres sont conçues pour les connexions alternatives.</span><span class="sxs-lookup"><span data-stu-id="4e00d-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Capture d’écran du paramètre Identité de connexion déléguée](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="4e00d-182">Si l’identité de connexion déléguée est utilisée, il se peut que la valeur ne soit pas la même pour l’ensemble des domaines ou forêts de votre organisation.</span><span class="sxs-lookup"><span data-stu-id="4e00d-182">If delegated login identity is used, the value might not be unique across all the domains or forests in your organization.</span></span> <span data-ttu-id="4e00d-183">Vous pouvez éviter ce problème en publiant ces applications deux fois à l’aide de deux groupes de connecteurs différents.</span><span class="sxs-lookup"><span data-stu-id="4e00d-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="4e00d-184">Dans la mesure où chaque application possède sa propre audience utilisateur, vous pouvez joindre ses connecteurs à un autre domaine.</span><span class="sxs-lookup"><span data-stu-id="4e00d-184">Since each application has a different user audience, you can join its Connectors to a different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="4e00d-185">Configuration de l’authentification unique pour différentes identités</span><span class="sxs-lookup"><span data-stu-id="4e00d-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="4e00d-186">Configurez les paramètres Azure AD Connect de manière à ce que l’identité principale soit l’adresse de messagerie (courrier).</span><span class="sxs-lookup"><span data-stu-id="4e00d-186">Configure Azure AD Connect settings so the main identity is the email address (mail).</span></span> <span data-ttu-id="4e00d-187">Cette opération est effectuée dans le cadre du processus de personnalisation, en modifiant le champ **Nom d’utilisateur principal** dans les paramètres de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="4e00d-187">This is done as part of the customize process, by changing the **User Principal Name** field in the sync settings.</span></span> <span data-ttu-id="4e00d-188">Ces paramètres déterminent également comment les utilisateurs se connectent à Office 365, aux appareils Windows 10 et autres applications qui utilisent Azure AD comme magasin d’identités.</span><span class="sxs-lookup"><span data-stu-id="4e00d-188">These settings also determine how users log in to Office365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="4e00d-189">![Capture d’écran de l’identification des utilisateurs : liste déroulante Nom d’utilisateur principal](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="4e00d-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="4e00d-190">Dans les paramètres de configuration de l’application à modifier, sélectionnez l’ **Identité de connexion déléguée** à utiliser :</span><span class="sxs-lookup"><span data-stu-id="4e00d-190">In the Application Configuration settings for the application you would like to modify, select the **Delegated Login Identity** to be used:</span></span>

   * <span data-ttu-id="4e00d-191">Nom d’utilisateur principal (par exemple, joe@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="4e00d-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="4e00d-192">Nom d’utilisateur principal alternatif (par exemple, joed@contoso.local)</span><span class="sxs-lookup"><span data-stu-id="4e00d-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="4e00d-193">Partie correspondant au nom d’utilisateur dans le nom d’utilisateur principal (par exemple, joe)</span><span class="sxs-lookup"><span data-stu-id="4e00d-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="4e00d-194">Partie correspondant au nom d’utilisateur dans le nom d’utilisateur principal alternatif (par exemple, joed)</span><span class="sxs-lookup"><span data-stu-id="4e00d-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="4e00d-195">Nom du compte SAM local (en fonction de la configuration du contrôleur de domaine)</span><span class="sxs-lookup"><span data-stu-id="4e00d-195">On-premises SAM account name (depends on the domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="4e00d-196">Résolution des problèmes liés à l’authentification unique pour différentes identités</span><span class="sxs-lookup"><span data-stu-id="4e00d-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="4e00d-197">Si une erreur se produit dans le processus d’authentification unique, elle apparaît dans le journal des événements d’ordinateur du connecteur, comme expliqué dans la section [Résolution des problèmes](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="4e00d-197">If there is an error in the SSO process, it appears in the connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="4e00d-198">Toutefois, dans certains cas, la demande est correctement envoyée à l’application principale, mais celle-ci répond dans plusieurs réponses HTTP.</span><span class="sxs-lookup"><span data-stu-id="4e00d-198">But, in some cases, the request is successfully sent to the backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="4e00d-199">Pour résoudre ces cas, il faut tout d’abord examiner le numéro d’événement 24029 sur l’ordinateur connecteur dans le journal des événements de session du proxy d’application.</span><span class="sxs-lookup"><span data-stu-id="4e00d-199">Troubleshooting these cases should start by examining event number 24029 on the connector machine in the Application Proxy session event log.</span></span> <span data-ttu-id="4e00d-200">L’identité de l’utilisateur qui a été utilisée pour la délégation s’affiche dans le champ « utilisateur » dans les détails de l’événement.</span><span class="sxs-lookup"><span data-stu-id="4e00d-200">The user identity that was used for delegation appears in the “user” field within the event details.</span></span> <span data-ttu-id="4e00d-201">Pour activer le journal de session, sélectionnez **Afficher les journaux d’analyse et de débogage** dans le menu Affichage de l’Observateur d’événements.</span><span class="sxs-lookup"><span data-stu-id="4e00d-201">To turn on session log, select **Show analytic and debug logs** in the event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4e00d-202">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="4e00d-202">Next steps</span></span>

* [<span data-ttu-id="4e00d-203">Comment configurer une application de proxy d’application pour utiliser la délégation Kerberos contrainte ?</span><span class="sxs-lookup"><span data-stu-id="4e00d-203">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="4e00d-204">Résoudre les problèmes rencontrés avec le proxy d’application</span><span class="sxs-lookup"><span data-stu-id="4e00d-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="4e00d-205">Pour les dernières nouvelles et mises à jour, visitez [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="4e00d-205">For the latest news and updates, check out the [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>

