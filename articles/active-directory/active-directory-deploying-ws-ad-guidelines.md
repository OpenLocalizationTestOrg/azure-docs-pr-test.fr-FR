---
title: "Recommandations en matière de déploiement de Windows Server Active Directory sur des machines virtuelles Azure | Microsoft Docs"
description: "Si vous savez comment déployer des services de domaine AD et des services de fédération AD localement, découvrez comment ils fonctionnent sur des machines virtuelles Azure."
services: active-directory
documentationcenter: 
author: femila
manager: femila
editor: 
ms.assetid: 04df4c46-e6b6-4754-960a-57b823d617fa
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 07/26/2017
ms.author: femila
ms.openlocfilehash: 342d9e2787add3d04f1b744152e135db98848179
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="guidelines-for-deploying-windows-server-active-directory-on-azure-virtual-machines"></a><span data-ttu-id="c1f13-103">Recommandations en matière de déploiement de Windows Server Active Directory sur des machines virtuelles Windows Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-103">Guidelines for deploying Windows Server Active Directory on Azure virtual machines</span></span>
<span data-ttu-id="c1f13-104">Cet article présente les principales différences d’un déploiement en local des services de domaine Windows Server Active Directory (AD DS) et des services de fédération Active Directory (AD FS) par rapport à un déploiement des mêmes outils sur des machines virtuelles Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-104">This article explains the important differences between deploying Windows Server Active Directory Domain Services (AD DS) and Active Directory Federation Services (AD FS) on-premises versus deploying them on Microsoft Azure virtual machines.</span></span>

## <a name="scope-and-audience"></a><span data-ttu-id="c1f13-105">Portée et public ciblé</span><span class="sxs-lookup"><span data-stu-id="c1f13-105">Scope and audience</span></span>
<span data-ttu-id="c1f13-106">Cet article a été rédigé à l’attention des utilisateurs ayant déjà une expérience du déploiement d’Active Directory en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-106">The article is intended for those already experienced with deploying Active Directory on-premises.</span></span> <span data-ttu-id="c1f13-107">Il explique les différences entre un déploiement d’Active Directory sur des machines virtuelles Microsoft Azure ou sur des réseaux virtuels Azure et les déploiements traditionnels d’Active Directory en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-107">It covers the differences between deploying Active Directory on Microsoft Azure virtual machines/Azure virtual networks and traditional on-premises Active Directory deployments.</span></span> <span data-ttu-id="c1f13-108">Les machines virtuelles Azure et les réseaux virtuels Azure s’inscrivent dans le cadre d’une offre IaaS (Infrastructure-as-a-Service) qui permet aux organisations de tirer parti des ressources informatiques hébergées dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-108">Azure virtual machines and Azure virtual networks are part of an Infrastructure-as-a-Service (IaaS) offering for organizations to leverage computing resources in the cloud.</span></span>

<span data-ttu-id="c1f13-109">Si vous n’avez aucune expérience du déploiement d’Active Directory, consultez le document [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) (Guide de déploiement d’AD DS) ou l’article [Planifier votre déploiement AD FS](https://technet.microsoft.com/library/dn151324.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1f13-109">For those that are not familiar with AD deployment, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963) or [Plan your AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) as appropriate.</span></span>

<span data-ttu-id="c1f13-110">Pour suivre cet article, le lecteur doit être familiarisé avec les concepts suivants :</span><span class="sxs-lookup"><span data-stu-id="c1f13-110">This article assumes that the reader is familiar with the following concepts:</span></span>

* <span data-ttu-id="c1f13-111">Déploiement et gestion de Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="c1f13-111">Windows Server AD DS deployment and management</span></span>
* <span data-ttu-id="c1f13-112">Déploiement et configuration de DNS pour la prise en charge d’une infrastructure Windows Server AD DS</span><span class="sxs-lookup"><span data-stu-id="c1f13-112">Deployment and configuration of DNS to support a Windows Server AD DS infrastructure</span></span>
* <span data-ttu-id="c1f13-113">Déploiement et gestion de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="c1f13-113">Windows Server AD FS deployment and management</span></span>
* <span data-ttu-id="c1f13-114">Déploiement, configuration et gestion des applications par partie de confiance (sites et services web) qui consomment des jetons Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="c1f13-114">Deploying, configuring, and managing relying party applications (websites and web services) that can consume Windows Server AD FS tokens</span></span>
* <span data-ttu-id="c1f13-115">Concepts généraux d’une machine virtuelle, notamment la procédure de configuration d’une machine virtuelle, de disques virtuels et de réseaux virtuels</span><span class="sxs-lookup"><span data-stu-id="c1f13-115">General virtual machine concepts, such as how to configure a virtual machine, virtual disks, and virtual networks</span></span>

<span data-ttu-id="c1f13-116">Ce document présente les conditions requises pour un scénario de déploiement hybride dans lequel les services Windows Server AD FS ou AD DS sont déployés en partie localement et en partie sur des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-116">This article highlights the requirements for a hybrid deployment scenario in which Windows Server AD DS or AD FS are partly deployed on-premises and partly deployed on Azure virtual machines.</span></span> <span data-ttu-id="c1f13-117">Il examine d’abord les différences essentielles entre l’exécution de Windows Server AD DS et AD FS sur des machines virtuelles Azure et l’exécution des mêmes services en local, et décrit les choix importants susceptibles d’affecter la conception et le déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-117">The document first covers the critical differences between running Windows Server AD DS and AD FS on Azure virtual machines versus on-premises, and important decision points that affect design and deployment.</span></span> <span data-ttu-id="c1f13-118">Le reste du document décrit plus en détail les instructions qu’il convient de suivre pour chaque décision à prendre et explique comment appliquer les instructions à différents scénarios de déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-118">The rest of the paper explains guidelines for each of the decision points in more detail, and how to apply the guidelines to various deployment scenarios.</span></span>

<span data-ttu-id="c1f13-119">Cet article n’aborde pas la configuration d’ [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), un service REST qui offre des fonctionnalités de contrôle d’accès et de gestion des identités pour les applications cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-119">This article does not discuss the configuration of [Azure Active Directory](http://azure.microsoft.com/services/active-directory/), which is a REST-based service that provides identity management and access control capabilities for cloud applications.</span></span> <span data-ttu-id="c1f13-120">Azure Active Directory (Azure AD) et Windows Server AD DS sont toutefois conçus pour fonctionner conjointement afin de fournir une solution de gestion des identités et des accès pour les environnements informatiques hybrides et les applications modernes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-120">Azure Active Directory (Azure AD) and Windows Server AD DS are, however, designed to work together to provide an identity and access management solution for today’s hybrid IT environments and modern applications.</span></span> <span data-ttu-id="c1f13-121">Afin de mieux comprendre les différences et les relations entre Windows Server AD DS et Azure AD, tenez compte des remarques suivantes :</span><span class="sxs-lookup"><span data-stu-id="c1f13-121">To help understand the differences and relationships between Windows Server AD DS and Azure AD, consider the following:</span></span>

1. <span data-ttu-id="c1f13-122">Vous pouvez exécuter Windows Server AD DS dans le cloud sur des machines virtuelles lorsque vous utilisez Azure pour étendre votre centre de données local dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-122">You might run Windows Server AD DS in the cloud on Azure virtual machines when you are using Azure to extend your on-premises datacenter into the cloud.</span></span>
2. <span data-ttu-id="c1f13-123">Vous pouvez utiliser Azure AD pour fournir à vos utilisateurs une authentification unique aux applications SaaS (Software-as-a-Service).</span><span class="sxs-lookup"><span data-stu-id="c1f13-123">You might use Azure AD to give your users single sign-on to Software-as-a-Service (SaaS) applications.</span></span> <span data-ttu-id="c1f13-124">Microsoft Office 365, par exemple, fait appel à cette technologie, et les applications exécutées sous Azure ou d’autres plateformes cloud peuvent également y recourir.</span><span class="sxs-lookup"><span data-stu-id="c1f13-124">Microsoft Office 365 uses this technology, for example, and applications running on Azure or other cloud platforms can also use it.</span></span>
3. <span data-ttu-id="c1f13-125">Vous pouvez utiliser Azure AD (et son service de contrôle d’accès) pour permettre aux utilisateurs de se connecter en utilisant des identités Facebook, Google, Microsoft et d’autres fournisseurs d’identité dans les applications hébergées sur le cloud ou en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-125">You might use Azure AD (its Access Control Service) to let users sign in using identities from Facebook, Google, Microsoft, and other identity providers to applications that are hosted in the cloud or on-premises.</span></span>

<span data-ttu-id="c1f13-126">Pour plus d’informations sur ces différences, consultez l’article [Principes de base de la gestion des identités Azure](fundamentals-identity.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-126">For more information about these differences, see [Azure Identity](fundamentals-identity.md).</span></span>

## <a name="related-resources"></a><span data-ttu-id="c1f13-127">Ressources associées</span><span class="sxs-lookup"><span data-stu-id="c1f13-127">Related resources</span></span>
<span data-ttu-id="c1f13-128">Vous pouvez télécharger et exécuter l’outil [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span><span class="sxs-lookup"><span data-stu-id="c1f13-128">You may download and run the [Azure Virtual Machine Readiness Assessment](https://www.microsoft.com/download/details.aspx?id=40898).</span></span> <span data-ttu-id="c1f13-129">Cette évaluation inspecte automatiquement votre environnement local et génère un rapport personnalisé tenant compte des conseils décrits dans cette rubrique afin de vous aider à migrer votre environnement vers Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-129">The assessment will automatically inspect your on-premises environment and generate a customized report based on the guidance found in this topic to help you migrate the environment to Azure.</span></span>

<span data-ttu-id="c1f13-130">Nous vous recommandons également de consulter les didacticiels, guides et vidéos sur les thèmes suivants :</span><span class="sxs-lookup"><span data-stu-id="c1f13-130">We recommend that you also first review the tutorials, guides, and videos that cover the following topics:</span></span>

* [<span data-ttu-id="c1f13-131">Configuration d’un réseau virtuel sur le cloud uniquement dans le portail Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-131">Configure a Cloud-Only Virtual Network in the Azure Portal</span></span>](../virtual-network/virtual-networks-create-vnet-arm-pportal.md)
* [<span data-ttu-id="c1f13-132">Configuration d’un VPN de site à site dans le portail Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-132">Configure a Site-to-Site VPN in the Azure Portal</span></span>](../vpn-gateway/vpn-gateway-site-to-site-create.md)
* [<span data-ttu-id="c1f13-133">Installer une nouvelle forêt Active Directory sur un réseau virtuel Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-133">Install a new Active Directory forest on an Azure virtual network</span></span>](active-directory-new-forest-virtual-machine.md)
* [<span data-ttu-id="c1f13-134">Installation d’un contrôleur de domaine Active Directory de réplication dans un réseau virtuel Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-134">Install a replica Active Directory domain controller on Azure</span></span>](active-directory-install-replica-active-directory-domain-controller.md)
* [<span data-ttu-id="c1f13-135">Iaas des professionnels de l’informatique Microsoft Azure : principes de base des machines virtuelles (01)</span><span class="sxs-lookup"><span data-stu-id="c1f13-135">Microsoft Azure IT Pro IaaS: (01) Virtual Machine Fundamentals</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/01)
* [<span data-ttu-id="c1f13-136">Iaas des professionnels de l’informatique Microsoft Azure :(05) Création de réseaux virtuels pour la connectivité entre différents locaux</span><span class="sxs-lookup"><span data-stu-id="c1f13-136">Microsoft Azure IT Pro IaaS: (05) Creating Virtual Networks and Cross-Premises Connectivity</span></span>](https://channel9.msdn.com/Series/Windows-Azure-IT-Pro-IaaS/05)

## <a name="introduction"></a><span data-ttu-id="c1f13-137">Introduction</span><span class="sxs-lookup"><span data-stu-id="c1f13-137">Introduction</span></span>
<span data-ttu-id="c1f13-138">Les exigences fondamentales de déploiement de Windows Server Active Directory sur des machines virtuelles Azure diffèrent peu d’un déploiement sur des machines virtuelles (et, dans une certaine mesure, sur des ordinateurs physiques) en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-138">The fundamental requirements for deploying Windows Server Active Directory on Azure virtual machines differ very little from deploying it in on-premises virtual machines (and, to some extent, physical machines).</span></span> <span data-ttu-id="c1f13-139">Par exemple, dans le cas de Windows Server AD DS, si les contrôleurs de domaine déployés sur des machines virtuelles Azure sont des réplicas d’un domaine et/ou d’une forêt d’entreprise existants en local, le déploiement d’Azure peut alors être abordé de la même façon que n’importe quel autre site Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-139">For example, in the case of Windows Server AD DS, if the domain controllers (DCs) that you deploy on Azure virtual machines are replicas in an existing on-premises corporate domain/forest, then the Azure deployment can largely be treated in the same way as you might treat any other additional Windows Server Active Directory site.</span></span> <span data-ttu-id="c1f13-140">Autrement dit, vous devez définir des sous-réseaux dans Windows Server AD DS, créer un site, lier les sous-réseaux à ce site et les connecter à d’autres sites via les liaisons de sites appropriées.</span><span class="sxs-lookup"><span data-stu-id="c1f13-140">That is, subnets must be defined in Windows Server AD DS, a site created, the subnets linked to that site, and connected to other sites using appropriate site-links.</span></span> <span data-ttu-id="c1f13-141">Il existe toutefois certaines différences communes à l’ensemble des déploiements Azure, dont certaines varient selon le scénario de déploiement spécifique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-141">There are, however, some differences that are common to all Azure deployments and some that vary according to the specific deployment scenario.</span></span> <span data-ttu-id="c1f13-142">Deux différences fondamentales sont décrites ci-après :</span><span class="sxs-lookup"><span data-stu-id="c1f13-142">Two fundamental differences are outlined below:</span></span>

### <a name="azure-virtual-machines-may-need-connectivity-to-the-on-premises-corporate-network"></a><span data-ttu-id="c1f13-143">Les machines virtuelles Azure auront peut-être besoin d’un accès au réseau local d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-143">Azure virtual machines may need connectivity to the on-premises corporate network.</span></span>
<span data-ttu-id="c1f13-144">La reconnexion des machines virtuelles Azure à un réseau d’entreprise local nécessite un réseau virtuel Azure, lequel comprend un composant de réseau privé virtuel (VPN) site à site ou site à point capable de connecter de façon transparente les machines virtuelles Azure et les ordinateurs locaux.</span><span class="sxs-lookup"><span data-stu-id="c1f13-144">Connecting Azure virtual machines back to an on-premises corporate network requires Azure virtual network, which includes a site-to-site or site-to-point virtual private network (VPN) component able to seamlessly connect Azure virtual machines and on-premises machines.</span></span> <span data-ttu-id="c1f13-145">Ce composant VPN peut également permettre aux ordinateurs membres du domaine local d’accéder à un domaine Windows Server Active Directory dont les contrôleurs de domaine sont hébergés exclusivement sur des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-145">This VPN component could also enable on-premises domain member computers to access a Windows Server Active Directory domain whose domain controllers are hosted exclusively on Azure virtual machines.</span></span> <span data-ttu-id="c1f13-146">Il est toutefois important de noter qu’un échec du VPN entraînera également l’échec de l’authentification et des autres opérations qui dépendent de Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-146">It is important to note, though, that if the VPN fails, authentication and other operations that depend on Windows Server Active Directory will also fail.</span></span> <span data-ttu-id="c1f13-147">Bien que les utilisateurs puissent se connecter à l’aide des informations d’identification existantes mises en cache, aucune tentative d’authentification d’égal à égal ou de client à serveur pour laquelle des tickets doivent être émis ou sont obsolètes ne pourra aboutir.</span><span class="sxs-lookup"><span data-stu-id="c1f13-147">While users may be able to sign in using existing cached credentials, all peer-to-peer or client-to-server authentication attempts for which tickets have yet to be issued or have become stale will fail.</span></span>

<span data-ttu-id="c1f13-148">Consultez la page [Réseau virtuel](http://azure.microsoft.com/documentation/services/virtual-network/) pour obtenir une vidéo de démonstration et une liste de didacticiels pas à pas, notamment pour savoir [configurer un VPN de site à site dans le portail Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-148">See [Virtual Network](http://azure.microsoft.com/documentation/services/virtual-network/) for a demonstration video and a list of step-by-step tutorials, including [Configure a Site-to-Site VPN in the Azure portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-149">Vous pouvez également déployer Windows Server Active Directory sur un réseau virtuel Azure qui ne dispose pas d’accès à un réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-149">You can also deploy Windows Server Active Directory on an Azure virtual network that does not have connectivity with an on-premises network.</span></span> <span data-ttu-id="c1f13-150">Cependant, les instructions de cette rubrique impliquent l’utilisation d’un réseau virtuel Azure, car il intègre les fonctions d’adressage IP indispensables à Windows Server.</span><span class="sxs-lookup"><span data-stu-id="c1f13-150">The guidelines in this topic, however, assume that an Azure virtual network is used because it provides IP addressing capabilities that are essential to Windows Server.</span></span>
> 
> 

### <a name="static-ip-addresses-must-be-configured-with-azure-powershell"></a><span data-ttu-id="c1f13-151">Les adresses IP doivent être configurées à l’aide d’Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c1f13-151">Static IP addresses must be configured with Azure PowerShell.</span></span>
<span data-ttu-id="c1f13-152">Les adresses dynamiques sont allouées par défaut, mais vous pouvez utiliser l’applet de commande Set-AzureStaticVNetIP pour attribuer une adresse IP statique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-152">Dynamic addresses are allocated by default, but use the Set-AzureStaticVNetIP cmdlet to assign a static IP address instead.</span></span> <span data-ttu-id="c1f13-153">Cette applet de commande définit une adresse IP statique qui persistera pendant la réparation de service et l’arrêt/le redémarrage de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-153">That sets a static IP address that will persist through service healing and VM shutdown/restart.</span></span> <span data-ttu-id="c1f13-154">Pour plus d’informations, consultez [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)(Adresse IP interne statique pour les machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="c1f13-154">For more information, see [Static internal IP address for virtual machines](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/).</span></span>

## <span data-ttu-id="c1f13-155"><a name="BKMK_Glossary"></a>Termes et définitions</span><span class="sxs-lookup"><span data-stu-id="c1f13-155"><a name="BKMK_Glossary"></a>Terms and definitions</span></span>
<span data-ttu-id="c1f13-156">Voici une liste non exhaustive de termes référencés dans le présent article concernant diverses technologies Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-156">The following is a non-exhaustive list of terms for various Azure technologies which will be referenced in this article.</span></span>

* <span data-ttu-id="c1f13-157">**Machines virtuelles Azure**: offre IaaS dans Azure qui permet aux clients de déployer des machines virtuelles exécutant pratiquement n’importe quelle charge de travail classique de serveur local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-157">**Azure virtual machines**: The IaaS offering in Azure that allows customers to deploy VMs running nearly any traditionally on-premises server workload.</span></span>
* <span data-ttu-id="c1f13-158">**Réseau virtuel Azure**: service de mise en réseau dans Azure qui permet aux clients de créer et gérer des réseaux virtuels dans Azure et de les associer en toute sécurité à leur propre infrastructure réseau locale à l’aide d’un réseau privé virtuel (VPN).</span><span class="sxs-lookup"><span data-stu-id="c1f13-158">**Azure virtual network**: The networking service in Azure that lets customers create and manage virtual networks in Azure and securely link them to their own on-premises networking infrastructure by using a virtual private network (VPN).</span></span>
* <span data-ttu-id="c1f13-159">**Adresse IP virtuelle**: adresse IP Internet qui n’est pas liée à un ordinateur ou à une carte d’interface réseau spécifique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-159">**Virtual IP address**: An internet-facing IP address that is not bound to a specific computer or network interface card.</span></span> <span data-ttu-id="c1f13-160">Une adresse IP virtuelle est allouée aux services cloud pour leur permettre de recevoir le trafic réseau qui est redirigé vers une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-160">Cloud services are assigned a virtual IP address for receiving network traffic which is redirected to an Azure VM.</span></span> <span data-ttu-id="c1f13-161">Une adresse IP virtuelle est une propriété d’un service cloud qui contient une ou plusieurs machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-161">A virtual IP address is a property of a cloud-service which can contain one or more Azure virtual machines.</span></span> <span data-ttu-id="c1f13-162">Notez également qu’un réseau virtuel Azure peut contenir un ou plusieurs services cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-162">Also note that an Azure virtual network can contain one or more cloud-services.</span></span> <span data-ttu-id="c1f13-163">Les adresses IP virtuelles fournissent des fonctions d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-163">Virtual IP addresses provide native load-balancing capabilities.</span></span>
* <span data-ttu-id="c1f13-164">**Adresse IP dynamique**: adresse IP utilisée uniquement en interne.</span><span class="sxs-lookup"><span data-stu-id="c1f13-164">**Dynamic IP address**: This is the IP address that is internal only.</span></span> <span data-ttu-id="c1f13-165">Elle doit être configurée comme adresse IP statique (à l’aide de l’applet de commande Set-AzureStaticVNetIP) pour les machines virtuelles hébergeant les rôles de serveur DC/DNS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-165">It should be configured as a static IP address (by using the Set-AzureStaticVNetIP cmdlet) for VMs that host the DC/DNS server roles.</span></span>
* <span data-ttu-id="c1f13-166">**Réparation de service**: processus au cours duquel Azure restaure automatiquement l’état d’exécution d’un service après avoir détecté un échec du service.</span><span class="sxs-lookup"><span data-stu-id="c1f13-166">**Service healing**: The process in which Azure automatically returns a service to a running state again after it detects that the service has failed.</span></span> <span data-ttu-id="c1f13-167">La réparation de service représente un des aspects d’Azure au service de la disponibilité et de la résilience.</span><span class="sxs-lookup"><span data-stu-id="c1f13-167">Service healing is one of the aspects of Azure that supports availability and resiliency.</span></span> <span data-ttu-id="c1f13-168">Bien que cela soit peu probable, le résultat obtenu après un incident de réparation de service pour un contrôleur de domaine exécuté sur une machine virtuelle est semblable à un redémarrage non planifié, mais présente quelques inconvénients :</span><span class="sxs-lookup"><span data-stu-id="c1f13-168">While unlikely, the result following a service healing incident for a DC running on a VM is similar to an unplanned reboot, but has a few side-effects:</span></span>
  
  * <span data-ttu-id="c1f13-169">la carte réseau virtuelle de la machine virtuelle sera modifiée ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-169">The virtual network adapter in the VM will change</span></span>
  * <span data-ttu-id="c1f13-170">l’adresse MAC de la carte réseau virtuelle sera modifiée ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-170">The MAC address of the virtual network adapter will change</span></span>
  * <span data-ttu-id="c1f13-171">l’ID de processeur/unité centrale de la machine virtuelle sera modifié ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-171">The Processor/CPU ID of the VM will change</span></span>
  * <span data-ttu-id="c1f13-172">la configuration IP de la carte réseau virtuelle ne sera pas modifiée tant que la machine virtuelle est attachée à un réseau virtuel et que l’adresse IP de la machine virtuelle est statique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-172">The IP configuration of the virtual network adapter will not change as long as the VM is attached to a virtual network and the VM’s IP address is static.</span></span>
  
  <span data-ttu-id="c1f13-173">Aucun de ces comportements n’affecte Windows Server Active Directory puisqu’il n’existe aucune dépendance sur l’adresse MAC ou l’ID de processeur/unité centrale. En outre, il est recommandé d’exécuter tous les déploiements de Windows Server Active Directory sur un réseau virtuel Azure comme expliqué ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="c1f13-173">None of these behaviors affect Windows Server Active Directory because it has no dependency on the MAC address or Processor/CPU ID, and all Windows Server Active Directory deployments on Azure are recommended to be run on an Azure virtual network as outlined above.</span></span>

## <a name="is-it-safe-to-virtualize-windows-server-active-directory-domain-controllers"></a><span data-ttu-id="c1f13-174">La virtualisation de contrôleurs de domaine Windows Server Active Directory peut-elle s’effectuer en toute sécurité ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-174">Is it safe to virtualize Windows Server Active Directory domain controllers?</span></span>
<span data-ttu-id="c1f13-175">Le déploiement de contrôleurs de domaine Windows Server Active Directory sur des machines virtuelles Azure est soumis aux mêmes instructions que l’exécution de contrôleurs de domaine en local dans une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-175">Deploying Windows Server Active Directory DCs on Azure virtual machines is subject to the same guidelines as running DCs on-premises in a virtual machine.</span></span> <span data-ttu-id="c1f13-176">L’exécution de contrôleurs de domaine virtualisés constitue une pratique prudente tant que vous respectez les instructions de sauvegarde et de restauration des contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-176">Running virtualized DCs is a safe practice as long as guidelines for backing up and restoring DCs are followed.</span></span> <span data-ttu-id="c1f13-177">Pour plus d’informations sur les contraintes et les recommandations d’exécution des contrôleurs de domaine virtualisés, consultez la page [Exécution de contrôleurs de domaine dans Hyper-V](https://technet.microsoft.com/library/dd363553).</span><span class="sxs-lookup"><span data-stu-id="c1f13-177">For more information about constraints and guidelines for running virtualized DCs, see [Running Domain Controllers in Hyper-V](https://technet.microsoft.com/library/dd363553).</span></span>

<span data-ttu-id="c1f13-178">Les hyperviseurs fournissent ou banalisent les technologies susceptibles de poser problème pour plusieurs systèmes distribués, notamment Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-178">Hypervisors provide or trivialize technologies that can cause problems for many distributed systems, including Windows Server Active Directory.</span></span> <span data-ttu-id="c1f13-179">Par exemple, sur un serveur physique, vous pouvez cloner un disque ou utiliser des méthodes non prises en charge pour restaurer l’état d’un serveur, notamment en utilisant des SAN, mais il est beaucoup plus difficile d’effectuer cette opération sur un serveur physique que de restaurer un instantané de machine virtuelle dans un hyperviseur.</span><span class="sxs-lookup"><span data-stu-id="c1f13-179">For example, on a physical server, you can clone a disk or use unsupported methods to roll back the state of a server, including using SANs and so on, but doing that on a physical server is much harder than restoring a virtual machine snapshot in a hypervisor.</span></span> <span data-ttu-id="c1f13-180">Certaines fonctionnalités d’Azure peuvent entraîner les mêmes effets indésirables.</span><span class="sxs-lookup"><span data-stu-id="c1f13-180">Azure offers functionality that can result in the same undesirable condition.</span></span> <span data-ttu-id="c1f13-181">Par exemple, il est déconseillé de copier les fichiers VHD des contrôleurs de domaine au lieu d’effectuer des sauvegardes régulières, car leur restauration risque d’entraîner une situation semblable à l’utilisation des fonctionnalités de restauration d’instantané.</span><span class="sxs-lookup"><span data-stu-id="c1f13-181">For example, you should not copy VHD files of DCs instead of performing regular backups because restoring them can result in a similar situation to using snapshot restore features.</span></span>

<span data-ttu-id="c1f13-182">De telles restaurations introduisent des bulles USN qui peuvent provoquer un état définitivement divergent entre les contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-182">Such rollbacks introduce USN bubbles that can lead to permanently divergent states between DCs.</span></span> <span data-ttu-id="c1f13-183">Cela peut être la cause de divers problèmes, notamment :</span><span class="sxs-lookup"><span data-stu-id="c1f13-183">That can cause issues such as:</span></span>

* <span data-ttu-id="c1f13-184">des objets en attente ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-184">Lingering objects</span></span>
* <span data-ttu-id="c1f13-185">des mots de passe incohérents ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-185">Inconsistent passwords</span></span>
* <span data-ttu-id="c1f13-186">des valeurs d’attribut incohérentes ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-186">Inconsistent attribute values</span></span>
* <span data-ttu-id="c1f13-187">des incompatibilités de schéma si le contrôleur de schéma est restauré.</span><span class="sxs-lookup"><span data-stu-id="c1f13-187">Schema mismatches if the schema master is rolled back</span></span>

<span data-ttu-id="c1f13-188">Pour plus d’informations sur la manière dont les contrôleurs de domaine peuvent être affectés, consultez [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback)(USN et restauration d’USN).</span><span class="sxs-lookup"><span data-stu-id="c1f13-188">For more information about how DCs are impacted, see [USN and USN Rollback](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx#usn_and_usn_rollback).</span></span>

<span data-ttu-id="c1f13-189">Depuis Windows Server 2012, [des dispositifs de protection supplémentaires sont intégrés aux services AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1f13-189">Beginning with Windows Server 2012, [additional safeguards are built in to AD DS](https://technet.microsoft.com/library/hh831734.aspx).</span></span> <span data-ttu-id="c1f13-190">Ces dispositifs protègent les contrôleurs de domaine virtualisés contre les problèmes susmentionnés, à condition que la plateforme de l’hyperviseur sous-jacent prenne en charge VM-GenerationID.</span><span class="sxs-lookup"><span data-stu-id="c1f13-190">These safeguards help protect virtualized domain controllers against the aforementioned problems, as long as the underlying hypervisor platform supports VM-GenerationID.</span></span> <span data-ttu-id="c1f13-191">Azure prend en charge VM-GenerationID, ce qui signifie que les contrôleurs de domaine qui exécutent Windows Server 2012 ou version ultérieure sur des machines virtuelles Azure disposent de dispositifs de protection supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="c1f13-191">Azure supports VM-GenerationID, which means that domain controllers that run Windows Server 2012 or later on Azure virtual machines have the additional safeguards.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-192">Il est recommandé d’éteindre et redémarrer une machine virtuelle exécutant le rôle de contrôleur de domaine dans Azure depuis le système d’exploitation invité plutôt que d’utiliser l’option **Arrêter** du portail Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-192">You should shut down and restart a VM that runs the domain controller role in Azure within the guest operating system instead of using the **Shut Down** option in the Azure porta.</span></span> <span data-ttu-id="c1f13-193">Aujourd’hui, l’utilisation du portail pour arrêter une machine virtuelle a pour effet d’annuler l’allocation de cette dernière.</span><span class="sxs-lookup"><span data-stu-id="c1f13-193">Today, using the portal to shut down a VM causes the VM to be deallocated.</span></span> <span data-ttu-id="c1f13-194">Une machine virtuelle qui n’est plus allouée présente l’avantage de ne pas entraîner de frais ; pour autant, elle a pour effet de réinitialiser le VM-GenerationID, ce qui n’est pas souhaitable pour un contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-194">A deallocated VM has the advantage of not incurring charges, but it also resets the VM-GenerationID, which is undesirable for a DC.</span></span> <span data-ttu-id="c1f13-195">Lorsque le VM-GenerationID est réinitialisé, l’invocationID de la base de données AD DS est également réinitialisé, le pool RID est supprimé et SYSVOL est marqué comme ne faisant pas autorité.</span><span class="sxs-lookup"><span data-stu-id="c1f13-195">When the VM-GenerationID is reset, the invocationID of the AD DS database is also reset, the RID pool is discarded, and SYSVOL is marked as non-authoritative.</span></span> <span data-ttu-id="c1f13-196">Pour plus d’informations, consultez l’article [Présentation de la virtualisation des services de domaine Active Directory (AD DS)](https://technet.microsoft.com/library/hh831734.aspx) et la rubrique [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx) (Virtualisation DFSR sécurisée).</span><span class="sxs-lookup"><span data-stu-id="c1f13-196">For more information, see [Introduction to Active Directory Domain Services (AD DS) Virtualization](https://technet.microsoft.com/library/hh831734.aspx) and [Safely Virtualizing DFSR](http://blogs.technet.com/b/filecab/archive/2013/04/05/safely-virtualizing-dfsr.aspx).</span></span>
> 
> 

## <a name="why-deploy-windows-server-ad-ds-on-azure-virtual-machines"></a><span data-ttu-id="c1f13-197">Pourquoi déployer Windows Server AD DS sur des machines virtuelles Azure ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-197">Why deploy Windows Server AD DS on Azure Virtual Machines?</span></span>
<span data-ttu-id="c1f13-198">De nombreux scénarios de déploiement de Windows Server AD DS sont parfaitement adaptés au déploiement sur des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-198">Many Windows Server AD DS deployment scenarios are well-suited for deployment as VMs on Azure.</span></span> <span data-ttu-id="c1f13-199">Supposons par exemple que vous gérez une société en Europe qui a besoin d’authentifier des utilisateurs sur un site distant en Asie.</span><span class="sxs-lookup"><span data-stu-id="c1f13-199">For example, suppose you have a company in Europe that needs to authenticate users in a remote location in Asia.</span></span> <span data-ttu-id="c1f13-200">La société n’a pas encore déployé de contrôleurs de domaine Windows Server Active Directory en Asie en raison de leur coût de déploiement et d’une expertise limitée en matière de gestion des serveurs après le déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-200">The company has not previously deployed Windows Server Active Directory DCs in Asia due to the cost to deploy them and limited expertise to manage the servers post-deployment.</span></span> <span data-ttu-id="c1f13-201">Les demandes d’authentification provenant d’Asie sont donc traitées par les contrôleurs de domaine déployés en Europe, mais avec des performances mitigées.</span><span class="sxs-lookup"><span data-stu-id="c1f13-201">As a result, authentication requests from Asia are serviced by DCs in Europe with suboptimal results.</span></span> <span data-ttu-id="c1f13-202">Dans ce cas, vous pouvez déployer un contrôleur de domaine sur une machine virtuelle qui doit s’exécuter dans le centre de données Azure en Asie.</span><span class="sxs-lookup"><span data-stu-id="c1f13-202">In this case, you can deploy a DC on a VM that you have specified must be run within the Azure datacenter in Asia.</span></span> <span data-ttu-id="c1f13-203">Le fait d’attacher ce contrôleur de domaine à un réseau virtuel Azure directement connecté au site distant améliorera les performances de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="c1f13-203">Attaching that DC to an Azure virtual network that is connected directly to the remote location will improve authentication performance.</span></span>

<span data-ttu-id="c1f13-204">Azure convient également en tant que substitut des sites de récupération d’urgence coûteux.</span><span class="sxs-lookup"><span data-stu-id="c1f13-204">Azure is also well-suited as a substitute to otherwise costly disaster recovery (DR) sites.</span></span> <span data-ttu-id="c1f13-205">Le coût relativement faible lié à l’hébergement d’un petit nombre de contrôleurs de domaine et d’un seul réseau virtuel sur Azure représente une solution intéressante.</span><span class="sxs-lookup"><span data-stu-id="c1f13-205">The relatively low-cost of hosting a small number of domain controllers and a single virtual network on Azure represents an attractive alternative.</span></span>

<span data-ttu-id="c1f13-206">Pour finir, vous pouvez déployer une application réseau sur Azure, telle que SharePoint, qui nécessite Windows Server Active Directory mais qui n’a aucune dépendance sur le réseau local ou sur l’instance Windows Server Active Directory d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-206">Finally, you may want to deploy a network application on Azure, such as SharePoint, that requires Windows Server Active Directory but has no dependency on the on-premises network or the corporate Windows Server Active Directory.</span></span> <span data-ttu-id="c1f13-207">Dans ce cas, il est intéressant de déployer une forêt isolée sur Azure pour répondre aux exigences de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="c1f13-207">In this case, deploying an isolated forest on Azure to meet the SharePoint server’s requirements is optimal.</span></span> <span data-ttu-id="c1f13-208">Là encore, le déploiement d’applications réseau qui nécessitent une connectivité au réseau local et à l’instance Active Directory d’entreprise est également pris en charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-208">Again, deploying network applications that do require connectivity to the on-premises network and the corporate Active Directory is also supported.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-209">Grâce à une connexion de couche 3, le composant VPN qui assure la connectivité entre un réseau virtuel Azure et un réseau local peut également permettre aux serveurs membres exécutés en local d’exploiter les contrôleurs de domaine exécutés en tant que machines virtuelles sur un réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-209">Since it provides a layer-3 connection, the VPN component that provides connectivity between an Azure virtual network and an on-premises network can also enable member servers that run on-premises to leverage DCs that run as Azure virtual machines on Azure virtual network.</span></span> <span data-ttu-id="c1f13-210">En revanche, si la connexion VPN est indisponible, la communication entre les ordinateurs locaux et les contrôleurs de domaine Azure ne pourra pas être établie, ce qui entraînera des problèmes d’authentification et d’autres erreurs.</span><span class="sxs-lookup"><span data-stu-id="c1f13-210">But if the VPN is unavailable, communication between on-premises computers and Azure-based domain controllers will not function, resulting in authentication and various other errors.</span></span>  
> 
> 

## <a name="contrasts-between-deploying-windows-server-active-directory-domain-controllers-on-azure-virtual-machines-versus-on-premises"></a><span data-ttu-id="c1f13-211">Différences entre le déploiement de contrôleurs de domaine Windows Server Active Directory sur des machines virtuelles Azure et leur déploiement en local</span><span class="sxs-lookup"><span data-stu-id="c1f13-211">Contrasts between deploying Windows Server Active Directory domain controllers on Azure Virtual Machines versus on-premises</span></span>
* <span data-ttu-id="c1f13-212">Pour tout scénario de déploiement de Windows Server Active Directory comprenant une seule machine virtuelle, il est nécessaire d’utiliser un réseau virtuel Azure pour garantir la cohérence des adresses IP.</span><span class="sxs-lookup"><span data-stu-id="c1f13-212">For any Windows Server Active Directory deployment scenario that includes more than a single VM, it is necessary to use an Azure virtual network for IP address consistency.</span></span> <span data-ttu-id="c1f13-213">Notez que ce guide suppose que les contrôleurs de domaine s’exécutent sur un réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-213">Note that this guide assumes that DCs are running on an Azure virtual network.</span></span>
* <span data-ttu-id="c1f13-214">Comme pour les contrôleurs de domaine locaux, l’utilisation d’adresses IP statiques est recommandée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-214">As with on-premises DCs, static IP addresses are recommended.</span></span> <span data-ttu-id="c1f13-215">Une adresse IP statique peut uniquement être configurée à l’aide d’Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c1f13-215">A static IP address can only be configured by using Azure PowerShell.</span></span> <span data-ttu-id="c1f13-216">Pour plus d’informations, consultez [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) (Adresse IP interne statique pour les machines virtuelles).</span><span class="sxs-lookup"><span data-stu-id="c1f13-216">See [Static internal IP address for VMs](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/) for more details.</span></span> <span data-ttu-id="c1f13-217">Si vous disposez de systèmes de surveillance ou d’autres solutions permettant de vérifier la configuration des adresses IP statiques dans le système d’exploitation invité, vous pouvez affecter la même adresse IP statique aux propriétés de carte réseau de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-217">If you have monitoring systems or other solutions that check for static IP address configuration within the guest operating system, you can assign the same static IP address to the network adapter properties of the VM.</span></span> <span data-ttu-id="c1f13-218">Sachez toutefois que la carte réseau sera ignorée si la machine virtuelle subit une réparation de service ou si elle est arrêtée dans le portail Azure et que son adresse est désallouée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-218">But be aware that the network adapter will be discarded if the VM undergoes service healing or is shut down in the portal and has its address deallocated.</span></span> <span data-ttu-id="c1f13-219">Dans ce cas, l’adresse IP statique dans l’invité devra être réinitialisée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-219">In that case, the static IP address within the guest will need to be reset.</span></span>
* <span data-ttu-id="c1f13-220">Le déploiement de machines virtuelles sur un réseau virtuel n’implique (ni ne nécessite) de connectivité à un réseau local ; le réseau virtuel le permet simplement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-220">Deploying VMs on a virtual network does not imply (or require) connectivity back to an on-premises network; the virtual network merely enables that possibility.</span></span> <span data-ttu-id="c1f13-221">Vous devez créer un réseau virtuel pour établir la communication privée entre Azure et votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-221">You must create a virtual network for private communication between Azure and your on-premises network.</span></span> <span data-ttu-id="c1f13-222">Vous devez déployer un point de terminaison VPN sur le réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-222">You need to deploy a VPN endpoint on the on-premises network.</span></span> <span data-ttu-id="c1f13-223">Le VPN est ouvert entre Azure et le réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-223">The VPN is opened from Azure to the on-premises network.</span></span> <span data-ttu-id="c1f13-224">Pour plus d’informations, consultez la page [Présentation du réseau virtuel](../virtual-network/virtual-networks-overview.md) et l’article dédié à la [configuration d’un VPN de site à site dans le portail Azure](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-224">For more information, see [Virtual Network Overview](../virtual-network/virtual-networks-overview.md) and [Configure a Site-to-Site VPN in the Azure Portal](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-225">Il existe une option de [création de VPN de point à site](../vpn-gateway/vpn-gateway-point-to-site-create.md) permettant de connecter directement des ordinateurs Windows à un réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-225">An option to [create a point-to-site VPN](../vpn-gateway/vpn-gateway-point-to-site-create.md) is available to connect individual Windows-based computers directly to an Azure virtual network.</span></span>
> 
> 

* <span data-ttu-id="c1f13-226">Que vous créiez ou non un réseau virtuel, Azure facture le trafic sortant, mais pas le trafic entrant.</span><span class="sxs-lookup"><span data-stu-id="c1f13-226">Regardless of whether you create a virtual network or not, Azure charges for egress traffic but not ingress.</span></span> <span data-ttu-id="c1f13-227">Les différents choix de conception de Windows Server Active Directory peuvent affecter le volume de trafic sortant généré par un déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-227">Various Windows Server Active Directory design choices can affect how much egress traffic is generated by a deployment.</span></span> <span data-ttu-id="c1f13-228">Par exemple, le déploiement d’un contrôleur de domaine en lecture seule (RODC) limite le trafic sortant, puisqu’il ne le réplique pas.</span><span class="sxs-lookup"><span data-stu-id="c1f13-228">For example, deploying a read-only domain controller (RODC) limits egress traffic because it does not replicate outbound.</span></span> <span data-ttu-id="c1f13-229">Mais la décision de déployer un contrôleur de domaine en lecture seule doit être contrebalancée avec la nécessité d’effectuer des opérations d’écriture sur le contrôleur de domaine et avec la [compatibilité](https://technet.microsoft.com/library/cc755190) des applications et services du site avec les contrôleurs de domaine en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c1f13-229">But the decision to deploy an RODC needs to be weighed against the need to perform write operations against the DC and the [compatibility](https://technet.microsoft.com/library/cc755190) that applications and services in the site have with RODCs.</span></span> <span data-ttu-id="c1f13-230">Pour plus d’informations sur les frais liés au trafic, consultez la page [Tarification Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="c1f13-230">For more information about traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>
* <span data-ttu-id="c1f13-231">Bien que vous ayez un contrôle total sur les ressources serveur à utiliser pour les machines virtuelles locales, notamment la quantité de RAM et la taille du disque, sur Azure, vous devez effectuer une sélection dans une liste de tailles de serveur préconfigurées.</span><span class="sxs-lookup"><span data-stu-id="c1f13-231">While you have complete control over what server resources to use for VMs on-premises, such as RAM, disk size, and so on, on Azure you must select from a list of preconfigured server sizes.</span></span> <span data-ttu-id="c1f13-232">Pour un contrôleur de domaine, vous devez ajouter un disque de données au disque du système d’exploitation afin de stocker la base de données Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-232">For a DC, a data disk is needed in addition to the operating system disk in order to store the Windows Server Active Directory database.</span></span>

## <a name="can-you-deploy-windows-server-ad-fs-on-azure-virtual-machines"></a><span data-ttu-id="c1f13-233">Est-il possible de déployer Windows Server AD FS sur des machines virtuelles Azure ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-233">Can you deploy Windows Server AD FS on Azure virtual machines?</span></span>
<span data-ttu-id="c1f13-234">Oui, vous pouvez déployer Windows Server AD FS sur des machines virtuelles, les [meilleures pratiques en matière de déploiement d’AD FS](https://technet.microsoft.com/library/dn151324.aspx) en local s’appliquant également au déploiement d’AD FS sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-234">Yes, you can deploy Windows Server AD FS on Azure virtual machines, and the [best practices for AD FS deployment](https://technet.microsoft.com/library/dn151324.aspx) on-premises apply equally to AD FS deployment on Azure.</span></span> <span data-ttu-id="c1f13-235">Cependant, certaines meilleures pratiques, comme l’équilibrage de la charge et la haute disponibilité, supposent de faire appel à des technologies allant au-delà des fonctions proposées par AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-235">But some of the best practices such as load balancing and high availability require technologies beyond what AD FS offers itself.</span></span> <span data-ttu-id="c1f13-236">Elles doivent être fournies par l’infrastructure sous-jacente.</span><span class="sxs-lookup"><span data-stu-id="c1f13-236">They must be provided by the underlying infrastructure.</span></span> <span data-ttu-id="c1f13-237">Nous allons passer en revue quelques-unes de ces meilleures pratiques et voir comment les appliquer à l’aide de machines virtuelles Azure et d’un réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-237">Let’s review some of those best practices and see how they can be achieved by using Azure VMs and an Azure virtual network.</span></span>

1. <span data-ttu-id="c1f13-238">**Ne jamais exposer de serveurs de service d’émission de jeton de sécurité (STS) directement sur Internet.**</span><span class="sxs-lookup"><span data-stu-id="c1f13-238">**Never expose security token service (STS) servers directly to the Internet.**</span></span>
   
    <span data-ttu-id="c1f13-239">Ce point est important car le service STS émet des jetons de sécurité.</span><span class="sxs-lookup"><span data-stu-id="c1f13-239">This is important because the STS issues security tokens.</span></span> <span data-ttu-id="c1f13-240">Par conséquent, les serveurs STS tels que des serveurs AD FS doivent être traités avec le même niveau de protection que celui d’un contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-240">As a result, STS servers such as AD FS servers should be treated with the same level of protection as a domain controller.</span></span> <span data-ttu-id="c1f13-241">Si un service d’émission de jeton de sécurité est corrompu, les utilisateurs malveillants ont la possibilité d’émettre des jetons d’accès qui contiennent potentiellement les revendications de leur choix dans les applications par partie de confiance et d’autres serveurs STS d’organisations fiables.</span><span class="sxs-lookup"><span data-stu-id="c1f13-241">If an STS is compromised, malicious users have the ability to issue access tokens potentially containing claims of their choosing to relying party applications and other STS servers in trusting organizations.</span></span>
2. <span data-ttu-id="c1f13-242">**Déployer des contrôleurs de domaine Active Directory pour tous les domaines d’utilisateurs dans le même réseau que les serveurs AD FS.**</span><span class="sxs-lookup"><span data-stu-id="c1f13-242">**Deploy Active Directory domain controllers for all user domains in the same network as the AD FS servers.**</span></span>
   
    <span data-ttu-id="c1f13-243">Les serveurs AD FS utilisent Active Directory Domain Services pour l’authentification des utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="c1f13-243">AD FS servers use Active Directory Domain Services to authenticate users.</span></span> <span data-ttu-id="c1f13-244">Il est recommandé de déployer des contrôleurs de domaine sur le même réseau que les serveurs AD FS,</span><span class="sxs-lookup"><span data-stu-id="c1f13-244">It is recommended to deploy domain controllers on the same network as the AD FS servers.</span></span> <span data-ttu-id="c1f13-245">ce afin de garantir la continuité d’activités si la liaison entre le réseau Azure et votre réseau local est rompue, tout en diminuant la latence et en améliorant les performances des connexions.</span><span class="sxs-lookup"><span data-stu-id="c1f13-245">This provides business continuity in case the link between the Azure network and your on-premises network is broken, and enables lower latency and increased performance for logins.</span></span>
3. <span data-ttu-id="c1f13-246">**Déployer plusieurs nœuds AD FS pour la haute disponibilité et l’équilibrage de la charge.**</span><span class="sxs-lookup"><span data-stu-id="c1f13-246">**Deploy multiple AD FS nodes for high availability and balancing the load.**</span></span>
   
    <span data-ttu-id="c1f13-247">Dans la plupart des cas, l’échec d’une application activée par AD FS est inacceptable, car les applications qui requièrent des jetons de sécurité sont souvent critiques.</span><span class="sxs-lookup"><span data-stu-id="c1f13-247">In most cases, the failure of an application that AD FS enables is unacceptable because the applications that require security tokens are often mission critical.</span></span> <span data-ttu-id="c1f13-248">Par conséquent, et étant donné que AD FS se situe désormais sur le chemin d’accès aux applications critiques, le service AD FS doit être hautement disponible via plusieurs proxys et serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-248">As a result, and because AD FS now resides in the critical path to accessing mission critical applications, the AD FS service must be highly available through multiple AD FS proxies and AD FS servers.</span></span> <span data-ttu-id="c1f13-249">Pour assurer la distribution des demandes, des équilibreurs de charge sont généralement déployés devant les proxys et les serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-249">To achieve distribution of requests, load balancers are typically deployed in front of both the AD FS Proxies and the AD FS servers.</span></span>
4. <span data-ttu-id="c1f13-250">**Déployer un ou plusieurs nœuds de proxy d’application web pour accéder à Internet.**</span><span class="sxs-lookup"><span data-stu-id="c1f13-250">**Deploy one or more Web Application Proxy nodes for internet access.**</span></span>
   
    <span data-ttu-id="c1f13-251">Lorsque les utilisateurs doivent accéder à des applications protégées par le service AD FS, le service AD FS doit être disponible à partir d’internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-251">When users need to access applications protected by the AD FS service, the AD FS service needs to be available from the internet.</span></span> <span data-ttu-id="c1f13-252">Pour cela, vous devez déployer le service de proxy d’application web.</span><span class="sxs-lookup"><span data-stu-id="c1f13-252">This is achieved by deploying the Web Application Proxy service.</span></span> <span data-ttu-id="c1f13-253">Il est fortement recommandé de déployer plusieurs nœuds pour garantir à la fois la haute disponibilité et l’équilibrage de la charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-253">It is strongly recommended to deploy more than one node for the purposes of high availability and load balancing.</span></span>
5. <span data-ttu-id="c1f13-254">**Restreindre l’accès aux ressources réseau internes à partir des nœuds de proxy d’application web.**</span><span class="sxs-lookup"><span data-stu-id="c1f13-254">**Restrict access from the Web Application Proxy nodes to internal network resources.**</span></span>
   
    <span data-ttu-id="c1f13-255">Pour permettre aux utilisateurs externes d’accéder aux services AD FS à partir d’Internet, vous devez déployer des nœuds de proxy d’application web (ou proxy AD FS dans les versions antérieures de Windows Server).</span><span class="sxs-lookup"><span data-stu-id="c1f13-255">To allow external users to access AD FS from the internet, you need to deploy Web Application Proxy nodes (or AD FS Proxy in earlier versions of Windows Server).</span></span> <span data-ttu-id="c1f13-256">Les nœuds de proxy d’application web sont directement exposés à Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-256">The Web Application proxy nodes are directly exposed to the Internet.</span></span> <span data-ttu-id="c1f13-257">Il n’est pas nécessaire de les joindre au domaine et ils doivent uniquement accéder aux serveurs AD FS via les ports TCP 443 et 80.</span><span class="sxs-lookup"><span data-stu-id="c1f13-257">They are not required to be domain-joined and they only need access to the AD FS servers over TCP ports 443 and 80.</span></span> <span data-ttu-id="c1f13-258">Il est fortement recommandé de bloquer la communication vers tous les autres ordinateurs (en particulier les contrôleurs de domaine).</span><span class="sxs-lookup"><span data-stu-id="c1f13-258">It is strongly recommended that communication to all other computers (especially domain controllers) is blocked.</span></span>
   
    <span data-ttu-id="c1f13-259">Pour cela, vous devez généralement agir en local au moyen d’une zone démilitarisée (DMZ).</span><span class="sxs-lookup"><span data-stu-id="c1f13-259">This is typically achieved on-premises by means of a DMZ.</span></span> <span data-ttu-id="c1f13-260">Les pare-feu utilisent un mode d’autorisation par liste d’approbation pour limiter le trafic entre la DMZ et le réseau local (ce qui signifie que seul le trafic provenant des adresses IP et des ports spécifiés est autorisé, tout autre trafic étant bloqué).</span><span class="sxs-lookup"><span data-stu-id="c1f13-260">Firewalls use a whitelist mode of operation to restrict traffic from the DMZ to the on-premises network (that is, only traffic from the specified IP addresses and over specified ports is allowed, and all other traffic is blocked).</span></span>

<span data-ttu-id="c1f13-261">Le schéma suivant illustre ce concept en présentant un exemple de déploiement AD FS en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-261">The following diagram shows a traditional on-premises AD FS deployment.</span></span>

![Diagramme d’un déploiement local de services de fédération Active Directory traditionnels](media/active-directory-deploying-ws-ad-guidelines/ADFS_onprem.png)

<span data-ttu-id="c1f13-263">Cependant, puisqu’Azure ne fournit pas de fonctionnalités de pare-feu complètes de façon native, vous devez utiliser d’autres options pour restreindre le trafic.</span><span class="sxs-lookup"><span data-stu-id="c1f13-263">However, because Azure does not provide native, full-featured firewall capability, other options need to be used to restrict traffic.</span></span> <span data-ttu-id="c1f13-264">Le tableau suivant présente chaque option, avec ses avantages et ses inconvénients.</span><span class="sxs-lookup"><span data-stu-id="c1f13-264">The following table shows each option and its advantages and disadvantages.</span></span>

| <span data-ttu-id="c1f13-265">Option</span><span class="sxs-lookup"><span data-stu-id="c1f13-265">Option</span></span> | <span data-ttu-id="c1f13-266">Avantage</span><span class="sxs-lookup"><span data-stu-id="c1f13-266">Advantage</span></span> | <span data-ttu-id="c1f13-267">Inconvénient</span><span class="sxs-lookup"><span data-stu-id="c1f13-267">Disadvantage</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="c1f13-268">Listes de contrôle d’accès (ACL) du réseau Azure</span><span class="sxs-lookup"><span data-stu-id="c1f13-268">Azure network ACLs</span></span>](../virtual-network/virtual-networks-acl.md) |<span data-ttu-id="c1f13-269">Configuration initiale moins coûteuse et plus simple.</span><span class="sxs-lookup"><span data-stu-id="c1f13-269">Less costly and simpler initial configuration</span></span> |<span data-ttu-id="c1f13-270">Configuration ACL réseau supplémentaire requise en cas d’ajout de machines virtuelles au déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-270">Additional network ACL configuration required if any new VMs are added to the deployment</span></span> |
| [<span data-ttu-id="c1f13-271">Appliance Barracuda NG Firewall</span><span class="sxs-lookup"><span data-stu-id="c1f13-271">Barracuda NG firewall</span></span>](https://www.barracuda.com/products/ngfirewall) |<span data-ttu-id="c1f13-272">Mode d’autorisation par liste d’approbation ; aucune configuration ACL réseau requise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-272">Whitelist mode of operation and it requires no network ACL configuration</span></span> |<span data-ttu-id="c1f13-273">Augmentation des coûts et configuration initiale plus coûteuse.</span><span class="sxs-lookup"><span data-stu-id="c1f13-273">Increased cost and complexity for initial setup</span></span> |

<span data-ttu-id="c1f13-274">Dans ce cas, la procédure générale pour le déploiement d’AD FS est la suivante :</span><span class="sxs-lookup"><span data-stu-id="c1f13-274">The high-level steps to deploy AD FS in this case are as follows:</span></span>

1. <span data-ttu-id="c1f13-275">Créer un réseau virtuel avec une connectivité intersite, à l’aide d’un réseau privé virtuel (VPN) ou [d’ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span><span class="sxs-lookup"><span data-stu-id="c1f13-275">Create a virtual network with cross-premises connectivity, using either a VPN or [ExpressRoute](http://azure.microsoft.com/services/expressroute/).</span></span>
2. <span data-ttu-id="c1f13-276">Déployer des contrôleurs de domaine sur le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c1f13-276">Deploy domain controllers on the virtual network.</span></span> <span data-ttu-id="c1f13-277">Cette étape est facultative mais recommandée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-277">This step is optional but recommended.</span></span>
3. <span data-ttu-id="c1f13-278">Déployer des serveurs AD FS joints au domaine sur le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c1f13-278">Deploy domain-joined AD FS servers on the virtual network.</span></span>
4. <span data-ttu-id="c1f13-279">Créer un [jeu d’équilibrage de la charge interne](http://azure.microsoft.com/blog/internal-load-balancing/) qui inclut les serveurs AD FS et utilise une nouvelle adresse IP privée dans le réseau virtuel (une adresse IP dynamique).</span><span class="sxs-lookup"><span data-stu-id="c1f13-279">Create an [internal load balanced set](http://azure.microsoft.com/blog/internal-load-balancing/) that includes the AD FS servers and uses a new private IP address within the virtual network (a dynamic IP address).</span></span>
   
   1. <span data-ttu-id="c1f13-280">Mettre à jour le DNS pour créer le nom de domaine complet afin de pointer vers l’adresse IP privée (dynamique) du jeu d’équilibrage de la charge interne.</span><span class="sxs-lookup"><span data-stu-id="c1f13-280">Update DNS to create the FQDN to point to the private (dynamic) IP address of the internal load balanced set.</span></span>
5. <span data-ttu-id="c1f13-281">Créer un service cloud (ou un réseau virtuel distinct) pour les nœuds de proxy d’application web.</span><span class="sxs-lookup"><span data-stu-id="c1f13-281">Create a cloud service (or a separate virtual network) for the Web Application Proxy nodes.</span></span>
6. <span data-ttu-id="c1f13-282">Déployer les nœuds de proxy d’application web dans le service cloud ou dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c1f13-282">Deploy the Web Application Proxy nodes in the cloud service or virtual network</span></span>
   
   1. <span data-ttu-id="c1f13-283">Créer un jeu d’équilibrage de la charge externe qui inclut les nœuds de proxy d’application web.</span><span class="sxs-lookup"><span data-stu-id="c1f13-283">Create an external load balanced set that includes the Web Application Proxy nodes.</span></span>
   2. <span data-ttu-id="c1f13-284">Mettre à jour le nom DNS externe (FQDN) pour pointer vers l’adresse publique du service cloud (l’adresse IP virtuelle).</span><span class="sxs-lookup"><span data-stu-id="c1f13-284">Update the external DNS name (FQDN) to point to the cloud service public IP address (the virtual IP address).</span></span>
   3. <span data-ttu-id="c1f13-285">Configurer les proxys AD FS pour utiliser le nom de domaine complet correspondant au jeu d’équilibrage de la charge interne pour les serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-285">Configure AD FS proxies to use the FQDN that corresponds to the internal load balanced set for the AD FS servers.</span></span>
   4. <span data-ttu-id="c1f13-286">Mettre à jour les sites web basés sur les revendications afin d’utiliser le nom de domaine complet externe pour leur fournisseur de revendications.</span><span class="sxs-lookup"><span data-stu-id="c1f13-286">Update claims-based web sites to use the external FQDN for their claims provider.</span></span>
7. <span data-ttu-id="c1f13-287">Limiter l’accès entre le proxy d’application web et les ordinateurs du réseau virtuel AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-287">Restrict access between Web Application Proxy to any machine in the AD FS virtual network.</span></span>

<span data-ttu-id="c1f13-288">Pour limiter le trafic, vous devez configurer le jeu d’équilibrage de la charge de l’équilibreur de charge interne Azure pour qu’il accepte uniquement le trafic vers les ports 80 et 443, bloquant ainsi le trafic vers l’adresse IP dynamique interne du jeu d’équilibrage de la charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-288">To restrict traffic, the load-balanced set for the Azure internal load balancer needs to be configured for only traffic to TCP ports 80 and 443, and all other traffic to the internal dynamic IP address of the load balanced set is dropped.</span></span>

![Diagramme des ACL réseau ADFS avec autorisation TCP 443 + 80.](media/active-directory-deploying-ws-ad-guidelines/ADFS_ACLs.png)

<span data-ttu-id="c1f13-290">Le trafic vers les serveurs AD FS doit uniquement être autorisé par les sources suivantes :</span><span class="sxs-lookup"><span data-stu-id="c1f13-290">Traffic to the AD FS servers would be permitted only by the following sources:</span></span>

* <span data-ttu-id="c1f13-291">l’équilibreur de charge interne Azure ;</span><span class="sxs-lookup"><span data-stu-id="c1f13-291">The Azure internal load balancer.</span></span>
* <span data-ttu-id="c1f13-292">l’adresse IP d’un administrateur sur le réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-292">The IP address of an administrator on the on-premises network.</span></span>

> [!WARNING]
> <span data-ttu-id="c1f13-293">La conception doit empêcher les nœuds de proxy d’application web d’atteindre les autres machines virtuelles du réseau virtuel Azure ou tout autre emplacement sur le réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-293">The design must prevent Web Application Proxy nodes from reaching any other VMs in the Azure virtual network or any locations on the on-premises network.</span></span> <span data-ttu-id="c1f13-294">Pour ce faire, configurez les règles de pare-feu dans l’appliance locale pour les connexions ExpressRoute ou le périphérique VPN pour les connexions VPN de site à site.</span><span class="sxs-lookup"><span data-stu-id="c1f13-294">That can be done by configuring firewall rules in the on-premises appliance for Express Route connections or the VPN device for site-to-site VPN connections.</span></span>
> 
> 

<span data-ttu-id="c1f13-295">Cette option présente un inconvénient : vous devez configurer les ACL réseau pour plusieurs appareils, y compris l’équilibreur de charge interne, les serveurs AD FS et les autres serveurs ajoutés au réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="c1f13-295">A disadvantage to this option is the need to configure the network ACLs for multiple devices, including internal load balancer, the AD FS servers, and any other servers that get added to the virtual network.</span></span> <span data-ttu-id="c1f13-296">Si un appareil est ajouté au déploiement sans configurer les ACL réseau pour limiter le trafic entrant, l’intégralité du déploiement peut être menacée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-296">If any device is added to the deployment without configuring network ACLs to restrict traffic to it, the entire deployment can be at risk.</span></span> <span data-ttu-id="c1f13-297">Si les adresses IP des nœuds du proxy d’application web sont modifiées, l’ACL réseau doit être réinitialisé (ce qui signifie que les serveurs proxy doivent être configurés pour utiliser des [adresses IP dynamiques statiques](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span><span class="sxs-lookup"><span data-stu-id="c1f13-297">If the IP addresses of the Web Application Proxy nodes ever change, the network ACLs must be reset (which means the proxies should be configured to use [static dynamic IP addresses](http://azure.microsoft.com/blog/static-internal-ip-address-for-virtual-machines/)).</span></span>

![ADFS sur Azure avec ACL réseau.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure.png)

<span data-ttu-id="c1f13-299">Une autre option consiste à utiliser l’appliance [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) pour contrôler le trafic entre les serveurs proxy AD FS et les serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-299">Another option is to use the [Barracuda NG Firewall](https://www.barracuda.com/products/ngfirewall) appliance to control traffic between AD FS proxy servers and the AD FS servers.</span></span> <span data-ttu-id="c1f13-300">Cette option est conforme aux meilleures pratiques en matière de sécurité et de haute disponibilité et nécessite moins d’efforts d’administration après la configuration initiale, car l’appliance Barracuda NG Firewall fournit un mode d’autorisation par liste d’approbation pour l’administration du pare-feu et peut être installée directement sur un réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-300">This option complies with best practices for security and high availability, and requires less administration after the initial setup because the Barracuda NG Firewall appliance provides a whitelist mode of firewall administration and it can be installed directly on an Azure virtual network.</span></span> <span data-ttu-id="c1f13-301">Cela permet de supprimer la nécessité de configurer les ACL réseau chaque fois qu’un nouveau serveur est ajouté au déploiement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-301">That eliminates the need to configure network ACLs any time a new server is added to the deployment.</span></span> <span data-ttu-id="c1f13-302">Néanmoins, cette option ajoute un certain degré de complexité au déploiement initial et entraîne des coûts supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="c1f13-302">But this option adds initial deployment complexity and cost.</span></span>

<span data-ttu-id="c1f13-303">Dans ce cas, deux réseaux virtuels sont déployés au lieu d’un seul.</span><span class="sxs-lookup"><span data-stu-id="c1f13-303">In this case, two virtual networks are deployed instead of one.</span></span> <span data-ttu-id="c1f13-304">Nous les appellerons le réseau virtuel 1 et le réseau virtuel 2.</span><span class="sxs-lookup"><span data-stu-id="c1f13-304">We'll call them VNet1 and VNet2.</span></span> <span data-ttu-id="c1f13-305">Le réseau virtuel 1 contient les proxys et le réseau virtuel 2 comprend les STS et la connexion réseau vers le réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-305">VNet1 contains the proxies and VNet2 contains the STSs and the network connection back to the corporate network.</span></span> <span data-ttu-id="c1f13-306">Le réseau virtuel 1 est donc physiquement (bien que virtuellement) isolé du réseau virtuel 2 et du réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-306">VNet1 is therefore physically (albeit virtually) isolated from VNet2 and, in turn, from the corporate network.</span></span> <span data-ttu-id="c1f13-307">Le réseau virtuel 1 est ensuite connecté au réseau virtuel 2 via une technologie de tunneling spéciale appelée architecture de réseau d’information des télécommunications (Transport Independent Network Architecture, TINA).</span><span class="sxs-lookup"><span data-stu-id="c1f13-307">VNet1 is then connected to VNet2 using a special tunneling technology known as Transport Independent Network Architecture (TINA).</span></span> <span data-ttu-id="c1f13-308">Le tunnel TINA est associé à chacun des réseaux virtuels à l’aide d’un pare-feu Barracuda NG (avec un pare-feu Barracuda sur chaque réseau virtuel).</span><span class="sxs-lookup"><span data-stu-id="c1f13-308">The TINA tunnel is attached to each of the virtual networks using a Barracuda NG firewall—one Barracuda on each of the virtual networks.</span></span>  <span data-ttu-id="c1f13-309">Pour bénéficier d’une haute disponibilité, nous vous recommandons de déployer deux pare-feu Barracuda sur chaque réseau virtuel ; l’un actif, l’autre passif.</span><span class="sxs-lookup"><span data-stu-id="c1f13-309">For high-availability, it is recommended that you deploy two Barracudas on each virtual network; one active, the other passive.</span></span> <span data-ttu-id="c1f13-310">Ils offrent des capacités de pare-feu très complètes qui nous permettent de reproduire le fonctionnement d’un réseau de périmètre local traditionnel dans Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-310">They offer extremely rich firewalling capabilities which allow us to mimic the operation of a traditional on-premises DMZ in Azure.</span></span>

![ADFS sur Azure avec pare-feu.](media/active-directory-deploying-ws-ad-guidelines/ADFS_Azure_firewall.png)

<span data-ttu-id="c1f13-312">Pour plus d’informations, consultez [AD FS : étendre une application frontale locale prenant en charge les revendications à Internet](#BKMK_CloudOnlyFed).</span><span class="sxs-lookup"><span data-stu-id="c1f13-312">For more information, see [AD FS: Extend a claims-aware on-premises front-end application to the Internet](#BKMK_CloudOnlyFed).</span></span>

### <a name="an-alternative-to-ad-fs-deployment-if-the-goal-is-office-365-sso-alone"></a><span data-ttu-id="c1f13-313">Alternative au déploiement AD FS si votre objectif est l’authentification unique Office 365 uniquement</span><span class="sxs-lookup"><span data-stu-id="c1f13-313">An alternative to AD FS deployment if the goal is Office 365 SSO alone</span></span>
<span data-ttu-id="c1f13-314">Il existe une autre solution pour déployer totalement AD FS si votre objectif est uniquement d’activer la connexion à Office 365.</span><span class="sxs-lookup"><span data-stu-id="c1f13-314">There is another alternative to deploying AD FS altogether if your goal is only to enable sign-in for Office 365.</span></span> <span data-ttu-id="c1f13-315">Dans ce cas, vous pouvez simplement déployer DirSync avec synchronisation des mots de passe en local et obtenir le même résultat avec un degré de complexité minimal, puisque cette approche ne nécessite pas AD FS ni Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-315">In that case, you can simply deploy DirSync with password sync on-premises and achieve the same end-result with minimal deployment complexity because this approach does not require AD FS or Azure.</span></span>

<span data-ttu-id="c1f13-316">Le tableau suivant compare les processus de connexion avec et sans le déploiement d’AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-316">The following table compares how the sign-in processes work with and without deploying AD FS.</span></span>

| <span data-ttu-id="c1f13-317">Authentification unique Office 365 avec AD FS et DirSync</span><span class="sxs-lookup"><span data-stu-id="c1f13-317">Office 365 single sign-on using AD FS and DirSync</span></span> | <span data-ttu-id="c1f13-318">Connexion à Office 365 identique avec DirSync + synchronisation de mots de passe</span><span class="sxs-lookup"><span data-stu-id="c1f13-318">Office 365 same sign-on using DirSync + Password Sync</span></span> |
| --- | --- |
| <span data-ttu-id="c1f13-319">1. L’utilisateur se connecte à un réseau d’entreprise et est authentifié à Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-319">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |<span data-ttu-id="c1f13-320">1. L’utilisateur se connecte à un réseau d’entreprise et est authentifié à Windows Server Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-320">1. The user logs on to a corporate network, and is authenticated to Windows Server Active Directory.</span></span> |
| <span data-ttu-id="c1f13-321">2. L’utilisateur tente d’accéder à Office 365 (je suis @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="c1f13-321">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |<span data-ttu-id="c1f13-322">2. L’utilisateur tente d’accéder à Office 365 (je suis @contoso.com).</span><span class="sxs-lookup"><span data-stu-id="c1f13-322">2. The user tries to access Office 365 (I am @contoso.com).</span></span> |
| <span data-ttu-id="c1f13-323">3. Office 365 redirige l’utilisateur vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c1f13-323">3. Office 365 redirects the user to Azure AD.</span></span> |<span data-ttu-id="c1f13-324">3. Office 365 redirige l’utilisateur vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c1f13-324">3. Office 365 redirects the user to Azure AD.</span></span> |
| <span data-ttu-id="c1f13-325">4. Dans la mesure où Azure AD ne peut pas authentifier l’utilisateur et comprend qu’il existe une approbation avec AD FS en local, il redirige l’utilisateur vers AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-325">4. Since Azure AD can’t authenticate the user and understands there is a trust with AD FS on-premises, it redirects the user to AD FS.</span></span> |<span data-ttu-id="c1f13-326">4. Azure AD ne peut pas accepter de tickets Kerberos directement et aucune relation d’approbation n’existe. L’utilisateur est donc invité à saisir des informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="c1f13-326">4. Azure AD can’t accept Kerberos tickets directly and no trust relationship exists so it requests that the user enter credentials.</span></span> |
| <span data-ttu-id="c1f13-327">5. L’utilisateur envoie un ticket Kerberos au STS AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-327">5. The user sends a Kerberos ticket to the AD FS STS.</span></span> |<span data-ttu-id="c1f13-328">5. L’utilisateur saisit le même mot de passe local et Azure AD le valide en fonction du nom d’utilisateur et du mot de passe qui ont été synchronisés par DirSync.</span><span class="sxs-lookup"><span data-stu-id="c1f13-328">5. The user enters the same on-premises password, and Azure AD validates them against the user name and password that was synchronized by DirSync.</span></span> |
| <span data-ttu-id="c1f13-329">6. AD FS transforme le ticket Kerberos pour les revendications/le format de jeton requis et redirige l’utilisateur vers Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c1f13-329">6. AD FS transforms the Kerberos ticket to the required token format/claims and redirects the user to Azure AD.</span></span> |<span data-ttu-id="c1f13-330">6. Azure AD redirige l’utilisateur vers Office 365.</span><span class="sxs-lookup"><span data-stu-id="c1f13-330">6. Azure AD redirects the user to Office 365.</span></span> |
| <span data-ttu-id="c1f13-331">7. L’utilisateur s’authentifie à Azure AD (une autre transformation se produit).</span><span class="sxs-lookup"><span data-stu-id="c1f13-331">7. The user authenticates to Azure AD (another transformation occurs).</span></span> |<span data-ttu-id="c1f13-332">7. L’utilisateur peut se connecter à Office 365 et OWA à l’aide du jeton Azure AD.</span><span class="sxs-lookup"><span data-stu-id="c1f13-332">7. The user can sign in to Office 365 and OWA using the Azure AD token.</span></span> |
| <span data-ttu-id="c1f13-333">8. Azure AD redirige l’utilisateur vers Office 365.</span><span class="sxs-lookup"><span data-stu-id="c1f13-333">8. Azure AD redirects the user to Office 365.</span></span> | |
| <span data-ttu-id="c1f13-334">9. L’utilisateur est connecté en mode silencieux à Office 365.</span><span class="sxs-lookup"><span data-stu-id="c1f13-334">9. The user is silently signed on to Office 365.</span></span> | |

<span data-ttu-id="c1f13-335">Dans le scénario de connexion à Office 365 avec la synchronisation de mot de passe (sans AD FS), l’authentification unique est remplacée par « l’authentification identique » où « identique » signifie simplement que les utilisateurs doivent confirmer leurs informations d’identification locales identiques lorsqu’ils accèdent à Office 365.</span><span class="sxs-lookup"><span data-stu-id="c1f13-335">In the Office 365 with DirSync with password sync scenario (no AD FS), single sign-on is replaced by “same sign-on” where “same” simply means that users must re-enter their same on-premises credentials when accessing Office 365.</span></span> <span data-ttu-id="c1f13-336">Veuillez noter que ces informations peuvent être conservées par le navigateur de l’utilisateur, ce qui permet de réduire le nombre d’invites à chaque tentative de connexion.</span><span class="sxs-lookup"><span data-stu-id="c1f13-336">Note that this data can be remembered by the user’s browser to help reduce subsequent prompts.</span></span>

### <a name="additional-food-for-thought"></a><span data-ttu-id="c1f13-337">Autres éléments de réflexion</span><span class="sxs-lookup"><span data-stu-id="c1f13-337">Additional food for thought</span></span>
* <span data-ttu-id="c1f13-338">Si vous déployez un proxy AD FS sur une machine virtuelle Azure, une connectivité aux serveurs AD FS est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="c1f13-338">If you deploy an AD FS proxy on an Azure virtual machine, connectivity to the AD FS servers is needed.</span></span> <span data-ttu-id="c1f13-339">Si ces serveurs sont locaux, nous vous recommandons de tirer parti de la connectivité VPN site à site fournie par le réseau virtuel pour permettre aux nœuds de proxy d’application web de communiquer avec leurs serveurs AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-339">If they are on-premises, it is recommended that you leverage the site-to-site VPN connectivity provided by the virtual network to allow the Web Application Proxy nodes to communicate with their AD FS servers.</span></span>
* <span data-ttu-id="c1f13-340">Si vous déployez un serveur AD FS sur une machine virtuelle Azure, la connectivité aux contrôleurs de domaine Windows Server Active Directory, aux magasins d’attributs et aux bases de données de configuration est nécessaire et peut également nécessiter une ExpressRoute ou une connexion VPN site à site entre le réseau virtuel Azure et le réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-340">If you deploy an AD FS server on an Azure virtual machine, connectivity to Windows Server Active Directory domain controllers, Attribute Stores, and Configuration databases is necessary and may also require an ExpressRoute or a site-to-site VPN connection between the Azure virtual network and the on-premises network.</span></span>
* <span data-ttu-id="c1f13-341">Des frais supplémentaires s’appliquent pour l’ensemble du trafic à partir des machines virtuelles Azure (trafic sortant).</span><span class="sxs-lookup"><span data-stu-id="c1f13-341">Charges are applied to all traffic from Azure virtual machines (egress traffic).</span></span> <span data-ttu-id="c1f13-342">Si le coût est un facteur déterminant, nous vous recommandons de déployer les nœuds de proxy d’application web sur Azure, en laissant les serveurs AD FS en local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-342">If cost is the driving factor, it is advisable to deploy the Web Application Proxy nodes on Azure, leaving the AD FS servers on-premises.</span></span> <span data-ttu-id="c1f13-343">Si les serveurs AD FS sont déployés sur des machines virtuelles Azure, des frais supplémentaires s’appliquent pour authentifier les utilisateurs locaux.</span><span class="sxs-lookup"><span data-stu-id="c1f13-343">If the AD FS servers are deployed on Azure virtual machines as well, additional costs will be incurred to authenticate on-premises users.</span></span> <span data-ttu-id="c1f13-344">Le trafic sortant génère un coût, qu’il traverse ou non l’ExpressRoute ou la connexion VPN site à site.</span><span class="sxs-lookup"><span data-stu-id="c1f13-344">Egress traffic incurs a cost regardless of whether or not it is traversing the ExpressRoute or the VPN site-to-site connection.</span></span>
* <span data-ttu-id="c1f13-345">Si vous décidez d’utiliser les fonctionnalités Azure natives d’équilibrage de charge pour assurer la haute disponibilité des serveurs AD FS, notez que l’équilibrage de charge fournit les sondes utilisées pour déterminer l’intégrité des machines virtuelles dans le service cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-345">If you decide to use Azure’s native server load balancing capabilities for high availability of AD FS servers, note that load balancing provides probes that are used to determine the health of the virtual machines within the cloud service.</span></span> <span data-ttu-id="c1f13-346">Dans le cas de machines virtuelles Azure (par opposition à des rôles de travail ou web), une sonde personnalisée doit être utilisée puisque l’agent qui répond aux sondes par défaut n’est pas présent sur les machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-346">In the case of Azure virtual machines (as opposed to web or worker roles), a custom probe must be used since the agent that responds to the default probes is not present on Azure virtual machines.</span></span> <span data-ttu-id="c1f13-347">Pour plus de simplicité, vous pouvez utiliser une sonde TCP personnalisée. Cela nécessite uniquement qu’une connexion TCP (un segment TCP SYN envoyé et qui obtient une réponse d’un segment TCP SYN ACK) soit correctement établie pour déterminer l’intégrité de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-347">For simplicity, you might use a custom TCP probe — this requires only that a TCP connection (a TCP SYN segment sent and responded to with a TCP SYN ACK segment) be successfully established to determine virtual machine health.</span></span> <span data-ttu-id="c1f13-348">Vous pouvez configurer la sonde personnalisée pour utiliser n’importe quel port TCP que vos machines virtuelles écoutent.</span><span class="sxs-lookup"><span data-stu-id="c1f13-348">You can configure the custom probe to use any TCP port to which your virtual machines are actively listening.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-349">Les machines qui ont besoin d’exposer le même ensemble de ports directement à Internet (tels que les ports 80 et 443) ne peuvent pas partager le même service cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-349">Machines that need to expose the same set of ports directly to the Internet (such as port 80 and 443) cannot share the same cloud service.</span></span> <span data-ttu-id="c1f13-350">Par conséquent, nous vous recommandons de créer un service cloud dédié pour vos serveurs Windows Server AD FS afin d’éviter les chevauchements éventuels entre les exigences de port pour une application et Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-350">It is, therefore, recommended that you create a dedicated cloud service for your Windows Server AD FS servers in order to avoid potential overlaps between port requirements for an application and Windows Server AD FS.</span></span>
> 
> 

## <a name="deployment-scenarios"></a><span data-ttu-id="c1f13-351">Scénarios de déploiement</span><span class="sxs-lookup"><span data-stu-id="c1f13-351">Deployment scenarios</span></span>
<span data-ttu-id="c1f13-352">La section suivante décrit les scénarios courants de déploiement et met l’accent sur les considérations importantes à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="c1f13-352">The following section outlines commonplace deployment scenarios to draw attention to important considerations that must be taken into account.</span></span> <span data-ttu-id="c1f13-353">Chaque scénario comporte des liens vers plus d’informations sur les décisions et les facteurs dont il faut tenir compte.</span><span class="sxs-lookup"><span data-stu-id="c1f13-353">Each scenario has links to more details about the decisions and factors to consider.</span></span>

1. [<span data-ttu-id="c1f13-354">AD DS : déployer une application compatible AD DS ne nécessitant pas de connectivité au réseau d’entreprise</span><span class="sxs-lookup"><span data-stu-id="c1f13-354">AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>](#BKMK_CloudOnly)
   
    <span data-ttu-id="c1f13-355">Par exemple, un service SharePoint accessible sur Internet est déployé sur une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-355">For example, an Internet-facing SharePoint service is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="c1f13-356">L’application n’a pas de dépendances sur les ressources du réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-356">The application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="c1f13-357">L’application nécessite Windows Server AD DS, mais NE nécessite PAS le Windows Server AD DS d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-357">The application does require Windows Server AD DS but does NOT require the corporate Windows Server AD DS.</span></span>
2. [<span data-ttu-id="c1f13-358">AD FS : étendre une application frontale locale prenant en charge les revendications à Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-358">AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>](#BKMK_CloudOnlyFed)
   
    <span data-ttu-id="c1f13-359">Par exemple, une application prenant en charge les revendications qui a été correctement déployée en local et utilisée par les utilisateurs d’entreprise doit devenir accessible à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-359">For example, a claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible from the Internet.</span></span> <span data-ttu-id="c1f13-360">L’application doit être accessible directement depuis Internet par des partenaires commerciaux à l’aide de leurs propres identités d’entreprise et par les utilisateurs d’entreprise existants.</span><span class="sxs-lookup"><span data-stu-id="c1f13-360">The application needs to be accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>
3. [<span data-ttu-id="c1f13-361">AD DS : déployer une application compatible Windows Server AD DS qui nécessite une connexion au réseau d’entreprise</span><span class="sxs-lookup"><span data-stu-id="c1f13-361">AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>](#BKMK_HybridExt)
   
    <span data-ttu-id="c1f13-362">Par exemple, une application compatible LDAP qui prend en charge l’authentification Windows intégrée et utilise Windows Server AD DS en tant que référentiel pour les données de profil utilisateur et de configuration est déployée sur une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-362">For example, an LDAP-aware application that supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user-profile data is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="c1f13-363">Il est souhaitable que l’application tire parti du Windows Server AD DS d’entreprise existant et fournisse une authentification unique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-363">It is desirable for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="c1f13-364">L’application ne prend pas en charge les revendications.</span><span class="sxs-lookup"><span data-stu-id="c1f13-364">The application is not claims-aware.</span></span>

### <span data-ttu-id="c1f13-365"><a name="BKMK_CloudOnly"></a>1. AD DS : déployer une application compatible AD DS ne nécessitant pas de connectivité au réseau d’entreprise</span><span class="sxs-lookup"><span data-stu-id="c1f13-365"><a name="BKMK_CloudOnly"></a>1. AD DS: Deploy an AD DS-aware application with no requirement for corporate network connectivity</span></span>
<span data-ttu-id="c1f13-366">![Déploiement AD DS dans le cloud seulement](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span><span class="sxs-lookup"><span data-stu-id="c1f13-366">![Cloud-only AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_cloud.png)
**Figure 1**</span></span>

#### <a name="description"></a><span data-ttu-id="c1f13-367">Description</span><span class="sxs-lookup"><span data-stu-id="c1f13-367">Description</span></span>
<span data-ttu-id="c1f13-368">SharePoint est déployé sur une machine virtuelle Azure et l’application n’a pas de dépendances sur les ressources du réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-368">SharePoint is deployed on an Azure virtual machine and the application has no dependencies on corporate-network resources.</span></span> <span data-ttu-id="c1f13-369">L’application nécessite Windows Server AD DS, mais ne nécessite *pas* le Windows Server AD DS d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-369">The application does require Windows Server AD DS but does *not* require the corporate Windows Server AD DS.</span></span> <span data-ttu-id="c1f13-370">Aucune approbation Kerberos ou fédérée n’est requise, puisque les utilisateurs sont configurés automatiquement via l’application dans le domaine Windows Server AD DS qui est également hébergé dans le cloud sur des machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-370">No Kerberos or federated trusts are required because users are self-provisioned through the application into the Windows Server AD DS domain that is also hosted in the cloud on Azure virtual machines.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="c1f13-371">Considérations sur le scénario et comment les domaines technologiques s’appliquent au scénario</span><span class="sxs-lookup"><span data-stu-id="c1f13-371">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="c1f13-372">[Topologie du réseau](#BKMK_NetworkTopology): créez un réseau virtuel Azure sans connectivité intersite (également appelée connectivité site à site).</span><span class="sxs-lookup"><span data-stu-id="c1f13-372">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network without cross-premises connectivity (also known as site-to-site connectivity).</span></span>
* <span data-ttu-id="c1f13-373">[Configuration du déploiement du contrôleur de domaine](#BKMK_DeploymentConfig): déployez un nouveau contrôleur de domaine dans une nouvelle forêt Windows Server Active Directory à un seul domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-373">[DC deployment configuration](#BKMK_DeploymentConfig): Deploy a new domain controller into a new, single-domain, Windows Server Active Directory forest.</span></span> <span data-ttu-id="c1f13-374">Ce déploiement doit être effectué en parallèle du déploiement du serveur DNS Windows.</span><span class="sxs-lookup"><span data-stu-id="c1f13-374">This should be deployed along with the Windows DNS server.</span></span>
* <span data-ttu-id="c1f13-375">[Topologie du site Windows Server Active Directory](#BKMK_ADSiteTopology): utilisez le site Windows Server Active Directory par défaut (tous les ordinateurs seront dans Default-First-Site-Name).</span><span class="sxs-lookup"><span data-stu-id="c1f13-375">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Use the default Windows Server Active Directory site (all computers will be in Default-First-Site-Name).</span></span>
* <span data-ttu-id="c1f13-376">[Adressage IP et DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="c1f13-376">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="c1f13-377">Définissez une adresse IP statique pour le contrôleur de domaine à l’aide de l’applet de commande Set-AzureStaticVNetIP Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c1f13-377">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="c1f13-378">Installez et configurez le serveur DNS Windows Server sur les contrôleurs de domaine sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-378">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="c1f13-379">Configurez les propriétés du réseau virtuel avec le nom et l’adresse IP de la machine virtuelle qui héberge les rôles de contrôleur de domaine et de serveur DNS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-379">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="c1f13-380">[Catalogue global](#BKMK_GC): le premier contrôleur de domaine de la forêt doit être un serveur de catalogue global.</span><span class="sxs-lookup"><span data-stu-id="c1f13-380">[Global Catalog](#BKMK_GC): The first DC in the forest must be a global catalog server.</span></span> <span data-ttu-id="c1f13-381">Les contrôleurs de domaine supplémentaires doivent également être configurés en tant que catalogues globaux car dans une forêt à un seul domaine, le catalogue global ne requiert aucun travail supplémentaire du contrôleur de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-381">Additional DCs should also be configured as GCs because in a single domain forest, the global catalog does not require any additional work from the DC.</span></span>
* <span data-ttu-id="c1f13-382">[Emplacement de la base de données Windows Server AD DS et SYSVOL](#BKMK_PlaceDB): ajoutez un disque de données aux contrôleurs de domaine exécutés en tant que machines virtuelles Azure, afin de stocker la base de données Windows Server Active Directory, les journaux et SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="c1f13-382">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running as Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="c1f13-383">[Sauvegarde et restauration](#BKMK_BUR): déterminez l’endroit où vous souhaitez stocker les sauvegardes de l’état du système.</span><span class="sxs-lookup"><span data-stu-id="c1f13-383">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="c1f13-384">Si nécessaire, ajoutez un autre disque de données à la machine virtuelle du contrôleur de domaine pour stocker les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-384">If necessary, add another data disk to the DC VM to store backups.</span></span>

### <span data-ttu-id="c1f13-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS : étendre une application frontale locale prenant en charge les revendications à Internet</span><span class="sxs-lookup"><span data-stu-id="c1f13-385"><a name="BKMK_CloudOnlyFed"></a>2 AD FS: Extend a claims-aware on-premises front-end application to the Internet</span></span>
<span data-ttu-id="c1f13-386">![Fédération avec connectivité intersite](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span><span class="sxs-lookup"><span data-stu-id="c1f13-386">![Federation with cross-premises connectivity](media/active-directory-deploying-ws-ad-guidelines/Federation_xprem.png)
**Figure 2**</span></span>

#### <a name="description"></a><span data-ttu-id="c1f13-387">Description</span><span class="sxs-lookup"><span data-stu-id="c1f13-387">Description</span></span>
<span data-ttu-id="c1f13-388">Une application prenant en charge les revendications qui a été correctement déployée en local et utilisée par les utilisateurs d’entreprise doit devenir directement accessible à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-388">A claims-aware application that has been successfully deployed on-premises and used by corporate users needs to become accessible directly from the Internet.</span></span> <span data-ttu-id="c1f13-389">L’application fait office de serveur web frontal pour une base de données SQL dans laquelle les données sont stockées.</span><span class="sxs-lookup"><span data-stu-id="c1f13-389">The application serves as a web frontend to a SQL database in which it stores data.</span></span> <span data-ttu-id="c1f13-390">Les serveurs SQL utilisés par l’application sont également disponibles sur le réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-390">The SQL servers used by the application are also located on the corporate network.</span></span> <span data-ttu-id="c1f13-391">Deux STS Windows Server AD FS et un équilibreur de charge ont été déployés en local pour fournir un accès aux utilisateurs d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-391">Two Windows Server AD FS STSs and a load-balancer have been deployed on-premises to provide access to the corporate users.</span></span> <span data-ttu-id="c1f13-392">L’application doit désormais être accessible directement depuis Internet par des partenaires commerciaux à l’aide de leurs propres identités d’entreprise et par les utilisateurs d’entreprise existants.</span><span class="sxs-lookup"><span data-stu-id="c1f13-392">The application now needs to be additionally accessed directly over the Internet both by business partners using their own corporate identities and by existing corporate users.</span></span>

<span data-ttu-id="c1f13-393">Dans le but de simplifier et de répondre aux besoins de déploiement et de configuration de cette nouvelle exigence, deux autres serveurs web frontaux et deux serveurs de proxy Windows Server AD FS sont installés sur les machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-393">In an effort to simplify and meet the deployment and configuration needs of this new requirement, it is decided that two additional web frontends and two Windows Server AD FS proxy servers be installed on Azure virtual machines.</span></span> <span data-ttu-id="c1f13-394">Les quatre machines virtuelles seront exposées directement à Internet et bénéficieront d’une connectivité au réseau local à l’aide de la fonctionnalité VPN site à site du réseau virtuel Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-394">All four VMs will be exposed directly to the Internet and will be provided connectivity to the on-premises network using Azure Virtual Network’s site-to-site VPN capability.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="c1f13-395">Considérations sur le scénario et comment les domaines technologiques s’appliquent au scénario</span><span class="sxs-lookup"><span data-stu-id="c1f13-395">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="c1f13-396">[Topologie du réseau](#BKMK_NetworkTopology) : créez un réseau virtuel Azure et [configurez la connectivité intersite](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-396">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network and [configure cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
  
  > [!NOTE]
  > <span data-ttu-id="c1f13-397">Pour chacun des certificats Windows Server AD FS, assurez-vous que l’URL définie dans le modèle de certificat et les certificats qui en résultent sont accessibles par les instances Windows Server AD FS s’exécutant sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-397">For each of the Windows Server AD FS certificates, ensure that the URL defined within the certificate template and the resulting certificates can be reached by the Windows Server AD FS instances running on Azure.</span></span> <span data-ttu-id="c1f13-398">Cela peut nécessiter une connectivité entre les différents locaux à des parties de votre infrastructure à clé publique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-398">This may require cross-premises connectivity to parts of your PKI infrastructure.</span></span> <span data-ttu-id="c1f13-399">Par exemple, si un point de terminaison de la liste de révocation de certificats est basé sur LDAP et hébergé exclusivement en local, alors une connectivité entre les différents locaux sera nécessaire.</span><span class="sxs-lookup"><span data-stu-id="c1f13-399">For example if the CRL's endpoint is LDAP-based and hosted exclusively on-premises, then cross-premises connectivity will be required.</span></span> <span data-ttu-id="c1f13-400">Si cela n’est pas souhaitable, vous pouvez utiliser des certificats émis par une autorité de certification dont la liste de révocation de certificats est accessible sur Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-400">If this is not desirable, it may be necessary to use certificates issued by a CA whose CRL is accessible over the Internet.</span></span>
  > 
  > 
* <span data-ttu-id="c1f13-401">[Configuration des services cloud](#BKMK_CloudSvcConfig): assurez-vous d’avoir deux services cloud pour fournir deux adresses IP virtuelles à équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-401">[Cloud services configuration](#BKMK_CloudSvcConfig): Ensure you have two cloud services in order provide two load-balanced virtual IP addresses.</span></span> <span data-ttu-id="c1f13-402">L’adresse IP virtuelle du premier service cloud est dirigée vers les deux machines virtuelles de proxy Windows Server AD FS sur les ports 80 et 443.</span><span class="sxs-lookup"><span data-stu-id="c1f13-402">The first cloud service’s virtual IP address will be directed to the two Windows Server AD FS proxy VMs on ports 80 and 443.</span></span> <span data-ttu-id="c1f13-403">Les machines virtuelles de proxy Windows Server AD FS sont configurées pour pointer vers l’adresse IP de l’équilibreur de charge local devant les STS Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-403">The Windows Server AD FS proxy VMs will be configured to point to the IP address of the on-premises load-balancer that fronts the Windows Server AD FS STSs.</span></span> <span data-ttu-id="c1f13-404">L’adresse IP virtuelle du deuxième service cloud est dirigée vers les deux machines virtuelles exécutant une nouvelle fois le serveur web frontal sur les ports 80 et 443.</span><span class="sxs-lookup"><span data-stu-id="c1f13-404">The second cloud service’s virtual IP address will be directed to the two VMs running the web frontend again on ports 80 and 443.</span></span> <span data-ttu-id="c1f13-405">Configurez une sonde personnalisée pour vous assurer que l’équilibreur de charge dirige uniquement le trafic vers les machines virtuelles du serveur web frontal et de proxy Windows Server AD FS en cours de fonctionnement.</span><span class="sxs-lookup"><span data-stu-id="c1f13-405">Configure a custom probe to ensure the load-balancer only directs traffic to functioning Windows Server AD FS proxy and web frontend VMs.</span></span>
* <span data-ttu-id="c1f13-406">[Configuration du serveur de fédération](#BKMK_FedSrvConfig): configurez Windows Server AD FS en tant que serveur de fédération (STS), afin de générer des jetons de sécurité pour la forêt Windows Server Active Directory créée dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-406">[Federation server configuration](#BKMK_FedSrvConfig): Configure Windows Server AD FS as a federation server (STS) to generate security tokens for the Windows Server Active Directory forest created in the cloud.</span></span> <span data-ttu-id="c1f13-407">Définissez des relations d’approbation de fournisseur de revendications de fédération avec les différents partenaires dont vous souhaitez accepter les identités et configurez des relations d’approbation de partie de confiance avec les différentes applications pour lesquelles vous souhaitez générer des jetons.</span><span class="sxs-lookup"><span data-stu-id="c1f13-407">Set federation claims provider trust relationships with the different partners you wish to accept identities from, and configure relying party trust relationships with the different applications you want to generate tokens to.</span></span>
  
    <span data-ttu-id="c1f13-408">Dans la plupart des scénarios, les serveurs de proxy Windows Server AD FS sont déployés dans une fonctionnalité sur Internet pour des raisons de sécurité, tandis que leurs homologues de fédération Windows Server AD FS restent isolés d’une connectivité directe à Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-408">In most scenarios, Windows Server AD FS proxy servers are deployed in an Internet-facing capacity for security purposes while their Windows Server AD FS federation counterparts remain isolated from direct Internet connectivity.</span></span> <span data-ttu-id="c1f13-409">Quel que soit votre scénario de déploiement, vous devez configurer votre service cloud avec une adresse IP virtuelle qui fournira une adresse IP exposée publiquement et le port qui est en mesure d’équilibrer la charge entre vos deux instances STS Windows Server AD FS ou de proxy.</span><span class="sxs-lookup"><span data-stu-id="c1f13-409">Regardless of your deployment scenario, you must configure your cloud service with a virtual IP address that will provide a publicly exposed IP address and port that is able to load-balance across either your two Windows Server AD FS STS instances or proxy instances.</span></span>
* <span data-ttu-id="c1f13-410">[Configuration de la haute disponibilité de Windows Server AD FS](#BKMK_ADFSHighAvail): nous vous recommandons de déployer une batterie Windows Server AD FS avec au moins deux serveurs pour le basculement et l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-410">[Windows Server AD FS high availability configuration](#BKMK_ADFSHighAvail): It is advisable to deploy a Windows Server AD FS farm with at least two servers for failover and load balancing.</span></span> <span data-ttu-id="c1f13-411">Vous pouvez envisager l’utilisation de la base de données interne Windows (WID) pour les données de configuration Windows Server AD FS et vous servir de la fonction d’équilibrage de charge interne d’Azure pour répartir les demandes entrantes sur les serveurs de la batterie.</span><span class="sxs-lookup"><span data-stu-id="c1f13-411">You might want to consider using the Windows Internal Database (WID) for Windows Server AD FS configuration data, and use the internal load balancing capability of Azure to distribute incoming requests across the servers in the farm.</span></span>

<span data-ttu-id="c1f13-412">Pour plus d’informations, consultez le [Guide de déploiement d’AD DS](https://technet.microsoft.com/library/cc753963).</span><span class="sxs-lookup"><span data-stu-id="c1f13-412">For more information, see the [AD DS Deployment Guide](https://technet.microsoft.com/library/cc753963).</span></span>

### <span data-ttu-id="c1f13-413"><a name="BKMK_HybridExt"></a>3. AD DS : déployer une application compatible Windows Server AD DS qui nécessite une connexion au réseau d’entreprise</span><span class="sxs-lookup"><span data-stu-id="c1f13-413"><a name="BKMK_HybridExt"></a>3. AD DS: Deploy a Windows Server AD DS-aware application that requires connectivity to the corporate network</span></span>
<span data-ttu-id="c1f13-414">![Déploiement AD DS dans différents locaux](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span><span class="sxs-lookup"><span data-stu-id="c1f13-414">![Cross-premises AD DS deployment](media/active-directory-deploying-ws-ad-guidelines/ADDS_xprem.png)
**Figure 3**</span></span>

#### <a name="description"></a><span data-ttu-id="c1f13-415">Description</span><span class="sxs-lookup"><span data-stu-id="c1f13-415">Description</span></span>
<span data-ttu-id="c1f13-416">Une application compatible LDAP est déployée sur une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-416">An LDAP-aware application is deployed on an Azure virtual machine.</span></span> <span data-ttu-id="c1f13-417">Elle prend en charge l’authentification Windows intégrée et utilise Windows Server AD DS comme référentiel pour les données de profil utilisateur et de configuration.</span><span class="sxs-lookup"><span data-stu-id="c1f13-417">It supports Windows-integrated authentication and uses Windows Server AD DS as a repository for configuration and user profile data.</span></span> <span data-ttu-id="c1f13-418">L’objectif est que l’application tire parti du Windows Server AD DS d’entreprise existant et fournisse une authentification unique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-418">The goal is for the application to leverage the existing corporate Windows Server AD DS and provide single sign-on.</span></span> <span data-ttu-id="c1f13-419">L’application ne prend pas en charge les revendications.</span><span class="sxs-lookup"><span data-stu-id="c1f13-419">The application is not claims-aware.</span></span> <span data-ttu-id="c1f13-420">Les utilisateurs doivent également accéder à l’application directement à partir d’Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-420">Users also need to access the application directly from the Internet.</span></span> <span data-ttu-id="c1f13-421">Pour optimiser les performances et les coûts, les deux contrôleurs de domaine supplémentaires, qui font partie du domaine d’entreprise, sont déployés avec l’application dans Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-421">To optimize for performance and cost, it is decided that two additional domain controllers that are part of the corporate domain be deployed alongside the application on Azure.</span></span>

#### <a name="scenario-considerations-and-how-technology-areas-apply-to-the-scenario"></a><span data-ttu-id="c1f13-422">Considérations sur le scénario et comment les domaines technologiques s’appliquent au scénario</span><span class="sxs-lookup"><span data-stu-id="c1f13-422">Scenario considerations and how technology areas apply to the scenario</span></span>
* <span data-ttu-id="c1f13-423">[Topologie du réseau](#BKMK_NetworkTopology) : créez un réseau virtuel Azure avec [une connectivité intersite](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-423">[Network topology](#BKMK_NetworkTopology): Create an Azure virtual network with [cross-premises connectivity](../vpn-gateway/vpn-gateway-site-to-site-create.md).</span></span>
* <span data-ttu-id="c1f13-424">[Méthode d’installation](#BKMK_InstallMethod): déployez des contrôleurs de domaine réplicas à partir du domaine Windows Server Active Directory d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-424">[Installation method](#BKMK_InstallMethod): Deploy replica DCs from the corporate Windows Server Active Directory domain.</span></span> <span data-ttu-id="c1f13-425">Pour un contrôleur de domaine réplica, vous pouvez installer Windows Server AD DS sur la machine virtuelle et éventuellement utiliser la fonctionnalité d’installation à partir d’un support pour réduire la quantité de données devant être répliquées sur le nouveau contrôleur de domaine lors de l’installation.</span><span class="sxs-lookup"><span data-stu-id="c1f13-425">For a replica DC, you can install Windows Server AD DS on the VM, and optionally use the Install From Media (IFM) feature to reduce the amount of data that needs to be replicated to the new DC during installation.</span></span> <span data-ttu-id="c1f13-426">Pour obtenir un didacticiel, consultez [Installation d’un contrôleur de domaine Active Directory réplica dans Azure](active-directory-install-replica-active-directory-domain-controller.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-426">For a tutorial, see [Install a replica Active Directory domain controller on Azure](active-directory-install-replica-active-directory-domain-controller.md).</span></span> <span data-ttu-id="c1f13-427">Même si vous recourez à cette fonctionnalité, il peut être plus efficace de créer le contrôleur de domaine en local et de déplacer l’intégralité du disque dur virtuel dans le cloud plutôt que de répliquer le Windows Server AD DS lors de l’installation.</span><span class="sxs-lookup"><span data-stu-id="c1f13-427">Even if you use IFM, it may be more efficient to build the virtual DC on-premises and move the entire Virtual Hard Disk (VHD) to the cloud instead of replicating Windows Server AD DS during installation.</span></span> <span data-ttu-id="c1f13-428">Pour des raisons de sécurité, nous vous recommandons de supprimer le disque dur virtuel du réseau local une fois qu’il a été copié dans Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-428">For safety, it is recommended that you delete the VHD from the on-premises network once it has been copied to Azure.</span></span>
* <span data-ttu-id="c1f13-429">[Topologie du site Windows Server Active Directory](#BKMK_ADSiteTopology): créez un nouveau site Azure dans les sites et services Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-429">[Windows Server Active Directory site topology](#BKMK_ADSiteTopology): Create a new Azure site in Active Directory Sites and Services.</span></span> <span data-ttu-id="c1f13-430">Créez un objet de sous-réseau de Windows Server Active Directory pour représenter le réseau virtuel Azure, puis ajoutez le sous-réseau au site.</span><span class="sxs-lookup"><span data-stu-id="c1f13-430">Create a Windows Server Active Directory subnet object to represent the Azure virtual network and add the subnet to the site.</span></span> <span data-ttu-id="c1f13-431">Créez un nouveau lien de sites comprenant le nouveau site Azure et le site dans lequel le point de terminaison VPN du réseau virtuel Azure se trouve pour contrôler et optimiser le trafic Windows Server Active Directory depuis et vers Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-431">Create a new site link that includes the new Azure site and the site in which the Azure virtual network VPN endpoint is located in order to control and optimize Windows Server Active Directory traffic to and from Azure.</span></span>
* <span data-ttu-id="c1f13-432">[Adressage IP et DNS](#BKMK_IPAddressDNS):</span><span class="sxs-lookup"><span data-stu-id="c1f13-432">[IP addressing and DNS](#BKMK_IPAddressDNS):</span></span>
  
  * <span data-ttu-id="c1f13-433">Définissez une adresse IP statique pour le contrôleur de domaine à l’aide de l’applet de commande Set-AzureStaticVNetIP Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c1f13-433">Set a static IP address for the DC by using the Set-AzureStaticVNetIP Azure PowerShell cmdlet.</span></span>
  * <span data-ttu-id="c1f13-434">Installez et configurez le serveur DNS Windows Server sur les contrôleurs de domaine sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-434">Install and configure Windows Server DNS on the domain controller(s) on Azure.</span></span>
  * <span data-ttu-id="c1f13-435">Configurez les propriétés du réseau virtuel avec le nom et l’adresse IP de la machine virtuelle qui héberge les rôles de contrôleur de domaine et de serveur DNS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-435">Configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles.</span></span>
* <span data-ttu-id="c1f13-436">[Contrôleurs de domaine géolocalisés](#BKMK_DistributedDCs): configurez les réseaux virtuels supplémentaires si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="c1f13-436">[Geo-distributed DCs](#BKMK_DistributedDCs): Configure additional virtual networks as needed.</span></span> <span data-ttu-id="c1f13-437">Si votre topologie de site Active Directory nécessite des contrôleurs de domaine dans des zones géographiques qui correspondent à différentes régions Azure, vous devez alors créer des sites Active Directory en conséquence.</span><span class="sxs-lookup"><span data-stu-id="c1f13-437">If your Active Directory site topology requires DCs in geographies that correspond to different Azure regions, than you want to create Active Directory sites accordingly.</span></span>
* <span data-ttu-id="c1f13-438">[Contrôleurs de domaine en lecture seule](#BKMK_RODC): vous pouvez déployer un contrôleur de domaine en lecture seule dans le site Azure selon vos conditions requises pour effectuer des opérations d’écriture sur le contrôleur de domaine et la compatibilité des applications et services dans le site avec les contrôleurs de domaine en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c1f13-438">[Read-only DCs](#BKMK_RODC): You might deploy an RODC in the Azure site, depending on your requirements for performing write operations against the DC and the compatibility of applications and services in the site with RODCs.</span></span> <span data-ttu-id="c1f13-439">Pour plus d’informations sur la compatibilité des applications, consultez le [guide de compatibilité des applications de contrôleurs de domaine en lecture seule](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="c1f13-439">For more information about application compatibility, see the [Read-Only domain controllers application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>
* <span data-ttu-id="c1f13-440">[Catalogue global](#BKMK_GC): des catalogues globaux sont nécessaires pour traiter les demandes de connexion dans les forêts avec plusieurs domaines.</span><span class="sxs-lookup"><span data-stu-id="c1f13-440">[Global Catalog](#BKMK_GC): GCs are needed to service logon requests in multidomain forests.</span></span> <span data-ttu-id="c1f13-441">Si vous ne déployez pas de catalogue global dans le site Azure, des coûts relatifs au trafic sortant vous seront facturés, puisque les demandes d’authentification entraînent des requêtes au niveau des catalogues globaux sur d’autres sites.</span><span class="sxs-lookup"><span data-stu-id="c1f13-441">If you do not deploy a GC in the Azure site, you will incur egress traffic costs as authentication requests cause queries GCs in other sites.</span></span> <span data-ttu-id="c1f13-442">Pour réduire ce trafic, vous pouvez activer la mise en cache de l’appartenance au groupe universel pour le site Azure dans les sites et services Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-442">To minimize that traffic, you can enable universal group membership caching for the Azure site in Active Directory Sites and Services.</span></span>
  
    <span data-ttu-id="c1f13-443">Si vous déployez un catalogue global, configurez les liens de sites et les coûts de liens de sites afin que le catalogue global dans le site Azure ne soit pas utilisé comme source du contrôleur de domaine par d’autres catalogues globaux qui doivent répliquer les mêmes partitions partielles de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-443">If you deploy a GC, configure site links and site links costs so that the GC in the Azure site is not preferred as a source DC by other GCs that need to replicate the same partial domain partitions.</span></span>
* <span data-ttu-id="c1f13-444">[Emplacement de la base de données Windows Server AD DS et SYSVOL](#BKMK_PlaceDB): ajoutez un disque de données aux contrôleurs de domaine exécutés sur des machines virtuelles Azure afin de stocker la base de données Windows Server Active Directory, les journaux et SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="c1f13-444">[Placement of the Windows Server AD DS database and SYSVOL](#BKMK_PlaceDB): Add a data disk to DCs running on Azure VMs in order to store the Windows Server Active Directory database, logs, and SYSVOL.</span></span>
* <span data-ttu-id="c1f13-445">[Sauvegarde et restauration](#BKMK_BUR): déterminez l’endroit où vous souhaitez stocker les sauvegardes de l’état du système.</span><span class="sxs-lookup"><span data-stu-id="c1f13-445">[Backup and Restore](#BKMK_BUR): Determine where you want to store system state backups.</span></span> <span data-ttu-id="c1f13-446">Si nécessaire, ajoutez un autre disque de données à la machine virtuelle du contrôleur de domaine pour stocker les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-446">If necessary, add another data disk to the DC VM to store backups.</span></span>

## <a name="deployment-decisions-and-factors"></a><span data-ttu-id="c1f13-447">Facteurs et décisions relatifs au déploiement</span><span class="sxs-lookup"><span data-stu-id="c1f13-447">Deployment decisions and factors</span></span>
<span data-ttu-id="c1f13-448">Le tableau suivant résume les domaines technologiques de Windows Server Active Directory qui sont affectés dans les scénarios précédents et les décisions correspondantes à prendre en compte, avec des liens pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="c1f13-448">This table summarizes the Windows Server Active Directory technology areas that are impacted in the preceding scenarios and the corresponding decisions to consider, with links to more detail below.</span></span> <span data-ttu-id="c1f13-449">Certains domaines technologiques peuvent ne pas être applicables à tous les scénarios de déploiement, et certains domaines technologiques peuvent être plus importants pour un scénario de déploiement que les autres domaines technologiques.</span><span class="sxs-lookup"><span data-stu-id="c1f13-449">Some technology areas might not be applicable to every deployment scenario, and some technology areas might be more critical to a deployment scenario than other technology areas.</span></span>

<span data-ttu-id="c1f13-450">Par exemple, si vous déployez un contrôleur de domaine réplica dans un réseau virtuel et que votre forêt ne dispose que d’un seul domaine, alors choisir de déployer un serveur de catalogue global n’affectera pas le scénario de déploiement, étant donné qu’aucune exigence de réplication supplémentaire ne sera générée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-450">For example, if you deploy a replica DC on a virtual network and your forest has only a single domain, then choosing to deploy a global catalog server in that case will not be critical to the deployment scenario because it will not create any additional replication requirements.</span></span> <span data-ttu-id="c1f13-451">En revanche, si la forêt possède plusieurs domaines, alors la décision de déployer un catalogue global sur un réseau virtuel peut affecter la bande passante disponible, les performances, l’authentification, les recherches dans le référentiel, etc.</span><span class="sxs-lookup"><span data-stu-id="c1f13-451">On the other hand, if the forest has several domains, then the decision to deploy a global catalog on a virtual network could affect available bandwidth, performance, authentication, directory lookups, and so on.</span></span>

| <span data-ttu-id="c1f13-452">Domaine technologique Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="c1f13-452">Windows Server Active Directory technology area</span></span> | <span data-ttu-id="c1f13-453">Décisions</span><span class="sxs-lookup"><span data-stu-id="c1f13-453">Decisions</span></span> | <span data-ttu-id="c1f13-454">Facteurs</span><span class="sxs-lookup"><span data-stu-id="c1f13-454">Factors</span></span> |
| --- | --- | --- |
| [<span data-ttu-id="c1f13-455">Topologie du réseau</span><span class="sxs-lookup"><span data-stu-id="c1f13-455">Network topology</span></span>](#BKMK_NetworkTopology) |<span data-ttu-id="c1f13-456">Devez-vous créer un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-456">Do you create a virtual network?</span></span> |<li><span data-ttu-id="c1f13-457">Configuration requise pour accéder aux ressources d’entreprise</span><span class="sxs-lookup"><span data-stu-id="c1f13-457">Requirements to access Corp resources</span></span></li> <li><span data-ttu-id="c1f13-458">Authentification</span><span class="sxs-lookup"><span data-stu-id="c1f13-458">Authentication</span></span></li> <li><span data-ttu-id="c1f13-459">Account Management</span><span class="sxs-lookup"><span data-stu-id="c1f13-459">Account management</span></span></li> |
| [<span data-ttu-id="c1f13-460">Configuration du déploiement du contrôleur de domaine</span><span class="sxs-lookup"><span data-stu-id="c1f13-460">DC deployment configuration</span></span>](#BKMK_DeploymentConfig) |<li><span data-ttu-id="c1f13-461">Déployer une forêt distincte sans aucune approbation ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-461">Deploy a separate forest without any trusts?</span></span></li> <li><span data-ttu-id="c1f13-462">Déployer une nouvelle forêt avec fédération ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-462">Deploy a new forest with federation?</span></span></li> <li><span data-ttu-id="c1f13-463">Déployer une nouvelle forêt avec approbation de forêt Windows Server Active Directory ou Kerberos ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-463">Deploy a new forest with Windows Server Active Directory forest trust or Kerberos?</span></span></li> <li><span data-ttu-id="c1f13-464">Étendre la forêt d’entreprise en déployant un contrôleur de domaine réplica ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-464">Extend Corp forest by deploying a replica DC?</span></span></li> <li><span data-ttu-id="c1f13-465">Étendre la forêt d’entreprise en déployant un nouveau domaine enfant ou une arborescence de domaine ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-465">Extend Corp forest by deploying a new child domain or domain tree?</span></span></li> |<li><span data-ttu-id="c1f13-466">Sécurité</span><span class="sxs-lookup"><span data-stu-id="c1f13-466">Security</span></span></li> <li><span data-ttu-id="c1f13-467">Conformité</span><span class="sxs-lookup"><span data-stu-id="c1f13-467">Compliance</span></span></li> <li><span data-ttu-id="c1f13-468">Coût</span><span class="sxs-lookup"><span data-stu-id="c1f13-468">Cost</span></span></li> <li><span data-ttu-id="c1f13-469">Résilience et tolérance de pannes</span><span class="sxs-lookup"><span data-stu-id="c1f13-469">Resiliency and fault-tolerance</span></span></li> <li><span data-ttu-id="c1f13-470">Compatibilité des applications</span><span class="sxs-lookup"><span data-stu-id="c1f13-470">Application compatibility</span></span></li> |
| [<span data-ttu-id="c1f13-471">Topologie du site Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="c1f13-471">Windows Server Active Directory site topology</span></span>](#BKMK_ADSiteTopology) |<span data-ttu-id="c1f13-472">Comment devez-vous configurer les liens de sites, sites et sous-réseaux avec le réseau virtuel Azure pour optimiser le trafic et réduire les coûts ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-472">How do you configure subnets, sites, and site links with Azure Virtual Network to optimize traffic and minimize cost?</span></span> |<li><span data-ttu-id="c1f13-473">Définitions de site et de sous-réseau</span><span class="sxs-lookup"><span data-stu-id="c1f13-473">Subnet and site definitions</span></span></li> <li><span data-ttu-id="c1f13-474">Propriétés du lien de site et notification de modification</span><span class="sxs-lookup"><span data-stu-id="c1f13-474">Site link properties and change notification</span></span></li> <li><span data-ttu-id="c1f13-475">Compression de la réplication</span><span class="sxs-lookup"><span data-stu-id="c1f13-475">Replication compression</span></span></li> |
| [<span data-ttu-id="c1f13-476">Adressage IP et DNS</span><span class="sxs-lookup"><span data-stu-id="c1f13-476">IP addressing and DNS</span></span>](#BKMK_IPAddressDNS) |<span data-ttu-id="c1f13-477">Comment configurer les adresses IP et la résolution de noms ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-477">How to configure IP addresses and name resolution?</span></span> |<li><span data-ttu-id="c1f13-478">Utilisez la cmdlet Set-AzureStaticVNetIP pour attribuer une adresse IP statique</span><span class="sxs-lookup"><span data-stu-id="c1f13-478">Use the Use the Set-AzureStaticVNetIP cmdlet to assign a static IP address</span></span></li> <li><span data-ttu-id="c1f13-479">Installez le serveur DNS Windows Server et configurez les propriétés du réseau virtuel avec le nom et l’adresse IP de la machine virtuelle qui héberge les rôles de contrôleur de domaine et de serveur DNS</span><span class="sxs-lookup"><span data-stu-id="c1f13-479">Install Windows Server DNS server and configure the virtual network properties with the name and IP address of the VM that hosts the DC and DNS server roles</span></span></li> |
| [<span data-ttu-id="c1f13-480">Contrôleurs de domaine géolocalisés</span><span class="sxs-lookup"><span data-stu-id="c1f13-480">Geo-distributed DCs</span></span>](#BKMK_DistributedDCs) |<span data-ttu-id="c1f13-481">Comment répliquer les contrôleurs de domaine sur des réseaux virtuels distincts ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-481">How to replicate to DCs on separate virtual networks?</span></span> |<span data-ttu-id="c1f13-482">Si votre topologie de site Active Directory nécessite des contrôleurs de domaine dans des zones géographiques qui correspondent à différentes régions Azure, vous devez alors créer des sites Active Directory en conséquence.</span><span class="sxs-lookup"><span data-stu-id="c1f13-482">If your Active Directory site topology requires DCs in geographies that corresponds to different Azure regions, than you want to create Active Directory sites accordingly.</span></span> <span data-ttu-id="c1f13-483">[Configurez le réseau virtuel pour la connectivité du réseau virtuel](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) , afin d’assurer la réplication entre les contrôleurs de domaine sur des réseaux virtuels distincts.</span><span class="sxs-lookup"><span data-stu-id="c1f13-483">[Configure virtual network to virtual network Connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) to replicate between domain controllers on separate virtual networks.</span></span> |
| [<span data-ttu-id="c1f13-484">Contrôleurs de domaine en lecture seule</span><span class="sxs-lookup"><span data-stu-id="c1f13-484">Read-only DCs</span></span>](#BKMK_RODC) |<span data-ttu-id="c1f13-485">Utilisez des contrôleurs de domaine en lecture seule ou en écriture ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-485">Use read-only or writeable DCs?</span></span> |<li><span data-ttu-id="c1f13-486">Filtrage des attributs HBI/PII</span><span class="sxs-lookup"><span data-stu-id="c1f13-486">Filter HBI/PII attributes</span></span></li> <li><span data-ttu-id="c1f13-487">Filtrage des secrets</span><span class="sxs-lookup"><span data-stu-id="c1f13-487">Filter secrets</span></span></li> <li><span data-ttu-id="c1f13-488">Limiter le trafic sortant</span><span class="sxs-lookup"><span data-stu-id="c1f13-488">Limit outbound traffic</span></span></li> |
| [<span data-ttu-id="c1f13-489">Catalogue global</span><span class="sxs-lookup"><span data-stu-id="c1f13-489">Global catalog</span></span>](#BKMK_GC) |<span data-ttu-id="c1f13-490">Installer un catalogue global ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-490">Install global catalog?</span></span> |<li><span data-ttu-id="c1f13-491">Pour une forêt à un seul domaine, configurez tous les contrôleurs de domaine en tant que catalogues globaux</span><span class="sxs-lookup"><span data-stu-id="c1f13-491">For single-domain forest, make all DCs GCs</span></span></li> <li><span data-ttu-id="c1f13-492">Pour une forêt à plusieurs domaines, les catalogues globaux sont requis pour l’authentification</span><span class="sxs-lookup"><span data-stu-id="c1f13-492">For multidomain forest, GCs are required for authentication</span></span></li> |
| [<span data-ttu-id="c1f13-493">Méthode d’installation</span><span class="sxs-lookup"><span data-stu-id="c1f13-493">Installation method</span></span>](#BKMK_InstallMethod) |<span data-ttu-id="c1f13-494">Comment installer un contrôleur de domaine dans Azure ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-494">How to install DC in Azure?</span></span> |<span data-ttu-id="c1f13-495">Au choix : </span><span class="sxs-lookup"><span data-stu-id="c1f13-495">Either:</span></span> <li><span data-ttu-id="c1f13-496">Installation d’AD DS à l’aide de Windows PowerShell ou Dcpromo</span><span class="sxs-lookup"><span data-stu-id="c1f13-496">Install AD DS using Windows PowerShell or Dcpromo</span></span></li> <li><span data-ttu-id="c1f13-497">Déplacer le disque dur virtuel d’un contrôleur de domaine virtuel local</span><span class="sxs-lookup"><span data-stu-id="c1f13-497">Move VHD of an on-premises virtual DC</span></span></li> |
| [<span data-ttu-id="c1f13-498">Emplacement de la base de données Windows Server AD DS et de SYSVOL</span><span class="sxs-lookup"><span data-stu-id="c1f13-498">Placement of the Windows Server AD DS database and SYSVOL</span></span>](#BKMK_PlaceDB) |<span data-ttu-id="c1f13-499">Où placer la base de données Windows Server AD DS, les journaux et SYSVOL ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-499">Where to store Windows Server AD DS database, logs, and SYSVOL?</span></span> |<span data-ttu-id="c1f13-500">Modifier les valeurs par défaut de Dcpromo.exe</span><span class="sxs-lookup"><span data-stu-id="c1f13-500">Change Dcpromo.exe default values.</span></span> <span data-ttu-id="c1f13-501">Ces fichiers Active Directory critiques *doivent* être placés sur des disques de données Azure plutôt que sur des disques de système d’exploitation qui implémentent le cache d’écriture.</span><span class="sxs-lookup"><span data-stu-id="c1f13-501">These critical Active Directory files *must* be placed on Azure Data Disks instead of Operating System disks that implement write caching.</span></span> |
| [<span data-ttu-id="c1f13-502">Sauvegarde et restauration</span><span class="sxs-lookup"><span data-stu-id="c1f13-502">Backup and Restore</span></span>](#BKMK_BUR) |<span data-ttu-id="c1f13-503">Comment sauvegarder et récupérer des données ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-503">How to safeguard and recover data?</span></span> |<span data-ttu-id="c1f13-504">Créer des sauvegardes d’états du système</span><span class="sxs-lookup"><span data-stu-id="c1f13-504">Create system state backups</span></span> |
| [<span data-ttu-id="c1f13-505">Configuration du serveur de fédération</span><span class="sxs-lookup"><span data-stu-id="c1f13-505">Federation server configuration</span></span>](#BKMK_FedSrvConfig) |<li><span data-ttu-id="c1f13-506">Déployer une nouvelle forêt avec fédération dans le cloud ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-506">Deploy a new forest with federation in the cloud?</span></span></li> <li><span data-ttu-id="c1f13-507">Déployer AD FS en local et exposer un proxy dans le cloud ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-507">Deploy AD FS on-premises and expose a proxy in the cloud?</span></span></li> |<li><span data-ttu-id="c1f13-508">Sécurité</span><span class="sxs-lookup"><span data-stu-id="c1f13-508">Security</span></span></li> <li><span data-ttu-id="c1f13-509">Conformité</span><span class="sxs-lookup"><span data-stu-id="c1f13-509">Compliance</span></span></li> <li><span data-ttu-id="c1f13-510">Coût</span><span class="sxs-lookup"><span data-stu-id="c1f13-510">Cost</span></span></li> <li><span data-ttu-id="c1f13-511">Accès aux applications par des partenaires commerciaux</span><span class="sxs-lookup"><span data-stu-id="c1f13-511">Access to applications by business partners</span></span></li> |
| [<span data-ttu-id="c1f13-512">Configuration des services cloud</span><span class="sxs-lookup"><span data-stu-id="c1f13-512">Cloud services configuration</span></span>](#BKMK_CloudSvcConfig) |<span data-ttu-id="c1f13-513">Un service cloud est déployé implicitement la première fois que vous créez une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-513">A cloud service is implicitly deployed the first time you create a virtual machine.</span></span> <span data-ttu-id="c1f13-514">Devez-vous déployer des services cloud supplémentaires ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-514">Do you need to deploy additional cloud services?</span></span> |<li><span data-ttu-id="c1f13-515">Une ou plusieurs machines virtuelles doivent-elles être directement exposées à Internet ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-515">Does a VM or VMs require direct exposure to the Internet?</span></span></li> <li> <span data-ttu-id="c1f13-516">Le service requiert-il un équilibrage de charge ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-516">Does the service require load-balancing?</span></span></li> |
| [<span data-ttu-id="c1f13-517">Configuration requise du serveur de fédération pour l’adressage IP privé et public (adresse IP dynamique et adresse IP virtuelle)</span><span class="sxs-lookup"><span data-stu-id="c1f13-517">Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>](#BKMK_FedReqVIPDIP) |<li><span data-ttu-id="c1f13-518">L’instance Windows Server AD FS doit-elle être accessible directement depuis Internet ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-518">Does the Windows Server AD FS instance need to be reached directly from the Internet?</span></span></li> <li><span data-ttu-id="c1f13-519">L’application déployée dans le cloud doit-elle avoir ses propres port et adresse IP accessibles sur Internet ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-519">Does the application being deployed in the cloud require its own Internet-facing IP address and port?</span></span></li> |<span data-ttu-id="c1f13-520">Créer un service cloud pour chaque adresse IP virtuelle requise par votre déploiement</span><span class="sxs-lookup"><span data-stu-id="c1f13-520">Create one cloud-service for each virtual IP address that is required by your deployment</span></span> |
| [<span data-ttu-id="c1f13-521">Configuration de la haute disponibilité de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="c1f13-521">Windows Server AD FS high availability configuration</span></span>](#BKMK_ADFSHighAvail) |<li><span data-ttu-id="c1f13-522">Combien y a-t-il de nœuds dans ma batterie de serveurs Windows Server AD FS ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-522">How many nodes in my Windows Server AD FS server farm?</span></span></li> <li><span data-ttu-id="c1f13-523">Combien y a-t-il de nœuds à déployer dans ma batterie de serveurs proxy Windows Server AD FS ?</span><span class="sxs-lookup"><span data-stu-id="c1f13-523">How many nodes to deploy in my Windows Server AD FS proxy farm?</span></span></li> |<span data-ttu-id="c1f13-524">Résilience et tolérance de pannes</span><span class="sxs-lookup"><span data-stu-id="c1f13-524">Resiliency and fault tolerance</span></span> |

### <span data-ttu-id="c1f13-525"><a name="BKMK_NetworkTopology"></a>Topologie du réseau</span><span class="sxs-lookup"><span data-stu-id="c1f13-525"><a name="BKMK_NetworkTopology"></a>Network topology</span></span>
<span data-ttu-id="c1f13-526">Pour respecter les exigences de cohérence des adresses IP et de DNS de Windows Server AD DS, vous devez d’abord créer un [réseau virtuel Azure](../virtual-network/virtual-networks-overview.md) auquel vous attacherez vos machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="c1f13-526">In order to meet the IP address consistency and DNS requirements of Windows Server AD DS, it is necessary to first create an [Azure virtual network](../virtual-network/virtual-networks-overview.md) and attach your virtual machines to it.</span></span> <span data-ttu-id="c1f13-527">Lors de sa création, vous devez décider d’étendre ou non la connectivité à votre réseau d’entreprise local, qui connecte les machines virtuelles Azure de façon transparente à des ordinateurs locaux. Cette opération est effectuée à l’aide de technologies VPN classiques et nécessite l’exposition d’un point de terminaison VPN sur le périmètre du réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-527">During its creation, you must decide whether to optionally extend connectivity to your on-premises corporate network, which transparently connects Azure virtual machines to on-premises machines — this is achieved using traditional VPN technologies and requires that a VPN endpoint be exposed on the edge of the corporate network.</span></span> <span data-ttu-id="c1f13-528">Autrement dit, le VPN est lancé à partir d’Azure sur le réseau d’entreprise, pas l’inverse.</span><span class="sxs-lookup"><span data-stu-id="c1f13-528">That is, the VPN is initiated from Azure to the corporate network, not vice-versa.</span></span>

<span data-ttu-id="c1f13-529">Notez que des frais supplémentaires s’appliquent lors de l’extension d’un réseau virtuel sur votre réseau local, en plus des frais standard appliqués pour chaque machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-529">Note that additional charges apply when extending a virtual network to your on-premises network beyond the standard charges that apply to each VM.</span></span> <span data-ttu-id="c1f13-530">Plus précisément, il existe des frais pour le temps processeur de la passerelle de réseau virtuel Azure et le trafic sortant généré par chaque machine virtuelle communiquant avec des ordinateurs locaux sur le VPN.</span><span class="sxs-lookup"><span data-stu-id="c1f13-530">Specifically, there are charges for CPU time of the Azure Virtual Network gateway and for the egress traffic generated by each VM that communicates with on-premises machines across the VPN.</span></span> <span data-ttu-id="c1f13-531">Pour plus d’informations sur les frais de trafic réseau, voir [Aperçu rapide de la tarification Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="c1f13-531">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

### <span data-ttu-id="c1f13-532"><a name="BKMK_DeploymentConfig"></a>Configuration du déploiement du contrôleur de domaine</span><span class="sxs-lookup"><span data-stu-id="c1f13-532"><a name="BKMK_DeploymentConfig"></a>DC deployment configuration</span></span>
<span data-ttu-id="c1f13-533">La manière dont vous configurez le contrôleur de domaine dépend de la configuration du service que vous souhaitez exécuter sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-533">The way you configure the DC depends on the requirements for the service you want to run on Azure.</span></span> <span data-ttu-id="c1f13-534">Par exemple, vous pouvez déployer une nouvelle forêt isolée de votre propre forêt d’entreprise pour tester une preuve de concept, une nouvelle application ou un autre projet à court terme qui nécessite des services d’annuaire, mais pas un accès spécifique aux ressources d’entreprise internes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-534">For example, you might deploy a new forest, isolated from your own corporate forest, for testing a proof-of-concept, a new application, or some other short term project that requires directory services but not specific access to internal corporate resources.</span></span>

<span data-ttu-id="c1f13-535">L’avantage est qu’un contrôleur de domaine de forêt isolée ne peut pas être répliqué avec des contrôleurs de domaine locaux, ce qui diminue le trafic réseau sortant généré par le système lui-même, réduisant directement les coûts.</span><span class="sxs-lookup"><span data-stu-id="c1f13-535">As a benefit, an isolated forest DC does not replicate with on-premises DCs, resulting in less outbound network traffic generated by the system itself, directly reducing costs.</span></span> <span data-ttu-id="c1f13-536">Pour plus d’informations sur les frais de trafic réseau, voir [Aperçu rapide de la tarification Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="c1f13-536">For more information about network traffic charges, see [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span>

<span data-ttu-id="c1f13-537">Prenons un autre exemple : supposons qu’un service exige la confidentialité, mais qu’il dépend de l’accès à Windows Server Active Directory en interne.</span><span class="sxs-lookup"><span data-stu-id="c1f13-537">As another example, suppose you have privacy requirements for a service, but the service depends on access to your internal Windows Server Active Directory.</span></span> <span data-ttu-id="c1f13-538">Si vous êtes autorisé à héberger des données pour le service dans le cloud, vous pouvez déployer un nouveau domaine enfant pour votre forêt interne sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-538">If you are allowed to host data for the service in the cloud, you might deploy a new child domain for your internal forest on Azure.</span></span> <span data-ttu-id="c1f13-539">Dans ce cas, vous pouvez déployer un contrôleur de domaine pour le nouveau domaine enfant (sans le catalogue global, pour faciliter la résolution des problèmes de confidentialité).</span><span class="sxs-lookup"><span data-stu-id="c1f13-539">In this case, you can deploy a DC for the new child domain (without the global catalog in order to help address privacy concerns).</span></span> <span data-ttu-id="c1f13-540">Ce scénario, combiné au déploiement d’un contrôleur de domaine réplica, nécessite un réseau virtuel pour la connectivité avec vos contrôleurs de domaine locaux.</span><span class="sxs-lookup"><span data-stu-id="c1f13-540">This scenario, along with a replica DC deployment, requires a virtual network for connectivity with your on-premises DCs.</span></span>

<span data-ttu-id="c1f13-541">Si vous créez une nouvelle forêt, choisissez s’il faut utiliser les [approbations Active Directory](https://technet.microsoft.com/library/cc771397) ou les [approbations de fédération](https://technet.microsoft.com/library/dd807036).</span><span class="sxs-lookup"><span data-stu-id="c1f13-541">If you create a new forest, choose whether to use [Active Directory trusts](https://technet.microsoft.com/library/cc771397) or [Federation trusts](https://technet.microsoft.com/library/dd807036).</span></span> <span data-ttu-id="c1f13-542">Équilibrez les exigences en matière de compatibilité, de sécurité, de conformité, de coût et de résilience.</span><span class="sxs-lookup"><span data-stu-id="c1f13-542">Balance the requirements dictated by compatibility, security, compliance, cost, and resiliency.</span></span> <span data-ttu-id="c1f13-543">Par exemple, pour tirer parti de [l’authentification sélective](https://technet.microsoft.com/library/cc755844) , vous pouvez choisir de déployer une nouvelle forêt sur Azure et de créer une approbation Windows Server Active Directory entre la forêt locale et la forêt du cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-543">For example, to take advantage of [selective authentication](https://technet.microsoft.com/library/cc755844) you might choose to deploy a new forest on Azure and create a Windows Server Active Directory trust between the on-premises forest and the cloud forest.</span></span> <span data-ttu-id="c1f13-544">Toutefois, si l’application prend en charge les revendications, vous pouvez déployer des approbations de fédération plutôt que des approbations de forêt Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c1f13-544">If the application is claims-aware, however, you might deploy federation trusts instead of Active Directory forest trusts.</span></span> <span data-ttu-id="c1f13-545">Un autre facteur est à prendre en compte : le coût de la réplication d’un plus grand nombre de données si vous étendez votre Windows Server Active Directory local dans le cloud, par rapport au coût de la génération d’un trafic sortant supplémentaire lié à la charge d’authentifications et de requêtes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-545">Another factor will be the cost to either replicate more data by extending your on-premises Windows Server Active Directory to the cloud or generate more outbound traffic as a result of authentication and query load.</span></span>

<span data-ttu-id="c1f13-546">Les exigences de disponibilité et de tolérance de pannes ont également une répercussion sur votre choix.</span><span class="sxs-lookup"><span data-stu-id="c1f13-546">Requirements for availability and fault tolerance also affect your choice.</span></span> <span data-ttu-id="c1f13-547">Par exemple, si le lien est interrompu, les applications exploitant une approbation Kerberos ou une approbation de fédération risquent d’être totalement isolées, sauf si vous avez déployé une infrastructure suffisante sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-547">For example, if the link is interrupted, applications leveraging either a Kerberos trust or a federation trust are all likely entirely broken unless you have deployed sufficient infrastructure on Azure.</span></span> <span data-ttu-id="c1f13-548">Les autres configurations de déploiement telles que les contrôleurs de domaine réplica (accessibles en écriture ou en lecture seule) augmentent la probabilité de tolérance aux pannes de liens.</span><span class="sxs-lookup"><span data-stu-id="c1f13-548">Alternative deployment configurations such as replica DCs (writeable or RODCs) increase the likelihood of being able to tolerate link outages.</span></span>

### <span data-ttu-id="c1f13-549"><a name="BKMK_ADSiteTopology"></a>Topologie du site Windows Server Active Directory</span><span class="sxs-lookup"><span data-stu-id="c1f13-549"><a name="BKMK_ADSiteTopology"></a>Windows Server Active Directory site topology</span></span>
<span data-ttu-id="c1f13-550">Vous devez définir correctement les sites et les liens des sites afin d’optimiser le trafic et de réduire les coûts.</span><span class="sxs-lookup"><span data-stu-id="c1f13-550">You need to correctly define sites and site links in order to optimize traffic and minimize cost.</span></span> <span data-ttu-id="c1f13-551">Les sites, les liens des sites et les sous-réseaux affectent la topologie de réplication entre les contrôleurs de domaine et le flux du trafic d’authentification.</span><span class="sxs-lookup"><span data-stu-id="c1f13-551">Sites, site-links, and subnets affect the replication topology between DCs and the flow of authentication traffic.</span></span> <span data-ttu-id="c1f13-552">Tenez compte des frais de trafic suivants, puis déployez et configurez des contrôleurs de domaine selon les besoins de votre scénario de déploiement :</span><span class="sxs-lookup"><span data-stu-id="c1f13-552">Consider the following traffic charges and then deploy and configure DCs according to the requirements of your deployment scenario:</span></span>

* <span data-ttu-id="c1f13-553">La passerelle elle-même implique des frais nominaux par heure :</span><span class="sxs-lookup"><span data-stu-id="c1f13-553">There is a nominal fee per hour for the gateway itself:</span></span>
  
  * <span data-ttu-id="c1f13-554">Elle peut être démarrée et arrêtée selon vos besoins.</span><span class="sxs-lookup"><span data-stu-id="c1f13-554">It can be started and stopped as you see fit</span></span>
  * <span data-ttu-id="c1f13-555">Si elle est arrêtée, les machines virtuelles Azure sont isolées du réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-555">If stopped, Azure VMs are isolated from the corporate network</span></span>
* <span data-ttu-id="c1f13-556">Le trafic entrant est gratuit.</span><span class="sxs-lookup"><span data-stu-id="c1f13-556">Inbound traffic is free</span></span>
* <span data-ttu-id="c1f13-557">Le trafic sortant est facturé, conformément à [l’Aperçu rapide de la tarification Azure](http://azure.microsoft.com/pricing/).</span><span class="sxs-lookup"><span data-stu-id="c1f13-557">Outbound traffic is charged, according to [Azure pricing at-a-glance](http://azure.microsoft.com/pricing/).</span></span> <span data-ttu-id="c1f13-558">Vous pouvez optimiser les propriétés des liens de sites entre les sites locaux et les sites dans le cloud comme suit :</span><span class="sxs-lookup"><span data-stu-id="c1f13-558">You can optimize site link properties between on-premises sites and the cloud sites as follows:</span></span>
  
  * <span data-ttu-id="c1f13-559">Si vous utilisez plusieurs réseaux virtuels, configurez les liens de sites et leurs coûts de manière à empêcher Windows Server AD DS de donner la priorité au site Azure plutôt qu’à un autre capable de fournir les mêmes niveaux de service sans frais.</span><span class="sxs-lookup"><span data-stu-id="c1f13-559">If you are using multiple virtual networks, configure the site-links and their costs appropriately to prevent Windows Server AD DS from prioritizing the Azure site over one that can provide the same levels of service at no charge.</span></span> <span data-ttu-id="c1f13-560">Vous pouvez également envisager de désactiver l’option Relier tous les liens de sites (qui est activée par défaut).</span><span class="sxs-lookup"><span data-stu-id="c1f13-560">You might also consider disabling the Bridge all site link (BASL) option (which is enabled by default).</span></span> <span data-ttu-id="c1f13-561">Cela garantit que seuls les sites connectés directement sont répliqués avec un autre.</span><span class="sxs-lookup"><span data-stu-id="c1f13-561">This ensures that only directly-connected sites replicate with one another.</span></span> <span data-ttu-id="c1f13-562">Les contrôleurs de domaine des sites connectés transitivement ne peuvent plus être répliqués directement entre eux, mais doivent être répliqués via un ou plusieurs sites communs.</span><span class="sxs-lookup"><span data-stu-id="c1f13-562">DCs in transitively connected sites are no longer able to replicate directly with each other, but must replicate through a common site or sites.</span></span> <span data-ttu-id="c1f13-563">Si les sites intermédiaires deviennent indisponibles pour une raison quelconque, la réplication entre les contrôleurs de domaine sur les sites connectés transitivement n’a pas lieu même si la connectivité entre les sites est disponible.</span><span class="sxs-lookup"><span data-stu-id="c1f13-563">If the intermediary sites become unavailable for some reason, replication between DCs in transitively connected sites will not occur even if connectivity between the sites is available.</span></span> <span data-ttu-id="c1f13-564">Enfin, chaque fois que des sections de comportement de réplication transitive restent souhaitables, créez des ponts de liaison de sites appropriés contenant des liens de sites et des sites, par exemple des sites locaux et des sites de réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-564">Finally, where sections of transitive replication behavior remain desirable, create site link bridges that contain the appropriate site-links and sites, such as on-premises, corporate network sites.</span></span>
  * <span data-ttu-id="c1f13-565">[Configurez les coûts des liens des sites](https://technet.microsoft.com/library/cc794882) de manière à éviter le trafic involontaire.</span><span class="sxs-lookup"><span data-stu-id="c1f13-565">[Configure site link costs](https://technet.microsoft.com/library/cc794882) appropriately to avoid unintended traffic.</span></span> <span data-ttu-id="c1f13-566">Par exemple, si le réglage **Essayer le site le plus proche suivant** est activé, vérifiez que les sites de réseau virtuel ne sont pas les sites les plus proches suivants en augmentant le coût associé de l’objet lien de sites qui connecte le site Azure au réseau d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-566">For example, if **Try Next Closest Site** setting is enabled, make sure the virtual network sites are not the next closest by increasing the cost associated of the site-link object that connects the Azure site back to the corporate network.</span></span>
  * <span data-ttu-id="c1f13-567">Configurez les [intervalles](https://technet.microsoft.com/library/cc794878) et les [planifications](https://technet.microsoft.com/library/cc816906) de liens de sites en fonction des exigences de cohérence et du taux de modifications d’objet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-567">Configure site link [intervals](https://technet.microsoft.com/library/cc794878) and [schedules](https://technet.microsoft.com/library/cc816906) according to consistency requirements and rate of object changes.</span></span> <span data-ttu-id="c1f13-568">Alignez la planification des réplications avec la tolérance de latence.</span><span class="sxs-lookup"><span data-stu-id="c1f13-568">Align replication schedule with latency tolerance.</span></span> <span data-ttu-id="c1f13-569">Les contrôleurs de domaine répliquent uniquement le dernier état d’une valeur, si bien que la diminution de l’intervalle de réplication peut réduire les coûts si le taux de modification d’objet est suffisant.</span><span class="sxs-lookup"><span data-stu-id="c1f13-569">DCs replicate only the last state of a value, so decreasing the replication interval can save costs if there is a sufficient object change rate.</span></span>
* <span data-ttu-id="c1f13-570">Si la réduction des coûts est une priorité, vérifiez que la réplication est planifiée et que la notification de modification n’est pas activée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-570">If minimizing costs is a priority, ensure replication is scheduled and change notification is not enabled.</span></span> <span data-ttu-id="c1f13-571">Il s’agit de la configuration par défaut lors de la réplication entre les sites.</span><span class="sxs-lookup"><span data-stu-id="c1f13-571">This is the default configuration when replicating between sites.</span></span> <span data-ttu-id="c1f13-572">Cela n’est pas important si vous déployez un contrôleur de domaine en lecture seule sur un réseau virtuel car ce type de contrôleur de domaine ne réplique aucune modification sortante.</span><span class="sxs-lookup"><span data-stu-id="c1f13-572">This is not important if you are deploying an RODC on a virtual network because the RODC will not replicate any changes outbound.</span></span> <span data-ttu-id="c1f13-573">Par contre, si vous déployez un contrôleur de domaine accessible en écriture, vous devez vous assurer que le lien de sites n’est pas configuré pour répliquer les mises à jour à une fréquence inutile.</span><span class="sxs-lookup"><span data-stu-id="c1f13-573">But if you deploy a writable DC, you should make sure the site link is not configured to replicate updates with unnecessary frequency.</span></span> <span data-ttu-id="c1f13-574">Si vous déployez un serveur de catalogue global (GC), assurez-vous que chaque autre site contenant un GC réplique les partitions de domaine à partir d’un contrôleur de domaine source dans un site connecté avec un lien de sites ou des liens de sites dont le coût est inférieur au GC du site Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-574">If you deploy a global catalog server (GC), make sure that every other site that contains a GC replicates domain partitions from a source DC in a site that is connected with a site-link or site-links that have a lower cost than the GC in the Azure site.</span></span>
* <span data-ttu-id="c1f13-575">Il est possible de réduire encore le trafic réseau généré par la réplication entre les sites en modifiant l’algorithme de compression de la réplication.</span><span class="sxs-lookup"><span data-stu-id="c1f13-575">It is possible to further still reduce network traffic generated by replication between sites by changing the replication compression algorithm.</span></span> <span data-ttu-id="c1f13-576">L’algorithme de compression est contrôlé par l’algorithme de compression HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicatorde l’entrée de registre REG_DWORD.</span><span class="sxs-lookup"><span data-stu-id="c1f13-576">The compression algorithm is controlled by the REG_DWORD registry entry HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\Replicator compression algorithm.</span></span> <span data-ttu-id="c1f13-577">La valeur par défaut est 3, qui effectue la corrélation avec l’algorithme de compression Xpress.</span><span class="sxs-lookup"><span data-stu-id="c1f13-577">The default value is 3, which correlates to the Xpress Compress algorithm.</span></span> <span data-ttu-id="c1f13-578">Vous pouvez remplacer la valeur par 2, ce qui modifie l’algorithme en MSZip.</span><span class="sxs-lookup"><span data-stu-id="c1f13-578">You can change the value to 2, which changes the algorithm to MSZip.</span></span> <span data-ttu-id="c1f13-579">Dans la plupart des cas, la compression augmente, au détriment de l’utilisation du processeur.</span><span class="sxs-lookup"><span data-stu-id="c1f13-579">In most cases, this will increase the compression, but it does so at the expense of CPU utilization.</span></span> <span data-ttu-id="c1f13-580">Pour plus d’informations, voir [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994)(Fonctionnement de la topologie de réplication Active Directory).</span><span class="sxs-lookup"><span data-stu-id="c1f13-580">For more information, see [How Active Directory replication topology works](https://technet.microsoft.com/library/cc755994).</span></span>

### <span data-ttu-id="c1f13-581"><a name="BKMK_IPAddressDNS"></a>Adressage IP et DNS</span><span class="sxs-lookup"><span data-stu-id="c1f13-581"><a name="BKMK_IPAddressDNS"></a>IP addressing and DNS</span></span>
<span data-ttu-id="c1f13-582">Par défaut, des « adresses avec bail DHCP » sont allouées aux machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-582">Azure virtual machines are allocated “DHCP-leased addresses” by default.</span></span> <span data-ttu-id="c1f13-583">Dans la mesure où les adresses dynamiques de réseau virtuel Azure persistent avec la machine virtuelle pendant toute sa durée de vie, les exigences de Windows Server AD DS sont satisfaites.</span><span class="sxs-lookup"><span data-stu-id="c1f13-583">Because Azure virtual network dynamic addresses persist with a virtual machine for the lifetime of the virtual machine, the requirements of Windows Server AD DS are met.</span></span>

<span data-ttu-id="c1f13-584">En conséquence, lorsque vous utilisez une adresse dynamique sur Azure, vous utilisez en fait une adresse IP statique car elle est routable pendant la durée du bail, et la durée du bail est égale à la durée de vie du service cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-584">As a result, when you use a dynamic address on Azure, you are in effect using a static IP address because it is routable for the period of the lease, and the period of the lease is equal to the lifetime of the cloud service.</span></span>

<span data-ttu-id="c1f13-585">Toutefois, l’adresse dynamique est désallouée si la machine virtuelle est arrêtée.</span><span class="sxs-lookup"><span data-stu-id="c1f13-585">However, the dynamic address is deallocated if the VM is shutdown.</span></span> <span data-ttu-id="c1f13-586">Pour éviter que l’adresse IP soit désallouée, vous pouvez [utiliser Set-AzureStaticVNetIP pour attribuer une adresse IP statique](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1f13-586">To prevent the IP address from being deallocated, you can [use Set-AzureStaticVNetIP to assign a static IP address](http://social.technet.microsoft.com/wiki/contents/articles/23447.how-to-assign-a-private-static-ip-to-an-azure-vm.aspx).</span></span>

<span data-ttu-id="c1f13-587">Pour la résolution de noms, déployez votre propre infrastructure de serveur DNS (ou exploitez celle qui existe déjà) ; le DNS fourni par Azure ne satisfait pas les besoins avancés de résolution de nom de Windows Server AD DS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-587">For name resolution, deploy your own (or leverage your existing) DNS server infrastructure; Azure-provided DNS does not meet the advanced name resolution needs of Windows Server AD DS.</span></span> <span data-ttu-id="c1f13-588">Par exemple, il ne prend pas en charge les enregistrements SRV dynamiques, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="c1f13-588">For example, it does not support dynamic SRV records, and so on.</span></span> <span data-ttu-id="c1f13-589">La résolution de noms est un élément de configuration critique pour les contrôleurs de domaine et les clients joints au domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-589">Name resolution is a critical configuration item for DCs and domain-joined clients.</span></span> <span data-ttu-id="c1f13-590">Les contrôleurs de domaine doivent être capables d’inscrire des enregistrements de ressource et de résoudre d’autres enregistrements de ressource de contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-590">DCs must be capable of registering resource records and resolving other DC’s resource records.</span></span>
<span data-ttu-id="c1f13-591">Pour des raisons de performances et de tolérance de pannes, il est souhaitable d’installer le service DNS de Windows Server sur les contrôleurs de domaine qui s’exécutent sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-591">For fault tolerance and performance reasons, it is optimal to install the Windows Server DNS service on the DCs running on Azure.</span></span> <span data-ttu-id="c1f13-592">Ensuite, configurez les propriétés du réseau virtuel Azure avec le nom et l’adresse IP du serveur DNS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-592">Then configure the Azure virtual network properties with the name and IP address of the DNS server.</span></span> <span data-ttu-id="c1f13-593">Lorsque d’autres machines virtuelles démarrent sur le réseau virtuel, leurs paramètres de résolution client DNS sont configurés avec le serveur DNS dans le cadre de l’allocation d’adresses IP dynamique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-593">When other VMs on the virtual network start, their DNS client resolver settings will be configured with DNS server as part of the dynamic IP address allocation.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-594">Vous ne pouvez pas joindre des ordinateurs locaux à un domaine Active Directory Windows Server AD DS hébergé sur Azure directement via Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-594">You cannot join on-premises computers to a Windows Server AD DS Active Directory domain that is hosted on Azure directly over the Internet.</span></span> <span data-ttu-id="c1f13-595">La configuration requise pour les ports d’Active Directory et l’opération de rattachement au domaine ne permettent pas d’exposer directement et facilement les ports nécessaires, qui plus est un contrôleur de domaine complet, à Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-595">The port requirements for Active Directory and the domain-join operation render it impractical to directly expose the necessary ports and in effect, an entire DC to the Internet.</span></span>
> 
> 

<span data-ttu-id="c1f13-596">Les machines virtuelles inscrivent leur nom DNS automatiquement au démarrage ou lors d’une modification de nom.</span><span class="sxs-lookup"><span data-stu-id="c1f13-596">VMs register their DNS name automatically on startup or when there is a name change.</span></span>

<span data-ttu-id="c1f13-597">Pour plus d’informations sur cet exemple et un autre exemple qui montre comment configurer la première machine virtuelle et installer AD DS dessus, voir [Installation d’une nouvelle forêt Active Directory sur un réseau virtuel Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-597">For more information about this example and another example that shows how to provision the first VM and install AD DS on it, see [Install a new Active Directory forest on Microsoft Azure](active-directory-new-forest-virtual-machine.md).</span></span> <span data-ttu-id="c1f13-598">Pour plus d’informations sur l’utilisation de Windows PowerShell, voir [Installer Azure PowerShell](/powershell/azureps-cmdlets-docs) et [Azure Management Cmdlet](/powershell/module/azurerm.compute/#virtual_machines) (Applets de commande de gestion Azure).</span><span class="sxs-lookup"><span data-stu-id="c1f13-598">For more information about using Windows PowerShell, see [Install Azure PowerShell](/powershell/azureps-cmdlets-docs) and [Azure Management Cmdlets](/powershell/module/azurerm.compute/#virtual_machines).</span></span>

### <span data-ttu-id="c1f13-599"><a name="BKMK_DistributedDCs"></a>Contrôleurs de domaine géolocalisés</span><span class="sxs-lookup"><span data-stu-id="c1f13-599"><a name="BKMK_DistributedDCs"></a>Geo-distributed DCs</span></span>
<span data-ttu-id="c1f13-600">Azure présente des avantages lors de l’hébergement de plusieurs contrôleurs de domaine sur différents réseaux virtuels :</span><span class="sxs-lookup"><span data-stu-id="c1f13-600">Azure offers advantages when hosting multiple DCs on different virtual networks:</span></span>

* <span data-ttu-id="c1f13-601">Tolérance de pannes sur plusieurs sites</span><span class="sxs-lookup"><span data-stu-id="c1f13-601">Multi-site fault-tolerance</span></span>
* <span data-ttu-id="c1f13-602">Proximité physique des filiales (latence réduite)</span><span class="sxs-lookup"><span data-stu-id="c1f13-602">Physical proximity to branch offices (lower latency)</span></span>

<span data-ttu-id="c1f13-603">Pour plus d’informations sur la configuration d’une communication directe entre les réseaux virtuels, voir [Configurer une connexion de réseau virtuel à réseau virtuel](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-603">For information about configuring direct communication between virtual networks, see [Configure virtual network to virtual network connectivity](../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

### <span data-ttu-id="c1f13-604"><a name="BKMK_RODC"></a>Contrôleurs de domaine en lecture seule</span><span class="sxs-lookup"><span data-stu-id="c1f13-604"><a name="BKMK_RODC"></a>Read-only DCs</span></span>
<span data-ttu-id="c1f13-605">Vous devez choisir entre le déploiement de contrôleurs de domaine accessibles en lecture seule ou en écriture.</span><span class="sxs-lookup"><span data-stu-id="c1f13-605">You need to choose whether to deploy read-only or writeable DCs.</span></span> <span data-ttu-id="c1f13-606">Vous pouvez être tenté de déployer des contrôleurs de domaine en lecture seule parce que cela vous éviter d’avoir à les contrôler physiquement. Or, ces contrôleurs sont conçus pour être déployés dans des sites où ils sont exposés aux risques, par exemple les filiales.</span><span class="sxs-lookup"><span data-stu-id="c1f13-606">You might be inclined to deploy RODCs because you will not have physical control over them, but RODCs are designed to be deployed in locations where their physical security is at risk, such as branch offices.</span></span>

<span data-ttu-id="c1f13-607">Azure ne présente pas le risque de sécurité physique d’une filiale, mais les contrôleurs de domaine en lecture seule peuvent tout de même s’avérer plus efficaces, car les fonctionnalités qu’ils fournissent sont bien adaptées à ces environnements, quoique pour des raisons très différentes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-607">Azure does not present the physical security risk of a branch office, but RODCs might still prove to be more cost effective because the features they provide are well-suited to these environments albeit for very different reasons.</span></span> <span data-ttu-id="c1f13-608">Par exemple, les contrôleurs de domaine en lecture seule ne génèrent pas de réplication sortante et peuvent renseigner sélectivement des secrets (mots de passe).</span><span class="sxs-lookup"><span data-stu-id="c1f13-608">For example, RODCs have no outbound replication and are able to selectively populate secrets (passwords).</span></span> <span data-ttu-id="c1f13-609">En revanche, si de tels secrets ne sont pas connus, le trafic sortant à la demande peut avoir à les valider chaque fois qu’un utilisateur ou un ordinateur s’authentifie.</span><span class="sxs-lookup"><span data-stu-id="c1f13-609">On the downside, the lack of these secrets might require on-demand outbound traffic to validate them as a user or computer authenticates.</span></span> <span data-ttu-id="c1f13-610">Toutefois, il est possible de pré-renseigner et mettre en cache les secrets de manière sélective.</span><span class="sxs-lookup"><span data-stu-id="c1f13-610">But secrets can be selectively prepopulated and cached.</span></span>

<span data-ttu-id="c1f13-611">Les contrôleurs de domaine accessibles en lecture seule fournissent un avantage supplémentaire pour gérer les problèmes de données HBI et PII et associés, car vous pouvez ajouter des attributs qui contiennent des données sensibles au jeu d’attributs filtré du contrôleur de domaine accessible en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c1f13-611">RODCs provide an additional advantage in and around HBI and PII concerns because you can add attributes that contain sensitive data to the RODC filtered attribute set (FAS).</span></span> <span data-ttu-id="c1f13-612">Le jeu d’attributs filtré comprend des attributs personnalisables qui ne sont pas répliqués vers le contrôleur de domaine accessible en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="c1f13-612">The FAS is a customizable set of attributes that are not replicated to RODCs.</span></span> <span data-ttu-id="c1f13-613">Vous pouvez utiliser le jeu d’attributs filtré comme solution de secours si vous n’êtes pas autorisé à stocker les attributs PII ou HBI sur Azure, ou si vous ne voulez pas le faire.</span><span class="sxs-lookup"><span data-stu-id="c1f13-613">You can use the FAS as a safeguard in case you are not permitted or do not want to store PII or HBI on Azure.</span></span> <span data-ttu-id="c1f13-614">Pour plus d’informations, voir [RODC filtered attribute set (jeu d’attributs filtré du contrôleur de domaine accessible en lecture seule)[(https://technet.microsoft.com/library/cc753459)].</span><span class="sxs-lookup"><span data-stu-id="c1f13-614">For more information, see [RODC filtered attribute set[(https://technet.microsoft.com/library/cc753459)].</span></span>

<span data-ttu-id="c1f13-615">Assurez-vous que les applications sont compatibles avec les contrôleurs que vous prévoyez d’utiliser.</span><span class="sxs-lookup"><span data-stu-id="c1f13-615">Make sure that applications will be compatible with RODCs you plan to use.</span></span> <span data-ttu-id="c1f13-616">De nombreuses applications compatibles avec Windows Server Active Directory fonctionnent bien avec les contrôleurs de domaine en lecture seule, mais certaines peuvent être inefficaces ou échouer si elles n’ont pas accès à un contrôleur de domaine accessible en écriture.</span><span class="sxs-lookup"><span data-stu-id="c1f13-616">Many Windows Server Active Directory-enabled applications work well with RODCs, but some applications can perform inefficiently or fail if they do not have access to a writable DC.</span></span> <span data-ttu-id="c1f13-617">Pour plus d’informations, voir [Compatibilité des applications avec les contrôleurs de domaine en lecture seule](https://technet.microsoft.com/library/cc755190).</span><span class="sxs-lookup"><span data-stu-id="c1f13-617">For more information, see [Read-Only DCs application compatibility guide](https://technet.microsoft.com/library/cc755190).</span></span>

### <span data-ttu-id="c1f13-618"><a name="BKMK_GC"></a>Catalogue global</span><span class="sxs-lookup"><span data-stu-id="c1f13-618"><a name="BKMK_GC"></a>Global catalog</span></span>
<span data-ttu-id="c1f13-619">Vous devez choisir d’installer ou non un catalogue global (GC).</span><span class="sxs-lookup"><span data-stu-id="c1f13-619">You need to choose whether to install a global catalog (GC).</span></span> <span data-ttu-id="c1f13-620">Dans une forêt de domaine unique, vous devez configurer tous les contrôleurs de domaine comme des serveurs de catalogue global.</span><span class="sxs-lookup"><span data-stu-id="c1f13-620">In a single domain forest, you should configure all DCs as global catalog servers.</span></span> <span data-ttu-id="c1f13-621">Cela n’augmente pas les coûts car aucun trafic de réplication supplémentaire n’est généré.</span><span class="sxs-lookup"><span data-stu-id="c1f13-621">It will not increase costs because there will be no additional replication traffic.</span></span>

<span data-ttu-id="c1f13-622">Dans une forêt multidomaine, les catalogues globaux sont nécessaires pour développer des appartenances au groupe universel pendant le processus d’authentification.</span><span class="sxs-lookup"><span data-stu-id="c1f13-622">In a multidomain forest, GCs are necessary to expand Universal Group memberships during the authentication process.</span></span> <span data-ttu-id="c1f13-623">Si vous ne déployez pas un catalogue global, les charges de travail sur le réseau virtuel authentifiées auprès d’un contrôleur de domaine sur Azure génèrent indirectement un trafic d’authentification sortant pour interroger les catalogues globaux locaux lors de chaque tentative d’authentification.</span><span class="sxs-lookup"><span data-stu-id="c1f13-623">If you do not deploy a GC, workloads on the virtual network that authenticate against a DC on Azure will indirectly generate outbound authentication traffic to query GCs on-premises during each authentication attempt.</span></span>

<span data-ttu-id="c1f13-624">Les coûts associés aux catalogues globaux sont moins prévisibles, car ils hébergent chaque domaine (en partie).</span><span class="sxs-lookup"><span data-stu-id="c1f13-624">The costs associated with GCs are less-predictable because they host every domain (in-part).</span></span> <span data-ttu-id="c1f13-625">Si la charge de travail héberge un service accessible sur Internet et authentifie les utilisateurs via Windows Server AD DS, les coûts peuvent être totalement imprévisibles.</span><span class="sxs-lookup"><span data-stu-id="c1f13-625">If the workload hosts an Internet-facing service and authenticates users against Windows Server AD DS, the costs could be completely unpredictable.</span></span> <span data-ttu-id="c1f13-626">Pour réduire les requêtes de catalogue global en dehors du site du cloud pendant l’authentification, vous pouvez [activer la mise en cache d’appartenance au groupe universel](https://technet.microsoft.com/library/cc816928).</span><span class="sxs-lookup"><span data-stu-id="c1f13-626">To help reduce GC queries outside of the cloud site during authentication, you can [enable Universal Group Membership Caching](https://technet.microsoft.com/library/cc816928).</span></span>

### <span data-ttu-id="c1f13-627"><a name="BKMK_InstallMethod"></a>Méthode d’installation</span><span class="sxs-lookup"><span data-stu-id="c1f13-627"><a name="BKMK_InstallMethod"></a>Installation method</span></span>
<span data-ttu-id="c1f13-628">Vous devez choisir comment installer les contrôleurs de domaine sur le réseau virtuel :</span><span class="sxs-lookup"><span data-stu-id="c1f13-628">You need to choose how to install the DCs on the virtual network:</span></span>

* <span data-ttu-id="c1f13-629">Promouvoir de nouveaux contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-629">Promote new DCs.</span></span> <span data-ttu-id="c1f13-630">Pour plus d’informations, voir [Installation d’une nouvelle forêt Active Directory sur un réseau virtuel Azure](active-directory-new-forest-virtual-machine.md).</span><span class="sxs-lookup"><span data-stu-id="c1f13-630">For more information, see [Install a new Active Directory forest on an Azure virtual network](active-directory-new-forest-virtual-machine.md).</span></span>
* <span data-ttu-id="c1f13-631">Déplacer le disque dur virtuel d’un contrôleur de domaine virtuel local vers le cloud.</span><span class="sxs-lookup"><span data-stu-id="c1f13-631">Move the VHD of an on-premises virtual DC to the cloud.</span></span> <span data-ttu-id="c1f13-632">Dans ce cas, vous devez vous assurer que le contrôleur de domaine virtuel local est « déplacé », pas « copié » ou « cloné ».</span><span class="sxs-lookup"><span data-stu-id="c1f13-632">In this case, you must ensure that the on-premises virtual DC is “moved,” not “copied” or “cloned.”</span></span>

<span data-ttu-id="c1f13-633">Utilisez uniquement des machines virtuelles Azure pour les contrôleurs de domaine (par opposition aux machines virtuelles Azure ayant un rôle « Web » ou « travail »).</span><span class="sxs-lookup"><span data-stu-id="c1f13-633">Use only Azure virtual machines for DCs (as opposed to Azure “web” or “worker” role VMs).</span></span> <span data-ttu-id="c1f13-634">Elles sont durables et la durabilité de l’état d’un contrôleur de domaine est essentielle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-634">They are durable and durability of state for a DC is required.</span></span> <span data-ttu-id="c1f13-635">Les machines virtuelles Azure sont conçues pour des charges de travail telles que des contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-635">Azure virtual machines are designed for workloads such as DCs.</span></span>

<span data-ttu-id="c1f13-636">N’utilisez pas SYSPREP pour déployer ou cloner des contrôleurs de domaine.</span><span class="sxs-lookup"><span data-stu-id="c1f13-636">Do not use SYSPREP to deploy or clone DCs.</span></span> <span data-ttu-id="c1f13-637">La capacité de clonage des contrôleurs de domaine est uniquement disponible à partir de Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="c1f13-637">The ability to clone DCs is only available beginning in Windows Server 2012.</span></span> <span data-ttu-id="c1f13-638">La fonctionnalité de clonage nécessite la prise en charge de VMGenerationID dans l’hyperviseur sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="c1f13-638">The cloning feature requires support for VMGenerationID in the underlying hypervisor.</span></span> <span data-ttu-id="c1f13-639">Hyper-V dans Windows Server 2012 et les réseaux virtuels Azure prennent tous deux en charge VMGenerationID, tout comme les fournisseurs de logiciels de virtualisation tiers.</span><span class="sxs-lookup"><span data-stu-id="c1f13-639">Hyper-V in Windows Server 2012 and Azure virtual networks both support VMGenerationID, as do third-party virtualization software vendors.</span></span>

### <span data-ttu-id="c1f13-640"><a name="BKMK_PlaceDB"></a>Emplacement de la base de données Windows Server AD DS et de SYSVOL</span><span class="sxs-lookup"><span data-stu-id="c1f13-640"><a name="BKMK_PlaceDB"></a>Placement of the Windows Server AD DS database and SYSVOL</span></span>
<span data-ttu-id="c1f13-641">Choisissez où placer la base de données Windows Server AD DS, les journaux et SYSVOL.</span><span class="sxs-lookup"><span data-stu-id="c1f13-641">Select where to locate the Windows Server AD DS database, logs, and SYSVOL.</span></span> <span data-ttu-id="c1f13-642">Ils doivent être déployés sur des disques de données Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-642">They must be deployed on Azure Data disks.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-643">Les disques de données Azure sont limités à 1 To.</span><span class="sxs-lookup"><span data-stu-id="c1f13-643">Azure Data disks are constrained to 1 TB.</span></span>
> 
> 

<span data-ttu-id="c1f13-644">Par défaut, les disques de données ne mettent pas les écritures en cache.</span><span class="sxs-lookup"><span data-stu-id="c1f13-644">Data disk drives do not cache writes by default.</span></span> <span data-ttu-id="c1f13-645">Les disques de données qui sont attachés à une machine virtuelle utilisent le cache à double écriture.</span><span class="sxs-lookup"><span data-stu-id="c1f13-645">Data disk drives that are attached to a VM use write-through caching.</span></span> <span data-ttu-id="c1f13-646">Le cache à double écriture garantit que l’écriture est validée dans un stockage Azure durable avant la fin de la transaction du point de vue du système d’exploitation de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-646">Write-through caching makes sure the write is committed to durable Azure storage before the transaction is complete from the perspective of the VM’s operating system.</span></span> <span data-ttu-id="c1f13-647">La durabilité est ainsi assurée, même si les écritures sont légèrement plus lentes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-647">It provides durability, at the expense of slightly slower writes.</span></span>

<span data-ttu-id="c1f13-648">Pour Windows Server AD DS, cela est important car le cache d’écriture différée rend les hypothèses émises par le contrôleur de domaine non valides.</span><span class="sxs-lookup"><span data-stu-id="c1f13-648">This is important for Windows Server AD DS because write-behind disk-caching invalidates assumptions made by the DC.</span></span> <span data-ttu-id="c1f13-649">Windows Server AD DS tente de désactiver le cache d’écriture, mais c’est le système d’E/S du disque qui valide.</span><span class="sxs-lookup"><span data-stu-id="c1f13-649">Windows Server AD DS attempts to disable write caching but it is up to the disk IO system to honor it.</span></span> <span data-ttu-id="c1f13-650">L’incapacité de désactiver le cache d’écriture peut, dans certaines circonstances, entraîner la restauration d’USN et produire des objets en attente et d’autres problèmes.</span><span class="sxs-lookup"><span data-stu-id="c1f13-650">Failure to disable write caching may, under certain circumstances, introduce USN rollback resulting in lingering objects and other problems.</span></span>

<span data-ttu-id="c1f13-651">Pour les contrôleurs de domaine virtuels, nous vous recommandons la bonne pratique suivante :</span><span class="sxs-lookup"><span data-stu-id="c1f13-651">As a best practice for virtual DCs, do the following:</span></span>

* <span data-ttu-id="c1f13-652">Sur le disque de données Azure, définissez le paramètre Préférences de cache d’hôte sur AUCUN.</span><span class="sxs-lookup"><span data-stu-id="c1f13-652">Set the Host Cache Preference setting on the Azure data disk for NONE.</span></span> <span data-ttu-id="c1f13-653">Cela évite les problèmes de cache d’écriture pour les opérations AD DS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-653">This prevents issues with write caching for AD DS operations.</span></span>
* <span data-ttu-id="c1f13-654">Stockez la base de données, les journaux et SYSVOL sur le même disque de données ou sur des disques de données distincts.</span><span class="sxs-lookup"><span data-stu-id="c1f13-654">Store the database, logs, and SYSVOL on the either same data disk or separate data disks.</span></span> <span data-ttu-id="c1f13-655">Généralement, il s’agit d’un disque distinct du disque utilisé pour le système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="c1f13-655">Typically, this is a separate disk from the disk used for the operating system itself.</span></span> <span data-ttu-id="c1f13-656">L’essentiel à retenir est que la base de données Windows Server AD DS et SYSVOL ne doivent pas être stockés sur un type de disque Système d’exploitation Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-656">The key takeaway is that the Windows Server AD DS database and SYSVOL must not be stored on an Azure Operating System disk type.</span></span> <span data-ttu-id="c1f13-657">Par défaut, le processus d’installation AD DS installe ces composants dans le dossier %systemroot%, qui n’est PAS recommandé pour Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-657">By default, the AD DS installation process installs these components in %systemroot% folder, which is NOT recommended for Azure.</span></span>

### <span data-ttu-id="c1f13-658"><a name="BKMK_BUR"></a>Sauvegarde et restauration</span><span class="sxs-lookup"><span data-stu-id="c1f13-658"><a name="BKMK_BUR"></a>Backup and restore</span></span>
<span data-ttu-id="c1f13-659">Soyez attentif à ce qui est pris en charge ou non dans le cadre de la sauvegarde et de la restauration des contrôleurs de domaine, en particulier ceux qui sont exécutés sur une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="c1f13-659">Be aware of what is and is not supported for backup and restore of a DC in general, and more specifically, those running in a VM.</span></span> <span data-ttu-id="c1f13-660">Voir [Observations sur la sauvegarde et la restauration des contrôleurs de domaine virtualisés](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span><span class="sxs-lookup"><span data-stu-id="c1f13-660">See [Backup and Restore Considerations for Virtualized DCs](https://technet.microsoft.com/library/virtual_active_directory_domain_controller_virtualization_hyperv#backup_and_restore_considerations_for_virtualized_domain_controllers).</span></span>

<span data-ttu-id="c1f13-661">Créez des sauvegardes d’état en utilisant seulement des logiciels de sauvegarde compatibles avec les exigences de sauvegarde de Windows Server AD DS, telles que Sauvegarde Windows Server.</span><span class="sxs-lookup"><span data-stu-id="c1f13-661">Create system state backups by using only backup software that is specifically aware of backup requirements for Windows Server AD DS, such as Windows Server Backup.</span></span>

<span data-ttu-id="c1f13-662">Ne copiez ou ne clonez pas les fichiers des disques durs virtuels des contrôleurs de domaine au lieu d’effectuer des sauvegardes régulières.</span><span class="sxs-lookup"><span data-stu-id="c1f13-662">Do not copy or clone VHD files of DCs instead of performing regular backups.</span></span> <span data-ttu-id="c1f13-663">Si une restauration doit être effectuée, vous introduirez des bulles USN en utilisant pour cela des disque durs virtuels clonés ou copiés sans Windows Server 2012 et un hyperviseur pris en charge.</span><span class="sxs-lookup"><span data-stu-id="c1f13-663">Should a restore ever be required, doing so using cloned or copied VHDs without Windows Server 2012 and a supported hypervisor will introduce USN bubbles.</span></span>

### <span data-ttu-id="c1f13-664"><a name="BKMK_FedSrvConfig"></a>Configuration du serveur de fédération</span><span class="sxs-lookup"><span data-stu-id="c1f13-664"><a name="BKMK_FedSrvConfig"></a>Federation server configuration</span></span>
<span data-ttu-id="c1f13-665">La configuration des serveurs de fédération (STS) Windows Server AD FS dépend en partie de la nécessité pour les applications déployées sur Azure d’accéder aux ressources de votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-665">The configuration of Windows Server AD FS federation servers (STSs) depends in part on whether the applications that you want to deploy on Azure need to access resources on your on-premises network.</span></span>

<span data-ttu-id="c1f13-666">Si les applications répondent aux critères suivants, vous pouvez déployer les applications de manière isolée à partir de votre réseau local.</span><span class="sxs-lookup"><span data-stu-id="c1f13-666">If the applications meet the following criteria, you could deploy the applications in isolation from your on-premises network.</span></span>

* <span data-ttu-id="c1f13-667">Elles acceptent les jetons de sécurité SAML.</span><span class="sxs-lookup"><span data-stu-id="c1f13-667">They accept SAML security tokens</span></span>
* <span data-ttu-id="c1f13-668">Elles peuvent être exposées sur Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-668">They are exposable to the Internet</span></span>
* <span data-ttu-id="c1f13-669">Elles n’accèdent pas aux ressources locales.</span><span class="sxs-lookup"><span data-stu-id="c1f13-669">They do not access on-premises resources</span></span>

<span data-ttu-id="c1f13-670">Dans ce cas, configurez les STS Windows Server AD FS comme suit :</span><span class="sxs-lookup"><span data-stu-id="c1f13-670">In this case, configure Windows Server AD FS STSs as follows:</span></span>

1. <span data-ttu-id="c1f13-671">Configurez une forêt à domaine unique isolée sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-671">Configure an isolated single-domain forest on Azure.</span></span>
2. <span data-ttu-id="c1f13-672">Fournissez un accès fédéré à la forêt en configurant une batterie de serveurs de fédération Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-672">Provide federated access to the forest by configuring a Windows Server AD FS federation server farm.</span></span>
3. <span data-ttu-id="c1f13-673">Configurez Windows Server AD FS (batterie de serveurs de fédération et batterie de serveurs proxy de fédération) dans la forêt locale.</span><span class="sxs-lookup"><span data-stu-id="c1f13-673">Configure Windows Server AD FS (federation server farm and federation server proxy farm) in the on-premises forest.</span></span>
4. <span data-ttu-id="c1f13-674">Établissez une relation d’approbation de fédération entre les instances locales et Azure de Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-674">Establish a federation trust relationship between the on-premises and Azure instances of Windows Server AD FS.</span></span>

<span data-ttu-id="c1f13-675">En revanche, si les applications nécessitent un accès aux ressources locales, vous pouvez configurer Windows Server AD FS avec l’application sur Azure comme suit :</span><span class="sxs-lookup"><span data-stu-id="c1f13-675">On the other hand, if the applications require access to on-premises resources, you could configure Windows Server AD FS with the application on Azure as follows:</span></span>

1. <span data-ttu-id="c1f13-676">Configurez la connectivité entre les réseaux locaux et Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-676">Configure connectivity between on-premises networks and Azure.</span></span>
2. <span data-ttu-id="c1f13-677">Configurez une batterie de serveurs de fédération Windows Server AD FS dans la forêt locale.</span><span class="sxs-lookup"><span data-stu-id="c1f13-677">Configure a Windows Server AD FS federation server farm in the on-premises forest.</span></span>
3. <span data-ttu-id="c1f13-678">Configurez une batterie de serveurs proxy de fédération Windows Server AD FS sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-678">Configure a Windows Server AD FS federation server proxy farm on Azure.</span></span>

<span data-ttu-id="c1f13-679">Cette configuration présente l’avantage de réduire l’exposition des ressources locales, comme la configuration de Windows Server AD FS avec des applications dans un réseau de périmètre.</span><span class="sxs-lookup"><span data-stu-id="c1f13-679">This configuration has the advantage of reducing the exposure of on-premises resources, similar to configuring Windows Server AD FS with applications in a perimeter network.</span></span>

<span data-ttu-id="c1f13-680">Notez que dans les deux cas, vous pouvez établir des relations d’approbation avec d’autres fournisseurs d’identité, si une collaboration d’entreprise à entreprise est requise.</span><span class="sxs-lookup"><span data-stu-id="c1f13-680">Note that in either scenario, you can establish trusts relationships with more identity providers, if business-to-business collaboration is needed.</span></span>

### <span data-ttu-id="c1f13-681"><a name="BKMK_CloudSvcConfig"></a>Configuration des services cloud</span><span class="sxs-lookup"><span data-stu-id="c1f13-681"><a name="BKMK_CloudSvcConfig"></a>Cloud services configuration</span></span>
<span data-ttu-id="c1f13-682">Les services cloud sont nécessaires si vous souhaitez exposer une machine virtuelle directement à Internet ou exposer une application d’équilibrage de charge accessible sur Internet.</span><span class="sxs-lookup"><span data-stu-id="c1f13-682">Cloud services are necessary if you want to expose a VM directly to the Internet or to expose an Internet-facing load-balanced application.</span></span> <span data-ttu-id="c1f13-683">Cela est possible car chaque service cloud propose une seule adresse IP virtuelle configurable.</span><span class="sxs-lookup"><span data-stu-id="c1f13-683">This is possible because each cloud service offers a single configurable virtual IP address.</span></span>

### <span data-ttu-id="c1f13-684"><a name="BKMK_FedReqVIPDIP"></a>Configuration requise du serveur de fédération pour l’adressage IP privé et public (adresse IP dynamique et adresse IP virtuelle)</span><span class="sxs-lookup"><span data-stu-id="c1f13-684"><a name="BKMK_FedReqVIPDIP"></a>Federation server requirements for public and private IP addressing (dynamic IP vs. virtual IP)</span></span>
<span data-ttu-id="c1f13-685">Chaque machine virtuelle Azure reçoit une adresse IP dynamique.</span><span class="sxs-lookup"><span data-stu-id="c1f13-685">Each Azure virtual machine receives a dynamic IP address.</span></span> <span data-ttu-id="c1f13-686">Une adresse IP dynamique est une adresse privée accessible uniquement dans Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-686">A dynamic IP address is a private address accessible only within Azure.</span></span> <span data-ttu-id="c1f13-687">Dans la plupart des cas, toutefois, il est nécessaire de configurer une adresse IP virtuelle pour vos déploiements Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-687">In most cases, however, it will be necessary to configure a virtual IP address for your Windows Server AD FS deployments.</span></span> <span data-ttu-id="c1f13-688">L’adresse IP virtuelle est nécessaire pour exposer des points de terminaison Windows Server AD FS à Internet, et est utilisée par les clients et partenaires fédérés pour l’authentification et la gestion continue.</span><span class="sxs-lookup"><span data-stu-id="c1f13-688">The virtual IP is necessary to expose Windows Server AD FS endpoints to the Internet, and will be used by federated partners and clients for authentication and ongoing management.</span></span> <span data-ttu-id="c1f13-689">Une adresse IP virtuelle est une propriété d’un service cloud qui contient une ou plusieurs machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-689">A virtual IP address is a property of a cloud service which contains one or more Azure virtual machines.</span></span> <span data-ttu-id="c1f13-690">Si l’application prenant en charge les revendications déployée sur Azure et Windows Server AD FS sont accessibles sur Internet et partagent des ports communs, ils doivent avoir leur propre adresse IP virtuelle. Il est donc nécessaire de créer un service cloud pour l’application et un autre pour Windows Server AD FS.</span><span class="sxs-lookup"><span data-stu-id="c1f13-690">If the claims-aware application deployed on Azure and Windows Server AD FS are both Internet-facing and share common ports, each will require a virtual IP address of its own and it will therefore be necessary to create one cloud service for the application and a second for Windows Server AD FS.</span></span>

<span data-ttu-id="c1f13-691">Pour connaître les définitions des termes adresse IP virtuelle et adresse IP dynamique, voir [Termes et définitions](#BKMK_Glossary).</span><span class="sxs-lookup"><span data-stu-id="c1f13-691">For definitions of the terms virtual IP address and dynamic IP address, see [Terms and definitions](#BKMK_Glossary).</span></span>

### <span data-ttu-id="c1f13-692"><a name="BKMK_ADFSHighAvail"></a>Configuration de la haute disponibilité de Windows Server AD FS</span><span class="sxs-lookup"><span data-stu-id="c1f13-692"><a name="BKMK_ADFSHighAvail"></a>Windows Server AD FS high availability configuration</span></span>
<span data-ttu-id="c1f13-693">Bien qu’il soit possible de déployer des services de fédération Windows Server AD FS autonomes, il est recommandé de déployer une batterie de serveurs avec au moins deux nœuds pour les STS et les serveurs proxy AD FS dans les environnements de production.</span><span class="sxs-lookup"><span data-stu-id="c1f13-693">While it is possible to deploy standalone Windows Server AD FS federation services, it is recommended to deploy a farm with at least two nodes for both AD FS STS and proxies for production environments.</span></span>

<span data-ttu-id="c1f13-694">Voir [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) (Observations concernant la topologie du déploiement AD FS 2.0) dans le [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) (Guide de conception AD FS 2.0) pour choisir les options de configuration du déploiement les plus adaptées à vos besoins particuliers.</span><span class="sxs-lookup"><span data-stu-id="c1f13-694">See [AD FS 2.0 deployment topology considerations](https://technet.microsoft.com/library/gg982489) in the [AD FS 2.0 Design Guide](https://technet.microsoft.com/library/dd807036) to decide which deployment configuration options best suit your particular needs.</span></span>

> [!NOTE]
> <span data-ttu-id="c1f13-695">Pour parvenir à l’équilibrage de charge des points de terminaison Windows Server AD FS sur Azure, configurez tous les membres de la batterie de serveurs Windows Server AD FS dans le même service cloud, et utilisez la fonction d’équilibrage de charge d’Azure pour les ports HTTP (80 par défaut) et HTTPS (443 par défaut).</span><span class="sxs-lookup"><span data-stu-id="c1f13-695">In order to get load balancing for Windows Server AD FS endpoints on Azure, configure all members of the Windows Server AD FS farm in the same cloud service, and use the load balancing capability of Azure for HTTP (default 80) and HTTPS ports (default 443).</span></span> <span data-ttu-id="c1f13-696">Pour plus d’informations, voir [Sonde d’équilibrage de charge Azure](https://msdn.microsoft.com/library/azure/jj151530).</span><span class="sxs-lookup"><span data-stu-id="c1f13-696">For more information, see [Azure load-balancer probe](https://msdn.microsoft.com/library/azure/jj151530).</span></span>
> <span data-ttu-id="c1f13-697">L’équilibrage de la charge réseau (NLB) de Windows Server n’est pas pris en charge sur Azure.</span><span class="sxs-lookup"><span data-stu-id="c1f13-697">Windows Server Network Load Balancing (NLB) is not supported on Azure.</span></span>
> 
> 

