---
title: "aaaHow tooconfigure un toouse d’application de Proxy d’Application la délégation contrainte Kerberos | Documents Microsoft"
description: "Comment tooconfigure la délégation contrainte Kerberos pour une application de Proxy d’Application Azure AD."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="293df-103">Comment tooconfigure un toouse d’application de Proxy d’Application la délégation contrainte Kerberos</span><span class="sxs-lookup"><span data-stu-id="293df-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="293df-104">Bonjour les méthodes disponibles pour atteindre une toopublished SSO applications peuvent varier quelque peu de tooapplication de l’application et une des options hello que le Proxy d’Application Azure offre dès la hello est la délégation Kerberos (KCD).</span><span class="sxs-lookup"><span data-stu-id="293df-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="293df-105">C’est là un hôte de connecteur configuré tooperform contraint kerberos authentification toobackend applications, pour le compte d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="293df-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="293df-106">procédure réel de Hello pour l’activation de KCD est relativement simple et ne nécessite généralement aucuns plus d’une compréhension générale de hello différents composants et flux d’authentification qui facilite l’authentification unique.</span><span class="sxs-lookup"><span data-stu-id="293df-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="293df-107">Recherche de bonnes sources d’informations toohelp dépanner des scénarios où KCD SSO ne fonctionne pas comme prévu, peut être fragmenté.</span><span class="sxs-lookup"><span data-stu-id="293df-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="293df-108">Par conséquent, cet article tente tooprovide un seul point de référence qui peut aider à résoudre les problèmes et certains des problèmes les plus courants hello qu’il corrige automatiquement.</span><span class="sxs-lookup"><span data-stu-id="293df-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="293df-109">À hello même offre des conseils supplémentaires de temps pour diagnostiquer hello plus complexe et gênés d’implémentation.</span><span class="sxs-lookup"><span data-stu-id="293df-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="293df-110">Notez que cet article rend hello suivant hypothèses :</span><span class="sxs-lookup"><span data-stu-id="293df-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="293df-111">Proxy d’Application Azure a été déployé en tant que par notre [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) et applications de KCD toonon accès général fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="293df-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="293df-112">Hello application publiée cible est basée sur la mise en œuvre de IIS et de Microsoft du protocole kerberos.</span><span class="sxs-lookup"><span data-stu-id="293df-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="293df-113">hôtes de serveur et l’application Hello résident dans un seul domaine Active Directory.</span><span class="sxs-lookup"><span data-stu-id="293df-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="293df-114">Vous trouverez des informations détaillées sur les scénarios inter-domaines et inter-forêts dans notre [livre blanc sur KCD](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="293df-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="293df-115">Hello objet application est publiée dans Azure locataire avec l’authentification préalable activée et les utilisateurs sont censés tooAzure tooauthenticate via des formulaires en fonction de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="293df-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="293df-116">Scénarios d’authentification client riche ne sont pas couverts par cet article, mais être ajoutés à un moment donné dans hello futures.</span><span class="sxs-lookup"><span data-stu-id="293df-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="293df-117">Composants requis</span><span class="sxs-lookup"><span data-stu-id="293df-117">Prerequisites</span></span>

<span data-ttu-id="293df-118">Proxy d’Application Azure peut être déployé dans presque n’importe quel type d’infrastructure ou architectures environnement et hello diffèrent sans aucun doute tooorganization d’organisation.</span><span class="sxs-lookup"><span data-stu-id="293df-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="293df-119">Une des causes les plus courantes de KCD hello liées problèmes ne sont pas hello environnements eux-mêmes, mais plutôt simple en matière de configuration ou supervision générale.</span><span class="sxs-lookup"><span data-stu-id="293df-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="293df-120">Pour cette raison, notre Conseil est toujours toostart en vous assurant que vous avez rempli tous les logiciels prérequis hello disposés dans notre principal [KCD à l’aide de l’authentification unique avec l’article de Proxy d’Application hello](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) avant de démarrer résolution des problèmes.</span><span class="sxs-lookup"><span data-stu-id="293df-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="293df-121">En particulier les section de hello sur la configuration de KCD sur 2012 R2, car il utilise un tooconfiguring approche fondamentalement différente KCD sur les versions antérieures de Windows, mais également tout en étant penser plusieurs autres considérations :</span><span class="sxs-lookup"><span data-stu-id="293df-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="293df-122">Il n’est pas rare qu’un tooopen de serveur de membre de domaine une boîte de dialogue canal sécurisé avec un contrôleur de domaine spécifique.</span><span class="sxs-lookup"><span data-stu-id="293df-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="293df-123">Puis déplacez tooanother la boîte de dialogue à un moment donné, les hôtes de connecteur doit donc généralement pas être toocommunicate en mesure de toobeing restreint avec les contrôleurs de domaine spécifiques uniquement de site local.</span><span class="sxs-lookup"><span data-stu-id="293df-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="293df-124">Toohello similaires au-dessus du point, les scénarios entre domaines reposent sur les références qui dirigent une tooDCs hôte connecteur situés en dehors du périmètre du réseau local hello.</span><span class="sxs-lookup"><span data-stu-id="293df-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="293df-125">Dans ce scénario, il est tout aussi important toomake que vous sont également autorisant le trafic d’et les versions ultérieures tooDCs qui représentent des autres domaines respectifs, ou bien la délégation d’échouer.</span><span class="sxs-lookup"><span data-stu-id="293df-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="293df-126">Dans la mesure du possible, vous devez éviter de placer des appareils IPS/IDS actifs entre les hôtes de connecteur et les contrôleurs de domaine. En effet, ceux-ci sont parfois trop intrusifs et interfèrent avec le trafic RPC de base.</span><span class="sxs-lookup"><span data-stu-id="293df-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="293df-127">Que nous souhaitons tooresolve problèmes rapidement et efficacement, peut prendre du temps, par conséquent, lorsque cela est possible doit essayer de délégation de test dans les scénarios les plus simples de hello.</span><span class="sxs-lookup"><span data-stu-id="293df-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="293df-128">Hello plus vous introduisez de variables, hello plus avoir toocontend avec.</span><span class="sxs-lookup"><span data-stu-id="293df-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="293df-129">Par exemple, limiter votre test tooa seul connecteur permettre gagner un temps précieux et connecteurs supplémentaires peuvent être ajoutées une fois les problèmes de hello a été résolu.</span><span class="sxs-lookup"><span data-stu-id="293df-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="293df-130">Certains facteurs environnementaux peuvent également être contribue tooan problème, et si possible, essayez et réduire hello architecture tooa minimum pour test.</span><span class="sxs-lookup"><span data-stu-id="293df-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="293df-131">Par exemple, le pare-feu interne mal configuré ACL ne sont pas rares, donc si possible avoir tout le trafic à partir d’un connecteur autorisé directement par le biais de contrôleurs de domaine toohello et de l’application principale.</span><span class="sxs-lookup"><span data-stu-id="293df-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="293df-132">Hello absolu meilleures place tooposition les connecteurs est en fait des cibles tootheir aussi près que peut être.</span><span class="sxs-lookup"><span data-stu-id="293df-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="293df-133">La mise en place d’un pare-feu en ligne lors des tests ne fait qu’ajouter une complexité inutile et peut prolonger vos recherches.</span><span class="sxs-lookup"><span data-stu-id="293df-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="293df-134">Alors quels aspects caractérisent effectivement un problème avec KCD ?</span><span class="sxs-lookup"><span data-stu-id="293df-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="293df-135">Ainsi, il plusieurs indications classiques de SSO KCD défectueux et hello premiers signes d’un problème généralement manifestent hello navigateur.</span><span class="sxs-lookup"><span data-stu-id="293df-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Erreur de configuration incorrecte de KCD](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Autorisation a échoué en raison d’autorisations de toomissing](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="293df-138">tous les qui portent hello même symptôme de l’échec de tooperform SSO et, par conséquent, le refus hello application toohello de l’accès utilisateur.</span><span class="sxs-lookup"><span data-stu-id="293df-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="293df-139">Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="293df-139">Troubleshooting</span></span>

<span data-ttu-id="293df-140">Comment vous puis résolvez le problème dépendent de problème de hello et symptômes observés.</span><span class="sxs-lookup"><span data-stu-id="293df-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="293df-141">Avant d’aller plus nous suggère hello suivant liens, car ils contiennent des informations utiles que vous pas encore avoir rencontriez :</span><span class="sxs-lookup"><span data-stu-id="293df-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="293df-142">Résoudre les problèmes de proxy d’application et les messages d’erreur</span><span class="sxs-lookup"><span data-stu-id="293df-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="293df-143">Erreurs Kerberos</span><span class="sxs-lookup"><span data-stu-id="293df-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="293df-144">Utilisation de l’authentification unique quand des identités locales et sur le cloud ne sont pas identiques</span><span class="sxs-lookup"><span data-stu-id="293df-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="293df-145">Si vous avez cette mesure, puis hello principal problème existe définitivement.</span><span class="sxs-lookup"><span data-stu-id="293df-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="293df-146">Vous devez toodig plus profond, donc démarrer en séparant les flux de hello en trois étapes distinctes que vous pouvez résoudre les problèmes.</span><span class="sxs-lookup"><span data-stu-id="293df-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="293df-147">**Authentification préalable du client** -utilisateur externe de hello authentification tooAzure via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="293df-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="293df-148">Qui est en mesure de toopre-authentifier tooAzure est impérative pour KCD SSO toofunction.</span><span class="sxs-lookup"><span data-stu-id="293df-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="293df-149">Cette possibilité doit être testée et tout problème doit être résolu en premier lieu.</span><span class="sxs-lookup"><span data-stu-id="293df-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="293df-150">Notez que l’étape de l’authentification préalable hello n’a aucune relation tooKCD ou le hello publié l’application.</span><span class="sxs-lookup"><span data-stu-id="293df-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="293df-151">Il doit être assez simple toocorrect les éventuelles incohérences par les tests de vérification du compte de sujet hello existe dans Azure, et qu’il n’est pas désactivéent/bloqués.</span><span class="sxs-lookup"><span data-stu-id="293df-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="293df-152">réponse d’erreur Hello dans le navigateur de hello s’agit généralement suffisamment descriptif toounderstand hello.</span><span class="sxs-lookup"><span data-stu-id="293df-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="293df-153">Vous pouvez également vérifier nos autres tooverify de documents de dépannage si vous n’êtes pas sûr.</span><span class="sxs-lookup"><span data-stu-id="293df-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="293df-154">**Service de délégation** -hello connecteur Azure Proxy d’obtenir un kerberos ticket de service à partir d’un KDC (centre de Distribution Kerberos), pour le compte d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="293df-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="293df-155">les communications externes de Hello entre le client de hello et de hello frontal Azure ne doit avoir aucune incidence sur KCD que ce soit, autre que vous être assuré qu’il fonctionne.</span><span class="sxs-lookup"><span data-stu-id="293df-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="293df-156">Il s’agit donc hello service Proxy de Azure peut être fournie avec un ID d’utilisateur valide qui est utilisé tooobtain un ticket kerberos.</span><span class="sxs-lookup"><span data-stu-id="293df-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="293df-157">Sans cela, la délégation KCD n’est pas possible et échouera.</span><span class="sxs-lookup"><span data-stu-id="293df-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="293df-158">Comme mentionné précédemment, messages d’erreur hello navigateur fournissent généralement des indices corrects sur la raison de l’échec choses.</span><span class="sxs-lookup"><span data-stu-id="293df-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="293df-159">Assurez-vous que toonote hello ID d’activité et timestamp dans la réponse de hello car cela vous permettre des événements toocorrelate hello comportement tooactual dans le journal des événements Azure Proxy hello.</span><span class="sxs-lookup"><span data-stu-id="293df-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Erreur de configuration incorrecte de KCD](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="293df-161">Et hello hello vu journal des événements peut être vu comme événements 13019 ou 12027 les entrées correspondantes.</span><span class="sxs-lookup"><span data-stu-id="293df-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="293df-162">Vous pouvez trouver hello journaux des événements de connecteur dans **journaux des Applications et Services** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connecteur**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="293df-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Événement 13019 du journal des événements du proxy d’application](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Événement 12027 du journal des événements du proxy d’application](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="293df-165">Utiliser un enregistrement de votre serveur DNS interne pour l’adresse de l’application hello et pas un enregistrement CName</span><span class="sxs-lookup"><span data-stu-id="293df-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="293df-166">Reconfirmer hello droits toodelegate toohello désigné les SPN du compte cible et qui a été accordé à cet hôte de connecteur hello **utiliser tout protocole d’authentification** est sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="293df-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="293df-167">Cet aspect est abordé dans notre [article principal sur la configuration de l’authentification SSO](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd).</span><span class="sxs-lookup"><span data-stu-id="293df-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="293df-168">Vérifiez qu’il existe une seule instance de hello SPN existe dans Active Directory en émettant un **setspn - x** à partir d’une invite de commandes sur un hôte membre de domaine</span><span class="sxs-lookup"><span data-stu-id="293df-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="293df-169">Vérifiez si une stratégie de domaine est en cours de toosee appliquée toolimit hello [taille maximale de jetons kerberos émis](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), comme ce connecteur de hello empêcher d’obtenir un jeton si trouvé toobe excessive</span><span class="sxs-lookup"><span data-stu-id="293df-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="293df-170">Une trace réseau capture échanges hello entre l’hôte du connecteur hello et un domaine KDC serait alors hello suivante meilleures étape permettant d’obtenir plus d’informations au niveau faible sur les problèmes de hello.</span><span class="sxs-lookup"><span data-stu-id="293df-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="293df-171">Pour cela, reportez-vous au [document sur la résolution approfondie des problèmes](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="293df-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="293df-172">Si la création de tickets semble correcte, vous devez voir un événement dans les journaux hello indiquant que l’authentification a échoué en raison de l’application qui toohello renvoie une erreur 401.</span><span class="sxs-lookup"><span data-stu-id="293df-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="293df-173">Cela indique généralement l’application cible hello rejet votre ticket, par conséquent, poursuivre hello suivant l’étape suivante.</span><span class="sxs-lookup"><span data-stu-id="293df-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="293df-174">**L’application cible** -consommateur hello du ticket kerberos de hello fourni par le connecteur de hello</span><span class="sxs-lookup"><span data-stu-id="293df-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="293df-175">À ce connecteur hello de phase est toohave attendu envoyé un backend toohello du ticket de service kerberos, comme un en-tête au sein de la première demande d’application hello.</span><span class="sxs-lookup"><span data-stu-id="293df-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="293df-176">URL interne définie dans le portail hello, à l’aide de l’application hello pour valider que l’application hello est accessible directement à partir de navigateur hello sur l’hôte du connecteur hello.</span><span class="sxs-lookup"><span data-stu-id="293df-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="293df-177">Vous pouvez alors vous connecter.</span><span class="sxs-lookup"><span data-stu-id="293df-177">Then you can login successfully.</span></span> <span data-ttu-id="293df-178">Vous trouverez des détails sur cette opération sur la page de résolution des problèmes du connecteur hello.</span><span class="sxs-lookup"><span data-stu-id="293df-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="293df-179">Toujours sur l’hôte du connecteur hello, vérifiez que l’authentification entre le navigateur de hello hello et application hello est à l’aide de kerberos, en effectuant l’une des manières suivantes les hello :</span><span class="sxs-lookup"><span data-stu-id="293df-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="293df-180">Exécuter les outils de développement (**F12**) dans Internet Explorer, ou utilisez [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) à partir de l’hôte du connecteur hello.</span><span class="sxs-lookup"><span data-stu-id="293df-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="293df-181">Accédez application toohello à l’aide d’une URL interne hello et inspecter hello proposé d’en-têtes d’autorisation WWW retournés en réponse hello à partir de l’application hello, tooensure soit negotiate ou kerberos est présent.</span><span class="sxs-lookup"><span data-stu-id="293df-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="293df-182">Un objet blob suivantes kerberos retourné dans la réponse de hello de hello navigateur toohello application commencent généralement par **YÎ**, c’est une bonne indication de kerberos en cours de lecture.</span><span class="sxs-lookup"><span data-stu-id="293df-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="293df-183">NTLM sur hello autre part commencent toujours par **TlRMTVNTUAAB**, qui lit NTLMSSP lorsque décodées à partir de Base64.</span><span class="sxs-lookup"><span data-stu-id="293df-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="293df-184">Si vous voyez **TlRMTVNTUAAB** au début de hello d’objet blob de hello, cela signifie que Kerberos est **pas** disponibles.</span><span class="sxs-lookup"><span data-stu-id="293df-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="293df-185">Dans le cas contraire, Kerberos est probablement disponible.</span><span class="sxs-lookup"><span data-stu-id="293df-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="293df-186">Notez que si vous utilisez Fiddler, cette méthode nécessiterait de désactiver temporairement la protection étendue sur la configuration de l’application hello dans IIS.</span><span class="sxs-lookup"><span data-stu-id="293df-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Fenêtre de contrôle de réseau du navigateur](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="293df-188">*Illustration :* dans cet exemple, comme le blob ne commence pas par TIRMTVNTUAAB, Kerberos est disponible.</span><span class="sxs-lookup"><span data-stu-id="293df-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="293df-189">Cet exemple montre un blob Kerberos qui ne commence pas par YII.</span><span class="sxs-lookup"><span data-stu-id="293df-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="293df-190">Supprimer temporairement NTLM à partir de la liste des fournisseurs hello sur site et accès application IIS directement à partir d’Internet Explorer sur l’ordinateur hôte du connecteur.</span><span class="sxs-lookup"><span data-stu-id="293df-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="293df-191">Avec NTLM n’est plus dans la liste des fournisseurs hello, vous devez être en mesure de tooaccess application de hello uniquement à l’aide de Kerberos.</span><span class="sxs-lookup"><span data-stu-id="293df-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="293df-192">En cas d’échec, qui suggère qu’il existe un problème avec la configuration de l’application hello et l’authentification Kerberos ne fonctionne pas.</span><span class="sxs-lookup"><span data-stu-id="293df-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="293df-193">Si Kerberos n’est pas disponible, l’authentification de l’application de vérification hello négocient des paramètres dans toomake IIS que figure au premier plan, avec NTLM situé sous celui-ci.</span><span class="sxs-lookup"><span data-stu-id="293df-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="293df-194">(Vous ne devez pas voir Negotiate:kerberos ou Negotiate:PKU2U).</span><span class="sxs-lookup"><span data-stu-id="293df-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="293df-195">Continuez uniquement si Kerberos est fonctionnel.</span><span class="sxs-lookup"><span data-stu-id="293df-195">Only continue if Kerberos is functional.</span></span>

   ![Fournisseurs d’authentification Windows](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="293df-197">Avec Kerberos et NTLM en place, vous permet maintenant désactiver temporairement l’authentification préalable pour une application hello dans le portail de hello.</span><span class="sxs-lookup"><span data-stu-id="293df-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="293df-198">Voir si vous pouvez y accéder à partir de hello internet à l’aide des URL externe de hello.</span><span class="sxs-lookup"><span data-stu-id="293df-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="293df-199">Vous doit être invité à tooauthenticate et doit être en mesure de toodo donc avec hello même compte hello utilisé dans une étape précédente.</span><span class="sxs-lookup"><span data-stu-id="293df-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="293df-200">Si ce n’est pas le cas, cela indique un problème avec l’application principale hello et KCD pas du tout.</span><span class="sxs-lookup"><span data-stu-id="293df-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="293df-201">Maintenant, réactivez l’authentification préalable dans le portail de hello et authentifier via Azure en tentant d’application de toohello tooconnect via son URL externe.</span><span class="sxs-lookup"><span data-stu-id="293df-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="293df-202">Si l’authentification unique a échoué, vous devez voir un message d’erreur interdit dans le navigateur de hello, ainsi que des événements 13022 dans le journal de hello :</span><span class="sxs-lookup"><span data-stu-id="293df-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="293df-203">*Microsoft AAD Application Proxy Connector ne peut pas authentifier l’utilisateur de hello, car le serveur principal de hello répond tooKerberos les tentatives d’authentification avec une erreur HTTP 401.*</span><span class="sxs-lookup"><span data-stu-id="293df-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Message d’interdiction HTTP 401](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="293df-205">Vérifiez hello IIS application tooensure hello configuré pool d’applications est hello toouse configuré même compte que hello SPN a été configuré sur dans Active Directory, en naviguant dans IIS, comme illustré ci-dessous</span><span class="sxs-lookup"><span data-stu-id="293df-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Fenêtre de configuration d’application IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="293df-207">Une fois que vous connaissez les identités hello, émettre suivant hello à partir d’un toomake invite cmd que ce compte est configuré sans aucun doute par hello nom principal de service en question.</span><span class="sxs-lookup"><span data-stu-id="293df-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="293df-208">Par exemple, **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="293df-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![Fenêtre de commandes SetSPN](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="293df-210">Vérifiez que hello SPN défini par rapport aux paramètres de l’application hello dans le portail de hello est hello même SPN qui est configuré sur hello cible AD compte utilisé par le pool d’applications de l’application hello</span><span class="sxs-lookup"><span data-stu-id="293df-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Configuration du SPN dans le Portail Azure](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="293df-212">Accédez à IIS et sélectionnez hello **l’éditeur de Configuration** option pour une application hello et accédez trop**system.webServer/security/authentication/windowsAuthentication** toomake que ce **UseAppPoolCredentials** a la valeur tootrue</span><span class="sxs-lookup"><span data-stu-id="293df-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Option de configuration IIS - informations d’identification des pools d’applications](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="293df-214">Tout en étant utiles pour améliorer les performances de hello des opérations Kerberos, en laissant en mode noyau provoque également ticket hello pour hello demandé toobe service déchiffrée à l’aide du compte d’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="293df-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="293df-215">Également appelé système Local hello, donc avoir ce saut de tootrue ensemble KCD lors de l’application hello est hébergée sur plusieurs serveurs dans une batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="293df-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="293df-216">En tant qu’une vérification supplémentaire, vous pouvez également toodisable hello **étendue** protection trop.</span><span class="sxs-lookup"><span data-stu-id="293df-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="293df-217">Ont été rencontrés scénarios où cela s’est avéré toobreak KCD quand activée dans des configurations très spécifiques, où une application est publiée en tant qu’un sous-dossier du site Web par défaut de hello.</span><span class="sxs-lookup"><span data-stu-id="293df-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="293df-218">Cette lui-même est configuré pour l’authentification anonyme uniquement, en laissant les boîtes de dialogue ensemble hello grisées suggérer des objets enfants ne seraient pas hériter de tous les paramètres actives.</span><span class="sxs-lookup"><span data-stu-id="293df-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="293df-219">Mais où possible, nous vous recommandons de serait toujours ayant cette option est activée, par conséquent, par tous les moyens de test, mais n’oubliez pas ce tooenabled toorestore.</span><span class="sxs-lookup"><span data-stu-id="293df-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="293df-220">Doivent avoir ces vérifications supplémentaires vous mettre dans toostart de suivi à l’aide de votre application publiée.</span><span class="sxs-lookup"><span data-stu-id="293df-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="293df-221">Vous pouvez commencer et vitesse de rotation des connecteurs supplémentaires qui sont également configurés toodelegate, mais si aucune autres les choses sont puis nous suggère une lecture de notre procédure pas à pas techniques plus approfondies [guide complet de hello pour résoudre les problèmes de Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="293df-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="293df-222">Si vous êtes toujours tooprogress ne peut pas votre problème, prise en charge est supérieure à tooassist heureux et continuer à partir d’ici.</span><span class="sxs-lookup"><span data-stu-id="293df-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="293df-223">Créer un ticket de support directement dans le portail de hello et nos ingénieurs tooyou va joindre.</span><span class="sxs-lookup"><span data-stu-id="293df-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="293df-224">Autres scénarios</span><span class="sxs-lookup"><span data-stu-id="293df-224">Other scenarios</span></span>

-   <span data-ttu-id="293df-225">Proxy d’Application Azure demande un ticket Kerberos avant d’envoyer son application tooan de demande.</span><span class="sxs-lookup"><span data-stu-id="293df-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="293df-226">Certaines applications de tiers 3e comme serveur de Tableau ne convient pas cette méthode d’authentification et plutôt attend hello plus classique négociations tootake place,.</span><span class="sxs-lookup"><span data-stu-id="293df-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="293df-227">Hello première demande est anonyme, ce qui permet de hello application toorespond avec les types d’authentification hello pris en charge via une erreur 401.</span><span class="sxs-lookup"><span data-stu-id="293df-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="293df-228">Authentification à deux tronçons : couramment utilisée dans les scénarios où une application est hiérarchisée, avec un serveur principal et un serveur frontal requérant tous deux une authentification comme les services SQL Reporting.</span><span class="sxs-lookup"><span data-stu-id="293df-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="293df-229">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="293df-229">Next steps</span></span>
[<span data-ttu-id="293df-230">Configurer la délégation Kerberos contrainte (KCD) sur un domaine géré</span><span class="sxs-lookup"><span data-stu-id="293df-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
