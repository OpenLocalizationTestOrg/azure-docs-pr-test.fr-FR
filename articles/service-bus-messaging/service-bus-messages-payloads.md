---
title: "Messages, charges utiles et sérialisation Azure Service Bus | Microsoft Docs"
description: "Présentation des charges utiles de messages Service Bus"
services: service-bus-messaging
documentationcenter: 
author: clemensv
manager: timlt
editor: 
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 09/28/2017
ms.author: sethm
ms.openlocfilehash: 7c18cc4a0e6a8dbf3a47c146707666c5538ff7c3
ms.sourcegitcommit: 6699c77dcbd5f8a1a2f21fba3d0a0005ac9ed6b7
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/11/2017
---
# <a name="messages-payloads-and-serialization"></a>Messages, charges utiles et sérialisation

Le service Microsoft Azure Service Bus traite les messages. Les messages contiennent une charge utile, ainsi que des métadonnées, sous la forme de propriétés de paire clé-valeur, qui décrivent la charge utile et fournissent des instructions de traitement à Service Bus et aux applications. Il arrive que les métadonnées suffisent à elles seules à transporter les informations que l’expéditeur souhaite communiquer aux destinataires, et la charge utile reste donc vide.

Le modèle objet des clients Service Bus officiels pour .NET et Java reflète la structure abstraite des messages Service Bus, qui est mappée sur et depuis les protocoles de transmission pris en charge par Service Bus.
 
Un message Service Bus se compose d’une section de charge utile binaire que Service Bus ne traite jamais sous quelque forme que ce soit côté service, ainsi que de deux ensembles de propriétés. Les *propriétés de répartiteur* sont prédéfinies par le système. Ces propriétés prédéfinies contrôlent les fonctionnalités au niveau des messages à l’intérieur du répartiteur, ou sont mappées sur des éléments de métadonnées communs et normalisés. Les *propriétés utilisateur* sont une collection de paires clé-valeur qui peuvent être définies et configurées par l’application.
 
Les propriétés de répartiteur prédéfinies sont répertoriées dans le tableau ci-après. Les noms sont utilisés avec toutes les API clientes officielles, ainsi que dans l’objet JSON [BrokerProperties](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Properties_) du mappage de protocole HTTP.
 
Les noms équivalents utilisés au niveau du protocole AMQP sont répertoriés entre parenthèses. 

| Nom de la propriété                         | Description                                                                                                                                                                                                                                                                                                                                                                                                                               |
|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) (content-type)           | Cette propriété facultative décrit la charge utile du message, avec un descripteur conforme au format de RFC2045, Section 5, par exemple `application/json`.                                                                                                                                                                                                                                                                                             |
|  [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid#Microsoft_Azure_ServiceBus_Message_CorrelationId) (correlation-id)       | Cette propriété permet à une application de spécifier un contexte pour le message à des fins de corrélation, qui reflète par exemple l’élément **MessageId** d’un message recevant une réponse.                                                                                                                                                                                                                                                                  |
| [DeadLetterSource](/dotnet/api/microsoft.azure.servicebus.message.deadlettersource)                      | Cette propriété est uniquement définie dans les messages qui ont été placés dans la file d’attente de lettres mortes, puis automatiquement transférés à une autre entité à partir de cette file d’attente. Elle indique l’entité dans laquelle le message a été placé comme message de lettres mortes. Cette propriété est en lecture seule.                                                                                                                                                                                                                                  |
| [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount)                         | Cette propriété indique le nombre de tentatives de remise de ce message. Ce nombre est incrémenté lorsque le verrouillage d’un message arrive à expiration, ou que le message est explicitement abandonné par le destinataire. Cette propriété est en lecture seule.                                                                                                                                                                                                                                                  |
| [EnqueuedSequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedsequencenumber)                | Dans le cas des messages qui ont été transférés automatiquement, cette propriété reflète le numéro de séquence qui avait été initialement attribué au message à son point d’envoi d’origine. Cette propriété est en lecture seule.                                                                                                                                                                                                                                                                |
| [EnqueuedTimeUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.enqueuedtimeutc)                       | Cette propriété indique l’heure UTC à laquelle le message a été accepté et stocké dans l’entité. Cette valeur peut faire office d’indicateur d’heure d’arrivée de référence et neutre lorsque le destinataire ne souhaite pas se fier à l’horloge de l’expéditeur. Cette propriété est en lecture seule.                                                                                                                                                                                                   |
|  [ExpiresAtUtc](/dotnet/api/microsoft.azure.servicebus.message.expiresatutc) (absolute-expiry-time) | Cette propriété indique l’heure UTC à laquelle le message est marqué pour suppression et n’est plus récupérable à partir de l’entité en raison de son arrivée à expiration. L’arrivée à expiration est contrôlée par la propriété **TimeToLive**, et cette propriété est calculée à partir de la combinaison de propriétés EnqueuedTimeUtc+TimeToLive. Cette propriété est en lecture seule.                                                                                                                                                                           |
| [ForcePersistence](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence)                      | Dans le cas des files d’attente ou des rubriques pour lesquelles l’indicateur [EnableExpress](/dotnet/api/microsoft.servicebus.messaging.queuedescription.enableexpress?view=azureservicebus-4.1.1#Microsoft_ServiceBus_Messaging_QueueDescription_EnableExpress) est défini, cette propriété permet d’indiquer que le message doit être conservé sur le disque avant que sa réception ait été confirmée. Il s’agit du comportement standard pour toutes les entités non-express.                                                                                                                                                                                                         |
| [Label](/dotnet/api/microsoft.azure.servicebus.message.label) (subject)                       | Cette propriété permet à l’application d’indiquer de façon normalisée au destinataire la finalité du message, tout comme la ligne Objet d’un e-mail.                                                                                                                                                                                                                                                                                  |
| [LockedUntilUtc](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.lockeduntilutc)                        | Dans le cas des messages récupérés avec un verrouillage (mode de réception peek-lock, non préalablement réglé), cette propriété reflète l’heure UTC jusqu’à laquelle le message reste verrouillé dans la file d’attente/l’abonnement. Lorsque le verrouillage arrive à expiration, la propriété [DeliveryCount](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.deliverycount) est incrémentée, et le message redevient récupérable. Cette propriété est en lecture seule.                                                                                                                         |
| [LockToken](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.locktoken)                             | La valeur de jeton de verrouillage lock-token est une référence au verrouillage maintenu par le répartiteur en mode de réception *peek-lock*. Le jeton permet d’épingler définitivement le verrouillage par le biais de l’API [Deferral](message-deferral.md) et d’extraire ainsi le message du flux d’état de remise normale. Cette propriété est en lecture seule.                                                                                                                                                               |
| [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid) (message-id)                | L’identificateur de message est une valeur définie par l’application qui identifie de manière unique le message et sa charge utile. Cet identificateur est une chaîne à structure libre et peut refléter un identificateur global unique (GUID) ou un identificateur dérivé du contexte de l’application. Si elle est activée, la fonctionnalité de [détection des doublons](duplicate-detection.md) identifie et supprime les envois ultérieurs des messages présentant la même valeur **MessageId**.                                                                |
| [PartitionKey](/dotnet/api/microsoft.azure.servicebus.message.partitionkey)                          | Dans le cas des [entités partitionnées](service-bus-partitioning.md), la définition de cette valeur permet d’attribuer des messages associés à la même partition interne, afin que l’ordre de séquence d’envoi soit correctement enregistré. La partition est choisie par une fonction de hachage prioritaire sur cette valeur et ne peut pas être sélectionnée directement. Pour les entités prenant en charge la session, la propriété **SessionId** se substitue à cette valeur.                                                                                                       |
| [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto) (reply-to)                    | Cette valeur facultative et définie par l’application est un moyen standard d’exprimer un chemin d’accès de réponse à l’intention du destinataire du message. Lorsqu’un expéditeur attend une réponse, cette propriété définit cette valeur sur le chemin d’accès absolu ou relatif de la file d’attente ou de la rubrique auxquelles la réponse doit être envoyée.                                                                                                                                           |
| [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid) (reply-to-group-id)  | Cette valeur incrémente l’information **ReplyTo** et spécifie la valeur **SessionId** qui doit être définie pour la réponse lors de son envoi à l’entité de réponse.                                                                                                                                                                                                                                                                            |
| [ScheduledEnqueueTimeUtc](/dotnet/api/microsoft.azure.servicebus.message.scheduledenqueuetimeutc)               | Dans le cas des messages qui ne deviennent récupérables qu’après un délai spécifique, cette propriété définit l’heure UTC à laquelle le message sera logiquement empilé, séquencé et rendu récupérable.                                                                                                                                                                                                                 |
| [SequenceNumber](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.sequencenumber)                        | Le numéro de séquence est un entier 64 bits unique attribué à un message lorsque celui-ci est accepté et stocké par le répartiteur, et fait office de véritable identificateur du message. Dans le cas des entités partitionnées, les 16 premiers bits reflètent l’identificateur de partition. Les numéros de séquence augmentent de façon monotone et ininterrompue. Ils repassent à 0 lorsque la plage 48 à 64 bits est épuisée. Cette propriété est en lecture seule.                                                                |
| [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid) (group-id)                  | Dans le cas des entités prenant en charge la session, cette valeur définie par l’application spécifie l’affiliation de session du message. Les messages dotés du même identificateur de session sont soumis à un verrouillage du résumé et permettent un traitement et un démultiplexage chronologiques. Dans le cas des entités ne prenant pas en charge la session, cette valeur est ignorée.                                                                                                                                     |
| [Taille](/dotnet/api/microsoft.azure.servicebus.message.size)                                  | Cette propriété reflète la taille stockée du message dans le journal du répartiteur sous la forme d’un nombre d’octets, car cette valeur est prise en compte dans le quota de stockage. Cette propriété est en lecture seule.                                                                                                                                                                                                                                                                                                       |
| [State](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.state)                                 | Cette propriété indique l’état du message dans le journal. Elle est uniquement pertinente lors du parcours (« aperçu ») des messages afin de déterminer si un message est « actif » et récupérable puisqu’il a atteint le sommet de la file d’attente, si le message est différé ou s’il est en attente de planification. Cette propriété est en lecture seule.                                                                                                                                           |
| [TimeToLive](/dotnet/api/microsoft.azure.servicebus.message.timetolive)                            | Cette valeur indique la durée relative au terme de laquelle le message arrive à expiration, à partir du moment où le message a été accepté et stocké par le répartiteur, tel que capturé dans la propriété **EnqueueTimeUtc**. Lorsque cette valeur n’est pas définie explicitement, la valeur prise en compte est celle du paramètre **DefaultTimeToLive** pour la file d’attente ou la rubrique concernées. La valeur **TimeToLive** au niveau du message ne peut pas dépasser celle du paramètre **DefaultTimeToLive** de l’entité, et est automatiquement ajustée dans le cas contraire. |
| [To](/dotnet/api/microsoft.azure.servicebus.message.to) (to)                               | Cette propriété est réservée pour une utilisation ultérieure dans les scénarios de routage et est actuellement ignorée par le répartiteur proprement dit. Les applications peuvent utiliser cette valeur dans les scénarios de chaînage de transferts automatiques basés sur des règles afin d’indiquer la destination logique prévue du message.                                                                                                                                                                                   |
| [ViaPartitionKey](/dotnet/api/microsoft.azure.servicebus.message.viapartitionkey)                       | Si un message est envoyé par le biais d’une file d’attente de transfert dans l’étendue d’une transaction, cette valeur sélectionne la partition de file d’attente de transfert.                                                                                                                                                                                                                                                                                                                 |

Le modèle de message abstrait permet de publier un message dans une file d’attente par l’intermédiaire du protocole HTTP (en réalité, toujours HTTPS) et de le récupérer à l’aide d’AMQP. Dans les deux cas, le message semble normal dans le contexte du protocole utilisé. Les propriétés du répartiteur sont traduites en fonction des besoins, et les propriétés utilisateur sont mappées sur l’emplacement le plus approprié du modèle de message du protocole associé. En HTTP, les propriétés utilisateur sont directement mappées sur et depuis les en-têtes HTTP ; en AMQP, elles sont mappées sur et depuis le mappage **application-properties**.

## <a name="message-routing-and-correlation"></a>Routage et corrélation des messages

Certaines des propriétés de répartiteur décrites ci-dessus, plus précisément [To](/dotnet/api/microsoft.azure.servicebus.message.to), [ReplyTo](/dotnet/api/microsoft.azure.servicebus.message.replyto), [ReplyToSessionId](/dotnet/api/microsoft.azure.servicebus.message.replytosessionid), [MessageId](/dotnet/api/microsoft.azure.servicebus.message.messageid), [CorrelationId](/dotnet/api/microsoft.azure.servicebus.message.correlationid) et [SessionId](/dotnet/api/microsoft.azure.servicebus.message.sessionid), sont conçues pour aider les applications à router les messages vers des destinations spécifiques. Pour illustrer ceci, considérons quelques modèles :

- **Requête/réponse simples** : un serveur de publication envoie un message dans une file d’attente et attend une réponse du consommateur du message. Pour recevoir la réponse, le serveur de publication dispose d’une file d’attente à laquelle les réponses doivent être remises. L’adresse de cette file d’attente est exprimée dans la propriété **ReplyTo** du message sortant. Lorsque le consommateur répond, la valeur **MessageId** du message traité est copiée dans la propriété **CorrelationId** du message de réponse, et le message est remis à la destination indiquée par la propriété **ReplyTo**. Selon le contexte de l’application, un même message peut entraîner plusieurs réponses.
- **Requête/réponse multidiffusion** : dans le cadre de cette variante du modèle précédent, un serveur de publication envoie le message dans une rubrique, et plusieurs abonnés sont habilités à consommer le message. Chacun de ces abonnés peut répondre de la manière précédemment décrite. Ce modèle est utilisé dans les scénarios de détection ou de liste d’appel, et le répondant s’identifie généralement avec une propriété utilisateur ou dans la charge utile. Si la propriété **ReplyTo** pointe vers une rubrique, cet ensemble de réponses de détection peut être distribué à une audience.
- **Multiplexage** : cette fonctionnalité de session permet de multiplexer des flux de messages associés par le biais d’une file d’attente ou d’un abonnement uniques, de sorte que chaque session (ou groupe) de messages associés, identifiée par des valeurs **SessionId** correspondantes, soit routée vers un destinataire spécifique pendant que ce dernier maintient sa session verrouillée. Pour plus d’informations sur les détails des sessions, consultez [cet article](message-sessions.md).
- **Requête/réponse multiplexées** : cette fonctionnalité de session autorise le multiplexage des réponses et permet ainsi à plusieurs serveurs de publication de partager une file d’attente de réponse. En définissant la propriété **ReplyToSessionId**, le serveur de publication peut demander aux consommateurs de copier cette valeur dans la propriété **SessionId** du message de réponse. La file d’attente ou la rubrique de publication n’ont pas besoin de prendre en charge la session. Une fois le message envoyé, le moteur de publication peut alors attendre spécifiquement qu’une session présentant la valeur **SessionId** correspondante se matérialise sur la file d’attente en acceptant de manière conditionnelle un destinataire de session. 

Le routage à l’intérieur d’un espace de noms Service Bus peut être effectué à l’aide de règles de chaînage de transferts automatiques et d’abonnement aux rubriques. Le routage au sein des espaces de noms est réalisable [par l’intermédiaire d’Azure Logic Apps](https://azure.microsoft.com/services/logic-apps/). Comme indiqué dans la liste précédente, la propriété **To** est réservée pour une utilisation ultérieure et peut finalement être interprétée par le répartiteur avec une fonctionnalité activée spécialement. Les applications destinées à implémenter le routage doivent effectuer cette opération à l’aide des propriétés utilisateur plutôt qu’en s’appuyant sur la propriété **To** ; toutefois, le choix de cette dernière solution n’entraîne plus de problèmes de compatibilité.

## <a name="payload-serialization"></a>Sérialisation de la charge utile

Lorsque la charge utile est en transit ou stockée à l’intérieur de Service Bus, elle constitue toujours un bloc binaire opaque. La propriété [ContentType](/dotnet/api/microsoft.azure.servicebus.message.contenttype) permet aux applications de décrire la charge utile, et le format recommandé pour les valeurs de cette propriété est une description Content-Type MIME conforme à IETF RFC2045, par exemple `application/json;charset=utf-8`.

Contrairement aux variantes Java ou .NET Standard, la version .NET Framework de l’API Service Bus prend en charge la création d’instances **BrokeredMessage** en transmettant des objets .NET arbitraires dans le constructeur. 

En cas d’utilisation du protocole SBMP hérité, ces objets sont sérialisés avec le sérialiseur binaire par défaut ou avec un sérialiseur fourni en externe. Si le protocole AMQP est utilisé, l’objet est sérialisé dans un objet AMQP. Le destinataire peut récupérer ces objets avec la méthode [GetBody<T>()](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.getbody#Microsoft_ServiceBus_Messaging_BrokeredMessage_GetBody__1), qui fournit le type attendu ; avec AMQP, les objets sont sérialisés dans un graphique AMQP d’objets **ArrayList** et **IDictionary<string,object>**, puis décodés par n’importe quel client AMQP. 

Bien que cette sérialisation cachée se révèle commode, les applications doivent contrôler explicitement la sérialisation des objets et convertir leurs graphiques d’objets en flux avant de les inclure dans un message, ainsi qu’effectuer l’opération inverse côté destinataire. Ceci entraîne des résultats interopérables. Il convient également de noter que bien qu’AMQP dispose d’un modèle d’encodage binaire très puissant, il est lié à l’écosystème de messagerie AMQP, et les clients HTTP auront donc des difficultés à décoder les charges utiles de ce type. 

Nous recommandons généralement d’utiliser JSON et Apache Avro comme formats de charge utile pour les données structurées.

Les variantes d’API .NET Standard et Java acceptent uniquement les tableaux d’octets, ce qui signifie que l’application doit gérer le contrôle de sérialisation des objets. 

## <a name="next-steps"></a>Étapes suivantes

Pour plus d’informations sur la messagerie Service Bus, consultez les articles suivants :

* [Concepts de base de Service Bus](service-bus-fundamentals-hybrid-solutions.md)
* [Files d’attente, rubriques et abonnements Service Bus](service-bus-queues-topics-subscriptions.md)
* [Prise en main des files d’attente Service Bus](service-bus-dotnet-get-started-with-queues.md)
* [Utilisation des rubriques et abonnements Service Bus](service-bus-dotnet-how-to-use-topics-subscriptions.md)