---
title: "les files d’attente d’aaaHow toouse Azure Service Bus Ruby | Documents Microsoft"
description: "Découvrez comment toouse Service Bus de files d’attente dans Azure. Exemples de code écrits en Ruby."
services: service-bus-messaging
documentationcenter: ruby
author: sethmanheim
manager: timlt
editor: 
ms.assetid: 0a11eab2-823f-4cc7-842b-fbbe0f953751
ms.service: service-bus-messaging
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: ruby
ms.topic: article
ms.date: 08/10/2017
ms.author: sethm
ms.openlocfilehash: 7270154583f98e3372e82efbb967ea7a5acd1686
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-service-bus-queues-with-ruby"></a><span data-ttu-id="174a6-104">Comment toouse Service Bus de files d’attente Ruby</span><span class="sxs-lookup"><span data-stu-id="174a6-104">How toouse Service Bus queues with Ruby</span></span>

[!INCLUDE [service-bus-selector-queues](../../includes/service-bus-selector-queues.md)]

<span data-ttu-id="174a6-105">Ce guide décrit comment les files d’attente de toouse Service Bus.</span><span class="sxs-lookup"><span data-stu-id="174a6-105">This guide describes how toouse Service Bus queues.</span></span> <span data-ttu-id="174a6-106">exemples de Hello sont écrits en Ruby et utilisent hello marque Azure.</span><span class="sxs-lookup"><span data-stu-id="174a6-106">hello samples are written in Ruby and use hello Azure gem.</span></span> <span data-ttu-id="174a6-107">Hello scénarios abordés incluent **création de files d’attente, envoyer et recevoir des messages**, et **la suppression de files d’attente**.</span><span class="sxs-lookup"><span data-stu-id="174a6-107">hello scenarios covered include **creating queues, sending and receiving messages**, and **deleting queues**.</span></span> <span data-ttu-id="174a6-108">Pour plus d’informations sur les files d’attente Service Bus, consultez hello [étapes](#next-steps) section.</span><span class="sxs-lookup"><span data-stu-id="174a6-108">For more information about Service Bus queues, see hello [Next Steps](#next-steps) section.</span></span>

[!INCLUDE [howto-service-bus-queues](../../includes/howto-service-bus-queues.md)]

[!INCLUDE [service-bus-create-namespace-portal](../../includes/service-bus-create-namespace-portal.md)]
   
[!INCLUDE [service-bus-ruby-setup](../../includes/service-bus-ruby-setup.md)]

## <a name="how-toocreate-a-queue"></a><span data-ttu-id="174a6-109">Comment toocreate une file d’attente</span><span class="sxs-lookup"><span data-stu-id="174a6-109">How toocreate a queue</span></span>
<span data-ttu-id="174a6-110">Hello **Azure::ServiceBusService** objet vous permet de toowork avec les files d’attente.</span><span class="sxs-lookup"><span data-stu-id="174a6-110">hello **Azure::ServiceBusService** object enables you toowork with queues.</span></span> <span data-ttu-id="174a6-111">toocreate une file d’attente, utilisez hello `create_queue()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="174a6-111">toocreate a queue, use hello `create_queue()` method.</span></span> <span data-ttu-id="174a6-112">Hello exemple suivant crée une file d’attente ou imprime les erreurs.</span><span class="sxs-lookup"><span data-stu-id="174a6-112">hello following example creates a queue or prints out any errors.</span></span>

```ruby
azure_service_bus_service = Azure::ServiceBus::ServiceBusService.new(sb_host, { signer: signer})
begin
  queue = azure_service_bus_service.create_queue("test-queue")
rescue
  puts $!
end
```

<span data-ttu-id="174a6-113">Vous pouvez également passer un **Azure::ServiceBus::Queue** de l’objet avec des options supplémentaires, qui vous permet de paramètres file d’attente par défaut toooverride hello, telles que la taille de file d’attente toolive ou maximale message temps.</span><span class="sxs-lookup"><span data-stu-id="174a6-113">You can also pass a **Azure::ServiceBus::Queue** object with additional options, which enables you toooverride hello default queue settings, such as message time toolive or maximum queue size.</span></span> <span data-ttu-id="174a6-114">Bonjour à l’exemple suivant montre comment les tooset hello too5 de taille de file d’attente maximale Go et too1 toolive minutes de temps :</span><span class="sxs-lookup"><span data-stu-id="174a6-114">hello following example shows how tooset hello maximum queue size too5 GB and time toolive too1 minute:</span></span>

```ruby
queue = Azure::ServiceBus::Queue.new("test-queue")
queue.max_size_in_megabytes = 5120
queue.default_message_time_to_live = "PT1M"

queue = azure_service_bus_service.create_queue(queue)
```

## <a name="how-toosend-messages-tooa-queue"></a><span data-ttu-id="174a6-115">Comment la file d’attente de tooa de messages toosend</span><span class="sxs-lookup"><span data-stu-id="174a6-115">How toosend messages tooa queue</span></span>
<span data-ttu-id="174a6-116">toosend une file d’attente Service Bus de messages tooa, votre application appelle hello `send_queue_message()` méthode sur hello **Azure::ServiceBusService** objet.</span><span class="sxs-lookup"><span data-stu-id="174a6-116">toosend a message tooa Service Bus queue, your application calls hello `send_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="174a6-117">Trop envoyée (et reçues à partir de) Service Bus sont des files d’attente de messages **Azure::ServiceBus::BrokeredMessage** , et qu’un ensemble de propriétés standard (tels que `label` et `time_to_live`), un dictionnaire qui est utilisé toohold les propriétés spécifiques à l’application personnalisées et un corps de données d’application arbitraire.</span><span class="sxs-lookup"><span data-stu-id="174a6-117">Messages sent too(and received from) Service Bus queues are **Azure::ServiceBus::BrokeredMessage** objects, and have a set of standard properties (such as `label` and `time_to_live`), a dictionary that is used toohold custom application-specific properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="174a6-118">Une application peut définir le corps de hello du message de type hello en passant une valeur de chaîne en tant que message de type hello et les propriétés standards sont remplies avec les valeurs par défaut.</span><span class="sxs-lookup"><span data-stu-id="174a6-118">An application can set hello body of hello message by passing a string value as hello message and any required standard properties are populated with default values.</span></span>

<span data-ttu-id="174a6-119">Hello exemple suivant montre comment toosend une file d’attente toohello test nommé `test-queue` à l’aide de `send_queue_message()`:</span><span class="sxs-lookup"><span data-stu-id="174a6-119">hello following example demonstrates how toosend a test message toohello queue named `test-queue` using `send_queue_message()`:</span></span>

```ruby
message = Azure::ServiceBus::BrokeredMessage.new("test queue message")
message.correlation_id = "test-correlation-id"
azure_service_bus_service.send_queue_message("test-queue", message)
```

<span data-ttu-id="174a6-120">Les files d’attente Service Bus prend en charge une taille maximale de 256 Ko Bonjour [niveau Standard](service-bus-premium-messaging.md) et 1 Mo Bonjour [niveau Premium](service-bus-premium-messaging.md).</span><span class="sxs-lookup"><span data-stu-id="174a6-120">Service Bus queues support a maximum message size of 256 KB in hello [Standard tier](service-bus-premium-messaging.md) and 1 MB in hello [Premium tier](service-bus-premium-messaging.md).</span></span> <span data-ttu-id="174a6-121">en-tête Hello, qui inclut les standard hello et les propriétés de l’application personnalisée, peut avoir une taille maximale de 64 Ko.</span><span class="sxs-lookup"><span data-stu-id="174a6-121">hello header, which includes hello standard and custom application properties, can have a maximum size of 64 KB.</span></span> <span data-ttu-id="174a6-122">Il n’existe aucune limite du nombre de hello de messages dans une file d’attente mais hello de taille totale des messages hello détenus par une file d’attente est une extrémité de fin.</span><span class="sxs-lookup"><span data-stu-id="174a6-122">There is no limit on hello number of messages held in a queue but there is a cap on hello total size of hello messages held by a queue.</span></span> <span data-ttu-id="174a6-123">Cette taille de file d'attente est définie au moment de la création. La limite maximale est de 5 Go.</span><span class="sxs-lookup"><span data-stu-id="174a6-123">This queue size is defined at creation time, with an upper limit of 5 GB.</span></span>

## <a name="how-tooreceive-messages-from-a-queue"></a><span data-ttu-id="174a6-124">Comment tooreceive les messages à partir d’une file d’attente</span><span class="sxs-lookup"><span data-stu-id="174a6-124">How tooreceive messages from a queue</span></span>
<span data-ttu-id="174a6-125">Les messages sont reçus à partir d’une file d’attente à l’aide de hello `receive_queue_message()` méthode sur hello **Azure::ServiceBusService** objet.</span><span class="sxs-lookup"><span data-stu-id="174a6-125">Messages are received from a queue using hello `receive_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="174a6-126">Par défaut, les messages sont lus et verrouillés sans les supprimer de la file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="174a6-126">By default, messages are read and locked without being deleted from hello queue.</span></span> <span data-ttu-id="174a6-127">Toutefois, vous pouvez supprimer des messages à partir de la file d’attente hello lorsqu’elles sont lues par la définition de hello `:peek_lock` option trop**false**.</span><span class="sxs-lookup"><span data-stu-id="174a6-127">However, you can delete messages from hello queue as they are read by setting hello `:peek_lock` option too**false**.</span></span>

<span data-ttu-id="174a6-128">comportement par défaut de Hello rend hello lors de la lecture et de suppression d’une opération de deux étapes, ce qui le rend également toosupport possible les applications qui ne peut pas tolérer des messages manquants.</span><span class="sxs-lookup"><span data-stu-id="174a6-128">hello default behavior makes hello reading and deleting a two-stage operation, which also makes it possible toosupport applications that cannot tolerate missing messages.</span></span> <span data-ttu-id="174a6-129">Lorsque le Service Bus reçoit une demande, il recherche hello suivant message toobe consommé, il verrouille tooprevent autres consommateurs le reçoivent et le retourne toohello application.</span><span class="sxs-lookup"><span data-stu-id="174a6-129">When Service Bus receives a request, it finds hello next message toobe consumed, locks it tooprevent other consumers receiving it, and then returns it toohello application.</span></span> <span data-ttu-id="174a6-130">Une fois l’application hello termine le traitement de message de type hello (ou stocke de manière fiable pour un traitement ultérieur), il termine hello deuxième étape du hello processus de réception en appelant `delete_queue_message()` (méthode) et en fournissant des toobe de message hello supprimé en tant que paramètre.</span><span class="sxs-lookup"><span data-stu-id="174a6-130">After hello application finishes processing hello message (or stores it reliably for future processing), it completes hello second stage of hello receive process by calling `delete_queue_message()` method and providing hello message toobe deleted as a parameter.</span></span> <span data-ttu-id="174a6-131">Hello `delete_queue_message()` méthode marquer le message de type hello comme ayant été consommé et supprimez-le de la file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="174a6-131">hello `delete_queue_message()` method will mark hello message as being consumed and remove it from hello queue.</span></span>

<span data-ttu-id="174a6-132">Si hello `:peek_lock` paramètre est défini trop**false**, la lecture et suppression d’un message de salutation devient le modèle le plus simple hello et convient le mieux pour les scénarios dans lesquels une application peut tolérer ne pas traiter un message dans l’événement de hello un Échec.</span><span class="sxs-lookup"><span data-stu-id="174a6-132">If hello `:peek_lock` parameter is set too**false**, reading and deleting hello message becomes hello simplest model, and works best for scenarios in which an application can tolerate not processing a message in hello event of a failure.</span></span> <span data-ttu-id="174a6-133">toounderstand, envisagez un scénario dans les problèmes liés aux consommateurs de hello hello reçoit la demande et puis se bloque avant de le traiter.</span><span class="sxs-lookup"><span data-stu-id="174a6-133">toounderstand this, consider a scenario in which hello consumer issues hello receive request and then crashes before processing it.</span></span> <span data-ttu-id="174a6-134">Étant donné que le Service Bus a marqué le message de type hello comme ayant été consommé, quand l’application hello redémarre et commence à consommer des messages, elle aura manqué message de type hello qui a été consommée toohello préalable incident.</span><span class="sxs-lookup"><span data-stu-id="174a6-134">Because Service Bus has marked hello message as being consumed, when hello application restarts and begins consuming messages again, it will have missed hello message that was consumed prior toohello crash.</span></span>

<span data-ttu-id="174a6-135">Hello exemple suivant montre comment tooreceive et processus de messages à l’aide de `receive_queue_message()`.</span><span class="sxs-lookup"><span data-stu-id="174a6-135">hello following example demonstrates how tooreceive and process messages using `receive_queue_message()`.</span></span> <span data-ttu-id="174a6-136">tout d’abord, Hello exemple reçoit et supprime un message à l’aide de `:peek_lock` défini trop**false**, il reçoit un autre message, puis puis suppressions hello à l’aide du message `delete_queue_message()`:</span><span class="sxs-lookup"><span data-stu-id="174a6-136">hello example first receives and deletes a message by using `:peek_lock` set too**false**, then it receives another message and then deletes hello message using `delete_queue_message()`:</span></span>

```ruby
message = azure_service_bus_service.receive_queue_message("test-queue",
  { :peek_lock => false })
message = azure_service_bus_service.receive_queue_message("test-queue")
azure_service_bus_service.delete_queue_message(message)
```

## <a name="how-toohandle-application-crashes-and-unreadable-messages"></a><span data-ttu-id="174a6-137">Comment toohandle application tombe en panne et messages illisibles</span><span class="sxs-lookup"><span data-stu-id="174a6-137">How toohandle application crashes and unreadable messages</span></span>
<span data-ttu-id="174a6-138">Service Bus fournit toohelp fonctionnalité que surmonter les erreurs dans votre application ou les difficultés du traitement d’un message.</span><span class="sxs-lookup"><span data-stu-id="174a6-138">Service Bus provides functionality toohelp you gracefully recover from errors in your application or difficulties processing a message.</span></span> <span data-ttu-id="174a6-139">Si une application du récepteur ne peut pas tooprocess hello message pour une raison quelconque, elle peut appeler hello `unlock_queue_message()` méthode sur hello **Azure::ServiceBusService** objet.</span><span class="sxs-lookup"><span data-stu-id="174a6-139">If a receiver application is unable tooprocess hello message for some reason, then it can call hello `unlock_queue_message()` method on hello **Azure::ServiceBusService** object.</span></span> <span data-ttu-id="174a6-140">Cela entraîne appel hello toounlock de Service Bus de messages dans la file d’attente hello et le rendre disponible toobe reçu, soit par Bonjour même consommation d’application ou par une autre application consommatrice.</span><span class="sxs-lookup"><span data-stu-id="174a6-140">This call causes Service Bus toounlock hello message within hello queue and make it available toobe received again, either by hello same consuming application or by another consuming application.</span></span>

<span data-ttu-id="174a6-141">Il existe également un délai d’attente d’un message verrouillé dans la file d’attente hello et en cas d’un message de type hello tooprocess avant application hello hello expiration délai de verrouillage (par exemple, si de l’application hello se bloque), puis le Service Bus déverrouille le message de type hello automatiquement et le rend disponible toobe de nouveau reçu.</span><span class="sxs-lookup"><span data-stu-id="174a6-141">There is also a timeout associated with a message locked within hello queue, and if hello application fails tooprocess hello message before hello lock timeout expires (for example, if hello application crashes), then Service Bus unlocks hello message automatically and makes it available toobe received again.</span></span>

<span data-ttu-id="174a6-142">Bonjour événement hello application se bloque après le traitement de message de type hello mais avant hello `delete_queue_message()` méthode est appelée, puis le message de type hello est redistribué toohello application lors de son redémarrage.</span><span class="sxs-lookup"><span data-stu-id="174a6-142">In hello event that hello application crashes after processing hello message but before hello `delete_queue_message()` method is called, then hello message is redelivered toohello application when it restarts.</span></span> <span data-ttu-id="174a6-143">Ce processus est souvent appelé *au moins une fois le traitement*; autrement dit, chaque message est traité au moins une fois, mais dans certain hello situations le même message peut être redistribué.</span><span class="sxs-lookup"><span data-stu-id="174a6-143">This process is often called *At Least Once Processing*; that is, each message is processed at least once but in certain situations hello same message may be redelivered.</span></span> <span data-ttu-id="174a6-144">Si le scénario de hello ne peut pas tolérer le traitement dupliqué, les développeurs d’applications doivent ajouter une logique supplémentaire tootheir application toohandle en double remise du message.</span><span class="sxs-lookup"><span data-stu-id="174a6-144">If hello scenario cannot tolerate duplicate processing, then application developers should add additional logic tootheir application toohandle duplicate message delivery.</span></span> <span data-ttu-id="174a6-145">Cela est souvent obtenue à l’aide de hello `message_id` propriété de message de type hello, qui reste constante entre les tentatives de remise.</span><span class="sxs-lookup"><span data-stu-id="174a6-145">This is often achieved using hello `message_id` property of hello message, which remains constant across delivery attempts.</span></span>

## <a name="next-steps"></a><span data-ttu-id="174a6-146">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="174a6-146">Next steps</span></span>
<span data-ttu-id="174a6-147">Maintenant que vous avez appris les notions de base de hello de files d’attente Service Bus, suivez ces liens de toolearn plus.</span><span class="sxs-lookup"><span data-stu-id="174a6-147">Now that you've learned hello basics of Service Bus queues, follow these links toolearn more.</span></span>

* <span data-ttu-id="174a6-148">Vue d’ensemble des [files d’attente, rubriques et abonnements](service-bus-queues-topics-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="174a6-148">Overview of [queues, topics, and subscriptions](service-bus-queues-topics-subscriptions.md).</span></span>
* <span data-ttu-id="174a6-149">Visitez hello [Azure SDK pour Ruby](https://github.com/Azure/azure-sdk-for-ruby) référentiel sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="174a6-149">Visit hello [Azure SDK for Ruby](https://github.com/Azure/azure-sdk-for-ruby) repository on GitHub.</span></span>

<span data-ttu-id="174a6-150">Pour obtenir une comparaison entre les files d’attente Azure Service Bus hello abordés dans cet article et des files d’attente Azure présentés dans hello [comment toouse stockage de file d’attente à partir de Ruby](../storage/queues/storage-ruby-how-to-use-queue-storage.md) l’article, consultez [Azure files d’attente et Azure Service Bus - comparées et différences](service-bus-azure-and-service-bus-queues-compared-contrasted.md)</span><span class="sxs-lookup"><span data-stu-id="174a6-150">For a comparison between hello Azure Service Bus queues discussed in this article and Azure Queues discussed in hello [How toouse Queue storage from Ruby](../storage/queues/storage-ruby-how-to-use-queue-storage.md) article, see [Azure Queues and Azure Service Bus Queues - Compared and Contrasted](service-bus-azure-and-service-bus-queues-compared-contrasted.md)</span></span>

