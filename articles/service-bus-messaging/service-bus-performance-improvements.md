---
title: "pratiques aaaBest pour améliorer les performances à l’aide d’Azure Service Bus | Documents Microsoft"
description: "Décrit comment toouse les performances de toooptimize Service Bus lors de l’échange répartie des messages."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: 52764d227757cbb11246675878933f21685817f1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="db81d-103">Meilleures pratiques relatives aux améliorations de performances à l’aide de la messagerie Service Bus</span><span class="sxs-lookup"><span data-stu-id="db81d-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="db81d-104">Cet article décrit comment toouse [messagerie Azure Service Bus](https://azure.microsoft.com/services/service-bus/) toooptimize performances lors de l’échange répartie des messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-104">This article describes how toouse [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) toooptimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="db81d-105">Hello première partie de cette rubrique décrit les mécanismes de différents hello offerts toohelp augmentation des performances.</span><span class="sxs-lookup"><span data-stu-id="db81d-105">hello first part of this topic describes hello different mechanisms that are offered toohelp increase performance.</span></span> <span data-ttu-id="db81d-106">deuxième partie de Hello fournit des conseils sur la toouse Service Bus d’une façon qui peut offrir hello des performances optimales dans un scénario donné.</span><span class="sxs-lookup"><span data-stu-id="db81d-106">hello second part provides guidance on how toouse Service Bus in a way that can offer hello best performance in a given scenario.</span></span>

<span data-ttu-id="db81d-107">Dans cette rubrique, le terme hello « client » fait référence entité tooany qui accède au Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-107">Throughout this topic, hello term "client" refers tooany entity that accesses Service Bus.</span></span> <span data-ttu-id="db81d-108">Un client peut prendre le rôle hello d’un expéditeur ou récepteur.</span><span class="sxs-lookup"><span data-stu-id="db81d-108">A client can take hello role of a sender or a receiver.</span></span> <span data-ttu-id="db81d-109">le terme Hello « expéditeur » est utilisé pour un client de file d’attente ou rubrique Service Bus qui envoie la file d’attente Service Bus de messages tooa ou une rubrique.</span><span class="sxs-lookup"><span data-stu-id="db81d-109">hello term "sender" is used for a Service Bus queue or topic client that sends messages tooa Service Bus queue or topic.</span></span> <span data-ttu-id="db81d-110">le terme Hello « récepteur » fait référence client de file d’attente ou d’un abonnement de Bus de Service tooa qui reçoit les messages d’une file d’attente du Bus de Service ou d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="db81d-110">hello term "receiver" refers tooa Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="db81d-111">Les sections suivantes présentent plusieurs concepts que Service Bus utilise toohelp améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="db81d-111">These sections introduce several concepts that Service Bus uses toohelp boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="db81d-112">Protocoles</span><span class="sxs-lookup"><span data-stu-id="db81d-112">Protocols</span></span>
<span data-ttu-id="db81d-113">Service Bus permet les clients toosend et recevoir des messages via l’une des trois protocoles :</span><span class="sxs-lookup"><span data-stu-id="db81d-113">Service Bus enables clients toosend and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="db81d-114">Advanced Message Queuing Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="db81d-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="db81d-115">Service Bus Messaging Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="db81d-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="db81d-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="db81d-116">HTTP</span></span>

<span data-ttu-id="db81d-117">SBMP et AMQP sont plus efficaces, car elles conservent hello connexion tooService Bus tant que fabrique de messagerie hello existe.</span><span class="sxs-lookup"><span data-stu-id="db81d-117">AMQP and SBMP are more efficient, because they maintain hello connection tooService Bus as long as hello messaging factory exists.</span></span> <span data-ttu-id="db81d-118">Il permet également le traitement par lot et la lecture anticipée.</span><span class="sxs-lookup"><span data-stu-id="db81d-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="db81d-119">Sauf mention explicite, tout le contenu de cette rubrique suppose l’utilisation de hello d’AMQP ou SBMP.</span><span class="sxs-lookup"><span data-stu-id="db81d-119">Unless explicitly mentioned, all content in this topic assumes hello use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="db81d-120">Réutilisation de structures et de clients</span><span class="sxs-lookup"><span data-stu-id="db81d-120">Reusing factories and clients</span></span>
<span data-ttu-id="db81d-121">Des objets client Service Bus, tels que [QueueClient][QueueClient] ou [MessageSender][MessageSender], sont créés via un objet [MessagingFactory][MessagingFactory], qui assure également la gestion interne des connexions.</span><span class="sxs-lookup"><span data-stu-id="db81d-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="db81d-122">Vous ne devez pas fermer fabriques de messageries ou file d’attente, rubrique et clients de l’abonnement après l’envoi d’un message et puis de les recréer lorsque vous envoyez le message de type hello suivant.</span><span class="sxs-lookup"><span data-stu-id="db81d-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send hello next message.</span></span> <span data-ttu-id="db81d-123">Fermeture d’une fabrique de messagerie supprime hello connexion toohello Service service Bus, et une nouvelle connexion est établie lorsque vous recréez la fabrique de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-123">Closing a messaging factory deletes hello connection toohello Service Bus service, and a new connection is established when recreating hello factory.</span></span> <span data-ttu-id="db81d-124">Objets de l’établissement de qu'une connexion est une opération coûteuse que vous pouvez éviter en réutilisant hello même fabrique et client pour plusieurs opérations.</span><span class="sxs-lookup"><span data-stu-id="db81d-124">Establishing a connection is an expensive operation that you can avoid by re-using hello same factory and client objects for multiple operations.</span></span> <span data-ttu-id="db81d-125">Vous pouvez utiliser en toute sécurité hello [QueueClient] [ QueueClient] objet pour envoyer des messages à partir de plusieurs threads et les opérations asynchrones simultanées.</span><span class="sxs-lookup"><span data-stu-id="db81d-125">You can safely use hello [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="db81d-126">Opérations simultanées</span><span class="sxs-lookup"><span data-stu-id="db81d-126">Concurrent operations</span></span>
<span data-ttu-id="db81d-127">L’exécution d’une opération (envoi, réception, suppression, etc.) prend un certain temps.</span><span class="sxs-lookup"><span data-stu-id="db81d-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="db81d-128">Ce temps inclut traitement hello d’opération de hello en hello Service service Bus de latence de toohello d’ajout de la demande de hello et réponse de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-128">This time includes hello processing of hello operation by hello Service Bus service in addition toohello latency of hello request and hello reply.</span></span> <span data-ttu-id="db81d-129">nombre de hello tooincrease d’opérations par période, les opérations doivent s’exécuter simultanément.</span><span class="sxs-lookup"><span data-stu-id="db81d-129">tooincrease hello number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="db81d-130">Pour cela, vous pouvez procéder de plusieurs façons différentes :</span><span class="sxs-lookup"><span data-stu-id="db81d-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="db81d-131">**Opérations asynchrones**: client de hello planifie les opérations en effectuant des opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="db81d-131">**Asynchronous operations**: hello client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="db81d-132">demande suivante de Hello est démarré avant de la demande précédente de hello est terminée.</span><span class="sxs-lookup"><span data-stu-id="db81d-132">hello next request is started before hello previous request is completed.</span></span> <span data-ttu-id="db81d-133">Hello Voici un exemple d’une opération d’envoi asynchrone :</span><span class="sxs-lookup"><span data-stu-id="db81d-133">hello following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="db81d-134">Voici un exemple d’opération de réception asynchrone :</span><span class="sxs-lookup"><span data-stu-id="db81d-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="db81d-135">**Plusieurs fabriques**: tous les clients (expéditeurs dans Ajout tooreceivers) qui sont créés par hello même fabrique partage une connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="db81d-135">**Multiple factories**: all clients (senders in addition tooreceivers) that are created by hello same factory share one TCP connection.</span></span> <span data-ttu-id="db81d-136">débit de message maximale Hello est limité par nombre de hello d’opérations pouvant circuler via cette connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="db81d-136">hello maximum message throughput is limited by hello number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="db81d-137">débit Hello qui peut être obtenu avec une seule fabrique varie grandement en fonction des durées de parcours circulaire TCP et la taille des messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-137">hello throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="db81d-138">taux de débit supérieurs tooobtain, vous devez utiliser plusieurs fabriques de messageries.</span><span class="sxs-lookup"><span data-stu-id="db81d-138">tooobtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="db81d-139">Mode de réception</span><span class="sxs-lookup"><span data-stu-id="db81d-139">Receive mode</span></span>
<span data-ttu-id="db81d-140">Lorsque vous créez un client de file d’attente ou d’abonnement, vous pouvez spécifier un mode de réception : *verrouillage* ou *recevoir et supprimer*.</span><span class="sxs-lookup"><span data-stu-id="db81d-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="db81d-141">mode de réception par défaut de Hello est [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="db81d-141">hello default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="db81d-142">Lors du fonctionnement dans ce mode, client de hello envoie à un tooreceive demande un message à partir de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-142">When operating in this mode, hello client sends a request tooreceive a message from Service Bus.</span></span> <span data-ttu-id="db81d-143">Une fois que le client de hello a reçu le message de type hello, il envoie un message de type hello toocomplete demande.</span><span class="sxs-lookup"><span data-stu-id="db81d-143">After hello client has received hello message, it sends a request toocomplete hello message.</span></span>

<span data-ttu-id="db81d-144">Lorsque la définition de hello mode de réception trop[ReceiveAndDelete][ReceiveAndDelete], les deux étapes sont combinées dans une demande unique.</span><span class="sxs-lookup"><span data-stu-id="db81d-144">When setting hello receive mode too[ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="db81d-145">Cela réduit le nombre total d’opérations de hello et peut améliorer les hello débit général des messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-145">This reduces hello overall number of operations, and can improve hello overall message throughput.</span></span> <span data-ttu-id="db81d-146">Ce gain de performances est fourni à des risques de perdre des messages hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-146">This performance gain comes at hello risk of losing messages.</span></span>

<span data-ttu-id="db81d-147">Service Bus ne gère pas les transactions des opérations de réception-suppression.</span><span class="sxs-lookup"><span data-stu-id="db81d-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="db81d-148">En outre, les sémantiques afficher-verrouiller sont requis pour les scénarios qui Bonjour client veut toodefer ou [mortes](service-bus-dead-letter-queues.md) un message.</span><span class="sxs-lookup"><span data-stu-id="db81d-148">In addition, peek-lock semantics are required for any scenarios in which hello client wants toodefer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="db81d-149">Traitement par lots côté client</span><span class="sxs-lookup"><span data-stu-id="db81d-149">Client-side batching</span></span>
<span data-ttu-id="db81d-150">Le traitement par lots côté client permet à une file d’attente ou rubrique client toodelay hello envoi d’un message pour un certain temps.</span><span class="sxs-lookup"><span data-stu-id="db81d-150">Client-side batching enables a queue or topic client toodelay hello sending of a message for a certain period of time.</span></span> <span data-ttu-id="db81d-151">Si le client de hello envoie d’autres messages pendant cette période, il transmet les messages hello dans un lot unique.</span><span class="sxs-lookup"><span data-stu-id="db81d-151">If hello client sends additional messages during this time period, it transmits hello messages in a single batch.</span></span> <span data-ttu-id="db81d-152">Le traitement par lots côté client entraîne également une toobatch de client de file d’attente ou abonnement plusieurs **Complete** requêtes en une seule requête.</span><span class="sxs-lookup"><span data-stu-id="db81d-152">Client-side batching also causes a queue or subscription client toobatch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="db81d-153">Le traitement par lots n’est disponible que pour les opérations **d’envoi** et **complètes** asynchrones.</span><span class="sxs-lookup"><span data-stu-id="db81d-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="db81d-154">Opérations synchrones sont envoyées immédiatement toohello Service service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-154">Synchronous operations are immediately sent toohello Service Bus service.</span></span> <span data-ttu-id="db81d-155">Le traitement par lots ne peut pas concerner des opérations de verrouillage ou de réception, ou plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="db81d-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="db81d-156">Par défaut, un client utilise un intervalle 20 ms entre les lots.</span><span class="sxs-lookup"><span data-stu-id="db81d-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="db81d-157">Vous pouvez modifier l’intervalle de lot hello en définissant un hello [BatchFlushInterval] [ BatchFlushInterval] propriété avant de créer hello fabrique de messagerie.</span><span class="sxs-lookup"><span data-stu-id="db81d-157">You can change hello batch interval by setting hello [BatchFlushInterval][BatchFlushInterval] property before creating hello messaging factory.</span></span> <span data-ttu-id="db81d-158">Ce paramètre affecte tous les clients créés par cette structure.</span><span class="sxs-lookup"><span data-stu-id="db81d-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="db81d-159">toodisable de traitement par lot, définissez hello [BatchFlushInterval] [ BatchFlushInterval] propriété trop**TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="db81d-159">toodisable batching, set hello [BatchFlushInterval][BatchFlushInterval] property too**TimeSpan.Zero**.</span></span> <span data-ttu-id="db81d-160">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="db81d-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="db81d-161">Le traitement par lot n’affecte pas le nombre de hello d’opérations de messagerie facturables et est disponible uniquement pour hello protocole client de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-161">Batching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="db81d-162">Hello protocole HTTP ne prend pas en charge le traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-162">hello HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="db81d-163">Accès au dispositif de stockage de traitement par lot</span><span class="sxs-lookup"><span data-stu-id="db81d-163">Batching store access</span></span>
<span data-ttu-id="db81d-164">débit hello tooincrease de file d’attente, rubrique ou abonnement Service Bus regroupe plusieurs messages lors de l’écriture de magasin interne de tooits.</span><span class="sxs-lookup"><span data-stu-id="db81d-164">tooincrease hello throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes tooits internal store.</span></span> <span data-ttu-id="db81d-165">S’il est activé sur une file d’attente ou une rubrique, l’écriture de messages dans le magasin de hello est traités par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-165">If enabled on a queue or topic, writing messages into hello store will be batched.</span></span> <span data-ttu-id="db81d-166">S’il est activé sur une file d’attente ou un abonnement, suppression des messages à partir du magasin de hello est traités par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-166">If enabled on a queue or subscription, deleting messages from hello store will be batched.</span></span> <span data-ttu-id="db81d-167">Si l’accès au magasin par lot est activée pour une entité, Service Bus retarde une opération d’écriture de magasin concernant cette entité par des too20ms.</span><span class="sxs-lookup"><span data-stu-id="db81d-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up too20ms.</span></span> <span data-ttu-id="db81d-168">Les opérations de magasin supplémentaires qui se produisent pendant cet intervalle sont ajoutées toohello lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-168">Additional store operations that occur during this interval are added toohello batch.</span></span> <span data-ttu-id="db81d-169">L’accès au dispositif de stockage par lot affecte seulement les opérations **d’envoi** et **complètes** ; les opérations de réception ne sont pas affectées.</span><span class="sxs-lookup"><span data-stu-id="db81d-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="db81d-170">L’accès au dispositif de stockage est une propriété d’entité.</span><span class="sxs-lookup"><span data-stu-id="db81d-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="db81d-171">Le traitement par lot se produit sur toutes les entités qui permettent l’accès au stockage par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="db81d-172">Lorsque vous créez une file d’attente, une rubrique ou un abonnement, l’accès au stockage par lot est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="db81d-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="db81d-173">toodisable traités par lot d’accès au magasin, jeu hello [EnableBatchedOperations] [ EnableBatchedOperations] propriété trop**false** avant de créer l’entité de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-173">toodisable batched store access, set hello [EnableBatchedOperations][EnableBatchedOperations] property too**false** before creating hello entity.</span></span> <span data-ttu-id="db81d-174">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="db81d-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="db81d-175">Accès au magasin par lot n’affecte pas le nombre de hello d’opérations de messagerie facturables et est une propriété d’une file d’attente, rubrique ou abonnement.</span><span class="sxs-lookup"><span data-stu-id="db81d-175">Batched store access does not affect hello number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="db81d-176">Elle est indépendante de hello mode et hello le protocole utilisé entre un client et un hello service Bus de Service de réception.</span><span class="sxs-lookup"><span data-stu-id="db81d-176">It is independent of hello receive mode and hello protocol that is used between a client and hello Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="db81d-177">Lecture anticipée</span><span class="sxs-lookup"><span data-stu-id="db81d-177">Prefetching</span></span>
<span data-ttu-id="db81d-178">Lecture anticipée permet hello file d’attente ou abonnement client tooload supplémentaire des messages à partir du service de hello lorsqu’elle effectue une opération de réception.</span><span class="sxs-lookup"><span data-stu-id="db81d-178">Prefetching enables hello queue or subscription client tooload additional messages from hello service when it performs a receive operation.</span></span> <span data-ttu-id="db81d-179">client de Hello stocke ces messages dans un cache local.</span><span class="sxs-lookup"><span data-stu-id="db81d-179">hello client stores these messages in a local cache.</span></span> <span data-ttu-id="db81d-180">taille de Hello du cache de hello est déterminée par hello [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] ou [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] Propriétés.</span><span class="sxs-lookup"><span data-stu-id="db81d-180">hello size of hello cache is determined by hello [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="db81d-181">Chaque client qui permet la lecture anticipée gère son propre cache.</span><span class="sxs-lookup"><span data-stu-id="db81d-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="db81d-182">Un cache n’est pas partagé par plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="db81d-182">A cache is not shared across clients.</span></span> <span data-ttu-id="db81d-183">Si le client de hello initie une opération de réception et son cache est vide, le service de hello transmet un lot de messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-183">If hello client initiates a receive operation and its cache is empty, hello service transmits a batch of messages.</span></span> <span data-ttu-id="db81d-184">taille de Hello du lot de hello est égale à la taille de hello du cache de hello ou 256 Ko, plus faible l’emportant.</span><span class="sxs-lookup"><span data-stu-id="db81d-184">hello size of hello batch equals hello size of hello cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="db81d-185">Si le client de hello initie une opération de réception et hello cache contient un message, message de type hello est extraite du cache de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-185">If hello client initiates a receive operation and hello cache contains a message, hello message is taken from hello cache.</span></span>

<span data-ttu-id="db81d-186">Lorsqu’un message est prérécupéré, message de salutation de verrous service hello prérécupérées.</span><span class="sxs-lookup"><span data-stu-id="db81d-186">When a message is prefetched, hello service locks hello prefetched message.</span></span> <span data-ttu-id="db81d-187">Ce faisant, message de type hello prérécupérées ne peut pas être reçu par un autre récepteur.</span><span class="sxs-lookup"><span data-stu-id="db81d-187">By doing this, hello prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="db81d-188">Si le récepteur de hello ne peut pas effectuer de message de type hello avant expiration du verrouillage hello, message de salutation devient disponible tooother récepteurs.</span><span class="sxs-lookup"><span data-stu-id="db81d-188">If hello receiver cannot complete hello message before hello lock expires, hello message becomes available tooother receivers.</span></span> <span data-ttu-id="db81d-189">copie de Hello prérécupéré du message de type hello reste dans le cache de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-189">hello prefetched copy of hello message remains in hello cache.</span></span> <span data-ttu-id="db81d-190">Hello récepteur qui consomme hello expiré mis en cache copie reçoit une exception lorsqu’il tente de toocomplete ce message.</span><span class="sxs-lookup"><span data-stu-id="db81d-190">hello receiver that consumes hello expired cached copy will receive an exception when it tries toocomplete that message.</span></span> <span data-ttu-id="db81d-191">Par défaut, le verrouillage du message hello expire au bout de 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="db81d-191">By default, hello message lock expires after 60 seconds.</span></span> <span data-ttu-id="db81d-192">Cette valeur peut être étendue too5 minutes.</span><span class="sxs-lookup"><span data-stu-id="db81d-192">This value can be extended too5 minutes.</span></span> <span data-ttu-id="db81d-193">tooprevent hello la consommation de messages arrivés à expiration, la taille du cache hello doit toujours être inférieure au nombre de hello de messages qui peuvent être utilisés par un client au sein de l’intervalle de délai d’attente de verrou hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-193">tooprevent hello consumption of expired messages, hello cache size should always be smaller than hello number of messages that can be consumed by a client within hello lock time-out interval.</span></span>

<span data-ttu-id="db81d-194">Lors de l’expiration de verrou hello par défaut de 60 secondes, une bonne valeur pour [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] est hello 20 fois maximal vitesses de traitement tous les récepteurs de fabrique de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-194">When using hello default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times hello maximum processing rates of all receivers of hello factory.</span></span> <span data-ttu-id="db81d-195">Par exemple, une fabrique crée 3 récepteurs, et chaque récepteur peut traiter les messages too10 par seconde.</span><span class="sxs-lookup"><span data-stu-id="db81d-195">For example, a factory creates 3 receivers, and each receiver can process up too10 messages per second.</span></span> <span data-ttu-id="db81d-196">nombre de prérécupérations Hello ne doit pas dépasser 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="db81d-196">hello prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="db81d-197">Par défaut, [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] est too0 ensemble, ce qui signifie qu’aucun message supplémentaire n’est récupéré à partir du service de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set too0, which means that no additional messages are fetched from hello service.</span></span>

<span data-ttu-id="db81d-198">La prérécupération des messages augmente hello débit global d’une file d’attente ou un abonnement, car il réduit le nombre total d’opérations de message, ou que les boucles de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-198">Prefetching messages increases hello overall throughput for a queue or subscription because it reduces hello overall number of message operations, or round trips.</span></span> <span data-ttu-id="db81d-199">L’extraction du premier message de type hello, toutefois, prendra plus de temps (en raison de taille de message toohello augmenté).</span><span class="sxs-lookup"><span data-stu-id="db81d-199">Fetching hello first message, however, will take longer (due toohello increased message size).</span></span> <span data-ttu-id="db81d-200">Réception de messages prérécupérées seront plus rapide, car ces messages ont déjà été téléchargés par le client de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-200">Receiving prefetched messages will be faster because these messages have already been downloaded by hello client.</span></span>

<span data-ttu-id="db81d-201">Hello time-to-live (TTL) propriété d’un message est vérifiée par le serveur de hello au moment de hello server de hello envoie client toohello de message hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-201">hello time-to-live (TTL) property of a message is checked by hello server at hello time hello server sends hello message toohello client.</span></span> <span data-ttu-id="db81d-202">client de Hello ne vérifie pas la propriété de durée de vie du message de type hello lors de la réception du message de type hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-202">hello client does not check hello message’s TTL property when hello message is received.</span></span> <span data-ttu-id="db81d-203">Au lieu de cela, le message de type hello peut être reçu même si hello sa durée de vie est dépassée, pendant que le message de salutation a été mis en cache par le client de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-203">Instead, hello message can be received even if hello message’s TTL has passed while hello message was cached by hello client.</span></span>

<span data-ttu-id="db81d-204">La prérécupération n’affecte pas le nombre de hello d’opérations de messagerie facturables et est disponible uniquement pour hello protocole client de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-204">Prefetching does not affect hello number of billable messaging operations, and is available only for hello Service Bus client protocol.</span></span> <span data-ttu-id="db81d-205">Hello protocole HTTP ne prend pas en charge la lecture anticipée.</span><span class="sxs-lookup"><span data-stu-id="db81d-205">hello HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="db81d-206">La lecture anticipée est disponible pour les opérations de réception synchrones et asynchrones.</span><span class="sxs-lookup"><span data-stu-id="db81d-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="db81d-207">Files d’attente et les rubriques rapides</span><span class="sxs-lookup"><span data-stu-id="db81d-207">Express queues and topics</span></span>

<span data-ttu-id="db81d-208">Entités Express activer un débit élevé et des scénarios de latence réduite et sont pris en charge uniquement dans la couche de messagerie Standard hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in hello Standard messaging tier.</span></span> <span data-ttu-id="db81d-209">Entités créées dans [espaces de noms Premium](service-bus-premium-messaging.md) ne prennent pas en charge l’option express de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support hello express option.</span></span> <span data-ttu-id="db81d-210">Avec des entités rapides, si un message est envoyé à la file d’attente de tooa ou une rubrique, message de type hello n'est pas immédiatement stocké dans la banque de messages hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-210">With express entities, if a message is sent tooa queue or topic, hello message is not immediately stored in hello messaging store.</span></span> <span data-ttu-id="db81d-211">Au lieu de cela, le message est mis en cache.</span><span class="sxs-lookup"><span data-stu-id="db81d-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="db81d-212">Si un message reste dans la file d’attente hello plus de quelques secondes, il est automatiquement écrit toostable stockage, afin de le protéger contre la perte d’échéance tooan panne.</span><span class="sxs-lookup"><span data-stu-id="db81d-212">If a message remains in hello queue for more than a few seconds, it is automatically written toostable storage, thus protecting it against loss due tooan outage.</span></span> <span data-ttu-id="db81d-213">L’écriture de message de type hello dans une mémoire cache augmente le débit et réduit la latence, car il n’existe aucun toostable accès stockage au message de type hello temps hello est envoyé.</span><span class="sxs-lookup"><span data-stu-id="db81d-213">Writing hello message into a memory cache increases throughput and reduces latency because there is no access toostable storage at hello time hello message is sent.</span></span> <span data-ttu-id="db81d-214">Les messages consommés en quelques secondes ne sont pas écrites toohello banque d’informations.</span><span class="sxs-lookup"><span data-stu-id="db81d-214">Messages that are consumed within a few seconds are not written toohello messaging store.</span></span> <span data-ttu-id="db81d-215">Bonjour à l’exemple suivant crée une rubrique expresse.</span><span class="sxs-lookup"><span data-stu-id="db81d-215">hello following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="db81d-216">Si un message contenant des informations sensibles qui ne doivent pas être égarées est envoyé tooan des entités express, l’expéditeur de hello peut forcer le Service Bus tooimmediately conserver stockage toostable des messages hello en définissant un hello [ForcePersistence] [ ForcePersistence] propriété trop**true**.</span><span class="sxs-lookup"><span data-stu-id="db81d-216">If a message containing critical information that must not be lost is sent tooan express entity, hello sender can force Service Bus tooimmediately persist hello message toostable storage by setting hello [ForcePersistence][ForcePersistence] property too**true**.</span></span>

> [!NOTE]
> <span data-ttu-id="db81d-217">Les entités rapides ne prennent pas en charge les transactions.</span><span class="sxs-lookup"><span data-stu-id="db81d-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="db81d-218">Utilisation de files d’attente partitionnées ou de rubriques</span><span class="sxs-lookup"><span data-stu-id="db81d-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="db81d-219">En interne, Service Bus utilise hello même nœud et tooprocess de la banque de messagerie et stocker tous les messages pour une entité de messagerie (file d’attente ou rubrique).</span><span class="sxs-lookup"><span data-stu-id="db81d-219">Internally, Service Bus uses hello same node and messaging store tooprocess and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="db81d-220">Une file d’attente partitionnée ou une rubrique, sur hello autre part, est distribué sur plusieurs nœuds et banques de messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-220">A partitioned queue or topic, on hello other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="db81d-221">Les rubriques et files d’attente partitionnées donnent non seulement un débit plus élevé que les rubriques et files d’attente standard, mais ils présentent également une disponibilité supérieure.</span><span class="sxs-lookup"><span data-stu-id="db81d-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="db81d-222">toocreate une entité partitionnée, jeu hello [EnablePartitioning] [ EnablePartitioning] propriété trop**true**, comme indiqué dans hello l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="db81d-222">toocreate a partitioned entity, set hello [EnablePartitioning][EnablePartitioning] property too**true**, as shown in hello following example.</span></span> <span data-ttu-id="db81d-223">Pour plus d’informations sur les entités partitionnées, consultez [Files d’attente et rubriques partitionnées][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="db81d-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="db81d-224">Utilisation de plusieurs files d’attente</span><span class="sxs-lookup"><span data-stu-id="db81d-224">Use of multiple queues</span></span>

<span data-ttu-id="db81d-225">Si elle n’est pas possible de toouse qu'une file d’attente partitionnée ou une rubrique ou un hello attendu de charge ne peut pas être gérée par une seule file d’attente partitionnée ou une rubrique, vous devez utiliser plusieurs entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="db81d-225">If it is not possible toouse a partitioned queue or topic, or hello expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="db81d-226">Lorsque vous utilisez plusieurs entités, créez un client dédié pour chaque entité, au lieu d’utiliser hello même client pour toutes les entités.</span><span class="sxs-lookup"><span data-stu-id="db81d-226">When using multiple entities, create a dedicated client for each entity, instead of using hello same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="db81d-227">Fonctionnalités de développement et de test</span><span class="sxs-lookup"><span data-stu-id="db81d-227">Development and testing features</span></span>

<span data-ttu-id="db81d-228">Service Bus possède une fonctionnalité qui est utilisée spécifiquement pour le développement, qui **ne doit jamais être utilisée dans les configurations de production** : [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="db81d-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="db81d-229">Lorsque de nouvelles règles ou des filtres sont ajoutés toohello rubrique, vous pouvez utiliser [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify qui hello nouvelle expression de filtre fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="db81d-229">When new rules or filters are added toohello topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] tooverify that hello new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="db81d-230">Scénarios</span><span class="sxs-lookup"><span data-stu-id="db81d-230">Scenarios</span></span>
<span data-ttu-id="db81d-231">Bonjour les sections suivantes décrivent des scénarios de messagerie classiques et montrer les paramètres de Service Bus hello préféré.</span><span class="sxs-lookup"><span data-stu-id="db81d-231">hello following sections describe typical messaging scenarios and outline hello preferred Service Bus settings.</span></span> <span data-ttu-id="db81d-232">Les débits sont classés dans la catégorie Petit (moins d’1 message/seconde), Modéré (1 message/s ou plus, mais moins de 100 messages par seconde) et Élevé (100 messages/seconde ou plus).</span><span class="sxs-lookup"><span data-stu-id="db81d-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="db81d-233">Hello nombre de clients est classé en tant que petite modéré (5 ou moins), (plus de 5, mais inférieur à ou égal too20) et de grande taille (plus de 20).</span><span class="sxs-lookup"><span data-stu-id="db81d-233">hello number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal too20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="db81d-234">File d’attente à débit élevé</span><span class="sxs-lookup"><span data-stu-id="db81d-234">High-throughput queue</span></span>
<span data-ttu-id="db81d-235">Objectif : Maximiser le débit de hello d’une file d’attente unique.</span><span class="sxs-lookup"><span data-stu-id="db81d-235">Goal: Maximize hello throughput of a single queue.</span></span> <span data-ttu-id="db81d-236">nombre de Hello d’expéditeurs et de récepteurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-236">hello number of senders and receivers is small.</span></span>

* <span data-ttu-id="db81d-237">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="db81d-238">hello tooincrease globale taux d’envoi dans la file d’attente hello, utilisez plusieurs expéditeurs de toocreate de fabriques de messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-238">tooincrease hello overall send rate into hello queue, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="db81d-239">Pour chaque expéditeur, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="db81d-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="db81d-240">hello tooincrease globale taux de réception à partir de la file d’attente hello, utilisez plusieurs destinataires toocreate fabriques.</span><span class="sxs-lookup"><span data-stu-id="db81d-240">tooincrease hello overall receive rate from hello queue, use multiple message factories toocreate receivers.</span></span>
* <span data-ttu-id="db81d-241">Utilisez parti de tootake d’opérations asynchrones de traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="db81d-241">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="db81d-242">Définissez hello too50ms tooreduce hello fréquence de transmissions de protocoles clients Service Bus de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-242">Set hello batching interval too50ms tooreduce hello number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="db81d-243">Si plusieurs expéditeurs sont utilisés, augmentez hello too100ms d’intervalle de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-243">If multiple senders are used, increase hello batching interval too100ms.</span></span>
* <span data-ttu-id="db81d-244">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-244">Leave batched store access enabled.</span></span> <span data-ttu-id="db81d-245">Cela augmente hello globale vitesse à laquelle les messages peuvent être écrits dans la file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-245">This increases hello overall rate at which messages can be written into hello queue.</span></span>
* <span data-ttu-id="db81d-246">Définir des vitesses de traitement maximales hello de tous les destinataires d’une fabrique de décompte too20 fois hello prérécupération.</span><span class="sxs-lookup"><span data-stu-id="db81d-246">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="db81d-247">Cela réduit le nombre de hello de transmissions de protocoles clients Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-247">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="db81d-248">Plusieurs files d’attente haut débit</span><span class="sxs-lookup"><span data-stu-id="db81d-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="db81d-249">Objectif : Optimiser le débit global de plusieurs files d’attente.</span><span class="sxs-lookup"><span data-stu-id="db81d-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="db81d-250">débit Hello d’une file d’attente individuelle est modéré ou élevé.</span><span class="sxs-lookup"><span data-stu-id="db81d-250">hello throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="db81d-251">tooobtain débit maximal sur plusieurs files d’attente, utiliser les paramètres hello décrites débit de hello toomaximize d’une file d’attente unique.</span><span class="sxs-lookup"><span data-stu-id="db81d-251">tooobtain maximum throughput across multiple queues, use hello settings outlined toomaximize hello throughput of a single queue.</span></span> <span data-ttu-id="db81d-252">En outre, utilisez les clients toocreate différentes fabriques qui envoient ou reçoivent à partir de différentes files d’attente.</span><span class="sxs-lookup"><span data-stu-id="db81d-252">In addition, use different factories toocreate clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="db81d-253">File d’attente à latence faible</span><span class="sxs-lookup"><span data-stu-id="db81d-253">Low latency queue</span></span>
<span data-ttu-id="db81d-254">Objectif : réduire la latence de bout en bout d’une file d’attente ou d’une rubrique.</span><span class="sxs-lookup"><span data-stu-id="db81d-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="db81d-255">nombre de Hello d’expéditeurs et de récepteurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-255">hello number of senders and receivers is small.</span></span> <span data-ttu-id="db81d-256">débit Hello de file d’attente hello est faible ou modérée.</span><span class="sxs-lookup"><span data-stu-id="db81d-256">hello throughput of hello queue is small or moderate.</span></span>

* <span data-ttu-id="db81d-257">Utiliser une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="db81d-258">Désactiver le traitement par lots côté client.</span><span class="sxs-lookup"><span data-stu-id="db81d-258">Disable client-side batching.</span></span> <span data-ttu-id="db81d-259">client de Hello envoie immédiatement un message.</span><span class="sxs-lookup"><span data-stu-id="db81d-259">hello client immediately sends a message.</span></span>
* <span data-ttu-id="db81d-260">Désactiver l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-260">Disable batched store access.</span></span> <span data-ttu-id="db81d-261">service de Hello écrit immédiatement banque toohello hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-261">hello service immediately writes hello message toohello store.</span></span>
* <span data-ttu-id="db81d-262">Si vous utilisez un seul client, définissez hello prérécupération nombre too20 fois hello vitesse de traitement du récepteur de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-262">If using a single client, set hello prefetch count too20 times hello processing rate of hello receiver.</span></span> <span data-ttu-id="db81d-263">Si plusieurs messages arrivent à la file d’attente de hello hello même moment, hello protocole client de Service Bus les transmet tous à hello même temps.</span><span class="sxs-lookup"><span data-stu-id="db81d-263">If multiple messages arrive at hello queue at hello same time, hello Service Bus client protocol transmits them all at hello same time.</span></span> <span data-ttu-id="db81d-264">Lorsque les clients hello reçoit un message de suivant de hello, ce message est déjà dans le cache local hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-264">When hello client receives hello next message, that message is already in hello local cache.</span></span> <span data-ttu-id="db81d-265">cache de Hello doit être faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-265">hello cache should be small.</span></span>
* <span data-ttu-id="db81d-266">Si vous utilisez plusieurs clients, définir hello prérécupération nombre too0.</span><span class="sxs-lookup"><span data-stu-id="db81d-266">If using multiple clients, set hello prefetch count too0.</span></span> <span data-ttu-id="db81d-267">Ce faisant, deuxième client de hello peut hello deuxième message alors que le premier client de hello traite toujours premier message de type hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-267">By doing this, hello second client can receive hello second message while hello first client is still processing hello first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="db81d-268">File d’attente comportant un grand nombre d’expéditeurs</span><span class="sxs-lookup"><span data-stu-id="db81d-268">Queue with a large number of senders</span></span>
<span data-ttu-id="db81d-269">Objectif : maximiser le débit d’une file d’attente ou d’une rubrique comportant un grand nombre d’expéditeurs.</span><span class="sxs-lookup"><span data-stu-id="db81d-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="db81d-270">Chaque expéditeur envoie des messages à une vitesse modérée.</span><span class="sxs-lookup"><span data-stu-id="db81d-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="db81d-271">nombre de Hello de récepteurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-271">hello number of receivers is small.</span></span>

<span data-ttu-id="db81d-272">Service Bus permet des tooa de connexions simultanées too1000 entité de messagerie (ou 5 000 en utilisant AMQP).</span><span class="sxs-lookup"><span data-stu-id="db81d-272">Service Bus enables up too1000 concurrent connections tooa messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="db81d-273">Cette limite est appliquée au niveau d’espace de noms hello et rubriques/files d’attente/abonnements sont restreintes par limite de hello de connexions simultanées par espace de noms.</span><span class="sxs-lookup"><span data-stu-id="db81d-273">This limit is enforced at hello namespace level, and queues/topics/subscriptions are capped by hello limit of concurrent connections per namespace.</span></span> <span data-ttu-id="db81d-274">Pour les files d’attente, ce nombre est partagé entre les expéditeurs et les destinataires.</span><span class="sxs-lookup"><span data-stu-id="db81d-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="db81d-275">Si toutes les connexions de 1000 sont requises pour les expéditeurs, vous devez remplacer la file d’attente hello avec une rubrique et un seul abonnement.</span><span class="sxs-lookup"><span data-stu-id="db81d-275">If all 1000 connections are required for senders, you should replace hello queue with a topic and a single subscription.</span></span> <span data-ttu-id="db81d-276">Une rubrique accepte des connexions simultanées de too1000 des expéditeurs, alors que les abonnements hello accepte un 1000 simultanées des connexions supplémentaires à partir de récepteurs.</span><span class="sxs-lookup"><span data-stu-id="db81d-276">A topic accepts up too1000 concurrent connections from senders, whereas hello subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="db81d-277">Si plus de 1000 expéditeurs simultanés sont requis, les expéditeurs hello doivent envoyer des messages toohello protocole de Service Bus via HTTP.</span><span class="sxs-lookup"><span data-stu-id="db81d-277">If more than 1000 concurrent senders are required, hello senders should send messages toohello Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="db81d-278">débit de toomaximize, hello suivant :</span><span class="sxs-lookup"><span data-stu-id="db81d-278">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="db81d-279">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="db81d-280">Si chaque expéditeur réside dans un processus différent, utilisez uniquement une structure par processus.</span><span class="sxs-lookup"><span data-stu-id="db81d-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="db81d-281">Utilisez parti de tootake d’opérations asynchrones de traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="db81d-281">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="db81d-282">Utiliser par défaut de hello intervalle nombre 20 ms tooreduce hello de transmissions de protocoles clients Service Bus de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-282">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="db81d-283">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-283">Leave batched store access enabled.</span></span> <span data-ttu-id="db81d-284">Cela augmente hello globale vitesse à laquelle les messages peuvent être écrits dans la file d’attente hello ou une rubrique.</span><span class="sxs-lookup"><span data-stu-id="db81d-284">This increases hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="db81d-285">Définir des vitesses de traitement maximales hello de tous les destinataires d’une fabrique de décompte too20 fois hello prérécupération.</span><span class="sxs-lookup"><span data-stu-id="db81d-285">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="db81d-286">Cela réduit le nombre de hello de transmissions de protocoles clients Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-286">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="db81d-287">File d’attente comportant un grand nombre de destinataires</span><span class="sxs-lookup"><span data-stu-id="db81d-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="db81d-288">Objectif : Optimiser hello taux d’une file d’attente ou d’abonnement avec un grand nombre de récepteurs de réception.</span><span class="sxs-lookup"><span data-stu-id="db81d-288">Goal: Maximize hello receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="db81d-289">Chaque destinataire reçoit les messages à une vitesse modérée.</span><span class="sxs-lookup"><span data-stu-id="db81d-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="db81d-290">nombre de Hello d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-290">hello number of senders is small.</span></span>

<span data-ttu-id="db81d-291">Service Bus permet des entités de tooan too1000 connexions simultanées.</span><span class="sxs-lookup"><span data-stu-id="db81d-291">Service Bus enables up too1000 concurrent connections tooan entity.</span></span> <span data-ttu-id="db81d-292">Si une file d’attente nécessite plus de 1000 récepteurs, vous devez remplacer la file d’attente hello avec une rubrique et plusieurs abonnements.</span><span class="sxs-lookup"><span data-stu-id="db81d-292">If a queue requires more than 1000 receivers, you should replace hello queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="db81d-293">Chaque abonnement peut prendre en charge les connexions simultanées de too1000.</span><span class="sxs-lookup"><span data-stu-id="db81d-293">Each subscription can support up too1000 concurrent connections.</span></span> <span data-ttu-id="db81d-294">Récepteurs peuvent également accéder à la file d’attente de hello via hello le protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="db81d-294">Alternatively, receivers can access hello queue via hello HTTP protocol.</span></span>

<span data-ttu-id="db81d-295">débit de toomaximize, hello suivant :</span><span class="sxs-lookup"><span data-stu-id="db81d-295">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="db81d-296">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="db81d-297">Si chaque destinataire réside dans un processus différent, utilisez uniquement une structure par processus.</span><span class="sxs-lookup"><span data-stu-id="db81d-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="db81d-298">Les récepteurs peuvent utiliser des opérations synchronisées ou asynchrones.</span><span class="sxs-lookup"><span data-stu-id="db81d-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="db81d-299">Donné hello modéré des taux d’un récepteur individuel de réception, traitement côté client d’une demande complète n’affecte pas le débit du récepteur.</span><span class="sxs-lookup"><span data-stu-id="db81d-299">Given hello moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="db81d-300">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-300">Leave batched store access enabled.</span></span> <span data-ttu-id="db81d-301">Cela réduit hello charge globale de l’entité de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-301">This reduces hello overall load of hello entity.</span></span> <span data-ttu-id="db81d-302">Cela réduit également hello taux global auquel les messages peuvent être écrits dans la file d’attente hello ou une rubrique.</span><span class="sxs-lookup"><span data-stu-id="db81d-302">It also reduces hello overall rate at which messages can be written into hello queue or topic.</span></span>
* <span data-ttu-id="db81d-303">La valeur hello prérécupération nombre tooa petit (par exemple, PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="db81d-303">Set hello prefetch count tooa small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="db81d-304">Cela empêche les destinataires de rester oisifs pendant que les autres destinataires mettent en cache un grand nombre de messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="db81d-305">Rubrique comportant un petit nombre d’abonnements</span><span class="sxs-lookup"><span data-stu-id="db81d-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="db81d-306">Objectif : Maximiser le débit de hello d’une rubrique comportant un petit nombre d’abonnements.</span><span class="sxs-lookup"><span data-stu-id="db81d-306">Goal: Maximize hello throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="db81d-307">Un message est reçu par un grand nombre d’abonnements, ce qui signifie que hello combinée de réception vitesse sur tous les abonnements est supérieure à la vitesse de transmission hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-307">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is larger than hello send rate.</span></span> <span data-ttu-id="db81d-308">nombre de Hello d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-308">hello number of senders is small.</span></span> <span data-ttu-id="db81d-309">nombre de Hello de récepteurs par abonnement est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-309">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="db81d-310">débit de toomaximize, hello suivant :</span><span class="sxs-lookup"><span data-stu-id="db81d-310">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="db81d-311">Utilisez une rubrique partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="db81d-312">hello tooincrease globale taux d’envoi dans la rubrique de hello, utilisez plusieurs expéditeurs de toocreate de fabriques de messages.</span><span class="sxs-lookup"><span data-stu-id="db81d-312">tooincrease hello overall send rate into hello topic, use multiple message factories toocreate senders.</span></span> <span data-ttu-id="db81d-313">Pour chaque expéditeur, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="db81d-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="db81d-314">hello tooincrease globale taux de réception d’un abonnement, utilisez plusieurs destinataires toocreate fabriques.</span><span class="sxs-lookup"><span data-stu-id="db81d-314">tooincrease hello overall receive rate from a subscription, use multiple message factories toocreate receivers.</span></span> <span data-ttu-id="db81d-315">Pour chaque destinataire, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="db81d-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="db81d-316">Utilisez parti de tootake d’opérations asynchrones de traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="db81d-316">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="db81d-317">Utiliser par défaut de hello intervalle nombre 20 ms tooreduce hello de transmissions de protocoles clients Service Bus de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-317">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="db81d-318">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-318">Leave batched store access enabled.</span></span> <span data-ttu-id="db81d-319">Cela augmente hello globale vitesse à laquelle les messages peuvent être écrits dans la rubrique de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-319">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="db81d-320">Définir des vitesses de traitement maximales hello de tous les destinataires d’une fabrique de décompte too20 fois hello prérécupération.</span><span class="sxs-lookup"><span data-stu-id="db81d-320">Set hello prefetch count too20 times hello maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="db81d-321">Cela réduit le nombre de hello de transmissions de protocoles clients Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-321">This reduces hello number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="db81d-322">Rubrique comportant un grand nombre d’abonnements</span><span class="sxs-lookup"><span data-stu-id="db81d-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="db81d-323">Objectif : Maximiser le débit de hello d’une rubrique comportant un grand nombre d’abonnements.</span><span class="sxs-lookup"><span data-stu-id="db81d-323">Goal: Maximize hello throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="db81d-324">Un message est reçu par un grand nombre d’abonnements, ce qui signifie que hello combinée de réception taux sur tous les abonnements est largement supérieur au taux d’envoi hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-324">A message is received by many subscriptions, which means hello combined receive rate over all subscriptions is much larger than hello send rate.</span></span> <span data-ttu-id="db81d-325">nombre de Hello d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-325">hello number of senders is small.</span></span> <span data-ttu-id="db81d-326">nombre de Hello de récepteurs par abonnement est faible.</span><span class="sxs-lookup"><span data-stu-id="db81d-326">hello number of receivers per subscription is small.</span></span>

<span data-ttu-id="db81d-327">Rubriques de procédures avec un grand nombre d’abonnements exposent généralement un faible débit global si tous les messages sont routés tooall abonnements.</span><span class="sxs-lookup"><span data-stu-id="db81d-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed tooall subscriptions.</span></span> <span data-ttu-id="db81d-328">Cela est dû au fait hello que chaque message est reçu plusieurs fois et tous les messages qui sont contenus dans une rubrique et tous ses abonnements sont stockés dans hello même stocker.</span><span class="sxs-lookup"><span data-stu-id="db81d-328">This is caused by hello fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in hello same store.</span></span> <span data-ttu-id="db81d-329">Il est supposé que le nombre de hello d’expéditeurs et de nombre de récepteurs par abonnement sont petites.</span><span class="sxs-lookup"><span data-stu-id="db81d-329">It is assumed that hello number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="db81d-330">Service Bus prend en charge jusqu'à too2, 000 abonnements par rubrique.</span><span class="sxs-lookup"><span data-stu-id="db81d-330">Service Bus supports up too2,000 subscriptions per topic.</span></span>

<span data-ttu-id="db81d-331">débit de toomaximize, hello suivant :</span><span class="sxs-lookup"><span data-stu-id="db81d-331">toomaximize throughput, do hello following:</span></span>

* <span data-ttu-id="db81d-332">Utilisez une rubrique partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="db81d-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="db81d-333">Utilisez parti de tootake d’opérations asynchrones de traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="db81d-333">Use asynchronous operations tootake advantage of client-side batching.</span></span>
* <span data-ttu-id="db81d-334">Utiliser par défaut de hello intervalle nombre 20 ms tooreduce hello de transmissions de protocoles clients Service Bus de traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-334">Use hello default batching interval of 20ms tooreduce hello number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="db81d-335">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="db81d-335">Leave batched store access enabled.</span></span> <span data-ttu-id="db81d-336">Cela augmente hello globale vitesse à laquelle les messages peuvent être écrits dans la rubrique de hello.</span><span class="sxs-lookup"><span data-stu-id="db81d-336">This increases hello overall rate at which messages can be written into hello topic.</span></span>
* <span data-ttu-id="db81d-337">Définir des temps de too20 du nombre de prérécupération hello hello attendu de réception taux en secondes.</span><span class="sxs-lookup"><span data-stu-id="db81d-337">Set hello prefetch count too20 times hello expected receive rate in seconds.</span></span> <span data-ttu-id="db81d-338">Cela réduit le nombre de hello de transmissions de protocoles clients Service Bus.</span><span class="sxs-lookup"><span data-stu-id="db81d-338">This reduces hello number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="db81d-339">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="db81d-339">Next steps</span></span>
<span data-ttu-id="db81d-340">toolearn savoir plus sur l’optimisation des performances du Service Bus, consultez [partitionnée des entités de messagerie][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="db81d-340">toolearn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing
