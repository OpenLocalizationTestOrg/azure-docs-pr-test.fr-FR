---
title: "Meilleures pratiques pour améliorer les performances à l’aide d’Azure Service Bus | Microsoft Docs"
description: "Explique comment utiliser Service Bus pour optimiser les performances lors de l’échange de messages répartis."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: e6a0e480f7748f12f5e566cf4059b5b2c4242c09
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="f7848-103">Meilleures pratiques relatives aux améliorations de performances à l’aide de la messagerie Service Bus</span><span class="sxs-lookup"><span data-stu-id="f7848-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="f7848-104">Cet article décrit comment utiliser la [messagerie Azure Service Bus](https://azure.microsoft.com/services/service-bus/) pour optimiser les performances lors de l’échange de messages répartis.</span><span class="sxs-lookup"><span data-stu-id="f7848-104">This article describes how to use [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) to optimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="f7848-105">La première partie de cette rubrique décrit les différents mécanismes qui sont proposés et qui permettent d’améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="f7848-105">The first part of this topic describes the different mechanisms that are offered to help increase performance.</span></span> <span data-ttu-id="f7848-106">La deuxième partie fournit des conseils sur l’utilisation de Service Bus des services visant à offrir des performances optimales dans un scénario donné.</span><span class="sxs-lookup"><span data-stu-id="f7848-106">The second part provides guidance on how to use Service Bus in a way that can offer the best performance in a given scenario.</span></span>

<span data-ttu-id="f7848-107">Dans cette rubrique, le terme « client » fait référence à une entité qui accède à Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-107">Throughout this topic, the term "client" refers to any entity that accesses Service Bus.</span></span> <span data-ttu-id="f7848-108">Un client peut jouer le rôle d’un expéditeur ou d’un destinataire.</span><span class="sxs-lookup"><span data-stu-id="f7848-108">A client can take the role of a sender or a receiver.</span></span> <span data-ttu-id="f7848-109">Le terme « expéditeur » est utilisé pour un client de file d’attente ou de rubrique Service Bus qui envoie des messages à une file d’attente ou une rubrique Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-109">The term "sender" is used for a Service Bus queue or topic client that sends messages to a Service Bus queue or topic.</span></span> <span data-ttu-id="f7848-110">Le terme « destinataire » fait référence à un client de file d’attente ou d’abonnement de Bus de Service qui reçoit des messages de la part d’une file d’attente ou d’un abonnement Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-110">The term "receiver" refers to a Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="f7848-111">Les sections suivantes présentent plusieurs concepts Service Bus utiles pour améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="f7848-111">These sections introduce several concepts that Service Bus uses to help boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="f7848-112">Protocoles</span><span class="sxs-lookup"><span data-stu-id="f7848-112">Protocols</span></span>
<span data-ttu-id="f7848-113">Service Bus permet aux clients d’envoyer et de recevoir des messages par le biais de l’un des trois protocoles suivants :</span><span class="sxs-lookup"><span data-stu-id="f7848-113">Service Bus enables clients to send and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="f7848-114">Advanced Message Queuing Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="f7848-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="f7848-115">Service Bus Messaging Protocol (SBMP)</span><span class="sxs-lookup"><span data-stu-id="f7848-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="f7848-116">http</span><span class="sxs-lookup"><span data-stu-id="f7848-116">HTTP</span></span>

<span data-ttu-id="f7848-117">AMQP et SBMP sont plus efficaces, car ils maintiennent la connexion au Service Bus tant que la fabrique de messagerie existe.</span><span class="sxs-lookup"><span data-stu-id="f7848-117">AMQP and SBMP are more efficient, because they maintain the connection to Service Bus as long as the messaging factory exists.</span></span> <span data-ttu-id="f7848-118">Il permet également le traitement par lot et la lecture anticipée.</span><span class="sxs-lookup"><span data-stu-id="f7848-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="f7848-119">Sauf mention explicite, tout le contenu de cette rubrique suppose l’utilisation du protocole AMQP ou SBMP.</span><span class="sxs-lookup"><span data-stu-id="f7848-119">Unless explicitly mentioned, all content in this topic assumes the use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="f7848-120">Réutilisation de structures et de clients</span><span class="sxs-lookup"><span data-stu-id="f7848-120">Reusing factories and clients</span></span>
<span data-ttu-id="f7848-121">Des objets client Service Bus, tels que [QueueClient][QueueClient] ou [MessageSender][MessageSender], sont créés via un objet [MessagingFactory][MessagingFactory], qui assure également la gestion interne des connexions.</span><span class="sxs-lookup"><span data-stu-id="f7848-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="f7848-122">Vous ne devez pas fermer les structures de messagerie ou les files d’attente, les rubriques et les clients d’abonnement après avoir envoyé un message, et les recréer lorsque vous envoyez le message suivant.</span><span class="sxs-lookup"><span data-stu-id="f7848-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send the next message.</span></span> <span data-ttu-id="f7848-123">La fermeture d’une structure de messagerie supprime la connexion à Service Bus et une nouvelle connexion est établie au moment de la recréation de la structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-123">Closing a messaging factory deletes the connection to the Service Bus service, and a new connection is established when recreating the factory.</span></span> <span data-ttu-id="f7848-124">L’établissement d’une connexion est une opération coûteuse, que vous pouvez éviter en réutilisant les objets de structure et client dans plusieurs opérations.</span><span class="sxs-lookup"><span data-stu-id="f7848-124">Establishing a connection is an expensive operation that you can avoid by re-using the same factory and client objects for multiple operations.</span></span> <span data-ttu-id="f7848-125">Vous pouvez utiliser en toute sécurité l’objet [QueueClient][QueueClient] pour envoyer des messages à partir de plusieurs threads et d’opérations asynchrones simultanées.</span><span class="sxs-lookup"><span data-stu-id="f7848-125">You can safely use the [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="f7848-126">Opérations simultanées</span><span class="sxs-lookup"><span data-stu-id="f7848-126">Concurrent operations</span></span>
<span data-ttu-id="f7848-127">L’exécution d’une opération (envoi, réception, suppression, etc.) prend un certain temps.</span><span class="sxs-lookup"><span data-stu-id="f7848-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="f7848-128">Ce temps comprend le traitement de l’opération par le service Service Bus en plus de la latence de la demande et de la réponse.</span><span class="sxs-lookup"><span data-stu-id="f7848-128">This time includes the processing of the operation by the Service Bus service in addition to the latency of the request and the reply.</span></span> <span data-ttu-id="f7848-129">Pour augmenter le nombre d’opérations par période, les opérations doivent s’exécuter simultanément.</span><span class="sxs-lookup"><span data-stu-id="f7848-129">To increase the number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="f7848-130">Pour cela, vous pouvez procéder de plusieurs façons différentes :</span><span class="sxs-lookup"><span data-stu-id="f7848-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="f7848-131">**Opérations asynchrones** : le client planifie les opérations en effectuant des opérations asynchrones.</span><span class="sxs-lookup"><span data-stu-id="f7848-131">**Asynchronous operations**: the client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="f7848-132">La requête suivante démarre avant la fin de la demande précédente.</span><span class="sxs-lookup"><span data-stu-id="f7848-132">The next request is started before the previous request is completed.</span></span> <span data-ttu-id="f7848-133">Voici un exemple d’opération d’envoi asynchrone :</span><span class="sxs-lookup"><span data-stu-id="f7848-133">The following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="f7848-134">Voici un exemple d’opération de réception asynchrone :</span><span class="sxs-lookup"><span data-stu-id="f7848-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="f7848-135">**Plusieurs structures** : tous les clients (expéditeurs et destinataires) qui sont créés par la même structure partagent une connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="f7848-135">**Multiple factories**: all clients (senders in addition to receivers) that are created by the same factory share one TCP connection.</span></span> <span data-ttu-id="f7848-136">Le débit maximal de messages est limité par le nombre d’opérations pouvant emprunter cette connexion TCP.</span><span class="sxs-lookup"><span data-stu-id="f7848-136">The maximum message throughput is limited by the number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="f7848-137">Le débit qui peut être obtenu avec une seule structure varie sensiblement en fonction des durées de parcours aller-retour TCP et de la taille des messages.</span><span class="sxs-lookup"><span data-stu-id="f7848-137">The throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="f7848-138">Pour obtenir des débits plus importants, vous devez utiliser plusieurs structures de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-138">To obtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="f7848-139">Mode de réception</span><span class="sxs-lookup"><span data-stu-id="f7848-139">Receive mode</span></span>
<span data-ttu-id="f7848-140">Lorsque vous créez un client de file d’attente ou d’abonnement, vous pouvez spécifier un mode de réception : *verrouillage* ou *recevoir et supprimer*.</span><span class="sxs-lookup"><span data-stu-id="f7848-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="f7848-141">Le mode par défaut est [Verrouillage][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="f7848-141">The default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="f7848-142">Lorsqu’il fonctionne dans ce mode, le client envoie une demande pour recevoir un message de la part de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-142">When operating in this mode, the client sends a request to receive a message from Service Bus.</span></span> <span data-ttu-id="f7848-143">Une fois que le client a reçu le message, il envoie une demande pour compléter le message.</span><span class="sxs-lookup"><span data-stu-id="f7848-143">After the client has received the message, it sends a request to complete the message.</span></span>

<span data-ttu-id="f7848-144">Lors de la définition du mode de réception [ReceiveAndDelete][ReceiveAndDelete], les deux étapes sont combinées dans une requête unique.</span><span class="sxs-lookup"><span data-stu-id="f7848-144">When setting the receive mode to [ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="f7848-145">Cela réduit le nombre total d’opérations et peut améliorer le débit global des messages.</span><span class="sxs-lookup"><span data-stu-id="f7848-145">This reduces the overall number of operations, and can improve the overall message throughput.</span></span> <span data-ttu-id="f7848-146">Ce gain de performances est fourni au risque de perdre des messages.</span><span class="sxs-lookup"><span data-stu-id="f7848-146">This performance gain comes at the risk of losing messages.</span></span>

<span data-ttu-id="f7848-147">Service Bus ne gère pas les transactions des opérations de réception-suppression.</span><span class="sxs-lookup"><span data-stu-id="f7848-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="f7848-148">En outre, la syntaxe de verrouillage est nécessaire pour tous les scénarios dans lesquels le client souhaite différer ou ignorer un message ([lettre morte](service-bus-dead-letter-queues.md)).</span><span class="sxs-lookup"><span data-stu-id="f7848-148">In addition, peek-lock semantics are required for any scenarios in which the client wants to defer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="f7848-149">Traitement par lots côté client</span><span class="sxs-lookup"><span data-stu-id="f7848-149">Client-side batching</span></span>
<span data-ttu-id="f7848-150">Le traitement par lot côté client permet à un client de file d’attente ou de rubrique de retarder l’envoi d’un message pendant une période donnée.</span><span class="sxs-lookup"><span data-stu-id="f7848-150">Client-side batching enables a queue or topic client to delay the sending of a message for a certain period of time.</span></span> <span data-ttu-id="f7848-151">Si le client envoie des messages supplémentaires pendant cette période, il transmet les messages dans un seul lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-151">If the client sends additional messages during this time period, it transmits the messages in a single batch.</span></span> <span data-ttu-id="f7848-152">Le traitement par lots côté client fait également en sorte qu’une file d’attente ou un abonnement client regroupe plusieurs requêtes **complètes** en une seule requête.</span><span class="sxs-lookup"><span data-stu-id="f7848-152">Client-side batching also causes a queue or subscription client to batch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="f7848-153">Le traitement par lots n’est disponible que pour les opérations **d’envoi** et **complètes** asynchrones.</span><span class="sxs-lookup"><span data-stu-id="f7848-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="f7848-154">Les opérations synchrones sont immédiatement envoyées au service Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-154">Synchronous operations are immediately sent to the Service Bus service.</span></span> <span data-ttu-id="f7848-155">Le traitement par lots ne peut pas concerner des opérations de verrouillage ou de réception, ou plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="f7848-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="f7848-156">Par défaut, un client utilise un intervalle 20 ms entre les lots.</span><span class="sxs-lookup"><span data-stu-id="f7848-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="f7848-157">Vous pouvez modifier l’intervalle de traitement par lots en définissant la propriété [BatchFlushInterval][BatchFlushInterval] avant de créer la structure de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-157">You can change the batch interval by setting the [BatchFlushInterval][BatchFlushInterval] property before creating the messaging factory.</span></span> <span data-ttu-id="f7848-158">Ce paramètre affecte tous les clients créés par cette structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="f7848-159">Pour désactiver le traitement par lot, définissez la propriété [BatchFlushInterval][BatchFlushInterval] sur **TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="f7848-159">To disable batching, set the [BatchFlushInterval][BatchFlushInterval] property to **TimeSpan.Zero**.</span></span> <span data-ttu-id="f7848-160">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f7848-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="f7848-161">Le traitement par lot n’affecte pas le nombre d’opérations de messagerie facturables et est disponible uniquement pour le protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-161">Batching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="f7848-162">Le protocole HTTP ne prend pas en charge le traitement par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-162">The HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="f7848-163">Accès au dispositif de stockage de traitement par lot</span><span class="sxs-lookup"><span data-stu-id="f7848-163">Batching store access</span></span>
<span data-ttu-id="f7848-164">Pour augmenter le débit d’une file d’attente, d’une rubrique ou d’un abonnement, Service Bus regroupe plusieurs messages lorsqu’il écrit à son dispositif de stockage en interne.</span><span class="sxs-lookup"><span data-stu-id="f7848-164">To increase the throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes to its internal store.</span></span> <span data-ttu-id="f7848-165">S’il est activé sur une file d’attente ou une rubrique, l’écriture de messages dans le dispositif de stockage est traitée par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-165">If enabled on a queue or topic, writing messages into the store will be batched.</span></span> <span data-ttu-id="f7848-166">S’il est activé sur une file d’attente ou un abonnement, l’écriture de messages depuis le dispositif de stockage est traitée par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-166">If enabled on a queue or subscription, deleting messages from the store will be batched.</span></span> <span data-ttu-id="f7848-167">Si l’accès au magasin par lot est activé pour une entité, Service Bus retarde l’opération d’écriture de dispositif de stockage concernant cette entité de 20 ms au maximum.</span><span class="sxs-lookup"><span data-stu-id="f7848-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up to 20ms.</span></span> <span data-ttu-id="f7848-168">Les opérations de stockage supplémentaires qui se produisent pendant cet intervalle sont ajoutées au lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-168">Additional store operations that occur during this interval are added to the batch.</span></span> <span data-ttu-id="f7848-169">L’accès au dispositif de stockage par lot affecte seulement les opérations **d’envoi** et **complètes** ; les opérations de réception ne sont pas affectées.</span><span class="sxs-lookup"><span data-stu-id="f7848-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="f7848-170">L’accès au dispositif de stockage est une propriété d’entité.</span><span class="sxs-lookup"><span data-stu-id="f7848-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="f7848-171">Le traitement par lot se produit sur toutes les entités qui permettent l’accès au stockage par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="f7848-172">Lorsque vous créez une file d’attente, une rubrique ou un abonnement, l’accès au stockage par lot est activé par défaut.</span><span class="sxs-lookup"><span data-stu-id="f7848-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="f7848-173">Pour désactiver l’accès au stockage par lot, définissez la propriété [EnableBatchedOperations][EnableBatchedOperations] sur **false** avant de créer l’entité.</span><span class="sxs-lookup"><span data-stu-id="f7848-173">To disable batched store access, set the [EnableBatchedOperations][EnableBatchedOperations] property to **false** before creating the entity.</span></span> <span data-ttu-id="f7848-174">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="f7848-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="f7848-175">L’accès au stockage par lot n’affecte pas le nombre d’opérations de messagerie facturables et constitue une propriété de file d’attente, de rubrique ou d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="f7848-175">Batched store access does not affect the number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="f7848-176">Il est indépendant du mode de réception et du protocole utilisé entre un client et le service Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-176">It is independent of the receive mode and the protocol that is used between a client and the Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="f7848-177">Lecture anticipée</span><span class="sxs-lookup"><span data-stu-id="f7848-177">Prefetching</span></span>
<span data-ttu-id="f7848-178">La lecture anticipée permet au client de la file d’attente ou de l’abonnement de charger des messages supplémentaires à partir du service lorsqu’il effectue une opération de réception.</span><span class="sxs-lookup"><span data-stu-id="f7848-178">Prefetching enables the queue or subscription client to load additional messages from the service when it performs a receive operation.</span></span> <span data-ttu-id="f7848-179">Le client stocke ces messages en mémoire cache.</span><span class="sxs-lookup"><span data-stu-id="f7848-179">The client stores these messages in a local cache.</span></span> <span data-ttu-id="f7848-180">La taille du cache est déterminée par la propriété [QueueClient.PrefetchCount][QueueClient.PrefetchCount] ou [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount].</span><span class="sxs-lookup"><span data-stu-id="f7848-180">The size of the cache is determined by the [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="f7848-181">Chaque client qui permet la lecture anticipée gère son propre cache.</span><span class="sxs-lookup"><span data-stu-id="f7848-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="f7848-182">Un cache n’est pas partagé par plusieurs clients.</span><span class="sxs-lookup"><span data-stu-id="f7848-182">A cache is not shared across clients.</span></span> <span data-ttu-id="f7848-183">Si le client initie une opération de réception et que sa mémoire cache est vide, le service transmet un lot de messages.</span><span class="sxs-lookup"><span data-stu-id="f7848-183">If the client initiates a receive operation and its cache is empty, the service transmits a batch of messages.</span></span> <span data-ttu-id="f7848-184">La taille du lot est égale à la taille du cache ou à 256 Ko, la plus faible l’emportant.</span><span class="sxs-lookup"><span data-stu-id="f7848-184">The size of the batch equals the size of the cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="f7848-185">Si le client initie une opération de réception et que le cache contient un message, ce dernier est extrait de la mémoire cache.</span><span class="sxs-lookup"><span data-stu-id="f7848-185">If the client initiates a receive operation and the cache contains a message, the message is taken from the cache.</span></span>

<span data-ttu-id="f7848-186">Lorsqu’un message est lu par anticipation, le service le verrouille.</span><span class="sxs-lookup"><span data-stu-id="f7848-186">When a message is prefetched, the service locks the prefetched message.</span></span> <span data-ttu-id="f7848-187">Ce faisant, le message lu par anticipation ne peut pas être reçu par un autre destinataire.</span><span class="sxs-lookup"><span data-stu-id="f7848-187">By doing this, the prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="f7848-188">Si le destinataire ne peut pas terminer le message avant expiration du verrouillage, le message devient disponible pour les autres destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-188">If the receiver cannot complete the message before the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="f7848-189">La copie lue par anticipation du message reste dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f7848-189">The prefetched copy of the message remains in the cache.</span></span> <span data-ttu-id="f7848-190">Le destinataire qui consomme la copie mise en cache expirée reçoit une exception lorsqu’il essaie de terminer le message.</span><span class="sxs-lookup"><span data-stu-id="f7848-190">The receiver that consumes the expired cached copy will receive an exception when it tries to complete that message.</span></span> <span data-ttu-id="f7848-191">Par défaut, le verrouillage du message expire au bout de 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="f7848-191">By default, the message lock expires after 60 seconds.</span></span> <span data-ttu-id="f7848-192">Cette valeur peut être étendue à 5 minutes.</span><span class="sxs-lookup"><span data-stu-id="f7848-192">This value can be extended to 5 minutes.</span></span> <span data-ttu-id="f7848-193">Pour empêcher la consommation des messages arrivés à expiration, la taille du cache doit toujours être inférieure au nombre de messages qui peuvent être utilisés par un client au sein de l’intervalle de délai d’expiration de verrouillage.</span><span class="sxs-lookup"><span data-stu-id="f7848-193">To prevent the consumption of expired messages, the cache size should always be smaller than the number of messages that can be consumed by a client within the lock time-out interval.</span></span>

<span data-ttu-id="f7848-194">Lorsque vous utilisez l’expiration de verrouillage par défaut (60 secondes), il est judicieux d’attribuer à [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] une valeur correspondant à 20 fois la vitesse de traitement de l’ensemble des destinataires présents dans la structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-194">When using the default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times the maximum processing rates of all receivers of the factory.</span></span> <span data-ttu-id="f7848-195">Par exemple, une structure crée 3 destinataires, et chaque récepteur peut traiter jusqu’à 10 messages par seconde.</span><span class="sxs-lookup"><span data-stu-id="f7848-195">For example, a factory creates 3 receivers, and each receiver can process up to 10 messages per second.</span></span> <span data-ttu-id="f7848-196">Le nombre de lectures anticipées ne doit pas dépasser 20 X 3 X 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="f7848-196">The prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="f7848-197">Par défaut, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] est définie sur 0, ce qui signifie qu’aucun message supplémentaire n’est lu à partir du service.</span><span class="sxs-lookup"><span data-stu-id="f7848-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set to 0, which means that no additional messages are fetched from the service.</span></span>

<span data-ttu-id="f7848-198">La lecture anticipée de messages augmente le débit global d’un abonnement ou une file d’attente, car elle permet de réduire le nombre total d’opérations de messagerie, ou les allers-retours.</span><span class="sxs-lookup"><span data-stu-id="f7848-198">Prefetching messages increases the overall throughput for a queue or subscription because it reduces the overall number of message operations, or round trips.</span></span> <span data-ttu-id="f7848-199">La lecture anticipée du premier message, cependant, prend plus de temps (en raison de la taille du message accrue).</span><span class="sxs-lookup"><span data-stu-id="f7848-199">Fetching the first message, however, will take longer (due to the increased message size).</span></span> <span data-ttu-id="f7848-200">La réception de message avec lecture anticipée sera plus rapide, car ces messages ont déjà été téléchargés par le client.</span><span class="sxs-lookup"><span data-stu-id="f7848-200">Receiving prefetched messages will be faster because these messages have already been downloaded by the client.</span></span>

<span data-ttu-id="f7848-201">La propriété (TTL) de durée de vie d’un message est vérifiée par le serveur au moment où le serveur envoie le message au client.</span><span class="sxs-lookup"><span data-stu-id="f7848-201">The time-to-live (TTL) property of a message is checked by the server at the time the server sends the message to the client.</span></span> <span data-ttu-id="f7848-202">Le client ne vérifie pas la propriété TTL de durée de vie du message à la réception du message.</span><span class="sxs-lookup"><span data-stu-id="f7848-202">The client does not check the message’s TTL property when the message is received.</span></span> <span data-ttu-id="f7848-203">Toutefois, le message peut être reçu même si la durée de vie du message a été dépassée pensant la mise en mémoire cache par le client.</span><span class="sxs-lookup"><span data-stu-id="f7848-203">Instead, the message can be received even if the message’s TTL has passed while the message was cached by the client.</span></span>

<span data-ttu-id="f7848-204">La lecture anticipée n’affecte pas le nombre d’opérations de messagerie facturables et est disponible uniquement pour le protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-204">Prefetching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="f7848-205">Le protocole HTTP ne prend pas en charge la lecture anticipée.</span><span class="sxs-lookup"><span data-stu-id="f7848-205">The HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="f7848-206">La lecture anticipée est disponible pour les opérations de réception synchrones et asynchrones.</span><span class="sxs-lookup"><span data-stu-id="f7848-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="f7848-207">Files d’attente et les rubriques rapides</span><span class="sxs-lookup"><span data-stu-id="f7848-207">Express queues and topics</span></span>

<span data-ttu-id="f7848-208">Les entités rapides garantissent un débit élevé et une faible latence et sont prises en charge uniquement dans la couche de messagerie Standard.</span><span class="sxs-lookup"><span data-stu-id="f7848-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in the Standard messaging tier.</span></span> <span data-ttu-id="f7848-209">Les entités créées dans les [espaces de noms Premium](service-bus-premium-messaging.md) ne prennent pas en charge l’option rapide.</span><span class="sxs-lookup"><span data-stu-id="f7848-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support the express option.</span></span> <span data-ttu-id="f7848-210">Avec les entités rapides, si un message est envoyé à une file d’attente ou à une rubrique, il n’est pas immédiatement stocké dans la banque de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-210">With express entities, if a message is sent to a queue or topic, the message is not immediately stored in the messaging store.</span></span> <span data-ttu-id="f7848-211">Au lieu de cela, le message est mis en cache.</span><span class="sxs-lookup"><span data-stu-id="f7848-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="f7848-212">Si un message reste dans la file d’attente pendant plus de quelques secondes, il est automatiquement écrit dans un stockage stable, afin d’éviter qu’il soit perdu en cas de panne.</span><span class="sxs-lookup"><span data-stu-id="f7848-212">If a message remains in the queue for more than a few seconds, it is automatically written to stable storage, thus protecting it against loss due to an outage.</span></span> <span data-ttu-id="f7848-213">L’écriture du message en mémoire cache permet d’augmenter le débit et de réduire le temps de latence, car il n’a pas accès au stockage stable au moment où que le message est envoyé.</span><span class="sxs-lookup"><span data-stu-id="f7848-213">Writing the message into a memory cache increases throughput and reduces latency because there is no access to stable storage at the time the message is sent.</span></span> <span data-ttu-id="f7848-214">Les messages consommés en quelques secondes ne sont pas écrits dans le magasin de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-214">Messages that are consumed within a few seconds are not written to the messaging store.</span></span> <span data-ttu-id="f7848-215">Dans l’exemple suivant, l’abonnement crée une rubrique rapide.</span><span class="sxs-lookup"><span data-stu-id="f7848-215">The following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="f7848-216">Si un message contenant des informations sensibles ne devant pas être égarées est envoyé à une entité rapide, l’expéditeur peut forcer Service Bus à placer immédiatement le message dans un dispositif de stockage stable en définissant la propriété [ForcePersistence][ForcePersistence] sur **true**.</span><span class="sxs-lookup"><span data-stu-id="f7848-216">If a message containing critical information that must not be lost is sent to an express entity, the sender can force Service Bus to immediately persist the message to stable storage by setting the [ForcePersistence][ForcePersistence] property to **true**.</span></span>

> [!NOTE]
> <span data-ttu-id="f7848-217">Les entités rapides ne prennent pas en charge les transactions.</span><span class="sxs-lookup"><span data-stu-id="f7848-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="f7848-218">Utilisation de files d’attente partitionnées ou de rubriques</span><span class="sxs-lookup"><span data-stu-id="f7848-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="f7848-219">En interne, Service Bus utilise le même nœud et stockage de messagerie pour traiter et stocker tous les messages d’une entité de messagerie (file d’attente ou rubrique).</span><span class="sxs-lookup"><span data-stu-id="f7848-219">Internally, Service Bus uses the same node and messaging store to process and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="f7848-220">Une file d’attente ou une rubrique partitionnée, elle, se répartit sur plusieurs nœuds et banques de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-220">A partitioned queue or topic, on the other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="f7848-221">Les rubriques et files d’attente partitionnées donnent non seulement un débit plus élevé que les rubriques et files d’attente standard, mais ils présentent également une disponibilité supérieure.</span><span class="sxs-lookup"><span data-stu-id="f7848-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="f7848-222">Pour créer une entité partitionnée, définissez la propriété [EnablePartitioning][EnablePartitioning] sur **true**, comme illustré dans l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="f7848-222">To create a partitioned entity, set the [EnablePartitioning][EnablePartitioning] property to **true**, as shown in the following example.</span></span> <span data-ttu-id="f7848-223">Pour plus d’informations sur les entités partitionnées, consultez [Files d’attente et rubriques partitionnées][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="f7848-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="f7848-224">Utilisation de plusieurs files d’attente</span><span class="sxs-lookup"><span data-stu-id="f7848-224">Use of multiple queues</span></span>

<span data-ttu-id="f7848-225">S’il est impossible d’utiliser une file d’attente ou une rubrique partitionnée, la charge prévue ne peut pas être gérée par une seule file d’attente ou rubrique partitionnée. Vous devez utiliser plusieurs entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="f7848-225">If it is not possible to use a partitioned queue or topic, or the expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="f7848-226">Lorsque vous utilisez plusieurs entités, créez un client dédié pour chacune d’elles au lieu d’utiliser le même client pour toutes les entités.</span><span class="sxs-lookup"><span data-stu-id="f7848-226">When using multiple entities, create a dedicated client for each entity, instead of using the same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="f7848-227">Fonctionnalités de développement et de test</span><span class="sxs-lookup"><span data-stu-id="f7848-227">Development and testing features</span></span>

<span data-ttu-id="f7848-228">Service Bus possède une fonctionnalité qui est utilisée spécifiquement pour le développement, qui **ne doit jamais être utilisée dans les configurations de production** : [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="f7848-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="f7848-229">Lorsque de nouvelles règles ou des filtres sont ajoutés à la rubrique, vous pouvez utiliser [TopicDescription.EnableFilteringMessagesBeforePublishing][] pour vérifier que la nouvelle expression de filtre fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="f7848-229">When new rules or filters are added to the topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] to verify that the new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="f7848-230">Scénarios</span><span class="sxs-lookup"><span data-stu-id="f7848-230">Scenarios</span></span>
<span data-ttu-id="f7848-231">Les sections suivantes décrivent les scénarios de messagerie classiques et soulignent les paramètres Service Bus favoris par défaut.</span><span class="sxs-lookup"><span data-stu-id="f7848-231">The following sections describe typical messaging scenarios and outline the preferred Service Bus settings.</span></span> <span data-ttu-id="f7848-232">Les débits sont classés dans la catégorie Petit (moins d’1 message/seconde), Modéré (1 message/s ou plus, mais moins de 100 messages par seconde) et Élevé (100 messages/seconde ou plus).</span><span class="sxs-lookup"><span data-stu-id="f7848-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="f7848-233">Le nombre de clients est classé en tant que petit (5 ou moins), modéré (plus de 5, mais inférieur ou égal à 20) et grand (plus de 20).</span><span class="sxs-lookup"><span data-stu-id="f7848-233">The number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal to 20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="f7848-234">File d’attente à débit élevé</span><span class="sxs-lookup"><span data-stu-id="f7848-234">High-throughput queue</span></span>
<span data-ttu-id="f7848-235">Objectif : maximiser le débit d’une file d’attente unique.</span><span class="sxs-lookup"><span data-stu-id="f7848-235">Goal: Maximize the throughput of a single queue.</span></span> <span data-ttu-id="f7848-236">Le nombre d’expéditeurs et de destinataires est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-236">The number of senders and receivers is small.</span></span>

* <span data-ttu-id="f7848-237">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="f7848-238">Pour augmenter la vitesse de transmission globale dans la file d’attente, utilisez plusieurs structures de messages pour créer des expéditeurs.</span><span class="sxs-lookup"><span data-stu-id="f7848-238">To increase the overall send rate into the queue, use multiple message factories to create senders.</span></span> <span data-ttu-id="f7848-239">Pour chaque expéditeur, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="f7848-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="f7848-240">Pour augmenter la vitesse de réception depuis la file d’attente, utilisez plusieurs structures de messages pour créer des destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-240">To increase the overall receive rate from the queue, use multiple message factories to create receivers.</span></span>
* <span data-ttu-id="f7848-241">Utilisez des opérations asynchrones pour tirer parti du traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="f7848-241">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="f7848-242">Définissez l’intervalle de mise en lot de 50 ms pour réduire le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-242">Set the batching interval to 50ms to reduce the number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="f7848-243">Si plusieurs expéditeurs sont utilisés, augmentez l’intervalle de traitement par lot à 100 ms.</span><span class="sxs-lookup"><span data-stu-id="f7848-243">If multiple senders are used, increase the batching interval to 100ms.</span></span>
* <span data-ttu-id="f7848-244">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-244">Leave batched store access enabled.</span></span> <span data-ttu-id="f7848-245">Cette opération augmente la cadence à laquelle les messages peuvent être écrits dans la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="f7848-245">This increases the overall rate at which messages can be written into the queue.</span></span>
* <span data-ttu-id="f7848-246">Définissez le nombre de lectures anticipées à 20 fois la vitesse de traitement maximale de la totalité des destinataires d’une structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-246">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="f7848-247">Cela réduit le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-247">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="f7848-248">Plusieurs files d’attente haut débit</span><span class="sxs-lookup"><span data-stu-id="f7848-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="f7848-249">Objectif : Optimiser le débit global de plusieurs files d’attente.</span><span class="sxs-lookup"><span data-stu-id="f7848-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="f7848-250">Le débit d’une file d’attente individuelle est modéré ou élevé.</span><span class="sxs-lookup"><span data-stu-id="f7848-250">The throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="f7848-251">Pour obtenir un débit maximal sur plusieurs files d’attente, utiliser les paramètres conseillés pour maximiser le débit d’une file d’attente unique.</span><span class="sxs-lookup"><span data-stu-id="f7848-251">To obtain maximum throughput across multiple queues, use the settings outlined to maximize the throughput of a single queue.</span></span> <span data-ttu-id="f7848-252">En outre, utiliser des structures différentes pour créer des clients procédant à des envois ou des réceptions de la part de différentes files d’attente.</span><span class="sxs-lookup"><span data-stu-id="f7848-252">In addition, use different factories to create clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="f7848-253">File d’attente à latence faible</span><span class="sxs-lookup"><span data-stu-id="f7848-253">Low latency queue</span></span>
<span data-ttu-id="f7848-254">Objectif : réduire la latence de bout en bout d’une file d’attente ou d’une rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="f7848-255">Le nombre d’expéditeurs et de destinataires est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-255">The number of senders and receivers is small.</span></span> <span data-ttu-id="f7848-256">Le débit de la file d’attente est faible ou modéré.</span><span class="sxs-lookup"><span data-stu-id="f7848-256">The throughput of the queue is small or moderate.</span></span>

* <span data-ttu-id="f7848-257">Utiliser une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="f7848-258">Désactiver le traitement par lots côté client.</span><span class="sxs-lookup"><span data-stu-id="f7848-258">Disable client-side batching.</span></span> <span data-ttu-id="f7848-259">Le client envoie immédiatement un message.</span><span class="sxs-lookup"><span data-stu-id="f7848-259">The client immediately sends a message.</span></span>
* <span data-ttu-id="f7848-260">Désactiver l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-260">Disable batched store access.</span></span> <span data-ttu-id="f7848-261">Le service écrit immédiatement le message pour le magasin.</span><span class="sxs-lookup"><span data-stu-id="f7848-261">The service immediately writes the message to the store.</span></span>
* <span data-ttu-id="f7848-262">Si vous utilisez un seul client, définissez le nombre de lectures anticipées à 20 fois la vitesse de traitement du destinataire.</span><span class="sxs-lookup"><span data-stu-id="f7848-262">If using a single client, set the prefetch count to 20 times the processing rate of the receiver.</span></span> <span data-ttu-id="f7848-263">Si plusieurs messages arrivent à la file d’attente en même temps, le protocole client Service Bus les transmet tous simultanément.</span><span class="sxs-lookup"><span data-stu-id="f7848-263">If multiple messages arrive at the queue at the same time, the Service Bus client protocol transmits them all at the same time.</span></span> <span data-ttu-id="f7848-264">Lorsque le client reçoit le message suivant, ce message est déjà dans le cache local.</span><span class="sxs-lookup"><span data-stu-id="f7848-264">When the client receives the next message, that message is already in the local cache.</span></span> <span data-ttu-id="f7848-265">Le cache doit être de petite taille.</span><span class="sxs-lookup"><span data-stu-id="f7848-265">The cache should be small.</span></span>
* <span data-ttu-id="f7848-266">Si vous utilisez plusieurs clients, définissez le nombre de lectures anticipées sur 0.</span><span class="sxs-lookup"><span data-stu-id="f7848-266">If using multiple clients, set the prefetch count to 0.</span></span> <span data-ttu-id="f7848-267">Ce faisant, le deuxième client peut recevoir le deuxième message alors que le premier client traite toujours le premier message.</span><span class="sxs-lookup"><span data-stu-id="f7848-267">By doing this, the second client can receive the second message while the first client is still processing the first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="f7848-268">File d’attente comportant un grand nombre d’expéditeurs</span><span class="sxs-lookup"><span data-stu-id="f7848-268">Queue with a large number of senders</span></span>
<span data-ttu-id="f7848-269">Objectif : maximiser le débit d’une file d’attente ou d’une rubrique comportant un grand nombre d’expéditeurs.</span><span class="sxs-lookup"><span data-stu-id="f7848-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="f7848-270">Chaque expéditeur envoie des messages à une vitesse modérée.</span><span class="sxs-lookup"><span data-stu-id="f7848-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="f7848-271">Le nombre de destinataires est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-271">The number of receivers is small.</span></span>

<span data-ttu-id="f7848-272">Service Bus permet jusqu’à 1 000 connexions simultanées vers une entité de messagerie (ou 5 000 avec AMQP).</span><span class="sxs-lookup"><span data-stu-id="f7848-272">Service Bus enables up to 1000 concurrent connections to a messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="f7848-273">Cette limite s’applique au niveau de l’espace de noms et les rubriques/files d’attente/abonnements sont limités par la limite de connexions simultanées par espace de noms.</span><span class="sxs-lookup"><span data-stu-id="f7848-273">This limit is enforced at the namespace level, and queues/topics/subscriptions are capped by the limit of concurrent connections per namespace.</span></span> <span data-ttu-id="f7848-274">Pour les files d’attente, ce nombre est partagé entre les expéditeurs et les destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="f7848-275">Si les 1 000 connexions sont requises pour les expéditeurs, vous devez remplacer la file d’attente par une rubrique et un seul abonnement.</span><span class="sxs-lookup"><span data-stu-id="f7848-275">If all 1000 connections are required for senders, you should replace the queue with a topic and a single subscription.</span></span> <span data-ttu-id="f7848-276">Une rubrique accepte jusqu’à 1 000 connexions simultanées provenant d’expéditeurs, alors que l’abonnement accepte un 1 000 connexions simultanées destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-276">A topic accepts up to 1000 concurrent connections from senders, whereas the subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="f7848-277">Si plus de 1 000 expéditeurs simultanés sont requis, les expéditeurs doivent envoyer leurs messages vers le protocole de Service Bus via HTTP.</span><span class="sxs-lookup"><span data-stu-id="f7848-277">If more than 1000 concurrent senders are required, the senders should send messages to the Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="f7848-278">Pour maximiser le débit, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="f7848-278">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="f7848-279">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="f7848-280">Si chaque expéditeur réside dans un processus différent, utilisez uniquement une structure par processus.</span><span class="sxs-lookup"><span data-stu-id="f7848-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="f7848-281">Utilisez des opérations asynchrones pour tirer parti du traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="f7848-281">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="f7848-282">Utilisez la valeur par défaut de l’intervalle de 20 ms pour réduire le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-282">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="f7848-283">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-283">Leave batched store access enabled.</span></span> <span data-ttu-id="f7848-284">Cette opération augmente la cadence à laquelle les messages peuvent être écrits dans la file d’attente ou la rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-284">This increases the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="f7848-285">Définissez le nombre de lectures anticipées à 20 fois la vitesse de traitement maximale de la totalité des destinataires d’une structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-285">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="f7848-286">Cela réduit le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-286">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="f7848-287">File d’attente comportant un grand nombre de destinataires</span><span class="sxs-lookup"><span data-stu-id="f7848-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="f7848-288">Objectif : optimiser la vitesse de réception d’une file d’attente ou d’abonnement comportant un grand nombre de destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-288">Goal: Maximize the receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="f7848-289">Chaque destinataire reçoit les messages à une vitesse modérée.</span><span class="sxs-lookup"><span data-stu-id="f7848-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="f7848-290">Le nombre d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-290">The number of senders is small.</span></span>

<span data-ttu-id="f7848-291">Service Bus permet jusqu’à 1 000 connexions simultanées vers une entité.</span><span class="sxs-lookup"><span data-stu-id="f7848-291">Service Bus enables up to 1000 concurrent connections to an entity.</span></span> <span data-ttu-id="f7848-292">Si une file d’attente nécessite plus de 1 000 récepteurs, vous devez remplacer la file d’attente par une rubrique et plusieurs abonnements.</span><span class="sxs-lookup"><span data-stu-id="f7848-292">If a queue requires more than 1000 receivers, you should replace the queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="f7848-293">Chaque abonnement peut prendre en charge jusqu’à 1 000 connexions simultanées.</span><span class="sxs-lookup"><span data-stu-id="f7848-293">Each subscription can support up to 1000 concurrent connections.</span></span> <span data-ttu-id="f7848-294">Les destinataires peuvent également accéder à la file d’attente via le protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="f7848-294">Alternatively, receivers can access the queue via the HTTP protocol.</span></span>

<span data-ttu-id="f7848-295">Pour maximiser le débit, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="f7848-295">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="f7848-296">Utilisez une file d’attente partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="f7848-297">Si chaque destinataire réside dans un processus différent, utilisez uniquement une structure par processus.</span><span class="sxs-lookup"><span data-stu-id="f7848-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="f7848-298">Les récepteurs peuvent utiliser des opérations synchronisées ou asynchrones.</span><span class="sxs-lookup"><span data-stu-id="f7848-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="f7848-299">Étant donné la vitesse de réception modérée d’un destinataire individuel, le traitement côté client de la demande complète n’affecte pas le débit du destinataire.</span><span class="sxs-lookup"><span data-stu-id="f7848-299">Given the moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="f7848-300">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-300">Leave batched store access enabled.</span></span> <span data-ttu-id="f7848-301">Cela réduit la charge globale de l’entité.</span><span class="sxs-lookup"><span data-stu-id="f7848-301">This reduces the overall load of the entity.</span></span> <span data-ttu-id="f7848-302">Cette opération réduit également la cadence générale à laquelle les messages peuvent être écrits dans la file d’attente ou la rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-302">It also reduces the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="f7848-303">Définir le nombre de lectures anticipées sur une valeur faible (par exemple, PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="f7848-303">Set the prefetch count to a small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="f7848-304">Cela empêche les destinataires de rester oisifs pendant que les autres destinataires mettent en cache un grand nombre de messages.</span><span class="sxs-lookup"><span data-stu-id="f7848-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="f7848-305">Rubrique comportant un petit nombre d’abonnements</span><span class="sxs-lookup"><span data-stu-id="f7848-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="f7848-306">Objectif : maximiser le débit d’une rubrique comportant un petit nombre d’abonnements.</span><span class="sxs-lookup"><span data-stu-id="f7848-306">Goal: Maximize the throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="f7848-307">Un message est reçu par un grand nombre d’abonnements, ce qui signifie que la vitesse de réception combinée sur l’ensemble des abonnements est supérieure à la vitesse d’envoi.</span><span class="sxs-lookup"><span data-stu-id="f7848-307">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is larger than the send rate.</span></span> <span data-ttu-id="f7848-308">Le nombre d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-308">The number of senders is small.</span></span> <span data-ttu-id="f7848-309">Le nombre de récepteurs par abonnement est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-309">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="f7848-310">Pour maximiser le débit, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="f7848-310">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="f7848-311">Utilisez une rubrique partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="f7848-312">Pour augmenter la vitesse de transmission globale dans la rubrique, utilisez plusieurs structures de messages pour créer des expéditeurs.</span><span class="sxs-lookup"><span data-stu-id="f7848-312">To increase the overall send rate into the topic, use multiple message factories to create senders.</span></span> <span data-ttu-id="f7848-313">Pour chaque expéditeur, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="f7848-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="f7848-314">Pour augmenter la vitesse de réception d’ensemble d’un abonnement, utilisez plusieurs structures de message pour créer des destinataires.</span><span class="sxs-lookup"><span data-stu-id="f7848-314">To increase the overall receive rate from a subscription, use multiple message factories to create receivers.</span></span> <span data-ttu-id="f7848-315">Pour chaque destinataire, utilisez des opérations asynchrones ou plusieurs threads.</span><span class="sxs-lookup"><span data-stu-id="f7848-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="f7848-316">Utilisez des opérations asynchrones pour tirer parti du traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="f7848-316">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="f7848-317">Utilisez la valeur par défaut de l’intervalle de 20 ms pour réduire le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-317">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="f7848-318">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-318">Leave batched store access enabled.</span></span> <span data-ttu-id="f7848-319">Cette opération augmente la cadence à laquelle les messages peuvent être écrits dans la rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-319">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="f7848-320">Définissez le nombre de lectures anticipées à 20 fois la vitesse de traitement maximale de la totalité des destinataires d’une structure.</span><span class="sxs-lookup"><span data-stu-id="f7848-320">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="f7848-321">Cela réduit le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-321">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="f7848-322">Rubrique comportant un grand nombre d’abonnements</span><span class="sxs-lookup"><span data-stu-id="f7848-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="f7848-323">Objectif : maximiser le débit d’une rubrique comportant un grand nombre d’abonnements.</span><span class="sxs-lookup"><span data-stu-id="f7848-323">Goal: Maximize the throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="f7848-324">Un message est reçu par un grand nombre d’abonnements, ce qui signifie que la vitesse de réception associée à l’ensemble des abonnements est supérieure à la vitesse d’envoi.</span><span class="sxs-lookup"><span data-stu-id="f7848-324">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is much larger than the send rate.</span></span> <span data-ttu-id="f7848-325">Le nombre d’expéditeurs est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-325">The number of senders is small.</span></span> <span data-ttu-id="f7848-326">Le nombre de récepteurs par abonnement est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-326">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="f7848-327">Les rubriques comportant un grand nombre d’abonnements affichent généralement un faible débit global si tous les messages sont acheminés vers tous les abonnements.</span><span class="sxs-lookup"><span data-stu-id="f7848-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed to all subscriptions.</span></span> <span data-ttu-id="f7848-328">Cela est dû au fait que chaque message est reçu plusieurs fois et tous les messages contenus dans une rubrique et tous les abonnements associés sont stockés dans le même magasin.</span><span class="sxs-lookup"><span data-stu-id="f7848-328">This is caused by the fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in the same store.</span></span> <span data-ttu-id="f7848-329">Il est supposé que le nombre d’expéditeurs et nombre de récepteurs par abonnement est faible.</span><span class="sxs-lookup"><span data-stu-id="f7848-329">It is assumed that the number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="f7848-330">Service Bus prend en charge jusqu’à 2 000 abonnements par rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-330">Service Bus supports up to 2,000 subscriptions per topic.</span></span>

<span data-ttu-id="f7848-331">Pour maximiser le débit, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="f7848-331">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="f7848-332">Utilisez une rubrique partitionnée pour améliorer les performances et la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f7848-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="f7848-333">Utilisez des opérations asynchrones pour tirer parti du traitement par lot côté client.</span><span class="sxs-lookup"><span data-stu-id="f7848-333">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="f7848-334">Utilisez la valeur par défaut de l’intervalle de 20 ms pour réduire le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-334">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="f7848-335">Désactivez l’accès au magasin par lot.</span><span class="sxs-lookup"><span data-stu-id="f7848-335">Leave batched store access enabled.</span></span> <span data-ttu-id="f7848-336">Cette opération augmente la cadence à laquelle les messages peuvent être écrits dans la rubrique.</span><span class="sxs-lookup"><span data-stu-id="f7848-336">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="f7848-337">Définissez le nombre de lectures anticipées à 20 fois la vitesse de réception prévue en secondes.</span><span class="sxs-lookup"><span data-stu-id="f7848-337">Set the prefetch count to 20 times the expected receive rate in seconds.</span></span> <span data-ttu-id="f7848-338">Cela réduit le nombre de transmissions de protocole client Service Bus.</span><span class="sxs-lookup"><span data-stu-id="f7848-338">This reduces the number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f7848-339">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f7848-339">Next steps</span></span>
<span data-ttu-id="f7848-340">Pour en savoir plus sur l’optimisation des performances Service Bus, consultez [Entités de messagerie partitionnées][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="f7848-340">To learn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
<span data-ttu-id="f7848-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span><span class="sxs-lookup"><span data-stu-id="f7848-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span></span>
