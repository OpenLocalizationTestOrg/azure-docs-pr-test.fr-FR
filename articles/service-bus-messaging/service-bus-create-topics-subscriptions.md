---
title: "Création d’applications qui utilisent des rubriques et des abonnements Azure Service Bus | Microsoft Docs"
description: Introduction aux fonctions publication-abonnement offertes par les abonnements et les rubriques de Service Bus.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: eb01120ce9578f716e5381c107faa93f0b36e358
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="4217b-103">Création d’applications qui utilisent des rubriques et des abonnements Service Bus</span><span class="sxs-lookup"><span data-stu-id="4217b-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="4217b-104">Azure Service Bus prend en charge un ensemble de technologies interlogicielles Cloud orientées messages, notamment une mise en file d'attente des messages fiable et une messagerie de publication/abonnement durable.</span><span class="sxs-lookup"><span data-stu-id="4217b-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="4217b-105">Cet article s’appuie sur les informations fournies dans [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md) et présente les fonctionnalités de publication/d’abonnement offertes par les rubriques Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4217b-105">This article builds on the information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction to the publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="4217b-106">Scénario de vente au détail - La suite</span><span class="sxs-lookup"><span data-stu-id="4217b-106">Evolving retail scenario</span></span>
<span data-ttu-id="4217b-107">Cet article propose une suite du scénario de vente au détail décrit dans la rubrique [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="4217b-107">This article continues the retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="4217b-108">Souvenez-vous. Les données de vente recueillies à partir de terminaux de point de vente (PDV) doivent être acheminées vers un système de gestion des stocks. Celui-ci utilise ces données pour déterminer le moment où il est nécessaire de renouveler les stocks.</span><span class="sxs-lookup"><span data-stu-id="4217b-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed to an inventory management system which uses that data to determine when stock has to be replenished.</span></span> <span data-ttu-id="4217b-109">Chaque terminal de PDV consigne ses données de vente en envoyant des messages à la file d’attente **DataCollectionQueue**, dans laquelle ils sont conservés jusqu’à ce qu’ils soient reçus par le système de gestion des stocks, comme illustré ici :</span><span class="sxs-lookup"><span data-stu-id="4217b-109">Each POS terminal reports its sales data by sending messages to the **DataCollectionQueue** queue, where they remain until they are received by the inventory management system, as shown here:</span></span>

![Service Bus 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="4217b-111">Pour faire évoluer ce scénario, une nouvelle exigence a été ajoutée au système : le propriétaire de la boutique aimerait surveiller les performances de son point de vente en temps réel.</span><span class="sxs-lookup"><span data-stu-id="4217b-111">To evolve this scenario, a new requirement has been added to the system: the store owner wants to be able to monitor how the store is performing in real time.</span></span>

<span data-ttu-id="4217b-112">Pour répondre à cette exigence, le système doit puiser des informations dans le flux de données des ventes.</span><span class="sxs-lookup"><span data-stu-id="4217b-112">To address this requirement, the system must "tap" off the sales data stream.</span></span> <span data-ttu-id="4217b-113">Nous souhaitons conserver l'envoi systématique de chaque message provenant des terminaux de PDV vers le système de gestion des stocks, comme c'était le cas auparavant. En revanche, nous souhaitons créer une copie de chaque message pour l'utiliser dans une vue sous forme de tableau de bord à destination du propriétaire du magasin.</span><span class="sxs-lookup"><span data-stu-id="4217b-113">We still want each message sent by the POS terminals to be sent to the inventory management system as before, but we want another copy of each message that we can use to present the dashboard view to the store owner.</span></span>

<span data-ttu-id="4217b-114">Dans tous les cas de ce type, quand chaque message doit être consommé par plusieurs parties, vous pouvez utiliser les *rubriques* Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4217b-114">In any situation such as this, in which you require each message to be consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="4217b-115">Les rubriques fournissent un modèle de publication/d’abonnement, dans lequel chaque message publié est mis à disposition d’un abonnement (ou plusieurs) inscrit auprès de la rubrique.</span><span class="sxs-lookup"><span data-stu-id="4217b-115">Topics provide a publish/subscribe pattern in which each published message is made available to one or more subscriptions registered with the topic.</span></span> <span data-ttu-id="4217b-116">Au contraire, avec les files d'attente, chaque message est reçu par un seul consommateur.</span><span class="sxs-lookup"><span data-stu-id="4217b-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="4217b-117">Les messages sont envoyés à une rubrique de la même façon qu’ils sont envoyés à une file d’attente.</span><span class="sxs-lookup"><span data-stu-id="4217b-117">Messages are sent to a topic in the same way as they are sent to a queue.</span></span> <span data-ttu-id="4217b-118">Toutefois, les messages ne sont pas reçus à partir de la rubrique directement ; ils sont reçus à partir des abonnements.</span><span class="sxs-lookup"><span data-stu-id="4217b-118">However, messages are not received from the topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="4217b-119">Un abonnement à une rubrique ressemble à une file d’attente virtuelle qui reçoit des copies des messages envoyés à la rubrique en question.</span><span class="sxs-lookup"><span data-stu-id="4217b-119">You can think of a subscription to a topic as a virtual queue that receives copies of the messages that are sent to that topic.</span></span> <span data-ttu-id="4217b-120">Les messages sont reçus à partir d’un abonnement identique de la même façon que ceux qui sont reçus de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="4217b-120">Messages are received from a subscription the same way as they are received from a queue.</span></span>

<span data-ttu-id="4217b-121">Pour revenir au scénario de vente au détail, la file d’attente est remplacée par une rubrique et un abonnement est ajouté. Il sera utilisé par le composant du système de gestion des stocks.</span><span class="sxs-lookup"><span data-stu-id="4217b-121">Going back to the retail scenario, the queue is replaced by a topic, and a subscription is added, which the inventory management system component can use.</span></span> <span data-ttu-id="4217b-122">Le système se présente alors comme suit :</span><span class="sxs-lookup"><span data-stu-id="4217b-122">The system now appears as follows:</span></span>

![Service Bus 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="4217b-124">La configuration ici se comporte comme la conception précédente basée sur la file d'attente.</span><span class="sxs-lookup"><span data-stu-id="4217b-124">The configuration here performs identically to the previous queue-based design.</span></span> <span data-ttu-id="4217b-125">Autrement dit, les messages envoyés à la rubrique sont routés vers l’abonnement **Inventaire**, à partir duquel le **système de gestion des stocks** les consomme.</span><span class="sxs-lookup"><span data-stu-id="4217b-125">That is, messages sent to the topic are routed to the **Inventory** subscription, from which the **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="4217b-126">Pour prendre en charge le tableau de bord de gestion, créons un second abonnement sur la rubrique, comme illustré ici :</span><span class="sxs-lookup"><span data-stu-id="4217b-126">In order to support the management dashboard, we create a second subscription on the topic, as shown here:</span></span>

![Service Bus 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="4217b-128">Avec cette configuration, chaque message provenant des terminaux de PDV est accessible à la fois aux abonnements **Tableau de bord** et **Inventaire**.</span><span class="sxs-lookup"><span data-stu-id="4217b-128">With this configuration, each message from the POS terminals is made available to both the **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-the-code"></a><span data-ttu-id="4217b-129">Afficher le code</span><span class="sxs-lookup"><span data-stu-id="4217b-129">Show me the code</span></span>
<span data-ttu-id="4217b-130">L’article [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md) décrit comment s’inscrire pour obtenir un compte Azure et créer un espace de noms de service.</span><span class="sxs-lookup"><span data-stu-id="4217b-130">The article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how to sign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="4217b-131">Le moyen le plus simple pour référencer des dépendances Service Bus consiste à installer le [package Nuget](https://www.nuget.org/packages/WindowsAzure.ServiceBus/) de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="4217b-131">The easiest way to reference Service Bus dependencies is to install the Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="4217b-132">Vous trouverez également les bibliothèques Service Bus dans le kit de développement logiciel (SDK) d'Azure.</span><span class="sxs-lookup"><span data-stu-id="4217b-132">You can also find the Service Bus libraries as part of the Azure SDK.</span></span> <span data-ttu-id="4217b-133">Le téléchargement est disponible sur la [page de téléchargement du Kit de développement logiciel (SDK) Azure](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="4217b-133">The download is available at the [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-the-topic-and-subscriptions"></a><span data-ttu-id="4217b-134">Créez la rubrique et les abonnements</span><span class="sxs-lookup"><span data-stu-id="4217b-134">Create the topic and subscriptions</span></span>
<span data-ttu-id="4217b-135">Les opérations de gestion des entités de messagerie Service Bus (rubriques files d’attente et publication/abonnement) sont effectuées via la classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager).</span><span class="sxs-lookup"><span data-stu-id="4217b-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="4217b-136">Des informations d’identification appropriées sont nécessaires pour créer une instance **NamespaceManager** pour un espace de noms particulier.</span><span class="sxs-lookup"><span data-stu-id="4217b-136">Appropriate credentials are required in order to create a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="4217b-137">Service Bus utilise un modèle de sécurité basé sur une [signature d’accès partagé (SAP)](service-bus-sas.md).</span><span class="sxs-lookup"><span data-stu-id="4217b-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="4217b-138">La classe [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) représente un fournisseur de jetons de sécurité dont les méthodes de fabrique intégrées renvoient des fournisseurs de jetons bien connus.</span><span class="sxs-lookup"><span data-stu-id="4217b-138">The [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="4217b-139">Nous allons utiliser une méthode [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) pour retenir les informations d’identification SAP.</span><span class="sxs-lookup"><span data-stu-id="4217b-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method to hold the SAS credentials.</span></span> <span data-ttu-id="4217b-140">L’instance [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) est ensuite créée avec l’adresse de base de l’espace de noms Service Bus et du fournisseur de jetons.</span><span class="sxs-lookup"><span data-stu-id="4217b-140">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with the base address of the Service Bus namespace and the token provider.</span></span>

<span data-ttu-id="4217b-141">La classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) fournit des méthodes pour créer, énumérer et supprimer des entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="4217b-141">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods to create, enumerate and delete messaging entities.</span></span> <span data-ttu-id="4217b-142">Le code ci-dessous montre comment l’instance **NamespaceManager** est créée et utilisée pour créer la rubrique **DataCollectionTopic**.</span><span class="sxs-lookup"><span data-stu-id="4217b-142">The code that is shown here shows how the **NamespaceManager** instance is created and used to create the **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="4217b-143">Notez qu’il existe des surcharges de la méthode [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) qui vous permettent de définir les propriétés de la rubrique.</span><span class="sxs-lookup"><span data-stu-id="4217b-143">Note that there are overloads of the [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you to set properties of the topic.</span></span> <span data-ttu-id="4217b-144">Par exemple, vous pouvez définir la valeur par défaut de durée de vie « time-to-live » pour les messages envoyés à la rubrique.</span><span class="sxs-lookup"><span data-stu-id="4217b-144">For example, you can set the default time-to-live (TTL) value for messages sent to the topic.</span></span> <span data-ttu-id="4217b-145">Ensuite, ajoutez les abonnements **Inventaire** et **Tableau de bord**.</span><span class="sxs-lookup"><span data-stu-id="4217b-145">Next, add the **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-to-the-topic"></a><span data-ttu-id="4217b-146">Envoyez des messages à la rubrique</span><span class="sxs-lookup"><span data-stu-id="4217b-146">Send messages to the topic</span></span>
<span data-ttu-id="4217b-147">Pour des opérations d’exécution sur les entités Service Bus ; par exemple, pour l’envoi et la réception de messages, une application doit tout d’abord créer un objet [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory).</span><span class="sxs-lookup"><span data-stu-id="4217b-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="4217b-148">Semblable à la classe [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager), l’instance **MessagingFactory** est créée à partir de l’adresse de base de l’espace de noms et du fournisseur de jetons.</span><span class="sxs-lookup"><span data-stu-id="4217b-148">Similar to the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, the **MessagingFactory** instance is created from the base address of the service namespace and the token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="4217b-149">Les messages envoyés aux rubriques Service Bus (et reçus de celles-ci) sont des instances de la classe [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage).</span><span class="sxs-lookup"><span data-stu-id="4217b-149">Messages sent to and received from Service Bus topics, are instances of the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="4217b-150">Cette classe se compose d’un ensemble de propriétés standard (telles que [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) et [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), un dictionnaire servant à conserver les propriétés propres à une application, ainsi qu’un corps de données d’application arbitraires.</span><span class="sxs-lookup"><span data-stu-id="4217b-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used to hold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="4217b-151">Une application peut définir le corps en transmettant un objet sérialisable (l’exemple suivant transmet un objet **SalesData** qui représente les données de ventes à partir du terminal de PDV), qui utilisera [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) pour sérialiser l’objet.</span><span class="sxs-lookup"><span data-stu-id="4217b-151">An application can set the body by passing in any serializable object (the following example passes in a **SalesData** object that represents the sales data from the POS terminal), which will use the [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) to serialize the object.</span></span> <span data-ttu-id="4217b-152">Une autre possibilité consiste à fournir un objet [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx).</span><span class="sxs-lookup"><span data-stu-id="4217b-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="4217b-153">Le moyen le plus simple pour envoyer des messages à la rubrique consiste à utiliser [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) pour créer un objet [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) directement à partir de l’instance [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) :</span><span class="sxs-lookup"><span data-stu-id="4217b-153">The easiest way to send messages to the topic is to use [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) to create a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="4217b-154">Réception des messages d’un abonnement</span><span class="sxs-lookup"><span data-stu-id="4217b-154">Receive messages from a subscription</span></span>
<span data-ttu-id="4217b-155">Semblable à l’utilisation des files d’attente, pour recevoir des messages à partir d’un abonnement, vous pouvez utiliser un objet [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) que vous pouvez créer directement à partir de [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) à l’aide de [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="4217b-155">Similar to using queues, to receive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="4217b-156">Vous pouvez utiliser l’un des deux modes de réception (**ReceiveAndDelete** et **PeekLock**), comme indiqué dans [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="4217b-156">You can use one of the two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="4217b-157">Notez que lorsque vous créez un **MessageReceiver** pour les abonnements, le paramètre *entityPath* se présente comme suit : `topicPath/subscriptions/subscriptionName`.</span><span class="sxs-lookup"><span data-stu-id="4217b-157">Note that when you create a **MessageReceiver** for subscriptions, the *entityPath* parameter is of the form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="4217b-158">Par conséquent, pour créer un **MessageReceiver** pour l’abonnement **Inventaire** de la rubrique **DataCollectionTopic**, *entityPath* doit être défini sur `DataCollectionTopic/subscriptions/Inventory`.</span><span class="sxs-lookup"><span data-stu-id="4217b-158">Therefore, to create a **MessageReceiver** for the **Inventory** subscription of the **DataCollectionTopic** topic, *entityPath* must be set to `DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="4217b-159">Le code apparaît comme suit :</span><span class="sxs-lookup"><span data-stu-id="4217b-159">The code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="4217b-160">Filtres d’abonnement</span><span class="sxs-lookup"><span data-stu-id="4217b-160">Subscription filters</span></span>
<span data-ttu-id="4217b-161">Jusqu’ici, dans ce scénario, tous les messages envoyés à la rubrique sont rendus disponibles pour tous les abonnements inscrits.</span><span class="sxs-lookup"><span data-stu-id="4217b-161">So far, in this scenario all messages sent to the topic are made available to all registered subscriptions.</span></span> <span data-ttu-id="4217b-162">L'expression clé ici est « rendus disponibles ».</span><span class="sxs-lookup"><span data-stu-id="4217b-162">The key phrase here is "made available."</span></span> <span data-ttu-id="4217b-163">Bien que les abonnements Service Bus voient tous les messages envoyés à la rubrique, vous pouvez uniquement copier un sous-ensemble de ces messages dans la file d’attente d’abonnement virtuelle.</span><span class="sxs-lookup"><span data-stu-id="4217b-163">While Service Bus subscriptions see all messages sent to the topic, you can copy only a subset of those messages to the virtual subscription queue.</span></span> <span data-ttu-id="4217b-164">Pour ce faire, il faut utiliser des *filtres* d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="4217b-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="4217b-165">Lorsque vous créez un abonnement, vous pouvez fournir une expression de filtre sous la forme d’un prédicat de style SQL92 qui fonctionne avec les propriétés du message, à la fois les propriétés système (par exemple, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) et les propriétés de l’application, telles que **StoreName** dans l’exemple précédent.</span><span class="sxs-lookup"><span data-stu-id="4217b-165">When you create a subscription, you can supply a filter expression in the form of a SQL92 style predicate that operates over the properties of the message, both the system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and the application properties, such as **StoreName** in the previous example.</span></span>

<span data-ttu-id="4217b-166">Pour que le scénario de vente au détail soit plus complet et pour illustrer ce propos, nous allons ajouter un deuxième magasin.</span><span class="sxs-lookup"><span data-stu-id="4217b-166">Evolving the scenario to illustrate this, a second store is to be added to our retail scenario.</span></span> <span data-ttu-id="4217b-167">Les données de vente de tous les terminaux de PDV des deux magasins doivent toujours être acheminées vers le système de gestion des stocks central. En revanche, le directeur de chaque magasin, qui utilise l’outil de tableau de bord, souhaite visualiser uniquement les données qui concernent les performances de son magasin.</span><span class="sxs-lookup"><span data-stu-id="4217b-167">Sales data from all of the POS terminals from both stores still have to be routed to the centralized inventory management system, but a store manager using the dashboard tool is only interested in the performance of that store.</span></span> <span data-ttu-id="4217b-168">Pour répondre à cette difficulté, vous pouvez utiliser un filtre d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="4217b-168">You can use subscription filtering to achieve this.</span></span> <span data-ttu-id="4217b-169">Remarque : lorsque les terminaux de PDV publient des messages, la propriété de l’application **StoreName** est définie dans le message.</span><span class="sxs-lookup"><span data-stu-id="4217b-169">Note that when the POS terminals publish messages, they set the **StoreName** application property on the message.</span></span> <span data-ttu-id="4217b-170">Prenons deux magasins, par exemple **Redmond** et **Seattle**. Les terminaux de PDV du magasin de Redmond estampillent leurs messages de données de ventes avec un **StoreName** égal à **Redmond**. Les terminaux de PDV du magasin de Seattle, quant à eux, utilisent un **StoreName** égal à **Seattle**.</span><span class="sxs-lookup"><span data-stu-id="4217b-170">Given two stores, for example **Redmond** and **Seattle**, the POS terminals in the Redmond store stamp their sales data messages with a **StoreName** equal to **Redmond**, whereas the Seattle store POS terminals use a **StoreName** equal to **Seattle**.</span></span> <span data-ttu-id="4217b-171">Le responsable de magasin de Redmond souhaite accéder uniquement aux données recueillies à partir de ses terminaux de PDV.</span><span class="sxs-lookup"><span data-stu-id="4217b-171">The store manager of the Redmond store only wants to see data from its POS terminals.</span></span> <span data-ttu-id="4217b-172">Le système se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="4217b-172">The system appears as follows:</span></span>

![Service-Bus4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="4217b-174">Pour configurer ce routage, vous créez l’abonnement **Tableau de bord** de la façon suivante :</span><span class="sxs-lookup"><span data-stu-id="4217b-174">To set up this routing, you create the **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="4217b-175">Avec ce [filtre d’abonnement](/dotnet/api/microsoft.servicebus.messaging.sqlfilter) en place, seuls les messages dont la propriété **StoreName** est définie sur **Redmond** sont copiés vers la file d’attente virtuelle de l’abonnement **Tableau de bord**.</span><span class="sxs-lookup"><span data-stu-id="4217b-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have the **StoreName** property set to **Redmond** will be copied to the virtual queue for the **Dashboard** subscription.</span></span> <span data-ttu-id="4217b-176">Le filtrage ne s’arrête pas aux abonnements, loin de là.</span><span class="sxs-lookup"><span data-stu-id="4217b-176">There is much more to subscription filtering, however.</span></span> <span data-ttu-id="4217b-177">Les applications peuvent présenter plusieurs règles de filtre par abonnement, ainsi que la possibilité de modifier les propriétés d’un message lorsqu’il passe dans la file d’attente virtuelle d’un abonnement.</span><span class="sxs-lookup"><span data-stu-id="4217b-177">Applications can have multiple filter rules per subscription in addition to the ability to modify the properties of a message as it passes to a subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="4217b-178">Résumé</span><span class="sxs-lookup"><span data-stu-id="4217b-178">Summary</span></span>
<span data-ttu-id="4217b-179">Toutes les raisons d’utiliser la mise en file d’attente décrites dans [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md) s’appliquent également aux rubriques, en particulier :</span><span class="sxs-lookup"><span data-stu-id="4217b-179">All of the reasons to use queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply to topics, specifically:</span></span>

* <span data-ttu-id="4217b-180">Découplage temporel : les producteurs et les consommateurs de messages n'ont pas besoin d'être en ligne en même temps.</span><span class="sxs-lookup"><span data-stu-id="4217b-180">Temporal decoupling – message producers and consumers do not have to be online at the same time.</span></span>
* <span data-ttu-id="4217b-181">Niveau de charge : les pics de charge sont apaisés par la rubrique qui permet aux applications consommatrices d’être configurées pour une charge moyenne au lieu de pics de charge.</span><span class="sxs-lookup"><span data-stu-id="4217b-181">Load leveling – peaks in load are smoothed out by the topic enabling consuming applications to be provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="4217b-182">Équilibrage de la charge : semblable à une file d’attente, plusieurs consommateurs concurrents peuvent être à l’écoute sur un seul abonnement. Dans ce contexte, chaque message est transmis à un seul des consommateurs, équilibrant ainsi la charge.</span><span class="sxs-lookup"><span data-stu-id="4217b-182">Load balancing – similar to a queue, you can have multiple competing consumers listening on a single subscription, with each message handed off to only one of the consumers, thereby balancing load.</span></span>
* <span data-ttu-id="4217b-183">Couplage faible : vous pouvez faire évoluer le réseau de messagerie sans incidence sur les points de terminaison existants ; par exemple, ajoutez des abonnements ou modifiez des filtres dans une rubrique pour permettre l’ajout de nouveaux consommateurs.</span><span class="sxs-lookup"><span data-stu-id="4217b-183">Loose coupling – you can evolve the messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters to a topic to allow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4217b-184">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="4217b-184">Next steps</span></span>

<span data-ttu-id="4217b-185">Consultez [Création d’applications qui utilisent les files d’attente Service Bus](service-bus-create-queues.md) pour obtenir des informations sur l’utilisation des files d’attente dans le scénario de vente au détail de PDV.</span><span class="sxs-lookup"><span data-stu-id="4217b-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how to use queues in the POS retail scenario.</span></span>

