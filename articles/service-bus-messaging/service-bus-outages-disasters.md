---
title: Protection des applications Azure Service Bus contre les pannes et les sinistres | Microsoft Docs
description: "Décrit les techniques que vous pouvez utiliser pour protéger les applications contre une panne Service Bus potentielle."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="53b0a-103">Meilleures pratiques pour protéger les applications contre les pannes de Service Bus et les sinistres</span><span class="sxs-lookup"><span data-stu-id="53b0a-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="53b0a-104">Les applications stratégiques doivent fonctionner en permanence, même en cas de pannes non planifiées ou de sinistres.</span><span class="sxs-lookup"><span data-stu-id="53b0a-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="53b0a-105">Cette rubrique décrit les techniques que vous pouvez utiliser pour protéger les applications Service Bus contre une panne ou un sinistre potentiel.</span><span class="sxs-lookup"><span data-stu-id="53b0a-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="53b0a-106">Une panne est définie comme l'indisponibilité temporaire d'Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="53b0a-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="53b0a-107">La panne peut affecter certains composants de Service Bus, comme une banque de messagerie ou même le centre de données entier.</span><span class="sxs-lookup"><span data-stu-id="53b0a-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="53b0a-108">Une fois le problème résolu, Service Bus redevient disponible.</span><span class="sxs-lookup"><span data-stu-id="53b0a-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="53b0a-109">En règle générale, une panne n'entraîne pas la perte de messages ou autres données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="53b0a-110">L'indisponibilité d'une banque de messagerie spécifique constitue un exemple de défaillance d'un composant.</span><span class="sxs-lookup"><span data-stu-id="53b0a-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="53b0a-111">Une panne d'alimentation ou un commutateur réseau défaillant constituent des exemples de panne au niveau du centre de données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="53b0a-112">Une panne peut durer de quelques minutes à plusieurs jours.</span><span class="sxs-lookup"><span data-stu-id="53b0a-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="53b0a-113">Un sinistre est défini comme la perte définitive d'une unité d'échelle ou d'un centre de données Service Bus.</span><span class="sxs-lookup"><span data-stu-id="53b0a-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="53b0a-114">Le centre de données peut devenir disponible à nouveau ou pas.</span><span class="sxs-lookup"><span data-stu-id="53b0a-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="53b0a-115">En général, un sinistre provoque la perte d'une partie ou de l'ensemble des messages ou autres données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="53b0a-116">Les incendies, les inondations ou les tremblements de terre sont des exemples de sinistres.</span><span class="sxs-lookup"><span data-stu-id="53b0a-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="53b0a-117">Architecture actuelle</span><span class="sxs-lookup"><span data-stu-id="53b0a-117">Current architecture</span></span>
<span data-ttu-id="53b0a-118">Service Bus utilise plusieurs banques de messagerie pour stocker les messages sont envoyés à des files d’attente ou des rubriques.</span><span class="sxs-lookup"><span data-stu-id="53b0a-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="53b0a-119">Une file d’attente ou une rubrique non partitionnée est affectée à une banque de messagerie.</span><span class="sxs-lookup"><span data-stu-id="53b0a-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="53b0a-120">Si cette banque de messagerie n’est pas disponible, toutes les opérations sur cette file d’attente ou rubrique échoueront.</span><span class="sxs-lookup"><span data-stu-id="53b0a-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="53b0a-121">Toutes les entités de messagerie Service Bus (files d’attente, rubriques, relais) résident dans un espace de noms de service, qui est affilié à un centre de données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="53b0a-122">Service Bus ne permet pas la géo-réplication automatique des données et ne permet pas non plus qu’un espace de noms couvre plusieurs centres de données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="53b0a-123">Protection contre les pannes ACS</span><span class="sxs-lookup"><span data-stu-id="53b0a-123">Protecting against ACS outages</span></span>
<span data-ttu-id="53b0a-124">Si vous utilisez des informations d'identification ACS et si ACS devient indisponible, les clients ne peuvent plus obtenir de jetons.</span><span class="sxs-lookup"><span data-stu-id="53b0a-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="53b0a-125">Les clients qui ont un jeton au moment où ACS tombe en panne peuvent continuer à utiliser Service Bus jusqu'à ce que les jetons expirent.</span><span class="sxs-lookup"><span data-stu-id="53b0a-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="53b0a-126">La durée de vie par défaut d'un jeton est de 3 heures.</span><span class="sxs-lookup"><span data-stu-id="53b0a-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="53b0a-127">Pour vous protéger contre les pannes ACS, utilisez des jetons SAS (Signature d'accès partagé).</span><span class="sxs-lookup"><span data-stu-id="53b0a-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="53b0a-128">Dans ce cas, le client s'authentifie directement auprès de Service Bus en signant un jeton auto-émis avec une clé secrète.</span><span class="sxs-lookup"><span data-stu-id="53b0a-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="53b0a-129">Les appels aux services ACS ne sont plus nécessaires.</span><span class="sxs-lookup"><span data-stu-id="53b0a-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="53b0a-130">Pour plus d’informations sur les jetons SAS, consultez [Authentification Service Bus][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="53b0a-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="53b0a-131">Protection des files d’attente et des rubriques contre les défaillances de la banque de messagerie</span><span class="sxs-lookup"><span data-stu-id="53b0a-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="53b0a-132">Une file d’attente ou une rubrique non partitionnée est affectée à une banque de messagerie.</span><span class="sxs-lookup"><span data-stu-id="53b0a-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="53b0a-133">Si cette banque de messagerie n’est pas disponible, toutes les opérations sur cette file d’attente ou rubrique échoueront.</span><span class="sxs-lookup"><span data-stu-id="53b0a-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="53b0a-134">D'autre part, une file d'attente partitionnée est constituée de plusieurs fragments.</span><span class="sxs-lookup"><span data-stu-id="53b0a-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="53b0a-135">Chaque fragment est stocké dans une banque de messagerie différente.</span><span class="sxs-lookup"><span data-stu-id="53b0a-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="53b0a-136">Lorsqu’un message est envoyé à une file d’attente ou une rubrique partitionnée, Service Bus affecte le message à l’un des fragments.</span><span class="sxs-lookup"><span data-stu-id="53b0a-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="53b0a-137">Si la banque de messagerie correspondante n'est pas disponible, Service Bus écrit le message dans un fragment différent, si possible.</span><span class="sxs-lookup"><span data-stu-id="53b0a-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="53b0a-138">Pour plus d’informations sur les entités partitionnées, consultez [Files d’attente et rubriques partitionnées][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="53b0a-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="53b0a-139">Protection contre les pannes ou les sinistres du centre de données</span><span class="sxs-lookup"><span data-stu-id="53b0a-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="53b0a-140">Pour permettre un basculement entre deux centres de données, vous pouvez créer un espace de noms de service Service Bus dans chaque centre de données.</span><span class="sxs-lookup"><span data-stu-id="53b0a-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="53b0a-141">Par exemple, l’espace de noms de service Service Bus **contosoPrimary.servicebus.windows.net** peut se trouver dans la région États-Unis (Nord/Centre) et **contosoSecondary.servicebus.windows.net** peut se trouver dans la région États-Unis (Sud/Centre).</span><span class="sxs-lookup"><span data-stu-id="53b0a-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="53b0a-142">Si une entité de messagerie Service Bus doit rester accessible en cas de panne du centre de données, vous pouvez créer cette entité dans les deux espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="53b0a-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="53b0a-143">Pour plus d’informations, consultez la section « Échec de Service Bus dans un centre de données Azure » sous [Modèles de messagerie asynchrone et haute disponibilité][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="53b0a-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="53b0a-144">Protection des points de terminaison de relais contre les pannes ou les sinistres du centre de données</span><span class="sxs-lookup"><span data-stu-id="53b0a-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="53b0a-145">La géo-réplication des points de terminaison de relais permet à un service qui expose un point de terminaison de relais d'être accessible en cas de pannes de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="53b0a-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="53b0a-146">Pour obtenir la géo-réplication, le service doit créer deux points de terminaison de relais dans des espaces de noms différents.</span><span class="sxs-lookup"><span data-stu-id="53b0a-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="53b0a-147">Les espaces de noms doivent résider dans des centres de données différents et les deux points de terminaison doivent avoir des noms différents.</span><span class="sxs-lookup"><span data-stu-id="53b0a-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="53b0a-148">Par exemple, un point de terminaison principal peut être accessible sous **contosoPrimary.servicebus.windows.net/myPrimaryService**, alors que son homologue secondaire peut être accessible sous **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="53b0a-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="53b0a-149">Le service écoute alors sur les deux points de terminaison et un client peut appeler le service par le biais de n'importe quel point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="53b0a-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="53b0a-150">Une application cliente choisit de façon aléatoire l'un des relais en tant que point de terminaison principal et envoie sa requête au point de terminaison actif.</span><span class="sxs-lookup"><span data-stu-id="53b0a-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="53b0a-151">Si l'opération échoue avec un code d'erreur, cette défaillance indique que le point de terminaison de relais n'est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="53b0a-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="53b0a-152">L'application ouvre un canal vers le point de terminaison de sauvegarde et soumet la requête à nouveau.</span><span class="sxs-lookup"><span data-stu-id="53b0a-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="53b0a-153">À ce stade, les points de terminaison actif et de sauvegarde permutent leurs rôles : l'application cliente considère l'ancien point de terminaison actif comme nouveau point de terminaison de sauvegarde, et l'ancien point de terminaison de sauvegarde comme nouveau point de terminaison actif.</span><span class="sxs-lookup"><span data-stu-id="53b0a-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="53b0a-154">Si les deux opérations d'envoi échouent, les rôles des deux entités restent inchangés et une erreur est renvoyée.</span><span class="sxs-lookup"><span data-stu-id="53b0a-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="53b0a-155">L’exemple [Géo-réplication avec la messagerie par relais Service Bus][Geo-replication with Service Bus relayed Messages] montre comment répliquer des relais.</span><span class="sxs-lookup"><span data-stu-id="53b0a-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="53b0a-156">Protection des files d’attente et des rubriques contre les pannes ou les sinistres du centre de données</span><span class="sxs-lookup"><span data-stu-id="53b0a-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="53b0a-157">Pour obtenir une résilience contre les pannes du centre de données lors de l’utilisation de la messagerie répartie, Service Bus prend en charge deux approches : la réplication *active* et *passive*.</span><span class="sxs-lookup"><span data-stu-id="53b0a-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="53b0a-158">Pour chaque approche, si une file d’attente ou une rubrique donnée doit rester accessible en cas de panne du centre de données, vous pouvez la créer dans les deux espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="53b0a-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="53b0a-159">Les deux entités peuvent avoir le même nom.</span><span class="sxs-lookup"><span data-stu-id="53b0a-159">Both entities can have the same name.</span></span> <span data-ttu-id="53b0a-160">Par exemple, une file d’attente principale peut être accessible sous **contosoPrimary.servicebus.windows.net/myQueue**, alors que son homologue secondaire peut être accessible sous **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="53b0a-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="53b0a-161">Si l'application ne nécessite pas une communication permanente entre l'expéditeur et le destinataire, l'application peut implémenter une file d'attente côté client durable pour empêcher la perte de messages et protéger l'expéditeur contre toute erreur Service Bus temporaire.</span><span class="sxs-lookup"><span data-stu-id="53b0a-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="53b0a-162">Réplication active</span><span class="sxs-lookup"><span data-stu-id="53b0a-162">Active replication</span></span>
<span data-ttu-id="53b0a-163">La réplication active utilise des entités dans les deux espaces de noms pour chaque opération.</span><span class="sxs-lookup"><span data-stu-id="53b0a-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="53b0a-164">Tout client qui envoie un message envoie deux copies du même message.</span><span class="sxs-lookup"><span data-stu-id="53b0a-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="53b0a-165">La première copie est envoyée à l’entité principale (par exemple, **contosoPrimary.servicebus.windows.net/sales**) et la deuxième copie du message est envoyée à l’entité secondaire (par exemple, **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="53b0a-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="53b0a-166">Un client reçoit des messages des deux files d'attente.</span><span class="sxs-lookup"><span data-stu-id="53b0a-166">A client receives messages from both queues.</span></span> <span data-ttu-id="53b0a-167">Le destinataire traite la première copie d'un message et la deuxième copie est supprimée.</span><span class="sxs-lookup"><span data-stu-id="53b0a-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="53b0a-168">Pour supprimer les messages en double, l'expéditeur doit attribuer un identificateur unique à chaque message.</span><span class="sxs-lookup"><span data-stu-id="53b0a-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="53b0a-169">Les deux copies du message doivent avoir le même identificateur.</span><span class="sxs-lookup"><span data-stu-id="53b0a-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="53b0a-170">Vous pouvez utiliser les propriétés [BrokeredMessage.MessageId][BrokeredMessage.MessageId] ou [BrokeredMessage.Label][BrokeredMessage.Label] ou une propriété personnalisée, pour baliser le message.</span><span class="sxs-lookup"><span data-stu-id="53b0a-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="53b0a-171">Le destinataire doit conserver une liste des messages qu'il a déjà reçus.</span><span class="sxs-lookup"><span data-stu-id="53b0a-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="53b0a-172">L’exemple [Géo-réplication avec la messagerie répartie de Service Bus][Geo-replication with Service Bus Brokered Messages] illustre la réplication active des entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="53b0a-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="53b0a-173">L'approche de réplication active double le nombre d'opérations ; par conséquent, cette approche peut mener à un coût plus élevé.</span><span class="sxs-lookup"><span data-stu-id="53b0a-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="53b0a-174">Réplication passive</span><span class="sxs-lookup"><span data-stu-id="53b0a-174">Passive replication</span></span>
<span data-ttu-id="53b0a-175">En cas d'absence de panne, la réplication passive n'utilise qu'une seule des deux entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="53b0a-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="53b0a-176">Un client envoie le message à l'entité active.</span><span class="sxs-lookup"><span data-stu-id="53b0a-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="53b0a-177">Si l'opération sur l'entité active échoue avec un code d'erreur qui indique que le centre de données qui héberge l'entité active n'est pas disponible, le client envoie une copie du message à l'entité de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="53b0a-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="53b0a-178">À ce stade, les entités active et de sauvegarde permutent leurs rôles : le client en charge de l'envoi considère l'ancienne entité active comme nouvelle entité de sauvegarde, et l'ancienne entité de sauvegarde comme nouvelle entité active.</span><span class="sxs-lookup"><span data-stu-id="53b0a-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="53b0a-179">Si les deux opérations d'envoi échouent, les rôles des deux entités restent inchangés et une erreur est renvoyée.</span><span class="sxs-lookup"><span data-stu-id="53b0a-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="53b0a-180">Un client reçoit des messages des deux files d'attente.</span><span class="sxs-lookup"><span data-stu-id="53b0a-180">A client receives messages from both queues.</span></span> <span data-ttu-id="53b0a-181">Étant donné qu'il est possible que le destinataire reçoive deux copies du même message, le destinataire doit supprimer les messages en double.</span><span class="sxs-lookup"><span data-stu-id="53b0a-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="53b0a-182">Vous pouvez supprimer les doublons de la même façon que celle décrite pour la réplication active.</span><span class="sxs-lookup"><span data-stu-id="53b0a-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="53b0a-183">En général, la réplication passive est moins onéreuse que la réplication active, car dans la plupart des cas, une seule opération est effectuée.</span><span class="sxs-lookup"><span data-stu-id="53b0a-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="53b0a-184">La latence, le débit et le coût monétaire sont identiques au scénario de la non réplication.</span><span class="sxs-lookup"><span data-stu-id="53b0a-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="53b0a-185">Lorsque vous utilisez la réplication passive, les messages peuvent être perdus ou reçus deux fois, dans les scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="53b0a-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="53b0a-186">**Retard ou perte de message**: supposons que l'expéditeur a envoyé avec succès un message m1 à la file d'attente principale, et qu'ensuite la file d'attente devient indisponible avant que le destinataire ne reçoive m1.</span><span class="sxs-lookup"><span data-stu-id="53b0a-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="53b0a-187">L'expéditeur envoie un message ultérieur m2 à la file d'attente secondaire.</span><span class="sxs-lookup"><span data-stu-id="53b0a-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="53b0a-188">Si la file d'attente principale est temporairement indisponible, le destinataire reçoit m1 lorsque la file d'attente est à nouveau disponible.</span><span class="sxs-lookup"><span data-stu-id="53b0a-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="53b0a-189">En cas de sinistre, le destinataire peut ne jamais recevoir m1.</span><span class="sxs-lookup"><span data-stu-id="53b0a-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="53b0a-190">**Réception de doublons**: supposons que l'expéditeur envoie un message m à la file d'attente principale.</span><span class="sxs-lookup"><span data-stu-id="53b0a-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="53b0a-191">Service Bus traite m avec succès mais ne parvient pas à envoyer une réponse.</span><span class="sxs-lookup"><span data-stu-id="53b0a-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="53b0a-192">Après expiration de l'opération d'envoi, l'expéditeur envoie une copie identique de m à la file d'attente secondaire.</span><span class="sxs-lookup"><span data-stu-id="53b0a-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="53b0a-193">Si le destinataire peut recevoir la première copie de m avant que la file d'attente principale ne devienne indisponible, le destinataire reçoit les deux copies de m approximativement au même moment.</span><span class="sxs-lookup"><span data-stu-id="53b0a-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="53b0a-194">Si le destinataire ne peut pas recevoir la première copie de m avant que la file d'attente principale ne devienne indisponible, le destinataire ne reçoit initialement que la deuxième copie de m, mais reçoit ensuite une deuxième copie de m lorsque la file d'attente principale devient disponible.</span><span class="sxs-lookup"><span data-stu-id="53b0a-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="53b0a-195">L’exemple [Géo-réplication avec la messagerie répartie de Service Bus][Geo-replication with Service Bus Brokered Messages] illustre la réplication passive des entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="53b0a-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="53b0a-196">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="53b0a-196">Next steps</span></span>
<span data-ttu-id="53b0a-197">Pour plus d'informations sur la récupération d'urgence, consultez les articles suivants :</span><span class="sxs-lookup"><span data-stu-id="53b0a-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="53b0a-198">[Continuité de l’activité Azure SQL Database][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="53b0a-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="53b0a-199">[Conception d’applications résilientes pour Azure][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="53b0a-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency
