---
title: Messagerie asynchrone Service Bus | Microsoft Docs
description: Description de la messagerie asynchrone Azure Service Bus.
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 95d6f295ba145a55fe4ed3fc7c6f627c9d419a3c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="5fa23-103">Modèles de messagerie asynchrone et haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="5fa23-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="5fa23-104">Une messagerie asynchrone peut être mise en œuvre de différentes façons.</span><span class="sxs-lookup"><span data-stu-id="5fa23-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="5fa23-105">Avec les files d’attente, rubriques et abonnements, Azure Service Bus prend en charge des opérations asynchrones en utilisant un mécanisme de stockage et de transfert.</span><span class="sxs-lookup"><span data-stu-id="5fa23-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="5fa23-106">En cas de fonctionnement normal (synchrone), des messages sont envoyés à des files d’attente et des rubriques et vous recevez des messages de la part de files d’attente et d’abonnements.</span><span class="sxs-lookup"><span data-stu-id="5fa23-106">In normal (synchronous) operation, you send messages to queues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="5fa23-107">Les applications que vous rédigez dépendent de la disponibilité permanente de ces entités.</span><span class="sxs-lookup"><span data-stu-id="5fa23-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="5fa23-108">Lorsque, suite à certaines circonstances, l’état de l’entité change, vous devez disposer d’une entité à fonctionnalités réduites pouvant satisfaire la plupart des besoins.</span><span class="sxs-lookup"><span data-stu-id="5fa23-108">When the entity health changes, due to a variety of circumstances, you need a way to provide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="5fa23-109">Les applications utilisent en général des modèles de messagerie asynchrones autorisant un certain nombre de scénarios de communication.</span><span class="sxs-lookup"><span data-stu-id="5fa23-109">Applications typically use asynchronous messaging patterns to enable a number of communication scenarios.</span></span> <span data-ttu-id="5fa23-110">Vous pouvez créer des applications dans lesquelles les clients peuvent envoyer des messages aux services, même si le service n’est pas en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="5fa23-110">You can build applications in which clients can send messages to services, even when the service is not running.</span></span> <span data-ttu-id="5fa23-111">Pour les applications soumises à des pics de communication, une file d’attente peut permettre de répartir la charge en fournissant un emplacement pour mettre les communications en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="5fa23-111">For applications that experience bursts of communications, a queue can help level the load by providing a place to buffer communications.</span></span> <span data-ttu-id="5fa23-112">Enfin, vous avez accès à un équilibreur de charge simple mais efficace pour distribuer les messages sur plusieurs ordinateurs.</span><span class="sxs-lookup"><span data-stu-id="5fa23-112">Finally, you can get a simple but effective load balancer to distribute messages across multiple machines.</span></span>

<span data-ttu-id="5fa23-113">Pour maintenir la disponibilité de toutes ces entités, vous devez trouver des moyens de faire apparaître ces entités comme indisponibles pour un système de messagerie durable.</span><span class="sxs-lookup"><span data-stu-id="5fa23-113">In order to maintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="5fa23-114">En règle générale, l’entité devient indisponible pour les applications que nous écrivons pour différentes raisons :</span><span class="sxs-lookup"><span data-stu-id="5fa23-114">Generally speaking, we see the entity become unavailable to applications we write in the following different ways:</span></span>

* <span data-ttu-id="5fa23-115">Impossible d’envoyer des messages</span><span class="sxs-lookup"><span data-stu-id="5fa23-115">Unable to send messages.</span></span>
* <span data-ttu-id="5fa23-116">Impossible de recevoir des messages</span><span class="sxs-lookup"><span data-stu-id="5fa23-116">Unable to receive messages.</span></span>
* <span data-ttu-id="5fa23-117">Impossible de gérer (créer, récupérer, mettre à jour ou supprimer) des entités.</span><span class="sxs-lookup"><span data-stu-id="5fa23-117">Unable to manage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="5fa23-118">Impossible de contacter le service.</span><span class="sxs-lookup"><span data-stu-id="5fa23-118">Unable to contact the service.</span></span>

<span data-ttu-id="5fa23-119">Pour chacune de ces erreurs, différents modes d’échec existent et permettent à une application de continuer de fonctionner à un niveau de fonctionnalités limité.</span><span class="sxs-lookup"><span data-stu-id="5fa23-119">For each of these failures, different failure modes exist that enable an application to continue to perform work at some level of reduced capability.</span></span> <span data-ttu-id="5fa23-120">Par exemple, un système qui peut envoyer des messages mais pas de les recevoir peut encore recevoir des commandes des clients, mais ne peut pas traiter ces commandes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="5fa23-121">Cette rubrique aborde les problèmes qui peuvent se présenter et explique comment y remédier.</span><span class="sxs-lookup"><span data-stu-id="5fa23-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="5fa23-122">Service Bus présente un certain nombre de mesures d’atténuation à votre disposition, et cette rubrique traite également des règles régissant l’utilisation de ces actions.</span><span class="sxs-lookup"><span data-stu-id="5fa23-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses the rules governing the use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="5fa23-123">Fiabilité de Service Bus</span><span class="sxs-lookup"><span data-stu-id="5fa23-123">Reliability in Service Bus</span></span>
<span data-ttu-id="5fa23-124">Il existe plusieurs méthodes permettant de gérer les problèmes de messagerie et d’entités et certaines instructions régissent l’utilisation appropriée de ces actions de correction.</span><span class="sxs-lookup"><span data-stu-id="5fa23-124">There are several ways to handle message and entity issues, and there are guidelines governing the appropriate use of those mitigations.</span></span> <span data-ttu-id="5fa23-125">Pour comprendre ces instructions, vous devez d’abord connaître les défaillances susceptibles de se produire dans Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5fa23-125">To understand the guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="5fa23-126">En raison de la conception des systèmes Azure, tous ces problèmes sont en général éphémères.</span><span class="sxs-lookup"><span data-stu-id="5fa23-126">Due to the design of Azure systems, all of these issues tend to be short-lived.</span></span> <span data-ttu-id="5fa23-127">À un niveau élevé, les différentes causes d’indisponibilité sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="5fa23-127">At a high level, the different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="5fa23-128">Limitation d’un système externe dont Service Bus dépend.</span><span class="sxs-lookup"><span data-stu-id="5fa23-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="5fa23-129">La limitation se produit à la suite d’interactions avec les ressources de stockage et de calcul.</span><span class="sxs-lookup"><span data-stu-id="5fa23-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="5fa23-130">Problème d’un système dont Service Bus dépend.</span><span class="sxs-lookup"><span data-stu-id="5fa23-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="5fa23-131">Par exemple, une partie donnée du stockage peut rencontrer des problèmes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="5fa23-132">Défaillance de Service Bus dans un sous-système unique</span><span class="sxs-lookup"><span data-stu-id="5fa23-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="5fa23-133">Dans ce cas, un nœud de calcul peut passer à l’état incohérent et redémarrer seul, ce qui fait que toutes les entités desservies doivent équilibrer leur charge sur d’autres nœuds.</span><span class="sxs-lookup"><span data-stu-id="5fa23-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves to load balance to other nodes.</span></span> <span data-ttu-id="5fa23-134">Pendant un bref laps de temps, le traitement des messages peut se trouver ralenti.</span><span class="sxs-lookup"><span data-stu-id="5fa23-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="5fa23-135">Échec de Service Bus dans un centre de données Azure.</span><span class="sxs-lookup"><span data-stu-id="5fa23-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="5fa23-136">Il s’agit d’une « défaillance irrémédiable », et le système reste inaccessible pendant plusieurs minutes, voire quelques heures.</span><span class="sxs-lookup"><span data-stu-id="5fa23-136">This is a "catastrophic failure" during which the system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="5fa23-137">Le terme **stockage** peut désigner le stockage Azure et SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="5fa23-137">The term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="5fa23-138">Service Bus propose un certain nombre de mesures d’atténuation des problèmes mentionnés ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="5fa23-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="5fa23-139">Les sections suivantes décrivent chaque problème et les actions correctives correspondantes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-139">The following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="5fa23-140">Limitation</span><span class="sxs-lookup"><span data-stu-id="5fa23-140">Throttling</span></span>
<span data-ttu-id="5fa23-141">Avec Service Bus, la limitation permet une gestion coopérative de la vitesse des messages.</span><span class="sxs-lookup"><span data-stu-id="5fa23-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="5fa23-142">Chaque nœud Service Bus héberge de nombreuses entités.</span><span class="sxs-lookup"><span data-stu-id="5fa23-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="5fa23-143">Chacune de ces entités effectue des demandes sur le système en termes de processeur, de mémoire, de stockage et autres.</span><span class="sxs-lookup"><span data-stu-id="5fa23-143">Each of those entities makes demands on the system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="5fa23-144">Lorsqu’une de ces facettes détecte une utilisation dépassant les seuils définis, Service Bus peut refuser une demande donnée.</span><span class="sxs-lookup"><span data-stu-id="5fa23-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="5fa23-145">L’appelant reçoit alors une exception [ServerBusyException][ServerBusyException] et refait une tentative après 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-145">The caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="5fa23-146">Pour remédier au problème, le code doit lire l’erreur et stopper toute nouvelle tentative du message pendant au moins 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-146">As a mitigation, the code must read the error and halt any retries of the message for at least 10 seconds.</span></span> <span data-ttu-id="5fa23-147">Dans la mesure où l’erreur peut se produire sur différents éléments de l’application client, chaque élément doit exécuter la nouvelle tentative de manière indépendante.</span><span class="sxs-lookup"><span data-stu-id="5fa23-147">Since the error can happen across pieces of the customer application, it is expected that each piece independently executes the retry logic.</span></span> <span data-ttu-id="5fa23-148">Le code peut réduire la probabilité de limitation en activant le partitionnement sur une file d’attente ou une rubrique.</span><span class="sxs-lookup"><span data-stu-id="5fa23-148">The code can reduce the probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="5fa23-149">Problème sur une dépendance Azure</span><span class="sxs-lookup"><span data-stu-id="5fa23-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="5fa23-150">D’autres composants dans Azure peuvent parfois rencontrer des problèmes de service.</span><span class="sxs-lookup"><span data-stu-id="5fa23-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="5fa23-151">Par exemple, lorsqu’un système Service Bus est en cours de mise à niveau, ce système peut provisoirement présenter des fonctionnalités réduites.</span><span class="sxs-lookup"><span data-stu-id="5fa23-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="5fa23-152">Pour résoudre ces types de problèmes, Service Bus procède régulièrement à des analyses et met en œuvre les solutions de correction.</span><span class="sxs-lookup"><span data-stu-id="5fa23-152">To work around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="5fa23-153">Des effets secondaires de ces mesures de correction peuvent apparaître.</span><span class="sxs-lookup"><span data-stu-id="5fa23-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="5fa23-154">Par exemple, pour gérer les problèmes temporaires liés au stockage, Service Bus fait appel à un système qui permet aux opérations d’envoi de message de continuer de fonctionner manière cohérente.</span><span class="sxs-lookup"><span data-stu-id="5fa23-154">For example, to handle transient issues with storage, Service Bus implements a system that allows message send operations to work consistently.</span></span> <span data-ttu-id="5fa23-155">En raison de la nature de cette mesure de correction, un message envoyé peut prendre jusqu’à 15 minutes pour apparaître dans la file d’attente ou l’abonnement affecté et être prêt pour une opération de réception.</span><span class="sxs-lookup"><span data-stu-id="5fa23-155">Due to the nature of the mitigation, a sent message can take up to 15 minutes to appear in the affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="5fa23-156">En règle générale, la plupart des entités ne rencontrent pas ce problème.</span><span class="sxs-lookup"><span data-stu-id="5fa23-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="5fa23-157">Toutefois, étant donné le nombre d’entités présentes dans Service Bus au sein d’Azure, cette opération est parfois nécessaire pour un petit sous-ensemble de clients de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5fa23-157">However, given the number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="5fa23-158">Défaillance Service Bus dans un sous-système unique</span><span class="sxs-lookup"><span data-stu-id="5fa23-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="5fa23-159">Quelle que soit l’application, les circonstances peuvent générer une défaillance chez un composant interne de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5fa23-159">With any application, circumstances can cause an internal component of Service Bus to become inconsistent.</span></span> <span data-ttu-id="5fa23-160">Lorsque Service Bus détecte cela, il rassemble les données de l’application pour vous aider à diagnostiquer ce qui est arrivé.</span><span class="sxs-lookup"><span data-stu-id="5fa23-160">When Service Bus detects this, it collects data from the application to aid in diagnosing what happened.</span></span> <span data-ttu-id="5fa23-161">Une fois les données collectées, l’application est redémarrée afin de revenir à un état cohérent.</span><span class="sxs-lookup"><span data-stu-id="5fa23-161">Once the data is collected, the application is restarted in an attempt to return it to a consistent state.</span></span> <span data-ttu-id="5fa23-162">Ce processus est assez rapidement et peut faire en sorte qu’une entité semble indisponible pendant quelques minutes, bien que les interruptions de service par défaut soient beaucoup plus courtes.</span><span class="sxs-lookup"><span data-stu-id="5fa23-162">This process happens fairly quickly, and results in an entity appearing to be unavailable for up to a few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="5fa23-163">Dans ce cas, l’application cliente génère une exception [System.TimeoutException][System.TimeoutException] ou [MessagingException][MessagingException].</span><span class="sxs-lookup"><span data-stu-id="5fa23-163">In these cases, the client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="5fa23-164">Service Bus contient un correctif pour ce problème sous la forme d’un programme de nouvelle tentative cliente automatisée.</span><span class="sxs-lookup"><span data-stu-id="5fa23-164">Service Bus contains a mitigation for this issue in the form of automated client retry logic.</span></span> <span data-ttu-id="5fa23-165">Une fois la période de nouvelle tentative épuisée, si le message n’est pas remis, vous pouvez entamer des recherches à l’aide d’autres fonctionnalités, par exemple, les [espaces de noms associés][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="5fa23-165">Once the retry period is exhausted and the message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="5fa23-166">Les espaces de noms associés génèrent d’autres notifications, qui sont abordées dans cet article.</span><span class="sxs-lookup"><span data-stu-id="5fa23-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="5fa23-167">Panne de Service Bus dans un centre de données Azure.</span><span class="sxs-lookup"><span data-stu-id="5fa23-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="5fa23-168">La cause la plus probable de défaillance dans un centre de données Azure est l’échec du déploiement d’une mise à niveau de Service Bus ou d’un système dépendant.</span><span class="sxs-lookup"><span data-stu-id="5fa23-168">The most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="5fa23-169">Au fur et à mesure que la plateforme évolue, l’éventualité de ce type de panne diminue.</span><span class="sxs-lookup"><span data-stu-id="5fa23-169">As the platform has matured, the likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="5fa23-170">Une défaillance de centre de données peut également se produire pour les raisons suivantes :</span><span class="sxs-lookup"><span data-stu-id="5fa23-170">A datacenter failure can also happen for reasons that include the following:</span></span>

* <span data-ttu-id="5fa23-171">Panne électrique (l’alimentation électrique et les générateurs de courant sont interrompus).</span><span class="sxs-lookup"><span data-stu-id="5fa23-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="5fa23-172">Connectivité (interruption d’Internet entre vos clients et Azure).</span><span class="sxs-lookup"><span data-stu-id="5fa23-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="5fa23-173">Dans les deux cas, une catastrophe naturelle ou une erreur humaine a provoqué le problème.</span><span class="sxs-lookup"><span data-stu-id="5fa23-173">In both cases, a natural or man-made disaster caused the issue.</span></span> <span data-ttu-id="5fa23-174">Pour contourner ce problème et vous assurer que vous pouvez toujours envoyer des messages, vous pouvez utiliser des [espaces de noms associés][paired namespaces] pour acheminer les messages vers un second emplacement pendant la restauration de l’emplacement principal.</span><span class="sxs-lookup"><span data-stu-id="5fa23-174">To work around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] to enable messages to be sent to a second location while the primary location is made healthy again.</span></span> <span data-ttu-id="5fa23-175">Pour plus d’informations, consultez la section [Meilleures pratiques pour protéger les applications contre les pannes de Service Bus et les sinistres][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="5fa23-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="5fa23-176">Espaces de noms associés</span><span class="sxs-lookup"><span data-stu-id="5fa23-176">Paired namespaces</span></span>
<span data-ttu-id="5fa23-177">La fonctionnalité d’[espaces de noms associés][paired namespaces] prend en charge les scénarios dans lesquels une entité Service Bus ou un déploiement dans un centre de données n’est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="5fa23-177">The [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="5fa23-178">Bien qu’un tel événement soit rare, les systèmes distribués toujours doivent être préparés aux pires scénarios.</span><span class="sxs-lookup"><span data-stu-id="5fa23-178">While this event occurs infrequently, distributed systems still must be prepared to handle worst case scenarios.</span></span> <span data-ttu-id="5fa23-179">En règle générale, cet événement se produit lorsque certains éléments dont dépend Service Bus rencontrent un problème de courte durée.</span><span class="sxs-lookup"><span data-stu-id="5fa23-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="5fa23-180">Pour maintenir la disponibilité des applications pendant une panne, les utilisateurs de Service Bus peuvent utiliser deux espaces de noms différents, de préférence dans des centres de données distincts, pour héberger leurs entités de messagerie.</span><span class="sxs-lookup"><span data-stu-id="5fa23-180">To maintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, to host their messaging entities.</span></span> <span data-ttu-id="5fa23-181">Le reste de cette section utilise la terminologie suivante :</span><span class="sxs-lookup"><span data-stu-id="5fa23-181">The remainder of this section uses the following terminology:</span></span>

* <span data-ttu-id="5fa23-182">Espace de noms principal : espace de noms avec lequel l’application interagit pour envoyer et recevoir des opérations.</span><span class="sxs-lookup"><span data-stu-id="5fa23-182">Primary namespace: The namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="5fa23-183">Espace de noms secondaire : espace de noms servant de sauvegarde de l’espace de noms principal.</span><span class="sxs-lookup"><span data-stu-id="5fa23-183">Secondary namespace: The namespace that acts as a backup to the primary namespace.</span></span> <span data-ttu-id="5fa23-184">La logique d’application n’interagit pas avec cet espace de noms.</span><span class="sxs-lookup"><span data-stu-id="5fa23-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="5fa23-185">Intervalle de basculement : durée d’une panne permettant d’accepter les pannes normales avant que l’application bascule de l’espace de noms principal vers l’espace de noms secondaire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-185">Failover interval: The amount of time to accept normal failures before the application switches from the primary namespace to the secondary namespace.</span></span>

<span data-ttu-id="5fa23-186">Les espaces de noms associés prennent en charge la *disponibilité des fonctions d’envoi*.</span><span class="sxs-lookup"><span data-stu-id="5fa23-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="5fa23-187">La disponibilité des fonctions d’envoi maintient la possibilité d’envoyer des messages.</span><span class="sxs-lookup"><span data-stu-id="5fa23-187">Send availability preserves the ability to send messages.</span></span> <span data-ttu-id="5fa23-188">Pour utiliser la disponibilité d’envoi, votre application doit répondre aux exigences suivantes :</span><span class="sxs-lookup"><span data-stu-id="5fa23-188">To use send availability, your application must meet the following requirements:</span></span>

1. <span data-ttu-id="5fa23-189">Les messages sont reçus uniquement à partir de l’espace de noms principal.</span><span class="sxs-lookup"><span data-stu-id="5fa23-189">Messages are only received from the primary namespace.</span></span>
2. <span data-ttu-id="5fa23-190">Les messages envoyés à une file d’attente ou rubrique donnée peuvent arriver dans le désordre.</span><span class="sxs-lookup"><span data-stu-id="5fa23-190">Messages sent to a given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="5fa23-191">Les messages au sein d’une session peuvent arriver dans le désordre.</span><span class="sxs-lookup"><span data-stu-id="5fa23-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="5fa23-192">Ce comportement diffère du comportement normal des sessions.</span><span class="sxs-lookup"><span data-stu-id="5fa23-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="5fa23-193">Cela signifie que votre application utilise des sessions pour regrouper les messages de façon logique.</span><span class="sxs-lookup"><span data-stu-id="5fa23-193">This means that your application uses sessions to logically group messages.</span></span>
4. <span data-ttu-id="5fa23-194">L’état de la session est conservé uniquement au niveau de l’espace de noms principal.</span><span class="sxs-lookup"><span data-stu-id="5fa23-194">Session state is only maintained on the primary namespace.</span></span>
5. <span data-ttu-id="5fa23-195">La file d’attente principale peut se mettre en ligne et commencer à accepter des messages avant que la file d’attente secondaire ait placé tous les messages dans la file d’attente principale.</span><span class="sxs-lookup"><span data-stu-id="5fa23-195">The primary queue can come online and start accepting messages before the secondary queue delivers all messages into the primary queue.</span></span>

<span data-ttu-id="5fa23-196">Les sections suivantes décrivent les API, la façon dont les API sont implémentées et présente des exemples de code qui utilisent la fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="5fa23-196">The following sections discuss the APIs, how the APIs are implemented, and shows sample code that uses the feature.</span></span> <span data-ttu-id="5fa23-197">Notez que cette fonctionnalité est associée à des coûts.</span><span class="sxs-lookup"><span data-stu-id="5fa23-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="the-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="5fa23-198">API MessagingFactory.PairNamespaceAsync</span><span class="sxs-lookup"><span data-stu-id="5fa23-198">The MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="5fa23-199">La fonctionnalité d’espaces de noms associés inclut la méthode [PairNamespaceAsync][PairNamespaceAsync] sur la classe [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] :</span><span class="sxs-lookup"><span data-stu-id="5fa23-199">The paired namespaces feature includes the [PairNamespaceAsync][PairNamespaceAsync] method on the [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="5fa23-200">Lorsque la tâche est terminée, l’association de l’espace de noms se termine elle aussi et est prête à fonctionner pour chaque entité [MessageReceiver][MessageReceiver], [QueueClient][QueueClient] ou [TopicClient][TopicClient] créée avec l’instance [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="5fa23-200">When the task completes, the namespace pairing is also complete and ready to act upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with the [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="5fa23-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] est la classe de base correspondant aux différents types d’associations disponibles avec l’objet [MessagingFactory][MessagingFactory].</span><span class="sxs-lookup"><span data-stu-id="5fa23-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is the base class for the different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="5fa23-202">Actuellement, la seule classe dérivée est la classe nommée [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], qui met en œuvre les exigences associées à la disponibilité des envois.</span><span class="sxs-lookup"><span data-stu-id="5fa23-202">Currently, the only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements the send availability requirements.</span></span> <span data-ttu-id="5fa23-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] possède un ensemble de constructeurs qui s’appuient les uns sur les autres.</span><span class="sxs-lookup"><span data-stu-id="5fa23-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="5fa23-204">En examinant le constructeur comportant le plus grand nombre de paramètres, vous pouvez comprendre le comportement des autres constructeurs.</span><span class="sxs-lookup"><span data-stu-id="5fa23-204">Looking at the constructor with the most parameters, you can understand the behavior of the other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="5fa23-205">Ces paramètres ont les significations suivantes :</span><span class="sxs-lookup"><span data-stu-id="5fa23-205">These parameters have the following meanings:</span></span>

* <span data-ttu-id="5fa23-206">*secondaryNamespaceManager* : instance [NamespaceManager][NamespaceManager] initialisée pour l’espace de noms secondaire que la méthode [PairNamespaceAsync][PairNamespaceAsync] peut utiliser pour configurer l’espace de noms secondaire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for the secondary namespace that the [PairNamespaceAsync][PairNamespaceAsync] method can use to set up the secondary namespace.</span></span> <span data-ttu-id="5fa23-207">Le gestionnaire d’espaces de noms sera utilisé pour obtenir la liste des files d’attente dans l’espace de noms et s’assurer que les files d’attente backlog requises existent.</span><span class="sxs-lookup"><span data-stu-id="5fa23-207">The namespace manager is used to obtain the list of queues in the namespace and to make sure that the required backlog queues exist.</span></span> <span data-ttu-id="5fa23-208">Si ce n’est pas le cas, ces files d’attente sont créées.</span><span class="sxs-lookup"><span data-stu-id="5fa23-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="5fa23-209">[NamespaceManager][NamespaceManager] doit avoir la possibilité de créer un jeton avec la revendication **Gérer**.</span><span class="sxs-lookup"><span data-stu-id="5fa23-209">[NamespaceManager][NamespaceManager] requires the ability to create a token with the **Manage** claim.</span></span>
* <span data-ttu-id="5fa23-210">*messagingFactory* : instance [MessagingFactory][MessagingFactory] de l’espace de noms secondaire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-210">*messagingFactory*: The [MessagingFactory][MessagingFactory] instance for the secondary namespace.</span></span> <span data-ttu-id="5fa23-211">L’objet [MessagingFactory][MessagingFactory] est utilisé pour procéder aux envois, et si la propriété [EnableSyphon][EnableSyphon] est définie sur **true**, pour recevoir des messages de la part des files d’attente.</span><span class="sxs-lookup"><span data-stu-id="5fa23-211">The [MessagingFactory][MessagingFactory] object is used to send and, if the [EnableSyphon][EnableSyphon] property is set to **true**, receive messages from the backlog queues.</span></span>
* <span data-ttu-id="5fa23-212">*backlogQueueCount* : nombre de files d’attente à créer.</span><span class="sxs-lookup"><span data-stu-id="5fa23-212">*backlogQueueCount*: The number of backlog queues to create.</span></span> <span data-ttu-id="5fa23-213">La valeur doit être au moins à 1.</span><span class="sxs-lookup"><span data-stu-id="5fa23-213">This value must be at least 1.</span></span> <span data-ttu-id="5fa23-214">Lorsque vous envoyez des messages à la file d’attente, l’une d’entre elles est sélectionnée de manière aléatoire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-214">When sending messages to the backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="5fa23-215">Si vous définissez la valeur sur 1, une seule file d’attente peut être utilisée.</span><span class="sxs-lookup"><span data-stu-id="5fa23-215">If you set the value to 1, then only one queue can ever be used.</span></span> <span data-ttu-id="5fa23-216">Lorsque cela se produit et que la seule file d’attente génère des erreurs, le client ne peut pas faire de tentative avec une autre file d’attente et risque de ne pas envoyer votre message.</span><span class="sxs-lookup"><span data-stu-id="5fa23-216">When this happens and the one backlog queue generates errors, the client is not able to try a different backlog queue and may fail to send your message.</span></span> <span data-ttu-id="5fa23-217">Nous vous recommandons de définir cette valeur sur une valeur supérieure et la valeur par défaut est de 10.</span><span class="sxs-lookup"><span data-stu-id="5fa23-217">We recommend setting this value to some larger value and default the value to 10.</span></span> <span data-ttu-id="5fa23-218">Vous pouvez lui attribuer une valeur supérieure ou inférieure selon la quantité de données que votre application envoie quotidiennement.</span><span class="sxs-lookup"><span data-stu-id="5fa23-218">You can change this to a higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="5fa23-219">Chaque file d’attente peut contenir jusqu’à 5 Go de messages.</span><span class="sxs-lookup"><span data-stu-id="5fa23-219">Each backlog queue can hold up to 5 GB of messages.</span></span>
* <span data-ttu-id="5fa23-220">*failoverInterval* : durée pendant laquelle vous allez accepter les défaillances sur l’espace de noms principal avant de basculer chaque entité sur l’espace de noms secondaire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-220">*failoverInterval*: The amount of time during which you will accept failures on the primary namespace before switching any single entity over to the secondary namespace.</span></span> <span data-ttu-id="5fa23-221">Les basculements se produisent sur la base entité par entité.</span><span class="sxs-lookup"><span data-stu-id="5fa23-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="5fa23-222">Les entités dans un espace de noms unique résident fréquemment sur différents nœuds au sein de Service Bus.</span><span class="sxs-lookup"><span data-stu-id="5fa23-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="5fa23-223">La défaillance d’une entité n’implique pas nécessairement la défaillance d’une autre.</span><span class="sxs-lookup"><span data-stu-id="5fa23-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="5fa23-224">Vous pouvez définir cette valeur sur [System.TimeSpan.Zero][System.TimeSpan.Zero] pour basculer sur le second espace de noms tout de suite après votre première défaillance non temporaire.</span><span class="sxs-lookup"><span data-stu-id="5fa23-224">You can set this value to [System.TimeSpan.Zero][System.TimeSpan.Zero] to failover to the secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="5fa23-225">Les défaillances qui déclenchent le minuteur de basculement sont les exceptions [MessagingException][MessagingException] dans lesquelles la propriété [IsTransient][IsTransient] a la valeur false ou [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="5fa23-225">Failures that trigger the failover timer are any [MessagingException][MessagingException] in which the [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="5fa23-226">D’autres exceptions, telles que [UnauthorizedAccessException][UnauthorizedAccessException] ne provoquent pas de basculement, car elles signalent que le client est configuré de façon incorrecte.</span><span class="sxs-lookup"><span data-stu-id="5fa23-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that the client is configured incorrectly.</span></span> <span data-ttu-id="5fa23-227">Une exception [ServerBusyException][ServerBusyException] n’entraîne pas de basculement, car le modèle correct consiste à attendre 10 secondes, puis à renvoyer le message.</span><span class="sxs-lookup"><span data-stu-id="5fa23-227">A [ServerBusyException][ServerBusyException] does not cause failover because the correct pattern is to wait 10 seconds, then send the message again.</span></span>
* <span data-ttu-id="5fa23-228">*enableSyphon* : indique que cette association particulière doit siphonner les messages de l’espace de noms secondaire et les placer sur l’espace de noms principal.</span><span class="sxs-lookup"><span data-stu-id="5fa23-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from the secondary namespace back to the primary namespace.</span></span> <span data-ttu-id="5fa23-229">En général, les applications qui envoient des messages doivent définir cette valeur sur**false** ; les applications qui reçoivent des messages doivent définir cette valeur sur **true**.</span><span class="sxs-lookup"><span data-stu-id="5fa23-229">In general, applications that send messages should set this value to **false**; applications that receive messages should set this value to **true**.</span></span> <span data-ttu-id="5fa23-230">La raison est que souvent, les destinataires de messages sont moins nombreux que les expéditeurs.</span><span class="sxs-lookup"><span data-stu-id="5fa23-230">The reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="5fa23-231">En fonction du nombre de destinataires, vous pouvez choisir d’utiliser une seule instance d’application pour gérer les tâches de siphon.</span><span class="sxs-lookup"><span data-stu-id="5fa23-231">Depending on the number of receivers, you can choose to have a single application instance handle the syphon duties.</span></span> <span data-ttu-id="5fa23-232">L’utilisation de nombreux destinataires a un coût pour chaque file d’attente backlog.</span><span class="sxs-lookup"><span data-stu-id="5fa23-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="5fa23-233">Pour utiliser le code, créez une instance principale de [MessagingFactory][MessagingFactory], une instance secondaire de [MessagingFactory][MessagingFactory], une instance secondaire de [NamespaceManager][NamespaceManager] et une instance de [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="5fa23-233">To use the code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="5fa23-234">L’appel peut se réduire à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="5fa23-234">The call can be as simple as the following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="5fa23-235">Lorsque la tâche retournée par la méthode [PairNamespaceAsync][PairNamespaceAsync] se termine, tout est configuré et prêt à l’emploi.</span><span class="sxs-lookup"><span data-stu-id="5fa23-235">When the task returned by the [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready to use.</span></span> <span data-ttu-id="5fa23-236">Avant que la tâche soit renvoyée, il se peut que vous n’ayez pas terminé toutes les tâches en arrière-plan nécessaires pour que l’association fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="5fa23-236">Before the task is returned, you may not have completed all of the background work necessary for the pairing to work right.</span></span> <span data-ttu-id="5fa23-237">Par conséquent, vous ne devez pas commencer à envoyer les messages avant que la tâche ne revienne.</span><span class="sxs-lookup"><span data-stu-id="5fa23-237">As a result, you should not start sending messages until the task returns.</span></span> <span data-ttu-id="5fa23-238">En cas de défaillance (informations d’identification incorrectes ou échec de création des files d’attente), ces exceptions seront levées lorsque la tâche est achevée.</span><span class="sxs-lookup"><span data-stu-id="5fa23-238">If any failures occurred, such as bad credentials, or failure to create the backlog queues, those exceptions will be thrown once the task completes.</span></span> <span data-ttu-id="5fa23-239">Une fois que la tâche est retournée, vérifiez que les files d’attente ont été détectées ou créées en examinant la propriété [BacklogQueueCount][BacklogQueueCount] de votre instance [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions].</span><span class="sxs-lookup"><span data-stu-id="5fa23-239">Once the task returns, verify that the queues were found or created by examining the [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="5fa23-240">Pour le code qui précède, cette opération se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="5fa23-240">For the preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="5fa23-241">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="5fa23-241">Next steps</span></span>
<span data-ttu-id="5fa23-242">Maintenant que vous avez appris les principes fondamentaux de la messagerie asynchrone dans Service Bus, approfondissez le sujet sur les [espaces de noms associés][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="5fa23-242">Now that you've learned the basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md
