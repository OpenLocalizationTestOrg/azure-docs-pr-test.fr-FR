---
title: "l’authentification du principal aaaService pour API Apps dans Azure App Service | Documents Microsoft"
description: "Découvrez comment application tooprotect une API dans Azure App Service pour les scénarios de service."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="985ff-103">Authentification de principal du service pour API Apps dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="985ff-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="985ff-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="985ff-104">Overview</span></span>
<span data-ttu-id="985ff-105">Cet article explique comment l’authentification du Service d’applications de toouse pour *interne* accéder aux applications de tooAPI.</span><span class="sxs-lookup"><span data-stu-id="985ff-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="985ff-106">Un scénario interne est où vous avez une application API que vous souhaitez toobe utilisable uniquement par votre propre code d’application.</span><span class="sxs-lookup"><span data-stu-id="985ff-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="985ff-107">Hello recommandé tooimplement de façon ce scénario dans le Service d’applications est toouse Azure AD tooprotect hello appelée application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="985ff-108">Vous appelez application d’API hello protégé avec un jeton de support que vous obtenez d’Azure AD en fournissant des informations d’identification (principal du service) d’identité de l’application.</span><span class="sxs-lookup"><span data-stu-id="985ff-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="985ff-109">Pour les alternatives toousing Azure AD, consultez hello **l’authentification de service** section Hello [vue d’ensemble de l’authentification du Service d’applications Azure](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="985ff-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="985ff-110">Cet article porte sur les points suivants :</span><span class="sxs-lookup"><span data-stu-id="985ff-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="985ff-111">Comment toouse Azure Active Directory (Azure AD) tooprotect une API application à partir de l’accès non authentifié.</span><span class="sxs-lookup"><span data-stu-id="985ff-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="985ff-112">Comment application tooconsume API protégée d’une application API, une application web ou une application mobile à l’aide des informations d’identification de l’entité de sécurité (identité de l’application) de service Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="985ff-113">Pour plus d’informations sur la façon tooconsume à partir d’une application logique, consultez [à l’aide de votre API personnalisée hébergé sur App Service avec les applications de la logique](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="985ff-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="985ff-114">Comment toomake que ce hello protégée application API ne peut pas être appelée à partir d’un navigateur par des utilisateurs connectés.</span><span class="sxs-lookup"><span data-stu-id="985ff-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="985ff-115">Comment toomake que ce hello protégée application API peut uniquement être appelée par un spécifique principal du service Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="985ff-116">article de Hello contient deux sections :</span><span class="sxs-lookup"><span data-stu-id="985ff-116">hello article contains two sections:</span></span>

* <span data-ttu-id="985ff-117">Hello [comment tooconfigure service principal d’authentification dans Azure App Service](#authconfig) section explique en général l’authentification tooconfigure pour n’importe quelle application API, et comment tooconsume hello protégés application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="985ff-118">Cette section s’applique aussi bien les infrastructures tooall pris en charge par le Service d’application, y compris .NET, Node.js et Java.</span><span class="sxs-lookup"><span data-stu-id="985ff-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="985ff-119">En commençant par hello [poursuivre les didacticiels de prise en main de .NET hello](#tutorialstart) section, hello didacticiel vous guide Configuration d’un scénario de « accès interne » pour un exemple d’application .NET en cours d’exécution dans le Service d’applications.</span><span class="sxs-lookup"><span data-stu-id="985ff-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="985ff-120"><a id="authconfig"></a>Comment tooconfigure service principal d’authentification dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="985ff-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="985ff-121">Cette section fournit des instructions générales qui s’appliquent tooany API app.</span><span class="sxs-lookup"><span data-stu-id="985ff-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="985ff-122">Pour tooDo de toohello spécifique comme exemple d’application .NET de la liste, consultez trop[poursuivre la série de didacticiels .NET API Apps hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="985ff-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="985ff-123">Bonjour [portail Azure](https://portal.azure.com/), accédez toohello **paramètres** Panneau de l’application hello API que vous le souhaitez tooprotect et recherchez hello **fonctionnalités** et cliquez sur **L’authentification / autorisation**.</span><span class="sxs-lookup"><span data-stu-id="985ff-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Authentification/Autorisation dans le portail Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="985ff-125">Bonjour **l’authentification / autorisation** panneau, cliquez sur **sur**.</span><span class="sxs-lookup"><span data-stu-id="985ff-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="985ff-126">Bonjour **tootake Action lors de la demande n’est pas authentifiée** la liste déroulante, sélectionnez **se connecter avec Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="985ff-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="985ff-127">Sous **Fournisseurs d’authentification**, cliquez sur **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="985ff-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Panneau Authentification/Autorisation dans le portail Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="985ff-129">Configurer hello **paramètres Azure Active Directory** panneau toocreate un nouvel Azure application AD ou utilisez une application Azure AD existante si vous en avez déjà que vous souhaitez toouse.</span><span class="sxs-lookup"><span data-stu-id="985ff-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="985ff-130">Les scénarios internes impliquent généralement l’appel d’une application API à une autre.</span><span class="sxs-lookup"><span data-stu-id="985ff-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="985ff-131">Vous pouvez utiliser soit des applications Azure AD distinctes pour chaque application API, soit une simple application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="985ff-132">Pour obtenir des instructions détaillées sur ce panneau, consultez [comment tooconfigure votre connexion de Service d’applications application toouse Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="985ff-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="985ff-133">Lorsque vous avez terminé avec le panneau de configuration de fournisseur d’authentification hello, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="985ff-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="985ff-134">Bonjour **l’authentification / autorisation** panneau, cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Cliquez sur Enregistrer.](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="985ff-136">Dans ce cas, du Service d’applications autorise uniquement les demandes provenant d’appelants dans le locataire Azure AD de hello configuré.</span><span class="sxs-lookup"><span data-stu-id="985ff-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="985ff-137">Aucun code d’authentification ou d’autorisation n’est requis dans l’application d’API hello protégé.</span><span class="sxs-lookup"><span data-stu-id="985ff-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="985ff-138">Hello jeton de support est passé application toohello API ainsi que les revendications couramment utilisées dans les en-têtes HTTP, et vous pouvez lire ces informations dans le code toovalidate qui sont des demandes provenant d’un appelant particulière, par exemple un principal de service.</span><span class="sxs-lookup"><span data-stu-id="985ff-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="985ff-139">Cette fonctionnalité d’authentification fonctionne hello identique pour toutes les langues que le service application prend en charge, y compris .NET, Node.js et Java.</span><span class="sxs-lookup"><span data-stu-id="985ff-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="985ff-140">Mode de protection de l’application API de tooconsume hello</span><span class="sxs-lookup"><span data-stu-id="985ff-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="985ff-141">appelant de Hello devez fournir un jeton de support Azure AD avec les appels d’API.</span><span class="sxs-lookup"><span data-stu-id="985ff-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="985ff-142">tooget un jeton de support à l’aide des informations d’identification du principal de service, l’appelant de hello utilise la bibliothèque d’authentification Active Directory (ADAL pour [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), ou [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="985ff-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="985ff-143">tooget un jeton, le code hello qui appelle la bibliothèque ADAL fournit hello tooADAL informations suivantes :</span><span class="sxs-lookup"><span data-stu-id="985ff-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="985ff-144">nom de Hello de votre client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="985ff-145">Hello client et ID de clé secrète client (clé d’application) de l’application hello Azure AD associée à l’appelant de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="985ff-146">ID de client Hello Hello application Azure AD associée hello protégé application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="985ff-147">(Si qu’une application Azure AD est utilisée, cela est hello même ID de client comme un appelant de hello hello.)</span><span class="sxs-lookup"><span data-stu-id="985ff-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="985ff-148">Ces valeurs sont disponibles dans les pages de hello Azure AD de hello [portail Azure classic](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="985ff-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="985ff-149">Une fois que le jeton de hello a été acquis, l’appelant de hello inclut les requêtes HTTP dans l’en-tête d’autorisation hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="985ff-150">Service d’applications valide le jeton de hello et permet de hello de tooreach demandes hello protégé application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="985ff-151">Comment application hello API de tooprotect à partir de l’accès par des utilisateurs Bonjour même locataire</span><span class="sxs-lookup"><span data-stu-id="985ff-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="985ff-152">Les jetons de support pour les utilisateurs de hello même client sont considérées comme valides pour hello protégé application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="985ff-153">Si vous voulez tooensure un service principal peut appeler hello application API protégée, ajoutez le code de hello protégé hello de toovalidate d’application API suivant des revendications à partir du jeton de hello :</span><span class="sxs-lookup"><span data-stu-id="985ff-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="985ff-154">`appid`doit être hello des ID de client de l’application hello Azure AD qui est associée à l’appelant de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="985ff-155">`oid`(`objectidentifier`) doit être l’ID de principal du service hello de l’appelant de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="985ff-156">Service d’applications fournit également hello `objectidentifier` revendication dans l’en-tête de hello X-MS-CLIENT-PRINCIPAL-ID.</span><span class="sxs-lookup"><span data-stu-id="985ff-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="985ff-157">Comment tooprotect hello application API à partir de l’accès du navigateur</span><span class="sxs-lookup"><span data-stu-id="985ff-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="985ff-158">Si vous ne validez les revendications dans le code dans l’application d’API hello protégé, et si vous utilisez un distinct application Azure AD pour hello protégé API app, assurez-vous que hello URL de réponse de l’application Azure AD est ne Hello pas identique hello URL de base de l’application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="985ff-159">Si hello URL de réponse pointe directement toohello protégé API app, un utilisateur de client de hello même instance Azure AD peut parcourir l’application d’API toohello session et appeler les API hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="985ff-160"><a id="tutorialstart"></a>Poursuivre la série de didacticiels hello .NET API Apps</span><span class="sxs-lookup"><span data-stu-id="985ff-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="985ff-161">Si vous suivez hello Node.js ou Java série de didacticiels pour les applications d’API, ignorer toohello [étapes](#next-steps) section.</span><span class="sxs-lookup"><span data-stu-id="985ff-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="985ff-162">reste Hello de cet article poursuit la série de didacticiels .NET API Apps hello et suppose que vous avez terminé hello [didacticiel de l’authentification utilisateur](app-service-api-dotnet-user-principal-auth.md) et posséder hello exemple d’application en cours d’exécution dans Azure avec l’authentification utilisateur activé.</span><span class="sxs-lookup"><span data-stu-id="985ff-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="985ff-163">Configurer l’authentification dans Azure</span><span class="sxs-lookup"><span data-stu-id="985ff-163">Set up authentication in Azure</span></span>
<span data-ttu-id="985ff-164">Dans cette section vous configurez le Service d’applications afin de rendre ce hello uniquement HTTP demande permet de tooreach hello données couche API application hello ceux ayant Azure valide les jetons de porteur AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="985ff-165">Bonjour suivant la section, vous configurez hello intermédiaire API application toosend tooAzure application informations d’identification Active Directory, récupérer un jeton de support, envoyez porteur de hello jeton toohello données couche API app.</span><span class="sxs-lookup"><span data-stu-id="985ff-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="985ff-166">Ce processus est illustré dans le diagramme de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-166">This process is illustrated in hello diagram.</span></span>

![Diagramme d’authentification du service](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="985ff-168">Si vous rencontrez des problèmes lors des instructions didacticiel hello suivantes, consultez hello [dépannage](#troubleshooting) section à fin hello du didacticiel de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="985ff-169">Bonjour [portail Azure](https://portal.azure.com/), accédez toohello **paramètres** Panneau de l’application hello API créé pour l’application d’API hello ToDoListDataAPI (couche de données), puis cliquez sur **paramètres**.</span><span class="sxs-lookup"><span data-stu-id="985ff-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="985ff-170">Bonjour **paramètres** panneau, rechercher hello **fonctionnalités** section, puis cliquez sur **l’authentification / autorisation**.</span><span class="sxs-lookup"><span data-stu-id="985ff-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Authentification/Autorisation dans le portail Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="985ff-172">Bonjour **l’authentification / autorisation** panneau, cliquez sur **sur**.</span><span class="sxs-lookup"><span data-stu-id="985ff-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="985ff-173">Bonjour **tootake Action lors de la demande n’est pas authentifiée** la liste déroulante, sélectionnez **se connecter avec Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="985ff-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="985ff-174">Il s’agit de paramètre hello qui provoque le Service d’applications tooensure qui a authentifié uniquement les demandes portée hello API app.</span><span class="sxs-lookup"><span data-stu-id="985ff-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="985ff-175">Pour les demandes qui ont des jetons de support valide, Service de l’application transmet les jetons hello le long de l’application de toohello API et remplit les en-têtes HTTP avec des revendications courantes toomake ces informations plus facilement accessibles tooyour code.</span><span class="sxs-lookup"><span data-stu-id="985ff-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="985ff-176">Sous **Fournisseurs d’authentification**, cliquez sur **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="985ff-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Panneau Authentification/Autorisation dans le portail Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="985ff-178">Bonjour **paramètres Azure Active Directory** panneau, cliquez sur **Express**.</span><span class="sxs-lookup"><span data-stu-id="985ff-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="985ff-179">Avec hello **Express** option Azure peut créer automatiquement une application AAD dans votre annuaire Azure AD [client](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="985ff-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="985ff-180">Vous n’avez toocreate d’un client, car chaque compte Azure a automatiquement un.</span><span class="sxs-lookup"><span data-stu-id="985ff-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="985ff-181">Sous **Mode d’administration**, cliquez sur **Créer une application AD**, si cette option n’est pas déjà sélectionnée.</span><span class="sxs-lookup"><span data-stu-id="985ff-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="985ff-182">portail de Hello branche hello **créer application** zone d’entrée avec une valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="985ff-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="985ff-183">Par défaut, hello application Azure AD est nommé même hello en tant qu’application hello API.</span><span class="sxs-lookup"><span data-stu-id="985ff-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="985ff-184">Vous pouvez, si vous le souhaitez, choisir un autre nom.</span><span class="sxs-lookup"><span data-stu-id="985ff-184">If you prefer, you can enter a different name.</span></span>
   
    ![Paramètres Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="985ff-186">**Remarque**: en guise d’alternative, vous pouvez utiliser un seul AD Azure application pour les deux hello appelante application API et hello protégé application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="985ff-187">Si vous choisissez cette solution, vous ne devez pas hello **créer une application AD** option ici, car vous déjà créé une application Azure AD plus haut dans le didacticiel de l’authentification utilisateur hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="985ff-188">Pour ce didacticiel, vous allez utiliser séparer des applications Azure AD pour hello appel application API et hello protégé application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="985ff-189">Prenez note de la valeur hello hello **créer application** zone d’entrée ; vous devez rechercher cette application AAD Bonjour portail Azure classic ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="985ff-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="985ff-190">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="985ff-190">Click **OK**.</span></span>
10. <span data-ttu-id="985ff-191">Bonjour **l’authentification / autorisation** panneau, cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Cliquez sur Enregistrer.](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="985ff-193">Service de l’application crée une application Azure Active Directory avec **URL de connexion** et **URL de réponse** automatiquement la valeur URL toohello de votre application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="985ff-194">valeur de cette dernière Hello permet les utilisateurs de votre toolog de locataire AAD dans et application d’API accès hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="985ff-195">Vérifiez que cette application hello API est protégée.</span><span class="sxs-lookup"><span data-stu-id="985ff-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="985ff-196">Dans un navigateur, accédez toohello des URL de l’application hello API : Bonjour **application API** panneau Bonjour portail Azure, cliquez sur le lien hello sous **URL**.</span><span class="sxs-lookup"><span data-stu-id="985ff-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="985ff-197">Vous êtes écran de connexion tooa redirigé, car les demandes non authentifiées ne sont pas autorisées tooreach hello API app.</span><span class="sxs-lookup"><span data-stu-id="985ff-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="985ff-198">Si votre navigateur accédez toohello Swagger de l’interface utilisateur, votre navigateur peut déjà connecté--dans ce cas, ouvrez une fenêtre de navigation InPrivate ou Incognito et accédez toohello Swagger une URL de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="985ff-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="985ff-199">Connectez-vous avec les informations d’identification d’un utilisateur de votre client AAD.</span><span class="sxs-lookup"><span data-stu-id="985ff-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="985ff-200">Lorsque vous êtes connecté, la page de « correctement créée » de hello s’affiche dans le navigateur de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="985ff-201">Configurer hello ToDoListAPI projet tooacquire et envoyer le jeton d’Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="985ff-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="985ff-202">Dans cette section, vous hello tâche suivantes :</span><span class="sxs-lookup"><span data-stu-id="985ff-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="985ff-203">Ajoutez du code dans l’application d’API de niveau intermédiaire hello qui utilise les informations d’identification tooacquire un jeton de Azure AD application et envoyer des que demandes avec HTTP toohello données couche API app.</span><span class="sxs-lookup"><span data-stu-id="985ff-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="985ff-204">Obtenir des informations d’identification de hello que vous avez besoin d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="985ff-205">Entrez des informations d’identification de hello dans les paramètres d’environnement runtime du Service d’applications Azure dans la couche intermédiaire de hello application API.</span><span class="sxs-lookup"><span data-stu-id="985ff-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="985ff-206">Configurer hello ToDoListAPI projet tooacquire et envoyer le jeton d’Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="985ff-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="985ff-207">Rendre hello suit les modifications dans le projet de ToDoListAPI hello dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="985ff-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="985ff-208">Supprimez les commentaires de tout code hello Bonjour *ServicePrincipal.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="985ff-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="985ff-209">Il s’agit de code hello qui utilise la bibliothèque ADAL pour le jeton de support .NET tooacquire hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="985ff-210">Elle utilise plusieurs valeurs de configuration que vous allez définir ultérieurement dans l’environnement d’exécution Azure hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="985ff-211">Voici le code de hello :</span><span class="sxs-lookup"><span data-stu-id="985ff-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="985ff-212">**Remarque :** ce code nécessite hello ADAL pour le package NuGet .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), qui est déjà installé dans le projet de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="985ff-213">Si vous avez créé ce projet à partir de zéro, vous devriez tooinstall ce package.</span><span class="sxs-lookup"><span data-stu-id="985ff-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="985ff-214">Ce package n’est pas installé automatiquement par le modèle de nouveau projet application hello API.</span><span class="sxs-lookup"><span data-stu-id="985ff-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="985ff-215">Dans *contrôleurs/ToDoListController*, supprimez les commentaires de code hello Bonjour `NewDataAPIClient` méthode qui ajoute des demandes de jeton tooHTTP hello dans l’en-tête d’autorisation hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="985ff-216">Déployer le projet de ToDoListAPI hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="985ff-217">(Projet de hello d’avec le bouton droit, puis cliquez sur **publier > Publier**.)</span><span class="sxs-lookup"><span data-stu-id="985ff-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="985ff-218">Visual Studio déploie hello projet et ouvre l’URL de base d’un navigateur toohello application web.</span><span class="sxs-lookup"><span data-stu-id="985ff-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="985ff-219">Cette opération affiche une page de 403 erreur, ce qui est normale d’une URL base tentative toogo tooa API Web depuis un navigateur.</span><span class="sxs-lookup"><span data-stu-id="985ff-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="985ff-220">Navigateur de fermer hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="985ff-221">Obtenir les valeurs de configuration Azure AD</span><span class="sxs-lookup"><span data-stu-id="985ff-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="985ff-222">Bonjour [portail Azure classic](https://manage.windowsazure.com/), accédez trop**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="985ff-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="985ff-223">Sur hello **répertoire** , cliquez sur votre client AAD.</span><span class="sxs-lookup"><span data-stu-id="985ff-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="985ff-224">Cliquez sur **Applications > Applications que ma société possède**, puis cliquez sur la case à cocher hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="985ff-225">Dans la liste de hello des applications, cliquez sur nom hello hello Azure créée pour vous lorsque vous avez activé l’authentification pour l’application d’API hello ToDoListDataAPI (couche de données).</span><span class="sxs-lookup"><span data-stu-id="985ff-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="985ff-226">Cliquez sur hello **configurer** onglet.</span><span class="sxs-lookup"><span data-stu-id="985ff-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="985ff-227">Hello de copie **ID Client** valeur et enregistrer un endroit où vous pouvez l’obtenir à partir de versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="985ff-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="985ff-228">Bonjour portail Azure classic revenir en arrière toohello la liste des **Applications que ma société possède**et cliquez sur l’application hello AAD que vous avez créé pour l’application de ToDoListAPI API de niveau intermédiaire hello (hello celui créé dans le cadre du didacticiel précédent hello, pas Hello vous créée dans ce didacticiel).</span><span class="sxs-lookup"><span data-stu-id="985ff-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="985ff-229">Cliquez sur hello **configurer** onglet.</span><span class="sxs-lookup"><span data-stu-id="985ff-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="985ff-230">Hello de copie **ID Client** valeur et enregistrer un endroit où vous pouvez l’obtenir à partir de versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="985ff-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="985ff-231">Sous **clés**, sélectionnez **1 an** de hello **sélectionner une durée** liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="985ff-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="985ff-232">Cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-232">Click **Save**.</span></span>
    
     ![Générer la clé d’application](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="985ff-234">Copiez la valeur de clé hello et enregistrer un endroit où que vous pouvez l’obtenir à partir de versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="985ff-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Copiez la nouvelle clé d’application](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="985ff-236">Configurer les paramètres d’Azure AD dans l’environnement d’exécution de l’application de couche intermédiaire API hello</span><span class="sxs-lookup"><span data-stu-id="985ff-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="985ff-237">Accédez toohello [portail Azure](https://portal.azure.com/), puis accédez toohello **application API** panneau pour l’application hello API qui héberge le projet d’hello TodoListAPI (intermédiaire).</span><span class="sxs-lookup"><span data-stu-id="985ff-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="985ff-238">Cliquez sur **Paramètres > Paramètres de l'application**.</span><span class="sxs-lookup"><span data-stu-id="985ff-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="985ff-239">Bonjour **paramètres de l’application** section, ajoutez des clés et de valeurs hello suivant :</span><span class="sxs-lookup"><span data-stu-id="985ff-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="985ff-240">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-240">**Key**</span></span> | <span data-ttu-id="985ff-241">ida:Authority</span><span class="sxs-lookup"><span data-stu-id="985ff-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-242">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-242">**Value**</span></span> |<span data-ttu-id="985ff-243">https://login.microsoftonline.com/{nom de votre client Azure AD}</span><span class="sxs-lookup"><span data-stu-id="985ff-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="985ff-244">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-244">**Example**</span></span> |<span data-ttu-id="985ff-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="985ff-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="985ff-246">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-246">**Key**</span></span> | <span data-ttu-id="985ff-247">ida:ClientId</span><span class="sxs-lookup"><span data-stu-id="985ff-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-248">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-248">**Value**</span></span> |<span data-ttu-id="985ff-249">ID client de hello appel d’application (couche intermédiaire - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="985ff-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="985ff-250">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-250">**Example**</span></span> |<span data-ttu-id="985ff-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="985ff-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="985ff-252">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-252">**Key**</span></span> | <span data-ttu-id="985ff-253">ida:ClientSecret</span><span class="sxs-lookup"><span data-stu-id="985ff-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-254">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-254">**Value**</span></span> |<span data-ttu-id="985ff-255">Clé d’une application Hello appel d’application (couche intermédiaire - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="985ff-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="985ff-256">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-256">**Example**</span></span> |<span data-ttu-id="985ff-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="985ff-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="985ff-258">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-258">**Key**</span></span> | <span data-ttu-id="985ff-259">ida:Resource</span><span class="sxs-lookup"><span data-stu-id="985ff-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-260">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-260">**Value**</span></span> |<span data-ttu-id="985ff-261">ID client de hello appelée application (couche de données - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="985ff-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="985ff-262">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-262">**Example**</span></span> |<span data-ttu-id="985ff-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="985ff-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="985ff-264">**Remarque**: pour `ida:Resource`, assurez-vous que vous utilisez hello appelé l’application **ID client** et non pas son **URI ID d’application**.</span><span class="sxs-lookup"><span data-stu-id="985ff-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="985ff-265">`ida:ClientId`et `ida:Resource` sont différentes valeurs pour ce didacticiel, car vous utilisez séparer applicaations Azure AD pour la couche intermédiaire de hello et la couche données.</span><span class="sxs-lookup"><span data-stu-id="985ff-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="985ff-266">Si vous utilisez une seule application Azure AD pour hello appel application API et hello protégé application API, vous utilisez hello même valeur dans les deux `ida:ClientId` et `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="985ff-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="985ff-267">code de Hello utilise ConfigurationManager tooget ces valeurs, il peut être stockés dans le fichier Web.config du projet hello ou dans l’environnement d’exécution Azure hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="985ff-268">Pendant l’exécution d’une application ASP.NET dans Azure App Service, les paramètres d’environnement remplacent automatiquement les paramètres du fichier Web.config. Paramètres d’environnement sont en général un [plus sécurisé moyen toostore personnelles comparées fichier Web.config de tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="985ff-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="985ff-269">Cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-269">Click **Save**.</span></span>
   
    ![Cliquez sur Enregistrer.](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="985ff-271">Tester l’application hello</span><span class="sxs-lookup"><span data-stu-id="985ff-271">Test hello application</span></span>
1. <span data-ttu-id="985ff-272">Dans un navigateur, accédez toohello URL HTTPS de hello AngularJS frontal web app.</span><span class="sxs-lookup"><span data-stu-id="985ff-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="985ff-273">Cliquez sur hello **tooDo liste** onglet et connectez-vous avec les informations d’identification d’un utilisateur dans votre locataire Azure AD.</span><span class="sxs-lookup"><span data-stu-id="985ff-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="985ff-274">Ajouter des tâches éléments tooverify que l’utilisation de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![page de liste tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="985ff-276">Si l’application hello ne fonctionne pas comme prévu, vérifiez que tous les paramètres de hello saisis dans hello portail Azure.</span><span class="sxs-lookup"><span data-stu-id="985ff-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="985ff-277">Si tous les paramètres de hello apparaissent toobe correct, consultez hello [dépannage](#troubleshooting) section plus loin dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="985ff-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="985ff-278">Protéger hello API application à partir de l’accès du navigateur</span><span class="sxs-lookup"><span data-stu-id="985ff-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="985ff-279">Pour ce didacticiel, vous avez créé un distinct application Azure AD pour l’application hello API de ToDoListDataAPI (couche de données).</span><span class="sxs-lookup"><span data-stu-id="985ff-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="985ff-280">Comme vous avez vu, lorsque le Service d’applications crée une application AAD, il configure application AAD de hello d’une façon qui permet à un utilisateur toogo toohello API URL de l’application dans un navigateur et le journal sur.</span><span class="sxs-lookup"><span data-stu-id="985ff-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="985ff-281">Cela signifie qu’il est possible pour un utilisateur final dans votre locataire Azure AD, et pas seulement un principal de service, tooaccess hello API.</span><span class="sxs-lookup"><span data-stu-id="985ff-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="985ff-282">Si vous souhaitez que l’accès du navigateur tooprevent sans écrire de code Bonjour protégées application API, vous pouvez modifier hello **URL de réponse** Bonjour application AAD afin qu’il soit différent de l’application hello API URL de base.</span><span class="sxs-lookup"><span data-stu-id="985ff-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="985ff-283">Désactiver l’accès du navigateur</span><span class="sxs-lookup"><span data-stu-id="985ff-283">Disable browser access</span></span>
1. <span data-ttu-id="985ff-284">Dans le portail hello classic **configurer** pour application AAD hello qui a été créée pour hello TodoListService, modifiez la valeur hello Bonjour **URL de réponse** champ afin qu’il soit une URL valide, mais pas hello API de l’application URL.</span><span class="sxs-lookup"><span data-stu-id="985ff-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="985ff-285">Cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="985ff-286">Vérifier que l’accès au navigateur ne fonctionne plus</span><span class="sxs-lookup"><span data-stu-id="985ff-286">Verify browser access no longer works</span></span>
<span data-ttu-id="985ff-287">Précédemment, vous avez vérifié que vous pouvez accéder toohello URL de l’application API à partir d’un navigateur en vous connectant avec les informations d’identification d’un utilisateur individuel.</span><span class="sxs-lookup"><span data-stu-id="985ff-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="985ff-288">Dans cette section, vous allez vérifier que cet accès ne fonctionne plus.</span><span class="sxs-lookup"><span data-stu-id="985ff-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="985ff-289">Dans une nouvelle fenêtre de navigateur, accédez à nouveau toohello des URL de l’application d’API hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="985ff-290">Ouvrez une session lorsque vous y êtes invité toodo donc.</span><span class="sxs-lookup"><span data-stu-id="985ff-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="985ff-291">Connexion réussit, mais entraîne une page d’erreurs tooan.</span><span class="sxs-lookup"><span data-stu-id="985ff-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="985ff-292">Vous avez configuré hello AAD application afin que les utilisateurs du client AAD de hello ne peut pas se connecter et accéder aux API de hello à partir d’un navigateur.</span><span class="sxs-lookup"><span data-stu-id="985ff-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="985ff-293">Vous pouvez toujours accéder à application d’API hello à l’aide d’un jeton de principal du service, vous pouvez vérifier en sélectionnant des URL de l’application toohello web et ajouter des éléments de tâches plus.</span><span class="sxs-lookup"><span data-stu-id="985ff-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="985ff-294">Restreindre la principal de service particulier d’accès tooa</span><span class="sxs-lookup"><span data-stu-id="985ff-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="985ff-295">Pour l’instant, tout appelant qui peut obtenir un jeton pour un utilisateur ou principal du service dans votre locataire Azure AD peut appeler l’application hello API de TodoListDataAPI (couche de données).</span><span class="sxs-lookup"><span data-stu-id="985ff-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="985ff-296">Vous souhaiterez peut-être toomake que cette application d’API hello données couche n’accepte que les appels à partir de l’application d’API hello TodoListAPI (intermédiaire) et uniquement à partir d’un principal de service particulier.</span><span class="sxs-lookup"><span data-stu-id="985ff-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="985ff-297">Vous pouvez ajouter ces restrictions en ajoutant hello toovalidate de code `appid` et `objectidentifier` les revendications pour les appels entrants.</span><span class="sxs-lookup"><span data-stu-id="985ff-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="985ff-298">Pour ce didacticiel, vous placez hello de code qui valide l’ID d’application et l’ID de principal de service directement dans vos actions de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="985ff-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="985ff-299">Alternatives sont toouse personnalisé `Authorize` attribut ou toodo cette validation dans vos séquences de démarrage (par exemple, le middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="985ff-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="985ff-300">Pour obtenir un exemple de hello ce dernier, consultez [cet exemple d’application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="985ff-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="985ff-301">Rendre hello suivant du projet de TodoListDataAPI toohello de modifications.</span><span class="sxs-lookup"><span data-stu-id="985ff-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="985ff-302">Ouvrez hello *Controllers/TodoListController.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="985ff-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="985ff-303">Commentaire hello définir `trustedCallerClientId` et `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="985ff-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="985ff-304">Supprimez les commentaires de code hello Bonjour CheckCallerId méthode.</span><span class="sxs-lookup"><span data-stu-id="985ff-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="985ff-305">Cette méthode est appelée au début de hello de chaque méthode d’action de contrôleur de hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="985ff-306">Redéployez hello ToDoListDataAPI tooAzure de projet du Service d’applications.</span><span class="sxs-lookup"><span data-stu-id="985ff-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="985ff-307">Dans votre navigateur, accédez URL HTTPS de l’application web toohello AngularJS front-end et dans la page d’accueil hello, cliquez sur hello **tooDo liste** onglet.</span><span class="sxs-lookup"><span data-stu-id="985ff-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="985ff-308">application Hello ne fonctionne pas, car les appels toohello retour de fin échouent.</span><span class="sxs-lookup"><span data-stu-id="985ff-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="985ff-309">est la vérification du code de nouveau Hello appid réel et objectidentifier, mais il ne dispose pas encore hello valeurs correctes toocheck contre les.</span><span class="sxs-lookup"><span data-stu-id="985ff-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="985ff-310">navigateur de Hello Console des outils de développement signale que ce serveur hello retourne une erreur HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="985ff-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Erreur dans la console des outils de développement](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="985ff-312">Vous configurez les valeurs attendues hello hello comme suit.</span><span class="sxs-lookup"><span data-stu-id="985ff-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="985ff-313">À l’aide de PowerShell Azure AD, obtenir valeur hello du service de hello principal pour hello application Azure AD que vous avez créé pour le projet de TodoListWebApp hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="985ff-314">a.</span><span class="sxs-lookup"><span data-stu-id="985ff-314">a.</span></span> <span data-ttu-id="985ff-315">Pour obtenir des instructions sur la façon de tooinstall Azure PowerShell et se connecter tooyour abonnement, consultez [à l’aide de Azure PowerShell avec Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="985ff-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="985ff-316">b.</span><span class="sxs-lookup"><span data-stu-id="985ff-316">b.</span></span> <span data-ttu-id="985ff-317">tooget une liste des principaux de service, exécutez hello `Login-AzureRmAccount` des commandes et puis hello `Get-AzureRmADServicePrincipal` commande.</span><span class="sxs-lookup"><span data-stu-id="985ff-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="985ff-318">c.</span><span class="sxs-lookup"><span data-stu-id="985ff-318">c.</span></span> <span data-ttu-id="985ff-319">Recherchez hello objectid hello principal du service d’application de TodoListAPI hello et enregistrez-le dans un emplacement que vous pouvez copier à partir de versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="985ff-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="985ff-320">Dans hello portail Azure, accédez à panneau de l’application API toohello pour l’application hello API que vous avez déployé le projet ToDoListDataAPI hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="985ff-321">Cliquez sur **Paramètres > Paramètres de l’application**.</span><span class="sxs-lookup"><span data-stu-id="985ff-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="985ff-322">Bonjour **paramètres de l’application** section, ajoutez des clés et de valeurs hello suivant :</span><span class="sxs-lookup"><span data-stu-id="985ff-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="985ff-323">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-323">**Key**</span></span> | <span data-ttu-id="985ff-324">todo:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="985ff-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-325">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-325">**Value**</span></span> |<span data-ttu-id="985ff-326">ID du principal de service principal de l’application appelante</span><span class="sxs-lookup"><span data-stu-id="985ff-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="985ff-327">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-327">**Example**</span></span> |<span data-ttu-id="985ff-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="985ff-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="985ff-329">**Clé**</span><span class="sxs-lookup"><span data-stu-id="985ff-329">**Key**</span></span> | <span data-ttu-id="985ff-330">todo:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="985ff-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="985ff-331">**Valeur**</span><span class="sxs-lookup"><span data-stu-id="985ff-331">**Value**</span></span> |<span data-ttu-id="985ff-332">ID de client de l’appel d’application - copiée à partir de l’application de hello TodoListAPI Azure AD</span><span class="sxs-lookup"><span data-stu-id="985ff-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="985ff-333">**Exemple**</span><span class="sxs-lookup"><span data-stu-id="985ff-333">**Example**</span></span> |<span data-ttu-id="985ff-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="985ff-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="985ff-335">Cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="985ff-335">Click **Save**.</span></span>
    
     ![Cliquez sur Enregistrer.](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="985ff-337">Dans votre navigateur, retourne l’URL de l’application toohello web, dans la page d’accueil hello, cliquez sur hello **tooDo liste** onglet.</span><span class="sxs-lookup"><span data-stu-id="985ff-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="985ff-338">Cette application hello de temps fonctionne comme prévu, car l’application hello appelant approuvé ID et l’ID de principal de service sont les valeurs attendues hello.</span><span class="sxs-lookup"><span data-stu-id="985ff-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![page de liste tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="985ff-340">Génération de projets hello à partir de zéro</span><span class="sxs-lookup"><span data-stu-id="985ff-340">Building hello projects from scratch</span></span>
<span data-ttu-id="985ff-341">projets d’API Web Hello deux ont été créés à l’aide de hello **application API Azure** modèle et en remplaçant contrôleur de valeurs par défaut hello avec un contrôleur de la liste des tâches de projet.</span><span class="sxs-lookup"><span data-stu-id="985ff-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="985ff-342">Pour l’acquisition des jetons de principal du service Azure AD dans le projet de ToDoListAPI hello, hello [Active Directory Authentication Library (ADAL) pour .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) le package NuGet a été installé.</span><span class="sxs-lookup"><span data-stu-id="985ff-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="985ff-343">Pour plus d’informations sur la façon de trop de création d’une application de page unique AngularJS avec un API Web back-end comme ToDoListAngular, consultez [mains sur Lab : générer une Application de Page unique (SPA) avec l’API Web ASP.NET et Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="985ff-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="985ff-344">Pour plus d’informations sur la façon tooadd code d’authentification Azure AD, consultez [sécurisation AngularJS Page applications unique avec Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="985ff-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="985ff-345">Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="985ff-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="985ff-346">Assurez-vous de ne pas confondre ToDoListAPI (niveau intermédiaire) et ToDoListDataAPI (couche de données).</span><span class="sxs-lookup"><span data-stu-id="985ff-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="985ff-347">Par exemple, dans ce didacticiel, vous ajoutez l’authentification toohello données couche API app, **mais clé d’une application hello doit provenir d’hello application Azure AD que vous avez créé pour l’application de couche intermédiaire API hello**.</span><span class="sxs-lookup"><span data-stu-id="985ff-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="985ff-348">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="985ff-348">Next steps</span></span>
<span data-ttu-id="985ff-349">Il s’agit de didacticiel de dernière hello Bonjour série d’applications API.</span><span class="sxs-lookup"><span data-stu-id="985ff-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="985ff-350">Pour plus d’informations sur Azure Active Directory, consultez hello suivant des ressources.</span><span class="sxs-lookup"><span data-stu-id="985ff-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="985ff-351">Guide du développeur Azure AD</span><span class="sxs-lookup"><span data-stu-id="985ff-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="985ff-352">Scénarios Azure AD</span><span class="sxs-lookup"><span data-stu-id="985ff-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="985ff-353">Exemples Azure AD</span><span class="sxs-lookup"><span data-stu-id="985ff-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="985ff-354">Hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) exemple est semblable toowhat est indiqué dans ce didacticiel, mais sans utiliser l’authentification du Service d’applications.</span><span class="sxs-lookup"><span data-stu-id="985ff-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="985ff-355">Pour plus d’informations sur les autres méthodes toodeploy Visual Studio projets tooAPI applications, à l’aide de Visual Studio ou [automatiser le déploiement](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) à partir d’un [système de contrôle source](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), consultez [comment toodeploy un Azure App service](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="985ff-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

