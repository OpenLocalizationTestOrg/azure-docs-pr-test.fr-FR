---
title: Authentification utilisateur pour API Apps dans Azure App Service | Microsoft Docs
description: "Découvrez comment protéger une application API dans Azure App Service en accordant l’accès uniquement aux utilisateurs authentifiés."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 3896760d-46ff-4b67-b98a-edd233f24758
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: a5b713f3a60b3886d813438496d704f464d914e6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="user-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="e9dfa-103">Authentification utilisateur pour API Apps dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="e9dfa-103">User authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="e9dfa-104">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="e9dfa-104">Overview</span></span>
<span data-ttu-id="e9dfa-105">Cet article montre comment protéger une application API Azure, afin que seuls les utilisateurs authentifiés puissent l’appeler.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-105">This article shows how to protect an Azure API app so that only authenticated users can call it.</span></span> <span data-ttu-id="e9dfa-106">Cet article suppose que vous avez lu la [Vue d’ensemble de l’authentification Azure App Service](../app-service/app-service-authentication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-106">The article assumes that you have read the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md).</span></span>

<span data-ttu-id="e9dfa-107">Vous apprendrez ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e9dfa-107">You'll learn:</span></span>

* <span data-ttu-id="e9dfa-108">La configuration d’un fournisseur d’authentification, avec des détails destinés à Azure Active Directory (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-108">How to configure an authentication provider, with details for Azure Active Directory (Azure AD).</span></span>
* <span data-ttu-id="e9dfa-109">L’utilisation d’une application API protégée à l’aide d’ [ADAL (Active Directory Authentication Library) pour JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-109">How to consume a protected API app by using the [Active Directory Authentication Library (ADAL) for JavaScript](https://github.com/AzureAD/azure-activedirectory-library-for-js).</span></span>

<span data-ttu-id="e9dfa-110">Cet article contient deux sections :</span><span class="sxs-lookup"><span data-stu-id="e9dfa-110">The article contains two sections:</span></span>

* <span data-ttu-id="e9dfa-111">La section [Configuration de l’authentification utilisateur dans Azure App Service](#authconfig) explique comment configurer l’authentification utilisateur de n’importe quelle application API. Elle s’applique également à toutes les infrastructures prises en charge par App Service, notamment .NET, Node.js et Java.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-111">The [How to configure user authentication in Azure App Service](#authconfig) section explains in general how to configure user authentication for any API app and applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="e9dfa-112">Cet article, qui commence par la section [Suite des didacticiels API Apps .NET](#tutorialstart) , vous guide dans la configuration d’un exemple d’application avec un backend .NET et un frontal AngularJS afin d’utiliser Azure Active Directory pour l’authentification utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-112">Starting with the [Continuing the .NET API Apps tutorials](#tutorialstart) section, the article guides you through configuring a sample application with a .NET back end and an AngularJS front end so that it uses Azure Active Directory for user authentication.</span></span> 

## <span data-ttu-id="e9dfa-113"><a id="authconfig"></a> Configuration de l’authentification utilisateur dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="e9dfa-113"><a id="authconfig"></a> How to configure user authentication in Azure App Service</span></span>
<span data-ttu-id="e9dfa-114">Cette section fournit des instructions générales s’appliquant à n’importe quelle application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-114">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="e9dfa-115">Pour connaître les étapes spécifiques à l’exemple d’application .NET To Do List, passez à la section [Suite des didacticiels de mise en route de .NET](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-115">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET getting-started tutorials](#tutorialstart).</span></span>

1. <span data-ttu-id="e9dfa-116">Dans le [portail Azure](https://portal.azure.com/), accédez au panneau **Paramètres** de l’application API que vous souhaitez protéger, puis recherchez la section **Fonctionnalités** et cliquez sur **Authentification/Autorisation**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-116">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, find the **Features** section, and then click **Authentication/ Authorization**.</span></span>
   
    ![Authentification/Autorisation du portail Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="e9dfa-118">Dans le panneau **Authentification/Autorisation**, cliquez sur **Activé**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-118">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="e9dfa-119">Sélectionnez une des options de la liste déroulante **Action à exécuter quand une demande n’est pas authentifiée** .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-119">Select one of the options from the **Action to take when request is not authenticated** drop-down list.</span></span>
   
   * <span data-ttu-id="e9dfa-120">Si vous souhaitez que seuls les appels authentifiés accèdent à votre application API, choisissez parmi les options **Se connecter avec...** .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-120">If you want only authenticated calls to reach your API app, choose one of the **Log in with ...** options.</span></span> <span data-ttu-id="e9dfa-121">Cette option vous permet de protéger l’application API sans écrire de code s’exécutant dans cette dernière.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-121">This option enables you to protect the API app without writing any code that runs in it.</span></span>
   * <span data-ttu-id="e9dfa-122">Si vous souhaitez que tous les appels accèdent à votre application API, choisissez **Autoriser la demande (aucune action)**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-122">If you want all calls to reach your API app, choose **Allow request (no action)**.</span></span> <span data-ttu-id="e9dfa-123">Vous pouvez utiliser cette option pour diriger les appelants non authentifiés vers une sélection de fournisseurs d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-123">You can use this option to direct unauthenticated callers to a choice of authentication providers.</span></span> <span data-ttu-id="e9dfa-124">Avec cette option, vous devez écrire du code pour gérer l’autorisation.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-124">With this option you have to write code to handle authorization.</span></span>
     
     <span data-ttu-id="e9dfa-125">Pour plus d’informations, consultez la page [Authentification et autorisation pour API Apps dans Azure App Service](app-service-api-authentication.md#multiple-protection-options).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-125">For more information, see [Authentication and authorization for API Apps in Azure App Service](app-service-api-authentication.md#multiple-protection-options).</span></span>
4. <span data-ttu-id="e9dfa-126">Sélectionnez un ou plusieurs **fournisseurs d’authentification**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-126">Select one or more of the **Authentication Providers**.</span></span>
   
    <span data-ttu-id="e9dfa-127">L’image montre les options qui exigent que tous les appelants soient authentifiés par Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-127">The image shows    choices that require all callers to be authenticated by Azure AD.</span></span>
   
    ![Panneau Authentification/Autorisation du portail Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
   
    <span data-ttu-id="e9dfa-129">Lorsque vous choisissez un fournisseur d’authentification, le portail affiche un panneau de configuration correspondant à ce fournisseur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-129">When you choose an authentication provider, the portal displays a configuration blade for that provider.</span></span> 
   
    <span data-ttu-id="e9dfa-130">Pour obtenir des instructions détaillées sur la procédure de configuration des panneaux de configuration du fournisseur d’authentification, consultez la page [Configurer votre application App Service pour utiliser la connexion Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-130">For detailed instructions that explain how to configure the authentication provider configuration blades, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span> <span data-ttu-id="e9dfa-131">(Le lien mène à un article sur Azure AD, mais l’article lui-même contient des onglets associés à des articles destinés aux autres fournisseurs d’authentification).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-131">(The link goes to an article about Azure AD, but the article itself contains tabs that link to articles for the other authentication providers.)</span></span>
5. <span data-ttu-id="e9dfa-132">Une fois que vous en avez terminé avec le panneau de configuration du fournisseur d’authentification, cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-132">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
6. <span data-ttu-id="e9dfa-133">Dans le panneau **Authentification/Autorisation**, cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-133">In the **Authentication / Authorization** blade, click **Save**.</span></span>

<span data-ttu-id="e9dfa-134">App Service authentifie alors tous les appels API avant qu’ils atteignent l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-134">When this is done, App Service authenticates all API calls before they reach the API app.</span></span> <span data-ttu-id="e9dfa-135">Ces services d’authentification fonctionnent de la même manière pour tous les langages pris en charge par App Service, notamment .NET, Node.js et Java.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-135">The authentication services work the same for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

<span data-ttu-id="e9dfa-136">Pour exécuter des appels d’API authentifiés, l’appelant inclut le jeton de porteur OAuth 2.0 du fournisseur d’authentification dans l’en-tête d’autorisation des demandes HTTP.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-136">To make authenticated API calls, the caller includes the authentication provider's OAuth 2.0 bearer token in the Authorization header of HTTP requests.</span></span> <span data-ttu-id="e9dfa-137">Le jeton peut être acquis à l’aide du kit de développement logiciel du fournisseur d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-137">The token can be acquired by using the authentication provider's SDK.</span></span>

## <span data-ttu-id="e9dfa-138"><a id="tutorialstart"></a> Suite des didacticiels API Apps .NET</span><span class="sxs-lookup"><span data-stu-id="e9dfa-138"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorials</span></span>
<span data-ttu-id="e9dfa-139">Si vous suivez les didacticiels Node.js ou Java pour les applications API, passez à l’article suivant, intitulé [Authentification de principal du service pour API Apps](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-139">If you are following the Node.js or Java tutorials for API apps, skip to the next article, [service principal authentication for API apps](app-service-api-dotnet-service-principal-auth.md).</span></span> 

<span data-ttu-id="e9dfa-140">Si vous suivez la série de didacticiels .NET pour les applications API et si vous avez déjà déployé l’exemple d’application comme indiqué dans les [premier](app-service-api-dotnet-get-started.md) et [deuxième](app-service-api-cors-consume-javascript.md) didacticiels, passez à la section [Configurer l’authentification dans App Service et Azure AD](#azureauth).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-140">If you are following the .NET tutorial series for API apps and have already deployed the sample application as directed in the [first](app-service-api-dotnet-get-started.md) and [second](app-service-api-cors-consume-javascript.md) tutorials, skip to the [Set up authentication in App Service and Azure AD](#azureauth) section.</span></span>

<span data-ttu-id="e9dfa-141">Si vous souhaitez suivre ce didacticiel sans suivre le premier et le deuxième didacticiels, effectuez les étapes suivantes, qui expliquent comment commencer en utilisant un processus automatisé pour déployer l’exemple d’application.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-141">If you want to follow this tutorial without going through the first and second tutorials, do the following steps which explain how to get started by using an automated process to deploy the sample application.</span></span>

> [!NOTE]
> <span data-ttu-id="e9dfa-142">Les étapes suivantes vous mènent au même point de départ que si vous aviez suivi les deux premiers didacticiels, à une exception près : Visual Studio ne sait pas vers quelle application web ou application API chaque projet est déployé.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-142">The following steps get you to the same starting point as if you did the first two tutorials, with one exception: Visual Studio won't already know which web app or API app that each project gets deployed to.</span></span> <span data-ttu-id="e9dfa-143">Cela signifie que ce didacticiel ne vous présentera pas d’instructions précises pour déployer vers les bonnes cibles.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-143">That means you won't have exact instructions in this tutorial that explain how to deploy to the right targets.</span></span> <span data-ttu-id="e9dfa-144">Si vous ne vous sentez pas suffisamment à l’aise pour effectuer seul les étapes de déploiement, il est préférable de suivre la série de didacticiels à partir du [premier didacticiel](app-service-api-dotnet-get-started.md) plutôt que de commencer par ce processus de déploiement automatisé.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-144">If you're not comfortable with figuring out how to do the deployment steps on your own, it's better to follow the tutorial series from the [first tutorial](app-service-api-dotnet-get-started.md) than to start with this automated deployment process.</span></span>
> 
> 

1. <span data-ttu-id="e9dfa-145">Assurez-vous de disposer de tous les composants requis répertoriés dans le [premier didacticiel](app-service-api-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-145">Make sure that you have all of the prerequisites listed in the [first tutorial](app-service-api-dotnet-get-started.md).</span></span> <span data-ttu-id="e9dfa-146">Outre la configuration requise indiquée, ces didacticiels d’authentification supposent que vous avez déjà travaillé avec des applications web et des applications API App Service dans Visual Studio et le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-146">In addition to the prerequisites listed, these authentication tutorials assume that you have worked with App Service web apps and API apps in Visual Studio and the Azure portal.</span></span>
2. <span data-ttu-id="e9dfa-147">Cliquez sur le bouton **Déployer dans Azure** dans le [fichier readme du référentiel de l’exemple To Do List](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) pour déployer les applications API et l’application web.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-147">Click the **Deploy to Azure** button in the [To Do List sample repository readme file](https://github.com/azure-samples/app-service-api-dotnet-todo-list/blob/master/readme.md) to deploy the API apps and the web app.</span></span> <span data-ttu-id="e9dfa-148">Prenez note du groupe de ressources Azure qui est créé, car vous pourrez l’utiliser ultérieurement pour rechercher les noms de l’application API et de l’application web.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-148">Make a note of the Azure resource group that gets created, as you can use this later to look up web app and API app names.</span></span>
3. <span data-ttu-id="e9dfa-149">Téléchargez ou clonez le [référentiel de l’exemple To Do List](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) pour obtenir le code que vous utiliserez localement dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-149">Download or clone the [To Do List sample repository](https://github.com/Azure-Samples/app-service-api-dotnet-todo-list) to get the code that you'll work with locally in Visual Studio.</span></span>

## <span data-ttu-id="e9dfa-150"><a id="azureauth"></a> Configurer l’authentification dans App Service et Azure AD</span><span class="sxs-lookup"><span data-stu-id="e9dfa-150"><a id="azureauth"></a> Set up authentication in App Service and Azure AD</span></span>
<span data-ttu-id="e9dfa-151">L’application s’exécute désormais dans Azure App Service sans exiger que les utilisateurs soient authentifiés.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-151">You now have the application running in Azure App Service without requiring that users be authenticated.</span></span> <span data-ttu-id="e9dfa-152">Dans cette section, vous allez ajouter l’authentification en effectuant les tâches suivantes :</span><span class="sxs-lookup"><span data-stu-id="e9dfa-152">In this section you add authentication by doing the following tasks:</span></span>

* <span data-ttu-id="e9dfa-153">Configurez App Service pour qu’elle exige une authentification Azure Active Directory (Azure AD) pour appeler l’application API de niveau intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-153">Configure App Service to require Azure Active Directory (Azure AD) authentication for calling the middle tier API app.</span></span>
* <span data-ttu-id="e9dfa-154">Créez une application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-154">Create an Azure AD application.</span></span>
* <span data-ttu-id="e9dfa-155">Configurez l’application Azure AD pour envoyer le jeton de porteur après la connexion au frontal AngularJS.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-155">Configure the Azure AD application to send the bearer token after logon to the AngularJS front end.</span></span> 

<span data-ttu-id="e9dfa-156">Si vous rencontrez des problèmes en suivant les instructions du didacticiel, consultez la section [Résolution de problèmes](#troubleshooting) à la fin du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-156">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

### <a name="configure-authentication-for-the-middle-tier-api-app"></a><span data-ttu-id="e9dfa-157">Configurer l’authentification pour l’application API de niveau intermédiaire</span><span class="sxs-lookup"><span data-stu-id="e9dfa-157">Configure authentication for the middle tier API app</span></span>
1. <span data-ttu-id="e9dfa-158">Dans le [portail Azure](https://portal.azure.com/), accédez au panneau **Paramètres** de l’application API que vous avez créée pour le projet ToDoListAPI, recherchez la section **Fonctionnalités** et cliquez sur **Authentification/Autorisation**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-158">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListAPI project, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Authentification/Autorisation du portail Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="e9dfa-160">Dans le panneau **Authentification/Autorisation**, cliquez sur **Activé**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-160">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="e9dfa-161">Dans la liste déroulante **Action à effectuer lorsque la demande n’est pas authentifiée**, sélectionnez **Se connecter avec Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-161">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="e9dfa-162">Cette option permet de s’assurer qu’aucune demande non authentifiée n’atteindra l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-162">This option ensures that no unauathenticated requests will reach the API app.</span></span> 
4. <span data-ttu-id="e9dfa-163">Sous **Fournisseurs d’authentification**, cliquez sur **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-163">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Panneau Authentification/Autorisation du portail Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="e9dfa-165">Dans le panneau **Paramètres Azure Active Directory**, cliquez sur **Express**</span><span class="sxs-lookup"><span data-stu-id="e9dfa-165">In the **Azure Active Directory Settings** blade, click **Express**</span></span>
   
    ![Option Express du panneau Authentification/Autorisation du portail Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings.png)
   
    <span data-ttu-id="e9dfa-167">Avec l’option **Express**, App Service permet à Azure AD de créer automatiquement une application Azure AD dans le [client](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-167">With the **Express** option, App Service can automatically create an Azure AD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="e9dfa-168">Vous n’avez pas à créer un client, car chaque compte Azure en possède un.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-168">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
6. <span data-ttu-id="e9dfa-169">Sous **Mode d’administration**, cliquez sur **Créer une application AD** si cette option n’est pas déjà sélectionnée, notez la valeur qui se trouve dans la zone de texte **Créer une application**. Vous allez rechercher cette application AAD dans le portail Azure Classic plus tard.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-169">Under **Management mode**, click **Create New AD App** if it isn't already selected, and notice the value that is in the **Create App** text box; you'll look up this AAD application in the Azure classic portal later.</span></span>
   
    ![Paramètres Azure AD du portail Azure](./media/app-service-api-dotnet-user-principal-auth/aadsettings2.png)
   
    <span data-ttu-id="e9dfa-171">Azure crée automatiquement une application Azure AD avec le nom indiqué dans votre client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-171">Azure will automatically create an Azure AD application with the indicated name in your Azure AD tenant.</span></span> <span data-ttu-id="e9dfa-172">Par défaut, l’application Azure AD porte le même nom que celui de l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-172">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="e9dfa-173">Vous pouvez, si vous le souhaitez, choisir un autre nom.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-173">If you prefer, you can enter a different name.</span></span>
7. <span data-ttu-id="e9dfa-174">Cliquez sur **OK**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-174">Click **OK**.</span></span>
8. <span data-ttu-id="e9dfa-175">Dans le panneau **Authentification/Autorisation**, cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-175">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Cliquez sur Enregistrer.](./media/app-service-api-dotnet-user-principal-auth/authsave.png)

<span data-ttu-id="e9dfa-177">Maintenant, seuls les utilisateurs de votre client Azure AD peuvent appeler l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-177">Now only users in your Azure AD tenant can call the API app.</span></span>

### <a name="optional-test-the-api-app"></a><span data-ttu-id="e9dfa-178">Facultatif : tester l’application API</span><span class="sxs-lookup"><span data-stu-id="e9dfa-178">Optional: Test the API app</span></span>
1. <span data-ttu-id="e9dfa-179">Dans un navigateur, accédez à l’URL de l’application API : dans le panneau **Application API** du portail Azure, cliquez sur le lien situé sous **URL**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-179">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span>  
   
    <span data-ttu-id="e9dfa-180">Vous êtes redirigé vers un écran de connexion, car les demandes non authentifiées ne sont pas autorisées à atteindre l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-180">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span>
   
    <span data-ttu-id="e9dfa-181">Si votre navigateur accède à la page « créé avec succès », le navigateur peut déjà être connecté. Dans ce cas, ouvrez une fenêtre InPrivate ou Incognito et accédez à l’URL de l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-181">If your browser goes to the "successfully created" page, the browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the API app's URL.</span></span>
2. <span data-ttu-id="e9dfa-182">Connectez-vous avec les informations d’identification d’un utilisateur de votre client Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-182">Log on using credentials for a user in your Azure AD tenant.</span></span>
   
    <span data-ttu-id="e9dfa-183">Une fois que vous êtes connecté, la page signalant que la création a réussi s’affiche dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-183">When you're logged on, the "successfully created" page appears in the browser.</span></span>
3. <span data-ttu-id="e9dfa-184">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-184">Close the browser.</span></span>

### <a name="configure-the-azure-ad-application"></a><span data-ttu-id="e9dfa-185">Configuration de l’application Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="e9dfa-185">Configure the Azure AD application</span></span>
<span data-ttu-id="e9dfa-186">Lorsque vous avez configuré l’authentification Azure AD, App Service a créé pour vous une application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-186">When you configured Azure AD authentication, App Service created an Azure AD application for you.</span></span> <span data-ttu-id="e9dfa-187">Par défaut, la nouvelle application Azure AD a été configurée pour fournir le jeton de porteur à l’URL de l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-187">By default the new Azure AD application was configured to provide the bearer token to the API app's URL.</span></span> <span data-ttu-id="e9dfa-188">Dans cette section, vous allez configurer l’application Azure AD pour fournir le jeton de porteur au frontal AngularJS plutôt que directement à l’application de niveau intermédiaire de l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-188">In this section you configure the Azure AD application to provide the bearer token to the AngularJS front end instead of directly to the middle tier API app.</span></span> <span data-ttu-id="e9dfa-189">Le frontal AngularJS envoie le jeton à l’application API lorsqu’il appelle l’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-189">The AngularJS front end will send the token to the API app when it calls the API app.</span></span>

> [!NOTE]
> <span data-ttu-id="e9dfa-190">Pour conserver un processus qui soit le plus simple possible, ce didacticiel utilise une seule application Azure AD pour le serveur frontal et l’application API de niveau intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-190">To keep the process as simple as possible, this tutorial uses a single Azure AD application for both the front end and the middle tier API app.</span></span> <span data-ttu-id="e9dfa-191">Une autre option consiste à utiliser deux applications Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-191">Another option is to use two Azure AD applications.</span></span> <span data-ttu-id="e9dfa-192">Dans ce cas, vous devez autoriser l’application Azure AD du serveur frontal à appeler l’application Azure AD de niveau intermédiaire.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-192">In that case you would have to give the front end's Azure AD application permission to call the middle tier's Azure AD application.</span></span> <span data-ttu-id="e9dfa-193">Cette approche à plusieurs applications permet d’obtenir un contrôle plus granulaire sur les autorisations à chaque niveau.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-193">This multi-application approach would give you more granular control over permissions to each tier.</span></span>
> 
> 

1. <span data-ttu-id="e9dfa-194">Dans le [portail Azure Classic](https://manage.windowsazure.com/), accédez à **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-194">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
   
   <span data-ttu-id="e9dfa-195">Vous devez utiliser le portail classique, car certains paramètres Azure Active Directory auxquels vous devez accéder ne sont pas encore disponibles dans le portail Azure actuel.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-195">You have to use the classic portal because certain Azure Active Directory settings that you need access to are not yet available in the current Azure portal.</span></span>
2. <span data-ttu-id="e9dfa-196">Sous l’onglet **Annuaire** , cliquez sur votre client AAD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-196">On the **Directory** tab, click your AAD tenant.</span></span>
   
   ![Azure AD dans le portail classique](./media/app-service-api-dotnet-user-principal-auth/selecttenant.png)
3. <span data-ttu-id="e9dfa-198">Cliquez sur **Applications > Applications que ma société possède**, puis cliquez sur la coche.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-198">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
   
   <span data-ttu-id="e9dfa-199">Vous devrez peut-être aussi actualiser la page pour afficher la nouvelle application.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-199">You might also have to refresh the page to see the new application.</span></span>
4. <span data-ttu-id="e9dfa-200">Dans la liste des applications, cliquez sur le nom de celle qu’Azure a créée pour vous quand vous avez activé l’authentification pour votre application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-200">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for your API app.</span></span>
   
   ![Onglet Applications Azure AD](./media/app-service-api-dotnet-user-principal-auth/appstab.png)
5. <span data-ttu-id="e9dfa-202">Cliquez sur **Configurer**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-202">Click **Configure**.</span></span>
   
   ![Onglet Configurer Azure AD](./media/app-service-api-dotnet-user-principal-auth/configure.png)
6. <span data-ttu-id="e9dfa-204">Définissez **URL de connexion** sur l’URL de votre application web AngularJS, sans barre oblique à la fin.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-204">Set **Sign-on URL** to the URL for your AngularJS web app, no trailing slash.</span></span>
   
   <span data-ttu-id="e9dfa-205">Par exemple : https://todolistangular.azurewebsites.net</span><span class="sxs-lookup"><span data-stu-id="e9dfa-205">For example: https://todolistangular.azurewebsites.net</span></span>
   
   ![URL de connexion](./media/app-service-api-dotnet-user-principal-auth/signonurlazure.png)
7. <span data-ttu-id="e9dfa-207">Définissez **URL de réponse** sur l’URL de votre application web, sans barre oblique à la fin.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-207">Set **Reply URL** to the URL for your web app, no trailing slash.</span></span>
   
   <span data-ttu-id="e9dfa-208">Par exemple : https://todolistsangular.azurewebsites.net</span><span class="sxs-lookup"><span data-stu-id="e9dfa-208">For example: https://todolistsangular.azurewebsites.net</span></span>
8. <span data-ttu-id="e9dfa-209">Cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-209">Click **Save**.</span></span>
   
   ![URL de réponse](./media/app-service-api-dotnet-user-principal-auth/replyurlazure.png)
9. <span data-ttu-id="e9dfa-211">En bas de la page, cliquez sur **Gérer le manifeste > Télécharger le manifeste**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-211">At the bottom of the page, click **Manage manifest > Download manifest**.</span></span>
   
   ![Télécharger le manifeste](./media/app-service-api-dotnet-user-principal-auth/downloadmanifest.png)
10. <span data-ttu-id="e9dfa-213">Téléchargez le fichier à un emplacement où vous pouvez le modifier.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-213">Download the file to a location where you can edit it.</span></span>
11. <span data-ttu-id="e9dfa-214">Dans le fichier manifeste téléchargé, recherchez la propriété `oauth2AllowImplicitFlow`.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-214">In the downloaded manifest file, search for the  `oauth2AllowImplicitFlow` property.</span></span> <span data-ttu-id="e9dfa-215">Modifiez la valeur de cette propriété en remplaçant `false` par `true`, puis enregistrez le fichier.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-215">Change the value of this property from `false` to `true`, and then save the file.</span></span>
    
    <span data-ttu-id="e9dfa-216">Ce paramètre est obligatoire pour l’accès depuis une application de page JavaScript unique.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-216">This setting is required for access from a JavaScript single-page application.</span></span> <span data-ttu-id="e9dfa-217">Il permet au jeton de porteur Oauth 2.0 d’être renvoyé dans le fragment d’URL.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-217">It enables the Oauth 2.0 bearer token to be returned in the URL fragment.</span></span>
12. <span data-ttu-id="e9dfa-218">Cliquez sur **Gérer le manifeste > Télécharger le manifeste**, puis chargez le fichier mis à jour à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-218">Click **Manage manifest > Upload manifest**, and upload the file that you updated in the preceding step.</span></span>
    
    ![Télécharger le manifeste sur le serveur](./media/app-service-api-dotnet-user-principal-auth/uploadmanifest.png)
13. <span data-ttu-id="e9dfa-220">Copiez la valeur **ID client** et enregistrez-la à un emplacement où vous pourrez la récupérer par la suite.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-220">Copy the **Client ID** value and save it somewhere you can get it from later.</span></span>

## <a name="configure-the-todolistangular-project-to-use-authentication"></a><span data-ttu-id="e9dfa-221">Configurer le projet ToDoListAngular pour utiliser l’authentification</span><span class="sxs-lookup"><span data-stu-id="e9dfa-221">Configure the ToDoListAngular project to use authentication</span></span>
<span data-ttu-id="e9dfa-222">Dans cette section, vous allez modifier le serveur frontal AngularJS afin qu’il utilise ADAL (Active Directory Authentication Library) pour que JS acquière un jeton de porteur pour l’utilisateur connecté à partir d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-222">In this section you change the AngularJS front end so that it uses Active Directory Authentication Library (ADAL) for JS to acquire a bearer token for the logged-on user from Azure AD.</span></span> <span data-ttu-id="e9dfa-223">Le code inclut le jeton dans les requêtes HTTP envoyées au niveau intermédiaire, comme l’indique le diagramme suivant.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-223">The code will include the token in HTTP requests sent to the middle tier, as shown in the following diagram.</span></span> 

![Diagramme d’authentification de l’utilisateur](./media/app-service-api-dotnet-user-principal-auth/appdiagram.png)

<span data-ttu-id="e9dfa-225">Apportez les modifications suivantes au projet ToDoListAngular.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-225">Make the following changes to files in the ToDoListAngular project.</span></span>

1. <span data-ttu-id="e9dfa-226">Ouvrez le fichier *index.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-226">Open the *index.cshtml* file.</span></span>
2. <span data-ttu-id="e9dfa-227">Supprimez les commentaires des lignes faisant référence à la bibliothèque d’authentification Active Directory (ADAL) pour les scripts JS.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-227">Uncomment the lines that reference the Active Directory Authentication Library (ADAL) for JS scripts.</span></span>
   
        <script src="app/scripts/adal.js"></script>
        <script src="app/scripts/adal-angular.js"></script>
3. <span data-ttu-id="e9dfa-228">Ouvrez le fichier *app/scripts/app.js* .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-228">Open the *app/scripts/app.js* file.</span></span>
4. <span data-ttu-id="e9dfa-229">Supprimez le commentaire du bloc de code marqué pour « sans authentification » et supprimez le bloc de code marqué « avec authentification ».</span><span class="sxs-lookup"><span data-stu-id="e9dfa-229">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>
   
    <span data-ttu-id="e9dfa-230">Cette modification fait référence au fournisseur d’authentification ADAL JS et lui fournit des valeurs de configuration.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-230">This change references the ADAL JS authentication provider and provides configuration values to it.</span></span> <span data-ttu-id="e9dfa-231">Lors des étapes suivantes, vous allez définir les valeurs de configuration pour votre application API et l’application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-231">In the following steps you set the configuration values for your API app and Azure AD application.</span></span>
5. <span data-ttu-id="e9dfa-232">Dans le code qui définit la variable `endpoints` , définissez l’URL de l’API sur l’URL de l’application API créée pour le projet ToDoListAPI et définissez l’ID d’application Azure AD sur l’ID client que vous avez copié depuis le portail Azure Classic.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-232">In the code that sets the `endpoints` variable, set the API URL to the URL of the API app that you created for the ToDoListAPI project, and set the Azure AD application ID to the client ID that you copied from the Azure classic portal.</span></span>
   
    <span data-ttu-id="e9dfa-233">Le code ressemble maintenant à l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-233">The code is now similar to the following example.</span></span>
   
        var endpoints = {
            "https://todolistapi0121.azurewebsites.net/": "1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3"
        };
6. <span data-ttu-id="e9dfa-234">Dans l’appel de `adalProvider.init`, définissez `tenant` sur votre nom de client et `clientId` sur la valeur utilisée à l’étape précédente.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-234">In the call to `adalProvider.init`, set `tenant` to your tenant name and `clientId` to same value you used in the previous step.</span></span>
   
    <span data-ttu-id="e9dfa-235">Le code ressemble maintenant à l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-235">The code is now similar to the following example.</span></span>
   
        adalProvider.init(
            {
                instance: 'https://login.microsoftonline.com/', 
                tenant: 'contoso.onmicrosoft.com',
                clientId: '1cf55bc9-9ed8-4df31cf55bc9-9ed8-4df3',
                extraQueryParameter: 'nux=1',
                endpoints: endpoints
            },
            $httpProvider
            );
   
    <span data-ttu-id="e9dfa-236">Ces modifications de `app.js` indiquent que le code appelant et l’API appelée se trouvent dans la même application Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-236">These changes to `app.js` specify that the calling code and the called API are in the same Azure AD application.</span></span>
7. <span data-ttu-id="e9dfa-237">Ouvrez le fichier *app/scripts/homeCtrl.js* .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-237">Open the *app/scripts/homeCtrl.js* file.</span></span>
8. <span data-ttu-id="e9dfa-238">Supprimez le commentaire du bloc de code marqué pour « sans authentification » et supprimez le bloc de code marqué « avec authentification ».</span><span class="sxs-lookup"><span data-stu-id="e9dfa-238">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>
9. <span data-ttu-id="e9dfa-239">Ouvrez le fichier *app/scripts/indexCtrl.js* .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-239">Open the *app/scripts/indexCtrl.js* file.</span></span>
10. <span data-ttu-id="e9dfa-240">Supprimez le commentaire du bloc de code marqué pour « sans authentification » et supprimez le bloc de code marqué « avec authentification ».</span><span class="sxs-lookup"><span data-stu-id="e9dfa-240">Comment out the block of code marked for "without authentication" and uncomment the block of code marked for "with authentication".</span></span>

### <a name="deploy-the-todolistangular-project-to-azure"></a><span data-ttu-id="e9dfa-241">Déployer le projet ToDoListAngular dans Azure</span><span class="sxs-lookup"><span data-stu-id="e9dfa-241">Deploy the ToDoListAngular project to Azure</span></span>
1. <span data-ttu-id="e9dfa-242">Dans l’**Explorateur de solutions**, cliquez avec le bouton droit sur le projet ToDoListAngular, puis cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-242">In **Solution Explorer**, right-click the ToDoListAngular project, and then click **Publish**.</span></span>
2. <span data-ttu-id="e9dfa-243">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-243">Click **Publish**.</span></span>
   
    <span data-ttu-id="e9dfa-244">Visual Studio déploie le projet et ouvre un navigateur vers l’URL de base d’application Web.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-244">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="e9dfa-245">Cette commande affiche la page d’erreur 403, ce qui est normal pour une tentative d’accès à une URL de base d’API Web depuis un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-245">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
   
    <span data-ttu-id="e9dfa-246">Vous devez toujours apporter une modification à l’application API de niveau intermédiaire avant de pouvoir tester l’application.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-246">You still have to make a change to the middle tier API app before you can test the application.</span></span>
3. <span data-ttu-id="e9dfa-247">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-247">Close the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-use-authentication"></a><span data-ttu-id="e9dfa-248">Configurer le projet ToDoListAPI pour utiliser l’authentification</span><span class="sxs-lookup"><span data-stu-id="e9dfa-248">Configure the ToDoListAPI project to use authentication</span></span>
<span data-ttu-id="e9dfa-249">Pour le moment, le projet ToDoListAPI envoie « * » comme valeur `owner` pour ToDoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-249">Currently the ToDoListAPI project sends "*" as the `owner` value to ToDoListDataAPI.</span></span> <span data-ttu-id="e9dfa-250">Dans cette section, vous allez modifier le code pour envoyer l’ID de l’utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-250">In this section you change the code to send the ID of the logged-on user.</span></span>

<span data-ttu-id="e9dfa-251">Apportez les modifications suivantes au projet ToDoListAPI.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-251">Make the following changes in the ToDoListAPI project.</span></span>

1. <span data-ttu-id="e9dfa-252">Ouvrez le fichier *Controllers/ToDoListController.cs* et supprimez les commentaires correspondant à la ligne de chaque méthode d’action définissant `owner` sur la valeur de revendication `NameIdentifier` d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-252">Open the *Controllers/ToDoListController.cs* file, and uncomment the line in each action method that sets `owner` to the Azure AD `NameIdentifier` claim value.</span></span> <span data-ttu-id="e9dfa-253">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="e9dfa-253">For example:</span></span>
   
        owner = ((ClaimsIdentity)User.Identity).FindFirst(ClaimTypes.NameIdentifier).Value;
   
    <span data-ttu-id="e9dfa-254">**Important** : ne supprimez pas les commentaires de code dans la méthode `ToDoListDataAPI`. Vous le ferez plus tard dans le didacticiel d’authentification du principal du service.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-254">**Important**: Don't uncomment code in the `ToDoListDataAPI` method; you'll do that later for the service principal authentication tutorial.</span></span>

### <a name="deploy-the-todolistapi-project-to-azure"></a><span data-ttu-id="e9dfa-255">Déployez le projet ToDoListAPI vers Azure</span><span class="sxs-lookup"><span data-stu-id="e9dfa-255">Deploy the ToDoListAPI project to Azure</span></span>
1. <span data-ttu-id="e9dfa-256">Dans l’**Explorateur de solutions**, cliquez avec le bouton droit sur le projet ToDoListAPI, puis cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-256">In **Solution Explorer**, right-click the ToDoListAPI project, and then click **Publish**.</span></span>
2. <span data-ttu-id="e9dfa-257">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-257">Click **Publish**.</span></span>
   
    <span data-ttu-id="e9dfa-258">Visual Studio déploie le projet et ouvre un navigateur vers l’URL de base d’application API.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-258">Visual Studio deploys the project and opens a browser to the API app's base URL.</span></span>
3. <span data-ttu-id="e9dfa-259">Fermez le navigateur.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-259">Close the browser.</span></span>

### <a name="test-the-application"></a><span data-ttu-id="e9dfa-260">Test de l'application</span><span class="sxs-lookup"><span data-stu-id="e9dfa-260">Test the application</span></span>
1. <span data-ttu-id="e9dfa-261">Accédez à l’URL de l’application web, **Utilisation de HTTPS et non de HTTP**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-261">Go to the URL of the web app, **using HTTPS, not HTTP**.</span></span>
2. <span data-ttu-id="e9dfa-262">Cliquez sur l’onglet **To Do List** .</span><span class="sxs-lookup"><span data-stu-id="e9dfa-262">Click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="e9dfa-263">Vous êtes invité à vous connecter.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-263">You are prompted to log in.</span></span>
3. <span data-ttu-id="e9dfa-264">Connectez-vous avec les informations d’identification d’un utilisateur dans votre client AAD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-264">Log in with the credentials of a user in your AAD tenant.</span></span>
4. <span data-ttu-id="e9dfa-265">La page **To do List** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-265">The **To Do List** page appears.</span></span>
   
   ![Page To Do List](./media/app-service-api-dotnet-user-principal-auth/webappindex.png)
   
   <span data-ttu-id="e9dfa-267">Aucune tâche ne s’affiche, car jusqu’ici, elles étaient toutes pour le propriétaire « * ».</span><span class="sxs-lookup"><span data-stu-id="e9dfa-267">No to-do items are displayed because until now they have all been for owner "*".</span></span> <span data-ttu-id="e9dfa-268">Maintenant le niveau intermédiaire demande des éléments pour l’utilisateur connecté, et aucun n’a encore été créé.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-268">Now the middle tier is requesting items for the logged-on user, and none have been created yet.</span></span>
5. <span data-ttu-id="e9dfa-269">Ajoutez de nouveaux éléments de tâche pour vérifier que l’application fonctionne.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-269">Add new to-do items to verify that the application is working.</span></span>
6. <span data-ttu-id="e9dfa-270">Dans une autre fenêtre de navigateur, accédez à l’URL de l’interface utilisateur Swagger pour l’application API ToDoListDataAPI, puis cliquez sur **ToDoList > Get**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-270">In another browser window, go to the Swagger UI URL for the ToDoListDataAPI API app and click **ToDoList > Get**.</span></span> <span data-ttu-id="e9dfa-271">Entrez un astérisque en tant que paramètre `owner` , puis cliquez sur **Try it out**.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-271">Enter an asterisk for the `owner` parameter, and then click **Try it out**.</span></span>
   
   <span data-ttu-id="e9dfa-272">La réponse indique que la propriété Propriétaire des nouveaux éléments de tâche contient l’ID d’utilisateur Active Directory Azure.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-272">The response shows that the new to-do items have the actual Azure AD user ID in the Owner property.</span></span>
   
   ![ID du propriétaire de la réponse JSON](./media/app-service-api-dotnet-user-principal-auth/todolistapiauth.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="e9dfa-274">Génération de projets de toutes pièces</span><span class="sxs-lookup"><span data-stu-id="e9dfa-274">Building the projects from scratch</span></span>
<span data-ttu-id="e9dfa-275">Les deux projets d’API Web ont été créés à l’aide du modèle de projet **Azure API App** et par remplacement du contrôleur Values par défaut par un contrôleur ToDoList.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-275">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> 

<span data-ttu-id="e9dfa-276">Pour plus d’informations sur la création d’une application à page unique AngularJS avec un backend d’API Web 2, consultez [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs) (Exercice pratique : créer une application à page unique (SPA) avec l’API Web ASP.NET et Angular.js).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-276">For information about how to  create an AngularJS single-page application with a Web API 2 back end, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="e9dfa-277">Pour plus d’informations sur l’ajout du code d’authentification Azure AD, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="e9dfa-277">For information about how to add Azure AD authentication code, see the following resources:</span></span>

* <span data-ttu-id="e9dfa-278">[Sécurisation d’une application à page unique AngularJS avec Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-278">[Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>
* [<span data-ttu-id="e9dfa-279">Présentation de JS ADAL v1</span><span class="sxs-lookup"><span data-stu-id="e9dfa-279">Introducing ADAL JS v1</span></span>](http://www.cloudidentity.com/blog/2015/02/19/introducing-adal-js-v1/)

## <a name="troubleshooting"></a><span data-ttu-id="e9dfa-280">Résolution de problèmes</span><span class="sxs-lookup"><span data-stu-id="e9dfa-280">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="e9dfa-281">Assurez-vous de ne pas confondre ToDoListAPI (niveau intermédiaire) et ToDoListDataAPI (couche de données).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-281">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="e9dfa-282">Par exemple, vérifiez que vous avez ajouté l’authentification à l’application API de niveau intermédiaire, pas la couche de données.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-282">For example, verify that you added authentication to the middle tier API app, not the data tier.</span></span> 
* <span data-ttu-id="e9dfa-283">Assurez-vous que le code source AngularJS fait référence à l’URL de l’application API de niveau intermédiaire (ToDoListAPI, pas ToDoListDataAPI) et à l’ID client correct d’Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-283">Make sure that the AngularJS source code references the middle tier API app URL (ToDoListAPI, not ToDoListDataAPI)and the correct Azure AD client ID.</span></span> 

## <a name="next-steps"></a><span data-ttu-id="e9dfa-284">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="e9dfa-284">Next steps</span></span>
<span data-ttu-id="e9dfa-285">Ce didacticiel vous a montré comment utiliser l’authentification du Service d’application pour une application API et comment appeler l’application API à l’aide de la bibliothèque ADAL JS.</span><span class="sxs-lookup"><span data-stu-id="e9dfa-285">In this tutorial you learned how to use App Service authentication for an API app and how to call the API app by using the ADAL JS library.</span></span> <span data-ttu-id="e9dfa-286">Dans le didacticiel suivant, vous allez découvrir comment [sécuriser l’accès à votre application API pour les scénarios de service à service](app-service-api-dotnet-service-principal-auth.md).</span><span class="sxs-lookup"><span data-stu-id="e9dfa-286">In the next tutorial you'll learn how to [secure access to your API app for service-to-service scenarios](app-service-api-dotnet-service-principal-auth.md).</span></span>

