---
title: "aaaCalling un Runbook Azure Automation à partir d’une alerte Analytique de journal | Documents Microsoft"
description: "Cet article fournit une vue d’ensemble de la manière tooinvoke un runbook Automation à partir d’une alerte Microsoft OMS journal Analytique."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="671c8-103">Appel d’un runbook Azure Automation à partir d’une alerte OMS Log Analytics</span><span class="sxs-lookup"><span data-stu-id="671c8-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="671c8-104">Lorsqu’une alerte est configurée dans le journal Analytique toocreate un enregistrement d’alerte si les résultats correspondent aux critères particuliers, tels qu’un pic prolongé dans l’utilisation du processeur ou une application particulière processus toohello critiques des fonctionnalités d’une application métier échoue et écrit un événement correspondant dans le journal des événements Windows hello, cette alerte peut exécuter automatiquement un runbook Automation dans un tooauto tentative-corriger le problème de hello.</span><span class="sxs-lookup"><span data-stu-id="671c8-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="671c8-105">Il y a deux options toocall un runbook pour la configuration d’alerte de hello.</span><span class="sxs-lookup"><span data-stu-id="671c8-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="671c8-106">Plus précisément :</span><span class="sxs-lookup"><span data-stu-id="671c8-106">Specifically,</span></span>

1. <span data-ttu-id="671c8-107">Utilisation d’un webhook.</span><span class="sxs-lookup"><span data-stu-id="671c8-107">Using a Webhook.</span></span>
   * <span data-ttu-id="671c8-108">Il s’agit de hello seule option si votre espace de travail OMS n’est pas lié tooan compte Automation.</span><span class="sxs-lookup"><span data-stu-id="671c8-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="671c8-109">Si vous disposez déjà d’un espace de travail Automation compte lié tooan OMS, cette option est toujours disponible.</span><span class="sxs-lookup"><span data-stu-id="671c8-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="671c8-110">Sélection directe d’un runbook.</span><span class="sxs-lookup"><span data-stu-id="671c8-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="671c8-111">Cette option est disponible uniquement lorsque l’espace de travail OMS hello est lié tooan compte Automation.</span><span class="sxs-lookup"><span data-stu-id="671c8-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="671c8-112">Appel d’un runbook à l’aide d’un webhook</span><span class="sxs-lookup"><span data-stu-id="671c8-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="671c8-113">Un webhook vous permet de toostart un runbook donné dans Azure Automation via une requête HTTP unique.</span><span class="sxs-lookup"><span data-stu-id="671c8-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="671c8-114">Avant de configurer hello [alerte d’Analytique de journal](../log-analytics/log-analytics-alerts.md#alert-rules) runbook de hello toocall à l’aide d’un webhook comme une action d’alerte, vous devez toofirst créer un webhook pour runbook hello qui sera appelée à l’aide de cette méthode.</span><span class="sxs-lookup"><span data-stu-id="671c8-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="671c8-115">Passez en revue et suivez les étapes de hello Bonjour [créer un webhook](automation-webhooks.md#creating-a-webhook) l’article et n’oubliez pas de l’URL du webhook toorecord hello afin que vous pouvez référencer lors de la configuration de règle d’alerte hello.</span><span class="sxs-lookup"><span data-stu-id="671c8-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="671c8-116">Appel direct d’un runbook</span><span class="sxs-lookup"><span data-stu-id="671c8-116">Calling a runbook directly</span></span>

<span data-ttu-id="671c8-117">Si vous avez hello Automation & offre de contrôle installé et configuré dans votre espace de travail OMS, lorsque vous configurez l’option d’actions hello Runbook d’alerte de hello, vous pouvez afficher tous les runbooks à partir de hello **sélectionnez un runbook** liste déroulante et sélectionnez hello spécifique de runbook vous souhaitez toorun dans alerte toohello de réponse.</span><span class="sxs-lookup"><span data-stu-id="671c8-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="671c8-118">Hello sélectionné runbook peut s’exécuter dans un espace de travail dans hello cloud Azure ou sur un runbook worker hybride.</span><span class="sxs-lookup"><span data-stu-id="671c8-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="671c8-119">Lors de l’alerte de hello est créé à l’aide d’option de runbook hello, un webhook va être créé pour hello runbook.</span><span class="sxs-lookup"><span data-stu-id="671c8-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="671c8-120">Vous pouvez voir hello webhook si vous accédez compte Automation de toohello et accédez lame de webhook toohello de runbook de hello sélectionné.</span><span class="sxs-lookup"><span data-stu-id="671c8-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="671c8-121">Si vous supprimez hello alerte, hello webhook n’est pas supprimé, mais hello l’utilisateur peut supprimer des hello webhook manuellement.</span><span class="sxs-lookup"><span data-stu-id="671c8-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="671c8-122">Il n’est pas un problème si hello webhook n’est pas supprimé, il est simplement un élément orphelin qui devra finalement toobe supprimé dans l’ordre toomaintain un compte Automation sont organisé.</span><span class="sxs-lookup"><span data-stu-id="671c8-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="671c8-123">Caractéristiques d’un runbook (pour les deux méthodes)</span><span class="sxs-lookup"><span data-stu-id="671c8-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="671c8-124">Les deux méthodes d’appel de hello runbook d’alerte d’Analytique de journal hello présentent les caractéristiques de comportement différent qui doivent toobe compris avant de configurer vos règles d’alerte.</span><span class="sxs-lookup"><span data-stu-id="671c8-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="671c8-125">Vous devez disposer d’un paramètre d’entrée de runbook appelé **WebhookData** qui est de type **objet**.</span><span class="sxs-lookup"><span data-stu-id="671c8-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="671c8-126">Il peut être obligatoire ou facultatif.</span><span class="sxs-lookup"><span data-stu-id="671c8-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="671c8-127">alerte de Hello passe hello recherche résultats toohello runbook à l’aide de ce paramètre d’entrée.</span><span class="sxs-lookup"><span data-stu-id="671c8-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="671c8-128">Vous devez avoir l’objet de code tooconvert hello WebhookData tooa PowerShell.</span><span class="sxs-lookup"><span data-stu-id="671c8-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="671c8-129">*$SearchResults* est un tableau d’objets ; chaque objet contient des champs de hello avec des valeurs à partir d’un résultat de recherche</span><span class="sxs-lookup"><span data-stu-id="671c8-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="671c8-130">WebhookData les incohérences entre l’option de webhook hello et option de runbook</span><span class="sxs-lookup"><span data-stu-id="671c8-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="671c8-131">Lorsque vous configurez une alerte toocall un Webhook, entrez une URL webhook que vous avez créé pour un runbook, cliquez sur hello **Test Webhook** bouton.</span><span class="sxs-lookup"><span data-stu-id="671c8-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="671c8-132">Hello WebhookData résultant envoyé toohello runbook ne contient pas *. Résultats de la recherche* ou *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="671c8-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="671c8-133">Si vous enregistrez cette alerte, lors de l’alerte de hello déclenche et appelle hello webhook, hello WebhookData envoyé toohello runbook contient *. Résultats de la recherche*.</span><span class="sxs-lookup"><span data-stu-id="671c8-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="671c8-134">Si vous créez une alerte et le configurez toocall un runbook (qui crée également un webhook), lorsque hello il envoie WebhookData toohello runbook qui contient les déclencheurs alerte *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="671c8-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="671c8-135">Par conséquent, dans l’exemple de code hello ci-dessus, vous devez tooget *. Résultats de la recherche* si l’alerte de hello appelle un webhook et devez tooget *. SearchResults* si l’alerte de hello appelle un runbook directement.</span><span class="sxs-lookup"><span data-stu-id="671c8-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="671c8-136">Exemple de procédure pas à pas</span><span class="sxs-lookup"><span data-stu-id="671c8-136">Example walkthrough</span></span>

<span data-ttu-id="671c8-137">Nous allons vous montrer comment cela fonctionne à l’aide de hello suivant l’exemple de runbook graphique, ce qui démarre un service Windows.</span><span class="sxs-lookup"><span data-stu-id="671c8-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Démarrer le runbook graphique d’un service Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="671c8-139">Hello runbook possède un paramètre d’entrée de type **objet** appelé **WebhookData** et inclut des données de webhook hello passées à partir de hello alerte contenant *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="671c8-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="671c8-140">![Paramètres d’entrée de runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="671c8-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="671c8-141">Pour cet exemple, dans le journal Analytique nous avons créé deux champs personnalisés, *SvcDisplayName_CF* et *SvcState_CF*, tooextract hello service hello nom et l’état d’affichage du service de hello (autrement dit, en cours d’exécution ou arrêté) à partir de l’événement de hello écrites toohello journal des événements système.</span><span class="sxs-lookup"><span data-stu-id="671c8-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="671c8-142">Ensuite, nous créons une règle d’alerte avec hello suivant la requête de recherche : `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` afin que nous pouvons détecter lorsque hello service Spouleur d’impression est arrêté sur hello système Windows.</span><span class="sxs-lookup"><span data-stu-id="671c8-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="671c8-143">Il peut être n’importe quel service qui vous intéresse, mais pour cet exemple nous référençons un des services préexistant hello qui sont incluses avec hello du système d’exploitation Windows.</span><span class="sxs-lookup"><span data-stu-id="671c8-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="671c8-144">action d’alerte Hello est configuré tooexecute notre runbook utilisé dans cet exemple et exécuter sur hello Runbook Worker hybride, qui sont activé sur les systèmes cibles de hello.</span><span class="sxs-lookup"><span data-stu-id="671c8-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="671c8-145">Hello d’activité de code runbook **obtenir un nom de Service à partir de LA** convertira la chaîne JSON de hello dans un type d’objet et un filtre sur l’élément de hello *SvcDisplayName_CF* nom d’affichage tooextract hello Hello Windows service et passer cette activité suivante de hello qui vérifiera hello est arrêté avant d’essayer de toorestart il.</span><span class="sxs-lookup"><span data-stu-id="671c8-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="671c8-146">*SvcDisplayName_CF* est un [champ personnalisé](../log-analytics/log-analytics-custom-fields.md) créé dans le journal Analytique toodemonstrate cet exemple.</span><span class="sxs-lookup"><span data-stu-id="671c8-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="671c8-147">Lorsque hello service s’arrête, règle d’alerte dans le journal Analytique hello détecte une correspondance et déclencher hello runbook et envoyer hello contexte de l’alerte toohello runbook.</span><span class="sxs-lookup"><span data-stu-id="671c8-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="671c8-148">Hello runbook effectuera une action tooverify hello service est arrêté, et si donc tentative toorestart hello service et vérifiez que l’opération a démarré correctement et hello de sortie des résultats.</span><span class="sxs-lookup"><span data-stu-id="671c8-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="671c8-149">Vous pouvez également si vous n’avez pas votre espace de travail Automation compte lié tooyour OMS, configurer la règle d’alerte hello avec un runbook de webhook action tootrigger hello et configurer une chaîne JSON hello runbook tooconvert hello et filtre sur *. Résultats de la recherche* suivant les instructions hello mentionnée précédemment.</span><span class="sxs-lookup"><span data-stu-id="671c8-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="671c8-150">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="671c8-150">Next steps</span></span>

* <span data-ttu-id="671c8-151">toolearn plus d’informations sur les alertes dans le journal Analytique et toocreate, voir [alertes dans le journal Analytique](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="671c8-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="671c8-152">toounderstand runbooks tootrigger à l’aide d’un webhook, voir [Azure Automation webhooks](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="671c8-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
