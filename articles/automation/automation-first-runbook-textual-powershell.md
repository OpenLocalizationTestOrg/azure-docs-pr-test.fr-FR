---
title: "Mon premier Runbook PowerShell dans Azure Automation | Microsoft Docs"
description: "Ce didacticiel vous familiarise avec la création, le test et la publication d’un Runbook Powershell simple."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
keywords: azure powershell, didacticiel sur le script powershell, automatisation powershell
ms.assetid: a43b395a-e740-41a3-ae62-40eac9d0ec00
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/26/2017
ms.author: magoedte;sngun
ms.openlocfilehash: 4b32011b72acc647d4af44bb5ccbcaab408fb4d6
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="my-first-powershell-runbook"></a><span data-ttu-id="09fc0-104">Mon premier Runbook PowerShell</span><span class="sxs-lookup"><span data-stu-id="09fc0-104">My first PowerShell runbook</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="09fc0-105">Graphique</span><span class="sxs-lookup"><span data-stu-id="09fc0-105">Graphical</span></span>](automation-first-runbook-graphical.md)
> * [<span data-ttu-id="09fc0-106">PowerShell</span><span class="sxs-lookup"><span data-stu-id="09fc0-106">PowerShell</span></span>](automation-first-runbook-textual-powershell.md)
> * [<span data-ttu-id="09fc0-107">Workflow PowerShell</span><span class="sxs-lookup"><span data-stu-id="09fc0-107">PowerShell Workflow</span></span>](automation-first-runbook-textual.md)
> 
> 

<span data-ttu-id="09fc0-108">Ce didacticiel vous guide dans la création d’un [Runbook PowerShell](automation-runbook-types.md#powershell-runbooks) dans Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="09fc0-108">This tutorial walks you through the creation of a [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) in Azure Automation.</span></span> <span data-ttu-id="09fc0-109">Nous commençons par un simple runbook que nous testons et publions tout en expliquant comment suivre l’état du travail du runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-109">We start with a simple runbook that we test and publish while we explain how to track the status of the runbook job.</span></span> <span data-ttu-id="09fc0-110">Nous modifions ensuite le runbook pour gérer les ressources Azure, en démarrant dans ce cas une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="09fc0-110">Then we modify the runbook to actually manage Azure resources, in this case starting an Azure virtual machine.</span></span> <span data-ttu-id="09fc0-111">Enfin, nous renforçons le runbook en ajoutant des paramètres de runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-111">Lastly, we make the runbook more robust by adding runbook parameters.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="09fc0-112">Composants requis</span><span class="sxs-lookup"><span data-stu-id="09fc0-112">Prerequisites</span></span>
<span data-ttu-id="09fc0-113">Pour réaliser ce didacticiel, vous avez besoin des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="09fc0-113">To complete this tutorial, you need the following:</span></span>

* <span data-ttu-id="09fc0-114">Abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="09fc0-114">Azure subscription.</span></span> <span data-ttu-id="09fc0-115">Si vous n’avez pas encore d’abonnement, vous pouvez [activer vos avantages abonnés MSDN](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) ou <a href="/pricing/free-account/" target="_blank">[créer un compte gratuit](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="09fc0-115">If you don't have one yet, you can [activate your MSDN subscriber benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/) or <a href="/pricing/free-account/" target="_blank">[sign up for a free account](https://azure.microsoft.com/free/).</span></span>
* <span data-ttu-id="09fc0-116">[compte Automation](automation-sec-configure-azure-runas-account.md) pour le stockage du Runbook et l’authentification auprès des ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="09fc0-116">[Automation account](automation-sec-configure-azure-runas-account.md) to hold the runbook and authenticate to Azure resources.</span></span>  <span data-ttu-id="09fc0-117">Ce compte doit avoir l’autorisation de démarrer et d’arrêter la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="09fc0-117">This account must have permission to start and stop the virtual machine.</span></span>
* <span data-ttu-id="09fc0-118">Une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="09fc0-118">An Azure virtual machine.</span></span> <span data-ttu-id="09fc0-119">Nous arrêtons et démarrons cette machine afin qu’elle ne soit pas une machine virtuelle de production.</span><span class="sxs-lookup"><span data-stu-id="09fc0-119">We stop and start this machine so it should not be a production VM.</span></span>

## <a name="step-1---create-new-runbook"></a><span data-ttu-id="09fc0-120">Étape 1 - Création d’un Runbook</span><span class="sxs-lookup"><span data-stu-id="09fc0-120">Step 1 - Create new runbook</span></span>
<span data-ttu-id="09fc0-121">Nous allons commencer par créer un Runbook simple qui renvoie le texte *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="09fc0-121">We'll start by creating a simple runbook that outputs the text *Hello World*.</span></span>

1. <span data-ttu-id="09fc0-122">Dans le portail Azure, ouvrez votre compte Automation.</span><span class="sxs-lookup"><span data-stu-id="09fc0-122">In the Azure portal, open your Automation account.</span></span>  
   <span data-ttu-id="09fc0-123">La page du compte Automation vous offre un aperçu rapide des ressources de ce compte.</span><span class="sxs-lookup"><span data-stu-id="09fc0-123">The Automation account page gives you a quick view of the resources in this account.</span></span> <span data-ttu-id="09fc0-124">Vous devriez déjà posséder certains éléments.</span><span class="sxs-lookup"><span data-stu-id="09fc0-124">You should already have some assets.</span></span> <span data-ttu-id="09fc0-125">La plupart de ces éléments représentent les modules automatiquement inclus dans un nouveau compte Automation.</span><span class="sxs-lookup"><span data-stu-id="09fc0-125">Most of those are the modules that are automatically included in a new Automation account.</span></span> <span data-ttu-id="09fc0-126">Vous devriez également disposer de la ressource d’informations d’identification mentionnée dans les [composants requis](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="09fc0-126">You should also have the Credential asset that's mentioned in the [prerequisites](#prerequisites).</span></span>
2. <span data-ttu-id="09fc0-127">Cliquez sur la vignette **Runbooks** pour ouvrir la liste des runbooks.</span><span class="sxs-lookup"><span data-stu-id="09fc0-127">Click the **Runbooks** tile to open the list of runbooks.</span></span><br><br> <span data-ttu-id="09fc0-128">![RunbooksControl](media/automation-first-runbook-textual-powershell/runbooks-control-tiles.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-128">![RunbooksControl](media/automation-first-runbook-textual-powershell/runbooks-control-tiles.png)</span></span>  
3. <span data-ttu-id="09fc0-129">Créez un runbook en cliquant sur le bouton **Ajouter un Runbook**, puis sur **Créer un Runbook**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-129">Create a new runbook by clicking the **Add a runbook** button and then **Create a new runbook**.</span></span>
4. <span data-ttu-id="09fc0-130">Nommez le Runbook *MyFirstRunbook-PowerShell*.</span><span class="sxs-lookup"><span data-stu-id="09fc0-130">Give the runbook the name *MyFirstRunbook-PowerShell*.</span></span>
5. <span data-ttu-id="09fc0-131">Dans ce cas précis, nous allons créer un [Runbook PowerShell](automation-runbook-types.md#powershell-runbooks). Par conséquent, sélectionnez **Powershell** comme **Type de Runbook**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-131">In this case, we're going to create a [PowerShell runbook](automation-runbook-types.md#powershell-runbooks) so select **Powershell** for **Runbook type**.</span></span><br><br> <span data-ttu-id="09fc0-132">![Types de Runbook](media/automation-first-runbook-textual-powershell/automation-runbook-type.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-132">![Runbook Type](media/automation-first-runbook-textual-powershell/automation-runbook-type.png)</span></span>  
6. <span data-ttu-id="09fc0-133">Cliquez sur **Créer** pour créer le Runbook et ouvrez l’éditeur textuel.</span><span class="sxs-lookup"><span data-stu-id="09fc0-133">Click **Create** to create the runbook and open the textual editor.</span></span>

## <a name="step-2---add-code-to-the-runbook"></a><span data-ttu-id="09fc0-134">Étape 2 - Ajouter du code au Runbook</span><span class="sxs-lookup"><span data-stu-id="09fc0-134">Step 2 - Add code to the runbook</span></span>
<span data-ttu-id="09fc0-135">Vous pouvez soit taper du code directement dans le Runbook, soit sélectionner des applets de commande, des Runbooks et des ressources à partir du contrôle Bibliothèque et les ajouter au Runbook avec tous les paramètres associés.</span><span class="sxs-lookup"><span data-stu-id="09fc0-135">You can either type code directly into the runbook, or you can select cmdlets, runbooks, and assets from the Library control and have them added to the runbook with any related parameters.</span></span> <span data-ttu-id="09fc0-136">Pour cette procédure pas à pas, nous tapons directement le code dans le runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-136">For this walkthrough, we type directly in the runbook.</span></span>

1. <span data-ttu-id="09fc0-137">Notre Runbook est actuellement vide, saisissez *Write-Output « Hello World »*.</span><span class="sxs-lookup"><span data-stu-id="09fc0-137">Our runbook is currently empty, type *Write-Output "Hello World."*.</span></span><br><br> <span data-ttu-id="09fc0-138">![Hello World](media/automation-first-runbook-textual-powershell/automation-helloworld.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-138">![Hello World](media/automation-first-runbook-textual-powershell/automation-helloworld.png)</span></span>  
2. <span data-ttu-id="09fc0-139">Enregistrez le Runbook en cliquant sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-139">Save the runbook by clicking **Save**.</span></span><br><br> <span data-ttu-id="09fc0-140">![Bouton Enregistrer](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-save.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-140">![Save Button](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-save.png)</span></span>  

## <a name="step-3---test-the-runbook"></a><span data-ttu-id="09fc0-141">Étape 3 : Test du Runbook</span><span class="sxs-lookup"><span data-stu-id="09fc0-141">Step 3 - Test the runbook</span></span>
<span data-ttu-id="09fc0-142">Avant publier le Runbook pour le rendre disponible en production, nous voulons le tester pour s’assurer qu'il fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="09fc0-142">Before we publish the runbook to make it available in production, we want to test it to make sure that it works properly.</span></span> <span data-ttu-id="09fc0-143">Lorsque vous testez un Runbook, vous exécutez sa version **Brouillon** et affichez sa sortie de manière interactive.</span><span class="sxs-lookup"><span data-stu-id="09fc0-143">When you test a runbook, you run its **Draft** version and view its output interactively.</span></span>

1. <span data-ttu-id="09fc0-144">Cliquez sur **Volet de test** pour ouvrir le volet de test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-144">Click **Test pane** to open the Test pane.</span></span><br><br> <span data-ttu-id="09fc0-145">![Test Pane](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-test.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-145">![Test Pane](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-test.png)</span></span>  
2. <span data-ttu-id="09fc0-146">Cliquez sur **Démarrer** pour démarrer le test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-146">Click **Start** to start the test.</span></span> <span data-ttu-id="09fc0-147">Ce doit être la seule option activée.</span><span class="sxs-lookup"><span data-stu-id="09fc0-147">This should be the only enabled option.</span></span>
3. <span data-ttu-id="09fc0-148">Une [tâche de Runbook](automation-runbook-execution.md) est créée et son état apparaît.</span><span class="sxs-lookup"><span data-stu-id="09fc0-148">A [runbook job](automation-runbook-execution.md) is created and its status displayed.</span></span>  
   <span data-ttu-id="09fc0-149">L’état initial du travail est *Mis en file d’attente* pour indiquer que la tâche attend qu’un Runbook Worker du cloud devienne disponible.</span><span class="sxs-lookup"><span data-stu-id="09fc0-149">The job status starts as *Queued* indicating that it is waiting for a runbook worker in the cloud to come available.</span></span> <span data-ttu-id="09fc0-150">La tâche prend ensuite l’état *Démarrage en cours* lorsqu’un Worker sélectionne la tâche, puis l’état *En cours d’exécution* lorsque le Runbook commence à s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="09fc0-150">It will then move to *Starting* when a worker claims the job, and then *Running* when the runbook actually starts running.</span></span>  
4. <span data-ttu-id="09fc0-151">Lorsque la tâche du Runbook est terminée, sa sortie s'affiche.</span><span class="sxs-lookup"><span data-stu-id="09fc0-151">When the runbook job completes, its output is displayed.</span></span> <span data-ttu-id="09fc0-152">Dans notre cas, nous devrions voir *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="09fc0-152">In our case, we should see *Hello World*.</span></span><br><br> <span data-ttu-id="09fc0-153">![Résultat du volet de test](media/automation-first-runbook-textual-powershell/automation-testpane-output.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-153">![Test Pane Output](media/automation-first-runbook-textual-powershell/automation-testpane-output.png)</span></span>  
5. <span data-ttu-id="09fc0-154">Fermez le volet de test pour revenir au canevas.</span><span class="sxs-lookup"><span data-stu-id="09fc0-154">Close the Test pane to return to the canvas.</span></span>

## <a name="step-4---publish-and-start-the-runbook"></a><span data-ttu-id="09fc0-155">Étape 4 : Publication et démarrage du Runbook</span><span class="sxs-lookup"><span data-stu-id="09fc0-155">Step 4 - Publish and start the runbook</span></span>
<span data-ttu-id="09fc0-156">Le runbook que nous avons créé est toujours en mode brouillon.</span><span class="sxs-lookup"><span data-stu-id="09fc0-156">The runbook that we created is still in Draft mode.</span></span> <span data-ttu-id="09fc0-157">Nous devons le publier pour pouvoir l'exécuter en production.</span><span class="sxs-lookup"><span data-stu-id="09fc0-157">We need to publish it before we can run it in production.</span></span>  <span data-ttu-id="09fc0-158">Lorsque vous publiez un Runbook, vous écrasez la version publiée existante par la version brouillon.</span><span class="sxs-lookup"><span data-stu-id="09fc0-158">When you publish a runbook, you overwrite the existing Published version with the Draft version.</span></span>  <span data-ttu-id="09fc0-159">Dans notre cas, nous n'avons pas encore de version publiée car nous venons de créer le Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-159">In our case, we don't have a Published version yet because we just created the runbook.</span></span>

1. <span data-ttu-id="09fc0-160">Cliquez sur **Publier** pour publier le Runbook, puis sur **Oui** lorsque vous y êtes invité.</span><span class="sxs-lookup"><span data-stu-id="09fc0-160">Click **Publish** to publish the runbook and then **Yes** when prompted.</span></span><br><br> <span data-ttu-id="09fc0-161">![Bouton Publier](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-publish.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-161">![Publish button](media/automation-first-runbook-textual-powershell/automation-runbook-edit-controls-publish.png)</span></span>  
2. <span data-ttu-id="09fc0-162">Si vous faites défiler la page vers la gauche pour visualiser le volet **Runbooks**, celui-ci affichera **l’État de création** **Publié**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-162">If you scroll left to view the runbook in the **Runbooks** pane now, it will show an **Authoring Status** of **Published**.</span></span>
3. <span data-ttu-id="09fc0-163">Faites défiler la page vers la droite pour visualiser le volet **MyFirstRunbook-PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-163">Scroll back to the right to view the pane for **MyFirstRunbook-PowerShell**.</span></span>  
   <span data-ttu-id="09fc0-164">Les options de la partie supérieure nous permettent de démarrer le runbook, de l’afficher, de planifier son démarrage à un moment ultérieur ou de créer un [webhook](automation-webhooks.md) afin de le démarrer par le biais d’un appel HTTP.</span><span class="sxs-lookup"><span data-stu-id="09fc0-164">The options across the top allow us to start the runbook, view the runbook, schedule it to start at some time in the future, or create a [webhook](automation-webhooks.md) so it can be started through an HTTP call.</span></span>
4. <span data-ttu-id="09fc0-165">Notre objectif étant de démarrer le runbook, cliquons sur **Démarrer**, puis sur **OK** à l’ouverture du panneau Démarrer le Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-165">We want to start the runbook, so click **Start** and then click **Ok** when the Start Runbook blade opens.</span></span><br><br> <span data-ttu-id="09fc0-166">![Bouton Démarrer](media/automation-first-runbook-textual-powershell/automation-runbook-controls-start.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-166">![Start button](media/automation-first-runbook-textual-powershell/automation-runbook-controls-start.png)</span></span><br>    
5. <span data-ttu-id="09fc0-167">Un volet de travail est ouvert pour le travail du runbook que nous avons créé.</span><span class="sxs-lookup"><span data-stu-id="09fc0-167">A job pane is opened for the runbook job that we created.</span></span> <span data-ttu-id="09fc0-168">Nous pouvons fermer ce volet mais, dans ce cas, nous le laissons ouvert afin de suivre la progression du travail.</span><span class="sxs-lookup"><span data-stu-id="09fc0-168">We can close this pane, but in this case we leave it open so we can watch the job's progress.</span></span>
6. <span data-ttu-id="09fc0-169">L’état de la tâche est indiqué dans le champ **Résumé de la tâche** et correspond aux états que nous avons constatés lors du test du Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-169">The job status is shown in **Job Summary** and matches the statuses that we saw when we tested the runbook.</span></span><br><br> <span data-ttu-id="09fc0-170">![Résumé des tâches](media/automation-first-runbook-textual-powershell/job-pane-status-blade-jobsummary.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-170">![Job Summary](media/automation-first-runbook-textual-powershell/job-pane-status-blade-jobsummary.png)</span></span><br>  
7. <span data-ttu-id="09fc0-171">Lorsque le Runbook prend l’état *Terminé*, cliquez sur **Sortie**.</span><span class="sxs-lookup"><span data-stu-id="09fc0-171">Once the runbook status shows *Completed*, click **Output**.</span></span> <span data-ttu-id="09fc0-172">Le volet Sortie s’ouvre, affichant *Hello World*.</span><span class="sxs-lookup"><span data-stu-id="09fc0-172">The Output pane is opened, and we can see our *Hello World*.</span></span><br><br> <span data-ttu-id="09fc0-173">![Sortie de travail](media/automation-first-runbook-textual-powershell/job-pane-status-blade-outputtile.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-173">![Job Output](media/automation-first-runbook-textual-powershell/job-pane-status-blade-outputtile.png)</span></span><br> 
8. <span data-ttu-id="09fc0-174">Fermez le volet Sortie.</span><span class="sxs-lookup"><span data-stu-id="09fc0-174">Close the Output pane.</span></span>
9. <span data-ttu-id="09fc0-175">Cliquez sur **Tous les journaux** pour ouvrir le volet Flux de la tâche du Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-175">Click **All Logs** to open the Streams pane for the runbook job.</span></span> <span data-ttu-id="09fc0-176">Seul le message *Hello World* devrait apparaître dans le flux de sortie, mais d’autres flux peuvent s’afficher pour une tâche de Runbook, notamment Mode détaillé et Erreur si le Runbook consigne ces informations.</span><span class="sxs-lookup"><span data-stu-id="09fc0-176">We should only see *Hello World* in the output stream, but this can show other streams for a runbook job such as Verbose and Error if the runbook writes to them.</span></span><br><br> <span data-ttu-id="09fc0-177">![Tous les journaux](media/automation-first-runbook-textual-powershell/job-pane-status-blade-alllogstile.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-177">![All Logs](media/automation-first-runbook-textual-powershell/job-pane-status-blade-alllogstile.png)</span></span><br>   
10. <span data-ttu-id="09fc0-178">Fermez les volets du flux et de la tâche pour revenir au volet MyFirstRunbook PowerShell.</span><span class="sxs-lookup"><span data-stu-id="09fc0-178">Close the Streams pane and the Job pane to return to the MyFirstRunbook-PowerShell pane.</span></span>
11. <span data-ttu-id="09fc0-179">Cliquez sur **Tâches** pour ouvrir le volet Tâches pour ce runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-179">Click **Jobs** to open the Jobs pane for this runbook.</span></span> <span data-ttu-id="09fc0-180">Il répertorie toutes les tâches créées par ce Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-180">This lists all of the jobs created by this runbook.</span></span> <span data-ttu-id="09fc0-181">Une seule tâche doit apparaître, car nous n’avons exécuté la tâche qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="09fc0-181">We should only see one job listed since we only ran the job once.</span></span><br><br> <span data-ttu-id="09fc0-182">![Liste des postes](media/automation-first-runbook-textual-powershell/runbook-control-job-tile.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-182">![Job List](media/automation-first-runbook-textual-powershell/runbook-control-job-tile.png)</span></span>  
12. <span data-ttu-id="09fc0-183">Vous pouvez cliquer sur ce travail pour ouvrir le même volet du travail que nous avons consulté au démarrage du runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-183">You can click this job to open the same Job pane that we viewed when we started the runbook.</span></span> <span data-ttu-id="09fc0-184">Cela vous permet de revenir en arrière et d’afficher les détails de toute tâche créée pour un Runbook donné.</span><span class="sxs-lookup"><span data-stu-id="09fc0-184">This allows you to go back in time and view the details of any job that was created for a particular runbook.</span></span>

## <a name="step-5---add-authentication-to-manage-azure-resources"></a><span data-ttu-id="09fc0-185">Étape 5 : Ajout d’une authentification pour gérer les ressources Azure</span><span class="sxs-lookup"><span data-stu-id="09fc0-185">Step 5 - Add authentication to manage Azure resources</span></span>
<span data-ttu-id="09fc0-186">Nous avons testé et publié notre Runbook, mais jusqu'à présent, il ne fait rien d'utile.</span><span class="sxs-lookup"><span data-stu-id="09fc0-186">We've tested and published our runbook, but so far it doesn't do anything useful.</span></span> <span data-ttu-id="09fc0-187">Nous voulons qu’il gère les ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="09fc0-187">We want to have it manage Azure resources.</span></span> <span data-ttu-id="09fc0-188">Il ne peut le faire que si nous le configurons pour qu’il s’authentifie à l’aide des informations d’identification mentionnées dans les [conditions préalables](#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="09fc0-188">It won't be able to do that though unless we have it authenticate using the credentials that are referred to in the [prerequisites](#prerequisites).</span></span> <span data-ttu-id="09fc0-189">Nous utilisons pour cela l’applet de commande **Add-AzureRmAccount** .</span><span class="sxs-lookup"><span data-stu-id="09fc0-189">We do that with the **Add-AzureRmAccount** cmdlet.</span></span>

1. <span data-ttu-id="09fc0-190">Ouvrez l’éditeur de texte en cliquant sur **Modifier** dans le volet MyFirstRunbook PowerShell.</span><span class="sxs-lookup"><span data-stu-id="09fc0-190">Open the textual editor by clicking **Edit** on the MyFirstRunbook-PowerShell pane.</span></span><br><br> <span data-ttu-id="09fc0-191">![Modifier un Runbook](media/automation-first-runbook-textual-powershell/automation-runbook-controls-edit.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-191">![Edit Runbook](media/automation-first-runbook-textual-powershell/automation-runbook-controls-edit.png)</span></span><br>   
2. <span data-ttu-id="09fc0-192">La ligne **Write-Output** ne nous est plus utile. Vous pouvez donc la supprimer.</span><span class="sxs-lookup"><span data-stu-id="09fc0-192">We don't need the **Write-Output** line anymore, so go ahead and delete it.</span></span>
3. <span data-ttu-id="09fc0-193">Tapez ou copiez-collez le code suivant qui gère l’authentification avec votre compte d’authentification Automation :</span><span class="sxs-lookup"><span data-stu-id="09fc0-193">Type or copy and paste the following code that handles the authentication with your Automation Run As account:</span></span>
   
   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationId $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   ```
   <br>
4. <span data-ttu-id="09fc0-194">Cliquez sur **Volet de test** afin de tester le Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-194">Click **Test pane** so that we can test the runbook.</span></span>
5. <span data-ttu-id="09fc0-195">Cliquez sur **Démarrer** pour démarrer le test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-195">Click **Start** to start the test.</span></span> <span data-ttu-id="09fc0-196">Une fois terminé, la sortie générée semblable à celle illustrée ci-dessous devrait afficher les informations de base sur votre compte.</span><span class="sxs-lookup"><span data-stu-id="09fc0-196">Once it completes, you should receive output similar to the following, displaying basic information from your account.</span></span> <span data-ttu-id="09fc0-197">Cette sortie confirme la validité des informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="09fc0-197">This confirms that the credential is valid.</span></span><br><br> <span data-ttu-id="09fc0-198">![Authentifier](media/automation-first-runbook-textual-powershell/runbook-auth-output.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-198">![Authenticate](media/automation-first-runbook-textual-powershell/runbook-auth-output.png)</span></span>

## <a name="step-6---add-code-to-start-a-virtual-machine"></a><span data-ttu-id="09fc0-199">Étape 6 - Ajouter du code pour démarrer une machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="09fc0-199">Step 6 - Add code to start a virtual machine</span></span>
<span data-ttu-id="09fc0-200">À présent que notre Runbook s’authentifie auprès de notre abonnement Azure, nous pouvons gérer les ressources.</span><span class="sxs-lookup"><span data-stu-id="09fc0-200">Now that our runbook is authenticating to our Azure subscription, we can manage resources.</span></span> <span data-ttu-id="09fc0-201">Nous ajoutons une commande pour démarrer une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="09fc0-201">We add a command to start a virtual machine.</span></span> <span data-ttu-id="09fc0-202">Vous pouvez choisir n’importe quelle machine virtuelle dans votre abonnement Azure, et pour l’instant, nous allons coder ce nom en dur dans le runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-202">You can pick any virtual machine in your Azure subscription, and for now we will hardcode that name in the runbook.</span></span>

1. <span data-ttu-id="09fc0-203">Après *Add-AzureRmAccount*, tapez *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* en fournissant le nom et le nom de groupe de ressources de la machine virtuelle à démarrer.</span><span class="sxs-lookup"><span data-stu-id="09fc0-203">After *Add-AzureRmAccount*, type *Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'NameofResourceGroup'* providing the name and Resource Group name of the virtual machine to start.</span></span>  
   
   ```
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationID $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name 'VMName' -ResourceGroupName 'ResourceGroupName'
   ```
   <br>
2. <span data-ttu-id="09fc0-204">Enregistrez le runbook, puis cliquez sur **Volet de test** pour le tester.</span><span class="sxs-lookup"><span data-stu-id="09fc0-204">Save the runbook and then click **Test pane** so that we can test it.</span></span>
3. <span data-ttu-id="09fc0-205">Cliquez sur **Démarrer** pour démarrer le test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-205">Click **Start** to start the test.</span></span> <span data-ttu-id="09fc0-206">Une fois le test terminé, vérifiez que la machine virtuelle a démarré.</span><span class="sxs-lookup"><span data-stu-id="09fc0-206">Once it completes, check that the virtual machine was started.</span></span>

## <a name="step-7---add-an-input-parameter-to-the-runbook"></a><span data-ttu-id="09fc0-207">Étape 7 : Ajout d’un paramètre d'entrée au Runbook</span><span class="sxs-lookup"><span data-stu-id="09fc0-207">Step 7 - Add an input parameter to the runbook</span></span>
<span data-ttu-id="09fc0-208">Pour l’instant, notre runbook démarre la machine virtuelle que nous avons codée en dur dans le runbook, mais ce dernier serait plus utile si nous spécifiions la machine virtuelle lorsque le runbook est démarré.</span><span class="sxs-lookup"><span data-stu-id="09fc0-208">Our runbook currently starts the virtual machine that we hardcoded in the runbook, but it would be more useful if we specify the virtual machine when the runbook is started.</span></span> <span data-ttu-id="09fc0-209">Nous allons à présent ajouter des paramètres d’entrée au Runbook pour fournir cette fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="09fc0-209">We will now add input parameters to the runbook to provide that functionality.</span></span>

1. <span data-ttu-id="09fc0-210">Ajoutez des paramètres au Runbook pour *VMName* et *ResourceGroupName* et utilisez ces variables avec l’applet de commande **Start-AzureRmVM** comme dans l’exemple ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="09fc0-210">Add parameters for *VMName* and *ResourceGroupName* to the runbook and use these variables with the **Start-AzureRmVM** cmdlet as in the example below.</span></span>  
   
   ```
   Param(
    [string]$VMName,
    [string]$ResourceGroupName
   )
   $Conn = Get-AutomationConnection -Name AzureRunAsConnection
   Add-AzureRMAccount -ServicePrincipal -Tenant $Conn.TenantID `
   -ApplicationID $Conn.ApplicationID -CertificateThumbprint $Conn.CertificateThumbprint
   Start-AzureRmVM -Name $VMName -ResourceGroupName $ResourceGroupName
   ```
   <br>
2. <span data-ttu-id="09fc0-211">Enregistrez le Runbook et ouvrez le volet de test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-211">Save the runbook and open the Test pane.</span></span> <span data-ttu-id="09fc0-212">Vous pouvez désormais fournir des valeurs pour les deux variables d’entrée utilisées dans le test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-212">You can now provide values for the two input variables that are used in the test.</span></span>
3. <span data-ttu-id="09fc0-213">Fermez le volet de test.</span><span class="sxs-lookup"><span data-stu-id="09fc0-213">Close the Test pane.</span></span>
4. <span data-ttu-id="09fc0-214">Cliquez sur **Publier** pour publier la nouvelle version du Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-214">Click **Publish** to publish the new version of the runbook.</span></span>
5. <span data-ttu-id="09fc0-215">Arrêtez la machine virtuelle que vous avez démarrée à l'étape précédente.</span><span class="sxs-lookup"><span data-stu-id="09fc0-215">Stop the virtual machine that you started in the previous step.</span></span>
6. <span data-ttu-id="09fc0-216">Cliquez sur **Démarrer** pour démarrer le Runbook.</span><span class="sxs-lookup"><span data-stu-id="09fc0-216">Click **Start** to start the runbook.</span></span> <span data-ttu-id="09fc0-217">Entrez les valeurs **VMName** et **ResourceGroupName** pour la machine virtuelle que vous allez démarrer.</span><span class="sxs-lookup"><span data-stu-id="09fc0-217">Type in the **VMName** and **ResourceGroupName** for the virtual machine that you're going to start.</span></span><br><br> <span data-ttu-id="09fc0-218">![Paramètre de réussite](media/automation-first-runbook-textual-powershell/automation-pass-params.png)</span><span class="sxs-lookup"><span data-stu-id="09fc0-218">![Pass Parameter](media/automation-first-runbook-textual-powershell/automation-pass-params.png)</span></span><br>  
7. <span data-ttu-id="09fc0-219">Une fois le Runbook terminé, vérifiez que la machine virtuelle a démarré.</span><span class="sxs-lookup"><span data-stu-id="09fc0-219">When the runbook completes, check that the virtual machine was started.</span></span>

## <a name="differences-from-powershell-workflow"></a><span data-ttu-id="09fc0-220">Différences par rapport à PowerShell Workflow</span><span class="sxs-lookup"><span data-stu-id="09fc0-220">Differences from PowerShell Workflow</span></span>
<span data-ttu-id="09fc0-221">Les runbooks PowerShell ont les mêmes cycle de vie, fonctionnalités et mode de gestion que ceux de PowerShell Workflow, avec toutefois quelques différences et limitations :</span><span class="sxs-lookup"><span data-stu-id="09fc0-221">PowerShell runbooks have the same lifecycle, capabilities, and management as PowerShell Workflow runbooks but there are some differences and limitations:</span></span>

1. <span data-ttu-id="09fc0-222">Les Runbooks PowerShell s’exécutent rapidement par rapport aux Runbooks PowerShell Workflow, car ils n’ont pas à subir l’étape de compilation.</span><span class="sxs-lookup"><span data-stu-id="09fc0-222">PowerShell runbooks run fast compared to PowerShell Workflow runbooks as they don’t have compilation step.</span></span>
2. <span data-ttu-id="09fc0-223">Les Runbooks PowerShell Workflow prennent en charge les points de contrôle. Avec les points de contrôle, les Runbooks PowerShell Workflow peuvent reprendre à n’importe quel point du Runbook, tandis que les Runbooks PowerShell ne peuvent recommencer qu’à partir du début.</span><span class="sxs-lookup"><span data-stu-id="09fc0-223">PowerShell Workflow runbooks support checkpoints, using checkpoints, PowerShell Workflow runbooks can resume from any point in the runbook whereas PowerShell runbooks can only resume from the beginning.</span></span>
3. <span data-ttu-id="09fc0-224">Les Runbooks PowerShell Workflow prennent en charge l’exécution parallèle et série, alors que les Runbooks PowerShell peuvent exécuter des commandes en série uniquement.</span><span class="sxs-lookup"><span data-stu-id="09fc0-224">PowerShell Workflow runbooks support parallel and serial execution whereas PowerShell runbooks can only execute commands serially.</span></span>
4. <span data-ttu-id="09fc0-225">Dans un runbook PowerShell Workflow, une activité, une commande ou un bloc de script peut avoir sa propre instance d’exécution, alors que dans un Runbook PowerShell, tous les éléments du script s’exécutent dans une instance d’exécution unique.</span><span class="sxs-lookup"><span data-stu-id="09fc0-225">In a PowerShell Workflow runbook, an activity, a command, or a script block can have its own runspace whereas in a PowerShell runbook, everything in a script runs in a single runspace.</span></span> <span data-ttu-id="09fc0-226">Il existe également certaines [différences syntaxiques](https://technet.microsoft.com/magazine/dn151046.aspx) entre un Runbook PowerShell natif et un Runbook PowerShell Workflow.</span><span class="sxs-lookup"><span data-stu-id="09fc0-226">There are also some [syntactic differences](https://technet.microsoft.com/magazine/dn151046.aspx) between a native PowerShell runbook and a PowerShell Workflow runbook.</span></span>

## <a name="next-steps"></a><span data-ttu-id="09fc0-227">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="09fc0-227">Next steps</span></span>
* <span data-ttu-id="09fc0-228">Pour une prise en main des Runbooks graphiques, consultez [Mon premier Runbook graphique](automation-first-runbook-graphical.md)</span><span class="sxs-lookup"><span data-stu-id="09fc0-228">To get started with Graphical runbooks, see [My first graphical runbook](automation-first-runbook-graphical.md)</span></span>
* <span data-ttu-id="09fc0-229">Pour une prise en main des runbooks de workflow PowerShell, consultez [Mon premier runbook PowerShell Workflow](automation-first-runbook-textual.md)</span><span class="sxs-lookup"><span data-stu-id="09fc0-229">To get started with PowerShell workflow runbooks, see [My first PowerShell workflow runbook](automation-first-runbook-textual.md)</span></span>
* <span data-ttu-id="09fc0-230">Pour en savoir plus sur les types de Runbook, leurs avantages et leurs limites, consultez [Types de Runbooks Azure Automation](automation-runbook-types.md)</span><span class="sxs-lookup"><span data-stu-id="09fc0-230">To know more about runbook types, their advantages and limitations, see [Azure Automation runbook types](automation-runbook-types.md)</span></span>
* <span data-ttu-id="09fc0-231">Pour plus d’informations sur la fonctionnalité de prise en charge de script PowerShell, consultez [Prise en charge de script PowerShell natif dans Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span><span class="sxs-lookup"><span data-stu-id="09fc0-231">For more information on PowerShell script support feature, see [Native PowerShell script support in Azure Automation](https://azure.microsoft.com/blog/announcing-powershell-script-support-azure-automation-2/)</span></span>

