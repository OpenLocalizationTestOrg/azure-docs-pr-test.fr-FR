---
title: "Exécution d’un Runbook dans Azure Automation | Microsoft Docs"
description: "Décrit les détails du traitement d'un Runbook dans Azure Automation."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: tysonn
ms.assetid: d10c8ce2-2c0b-4ea7-ba3c-d20e09b2c9ca
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/17/2017
ms.author: bwren
ms.openlocfilehash: 14f923e3f08dd3b286218ae56012ce14edcc4058
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="runbook-execution-in-azure-automation"></a><span data-ttu-id="ff90b-103">Exécution d'un Runbook dans Azure Automation</span><span class="sxs-lookup"><span data-stu-id="ff90b-103">Runbook execution in Azure Automation</span></span>
<span data-ttu-id="ff90b-104">Lorsque vous démarrez un Runbook dans Azure Automation, une tâche est créée.</span><span class="sxs-lookup"><span data-stu-id="ff90b-104">When you start a runbook in Azure Automation, a job is created.</span></span> <span data-ttu-id="ff90b-105">Une tâche est une instance d'exécution unique d'un Runbook.</span><span class="sxs-lookup"><span data-stu-id="ff90b-105">A job is a single execution instance of a runbook.</span></span> <span data-ttu-id="ff90b-106">Un travail Azure Automation est assigné pour exécuter chaque tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-106">An Azure Automation worker is assigned to run each job.</span></span> <span data-ttu-id="ff90b-107">Même si les travaux sont partagés par plusieurs comptes Azure, les tâches des différents comptes Automation sont isolées les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="ff90b-107">While workers are shared by multiple Azure accounts, jobs from different Automation accounts are isolated from one another.</span></span> <span data-ttu-id="ff90b-108">Vous n'avez pas le contrôle du travail qui traite la demande de votre tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-108">You do not have control over which worker services the request for your job.</span></span>  <span data-ttu-id="ff90b-109">Un même Runbook peut avoir plusieurs tâches s'exécutant à la fois.</span><span class="sxs-lookup"><span data-stu-id="ff90b-109">A single runbook can have multiple jobs running at one time.</span></span> <span data-ttu-id="ff90b-110">Lorsque vous affichez la liste des Runbooks du portail Azure, vous voyez l'état de toutes les tâches démarrées pour chaque Runbook.</span><span class="sxs-lookup"><span data-stu-id="ff90b-110">When you view the list of runbooks in the Azure portal, it lists the status of all jobs that were started for each runbook.</span></span> <span data-ttu-id="ff90b-111">Vous pouvez afficher la liste des tâches de chaque Runbook pour en assurer le suivi de l'état.</span><span class="sxs-lookup"><span data-stu-id="ff90b-111">You can view the list of jobs for each runbook in order to track the status of each.</span></span> <span data-ttu-id="ff90b-112">Pour obtenir une description des différents états des tâches, consultez [États des tâches](#job-statuses).</span><span class="sxs-lookup"><span data-stu-id="ff90b-112">For a description of the different job statuses, see [Job Statuses](#job-statuses).</span></span>

<span data-ttu-id="ff90b-113">Le diagramme suivant illustre le cycle de vie d’une tâche de Runbook pour des [Runbooks graphiques](automation-runbook-types.md#graphical-runbooks) et des [Runbooks de flux de travail PowerShell](automation-runbook-types.md#powershell-workflow-runbooks).</span><span class="sxs-lookup"><span data-stu-id="ff90b-113">The following diagram shows the lifecycle of a runbook job for [Graphical runbooks](automation-runbook-types.md#graphical-runbooks) and [PowerShell Workflow runbooks](automation-runbook-types.md#powershell-workflow-runbooks).</span></span>

![États des tâches - Workflow PowerShell](./media/automation-runbook-execution/job-statuses.png)

<span data-ttu-id="ff90b-115">Le diagramme suivant illustre le cycle de vie d'une tâche de Runbook pour des [Runbooks PowerShell](automation-runbook-types.md#powershell-runbooks).</span><span class="sxs-lookup"><span data-stu-id="ff90b-115">The following diagram shows the lifecycle of a runbook job for [PowerShell runbooks](automation-runbook-types.md#powershell-runbooks).</span></span>

![États des tâches - Script PowerShell](./media/automation-runbook-execution/job-statuses-script.png)

<span data-ttu-id="ff90b-117">Vos tâches auront accès à vos ressources Azure en créant une connexion à votre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="ff90b-117">Your jobs have access to your Azure resources by making a connection to your Azure subscription.</span></span> <span data-ttu-id="ff90b-118">Ils auront uniquement accès aux ressources de votre centre de données si ces ressources sont accessibles depuis le cloud public.</span><span class="sxs-lookup"><span data-stu-id="ff90b-118">They only have access to resources in your data center if those resources are accessible from the public cloud.</span></span>

## <a name="job-statuses"></a><span data-ttu-id="ff90b-119">États des tâches</span><span class="sxs-lookup"><span data-stu-id="ff90b-119">Job statuses</span></span>
<span data-ttu-id="ff90b-120">Le tableau suivant décrit les différents statuts possibles pour une tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-120">The following table describes the different statuses that are possible for a job.</span></span>

| <span data-ttu-id="ff90b-121">Statut</span><span class="sxs-lookup"><span data-stu-id="ff90b-121">Status</span></span> | <span data-ttu-id="ff90b-122">Description</span><span class="sxs-lookup"><span data-stu-id="ff90b-122">Description</span></span> |
|:--- |:--- |
| <span data-ttu-id="ff90b-123">Completed</span><span class="sxs-lookup"><span data-stu-id="ff90b-123">Completed</span></span> |<span data-ttu-id="ff90b-124">La tâche s'est terminée avec succès.</span><span class="sxs-lookup"><span data-stu-id="ff90b-124">The job completed successfully.</span></span> |
| <span data-ttu-id="ff90b-125">Échec</span><span class="sxs-lookup"><span data-stu-id="ff90b-125">Failed</span></span> |<span data-ttu-id="ff90b-126">Pour des [Runbooks graphiques et de workflow PowerShell](automation-runbook-types.md), le Runbook n’a pas pu être compilé.</span><span class="sxs-lookup"><span data-stu-id="ff90b-126">For [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md), the runbook failed to compile.</span></span>  <span data-ttu-id="ff90b-127">Pour des [Runbooks de script PowerShell](automation-runbook-types.md), le Runbook n'a pas pu démarrer ou la tâche a rencontré une exception.</span><span class="sxs-lookup"><span data-stu-id="ff90b-127">For [PowerShell Script runbooks](automation-runbook-types.md), the runbook failed to start or the job encountered an exception.</span></span> |
| <span data-ttu-id="ff90b-128">Échec, en attente de ressources</span><span class="sxs-lookup"><span data-stu-id="ff90b-128">Failed, waiting for resources</span></span> |<span data-ttu-id="ff90b-129">La tâche a échoué, car elle a atteint la limite de [répartition de charge équilibrée](#fairshare) trois fois et a démarré à partir du même point de contrôle ou à partir du début du Runbook à chaque fois.</span><span class="sxs-lookup"><span data-stu-id="ff90b-129">The job failed because it reached the [fair share](#fairshare) limit three times and started from the same checkpoint or from the start of the runbook each time.</span></span> |
| <span data-ttu-id="ff90b-130">Mis en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="ff90b-130">Queued</span></span> |<span data-ttu-id="ff90b-131">La tâche attend que les ressources d'un travail Automation deviennent disponibles afin de pouvoir être démarrée.</span><span class="sxs-lookup"><span data-stu-id="ff90b-131">The job is waiting for resources on an Automation worker to come available so that it can be started.</span></span> |
| <span data-ttu-id="ff90b-132">Starting</span><span class="sxs-lookup"><span data-stu-id="ff90b-132">Starting</span></span> |<span data-ttu-id="ff90b-133">La tâche a été attribuée à un travail et le système est en train de le démarrer.</span><span class="sxs-lookup"><span data-stu-id="ff90b-133">The job has been assigned to a worker, and the system is in the process of starting it.</span></span> |
| <span data-ttu-id="ff90b-134">Reprise</span><span class="sxs-lookup"><span data-stu-id="ff90b-134">Resuming</span></span> |<span data-ttu-id="ff90b-135">Le système est en cours de reprise de la tâche après qu'elle a été suspendue.</span><span class="sxs-lookup"><span data-stu-id="ff90b-135">The system is in the process of resuming the job after it was suspended.</span></span> |
| <span data-ttu-id="ff90b-136">Exécution</span><span class="sxs-lookup"><span data-stu-id="ff90b-136">Running</span></span> |<span data-ttu-id="ff90b-137">La tâche est en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="ff90b-137">The job is running.</span></span> |
| <span data-ttu-id="ff90b-138">En cours d'exécution, en attente de ressources</span><span class="sxs-lookup"><span data-stu-id="ff90b-138">Running, waiting for resources</span></span> |<span data-ttu-id="ff90b-139">La tâche a été déchargée, car elle a atteint la limite de [répartition de charge équilibrée](#fairshare) .</span><span class="sxs-lookup"><span data-stu-id="ff90b-139">The job has been unloaded because it reached the [fair share](#fairshare) limit.</span></span> <span data-ttu-id="ff90b-140">Elle reprend bientôt depuis son dernier point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ff90b-140">It resumes shortly from its last checkpoint.</span></span> |
| <span data-ttu-id="ff90b-141">Arrêté</span><span class="sxs-lookup"><span data-stu-id="ff90b-141">Stopped</span></span> |<span data-ttu-id="ff90b-142">La tâche a été arrêtée par l'utilisateur avant qu'elle n'ait été terminée.</span><span class="sxs-lookup"><span data-stu-id="ff90b-142">The job was stopped by the user before it was completed.</span></span> |
| <span data-ttu-id="ff90b-143">En cours d’arrêt</span><span class="sxs-lookup"><span data-stu-id="ff90b-143">Stopping</span></span> |<span data-ttu-id="ff90b-144">Le système est en cours d'arrêt de la tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-144">The system is in the process of stopping the job.</span></span> |
| <span data-ttu-id="ff90b-145">Interrompu</span><span class="sxs-lookup"><span data-stu-id="ff90b-145">Suspended</span></span> |<span data-ttu-id="ff90b-146">La tâche a été suspendue par l'utilisateur, le système ou une commande du Runbook.</span><span class="sxs-lookup"><span data-stu-id="ff90b-146">The job was suspended by the user, by the system, or by a command in the runbook.</span></span> <span data-ttu-id="ff90b-147">Une tâche qui est interrompue peut être démarrée à nouveau et reprend à partir de son dernier point de contrôle ou à partir du début du Runbook s'il n'a aucun point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ff90b-147">A job that is suspended can be started again and resume from its last checkpoint or from the beginning of the runbook if it doesn't have checkpoints.</span></span> <span data-ttu-id="ff90b-148">Le Runbook est uniquement interrompu par le système en cas d'exception.</span><span class="sxs-lookup"><span data-stu-id="ff90b-148">The runbook will only be suspended by the system when an exception occurs.</span></span> <span data-ttu-id="ff90b-149">Par défaut, ErrorActionPreference est définie sur **Continuer**, ce qui signifie que la tâche se poursuit en cas d'erreur.</span><span class="sxs-lookup"><span data-stu-id="ff90b-149">By default, ErrorActionPreference is set to **Continue**, meaning that the job keeps running on an error.</span></span> <span data-ttu-id="ff90b-150">Si cette préférence est définie sur **Arrêter**, la tâche s'interrompt en cas d'erreur.</span><span class="sxs-lookup"><span data-stu-id="ff90b-150">If this preference variable is set to **Stop**, then the job suspends on an error.</span></span>  <span data-ttu-id="ff90b-151">S'applique aux [Runbooks graphiques et de workflow PowerShell](automation-runbook-types.md) uniquement.</span><span class="sxs-lookup"><span data-stu-id="ff90b-151">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |
| <span data-ttu-id="ff90b-152">Suspension</span><span class="sxs-lookup"><span data-stu-id="ff90b-152">Suspending</span></span> |<span data-ttu-id="ff90b-153">Le système tente de suspendre la tâche à la demande de l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ff90b-153">The system is attempting to suspend the job at the request of the user.</span></span> <span data-ttu-id="ff90b-154">Le Runbook doit atteindre son prochain point de contrôle avant de pouvoir être suspendu.</span><span class="sxs-lookup"><span data-stu-id="ff90b-154">The runbook must reach its next checkpoint before it can be suspended.</span></span> <span data-ttu-id="ff90b-155">S'il a déjà passé le dernier point de contrôle, il se termine avant d'être suspendu.</span><span class="sxs-lookup"><span data-stu-id="ff90b-155">If it already passed its last checkpoint, then it completes before it can be suspended.</span></span>  <span data-ttu-id="ff90b-156">S'applique aux [Runbooks graphiques et de workflow PowerShell](automation-runbook-types.md) uniquement.</span><span class="sxs-lookup"><span data-stu-id="ff90b-156">Applies to [Graphical and PowerShell Workflow runbooks](automation-runbook-types.md) only.</span></span> |

## <a name="viewing-job-status-from-the-azure-portal"></a><span data-ttu-id="ff90b-157">Affichage de l’état du travail à partir du portail Azure</span><span class="sxs-lookup"><span data-stu-id="ff90b-157">Viewing job status from the Azure portal</span></span>
<span data-ttu-id="ff90b-158">Vous pouvez afficher une synthèse de l’état de toutes les tâches du Runbook ou explorer les détails d’une tâche spécifique du Runbook dans le portail Azure ou en configurant l’intégration à votre espace de travail Microsoft Operations Management Suite (OMS) Log Analytics pour transférer l’état des tâches de Runbook et les flux de tâches.</span><span class="sxs-lookup"><span data-stu-id="ff90b-158">You can view a summarized status of all runbook jobs or drill into details of a specific runbook job in the Azure portal or by configuring integration with your Microsoft Operations Management Suite (OMS) Log Analytics workspace to forward runbook job status and job streams.</span></span>  <span data-ttu-id="ff90b-159">Pour plus d’informations sur l’intégration à OMS Log Analytics, consultez [Transférer l’état d’un travail et des flux de travail d’Automation vers Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="ff90b-159">For more information about integrating with OMS Log Analytics, see [Forward job status and job streams from Automation to Log Analytics (OMS)](automation-manage-send-joblogs-log-analytics.md).</span></span>  

### <a name="automation-runbook-jobs-summary"></a><span data-ttu-id="ff90b-160">Résumé des tâches de Runbook Automation</span><span class="sxs-lookup"><span data-stu-id="ff90b-160">Automation runbook jobs summary</span></span>
<span data-ttu-id="ff90b-161">À droite de votre compte Automation, vous pouvez observer un résumé de toutes les tâches de Runbook pour un compte Automation sélectionné sous la vignette **Statistiques des tâches**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-161">On the right of your selected Automation account, you can see a summary of all of the runbook jobs for a selected Automation account under **Job Statistics** tile.</span></span><br><br> <span data-ttu-id="ff90b-162">![Vignette Statistiques des tâches](./media/automation-runbook-execution/automation-account-job-status-summary.png).</span><span class="sxs-lookup"><span data-stu-id="ff90b-162">![Job Statistics tile](./media/automation-runbook-execution/automation-account-job-status-summary.png).</span></span><br> <span data-ttu-id="ff90b-163">Cette vignette affiche un nombre et une représentation graphique de l’état de toutes les tâches exécutées.</span><span class="sxs-lookup"><span data-stu-id="ff90b-163">This tile displays a count and graphical representation of the job status for all jobs executed.</span></span>  

<span data-ttu-id="ff90b-164">Cliquez sur la vignette pour afficher le panneau **Tâches**, qui comprend une liste récapitulative de toutes les tâches exécutées avec leur état ainsi que les heures de début et de fin de leur exécution.</span><span class="sxs-lookup"><span data-stu-id="ff90b-164">Clicking on the tile presents the **Jobs** blade, which includes a summarized list of all jobs executed, with status, job execution, and start and completion times.</span></span><br><br> <span data-ttu-id="ff90b-165">![Panneau Tâches de compte Automation](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span><span class="sxs-lookup"><span data-stu-id="ff90b-165">![Automation account Jobs blade](./media/automation-runbook-execution/automation-account-jobs-status-blade.png)</span></span><br><br>  <span data-ttu-id="ff90b-166">Pour filtrer la liste des tâches, sélectionnez **Filtrer les tâches**, puis filtrez sur un Runbook spécifique, un état de tâche ou dans la liste déroulante, la plage de dates/heures pour y effectuer une recherche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-166">You can filter the list of jobs by selecting **Filter jobs**  and filter on a specific runbook, job status, or from the drop-down list, the date/time range to search within.</span></span><br><br> <span data-ttu-id="ff90b-167">![Filtrer l’état des tâches](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span><span class="sxs-lookup"><span data-stu-id="ff90b-167">![Filter Job status](./media/automation-runbook-execution/automation-account-jobs-filter.png)</span></span>

<span data-ttu-id="ff90b-168">Vous pouvez également afficher les détails d’un résumé de tâche d’un Runbook spécifique en sélectionnant celui-ci dans le panneau **Runbooks** de votre compte Automation, puis sélectionner la vignette **Tâches**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-168">Alternatively, you can view job summary details for a specific runbook by selecting that runbook from the **Runbooks** blade in your Automation account, and then select the **Jobs** tile.</span></span>  <span data-ttu-id="ff90b-169">Dans le panneau **Tâches** qui s’ouvre, vous pouvez cliquer sur l’enregistrement d’une tâche pour en afficher les détails et la sortie.</span><span class="sxs-lookup"><span data-stu-id="ff90b-169">This presents the **Jobs** blade, and from there you can click on the job record to view its detail and output.</span></span><br><br> <span data-ttu-id="ff90b-170">![Panneau Tâches de compte Automation](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span><span class="sxs-lookup"><span data-stu-id="ff90b-170">![Automation account Jobs blade](./media/automation-runbook-execution/automation-runbook-job-summary-blade.png)</span></span><br> 

### <a name="job-summary"></a><span data-ttu-id="ff90b-171">Résumé des tâches</span><span class="sxs-lookup"><span data-stu-id="ff90b-171">Job Summary</span></span>
<span data-ttu-id="ff90b-172">Vous pouvez afficher la liste de toutes les tâches qui ont été créées pour un Runbook donné et leur état le plus récent.</span><span class="sxs-lookup"><span data-stu-id="ff90b-172">You can view a list of all of the jobs that have been created for a particular runbook and their most recent status.</span></span> <span data-ttu-id="ff90b-173">Vous pouvez filtrer cette liste par état de la tâche et par plage de dates de la dernière modification de la tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-173">You can filter this list by job status and the range of dates for the last change to the job.</span></span> <span data-ttu-id="ff90b-174">Pour afficher des informations détaillées et la sortie, cliquez sur le nom d’une tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-174">To view its detailed information and output, click on the name of a job.</span></span> <span data-ttu-id="ff90b-175">La vue détaillée de la tâche inclut les valeurs des paramètres du Runbook qui ont été fournies à cette tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-175">The detailed view of the job includes the values for the runbook parameters that were provided to that job.</span></span>

<span data-ttu-id="ff90b-176">Vous pouvez utiliser les étapes suivantes pour afficher les tâches d'un Runbook.</span><span class="sxs-lookup"><span data-stu-id="ff90b-176">You can use the following steps to view the jobs for a runbook.</span></span>

1. <span data-ttu-id="ff90b-177">Dans le portail Azure, sélectionnez **Automation**, puis le nom d’un compte Automation.</span><span class="sxs-lookup"><span data-stu-id="ff90b-177">In the Azure portal, select **Automation** and then select the name of an Automation account.</span></span>
2. <span data-ttu-id="ff90b-178">À partir du concentrateur, sélectionnez **Runbooks** puis, dans le panneau **Runbooks**, sélectionnez un Runbook dans la liste.</span><span class="sxs-lookup"><span data-stu-id="ff90b-178">From the hub, select **Runbooks** and then on the **Runbooks** blade select a runbook from the list.</span></span>
3. <span data-ttu-id="ff90b-179">Dans le panneau du Runbook sélectionné, cliquez sur la vignette **Tâches**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-179">On the blade for the selected runbook, click the **Jobs** tile.</span></span>
4. <span data-ttu-id="ff90b-180">Cliquez sur une des tâches de la liste et dans le panneau de détails des tâches Runbook, vous pouvez afficher ses détails et sa sortie.</span><span class="sxs-lookup"><span data-stu-id="ff90b-180">Click on one of the jobs in the list and on the runbook job details blade you can view its detail and output.</span></span>

## <a name="retrieving-job-status-using-windows-powershell"></a><span data-ttu-id="ff90b-181">Récupération de l'état d'une tâche à l'aide de Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="ff90b-181">Retrieving job status using Windows PowerShell</span></span>
<span data-ttu-id="ff90b-182">Vous pouvez utiliser [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx) pour récupérer les tâches créées pour un Runbook et les détails d’une tâche particulière.</span><span class="sxs-lookup"><span data-stu-id="ff90b-182">You can use the [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx) to retrieve the jobs created for a runbook and the details of a particular job.</span></span> <span data-ttu-id="ff90b-183">Si vous démarrez un Runbook avec Windows PowerShell à l’aide de [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx), il retourne la tâche résultante.</span><span class="sxs-lookup"><span data-stu-id="ff90b-183">If you start a runbook with Windows PowerShell using [Start-AzureRmAutomationRunbook](https://msdn.microsoft.com/library/mt603661.aspx), then it returns the resulting job.</span></span> <span data-ttu-id="ff90b-184">Utilisez [Get-AzureRmAutomationJobOutput](https://msdn.microsoft.com/library/mt619440.aspx) pour obtenir la sortie d’une tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-184">Use [Get-AzureRmAutomationJob](https://msdn.microsoft.com/library/mt619440.aspx)Output to get a job’s output.</span></span>

<span data-ttu-id="ff90b-185">Les exemples de commandes suivants récupèrent la dernière tâche d’un exemple de Runbook et affichent son état, les valeurs fournies aux paramètres du Runbook et la sortie de la tâche.</span><span class="sxs-lookup"><span data-stu-id="ff90b-185">The following sample commands retrieve the last job for a sample runbook and displays its status, the values provided for the runbook parameters, and the output from the job.</span></span>

    $job = (Get-AzureRmAutomationJob –AutomationAccountName "MyAutomationAccount" `
    –RunbookName "Test-Runbook" -ResourceGroupName "ResourceGroup01" | sort LastModifiedDate –desc)[0]
    $job.Status
    $job.JobParameters
    Get-AzureRmAutomationJobOutput -ResourceGroupName "ResourceGroup01" `
    –AutomationAccountName "MyAutomationAcct" -Id $job.JobId –Stream Output

## <a name="fair-share"></a><span data-ttu-id="ff90b-186">répartition de charge équilibrée</span><span class="sxs-lookup"><span data-stu-id="ff90b-186">Fair share</span></span>
<span data-ttu-id="ff90b-187">Afin de partager les ressources entre tous les Runbooks du cloud, Azure Automation décharge temporairement toute tâche après leur exécution pendant 3 heures.</span><span class="sxs-lookup"><span data-stu-id="ff90b-187">In order to share resources among all runbooks in the cloud, Azure Automation will temporarily unload any job after it has been running for three hours.</span></span>  <span data-ttu-id="ff90b-188">Pendant ce temps, les tâches pour [Runbooks basés sur PowerShell](automation-runbook-types.md#powershell-runbooks) sont arrêtées et non redémarrées.</span><span class="sxs-lookup"><span data-stu-id="ff90b-188">During this time, jobs for [PowerShell-based runbooks](automation-runbook-types.md#powershell-runbooks) are stopped and will not be restarted.</span></span>  <span data-ttu-id="ff90b-189">L’état de la tâche indique **Arrêté**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-189">The job status shows **Stopped**.</span></span>  <span data-ttu-id="ff90b-190">Ce type de Runbook est toujours redémarré depuis le début puisqu’il ne prend pas en charge les points de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ff90b-190">This type of runbook is always restarted from the beginning since they don't support checkpoints.</span></span>  

<span data-ttu-id="ff90b-191">[Les Runbooks basés sur le flux de travail PowerShell](automation-runbook-types.md#powershell-workflow-runbooks) reprennent depuis leur dernier [point de contrôle](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints).</span><span class="sxs-lookup"><span data-stu-id="ff90b-191">[PowerShell-Workflow-based runbooks](automation-runbook-types.md#powershell-workflow-runbooks) will be resumed from their last [checkpoint](https://docs.microsoft.com/system-center/sma/overview-powershell-workflows#bk_Checkpoints).</span></span>  <span data-ttu-id="ff90b-192">Après avoir été exécutée pendant trois heures, la tâche Runbook est interrompue par le service et son état indique **En cours d’exécution, en attente de ressources**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-192">After running three hours, the runbook job will be suspended by the service and its status shows **Running, waiting for resources**.</span></span>  <span data-ttu-id="ff90b-193">Lorsqu’un bac à sable devient disponible, le Runbook est automatiquement redémarré par le service Automation et reprend à partir du dernier point de contrôle.</span><span class="sxs-lookup"><span data-stu-id="ff90b-193">When a sandbox becomes available, the runbook will be automatically restarted by the Automation service and resumes from the last checkpoint.</span></span>  <span data-ttu-id="ff90b-194">Ce comportement de flux de travail PowerShell est normal pour la suspension/reprise.</span><span class="sxs-lookup"><span data-stu-id="ff90b-194">This is normal PowerShell-Workflow behavior for suspend/restart.</span></span>  <span data-ttu-id="ff90b-195">Si le Runbook dépasse à nouveau trois heures d’exécution, le processus se répète, jusqu'à trois fois.</span><span class="sxs-lookup"><span data-stu-id="ff90b-195">If the runbook again exceeds three hours of runtime, the process repeats, up to three times.</span></span>  <span data-ttu-id="ff90b-196">Après le troisième redémarrage, si le Runbook n’est toujours pas terminé en trois heures, la tâche du Runbook échoue et l’état de la tâche affiche **Échec, en attente de ressources**.</span><span class="sxs-lookup"><span data-stu-id="ff90b-196">After the third restart, if the runbook still has not completed in three hours, then the runbook job is failed, and the job status shows **Failed, waiting for resources**.</span></span>  <span data-ttu-id="ff90b-197">Dans ce cas, vous recevez l'exception suivante avec l'échec.</span><span class="sxs-lookup"><span data-stu-id="ff90b-197">In this case, you receive the following exception with the failure.</span></span>

<span data-ttu-id="ff90b-198">*La tâche ne peut pas continuer, car elle a été exclue à plusieurs reprises du même point de contrôle. Assurez-vous que votre Runbook n’effectue pas des opérations de longue durée sans conserver son état.*</span><span class="sxs-lookup"><span data-stu-id="ff90b-198">*The job cannot continue running because it was repeatedly evicted from the same checkpoint. Please make sure your Runbook does not perform lengthy operations without persisting its state.*</span></span>

<span data-ttu-id="ff90b-199">L'objectif est d'empêcher que les Runbooks ne s'exécutent indéfiniment sans s'achever, pour protéger le service, car ils ne sont pas en mesure d'accéder au point de contrôle suivant sans être à nouveau déchargés.</span><span class="sxs-lookup"><span data-stu-id="ff90b-199">This is to protect the service from runbooks running indefinitely without completing, as they are not able to make it to the next checkpoint without being unloaded again.</span></span>

<span data-ttu-id="ff90b-200">Si le Runbook n'a aucun point de contrôle ou si la tâche n'a pas atteint le premier point de contrôle avant d'être déchargée, il redémarre depuis le début.</span><span class="sxs-lookup"><span data-stu-id="ff90b-200">If the runbook has no checkpoints or the job had not reached the first checkpoint before being unloaded, then it restarts from the beginning.</span></span>  

<span data-ttu-id="ff90b-201">Lorsque vous créez un Runbook, vous devez vous assurer que la durée d'exécution de toute activité entre deux points de contrôle ne dépasse pas 3 heures.</span><span class="sxs-lookup"><span data-stu-id="ff90b-201">When you create a runbook, you should ensure that the time to run any activities between two checkpoints does not exceed three hours.</span></span> <span data-ttu-id="ff90b-202">Vous devrez peut-être ajouter des points de contrôle à votre Runbook pour vous assurer qu'il n'excède pas cette limite de trois heures ou n’interrompt pas les opérations de longue durée.</span><span class="sxs-lookup"><span data-stu-id="ff90b-202">You may need to add checkpoints to your runbook to ensure that it does not reach this three hour limit or break up long running operations.</span></span> <span data-ttu-id="ff90b-203">Par exemple, votre Runbook peut effectuer une réindexation sur une base de données SQL volumineuse.</span><span class="sxs-lookup"><span data-stu-id="ff90b-203">For example, your runbook might perform a reindex on a large SQL database.</span></span> <span data-ttu-id="ff90b-204">Si cette opération unique ne se termine pas dans la limite de la répartition de charge équilibrée, la tâche est déchargée et redémarrée depuis le début.</span><span class="sxs-lookup"><span data-stu-id="ff90b-204">If this single operation does not complete within the fair share limit, then the job are unloaded and restarted from the beginning.</span></span> <span data-ttu-id="ff90b-205">Dans ce cas, vous devez décomposer l'opération de réindexation en plusieurs étapes, comme la réindexation d'une table à la fois, puis insérer un point de contrôle après chaque opération, afin que la tâche puisse reprendre après que la dernière opération s'est terminée.</span><span class="sxs-lookup"><span data-stu-id="ff90b-205">In this case, you should break up the reindex operation into multiple steps, such as reindexing one table at a time, and then insert a checkpoint after each operation so that the job could resume after the last operation to complete.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ff90b-206">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="ff90b-206">Next steps</span></span>
* <span data-ttu-id="ff90b-207">Pour en savoir plus sur les différentes méthodes qui peuvent être utilisées pour démarrer un Runbook dans Azure Automation, consultez [Démarrage d’un Runbook dans Azure Automation](automation-starting-a-runbook.md)</span><span class="sxs-lookup"><span data-stu-id="ff90b-207">To learn more about the different methods that can be used to start a runbook in Azure Automation, see [Starting a runbook in Azure Automation](automation-starting-a-runbook.md)</span></span>

