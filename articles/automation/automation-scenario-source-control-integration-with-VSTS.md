---
title: "Intégration d’Azure Automation au contrôle de code source Visual Studio Team Services | Microsoft Docs"
description: "Ce scénario vous guide pour la configuration de l’intégration dans un compte Azure Automation et pour le contrôle de code source Visual Studio Team Services."
services: automation
documentationcenter: 
author: eamono
manager: 
editor: 
keywords: "Azure powershell, VSTS, contrôle de code source, automation"
ms.assetid: a43b395a-e740-41a3-ae62-40eac9d0ec00
ms.service: automation
ms.workload: infrastructure-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/24/2017
ms.openlocfilehash: 01f9c01c9e04e02dbb548b68cf99684ba6ddd57e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="azure-automation-scenario---automation-source-control-integration-with-visual-studio-team-services"></a><span data-ttu-id="08c85-104">Scénario Azure Automation - Intégration du contrôle de code source Automation dans Visual Studio Team Services</span><span class="sxs-lookup"><span data-stu-id="08c85-104">Azure Automation scenario - Automation source control integration with Visual Studio Team Services</span></span>

<span data-ttu-id="08c85-105">Dans ce scénario, vous avez un projet Visual Studio Team Services que vous utilisez pour gérer des runbook Azure Automation ou des configurations DSC avec un contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="08c85-105">In this scenario, you have a Visual Studio Team Services project that you are using to manage Azure Automation runbooks or DSC configurations under source control.</span></span>
<span data-ttu-id="08c85-106">Cet article décrit comment intégrer VSTS dans votre environnement Azure Automation pour assurer une intégration continue pour chaque archivage.</span><span class="sxs-lookup"><span data-stu-id="08c85-106">This article describes how to integrate VSTS with your Azure Automation environment so that continuous integration happens for each check-in.</span></span>

## <a name="getting-the-scenario"></a><span data-ttu-id="08c85-107">Obtention du scénario</span><span class="sxs-lookup"><span data-stu-id="08c85-107">Getting the scenario</span></span>

<span data-ttu-id="08c85-108">Ce scénario se compose de deux runbooks PowerShell que vous pouvez importer directement depuis la [galerie de runbooks](automation-runbook-gallery.md) dans le portail Azure ou télécharger depuis [PowerShell Gallery](https://www.powershellgallery.com).</span><span class="sxs-lookup"><span data-stu-id="08c85-108">This scenario consists of two PowerShell runbooks that you can import directly from the [Runbook Gallery](automation-runbook-gallery.md) in the Azure portal or download from the [PowerShell Gallery](https://www.powershellgallery.com).</span></span>

### <a name="runbooks"></a><span data-ttu-id="08c85-109">Runbooks</span><span class="sxs-lookup"><span data-stu-id="08c85-109">Runbooks</span></span>

<span data-ttu-id="08c85-110">Runbook</span><span class="sxs-lookup"><span data-stu-id="08c85-110">Runbook</span></span> | <span data-ttu-id="08c85-111">Description</span><span class="sxs-lookup"><span data-stu-id="08c85-111">Description</span></span>| 
--------|------------|
<span data-ttu-id="08c85-112">Sync-VSTS</span><span class="sxs-lookup"><span data-stu-id="08c85-112">Sync-VSTS</span></span> | <span data-ttu-id="08c85-113">Importer des runbooks ou des configurations à partir du contrôle de code source VSTS lorsqu’un archivage est effectué.</span><span class="sxs-lookup"><span data-stu-id="08c85-113">Import runbooks or configurations from VSTS source control when a check-in is done.</span></span> <span data-ttu-id="08c85-114">En cas d’exécution manuelle, cette fonction importe et publie tous les runbooks et toutes les configurations dans le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-114">If run manually, it will import and publish all runbooks or configurations into the Automation account.</span></span>| 
<span data-ttu-id="08c85-115">Sync-VSTSGit</span><span class="sxs-lookup"><span data-stu-id="08c85-115">Sync-VSTSGit</span></span> | <span data-ttu-id="08c85-116">Importer des runbooks ou des configurations à partir du contrôle de code source VSTS sous Git lorsqu’un archivage est effectué.</span><span class="sxs-lookup"><span data-stu-id="08c85-116">Import runbooks or configurations from VSTS under Git source control when a check-in is done.</span></span> <span data-ttu-id="08c85-117">En cas d’exécution manuelle, cette fonction importe et publie tous les runbooks et toutes les configurations dans le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-117">If run manually, it will import and publish all runbooks or configurations into the Automation account.</span></span>|

### <a name="variables"></a><span data-ttu-id="08c85-118">Variables</span><span class="sxs-lookup"><span data-stu-id="08c85-118">Variables</span></span>

<span data-ttu-id="08c85-119">Variable</span><span class="sxs-lookup"><span data-stu-id="08c85-119">Variable</span></span> | <span data-ttu-id="08c85-120">Description</span><span class="sxs-lookup"><span data-stu-id="08c85-120">Description</span></span>|
-----------|------------|
<span data-ttu-id="08c85-121">VSToken</span><span class="sxs-lookup"><span data-stu-id="08c85-121">VSToken</span></span> | <span data-ttu-id="08c85-122">Ressource de variable sécurisée que vous allez créer qui contient le jeton d’accès personnel VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-122">Secure variable asset you will create that contains the VSTS personal access token.</span></span> <span data-ttu-id="08c85-123">Vous pouvez apprendre à créer un jeton d’accès personnel VSTS sur la [page d’authentification VSTS](https://www.visualstudio.com/en-us/docs/integrate/get-started/auth/overview).</span><span class="sxs-lookup"><span data-stu-id="08c85-123">You can learn how to create a VSTS personal access token on the [VSTS authentication page](https://www.visualstudio.com/en-us/docs/integrate/get-started/auth/overview).</span></span> 
## <a name="installing-and-configuring-this-scenario"></a><span data-ttu-id="08c85-124">Installation et configuration de ce scénario</span><span class="sxs-lookup"><span data-stu-id="08c85-124">Installing and configuring this scenario</span></span>

<span data-ttu-id="08c85-125">Créez un [jeton d’accès personnel](https://www.visualstudio.com/en-us/docs/integrate/get-started/auth/overview) dans VSTS que vous utiliserez pour synchroniser les runbooks ou les configurations dans votre compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-125">Create a [personal access token](https://www.visualstudio.com/en-us/docs/integrate/get-started/auth/overview) in VSTS that you will use to sync the runbooks or configurations into your automation account.</span></span>

![](media/automation-scenario-source-control-integration-with-VSTS/VSTSPersonalToken.png) 

<span data-ttu-id="08c85-126">Créez une [variable securisée](automation-variables.md) dans votre compte Automation pour stocker le jeton d’accès personnel afin que le runbook puisse s’authentifier dans VSTS et synchroniser les runbooks ou les configurations dans le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-126">Create a [secure variable](automation-variables.md) in your automation account to hold the personal access token so that the runbook can authenticate to VSTS and sync the runbooks or configurations into the Automation account.</span></span> <span data-ttu-id="08c85-127">Vous pouvez la nommer VSToken.</span><span class="sxs-lookup"><span data-stu-id="08c85-127">You can name this VSToken.</span></span> 

![](media/automation-scenario-source-control-integration-with-VSTS/VSTSTokenVariable.png)

<span data-ttu-id="08c85-128">Importez le runbook qui se synchronise vos runbooks ou configurations dans le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-128">Import the runbook that will sync your runbooks or configurations into the automation account.</span></span> <span data-ttu-id="08c85-129">Vous pouvez utiliser [l’exemple de runbook VSTS](https://www.powershellgallery.com/packages/Sync-VSTS/1.0/DisplayScript) ou [l’exemple de runbook VSTS avec Git] (https://www.powershellgallery.com/packages/Sync-VSTSGit/1.0/DisplayScript) à partir de PowerShellGallery.com selon que vous utilisez VSTS ou le contrôle de code source VSTS avec Git pour effectuer un déploiement dans votre compte automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-129">You can use the [VSTS sample runbook](https://www.powershellgallery.com/packages/Sync-VSTS/1.0/DisplayScript) or the [VSTS with Git sample runbook] (https://www.powershellgallery.com/packages/Sync-VSTSGit/1.0/DisplayScript) from the PowerShellGallery.com depending on if you use VSTS source control or VSTS with Git and deploy to your automation account.</span></span>

![](media/automation-scenario-source-control-integration-with-VSTS/VSTSPowerShellGallery.png)

<span data-ttu-id="08c85-130">Vous pouvez à présent [publier](automation-creating-importing-runbook.md#publishing-a-runbook) ce runbook pour créer un webhook.</span><span class="sxs-lookup"><span data-stu-id="08c85-130">You can now [publish](automation-creating-importing-runbook.md#publishing-a-runbook) this runbook so you can create a webhook.</span></span> 
![](media/automation-scenario-source-control-integration-with-VSTS/VSTSPublishRunbook.png)

<span data-ttu-id="08c85-131">Créez un [webhook](automation-webhooks.md) pour ce runbook Sync-VSTS et renseigner les paramètres comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="08c85-131">Create a [webhook](automation-webhooks.md) for this Sync-VSTS runbook and fill in the parameters as shown below.</span></span> <span data-ttu-id="08c85-132">Veillez à effectuer une copie de l’URL du webhook, car vous en aurez besoin pour un crochet de service dans VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-132">Make sure you copy the webhook url as you will need it for a service hook in VSTS.</span></span> <span data-ttu-id="08c85-133">VSAccessTokenVariableName est le nom (VSToken) de la variable sécurisée que vous avez créée précédemment pour stocker le jeton d’accès personnel.</span><span class="sxs-lookup"><span data-stu-id="08c85-133">The VSAccessTokenVariableName is the name (VSToken) of the secure variable that you created earlier to hold the personal access token.</span></span> 

<span data-ttu-id="08c85-134">L’intégration dans VSTS (Sync-VSTS.ps1) aura les paramètres suivants.</span><span class="sxs-lookup"><span data-stu-id="08c85-134">Integrating with VSTS (Sync-VSTS.ps1) will take the following parameters.</span></span>
### <a name="sync-vsts-parameters"></a><span data-ttu-id="08c85-135">Paramètres Sync-VSTS</span><span class="sxs-lookup"><span data-stu-id="08c85-135">Sync-VSTS Parameters</span></span>

<span data-ttu-id="08c85-136">Paramètre</span><span class="sxs-lookup"><span data-stu-id="08c85-136">Parameter</span></span> | <span data-ttu-id="08c85-137">Description</span><span class="sxs-lookup"><span data-stu-id="08c85-137">Description</span></span>| 
--------|------------|
<span data-ttu-id="08c85-138">WebhookData</span><span class="sxs-lookup"><span data-stu-id="08c85-138">WebhookData</span></span> | <span data-ttu-id="08c85-139">Ce paramètre contiendra les informations d’archivage envoyées dans le crochet de service VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-139">This will contain the checkin information sent from the VSTS service hook.</span></span> <span data-ttu-id="08c85-140">Laissez ce paramètre vide.</span><span class="sxs-lookup"><span data-stu-id="08c85-140">You should leave this parameter blank.</span></span>| 
<span data-ttu-id="08c85-141">ResourceGroup</span><span class="sxs-lookup"><span data-stu-id="08c85-141">ResourceGroup</span></span> | <span data-ttu-id="08c85-142">Nom du groupe de ressources dans lequel se trouve le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-142">This is the name of the resource group that the automation account is in.</span></span>|
<span data-ttu-id="08c85-143">AutomationAccountName</span><span class="sxs-lookup"><span data-stu-id="08c85-143">AutomationAccountName</span></span> | <span data-ttu-id="08c85-144">Le nom du compte Automation qui se synchronise sur VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-144">The name of the automation account that will sync with VSTS.</span></span>|
<span data-ttu-id="08c85-145">VSFolder</span><span class="sxs-lookup"><span data-stu-id="08c85-145">VSFolder</span></span> | <span data-ttu-id="08c85-146">Nom du dossier dans VSTS dans lequel se trouvent les runbooks et les configurations.</span><span class="sxs-lookup"><span data-stu-id="08c85-146">The name of the folder in VSTS where the runbooks and configurations exist.</span></span>|
<span data-ttu-id="08c85-147">VSAccount</span><span class="sxs-lookup"><span data-stu-id="08c85-147">VSAccount</span></span> | <span data-ttu-id="08c85-148">Nom du compte Visual Studio Team Services.</span><span class="sxs-lookup"><span data-stu-id="08c85-148">The name of the Visual Studio Team Services account.</span></span>| 
<span data-ttu-id="08c85-149">VSAccessTokenVariableName</span><span class="sxs-lookup"><span data-stu-id="08c85-149">VSAccessTokenVariableName</span></span> | <span data-ttu-id="08c85-150">Nom de la variable sécurisée (VSToken) qui contient le jeton d’accès personnel VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-150">The name of the secure variable (VSToken) that holds the VSTS personal access token.</span></span>| 


![](media/automation-scenario-source-control-integration-with-VSTS/VSTSWebhook.png)

<span data-ttu-id="08c85-151">Si vous utilisez VSTS avec GIT (Sync-VSTSGit.ps1), il aura les paramètres suivants.</span><span class="sxs-lookup"><span data-stu-id="08c85-151">If you are using VSTS with GIT (Sync-VSTSGit.ps1) it will take the following parameters.</span></span>

<span data-ttu-id="08c85-152">Paramètre</span><span class="sxs-lookup"><span data-stu-id="08c85-152">Parameter</span></span> | <span data-ttu-id="08c85-153">Description</span><span class="sxs-lookup"><span data-stu-id="08c85-153">Description</span></span>|
--------|------------|
<span data-ttu-id="08c85-154">WebhookData</span><span class="sxs-lookup"><span data-stu-id="08c85-154">WebhookData</span></span> | <span data-ttu-id="08c85-155">Ce paramètre contiendra les informations d’archivage envoyées dans le crochet de service VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-155">This will contain the checkin information sent from the VSTS service hook.</span></span> <span data-ttu-id="08c85-156">Laissez ce paramètre vide.</span><span class="sxs-lookup"><span data-stu-id="08c85-156">You should leave this parameter blank.</span></span>| <span data-ttu-id="08c85-157">ResourceGroup</span><span class="sxs-lookup"><span data-stu-id="08c85-157">ResourceGroup</span></span> | <span data-ttu-id="08c85-158">Nom du groupe de ressources dans lequel se trouve le compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-158">This the name of the resource group that the automation account is in.</span></span>|
<span data-ttu-id="08c85-159">AutomationAccountName</span><span class="sxs-lookup"><span data-stu-id="08c85-159">AutomationAccountName</span></span> | <span data-ttu-id="08c85-160">Le nom du compte Automation qui se synchronise sur VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-160">The name of the automation account that will sync with VSTS.</span></span>|
<span data-ttu-id="08c85-161">VSAccount</span><span class="sxs-lookup"><span data-stu-id="08c85-161">VSAccount</span></span> | <span data-ttu-id="08c85-162">Nom du compte Visual Studio Team Services.</span><span class="sxs-lookup"><span data-stu-id="08c85-162">The name of the Visual Studio Team Services account.</span></span>|
<span data-ttu-id="08c85-163">VSProject</span><span class="sxs-lookup"><span data-stu-id="08c85-163">VSProject</span></span> | <span data-ttu-id="08c85-164">Nom du projet dans VSTS dans lequel se trouvent les runbooks et les configurations.</span><span class="sxs-lookup"><span data-stu-id="08c85-164">The name of the project in VSTS where the runbooks and configurations exist.</span></span>|
<span data-ttu-id="08c85-165">GitRepo</span><span class="sxs-lookup"><span data-stu-id="08c85-165">GitRepo</span></span> | <span data-ttu-id="08c85-166">Nom du référentiel Git.</span><span class="sxs-lookup"><span data-stu-id="08c85-166">The name of the Git repository.</span></span>|
<span data-ttu-id="08c85-167">GitBranch</span><span class="sxs-lookup"><span data-stu-id="08c85-167">GitBranch</span></span> | <span data-ttu-id="08c85-168">Le nom de la branche de référentiel Git VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-168">The name of the branch in VSTS Git repository.</span></span>|
<span data-ttu-id="08c85-169">Dossier</span><span class="sxs-lookup"><span data-stu-id="08c85-169">Folder</span></span> | <span data-ttu-id="08c85-170">Nom du dossier dans la branche Git VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-170">The name of the folder in VSTS Git branch.</span></span>|
<span data-ttu-id="08c85-171">VSAccessTokenVariableName</span><span class="sxs-lookup"><span data-stu-id="08c85-171">VSAccessTokenVariableName</span></span> | <span data-ttu-id="08c85-172">Nom de la variable sécurisée (VSToken) qui contient le jeton d’accès personnel VSTS.</span><span class="sxs-lookup"><span data-stu-id="08c85-172">The name of the secure variable (VSToken) that holds the VSTS personal access token.</span></span>|

![](media/automation-scenario-source-control-integration-with-VSTS/VSTSGitWebhook.png)

<span data-ttu-id="08c85-173">Créer un crochet de service dans VSTS pour les archivages dans le dossier qui déclenche ce webhook lors de l’archivage de code.</span><span class="sxs-lookup"><span data-stu-id="08c85-173">Create a service hook in VSTS for check-ins to the folder that triggers this webhook on code check-in.</span></span> <span data-ttu-id="08c85-174">Sélectionnez Web Hooks en tant que service à intégrer lorsque vous créez un nouvel abonnement.</span><span class="sxs-lookup"><span data-stu-id="08c85-174">Select Web Hooks as the service to integrate with when you create a new subscription.</span></span> <span data-ttu-id="08c85-175">Pour en savoir plus sur les webhooks de service, consultez la [documentation sur les webhooks de service VSTS](https://www.visualstudio.com/en-us/docs/marketplace/integrate/service-hooks/get-started).</span><span class="sxs-lookup"><span data-stu-id="08c85-175">You can learn more about service hooks on [VSTS Service Hooks documentation](https://www.visualstudio.com/en-us/docs/marketplace/integrate/service-hooks/get-started).</span></span>
![](media/automation-scenario-source-control-integration-with-VSTS/VSTSServiceHook.png)

<span data-ttu-id="08c85-176">Vous êtes maintenant être en mesure d’effectuer tous les archivages de vos runbooks et configurations dans VSTS et de les synchroniser automatiquement dans votre compte Automation.</span><span class="sxs-lookup"><span data-stu-id="08c85-176">You should now be able to do all check-ins of your runbooks and configurations into VSTS and have these automatically sync’d into your automation account.</span></span>

![](media/automation-scenario-source-control-integration-with-VSTS/VSTSSyncRunbookOutput.png)

<span data-ttu-id="08c85-177">Si vous exécutez ce runbook manuellement sans déclenchement par VSTS, vous pouvez laisser le paramètre webhookdata vide et il effectuera une synchronisation complète du dossier VSTS spécifié.</span><span class="sxs-lookup"><span data-stu-id="08c85-177">If you run this runbook manually without being triggered by VSTS, you can leave the webhookdata parameter empty and it will do a full sync from the VSTS folder specified.</span></span>

<span data-ttu-id="08c85-178">Si vous souhaitez désinstaller le scénario, supprimez le crochet de service de VSTS, supprimez le runbook et la variable VSToken.</span><span class="sxs-lookup"><span data-stu-id="08c85-178">If you wish to uninstall the scenario, remove the service hook from VSTS, delete the runbook, and the VSToken variable.</span></span>
