---
title: "Azure Active Directory B2C : résoudre les problèmes liés aux stratégies personnalisées | Microsoft Docs"
description: "Découvrez les approches pour résoudre les erreurs quand vous utilisez des stratégies personnalisées dans Azure Active Directory."
services: active-directory-b2c
documentationcenter: 
author: rojasja
manager: krassk
editor: rojasja
ms.assetid: 
ms.service: active-directory-b2c
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/07/2017
ms.author: joroja
ms.openlocfilehash: 023390ba36a74217503ff8b3076ad17978fe3fb8
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-azure-ad-b2c-custom-policies-and-identity-experience-framework"></a><span data-ttu-id="bb644-103">Résoudre les problèmes liés aux stratégies personnalisées Azure AD B2C et à l’Infrastructure d’expérience d’identité.</span><span class="sxs-lookup"><span data-stu-id="bb644-103">Troubleshoot Azure AD B2C custom policies and Identity Experience Framework</span></span>

<span data-ttu-id="bb644-104">Si vous utilisez des stratégies personnalisées Azure Active Directory B2C (Azure AD B2C), vous risquez de rencontrer des difficultés lors de la configuration de l’Infrastructure d’expérience d’identité dans son format XML de langage de stratégie.</span><span class="sxs-lookup"><span data-stu-id="bb644-104">If you use Azure Active Directory B2C (Azure AD B2C) custom policies, you might experience challenges setting up the Identity Experience Framework in its policy language XML format.</span></span>  <span data-ttu-id="bb644-105">Apprendre à écrire des stratégies personnalisées peut s’apparenter à l’apprentissage d’une nouvelle langue.</span><span class="sxs-lookup"><span data-stu-id="bb644-105">Learning to write custom policies can be like learning a new language.</span></span> <span data-ttu-id="bb644-106">Dans cet article, nous décrivons des outils et proposons des conseils qui peuvent vous aider à identifier et résoudre rapidement les problèmes.</span><span class="sxs-lookup"><span data-stu-id="bb644-106">In this article, we describe tools and tips that can help you quickly discover and resolve issues.</span></span> 

> [!NOTE]
> <span data-ttu-id="bb644-107">Cet article est axé sur la résolution des problèmes de configuration de stratégie personnalisée Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="bb644-107">This article focuses on troubleshooting your Azure AD B2C custom policy configuration.</span></span> <span data-ttu-id="bb644-108">Il ne traite pas de l’application par partie de confiance ou de sa bibliothèque d’identités.</span><span class="sxs-lookup"><span data-stu-id="bb644-108">It doesn't address the relying party application or its identity library.</span></span>

## <a name="xml-editing"></a><span data-ttu-id="bb644-109">Édition XML</span><span class="sxs-lookup"><span data-stu-id="bb644-109">XML editing</span></span>

<span data-ttu-id="bb644-110">L’erreur la plus courante lors de la configuration des stratégies personnalisées concerne la mise en forme du code XML.</span><span class="sxs-lookup"><span data-stu-id="bb644-110">The most common error in setting up custom policies is improperly formatted XML.</span></span> <span data-ttu-id="bb644-111">Un bon éditeur XML est quasiment essentiel.</span><span class="sxs-lookup"><span data-stu-id="bb644-111">A good XML editor is nearly essential.</span></span> <span data-ttu-id="bb644-112">Un bon éditeur XML affiche le code XML en mode natif, applique un code couleur au contenu, prérenseigne les termes courants, maintient les éléments indexés et peut valider avec un schéma.</span><span class="sxs-lookup"><span data-stu-id="bb644-112">A good XML editor displays XML natively, color-codes content, prefills common terms, keeps XML elements indexed, and can validate with schema.</span></span> <span data-ttu-id="bb644-113">Voici deux de nos éditeurs XML préférés :</span><span class="sxs-lookup"><span data-stu-id="bb644-113">Here are two of our favorite XML editors:</span></span>

* [<span data-ttu-id="bb644-114">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="bb644-114">Visual Studio Code</span></span>](https://code.visualstudio.com/)
* [<span data-ttu-id="bb644-115">Notepad++</span><span class="sxs-lookup"><span data-stu-id="bb644-115">Notepad++</span></span>](https://notepad-plus-plus.org/)

<span data-ttu-id="bb644-116">La validation du schéma XML identifie les erreurs avant le chargement de votre fichier XML.</span><span class="sxs-lookup"><span data-stu-id="bb644-116">XML schema validation identifies errors before you upload your XML file.</span></span> <span data-ttu-id="bb644-117">Dans le dossier racine du pack de démarrage, obtenez la définition du schéma XML TrustFrameworkPolicy_0.3.0.0.xsd.</span><span class="sxs-lookup"><span data-stu-id="bb644-117">In the root folder of the starter pack, get the XML schema definition TrustFrameworkPolicy_0.3.0.0.xsd.</span></span> <span data-ttu-id="bb644-118">Pour plus d’informations, recherchez *outils XML* et *validation XML* dans la documentation de votre éditeur XML.</span><span class="sxs-lookup"><span data-stu-id="bb644-118">For more information, in the documentation of your XML editor, look for *XML tools* and *XML validation*.</span></span>

<span data-ttu-id="bb644-119">Il peut être utile de passer en revue les règles XML.</span><span class="sxs-lookup"><span data-stu-id="bb644-119">You might find a review of XML rules helpful.</span></span> <span data-ttu-id="bb644-120">Azure AD B2C rejette toute erreur de mise en forme XML qu’il détecte.</span><span class="sxs-lookup"><span data-stu-id="bb644-120">Azure AD B2C rejects any XML formatting errors that it detects.</span></span> <span data-ttu-id="bb644-121">Parfois, une mauvaise mise en forme XML peut entraîner des messages d’erreur trompeurs.</span><span class="sxs-lookup"><span data-stu-id="bb644-121">Occasionally, incorrectly formatted XML might cause error messages that are misleading.</span></span>

## <a name="upload-policies-and-policy-validation"></a><span data-ttu-id="bb644-122">Chargement et validation de stratégies</span><span class="sxs-lookup"><span data-stu-id="bb644-122">Upload policies and policy validation</span></span>

 <span data-ttu-id="bb644-123">La validation du chargement de fichier XML est automatique.</span><span class="sxs-lookup"><span data-stu-id="bb644-123">XML file upload validation is automatic.</span></span> <span data-ttu-id="bb644-124">La plupart des erreurs provoquent l’échec du chargement.</span><span class="sxs-lookup"><span data-stu-id="bb644-124">Most errors cause the upload to fail.</span></span> <span data-ttu-id="bb644-125">La validation inclut le fichier de stratégie que vous chargez.</span><span class="sxs-lookup"><span data-stu-id="bb644-125">Validation includes the policy file that you are uploading.</span></span> <span data-ttu-id="bb644-126">Elle inclut également la chaîne de fichiers à laquelle le fichier de chargement fait référence (le fichier de stratégie de la partie de confiance, le fichier d’extensions et le fichier de base).</span><span class="sxs-lookup"><span data-stu-id="bb644-126">It also includes the chain of files the upload file refers to (the relying party policy file, the extensions file, and the base file).</span></span> 
 
 <span data-ttu-id="bb644-127">Voici quelques-unes des erreurs de validation courantes.</span><span class="sxs-lookup"><span data-stu-id="bb644-127">Common validation errors include the following.</span></span>

<span data-ttu-id="bb644-128">Extrait de code de l’erreur :`... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span><span class="sxs-lookup"><span data-stu-id="bb644-128">Error snippet: `... makes a reference to ClaimType with id "displaName" but neither the policy nor any of its base policies contain such an element`</span></span>
* <span data-ttu-id="bb644-129">La valeur ClaimType est mal orthographiée ou n’existe pas dans le schéma.</span><span class="sxs-lookup"><span data-stu-id="bb644-129">The ClaimType value might be misspelled, or does not exist in the schema.</span></span>
* <span data-ttu-id="bb644-130">Les valeurs ClaimTypes doivent être définies dans au moins l’un des fichiers de la stratégie.</span><span class="sxs-lookup"><span data-stu-id="bb644-130">ClaimType values must be defined in at least one of the files in the policy.</span></span> 
    <span data-ttu-id="bb644-131">Par exemple : ` <ClaimType Id="socialIdpUserId">`</span><span class="sxs-lookup"><span data-stu-id="bb644-131">For example: ` <ClaimType Id="socialIdpUserId">`</span></span>
* <span data-ttu-id="bb644-132">Si la valeur ClaimType est définie dans le fichier d’extensions mais utilisée également dans une valeur TechnicalProfile du fichier de base, le chargement du fichier de base provoque une erreur.</span><span class="sxs-lookup"><span data-stu-id="bb644-132">If ClaimType is defined in the extensions file, but it's also used in a TechnicalProfile value in the base file, uploading the base file results in an error.</span></span>

<span data-ttu-id="bb644-133">Extrait de code de l’erreur :`...makes a reference to a ClaimsTransformation with id...`</span><span class="sxs-lookup"><span data-stu-id="bb644-133">Error snippet: `...makes a reference to a ClaimsTransformation with id...`</span></span>
* <span data-ttu-id="bb644-134">Les causes de l’erreur peuvent être les mêmes que pour l’erreur ClaimType.</span><span class="sxs-lookup"><span data-stu-id="bb644-134">The causes for the error might be the same as for the ClaimType error.</span></span>

<span data-ttu-id="bb644-135">Extrait de code de l’erreur :`Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span><span class="sxs-lookup"><span data-stu-id="bb644-135">Error snippet: `Reason: User is currently logged as a user of 'yourtenant.onmicrosoft.com' tenant. In order to manage 'yourtenant.onmicrosoft.com', please login as a user of 'yourtenant.onmicrosoft.com' tenant`</span></span>
* <span data-ttu-id="bb644-136">Vérifiez que la valeur TenantId dans les éléments  **\<TrustFrameworkPolicy\>** et **\<BasePolicy\>** correspondent à votre locataire Azure AD B2C cible.</span><span class="sxs-lookup"><span data-stu-id="bb644-136">Check that the TenantId value in the **\<TrustFrameworkPolicy\>** and **\<BasePolicy\>** elements match your target Azure AD B2C tenant.</span></span>  

## <a name="troubleshoot-the-runtime"></a><span data-ttu-id="bb644-137">Résoudre les problèmes au moment de l’exécution</span><span class="sxs-lookup"><span data-stu-id="bb644-137">Troubleshoot the runtime</span></span>

* <span data-ttu-id="bb644-138">Utilisez `Run Now` et `https://jwt.io` pour tester vos stratégies indépendamment de votre application web ou mobile.</span><span class="sxs-lookup"><span data-stu-id="bb644-138">Use `Run Now` and `https://jwt.io` to test your policies independently of your web or mobile application.</span></span> <span data-ttu-id="bb644-139">Ce site web agit comme une application par partie de confiance.</span><span class="sxs-lookup"><span data-stu-id="bb644-139">This website acts like a relying party application.</span></span> <span data-ttu-id="bb644-140">Il affiche le contenu du JSON Web Token (JWT) généré par votre stratégie Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="bb644-140">It displays the contents of the JSON Web Token (JWT) that is generated by your Azure AD B2C policy.</span></span> <span data-ttu-id="bb644-141">Pour créer une application de test dans l’Infrastructure d’expérience d’identité, utilisez les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="bb644-141">To create a test application in Identity Experience Framework, use the following values:</span></span>
    * <span data-ttu-id="bb644-142">Nom : TestApp</span><span class="sxs-lookup"><span data-stu-id="bb644-142">Name: TestApp</span></span>
    * <span data-ttu-id="bb644-143">Application/API web : Non</span><span class="sxs-lookup"><span data-stu-id="bb644-143">Web App/Web API: No</span></span>
    * <span data-ttu-id="bb644-144">Client natif : Non</span><span class="sxs-lookup"><span data-stu-id="bb644-144">Native client: No</span></span>

* <span data-ttu-id="bb644-145">Pour suivre l’échange de messages entre votre navigateur client et Azure AD B2C, utilisez [Fiddler](http://www.telerik.com/fiddler).</span><span class="sxs-lookup"><span data-stu-id="bb644-145">To trace the exchange of messages between your client browser and Azure AD B2C, use [Fiddler](http://www.telerik.com/fiddler).</span></span> <span data-ttu-id="bb644-146">Il peut vous aider à obtenir une indication de l’endroit où vos étapes d’orchestration échouent dans le parcours utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bb644-146">It can help you get an indication of where your user journey is failing in your orchestration steps.</span></span>

* <span data-ttu-id="bb644-147">En **Mode de développement**, utilisez **Application Insights** pour suivre l’activité de votre parcours utilisateur d’Infrastructure d’expérience d’identité.</span><span class="sxs-lookup"><span data-stu-id="bb644-147">In **Development mode**, use **Application Insights** to trace the activity of your Identity Experience Framework user journey.</span></span> <span data-ttu-id="bb644-148">En **Mode de développement**, vous pouvez observer l’échange de revendications entre l’Infrastructure d’expérience d’identité et les divers fournisseurs de revendications définis par les profils techniques, tels que les fournisseurs d’identité, les services basés sur les API, le répertoire utilisateur Azure AD B2C et d’autres services comme Azure Multi-Factor-Authentication.</span><span class="sxs-lookup"><span data-stu-id="bb644-148">In **Development mode**, you can observe the exchange of claims between the Identity Experience Framework and the various claims providers that are defined by technical profiles, such as identity providers, API-based services, the Azure AD B2C user directory, and other services, like Azure Multi-Factor-Authentication.</span></span>  

## <a name="recommended-practices"></a><span data-ttu-id="bb644-149">Pratiques recommandées</span><span class="sxs-lookup"><span data-stu-id="bb644-149">Recommended practices</span></span>

<span data-ttu-id="bb644-150">**Conservez plusieurs versions de vos scénarios. Regroupez-les dans un projet avec votre application.**</span><span class="sxs-lookup"><span data-stu-id="bb644-150">**Keep multiple versions of your scenarios. Group them in a project with your application.**</span></span> <span data-ttu-id="bb644-151">Les fichiers de base, d’extensions et de partie de confiance dépendent directement les uns des autres.</span><span class="sxs-lookup"><span data-stu-id="bb644-151">The base, extensions, and relying party files are directly dependent on each other.</span></span> <span data-ttu-id="bb644-152">Enregistrez-les en tant que groupe.</span><span class="sxs-lookup"><span data-stu-id="bb644-152">Save them as a group.</span></span> <span data-ttu-id="bb644-153">À mesure que de nouvelles fonctionnalités sont ajoutées à vos stratégies, conservez des versions de travail distinctes.</span><span class="sxs-lookup"><span data-stu-id="bb644-153">As new features are added to your policies, keep separate working versions.</span></span> <span data-ttu-id="bb644-154">Organisez les versions de travail dans votre propre système de fichiers avec le code d’application avec lequel ils interagissent.</span><span class="sxs-lookup"><span data-stu-id="bb644-154">Stage working versions in your own file system with the application code they interact with.</span></span>  <span data-ttu-id="bb644-155">Vos applications peuvent appeler de nombreuses stratégies de partie de confiance différentes dans un locataire.</span><span class="sxs-lookup"><span data-stu-id="bb644-155">Your applications might invoke many different relying party policies in a tenant.</span></span> <span data-ttu-id="bb644-156">Elles peuvent devenir dépendantes envers les revendications qu’elles attendent de vos stratégies Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="bb644-156">They might become dependent on the claims that they expect from your Azure AD B2C policies.</span></span>

<span data-ttu-id="bb644-157">**Développez et testez des profils techniques avec des parcours utilisateur connus.**</span><span class="sxs-lookup"><span data-stu-id="bb644-157">**Develop and test technical profiles with known user journeys.**</span></span> <span data-ttu-id="bb644-158">Utilisez des stratégies de pack de démarrage testées pour configurer vos profils techniques.</span><span class="sxs-lookup"><span data-stu-id="bb644-158">Use tested starter pack policies to set up your technical profiles.</span></span> <span data-ttu-id="bb644-159">Testez-les séparément avant de les incorporer à vos propres parcours utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bb644-159">Test them separately before you incorporate them into your own user journeys.</span></span>

<span data-ttu-id="bb644-160">**Développez et testez des parcours utilisateur avec des profils techniques testés.**</span><span class="sxs-lookup"><span data-stu-id="bb644-160">**Develop and test user journeys with tested technical profiles.**</span></span> <span data-ttu-id="bb644-161">Changez les étapes d’orchestration d’un parcours utilisateur de manière incrémentielle.</span><span class="sxs-lookup"><span data-stu-id="bb644-161">Change the orchestration steps of a user journey incrementally.</span></span> <span data-ttu-id="bb644-162">Générez progressivement vos scénarios prévus.</span><span class="sxs-lookup"><span data-stu-id="bb644-162">Progressively build your intended scenarios.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb644-163">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bb644-163">Next steps</span></span>

* <span data-ttu-id="bb644-164">Dans GitHub, téléchargez le fichier .zip [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip).</span><span class="sxs-lookup"><span data-stu-id="bb644-164">In GitHub, download the [active-directory-b2c-custom-policy-starterpack] (https://github.com/Azure-Samples/active-directory-b2c-custom-policy-starterpack/archive/master.zip) .zip file.</span></span>
