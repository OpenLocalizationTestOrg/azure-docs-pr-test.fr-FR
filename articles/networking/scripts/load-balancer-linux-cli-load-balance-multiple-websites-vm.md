---
title: "Exemple de script CLI Azure - Équilibrer la charge de plusieurs sites web avec l’interface CLI Azure | Microsoft Docs"
description: "Exemple de Script CLI Azure - Équilibrer la charge de plusieurs sites web sur la même machine virtuelle"
services: load-balancer
documentationcenter: load-balancer
author: KumudD
manager: timlt
editor: tysonn
tags: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: azurecli
ms.topic: article
ms.tgt_pltfrm: 
ms.workload: infrastructure
ms.date: 07/07/2017
ms.author: kumud
ms.openlocfilehash: c5a584b33025122033b930822ae0a0864a7ec1cb
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="load-balance-multiple-websites"></a><span data-ttu-id="f0af0-103">Équilibrer la charge de plusieurs sites web</span><span class="sxs-lookup"><span data-stu-id="f0af0-103">Load balance multiple websites</span></span>

<span data-ttu-id="f0af0-104">Cet exemple de script crée un réseau virtuel avec deux machines virtuelles qui sont membres d’un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f0af0-104">This script sample creates a virtual network with two virtual machines (VM) that are members of an availability set.</span></span> <span data-ttu-id="f0af0-105">Un équilibrage de charge dirige le trafic pour les deux adresses IP distinctes vers les deux machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f0af0-105">A load balancer directs traffic for two separate IP addresses to the two VMs.</span></span> <span data-ttu-id="f0af0-106">Après avoir exécuté le script, vous pouvez déployer le logiciel de serveur web pour les machines virtuelles et héberger plusieurs sites web, chacun avec sa propre adresse IP.</span><span class="sxs-lookup"><span data-stu-id="f0af0-106">After running the script, you could deploy web server software to the VMs and host multiple web sites, each with its own IP address.</span></span>

[!INCLUDE [sample-cli-install](../../../includes/sample-cli-install.md)]

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="sample-script"></a><span data-ttu-id="f0af0-107">Exemple de script</span><span class="sxs-lookup"><span data-stu-id="f0af0-107">Sample script</span></span>


<span data-ttu-id="f0af0-108">[!code-azurecli-interactive[main](../../../cli_scripts/load-balancer/load-balance-multiple-web-sites-vm/load-balance-multiple-web-sites-vm.sh  "Équilibrer la charge de plusieurs sites web")]</span><span class="sxs-lookup"><span data-stu-id="f0af0-108">[!code-azurecli-interactive[main](../../../cli_scripts/load-balancer/load-balance-multiple-web-sites-vm/load-balance-multiple-web-sites-vm.sh  "Load balance multiple web sites")]</span></span>

## <a name="clean-up-deployment"></a><span data-ttu-id="f0af0-109">Nettoyer le déploiement</span><span class="sxs-lookup"><span data-stu-id="f0af0-109">Clean up deployment</span></span> 

<span data-ttu-id="f0af0-110">Exécutez la commande suivante pour supprimer le groupe de ressources, la machine virtuelle et toutes les ressources associées.</span><span class="sxs-lookup"><span data-stu-id="f0af0-110">Run the following command to remove the resource group, VM, and all related resources.</span></span>

```azurecli
az group delete --name myResourceGroup --yes
```

## <a name="script-explanation"></a><span data-ttu-id="f0af0-111">Explication du script</span><span class="sxs-lookup"><span data-stu-id="f0af0-111">Script explanation</span></span>

<span data-ttu-id="f0af0-112">Ce script utilise les commandes suivantes pour créer un groupe de ressources, un réseau virtuel, un équilibreur de charge et toutes les ressources associées.</span><span class="sxs-lookup"><span data-stu-id="f0af0-112">This script uses the following commands to create a resource group, virtual network, load balancer, and all related resources.</span></span> <span data-ttu-id="f0af0-113">Chaque commande du tableau renvoie à une documentation spécifique.</span><span class="sxs-lookup"><span data-stu-id="f0af0-113">Each command in the table links to command specific documentation.</span></span>

| <span data-ttu-id="f0af0-114">Commande</span><span class="sxs-lookup"><span data-stu-id="f0af0-114">Command</span></span> | <span data-ttu-id="f0af0-115">Remarques</span><span class="sxs-lookup"><span data-stu-id="f0af0-115">Notes</span></span> |
|---|---|
| [<span data-ttu-id="f0af0-116">az group create</span><span class="sxs-lookup"><span data-stu-id="f0af0-116">az group create</span></span>](https://docs.microsoft.com/cli/azure/group#create) | <span data-ttu-id="f0af0-117">Crée un groupe de ressources dans lequel toutes les ressources sont stockées.</span><span class="sxs-lookup"><span data-stu-id="f0af0-117">Creates a resource group in which all resources are stored.</span></span> |
| [<span data-ttu-id="f0af0-118">az network vnet create</span><span class="sxs-lookup"><span data-stu-id="f0af0-118">az network vnet create</span></span>](https://docs.microsoft.com/cli/azure/network/vnet#create) | <span data-ttu-id="f0af0-119">Crée un réseau virtuel et un sous-réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="f0af0-119">Creates an Azure virtual network and subnet.</span></span> |
| [<span data-ttu-id="f0af0-120">az network public-ip create</span><span class="sxs-lookup"><span data-stu-id="f0af0-120">az network public-ip create</span></span>](https://docs.microsoft.com/cli/azure/network/public-ip#create) | <span data-ttu-id="f0af0-121">Crée une adresse IP publique avec une adresse IP statique et un nom DNS associé.</span><span class="sxs-lookup"><span data-stu-id="f0af0-121">Creates a public IP address with a static IP address and an associated DNS name.</span></span> |
| [<span data-ttu-id="f0af0-122">az network lb create</span><span class="sxs-lookup"><span data-stu-id="f0af0-122">az network lb create</span></span>](https://docs.microsoft.com/cli/azure/network/lb#create) | <span data-ttu-id="f0af0-123">Crée un équilibreur de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="f0af0-123">Creates an Azure Load Balancer.</span></span> |
| [<span data-ttu-id="f0af0-124">az network lb probe create</span><span class="sxs-lookup"><span data-stu-id="f0af0-124">az network lb probe create</span></span>](https://docs.microsoft.com/cli/azure/network/lb/probe#create) | <span data-ttu-id="f0af0-125">Crée une sonde d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="f0af0-125">Creates a load balancer probe.</span></span> <span data-ttu-id="f0af0-126">Les sondes d’équilibreurs de charge permettent de surveiller chaque machine virtuelle d’un jeu d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f0af0-126">A load balancer probe is used to monitor each VM in the load balancer set.</span></span> <span data-ttu-id="f0af0-127">Si une machine virtuelle n’est plus accessible, le trafic n’est pas acheminé vers cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="f0af0-127">If any VM becomes inaccessible, traffic is not routed to the VM.</span></span> |
| [<span data-ttu-id="f0af0-128">az network lb rule create</span><span class="sxs-lookup"><span data-stu-id="f0af0-128">az network lb rule create</span></span>](https://docs.microsoft.com/cli/azure/network/lb/rule#create) | <span data-ttu-id="f0af0-129">Crée une règle d’équilibeur de charge.</span><span class="sxs-lookup"><span data-stu-id="f0af0-129">Creates a load balancer rule.</span></span> <span data-ttu-id="f0af0-130">Dans cet exemple, une règle est créée pour le port 80.</span><span class="sxs-lookup"><span data-stu-id="f0af0-130">In this sample, a rule is created for port 80.</span></span> <span data-ttu-id="f0af0-131">Le trafic HTTP qui arrive à l’équilibreur de charge est acheminé vers le port 80 de l’une des machines virtuelles du jeu d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f0af0-131">As HTTP traffic arrives at the load balancer, it is routed to port 80 one of the VMs in the load balancer set.</span></span> |
| [<span data-ttu-id="f0af0-132">az network lb frontend-ip create</span><span class="sxs-lookup"><span data-stu-id="f0af0-132">az network lb frontend-ip create</span></span>](https://docs.microsoft.com/cli/azure/network/lb/frontend-ip#create) | <span data-ttu-id="f0af0-133">Créez une adresse IP frontale pour l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="f0af0-133">Create a frontend IP address for the Load Balancer.</span></span> |
| [<span data-ttu-id="f0af0-134">az network lb address-pool create</span><span class="sxs-lookup"><span data-stu-id="f0af0-134">az network lb address-pool create</span></span>](https://docs.microsoft.com/cli/azure/network/lb/address-pool#create) | <span data-ttu-id="f0af0-135">Crée un pool d’adresses principal.</span><span class="sxs-lookup"><span data-stu-id="f0af0-135">Creates a backend address pool.</span></span> |
| [<span data-ttu-id="f0af0-136">az network nic create</span><span class="sxs-lookup"><span data-stu-id="f0af0-136">az network nic create</span></span>](https://docs.microsoft.com/cli/azure/network/nic#create) | <span data-ttu-id="f0af0-137">Crée une carte réseau virtuelle et l’associe au réseau virtuel et au sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="f0af0-137">Creates a virtual network card and attaches it to the virtual network, and subnet.</span></span> |
| [<span data-ttu-id="f0af0-138">az vm availability-set create</span><span class="sxs-lookup"><span data-stu-id="f0af0-138">az vm availability-set create</span></span>](https://docs.microsoft.com/cli/azure/network/lb/rule#create) | <span data-ttu-id="f0af0-139">Crée un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f0af0-139">Creates an availability set.</span></span> <span data-ttu-id="f0af0-140">Les groupes à haute disponibilité garantissent le temps de fonctionnement des applications en répartissant les machines virtuelles sur les ressources physiques de sorte que, en cas d’échec, l’ensemble du groupe ne soit pas affecté.</span><span class="sxs-lookup"><span data-stu-id="f0af0-140">Availability sets ensure application uptime by spreading the virtual machines across physical resources such that if failure occurs, the entire set is not effected.</span></span> |
| [<span data-ttu-id="f0af0-141">az network nic ip-config create</span><span class="sxs-lookup"><span data-stu-id="f0af0-141">az network nic ip-config create</span></span>](https://docs.microsoft.com/cli/azure/network/nic/ip-config#create) | <span data-ttu-id="f0af0-142">Crée une configuration IP.</span><span class="sxs-lookup"><span data-stu-id="f0af0-142">Creates an IP confiuration.</span></span> <span data-ttu-id="f0af0-143">Vous devez activer la fonction Microsoft.Network/AllowMultipleIpConfigurationsPerNic pour votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="f0af0-143">You must have the Microsoft.Network/AllowMultipleIpConfigurationsPerNic feature enabled for your subscription.</span></span> <span data-ttu-id="f0af0-144">Seule une configuration par carte réseau peut être désignée comme configuration IP principale, à l’aide de l’indicateur --make-primary.</span><span class="sxs-lookup"><span data-stu-id="f0af0-144">Only one configuration may be designated as the primary IP configuration per NIC, using the --make-primary flag.</span></span> |
| [<span data-ttu-id="f0af0-145">az vm create</span><span class="sxs-lookup"><span data-stu-id="f0af0-145">az vm create</span></span>](https://docs.microsoft.com/cli/azure/vm/availability-set#create) | <span data-ttu-id="f0af0-146">Crée la machine virtuelle et l’associe à la carte réseau, au réseau virtuel, au sous-réseau et au groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="f0af0-146">Creates the virtual machine and connects it to the network card, virtual network, subnet, and NSG.</span></span> <span data-ttu-id="f0af0-147">Cette commande spécifie également l’image de machine virtuelle à utiliser ainsi que les informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="f0af0-147">This command also specifies the virtual machine image to be used and administrative credentials.</span></span>  |
| [<span data-ttu-id="f0af0-148">az group delete</span><span class="sxs-lookup"><span data-stu-id="f0af0-148">az group delete</span></span>](https://docs.microsoft.com/cli/azure/vm/extension#set) | <span data-ttu-id="f0af0-149">Supprime un groupe de ressources, y compris toutes les ressources imbriquées.</span><span class="sxs-lookup"><span data-stu-id="f0af0-149">Deletes a resource group including all nested resources.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="f0af0-150">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f0af0-150">Next steps</span></span>

<span data-ttu-id="f0af0-151">Pour plus d’informations sur l’interface Azure CLI, consultez la [documentation relative à l’interface Azure CLI](https://docs.microsoft.com/cli/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="f0af0-151">For more information on the Azure CLI, see [Azure CLI documentation](https://docs.microsoft.com/cli/azure/overview).</span></span>

<span data-ttu-id="f0af0-152">Vous pouvez trouver des exemples supplémentaires de scripts CLI de mise en réseau dans la [documentation Vue d’ensemble de la mise en réseau Azure](../cli-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="f0af0-152">Additional networking CLI script samples can be found in the [Azure Networking Overview documentation](../cli-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span></span>
