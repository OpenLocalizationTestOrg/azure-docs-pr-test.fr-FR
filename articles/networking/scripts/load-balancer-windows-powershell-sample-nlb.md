---
title: "Exemple de Script PowerShell - charge équilibrer le trafic tooVMs pour la haute disponibilité d’aaaAzure | Documents Microsoft"
description: "Exemple de PowerShell Script Azure - charge équilibrer le trafic tooVMs pour la haute disponibilité"
services: load-balancer
documentationcenter: load-balancer
author: georgewallace
manager: timlt
editor: tysonn
tags: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: powershell
ms.topic: article
ms.tgt_pltfrm: 
ms.workload: infrastructure
ms.date: 05/16/2017
ms.author: gwallace
ms.openlocfilehash: 332c39e1aad071ca6f7ce420ccc1f423ef647d2d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="load-balance-traffic-toovms-for-high-availability"></a><span data-ttu-id="49c24-103">Charger tooVMs le trafic de solde pour la haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="49c24-103">Load balance traffic tooVMs for high availability</span></span>

<span data-ttu-id="49c24-104">Cet exemple de script crée tous les éléments nécessaires toorun plusieurs machines virtuelles de Windows configurés dans une haute disponibilité et de charge équilibrée de configuration.</span><span class="sxs-lookup"><span data-stu-id="49c24-104">This script sample creates everything needed toorun several Windows virtual machines configured in a highly available and load balanced configuration.</span></span> <span data-ttu-id="49c24-105">Après l’exécution du script hello, vous aurez trois machines virtuelles, tooan jointe à haute disponibilité Azure et accessible via un équilibrage de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="49c24-105">After running hello script, you will have three virtual machines, joined tooan Azure Availability Set, and accessible through an Azure Load Balancer.</span></span>

<span data-ttu-id="49c24-106">Si nécessaire, installez hello Azure PowerShell en utilisant une instruction de hello trouvé dans hello [guide Azure PowerShell](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/), puis exécutez `Login-AzureRmAccount` toocreate une connexion avec Azure.</span><span class="sxs-lookup"><span data-stu-id="49c24-106">If needed, install hello Azure PowerShell using hello instruction found in hello [Azure PowerShell guide](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/), and then run `Login-AzureRmAccount` toocreate a connection with Azure.</span></span>

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="sample-script"></a><span data-ttu-id="49c24-107">Exemple de script</span><span class="sxs-lookup"><span data-stu-id="49c24-107">Sample script</span></span>

[!code-powershell[main](../../../powershell_scripts/virtual-machine/create-vm-nlb/create-vm-nlb.ps1 "Quick Create VM")]

## <a name="clean-up-deployment"></a><span data-ttu-id="49c24-108">Nettoyer le déploiement</span><span class="sxs-lookup"><span data-stu-id="49c24-108">Clean up deployment</span></span> 

<span data-ttu-id="49c24-109">Exécutez hello suivant du groupe de ressources de commande tooremove hello, machine virtuelle et toutes les ressources.</span><span class="sxs-lookup"><span data-stu-id="49c24-109">Run hello following command tooremove hello resource group, VM, and all related resources.</span></span>

```powershell
Remove-AzureRmResourceGroup -Name myResourceGroup
```

## <a name="script-explanation"></a><span data-ttu-id="49c24-110">Explication du script</span><span class="sxs-lookup"><span data-stu-id="49c24-110">Script explanation</span></span>

<span data-ttu-id="49c24-111">Ce script utilise hello suivant de commandes toocreate un groupe de ressources, machine virtuelle, haute disponibilité, équilibrage de charge et toutes les ressources.</span><span class="sxs-lookup"><span data-stu-id="49c24-111">This script uses hello following commands toocreate a resource group, virtual machine, availability set, load balancer, and all related resources.</span></span> <span data-ttu-id="49c24-112">Chaque commande figurant dans la documentation spécifique du toocommand liens table hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-112">Each command in hello table links toocommand specific documentation.</span></span>

| <span data-ttu-id="49c24-113">Commande</span><span class="sxs-lookup"><span data-stu-id="49c24-113">Command</span></span> | <span data-ttu-id="49c24-114">Remarques</span><span class="sxs-lookup"><span data-stu-id="49c24-114">Notes</span></span> |
|---|---|
| [<span data-ttu-id="49c24-115">New-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="49c24-115">New-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/new-azurermresourcegroup) | <span data-ttu-id="49c24-116">Crée un groupe de ressources dans lequel toutes les ressources sont stockées.</span><span class="sxs-lookup"><span data-stu-id="49c24-116">Creates a resource group in which all resources are stored.</span></span> |
| [<span data-ttu-id="49c24-117">New-AzureRmVirtualNetworkSubnetConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-117">New-AzureRmVirtualNetworkSubnetConfig</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetworksubnetconfig) | <span data-ttu-id="49c24-118">Crée une configuration de sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="49c24-118">Creates a subnet configuration.</span></span> <span data-ttu-id="49c24-119">Cette configuration est utilisée avec le processus de création du réseau virtuel hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-119">This configuration is used with hello virtual network creation process.</span></span> |
| [<span data-ttu-id="49c24-120">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="49c24-120">New-AzureRmVirtualNetwork</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetwork) | <span data-ttu-id="49c24-121">Crée un réseau virtuel et un sous-réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="49c24-121">Creates an Azure virtual network and subnet.</span></span> |
| [<span data-ttu-id="49c24-122">New-AzureRmPublicIpAddress</span><span class="sxs-lookup"><span data-stu-id="49c24-122">New-AzureRmPublicIpAddress</span></span>](/powershell/module/azurerm.network/new-azurermpublicipaddress)  | <span data-ttu-id="49c24-123">Crée une adresse IP publique avec une adresse IP statique et un nom DNS associé.</span><span class="sxs-lookup"><span data-stu-id="49c24-123">Creates a public IP address with a static IP address and an associated DNS name.</span></span> |
| [<span data-ttu-id="49c24-124">New-AzureRmLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="49c24-124">New-AzureRmLoadBalancer</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancer)  | <span data-ttu-id="49c24-125">Crée un équilibreur de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="49c24-125">Creates an Azure load balancer.</span></span> |
| [<span data-ttu-id="49c24-126">New-AzureRmLoadBalancerProbeConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-126">New-AzureRmLoadBalancerProbeConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerprobeconfig) | <span data-ttu-id="49c24-127">Crée une sonde d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="49c24-127">Creates a load balancer probe.</span></span> <span data-ttu-id="49c24-128">Une sonde d’équilibrage de charge est utilisé toomonitor chaque machine virtuelle dans le jeu d’équilibrage de charge de hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-128">A load balancer probe is used toomonitor each VM in hello load balancer set.</span></span> <span data-ttu-id="49c24-129">Si toutes les machines virtuelles devient inaccessible, le trafic n’est pas routé toohello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="49c24-129">If any VM becomes inaccessible, traffic is not routed toohello VM.</span></span> |
| [<span data-ttu-id="49c24-130">New-AzureRmLoadBalancerRuleConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-130">New-AzureRmLoadBalancerRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerruleconfig) | <span data-ttu-id="49c24-131">Crée une règle d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="49c24-131">Creates an load balancer rule.</span></span> <span data-ttu-id="49c24-132">Dans cet exemple, une règle est créée pour le port 80.</span><span class="sxs-lookup"><span data-stu-id="49c24-132">In this sample, a rule is created for port 80.</span></span> <span data-ttu-id="49c24-133">Comme le trafic HTTP arrive au niveau de l’équilibrage de charge hello, il est routé tooport 80 une des machines virtuelles de hello dans le jeu d’équilibrage de charge de hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-133">As HTTP traffic arrives at hello load balancer, it is routed tooport 80 one of hello VMs in hello load balancer set.</span></span> |
| [<span data-ttu-id="49c24-134">New-AzureRmLoadBalancerInboundNatRuleConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-134">New-AzureRmLoadBalancerInboundNatRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerinboundnatruleconfig) | <span data-ttu-id="49c24-135">Crée une règle de traduction d’adresses réseau (NAT) pour l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="49c24-135">Creates a load balancer Network Address Translation (NAT) rule.</span></span>  <span data-ttu-id="49c24-136">Les règles NAT de mappent un port de port de tooa d’équilibrage de charge de hello sur une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="49c24-136">NAT rules map a port of hello load balancer tooa port on a VM.</span></span> <span data-ttu-id="49c24-137">Dans cet exemple, une règle NAT est créée pour SSH trafic tooeach machine virtuelle dans le jeu d’équilibrage de charge de hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-137">In this sample, a NAT rule is created for SSH traffic tooeach VM in hello load balancer set.</span></span>  |
| [<span data-ttu-id="49c24-138">New-AzureRmNetworkSecurityGroup</span><span class="sxs-lookup"><span data-stu-id="49c24-138">New-AzureRmNetworkSecurityGroup</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecuritygroup) | <span data-ttu-id="49c24-139">Crée un groupe de sécurité réseau (NSG), qui est une limite de sécurité entre l’ordinateur virtuel pour internet et hello hello.</span><span class="sxs-lookup"><span data-stu-id="49c24-139">Creates a network security group (NSG), which is a security boundary between hello internet and hello virtual machine.</span></span> |
| [<span data-ttu-id="49c24-140">New-AzureRmNetworkSecurityRuleConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-140">New-AzureRmNetworkSecurityRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecurityruleconfig) | <span data-ttu-id="49c24-141">Crée un tooallow de règle de groupe de sécurité réseau le trafic entrant.</span><span class="sxs-lookup"><span data-stu-id="49c24-141">Creates an NSG rule tooallow inbound traffic.</span></span> <span data-ttu-id="49c24-142">Dans cet exemple, le port 22 est ouvert pour le trafic SSH.</span><span class="sxs-lookup"><span data-stu-id="49c24-142">In this sample, port 22 is opened for SSH traffic.</span></span> |
| [<span data-ttu-id="49c24-143">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="49c24-143">New-AzureRmNetworkInterface</span></span>](/powershell/module/azurerm.network/new-azurermnetworkinterface) | <span data-ttu-id="49c24-144">Crée une carte réseau virtuelle et attache les réseaux virtuels toohello, du sous-réseau et groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="49c24-144">Creates a virtual network card and attaches it toohello virtual network, subnet, and NSG.</span></span> |
| [<span data-ttu-id="49c24-145">New-AzureRmAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="49c24-145">New-AzureRmAvailabilitySet</span></span>](/powershell/module/azurerm.compute/new-azurermavailabilityset) | <span data-ttu-id="49c24-146">Crée un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="49c24-146">Creates an availability set.</span></span> <span data-ttu-id="49c24-147">Haute disponibilité garantit la disponibilité des applications en répartissant les machines virtuelles de hello sur ressources physiques telles qu’en cas de défaillance, ensemble hello n’est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="49c24-147">Availability sets ensure application uptime by spreading hello virtual machines across physical resources such that if failure occurs, hello entire set is not effected.</span></span> |
| [<span data-ttu-id="49c24-148">New-AzureRmVMConfig</span><span class="sxs-lookup"><span data-stu-id="49c24-148">New-AzureRmVMConfig</span></span>](/powershell/module/azurerm.compute/new-azurermvmconfig) | <span data-ttu-id="49c24-149">Crée une configuration de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="49c24-149">Creates a VM configuration.</span></span> <span data-ttu-id="49c24-150">Cette configuration inclut des informations telles que le nom de la machine virtuelle, le système d’exploitation et les informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="49c24-150">This configuration includes information such as VM name, operating system, and administrative credentials.</span></span> <span data-ttu-id="49c24-151">configuration de Hello est utilisée lors de la création de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="49c24-151">hello configuration is used during VM creation.</span></span> |
| [<span data-ttu-id="49c24-152">New-AzureRmVM</span><span class="sxs-lookup"><span data-stu-id="49c24-152">New-AzureRmVM</span></span>](/powershell/module/azurerm.compute/new-azurermvm)  | <span data-ttu-id="49c24-153">Crée la machine virtuelle de hello et connecte une carte réseau de toohello, du réseau virtuel, sous-réseau et groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="49c24-153">Creates hello virtual machine and connects it toohello network card, virtual network, subnet, and NSG.</span></span> <span data-ttu-id="49c24-154">Cette commande spécifie également toobe d’image de machine virtuelle hello utilisé et les informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="49c24-154">This command also specifies hello virtual machine image toobe used and administrative credentials.</span></span>  |
| [<span data-ttu-id="49c24-155">Remove-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="49c24-155">Remove-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/remove-azurermresourcegroup) | <span data-ttu-id="49c24-156">Supprime un groupe de ressources, y compris toutes les ressources imbriquées.</span><span class="sxs-lookup"><span data-stu-id="49c24-156">Deletes a resource group including all nested resources.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="49c24-157">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="49c24-157">Next steps</span></span>

<span data-ttu-id="49c24-158">Pour plus d’informations sur hello Azure PowerShell, consultez [documentation Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="49c24-158">For more information on hello Azure PowerShell, see [Azure PowerShell documentation](https://docs.microsoft.com/powershell/azure/overview).</span></span>

<span data-ttu-id="49c24-159">Vous trouverez des exemples de script PowerShell mise en réseau supplémentaires dans hello [documentation de vue d’ensemble de la mise en réseau Azure](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="49c24-159">Additional networking PowerShell script samples can be found in hello [Azure Networking Overview documentation](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span></span>
