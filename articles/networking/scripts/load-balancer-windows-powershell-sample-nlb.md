---
title: "Exemple de script Azure PowerShell - Équilibrage de charge du trafic vers des machines virtuelles afin d’obtenir une haute disponibilité | Microsoft Docs"
description: "Exemple de script Azure PowerShell - Équilibrage de charge du trafic vers des machines virtuelles afin d’obtenir une haute disponibilité"
services: load-balancer
documentationcenter: load-balancer
author: georgewallace
manager: timlt
editor: tysonn
tags: 
ms.assetid: 
ms.service: load-balancer
ms.devlang: powershell
ms.topic: article
ms.tgt_pltfrm: 
ms.workload: infrastructure
ms.date: 05/16/2017
ms.author: gwallace
ms.openlocfilehash: c77def8906b151f2cc6e4bbc4188be8ecbeac732
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="load-balance-traffic-to-vms-for-high-availability"></a><span data-ttu-id="b6a16-103">Équilibrer le trafic sur les machines virtuelles pour la haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="b6a16-103">Load balance traffic to VMs for high availability</span></span>

<span data-ttu-id="b6a16-104">Cet exemple de script crée tous les éléments nécessaires pour exécuter plusieurs machines virtuelles Windows configurées dans une configuration haute disponibilité avec équilibrage de la charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-104">This script sample creates everything needed to run several Windows virtual machines configured in a highly available and load balanced configuration.</span></span> <span data-ttu-id="b6a16-105">Une fois que vous avez exécuté le script, vous obtenez trois machines virtuelles jointes à un groupe à haute disponibilité Azure et accessibles par le biais d’Azure Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="b6a16-105">After running the script, you will have three virtual machines, joined to an Azure Availability Set, and accessible through an Azure Load Balancer.</span></span>

<span data-ttu-id="b6a16-106">Si nécessaire, installez Azure PowerShell à l’aide des instructions figurant dans le [Guide Azure PowerShell](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/), puis exécutez `Login-AzureRmAccount` pour créer une connexion avec Azure.</span><span class="sxs-lookup"><span data-stu-id="b6a16-106">If needed, install the Azure PowerShell using the instruction found in the [Azure PowerShell guide](https://docs.microsoft.com/powershell/azureps-cmdlets-docs/), and then run `Login-AzureRmAccount` to create a connection with Azure.</span></span>

[!INCLUDE [quickstarts-free-trial-note](../../../includes/quickstarts-free-trial-note.md)]

## <a name="sample-script"></a><span data-ttu-id="b6a16-107">Exemple de script</span><span class="sxs-lookup"><span data-stu-id="b6a16-107">Sample script</span></span>

<span data-ttu-id="b6a16-108">[!code-powershell[main](../../../powershell_scripts/virtual-machine/create-vm-nlb/create-vm-nlb.ps1 "Création rapide de machine virtuelle")]</span><span class="sxs-lookup"><span data-stu-id="b6a16-108">[!code-powershell[main](../../../powershell_scripts/virtual-machine/create-vm-nlb/create-vm-nlb.ps1 "Quick Create VM")]</span></span>

## <a name="clean-up-deployment"></a><span data-ttu-id="b6a16-109">Nettoyer le déploiement</span><span class="sxs-lookup"><span data-stu-id="b6a16-109">Clean up deployment</span></span> 

<span data-ttu-id="b6a16-110">Exécutez la commande suivante pour supprimer le groupe de ressources, la machine virtuelle et toutes les ressources associées.</span><span class="sxs-lookup"><span data-stu-id="b6a16-110">Run the following command to remove the resource group, VM, and all related resources.</span></span>

```powershell
Remove-AzureRmResourceGroup -Name myResourceGroup
```

## <a name="script-explanation"></a><span data-ttu-id="b6a16-111">Explication du script</span><span class="sxs-lookup"><span data-stu-id="b6a16-111">Script explanation</span></span>

<span data-ttu-id="b6a16-112">Ce script utilise les commandes suivantes pour créer un groupe de ressources, une machine virtuelle, un groupe à haute disponibilité, un équilibreur de charge et toutes les ressources associées.</span><span class="sxs-lookup"><span data-stu-id="b6a16-112">This script uses the following commands to create a resource group, virtual machine, availability set, load balancer, and all related resources.</span></span> <span data-ttu-id="b6a16-113">Chaque commande du tableau renvoie à une documentation spécifique.</span><span class="sxs-lookup"><span data-stu-id="b6a16-113">Each command in the table links to command specific documentation.</span></span>

| <span data-ttu-id="b6a16-114">Commande</span><span class="sxs-lookup"><span data-stu-id="b6a16-114">Command</span></span> | <span data-ttu-id="b6a16-115">Remarques</span><span class="sxs-lookup"><span data-stu-id="b6a16-115">Notes</span></span> |
|---|---|
| [<span data-ttu-id="b6a16-116">New-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="b6a16-116">New-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/new-azurermresourcegroup) | <span data-ttu-id="b6a16-117">Crée un groupe de ressources dans lequel toutes les ressources sont stockées.</span><span class="sxs-lookup"><span data-stu-id="b6a16-117">Creates a resource group in which all resources are stored.</span></span> |
| [<span data-ttu-id="b6a16-118">New-AzureRmVirtualNetworkSubnetConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-118">New-AzureRmVirtualNetworkSubnetConfig</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetworksubnetconfig) | <span data-ttu-id="b6a16-119">Crée une configuration de sous-réseau.</span><span class="sxs-lookup"><span data-stu-id="b6a16-119">Creates a subnet configuration.</span></span> <span data-ttu-id="b6a16-120">Cette configuration est utilisée avec le processus de création du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="b6a16-120">This configuration is used with the virtual network creation process.</span></span> |
| [<span data-ttu-id="b6a16-121">New-AzureRmVirtualNetwork</span><span class="sxs-lookup"><span data-stu-id="b6a16-121">New-AzureRmVirtualNetwork</span></span>](/powershell/module/azurerm.network/new-azurermvirtualnetwork) | <span data-ttu-id="b6a16-122">Crée un réseau virtuel et un sous-réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="b6a16-122">Creates an Azure virtual network and subnet.</span></span> |
| [<span data-ttu-id="b6a16-123">New-AzureRmPublicIpAddress</span><span class="sxs-lookup"><span data-stu-id="b6a16-123">New-AzureRmPublicIpAddress</span></span>](/powershell/module/azurerm.network/new-azurermpublicipaddress)  | <span data-ttu-id="b6a16-124">Crée une adresse IP publique avec une adresse IP statique et un nom DNS associé.</span><span class="sxs-lookup"><span data-stu-id="b6a16-124">Creates a public IP address with a static IP address and an associated DNS name.</span></span> |
| [<span data-ttu-id="b6a16-125">New-AzureRmLoadBalancer</span><span class="sxs-lookup"><span data-stu-id="b6a16-125">New-AzureRmLoadBalancer</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancer)  | <span data-ttu-id="b6a16-126">Crée un équilibreur de charge Azure.</span><span class="sxs-lookup"><span data-stu-id="b6a16-126">Creates an Azure load balancer.</span></span> |
| [<span data-ttu-id="b6a16-127">New-AzureRmLoadBalancerProbeConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-127">New-AzureRmLoadBalancerProbeConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerprobeconfig) | <span data-ttu-id="b6a16-128">Crée une sonde d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-128">Creates a load balancer probe.</span></span> <span data-ttu-id="b6a16-129">Les sondes d’équilibreurs de charge permettent de surveiller chaque machine virtuelle d’un jeu d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-129">A load balancer probe is used to monitor each VM in the load balancer set.</span></span> <span data-ttu-id="b6a16-130">Si une machine virtuelle n’est plus accessible, le trafic n’est pas acheminé vers cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="b6a16-130">If any VM becomes inaccessible, traffic is not routed to the VM.</span></span> |
| [<span data-ttu-id="b6a16-131">New-AzureRmLoadBalancerRuleConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-131">New-AzureRmLoadBalancerRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerruleconfig) | <span data-ttu-id="b6a16-132">Crée une règle d’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-132">Creates an load balancer rule.</span></span> <span data-ttu-id="b6a16-133">Dans cet exemple, une règle est créée pour le port 80.</span><span class="sxs-lookup"><span data-stu-id="b6a16-133">In this sample, a rule is created for port 80.</span></span> <span data-ttu-id="b6a16-134">Le trafic HTTP qui arrive à l’équilibreur de charge est routé vers le port 80 de l’une des machines virtuelles dans le jeu d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-134">As HTTP traffic arrives at the load balancer, it is routed to port 80 one of the VMs in the load balancer set.</span></span> |
| [<span data-ttu-id="b6a16-135">New-AzureRmLoadBalancerInboundNatRuleConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-135">New-AzureRmLoadBalancerInboundNatRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermloadbalancerinboundnatruleconfig) | <span data-ttu-id="b6a16-136">Crée une règle de traduction d’adresses réseau (NAT) pour l’équilibreur de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-136">Creates a load balancer Network Address Translation (NAT) rule.</span></span>  <span data-ttu-id="b6a16-137">Les règles NAT mappent un port de l’équilibreur de charge à un port de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="b6a16-137">NAT rules map a port of the load balancer to a port on a VM.</span></span> <span data-ttu-id="b6a16-138">Dans cet exemple, une règle NAT est créée pour le trafic SSH en direction de chaque machine virtuelle au sein du jeu d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="b6a16-138">In this sample, a NAT rule is created for SSH traffic to each VM in the load balancer set.</span></span>  |
| [<span data-ttu-id="b6a16-139">New-AzureRmNetworkSecurityGroup</span><span class="sxs-lookup"><span data-stu-id="b6a16-139">New-AzureRmNetworkSecurityGroup</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecuritygroup) | <span data-ttu-id="b6a16-140">Crée un groupe de sécurité réseau qui représente une frontière de sécurité entre Internet et la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="b6a16-140">Creates a network security group (NSG), which is a security boundary between the internet and the virtual machine.</span></span> |
| [<span data-ttu-id="b6a16-141">New-AzureRmNetworkSecurityRuleConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-141">New-AzureRmNetworkSecurityRuleConfig</span></span>](/powershell/module/azurerm.network/new-azurermnetworksecurityruleconfig) | <span data-ttu-id="b6a16-142">Crée une règle de groupe de sécurité réseau permettant d’autoriser le trafic entrant.</span><span class="sxs-lookup"><span data-stu-id="b6a16-142">Creates an NSG rule to allow inbound traffic.</span></span> <span data-ttu-id="b6a16-143">Dans cet exemple, le port 22 est ouvert pour le trafic SSH.</span><span class="sxs-lookup"><span data-stu-id="b6a16-143">In this sample, port 22 is opened for SSH traffic.</span></span> |
| [<span data-ttu-id="b6a16-144">New-AzureRmNetworkInterface</span><span class="sxs-lookup"><span data-stu-id="b6a16-144">New-AzureRmNetworkInterface</span></span>](/powershell/module/azurerm.network/new-azurermnetworkinterface) | <span data-ttu-id="b6a16-145">Crée une carte réseau virtuelle et l’associe au réseau virtuel, au sous-réseau et au groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="b6a16-145">Creates a virtual network card and attaches it to the virtual network, subnet, and NSG.</span></span> |
| [<span data-ttu-id="b6a16-146">New-AzureRmAvailabilitySet</span><span class="sxs-lookup"><span data-stu-id="b6a16-146">New-AzureRmAvailabilitySet</span></span>](/powershell/module/azurerm.compute/new-azurermavailabilityset) | <span data-ttu-id="b6a16-147">Crée un groupe à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="b6a16-147">Creates an availability set.</span></span> <span data-ttu-id="b6a16-148">Les groupes à haute disponibilité garantissent le temps de fonctionnement des applications en répartissant les machines virtuelles sur les ressources physiques de sorte que, en cas d’échec, l’ensemble du groupe ne soit pas affecté.</span><span class="sxs-lookup"><span data-stu-id="b6a16-148">Availability sets ensure application uptime by spreading the virtual machines across physical resources such that if failure occurs, the entire set is not effected.</span></span> |
| [<span data-ttu-id="b6a16-149">New-AzureRmVMConfig</span><span class="sxs-lookup"><span data-stu-id="b6a16-149">New-AzureRmVMConfig</span></span>](/powershell/module/azurerm.compute/new-azurermvmconfig) | <span data-ttu-id="b6a16-150">Crée une configuration de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="b6a16-150">Creates a VM configuration.</span></span> <span data-ttu-id="b6a16-151">Cette configuration inclut des informations telles que le nom de la machine virtuelle, le système d’exploitation et les informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="b6a16-151">This configuration includes information such as VM name, operating system, and administrative credentials.</span></span> <span data-ttu-id="b6a16-152">La configuration est utilisée lors de la création de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="b6a16-152">The configuration is used during VM creation.</span></span> |
| [<span data-ttu-id="b6a16-153">New-AzureRmVM</span><span class="sxs-lookup"><span data-stu-id="b6a16-153">New-AzureRmVM</span></span>](/powershell/module/azurerm.compute/new-azurermvm)  | <span data-ttu-id="b6a16-154">Crée la machine virtuelle et l’associe à la carte réseau, au réseau virtuel, au sous-réseau et au groupe de sécurité réseau.</span><span class="sxs-lookup"><span data-stu-id="b6a16-154">Creates the virtual machine and connects it to the network card, virtual network, subnet, and NSG.</span></span> <span data-ttu-id="b6a16-155">Cette commande spécifie également l’image de machine virtuelle à utiliser ainsi que les informations d’identification d’administration.</span><span class="sxs-lookup"><span data-stu-id="b6a16-155">This command also specifies the virtual machine image to be used and administrative credentials.</span></span>  |
| [<span data-ttu-id="b6a16-156">Remove-AzureRmResourceGroup</span><span class="sxs-lookup"><span data-stu-id="b6a16-156">Remove-AzureRmResourceGroup</span></span>](/powershell/module/azurerm.resources/remove-azurermresourcegroup) | <span data-ttu-id="b6a16-157">Supprime un groupe de ressources, y compris toutes les ressources imbriquées.</span><span class="sxs-lookup"><span data-stu-id="b6a16-157">Deletes a resource group including all nested resources.</span></span> |

## <a name="next-steps"></a><span data-ttu-id="b6a16-158">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="b6a16-158">Next steps</span></span>

<span data-ttu-id="b6a16-159">Pour plus d’informations sur Azure PowerShell, consultez la [documentation Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="b6a16-159">For more information on the Azure PowerShell, see [Azure PowerShell documentation](https://docs.microsoft.com/powershell/azure/overview).</span></span>

<span data-ttu-id="b6a16-160">Vous pouvez trouver des exemples supplémentaires de scripts PowerShell de mise en réseau dans la [documentation Vue d’ensemble de la mise en réseau Azure](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="b6a16-160">Additional networking PowerShell script samples can be found in the [Azure Networking Overview documentation](../powershell-samples.md?toc=%2fazure%2fnetworking%2ftoc.json).</span></span>
