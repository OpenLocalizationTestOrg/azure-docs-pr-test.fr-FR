---
title: "Utilisation de captures instantanées incrémentielles pour la sauvegarde et la récupération de disques de machines virtuelles Azure non gérés | Microsoft Docs"
description: "Créer une solution personnalisée pour la sauvegarde et la récupération de vos disques de machine virtuelle Azure à l’aide d’instantanés incrémentiels."
services: storage
documentationcenter: na
author: aungoo-msft
manager: tadb
editor: tysonn
ms.assetid: 3524b987-bd65-4e35-83e7-fbc2136643e5
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/23/2017
ms.author: aungoo
ms.openlocfilehash: 7b08ce207b2a3cc2dd3d3559765def6af42a844a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="1c6f6-103">Sauvegarder les disques de machines virtuelles Azure non gérés avec des captures instantanées incrémentielles</span><span class="sxs-lookup"><span data-stu-id="1c6f6-103">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="1c6f6-104">Vue d’ensemble</span><span class="sxs-lookup"><span data-stu-id="1c6f6-104">Overview</span></span>
<span data-ttu-id="1c6f6-105">Azure Storage offre la possibilité de prendre des instantanés d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-105">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="1c6f6-106">Les instantanés capturent l’état de l’objet blob à un instant précis.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-106">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="1c6f6-107">Dans cet article, nous allons décrire comment gérer des sauvegardes de disques de machine virtuelle à l’aide d’instantanés.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-107">In this article, we will describe a scenario of how you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="1c6f6-108">Vous pouvez utiliser cette méthode comme une alternative à Azure Backup et Recovery Service et si vous voulez créer une stratégie de sauvegarde personnalisée pour vos disques de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-108">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="1c6f6-109">Les disques de machine virtuelle Azure sont stockés en tant qu’objets blob de pages dans Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-109">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="1c6f6-110">Étant donné que cet article aborde la stratégie de sauvegarde des disques de machine virtuelle, nous faisons référence aux instantanés dans le contexte des objets blob de pages.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-110">Since we are talking about backup strategy for virtual machine disks in this article, we will be referring to snapshots in the context of page blobs.</span></span> <span data-ttu-id="1c6f6-111">Pour plus d’informations sur les instantanés, reportez-vous à [Création d’un instantané d’objet blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-111">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="1c6f6-112">Qu’est-ce qu’un instantané ?</span><span class="sxs-lookup"><span data-stu-id="1c6f6-112">What is a snapshot?</span></span>
<span data-ttu-id="1c6f6-113">Un instantané d’objet blob est une version en lecture seule d’un objet blob capturé à un instant donné.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-113">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="1c6f6-114">Un instantané peut être lu, copié ou supprimé, mais pas modifié.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-114">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="1c6f6-115">Les instantanés sont une façon de sauvegarder un objet blob à un instant T.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-115">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="1c6f6-116">Jusqu’à la version REST 2015-04-05, vous aviez la possibilité de copier des instantanés complets.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-116">Until REST version 2015-04-05 you had the ability to copy full snapshots.</span></span> <span data-ttu-id="1c6f6-117">À partir de la version REST 2015-07-08, vous pouvez également copier des instantanés incrémentiels.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-117">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="1c6f6-118">Copie d’un instantané complet</span><span class="sxs-lookup"><span data-stu-id="1c6f6-118">Full snapshot copy</span></span>
<span data-ttu-id="1c6f6-119">Les instantanés peuvent être copiés vers un autre compte de stockage en tant qu’objet blob pour conserver des sauvegardes de l’objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-119">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="1c6f6-120">Vous pouvez également copier un instantané sur l’objet blob de base, ce qui revient à restaurer l’objet blob à une version antérieure.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-120">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="1c6f6-121">Quand un instantané est copié d’un compte de stockage à un autre, il occupe le même espace que l’objet blob de pages de base.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-121">When a snapshot is copied from one storage account to another, it will occupy the same space as the base page blob.</span></span> <span data-ttu-id="1c6f6-122">Par conséquent, la copie d’instantanés complets d’un compte de stockage à l’autre est lente et consomme également beaucoup d’espace dans le compte de stockage cible.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-122">Therefore, copying whole snapshots from one storage account to another will be slow and will also consume lot of space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="1c6f6-123">Si vous copiez l’objet blob de base vers une autre destination, les instantanés de l’objet blob ne sont pas copiés en même temps.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-123">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="1c6f6-124">De même, si vous remplacez un objet blob de base par une copie, les instantanés associés à l’objet blob de base ne sont pas affectés et restent intacts sous le nom de l’objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-124">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="1c6f6-125">Sauvegarder des disques à l’aide d’instantanés</span><span class="sxs-lookup"><span data-stu-id="1c6f6-125">Back up disks using snapshots</span></span>
<span data-ttu-id="1c6f6-126">Comme stratégie de sauvegarde pour vos disques de machine virtuelle, vous pouvez prendre des instantanés périodiques du disque ou de l’objet blob de pages, et les copier dans un autre compte de stockage à l’aide d’outils tels que l’opération [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) ou [AzCopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-126">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) operation or [AzCopy](storage-use-azcopy.md).</span></span> <span data-ttu-id="1c6f6-127">Vous pouvez copier un instantané sur un objet blob de pages de destination avec un nom différent.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-127">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="1c6f6-128">L’objet blob de pages de destination qui en découle est modifiable et n’est pas un instantané.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-128">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="1c6f6-129">Plus loin dans cet article, nous allons décrire les étapes permettant d’effectuer des sauvegardes de disques de machine virtuelle à l’aide d’instantanés.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-129">Later in this article we will describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="1c6f6-130">Restaurer des disques à l’aide d’instantanés</span><span class="sxs-lookup"><span data-stu-id="1c6f6-130">Restore disks using snapshots</span></span>
<span data-ttu-id="1c6f6-131">Pour restaurer votre disque vers une version stable précédente capturée dans l’un des instantanés de sauvegarde, vous pouvez copier un instantané sur l’objet blob de pages de base.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-131">When it is time to restore your disk to a previous stable version captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="1c6f6-132">Une fois que l’instantané est copié sur l’objet blob de pages de base, il reste, mais sa source est remplacée par une copie qui peut être lue et modifiée.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-132">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="1c6f6-133">Plus loin dans cet article, nous allons décrire les étapes permettant de restaurer une version précédente de votre disque à partir de son instantané.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-133">Later in this article we will describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="1c6f6-134">Implémentation de la copie d’un instantané complet</span><span class="sxs-lookup"><span data-stu-id="1c6f6-134">Implementing full snapshot copy</span></span>
<span data-ttu-id="1c6f6-135">Vous pouvez implémenter la copie d’un instantané complet de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="1c6f6-135">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="1c6f6-136">Tout d’abord, prenez un instantané de l’objet blob de base à l’aide de l’opération [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) .</span><span class="sxs-lookup"><span data-stu-id="1c6f6-136">First, take a snapshot of the base blob using the [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) operation.</span></span>
* <span data-ttu-id="1c6f6-137">Ensuite, copiez l’instantané vers un compte de stockage cible à l’aide de [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-137">Then, copy the snapshot to a target storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span>
* <span data-ttu-id="1c6f6-138">Répétez cette procédure pour mettre à jour les copies de sauvegarde de votre objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-138">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="1c6f6-139">Copie d’un instantané incrémentiel</span><span class="sxs-lookup"><span data-stu-id="1c6f6-139">Incremental snapshot copy</span></span>
<span data-ttu-id="1c6f6-140">La nouvelle fonctionnalité dans [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) est une bien meilleure méthode pour sauvegarder les instantanés de vos objets blob de pages ou vos disques.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-140">The new feature in [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="1c6f6-141">Cette API renvoie la liste des modifications entre l’objet blob de base et les instantanés.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-141">The API returns the list of changes between the base blob and the snapshots.</span></span> <span data-ttu-id="1c6f6-142">Cela réduit la quantité d’espace de stockage utilisé sur le compte de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-142">This reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="1c6f6-143">L’API prend en charge les objets blob de pages sur le Stockage Premium et le Stockage Standard.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-143">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="1c6f6-144">À l’aide de cette API, vous pouvez créer des solutions de sauvegarde plus rapides et efficaces pour les machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-144">Using this API, you can now build faster and efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="1c6f6-145">Cette méthode est disponible à partir de la version REST 2015-07-08.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-145">This will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="1c6f6-146">La copie d’instantané incrémentiel vous permet de copier d’un compte de stockage à un autre la différence entre</span><span class="sxs-lookup"><span data-stu-id="1c6f6-146">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="1c6f6-147">l’objet blob de base et son instantané OU</span><span class="sxs-lookup"><span data-stu-id="1c6f6-147">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="1c6f6-148">les deux instantanés de l’objet blob de base</span><span class="sxs-lookup"><span data-stu-id="1c6f6-148">Any two snapshots of the base blob</span></span>

<span data-ttu-id="1c6f6-149">Si les conditions suivantes sont respectées,</span><span class="sxs-lookup"><span data-stu-id="1c6f6-149">Provided the following conditions are met,</span></span>

* <span data-ttu-id="1c6f6-150">L’objet blob a été créé le 1er janvier 2016 ou ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-150">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="1c6f6-151">L’objet blob n’a pas été remplacé avec [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) ou [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) entre deux instantanés.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-151">The blob was not overwritten with [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) or [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx) between two snapshots.</span></span>

<span data-ttu-id="1c6f6-152">**Remarque**: cette fonctionnalité est disponible pour les objets blob de pages Azure Standard et Premium.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-152">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="1c6f6-153">Quand votre stratégie de sauvegarde personnalisée utilise des instantanés, la copie des instantanés d’un compte de stockage à un autre peut être très lente et consommer beaucoup d’espace de stockage.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-153">When you have a custom backup strategy that uses snapshots, copying the snapshots from one storage account to another can be very slow and consumes a lot of storage space.</span></span> <span data-ttu-id="1c6f6-154">Au lieu de copier l’instantané en entier sur un compte de stockage de sauvegarde, vous pouvez écrire la différence entre des instantanés consécutifs dans un objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-154">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="1c6f6-155">De cette façon, le temps de copie et l’espace de stockage des sauvegardes sont sensiblement réduits.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-155">This way, the time to copy and space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="1c6f6-156">Implémentation de la copie d’un instantané incrémentiel</span><span class="sxs-lookup"><span data-stu-id="1c6f6-156">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="1c6f6-157">Vous pouvez implémenter la copie d’un instantané incrémentiel de la manière suivante :</span><span class="sxs-lookup"><span data-stu-id="1c6f6-157">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="1c6f6-158">Prenez un instantané de l’objet blob de base à l’aide de [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-158">Take a snapshot of the base blob using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx).</span></span>
* <span data-ttu-id="1c6f6-159">Copiez l’instantané vers le compte de stockage de sauvegarde cible à l’aide de [Copie d’un objet blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-159">Copy the snapshot to the target backup storage account using [Copy Blob](https://msdn.microsoft.com/library/azure/dd894037.aspx).</span></span> <span data-ttu-id="1c6f6-160">Il s’agit de l’objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-160">This will be the backup page blob.</span></span> <span data-ttu-id="1c6f6-161">Prenez un instantané de cet objet blob de pages de sauvegarde et stockez-le dans un compte de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-161">Take a snapshot of this backup page blob and store in backup account.</span></span>
* <span data-ttu-id="1c6f6-162">Prenez un autre instantané de l’objet blob de base à l’aide de Snapshot Blob.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-162">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="1c6f6-163">Faites la différence entre le premier et le deuxième instantanés de l’objet blob de base à l’aide de [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-163">Get the difference between first and second snapshots of base blob using  [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx).</span></span> <span data-ttu-id="1c6f6-164">Utilisez le nouveau paramètre **prevsnapshot** pour spécifier la valeur DateTime de l’instantané à comparer.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-164">Use the new parameter **prevsnapshot** to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="1c6f6-165">Quand ce paramètre est présent, la réponse REST inclut uniquement les pages qui ont été modifiées entre l’instantané cible et l’instantané précédent, y compris les pages effacées.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-165">When this parameter is present, the REST response will include only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="1c6f6-166">Utilisez [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) pour appliquer ces modifications à l’objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-166">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="1c6f6-167">Enfin, prenez un instantané de l’objet blob de pages de sauvegarde et stockez-le dans le compte de stockage de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-167">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="1c6f6-168">Dans la section suivante, nous allons décrire plus en détail comment conserver des sauvegardes de disques à l’aide de la copie d’instantané incrémentiel</span><span class="sxs-lookup"><span data-stu-id="1c6f6-168">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="1c6f6-169">Scénario</span><span class="sxs-lookup"><span data-stu-id="1c6f6-169">Scenario</span></span>
<span data-ttu-id="1c6f6-170">Dans cette section, nous allons décrire un scénario qui implique une stratégie de sauvegarde personnalisée pour les disques de machine virtuelle à l’aide d’instantanés.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-170">In this section we will describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="1c6f6-171">Prenez une machine virtuelle Azure de série DS avec un disque P30 de stockage Premium attaché.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-171">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="1c6f6-172">Le disque P30 appelé *mypremiumdisk* est stocké dans un compte de stockage Premium appelé *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-172">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="1c6f6-173">Un compte de stockage Standard appelé *mybackupstdaccount* est utilisé pour stocker la sauvegarde de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-173">A standard storage account called *mybackupstdaccount* will be used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="1c6f6-174">Nous voulons conserver un instantané de *mypremiumdisk* toutes les 12 heures.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-174">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="1c6f6-175">Pour en savoir plus sur la création d’un compte de stockage et de disques, consultez [À propos des comptes de stockage Azure](storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-175">To learn about creating storage account and disks, refer to [About Azure storage accounts](storage-create-storage-account.md).</span></span>

<span data-ttu-id="1c6f6-176">Pour en savoir plus sur la sauvegarde de machines virtuelles Azure, reportez-vous à [Planifier les sauvegardes de machine virtuelle Azure](../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="1c6f6-176">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="1c6f6-177">Étapes pour gérer les sauvegardes d’un disque à l’aide d’instantanés incrémentiels</span><span class="sxs-lookup"><span data-stu-id="1c6f6-177">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="1c6f6-178">Les étapes décrites ci-dessous prennent des instantanés de *mypremiumdisk* et conservent les sauvegardes dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-178">The steps described below will take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="1c6f6-179">La sauvegarde est un objet blob de pages standard appelé *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-179">The backup will be a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="1c6f6-180">L’objet blob de pages de sauvegarde reflète toujours l’état du dernier instantané de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-180">The backup page blob will always reflect the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="1c6f6-181">Commencez par créer l’objet blob de pages de sauvegarde pour votre disque de stockage Premium.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-181">First, create the backup page blob for your premium storage disk.</span></span> <span data-ttu-id="1c6f6-182">Pour ce faire, prenez un instantané de *mypremiumdisk* nommé *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-182">To do this, take a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="1c6f6-183">Copiez cet instantané vers mybackupstdaccount en tant qu’objet blob de pages nommé *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-183">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="1c6f6-184">Prenez un instantané de *mybackupstdpageblob* nommé *mybackupstdpageblob_ss1*, à l’aide de [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx), et stockez-le dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-184">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://msdn.microsoft.com/library/azure/ee691971.aspx) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="1c6f6-185">Pendant la fenêtre de sauvegarde, créez un autre instantané de *mypremiumdisk*, appelez-le *mypremiumdisk_ss2* et stockez-le dans *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-185">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="1c6f6-186">Identifiez les modifications incrémentielles entre les deux instantanés *mypremiumdisk_ss2* et *mypremiumdisk_ss1*, en utilisant [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) sur *mypremiumdisk_ss2* avec le paramètre **prevsnapshot** défini sur l’horodatage de *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-186">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://msdn.microsoft.com/library/azure/ee691973.aspx) on *mypremiumdisk_ss2* with **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="1c6f6-187">Écrivez ces modifications incrémentielles dans l’objet blob de pages de sauvegarde *mybackupstdpageblob* dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-187">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="1c6f6-188">Si des modifications incrémentielles consistent en la suppression de plages, elles doivent être effacées de l’objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-188">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="1c6f6-189">Utilisez [Put Page](https://msdn.microsoft.com/library/azure/ee691975.aspx) pour écrire des modifications incrémentielles dans l’objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-189">Use [PutPage](https://msdn.microsoft.com/library/azure/ee691975.aspx) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="1c6f6-190">Prenez un instantané de l’objet blob de pages de sauvegarde *mybackupstdpageblob*, appelé *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-190">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="1c6f6-191">Supprimez l’instantané précédent *mypremiumdisk_ss1* du compte de stockage Premium.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-191">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="1c6f6-192">Répétez les étapes 4 à 6 pour chaque fenêtre de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-192">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="1c6f6-193">De cette façon, vous pouvez gérer les sauvegardes de *mypremiumdisk* dans un compte de stockage Standard.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-193">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Sauvegarder un disque à l’aide d’instantanés incrémentiels](./media/storage-incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="1c6f6-195">Procédure de restauration d’un disque à partir d’instantanés</span><span class="sxs-lookup"><span data-stu-id="1c6f6-195">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="1c6f6-196">La procédure décrite ci-dessous permet de restaurer le disque Premium *mypremiumdisk* vers un instantané antérieur à partir du compte de stockage de sauvegarde *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-196">The steps described below will restore premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="1c6f6-197">Identifiez le point dans le temps auquel restaurer le disque Premium.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-197">Identify the point in time you wish to restore the premium disk to.</span></span> <span data-ttu-id="1c6f6-198">Supposons qu’il s’agit de l’instantané *mybackupstdpageblob_ss2*, qui est stocké dans le compte de stockage de sauvegarde *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-198">Let's say that is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="1c6f6-199">Dans mybackupstdaccount, déclarez l’instantané *mybackupstdpageblob_ss2* comme nouvel objet blob de pages de base de sauvegarde *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-199">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="1c6f6-200">Prenez un instantané de cet objet blob de pages de sauvegarde restauré appelé *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-200">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="1c6f6-201">Copiez l’objet blob restauré *mybackupstdpageblobrestored* de *mybackupstdaccount* vers *mypremiumaccount* en tant que nouveau disque Premium *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-201">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="1c6f6-202">Prenez un instantané de *mypremiumdiskrestored*, appelé *mypremiumdiskrestored_ss1* pour les futures sauvegardes incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-202">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="1c6f6-203">Pointez la machine virtuelle de série DS sur le disque restauré *mypremiumdiskrestored* et détachez l’ancien *mypremiumdisk* de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-203">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="1c6f6-204">Lancez le processus de sauvegarde décrit dans la section précédente pour le disque restauré *mypremiumdiskrestored*, à l’aide de *mybackupstdpageblobrestored* en tant qu’objet blob de pages de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-204">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Restaurer un disque à partir d’instantanés](./media/storage-incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="1c6f6-206">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1c6f6-206">Next Steps</span></span>
<span data-ttu-id="1c6f6-207">Apprenez-en plus sur la création d’instantanés d’un objet blob et la planification de votre infrastructure de sauvegarde de machine virtuelle à l’aide des liens ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="1c6f6-207">Learn more about creating snapshots of a blob and planning your VM backup infrastructure using the links below.</span></span>

* [<span data-ttu-id="1c6f6-208">Création d’un instantané d’objet blob</span><span class="sxs-lookup"><span data-stu-id="1c6f6-208">Creating a Snapshot of a Blob</span></span>](https://msdn.microsoft.com/library/azure/hh488361.aspx)
* [<span data-ttu-id="1c6f6-209">Planification de votre infrastructure de sauvegarde de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="1c6f6-209">Plan your VM Backup Infrastructure</span></span>](../backup/backup-azure-vms-introduction.md)

