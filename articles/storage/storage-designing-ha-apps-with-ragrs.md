---
title: "Conception d’applications hautement disponibles à l’aide du stockage géoredondant avec accès en lecture (RA-GRS) Azure | Microsoft Docs"
description: "Comment utiliser le stockage RA-GRS Azure pour concevoir une application hautement disponible suffisamment flexible pour gérer les interruptions."
services: storage
documentationcenter: .net
author: robinsh
manager: timlt
editor: tysonn
ms.assetid: 8f040b0f-8926-4831-ac07-79f646f31926
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 1/19/2017
ms.author: robinsh
ms.openlocfilehash: adc7e23d8c9f869f2951490020e3d0f1a2b2e81c
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="designing-highly-available-applications-using-ra-grs"></a><span data-ttu-id="792bf-103">Conception d’applications hautement disponibles à l’aide du stockage RA-GRS</span><span class="sxs-lookup"><span data-stu-id="792bf-103">Designing Highly Available Applications using RA-GRS</span></span>

<span data-ttu-id="792bf-104">La fourniture d’une plateforme hautement disponible pour l’hébergement des applications est une caractéristique courante des infrastructures basées sur le cloud.</span><span class="sxs-lookup"><span data-stu-id="792bf-104">A common feature of cloud-based infrastructures is that they provide a highly available platform for hosting applications.</span></span> <span data-ttu-id="792bf-105">Les développeurs d’applications cloud doivent bien réfléchir à la façon de tirer parti de cette plateforme pour proposer des applications hautement disponibles à leurs utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="792bf-105">Developers of cloud-based applications must consider carefully how to leverage this platform to deliver highly available applications to their users.</span></span> <span data-ttu-id="792bf-106">Cet article porte spécifiquement sur la façon dont les développeurs peuvent utiliser le stockage géoredondant avec accès en lecture (RA-GRS) Azure pour améliorer la disponibilité de leurs applications.</span><span class="sxs-lookup"><span data-stu-id="792bf-106">This article focuses specifically on how developers can use the Azure Storage Read Access Geo Redundant Storage (RA-GRS) to make their applications more available.</span></span>

<span data-ttu-id="792bf-107">Quatre options de redondance sont disponibles : le stockage localement redondant (LRS), le stockage redondant dans une zone (ZRS), le stockage géoredondant (GRS) et le stockage géoredondant avec accès en lecture (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="792bf-107">There are four choices for redundancy – LRS (Locally Redundant Storage), ZRS (Zone Redundant Storage), GRS (Geo-Redundant Storage), and RA-GRS (Read Access Geo-Redundant Storage).</span></span> <span data-ttu-id="792bf-108">Dans cet article, nous aborderons les stockages GRS et RA-GRS.</span><span class="sxs-lookup"><span data-stu-id="792bf-108">We are going to discuss GRS and RA-GRS in this article.</span></span> <span data-ttu-id="792bf-109">Avec le stockage GRS, trois copies de vos données sont conservées dans la région primaire que vous avez sélectionnée lors de la configuration du compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="792bf-109">With GRS, three copies of your data are kept in the primary region you selected when setting up the storage account.</span></span> <span data-ttu-id="792bf-110">Trois copies supplémentaires sont conservées de façon asynchrone dans une région secondaire spécifiée par Azure.</span><span class="sxs-lookup"><span data-stu-id="792bf-110">Three additional copies are maintained asynchronously in a secondary region specified by Azure.</span></span> <span data-ttu-id="792bf-111">Le stockage RA-GRS est identique au stockage GRS. Cependant, il offre un accès en lecture à la copie secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-111">RA-GRS is the same thing as GRS except that you have read access to the secondary copy.</span></span> <span data-ttu-id="792bf-112">Pour plus d’informations sur les différentes options de redondance relatives au stockage Azure, consultez [Réplication du stockage Azure](https://docs.microsoft.com/en-us/azure/storage/storage-redundancy).</span><span class="sxs-lookup"><span data-stu-id="792bf-112">For more information about the different Azure Storage redundancy options, see [Azure Storage replication](https://docs.microsoft.com/en-us/azure/storage/storage-redundancy).</span></span> <span data-ttu-id="792bf-113">L’article sur la réplication indique également les paires de régions primaires et secondaires.</span><span class="sxs-lookup"><span data-stu-id="792bf-113">The replication article also shows the pairings of the primary and secondary regions.</span></span>

<span data-ttu-id="792bf-114">Vous y trouverez aussi des extraits de code et, à la fin, un lien vers un exemple complet que vous pouvez télécharger et exécuter.</span><span class="sxs-lookup"><span data-stu-id="792bf-114">There are code snippets included in this article, and a link to a complete sample at the end that you can download and run.</span></span>

## <a name="key-features-of-ra-grs"></a><span data-ttu-id="792bf-115">Fonctionnalités clés du stockage RA-GRS</span><span class="sxs-lookup"><span data-stu-id="792bf-115">Key features of RA-GRS</span></span>

<span data-ttu-id="792bf-116">Avant d’aborder l’utilisation du stockage RA-GRS, nous allons parler de ses propriétés et de son comportement.</span><span class="sxs-lookup"><span data-stu-id="792bf-116">Before we talk about how to use RA-GRS storage, let's talk about its properties and behavior.</span></span>

* <span data-ttu-id="792bf-117">Le stockage Azure conserve, dans une région secondaire, une copie en lecture seule des données que vous stockez dans votre région primaire. Comme indiqué ci-dessus, le service de stockage détermine l’emplacement de la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-117">Azure Storage maintains a read-only copy of the data you store in your primary region in a secondary region; as noted above, the storage service determines the location of the secondary region.</span></span>

* <span data-ttu-id="792bf-118">La copie en lecture seule est [cohérente](https://en.wikipedia.org/wiki/Eventual_consistency) avec les données de la région primaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-118">The read-only copy is [eventually consistent](https://en.wikipedia.org/wiki/Eventual_consistency) with the data in the primary region.</span></span>

* <span data-ttu-id="792bf-119">Pour les blobs, tables et files d’attente, vous pouvez interroger la région secondaire pour obtenir la *dernière heure de synchronisation*. Cette valeur vous indique à quel moment la dernière réplication de la région primaire sur la région secondaire s’est produite.</span><span class="sxs-lookup"><span data-stu-id="792bf-119">For blobs, tables, and queues, you can query the secondary region for a *Last Sync Time* value that tells you when the last replication from the primary to the secondary region occurred.</span></span> <span data-ttu-id="792bf-120">(Cette fonctionnalité n’est pas prise en charge pour le stockage de fichiers Azure, qui n’a pas la redondance RA-GRS pour l’instant.)</span><span class="sxs-lookup"><span data-stu-id="792bf-120">(This is not supported for Azure File storage, which doesn't have RA-GRS redundancy at this time.)</span></span>

* <span data-ttu-id="792bf-121">Vous pouvez utiliser la bibliothèque cliente de stockage pour interagir avec les données de la région primaire ou secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-121">You can use the Storage Client Library to interact with the data in either the primary or secondary region.</span></span> <span data-ttu-id="792bf-122">Vous pouvez également rediriger les demandes de lecture automatiquement vers la région secondaire si une demande de lecture adressée à la région primaire arrive à expiration.</span><span class="sxs-lookup"><span data-stu-id="792bf-122">You can also redirect read requests automatically to the secondary region if a read request to the primary region times out.</span></span>

* <span data-ttu-id="792bf-123">Si un problème majeur affecte l’accessibilité des données dans la région primaire, l’équipe Azure peut déclencher un basculement géographique, à partir duquel les entrées DNS pointant vers la région primaire seront modifiées afin de pointer vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-123">If there is a major issue affecting the accessibility of the data in the primary region, the Azure team may trigger a geo-failover, at which point the DNS entries pointing to the primary region will be changed to point to the secondary region.</span></span>

* <span data-ttu-id="792bf-124">En cas de basculement géographique, Azure sélectionne un nouvel emplacement secondaire, réplique les données à cet emplacement, puis fait pointer les entrées DNS secondaires vers celui-ci.</span><span class="sxs-lookup"><span data-stu-id="792bf-124">If a geo-failover occurs, Azure will select a new secondary location and replicate the data to that location, then point the secondary DNS entries to it.</span></span> <span data-ttu-id="792bf-125">Le point de terminaison secondaire est indisponible jusqu’à ce que le compte de stockage ait terminé la réplication.</span><span class="sxs-lookup"><span data-stu-id="792bf-125">The secondary endpoint will be unavailable until the storage account has finished replicating.</span></span> <span data-ttu-id="792bf-126">Pour plus d’informations, consultez [Que faire en cas de panne du stockage Azure](https://docs.microsoft.com/en-us/azure/storage/storage-disaster-recovery-guidance).</span><span class="sxs-lookup"><span data-stu-id="792bf-126">For more information, please see [What to do if an Azure Storage outage occurs](https://docs.microsoft.com/en-us/azure/storage/storage-disaster-recovery-guidance).</span></span>

## <a name="application-design-considerations-when-using-ra-grs"></a><span data-ttu-id="792bf-127">Considérations relatives à la conception d’applications avec le stockage RA-GRS</span><span class="sxs-lookup"><span data-stu-id="792bf-127">Application design considerations when using RA-GRS</span></span>

<span data-ttu-id="792bf-128">L’objectif principal de cet article est de vous montrer comment concevoir une application qui continuera à fonctionner (bien qu’avec des capacités limitées), même si un sinistre majeur affecte le centre de données principal.</span><span class="sxs-lookup"><span data-stu-id="792bf-128">The main purpose of this article is to show you how to design an application that will continue to function (albeit in a limited capacity) even in the event of a major disaster at the primary data center.</span></span> <span data-ttu-id="792bf-129">Pour cela, votre application doit gérer les problèmes temporaires ou de longue durée en faisant basculer la lecture sur la région secondaire tant que le problème existe et en effectuant un nouveau basculement vers la région primaire lorsque celle-ci est de nouveau disponible.</span><span class="sxs-lookup"><span data-stu-id="792bf-129">You do this by having your application to handle transient or long-running issues by switching to read from the secondary region while there is a problem, and switching back when the primary region is available again.</span></span>

### <a name="using-eventually-consistent-data"></a><span data-ttu-id="792bf-130">Utilisation de données cohérentes</span><span class="sxs-lookup"><span data-stu-id="792bf-130">Using eventually consistent data</span></span>

<span data-ttu-id="792bf-131">Cette solution part du principe qu’il est acceptable de retourner des données qui pourraient être périmées à l’application appelante.</span><span class="sxs-lookup"><span data-stu-id="792bf-131">This proposed solution assumes that it is okay to return what could be stale data to the calling application.</span></span> <span data-ttu-id="792bf-132">Dans la mesure où les données secondaires sont cohérentes, il est possible que les données aient été écrites dans la région primaire, mais que la réplication effectuée lors de la mise à jour de la région secondaire n’ait pas été achevée lorsque la région primaire est devenue inaccessible.</span><span class="sxs-lookup"><span data-stu-id="792bf-132">Because the secondary data is eventually consistent, it is possible that the data was written to the primary but the update to the secondary had not finished replicating when the primary region became inaccessible.</span></span>

<span data-ttu-id="792bf-133">Par exemple, votre client pourrait envoyer une mise à jour qui réussit et la région primaire pourrait tomber en panne avant la propagation de la mise à jour sur la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-133">For example, your customer could submit an update that is successful, and then the primary could go down before the update is propagated to the secondary.</span></span> <span data-ttu-id="792bf-134">Dans ce cas, si le client demande à lire de nouveau les données, il reçoit les données périmées au lieu des données mises à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-134">In this case, if the customer then asks to read the data back, he receives the stale data instead of the updated data.</span></span> <span data-ttu-id="792bf-135">Vous devez décider si cela est acceptable et, si tel est le cas, la façon dont vous enverrez un message au client.</span><span class="sxs-lookup"><span data-stu-id="792bf-135">You must decide if this is acceptable, and if so, how you will message the customer.</span></span> <span data-ttu-id="792bf-136">Plus loin dans cet article, vous verrez comment vérifier la dernière heure de synchronisation des données secondaires pour savoir si la région secondaire est à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-136">You'll see how to check the Last Sync Time on the secondary data later in this article to see if the secondary is up-to-date.</span></span>

### <a name="handling-services-separately-or-all-together"></a><span data-ttu-id="792bf-137">Gestion des services ensemble ou séparément</span><span class="sxs-lookup"><span data-stu-id="792bf-137">Handling services separately or all together</span></span>

<span data-ttu-id="792bf-138">Même si cette situation est peu probable, il est possible qu’un service devienne indisponible, alors que tous les autres restent entièrement fonctionnels.</span><span class="sxs-lookup"><span data-stu-id="792bf-138">While not likely, it is possible for one service to become unavailable while the other services are still fully functional.</span></span> <span data-ttu-id="792bf-139">Vous pouvez gérer les nouvelles tentatives et le mode lecture seule pour chaque service séparément (blobs, files d’attente, tables) ou gérer les nouvelles tentatives de façon générique pour l’ensemble des services de stockage.</span><span class="sxs-lookup"><span data-stu-id="792bf-139">You can handle the retries and read-only mode for each service separately (blobs, queues, tables), or you can handle retries generically for all the storage services together.</span></span>

<span data-ttu-id="792bf-140">Par exemple, si vous utilisez des files d’attente et des blobs dans votre application, vous pouvez décider d’insérer un code distinct pour gérer les erreurs renouvelables pour chacun d’eux.</span><span class="sxs-lookup"><span data-stu-id="792bf-140">For example, if you use queues and blobs in your application, you may decide to put in separate code to handle retryable errors for each of these.</span></span> <span data-ttu-id="792bf-141">Par la suite, si vous recevez une nouvelle tentative du service BLOB mais que le service de File d’attente est toujours fonctionnel, seule la partie de votre application qui gère les blobs sera affectée.</span><span class="sxs-lookup"><span data-stu-id="792bf-141">Then if you get a retry from the blob service, but the queue service is still working, only the part of your application that handles blobs will be impacted.</span></span> <span data-ttu-id="792bf-142">Si vous décidez de gérer toutes les nouvelles tentatives de service de stockage de manière générique et qu’un appel au service BLOB retourne une erreur renouvelable, les demandes au service BLOB et au service de File d’attente seront affectées.</span><span class="sxs-lookup"><span data-stu-id="792bf-142">If you decide to handle all storage service retries generically and a call to the blob service returns a retryable error, then requests to both the blob service and the queue service will be impacted.</span></span>

<span data-ttu-id="792bf-143">Cela dépend de la complexité de votre application.</span><span class="sxs-lookup"><span data-stu-id="792bf-143">Ultimately, this depends on the complexity of your application.</span></span> <span data-ttu-id="792bf-144">Vous pouvez décider de ne pas gérer les échecs par service, mais plutôt de rediriger les demandes de lecture pour tous les services de stockage vers la région secondaire et d’exécuter l’application en mode lecture seule lorsque vous détectez un problème affectant tout service de stockage dans la région primaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-144">You may decide not to handle the failures by service, but instead to redirect read requests for all storage services to the secondary region and run the application in read-only mode when you detect a problem with any storage service in the primary region.</span></span>

### <a name="other-considerations"></a><span data-ttu-id="792bf-145">Autres considérations</span><span class="sxs-lookup"><span data-stu-id="792bf-145">Other considerations</span></span>

<span data-ttu-id="792bf-146">Voici les autres considérations dont nous parlerons dans le reste de cet article.</span><span class="sxs-lookup"><span data-stu-id="792bf-146">These are the other considerations we will discuss in the rest of this article.</span></span>

*   <span data-ttu-id="792bf-147">Gestion des nouvelles tentatives de demandes de lecture à l’aide du modèle Disjoncteur</span><span class="sxs-lookup"><span data-stu-id="792bf-147">Handling retries of read requests using the Circuit Breaker pattern</span></span>

*   <span data-ttu-id="792bf-148">Données cohérentes et dernière heure de synchronisation</span><span class="sxs-lookup"><span data-stu-id="792bf-148">Eventually-consistent data and the Last Sync Time</span></span>

*   <span data-ttu-id="792bf-149">Test</span><span class="sxs-lookup"><span data-stu-id="792bf-149">Testing</span></span>

## <a name="running-your-application-in-read-only-mode"></a><span data-ttu-id="792bf-150">Exécution de votre application en mode lecture seule</span><span class="sxs-lookup"><span data-stu-id="792bf-150">Running your application in read-only mode</span></span>

<span data-ttu-id="792bf-151">Pour utiliser le stockage RA-GRS, vous devez être en mesure de gérer les demandes de lecture et de mise à jour (dans le cas présent, les insertions, mises à jour et suppressions) ayant échoué.</span><span class="sxs-lookup"><span data-stu-id="792bf-151">To use RA-GRS storage, you must be able to handle both failed read requests and failed update requests (with update in this case meaning inserts, updates, and deletions).</span></span> <span data-ttu-id="792bf-152">En cas d’échec du centre de données principal, les demandes de lecture peuvent être redirigées vers le centre de données secondaire, mais pas les demandes de mise à jour, car le centre de données secondaire est en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-152">If the primary data center fails, read requests can be redirected to the secondary data center, but update requests cannot because the secondary is read only.</span></span> <span data-ttu-id="792bf-153">C’est la raison pour laquelle vous avez besoin d’un moyen d’exécuter votre application en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-153">For this reason, you need some way to run your application in read-only mode.</span></span>

<span data-ttu-id="792bf-154">Par exemple, vous pouvez définir un indicateur qui sera vérifié avant l’envoi de toute demande de mise à jour au service de stockage.</span><span class="sxs-lookup"><span data-stu-id="792bf-154">For example, you can set a flag that will be checked before submitting any update requests to the storage service.</span></span> <span data-ttu-id="792bf-155">Lorsque l’une des demandes de mise à jour aboutit, vous pouvez l’ignorer et retourner une réponse appropriée au client.</span><span class="sxs-lookup"><span data-stu-id="792bf-155">When one of the update requests comes through, you can skip it and return an appropriate response to the customer.</span></span> <span data-ttu-id="792bf-156">Vous pouvez même décider de désactiver certaines fonctionnalités simultanément, et ce, jusqu’à ce que le problème soit résolu, et informer les utilisateurs que ces fonctionnalités sont temporairement indisponibles.</span><span class="sxs-lookup"><span data-stu-id="792bf-156">You may even want to disable certain features altogether until the problem is resolved and notify users that those features are temporarily unavailable.</span></span>

<span data-ttu-id="792bf-157">Si vous décidez de gérer les erreurs pour chaque service séparément, vous devez également gérer la possibilité d’exécuter votre application en mode lecture seule par service.</span><span class="sxs-lookup"><span data-stu-id="792bf-157">If you decide to handle errors for each service separately, you will also need to handle the ability to run your application in read-only mode by service.</span></span> <span data-ttu-id="792bf-158">Vous pouvez avoir des indicateurs en lecture seule pour chaque service, qui peuvent être activés et désactivés, et gérer l’indicateur approprié aux emplacements adaptés, dans votre code.</span><span class="sxs-lookup"><span data-stu-id="792bf-158">You could have read-only flags for each service that can be enabled and disabled and handle the appropriate flag in the appropriate places in your code.</span></span>

<span data-ttu-id="792bf-159">La possibilité d’exécuter votre application en mode lecture seule offre un autre avantage : vous avez la possibilité d’assurer des fonctionnalités limitées pendant une mise à niveau majeure de l’application.</span><span class="sxs-lookup"><span data-stu-id="792bf-159">Being able to run your application in read-only mode has another side benefit – it gives you the ability to ensure limited functionality during a major application upgrade.</span></span> <span data-ttu-id="792bf-160">Vous pouvez déclencher l’exécution de votre application en mode lecture seule et la faire pointer vers le centre de données secondaire. Vous avez ainsi la certitude que personne n’accède aux données dans la région primaire pendant vous effectuez des mises à niveau.</span><span class="sxs-lookup"><span data-stu-id="792bf-160">You can trigger your application to run in read-only mode and point to the secondary data center, ensuring nobody is accessing the data in the primary region while you're making upgrades.</span></span>

## <a name="handling-updates-when-running-in-read-only-mode"></a><span data-ttu-id="792bf-161">Gestion des mises à jour lors d’une exécution en mode lecture seule</span><span class="sxs-lookup"><span data-stu-id="792bf-161">Handling updates when running in read-only mode</span></span>

<span data-ttu-id="792bf-162">Il existe de nombreuses façons de gérer les demandes de mise à jour lors d’une exécution en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-162">There are many ways to handle update requests when running in read-only mode.</span></span> <span data-ttu-id="792bf-163">Nous n’abordons pas ce point de façon complète, mais vous pouvez généralement prendre quelques modèles en considération.</span><span class="sxs-lookup"><span data-stu-id="792bf-163">We won't cover this comprehensively, but generally, there are a couple of patterns that you consider.</span></span>

1.  <span data-ttu-id="792bf-164">Vous pouvez répondre à votre utilisateur et lui indiquer que les mises à jour ne sont actuellement pas autorisées.</span><span class="sxs-lookup"><span data-stu-id="792bf-164">You can respond to your user and tell them you are not currently accepting updates.</span></span> <span data-ttu-id="792bf-165">Par exemple, un système de gestion des contacts pourrait permettre aux clients d’accéder aux informations de contact sans toutefois autoriser les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-165">For example, a contact management system could enable customers to access contact information but not make updates.</span></span>

2.  <span data-ttu-id="792bf-166">Vous pouvez empiler vos mises à jour dans une autre région.</span><span class="sxs-lookup"><span data-stu-id="792bf-166">You can enqueue your updates in another region.</span></span> <span data-ttu-id="792bf-167">Dans ce cas, vous écrirez vos demandes de mise à jour en attente dans la file d’attente d’une autre région et disposerez d’un moyen de traiter ces demandes une fois le centre de données principal à nouveau en ligne.</span><span class="sxs-lookup"><span data-stu-id="792bf-167">In this case, you would write your pending update requests to a queue in a different region, and then have a way to process those requests after the primary data center comes online again.</span></span> <span data-ttu-id="792bf-168">Dans ce scénario, vous devez informer le client que la mise à jour demandée a été mise en file d’attente pour un traitement ultérieur.</span><span class="sxs-lookup"><span data-stu-id="792bf-168">In this scenario, you should let the customer know that the update requested is queued for later processing.</span></span>

3.  <span data-ttu-id="792bf-169">Vous pouvez écrire vos mises à jour dans un compte de stockage d’une autre région.</span><span class="sxs-lookup"><span data-stu-id="792bf-169">You can write your updates to a storage account in another region.</span></span> <span data-ttu-id="792bf-170">Puis, lorsque le centre de données principal est de nouveau en ligne, vous disposez d’un moyen de fusionner ces mises à jour dans les données primaires, selon la structure des données.</span><span class="sxs-lookup"><span data-stu-id="792bf-170">Then when the primary data center comes back online, you can have a way to merge those updates into the primary data, depending on the structure of the data.</span></span> <span data-ttu-id="792bf-171">Par exemple, si vous créez des fichiers distincts, dont le nom contient l’horodatage, vous pouvez recopier ces fichiers dans la région primaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-171">For example, if you are creating separate files with a date/time stamp in the name, you can copy those files back to the primary region.</span></span> <span data-ttu-id="792bf-172">Cela fonctionne pour certaines charges de travail, notamment la journalisation et les données IoT.</span><span class="sxs-lookup"><span data-stu-id="792bf-172">This works for some workloads such as logging and iOT data.</span></span>

## <a name="handling-retries"></a><span data-ttu-id="792bf-173">Gestion des nouvelles tentatives</span><span class="sxs-lookup"><span data-stu-id="792bf-173">Handling retries</span></span>

<span data-ttu-id="792bf-174">Comment savoir quelles sont les erreurs renouvelables ?</span><span class="sxs-lookup"><span data-stu-id="792bf-174">How do you know which errors are retryable?</span></span> <span data-ttu-id="792bf-175">C’est la bibliothèque cliente de stockage qui le détermine.</span><span class="sxs-lookup"><span data-stu-id="792bf-175">This is determined by the storage client library.</span></span> <span data-ttu-id="792bf-176">Par exemple, une erreur 404 (ressource introuvable) n’est pas renouvelable, car une nouvelle tentative serait peu susceptible d’aboutir.</span><span class="sxs-lookup"><span data-stu-id="792bf-176">For example, a 404 error (resource not found) is not retryable because retrying it is not likely to result in success.</span></span> <span data-ttu-id="792bf-177">En revanche, une erreur 500 est renouvelable, car il s’agit d’une erreur de serveur. Il se peut que le problème ne soit que temporaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-177">On the other hand, a 500 error is retryable because it is a server error, and it may simply be a transient issue.</span></span> <span data-ttu-id="792bf-178">Pour plus d’informations, consultez le [code open source de la classe ExponentialRetry](https://github.com/Azure/azure-storage-net/blob/87b84b3d5ee884c7adc10e494e2c7060956515d0/Lib/Common/RetryPolicies/ExponentialRetry.cs) dans la bibliothèque cliente de stockage .NET.</span><span class="sxs-lookup"><span data-stu-id="792bf-178">For more details, check out the [open source code for the ExponentialRetry class](https://github.com/Azure/azure-storage-net/blob/87b84b3d5ee884c7adc10e494e2c7060956515d0/Lib/Common/RetryPolicies/ExponentialRetry.cs) in the .NET storage client library.</span></span> <span data-ttu-id="792bf-179">(Recherchez la méthode ShouldRetry.)</span><span class="sxs-lookup"><span data-stu-id="792bf-179">(Look for the ShouldRetry method.)</span></span>

### <a name="read-requests"></a><span data-ttu-id="792bf-180">Demandes de lecture</span><span class="sxs-lookup"><span data-stu-id="792bf-180">Read requests</span></span>

<span data-ttu-id="792bf-181">En cas de problème avec le stockage principal, les demandes de lecture peuvent être redirigées vers le stockage secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-181">Read requests can be redirected to secondary storage if there is a problem with primary storage.</span></span> <span data-ttu-id="792bf-182">Comme indiqué plus haut dans la section [Utilisation de données cohérentes](#using-eventually-consistent-data), la lecture de données périmées par votre application doit être acceptable.</span><span class="sxs-lookup"><span data-stu-id="792bf-182">As noted above in [Using Eventually Consistent Data](#using-eventually-consistent-data), it must be acceptable for your application to potentially read stale data.</span></span> <span data-ttu-id="792bf-183">Si vous utilisez la bibliothèque cliente de stockage pour accéder aux données de RA-GRS, vous pouvez spécifier le comportement de nouvelle tentative d’une demande de lecture en affectant à la propriété **LocationMode** l’une des valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="792bf-183">If you are using the storage client library to access RA-GRS data, you can specify the retry behavior of a read request by setting a value for the **LocationMode** property to one of the following:</span></span>

*   <span data-ttu-id="792bf-184">**PrimaryOnly** (valeur par défaut)</span><span class="sxs-lookup"><span data-stu-id="792bf-184">**PrimaryOnly** (the default)</span></span>

*   <span data-ttu-id="792bf-185">**PrimaryThenSecondary**</span><span class="sxs-lookup"><span data-stu-id="792bf-185">**PrimaryThenSecondary**</span></span>

*   <span data-ttu-id="792bf-186">**SecondaryOnly**</span><span class="sxs-lookup"><span data-stu-id="792bf-186">**SecondaryOnly**</span></span>

*   <span data-ttu-id="792bf-187">**SecondaryThenPrimary**</span><span class="sxs-lookup"><span data-stu-id="792bf-187">**SecondaryThenPrimary**</span></span>

<span data-ttu-id="792bf-188">Lorsque vous affectez à la propriété **LocationMode** la valeur **PrimaryThenSecondary**, si la demande de lecture initiale au point de terminaison principal échoue avec une erreur renouvelable, le client effectue automatiquement une autre demande de lecture au point de terminaison secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-188">When you set the **LocationMode** to **PrimaryThenSecondary**, if the initial read request to the primary endpoint fails with a retryable error, the client automatically makes another read request to the secondary endpoint.</span></span> <span data-ttu-id="792bf-189">Si l’erreur est liée au délai d’attente du serveur, le client devra attendre l’expiration du délai avant la réception d’une erreur renouvelable du service.</span><span class="sxs-lookup"><span data-stu-id="792bf-189">If the error is a server timeout, then the client will have to wait for the timeout to expire before it receives a retryable error from the service.</span></span>

<span data-ttu-id="792bf-190">Lorsque vous décidez de la façon de répondre à une erreur renouvelable, deux scénarios principaux doivent être envisagés :</span><span class="sxs-lookup"><span data-stu-id="792bf-190">There are basically two scenarios to consider when you are deciding how to respond to a retryable error:</span></span>

*   <span data-ttu-id="792bf-191">Il s’agit d’un problème isolé et les demandes ultérieures au point de terminaison principal ne retourneront pas d’erreur renouvelable.</span><span class="sxs-lookup"><span data-stu-id="792bf-191">This is an isolated problem and subsequent requests to the primary endpoint will not return a retryable error.</span></span> <span data-ttu-id="792bf-192">Ceci peut se produire, par exemple, en cas d’erreur réseau temporaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-192">An example of where this might happen is when there is a transient network error.</span></span>

    <span data-ttu-id="792bf-193">Dans ce scénario, l’affectation à la propriété **LocationMode** de la valeur **PrimaryThenSecondary** n’entraîne pas de perte de performances significative, dans la mesure où cela ne se produit que rarement.</span><span class="sxs-lookup"><span data-stu-id="792bf-193">In this scenario, there is no significant performance penalty in having **LocationMode** set to **PrimaryThenSecondary** as this only happens infrequently.</span></span>

*   <span data-ttu-id="792bf-194">Le problème concerne au moins un des services de stockage de la région primaire, et toutes les demandes ultérieures à l’attention de ce service dans la région primaire sont susceptibles de retourner des erreurs renouvelables sur une certaine période.</span><span class="sxs-lookup"><span data-stu-id="792bf-194">This is a problem with at least one of the storage services in the primary region and all subsequent requests to that service in the primary region are likely to return retryable errors for a period of time.</span></span> <span data-ttu-id="792bf-195">Cela peut se produire, par exemple, lorsque la région primaire est totalement inaccessible.</span><span class="sxs-lookup"><span data-stu-id="792bf-195">An example of this is if the primary region is completely inaccessible.</span></span>

    <span data-ttu-id="792bf-196">Dans ce scénario, une perte de performances est observée, dans la mesure où toutes vos demandes de lecture essaieront le point de terminaison principal en premier, attendront l’expiration du délai, puis basculeront vers le point de terminaison secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-196">In this scenario, there is a performance penalty because all your read requests will try the primary endpoint first, wait for the timeout to expire, then switch to the secondary endpoint.</span></span>

<span data-ttu-id="792bf-197">Dans le cadre de ces scénarios, vous devez savoir qu’un problème affecte actuellement le point de terminaison principal et envoyer toutes les demandes de lecture directement au point de terminaison secondaire en affectant à la propriété **LocationMode** la valeur **SecondaryOnly**.</span><span class="sxs-lookup"><span data-stu-id="792bf-197">For these scenarios, you should identify that there is an ongoing issue with the primary endpoint and send all read requests directly to the secondary endpoint by setting the **LocationMode** property to **SecondaryOnly**.</span></span> <span data-ttu-id="792bf-198">À ce stade, vous devez également définir l’exécution de l’application en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-198">At this time, you should also change the application to run in read-only mode.</span></span> <span data-ttu-id="792bf-199">Cette approche est appelée le modèle Disjoncteur. Voir [Circuit Breaker Pattern](https://msdn.microsoft.com/library/dn589784.aspx) (modèle Disjoncteur).</span><span class="sxs-lookup"><span data-stu-id="792bf-199">This approach is known as the [Circuit Breaker Pattern](https://msdn.microsoft.com/library/dn589784.aspx).</span></span>

### <a name="update-requests"></a><span data-ttu-id="792bf-200">Demandes de mise à jour</span><span class="sxs-lookup"><span data-stu-id="792bf-200">Update requests</span></span>

<span data-ttu-id="792bf-201">Le modèle Disjoncteur peut également être appliqué aux demandes de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-201">The Circuit Breaker pattern can also be applied to update requests.</span></span> <span data-ttu-id="792bf-202">Toutefois, les demandes de mise à jour ne peuvent pas être redirigées vers un stockage secondaire, qui est en lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-202">However, update requests cannot be redirected to secondary storage, which is read-only.</span></span> <span data-ttu-id="792bf-203">Pour ces demandes, vous devez laisser la propriété **LocationMode** définie sur la valeur **PrimaryOnly** (valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="792bf-203">For these requests, you should leave the **LocationMode** property set to **PrimaryOnly** (the default).</span></span> <span data-ttu-id="792bf-204">Pour gérer ces erreurs, vous pouvez appliquer une mesure à ces demandes (10 échecs consécutifs, par exemple) et faire basculer l’application en mode lecture seule lorsque le seuil est atteint.</span><span class="sxs-lookup"><span data-stu-id="792bf-204">To handle these errors, you can apply a metric to these requests – such as 10 failures in a row – and when your threshold is met, switch the application into read-only mode.</span></span> <span data-ttu-id="792bf-205">Vous pouvez utiliser les méthodes décrites ci-après, dans la section Modèle Disjoncteur, pour rétablir le mode de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-205">You can use the same methods for returning to update mode as those described below in the next section about the Circuit Breaker pattern.</span></span>

## <a name="circuit-breaker-pattern"></a><span data-ttu-id="792bf-206">Modèle Disjoncteur</span><span class="sxs-lookup"><span data-stu-id="792bf-206">Circuit Breaker pattern</span></span>

<span data-ttu-id="792bf-207">L’utilisation du modèle Disjoncteur dans votre application peut l’empêcher de réessayer une opération qui échouera probablement de nouveau.</span><span class="sxs-lookup"><span data-stu-id="792bf-207">Using the Circuit Breaker pattern in your application can prevent it from retrying an operation that is likely to fail repeatedly.</span></span> <span data-ttu-id="792bf-208">Il permet à l’application de poursuivre son exécution plutôt que de perdre du temps en multipliant les tentatives.</span><span class="sxs-lookup"><span data-stu-id="792bf-208">It allows the application to continue to run rather than taking up time while the operation is retried exponentially.</span></span> <span data-ttu-id="792bf-209">Il détecte également le moment auquel l’erreur est corrigée et auquel l’application peut essayer l’opération de nouveau.</span><span class="sxs-lookup"><span data-stu-id="792bf-209">It also detects when the fault has been fixed, at which time the application can try the operation again.</span></span>

### <a name="how-to-implement-the-circuit-breaker-pattern"></a><span data-ttu-id="792bf-210">Comment implémenter le modèle Disjoncteur</span><span class="sxs-lookup"><span data-stu-id="792bf-210">How to implement the circuit breaker pattern</span></span>

<span data-ttu-id="792bf-211">Pour savoir si un problème affecte actuellement un point de terminaison principal, vous pouvez contrôler la fréquence à laquelle le client rencontre des erreurs renouvelables.</span><span class="sxs-lookup"><span data-stu-id="792bf-211">To identify that there is an ongoing problem with a primary endpoint, you can monitor how frequently the client encounters retryable errors.</span></span> <span data-ttu-id="792bf-212">Chaque cas étant différent, vous devez décider du seuil à utiliser pour déterminer quand basculer vers le point de terminaison secondaire et exécuter l’application en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-212">Because each case is different, you have to decide on the threshold you want to use for the decision to switch to the secondary endpoint and run the application in read-only mode.</span></span> <span data-ttu-id="792bf-213">Par exemple, vous pouvez décider d’effectuer le basculement au bout de 10 échecs consécutifs.</span><span class="sxs-lookup"><span data-stu-id="792bf-213">For example, you could decide to perform the switch if there are 10 failures in a row with no successes.</span></span> <span data-ttu-id="792bf-214">Vous pouvez également effectuer le basculement si 90 % des demandes échouent sur une période de 2 minutes.</span><span class="sxs-lookup"><span data-stu-id="792bf-214">Another example is to switch if 90% of the requests in a 2-minute period fail.</span></span>

<span data-ttu-id="792bf-215">Dans le cadre du premier scénario, vous pouvez simplement tenir le compte des échecs et, en cas de réussite avant que la valeur maximale soit atteinte, remettre le compte à zéro.</span><span class="sxs-lookup"><span data-stu-id="792bf-215">For the first scenario, you can simply keep a count of the failures, and if there is a success before reaching the maximum, set the count back to zero.</span></span> <span data-ttu-id="792bf-216">Dans le cadre du deuxième scénario, vous pouvez, par exemple, utiliser l’objet MemoryCache (dans .NET).</span><span class="sxs-lookup"><span data-stu-id="792bf-216">For the second scenario, one way to implement it is to use the MemoryCache object (in .NET).</span></span> <span data-ttu-id="792bf-217">Pour chaque demande, ajoutez un CacheItem au cache, définissez la valeur sur 1 (réussite) ou 0 (échec) et définissez le délai d’expiration à 2 minutes à partir de maintenant (ou sur une autre valeur selon vos contraintes de temps).</span><span class="sxs-lookup"><span data-stu-id="792bf-217">For each request, add a CacheItem to the cache, set the value to success (1) or fail (0), and set the expiration time to 2 minutes from now (or whatever your time constraint is).</span></span> <span data-ttu-id="792bf-218">Quand le délai d’expiration d’une entrée est atteint, l’entrée est automatiquement supprimée.</span><span class="sxs-lookup"><span data-stu-id="792bf-218">When an entry's expiration time is reached, the entry is automatically removed.</span></span> <span data-ttu-id="792bf-219">Cela vous donne une fenêtre cumulative de 2 minutes.</span><span class="sxs-lookup"><span data-stu-id="792bf-219">This will give you a rolling 2-minute window.</span></span> <span data-ttu-id="792bf-220">À chaque demande effectuée au service de stockage, vous utilisez d’abord une requête LINQ sur l’objet MemoryCache pour calculer le pourcentage de réussite en additionnant les valeurs et en divisant le résultat par la valeur du compte.</span><span class="sxs-lookup"><span data-stu-id="792bf-220">Each time you make a request to the storage service, you first use a Linq query across the MemoryCache object to calculate the percent success by summing the values and dividing by the count.</span></span> <span data-ttu-id="792bf-221">Lorsque le pourcentage de réussite est inférieur à un certain seuil (par exemple, 10 %), affectez à la propriété **LocationMode** la valeur **SecondaryOnly** pour les demandes de lecture et faites basculer l’application en mode lecture seule avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="792bf-221">When the percent success drops below some threshold (such as 10%), set the **LocationMode** property for read requests to **SecondaryOnly** and switch the application into read-only mode before continuing.</span></span>

<span data-ttu-id="792bf-222">Le seuil d’erreurs, qui permet de déterminer le moment auquel effectuer le basculement, peut varier d’un service à l’autre dans votre application. Vous devez donc envisager de rendre ces paramètres configurables.</span><span class="sxs-lookup"><span data-stu-id="792bf-222">The threshold of errors used to determine when to make the switch may vary from service to service in your application, so you should consider making them configurable parameters.</span></span> <span data-ttu-id="792bf-223">C’est également le moment où vous décidez de gérer les erreurs renouvelables pour chaque service séparément ou comme un ensemble, comme indiqué précédemment.</span><span class="sxs-lookup"><span data-stu-id="792bf-223">This is also where you decide to handle retryable errors from each service separately or as one, as discussed previously.</span></span>

<span data-ttu-id="792bf-224">Vous devez également réfléchir à la façon de gérer plusieurs instances d’une application et à ce que vous souhaitez faire lorsque vous détectez des erreurs renouvelables dans chaque instance.</span><span class="sxs-lookup"><span data-stu-id="792bf-224">Another consideration is how to handle multiple instances of an application, and what to do when you detect retryable errors in each instance.</span></span> <span data-ttu-id="792bf-225">Par exemple, vous pouvez avoir 20 machines virtuelles en cours d’exécution, sur lesquelles la même application est chargée.</span><span class="sxs-lookup"><span data-stu-id="792bf-225">For example, you may have 20 VMs running with the same application loaded.</span></span> <span data-ttu-id="792bf-226">Gérez-vous chaque instance séparément ?</span><span class="sxs-lookup"><span data-stu-id="792bf-226">Do you handle each instance separately?</span></span> <span data-ttu-id="792bf-227">Si une instance commence à présenter des problèmes, souhaitez-vous limiter la réponse à cette instance ou essayer de faire en sorte que toutes les instances répondent de la même façon ?</span><span class="sxs-lookup"><span data-stu-id="792bf-227">If one instance starts having problems, do you want to limit the response to just that one instance, or do you want to try to have all instances respond in the same way when one instance has a problem?</span></span> <span data-ttu-id="792bf-228">Gérer les instances séparément est beaucoup plus simple que d’essayer de coordonner la réponse entre elles. Cependant, la façon de procéder varie selon l’architecture de votre application.</span><span class="sxs-lookup"><span data-stu-id="792bf-228">Handling the instances separately is much simpler than trying to coordinate the response across them, but how you do this depends on your application's architecture.</span></span>

### <a name="options-for-monitoring-the-error-frequency"></a><span data-ttu-id="792bf-229">Options disponibles pour la surveillance de la fréquence d’erreur</span><span class="sxs-lookup"><span data-stu-id="792bf-229">Options for monitoring the error frequency</span></span>

<span data-ttu-id="792bf-230">Vous disposez de trois options principales pour la surveillance de la fréquence des nouvelles tentatives dans la région primaire, en vue de déterminer à quel moment basculer vers la région secondaire et faire passer l’application en mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-230">You have three main options for monitoring the frequency of retries in the primary region in order to determine when to switch over to the secondary region and change the application to run in read-only mode.</span></span>

*   <span data-ttu-id="792bf-231">Ajoutez un gestionnaire pour l’événement [**Retrying**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.retrying.aspx) sur l’objet [**OperationContext**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.aspx) transmis à vos demandes de stockage. Il s’agit de la méthode présentée dans cet article et utilisée dans l’exemple qui l’accompagne.</span><span class="sxs-lookup"><span data-stu-id="792bf-231">Add a handler for the [**Retrying**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.retrying.aspx) event on the [**OperationContext**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.operationcontext.aspx) object you pass to your storage requests – this is the method displayed in this article and used in the accompanying sample.</span></span> <span data-ttu-id="792bf-232">Ces événements se déclenchent à chaque fois que le client tente une nouvelle demande, ce qui vous permet de suivre la fréquence à laquelle le client rencontre des erreurs renouvelables sur un point de terminaison principal.</span><span class="sxs-lookup"><span data-stu-id="792bf-232">These events fire whenever the client retries a request, enabling you to track how often the client encounters retryable errors on a primary endpoint.</span></span>

    ```csharp 
    operationContext.Retrying += (sender, arguments) =>
    {
        // Retrying in the primary region
        if (arguments.Request.Host == primaryhostname)
            ...
    };
    ```

*   <span data-ttu-id="792bf-233">Dans la méthode [**Evaluate**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.retrypolicies.iextendedretrypolicy.evaluate.aspx) d’une stratégie de nouvelle tentative personnalisée, vous pouvez exécuter du code personnalisé chaque fois qu’une nouvelle tentative est effectuée.</span><span class="sxs-lookup"><span data-stu-id="792bf-233">In the [**Evaluate**](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storage.retrypolicies.iextendedretrypolicy.evaluate.aspx) method in a custom retry policy, you can run custom code whenever a retry takes place.</span></span> <span data-ttu-id="792bf-234">Le moment où une nouvelle tentative est effectuée est enregistré. En outre, cela vous donne également la possibilité de modifier le comportement de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="792bf-234">In addition to recording when a retry happens, this also gives you the opportunity to modify your retry behavior.</span></span>

    ```csharp 
    public RetryInfo Evaluate(RetryContext retryContext,
    OperationContext operationContext)
    {
        var statusCode = retryContext.LastRequestResult.HttpStatusCode;
        if (retryContext.CurrentRetryCount >= this.maximumAttempts
        || ((statusCode &gt;= 300 && statusCode &lt; 500 && statusCode != 408)
        || statusCode == 501 // Not Implemented
        || statusCode == 505 // Version Not Supported
            ))
        {
        // Do not retry
            return null;
        }

        // Monitor retries in the primary location
        ...

        // Determine RetryInterval and TargetLocation
        RetryInfo info =
            CreateRetryInfo(retryContext.CurrentRetryCount);

        return info;
    }
    ```

*   <span data-ttu-id="792bf-235">La troisième approche consiste à implémenter un composant de contrôle personnalisé dans votre application, qui effectue des tests ping en permanence sur votre point de terminaison de stockage principal avec des demandes de lecture factices (par exemple, la lecture d’un blob de petite taille) pour en déterminer l’état d’intégrité.</span><span class="sxs-lookup"><span data-stu-id="792bf-235">The third approach is to implement a custom monitoring component in your application that continually pings your primary storage endpoint with dummy read requests (such as reading a small blob) to determine its health.</span></span> <span data-ttu-id="792bf-236">Dans ce cas, la quantité de ressources sollicitées est raisonnable.</span><span class="sxs-lookup"><span data-stu-id="792bf-236">This would take up some resources, but not a significant amount.</span></span> <span data-ttu-id="792bf-237">Lorsque le système détecte qu’un problème atteint votre seuil, vous effectuez alors le basculement vers **SecondaryOnly** et le mode lecture seule.</span><span class="sxs-lookup"><span data-stu-id="792bf-237">When a problem is discovered that reaches your threshold, you would then perform the switch to **SecondaryOnly** and read-only mode.</span></span>

<span data-ttu-id="792bf-238">À un moment donné, vous souhaiterez rétablir l’utilisation du point de terminaison principal et autoriser les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-238">At some point, you will want to switch back to using the primary endpoint and allowing updates.</span></span> <span data-ttu-id="792bf-239">Si vous utilisez l’une des deux premières méthodes indiquées plus haut, vous pouvez simplement rebasculer vers le point de terminaison principal et activer le mode de mise à jour après une période sélectionnée arbitrairement ou une fois effectué un certain nombre d’opérations.</span><span class="sxs-lookup"><span data-stu-id="792bf-239">If using one of the first two methods listed above, you could simply switch back to the primary endpoint and enable update mode after an arbitrarily selected amount of time or number of operations has been performed.</span></span> <span data-ttu-id="792bf-240">Vous pouvez ensuite laisser place de nouveau à la logique de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="792bf-240">You can then let it go through the retry logic again.</span></span> <span data-ttu-id="792bf-241">Si le problème a été résolu, le point de terminaison principal reste utilisé et les mises à jour restent autorisées.</span><span class="sxs-lookup"><span data-stu-id="792bf-241">If the problem has been fixed, it will continue to use the primary endpoint and allow updates.</span></span> <span data-ttu-id="792bf-242">Si le problème persiste, un basculement vers le point de terminaison secondaire et le mode lecture seul est de nouveau effectué dès lors que les critères que vous avez définis ne sont pas respectés.</span><span class="sxs-lookup"><span data-stu-id="792bf-242">If there is still a problem, it will once more switch back to the secondary endpoint and read-only mode after failing the criteria you've set.</span></span>

<span data-ttu-id="792bf-243">Dans le cadre du troisième scénario, lorsque les tests ping effectués sur le point de terminaison de stockage principal aboutissent de nouveau, vous pouvez déclencher le nouveau basculement vers **PrimaryOnly** et continuer à autoriser les mises à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-243">For the third scenario, when pinging the primary storage endpoint becomes successful again, you can trigger the switch back to **PrimaryOnly** and continue allowing updates.</span></span>

## <a name="handling-eventually-consistent-data"></a><span data-ttu-id="792bf-244">Gestion des données cohérentes</span><span class="sxs-lookup"><span data-stu-id="792bf-244">Handling eventually consistent data</span></span>

<span data-ttu-id="792bf-245">Le stockage RA-GRS réplique des transactions de la région primaire vers la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-245">RA-GRS works by replicating transactions from the primary to the secondary region.</span></span> <span data-ttu-id="792bf-246">Ce processus de réplication garantit que les données de la région secondaire sont *cohérentes*.</span><span class="sxs-lookup"><span data-stu-id="792bf-246">This replication process guarantees that the data in the secondary region is *eventually consistent*.</span></span> <span data-ttu-id="792bf-247">Cela signifie que toutes les transactions de la région primaire apparaîtront dans la région secondaire. Cependant, cela peut prendre un certain temps, et rien ne garantit que les transactions arrivent dans la région secondaire dans l’ordre dans lequel elles ont été initialement appliquées dans la région primaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-247">This means that all the transactions in the primary region will eventually appear in the secondary region, but that there may be a lag before they appear, and that there is no guarantee the transactions arrive in the secondary region in the same order as that in which they were originally applied in the primary region.</span></span> <span data-ttu-id="792bf-248">Si vos transactions arrivent dans la région secondaire dans le désordre, vous *pouvez* considérer que vos données dans cette région resteront dans un état incohérent jusqu’à ce que le service rattrape son retard.</span><span class="sxs-lookup"><span data-stu-id="792bf-248">If your transactions arrive in the secondary region out of order, you *may* consider your data in the secondary region to be in an inconsistent state until the service catches up.</span></span>

<span data-ttu-id="792bf-249">Le tableau suivant illustre ce qui peut se produire lorsque vous mettez à jour les informations d’une employée pour lui affecter le rôle *administrateur*.</span><span class="sxs-lookup"><span data-stu-id="792bf-249">The following table shows an example of what might happen when you update the details of an employee to make her a member of the *administrators* role.</span></span> <span data-ttu-id="792bf-250">Cet exemple implique que vous mettiez à jour l’entité **d’employé** et une entité de **rôle administrateur** avec le nombre total d’administrateurs.</span><span class="sxs-lookup"><span data-stu-id="792bf-250">For the sake of this example, this requires you update the **employee** entity and update an **administrator role** entity with a count of the total number of administrators.</span></span> <span data-ttu-id="792bf-251">Notez la façon dont les mises à jour sont appliquées dans le désordre dans la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-251">Notice how the updates are applied out of order in the secondary region.</span></span>

| <span data-ttu-id="792bf-252">**Time**</span><span class="sxs-lookup"><span data-stu-id="792bf-252">**Time**</span></span> | <span data-ttu-id="792bf-253">**Transaction**</span><span class="sxs-lookup"><span data-stu-id="792bf-253">**Transaction**</span></span>                                            | <span data-ttu-id="792bf-254">**Réplication**</span><span class="sxs-lookup"><span data-stu-id="792bf-254">**Replication**</span></span>                       | <span data-ttu-id="792bf-255">**Dernière heure de synchronisation**</span><span class="sxs-lookup"><span data-stu-id="792bf-255">**Last Sync Time**</span></span> | <span data-ttu-id="792bf-256">**Résultat**</span><span class="sxs-lookup"><span data-stu-id="792bf-256">**Result**</span></span> |
|----------|------------------------------------------------------------|---------------------------------------|--------------------|------------| 
| <span data-ttu-id="792bf-257">T0</span><span class="sxs-lookup"><span data-stu-id="792bf-257">T0</span></span>       | <span data-ttu-id="792bf-258">Transaction A :</span><span class="sxs-lookup"><span data-stu-id="792bf-258">Transaction A:</span></span> <br> <span data-ttu-id="792bf-259">Insérer l’entité d’employé</span><span class="sxs-lookup"><span data-stu-id="792bf-259">Insert employee</span></span> <br> <span data-ttu-id="792bf-260">dans la région primaire</span><span class="sxs-lookup"><span data-stu-id="792bf-260">entity in primary</span></span> |                                   |                    | <span data-ttu-id="792bf-261">Transaction A insérée dans la région primaire,</span><span class="sxs-lookup"><span data-stu-id="792bf-261">Transaction A inserted to primary,</span></span><br> <span data-ttu-id="792bf-262">pas encore répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-262">not replicated yet.</span></span> |
| <span data-ttu-id="792bf-263">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-263">T1</span></span>       |                                                            | <span data-ttu-id="792bf-264">Transaction A</span><span class="sxs-lookup"><span data-stu-id="792bf-264">Transaction A</span></span> <br> <span data-ttu-id="792bf-265">répliquée sur</span><span class="sxs-lookup"><span data-stu-id="792bf-265">replicated to</span></span><br> <span data-ttu-id="792bf-266">la région secondaire</span><span class="sxs-lookup"><span data-stu-id="792bf-266">secondary</span></span> | <span data-ttu-id="792bf-267">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-267">T1</span></span> | <span data-ttu-id="792bf-268">Transaction A répliquée sur la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-268">Transaction A replicated to secondary.</span></span> <br><span data-ttu-id="792bf-269">Dernière heure de synchronisation mise à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-269">Last Sync Time updated.</span></span>    |
| <span data-ttu-id="792bf-270">T2</span><span class="sxs-lookup"><span data-stu-id="792bf-270">T2</span></span>       | <span data-ttu-id="792bf-271">Transaction B :</span><span class="sxs-lookup"><span data-stu-id="792bf-271">Transaction B:</span></span><br><span data-ttu-id="792bf-272">Mettre à jour</span><span class="sxs-lookup"><span data-stu-id="792bf-272">Update</span></span><br> <span data-ttu-id="792bf-273">l’entité d’employé</span><span class="sxs-lookup"><span data-stu-id="792bf-273">employee entity</span></span><br> <span data-ttu-id="792bf-274">dans la région primaire</span><span class="sxs-lookup"><span data-stu-id="792bf-274">in primary</span></span>  |                                | <span data-ttu-id="792bf-275">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-275">T1</span></span>                 | <span data-ttu-id="792bf-276">Transaction B écrite dans la région primaire,</span><span class="sxs-lookup"><span data-stu-id="792bf-276">Transaction B written to primary,</span></span><br> <span data-ttu-id="792bf-277">pas encore répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-277">not replicated yet.</span></span>  |
| <span data-ttu-id="792bf-278">T3</span><span class="sxs-lookup"><span data-stu-id="792bf-278">T3</span></span>       | <span data-ttu-id="792bf-279">Transaction C :</span><span class="sxs-lookup"><span data-stu-id="792bf-279">Transaction C:</span></span><br> <span data-ttu-id="792bf-280">Mettre à jour</span><span class="sxs-lookup"><span data-stu-id="792bf-280">Update</span></span> <br><span data-ttu-id="792bf-281">administrator</span><span class="sxs-lookup"><span data-stu-id="792bf-281">administrator</span></span><br><span data-ttu-id="792bf-282">entité de rôle dans</span><span class="sxs-lookup"><span data-stu-id="792bf-282">role entity in</span></span><br><span data-ttu-id="792bf-283">primary</span><span class="sxs-lookup"><span data-stu-id="792bf-283">primary</span></span> |                    | <span data-ttu-id="792bf-284">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-284">T1</span></span>                 | <span data-ttu-id="792bf-285">Transaction C écrite dans la région primaire,</span><span class="sxs-lookup"><span data-stu-id="792bf-285">Transaction C written to primary,</span></span><br> <span data-ttu-id="792bf-286">pas encore répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-286">not replicated yet.</span></span>  |
| <span data-ttu-id="792bf-287">*T4*</span><span class="sxs-lookup"><span data-stu-id="792bf-287">*T4*</span></span>     |                                                       | <span data-ttu-id="792bf-288">Transaction C</span><span class="sxs-lookup"><span data-stu-id="792bf-288">Transaction C</span></span> <br><span data-ttu-id="792bf-289">répliquée sur</span><span class="sxs-lookup"><span data-stu-id="792bf-289">replicated to</span></span><br> <span data-ttu-id="792bf-290">la région secondaire</span><span class="sxs-lookup"><span data-stu-id="792bf-290">secondary</span></span> | <span data-ttu-id="792bf-291">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-291">T1</span></span>         | <span data-ttu-id="792bf-292">Transaction C répliquée sur la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-292">Transaction C replicated to secondary.</span></span><br><span data-ttu-id="792bf-293">LastSyncTime pas encore mis à jour car</span><span class="sxs-lookup"><span data-stu-id="792bf-293">LastSyncTime not updated because</span></span> <br><span data-ttu-id="792bf-294">la transaction B n’a pas encore été répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-294">transaction B has not been replicated yet.</span></span>|
| <span data-ttu-id="792bf-295">*T5*</span><span class="sxs-lookup"><span data-stu-id="792bf-295">*T5*</span></span>     | <span data-ttu-id="792bf-296">Lire les entités</span><span class="sxs-lookup"><span data-stu-id="792bf-296">Read entities</span></span> <br><span data-ttu-id="792bf-297">de la région secondaire</span><span class="sxs-lookup"><span data-stu-id="792bf-297">from secondary</span></span>                           |                                  | <span data-ttu-id="792bf-298">T1</span><span class="sxs-lookup"><span data-stu-id="792bf-298">T1</span></span>                 | <span data-ttu-id="792bf-299">Vous obtenez la valeur périmée pour l’entité d’employé</span><span class="sxs-lookup"><span data-stu-id="792bf-299">You get the stale value for employee</span></span> <br> <span data-ttu-id="792bf-300">car la transaction B n’a</span><span class="sxs-lookup"><span data-stu-id="792bf-300">entity because transaction B hasn't</span></span> <br> <span data-ttu-id="792bf-301">pas encore été répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-301">replicated yet.</span></span> <span data-ttu-id="792bf-302">Vous obtenez la nouvelle valeur pour</span><span class="sxs-lookup"><span data-stu-id="792bf-302">You get the new value for</span></span><br> <span data-ttu-id="792bf-303">l’entité de rôle d’administrateur car C a</span><span class="sxs-lookup"><span data-stu-id="792bf-303">administrator role entity because C has</span></span><br> <span data-ttu-id="792bf-304">été répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-304">replicated.</span></span> <span data-ttu-id="792bf-305">La dernière heure de synchronisation n’a pas encore</span><span class="sxs-lookup"><span data-stu-id="792bf-305">Last Sync Time still hasn't</span></span><br> <span data-ttu-id="792bf-306">été mise à jour car la transaction B</span><span class="sxs-lookup"><span data-stu-id="792bf-306">been updated because transaction B</span></span><br> <span data-ttu-id="792bf-307">n’a pas été répliquée.</span><span class="sxs-lookup"><span data-stu-id="792bf-307">hasn't replicated.</span></span> <span data-ttu-id="792bf-308">Vous savez que</span><span class="sxs-lookup"><span data-stu-id="792bf-308">You can tell the</span></span><br><span data-ttu-id="792bf-309">l’entité de rôle d’administrateur est cohérente</span><span class="sxs-lookup"><span data-stu-id="792bf-309">administrator role entity is inconsistent</span></span> <br><span data-ttu-id="792bf-310">car l’heure/la date de l’entité sont postérieures à</span><span class="sxs-lookup"><span data-stu-id="792bf-310">because the entity date/time is after</span></span> <br><span data-ttu-id="792bf-311">la dernière heure de synchronisation.</span><span class="sxs-lookup"><span data-stu-id="792bf-311">the Last Sync Time.</span></span> |
| <span data-ttu-id="792bf-312">*T6*</span><span class="sxs-lookup"><span data-stu-id="792bf-312">*T6*</span></span>     |                                                      | <span data-ttu-id="792bf-313">Transaction B</span><span class="sxs-lookup"><span data-stu-id="792bf-313">Transaction B</span></span><br> <span data-ttu-id="792bf-314">répliquée sur</span><span class="sxs-lookup"><span data-stu-id="792bf-314">replicated to</span></span><br> <span data-ttu-id="792bf-315">la région secondaire</span><span class="sxs-lookup"><span data-stu-id="792bf-315">secondary</span></span> | <span data-ttu-id="792bf-316">T6</span><span class="sxs-lookup"><span data-stu-id="792bf-316">T6</span></span>                 | <span data-ttu-id="792bf-317">*T6* – Toutes les transactions jusqu’à C ont</span><span class="sxs-lookup"><span data-stu-id="792bf-317">*T6* – All transactions through C have</span></span> <br><span data-ttu-id="792bf-318">été répliquées. La dernière heure de synchronisation</span><span class="sxs-lookup"><span data-stu-id="792bf-318">been replicated, Last Sync Time</span></span><br> <span data-ttu-id="792bf-319">est mise à jour.</span><span class="sxs-lookup"><span data-stu-id="792bf-319">is updated.</span></span> |

<span data-ttu-id="792bf-320">Dans cet exemple, supposons que le client bascule vers la lecture à partir de la région secondaire à l’instant T5.</span><span class="sxs-lookup"><span data-stu-id="792bf-320">In this example, assume the client switches to reading from the secondary region at T5.</span></span> <span data-ttu-id="792bf-321">À ce stade, il peut lire correctement l’entité de **rôle administrateur**. Cependant, l’entité contient une valeur pour le nombre d’administrateurs qui n’est pas cohérente avec le nombre d’entités **d’employé** marquées comme administrateurs dans la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-321">It can successfully read the **administrator role** entity at this time, but the entity contains a value for the count of administrators that is not consistent with the number of **employee** entities that are marked as administrators in the secondary region at this time.</span></span> <span data-ttu-id="792bf-322">Votre client pourrait simplement afficher cette valeur au risque que les informations soient incohérentes.</span><span class="sxs-lookup"><span data-stu-id="792bf-322">Your client could simply display this value, with the risk that it is inconsistent information.</span></span> <span data-ttu-id="792bf-323">Il pourrait également tenter de déterminer que le **rôle administrateur** est dans un état potentiellement incohérent dans la mesure où les mises à jour ont été effectuées dans le désordre et en informer l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="792bf-323">Alternatively, the client could attempt to determine that the **administrator role** is in a potentially inconsistent state because the updates have happened out of order, and then inform the user of this fact.</span></span>

<span data-ttu-id="792bf-324">Pour déterminer que ses données sont potentiellement incohérentes, le client peut utiliser la valeur de la *dernière heure de synchronisation*, que vous pouvez obtenir à tout moment en interrogeant un service de stockage.</span><span class="sxs-lookup"><span data-stu-id="792bf-324">To recognize that it has potentially inconsistent data, the client can use the value of the *Last Sync Time* that you can get at any time by querying a storage service.</span></span> <span data-ttu-id="792bf-325">Elle vous indique la dernière heure à laquelle les données de la région secondaire étaient cohérentes et à laquelle le service avait appliqué toutes les transactions.</span><span class="sxs-lookup"><span data-stu-id="792bf-325">This tells you the time when the data in the secondary region was last consistent and when the service had applied all the transactions prior to that point in time.</span></span> <span data-ttu-id="792bf-326">Dans l’exemple ci-dessus, une fois que le service insère l’entité **d’employé** dans la région secondaire, la dernière heure de synchronisation est définie sur *T1*.</span><span class="sxs-lookup"><span data-stu-id="792bf-326">In the example shown above, after the service inserts the **employee** entity in the secondary region, the last sync time is set to *T1*.</span></span> <span data-ttu-id="792bf-327">Elle reste définie sur *T1* jusqu’à ce que le service mette à jour l’entité **d’employé** dans la région secondaire, puis est définie sur *T6*.</span><span class="sxs-lookup"><span data-stu-id="792bf-327">It remains at *T1* until the service updates the **employee** entity in the secondary region when it is set to *T6*.</span></span> <span data-ttu-id="792bf-328">Si le client récupère la dernière heure de synchronisation lors de la lecture de l’entité à l’instant *T5*, il peut la comparer avec l’horodatage de l’entité.</span><span class="sxs-lookup"><span data-stu-id="792bf-328">If the client retrieves the last sync time when it reads the entity at *T5*, it can compare it with the timestamp on the entity.</span></span> <span data-ttu-id="792bf-329">Si l’horodatage de l’entité est postérieur à la dernière heure de synchronisation, l’entité est dans un état potentiellement incohérent, et vous pouvez alors effectuer toute action appropriée pour votre application.</span><span class="sxs-lookup"><span data-stu-id="792bf-329">If the timestamp on the entity is later than the last sync time, then the entity is in a potentially inconsistent state, and you can take whatever is the appropriate action for your application.</span></span> <span data-ttu-id="792bf-330">L’utilisation de ce champ requiert que vous sachiez à quel moment a été effectuée la dernière mise à jour de la région primaire.</span><span class="sxs-lookup"><span data-stu-id="792bf-330">Using this field requires that you know when the last update to the primary was completed.</span></span>

## <a name="testing"></a><span data-ttu-id="792bf-331">Test</span><span class="sxs-lookup"><span data-stu-id="792bf-331">Testing</span></span>

<span data-ttu-id="792bf-332">Il est important de tester si votre application se comporte comme prévu lorsqu’elle rencontre des erreurs renouvelables.</span><span class="sxs-lookup"><span data-stu-id="792bf-332">It's important to test that your application behaves as expected when it encounters retryable errors.</span></span> <span data-ttu-id="792bf-333">Par exemple, vous devez tester si l’application bascule vers la région secondaire et le mode lecture seule lorsqu’elle détecte un problème et bascule de nouveau lorsque la région primaire est à nouveau disponible.</span><span class="sxs-lookup"><span data-stu-id="792bf-333">For example, you need to test that the application switches to the secondary and into read-only mode when it detects a problem, and switches back when the primary region becomes available again.</span></span> <span data-ttu-id="792bf-334">Pour ce faire, il vous faut un moyen de simuler les erreurs renouvelables et de contrôler la fréquence à laquelle elles se produisent.</span><span class="sxs-lookup"><span data-stu-id="792bf-334">To do this, you need a way to simulate retryable errors and control how often they occur.</span></span>

<span data-ttu-id="792bf-335">Vous pouvez utiliser [Fiddler](http://www.telerik.com/fiddler) pour intercepter et modifier les réponses HTTP dans un script.</span><span class="sxs-lookup"><span data-stu-id="792bf-335">You can use [Fiddler](http://www.telerik.com/fiddler) to intercept and modify HTTP responses in a script.</span></span> <span data-ttu-id="792bf-336">Ce script peut identifier les réponses provenant de votre point de terminaison principal et remplacer le code d’état HTTP par un code que la bibliothèque cliente de stockage reconnaît comme une erreur renouvelable.</span><span class="sxs-lookup"><span data-stu-id="792bf-336">This script can identify responses that come from your primary endpoint and change the HTTP status code to one that the Storage Client Library recognizes as a retryable error.</span></span> <span data-ttu-id="792bf-337">Cet extrait de code offre un exemple simple de script Fiddler, qui intercepte les réponses aux demandes de lecture portant sur la table **employeedata** pour retourner un état 502 :</span><span class="sxs-lookup"><span data-stu-id="792bf-337">This code snippet shows a simple example of a Fiddler script that intercepts responses to read requests against the **employeedata** table to return a 502 status:</span></span>

```java
static function OnBeforeResponse(oSession: Session) {
    ...
    if ((oSession.hostname == "\[yourstorageaccount\].table.core.windows.net")
      && (oSession.PathAndQuery.StartsWith("/employeedata?$filter"))) {
        oSession.responseCode = 502;
    }
}
```

<span data-ttu-id="792bf-338">Vous pouvez étendre cet exemple pour intercepter un plus grand nombre de demandes et modifier le **responseCode** uniquement sur certaines d’entre elles pour mieux simuler un scénario réel.</span><span class="sxs-lookup"><span data-stu-id="792bf-338">You could extend this example to intercept a wider range of requests and only change the **responseCode** on some of them to better simulate a real-world scenario.</span></span> <span data-ttu-id="792bf-339">Pour plus d’informations sur la personnalisation des scripts Fiddler, consultez [Modifying a Request or Response](http://docs.telerik.com/fiddler/KnowledgeBase/FiddlerScript/ModifyRequestOrResponse) (Modification d’une demande ou d’une réponse) dans la documentation Fiddler.</span><span class="sxs-lookup"><span data-stu-id="792bf-339">For more information about customizing Fiddler scripts, see [Modifying a Request or Response](http://docs.telerik.com/fiddler/KnowledgeBase/FiddlerScript/ModifyRequestOrResponse) in the Fiddler documentation.</span></span>

<span data-ttu-id="792bf-340">Si vous avez rendu configurables les seuils de basculement de votre application en mode lecture seule, il sera plus facile de tester le comportement avec des volumes de transaction hors production.</span><span class="sxs-lookup"><span data-stu-id="792bf-340">If you have made the thresholds for switching your application to read-only mode configurable, it will be easier to test the behavior with non-production transaction volumes.</span></span>

## <a name="next-steps"></a><span data-ttu-id="792bf-341">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="792bf-341">Next Steps</span></span>

* <span data-ttu-id="792bf-342">Pour plus d’informations sur la géoredondance avec accès en lecture et pour voir un autre exemple de définition du paramètre LastSyncTime, consultez [Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/) (Options de redondance de stockage Windows Azure et stockage géoredondant avec accès en lecture).</span><span class="sxs-lookup"><span data-stu-id="792bf-342">For more information about Read Access Geo-Redundancy, including another example of how the LastSyncTime is set, please see [Windows Azure Storage Redundancy Options and Read Access Geo Redundant Storage](https://blogs.msdn.microsoft.com/windowsazurestorage/2013/12/11/windows-azure-storage-redundancy-options-and-read-access-geo-redundant-storage/).</span></span>

* <span data-ttu-id="792bf-343">Pour obtenir un exemple complet montrant comment effectuer les basculements entre les points de terminaison principaux et secondaires, consultez [Azure Samples – Using the Circuit Breaker Pattern with RA-GRS storage](https://github.com/Azure-Samples/storage-dotnet-circuit-breaker-pattern-ha-apps-using-ra-grs) (Exemples Azure – Utilisation du modèle Disjoncteur avec le stockage RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="792bf-343">For a complete sample showing how to make the switch back and forth between the Primary and Secondary endpoints, please see [Azure Samples – Using the Circuit Breaker Pattern with RA-GRS storage](https://github.com/Azure-Samples/storage-dotnet-circuit-breaker-pattern-ha-apps-using-ra-grs).</span></span>
