---
title: "aaaCreate un instantané en lecture seule d’un objet blob dans le stockage Azure | Documents Microsoft"
description: "Découvrez comment toocreate un instantané d’un tooback d’objets blob des données blob à un moment donné dans le temps. Comprendre comment les instantanés sont facturés et toouse les frais de capacité toominimize."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 3710705d-e127-4b01-8d0f-29853fb06d0d
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/11/2017
ms.author: marsma
ms.openlocfilehash: 57f2e76b8899b8a513688bf148dd13673141d5bd
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="create-a-blob-snapshot"></a><span data-ttu-id="eef7a-104">Création d’un instantané d’objet blob</span><span class="sxs-lookup"><span data-stu-id="eef7a-104">Create a blob snapshot</span></span>

<span data-ttu-id="eef7a-105">Un instantané est une version en lecture seule d'un objet blob capturé à un instant donné.</span><span class="sxs-lookup"><span data-stu-id="eef7a-105">A snapshot is a read-only version of a blob that's taken at a point in time.</span></span> <span data-ttu-id="eef7a-106">Les captures instantanées sont utiles pour la sauvegarde des objets blob.</span><span class="sxs-lookup"><span data-stu-id="eef7a-106">Snapshots are useful for backing up blobs.</span></span> <span data-ttu-id="eef7a-107">Une fois créé, un instantané peut être lu, copié ou supprimé, mais pas modifié.</span><span class="sxs-lookup"><span data-stu-id="eef7a-107">After you create a snapshot, you can read, copy, or delete it, but you cannot modify it.</span></span>

<span data-ttu-id="eef7a-108">Un instantané d’un objet blob est l’objet blob de base tooits identiques, à l’exception de cet objet blob hello URI a un **DateTime** valeur ajoutée temps hello toohello blob URI tooindicate à quels hello instantané a été pris.</span><span class="sxs-lookup"><span data-stu-id="eef7a-108">A snapshot of a blob is identical tooits base blob, except that hello blob URI has a **DateTime** value appended toohello blob URI tooindicate hello time at which hello snapshot was taken.</span></span> <span data-ttu-id="eef7a-109">Par exemple, si une page d’objets blob URI est `http://storagesample.core.blob.windows.net/mydrives/myvhd`, hello instantané URI est trop similaire`http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z`.</span><span class="sxs-lookup"><span data-stu-id="eef7a-109">For example, if a page blob URI is `http://storagesample.core.blob.windows.net/mydrives/myvhd`, hello snapshot URI is similar too`http://storagesample.core.blob.windows.net/mydrives/myvhd?snapshot=2011-03-09T01:42:34.9360000Z`.</span></span>

> [!NOTE]
> <span data-ttu-id="eef7a-110">Tous les instantanés de partagent les URI hello base de l’objet blob.</span><span class="sxs-lookup"><span data-stu-id="eef7a-110">All snapshots share hello base blob's URI.</span></span> <span data-ttu-id="eef7a-111">Hello seule distinction entre l’objet blob de base hello et instantané d’hello est hello ajouté **DateTime** valeur.</span><span class="sxs-lookup"><span data-stu-id="eef7a-111">hello only distinction between hello base blob and hello snapshot is hello appended **DateTime** value.</span></span>
>

<span data-ttu-id="eef7a-112">Un objet blob peut avoir plusieurs instantanés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-112">A blob can have any number of snapshots.</span></span> <span data-ttu-id="eef7a-113">Les instantanés sont conservés jusqu’à ce qu’ils soient explicitement supprimés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-113">Snapshots persist until they are explicitly deleted.</span></span> <span data-ttu-id="eef7a-114">Un instantané ne peut pas être conservé plus longtemps que son objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="eef7a-114">A snapshot cannot outlive its base blob.</span></span> <span data-ttu-id="eef7a-115">Vous pouvez énumérer les instantanés hello associés tootrack d’objet blob de base hello vos instantanés actuels.</span><span class="sxs-lookup"><span data-stu-id="eef7a-115">You can enumerate hello snapshots associated with hello base blob tootrack your current snapshots.</span></span>

<span data-ttu-id="eef7a-116">Lorsque vous créez un instantané d’un objet blob, hello des propriétés de système de l’objet blob est des mêmes valeurs instantané toohello copiés avec hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-116">When you create a snapshot of a blob, hello blob's system properties are copied toohello snapshot with hello same values.</span></span> <span data-ttu-id="eef7a-117">Hello base métadonnées d’objet blob sont également copié toohello snapshot, sauf si vous spécifiez des métadonnées distincts pour hello d’instantané lors de sa création.</span><span class="sxs-lookup"><span data-stu-id="eef7a-117">hello base blob's metadata is also copied toohello snapshot, unless you specify separate metadata for hello snapshot when you create it.</span></span>

<span data-ttu-id="eef7a-118">Des baux associés d’objet blob de base hello n’affectent pas l’instantané d’hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-118">Any leases associated with hello base blob do not affect hello snapshot.</span></span> <span data-ttu-id="eef7a-119">Vous ne pouvez pas acquérir de bail pour un instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-119">You cannot acquire a lease on a snapshot.</span></span>

<span data-ttu-id="eef7a-120">Un fichier de disque dur virtuel est utilisé toostore hello plus d’informations en cours et l’état d’un disque de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="eef7a-120">A VHD file is used toostore hello current information and status for a VM disk.</span></span> <span data-ttu-id="eef7a-121">Vous pouvez détacher un disque à partir de hello machine virtuelle ou arrêter hello machine virtuelle et puis prendre un instantané de son fichier de disque dur virtuel.</span><span class="sxs-lookup"><span data-stu-id="eef7a-121">You can detach a disk from within hello VM or shut down hello VM, and then take a snapshot of its VHD file.</span></span> <span data-ttu-id="eef7a-122">Vous pouvez utiliser ce fichier de capture instantanée ultérieure tooretrieve hello disque dur virtuel du fichier à ce stade dans le temps et recréer hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="eef7a-122">You can use that snapshot file later tooretrieve hello VHD file at that point in time and recreate hello VM.</span></span>

<span data-ttu-id="eef7a-123">Si le chiffrement de Service de stockage (SSE) est activée pour le compte de stockage hello dans le hello blob réside, puis toutes les captures instantanées prises de cet objet blob seront chiffrées au repos.</span><span class="sxs-lookup"><span data-stu-id="eef7a-123">If Storage Service Encryption (SSE) is enabled for hello storage account in which hello blob resides, then any snapshots taken of that blob will be encrypted at rest.</span></span>

## <a name="create-a-snapshot"></a><span data-ttu-id="eef7a-124">Créer un instantané</span><span class="sxs-lookup"><span data-stu-id="eef7a-124">Create a snapshot</span></span>
<span data-ttu-id="eef7a-125">Hello exemple de code suivant montre comment un instantané à l’aide de toocreate hello [bibliothèque cliente de stockage Azure pour .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="eef7a-125">hello following code example shows how toocreate a snapshot by using hello [Azure Storage Client Library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="eef7a-126">Cet exemple spécifie des métadonnées supplémentaires pour la capture instantanée de hello lors de sa création.</span><span class="sxs-lookup"><span data-stu-id="eef7a-126">This example specifies additional metadata for hello snapshot when it is created.</span></span>

```csharp
private static async Task CreateBlockBlobSnapshot(CloudBlobContainer container)
{
    // Create a new block blob in hello container.
    CloudBlockBlob baseBlob = container.GetBlockBlobReference("sample-base-blob.txt");

    // Add blob metadata.
    baseBlob.Metadata.Add("ApproxBlobCreatedDate", DateTime.UtcNow.ToString());

    try
    {
        // Upload hello blob toocreate it, with its metadata.
        await baseBlob.UploadTextAsync(string.Format("Base blob: {0}", baseBlob.Uri.ToString()));

        // Sleep 5 seconds.
        System.Threading.Thread.Sleep(5000);

        // Create a snapshot of hello base blob.
        // Specify metadata at hello time that hello snapshot is created toospecify unique metadata for hello snapshot.
        // If no metadata is specified when hello snapshot is created, hello base blob's metadata is copied toohello snapshot.
        Dictionary<string, string> metadata = new Dictionary<string, string>();
        metadata.Add("ApproxSnapshotCreatedDate", DateTime.UtcNow.ToString());
        await baseBlob.CreateSnapshotAsync(metadata, null, null, null);
    }
    catch (StorageException e)
    {
        Console.WriteLine(e.Message);
        Console.ReadLine();
        throw;
    }
}
```

## <a name="copy-snapshots"></a><span data-ttu-id="eef7a-127">Copie d'instantanés</span><span class="sxs-lookup"><span data-stu-id="eef7a-127">Copy snapshots</span></span>
<span data-ttu-id="eef7a-128">Les opérations de copie impliquant des objets blob et des instantanés respectent les règles suivantes :</span><span class="sxs-lookup"><span data-stu-id="eef7a-128">Copy operations involving blobs and snapshots follow these rules:</span></span>

* <span data-ttu-id="eef7a-129">Vous pouvez copier un instantané sur son objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="eef7a-129">You can copy a snapshot over its base blob.</span></span> <span data-ttu-id="eef7a-130">En promouvant la position toohello instantané d’objet blob de base hello, vous pouvez restaurer une version antérieure d’un objet blob.</span><span class="sxs-lookup"><span data-stu-id="eef7a-130">By promoting a snapshot toohello position of hello base blob, you can restore an earlier version of a blob.</span></span> <span data-ttu-id="eef7a-131">Hello d’instantané est conservé, mais l’objet blob de base hello est remplacée par une copie accessible en écriture de l’instantané d’hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-131">hello snapshot remains, but hello base blob is overwritten with a writable copy of hello snapshot.</span></span>
* <span data-ttu-id="eef7a-132">Vous pouvez copier un objet blob de destination instantané tooa avec un nom différent.</span><span class="sxs-lookup"><span data-stu-id="eef7a-132">You can copy a snapshot tooa destination blob with a different name.</span></span> <span data-ttu-id="eef7a-133">objet blob de destination qui en résulte Hello est un objet blob accessible en écriture et pas un instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-133">hello resulting destination blob is a writable blob and not a snapshot.</span></span>
* <span data-ttu-id="eef7a-134">Lorsqu’un objet blob source est copié, les instantanés de l’objet blob source de hello ne sont pas copiés toohello destination.</span><span class="sxs-lookup"><span data-stu-id="eef7a-134">When a source blob is copied, any snapshots of hello source blob are not copied toohello destination.</span></span> <span data-ttu-id="eef7a-135">Lorsqu’un objet blob de destination est remplacé par une copie, tous les instantanés associés d’objet blob de destination d’origine hello restent intacts.</span><span class="sxs-lookup"><span data-stu-id="eef7a-135">When a destination blob is overwritten with a copy, any snapshots associated with hello original destination blob remain intact.</span></span>
* <span data-ttu-id="eef7a-136">Lorsque vous créez un instantané d’un objet blob de blocs, liste des blocs validés de l’objet blob de hello est également copié toohello instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-136">When you create a snapshot of a block blob, hello blob's committed block list is also copied toohello snapshot.</span></span> <span data-ttu-id="eef7a-137">Les blocs non validés ne sont pas copiés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-137">Any uncommitted blocks are not copied.</span></span>

## <a name="specify-an-access-condition"></a><span data-ttu-id="eef7a-138">Spécification d'une condition d'accès</span><span class="sxs-lookup"><span data-stu-id="eef7a-138">Specify an access condition</span></span>
<span data-ttu-id="eef7a-139">Lorsque vous appelez [CreateSnapshotAsync][dotnet_CreateSnapshotAsync], vous pouvez spécifier une condition d’accès afin que hello instantané est créé uniquement si une condition est remplie.</span><span class="sxs-lookup"><span data-stu-id="eef7a-139">When you call [CreateSnapshotAsync][dotnet_CreateSnapshotAsync], you can specify an access condition so that hello snapshot is created only if a condition is met.</span></span> <span data-ttu-id="eef7a-140">toospecify une condition d’accès, utilisez hello [AccessCondition] [ dotnet_AccessCondition] paramètre.</span><span class="sxs-lookup"><span data-stu-id="eef7a-140">toospecify an access condition, use hello [AccessCondition][dotnet_AccessCondition] parameter.</span></span> <span data-ttu-id="eef7a-141">Si hello spécifié la condition n’est pas remplie, hello instantané n’est créé et hello service Blob retourne le code d’état [HTTPStatusCode][dotnet_HTTPStatusCode]. Ne.</span><span class="sxs-lookup"><span data-stu-id="eef7a-141">If hello specified condition is not met, hello snapshot is not created, and hello Blob service returns status code [HTTPStatusCode][dotnet_HTTPStatusCode].PreconditionFailed.</span></span>

## <a name="delete-snapshots"></a><span data-ttu-id="eef7a-142">Suppression d'instantanés</span><span class="sxs-lookup"><span data-stu-id="eef7a-142">Delete snapshots</span></span>
<span data-ttu-id="eef7a-143">Impossible de supprimer un objet blob avec des instantanés, sauf si hello instantanés sont également supprimés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-143">You can't delete a blob with snapshots unless hello snapshots are also deleted.</span></span> <span data-ttu-id="eef7a-144">Vous pouvez supprimer un instantané individuel, ou spécifier que toutes les captures instantanées supprimée lorsque l’objet blob source de hello est supprimé.</span><span class="sxs-lookup"><span data-stu-id="eef7a-144">You can delete a snapshot individually, or specify that all snapshots be deleted when hello source blob is deleted.</span></span> <span data-ttu-id="eef7a-145">Si vous essayez de toodelete un objet blob qui a toujours des captures instantanées, une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="eef7a-145">If you attempt toodelete a blob that still has snapshots, an error results.</span></span>

<span data-ttu-id="eef7a-146">Hello suivant exemple de code montre comment toodelete un objet blob et ses instantanés dans .NET, où `blockBlob` est un objet de type [CloudBlockBlob][dotnet_CloudBlockBlob]:</span><span class="sxs-lookup"><span data-stu-id="eef7a-146">hello following code example shows how toodelete a blob and its snapshots in .NET, where `blockBlob` is an object of type [CloudBlockBlob][dotnet_CloudBlockBlob]:</span></span>

```csharp
await blockBlob.DeleteIfExistsAsync(DeleteSnapshotsOption.IncludeSnapshots, null, null, null);
```

## <a name="snapshots-with-azure-premium-storage"></a><span data-ttu-id="eef7a-147">Instantanés avec Azure Premium Storage</span><span class="sxs-lookup"><span data-stu-id="eef7a-147">Snapshots with Azure Premium Storage</span></span>
<span data-ttu-id="eef7a-148">Lors de l’utilisation des instantanés de stockage Premium, hello suivant les règles s’appliquent :</span><span class="sxs-lookup"><span data-stu-id="eef7a-148">When using snapshots with Premium Storage, hello following rules apply:</span></span>

* <span data-ttu-id="eef7a-149">nombre maximal de Hello d’instantanés par l’objet blob de pages dans un compte de stockage premium est 100.</span><span class="sxs-lookup"><span data-stu-id="eef7a-149">hello maximum number of snapshots per page blob in a premium storage account is 100.</span></span> <span data-ttu-id="eef7a-150">Si cette limite est dépassée, hello opération Snapshot Blob renvoie le code d’erreur 409 (`SnapshotCountExceeded`).</span><span class="sxs-lookup"><span data-stu-id="eef7a-150">If that limit is exceeded, hello Snapshot Blob operation returns error code 409 (`SnapshotCountExceeded`).</span></span>
* <span data-ttu-id="eef7a-151">Vous pouvez prendre un instantané d’un objet blob de pages dans un compte de stockage premium toutes les 10 minutes.</span><span class="sxs-lookup"><span data-stu-id="eef7a-151">You can take a snapshot of a page blob in a premium storage account once every 10 minutes.</span></span> <span data-ttu-id="eef7a-152">Si ce taux est dépassé, hello opération Snapshot Blob renvoie le code d’erreur 409 (`SnapshotOperationRateExceeded`).</span><span class="sxs-lookup"><span data-stu-id="eef7a-152">If that rate is exceeded, hello Snapshot Blob operation returns error code 409 (`SnapshotOperationRateExceeded`).</span></span>
* <span data-ttu-id="eef7a-153">tooread un instantané, vous pouvez utiliser toocopy opération de copie d’objets Blob hello objet blob de pages tooanother instantané dans le compte de hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-153">tooread a snapshot, you can use hello Copy Blob operation toocopy a snapshot tooanother page blob in hello account.</span></span> <span data-ttu-id="eef7a-154">objet blob de destination Hello pour l’opération de copie hello ne doit pas avoir tous les instantanés existants.</span><span class="sxs-lookup"><span data-stu-id="eef7a-154">hello destination blob for hello copy operation must not have any existing snapshots.</span></span> <span data-ttu-id="eef7a-155">Si le blob de destination hello ne dispose pas des captures instantanées, puis hello opération Copy Blob renvoie le code d’erreur 409 (`SnapshotsPresent`).</span><span class="sxs-lookup"><span data-stu-id="eef7a-155">If hello destination blob does have snapshots, then hello Copy Blob operation returns error code 409 (`SnapshotsPresent`).</span></span>

## <a name="return-hello-absolute-uri-tooa-snapshot"></a><span data-ttu-id="eef7a-156">Instantané tooa URI absolu de retour hello</span><span class="sxs-lookup"><span data-stu-id="eef7a-156">Return hello absolute URI tooa snapshot</span></span>
<span data-ttu-id="eef7a-157">Cet exemple de code c# crée une capture instantanée et écrit hello URI absolu pour l’emplacement principal de hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-157">This C# code example creates a snapshot and writes out hello absolute URI for hello primary location.</span></span>

```csharp
//Create hello blob service client object.
const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";

CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);
CloudBlobClient blobClient = storageAccount.CreateCloudBlobClient();

//Get a reference tooa container.
CloudBlobContainer container = blobClient.GetContainerReference("sample-container");
container.CreateIfNotExists();

//Get a reference tooa blob.
CloudBlockBlob blob = container.GetBlockBlobReference("sampleblob.txt");
blob.UploadText("This is a blob.");

//Create a snapshot of hello blob and write out its primary URI.
CloudBlockBlob blobSnapshot = blob.CreateSnapshot();
Console.WriteLine(blobSnapshot.SnapshotQualifiedStorageUri.PrimaryUri);
```

## <a name="understand-how-snapshots-accrue-charges"></a><span data-ttu-id="eef7a-158">Présentation des frais liés aux instantanés</span><span class="sxs-lookup"><span data-stu-id="eef7a-158">Understand how snapshots accrue charges</span></span>
<span data-ttu-id="eef7a-159">Création d’un instantané, qui est une copie en lecture seule d’un objet blob, peut entraîner un compte de tooyour de frais de stockage des données supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="eef7a-159">Creating a snapshot, which is a read-only copy of a blob, can result in additional data storage charges tooyour account.</span></span> <span data-ttu-id="eef7a-160">Lorsque vous concevez votre application, il est important toobe prenant en charge de la façon dont ces frais peuvent accumuler afin que vous pouvez réduire les coûts.</span><span class="sxs-lookup"><span data-stu-id="eef7a-160">When designing your application, it is important toobe aware of how these charges might accrue so that you can minimize costs.</span></span>

### <a name="important-billing-considerations"></a><span data-ttu-id="eef7a-161">Considérations importantes relatives à la facturation</span><span class="sxs-lookup"><span data-stu-id="eef7a-161">Important billing considerations</span></span>
<span data-ttu-id="eef7a-162">Hello suivant liste inclut les points clés tooconsider lors de la création d’un instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-162">hello following list includes key points tooconsider when creating a snapshot.</span></span>

* <span data-ttu-id="eef7a-163">Votre compte de stockage entraîne des frais pour les blocs uniques ou des pages, qu’ils soient dans l’objet blob de hello ou hello instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-163">Your storage account incurs charges for unique blocks or pages, whether they are in hello blob or in hello snapshot.</span></span> <span data-ttu-id="eef7a-164">Votre compte n’entraîne pas de frais supplémentaires pour les instantanés associés à un objet blob jusqu'à ce que vous mettez à jour blob hello sur lequel ils sont basés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-164">Your account does not incur additional charges for snapshots associated with a blob until you update hello blob on which they are based.</span></span> <span data-ttu-id="eef7a-165">Une fois que vous mettez à jour d’objet blob de base hello, il diffère de ses instantanés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-165">After you update hello base blob, it diverges from its snapshots.</span></span> <span data-ttu-id="eef7a-166">Dans ce cas, vous êtes facturé pour hello blocs ou pages uniques dans chaque objet blob ou un instantané.</span><span class="sxs-lookup"><span data-stu-id="eef7a-166">When this happens, you are charged for hello unique blocks or pages in each blob or snapshot.</span></span>
* <span data-ttu-id="eef7a-167">Quand vous remplacez un bloc au sein d’un objet blob de bloc, ce bloc est ensuite facturé comme un bloc unique.</span><span class="sxs-lookup"><span data-stu-id="eef7a-167">When you replace a block within a block blob, that block is subsequently charged as a unique block.</span></span> <span data-ttu-id="eef7a-168">Cela est vrai même si le bloc de hello a hello même ID de bloc et hello même des données tel qu’il est dans l’instantané d’hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-168">This is true even if hello block has hello same block ID and hello same data as it has in hello snapshot.</span></span> <span data-ttu-id="eef7a-169">Une fois que le bloc de hello est validée, elle diffère de son homologue dans tous les instantanés et vous serez facturé pour ses données.</span><span class="sxs-lookup"><span data-stu-id="eef7a-169">After hello block is committed again, it diverges from its counterpart in any snapshot, and you will be charged for its data.</span></span> <span data-ttu-id="eef7a-170">Hello que va de même pour une page dans un objet blob de pages est mis à jour avec des données identiques.</span><span class="sxs-lookup"><span data-stu-id="eef7a-170">hello same holds true for a page in a page blob that's updated with identical data.</span></span>
* <span data-ttu-id="eef7a-171">Remplacement d’un objet blob de blocs en appelant hello [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream] [ dotnet_UploadFromStream], ou [UploadFromByteArray] [ dotnet_UploadFromByteArray] méthode remplace tous les blocs dans l’objet blob de hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-171">Replacing a block blob by calling hello [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray] method replaces all blocks in hello blob.</span></span> <span data-ttu-id="eef7a-172">Si vous disposez d’un instantané associé à cet objet blob, tous les blocs dans l’objet blob de base hello et instantané différents, et vous serez facturé pour tous les blocs hello dans les deux objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="eef7a-172">If you have a snapshot associated with that blob, all blocks in hello base blob and snapshot now diverge, and you will be charged for all hello blocks in both blobs.</span></span> <span data-ttu-id="eef7a-173">Cela est vrai même si les données de salutation dans l’objet blob de base hello et l’instantané hello restent identiques.</span><span class="sxs-lookup"><span data-stu-id="eef7a-173">This is true even if hello data in hello base blob and hello snapshot remain identical.</span></span>
* <span data-ttu-id="eef7a-174">Hello service Blob Azure n’est pas un toodetermine signifie que si deux blocs contiennent des données identiques.</span><span class="sxs-lookup"><span data-stu-id="eef7a-174">hello Azure Blob service does not have a means toodetermine whether two blocks contain identical data.</span></span> <span data-ttu-id="eef7a-175">Chaque bloc est téléchargé et validé est traité comme uniques, même si elle a hello des mêmes données et hello même bloquer le code.</span><span class="sxs-lookup"><span data-stu-id="eef7a-175">Each block that is uploaded and committed is treated as unique, even if it has hello same data and hello same block ID.</span></span> <span data-ttu-id="eef7a-176">Les coûts pour les blocs uniques, il est important tooconsider, entraînant la mise à jour d’un objet blob qui a un instantané dans les blocs uniques supplémentaires et des frais supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="eef7a-176">Because charges accrue for unique blocks, it's important tooconsider that updating a blob that has a snapshot results in additional unique blocks and additional charges.</span></span>

### <a name="minimize-cost-with-snapshot-management"></a><span data-ttu-id="eef7a-177">Réduire les coûts grâce à la gestion des captures instantanées</span><span class="sxs-lookup"><span data-stu-id="eef7a-177">Minimize cost with snapshot management</span></span>

<span data-ttu-id="eef7a-178">Nous vous recommandons de la gestion de vos instantanés avec précaution tooavoid des frais supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="eef7a-178">We recommend managing your snapshots carefully tooavoid extra charges.</span></span> <span data-ttu-id="eef7a-179">Vous pouvez suivre ces meilleures pratiques toohelp réduire les coûts de hello induites par le stockage de vos instantanés hello :</span><span class="sxs-lookup"><span data-stu-id="eef7a-179">You can follow these best practices toohelp minimize hello costs incurred by hello storage of your snapshots:</span></span>

* <span data-ttu-id="eef7a-180">Supprimer et recréer les instantanés associés à un objet blob lorsque vous mettez à jour les objets blob hello, même si vous mettez à jour avec des données identiques, sauf si la conception de votre application nécessite que vous conservez des instantanés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-180">Delete and re-create snapshots associated with a blob whenever you update hello blob, even if you are updating with identical data, unless your application design requires that you maintain snapshots.</span></span> <span data-ttu-id="eef7a-181">En supprimant et en recréant les instantanés de l’objet blob de hello, vous pouvez vous assurer que les instantanés et les objets blob de hello divergences.</span><span class="sxs-lookup"><span data-stu-id="eef7a-181">By deleting and re-creating hello blob's snapshots, you can ensure that hello blob and snapshots do not diverge.</span></span>
* <span data-ttu-id="eef7a-182">Si vous gardez les instantanés d’un objet blob, évitez d’appeler [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [ UploadFromStream][dotnet_UploadFromStream], ou [UploadFromByteArray] [ dotnet_UploadFromByteArray] objet blob de tooupdate hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-182">If you are maintaining snapshots for a blob, avoid calling [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray] tooupdate hello blob.</span></span> <span data-ttu-id="eef7a-183">Ces méthodes remplacent tous les blocs hello dans l’objet blob de hello, à l’origine de votre objet blob de base et ses toodiverge instantanés considérablement.</span><span class="sxs-lookup"><span data-stu-id="eef7a-183">These methods replace all of hello blocks in hello blob, causing your base blob and its snapshots toodiverge significantly.</span></span> <span data-ttu-id="eef7a-184">Au lieu de cela, les mises à jour hello plus petit nombre possible de blocs à l’aide de hello [PutBlock] [ dotnet_PutBlock] et [PutBlockList] [ dotnet_PutBlockList] méthodes.</span><span class="sxs-lookup"><span data-stu-id="eef7a-184">Instead, update hello fewest possible number of blocks by using hello [PutBlock][dotnet_PutBlock] and [PutBlockList][dotnet_PutBlockList] methods.</span></span>

### <a name="snapshot-billing-scenarios"></a><span data-ttu-id="eef7a-185">Scénarios de facturation d’instantanés</span><span class="sxs-lookup"><span data-stu-id="eef7a-185">Snapshot billing scenarios</span></span>
<span data-ttu-id="eef7a-186">Hello les scénarios suivants illustrent l’augmentation des coûts pour un objet blob de blocs et de ses instantanés.</span><span class="sxs-lookup"><span data-stu-id="eef7a-186">hello following scenarios demonstrate how charges accrue for a block blob and its snapshots.</span></span>

<span data-ttu-id="eef7a-187">**Scénario 1**</span><span class="sxs-lookup"><span data-stu-id="eef7a-187">**Scenario 1**</span></span>

<span data-ttu-id="eef7a-188">Dans le scénario 1, objet blob de base hello n'a pas été mis à jour une fois l’instantané hello, frais sont donc calculés uniquement pour les blocs uniques 1, 2 et 3.</span><span class="sxs-lookup"><span data-stu-id="eef7a-188">In scenario 1, hello base blob has not been updated after hello snapshot was taken, so charges are incurred only for unique blocks 1, 2, and 3.</span></span>

![Ressources Azure Storage](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-1.png)

<span data-ttu-id="eef7a-190">**Scénario 2**</span><span class="sxs-lookup"><span data-stu-id="eef7a-190">**Scenario 2**</span></span>

<span data-ttu-id="eef7a-191">Dans le scénario 2, objet blob de base hello a été mis à jour, mais les instantanés hello ne sont pas.</span><span class="sxs-lookup"><span data-stu-id="eef7a-191">In scenario 2, hello base blob has been updated, but hello snapshot has not.</span></span> <span data-ttu-id="eef7a-192">Le bloc 3 a été mis à jour et bien qu’il contienne hello les mêmes données et hello même ID, il est non hello même bloc 3 de l’instantané d’hello.</span><span class="sxs-lookup"><span data-stu-id="eef7a-192">Block 3 was updated, and even though it contains hello same data and hello same ID, it is not hello same as block 3 in hello snapshot.</span></span> <span data-ttu-id="eef7a-193">Par conséquent, le compte de hello est facturé pour quatre blocs.</span><span class="sxs-lookup"><span data-stu-id="eef7a-193">As a result, hello account is charged for four blocks.</span></span>

![Ressources Azure Storage](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-2.png)

<span data-ttu-id="eef7a-195">**Scénario 3**</span><span class="sxs-lookup"><span data-stu-id="eef7a-195">**Scenario 3**</span></span>

<span data-ttu-id="eef7a-196">Dans le scénario 3, objet blob de base hello a été mis à jour, mais les instantanés hello ne sont pas.</span><span class="sxs-lookup"><span data-stu-id="eef7a-196">In scenario 3, hello base blob has been updated, but hello snapshot has not.</span></span> <span data-ttu-id="eef7a-197">Le bloc 3 a été remplacé par le bloc 4 dans l’objet blob de base hello, mais l’instantané d’hello reflète toujours le bloc 3.</span><span class="sxs-lookup"><span data-stu-id="eef7a-197">Block 3 was replaced with block 4 in hello base blob, but hello snapshot still reflects block 3.</span></span> <span data-ttu-id="eef7a-198">Par conséquent, le compte de hello est facturé pour quatre blocs.</span><span class="sxs-lookup"><span data-stu-id="eef7a-198">As a result, hello account is charged for four blocks.</span></span>

![Ressources Azure Storage](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-3.png)

<span data-ttu-id="eef7a-200">**Scénario 4**</span><span class="sxs-lookup"><span data-stu-id="eef7a-200">**Scenario 4**</span></span>

<span data-ttu-id="eef7a-201">Dans le scénario 4, objet blob de base hello a été complètement mis à jour et ne contient aucun de ses blocs d’origine.</span><span class="sxs-lookup"><span data-stu-id="eef7a-201">In scenario 4, hello base blob has been completely updated and contains none of its original blocks.</span></span> <span data-ttu-id="eef7a-202">Par conséquent, compte de hello est facturé pour toutes les huit blocs uniques.</span><span class="sxs-lookup"><span data-stu-id="eef7a-202">As a result, hello account is charged for all eight unique blocks.</span></span> <span data-ttu-id="eef7a-203">Ce scénario peut se produire si vous utilisez une méthode de mise à jour comme [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [ UploadFromStream][dotnet_UploadFromStream], ou [UploadFromByteArray][dotnet_UploadFromByteArray], car ces méthodes remplacent tout contenu hello d’un objet blob.</span><span class="sxs-lookup"><span data-stu-id="eef7a-203">This scenario can occur if you are using an update method such as [UploadFromFile][dotnet_UploadFromFile], [UploadText][dotnet_UploadText], [UploadFromStream][dotnet_UploadFromStream], or [UploadFromByteArray][dotnet_UploadFromByteArray], because these methods replace all of hello contents of a blob.</span></span>

![Ressources Azure Storage](./media/storage-blob-snapshots/storage-blob-snapshots-billing-scenario-4.png)

## <a name="next-steps"></a><span data-ttu-id="eef7a-205">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="eef7a-205">Next steps</span></span>

* <span data-ttu-id="eef7a-206">Vous trouverez plus d’informations sur l’utilisation des captures instantanées de disque de machine virtuelle (VM) dans [Sauvegarder les disques de machines virtuelles Azure non gérés avec des captures instantanées incrémentielles](../../virtual-machines/windows/incremental-snapshots.md)</span><span class="sxs-lookup"><span data-stu-id="eef7a-206">You can find more information about working with virtual machine (VM) disk snapshots in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md)</span></span>

* <span data-ttu-id="eef7a-207">Pour obtenir des exemples de code supplémentaires d’utilisation du Stockage Blob, consultez [Exemples de code Azure](https://azure.microsoft.com/documentation/samples/?service=storage&term=blob).</span><span class="sxs-lookup"><span data-stu-id="eef7a-207">For additional code examples using Blob storage, see [Azure Code Samples](https://azure.microsoft.com/documentation/samples/?service=storage&term=blob).</span></span> <span data-ttu-id="eef7a-208">Vous pouvez télécharger un exemple d’application et exécutez-le ou parcourir le code hello sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="eef7a-208">You can download a sample application and run it, or browse hello code on GitHub.</span></span>

[dotnet_AccessCondition]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.accesscondition.aspx
[dotnet_CloudBlockBlob]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.aspx
[dotnet_CreateSnapshotAsync]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.createsnapshotasync.aspx
[dotnet_HTTPStatusCode]: https://msdn.microsoft.com/library/system.net.httpstatuscode(v=vs.110).aspx
[dotnet_PutBlockList]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.putblocklist.aspx
[dotnet_PutBlock]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.putblock.aspx
[dotnet_UploadFromByteArray]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadfrombytearray.aspx
[dotnet_UploadFromFile]: https://msdn.microsoft.com/library/azure/mt705654.aspx
[dotnet_UploadFromStream]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadfromstream.aspx
[dotnet_UploadText]: https://msdn.microsoft.com/library/azure/microsoft.windowsazure.storage.blob.cloudblockblob.uploadtext.aspx