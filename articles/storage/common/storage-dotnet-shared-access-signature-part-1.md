---
title: "Utilisation des signatures d’accès partagé (SAP) dans le stockage Azure | Microsoft Docs"
description: "Apprenez à utiliser des signatures d’accès partagé (SAP) pour déléguer l’accès aux ressources de stockage Azure, notamment les objets blob, les files d’attente, les tables et les fichiers."
services: storage
documentationcenter: 
author: mmacy
manager: timlt
editor: tysonn
ms.assetid: 46fd99d7-36b3-4283-81e3-f214b29f1152
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 04/18/2017
ms.author: marsma
ms.openlocfilehash: a753fd481c9f91d94b6a2bd3633142e2dddedaec
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="using-shared-access-signatures-sas"></a><span data-ttu-id="6f3b0-103">Utilisation des signatures d’accès partagé (SAP)</span><span class="sxs-lookup"><span data-stu-id="6f3b0-103">Using shared access signatures (SAS)</span></span>

<span data-ttu-id="6f3b0-104">Une signature d’accès partagé (SAP) constitue un moyen d’octroyer aux autres clients un accès limité aux objets dans votre compte de stockage, sans exposer votre clé de compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-104">A shared access signature (SAS) provides you with a way to grant limited access to objects in your storage account to other clients, without exposing your account key.</span></span> <span data-ttu-id="6f3b0-105">Dans cet article, nous vous présentons un aperçu du modèle SAP, passons en revue les bonnes pratiques concernant les signatures d’accès partagé et examinons quelques exemples.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-105">In this article, we provide an overview of the SAS model, review SAS best practices, and look at some examples.</span></span>

<span data-ttu-id="6f3b0-106">Pour obtenir d’autres exemples de code utilisant la SAP, consultez la page [Azure Blob Storage Samples for .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/) (Exemples de stockage Blob Azure pour .NET). Pour d’autres exemples, consultez la bibliothèque [Exemples de code Azure](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-106">For additional code examples using SAS beyond those presented here, see [Getting Started with Azure Blob Storage in .NET](https://azure.microsoft.com/documentation/samples/storage-blob-dotnet-getting-started/) and other samples available in the [Azure Code Samples](https://azure.microsoft.com/documentation/samples/?service=storage) library.</span></span> <span data-ttu-id="6f3b0-107">Vous pouvez télécharger des exemples d’application et les exécuter ou parcourir le code sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-107">You can download the sample applications and run them, or browse the code on GitHub.</span></span>

## <a name="what-is-a-shared-access-signature"></a><span data-ttu-id="6f3b0-108">Présentation de la signature d’accès partagé</span><span class="sxs-lookup"><span data-stu-id="6f3b0-108">What is a shared access signature?</span></span>
<span data-ttu-id="6f3b0-109">Une signature d'accès partagé fournit un accès délégué aux ressources de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-109">A shared access signature provides delegated access to resources in your storage account.</span></span> <span data-ttu-id="6f3b0-110">Avec une signature d’accès partagé, vous pouvez accorder aux clients l’accès aux ressources dans votre compte de stockage sans partager les clés de votre compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-110">With a SAS, you can grant clients access to resources in your storage account, without sharing your account keys.</span></span> <span data-ttu-id="6f3b0-111">C’est tout l’intérêt d’utiliser des signatures d’accès partagé dans vos applications : une SAP est un moyen sécurisé de partager vos ressources de stockage sans compromettre vos clés de compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-111">This is the key point of using shared access signatures in your applications--a SAS is a secure way to share your storage resources without compromising your account keys.</span></span>

[!INCLUDE [storage-account-key-note-include](../../../includes/storage-account-key-note-include.md)]

<span data-ttu-id="6f3b0-112">Une SAP vous donne un contrôle précis sur le type d’accès que vous accordez aux clients qui disposent de la SAP, notamment :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-112">A SAS gives you granular control over the type of access you grant to clients who have the SAS, including:</span></span>

* <span data-ttu-id="6f3b0-113">L’intervalle pendant lequel la SAP est valide, y compris l’heure de début et l’heure d’expiration.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-113">The interval over which the SAS is valid, including the start time and the expiry time.</span></span>
* <span data-ttu-id="6f3b0-114">Les autorisations accordées par la SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-114">The permissions granted by the SAS.</span></span> <span data-ttu-id="6f3b0-115">Par exemple, une SAP pour un objet blob peut accorder des autorisations en lecture et en écriture sur cet objet blob, mais pas d’autorisations de suppression.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-115">For example, a SAS for a blob might grant read and write permissions to that blob, but not delete permissions.</span></span>
* <span data-ttu-id="6f3b0-116">Une adresse IP ou plage d’adresses IP facultative à partir de laquelle le stockage Azure acceptera la signature d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-116">An optional IP address or range of IP addresses from which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="6f3b0-117">Par exemple, vous pouvez spécifier une plage d’adresses IP appartenant à votre organisation.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-117">For example, you might specify a range of IP addresses belonging to your organization.</span></span>
* <span data-ttu-id="6f3b0-118">Le protocole sur lequel le stockage Azure acceptera la SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-118">The protocol over which Azure Storage will accept the SAS.</span></span> <span data-ttu-id="6f3b0-119">Vous pouvez utiliser ce paramètre facultatif pour restreindre l’accès aux clients à l’aide de HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-119">You can use this optional parameter to restrict access to clients using HTTPS.</span></span>

## <a name="when-should-you-use-a-shared-access-signature"></a><span data-ttu-id="6f3b0-120">Quand devez-vous utiliser une signature d’accès partagé ?</span><span class="sxs-lookup"><span data-stu-id="6f3b0-120">When should you use a shared access signature?</span></span>
<span data-ttu-id="6f3b0-121">Vous pouvez utiliser une signature d’accès partagé quand vous voulez fournir un accès aux ressources dans votre compte de stockage à un client qui ne dispose pas des clés d’accès de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-121">You can use a SAS when you want to provide access to resources in your storage account to any client not possessing your storage account's access keys.</span></span> <span data-ttu-id="6f3b0-122">Votre compte de stockage inclut une clé d’accès primaire et une clé d’accès secondaire, qui octroient toutes deux un accès administratif à votre compte et à toutes les ressources qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-122">Your storage account includes both a primary and secondary access key, both of which grant administrative access to your account, and all resources within it.</span></span> <span data-ttu-id="6f3b0-123">En exposant l’une ou l’autre de ces clés, vous courez le risque d’une utilisation malveillante ou négligente de votre compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-123">Exposing either of these keys opens your account to the possibility of malicious or negligent use.</span></span> <span data-ttu-id="6f3b0-124">Les signatures d’accès partagé offrent une alternative sûre qui permet aux clients de lire, d’écrire et de supprimer des données dans votre compte de stockage en fonction des autorisations que vous avez explicitement octroyées, sans avoir besoin d’une clé du compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-124">Shared access signatures provide a safe alternative that allows clients to read, write, and delete data in your storage account according to the permissions you've explicitly granted, and without need for an account key.</span></span>

<span data-ttu-id="6f3b0-125">Un service où les utilisateurs lisent et écrivent leurs propres données dans votre compte de stockage correspond à un scénario courant dans lequel une signature d'accès partagé peut s'avérer utile.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-125">A common scenario where a SAS is useful is a service where users read and write their own data to your storage account.</span></span> <span data-ttu-id="6f3b0-126">Dans un scénario où un compte de stockage stocke les données utilisateur, il existe deux modèles de conception types :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-126">In a scenario where a storage account stores user data, there are two typical design patterns:</span></span>

1. <span data-ttu-id="6f3b0-127">Les clients chargent et téléchargent les données par le biais d’un service proxy frontal, qui se charge de l’authentification.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-127">Clients upload and download data via a front-end proxy service, which performs authentication.</span></span> <span data-ttu-id="6f3b0-128">Ce service présente l'avantage de permettre la validation des règles métier, mais pour de grosses quantités de données ou des transactions à haut volume, la création d'un service qui peut être mis à l'échelle en fonction de la demande peut se révéler coûteuse ou difficile.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-128">This front-end proxy service has the advantage of allowing validation of business rules, but for large amounts of data or high-volume transactions, creating a service that can scale to match demand may be expensive or difficult.</span></span>

  ![Schéma du scénario : service proxy frontal](./media/storage-dotnet-shared-access-signature-part-1/sas-storage-fe-proxy-service.png)   

1. <span data-ttu-id="6f3b0-130">Un service léger authentifie le client en fonction des besoins, puis génère une signature d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-130">A lightweight service authenticates the client as needed and then generates a SAS.</span></span> <span data-ttu-id="6f3b0-131">Une fois que le client reçoit la signature, il peut accéder aux ressources du compte de stockage directement avec les autorisations définies par la signature d'accès partagé et pendant l'intervalle autorisé par cette dernière.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-131">Once the client receives the SAS, they can access storage account resources directly with the permissions defined by the SAS and for the interval allowed by the SAS.</span></span> <span data-ttu-id="6f3b0-132">La signature d'accès partagé atténue la nécessité du routage de toutes les données via le service proxy frontal.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-132">The SAS mitigates the need for routing all data through the front-end proxy service.</span></span>

  ![Schéma du scénario : service du fournisseur SAP](./media/storage-dotnet-shared-access-signature-part-1/sas-storage-provider-service.png)   

<span data-ttu-id="6f3b0-134">De nombreux services réels peuvent utiliser un mélange de ces deux approches.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-134">Many real-world services may use a hybrid of these two approaches.</span></span> <span data-ttu-id="6f3b0-135">Par exemple, certaines données peuvent être traitées et validées via le proxy frontal, tandis que les autres données sont enregistrées et/ou lues directement à l’aide de SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-135">For example, some data might be processed and validated via the front-end proxy, while other data is saved and/or read directly using SAS.</span></span>

<span data-ttu-id="6f3b0-136">En outre, vous devez utiliser une SAP pour authentifier l’objet source d’une opération de copie, dans certains cas de figure :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-136">Additionally, you will need to use a SAS to authenticate the source object in a copy operation in certain scenarios:</span></span>

* <span data-ttu-id="6f3b0-137">Lorsque vous copiez un objet blob dans un autre objet blob qui réside dans un autre compte de stockage, vous devez utiliser une SAP pour authentifier l’objet blob source.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-137">When you copy a blob to another blob that resides in a different storage account, you must use a SAS to authenticate the source blob.</span></span> <span data-ttu-id="6f3b0-138">Vous pouvez éventuellement utiliser une SAP pour authentifier également l’objet blob de destination.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-138">You can optionally use a SAS to authenticate the destination blob as well.</span></span>
* <span data-ttu-id="6f3b0-139">Lorsque vous copiez un objet blob dans un autre fichier qui réside dans un autre compte de stockage, vous devez utiliser une SAP pour authentifier le fichier source.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-139">When you copy a file to another file that resides in a different storage account, you must use a SAS to authenticate the source file.</span></span> <span data-ttu-id="6f3b0-140">Vous pouvez éventuellement utiliser une SAP pour authentifier également le fichier de destination.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-140">You can optionally use a SAS to authenticate the destination file as well.</span></span>
* <span data-ttu-id="6f3b0-141">Lorsque vous copiez un objet blob dans un fichier ou un fichier dans un objet blob, vous devez utiliser une SAP pour authentifier l’objet source, même si les objets source et de destination résident dans le même compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-141">When you copy a blob to a file, or a file to a blob, you must use a SAS to authenticate the source object, even if the source and destination objects reside within the same storage account.</span></span>

## <a name="types-of-shared-access-signatures"></a><span data-ttu-id="6f3b0-142">Types de signatures d’accès partagé</span><span class="sxs-lookup"><span data-stu-id="6f3b0-142">Types of shared access signatures</span></span>
<span data-ttu-id="6f3b0-143">Vous pouvez créer deux types de signatures d’accès partagé :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-143">You can create two types of shared access signatures:</span></span>

* <span data-ttu-id="6f3b0-144">**SAP de service.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-144">**Service SAS.**</span></span> <span data-ttu-id="6f3b0-145">Une SAP de service délègue l’accès à une ressource d’un seul des services de stockage : le service blob, de file d’attente, de table ou de fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-145">The service SAS delegates access to a resource in just one of the storage services: the Blob, Queue, Table, or File service.</span></span> <span data-ttu-id="6f3b0-146">Pour obtenir des informations détaillées sur la construction du jeton de SAP de service, consultez les pages [Construction d’une SAP de service](https://msdn.microsoft.com/library/dn140255.aspx) et [Exemples de SAP de service](https://msdn.microsoft.com/library/dn140256.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-146">See [Constructing a Service SAS](https://msdn.microsoft.com/library/dn140255.aspx) and [Service SAS Examples](https://msdn.microsoft.com/library/dn140256.aspx) for in-depth information about constructing the service SAS token.</span></span>
* <span data-ttu-id="6f3b0-147">**SAP de compte.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-147">**Account SAS.**</span></span> <span data-ttu-id="6f3b0-148">La SAP de compte délègue l’accès aux ressources d’un ou plusieurs des services de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-148">The account SAS delegates access to resources in one or more of the storage services.</span></span> <span data-ttu-id="6f3b0-149">Toutes les opérations disponibles via une SAP de service sont également disponibles via une SAP de compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-149">All of the operations available via a service SAS are also available via an account SAS.</span></span> <span data-ttu-id="6f3b0-150">En outre, avec la SAP de compte, vous pouvez déléguer l’accès à des opérations qui s’appliquent à un service donné, telles que **Get/Set Service Properties** et **Get Service Stats**. Vous pouvez également déléguer l'accès aux opérations de lecture, d’écriture et de suppression sur les conteneurs d'objets blob, les tables, les files d'attente et les partages de fichiers qui ne sont pas autorisées avec une SAP de service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-150">Additionally, with the account SAS, you can delegate access to operations that apply to a given service, such as **Get/Set Service Properties** and **Get Service Stats**. You can also delegate access to read, write, and delete operations on blob containers, tables, queues, and file shares that are not permitted with a service SAS.</span></span> <span data-ttu-id="6f3b0-151">Pour obtenir des informations détaillées sur la construction du jeton SAP de compte, consultez la page [Construction d’une SAP de compte](https://msdn.microsoft.com/library/mt584140.aspx).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-151">See [Constructing an Account SAS](https://msdn.microsoft.com/library/mt584140.aspx) for in-depth information about constructing the account SAS token.</span></span>

## <a name="how-a-shared-access-signature-works"></a><span data-ttu-id="6f3b0-152">Fonctionnement d’une signature d’accès partagé</span><span class="sxs-lookup"><span data-stu-id="6f3b0-152">How a shared access signature works</span></span>
<span data-ttu-id="6f3b0-153">Une signature d’accès partagé est un URI signé qui désigne une ou plusieurs ressources de stockage et inclut un jeton qui contient un ensemble spécial de paramètres de requête.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-153">A shared access signature is a signed URI that points to one or more storage resources and includes a token that contains a special set of query parameters.</span></span> <span data-ttu-id="6f3b0-154">Le jeton indique comment le client peut accéder aux ressources.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-154">The token indicates how the resources may be accessed by the client.</span></span> <span data-ttu-id="6f3b0-155">L’un des paramètres de requête, la signature, est construit à partir des paramètres de signature d’accès partagé et signé avec la clé du compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-155">One of the query parameters, the signature, is constructed from the SAS parameters and signed with the account key.</span></span> <span data-ttu-id="6f3b0-156">Cette signature est utilisée par Azure Storage pour authentifier la signature d'accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-156">This signature is used by Azure Storage to authenticate the SAS.</span></span>

<span data-ttu-id="6f3b0-157">Voici un exemple d’URI de SAP, montrant l’URI de la ressource et le jeton de la SAP :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-157">Here's an example of a SAS URI, showing the resource URI and the SAS token:</span></span>

![Composants d’un URI SAP](./media/storage-dotnet-shared-access-signature-part-1/sas-storage-uri.png)   

<span data-ttu-id="6f3b0-159">Le jeton de la SAP est une chaîne que vous générez côté *client* (consultez la section [Exemples de SAP](#sas-examples) pour obtenir des exemples de code).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-159">The SAS token is a string you generate on the *client* side (see the [SAS examples](#sas-examples) section for code examples).</span></span> <span data-ttu-id="6f3b0-160">Un jeton de la SAP que vous générez avec la bibliothèque cliente de stockage, par exemple, n’est pas suivi par le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-160">A SAS token you generate with the storage client library, for example, is not tracked by Azure Storage in any way.</span></span> <span data-ttu-id="6f3b0-161">Vous pouvez créer un nombre illimité de jetons de SAP côté client.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-161">You can create an unlimited number of SAS tokens on the client side.</span></span>

<span data-ttu-id="6f3b0-162">Lorsqu’un client fournit un URI de SAP au stockage Azure dans le cadre d’une demande, le service vérifie les paramètres et la signature de la SAP pour s’assurer que celle-ci est valide pour authentifier la demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-162">When a client provides a SAS URI to Azure Storage as part of a request, the service checks the SAS parameters and signature to verify that it is valid for authenticating the request.</span></span> <span data-ttu-id="6f3b0-163">Si le service vérifie que la signature est valide, la demande est authentifiée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-163">If the service verifies that the signature is valid, then the request is authenticated.</span></span> <span data-ttu-id="6f3b0-164">Dans le cas contraire, la demande est refusée avec le code d’erreur 403 (Interdit).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-164">Otherwise, the request is declined with error code 403 (Forbidden).</span></span>

## <a name="shared-access-signature-parameters"></a><span data-ttu-id="6f3b0-165">Paramètres de la signature d’accès partagé (SAP)</span><span class="sxs-lookup"><span data-stu-id="6f3b0-165">Shared access signature parameters</span></span>
<span data-ttu-id="6f3b0-166">Les jetons de SAP de compte et de SAP de service incluent des paramètres communs et également quelques paramètres différents.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-166">The account SAS and service SAS tokens include some common parameters, and also take a few parameters that that are different.</span></span>

### <a name="parameters-common-to-account-sas-and-service-sas-tokens"></a><span data-ttu-id="6f3b0-167">Paramètres communs aux jetons de SAP de compte et de SAP de service</span><span class="sxs-lookup"><span data-stu-id="6f3b0-167">Parameters common to account SAS and service SAS tokens</span></span>
* <span data-ttu-id="6f3b0-168">**Version de l’API.** Paramètre facultatif qui spécifie la version du service de stockage à utiliser pour exécuter la demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-168">**Api version** An optional parameter that specifies the storage service version to use to execute the request.</span></span>
* <span data-ttu-id="6f3b0-169">**Version du service.** Paramètre obligatoire qui spécifie la version du service de stockage à utiliser pour authentifier la demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-169">**Service version** A required parameter that specifies the storage service version to use to authenticate the request.</span></span>
* <span data-ttu-id="6f3b0-170">**Heure de début.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-170">**Start time.**</span></span> <span data-ttu-id="6f3b0-171">Il s'agit de l'heure à laquelle la signature d'accès partagé devient valide.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-171">This is the time at which the SAS becomes valid.</span></span> <span data-ttu-id="6f3b0-172">L’heure de début pour une signature d’accès partagé est facultative.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-172">The start time for a shared access signature is optional.</span></span> <span data-ttu-id="6f3b0-173">Si elle est omise, la signature d’accès partagé prend effet immédiatement.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-173">If a start time is omitted, the SAS is effective immediately.</span></span> <span data-ttu-id="6f3b0-174">L’heure de début doit être exprimée en temps universel coordonné (UTC), par un indicateur UTC spécial (« Z »), par exemple `1994-11-05T13:15:30Z`.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-174">The start time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z`.</span></span>
* <span data-ttu-id="6f3b0-175">**Heure d’expiration.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-175">**Expiry time.**</span></span> <span data-ttu-id="6f3b0-176">Il s'agit de l'heure à laquelle la signature d'accès partagé cesse d'être valide.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-176">This is the time after which the SAS is no longer valid.</span></span> <span data-ttu-id="6f3b0-177">Les meilleures pratiques recommandent soit de spécifier une heure d’expiration pour une signature d’accès partagé, soit de l’associer à une stratégie d’accès stockée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-177">Best practices recommend that you either specify an expiry time for a SAS, or associate it with a stored access policy.</span></span> <span data-ttu-id="6f3b0-178">L’heure d’expiration doit être exprimée en temps universel coordonné (UTC), par un indicateur UTC spécial (« Z »), par exemple `1994-11-05T13:15:30Z` (voir détails ci-dessous).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-178">The expiry time must be expressed in UTC (Coordinated Universal Time), with a special UTC designator ("Z"), for example `1994-11-05T13:15:30Z` (see more below).</span></span>
* <span data-ttu-id="6f3b0-179">**Autorisations.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-179">**Permissions.**</span></span> <span data-ttu-id="6f3b0-180">Les autorisations spécifiées sur la signature d'accès partagé indiquent quelles opérations le client peut exécuter avec cette dernière sur la ressource de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-180">The permissions specified on the SAS indicate what operations the client can perform against the storage resource using the SAS.</span></span> <span data-ttu-id="6f3b0-181">Les autorisations disponibles ne sont pas les mêmes pour une SAP de compte et une SAP de service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-181">Available permissions differ for an account SAS and a service SAS.</span></span>
* <span data-ttu-id="6f3b0-182">**IP.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-182">**IP.**</span></span> <span data-ttu-id="6f3b0-183">Paramètre facultatif qui spécifie une adresse IP ou une plage d’adresses IP en dehors d’Azure en provenance de laquelle accepter les demandes (consultez la section [État de configuration d’une session de routage](../../expressroute/expressroute-workflows.md#routing-session-configuration-state) pour ExpressRoute).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-183">An optional parameter that specifies an IP address or a range of IP addresses outside of Azure (see the section [Routing session configuration state](../../expressroute/expressroute-workflows.md#routing-session-configuration-state) for Express Route) from which to accept requests.</span></span>
* <span data-ttu-id="6f3b0-184">**Protocole.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-184">**Protocol.**</span></span> <span data-ttu-id="6f3b0-185">Paramètre facultatif qui spécifie le protocole autorisé pour une demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-185">An optional parameter that specifies the protocol permitted for a request.</span></span> <span data-ttu-id="6f3b0-186">Les valeurs possibles sont HTTPS et HTTP à la fois (`https,http`), qui est la valeur par défaut, ou HTTPS uniquement (`https`).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-186">Possible values are both HTTPS and HTTP (`https,http`), which is the default value, or HTTPS only (`https`).</span></span> <span data-ttu-id="6f3b0-187">Notez que HTTP uniquement n’est pas une valeur autorisée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-187">Note that HTTP only is not a permitted value.</span></span>
* <span data-ttu-id="6f3b0-188">**Signature.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-188">**Signature.**</span></span> <span data-ttu-id="6f3b0-189">La signature est construite à partir des autres paramètres spécifiés pour le jeton, puis chiffrée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-189">The signature is constructed from the other parameters specified as part token and then encrypted.</span></span> <span data-ttu-id="6f3b0-190">Elle est utilisée pour authentifier la SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-190">It's used to authenticate the SAS.</span></span>

### <a name="parameters-for-a-service-sas-token"></a><span data-ttu-id="6f3b0-191">Paramètres d’un jeton de SAP de service</span><span class="sxs-lookup"><span data-stu-id="6f3b0-191">Parameters for a service SAS token</span></span>
* <span data-ttu-id="6f3b0-192">**Ressource de stockage.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-192">**Storage resource.**</span></span> <span data-ttu-id="6f3b0-193">Les ressources de stockage dont vous pouvez déléguer l’accès à l’aide d’une SAP de service incluent :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-193">Storage resources for which you can delegate access with a service SAS include:</span></span>
  * <span data-ttu-id="6f3b0-194">Conteneurs et objets blob</span><span class="sxs-lookup"><span data-stu-id="6f3b0-194">Containers and blobs</span></span>
  * <span data-ttu-id="6f3b0-195">Partages de fichiers et fichiers</span><span class="sxs-lookup"><span data-stu-id="6f3b0-195">File shares and files</span></span>
  * <span data-ttu-id="6f3b0-196">Files d’attente</span><span class="sxs-lookup"><span data-stu-id="6f3b0-196">Queues</span></span>
  * <span data-ttu-id="6f3b0-197">Tables et plages d’entités de table.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-197">Tables and ranges of table entities.</span></span>

### <a name="parameters-for-an-account-sas-token"></a><span data-ttu-id="6f3b0-198">Paramètres d’un jeton de compte SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-198">Parameters for an account SAS token</span></span>
* <span data-ttu-id="6f3b0-199">**Service ou services.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-199">**Service or services.**</span></span> <span data-ttu-id="6f3b0-200">Une SAP de compte peut déléguer l’accès à un ou plusieurs des services de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-200">An account SAS can delegate access to one or more of the storage services.</span></span> <span data-ttu-id="6f3b0-201">Par exemple, vous pouvez créer une SAP de compte qui délègue l’accès au service BLOB et au service de fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-201">For example, you can create an account SAS that delegates access to the Blob and File service.</span></span> <span data-ttu-id="6f3b0-202">Vous pouvez également créer une SAP qui délègue l’accès à l’ensemble des quatre services (BLOB, File d’attente, Table et fichiers).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-202">Or you can create a SAS that delegates access to all four services (Blob, Queue, Table, and File).</span></span>
* <span data-ttu-id="6f3b0-203">**Types de ressources de stockage.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-203">**Storage resource types.**</span></span> <span data-ttu-id="6f3b0-204">Une SAP de compte s’applique à une ou plusieurs classes de ressources de stockage plutôt qu’à une ressource spécifique.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-204">An account SAS applies to one or more classes of storage resources, rather than a specific resource.</span></span> <span data-ttu-id="6f3b0-205">Vous pouvez créer une SAP de compte pour déléguer l’accès à :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-205">You can create an account SAS to delegate access to:</span></span>
  * <span data-ttu-id="6f3b0-206">Des API au niveau de service, qui sont appelées sur la ressource du compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-206">Service-level APIs, which are called against the storage account resource.</span></span> <span data-ttu-id="6f3b0-207">Exemples : **Get/Set Service Properties**, **Get Service Stats** et **List Containers/Queues/Tables/Shares**.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-207">Examples include **Get/Set Service Properties**, **Get Service Stats**, and **List Containers/Queues/Tables/Shares**.</span></span>
  * <span data-ttu-id="6f3b0-208">Des API au niveau du conteneur, qui sont appelés sur les objets de conteneur pour chaque service : conteneurs d’objets blob, files d’attente, tables et partages de fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-208">Container-level APIs, which are called against the container objects for each service: blob containers, queues, tables, and file shares.</span></span> <span data-ttu-id="6f3b0-209">Exemples : **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share** et **List Blobs/Files and Directories**.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-209">Examples include **Create/Delete Container**, **Create/Delete Queue**, **Create/Delete Table**, **Create/Delete Share**, and **List Blobs/Files and Directories**.</span></span>
  * <span data-ttu-id="6f3b0-210">Des API au niveau de l’objet, qui sont appelées sur les objets blob, les messages de file d’attente, les entités de table et les fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-210">Object-level APIs, which are called against blobs, queue messages, table entities, and files.</span></span> <span data-ttu-id="6f3b0-211">Exemples : **Put Blob**, **Query Entity**, **Get Messages** et **Create File**.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-211">For example, **Put Blob**, **Query Entity**, **Get Messages**, and **Create File**.</span></span>

## <a name="examples-of-sas-uris"></a><span data-ttu-id="6f3b0-212">Exemples d’URI de SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-212">Examples of SAS URIs</span></span>

### <a name="service-sas-uri-example"></a><span data-ttu-id="6f3b0-213">Exemple d’URI SAP de service</span><span class="sxs-lookup"><span data-stu-id="6f3b0-213">Service SAS URI example</span></span>

<span data-ttu-id="6f3b0-214">Voici un exemple d’URI de SAP de service qui fournit des autorisations d’accès en lecture et en écriture sur un objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-214">Here is an example of a service SAS URI that provides read and write permissions to a blob.</span></span> <span data-ttu-id="6f3b0-215">La table décompose chaque partie de l’URI pour comprendre comment elle contribue à la signature d’accès partagé :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-215">The table breaks down each part of the URI to understand how it contributes to the SAS:</span></span>

```
https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt?sv=2015-04-05&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D
```

| <span data-ttu-id="6f3b0-216">Nom</span><span class="sxs-lookup"><span data-stu-id="6f3b0-216">Name</span></span> | <span data-ttu-id="6f3b0-217">Partie de la SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-217">SAS portion</span></span> | <span data-ttu-id="6f3b0-218">Description</span><span class="sxs-lookup"><span data-stu-id="6f3b0-218">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6f3b0-219">URI de l’objet blob</span><span class="sxs-lookup"><span data-stu-id="6f3b0-219">Blob URI</span></span> |`https://myaccount.blob.core.windows.net/sascontainer/sasblob.txt` |<span data-ttu-id="6f3b0-220">Adresse de l'objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-220">The address of the blob.</span></span> <span data-ttu-id="6f3b0-221">Notez que l'utilisation de HTTPS est fortement recommandée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-221">Note that using HTTPS is highly recommended.</span></span> |
| <span data-ttu-id="6f3b0-222">Version des services de stockage</span><span class="sxs-lookup"><span data-stu-id="6f3b0-222">Storage services version</span></span> |`sv=2015-04-05` |<span data-ttu-id="6f3b0-223">Pour la version 2012-02-12 des services de stockage et les versions ultérieures, ce paramètre indique la version à utiliser.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-223">For storage services version 2012-02-12 and later, this parameter indicates the version to use.</span></span> |
| <span data-ttu-id="6f3b0-224">Heure de début</span><span class="sxs-lookup"><span data-stu-id="6f3b0-224">Start time</span></span> |`st=2015-04-29T22%3A18%3A26Z` |<span data-ttu-id="6f3b0-225">Spécifiée en heure UTC.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-225">Specified in UTC time.</span></span> <span data-ttu-id="6f3b0-226">Si vous voulez que la signature d'accès partagé soit valide immédiatement, omettez l'heure de début.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-226">If you want the SAS to be valid immediately, omit the start time.</span></span> |
| <span data-ttu-id="6f3b0-227">Heure d’expiration</span><span class="sxs-lookup"><span data-stu-id="6f3b0-227">Expiry time</span></span> |`se=2015-04-30T02%3A23%3A26Z` |<span data-ttu-id="6f3b0-228">Spécifiée en heure UTC.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-228">Specified in UTC time.</span></span> |
| <span data-ttu-id="6f3b0-229">Ressource</span><span class="sxs-lookup"><span data-stu-id="6f3b0-229">Resource</span></span> |`sr=b` |<span data-ttu-id="6f3b0-230">La ressource est un objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-230">The resource is a blob.</span></span> |
| <span data-ttu-id="6f3b0-231">Autorisations</span><span class="sxs-lookup"><span data-stu-id="6f3b0-231">Permissions</span></span> |`sp=rw` |<span data-ttu-id="6f3b0-232">Les autorisations octroyées par la signature d'accès partagé incluent les opérations de lecture (r) et d'écriture (w).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-232">The permissions granted by the SAS include Read (r) and Write (w).</span></span> |
| <span data-ttu-id="6f3b0-233">Plage d’adresses IP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-233">IP range</span></span> |`sip=168.1.5.60-168.1.5.70` |<span data-ttu-id="6f3b0-234">Plage d’adresses IP dont les demandes seront acceptées.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-234">The range of IP addresses from which a request will be accepted.</span></span> |
| <span data-ttu-id="6f3b0-235">Protocole</span><span class="sxs-lookup"><span data-stu-id="6f3b0-235">Protocol</span></span> |`spr=https` |<span data-ttu-id="6f3b0-236">Seules les demandes utilisant HTTPS sont autorisées.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-236">Only requests using HTTPS are permitted.</span></span> |
| <span data-ttu-id="6f3b0-237">Signature</span><span class="sxs-lookup"><span data-stu-id="6f3b0-237">Signature</span></span> |`sig=Z%2FRHIX5Xcg0Mq2rqI3OlWTjEg2tYkboXr1P9ZUXDtkk%3D` |<span data-ttu-id="6f3b0-238">Utilisée pour authentifier l'accès à l'objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-238">Used to authenticate access to the blob.</span></span> <span data-ttu-id="6f3b0-239">La signature est un HMAC calculé sur une chaîne de signature et une clé à l'aide de l'algorithme SHA256, puis codé en Base64.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-239">The signature is an HMAC computed over a string-to-sign and key using the SHA256 algorithm, and then encoded using Base64 encoding.</span></span> |

### <a name="account-sas-uri-example"></a><span data-ttu-id="6f3b0-240">Exemple d’URI SAP de compte</span><span class="sxs-lookup"><span data-stu-id="6f3b0-240">Account SAS URI example</span></span>

<span data-ttu-id="6f3b0-241">Voici un exemple de SAP de compte qui utilise les mêmes paramètres communs sur le jeton.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-241">Here is an example of an account SAS that uses the same common parameters on the token.</span></span> <span data-ttu-id="6f3b0-242">Dans la mesure où ces paramètres sont décrits ci-dessus, ils ne sont pas décrits ici.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-242">Since these parameters are described above, they are not described here.</span></span> <span data-ttu-id="6f3b0-243">Seuls les paramètres propres à la SAP de compte sont décrits dans le tableau ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-243">Only the parameters that are specific to account SAS are described in the table below.</span></span>

```
https://myaccount.blob.core.windows.net/?restype=service&comp=properties&sv=2015-04-05&ss=bf&srt=s&st=2015-04-29T22%3A18%3A26Z&se=2015-04-30T02%3A23%3A26Z&sr=b&sp=rw&sip=168.1.5.60-168.1.5.70&spr=https&sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B
```

| <span data-ttu-id="6f3b0-244">Nom</span><span class="sxs-lookup"><span data-stu-id="6f3b0-244">Name</span></span> | <span data-ttu-id="6f3b0-245">Partie de la SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-245">SAS portion</span></span> | <span data-ttu-id="6f3b0-246">Description</span><span class="sxs-lookup"><span data-stu-id="6f3b0-246">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="6f3b0-247">URI de ressource</span><span class="sxs-lookup"><span data-stu-id="6f3b0-247">Resource URI</span></span> |`https://myaccount.blob.core.windows.net/?restype=service&comp=properties` |<span data-ttu-id="6f3b0-248">Point de terminaison du service BLOB, avec les paramètres d’obtention des propriétés du service (appel avec la méthode GET) ou de définition des propriétés du service (appel avec la méthode SET).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-248">The Blob service endpoint, with parameters for getting service properties (when called with GET) or setting service properties (when called with SET).</span></span> |
| <span data-ttu-id="6f3b0-249">Services</span><span class="sxs-lookup"><span data-stu-id="6f3b0-249">Services</span></span> |`ss=bf` |<span data-ttu-id="6f3b0-250">La SAP s’applique au service BLOB et au service de fichiers.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-250">The SAS applies to the Blob and File services</span></span> |
| <span data-ttu-id="6f3b0-251">Types de ressources</span><span class="sxs-lookup"><span data-stu-id="6f3b0-251">Resource types</span></span> |`srt=s` |<span data-ttu-id="6f3b0-252">La SAP s’applique aux opérations au niveau du service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-252">The SAS applies to service-level operations.</span></span> |
| <span data-ttu-id="6f3b0-253">Autorisations</span><span class="sxs-lookup"><span data-stu-id="6f3b0-253">Permissions</span></span> |`sp=rw` |<span data-ttu-id="6f3b0-254">Les autorisations accordent l’accès aux opérations de lecture et d’écriture.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-254">The permissions grant access to read and write operations.</span></span> |

<span data-ttu-id="6f3b0-255">Étant donné que les autorisations sont limitées au niveau du service, les opérations accessibles avec cette SAP sont **Get Blob Service Properties** (lecture) et **Set Blob Service Properties** (écriture).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-255">Given that permissions are restricted to the service level, accessible operations with this SAS are **Get Blob Service Properties** (read) and **Set Blob Service Properties** (write).</span></span> <span data-ttu-id="6f3b0-256">Cependant, avec un autre URI de ressource, le même jeton de SAP peut également être utilisé pour déléguer l’accès à l’opération **Get Blob Service Stats** (lecture).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-256">However, with a different resource URI, the same SAS token could also be used to delegate access to **Get Blob Service Stats** (read).</span></span>

## <a name="controlling-a-sas-with-a-stored-access-policy"></a><span data-ttu-id="6f3b0-257">Contrôle d’une SAP avec une stratégie d’accès stockée</span><span class="sxs-lookup"><span data-stu-id="6f3b0-257">Controlling a SAS with a stored access policy</span></span>
<span data-ttu-id="6f3b0-258">Une signature d’accès partagé peut prendre deux formes :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-258">A shared access signature can take one of two forms:</span></span>

* <span data-ttu-id="6f3b0-259">**Signature d’accès partagé ad hoc :** quand vous créez une signature d’accès partagé ad hoc, l’heure de début, l’heure d’expiration et les autorisations associées à cette signature sont spécifiées dans l’URI SAP (ou sont implicites, dans le cas où l’heure de début est omise).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-259">**Ad hoc SAS:** When you create an ad hoc SAS, the start time, expiry time, and permissions for the SAS are all specified in the SAS URI (or implied, in the case where start time is omitted).</span></span> <span data-ttu-id="6f3b0-260">Ce type de SAP peut être créé en tant que SAP de compte ou SAP de service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-260">This type of SAS can be created as an account SAS or a service SAS.</span></span>
* <span data-ttu-id="6f3b0-261">**Signature d’accès partagé avec stratégie d’accès stockée :** une stratégie d’accès stockée est définie sur un conteneur de ressources (conteneur d’objets blob, table, file d’attente ou partage de fichiers) et permet de gérer les contraintes d’une ou de plusieurs signatures d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-261">**SAS with stored access policy:** A stored access policy is defined on a resource container--a blob container, table, queue, or file share--and can be used to manage constraints for one or more shared access signatures.</span></span> <span data-ttu-id="6f3b0-262">Quand vous associez une signature d’accès partagé à une stratégie d’accès stockée, la signature hérite des contraintes (heure de début, heure d’expiration et autorisations) définies pour la stratégie.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-262">When you associate a SAS with a stored access policy, the SAS inherits the constraints--the start time, expiry time, and permissions--defined for the stored access policy.</span></span>

> [!NOTE]
> <span data-ttu-id="6f3b0-263">À l’heure actuelle, une SAP de compte doit être une SAP ad hoc.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-263">Currently, an account SAS must be an ad hoc SAS.</span></span> <span data-ttu-id="6f3b0-264">Les stratégies d’accès stockées ne sont pas encore prises en charge pour les SAP de compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-264">Stored access policies are not yet supported for account SAS.</span></span>

<span data-ttu-id="6f3b0-265">La différence entre les deux formes est importante pour un scénario clé : la révocation.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-265">The difference between the two forms is important for one key scenario: revocation.</span></span> <span data-ttu-id="6f3b0-266">Comme un URI SAP est une URL, toute personne qui obtient la signature d’accès partagé peut s’en servir, quel que soit celui qui l’a créée initialement.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-266">Because a SAS URI is a URL, anyone that obtains the SAS can use it, regardless of who originally created it.</span></span> <span data-ttu-id="6f3b0-267">Si une SAP est publiée publiquement, elle peut être utilisée par n’importe qui.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-267">If a SAS is published publicly, it can be used by anyone in the world.</span></span> <span data-ttu-id="6f3b0-268">Une signature d’accès partagé accorde l’accès aux ressources à toute personne qui la possède jusqu’à ce que l’un des quatre événements suivants ait lieu :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-268">A SAS grants access to resources to anyone possessing it until one of four things happens:</span></span>

1. <span data-ttu-id="6f3b0-269">L'heure d'expiration spécifiée sur la signature d'accès partagé est atteinte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-269">The expiry time specified on the SAS is reached.</span></span>
2. <span data-ttu-id="6f3b0-270">L'heure d'expiration spécifiée sur la stratégie d'accès stockée référencée par la signature d'accès partagé est atteinte (si une stratégie d'accès stockée est référencée et si elle spécifie une heure d'expiration).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-270">The expiry time specified on the stored access policy referenced by the SAS is reached (if a stored access policy is referenced, and if it specifies an expiry time).</span></span> <span data-ttu-id="6f3b0-271">Cela peut arriver soit parce que l’intervalle s’est écoulé, soit parce que vous avez modifié la stratégie d’accès stockée pour définir une heure d’expiration dans le passé, ce qui est une manière de révoquer la signature d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-271">This can occur either because the interval elapses, or because you've modified the stored access policy with an expiry time in the past, which is one way to revoke the SAS.</span></span>
3. <span data-ttu-id="6f3b0-272">La stratégie d'accès stockée référencée par la signature d'accès partagé est supprimée, ce qui est une autre manière de révoquer la signature d'accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-272">The stored access policy referenced by the SAS is deleted, which is another way to revoke the SAS.</span></span> <span data-ttu-id="6f3b0-273">Notez que si vous recréez la stratégie d'accès stockée avec exactement le même nom, tous les jetons de signature d'accès partagé existants seront de nouveau valides en fonction des autorisations associées à cette stratégie d'accès stockée (en partant du principe que l'heure d'expiration sur la signature d'accès partagé n'est pas passée).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-273">Note that if you recreate the stored access policy with exactly the same name, all existing SAS tokens will again be valid according to the permissions associated with that stored access policy (assuming that the expiry time on the SAS has not passed).</span></span> <span data-ttu-id="6f3b0-274">Si vous avez l'intention de révoquer la signature d'accès partagé, veillez à utiliser un nom différent si vous recréez la stratégie d'accès avec une heure d'expiration située dans le futur.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-274">If you are intending to revoke the SAS, be sure to use a different name if you recreate the access policy with an expiry time in the future.</span></span>
4. <span data-ttu-id="6f3b0-275">La clé de compte qui a été utilisée pour créer la signature d'accès partagé est régénérée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-275">The account key that was used to create the SAS is regenerated.</span></span> <span data-ttu-id="6f3b0-276">La regénération d’une clé de compte provoquera l’échec de l’authentification de tous les composants de l’application qui utilisent cette clé jusqu’à ce qu’ils soient mis à jour afin d’utiliser l’autre clé de compte valide ou la clé de compte nouvellement regénérée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-276">Regenerating an account key will cause all application components using that key to fail to authenticate until they're updated to use either the other valid account key or the newly regenerated account key.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6f3b0-277">L’URI d’une signature d’accès partagé est associé à la clé du compte utilisée pour créer la signature et à la stratégie d’accès stockée correspondante (le cas échéant).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-277">A shared access signature URI is associated with the account key used to create the signature, and the associated stored access policy (if any).</span></span> <span data-ttu-id="6f3b0-278">Si aucune stratégie d’accès stockée n’est spécifiée, la seule façon de révoquer une signature d’accès partagé consiste à modifier la clé du compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-278">If no stored access policy is specified, the only way to revoke a shared access signature is to change the account key.</span></span>

## <a name="authenticating-from-a-client-application-with-a-sas"></a><span data-ttu-id="6f3b0-279">Authentification à partir d’une application cliente avec la SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-279">Authenticating from a client application with a SAS</span></span>
<span data-ttu-id="6f3b0-280">Un client qui est en possession d’une SAP peut l’utiliser pour authentifier une demande sur un compte de stockage pour lequel il ne possède pas les clés de compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-280">A client who is in possession of a SAS can use the SAS to authenticate a request against a storage account for which they do not possess the account keys.</span></span> <span data-ttu-id="6f3b0-281">Une SAP peut être incluse dans une chaîne de connexion ou utilisée directement à partir de la méthode ou du constructeur approprié(e).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-281">A SAS can be included in a connection string, or used directly from the appropriate constructor or method.</span></span>

### <a name="using-a-sas-in-a-connection-string"></a><span data-ttu-id="6f3b0-282">Utilisation d’une SAP dans une chaîne de connexion</span><span class="sxs-lookup"><span data-stu-id="6f3b0-282">Using a SAS in a connection string</span></span>
[!INCLUDE [storage-use-sas-in-connection-string-include](../../../includes/storage-use-sas-in-connection-string-include.md)]

### <a name="using-a-sas-in-a-constructor-or-method"></a><span data-ttu-id="6f3b0-283">Utilisation d’une SAP dans un constructeur ou une méthode</span><span class="sxs-lookup"><span data-stu-id="6f3b0-283">Using a SAS in a constructor or method</span></span>
<span data-ttu-id="6f3b0-284">Plusieurs surcharges de méthodes et constructeurs de bibliothèques clientes du Stockage Azure offrent un paramètre SAP, afin de vous permettre d’authentifier une demande au service avec une SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-284">Several Azure Storage client library constructors and method overloads offer a SAS parameter, so that you can authenticate a request to the service with a SAS.</span></span>

<span data-ttu-id="6f3b0-285">Ici, par exemple, un URI de SAP est utilisé pour créer une référence à un objet blob de blocs.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-285">For example, here a SAS URI is used to create a reference to a block blob.</span></span> <span data-ttu-id="6f3b0-286">La SAP fournit uniquement les informations d’identification nécessaires à la demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-286">The SAS provides the only credentials needed for the request.</span></span> <span data-ttu-id="6f3b0-287">La référence à l’objet blob de bloc est ensuite utilisée pour une opération d’écriture :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-287">The block blob reference is then used for a write operation:</span></span>

```csharp
string sasUri = "https://storagesample.blob.core.windows.net/sample-container/" +
    "sampleBlob.txt?sv=2015-07-08&sr=b&sig=39Up9JzHkxhUIhFEjEH9594DJxe7w6cIRCg0V6lCGSo%3D" +
    "&se=2016-10-18T21%3A51%3A37Z&sp=rcw";

CloudBlockBlob blob = new CloudBlockBlob(new Uri(sasUri));

// Create operation: Upload a blob with the specified name to the container.
// If the blob does not exist, it will be created. If it does exist, it will be overwritten.
try
{
    MemoryStream msWrite = new MemoryStream(Encoding.UTF8.GetBytes(blobContent));
    msWrite.Position = 0;
    using (msWrite)
    {
        await blob.UploadFromStreamAsync(msWrite);
    }

    Console.WriteLine("Create operation succeeded for SAS {0}", sasUri);
    Console.WriteLine();
}
catch (StorageException e)
{
    if (e.RequestInformation.HttpStatusCode == 403)
    {
        Console.WriteLine("Create operation failed for SAS {0}", sasUri);
        Console.WriteLine("Additional error information: " + e.Message);
        Console.WriteLine();
    }
    else
    {
        Console.WriteLine(e.Message);
        Console.ReadLine();
        throw;
    }
}

```

## <a name="best-practices-when-using-sas"></a><span data-ttu-id="6f3b0-288">Bonnes pratiques lors de l’utilisation de SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-288">Best practices when using SAS</span></span>
<span data-ttu-id="6f3b0-289">Lorsque vous utilisez des signatures d'accès partagé dans vos applications, vous devez être conscient de deux risques potentiels :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-289">When you use shared access signatures in your applications, you need to be aware of two potential risks:</span></span>

* <span data-ttu-id="6f3b0-290">Si une signature d'accès partagé est divulguée, toute personne qui se la procure peut s'en servir et votre compte de stockage court donc le risque d'être compromis.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-290">If a SAS is leaked, it can be used by anyone who obtains it, which can potentially compromise your storage account.</span></span>
* <span data-ttu-id="6f3b0-291">Si une signature d'accès partagé fournie à une application cliente expire et que l'application est incapable d'en récupérer une nouvelle à partir de votre service, la fonctionnalité de votre application risque d'être entravée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-291">If a SAS provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.</span></span>

<span data-ttu-id="6f3b0-292">Les recommandations suivantes relatives à l’utilisation des signatures d’accès partagé peuvent aider à limiter ces risques :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-292">The following recommendations for using shared access signatures can help mitigate these risks:</span></span>

1. <span data-ttu-id="6f3b0-293">**Utilisez toujours HTTPS** pour créer ou distribuer une signature d’accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-293">**Always use HTTPS** to create or distribute a SAS.</span></span> <span data-ttu-id="6f3b0-294">Si une signature d’accès partagé est transmise sur HTTP et interceptée, un pirate qui lance une attaque de type « attaque de l’intercepteur » (man-in-the-middle) peut lire la signature et s’en servir exactement comme l’utilisateur concerné aurait pu le faire, d’où le risque que les données sensibles soient compromises ou que les données soient altérées par l’utilisateur malveillant.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-294">If a SAS is passed over HTTP and intercepted, an attacker performing a man-in-the-middle attack is able to read the SAS and then use it just as the intended user could have, potentially compromising sensitive data or allowing for data corruption by the malicious user.</span></span>
2. <span data-ttu-id="6f3b0-295">**Référencez si possible les stratégies d'accès stockées.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-295">**Reference stored access policies where possible.**</span></span> <span data-ttu-id="6f3b0-296">Celles-ci vous donnent la possibilité de révoquer les autorisations sans avoir à régénérer les clés de compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-296">Stored access policies give you the option to revoke permissions without having to regenerate the storage account keys.</span></span> <span data-ttu-id="6f3b0-297">Définissez une échéance très éloignée dans le temps (voire infinie) pour l’expiration de ces dernières et veillez à ce qu’elle soit régulièrement mise à jour et repoussée dans le futur.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-297">Set the expiration on these very far in the future (or infinite) and make sure it's regularly updated to move it farther into the future.</span></span>
3. <span data-ttu-id="6f3b0-298">**Utilisez des heures d'expiration avec une échéance à court terme sur une signature d'accès partagé ad hoc.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-298">**Use near-term expiration times on an ad hoc SAS.**</span></span> <span data-ttu-id="6f3b0-299">De cette manière, même si une signature d’accès partagé est compromise, elle n’est valide que pendant une courte durée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-299">In this way, even if a SAS is compromised, it's valid only for a short time.</span></span> <span data-ttu-id="6f3b0-300">Cette pratique est particulièrement importante si vous ne pouvez pas référencer une stratégie d'accès stockée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-300">This practice is especially important if you cannot reference a stored access policy.</span></span> <span data-ttu-id="6f3b0-301">Des heures d’expiration avec une échéance à court terme permettent également de limiter la quantité de données pouvant être écrites dans un objet blob en limitant le temps disponible pour le chargement vers ce dernier.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-301">Near-term expiration times also limit the amount of data that can be written to a blob by limiting the time available to upload to it.</span></span>
4. <span data-ttu-id="6f3b0-302">**Faites en sorte que les clients renouvellent automatiquement la signature d'accès partagé si nécessaire.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-302">**Have clients automatically renew the SAS if necessary.**</span></span> <span data-ttu-id="6f3b0-303">Les clients doivent renouveler la signature d’accès partagé bien avant l’heure d’expiration afin de laisser suffisamment de temps pour de nouvelles tentatives, si le service qui fournit la signature est indisponible.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-303">Clients should renew the SAS well before the expiration, in order to allow time for retries if the service providing the SAS is unavailable.</span></span> <span data-ttu-id="6f3b0-304">Si votre signature d’accès partagé doit être utilisée pour un petit nombre d’opérations immédiates de courte durée, censées être terminées avant l’heure d’expiration, cela ne sera peut-être pas nécessaire, car il n’est pas prévu que la signature d’accès partagé soit renouvelée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-304">If your SAS is meant to be used for a small number of immediate, short-lived operations that are expected to be completed within the expiration period, then this may be unnecessary as the SAS is not expected to be renewed.</span></span> <span data-ttu-id="6f3b0-305">Toutefois, si vous avez un client qui effectue régulièrement des demandes par le biais de signatures d'accès partagé, le risque d'expiration est à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-305">However, if you have client that is routinely making requests via SAS, then the possibility of expiration comes into play.</span></span> <span data-ttu-id="6f3b0-306">La principale considération consiste à trouver un équilibre entre la nécessité que la signature d’accès partagé ait une durée de vie limitée (comme indiqué plus haut) et la nécessité de veiller à ce que le client demande le renouvellement suffisamment tôt pour éviter une interruption due à une expiration de la signature avant le renouvellement effectif.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-306">The key consideration is to balance the need for the SAS to be short-lived (as previously stated) with the need to ensure that the client is requesting renewal early enough (to avoid disruption due to the SAS expiring prior to successful renewal).</span></span>
5. <span data-ttu-id="6f3b0-307">**Faites attention à la date de début de la signature d’accès partagé.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-307">**Be careful with SAS start time.**</span></span> <span data-ttu-id="6f3b0-308">Si vous définissez la date de début d’une signature d’accès partagé sur **maintenant**, en raison du décalage d’horloge (différences constatées dans l’heure actuelle sur des machines différentes), des défaillances peuvent être observées par intermittence pendant les premières minutes.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-308">If you set the start time for a SAS to **now**, then due to clock skew (differences in current time according to different machines), failures may be observed intermittently for the first few minutes.</span></span> <span data-ttu-id="6f3b0-309">En règle générale, définissez une heure de début située au moins 15 minutes avant l’heure courante</span><span class="sxs-lookup"><span data-stu-id="6f3b0-309">In general, set the start time to be at least 15 minutes in the past.</span></span> <span data-ttu-id="6f3b0-310">ou ne la définissez pas du tout, et elle sera alors valide immédiatement dans tous les cas.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-310">Or, don't set it at all, which will make it valid immediately in all cases.</span></span> <span data-ttu-id="6f3b0-311">Cela vaut également d’une manière générale pour l’heure d’expiration. Souvenez-vous que vous pouvez observer jusqu’à 15 minutes de décalage d’horloge (dans l’une ou l’autre direction) sur une demande.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-311">The same generally applies to expiry time as well--remember that you may observe up to 15 minutes of clock skew in either direction on any request.</span></span> <span data-ttu-id="6f3b0-312">Pour les clients qui utilisent une version de REST antérieure à la version 2012-02-12, la durée maximale pour une signature d’accès partagé qui ne renvoie pas à une stratégie d’accès stockée est de 1 heure et toutes les stratégies spécifiant une période plus longue échouent.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-312">For clients using a REST version prior to 2012-02-12, the maximum duration for a SAS that does not reference a stored access policy is 1 hour, and any policies specifying longer term than that will fail.</span></span>
6. <span data-ttu-id="6f3b0-313">**Soyez précis quant à la ressource pour laquelle vous voulez configurer l'accès.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-313">**Be specific with the resource to be accessed.**</span></span> <span data-ttu-id="6f3b0-314">Une bonne pratique en matière de sécurité consiste à fournir à l’utilisateur les privilèges minimaux requis.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-314">A security best practice is to provide a user with the minimum required privileges.</span></span> <span data-ttu-id="6f3b0-315">Si un utilisateur a besoin d'un accès en lecture à une seule entité, accordez-lui un accès en lecture à cette seule entité, plutôt qu'un accès en lecture/écriture/suppression à toutes les entités.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-315">If a user only needs read access to a single entity, then grant them read access to that single entity, and not read/write/delete access to all entities.</span></span> <span data-ttu-id="6f3b0-316">Cela permet également d’atténuer les dégâts si une signature d’accès partagé est compromise, car son pouvoir est moindre entre les mains d’une personne malveillante.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-316">This also helps lessen the damage if a SAS is compromised because the SAS has less power in the hands of an attacker.</span></span>
7. <span data-ttu-id="6f3b0-317">**Sachez que toute utilisation de votre compte sera facturée, y compris pour les signatures d'accès partagé.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-317">**Understand that your account will be billed for any usage, including that done with SAS.**</span></span> <span data-ttu-id="6f3b0-318">Si vous fournissez un accès en écriture à un objet blob, un utilisateur peut choisir de charger un objet blob de 200 Go.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-318">If you provide write access to a blob, a user may choose to upload a 200GB blob.</span></span> <span data-ttu-id="6f3b0-319">Si vous lui avez également accordé un accès en lecture, il peut choisir de le télécharger 10 fois, et vous devrez alors acquitter des frais de sortie pour l’équivalent de 2 To.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-319">If you've given them read access as well, they may choose to download it 10 times, incurring 2 TB in egress costs for you.</span></span> <span data-ttu-id="6f3b0-320">Accordez des autorisations limitées pour atténuer les risques liés aux actions éventuelles d’utilisateurs malveillants.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-320">Again, provide limited permissions to help mitigate the potential actions of malicious users.</span></span> <span data-ttu-id="6f3b0-321">Utilisez des signatures d'accès partagé à durée de vie limitée pour atténuer cette menace (mais pensez au décalage d'horloge pour l'heure de fin).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-321">Use short-lived SAS to reduce this threat (but be mindful of clock skew on the end time).</span></span>
8. <span data-ttu-id="6f3b0-322">**Validez les données écrites avec une signature d'accès partagé.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-322">**Validate data written using SAS.**</span></span> <span data-ttu-id="6f3b0-323">Lorsqu'une application cliente écrit des données dans votre compte de stockage, n'oubliez pas que ces données peuvent être une source de problèmes.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-323">When a client application writes data to your storage account, keep in mind that there can be problems with that data.</span></span> <span data-ttu-id="6f3b0-324">Si votre application exige que ces données soient validées ou autorisées avant de pouvoir être utilisées, vous devez effectuer cette validation après l'écriture des données et avant qu'elles ne soient utilisées par votre application.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-324">If your application requires that that data be validated or authorized before it is ready to use, you should perform this validation after the data is written and before it is used by your application.</span></span> <span data-ttu-id="6f3b0-325">Cette pratique assure également une protection contre l'écriture de données endommagées ou malveillantes dans votre compte, soit par un utilisateur qui a acquis correctement la signature d'accès partagé, soit par un utilisateur qui exploite sa divulgation.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-325">This practice also protects against corrupt or malicious data being written to your account, either by a user who properly acquired the SAS, or by a user exploiting a leaked SAS.</span></span>
9. <span data-ttu-id="6f3b0-326">**N'utilisez pas toujours une signature d'accès partagé.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-326">**Don't always use SAS.**</span></span> <span data-ttu-id="6f3b0-327">Parfois, les risques associés à une opération particulière sur votre compte de stockage l'emportent sur les avantages offerts par la signature d'accès partagé.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-327">Sometimes the risks associated with a particular operation against your storage account outweigh the benefits of SAS.</span></span> <span data-ttu-id="6f3b0-328">Pour ces opérations, créez un service de niveau intermédiaire qui écrit dans votre compte de stockage après avoir effectué la validation des règles métier, l'authentification et un audit.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-328">For such operations, create a middle-tier service that writes to your storage account after performing business rule validation, authentication, and auditing.</span></span> <span data-ttu-id="6f3b0-329">Parfois aussi, il est plus simple de gérer l'accès par d'autres moyens.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-329">Also, sometimes it's simpler to manage access in other ways.</span></span> <span data-ttu-id="6f3b0-330">Par exemple, si vous voulez que tous les objets blob dans un conteneur soient publiquement lisibles, vous pouvez rendre le conteneur public, au lieu de fournir une signature d'accès partagé à chaque client.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-330">For example, if you want to make all blobs in a container publically readable, you can make the container Public, rather than providing a SAS to every client for access.</span></span>
10. <span data-ttu-id="6f3b0-331">**Utilisez Storage Analytics pour surveiller votre application.**</span><span class="sxs-lookup"><span data-stu-id="6f3b0-331">**Use Storage Analytics to monitor your application.**</span></span> <span data-ttu-id="6f3b0-332">Vous pouvez utiliser la journalisation et les mesures pour observer tout pic dans les échecs d’authentification dus à une interruption du service de votre fournisseur de signatures d’accès partagé ou à la suppression par inadvertance d’une stratégie d’accès stockée.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-332">You can use logging and metrics to observe any spike in authentication failures due to an outage in your SAS provider service or to the inadvertent removal of a stored access policy.</span></span> <span data-ttu-id="6f3b0-333">Pour plus d'informations, consultez le [blog de l'équipe Azure Storage](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx) .</span><span class="sxs-lookup"><span data-stu-id="6f3b0-333">See the [Azure Storage Team Blog](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/08/03/windows-azure-storage-logging-using-logs-to-track-storage-requests.aspx) for additional information.</span></span>

## <a name="sas-examples"></a><span data-ttu-id="6f3b0-334">Exemples de SAP</span><span class="sxs-lookup"><span data-stu-id="6f3b0-334">SAS examples</span></span>
<span data-ttu-id="6f3b0-335">Vous trouverez ci-dessous des exemples des deux types de signatures d’accès partagé, SAP de compte et SAP de service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-335">Below are some examples of both types of shared access signatures, account SAS and service SAS.</span></span>

<span data-ttu-id="6f3b0-336">Pour exécuter ces exemples C#, vous devez référencer les packages NuGet suivants dans votre projet :</span><span class="sxs-lookup"><span data-stu-id="6f3b0-336">To run these C# examples, you need to reference the following NuGet packages in your project:</span></span>

* <span data-ttu-id="6f3b0-337">[Bibliothèque cliente de stockage Azure pour .NET](http://www.nuget.org/packages/WindowsAzure.Storage), version 6.x ou ultérieure (pour utiliser une SAP de compte).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-337">[Azure Storage Client Library for .NET](http://www.nuget.org/packages/WindowsAzure.Storage), version 6.x or later (to use account SAS).</span></span>
* [<span data-ttu-id="6f3b0-338">Gestionnaire de configuration Azure</span><span class="sxs-lookup"><span data-stu-id="6f3b0-338">Azure Configuration Manager</span></span>](http://www.nuget.org/packages/Microsoft.WindowsAzure.ConfigurationManager)

<span data-ttu-id="6f3b0-339">Pour obtenir des exemples supplémentaires expliquant comment créer et tester une SAP, consultez les [Exemples de code Azure pour le stockage](https://azure.microsoft.com/documentation/samples/?service=storage).</span><span class="sxs-lookup"><span data-stu-id="6f3b0-339">For additional examples that show how to create and test a SAS, see [Azure Code Samples for Storage](https://azure.microsoft.com/documentation/samples/?service=storage).</span></span>

### <a name="example-create-and-use-an-account-sas"></a><span data-ttu-id="6f3b0-340">Exemple : création et utilisation d’une SAP de compte</span><span class="sxs-lookup"><span data-stu-id="6f3b0-340">Example: Create and use an account SAS</span></span>
<span data-ttu-id="6f3b0-341">L’exemple de code suivant crée une SAP de compte valide pour le service BLOB et le service de fichiers, et donne au client des autorisations d’accès en lecture, en écriture et en liste pour accéder aux API au niveau du service.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-341">The following code example creates an account SAS that is valid for the Blob and File services, and gives the client permissions read, write, and list permissions to access service-level APIs.</span></span> <span data-ttu-id="6f3b0-342">Le SAP de compte limitant le protocole à HTTPS, la demande doit être effectuée avec ce protocole.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-342">The account SAS restricts the protocol to HTTPS, so the request must be made with HTTPS.</span></span>

```csharp
static string GetAccountSASToken()
{
    // To create the account SAS, you need to use your shared key credentials. Modify for your account.
    const string ConnectionString = "DefaultEndpointsProtocol=https;AccountName=account-name;AccountKey=account-key";
    CloudStorageAccount storageAccount = CloudStorageAccount.Parse(ConnectionString);

    // Create a new access policy for the account.
    SharedAccessAccountPolicy policy = new SharedAccessAccountPolicy()
        {
            Permissions = SharedAccessAccountPermissions.Read | SharedAccessAccountPermissions.Write | SharedAccessAccountPermissions.List,
            Services = SharedAccessAccountServices.Blob | SharedAccessAccountServices.File,
            ResourceTypes = SharedAccessAccountResourceTypes.Service,
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Protocols = SharedAccessProtocol.HttpsOnly
        };

    // Return the SAS token.
    return storageAccount.GetSharedAccessSignature(policy);
}
```

<span data-ttu-id="6f3b0-343">Afin utiliser la SAP de compte pour accéder aux API au niveau du service pour le service BLOB, construisez un client d’objet blob à l’aide de la SAP et du point de terminaison de stockage d’objets blob de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-343">To use the account SAS to access service-level APIs for the Blob service, construct a Blob client object using the SAS and the Blob storage endpoint for your storage account.</span></span>

```csharp
static void UseAccountSAS(string sasToken)
{
    // Create new storage credentials using the SAS token.
    StorageCredentials accountSAS = new StorageCredentials(sasToken);
    // Use these credentials and the account name to create a Blob service client.
    CloudStorageAccount accountWithSAS = new CloudStorageAccount(accountSAS, "account-name", endpointSuffix: null, useHttps: true);
    CloudBlobClient blobClientWithSAS = accountWithSAS.CreateCloudBlobClient();

    // Now set the service properties for the Blob client created with the SAS.
    blobClientWithSAS.SetServiceProperties(new ServiceProperties()
    {
        HourMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        MinuteMetrics = new MetricsProperties()
        {
            MetricsLevel = MetricsLevel.ServiceAndApi,
            RetentionDays = 7,
            Version = "1.0"
        },
        Logging = new LoggingProperties()
        {
            LoggingOperations = LoggingOperations.All,
            RetentionDays = 14,
            Version = "1.0"
        }
    });

    // The permissions granted by the account SAS also permit you to retrieve service properties.
    ServiceProperties serviceProperties = blobClientWithSAS.GetServiceProperties();
    Console.WriteLine(serviceProperties.HourMetrics.MetricsLevel);
    Console.WriteLine(serviceProperties.HourMetrics.RetentionDays);
    Console.WriteLine(serviceProperties.HourMetrics.Version);
}
```

### <a name="example-create-a-stored-access-policy"></a><span data-ttu-id="6f3b0-344">Exemple : création d’une stratégie d’accès stockée</span><span class="sxs-lookup"><span data-stu-id="6f3b0-344">Example: Create a stored access policy</span></span>
<span data-ttu-id="6f3b0-345">Le code suivant crée une stratégie d’accès stockée sur un conteneur.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-345">The following code creates a stored access policy on a container.</span></span> <span data-ttu-id="6f3b0-346">Vous pouvez utiliser la stratégie d’accès pour spécifier des contraintes pour une SAP de service sur le conteneur ou sur ses objets blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-346">You can use the access policy to specify constraints for a service SAS on the container or its blobs.</span></span>

```csharp
private static async Task CreateSharedAccessPolicyAsync(CloudBlobContainer container, string policyName)
{
    // Create a new shared access policy and define its constraints.
    // The access policy provides create, write, read, list, and delete permissions.
    SharedAccessBlobPolicy sharedPolicy = new SharedAccessBlobPolicy()
    {
        // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
        // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
        SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
        Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.List |
            SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create | SharedAccessBlobPermissions.Delete
    };

    // Get the container's existing permissions.
    BlobContainerPermissions permissions = await container.GetPermissionsAsync();

    // Add the new policy to the container's permissions, and set the container's permissions.
    permissions.SharedAccessPolicies.Add(policyName, sharedPolicy);
    await container.SetPermissionsAsync(permissions);
}
```

### <a name="example-create-a-service-sas-on-a-container"></a><span data-ttu-id="6f3b0-347">Exemple : création d’une SAP de service sur un conteneur</span><span class="sxs-lookup"><span data-stu-id="6f3b0-347">Example: Create a service SAS on a container</span></span>
<span data-ttu-id="6f3b0-348">Le code suivant crée une SAP sur un conteneur.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-348">The following code creates a SAS on a container.</span></span> <span data-ttu-id="6f3b0-349">Si le nom d’une stratégie d’accès stockée existante est fourni, cette stratégie est associée à la SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-349">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="6f3b0-350">Dans le cas contraire, le code crée une SAP ad hoc sur le conteneur.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-350">If no stored access policy is provided, then the code creates an ad-hoc SAS on the container.</span></span>

```csharp
private static string GetContainerSasUri(CloudBlobContainer container, string storedPolicyName = null)
{
    string sasContainerToken;

    // If no stored policy is specified, create a new access policy and define its constraints.
    if (storedPolicyName == null)
    {
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocPolicy = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.List
        };

        // Generate the shared access signature on the container, setting the constraints directly on the signature.
        sasContainerToken = container.GetSharedAccessSignature(adHocPolicy, null);

        Console.WriteLine("SAS for blob container (ad hoc): {0}", sasContainerToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the container. In this case, all of the constraints for the
        // shared access signature are specified on the stored access policy, which is provided by name.
        // It is also possible to specify some constraints on an ad-hoc SAS and others on the stored access policy.
        sasContainerToken = container.GetSharedAccessSignature(null, storedPolicyName);

        Console.WriteLine("SAS for blob container (stored access policy): {0}", sasContainerToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return container.Uri + sasContainerToken;
}
```

### <a name="example-create-a-service-sas-on-a-blob"></a><span data-ttu-id="6f3b0-351">Exemple : création d’une SAP de service sur un objet blob</span><span class="sxs-lookup"><span data-stu-id="6f3b0-351">Example: Create a service SAS on a blob</span></span>
<span data-ttu-id="6f3b0-352">Le code suivant crée une SAP sur un objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-352">The following code creates a SAS on a blob.</span></span> <span data-ttu-id="6f3b0-353">Si le nom d’une stratégie d’accès stockée existante est fourni, cette stratégie est associée à la SAP.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-353">If the name of an existing stored access policy is provided, that policy is associated with the SAS.</span></span> <span data-ttu-id="6f3b0-354">Dans le cas contraire, le code crée une SAP ad hoc sur l’objet blob.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-354">If no stored access policy is provided, then the code creates an ad-hoc SAS on the blob.</span></span>

```csharp
private static string GetBlobSasUri(CloudBlobContainer container, string blobName, string policyName = null)
{
    string sasBlobToken;

    // Get a reference to a blob within the container.
    // Note that the blob may not exist yet, but a SAS can still be created for it.
    CloudBlockBlob blob = container.GetBlockBlobReference(blobName);

    if (policyName == null)
    {
        // Create a new access policy and define its constraints.
        // Note that the SharedAccessBlobPolicy class is used both to define the parameters of an ad-hoc SAS, and
        // to construct a shared access policy that is saved to the container's shared access policies.
        SharedAccessBlobPolicy adHocSAS = new SharedAccessBlobPolicy()
        {
            // When the start time for the SAS is omitted, the start time is assumed to be the time when the storage service receives the request.
            // Omitting the start time for a SAS that is effective immediately helps to avoid clock skew.
            SharedAccessExpiryTime = DateTime.UtcNow.AddHours(24),
            Permissions = SharedAccessBlobPermissions.Read | SharedAccessBlobPermissions.Write | SharedAccessBlobPermissions.Create
        };

        // Generate the shared access signature on the blob, setting the constraints directly on the signature.
        sasBlobToken = blob.GetSharedAccessSignature(adHocSAS);

        Console.WriteLine("SAS for blob (ad hoc): {0}", sasBlobToken);
        Console.WriteLine();
    }
    else
    {
        // Generate the shared access signature on the blob. In this case, all of the constraints for the
        // shared access signature are specified on the container's stored access policy.
        sasBlobToken = blob.GetSharedAccessSignature(null, policyName);

        Console.WriteLine("SAS for blob (stored access policy): {0}", sasBlobToken);
        Console.WriteLine();
    }

    // Return the URI string for the container, including the SAS token.
    return blob.Uri + sasBlobToken;
}
```

## <a name="conclusion"></a><span data-ttu-id="6f3b0-355">Conclusion</span><span class="sxs-lookup"><span data-stu-id="6f3b0-355">Conclusion</span></span>
<span data-ttu-id="6f3b0-356">Les signatures d'accès partagé sont utiles pour fournir des autorisations d'accès limitées à votre compte de stockage aux clients qui ne doivent pas avoir la clé du compte.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-356">Shared access signatures are useful for providing limited permissions to your storage account to clients that should not have the account key.</span></span> <span data-ttu-id="6f3b0-357">À ce titre, elles sont un élément crucial du modèle de sécurité pour toute application utilisant Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-357">As such, they are a vital part of the security model for any application using Azure Storage.</span></span> <span data-ttu-id="6f3b0-358">Si vous suivez les meilleures pratiques énumérées ci-dessus, vous pouvez utiliser une signature d'accès partagé pour offrir une plus grande souplesse d'accès aux ressources de votre compte de stockage, sans compromettre la sécurité de votre application.</span><span class="sxs-lookup"><span data-stu-id="6f3b0-358">If you follow the best practices listed here, you can use SAS to provide greater flexibility of access to resources in your storage account, without compromising the security of your application.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6f3b0-359">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="6f3b0-359">Next Steps</span></span>
* [<span data-ttu-id="6f3b0-360">Gestion de l’accès en lecture anonyme aux conteneurs et aux objets blob</span><span class="sxs-lookup"><span data-stu-id="6f3b0-360">Manage anonymous read access to containers and blobs</span></span>](../blobs/storage-manage-access-to-resources.md)
* [<span data-ttu-id="6f3b0-361">Délégation de l'accès avec une signature d'accès partagé</span><span class="sxs-lookup"><span data-stu-id="6f3b0-361">Delegating Access with a Shared Access Signature</span></span>](http://msdn.microsoft.com/library/azure/ee395415.aspx)
* [<span data-ttu-id="6f3b0-362">Présentation des signatures d’accès partagé de table et de file d’attente</span><span class="sxs-lookup"><span data-stu-id="6f3b0-362">Introducing Table and Queue SAS</span></span>](http://blogs.msdn.com/b/windowsazurestorage/archive/2012/06/12/introducing-table-sas-shared-access-signature-queue-sas-and-update-to-blob-sas.aspx)
