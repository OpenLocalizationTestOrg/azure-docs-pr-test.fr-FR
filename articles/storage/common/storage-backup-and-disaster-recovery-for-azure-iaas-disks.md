---
title: "Sauvegarde et récupération d’urgence pour les disques IaaS Azure | Microsoft Docs"
description: "Cet article montre comment planifier la sauvegarde et la récupération d’urgence de disques et de machines virtuelles IaaS dans Azure. Ce document couvre les disques managés et non managés."
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 03d38bc3383b5fd39eca5ca67c315b34b98f0c39
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="d0971-104">Sauvegarde et récupération d’urgence pour les disques IaaS Azure</span><span class="sxs-lookup"><span data-stu-id="d0971-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="d0971-105">Cet article montre comment planifier la sauvegarde et la récupération d’urgence de disques et de machines virtuelles IaaS dans Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="d0971-106">Ce document couvre les disques managés et non managés.</span><span class="sxs-lookup"><span data-stu-id="d0971-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="d0971-107">Nous abordons tout d’abord les fonctionnalités de tolérance de panne intégrées dans la plateforme Azure qui vous protègent contre les défaillances locales.</span><span class="sxs-lookup"><span data-stu-id="d0971-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="d0971-108">Nous présentons ensuite les scénarios d’urgence qui ne sont pas entièrement couverts par les fonctionnalités intégrées. Il s’agit du thème principal traité par ce document.</span><span class="sxs-lookup"><span data-stu-id="d0971-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="d0971-109">Nous montrons également plusieurs exemples de charges de travail où différentes considérations en matière de sauvegarde et de récupération d’urgence peuvent s’appliquer.</span><span class="sxs-lookup"><span data-stu-id="d0971-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="d0971-110">Nous voyons ensuite les solutions possibles pour la récupération d’urgence des disques IaaS.</span><span class="sxs-lookup"><span data-stu-id="d0971-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="d0971-111">Introduction</span><span class="sxs-lookup"><span data-stu-id="d0971-111">Introduction</span></span>

<span data-ttu-id="d0971-112">La plateforme Azure utilise différentes méthodes pour la redondance et la tolérance de panne afin de protéger les clients contre les défaillances matérielles localisées qui peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="d0971-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="d0971-113">Les défaillances locales peuvent inclure des problèmes avec un serveur de stockage Azure qui stocke une partie des données d’un disque virtuel ou les défaillances d’un disque SSD ou d’un disque dur sur ce serveur.</span><span class="sxs-lookup"><span data-stu-id="d0971-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="d0971-114">Ces défaillances de composant matériel isolées peuvent se produire pendant les opérations normales et la plateforme est conçue pour être résiliente à ces défaillances.</span><span class="sxs-lookup"><span data-stu-id="d0971-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="d0971-115">Des sinistres majeurs peuvent entraîner des défaillances ou l’inaccessibilité d’un grand nombre de serveurs de stockage ou d’un centre de données entier.</span><span class="sxs-lookup"><span data-stu-id="d0971-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="d0971-116">Alors que vos machines virtuelles et disques sont normalement protégés contre les défaillances localisées, des étapes supplémentaires sont nécessaires pour protéger votre charge de travail contre les défaillances irrécupérables à l’échelle de la région (par exemple, une catastrophe majeure) qui peuvent affecter vos machines virtuelles et vos disques.</span><span class="sxs-lookup"><span data-stu-id="d0971-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="d0971-117">Outre la possibilité de défaillances de la plateforme, des problèmes avec l’application ou les données du client peuvent se produire.</span><span class="sxs-lookup"><span data-stu-id="d0971-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="d0971-118">Par exemple, une nouvelle version de votre application peut par inadvertance apporter des modifications importantes aux données.</span><span class="sxs-lookup"><span data-stu-id="d0971-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="d0971-119">Dans ce cas, vous pouvez restaurer l’application et les données à une version antérieure qui contient le dernier état correct connu.</span><span class="sxs-lookup"><span data-stu-id="d0971-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="d0971-120">Cela nécessite la gestion de sauvegardes régulières.</span><span class="sxs-lookup"><span data-stu-id="d0971-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="d0971-121">Pour la récupération d’urgence régionale, vous devez sauvegarder vos disques de machines virtuelles IaaS dans une autre région.</span><span class="sxs-lookup"><span data-stu-id="d0971-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="d0971-122">Avant d’examiner les options de sauvegarde et de récupération d’urgence, récapitulons quelques méthodes disponibles pour gérer les défaillances localisées.</span><span class="sxs-lookup"><span data-stu-id="d0971-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="d0971-123">Résilience Azure IaaS</span><span class="sxs-lookup"><span data-stu-id="d0971-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="d0971-124">La *résilience* fait référence à la tolérance aux défaillances normales qui se produisent dans les composants matériels.</span><span class="sxs-lookup"><span data-stu-id="d0971-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="d0971-125">La résilience est la capacité à récupérer après des défaillances et à continuer de fonctionner.</span><span class="sxs-lookup"><span data-stu-id="d0971-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="d0971-126">Il ne s’agit pas d’éviter les défaillances, mais d’y répondre en évitant les temps d’arrêt ou la perte de données.</span><span class="sxs-lookup"><span data-stu-id="d0971-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="d0971-127">L’objectif de la résilience est que l’application retrouve un état entièrement fonctionnel suite à une défaillance.</span><span class="sxs-lookup"><span data-stu-id="d0971-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="d0971-128">Les machines virtuelles et les disques Azure sont conçus pour assurer la résilience aux défaillances matérielles courantes.</span><span class="sxs-lookup"><span data-stu-id="d0971-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="d0971-129">Examinons comment la plateforme Azure IaaS fournit cette résilience.</span><span class="sxs-lookup"><span data-stu-id="d0971-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="d0971-130">Une machine virtuelle se compose principalement de deux parties : (1) un serveur de calcul et (2) les disques persistants.</span><span class="sxs-lookup"><span data-stu-id="d0971-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="d0971-131">Ces deux composants assurent la tolérance de panne d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="d0971-132">Si le serveur hôte de calcul Azure qui héberge votre machine virtuelle subit une défaillance matérielle (ce qui est rare), Azure est conçu pour restaurer automatiquement la machine virtuelle sur un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="d0971-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="d0971-133">Dans ce cas, un redémarrage a lieu et la machine virtuelle est sauvegardée au bout d’un certain temps.</span><span class="sxs-lookup"><span data-stu-id="d0971-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="d0971-134">Azure détecte automatiquement de telles défaillances matérielles et exécute des récupérations pour garantir la disponibilité rapide de la machine virtuelle du client.</span><span class="sxs-lookup"><span data-stu-id="d0971-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="d0971-135">Concernant les disques IaaS, la durabilité des données est essentielle pour la plateforme de stockage persistant.</span><span class="sxs-lookup"><span data-stu-id="d0971-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="d0971-136">Les clients Azure ont des applications métiers importantes exécutées sur IaaS qui dépendent de la persistance des données.</span><span class="sxs-lookup"><span data-stu-id="d0971-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="d0971-137">Azure conçoit la protection de ces disques IaaS avec trois copies redondantes des données stockées localement, fournissant ainsi une durabilité élevée contre les défaillances locales.</span><span class="sxs-lookup"><span data-stu-id="d0971-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="d0971-138">Si un des composants matériels qui contient le disque tombe en panne, votre machine virtuelle n’est pas affectée, car il existe deux copies supplémentaires pour prendre en charge les demandes du disque.</span><span class="sxs-lookup"><span data-stu-id="d0971-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="d0971-139">Cela fonctionne bien même si deux composants matériels prenant en charge un disque tombent en panne en même temps (ce qui est très rare).</span><span class="sxs-lookup"><span data-stu-id="d0971-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="d0971-140">Pour garantir le maintien en continu de trois réplicas, le service Stockage Azure génère automatiquement une nouvelle copie des données en arrière-plan si une des trois copies devient indisponible.</span><span class="sxs-lookup"><span data-stu-id="d0971-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="d0971-141">Par conséquent, il ne doit pas être nécessaire d’utiliser un système RAID avec des disques Azure pour assurer la tolérance de panne.</span><span class="sxs-lookup"><span data-stu-id="d0971-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="d0971-142">Une simple configuration RAID 0 doit être suffisante pour la répartition des disques le cas échéant afin de créer des volumes de plus grande capacité.</span><span class="sxs-lookup"><span data-stu-id="d0971-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="d0971-143">Cette architecture a permis à **Azure de fournir de façon cohérente une durabilité de classe Entreprise pour les disques IaaS, avec un [taux de défaillance annuel](https://en.wikipedia.org/wiki/Annualized_failure_rate) inégalé dans le secteur de zéro %.**</span><span class="sxs-lookup"><span data-stu-id="d0971-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="d0971-144">Les défaillances matérielles localisées sur l’ordinateur hôte ou dans la plateforme de stockage peuvent parfois entraîner une indisponibilité temporaire de la machine virtuelle qui est couverte par le [contrat SLA Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/) qui en garantit la disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d0971-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="d0971-145">Azure fournit également un contrat SLA de pointe pour les instances de machine virtuelle uniques qui utilisent des disques Stockage Premium.</span><span class="sxs-lookup"><span data-stu-id="d0971-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="d0971-146">Pour protéger les charges de travail d’application contre les temps d’arrêt suite à l’indisponibilité temporaire d’un disque ou d’une machine virtuelle, les clients peuvent exploiter les [groupes à haute disponibilité](../../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="d0971-147">Plusieurs machines virtuelles regroupées dans un groupe à haute disponibilité assurent la redondance de votre application.</span><span class="sxs-lookup"><span data-stu-id="d0971-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="d0971-148">Azure crée ensuite ces machines virtuelles et disques dans des domaines d’erreur distincts avec différents composants d’alimentation, réseau et serveur.</span><span class="sxs-lookup"><span data-stu-id="d0971-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="d0971-149">Par conséquent, les défaillances matérielles localisées n’affectent généralement pas plusieurs machines virtuelles du groupe en même temps, offrant ainsi une haute disponibilité pour votre application.</span><span class="sxs-lookup"><span data-stu-id="d0971-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="d0971-150">Il est considéré comme une bonne pratique d’utiliser des groupes à haute disponibilité lorsque la haute disponibilité est requise.</span><span class="sxs-lookup"><span data-stu-id="d0971-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="d0971-151">Pour plus d’informations, consultez les aspects de la récupération d’urgence détaillés ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="d0971-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="d0971-152">Sauvegarde et récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="d0971-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="d0971-153">La récupération d’urgence est la capacité à récupérer après des incidents rares mais majeurs : des défaillances non transitoires et à grande échelle, telles que des interruptions de service qui affectent une région entière.</span><span class="sxs-lookup"><span data-stu-id="d0971-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="d0971-154">La récupération d’urgence inclut la sauvegarde et l’archivage des données. Elle peut également inclure une intervention manuelle, comme la restauration d’une base de données à partir de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="d0971-155">Il se peut que la protection intégrée de la plateforme Azure contre les défaillances localisées ne protège pas entièrement les machines virtuelles/disques dans le cas de sinistres majeurs qui peuvent provoquer des interruptions à grande échelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="d0971-156">Cela inclut les événements catastrophiques, par exemple un centre de données atteint par un ouragan, un tremblement de terre, un incendie ou des pannes d’unités matérielles à grande échelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="d0971-157">En outre, vous pouvez rencontrer des défaillances en raison de problèmes rencontrés par l’application ou les données.</span><span class="sxs-lookup"><span data-stu-id="d0971-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="d0971-158">Pour protéger vos charges de travail IaaS contre les interruptions, vous devez planifier la redondance et les sauvegardes afin d’activer la récupération.</span><span class="sxs-lookup"><span data-stu-id="d0971-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="d0971-159">Pour la récupération d’urgence, vous devez planifier la redondance et la sauvegarde dans un emplacement géographique différent situé en dehors du site principal.</span><span class="sxs-lookup"><span data-stu-id="d0971-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="d0971-160">Cela permet de garantir que la sauvegarde n’est pas affectée par l’événement qui a initialement eu un impact sur la machine virtuelle ou les disques.</span><span class="sxs-lookup"><span data-stu-id="d0971-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="d0971-161">Pour plus d’informations, consultez [Récupération d’urgence pour les applications développées sur Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="d0971-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="d0971-162">Vos considérations relatives à la récupération d’urgence peuvent inclure les aspects suivants :</span><span class="sxs-lookup"><span data-stu-id="d0971-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="d0971-163">La haute disponibilité est la capacité de l’application à continuer de s’exécuter dans un état sain, sans temps d’arrêt significatif.</span><span class="sxs-lookup"><span data-stu-id="d0971-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="d0971-164">« Sain » signifie que l’application est réactive et que les utilisateurs peuvent s’y connecter et interagir avec elle.</span><span class="sxs-lookup"><span data-stu-id="d0971-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="d0971-165">Certaines applications et bases de données critiques peuvent avoir besoin d’être toujours disponibles, même en cas de défaillances dans la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d0971-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="d0971-166">Pour ces charges de travail, vous devrez peut-être planifier une redondance pour l’application ainsi que les données.</span><span class="sxs-lookup"><span data-stu-id="d0971-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="d0971-167">Durabilité des données : dans certains cas, la considération principale est de s’assurer que les données sont préservées en cas de sinistre.</span><span class="sxs-lookup"><span data-stu-id="d0971-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="d0971-168">Par conséquent, vous aurez peut-être besoin d’une sauvegarde de vos données dans un autre site.</span><span class="sxs-lookup"><span data-stu-id="d0971-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="d0971-169">Pour ces charges de travail, vous n’aurez peut-être pas besoin d’une redondance complète pour l’application, mais d’une sauvegarde régulière des disques.</span><span class="sxs-lookup"><span data-stu-id="d0971-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="d0971-170">Scénarios de sauvegarde et de récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="d0971-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="d0971-171">Examinons quelques exemples de charges de travail d’application et les éléments à prendre en compte pour la planification de la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="d0971-172">Scénario 1 : solutions de base de données majeures</span><span class="sxs-lookup"><span data-stu-id="d0971-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="d0971-173">Prenons l’exemple d’un serveur de base de données de production tel que SQL Server ou Oracle prenant en charge la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d0971-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="d0971-174">Les utilisateurs et les applications de production critiques dépendent de cette base de données.</span><span class="sxs-lookup"><span data-stu-id="d0971-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="d0971-175">Le plan de récupération d’urgence pour ce système peut être de prendre en charge les exigences suivantes :</span><span class="sxs-lookup"><span data-stu-id="d0971-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="d0971-176">Les données doivent être protégées et récupérables.</span><span class="sxs-lookup"><span data-stu-id="d0971-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="d0971-177">Le serveur doit être disponible pour utilisation.</span><span class="sxs-lookup"><span data-stu-id="d0971-177">Server must be available for use.</span></span>

<span data-ttu-id="d0971-178">Cela peut nécessiter de maintenir un réplica de la base de données dans une autre région en tant que sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="d0971-179">Selon les exigences liées à la récupération des données et à la disponibilité du serveur, la solution peut aller d’un site de réplica actif-actif ou actif-passif à des sauvegardes en mode hors connexion des données.</span><span class="sxs-lookup"><span data-stu-id="d0971-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="d0971-180">Les bases de données relationnelles telles que SQL Server et Oracle fournissent diverses options pour la réplication.</span><span class="sxs-lookup"><span data-stu-id="d0971-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="d0971-181">Pour SQL Server, les [groupes de disponibilité SQL Server Always On](https://msdn.microsoft.com/library/hh510230.aspx) peuvent être utilisés pour la haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="d0971-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="d0971-182">Les bases de données NoSQL comme MongoDB prennent également en charge les [réplicas](https://docs.mongodb.com/manual/replication/) pour assurer la redondance.</span><span class="sxs-lookup"><span data-stu-id="d0971-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="d0971-183">Les réplicas pour la haute disponibilité peuvent être utilisés.</span><span class="sxs-lookup"><span data-stu-id="d0971-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="d0971-184">Scénario 2 : un cluster de machines virtuelles redondantes</span><span class="sxs-lookup"><span data-stu-id="d0971-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="d0971-185">Prenons l’exemple d’une charge de travail gérée par un cluster de machines virtuelles qui fournit la redondance et l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="d0971-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="d0971-186">Il peut s’agir d’un cluster Cassandra déployé dans une région.</span><span class="sxs-lookup"><span data-stu-id="d0971-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="d0971-187">Ce type d’architecture fournit déjà un niveau élevé de redondance dans cette région.</span><span class="sxs-lookup"><span data-stu-id="d0971-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="d0971-188">Toutefois, pour protéger la charge de travail contre une défaillance au niveau régional, vous devez envisager de répartir le cluster entre deux régions ou d’effectuer des sauvegardes périodiques vers une autre région.</span><span class="sxs-lookup"><span data-stu-id="d0971-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="d0971-189">Scénario 3 : charge de travail d’application IaaS</span><span class="sxs-lookup"><span data-stu-id="d0971-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="d0971-190">Il peut s’agir d’une charge de travail de production standard exécutée sur une machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="d0971-191">Par exemple, il peut s’agir d’un serveur web ou d’un serveur de fichiers contenant le contenu et d’autres ressources d’un site.</span><span class="sxs-lookup"><span data-stu-id="d0971-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="d0971-192">Il peut également s’agir d’une application métier personnalisée exécutée sur une machine virtuelle qui stocke ses données, ressources et son état sur des disques de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="d0971-193">Dans ce cas, il est important de veiller à effectuer des sauvegardes régulièrement.</span><span class="sxs-lookup"><span data-stu-id="d0971-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="d0971-194">La fréquence des sauvegardes doit être basée sur la nature de la charge de travail de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="d0971-195">Par exemple, si l’application s’exécute chaque jour et modifie des données, la sauvegarde doit être effectuée toutes les heures.</span><span class="sxs-lookup"><span data-stu-id="d0971-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="d0971-196">Voici un autre exemple : un serveur de rapports qui extrait des données provenant d’autres sources et génère des rapports agrégés.</span><span class="sxs-lookup"><span data-stu-id="d0971-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="d0971-197">La perte de cette machine virtuelle ou des disques entraîne la perte des rapports.</span><span class="sxs-lookup"><span data-stu-id="d0971-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="d0971-198">Toutefois, il est possible de réexécuter le processus de création de rapports et de regénérer la sortie.</span><span class="sxs-lookup"><span data-stu-id="d0971-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="d0971-199">Dans ce cas, vous ne rencontrez pas vraiment une perte de données, même si le serveur de rapports est touché par un sinistre. Vous pouvez donc avoir un niveau plus élevé de tolérance concernant la perte d’une partie des données du serveur de rapports.</span><span class="sxs-lookup"><span data-stu-id="d0971-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="d0971-200">Dans ce cas, des sauvegardes moins fréquentes sont une option permettant de réduire les coûts.</span><span class="sxs-lookup"><span data-stu-id="d0971-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="d0971-201">Scénario 4 : problèmes liés aux données d’une application IaaS</span><span class="sxs-lookup"><span data-stu-id="d0971-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="d0971-202">Vous avez une application qui calcule, tient à jour et gère des données commerciales critiques telles que des informations de tarification.</span><span class="sxs-lookup"><span data-stu-id="d0971-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="d0971-203">Une nouvelle version de votre application a rencontré un bogue logiciel qui a incorrectement calculé la tarification et a endommagé les données commerciales actuelles prises en charge par la plateforme.</span><span class="sxs-lookup"><span data-stu-id="d0971-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="d0971-204">Ici, le meilleur plan d’action est de commencer par rétablir la version antérieure de l’application et des données.</span><span class="sxs-lookup"><span data-stu-id="d0971-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="d0971-205">Pour ce faire, effectuez des sauvegardes périodiques de votre système.</span><span class="sxs-lookup"><span data-stu-id="d0971-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="d0971-206">Solution de récupération d’urgence : service Sauvegarde Azure</span><span class="sxs-lookup"><span data-stu-id="d0971-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="d0971-207">Le [service Sauvegarde Azure](https://azure.microsoft.com/services/backup/) peut être utilisé pour la sauvegarde et la récupération d’urgence et il fonctionne aussi bien avec les [disques managés](../../virtual-machines/windows/managed-disks-overview.md) que les [disques non managés](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="d0971-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) as well as [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="d0971-208">Vous pouvez créer un travail de sauvegarde avec des sauvegardes périodiques, une restauration facile des machines virtuelles et des stratégies de rétention de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="d0971-209">Si vous utilisez des [disques Stockage Premium](storage-premium-storage.md), des [disques managés](../../virtual-machines/windows/managed-disks-overview.md) ou d’autres types de disque avec l’option [Stockage localement redondant (LRS)](storage-redundancy.md#locally-redundant-storage) , il est particulièrement important de tirer parti des sauvegardes de récupération d’urgence périodiques.</span><span class="sxs-lookup"><span data-stu-id="d0971-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="d0971-210">Sauvegarde Azure stocke les données dans votre coffre Recovery Services pour une rétention à long terme.</span><span class="sxs-lookup"><span data-stu-id="d0971-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="d0971-211">Choisissez l’option [Stockage géoredondant (GRS)](storage-redundancy.md#geo-redundant-storage) pour le coffre Recovery Services du service Sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="d0971-212">Cela permet de garantir que les sauvegardes sont répliquées sur une région Azure différente afin d’assurer la protection contre les sinistres au niveau d’une région.</span><span class="sxs-lookup"><span data-stu-id="d0971-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="d0971-213">Pour les [disques non managés](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), vous pouvez utiliser le type de stockage LRS pour les disques IaaS, mais veillez à ce que Sauvegarde Azure soit activé avec l’option GRS pour le coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="d0971-213">For [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="d0971-214">**Si vous utilisez l’option [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) pour vos disques non managés, vous avez besoin de captures instantanées cohérentes pour la sauvegarde et la récupération d’urgence.**</span><span class="sxs-lookup"><span data-stu-id="d0971-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="d0971-215">Vous devez utiliser le [service Sauvegarde Azure](https://azure.microsoft.com/services/backup/) ou des [captures instantanées cohérentes](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="d0971-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="d0971-216">Voici un résumé des solutions de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="d0971-217">Scénario</span><span class="sxs-lookup"><span data-stu-id="d0971-217">Scenario</span></span> | <span data-ttu-id="d0971-218">Réplication automatique</span><span class="sxs-lookup"><span data-stu-id="d0971-218">Automatic Replication</span></span> | <span data-ttu-id="d0971-219">Solution de récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="d0971-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d0971-220">*Disques stockage Premium*</span><span class="sxs-lookup"><span data-stu-id="d0971-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="d0971-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="d0971-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="d0971-222">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="d0971-223">*Disques gérés*</span><span class="sxs-lookup"><span data-stu-id="d0971-223">*Managed Disks*</span></span> | <span data-ttu-id="d0971-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="d0971-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="d0971-225">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="d0971-226">*Disques LRS non managés*</span><span class="sxs-lookup"><span data-stu-id="d0971-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="d0971-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="d0971-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="d0971-228">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="d0971-229">*Disques GRS non managés*</span><span class="sxs-lookup"><span data-stu-id="d0971-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="d0971-230">Inter-région ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="d0971-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="d0971-231">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="d0971-232">Captures instantanées cohérentes</span><span class="sxs-lookup"><span data-stu-id="d0971-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="d0971-233">*Disques RA-GRS non managés*</span><span class="sxs-lookup"><span data-stu-id="d0971-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="d0971-234">Inter-région ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="d0971-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="d0971-235">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="d0971-236">Captures instantanées cohérentes</span><span class="sxs-lookup"><span data-stu-id="d0971-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="d0971-237">Pour obtenir une haute disponibilité, il est conseillé d’utiliser des disques managés dans un groupe à haute disponibilité avec Sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="d0971-238">Si vous utilisez des disques non managés, vous pouvez toujours utiliser Sauvegarde Azure pour la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="d0971-239">Si vous ne pouvez pas utiliser Sauvegarde Azure, une solution consiste à utiliser des [captures instantanées cohérentes](#alternative-solution-consistent-snapshots), comme décrit dans une section ultérieure.</span><span class="sxs-lookup"><span data-stu-id="d0971-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="d0971-240">Vos choix pour la haute disponibilité, la sauvegarde et la récupération d’urgence aux niveaux Application et Infrastructure peuvent être représentés comme suit :</span><span class="sxs-lookup"><span data-stu-id="d0971-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="d0971-241">*Niveau*</span><span class="sxs-lookup"><span data-stu-id="d0971-241">*Level*</span></span> | <span data-ttu-id="d0971-242">Haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="d0971-242">High Availability</span></span>   | <span data-ttu-id="d0971-243">Sauvegarde/récupération d’urgence</span><span class="sxs-lookup"><span data-stu-id="d0971-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="d0971-244">*Application*</span><span class="sxs-lookup"><span data-stu-id="d0971-244">*Application*</span></span> | <span data-ttu-id="d0971-245">SQL Always On</span><span class="sxs-lookup"><span data-stu-id="d0971-245">SQL Always On</span></span> | <span data-ttu-id="d0971-246">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="d0971-246">Azure Backup</span></span> |
| <span data-ttu-id="d0971-247">*Infrastructure*</span><span class="sxs-lookup"><span data-stu-id="d0971-247">*Infrastructure*</span></span>  | <span data-ttu-id="d0971-248">Groupe à haute disponibilité</span><span class="sxs-lookup"><span data-stu-id="d0971-248">Availability Set</span></span>  | <span data-ttu-id="d0971-249">GRS avec captures instantanées cohérentes</span><span class="sxs-lookup"><span data-stu-id="d0971-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="d0971-250">Utilisation du service Sauvegarde Azure</span><span class="sxs-lookup"><span data-stu-id="d0971-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="d0971-251">[Sauvegarde Azure](../../backup/backup-azure-vms-introduction.md) peut sauvegarder vos machines virtuelles exécutant Windows ou Linux dans le coffre Azure Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="d0971-251">[Azure Backup](../../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="d0971-252">La sauvegarde et la restauration des données critiques sont compliquées par le fait qu’elles doivent être sauvegardées alors que les applications qui génèrent les données sont en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="d0971-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="d0971-253">Pour résoudre ce problème, Sauvegarde Azure fournit des sauvegardes cohérentes entre les applications pour les charges de travail Microsoft en utilisant le service VSS (Volume Shadow Service) pour s’assurer que les données sont correctement écrites dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="d0971-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="d0971-254">Pour les machines virtuelles Linux, seules les sauvegardes cohérentes au niveau fichier sont possibles, car l’équivalent de la fonctionnalité VSS n’existe pas sous Linux.</span><span class="sxs-lookup"><span data-stu-id="d0971-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png)   

<span data-ttu-id="d0971-255">Lorsque le service Sauvegarde Azure lance le travail de sauvegarde à l’heure planifiée, il déclenche l’extension de sauvegarde installée dans la machine virtuelle pour prendre une capture instantanée à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="d0971-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="d0971-256">Cette capture instantanée est prise de façon coordonnée avec VSS pour obtenir une capture instantanée cohérente des disques de la machine virtuelle sans avoir à arrêter cette dernière.</span><span class="sxs-lookup"><span data-stu-id="d0971-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="d0971-257">L’extension de sauvegarde de la machine virtuelle vide toutes les écritures avant de prendre la capture instantanée cohérente de tous les disques.</span><span class="sxs-lookup"><span data-stu-id="d0971-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="d0971-258">Une fois la capture instantanée réalisée, les données sont transférées par le service Sauvegarde Azure dans le coffre de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="d0971-259">Pour rendre le processus de sauvegarde plus efficace, le service identifie et transfère uniquement les blocs de données qui ont été modifiés depuis la sauvegarde précédente.</span><span class="sxs-lookup"><span data-stu-id="d0971-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="d0971-260">Pour effectuer la restauration, vous pouvez afficher les sauvegardes disponibles au moyen de Sauvegarde Azure, puis lancer une restauration.</span><span class="sxs-lookup"><span data-stu-id="d0971-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="d0971-261">Vous pouvez créer et restaurer des sauvegardes Azure au moyen du [portail Azure](https://portal.azure.com/), de [PowerShell](../../backup/backup-azure-vms-automation.md ) ou de l’interface [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="d0971-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="d0971-262">Pour plus d’informations, consultez la page relative à Sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="d0971-263">Étapes à suivre pour activer la sauvegarde</span><span class="sxs-lookup"><span data-stu-id="d0971-263">Steps to Enable Backup</span></span>

<span data-ttu-id="d0971-264">Les étapes suivantes sont généralement suivies pour activer les sauvegardes de vos machines virtuelles à l’aide du [portail Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="d0971-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="d0971-265">Cela peut varier légèrement en fonction de votre scénario.</span><span class="sxs-lookup"><span data-stu-id="d0971-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="d0971-266">Pour plus d’informations, consultez la documentation [Sauvegarde Azure](../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-266">Refer to the [Azure Backup](../../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="d0971-267">Sauvegarde Azure [prend également en charge les machines virtuelles avec des disques managés](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="d0971-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="d0971-268">Pour créer un coffre Recovery Services pour une machine virtuelle, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="d0971-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="d0971-269">a.</span><span class="sxs-lookup"><span data-stu-id="d0971-269">a.</span></span>  <span data-ttu-id="d0971-270">Dans le [portail Azure](https://portal.azure.com/), parcourez toutes les ressources et recherchez Coffres Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="d0971-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="d0971-271">b.</span><span class="sxs-lookup"><span data-stu-id="d0971-271">b.</span></span>  <span data-ttu-id="d0971-272">Dans le menu Coffres Recovery Services, cliquez sur Ajouter et suivez les étapes pour créer un coffre dans la même région que la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="d0971-273">Par exemple, si votre machine virtuelle est située dans la région Ouest des États-Unis, vous pouvez choisir Ouest des États-Unis pour le coffre.</span><span class="sxs-lookup"><span data-stu-id="d0971-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="d0971-274">Vérifiez la réplication du stockage pour le nouveau coffre.</span><span class="sxs-lookup"><span data-stu-id="d0971-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="d0971-275">Pour ce faire, accédez au coffre à partir du panneau Coffres Recovery Services, puis accédez aux paramètres de configuration de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="d0971-276">Veillez à ce que l’option GRS soit sélectionnée par défaut.</span><span class="sxs-lookup"><span data-stu-id="d0971-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="d0971-277">Cela garantit que votre coffre est automatiquement répliqué vers un centre de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="d0971-278">Par exemple, votre coffre de la région Ouest des États-Unis est automatiquement répliqué vers la région Est des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="d0971-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="d0971-279">Configurez la stratégie de sauvegarde et sélectionnez la machine virtuelle à partir de la même interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="d0971-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="d0971-280">Vérifiez que l’agent de sauvegarde est installé sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="d0971-281">Si votre machine virtuelle est créée à l’aide d’une image de la galerie Azure, l’agent de sauvegarde est déjà installé.</span><span class="sxs-lookup"><span data-stu-id="d0971-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="d0971-282">Sinon (autrement dit, si vous utilisez une image personnalisée), utilisez les instructions de la page [Installer l’agent de machine virtuelle sur la machine virtuelle](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="d0971-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="d0971-283">Vérifiez que la machine virtuelle autorise la connectivité réseau pour que le service de sauvegarde fonctionne.</span><span class="sxs-lookup"><span data-stu-id="d0971-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="d0971-284">Suivez ces instructions relatives à la [connectivité réseau](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="d0971-284">Follow these instructions for [Network connectivity](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="d0971-285">Une fois les étapes ci-dessus terminées, la sauvegarde s’exécute à intervalles réguliers, comme spécifié dans la stratégie de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="d0971-286">Si nécessaire, vous pouvez déclencher la première sauvegarde manuellement à partir du tableau de bord du coffre sur le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="d0971-287">Pour automatiser l’utilisation de scripts par Sauvegarde Azure, reportez-vous à [Applets de commande PowerShell pour la sauvegarde de machines virtuelles](../../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="d0971-288">Étapes de récupération</span><span class="sxs-lookup"><span data-stu-id="d0971-288">Steps for Recovery</span></span>

<span data-ttu-id="d0971-289">Si vous devez réparer ou regénérer une machine virtuelle, vous pouvez la restaurer à partir des points de récupération de sauvegarde dans le coffre.</span><span class="sxs-lookup"><span data-stu-id="d0971-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="d0971-290">Il existe deux options différentes pour effectuer la récupération :</span><span class="sxs-lookup"><span data-stu-id="d0971-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="d0971-291">Vous pouvez créer une machine virtuelle en tant que représentation jusqu’à une date et une heure de votre machine virtuelle sauvegardée.</span><span class="sxs-lookup"><span data-stu-id="d0971-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="d0971-292">Vous pouvez restaurer les disques, puis utiliser le modèle de la machine virtuelle pour personnaliser et recréer la machine virtuelle restaurée.</span><span class="sxs-lookup"><span data-stu-id="d0971-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="d0971-293">Consultez les instructions à la page [Utiliser le portail Azure pour restaurer des machines virtuelles](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="d0971-293">See instructions to [Use Azure portal to restore virtual machines](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="d0971-294">Le document explique également les étapes spécifiques permettant de restaurer les machines virtuelles sauvegardées dans le centre de données associé à l’aide de votre coffre de sauvegarde géoredondant en cas de sinistre dans le centre de données primaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="d0971-295">Dans ce cas, Sauvegarde Azure utilise le service Compute de la région secondaire pour créer la machine virtuelle restaurée.</span><span class="sxs-lookup"><span data-stu-id="d0971-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="d0971-296">Vous pouvez également utiliser PowerShell pour [restaurer une machine virtuelle](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) ou [créer une machine virtuelle à partir de disques restaurés](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="d0971-296">You can also use PowerShell for [restoring a VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="d0971-297">Solution alternative : captures instantanées cohérentes</span><span class="sxs-lookup"><span data-stu-id="d0971-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="d0971-298">Si vous ne pouvez pas utiliser le service Sauvegarde Azure, vous pouvez implémenter votre propre mécanisme de sauvegarde à l’aide de captures instantanées.</span><span class="sxs-lookup"><span data-stu-id="d0971-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="d0971-299">Il est compliqué de créer des captures instantanées cohérentes pour tous les disques utilisés par une machine virtuelle, puis de répliquer ces captures instantanées vers une autre région.</span><span class="sxs-lookup"><span data-stu-id="d0971-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="d0971-300">Pour cette raison, Azure considère qu’il est préférable d’utiliser le service Sauvegarde plutôt que de créer une solution personnalisée.</span><span class="sxs-lookup"><span data-stu-id="d0971-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="d0971-301">Si vous utilisez le stockage RA-GRS/GRS pour les disques, les captures instantanées sont automatiquement répliquées vers un centre de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="d0971-302">Si vous utilisez le stockage LRS pour les disques, vous devez répliquer les données vous-même.</span><span class="sxs-lookup"><span data-stu-id="d0971-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="d0971-303">Pour plus d’informations, consultez [Sauvegarder les disques de machines virtuelles Azure non gérés avec des captures instantanées incrémentielles](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="d0971-304">Une capture instantanée est une représentation sous la forme d’un objet à un point spécifique dans le temps.</span><span class="sxs-lookup"><span data-stu-id="d0971-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="d0971-305">Une capture instantanée entraîne la facturation de la taille incrémentielle des données qu’elle contient.</span><span class="sxs-lookup"><span data-stu-id="d0971-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="d0971-306">Pour plus d’informations, consultez [Création d’un instantané d’objet blob](../blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-306">For more information, see [Create a blob snapshot](../blobs/storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="d0971-307">Création de captures instantanées pendant l’exécution de la machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="d0971-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="d0971-308">Quand vous prenez une capture instantanée à un moment donné, si la machine virtuelle est en cours d’exécution, il y a toujours des données qui sont diffusées vers les disques et les captures instantanées peuvent contenir des opérations partielles qui étaient en cours.</span><span class="sxs-lookup"><span data-stu-id="d0971-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="d0971-309">En outre, si plusieurs disques sont impliqués, les captures instantanées des différents disques se sont peut-être produites à différents moments, et il est donc possible qu’elles ne soient pas coordonnées.</span><span class="sxs-lookup"><span data-stu-id="d0971-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="d0971-310">Cela est particulièrement problématique pour les volumes agrégés par bandes dont les fichiers peuvent être endommagés si des modifications sont apportées pendant la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="d0971-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="d0971-311">Pour éviter cette situation, le processus de sauvegarde doit implémenter les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="d0971-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="d0971-312">Figer tous les disques</span><span class="sxs-lookup"><span data-stu-id="d0971-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="d0971-313">Vider toutes les écritures en attente</span><span class="sxs-lookup"><span data-stu-id="d0971-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="d0971-314">[Créer une capture instantanée de blob](../blobs/storage-blob-snapshots.md) pour tous les disques</span><span class="sxs-lookup"><span data-stu-id="d0971-314">Then, [create a blob snapshot](../blobs/storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="d0971-315">Certaines applications Windows telles que SQL Server fournissent un mécanisme de sauvegarde coordonné via VSS pour créer des sauvegardes cohérentes entre les applications.</span><span class="sxs-lookup"><span data-stu-id="d0971-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="d0971-316">Sur Linux, vous pouvez utiliser un outil tel que fsfreeze pour coordonner les disques, ce qui fournit des sauvegardes cohérentes au niveau fichier, mais pas de captures instantanés cohérentes au niveau application.</span><span class="sxs-lookup"><span data-stu-id="d0971-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="d0971-317">Ce processus étant compliqué, envisagez d’utiliser le service [Sauvegarde Azure](../../backup/backup-azure-vms-introduction.md) ou une solution de sauvegarde tierce qui implémente déjà cela.</span><span class="sxs-lookup"><span data-stu-id="d0971-317">This process is complicated, so and you should consider using [Azure Backup](../../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="d0971-318">Le processus ci-dessus produit une collection de captures instantanées coordonnées pour tous les disques de machine virtuelle, ce qui représente une vue dans le temps spécifique de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="d0971-319">Il s’agit d’un point de restauration de sauvegarde pour la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="d0971-320">Vous pouvez répéter le processus à intervalles réguliers pour créer des sauvegardes périodiques.</span><span class="sxs-lookup"><span data-stu-id="d0971-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="d0971-321">Consultez ci-dessous les étapes permettant de [copier les sauvegardes vers une autre région](#copy-the-snapshots-to-another-region) à des fins de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="d0971-322">Création de captures instantanées quand la machine virtuelle est en mode hors connexion</span><span class="sxs-lookup"><span data-stu-id="d0971-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="d0971-323">Une autre option pour créer des sauvegardes cohérentes est d’arrêter la machine virtuelle et de prendre des captures instantanées de blob de chaque disque.</span><span class="sxs-lookup"><span data-stu-id="d0971-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="d0971-324">Cette opération est plus facile que de coordonner les captures instantanées d’une machine virtuelle en cours d’exécution, mais elle nécessite un temps d’arrêt de quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="d0971-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="d0971-325">Pour ce processus, procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="d0971-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="d0971-326">Arrêtez la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-326">Shut down the VM.</span></span>

2. <span data-ttu-id="d0971-327">Créez une capture instantanée de chaque blob de disque dur virtuel. Cette opération ne prend que quelques secondes.</span><span class="sxs-lookup"><span data-stu-id="d0971-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="d0971-328">Pour créer une capture instantanée, vous pouvez utiliser [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), l’[API REST Stockage Azure](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install) ou l’une des bibliothèques clientes Stockage Azure comme [la bibliothèque cliente Stockage pour .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="d0971-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="d0971-329">Démarrez la machine virtuelle, ce qui met fin au temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="d0971-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="d0971-330">En général, l’ensemble du processus se termine en quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="d0971-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="d0971-331">Ce processus génère une collection de captures instantanées cohérentes pour tous les disques, en fournissant un point de restauration de sauvegarde pour la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="d0971-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="d0971-332">Consultez ci-dessous les étapes permettant de copier les captures instantanées vers une autre région à des fins de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="d0971-333">Copier les captures instantanées vers une autre région</span><span class="sxs-lookup"><span data-stu-id="d0971-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="d0971-334">La création de captures instantanées uniquement n’est peut-être pas suffisante pour la récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="d0971-335">Vous devez également répliquer les sauvegardes de captures instantanées vers une autre région.</span><span class="sxs-lookup"><span data-stu-id="d0971-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="d0971-336">Si vous utilisez le stockage GRS ou RA-GRS pour vos disques, les captures instantanées sont automatiquement répliquées dans la région secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="d0971-337">Il peut y avoir un délai de quelques minutes avant la réplication et si le centre de données principal tombe en panne avant la fin de la réplication des captures instantanées, vous ne pouvez pas accéder aux captures instantanées à partir du centre de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="d0971-338">La probabilité que cela se produise est faible.</span><span class="sxs-lookup"><span data-stu-id="d0971-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="d0971-339">Avoir des disques dans un compte GRS ou RA-GRS uniquement ne protège pas la machine virtuelle contre les incidents.</span><span class="sxs-lookup"><span data-stu-id="d0971-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="d0971-340">Vous devez également créer des captures instantanées coordonnées ou utiliser Sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="d0971-341">Cela est nécessaire pour récupérer une machine virtuelle dans un état cohérent.</span><span class="sxs-lookup"><span data-stu-id="d0971-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="d0971-342">Si vous utilisez LRS, vous devez copier les captures instantanées dans un autre compte de stockage immédiatement après leur création.</span><span class="sxs-lookup"><span data-stu-id="d0971-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="d0971-343">La cible de la copie peut être un compte de stockage LRS dans une région différente, ce qui entraîne la génération d’une copie dans une région éloignée.</span><span class="sxs-lookup"><span data-stu-id="d0971-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="d0971-344">Vous pouvez également copier la capture instantanée dans un compte de stockage RA-GRS dans la même région.</span><span class="sxs-lookup"><span data-stu-id="d0971-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="d0971-345">Dans ce cas, la capture instantanée est répliquée tardivement dans la région secondaire distante.</span><span class="sxs-lookup"><span data-stu-id="d0971-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="d0971-346">Votre sauvegarde est protégée contre les sinistres sur le site principal une fois que la copie et la réplication sont terminées.</span><span class="sxs-lookup"><span data-stu-id="d0971-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="d0971-347">Pour copier efficacement vos captures instantanées incrémentielles à des fins de récupération d’urgence, consultez les instructions figurant dans [Sauvegarder des disques de machine virtuelle non managés Azure avec des captures instantanées incrémentielles](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png)   

### <a name="recovery-from-snapshots"></a><span data-ttu-id="d0971-348">Récupération à partir de captures instantanées</span><span class="sxs-lookup"><span data-stu-id="d0971-348">Recovery from Snapshots</span></span>

<span data-ttu-id="d0971-349">Pour récupérer une capture instantanée, copiez-la pour créer un nouveau blob.</span><span class="sxs-lookup"><span data-stu-id="d0971-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="d0971-350">Si vous copiez la capture instantanée à partir du compte principal, vous pouvez la copier dans le blob de base de la capture instantanée, et ainsi rétablir le disque vers la capture instantanée. Ce processus est également appelé « promotion de la capture instantanée ».</span><span class="sxs-lookup"><span data-stu-id="d0971-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="d0971-351">Si vous copiez la sauvegarde de capture instantanée à partir d’un compte secondaire (dans le cas d’un stockage RA-GRS), celle-ci doit être copiée dans un compte principal.</span><span class="sxs-lookup"><span data-stu-id="d0971-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="d0971-352">Vous pouvez copier une capture instantanée [à l’aide de PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) ou de l’utilitaire AzCopy.</span><span class="sxs-lookup"><span data-stu-id="d0971-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="d0971-353">Pour plus d’informations, consultez [Transfert de données avec l’utilitaire de ligne de commande AzCopy](storage-use-azcopy.md) .</span><span class="sxs-lookup"><span data-stu-id="d0971-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="d0971-354">Dans le cas des machines virtuelles contenant plusieurs disques, vous devez copier toutes les captures instantanées qui font partie du même point de restauration coordonné.</span><span class="sxs-lookup"><span data-stu-id="d0971-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="d0971-355">Une fois que vous copiez les captures instantanées vers des blobs de disque dur virtuel accessibles en écriture, vous pouvez utiliser les blobs pour recréer votre machine virtuelle à l’aide du modèle correspondant.</span><span class="sxs-lookup"><span data-stu-id="d0971-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="d0971-356">Autres options</span><span class="sxs-lookup"><span data-stu-id="d0971-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="d0971-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="d0971-357">SQL Server</span></span>

<span data-ttu-id="d0971-358">SQL Server exécuté dans une machine virtuelle a ses propres fonctionnalités intégrées permettant de sauvegarder votre base de données SQL Server vers Stockage Blob Azure ou un partage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="d0971-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="d0971-359">Si le compte de stockage est GRS ou RA-GRS, vous pouvez accéder à ces sauvegardes dans le centre de données secondaire du compte de stockage en cas de sinistre, avec les restrictions indiquées précédemment.</span><span class="sxs-lookup"><span data-stu-id="d0971-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="d0971-360">Pour plus d’informations, voir [Sauvegarde et restauration de SQL Server dans les machines virtuelles Azure](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="d0971-361">En plus de la sauvegarde et de la restauration, [les groupes de disponibilité SQL Server AlwaysOn](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) peuvent gérer les réplicas secondaires de bases de données pour réduire considérablement le temps de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="d0971-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="d0971-362">Autres points à considérer</span><span class="sxs-lookup"><span data-stu-id="d0971-362">Other considerations</span></span>

<span data-ttu-id="d0971-363">Cet article a décrit la sauvegarde ou la réalisation de captures instantanées de vos machines virtuelles et de leurs disques pour prendre en charge la récupération d’urgence. Il a également présenté leur utilisation dans le cadre d’une récupération.</span><span class="sxs-lookup"><span data-stu-id="d0971-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="d0971-364">Avec le modèle Azure Resource Manager, de nombreuses personnes utilisent des modèles pour créer leurs machines virtuelles et d’autres infrastructures dans Azure.</span><span class="sxs-lookup"><span data-stu-id="d0971-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="d0971-365">Vous pouvez utiliser un modèle pour créer une machine virtuelle qui possède la même configuration à chaque fois.</span><span class="sxs-lookup"><span data-stu-id="d0971-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="d0971-366">Si vous utilisez des images personnalisées pour la création de vos machines virtuelles, vous devez également vérifier que vos images sont protégées en utilisant un compte RA-GRS pour les stocker.</span><span class="sxs-lookup"><span data-stu-id="d0971-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="d0971-367">Par conséquent, votre processus de sauvegarde peut être une combinaison de deux éléments :</span><span class="sxs-lookup"><span data-stu-id="d0971-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="d0971-368">Sauvegarder les données (disques)</span><span class="sxs-lookup"><span data-stu-id="d0971-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="d0971-369">Sauvegarder la configuration (modèles, images personnalisées)</span><span class="sxs-lookup"><span data-stu-id="d0971-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="d0971-370">Selon l’option de sauvegarde que vous choisissez, vous devrez peut-être gérer la sauvegarde des données et de la configuration ou il se peut que le service Sauvegarde gère tout cela pour vous.</span><span class="sxs-lookup"><span data-stu-id="d0971-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="d0971-371">Annexe - Comprendre l’impact des stockages LRS, GRS et RA-GRS</span><span class="sxs-lookup"><span data-stu-id="d0971-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="d0971-372">Pour les comptes de stockage dans Azure, il existe trois types de redondance de données que vous devez prendre en compte lors d’une récupération d’urgence : le stockage localement redondant (LRS), le stockage géoredondant (GRS) ou le stockage géoredondant avec accès en lecture (RA-GRS).</span><span class="sxs-lookup"><span data-stu-id="d0971-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="d0971-373">Le stockage localement redondant (LRS) conserve trois copies des données dans le même centre de données.</span><span class="sxs-lookup"><span data-stu-id="d0971-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="d0971-374">Lorsque vous écrivez des données, les trois copies sont mises à jour avant qu’un message de réussite ne soit retourné à l’appelant. Vous savez donc qu’elles sont identiques.</span><span class="sxs-lookup"><span data-stu-id="d0971-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="d0971-375">Votre disque est protégé contre les défaillances locales, car il est très peu probable que les trois copies soient affectées en même temps.</span><span class="sxs-lookup"><span data-stu-id="d0971-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="d0971-376">Dans le cas du stockage LRS, il n’y a pas de géoredondance. Par conséquent, le disque n’est pas protégé contre les défaillances graves qui peuvent avoir un impact sur une unité de stockage ou un centre de données entier.</span><span class="sxs-lookup"><span data-stu-id="d0971-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="d0971-377">Avec les stockages GRS et RA-GRS, trois copies de vos données sont conservées dans la région primaire (que vous avez choisie) et trois autres copies sont conservées dans une région secondaire correspondante (définie par Azure).</span><span class="sxs-lookup"><span data-stu-id="d0971-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="d0971-378">Par exemple, si vous stockez des données dans la région Ouest des États-Unis, celles-ci sont répliquées dans la région Est des États-Unis.</span><span class="sxs-lookup"><span data-stu-id="d0971-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="d0971-379">Cette opération est effectuée en mode asynchrone et il existe un léger délai entre les mises à jour vers les régions primaires et secondaires.</span><span class="sxs-lookup"><span data-stu-id="d0971-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="d0971-380">Les réplicas des disques sur le site secondaire sont cohérents par disque (avec le délai), mais les réplicas de plusieurs disques actifs peuvent ne pas être synchronisés **entre eux**.</span><span class="sxs-lookup"><span data-stu-id="d0971-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="d0971-381">Pour avoir des réplicas cohérents sur plusieurs disques, les captures instantanées cohérentes sont nécessaires.</span><span class="sxs-lookup"><span data-stu-id="d0971-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="d0971-382">La principale différence entre les stockages GRS et RA-GRS est que, avec l’option RA-GRS, vous pouvez lire la copie secondaire à tout moment.</span><span class="sxs-lookup"><span data-stu-id="d0971-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="d0971-383">S’il existe un problème à cause duquel les données de la région primaire sont inaccessibles, l’équipe Azure s’efforce de rétablir l’accès.</span><span class="sxs-lookup"><span data-stu-id="d0971-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="d0971-384">Quand la région primaire est en panne, si vous avez activé le stockage RA-GRS, vous pouvez accéder aux données dans le centre de données secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="d0971-385">Par conséquent, si vous envisagez de lire à partir du réplica alors que la région primaire n’est pas accessible, le stockage RA-GRS doit être envisagé.</span><span class="sxs-lookup"><span data-stu-id="d0971-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="d0971-386">S’il s’agit d’une interruption importante, l’équipe Azure peut déclencher un basculement géographique et modifier les entrées DNS principales pour qu’elles pointent vers le stockage secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="d0971-387">À ce stade, si vous avez activé le stockage GRS ou RA-GRS, vous pouvez accéder aux données dans la région utilisée comme région secondaire.</span><span class="sxs-lookup"><span data-stu-id="d0971-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="d0971-388">En d’autres termes, si votre compte de stockage est GRS et qu’un problème survient, vous pouvez accéder au stockage secondaire uniquement s’il existe un basculement géographique.</span><span class="sxs-lookup"><span data-stu-id="d0971-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="d0971-389">Pour plus d’informations, consultez [Que faire en cas de panne du stockage Azure](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="d0971-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="d0971-390">Notez que Microsoft contrôle si un basculement se produit.</span><span class="sxs-lookup"><span data-stu-id="d0971-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="d0971-391">Le basculement n’est pas contrôlé par le compte de stockage. Par conséquent, il n’est pas décidé par les clients individuels.</span><span class="sxs-lookup"><span data-stu-id="d0971-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="d0971-392">Pour implémenter la récupération d’urgence pour des comptes de stockage ou disques de machine virtuelle spécifiques, vous devez utiliser les techniques décrites précédemment dans cet article.</span><span class="sxs-lookup"><span data-stu-id="d0971-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>
