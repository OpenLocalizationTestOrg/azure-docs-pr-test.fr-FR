---
title: "Fonctionnement de la réplication Hyper-V sur Azure dans Site Recovery | Microsoft Docs"
description: "Cet article fournit une vue d’ensemble du fonctionnement de la réplication Hyper-V dans Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: 6fa952af93033f82effdef418903fc93d94dd05c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work"></a><span data-ttu-id="dd5ee-104">Fonctionnement de la réplication Hyper-V sur Azure</span><span class="sxs-lookup"><span data-stu-id="dd5ee-104">How does Hyper-V replication to Azure work?</span></span>

<span data-ttu-id="dd5ee-105">Lisez cet article pour comprendre l’architecture et les flux de travail de la réplication Hyper-V sur Azure à l’aide du service [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-105">Read this article to understand the architecture and workflows for Hyper-V replication to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="dd5ee-106">Publiez des commentaires au bas de cet article, ou sur le [Forum Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="dd5ee-107">Vous pouvez répliquer les éléments suivants dans Azure :</span><span class="sxs-lookup"><span data-stu-id="dd5ee-107">You can replicate the following to Azure:</span></span>
- <span data-ttu-id="dd5ee-108">**Hyper-V avec VMM** : machines virtuelles situées sur les hôtes Hyper-V locaux gérés dans des clouds System Center Virtual Machine Manager (VMM).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="dd5ee-109">Les hôtes peuvent exécuter tout type de [système d’exploitation pris en charge](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="dd5ee-110">Vous pouvez répliquer des machines virtuelles Hyper-V exécutant un système d’exploitation invité [pris en charge par Hyper-V et Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="dd5ee-111">**Hyper-V sans VMM** : machines virtuelles locales situées sur des hôtes Hyper-V qui ne sont pas gérés dans des clouds VMM.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="dd5ee-112">Les hôtes peuvent exécuter n’importe quel [système d’exploitation pris en charge](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-112">Hosts can run any of the [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="dd5ee-113">Vous pouvez répliquer des machines virtuelles Hyper-V exécutant un système d’exploitation invité [pris en charge par Hyper-V et Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="dd5ee-114">Composants architecturaux</span><span class="sxs-lookup"><span data-stu-id="dd5ee-114">Architectural components</span></span>

<span data-ttu-id="dd5ee-115">**Zone**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-115">**Area**</span></span> | <span data-ttu-id="dd5ee-116">**Composant**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-116">**Component**</span></span> | <span data-ttu-id="dd5ee-117">**Détails**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="dd5ee-118">**Microsoft Azure**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-118">**Azure**</span></span> | <span data-ttu-id="dd5ee-119">Dans Azure, vous avez besoin d’un compte Microsoft Azure, d’un compte de stockage Azure et d’un réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="dd5ee-120">Le stockage et le réseau peuvent être des comptes Resource Manager ou Classic.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="dd5ee-121">Les données répliquées sont stockées dans le compte de stockage, et les machines virtuelles Azure sont créées avec les données répliquées lors du basculement à partir de votre site local.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-121">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="dd5ee-122">Les machines virtuelles Azure se connectent au réseau virtuel Azure lors de leur création.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-122">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="dd5ee-123">**Serveur VMM**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-123">**VMM server**</span></span> | <span data-ttu-id="dd5ee-124">Hôtes Hyper-V situés dans des clouds VMM</span><span class="sxs-lookup"><span data-stu-id="dd5ee-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="dd5ee-125">Si les hôtes Hyper-V sont gérés dans des clouds VMM, vous inscrivez le serveur VMM dans le coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-125">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="dd5ee-126">Sur le serveur VMM, vous installez le fournisseur Site Recovery pour orchestrer la réplication avec Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-126">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="dd5ee-127">Vous avez besoin d’un réseau logique et d’un réseau de machines virtuelles pour configurer le mappage réseau.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-127">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="dd5ee-128">Un réseau de machines virtuelles doit être lié à un réseau logique lui-même associé au cloud.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-128">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="dd5ee-129">**Hôte Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-129">**Hyper-V host**</span></span> | <span data-ttu-id="dd5ee-130">Les serveurs Hyper-V peuvent être déployés avec ou sans serveur VMM.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="dd5ee-131">S’il n’existe aucun serveur VMM, le fournisseur Site Recovery est installé sur l’hôte pour orchestrer la réplication avec Site Recovery via Internet.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-131">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="dd5ee-132">S’il existe un serveur VMM, le fournisseur est installé sur ce dernier et non sur l’hôte.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-132">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="dd5ee-133">L’agent Recovery Services est installé sur l’hôte pour gérer la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-133">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="dd5ee-134">Les communications en provenance du fournisseur et de l’agent sont sécurisées et chiffrées.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-134">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="dd5ee-135">Les données répliquées dans le stockage Azure sont également chiffrées.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="dd5ee-136">**Machines virtuelles Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="dd5ee-137">Vous devez avoir une ou plusieurs machines virtuelles sur le serveur hôte Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-137">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="dd5ee-138">Rien ne doit explicitement être installé sur les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-138">Nothing needs to explicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="dd5ee-139">Étapes du déploiement</span><span class="sxs-lookup"><span data-stu-id="dd5ee-139">Deployment steps</span></span>

1. <span data-ttu-id="dd5ee-140">**Azure** : vous configurez les composants Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-140">**Azure**: You set up the Azure components.</span></span> <span data-ttu-id="dd5ee-141">Nous vous recommandons de configurer les comptes de stockage et de réseau avant de lancer le déploiement de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="dd5ee-142">**Coffre** : vous créez un coffre Recovery Services pour Site Recovery et vous configurez les paramètres du coffre, y compris les paramètres sources et cibles, la définition d’une stratégie de réplication et l’activation de la réplication.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="dd5ee-143">**Source et cible** :</span><span class="sxs-lookup"><span data-stu-id="dd5ee-143">**Source and target**:</span></span>
    - <span data-ttu-id="dd5ee-144">**Hôtes Hyper-V dans des clouds VMM** : dans le cadre de la définition des paramètres sources, vous téléchargez et installez le fournisseur Azure Site Recovery sur le serveur VMM et l’agent Azure Recovery Services sur chaque hôte Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install the Azure Site Recovery Provider on the VMM server, and the Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="dd5ee-145">La source est le serveur VMM.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-145">The source will be the VMM server.</span></span> <span data-ttu-id="dd5ee-146">La cible est Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-146">The target is Azure.</span></span>
    - <span data-ttu-id="dd5ee-147">Hôtes Hyper-V sans VMM : quand vous définissez des paramètres sources, vous téléchargez et installez le fournisseur et l’agent sur chaque hôte Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-147">Hyper-V hosts without VMM: When you specify source settings, you download and install the Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="dd5ee-148">Au cours du déploiement, vous regroupez les hôtes dans un site Hyper-V et spécifiez ce site comme source.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-148">During deployment you gather the hosts into a Hyper-V site, and specify this site as the source.</span></span> <span data-ttu-id="dd5ee-149">La cible est Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-149">The target is Azure.</span></span>

    <span data-ttu-id="dd5ee-150">![Réplication Hyper-V/VMM vers Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![la réplication de site Hyper-V vers Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-150">![Hyper-V/VMM replication to Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication to Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="dd5ee-151">**Stratégie de réplication** : vous créez une stratégie de réplication pour le site Hyper-V ou le cloud VMM.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-151">**Replication policy**: You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="dd5ee-152">La stratégie est appliquée à toutes les machines virtuelles situées sur les hôtes du site ou du cloud.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-152">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
5. <span data-ttu-id="dd5ee-153">**Activer la réplication** : vous activez la réplication pour les machines virtuelles Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="dd5ee-154">La réplication initiale se déclenche selon les paramètres de la stratégie de réplication.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-154">Initial replication occurs in accordance with the replication policy settings.</span></span> <span data-ttu-id="dd5ee-155">Les modifications des données font l’objet d’un suivi et la réplication des modifications delta dans Azure débute après la réplication initiale.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-155">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="dd5ee-156">Les modifications qui font l’objet d’un suivi sont conservées dans un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="dd5ee-157">**Test de basculement** : vous exécutez un test de basculement pour vérifier que tout fonctionne bien.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-157">**Test failover**:  You run a test failover to make sure everything's working as expected.</span></span>

<span data-ttu-id="dd5ee-158">Pour en savoir plus sur le déploiement :</span><span class="sxs-lookup"><span data-stu-id="dd5ee-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="dd5ee-159">Prise en main de la réplication des machines virtuelles Hyper-V sur Azure (avec VMM)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-159">Get started with Hyper-V VM replication to Azure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="dd5ee-160">Prise en main de la réplication des machines virtuelles Hyper-V sur Azure (sans VMM)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-160">Get started with Hyper-V VM replication to Azure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="dd5ee-161">Flux de travail de réplication Hyper-V</span><span class="sxs-lookup"><span data-stu-id="dd5ee-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="dd5ee-162">Activer la protection</span><span class="sxs-lookup"><span data-stu-id="dd5ee-162">Enable protection</span></span>

1. <span data-ttu-id="dd5ee-163">Une fois que vous activez la protection d’une machine virtuelle Hyper-V, dans le portail Azure ou en local, **l’activation de la protection** démarre.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-163">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="dd5ee-164">Le travail vérifie que la machine est conforme à la configuration requise, puis appelle la méthode [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), laquelle configure la réplication avec les paramètres que vous avez configurés.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-164">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="dd5ee-165">Le travail démarre la réplication initiale en appelant la méthode [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) pour initialiser une réplication complète de la machine virtuelle et envoyer les disques virtuels de la machine virtuelle sur Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-165">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="dd5ee-166">Vous pouvez surveiller le travail dans l'onglet **Travaux**.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-166">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="dd5ee-167">![Liste des travaux](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Activer l’exploration de la protection](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-167">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="dd5ee-168">Réplication initiale</span><span class="sxs-lookup"><span data-stu-id="dd5ee-168">Initial replication</span></span>

1. <span data-ttu-id="dd5ee-169">Un [instantané des machines virtuelles Hyper-V](https://technet.microsoft.com/library/dd560637.aspx) a lieu au moment où la réplication initiale est déclenchée.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-169">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="dd5ee-170">Les disques durs virtuels sont répliqués un par un jusqu'à ce qu’ils soient copiés sur Azure.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-170">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="dd5ee-171">Cela peut prendre un certain temps selon la taille de la machine virtuelle et la bande passante réseau.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-171">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="dd5ee-172">Pour savoir comment optimiser l’utilisation du réseau, consultez la page [Gestion de l’utilisation de la bande passante réseau de protection d’un serveur local vers Azure](https://support.microsoft.com/kb/3056159).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-172">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="dd5ee-173">Si des modifications interviennent sur les disques pendant la réplication initiale, le dispositif de suivi de réplication des réplicas Hyper-V assure le suivi de ces modifications dans des journaux de réplication Hyper-V (.hrl)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-173">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="dd5ee-174">qui se trouvent dans le même dossier que les disques.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-174">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="dd5ee-175">À chaque disque correspond un fichier .hrl, qui est envoyé au stockage secondaire.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-175">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="dd5ee-176">L’instantané et les fichiers journaux consomment des ressources disque pendant la réplication initiale.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-176">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="dd5ee-177">Lorsque la réplication initiale s’achève, l’instantané de machine virtuelle est supprimé.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-177">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="dd5ee-178">Les modifications d’ordre différentiel dans le fichier journal sont synchronisées et fusionnées sur le disque parent.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-178">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="dd5ee-179">Finalisation de la protection</span><span class="sxs-lookup"><span data-stu-id="dd5ee-179">Finalize protection</span></span>

1. <span data-ttu-id="dd5ee-180">Une fois la réplication initiale terminée, le travail **Finaliser la protection sur l’ordinateur virtuel** configure les paramètres réseau et d’autres paramètres de post-réplication pour protéger la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-180">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="dd5ee-181">![Finaliser le travail de protection](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-181">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="dd5ee-182">Si vous répliquez dans Azure, vous devrez peut-être modifier les paramètres de la machine virtuelle pour la préparer au basculement.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-182">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="dd5ee-183">À ce stade, vous pouvez exécuter un basculement de test pour vérifier que tout fonctionne comme prévu.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-183">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="dd5ee-184">Réplication différentielle</span><span class="sxs-lookup"><span data-stu-id="dd5ee-184">Delta replication</span></span>

1. <span data-ttu-id="dd5ee-185">La synchronisation delta commence à l’issue de la réplication initiale, selon les paramètres de réplication.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-185">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="dd5ee-186">Le dispositif de suivi de réplication des réplicas Hyper-V assure le suivi de ces modifications sur un disque dur virtuel, dans des fichiers .hrl.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-186">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="dd5ee-187">Chaque disque configuré pour la réplication est associé à un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-187">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="dd5ee-188">Ce journal est envoyé au compte de stockage du client à la fin de la réplication initiale.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-188">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="dd5ee-189">Lorsqu’un journal est en transit vers Azure, les modifications apportées au disque principal font l’objet d’un suivi dans un autre fichier journal du même répertoire.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-189">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="dd5ee-190">Lors de la réplication différentielle et initiale, vous pouvez surveiller la machine virtuelle dans la vue correspondante.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-190">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="dd5ee-191">[En savoir plus](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="dd5ee-191">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="dd5ee-192">Synchronisation de réplication</span><span class="sxs-lookup"><span data-stu-id="dd5ee-192">Replication synchronization</span></span>

1. <span data-ttu-id="dd5ee-193">Si la réplication différentielle échoue et si une réplication complète est exclue (car elle monopoliserait trop de bande passante ou prendrait trop de temps), une resynchronisation se produit au niveau d’une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-193">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="dd5ee-194">Par exemple, si les fichiers .hrl atteignent 50 % de la taille du disque, la machine virtuelle est marquée pour resynchronisation.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-194">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="dd5ee-195">La resynchronisation limite la quantité de données envoyées en calculant les sommes de contrôle des machines virtuelles sources et cibles et en envoyant les données différentielles uniquement.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-195">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="dd5ee-196">La resynchronisation utilise un algorithme de segmentation de bloc fixe, dans lequel les fichiers source et cible sont divisés en segments fixes.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-196">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="dd5ee-197">Le système génère les sommes de contrôle de chaque segment, puis les compare, afin de savoir quels blocs de la source doivent être appliqués à la cible.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-197">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="dd5ee-198">Une fois la resynchronisation terminée, la réplication différentielle normale doit reprendre.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-198">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="dd5ee-199">Par défaut, la resynchronisation est planifiée pour s’exécuter automatiquement en dehors des heures de bureau, mais vous pouvez resynchroniser une machine virtuelle manuellement.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-199">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="dd5ee-200">Par exemple, la resynchronisation peut reprendre en cas d’interruption du réseau ou autre panne.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-200">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="dd5ee-201">Pour ce faire, sélectionnez la machine virtuelle dans le portail > **Resynchroniser**.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-201">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Resynchronisation manuelle](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="dd5ee-203">Nouvelle tentatives</span><span class="sxs-lookup"><span data-stu-id="dd5ee-203">Retries</span></span>

<span data-ttu-id="dd5ee-204">Si une erreur de réplication se produit, une nouvelle tentative intégrée est effectuée.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-204">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="dd5ee-205">Elle s’articule autour de deux catégories :</span><span class="sxs-lookup"><span data-stu-id="dd5ee-205">This logic can be classified into two categories:</span></span>

<span data-ttu-id="dd5ee-206">**Catégorie**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-206">**Category**</span></span> | <span data-ttu-id="dd5ee-207">**Détails**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-207">**Details**</span></span>
--- | ---
<span data-ttu-id="dd5ee-208">**Erreurs non récupérables**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-208">**Non-recoverable errors**</span></span> | <span data-ttu-id="dd5ee-209">Aucune nouvelle tentative n’est effectuée.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-209">No retry is attempted.</span></span> <span data-ttu-id="dd5ee-210">L’état de la machine virtuelle est affiché comme **Critique** et l’intervention de l’administrateur est requise.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-210">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="dd5ee-211">Exemples d’erreurs : chaîne de disques durs virtuels rompue, état non valide pour les machines virtuelles réplicas, erreurs d’authentification du réseau : erreurs d’autorisations, erreurs de machines virtuelles non trouvées (pour les serveurs Hyper-V autonomes)</span><span class="sxs-lookup"><span data-stu-id="dd5ee-211">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="dd5ee-212">**Erreurs récupérables**</span><span class="sxs-lookup"><span data-stu-id="dd5ee-212">**Recoverable errors**</span></span> | <span data-ttu-id="dd5ee-213">De nouvelles tentatives se produisent à chaque intervalle de réplication, à l’aide d’une interruption exponentielle laquelle augmente l’intervalle de récupération de 1, 2, 4, 8 et 10 minutes, dès le début de la première tentative.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-213">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="dd5ee-214">Si une erreur persiste, effectuez une nouvelle tentative toutes les 30 minutes.</span><span class="sxs-lookup"><span data-stu-id="dd5ee-214">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="dd5ee-215">Voici quelques exemples : erreur réseau, erreur espace disque faible, conditions de mémoire insuffisante</span><span class="sxs-lookup"><span data-stu-id="dd5ee-215">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="dd5ee-216">Cycle de vie de protection et de récupération</span><span class="sxs-lookup"><span data-stu-id="dd5ee-216">Protection and recovery lifecycle</span></span>

![flux de travail](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="dd5ee-218">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="dd5ee-218">Next steps</span></span>

- [<span data-ttu-id="dd5ee-219">Vérification des conditions préalables au déploiement</span><span class="sxs-lookup"><span data-stu-id="dd5ee-219">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="dd5ee-220">Résolution des problèmes avec :</span><span class="sxs-lookup"><span data-stu-id="dd5ee-220">Troubleshoot with:</span></span>
    - [<span data-ttu-id="dd5ee-221">Surveiller et dépanner la protection</span><span class="sxs-lookup"><span data-stu-id="dd5ee-221">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="dd5ee-222">Aide du support Microsoft</span><span class="sxs-lookup"><span data-stu-id="dd5ee-222">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="dd5ee-223">Problèmes courants et leur résolution</span><span class="sxs-lookup"><span data-stu-id="dd5ee-223">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
