---
title: "Répliquer une application SharePoint multiniveau à l’aide d’Azure Site Recovery | Microsoft Docs"
description: "Cet article explique comment répliquer une application SharePoint multiniveau à l’aide des fonctionnalités d’Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: sujayt
manager: rochakm
editor: 
ms.assetid: 
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/10/2017
ms.author: sutalasi
ms.openlocfilehash: 9c0570b9da661a8ffb0041e5c24905480f55f6e2
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="replicate-a-multi-tier-sharepoint-application-for-disaster-recovery-using-azure-site-recovery"></a><span data-ttu-id="ac6b2-103">Répliquer une application SharePoint multiniveau pour la récupération d’urgence à l’aide d’Azure Site Recovery</span><span class="sxs-lookup"><span data-stu-id="ac6b2-103">Replicate a multi-tier SharePoint application for disaster recovery using Azure Site Recovery</span></span>

<span data-ttu-id="ac6b2-104">Cet article explique en détail comment protéger une application SharePoint à l’aide d’[Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-104">This article describes in detail how to protect a SharePoint application using  [Azure Site Recovery](site-recovery-overview.md).</span></span>


## <a name="overview"></a><span data-ttu-id="ac6b2-105">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="ac6b2-105">Overview</span></span>

<span data-ttu-id="ac6b2-106">Microsoft SharePoint est une application puissante qui peut aider un groupe ou service à s’organiser, à collaborer et à partager des informations.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-106">Microsoft SharePoint is a powerful application that can help a group or department organize, collaborate, and share information.</span></span> <span data-ttu-id="ac6b2-107">SharePoint permet les portails intranet, la gestion des documents et fichiers, la collaboration, les réseaux sociaux, les réseaux extranet, les sites web, la recherche de contenu d’entreprise et le décisionnel.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-107">SharePoint can provide intranet portals, document and file management, collaboration, social networks, extranets, websites, enterprise search, and business intelligence.</span></span> <span data-ttu-id="ac6b2-108">Elle offre également des capacités d’intégration de système, d’intégration de processus et d’automatisation de flux de travail.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-108">It also has system integration, process integration, and workflow automation capabilities.</span></span> <span data-ttu-id="ac6b2-109">En règle générale, les organisations le considèrent comme une application de niveau 1 sensible à la perte de données et au temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-109">Typically, organizations consider it as a Tier-1 application sensitive to downtime and data loss.</span></span>

<span data-ttu-id="ac6b2-110">Aujourd'hui, Microsoft SharePoint ne fournit aucune capacité de récupération d’urgence prête à l’emploi.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-110">Today, Microsoft SharePoint  does not provide any out-of-the-box disaster recovery capabilities.</span></span> <span data-ttu-id="ac6b2-111">Quels que soient le type et l’ampleur d’un sinistre, la récupération implique d’utiliser un centre de données de secours grâce auquel vous pouvez récupérer la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-111">Regardless of the type and scale of a disaster, recovery involves the use of a standby data center that you can recover the farm to.</span></span> <span data-ttu-id="ac6b2-112">Des centres de données de secours sont nécessaires lorsque les sauvegardes et systèmes redondants locaux ne peuvent pas être récupérés après une panne au centre de données principal.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-112">Standby data centers are required for scenarios where local redundant systems and backups cannot recover from the outage at the primary data center.</span></span>

<span data-ttu-id="ac6b2-113">Une bonne solution de récupération d’urgence doit permettre de modéliser des plans de récupération sur les architectures d’application complexes telles que SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-113">A good disaster recovery solution should allow modeling of recovery plans around the  complex application architectures such as SharePoint.</span></span> <span data-ttu-id="ac6b2-114">Elle doit également offrir la possibilité d’ajouter des étapes personnalisées pour gérer des mappages d’application entre les différents niveaux et, par conséquent, fournir un basculement par simple clic avec un RTO inférieur en cas de sinistre.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-114">It should also have the ability to add customized steps to handle application mappings between various tiers and hence providing a single-click failover with a lower RTO in the event of a disaster.</span></span>

<span data-ttu-id="ac6b2-115">Cet article explique en détail comment protéger une application SharePoint à l’aide d’[Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-115">This article describes in detail how to protect a SharePoint application using [Azure Site Recovery](site-recovery-overview.md).</span></span> <span data-ttu-id="ac6b2-116">Cet article décrit les recommandations à suivre pour répliquer une application SharePoint à trois niveaux dans Azure, et indique comment vous pouvez effectuer un exercice de récupération d’urgence et comment vous pouvez basculer l’application vers Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-116">This article will cover best practices for replicating a three tier SharePoint application to Azure, how you can do a disaster recovery drill, and how you can failover the application to Azure.</span></span>

<span data-ttu-id="ac6b2-117">Vous pouvez regarder la vidéo ci-dessous sur la récupération d’une application multiniveau dans Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-117">You can watch the below video about recovering a multi tier application to Azure.</span></span>

> [!VIDEO https://channel9.msdn.com/Series/Azure-Site-Recovery/Disaster-Recovery-of-load-balanced-multi-tier-applications-using-Azure-Site-Recovery/player]


## <a name="prerequisites"></a><span data-ttu-id="ac6b2-118">Composants requis</span><span class="sxs-lookup"><span data-stu-id="ac6b2-118">Prerequisites</span></span>

<span data-ttu-id="ac6b2-119">Avant de commencer, veillez à bien comprendre ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="ac6b2-119">Before you start, make sure you understand the following:</span></span>

1. [<span data-ttu-id="ac6b2-120">Réplication d’une machine virtuelle dans Azure</span><span class="sxs-lookup"><span data-stu-id="ac6b2-120">Replicating a virtual machine to Azure</span></span>](site-recovery-vmware-to-azure.md)
2. <span data-ttu-id="ac6b2-121">[Conception d’un réseau de récupération](site-recovery-network-design.md)</span><span class="sxs-lookup"><span data-stu-id="ac6b2-121">How to [design a recovery network](site-recovery-network-design.md)</span></span>
3. [<span data-ttu-id="ac6b2-122">Réalisation d’un test de basculement vers Azure</span><span class="sxs-lookup"><span data-stu-id="ac6b2-122">Doing a test failover to Azure</span></span>](site-recovery-test-failover-to-azure.md)
4. [<span data-ttu-id="ac6b2-123">Exécution d’un basculement vers Azure</span><span class="sxs-lookup"><span data-stu-id="ac6b2-123">Doing a failover to Azure</span></span>](site-recovery-failover.md)
5. <span data-ttu-id="ac6b2-124">[Réplication d’un contrôleur de domaine](site-recovery-active-directory.md)</span><span class="sxs-lookup"><span data-stu-id="ac6b2-124">How to [replicate a domain controller](site-recovery-active-directory.md)</span></span>
6. <span data-ttu-id="ac6b2-125">[Réplication de SQL Server](site-recovery-sql.md)</span><span class="sxs-lookup"><span data-stu-id="ac6b2-125">How to [replicate SQL Server](site-recovery-sql.md)</span></span>

## <a name="sharepoint-architecture"></a><span data-ttu-id="ac6b2-126">Architecture SharePoint</span><span class="sxs-lookup"><span data-stu-id="ac6b2-126">SharePoint architecture</span></span>

<span data-ttu-id="ac6b2-127">SharePoint peut être déployée sur un ou plusieurs serveurs à l’aide de rôles de serveur et de topologies à plusieurs niveaux pour implémenter une conception de batterie de serveurs qui répond à des objectifs spécifiques.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-127">SharePoint can be deployed on one or more servers using tiered topologies and server roles to implement a farm design that meets specific goals and objectives.</span></span> <span data-ttu-id="ac6b2-128">Une batterie de serveurs SharePoint de grande capacité et à forte demande qui prend en charge un grand nombre d’utilisateurs simultanés et un grand nombre d’éléments de contenu utilise le regroupement de service dans le cadre de sa stratégie d’évolutivité.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-128">A typical large, high-demand SharePoint server farm that supports a high number of concurrent users and a large number of content items use service grouping as part of their scalability strategy.</span></span> <span data-ttu-id="ac6b2-129">Cette approche implique d’exécuter les services sur des serveurs dédiés, de regrouper ces services puis d’augmenter la taille des instances des serveurs en tant que groupe.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-129">This approach involves running services on dedicated servers, grouping these services together, and then scaling out the servers as a group.</span></span> <span data-ttu-id="ac6b2-130">La topologie suivante illustre le regroupement des services et serveurs pour une batterie de serveurs SharePoint à trois niveaux.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-130">The following topology illustrates the service and server grouping for a three tier SharePoint server farm.</span></span> <span data-ttu-id="ac6b2-131">Reportez-vous à la documentation de SharePoint et aux architectures de gamme de produits pour des instructions détaillées sur les différentes topologies de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-131">Please refer to SharePoint documentation and product line architectures for detailed guidance on different SharePoint topologies.</span></span> <span data-ttu-id="ac6b2-132">Vous trouverez plus d’informations sur le déploiement de SharePoint 2013 dans [ce document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-132">You can find more details about SharePoint 2013 deployment in [this document](https://technet.microsoft.com/en-us/library/cc303422.aspx).</span></span>



![Modèle de déploiement 1](./media/site-recovery-sharepoint/sharepointarch.png)


## <a name="site-recovery-support"></a><span data-ttu-id="ac6b2-134">Prise en charge de Site Recovery</span><span class="sxs-lookup"><span data-stu-id="ac6b2-134">Site Recovery support</span></span>

<span data-ttu-id="ac6b2-135">Pour la création de cet article, des machines virtuelles VMware avec Windows Server 2012 R2 Enterprise ont été utilisées.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-135">For creating this article, VMware virtual machines with Windows Server 2012 R2 Enterprise were used.</span></span> <span data-ttu-id="ac6b2-136">Les applications SharePoint 2013 Enterprise Edition et SQL Server 2014 Enterprise Edition ont été utilisées.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-136">SharePoint 2013 Enterprise edition and SQL server 2014 Enterprise edition were used.</span></span> <span data-ttu-id="ac6b2-137">Comme la réplication Site Recovery est indépendante des applications, les recommandations indiquées ici sont censées également s’appliquer aux scénarios suivants.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-137">As Site Recovery replication is application agnostic, the recommendations provided here are expected to hold on for following scenarios as well.</span></span>

### <a name="source-and-target"></a><span data-ttu-id="ac6b2-138">Source et cible</span><span class="sxs-lookup"><span data-stu-id="ac6b2-138">Source and target</span></span>

<span data-ttu-id="ac6b2-139">**Scénario**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-139">**Scenario**</span></span> | <span data-ttu-id="ac6b2-140">**Vers un site secondaire**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-140">**To a secondary site**</span></span> | <span data-ttu-id="ac6b2-141">**Vers Azure**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-141">**To Azure**</span></span>
--- | --- | ---
<span data-ttu-id="ac6b2-142">**Hyper-V**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-142">**Hyper-V**</span></span> | <span data-ttu-id="ac6b2-143">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-143">Yes</span></span> | <span data-ttu-id="ac6b2-144">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-144">Yes</span></span>
<span data-ttu-id="ac6b2-145">**VMware**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-145">**VMware**</span></span> | <span data-ttu-id="ac6b2-146">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-146">Yes</span></span> | <span data-ttu-id="ac6b2-147">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-147">Yes</span></span>
<span data-ttu-id="ac6b2-148">**Serveur physique**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-148">**Physical server**</span></span> | <span data-ttu-id="ac6b2-149">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-149">Yes</span></span> | <span data-ttu-id="ac6b2-150">Oui</span><span class="sxs-lookup"><span data-stu-id="ac6b2-150">Yes</span></span>

### <a name="sharepoint-versions"></a><span data-ttu-id="ac6b2-151">Versions de SharePoint</span><span class="sxs-lookup"><span data-stu-id="ac6b2-151">SharePoint Versions</span></span>
<span data-ttu-id="ac6b2-152">Les versions suivantes de SharePoint Server sont prises en charge.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-152">The following SharePoint server versions are supported.</span></span>

* <span data-ttu-id="ac6b2-153">SharePoint Server 2013 Standard</span><span class="sxs-lookup"><span data-stu-id="ac6b2-153">SharePoint server 2013 Standard</span></span>
* <span data-ttu-id="ac6b2-154">SharePoint Server 2013 Enterprise</span><span class="sxs-lookup"><span data-stu-id="ac6b2-154">SharePoint server 2013 Enterprise</span></span>
* <span data-ttu-id="ac6b2-155">SharePoint Server 2016 Standard</span><span class="sxs-lookup"><span data-stu-id="ac6b2-155">SharePoint server 2016 Standard</span></span>
* <span data-ttu-id="ac6b2-156">SharePoint Server 2016 Enterprise</span><span class="sxs-lookup"><span data-stu-id="ac6b2-156">SharePoint server 2016 Enterprise</span></span>

### <a name="things-to-keep-in-mind"></a><span data-ttu-id="ac6b2-157">Éléments à prendre en compte</span><span class="sxs-lookup"><span data-stu-id="ac6b2-157">Things to keep in mind</span></span>

<span data-ttu-id="ac6b2-158">Si vous utilisez un cluster basé sur disque partagé comme n’importe quel niveau dans votre application, vous ne pourrez pas utiliser la réplication de Site Recovery pour répliquer ces machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-158">If you are using a shared disk-based cluster as any tier in your application then you will not be able to use Site Recovery replication to replicate those virtual machines.</span></span> <span data-ttu-id="ac6b2-159">Vous pouvez utiliser la réplication native fournie par l’application, puis utiliser un [plan de récupération](site-recovery-create-recovery-plans.md) pour basculer tous les niveaux.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-159">You can use native replication provided by the application and then use a [recovery plan](site-recovery-create-recovery-plans.md) to failover all tiers.</span></span>

## <a name="replicating-virtual-machines"></a><span data-ttu-id="ac6b2-160">Réplication des machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="ac6b2-160">Replicating virtual machines</span></span>

<span data-ttu-id="ac6b2-161">Suivez [ce guide](site-recovery-vmware-to-azure.md) pour démarrer la réplication de la machine virtuelle dans Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-161">Follow [this guidance](site-recovery-vmware-to-azure.md) to start replicating the virtual machine to Azure.</span></span>

* <span data-ttu-id="ac6b2-162">Une fois la réplication terminée, assurez-vous que vous accédez à chaque machine virtuelle de chaque niveau et sélectionnez le même groupe à haute disponibilité dans « Élément répliqué > Paramètres > Propriétés > Calcul et réseau ».</span><span class="sxs-lookup"><span data-stu-id="ac6b2-162">Once the replication is complete, make sure you go to each virtual machine of each tier and select same availability set in 'Replicated item > Settings > Properties > Compute and Network'.</span></span> <span data-ttu-id="ac6b2-163">Par exemple, si votre niveau web comporte 3 machines virtuelles, vérifiez que les 3 machines virtuelles sont configurées pour faire partie du même groupe à haute disponibilité dans Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-163">For example, if your web tier has 3 VMs, ensure all the 3 VMs are configured to be part of same availability set in Azure.</span></span>

    ![Set-Availability-Set](./media/site-recovery-sharepoint/select-av-set.png)

* <span data-ttu-id="ac6b2-165">Pour obtenir des conseils sur la protection d’Active Directory et de DNS, consultez le document [Protéger Active Directory et DNS](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-165">For guidance on protecting Active Directory and DNS, refer to [Protect Active Directory and DNS](site-recovery-active-directory.md) document.</span></span>

* <span data-ttu-id="ac6b2-166">Pour obtenir des conseils sur la protection d’un niveau de base de données en cours d’exécution sur SQL Server, consultez le document [Protéger SQL Server](site-recovery-active-directory.md).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-166">For guidance on protecting database tier running on SQL server, refer to [Protect SQL Server](site-recovery-active-directory.md) document.</span></span>

## <a name="networking-configuration"></a><span data-ttu-id="ac6b2-167">Configuration de la mise en réseau</span><span class="sxs-lookup"><span data-stu-id="ac6b2-167">Networking configuration</span></span>

### <a name="network-properties"></a><span data-ttu-id="ac6b2-168">Propriétés du réseau</span><span class="sxs-lookup"><span data-stu-id="ac6b2-168">Network properties</span></span>

* <span data-ttu-id="ac6b2-169">Pour les machines virtuelles de niveau web et de niveau application, configurez les paramètres réseau dans le portail Azure afin que les machines virtuelles soient associées au bon réseau de récupération d’urgence après le basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-169">For the App and Web tier VMs, configure network settings in Azure portal so that the VMs get attached to the right DR network after failover.</span></span>

    ![Sélectionner le réseau](./media/site-recovery-sharepoint/select-network.png)


* <span data-ttu-id="ac6b2-171">Si vous utilisez une adresse IP statique, spécifiez l’adresse IP que vous souhaitez attribuer à la machine virtuelle dans le champ **Adresse IP cible**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-171">If you are using a static IP, then specify the IP that you want the virtual machine to take in the **Target IP** field</span></span>

    ![Définir l’adresse IP statique](./media/site-recovery-sharepoint/set-static-ip.png)

### <a name="dns-and-traffic-routing"></a><span data-ttu-id="ac6b2-173">Routage du trafic et DNS</span><span class="sxs-lookup"><span data-stu-id="ac6b2-173">DNS and Traffic Routing</span></span>

<span data-ttu-id="ac6b2-174">Pour les sites accessibles sur Internet, [créez un profil Traffic Manager de type « Priorité »](../traffic-manager/traffic-manager-create-profile.md) dans l’abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-174">For internet facing sites, [create a Traffic Manager profile of 'Priority' type](../traffic-manager/traffic-manager-create-profile.md) in the Azure subscription.</span></span> <span data-ttu-id="ac6b2-175">Puis, configurez votre profil DNS et Traffic Manager de la manière suivante.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-175">And then configure your DNS and Traffic Manager profile in the following manner.</span></span>


| <span data-ttu-id="ac6b2-176">**Where**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-176">**Where**</span></span> | <span data-ttu-id="ac6b2-177">**Source**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-177">**Source**</span></span> | <span data-ttu-id="ac6b2-178">**Cible**</span><span class="sxs-lookup"><span data-stu-id="ac6b2-178">**Target**</span></span>|
| --- | --- | --- |
| <span data-ttu-id="ac6b2-179">DNS public</span><span class="sxs-lookup"><span data-stu-id="ac6b2-179">Public DNS</span></span> | <span data-ttu-id="ac6b2-180">DNS public pour les sites SharePoint</span><span class="sxs-lookup"><span data-stu-id="ac6b2-180">Public DNS for SharePoint sites</span></span> <br/><br/> <span data-ttu-id="ac6b2-181">Exemple : sharepoint.contoso.com</span><span class="sxs-lookup"><span data-stu-id="ac6b2-181">Ex: sharepoint.contoso.com</span></span> | <span data-ttu-id="ac6b2-182">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="ac6b2-182">Traffic Manager</span></span> <br/><br/> <span data-ttu-id="ac6b2-183">contososharepoint.trafficmanager.net</span><span class="sxs-lookup"><span data-stu-id="ac6b2-183">contososharepoint.trafficmanager.net</span></span> |
| <span data-ttu-id="ac6b2-184">DNS local</span><span class="sxs-lookup"><span data-stu-id="ac6b2-184">On-premises DNS</span></span> | <span data-ttu-id="ac6b2-185">sharepointonprem.contoso.com</span><span class="sxs-lookup"><span data-stu-id="ac6b2-185">sharepointonprem.contoso.com</span></span> | <span data-ttu-id="ac6b2-186">Adresse IP publique sur la batterie de serveurs locale</span><span class="sxs-lookup"><span data-stu-id="ac6b2-186">Public IP on the on-premises farm</span></span> |


<span data-ttu-id="ac6b2-187">Dans le profil Traffic Manager, [créez les points de terminaison principaux et de récupération](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-187">In the Traffic Manager profile, [create the primary and recovery endpoints](../traffic-manager/traffic-manager-configure-priority-routing-method.md).</span></span> <span data-ttu-id="ac6b2-188">Utilisez le point de terminaison externe pour le point de terminaison local et l’adresse IP publique pour le point de terminaison Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-188">Use the external endpoint for on-premises endpoint and public IP for Azure endpoint.</span></span> <span data-ttu-id="ac6b2-189">Vérifiez que la priorité définie est plus élevée que celle du point de terminaison local.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-189">Ensure that the priority is set higher to on-premises endpoint.</span></span>

<span data-ttu-id="ac6b2-190">Hébergez une page de test sur un port spécifique (800 par exemple) du niveau web de SharePoint afin que Traffic Manager détecte automatiquement la disponibilité après basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-190">Host a test page on a specific port (for example, 800) in the SharePoint web tier in order for Traffic Manager to automatically detect availability post failover.</span></span> <span data-ttu-id="ac6b2-191">Il s’agit d’une solution de contournement si vous ne pouvez pas activer l’authentification anonyme sur un de vos sites SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-191">This is a workaround in case you cannot enable anonymous authentication on any of your SharePoint sites.</span></span>

<span data-ttu-id="ac6b2-192">[Configurez le profil Traffic Manager](../traffic-manager/traffic-manager-configure-priority-routing-method.md) avec les paramètres ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-192">[Configure the Traffic Manager profile](../traffic-manager/traffic-manager-configure-priority-routing-method.md) with the below settings.</span></span>

* <span data-ttu-id="ac6b2-193">Méthode de routage - « Priorité »</span><span class="sxs-lookup"><span data-stu-id="ac6b2-193">Routing method - 'Priority'</span></span>
* <span data-ttu-id="ac6b2-194">Durée de vie du DNS - « 30 secondes »</span><span class="sxs-lookup"><span data-stu-id="ac6b2-194">DNS time to live (TTL) - '30 seconds'</span></span>
* <span data-ttu-id="ac6b2-195">Paramètres d’analyse de point de terminaison - Si vous pouvez activer l’authentification anonyme, vous pouvez donner un point de terminaison de site web spécifique.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-195">Endpoint monitor settings - If you can enable anonymous authentication, you can give a specific website endpoint.</span></span> <span data-ttu-id="ac6b2-196">Ou bien, vous pouvez utiliser une page de test sur un port spécifique (800 par exemple).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-196">Or, you can use a test page on a specific port (for example, 800).</span></span>

## <a name="creating-a-recovery-plan"></a><span data-ttu-id="ac6b2-197">Création d’un plan de récupération</span><span class="sxs-lookup"><span data-stu-id="ac6b2-197">Creating a recovery plan</span></span>

<span data-ttu-id="ac6b2-198">Un plan de récupération permet de séquencer le basculement de différents niveaux d’une application multiniveau, ce qui contribue au maintien de la cohérence de l’application.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-198">A recovery plan allows sequencing the failover of various tiers in a multi-tier application, hence, maintaining application consistency.</span></span> <span data-ttu-id="ac6b2-199">Suivez les étapes indiquées ci-dessous lorsque vous créez un plan de récupération pour une application web multiniveau.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-199">Follow the below steps while creating a recovery plan for a multi-tier web application.</span></span> <span data-ttu-id="ac6b2-200">[En savoir plus sur la création d’un plan de récupération](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-200">[Learn more about creating a recovery plan](site-recovery-runbook-automation.md#customize-the-recovery-plan).</span></span>

### <a name="adding-virtual-machines-to-failover-groups"></a><span data-ttu-id="ac6b2-201">Ajout de machines virtuelles à des groupes de basculement</span><span class="sxs-lookup"><span data-stu-id="ac6b2-201">Adding virtual machines to failover groups</span></span>

1. <span data-ttu-id="ac6b2-202">Créez un plan de récupération en ajoutant des machines virtuelles de niveau web et application.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-202">Create a recovery plan by adding the App and Web tier VMs.</span></span>
2. <span data-ttu-id="ac6b2-203">Cliquez sur « Personnaliser » pour regrouper les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-203">Click on 'Customize' to group the VMs.</span></span> <span data-ttu-id="ac6b2-204">Par défaut, toutes les machines virtuelles font partie du « Groupe 1 ».</span><span class="sxs-lookup"><span data-stu-id="ac6b2-204">By default, all VMs are part of 'Group 1'.</span></span>

    ![Personnaliser un RP](./media/site-recovery-sharepoint/rp-groups.png)

3. <span data-ttu-id="ac6b2-206">Créez un autre groupe (Groupe 2) et déplacez les machines virtuelles de niveau web dans le nouveau groupe.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-206">Create another Group (Group 2) and move the Web tier VMs into the new group.</span></span> <span data-ttu-id="ac6b2-207">Vos machines virtuelles de niveau application doivent faire partie du « Groupe 1 » tandis que les machines virtuelles de niveau web doivent faire partie du « Groupe 2 ».</span><span class="sxs-lookup"><span data-stu-id="ac6b2-207">Your App tier VMs should be part of 'Group 1' and Web tier VMs should be part of 'Group 2'.</span></span> <span data-ttu-id="ac6b2-208">Cela permet de s’assurer que les machines virtuelles de niveau application démarrent avant les machines virtuelles de niveau web.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-208">This is to ensure that the App tier VMs boot up first followed by Web tier VMs.</span></span>


### <a name="adding-scripts-to-the-recovery-plan"></a><span data-ttu-id="ac6b2-209">Ajout de scripts au plan de récupération</span><span class="sxs-lookup"><span data-stu-id="ac6b2-209">Adding scripts to the recovery plan</span></span>

<span data-ttu-id="ac6b2-210">Vous pouvez déployer les scripts Azure Site Recovery les plus couramment utilisés dans votre compte Automation en cliquant sur le bouton « Déployer dans Azure » ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-210">You can deploy the most commonly used Azure Site Recovery scripts into your Automation account clicking the 'Deploy to Azure' button below.</span></span> <span data-ttu-id="ac6b2-211">Lorsque vous utilisez n’importe quel script publié, assurez-vous de suivre les instructions dans le script.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-211">When you are using any published script, ensure you follow the guidance in the script.</span></span>

<span data-ttu-id="ac6b2-212">[![Déploiement sur Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span><span class="sxs-lookup"><span data-stu-id="ac6b2-212">[![Deploy to Azure](https://azurecomcdn.azureedge.net/mediahandler/acomblog/media/Default/blog/c4803408-340e-49e3-9a1f-0ed3f689813d.png)](https://aka.ms/asr-automationrunbooks-deploy)</span></span>

1. <span data-ttu-id="ac6b2-213">Ajoutez un script d’action préalable au « Groupe 1 » pour basculer le groupe de disponibilité SQL.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-213">Add a pre-action script to 'Group 1' to failover SQL Availability group.</span></span> <span data-ttu-id="ac6b2-214">Utilisez le script « ASR-SQL-FailoverAG » publié dans les exemples de script.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-214">Use the 'ASR-SQL-FailoverAG' script published in the sample scripts.</span></span> <span data-ttu-id="ac6b2-215">Assurez-vous de suivre les instructions dans le script et apportez les modifications requises dans le script en conséquence.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-215">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-AG-Script-Step-1](./media/site-recovery-sharepoint/add-ag-script-step1.png)

    ![Add-AG-Script-Step-2](./media/site-recovery-sharepoint/add-ag-script-step2.png)

2. <span data-ttu-id="ac6b2-218">Ajoutez un script d’action postérieure pour attribuer un équilibrage de charge sur les machines virtuelles de niveau web basculées (Groupe 2).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-218">Add a post action script to attach a load balancer on the failed over virtual machines of Web tier (Group 2).</span></span> <span data-ttu-id="ac6b2-219">Utilisez le script « ASR-AddSingleLoadBalancer » publié dans les exemples de script.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-219">Use the 'ASR-AddSingleLoadBalancer' script published in the sample scripts.</span></span> <span data-ttu-id="ac6b2-220">Assurez-vous de suivre les instructions dans le script et apportez les modifications requises dans le script en conséquence.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-220">Ensure you follow the guidance in the script and make the required changes in the script appropriately.</span></span>

    ![Add-LB-Script-Step-1](./media/site-recovery-sharepoint/add-lb-script-step1.png)

    ![Add-LB-Script-Step-2](./media/site-recovery-sharepoint/add-lb-script-step2.png)

3. <span data-ttu-id="ac6b2-223">Ajoutez une étape manuelle pour mettre à jour les enregistrements DNS afin qu’ils indiquent la nouvelle batterie de serveurs dans Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-223">Add a manual step to update the DNS records to point to the new farm in Azure.</span></span>

    * <span data-ttu-id="ac6b2-224">Pour les sites accessibles sur Internet, aucune mise à jour des DNS n’est obligatoire après le basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-224">For internet facing sites, no DNS updates are required post failover.</span></span> <span data-ttu-id="ac6b2-225">Suivez les étapes décrites dans la section « Guide de mise en réseau » pour configurer Traffic Manager.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-225">Follow the steps described in the 'Networking guidance' section to configure Traffic Manager.</span></span> <span data-ttu-id="ac6b2-226">Si le profil Traffic Manager a été configuré comme décrit dans la section précédente, ajoutez un script pour ouvrir un port factice (800 dans l’exemple) sur la machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-226">If the Traffic Manager profile has been set up as described in the previous section, add a script to open dummy port (800 in the example) on the Azure VM.</span></span>

    * <span data-ttu-id="ac6b2-227">Pour les sites accessibles en interne, ajoutez une étape manuelle pour mettre à jour l’enregistrement DNS afin qu’il indique l’adresse IP de l’équilibrage de charge de la nouvelle machine virtuelle de niveau web.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-227">For internal facing sites, add a manual step to update the DNS record to point to the new Web tier VM’s load balancer IP.</span></span>

4. <span data-ttu-id="ac6b2-228">Ajoutez une étape manuelle pour restaurer l’application de recherche à partir d’une sauvegarde ou pour démarrer un nouveau service de recherche.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-228">Add a manual step to restore search application from a backup or start a new search service.</span></span>

5. <span data-ttu-id="ac6b2-229">Pour restaurer l’application de service de recherche à partir d’une sauvegarde, suivez les étapes ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-229">For restoring Search service application from a backup, follow below steps.</span></span>

    * <span data-ttu-id="ac6b2-230">Cette méthode suppose qu’une sauvegarde de l’application de service de recherche a été effectuée avant l’événement catastrophique et que cette sauvegarde est disponible sur le site de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-230">This method assumes that a backup of the Search Service Application was performed before the catastrophic event and that the backup is available at the DR site.</span></span>
    * <span data-ttu-id="ac6b2-231">Pour y parvenir facilement, il suffit de planifier la sauvegarde (par exemple, une fois par jour) et d’utiliser une procédure de copie pour placer la sauvegarde sur le site de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-231">This can easily be achieved by scheduling the backup (for example, once daily) and using a copy procedure to place the backup at the DR site.</span></span> <span data-ttu-id="ac6b2-232">Les procédures de copie peuvent inclure des programmes par script comme AzCopy (Azure Copy) ou la configuration de DFSR (Distributed File Services Replication).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-232">Copy procedures could include scripted programs such as AzCopy (Azure Copy) or setting up DFSR (Distributed File Services Replication).</span></span>
    * <span data-ttu-id="ac6b2-233">Maintenant que la batterie de serveurs SharePoint est en cours d’exécution, parcourez le site Administration centrale pour accéder à « Sauvegarde et restauration » puis sélectionnez Restaurer.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-233">Now that the SharePoint farm is running, navigate the Central Administration, 'Backup and Restore' and select Restore.</span></span> <span data-ttu-id="ac6b2-234">La restauration interroge l’emplacement de sauvegarde spécifié (vous devrez peut-être mettre à jour la valeur).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-234">The restore interrogates the backup location specified (you may need to update the value).</span></span> <span data-ttu-id="ac6b2-235">Sélectionnez la sauvegarde de l’application de service de recherche que vous voulez restaurer.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-235">Select the Search Service Application backup you would like to restore.</span></span>
    * <span data-ttu-id="ac6b2-236">La recherche est restaurée.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-236">Search is restored.</span></span> <span data-ttu-id="ac6b2-237">N’oubliez pas que la restauration s’attend à trouver la même topologie (même nombre de serveurs) et les mêmes lettres de lecteur affectées à ces serveurs.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-237">Keep in mind that the restore expects to find the same topology (same number of servers) and same hard drive letters assigned to those servers.</span></span> <span data-ttu-id="ac6b2-238">Pour plus d’informations, consultez le document [« Restaurer une application de service de recherche dans SharePoint 2013 »](https://technet.microsoft.com/library/ee748654.aspx).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-238">For more information, see ['Restore Search service application in SharePoint 2013'](https://technet.microsoft.com/library/ee748654.aspx) document.</span></span>


6. <span data-ttu-id="ac6b2-239">Pour démarrer avec une nouvelle application de service de recherche, suivez les étapes ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-239">For starting with a new Search service application, follow below steps.</span></span>

    * <span data-ttu-id="ac6b2-240">Cette méthode suppose qu’une sauvegarde de la base de données « Administration de la recherche » est disponible sur le site de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-240">This method assumes that a backup of the “Search Administration” database is available at the DR site.</span></span>
    * <span data-ttu-id="ac6b2-241">Étant donné que les autres bases de données d’application de service de recherche ne sont pas répliquées, elles doivent être recréées.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-241">Since the other Search Service Application databases are not replicated, they need to be re-created.</span></span> <span data-ttu-id="ac6b2-242">Pour ce faire, accédez à l’Administration centrale et supprimez l’application de service de recherche.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-242">To do so, navigate to Central Administration and delete the Search Service Application.</span></span> <span data-ttu-id="ac6b2-243">Sur les serveurs qui hébergent l’index de recherche, supprimez les fichiers d’index.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-243">On any servers which host the Search Index, delete the index files.</span></span>
    * <span data-ttu-id="ac6b2-244">Recréez l’application de service de recherche pour recréer les bases de données.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-244">Re-create the Search Service Application and this re-creates the databases.</span></span> <span data-ttu-id="ac6b2-245">Il est recommandé d’avoir un script préparé qui recrée cette application de service, car il n’est pas possible d’effectuer toutes les actions via l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-245">It is recommended to have a prepared script that re-creates this service application since it is not possible to perform all actions via the GUI.</span></span> <span data-ttu-id="ac6b2-246">Par exemple, il n’est possible de définir l’emplacement du lecteur d’index et de configurer la topologie de recherche qu’à l’aide des applets de commande PowerShell de SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-246">For example, setting the index drive location and configuring the search topology are only possible by using SharePoint PowerShell cmdlets.</span></span> <span data-ttu-id="ac6b2-247">Utilisez l’applet de commande Windows PowerShell Restore-SPEnterpriseSearchServiceApplication et spécifiez la base de données d’administration de recherche répliquée et pour laquelle les journaux ont été copiés, Search_Service__DB.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-247">Use the Windows PowerShell cmdlet Restore-SPEnterpriseSearchServiceApplication and specify the log-shipped and replicated Search Administration database, Search_Service__DB.</span></span> <span data-ttu-id="ac6b2-248">Cette applet de commande permet la configuration de la recherche, le schéma, les propriétés gérées, les règles et les sources, et crée un ensemble par défaut des autres composants.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-248">This cmdlet gives the search configuration, schema, managed properties, rules, and sources and creates a default set of the other components.</span></span>
    * <span data-ttu-id="ac6b2-249">Une fois que l’application de service de recherche a été recréée, vous devez démarrer une analyse complète pour chaque source de contenu afin de restaurer le service de recherche.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-249">Once the Search Service Application has be re-created, you must start a full crawl for each content source to restore the Search Service.</span></span> <span data-ttu-id="ac6b2-250">Vous perdrez des informations analytiques provenant de la batterie de serveurs locale, telles que des recommandations de recherche.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-250">You lose some analytics information from the on-premises farm, such as search recommendations.</span></span>

7. <span data-ttu-id="ac6b2-251">Une fois toutes les étapes effectuées, enregistrez le plan de récupération. Le plan de récupération final se présente alors comme suit.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-251">Once all the steps are completed, save the recovery plan and the final recovery plan will look like following.</span></span>

    ![RP enregistré](./media/site-recovery-sharepoint/saved-rp.png)

## <a name="doing-a-test-failover"></a><span data-ttu-id="ac6b2-253">Exécution d’un test de basculement</span><span class="sxs-lookup"><span data-stu-id="ac6b2-253">Doing a test failover</span></span>
<span data-ttu-id="ac6b2-254">Suivez [ce guide](site-recovery-test-failover-to-azure.md) pour effectuer un test de basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-254">Follow [this guidance](site-recovery-test-failover-to-azure.md) to do a test failover.</span></span>

1.  <span data-ttu-id="ac6b2-255">Accédez au portail Azure et sélectionnez votre coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-255">Go to Azure portal and select your Recovery Service vault.</span></span>
2.  <span data-ttu-id="ac6b2-256">Cliquez sur le plan de récupération créé pour l’application SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-256">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="ac6b2-257">Cliquez sur Test de basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-257">Click on 'Test Failover'.</span></span>
4.  <span data-ttu-id="ac6b2-258">Sélectionnez un point de récupération et un réseau virtuel Azure pour démarrer le test de basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-258">Select recovery point and Azure virtual network to start the test failover process.</span></span>
5.  <span data-ttu-id="ac6b2-259">Lorsque l’environnement secondaire est opérationnel, vous pouvez effectuer vos validations.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-259">Once the secondary environment is up, you can perform your validations.</span></span>
6.  <span data-ttu-id="ac6b2-260">Une fois les validations terminées, vous pouvez cliquer sur « Nettoyage du test de basculement » sur le plan de récupération. L’environnement de test de basculement est alors nettoyé.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-260">Once the validations are complete, you can click 'Cleanup test failover' on the recovery plan and the test failover environment is cleaned.</span></span>

<span data-ttu-id="ac6b2-261">Pour obtenir des conseils sur la réalisation du test de basculement pour Active Directory et DNS, consultez le document [Considérations relatives au test de basculement pour Active Directory et DNS](site-recovery-active-directory.md#test-failover-considerations).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-261">For guidance on doing test failover for AD and DNS, refer to [Test failover considerations for AD and DNS](site-recovery-active-directory.md#test-failover-considerations) document.</span></span>

<span data-ttu-id="ac6b2-262">Pour obtenir des conseils sur la réalisation du test de basculement pour les groupes de disponibilité SQL AlwaysOn, consultez le document [Réalisation d’un test de basculement pour SQL Server AlwaysOn](site-recovery-sql.md#steps-to-do-a-test-failover).</span><span class="sxs-lookup"><span data-stu-id="ac6b2-262">For guidance on doing test failover for SQL Always ON availability groups, refer to [Doing Test failover for SQL Server Always On](site-recovery-sql.md#steps-to-do-a-test-failover) document.</span></span>

## <a name="doing-a-failover"></a><span data-ttu-id="ac6b2-263">Exécution d’un basculement</span><span class="sxs-lookup"><span data-stu-id="ac6b2-263">Doing a failover</span></span>
<span data-ttu-id="ac6b2-264">Suivez [ce guide](site-recovery-failover.md) pour réaliser un basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-264">Follow [this guidance](site-recovery-failover.md) for doing a failover.</span></span>

1.  <span data-ttu-id="ac6b2-265">Accédez au portail Azure et sélectionnez votre coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-265">Go to Azure portal and select your Recovery Services vault.</span></span>
2.  <span data-ttu-id="ac6b2-266">Cliquez sur le plan de récupération créé pour l’application SharePoint.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-266">Click on the recovery plan created for SharePoint application.</span></span>
3.  <span data-ttu-id="ac6b2-267">Cliquez sur « Basculement ».</span><span class="sxs-lookup"><span data-stu-id="ac6b2-267">Click on 'Failover'.</span></span>
4.  <span data-ttu-id="ac6b2-268">Sélectionnez un point de récupération pour démarrer le processus de basculement.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-268">Select recovery point to start the failover process.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ac6b2-269">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="ac6b2-269">Next steps</span></span>
<span data-ttu-id="ac6b2-270">Vous pouvez en savoir plus sur la [réplication d’autres applications](site-recovery-workload.md) à l’aide de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="ac6b2-270">You can learn more about [replicating other applications](site-recovery-workload.md) using Site Recovery.</span></span>
