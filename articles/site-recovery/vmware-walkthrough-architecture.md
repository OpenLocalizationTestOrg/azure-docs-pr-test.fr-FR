---
title: "Examen de l’architecture de la réplication VMware sur Azure | Microsoft Docs"
description: "Cet article fournit une vue d’ensemble des composants et de l’architecture utilisés lors de la réplication de machines virtuelles VMware locales sur Azure avec le service Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27.017
ms.author: raynew
ms.openlocfilehash: 4aae04a793bab11562c20ceec0e1ae8f1a035a0f
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-vmware-replication-to-azure"></a><span data-ttu-id="a4a39-103">Étape 1 : examen de l’architecture pour la réplication de VMware sur Azure</span><span class="sxs-lookup"><span data-stu-id="a4a39-103">Step 1: Review the architecture for VMware replication to Azure</span></span>

<span data-ttu-id="a4a39-104">Cet article décrit les composants et les processus impliqués dans la réplication des machines virtuelles VMware locales sur Azure à l’aide du service [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a4a39-104">This article describes the components and processes used when replicating on-premises VMware virtual machines to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="a4a39-105">Publiez des commentaires au bas de cet article ou posez des questions sur le [Forum Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="a4a39-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="a4a39-106">Composants architecturaux</span><span class="sxs-lookup"><span data-stu-id="a4a39-106">Architectural components</span></span>

<span data-ttu-id="a4a39-107">Le tableau récapitule les composants dont vous avez besoin.</span><span class="sxs-lookup"><span data-stu-id="a4a39-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="a4a39-108">**Composant**</span><span class="sxs-lookup"><span data-stu-id="a4a39-108">**Component**</span></span> | <span data-ttu-id="a4a39-109">**Prérequis**</span><span class="sxs-lookup"><span data-stu-id="a4a39-109">**Requirement**</span></span> | <span data-ttu-id="a4a39-110">**Détails**</span><span class="sxs-lookup"><span data-stu-id="a4a39-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="a4a39-111">**Microsoft Azure**</span><span class="sxs-lookup"><span data-stu-id="a4a39-111">**Azure**</span></span> | <span data-ttu-id="a4a39-112">Vous avez besoin d’un abonnement Azure, d’un compte de stockage Azure et d’un Réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-112">You need an Azure subscription, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="a4a39-113">Les données répliquées sont stockées dans le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="a4a39-113">Replicated data is stored in the storage account.</span></span> <span data-ttu-id="a4a39-114">Les machines virtuelles Azure sont créées avec les données répliquées lors du basculement à partir de votre site local.</span><span class="sxs-lookup"><span data-stu-id="a4a39-114">Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="a4a39-115">Les machines virtuelles Azure se connectent au réseau virtuel Azure lors de leur création.</span><span class="sxs-lookup"><span data-stu-id="a4a39-115">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="a4a39-116">**Serveur de configuration**</span><span class="sxs-lookup"><span data-stu-id="a4a39-116">**Configuration server**</span></span> | <span data-ttu-id="a4a39-117">Un seul serveur d’administration local (VMware VM) qui exécute les composants locaux de Site Recovery pour le déploiement.</span><span class="sxs-lookup"><span data-stu-id="a4a39-117">A single on-premises management server (VMware VM) that runs all the on-premises Site Recovery components for the deployment.</span></span> <span data-ttu-id="a4a39-118">Ces derniers incluent un serveur de configuration, serveur de processus, serveur maître.</span><span class="sxs-lookup"><span data-stu-id="a4a39-118">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="a4a39-119">Le composant de serveur de configuration coordonne la communication entre les ordinateurs locaux et Azure, et gère la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="a4a39-119">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="a4a39-120">**Serveur de traitement**:</span><span class="sxs-lookup"><span data-stu-id="a4a39-120">**Process server**:</span></span>  | <span data-ttu-id="a4a39-121">Installé par défaut sur le serveur de configuration.</span><span class="sxs-lookup"><span data-stu-id="a4a39-121">Installed by default on the configuration server.</span></span> | <span data-ttu-id="a4a39-122">Fait office de passerelle de réplication.</span><span class="sxs-lookup"><span data-stu-id="a4a39-122">Acts as a replication gateway.</span></span> <span data-ttu-id="a4a39-123">Reçoit les données de réplication, les optimise grâce à la mise en cache, la compression et le chiffrement et les envoie vers le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-123">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="a4a39-124">Le serveur de traitement gère également l’installation Push du service Mobilité sur des machines protégées et assure la détection automatique des machines virtuelles VMware.</span><span class="sxs-lookup"><span data-stu-id="a4a39-124">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="a4a39-125">À mesure que s’étend votre déploiement, vous pouvez ajouter des serveurs de traitement dédiés supplémentaires afin de gérer de plus grands volumes de trafic de réplication.</span><span class="sxs-lookup"><span data-stu-id="a4a39-125">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="a4a39-126">**Serveur cible maître**</span><span class="sxs-lookup"><span data-stu-id="a4a39-126">**Master target server**</span></span> | <span data-ttu-id="a4a39-127">Installé par défaut sur le serveur de configuration local.</span><span class="sxs-lookup"><span data-stu-id="a4a39-127">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="a4a39-128">Gère les données de réplication pendant la restauration automatique à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-128">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="a4a39-129">Si les volumes de trafic de restauration automatique sont importants, vous pouvez déployer un serveur cible maître distinct pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="a4a39-129">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="a4a39-130">**Serveurs VMware**</span><span class="sxs-lookup"><span data-stu-id="a4a39-130">**VMware servers**</span></span> | <span data-ttu-id="a4a39-131">Les machines virtuelles VMware sont hébergées sur des serveurs vSphere ESXi et nous vous recommandons d’utiliser un serveur vCenter pour gérer les ordinateurs hôtes.</span><span class="sxs-lookup"><span data-stu-id="a4a39-131">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="a4a39-132">Vous ajoutez des serveurs VMware à votre coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="a4a39-132">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="a4a39-133">**Machines répliquées**</span><span class="sxs-lookup"><span data-stu-id="a4a39-133">**Replicated machines**</span></span> | <span data-ttu-id="a4a39-134">Le service Mobilité sera installé sur chaque machine virtuelle VMware que vous répliquez.</span><span class="sxs-lookup"><span data-stu-id="a4a39-134">The Mobility service will be installed on each VMware VM you replicate.</span></span> <span data-ttu-id="a4a39-135">Il peut être installé manuellement sur chaque ordinateur ou avec une installation push à partir du serveur de traitement.</span><span class="sxs-lookup"><span data-stu-id="a4a39-135">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="a4a39-136">**Figure 1 : composants VMware vers Azure**</span><span class="sxs-lookup"><span data-stu-id="a4a39-136">**Figure 1: VMware to Azure components**</span></span>

![Composants](./media/vmware-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="a4a39-138">Processus de réplication</span><span class="sxs-lookup"><span data-stu-id="a4a39-138">Replication process</span></span>

1. <span data-ttu-id="a4a39-139">Vous configurez le déploiement, notamment celui des composants locaux et des composants Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-139">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="a4a39-140">Dans le coffre Recovery Services, vous spécifiez la source et la cible de réplication, configurez le serveur de configuration, créez une stratégie de réplication, déployez le service Mobilité, activez la réplication et effectuez un test de basculement.</span><span class="sxs-lookup"><span data-stu-id="a4a39-140">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2. <span data-ttu-id="a4a39-141">Les machines répliquent conformément à la stratégie définie, et une copie initiale des données est répliquée dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-141">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
3. <span data-ttu-id="a4a39-142">La réplication des modifications delta dans Azure commence à l’issue de la réplication initiale.</span><span class="sxs-lookup"><span data-stu-id="a4a39-142">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="a4a39-143">Le suivi des modifications d’une machine est conservé dans un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="a4a39-143">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="a4a39-144">Les machines qui assurent la réplication communiquent avec le serveur de configuration sur le port HTTPS 443 entrants, pour la gestion de la réplication.</span><span class="sxs-lookup"><span data-stu-id="a4a39-144">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="a4a39-145">Les machines qui assurent la réplication envoient des données de réplication au serveur de processus sur le port HTTPS 9443 entrant (modification possible).</span><span class="sxs-lookup"><span data-stu-id="a4a39-145">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="a4a39-146">Le serveur de configuration orchestre la gestion de la réplication avec Azure sur le port HTTPS 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="a4a39-146">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="a4a39-147">Le serveur de traitement reçoit les données à partir des machines source, puis les chiffre et les envoie au stockage Azure via le port 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="a4a39-147">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="a4a39-148">Si vous activez la cohérence multimachine virtuelle, les machines du groupe de réplication communiquent entre elles sur le port 20004.</span><span class="sxs-lookup"><span data-stu-id="a4a39-148">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="a4a39-149">Le mode multimachine virtuelle est utilisé si vous regroupez plusieurs machines dans des groupes de réplication qui partagent des points de récupération cohérents en cas d’incident et avec les applications lorsqu’ils basculent.</span><span class="sxs-lookup"><span data-stu-id="a4a39-149">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="a4a39-150">Cela est utile si les machines exécutent la même charge de travail et doivent être cohérentes.</span><span class="sxs-lookup"><span data-stu-id="a4a39-150">This is useful if machines are running the same workload and need to be consistent.</span></span>
4. <span data-ttu-id="a4a39-151">Le trafic est répliqué sur des points de terminaison publics de stockage Azure via Internet.</span><span class="sxs-lookup"><span data-stu-id="a4a39-151">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="a4a39-152">L’autre solution consiste à utiliser l’[homologation publique](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="a4a39-152">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="a4a39-153">La réplication du trafic à partir d’un site local vers Azure via un réseau VPN de site à site n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="a4a39-153">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>


<span data-ttu-id="a4a39-154">**Figure 2 : réplication de VMware vers Azure**</span><span class="sxs-lookup"><span data-stu-id="a4a39-154">**Figure 2: VMware to Azure replication**</span></span>

![Amélioré](./media/vmware-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="a4a39-156">Processus de basculement et de restauration automatique</span><span class="sxs-lookup"><span data-stu-id="a4a39-156">Failover and failback process</span></span>

1. <span data-ttu-id="a4a39-157">Après avoir vérifié que le test de basculement fonctionne comme prévu, vous pouvez exécuter des basculements non planifiés sur Azure en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="a4a39-157">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="a4a39-158">Le basculement planifié n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="a4a39-158">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="a4a39-159">Vous pouvez basculer une seule machine ou créer des [plans de récupération](site-recovery-create-recovery-plans.md) pour basculer plusieurs machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="a4a39-159">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="a4a39-160">Lorsque vous effectuez un basculement, les machines virtuelles répliquées sont créées dans Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-160">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="a4a39-161">Vous validez un basculement pour accéder à la charge de travail à partir de la machine virtuelle Azure répliquée.</span><span class="sxs-lookup"><span data-stu-id="a4a39-161">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="a4a39-162">Lorsque votre site local principal est à nouveau disponible, vous pouvez lancer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="a4a39-162">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="a4a39-163">Vous configurez une infrastructure de restauration automatique, lancez la réplication de la machine à partir du site secondaire vers le site principal et effectuez un basculement non planifié à partir du site secondaire.</span><span class="sxs-lookup"><span data-stu-id="a4a39-163">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="a4a39-164">Une fois ce basculement validé, les données sont à nouveau disponibles en local et vous devez relancer la réplication sur Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-164">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="a4a39-165">En savoir plus</span><span class="sxs-lookup"><span data-stu-id="a4a39-165">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="a4a39-166">La restauration automatique doit répondre à plusieurs conditions requises :</span><span class="sxs-lookup"><span data-stu-id="a4a39-166">There are a few failback requirements:</span></span>


- <span data-ttu-id="a4a39-167">**Serveur de traitement temporaire dans Azure**: si vous souhaitez effectuer une restauration automatique à partir d’Azure après le basculement, vous devez définir une machine virtuelle Azure configurée comme serveur de traitement pour gérer la réplication à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-167">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="a4a39-168">Vous pourrez supprimer cette machine virtuelle une fois la restauration terminée.</span><span class="sxs-lookup"><span data-stu-id="a4a39-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="a4a39-169">**Connexion VPN**: pour une restauration automatique, vous devrez disposer d’une connexion VPN (ou d’Azure ExpressRoute) configurée à partir du réseau Azure sur le site local.</span><span class="sxs-lookup"><span data-stu-id="a4a39-169">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="a4a39-170">**Serveur cible maître local distinct** : le serveur cible maître local gère la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="a4a39-170">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="a4a39-171">Le serveur cible maître est installé par défaut sur le serveur d’administration. Toutefois, si vous restaurez automatiquement de plus grands volumes de trafic vous devez définir un serveur cible maître local à cet effet.</span><span class="sxs-lookup"><span data-stu-id="a4a39-171">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="a4a39-172">**Stratégie de restauration automatique** : pour répliquer vers votre site local, vous avez besoin d’une stratégie de restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="a4a39-172">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="a4a39-173">Celle-ci est automatiquement créée lors de la création de votre stratégie de réplication.</span><span class="sxs-lookup"><span data-stu-id="a4a39-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="a4a39-174">**Infrastructure VMware** : vous devez basculer vers une machine virtuelle VMware locale.</span><span class="sxs-lookup"><span data-stu-id="a4a39-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="a4a39-175">Cela signifie que vous avez besoin d’une infrastructure VMware locale, même si vous répliquez des serveurs physiques locaux vers Azure.</span><span class="sxs-lookup"><span data-stu-id="a4a39-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="a4a39-176">**Figure 3 : restauration automatique VMware/physique**</span><span class="sxs-lookup"><span data-stu-id="a4a39-176">**Figure 3: VMware/physical failback**</span></span>

![Restauration automatique](./media/vmware-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="a4a39-178">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a4a39-178">Next steps</span></span>

<span data-ttu-id="a4a39-179">Aller à [Étape 2 : vérifier les conditions préalables et les limitations](vmware-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="a4a39-179">Go to [Step 2: Verify prerequisites and limitations](vmware-walkthrough-prerequisites.md)</span></span>
