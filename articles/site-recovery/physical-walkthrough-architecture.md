---
title: "Vérifier l’architecture de la réplication de serveurs physiques dans Azure à l’aide d’Azure Site Recovery | Microsoft Docs"
description: "Cet article fournit une vue d’ensemble des composants et de l’architecture utilisés lors de la réplication de serveurs physiques locaux dans Azure avec le service Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a><span data-ttu-id="38344-103">Étape 1 : vérifier l’architecture de la réplication de serveurs physiques dans Azure</span><span class="sxs-lookup"><span data-stu-id="38344-103">Step 1: Review the architecture for physical server replication to Azure</span></span>

<span data-ttu-id="38344-104">Cet article décrit les composants et les processus utilisés lorsque vous répliquez des serveurs physiques Windows/Linux locaux dans Azure à l’aide du service [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="38344-104">This article describes the components and processes used when you replicate on-premises Windows/Linux physical servers to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="38344-105">Publiez des commentaires au bas de cet article ou posez des questions sur le [Forum Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="38344-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="38344-106">Composants architecturaux</span><span class="sxs-lookup"><span data-stu-id="38344-106">Architectural components</span></span>

<span data-ttu-id="38344-107">Le tableau récapitule les composants dont vous avez besoin.</span><span class="sxs-lookup"><span data-stu-id="38344-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="38344-108">**Composant**</span><span class="sxs-lookup"><span data-stu-id="38344-108">**Component**</span></span> | <span data-ttu-id="38344-109">**Prérequis**</span><span class="sxs-lookup"><span data-stu-id="38344-109">**Requirement**</span></span> | <span data-ttu-id="38344-110">**Détails**</span><span class="sxs-lookup"><span data-stu-id="38344-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="38344-111">**Microsoft Azure**</span><span class="sxs-lookup"><span data-stu-id="38344-111">**Azure**</span></span> | <span data-ttu-id="38344-112">Vous avez besoin d’un compte Azure, d’un compte de stockage Azure et d’un réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="38344-113">Les données répliquées sont stockées dans le compte de stockage, et les machines virtuelles Azure sont créées avec les données répliquées lors du basculement.</span><span class="sxs-lookup"><span data-stu-id="38344-113">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover occurs.</span></span> <span data-ttu-id="38344-114">Les machines virtuelles Azure se connectent au réseau virtuel Azure lors de leur création.</span><span class="sxs-lookup"><span data-stu-id="38344-114">Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="38344-115">**Serveur de configuration**</span><span class="sxs-lookup"><span data-stu-id="38344-115">**Configuration server**</span></span> | <span data-ttu-id="38344-116">Un seul serveur d’administration local (serveur physique ou machine virtuelle VMware) qui exécute tous les composants locaux de Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="38344-116">A single on-premises management server (physical server or VMware VM) that runs all the on-premises Site Recovery components.</span></span> <span data-ttu-id="38344-117">Ces derniers incluent un serveur de configuration, un serveur de processus et un serveur cible maître.</span><span class="sxs-lookup"><span data-stu-id="38344-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="38344-118">Le composant de serveur de configuration coordonne la communication entre les ordinateurs locaux et Azure, et gère la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="38344-118">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="38344-119">**Serveur de traitement**</span><span class="sxs-lookup"><span data-stu-id="38344-119">**Process server**</span></span>  | <span data-ttu-id="38344-120">Installé par défaut sur le serveur de configuration.</span><span class="sxs-lookup"><span data-stu-id="38344-120">Installed by default on the configuration server.</span></span> | <span data-ttu-id="38344-121">Fait office de passerelle de réplication.</span><span class="sxs-lookup"><span data-stu-id="38344-121">Acts as a replication gateway.</span></span> <span data-ttu-id="38344-122">Reçoit les données de réplication, les optimise grâce à la mise en cache, la compression et le chiffrement et les envoie vers le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="38344-123">Le serveur de processus gère également l’installation Push du service Mobilité sur des machines protégées.</span><span class="sxs-lookup"><span data-stu-id="38344-123">The process server also handles push installation of the Mobility service to protected machines.</span></span><br/><br/> <span data-ttu-id="38344-124">Vous pouvez ajouter séparément des serveurs de processus dédiés supplémentaires afin de gérer de plus grands volumes de trafic de réplication.</span><span class="sxs-lookup"><span data-stu-id="38344-124">You can add additional separate dedicated process servers, to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="38344-125">**Serveur cible maître**</span><span class="sxs-lookup"><span data-stu-id="38344-125">**Master target server**</span></span> | <span data-ttu-id="38344-126">Installé par défaut sur le serveur de configuration local.</span><span class="sxs-lookup"><span data-stu-id="38344-126">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="38344-127">Gère les données de réplication pendant la restauration automatique à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="38344-128">Si les volumes de trafic de restauration automatique sont importants, vous pouvez déployer un serveur cible maître distinct pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="38344-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="38344-129">**Serveurs répliqués**</span><span class="sxs-lookup"><span data-stu-id="38344-129">**Replicated servers**</span></span> | <span data-ttu-id="38344-130">Le composant service Mobilité est installé sur chaque serveur Windows/Linux à répliquer.</span><span class="sxs-lookup"><span data-stu-id="38344-130">The Mobility service component is installed on each Windows/Linux server you want to replicate.</span></span> <span data-ttu-id="38344-131">Il peut être installé manuellement sur chaque ordinateur ou avec une installation push à partir du serveur de traitement.</span><span class="sxs-lookup"><span data-stu-id="38344-131">It can be installed manually on each machine, or with a push installation from the process server.</span></span>
<span data-ttu-id="38344-132">**Restauration automatique**</span><span class="sxs-lookup"><span data-stu-id="38344-132">**Failback**</span></span> | <span data-ttu-id="38344-133">Une infrastructure VMware est requise pour la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="38344-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="38344-134">Il est impossible d’effectuer cette procédure vers un serveur physique.</span><span class="sxs-lookup"><span data-stu-id="38344-134">You can't fail back to a physical server.</span></span>


<span data-ttu-id="38344-135">**Figure 1 : serveur physique vers composants Azure**</span><span class="sxs-lookup"><span data-stu-id="38344-135">**Figure 1: Physical to Azure components**</span></span>

![Composants](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="38344-137">Processus de réplication</span><span class="sxs-lookup"><span data-stu-id="38344-137">Replication process</span></span>

1. <span data-ttu-id="38344-138">Vous configurez le déploiement, notamment celui des composants locaux et des composants Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-138">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="38344-139">Dans le coffre Recovery Services, vous spécifiez la source et la cible de réplication, configurez le serveur de configuration, créez une stratégie de réplication, déployez le service Mobilité, activez la réplication et effectuez un test de basculement.</span><span class="sxs-lookup"><span data-stu-id="38344-139">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="38344-140">Les machines répliquent conformément à la stratégie définie, et une copie initiale des données est répliquée dans le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-140">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="38344-141">La réplication des modifications delta dans Azure commence à l’issue de la réplication initiale.</span><span class="sxs-lookup"><span data-stu-id="38344-141">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="38344-142">Le suivi des modifications d’une machine est conservé dans un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="38344-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="38344-143">Les machines qui assurent la réplication communiquent avec le serveur de configuration sur le port HTTPS 443 entrants, pour la gestion de la réplication.</span><span class="sxs-lookup"><span data-stu-id="38344-143">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="38344-144">Les machines qui assurent la réplication envoient des données de réplication au serveur de processus sur le port HTTPS 9443 entrant (modification possible).</span><span class="sxs-lookup"><span data-stu-id="38344-144">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="38344-145">Le serveur de configuration orchestre la gestion de la réplication avec Azure sur le port HTTPS 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="38344-145">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="38344-146">Le serveur de traitement reçoit les données à partir des machines source, puis les chiffre et les envoie au stockage Azure via le port 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="38344-146">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="38344-147">Si vous activez la cohérence multimachine virtuelle, les machines du groupe de réplication communiquent entre elles sur le port 20004.</span><span class="sxs-lookup"><span data-stu-id="38344-147">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="38344-148">Le mode multimachine virtuelle est utilisé si vous regroupez plusieurs machines dans des groupes de réplication qui partagent des points de récupération cohérents en cas d’incident et avec les applications lorsqu’ils basculent.</span><span class="sxs-lookup"><span data-stu-id="38344-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="38344-149">Cela est utile si les machines exécutent la même charge de travail et doivent être cohérentes.</span><span class="sxs-lookup"><span data-stu-id="38344-149">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="38344-150">Le trafic est répliqué sur des points de terminaison publics de stockage Azure via Internet.</span><span class="sxs-lookup"><span data-stu-id="38344-150">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="38344-151">L’autre solution consiste à utiliser l’[homologation publique](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="38344-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="38344-152">La réplication du trafic à partir d’un site local vers Azure via un réseau VPN de site à site n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="38344-152">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="38344-153">**Figure 2 : réplication de serveur physique dans Azure**</span><span class="sxs-lookup"><span data-stu-id="38344-153">**Figure 2: Physical to Azure replication**</span></span>

![Amélioré](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="38344-155">Processus de basculement et de restauration automatique</span><span class="sxs-lookup"><span data-stu-id="38344-155">Failover and failback process</span></span>

<span data-ttu-id="38344-156">Après avoir vérifié que le test de basculement fonctionne comme prévu, vous pouvez exécuter des basculements non planifiés sur Azure en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="38344-156">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="38344-157">Lorsque vous exécutez un basculement, les machines virtuelles Azure sont créées à partir des données répliquées.</span><span class="sxs-lookup"><span data-stu-id="38344-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="38344-158">Lorsque votre site local principal est à nouveau disponible, vous pouvez lancer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="38344-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="38344-159">Notez les points suivants :</span><span class="sxs-lookup"><span data-stu-id="38344-159">Note that:</span></span>

- <span data-ttu-id="38344-160">Le basculement planifié n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="38344-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="38344-161">Vous pouvez basculer une seule machine ou créer des [plans de récupération](site-recovery-create-recovery-plans.md) pour basculer ensemble plusieurs machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="38344-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple machines together.</span></span>
- <span data-ttu-id="38344-162">Vous validez un basculement pour accéder à la charge de travail à partir de la machine virtuelle Azure répliquée.</span><span class="sxs-lookup"><span data-stu-id="38344-162">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
- <span data-ttu-id="38344-163">Lorsque le site principal est à nouveau disponible, vous répliquez la machine du site secondaire vers le site principal.</span><span class="sxs-lookup"><span data-stu-id="38344-163">When the primary site is available again, you replicate the machine from the secondary to the primary site.</span></span> <span data-ttu-id="38344-164">Exécutez ensuite un basculement non planifié à partir du site secondaire.</span><span class="sxs-lookup"><span data-stu-id="38344-164">Then, run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="38344-165">Une fois ce basculement validé, les données sont à nouveau disponibles en local et vous devez relancer la réplication sur Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-165">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span>

<span data-ttu-id="38344-166">Composants de la restauration automatique :</span><span class="sxs-lookup"><span data-stu-id="38344-166">Failback components include:</span></span>

- <span data-ttu-id="38344-167">**Serveur de processus temporaire dans Azure** : vous devez configurer une machine virtuelle Azure en tant que serveur de processus pour gérer la réplication à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-167">**Temporary process server in Azure**: You need to set up an Azure VM to act as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="38344-168">Vous pourrez supprimer cette machine virtuelle une fois la restauration terminée.</span><span class="sxs-lookup"><span data-stu-id="38344-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="38344-169">**Connexion VPN** : vous avez besoin d’une connexion VPN (ou Azure ExpressRoute) du réseau Azure vers le site local.</span><span class="sxs-lookup"><span data-stu-id="38344-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="38344-170">**Serveur cible maître local distinct** : le serveur cible maître local (installé par défaut sur le serveur de configuration) gère la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="38344-170">**Separate on-premises master target server**: The on-premises master target server (installed by default on the configuration server) handles failback.</span></span> <span data-ttu-id="38344-171">Si vous restaurez automatiquement de grands volumes de trafic, vous devez configurer un serveur cible maître local distinct à cet effet.</span><span class="sxs-lookup"><span data-stu-id="38344-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="38344-172">**Stratégie de restauration automatique** : vous devez définir une stratégie de restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="38344-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="38344-173">Celle-ci est automatiquement créée lors de la création de votre stratégie de réplication.</span><span class="sxs-lookup"><span data-stu-id="38344-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="38344-174">**Infrastructure VMware** : vous devez basculer vers une machine virtuelle VMware locale.</span><span class="sxs-lookup"><span data-stu-id="38344-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="38344-175">Cela signifie que vous avez besoin d’une infrastructure VMware locale, même si vous répliquez des serveurs physiques locaux vers Azure.</span><span class="sxs-lookup"><span data-stu-id="38344-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="38344-176">**Figure 3 : restauration automatique de serveur physique**</span><span class="sxs-lookup"><span data-stu-id="38344-176">**Figure 3: Physical server failback**</span></span>

![Restauration automatique](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="38344-178">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="38344-178">Next steps</span></span>

<span data-ttu-id="38344-179">Aller à [Étape 2 : vérifier les conditions préalables et les limitations](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="38344-179">Go to [Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>
