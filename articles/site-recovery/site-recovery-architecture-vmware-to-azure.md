---
title: "aaaHow fonctionne VMware réplication tooAzure dans Azure Site Recovery ? | Microsoft Docs"
description: "Cet article fournit une vue d’ensemble des composants et architecture utilisée lors de la réplication locale tooAzure serveurs physiques avec hello service Azure Site Recovery et les ordinateurs virtuels VMware"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: f0fb834f8b251640f97e4d0163b2b9e54de691e1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="how-does-vmware-replication-tooazure-work-in-site-recovery"></a><span data-ttu-id="36433-104">Comment VMware réplication tooAzure fonctionne en mode de récupération de Site ?</span><span class="sxs-lookup"><span data-stu-id="36433-104">How does VMware replication tooAzure work in Site Recovery?</span></span>

<span data-ttu-id="36433-105">Cet article décrit les composants hello et processus impliqués lors de la réplication locale tooAzure d’ordinateurs virtuels et les serveurs physiques Windows/Linux, VMware à l’aide de hello [Azure Site Recovery](site-recovery-overview.md) service.</span><span class="sxs-lookup"><span data-stu-id="36433-105">This article describes hello components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, tooAzure using hello [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="36433-106">Lorsque vous répliquez tooAzure des serveurs physiques locaux, la réplication utilise également hello même des composants et des processus en tant que la réplication VMware VM, avec ces différences :</span><span class="sxs-lookup"><span data-stu-id="36433-106">When you replicate physical on-premises servers tooAzure, replication uses also hello same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="36433-107">Vous pouvez utiliser un serveur physique pour le serveur de configuration hello, au lieu d’un VM VMware.</span><span class="sxs-lookup"><span data-stu-id="36433-107">You can use a physical server for hello configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="36433-108">Il vous faudra une infrastructure VMware locale pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="36433-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="36433-109">Vous ne peuvent pas basculer l’ordinateur physique tooa précédent.</span><span class="sxs-lookup"><span data-stu-id="36433-109">You can't fail back tooa physical machine.</span></span>

<span data-ttu-id="36433-110">Valider les commentaires en bas de hello de cet article, ou poser des questions dans hello [Forum sur Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="36433-110">Post any comments at hello bottom of this article, or ask questions in hello [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="36433-111">Composants architecturaux</span><span class="sxs-lookup"><span data-stu-id="36433-111">Architectural components</span></span>

<span data-ttu-id="36433-112">Un certain nombre de composants sont impliqués lors de la réplication des ordinateurs virtuels VMware et tooAzure des serveurs physiques.</span><span class="sxs-lookup"><span data-stu-id="36433-112">There are a number of components involved when replicating VMware VMs and physical servers tooAzure.</span></span>

<span data-ttu-id="36433-113">**Composant**</span><span class="sxs-lookup"><span data-stu-id="36433-113">**Component**</span></span> | <span data-ttu-id="36433-114">**Emplacement**</span><span class="sxs-lookup"><span data-stu-id="36433-114">**Location**</span></span> | <span data-ttu-id="36433-115">**Détails**</span><span class="sxs-lookup"><span data-stu-id="36433-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="36433-116">**Microsoft Azure**</span><span class="sxs-lookup"><span data-stu-id="36433-116">**Azure**</span></span> | <span data-ttu-id="36433-117">Dans Azure, vous avez besoin d’un Compte Azure, d’un compte de stockage Azure et d’un Réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="36433-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="36433-118">Les données répliquées sont stockées dans le compte de stockage hello et machines virtuelles Azure sont créés avec les données de salutation répliquée en cas de basculement à partir de votre site local.</span><span class="sxs-lookup"><span data-stu-id="36433-118">Replicated data is stored in hello storage account, and Azure VMs are created with hello replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="36433-119">Hello machines virtuelles Azure se connecter toohello réseau virtuel Azure lorsqu’elles sont créées.</span><span class="sxs-lookup"><span data-stu-id="36433-119">hello Azure VMs connect toohello Azure virtual network when they're created.</span></span>
<span data-ttu-id="36433-120">**Serveur de configuration**</span><span class="sxs-lookup"><span data-stu-id="36433-120">**Configuration server**</span></span> | <span data-ttu-id="36433-121">Un seul serveur d’administration (VMWare VM) qui s’exécute tous les composants locaux hello qui sont nécessaires pour le déploiement de hello, y compris le serveur de configuration hello, serveur de processus, serveur cible maître sur site</span><span class="sxs-lookup"><span data-stu-id="36433-121">A single on-premises management server (VMWare VM) that runs all hello on-premises components that are needed for hello deployment, including hello configuration server, process server, master target server</span></span> | <span data-ttu-id="36433-122">composant de serveur de configuration Hello coordonne les communications entre Azure et locaux et gère la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="36433-122">hello configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="36433-123">**Serveur de traitement**:</span><span class="sxs-lookup"><span data-stu-id="36433-123">**Process server**:</span></span>  | <span data-ttu-id="36433-124">Installé par défaut sur le serveur de configuration hello.</span><span class="sxs-lookup"><span data-stu-id="36433-124">Installed by default on hello configuration server.</span></span> | <span data-ttu-id="36433-125">Fait office de passerelle de réplication.</span><span class="sxs-lookup"><span data-stu-id="36433-125">Acts as a replication gateway.</span></span> <span data-ttu-id="36433-126">Reçoit les données de réplication, il optimise avec la mise en cache, la compression et le chiffrement et l’envoie tooAzure stockage.</span><span class="sxs-lookup"><span data-stu-id="36433-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it tooAzure storage.</span></span><br/><br/> <span data-ttu-id="36433-127">serveur de processus Hello gère l’installation push des machines de tooprotected de service de mobilité hello et effectue la détection automatique des ordinateurs virtuels VMware.</span><span class="sxs-lookup"><span data-stu-id="36433-127">hello process server also handles push installation of hello Mobility service tooprotected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="36433-128">À mesure que votre déploiement augmente, vous pouvez ajouter toohandle de serveurs de processus dédié distinct supplémentaire augmentation des volumes de trafic de réplication.</span><span class="sxs-lookup"><span data-stu-id="36433-128">As your deployment grows you can add additional separate dedicated process servers toohandle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="36433-129">**Serveur cible maître**</span><span class="sxs-lookup"><span data-stu-id="36433-129">**Master target server**</span></span> | <span data-ttu-id="36433-130">Installé par défaut sur le serveur de configuration local hello.</span><span class="sxs-lookup"><span data-stu-id="36433-130">Installed by default on hello on-premises configuration server.</span></span> | <span data-ttu-id="36433-131">Gère les données de réplication pendant la restauration automatique à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="36433-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="36433-132">Si les volumes de trafic de restauration automatique sont importants, vous pouvez déployer un serveur cible maître distinct pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="36433-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="36433-133">**Serveurs VMware**</span><span class="sxs-lookup"><span data-stu-id="36433-133">**VMware servers**</span></span> | <span data-ttu-id="36433-134">Les ordinateurs virtuels VMware sont hébergés sur des serveurs vSphere ESXi, et nous recommandons un vCenter hôtes hello toomanage du serveur.</span><span class="sxs-lookup"><span data-stu-id="36433-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server toomanage hello hosts.</span></span> | <span data-ttu-id="36433-135">Vous ajoutez le coffre de Services de récupération de tooyour de serveurs VMware.</span><span class="sxs-lookup"><span data-stu-id="36433-135">You add VMware servers tooyour Recovery Services vault.</span></span>
<span data-ttu-id="36433-136">**Machines répliquées**</span><span class="sxs-lookup"><span data-stu-id="36433-136">**Replicated machines**</span></span> | <span data-ttu-id="36433-137">Hello service mobilité sera installé sur chaque machine virtuelle que vous souhaitez tooreplicate VMware.</span><span class="sxs-lookup"><span data-stu-id="36433-137">hello Mobility service will be installed on each VMware VM you want tooreplicate.</span></span> <span data-ttu-id="36433-138">Il peut être installé manuellement sur chaque ordinateur, ou avec une installation poussée du hello du serveur de processus.</span><span class="sxs-lookup"><span data-stu-id="36433-138">It can be installed manually on each machine, or with a push installation from hello process server.</span></span>

<span data-ttu-id="36433-139">En savoir plus sur les conditions préalables au déploiement de hello et la configuration requise pour chacun de ces composants Bonjour [matrice de prise en charge](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="36433-139">Learn about hello deployment prerequisites and requirements for each of these components in hello [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="36433-140">**Figure 1 : VMware tooAzure composants**</span><span class="sxs-lookup"><span data-stu-id="36433-140">**Figure 1: VMware tooAzure components**</span></span>

![Composants](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="36433-142">Processus de réplication</span><span class="sxs-lookup"><span data-stu-id="36433-142">Replication process</span></span>

1. <span data-ttu-id="36433-143">Vous définissez le déploiement hello, y compris les composants Azure et un coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="36433-143">You set up hello deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="36433-144">Dans le coffre de hello, vous spécifiez la source de réplication hello cible, configurez le serveur de configuration hello, ajouter des serveurs VMware, créer une stratégie de réplication, déployer le service de mobilité hello, activer la réplication et exécuter un test de basculement.</span><span class="sxs-lookup"><span data-stu-id="36433-144">In hello vault you specify hello replication source and target, set up hello configuration server, add VMware servers, create a replication policy, deploy hello Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="36433-145">Ordinateurs commence à répliquer conformément à la stratégie de réplication hello et une copie initiale des données de salutation est répliquée tooAzure stockage.</span><span class="sxs-lookup"><span data-stu-id="36433-145">Machines start replicating in accordance with hello replication policy, and an initial copy of hello data is replicated tooAzure storage.</span></span>
4. <span data-ttu-id="36433-146">La réplication de delta modifications tooAzure commence une fois la réplication initiale hello terminée.</span><span class="sxs-lookup"><span data-stu-id="36433-146">Replication of delta changes tooAzure begins after hello initial replication finishes.</span></span> <span data-ttu-id="36433-147">Le suivi des modifications d’une machine est conservé dans un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="36433-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="36433-148">Réplication des ordinateurs communiquent avec le serveur de configuration hello sur le port HTTPS 443 entrants, pour la gestion de la réplication.</span><span class="sxs-lookup"><span data-stu-id="36433-148">Replicating machines communicate with hello configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="36433-149">Réplication des machines envoient le serveur de processus de réplication données toohello sur le port HTTPS 9443 entrants (peut être configuré).</span><span class="sxs-lookup"><span data-stu-id="36433-149">Replicating machines send replication data toohello process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="36433-150">serveur de configuration Hello orchestre la gestion de la réplication avec Azure sur le port 443 HTTPS sortantes.</span><span class="sxs-lookup"><span data-stu-id="36433-150">hello configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="36433-151">serveur de processus Hello reçoit des données à partir d’ordinateurs de la source, optimise crypte et transmet tooAzure stockage via le port 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="36433-151">hello process server receives data from source machines, optimizes and encrypts it, and sends it tooAzure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="36433-152">Si vous activez la cohérence multimachine virtuelle, puis les ordinateurs dans le groupe de réplication hello communiquent entre eux sur le port 20004.</span><span class="sxs-lookup"><span data-stu-id="36433-152">If you enable multi-VM consistency, then machines in hello replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="36433-153">Le mode multimachine virtuelle est utilisé si vous regroupez plusieurs machines dans des groupes de réplication qui partagent des points de récupération cohérents en cas d’incident et avec les applications lorsqu’ils basculent.</span><span class="sxs-lookup"><span data-stu-id="36433-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="36433-154">Cela est utile si les ordinateurs hello la même charge de travail et devez toobe cohérent.</span><span class="sxs-lookup"><span data-stu-id="36433-154">This is useful if machines are running hello same workload and need toobe consistent.</span></span>
5. <span data-ttu-id="36433-155">Le trafic est plus des points de terminaison publics répliquées tooAzure stockage, hello internet.</span><span class="sxs-lookup"><span data-stu-id="36433-155">Traffic is replicated tooAzure storage public endpoints, over hello internet.</span></span> <span data-ttu-id="36433-156">L’autre solution consiste à utiliser l’[homologation publique](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="36433-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="36433-157">Réplication du trafic via une connexion VPN de site à site à partir d’un tooAzure de site local n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="36433-157">Replicating traffic over a site-to-site VPN from an on-premises site tooAzure isn't supported.</span></span>

<span data-ttu-id="36433-158">**Figure 2 : VMware tooAzure réplication**</span><span class="sxs-lookup"><span data-stu-id="36433-158">**Figure 2: VMware tooAzure replication**</span></span>

![Amélioré](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="36433-160">Processus de basculement et de restauration automatique</span><span class="sxs-lookup"><span data-stu-id="36433-160">Failover and failback process</span></span>

1. <span data-ttu-id="36433-161">Après avoir vérifié que le test de basculement fonctionne comme prévu, vous pouvez exécuter des basculements non planifiés tooAzure en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="36433-161">After you verify that test failover is working as expected, you can run unplanned failovers tooAzure as required.</span></span> <span data-ttu-id="36433-162">Le basculement planifié n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="36433-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="36433-163">Vous pouvez basculer d’un seul ordinateur, ou créer [plans de récupération](site-recovery-create-recovery-plans.md), toofail sur plusieurs machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="36433-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), toofail over multiple VMs.</span></span>
3. <span data-ttu-id="36433-164">Lorsque vous effectuez un basculement, les machines virtuelles répliquées sont créées dans Azure.</span><span class="sxs-lookup"><span data-stu-id="36433-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="36433-165">Vous validez un basculement toostart accès hello la charge de travail à partir du réplica de hello machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="36433-165">You commit a failover toostart accessing hello workload from hello replica Azure VM.</span></span>
4. <span data-ttu-id="36433-166">Lorsque votre site local principal est à nouveau disponible, vous pouvez lancer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="36433-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="36433-167">Vous configurez une infrastructure de la restauration automatique, commence à répliquer l’ordinateur de hello de toohello de site secondaire hello principal et exécutez un basculement non planifié à partir du site secondaire de hello.</span><span class="sxs-lookup"><span data-stu-id="36433-167">You set up a failback infrastructure, start replicating hello machine from hello secondary site toohello primary, and run an unplanned failover from hello secondary site.</span></span> <span data-ttu-id="36433-168">Une fois que vous validez ce basculement, les données seront arrière localement, et vous devez tooenable réplication tooAzure à nouveau.</span><span class="sxs-lookup"><span data-stu-id="36433-168">After you commit this failover, data will be back on-premises, and you need tooenable replication tooAzure again.</span></span> [<span data-ttu-id="36433-169">En savoir plus</span><span class="sxs-lookup"><span data-stu-id="36433-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="36433-170">La restauration automatique doit répondre à plusieurs conditions requises :</span><span class="sxs-lookup"><span data-stu-id="36433-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="36433-171">**Serveur de traitement temporaire Azure**: Si vous souhaitez toofail à partir de Azure après le basculement, vous devez tooset d’une machine virtuelle de Azure configuré comme un serveur de processus, la réplication toohandle depuis Azure.</span><span class="sxs-lookup"><span data-stu-id="36433-171">**Temporary process server in Azure**: If you want toofail back from Azure after failover you'll need tooset up an Azure VM configured as a process server, toohandle replication from Azure.</span></span> <span data-ttu-id="36433-172">Vous pourrez supprimer cette machine virtuelle une fois la restauration terminée.</span><span class="sxs-lookup"><span data-stu-id="36433-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="36433-173">**Connexion VPN**: pour la restauration automatique que vous aurez besoin d’une connexion VPN (ou le Azure ExpressRoute) configurer à partir du site local de hello réseau Azure toohello.</span><span class="sxs-lookup"><span data-stu-id="36433-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from hello Azure network toohello on-premises site.</span></span>
- <span data-ttu-id="36433-174">**Serveur maître cible local distinct**: hello locale cible maître server gère la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="36433-174">**Separate on-premises master target server**: hello on-premises master target server handles failback.</span></span> <span data-ttu-id="36433-175">serveur cible maître de Hello est installé par défaut sur le serveur d’administration hello, mais si vous êtes échouent précédent supérieure volumes de trafic vous devez configurer un serveur de la cible maître local distinct à cet effet.</span><span class="sxs-lookup"><span data-stu-id="36433-175">hello master target server is installed by default on hello management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="36433-176">**Stratégie de restauration automatique**: tooyour de retour tooreplicate site local, vous avez besoin d’une stratégie de restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="36433-176">**Failback policy**: tooreplicate back tooyour on-premises site, you need a failback policy.</span></span> <span data-ttu-id="36433-177">Celle-ci est automatiquement créée lors de la création de votre stratégie de réplication.</span><span class="sxs-lookup"><span data-stu-id="36433-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="36433-178">**VMware infrastructure**: vous devez restaurer tooan VMware VM sur site.</span><span class="sxs-lookup"><span data-stu-id="36433-178">**VMware infrastructure**: You must fail back tooan on-premises VMware VM.</span></span> <span data-ttu-id="36433-179">Cela signifie que vous avez besoin d’une infrastructure VMware sur site, même si vous effectuez une réplication tooAzure des serveurs physiques sur site.</span><span class="sxs-lookup"><span data-stu-id="36433-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers tooAzure.</span></span>

<span data-ttu-id="36433-180">**Figure 3 : restauration automatique VMware/physique**</span><span class="sxs-lookup"><span data-stu-id="36433-180">**Figure 3: VMware/physical failback**</span></span>

![Restauration automatique](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="36433-182">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="36433-182">Next steps</span></span>

<span data-ttu-id="36433-183">Hello de révision [matrice de prise en charge](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="36433-183">Review hello [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
