---
title: "Fonctionnement de la réplication VMware sur Azure dans Azure Site Recovery | Microsoft Docs"
description: "Cet article fournit une vue d’ensemble des composants et de l’architecture utilisés lors de la réplication de serveurs physiques et de machines virtuelles VMware locaux vers Azure avec le service Azure Site Recovery."
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: 81f02c1277ae8a2c377ca0d6db67ec4211e9aa5e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-vmware-replication-to-azure-work-in-site-recovery"></a><span data-ttu-id="3ba24-104">Fonctionnement de la réplication VMware sur Azure dans Site Recovery</span><span class="sxs-lookup"><span data-stu-id="3ba24-104">How does VMware replication to Azure work in Site Recovery?</span></span>

<span data-ttu-id="3ba24-105">Cet article décrit les composants et les processus impliqués dans la réplication des serveurs physiques Windows/Linux et des machines virtuelles VMware locaux sur Azure à l’aide du service [Azure Site Recovery](site-recovery-overview.md).</span><span class="sxs-lookup"><span data-stu-id="3ba24-105">This article describes the components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="3ba24-106">Lorsque vous répliquez des serveurs physiques locaux vers Azure, la réplication utilise également les mêmes composants et processus que pour la réplication de machine virtuelle VMware, mais les différences suivantes sont à noter :</span><span class="sxs-lookup"><span data-stu-id="3ba24-106">When you replicate physical on-premises servers to Azure, replication uses also the same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="3ba24-107">Vous pouvez utiliser un serveur physique pour le serveur de configuration, au lieu d’une machine virtuelle VMware.</span><span class="sxs-lookup"><span data-stu-id="3ba24-107">You can use a physical server for the configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="3ba24-108">Il vous faudra une infrastructure VMware locale pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="3ba24-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="3ba24-109">Il est impossible d’effectuer une restauration sur un serveur physique.</span><span class="sxs-lookup"><span data-stu-id="3ba24-109">You can't fail back to a physical machine.</span></span>

<span data-ttu-id="3ba24-110">Publiez des commentaires au bas de cet article ou posez des questions sur le [Forum Azure Recovery Services](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="3ba24-110">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="3ba24-111">Composants architecturaux</span><span class="sxs-lookup"><span data-stu-id="3ba24-111">Architectural components</span></span>

<span data-ttu-id="3ba24-112">Un certain nombre de composants sont impliqués dans la réplication des serveurs physiques et des machines virtuelles VMware Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-112">There are a number of components involved when replicating VMware VMs and physical servers to Azure.</span></span>

<span data-ttu-id="3ba24-113">**Composant**</span><span class="sxs-lookup"><span data-stu-id="3ba24-113">**Component**</span></span> | <span data-ttu-id="3ba24-114">**Emplacement**</span><span class="sxs-lookup"><span data-stu-id="3ba24-114">**Location**</span></span> | <span data-ttu-id="3ba24-115">**Détails**</span><span class="sxs-lookup"><span data-stu-id="3ba24-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="3ba24-116">**Microsoft Azure**</span><span class="sxs-lookup"><span data-stu-id="3ba24-116">**Azure**</span></span> | <span data-ttu-id="3ba24-117">Dans Azure, vous avez besoin d’un Compte Azure, d’un compte de stockage Azure et d’un Réseau Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="3ba24-118">Les données répliquées sont stockées dans le compte de stockage, et les machines virtuelles Azure sont créées avec les données répliquées lors du basculement à partir de votre site local.</span><span class="sxs-lookup"><span data-stu-id="3ba24-118">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="3ba24-119">Les machines virtuelles Azure se connectent au réseau virtuel Azure lors de leur création.</span><span class="sxs-lookup"><span data-stu-id="3ba24-119">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="3ba24-120">**Serveur de configuration**</span><span class="sxs-lookup"><span data-stu-id="3ba24-120">**Configuration server**</span></span> | <span data-ttu-id="3ba24-121">Un seul serveur d’administration local (machine virtuelle VMWare) qui exécute tous les composants nécessaires au déploiement, y compris le serveur de configuration, le serveur de traitement, le serveur cible maître</span><span class="sxs-lookup"><span data-stu-id="3ba24-121">A single on-premises management server (VMWare VM) that runs all the on-premises components that are needed for the deployment, including the configuration server, process server, master target server</span></span> | <span data-ttu-id="3ba24-122">Le composant de serveur de configuration coordonne la communication entre les ordinateurs locaux et Azure, et gère la réplication des données.</span><span class="sxs-lookup"><span data-stu-id="3ba24-122">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="3ba24-123">**Serveur de traitement**:</span><span class="sxs-lookup"><span data-stu-id="3ba24-123">**Process server**:</span></span>  | <span data-ttu-id="3ba24-124">Installé par défaut sur le serveur de configuration.</span><span class="sxs-lookup"><span data-stu-id="3ba24-124">Installed by default on the configuration server.</span></span> | <span data-ttu-id="3ba24-125">Fait office de passerelle de réplication.</span><span class="sxs-lookup"><span data-stu-id="3ba24-125">Acts as a replication gateway.</span></span> <span data-ttu-id="3ba24-126">Reçoit les données de réplication, les optimise grâce à la mise en cache, la compression et le chiffrement et les envoie vers le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="3ba24-127">Le serveur de traitement gère également l’installation Push du service Mobilité sur des machines protégées et assure la détection automatique des machines virtuelles VMware.</span><span class="sxs-lookup"><span data-stu-id="3ba24-127">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="3ba24-128">À mesure que s’étend votre déploiement, vous pouvez ajouter des serveurs de traitement dédiés supplémentaires afin de gérer de plus grands volumes de trafic de réplication.</span><span class="sxs-lookup"><span data-stu-id="3ba24-128">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="3ba24-129">**Serveur cible maître**</span><span class="sxs-lookup"><span data-stu-id="3ba24-129">**Master target server**</span></span> | <span data-ttu-id="3ba24-130">Installé par défaut sur le serveur de configuration local.</span><span class="sxs-lookup"><span data-stu-id="3ba24-130">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="3ba24-131">Gère les données de réplication pendant la restauration automatique à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="3ba24-132">Si les volumes de trafic de restauration automatique sont importants, vous pouvez déployer un serveur cible maître distinct pour la restauration.</span><span class="sxs-lookup"><span data-stu-id="3ba24-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="3ba24-133">**Serveurs VMware**</span><span class="sxs-lookup"><span data-stu-id="3ba24-133">**VMware servers**</span></span> | <span data-ttu-id="3ba24-134">Les machines virtuelles VMware sont hébergées sur des serveurs vSphere ESXi et nous vous recommandons d’utiliser un serveur vCenter pour gérer les ordinateurs hôtes.</span><span class="sxs-lookup"><span data-stu-id="3ba24-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="3ba24-135">Vous ajoutez des serveurs VMware à votre coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="3ba24-135">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="3ba24-136">**Machines répliquées**</span><span class="sxs-lookup"><span data-stu-id="3ba24-136">**Replicated machines**</span></span> | <span data-ttu-id="3ba24-137">Le service Mobilité sera installé sur chaque machine virtuelle VMware que vous souhaitez répliquer.</span><span class="sxs-lookup"><span data-stu-id="3ba24-137">The Mobility service will be installed on each VMware VM you want to replicate.</span></span> <span data-ttu-id="3ba24-138">Il peut être installé manuellement sur chaque ordinateur ou avec une installation push à partir du serveur de traitement.</span><span class="sxs-lookup"><span data-stu-id="3ba24-138">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="3ba24-139">En savoir plus sur les conditions préalables au déploiement et la configuration requise pour chacun de ces composants dans la [matrice de prise en charge](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="3ba24-139">Learn about the deployment prerequisites and requirements for each of these components in the [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="3ba24-140">**Figure 1 : composants VMware vers Azure**</span><span class="sxs-lookup"><span data-stu-id="3ba24-140">**Figure 1: VMware to Azure components**</span></span>

![Composants](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="3ba24-142">Processus de réplication</span><span class="sxs-lookup"><span data-stu-id="3ba24-142">Replication process</span></span>

1. <span data-ttu-id="3ba24-143">Vous configurez le déploiement, y compris les composants Azure et un coffre Recovery Services.</span><span class="sxs-lookup"><span data-stu-id="3ba24-143">You set up the deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="3ba24-144">Dans le coffre, vous spécifiez la source et la cible de réplication, configurez le serveur de configuration, ajoutez des serveurs VMware, créez une stratégie de réplication, déployez le service Mobility, autorisez la réplication et effectuez un test de basculement.</span><span class="sxs-lookup"><span data-stu-id="3ba24-144">In the vault you specify the replication source and target, set up the configuration server, add VMware servers, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="3ba24-145">Les machines débutent la réplication conformément à la stratégie définie, et une copie initiale des données est répliquée sur le stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-145">Machines start replicating in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="3ba24-146">La réplication des modifications delta dans Azure commence une fois la réplication initiale terminée.</span><span class="sxs-lookup"><span data-stu-id="3ba24-146">Replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="3ba24-147">Le suivi des modifications d’une machine est conservé dans un fichier .hrl.</span><span class="sxs-lookup"><span data-stu-id="3ba24-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="3ba24-148">Les machines qui assurent la réplication communiquent avec le serveur de configuration sur le port HTTPS 443 entrants, pour la gestion de la réplication.</span><span class="sxs-lookup"><span data-stu-id="3ba24-148">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="3ba24-149">Les machines qui assurent la réplication envoient des données de réplication au serveur de traitement sur le port HTTPS 9443 entrant (configuration possible).</span><span class="sxs-lookup"><span data-stu-id="3ba24-149">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="3ba24-150">Le serveur de configuration orchestre la gestion de la réplication avec Azure sur le port HTTPS 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="3ba24-150">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="3ba24-151">Le serveur de traitement reçoit les données à partir des machines source, puis les chiffre et les envoie au stockage Azure via le port 443 sortant.</span><span class="sxs-lookup"><span data-stu-id="3ba24-151">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="3ba24-152">Si vous activez la cohérence multimachine virtuelle, les machines du groupe de réplication communiquent entre elles sur le port 20004.</span><span class="sxs-lookup"><span data-stu-id="3ba24-152">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="3ba24-153">Le mode multimachine virtuelle est utilisé si vous regroupez plusieurs machines dans des groupes de réplication qui partagent des points de récupération cohérents en cas d’incident et avec les applications lorsqu’ils basculent.</span><span class="sxs-lookup"><span data-stu-id="3ba24-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="3ba24-154">Cela est utile si les machines exécutent la même charge de travail et doivent être cohérentes.</span><span class="sxs-lookup"><span data-stu-id="3ba24-154">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="3ba24-155">Le trafic est répliqué sur des points de terminaison publics de stockage Azure via Internet.</span><span class="sxs-lookup"><span data-stu-id="3ba24-155">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="3ba24-156">L’autre solution consiste à utiliser l’[homologation publique](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="3ba24-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="3ba24-157">La réplication du trafic à partir d’un site local vers Azure via un réseau VPN de site à site n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="3ba24-157">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="3ba24-158">**Figure 2 : réplication de VMware vers Azure**</span><span class="sxs-lookup"><span data-stu-id="3ba24-158">**Figure 2: VMware to Azure replication**</span></span>

![Amélioré](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="3ba24-160">Processus de basculement et de restauration automatique</span><span class="sxs-lookup"><span data-stu-id="3ba24-160">Failover and failback process</span></span>

1. <span data-ttu-id="3ba24-161">Après avoir vérifié que le test de basculement fonctionne comme prévu, vous pouvez exécuter des basculements non planifiés sur Azure en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="3ba24-161">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="3ba24-162">Le basculement planifié n’est pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="3ba24-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="3ba24-163">Vous pouvez basculer une seule machine ou créer des [plans de récupération](site-recovery-create-recovery-plans.md) pour basculer plusieurs machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="3ba24-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="3ba24-164">Lorsque vous effectuez un basculement, les machines virtuelles répliquées sont créées dans Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="3ba24-165">Vous validez un basculement pour accéder à la charge de travail à partir de la machine virtuelle Azure répliquée.</span><span class="sxs-lookup"><span data-stu-id="3ba24-165">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="3ba24-166">Lorsque votre site local principal est à nouveau disponible, vous pouvez lancer la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="3ba24-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="3ba24-167">Vous configurez une infrastructure de restauration automatique, lancez la réplication de la machine à partir du site secondaire vers le site principal et effectuez un basculement non planifié à partir du site secondaire.</span><span class="sxs-lookup"><span data-stu-id="3ba24-167">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="3ba24-168">Une fois ce basculement validé, les données sont à nouveau disponibles en local et vous devez relancer la réplication sur Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-168">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="3ba24-169">En savoir plus</span><span class="sxs-lookup"><span data-stu-id="3ba24-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="3ba24-170">La restauration automatique doit répondre à plusieurs conditions requises :</span><span class="sxs-lookup"><span data-stu-id="3ba24-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="3ba24-171">**Serveur de traitement temporaire dans Azure**: si vous souhaitez effectuer une restauration automatique à partir d’Azure après le basculement, vous devez définir une machine virtuelle Azure configurée comme serveur de traitement pour gérer la réplication à partir d’Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-171">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="3ba24-172">Vous pourrez supprimer cette machine virtuelle une fois la restauration terminée.</span><span class="sxs-lookup"><span data-stu-id="3ba24-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="3ba24-173">**Connexion VPN**: pour une restauration automatique, vous devrez disposer d’une connexion VPN (ou d’Azure ExpressRoute) configurée à partir du réseau Azure sur le site local.</span><span class="sxs-lookup"><span data-stu-id="3ba24-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="3ba24-174">**Serveur cible maître local distinct** : le serveur cible maître local gère la restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="3ba24-174">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="3ba24-175">Le serveur cible maître est installé par défaut sur le serveur d’administration. Toutefois, si vous restaurez automatiquement de plus grands volumes de trafic vous devez définir un serveur cible maître local à cet effet.</span><span class="sxs-lookup"><span data-stu-id="3ba24-175">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="3ba24-176">**Stratégie de restauration automatique** : pour répliquer vers votre site local, vous avez besoin d’une stratégie de restauration automatique.</span><span class="sxs-lookup"><span data-stu-id="3ba24-176">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="3ba24-177">Celle-ci est automatiquement créée lors de la création de votre stratégie de réplication.</span><span class="sxs-lookup"><span data-stu-id="3ba24-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="3ba24-178">**Infrastructure VMware** : vous devez basculer vers une machine virtuelle VMware locale.</span><span class="sxs-lookup"><span data-stu-id="3ba24-178">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="3ba24-179">Cela signifie que vous avez besoin d’une infrastructure VMware locale, même si vous répliquez des serveurs physiques locaux vers Azure.</span><span class="sxs-lookup"><span data-stu-id="3ba24-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="3ba24-180">**Figure 3 : restauration automatique VMware/physique**</span><span class="sxs-lookup"><span data-stu-id="3ba24-180">**Figure 3: VMware/physical failback**</span></span>

![Restauration automatique](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="3ba24-182">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="3ba24-182">Next steps</span></span>

<span data-ttu-id="3ba24-183">Examen de la [matrice de prise en charge](site-recovery-support-matrix-to-azure.md)</span><span class="sxs-lookup"><span data-stu-id="3ba24-183">Review the [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
