---
title: "conseils d’aaaPerformance - Azure Cosmos DB NoSQL | Documents Microsoft"
description: "En savoir plus les performances de la base de données client configuration options tooimprove base de données Azure Cosmos"
keywords: tooimprove base de performances
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: 4f3e82ae5048e3dbc20b0fd891a2d3aa22adf3fc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="346c8-104">Conseils sur les performances pour Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="346c8-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="346c8-105">Azure Cosmos DB est une base de données distribuée rapide et flexible qui peut être mise à l’échelle en toute transparence avec une latence et un débit garantis.</span><span class="sxs-lookup"><span data-stu-id="346c8-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="346c8-106">Ne pas avoir les modifications de l’architecture principale toomake ou écrire un code complexe tooscale votre base de données avec la base de données Cosmos.</span><span class="sxs-lookup"><span data-stu-id="346c8-106">You do not have toomake major architecture changes or write complex code tooscale your database with Cosmos DB.</span></span> <span data-ttu-id="346c8-107">Il suffit d’un simple appel d’API ou de méthode de [kit de développement logiciel (SDK)](set-throughput.md#set-throughput-sdk)pour effectuer une mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="346c8-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="346c8-108">Toutefois, Cosmos de base de données est accessible via les appels réseau il sont optimisations côté client vous pouvez apporter tooachieve maximiser les performances.</span><span class="sxs-lookup"><span data-stu-id="346c8-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make tooachieve peak performance.</span></span>

<span data-ttu-id="346c8-109">Si vous vous demandez comment améliorer les performances de votre base de données,</span><span class="sxs-lookup"><span data-stu-id="346c8-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="346c8-110">Tenez compte des hello options suivantes :</span><span class="sxs-lookup"><span data-stu-id="346c8-110">consider hello following options:</span></span>

## <a name="networking"></a><span data-ttu-id="346c8-111">Mise en réseau</span><span class="sxs-lookup"><span data-stu-id="346c8-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="346c8-112">**Stratégie de connexion : utilisation du mode de connexion direct**</span><span class="sxs-lookup"><span data-stu-id="346c8-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="346c8-113">Comment un client connecte tooCosmos DB a des implications importantes sur les performances, tout particulièrement en termes de latence observée sur le côté client.</span><span class="sxs-lookup"><span data-stu-id="346c8-113">How a client connects tooCosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="346c8-114">Il existe deux paramètres de configuration de la clé de configuration client stratégie de connexion : connexion de hello *mode* et hello [connexion *protocole*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="346c8-114">There are two key configuration settings available for configuring client Connection Policy – hello connection *mode* and hello [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="346c8-115">Hello de deux modes disponibles est :</span><span class="sxs-lookup"><span data-stu-id="346c8-115">hello two available modes are:</span></span>

   1. <span data-ttu-id="346c8-116">Mode passerelle (par défaut)</span><span class="sxs-lookup"><span data-stu-id="346c8-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="346c8-117">Mode direct</span><span class="sxs-lookup"><span data-stu-id="346c8-117">Direct Mode</span></span>

      <span data-ttu-id="346c8-118">Mode de passerelle est pris en charge sur toutes les plateformes de kit de développement logiciel et est par défaut de hello configuré.</span><span class="sxs-lookup"><span data-stu-id="346c8-118">Gateway Mode is supported on all SDK platforms and is hello configured default.</span></span>  <span data-ttu-id="346c8-119">Si votre application s’exécute dans un réseau d’entreprise avec des restrictions de pare-feu strict, Mode de passerelle est hello meilleur choix, car elle utilise le port HTTPS standard hello et un seul point de terminaison.</span><span class="sxs-lookup"><span data-stu-id="346c8-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is hello best choice since it uses hello standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="346c8-120">Hello compromis de performances, toutefois, est que passerelle Mode implique un saut réseau supplémentaire chaque fois les données sont lues ou écrites tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="346c8-120">hello performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written tooCosmos DB.</span></span> <span data-ttu-id="346c8-121">Pour cette raison, le Mode Direct offre de meilleures performances en raison de tronçons toofewer.</span><span class="sxs-lookup"><span data-stu-id="346c8-121">Because of this, Direct Mode offers better performance due toofewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="346c8-122">**Stratégie de connexion : utiliser le protocole TCP hello**</span><span class="sxs-lookup"><span data-stu-id="346c8-122">**Connection policy: Use hello TCP protocol**</span></span>

    <span data-ttu-id="346c8-123">Lorsque vous utilisez le mode direct, deux options de protocole sont disponibles :</span><span class="sxs-lookup"><span data-stu-id="346c8-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="346c8-124">TCP</span><span class="sxs-lookup"><span data-stu-id="346c8-124">TCP</span></span>
   * <span data-ttu-id="346c8-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="346c8-125">HTTPS</span></span>

     <span data-ttu-id="346c8-126">Cosmos DB fournit un modèle de programmation RESTful simple et ouvert sur HTTPS.</span><span class="sxs-lookup"><span data-stu-id="346c8-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="346c8-127">En outre, il offre un protocole TCP efficace, également RESTful dans son modèle de communication et est disponible via le SDK de client .NET hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through hello .NET client SDK.</span></span> <span data-ttu-id="346c8-128">Direct TCP et HTTPS SSL utilisent tous deux SSL pour l’authentification initiale et le chiffrement du trafic.</span><span class="sxs-lookup"><span data-stu-id="346c8-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="346c8-129">Pour de meilleures performances, utilisez le protocole TCP hello lorsque cela est possible.</span><span class="sxs-lookup"><span data-stu-id="346c8-129">For best performance, use hello TCP protocol when possible.</span></span>

     <span data-ttu-id="346c8-130">Lorsque vous utilisez TCP en Mode de passerelle, le Port TCP 443 est hello Cosmos DB port et 10255 est le port de MongoDB API hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-130">When using TCP in Gateway Mode, TCP Port 443 is hello Cosmos DB port, and 10255 is hello MongoDB API port.</span></span> <span data-ttu-id="346c8-131">Lors de l’utilisation de TCP en Mode Direct, dans les ports de passerelle toohello addition, vous avez besoin de port de hello tooensure compris entre 10000 et 20000 est ouvert, car Cosmos DB utilise des ports TCP dynamiques.</span><span class="sxs-lookup"><span data-stu-id="346c8-131">When using TCP in Direct Mode, in addition toohello Gateway ports, you need tooensure hello port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="346c8-132">Si ces ports ne sont pas ouverts et que vous essayez de toouse TCP, vous recevez une erreur de 503 Service non disponible.</span><span class="sxs-lookup"><span data-stu-id="346c8-132">If these ports are not open and you attempt toouse TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="346c8-133">Mode de connectivité de Hello est configuré pendant la construction de hello d’instance de DocumentClient hello avec le paramètre ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-133">hello Connectivity Mode is configured during hello construction of hello DocumentClient instance with hello ConnectionPolicy parameter.</span></span> <span data-ttu-id="346c8-134">Si le Mode Direct est utilisé, hello protocole peut également être définie dans paramètres de ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-134">If Direct Mode is used, hello Protocol can also be set within hello ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from hello Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="346c8-135">TCP est uniquement pris en charge en Mode Direct, si le Mode de passerelle est utilisé, puis hello le protocole HTTPS est toujours utilisé toocommunicate avec hello passerelle et hello valeur du protocole Bonjour que connectionpolicy est ignoré.</span><span class="sxs-lookup"><span data-stu-id="346c8-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then hello HTTPS protocol is always used toocommunicate with hello Gateway and hello Protocol value in hello ConnectionPolicy is ignored.</span></span>

    ![Illustration de la stratégie de connexion de base de données Azure Cosmos de hello](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="346c8-137">**Latence de démarrage de tooavoid OpenAsync des appels à la première demande**</span><span class="sxs-lookup"><span data-stu-id="346c8-137">**Call OpenAsync tooavoid startup latency on first request**</span></span>

    <span data-ttu-id="346c8-138">Par défaut, la première demande de hello a une latence plus élevée, car elle contient la table de routage d’adresse toofetch hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-138">By default, hello first request has a higher latency because it has toofetch hello address routing table.</span></span> <span data-ttu-id="346c8-139">tooavoid cette latence de démarrage sur hello demande tout d’abord, vous devez appeler OpenAsync() qu’une seule fois lors de l’initialisation, comme suit.</span><span class="sxs-lookup"><span data-stu-id="346c8-139">tooavoid this startup latency on hello first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="346c8-140">**Colocalisation des clients dans la même région Azure pour les performances**</span><span class="sxs-lookup"><span data-stu-id="346c8-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="346c8-141">Lorsque possible, place toutes les applications de l’appel de base de données Cosmos dans hello même région que hello de base de données de base de données de Cosmos.</span><span class="sxs-lookup"><span data-stu-id="346c8-141">When possible, place any applications calling Cosmos DB in hello same region as hello Cosmos DB database.</span></span> <span data-ttu-id="346c8-142">Pour une comparaison approximative, appelle tooCosmos DB dans hello même région se termine dans 1 à 2 ms, mais la latence hello entre hello ouest et la côte est de hello US est > à 50 ms.</span><span class="sxs-lookup"><span data-stu-id="346c8-142">For an approximate comparison, calls tooCosmos DB within hello same region complete within 1-2 ms, but hello latency between hello West and East coast of hello US is >50 ms.</span></span> <span data-ttu-id="346c8-143">Cette latence peut varier probablement de toorequest demande en fonction de l’itinéraire hello pris par la demande de hello lorsqu’il passe à partir de la limite de centre de données Azure hello client toohello.</span><span class="sxs-lookup"><span data-stu-id="346c8-143">This latency can likely vary from request toorequest depending on hello route taken by hello request as it passes from hello client toohello Azure datacenter boundary.</span></span> <span data-ttu-id="346c8-144">Hello la latence la plus basse possible est obtenue en garantissant l’appel hello se trouve dans hello même région Azure que hello configuré de point de terminaison de base de données Cosmos.</span><span class="sxs-lookup"><span data-stu-id="346c8-144">hello lowest possible latency is achieved by ensuring hello calling application is located within hello same Azure region as hello provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="346c8-145">Pour obtenir la liste des régions disponibles, voir [Régions Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="346c8-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="346c8-146">![Illustration de la stratégie de connexion de base de données Azure Cosmos de hello](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="346c8-146">![Illustration of hello Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="346c8-147">**Augmentation du nombre de threads/tâches**</span><span class="sxs-lookup"><span data-stu-id="346c8-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="346c8-148">Étant donné que les appels tooAzure Cosmos DB sont effectuées via le réseau de hello, vous devrez peut-être degré de hello toovary de parallélisme de vos demandes afin que l’application cliente de hello consacre à très peu de temps d’attente entre les demandes.</span><span class="sxs-lookup"><span data-stu-id="346c8-148">Since calls tooAzure Cosmos DB are made over hello network, you may need toovary hello degree of parallelism of your requests so that hello client application spends very little time waiting between requests.</span></span> <span data-ttu-id="346c8-149">Par exemple, si vous utilisez. De NET [bibliothèque parallèle de tâches](https://msdn.microsoft.com//library/dd460717.aspx), créer dans l’ordre de hello de 100 s de lecture ou écriture tooCosmos base de données de tâches.</span><span class="sxs-lookup"><span data-stu-id="346c8-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in hello order of 100s of Tasks reading or writing tooCosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="346c8-150">Utilisation du kit de développement logiciel (SDK)</span><span class="sxs-lookup"><span data-stu-id="346c8-150">SDK Usage</span></span>
1. <span data-ttu-id="346c8-151">**Installer hello du Kit de développement logiciel plus récent**</span><span class="sxs-lookup"><span data-stu-id="346c8-151">**Install hello most recent SDK**</span></span>

    <span data-ttu-id="346c8-152">Hello Cosmos DB SDK sont constamment hello tooprovide amélioration des performances optimales.</span><span class="sxs-lookup"><span data-stu-id="346c8-152">hello Cosmos DB SDKs are constantly being improved tooprovide hello best performance.</span></span> <span data-ttu-id="346c8-153">Consultez hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello du Kit de développement logiciel plus récent et passez en revue les améliorations.</span><span class="sxs-lookup"><span data-stu-id="346c8-153">See hello [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages toodetermine hello most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="346c8-154">**Utiliser un client de base de données Cosmos singleton pour la durée de vie hello de votre application**</span><span class="sxs-lookup"><span data-stu-id="346c8-154">**Use a singleton Cosmos DB client for hello lifetime of your application**</span></span>

    <span data-ttu-id="346c8-155">Notez que chaque instance de DocumentClient est thread-safe et effectue une gestion des connexions efficace et une mise en cache d’adresses lorsque le mode direct est sélectionné.</span><span class="sxs-lookup"><span data-stu-id="346c8-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="346c8-156">gestion des connexions efficace de tooallow et de meilleures performances par DocumentClient, il est recommandé d’une seule instance de DocumentClient par AppDomain toouse pour la durée de vie de hello d’application hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-156">tooallow efficient connection management and better performance by DocumentClient, it is recommended toouse a single instance of DocumentClient per AppDomain for hello lifetime of hello application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="346c8-157">**Augmentation de System.Net MaxConnections par hôte lors de l’utilisation du mode passerelle**</span><span class="sxs-lookup"><span data-stu-id="346c8-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="346c8-158">COSMOS DB demandes sont effectuées via le protocole HTTPS/REST lorsque le mode de passerelle et sont soumis toohello limite de connexion par défaut par le nom d’hôte ou adresse IP.</span><span class="sxs-lookup"><span data-stu-id="346c8-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected toohello default connection limit per hostname or IP address.</span></span> <span data-ttu-id="346c8-159">Vous devrez peut-être tooset hello MaxConnections tooa valeur plus élevée (100-1000) afin que hello bibliothèque cliente peut utiliser plusieurs connexions simultanées tooCosmos DB.</span><span class="sxs-lookup"><span data-stu-id="346c8-159">You may need tooset hello MaxConnections tooa higher value (100-1000) so that hello client library can utilize multiple simultaneous connections tooCosmos DB.</span></span> <span data-ttu-id="346c8-160">Hello .NET SDK 1.8.0 et ci-dessus, hello la valeur par défaut de [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) est 50 et toochange hello valeur, vous pouvez définir des hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit ](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa plus élevée.</span><span class="sxs-lookup"><span data-stu-id="346c8-160">In hello .NET SDK 1.8.0 and above, hello default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and toochange hello value, you can set hello [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) tooa higher value.</span></span>   
4. <span data-ttu-id="346c8-161">**Paramétrage des requêtes parallèles pour les collections partitionnées**</span><span class="sxs-lookup"><span data-stu-id="346c8-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="346c8-162">DocumentDB .NET SDK version à 1.9.0 et versions ultérieures de la prise en charge des requêtes parallèles, ce qui vous permettent de tooquery une collection partitionnée en parallèle (voir [utilisation de kits de développement logiciel de hello](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) et hello liées [exemples de code](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) pour plus d’informations).</span><span class="sxs-lookup"><span data-stu-id="346c8-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you tooquery a partitioned collection in parallel (see [Working with hello SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and hello related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="346c8-163">Requêtes parallèles sont débit et la latence requête tooimprove conçue sur leur équivalent en série.</span><span class="sxs-lookup"><span data-stu-id="346c8-163">Parallel queries are designed tooimprove query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="346c8-164">Requêtes parallèles fournissent deux paramètres que les utilisateurs peuvent paramétrer toocustom ajuster leurs exigences, (a) MaxDegreeOfParallelism : nombre maximal de toocontrol hello de partitions puis peut être interrogée en parallèle et (b) MaxBufferedItemCount : nombre de hello toocontrol de résultats préalablement extraites.</span><span class="sxs-lookup"><span data-stu-id="346c8-164">Parallel queries provide two parameters that users can tune toocustom-fit their requirements, (a) MaxDegreeOfParallelism: toocontrol hello maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: toocontrol hello number of pre-fetched results.</span></span>

    <span data-ttu-id="346c8-165">(a) La requête parallèle ***Tuning MaxDegreeOfParallelism\:*** interroge plusieurs partitions en parallèle.</span><span class="sxs-lookup"><span data-stu-id="346c8-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="346c8-166">Toutefois, les données à partir d’une collecte partitionnée individuel sont extraites en série avec respect toohello requête.</span><span class="sxs-lookup"><span data-stu-id="346c8-166">However, data from an individual partitioned collect is fetched serially with respect toohello query.</span></span> <span data-ttu-id="346c8-167">Par conséquent, la définition hello MaxDegreeOfParallelism toohello du nombre de partitions est hello maximale susceptible d’aboutir atteindre hello la plupart des requêtes de performant, fourni toutes les autres conditions système restent hello même.</span><span class="sxs-lookup"><span data-stu-id="346c8-167">So, setting hello MaxDegreeOfParallelism toohello number of partitions has hello maximum chance of achieving hello most performant query, provided all other system conditions remain hello same.</span></span> <span data-ttu-id="346c8-168">Si vous ne connaissez pas nombre hello de partitions, vous pouvez définir le nombre élevé de hello MaxDegreeOfParallelism tooa et système de hello choisit le minimum de hello (nombre de partitions, l’entrée d’utilisateur fourni) comme hello MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="346c8-168">If you don't know hello number of partitions, you can set hello MaxDegreeOfParallelism tooa high number, and hello system chooses hello minimum (number of partitions, user provided input) as hello MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="346c8-169">Il est important toonote parallèles requêtes produisent hello avantages si les données de salutation sont répartie équitablement entre toutes les partitions avec respect toohello requête.</span><span class="sxs-lookup"><span data-stu-id="346c8-169">It is important toonote that parallel queries produce hello best benefits if hello data is evenly distributed across all partitions with respect toohello query.</span></span> <span data-ttu-id="346c8-170">Si hello partitionnée collection est partitionnée de telle façon que tout ou une majorité des données hello retournées par une requête est concentrée dans plusieurs partitions (une partition dans le pire des cas), puis performances hello de requête de hello serait être encombré par ces partitions.</span><span class="sxs-lookup"><span data-stu-id="346c8-170">If hello partitioned collection is partitioned such a way that all or a majority of hello data returned by a query is concentrated in a few partitions (one partition in worst case), then hello performance of hello query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="346c8-171">(b) ***MaxBufferedItemCount de réglage\: *** requête parallèle est résultats de l’extraction toopre conçue pendant le traitement de lot en cours de hello des résultats par le client de hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed toopre-fetch results while hello current batch of results is being processed by hello client.</span></span> <span data-ttu-id="346c8-172">Hello prérécupération permet à l’amélioration de la latence globale d’une requête.</span><span class="sxs-lookup"><span data-stu-id="346c8-172">hello pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="346c8-173">MaxBufferedItemCount est hello paramètre toolimit hello différents résultats préalablement extraites.</span><span class="sxs-lookup"><span data-stu-id="346c8-173">MaxBufferedItemCount is hello parameter toolimit hello number of pre-fetched results.</span></span> <span data-ttu-id="346c8-174">Paramètre MaxBufferedItemCount toohello attendu hello requête tooreceive maximum de profit de prérécupération permet de nombre de résultats retournés (ou un nombre plus élevé).</span><span class="sxs-lookup"><span data-stu-id="346c8-174">Setting MaxBufferedItemCount toohello expected number of results returned (or a higher number) allows hello query tooreceive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="346c8-175">Notez qu’avant l’extraction works hello même façon indépendamment de hello MaxDegreeOfParallelism, et une seule mémoire tampon pour les données de salutation de toutes les partitions.</span><span class="sxs-lookup"><span data-stu-id="346c8-175">Note that pre-fetching works hello same way irrespective of hello MaxDegreeOfParallelism, and there is a single buffer for hello data from all partitions.</span></span>  
5. <span data-ttu-id="346c8-176">**Activation de GC côté serveur**</span><span class="sxs-lookup"><span data-stu-id="346c8-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="346c8-177">Réduction de fréquence hello du garbage collection peut aider dans certains cas.</span><span class="sxs-lookup"><span data-stu-id="346c8-177">Reducing hello frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="346c8-178">Dans .NET, définissez [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span><span class="sxs-lookup"><span data-stu-id="346c8-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) tootrue.</span></span>
6. <span data-ttu-id="346c8-179">**Implémentation d’interruption à des intervalles de RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="346c8-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="346c8-180">Lors du test de performances, vous devez augmenter la charge jusqu’à une limite d’un petit nombre de requêtes.</span><span class="sxs-lookup"><span data-stu-id="346c8-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="346c8-181">Si la limitation, hello application cliente doit interruption en cas de limitation pour hello spécifiée par le serveur intervalle avant nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="346c8-181">If throttled, hello client application should backoff on throttle for hello server-specified retry interval.</span></span> <span data-ttu-id="346c8-182">En respectant hello interruption garantit que vous passez des minimiser le temps d’attente entre deux tentatives.</span><span class="sxs-lookup"><span data-stu-id="346c8-182">Respecting hello backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="346c8-183">Prise en charge de stratégie de nouvelle tentative est inclus dans la Version 1.8.0 et versions ultérieures de hello DocumentDB [.NET](documentdb-sdk-dotnet.md) et [Java](documentdb-sdk-java.md), version à 1.9.0 et versions ultérieures de hello [Node.js](documentdb-sdk-node.md) et [ Python](documentdb-sdk-python.md), et toutes les versions de hello [.NET Core](documentdb-sdk-dotnet-core.md) kits de développement logiciel.</span><span class="sxs-lookup"><span data-stu-id="346c8-183">Retry policy support is included in Version 1.8.0 and above of hello DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of hello [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of hello [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="346c8-184">Pour plus d’informations, consultez la section [Dépassement des limites de débit réservé](request-units.md#RequestRateTooLarge) et [Propriété RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="346c8-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="346c8-185">**Augmentation de la taille des instances de votre charge de travail cliente**</span><span class="sxs-lookup"><span data-stu-id="346c8-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="346c8-186">Si vous testez à des niveaux de débit élevé (> 50 000 ur/s), application de client hello peut devenir le goulot d’étranglement hello en raison de la limitation des machine toohello out sur l’utilisation du processeur ou le réseau.</span><span class="sxs-lookup"><span data-stu-id="346c8-186">If you are testing at high throughput levels (>50,000 RU/s), hello client application may become hello bottleneck due toohello machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="346c8-187">Si vous atteignez ce point, vous pouvez continuer compte plus de toopush hello Cosmos DB par montée en puissance parallèle de vos applications clientes sur plusieurs serveurs.</span><span class="sxs-lookup"><span data-stu-id="346c8-187">If you reach this point, you can continue toopush hello Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="346c8-188">**Mise en cache d’URI de document pour une latence de lecture plus faible**</span><span class="sxs-lookup"><span data-stu-id="346c8-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="346c8-189">Document du cache URI autant que possible pour de meilleures performances de lecture hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-189">Cache document URIs whenever possible for hello best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="346c8-190">**Régler la taille de la page hello pour les flux de requêtes/lecture pour de meilleures performances**</span><span class="sxs-lookup"><span data-stu-id="346c8-190">**Tune hello page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="346c8-191">Lors de l’exécution d’un bloc de lecture de documents à l’aide de la lecture de flux de fonctionnalités (par exemple, ReadDocumentFeedAsync) ou lors de l’émission d’une requête SQL DocumentDB, les résultats de hello sont retournés sous forme de segmenté si le jeu de résultats hello est trop grande.</span><span class="sxs-lookup"><span data-stu-id="346c8-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, hello results are returned in a segmented fashion if hello result set is too large.</span></span> <span data-ttu-id="346c8-192">Par défaut, les résultats sont retournés dans des segments de 100 éléments ou de 1 Mo, selon la limite atteinte en premier.</span><span class="sxs-lookup"><span data-stu-id="346c8-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="346c8-193">nombre de hello tooreduce de réseau tooretrieve d’allers-retours requis tous les résultats applicables, vous pouvez augmenter la taille de page hello too1000 de tooup d’en-tête x-ms-max-item-count demande.</span><span class="sxs-lookup"><span data-stu-id="346c8-193">tooreduce hello number of network round trips required tooretrieve all applicable results, you can increase hello page size using x-ms-max-item-count request header tooup too1000.</span></span> <span data-ttu-id="346c8-194">Dans le cas où vous devez toodisplay que quelques résultats, par exemple, si votre API d’application ou d’interface utilisateur retourne uniquement les 10 entraîne un temps, vous pouvez également réduire hello page taille too10 tooreduce hello débit consommé pour les lectures et les requêtes.</span><span class="sxs-lookup"><span data-stu-id="346c8-194">In cases where you need toodisplay only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease hello page size too10 tooreduce hello throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="346c8-195">Vous pouvez également définir la taille de la page hello à l’aide de hello disponible Cosmos DB kits de développement logiciel.</span><span class="sxs-lookup"><span data-stu-id="346c8-195">You may also set hello page size using hello available Cosmos DB SDKs.</span></span>  <span data-ttu-id="346c8-196">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="346c8-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="346c8-197">**Augmentation du nombre de threads/tâches**</span><span class="sxs-lookup"><span data-stu-id="346c8-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="346c8-198">Consultez [augmenter le nombre de threads/tâches](#increase-threads) Bonjour section de mise en réseau.</span><span class="sxs-lookup"><span data-stu-id="346c8-198">See [Increase number of threads/tasks](#increase-threads) in hello Networking section.</span></span>

11. <span data-ttu-id="346c8-199">**Utilisation du processus hôte 64 bits**</span><span class="sxs-lookup"><span data-stu-id="346c8-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="346c8-200">Hello DocumentDB SDK fonctionne dans un processus hôte 32 bits lorsque vous utilisez le Kit de développement logiciel .NET DocumentDB version 1.11.4 et versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="346c8-200">hello DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="346c8-201">Toutefois, que si vous utilisez des requêtes entre les partitions, le processus hôte 64 bits est recommandé pour améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="346c8-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="346c8-202">Hello, les types d’applications suivants ont hôte 32 bits traiter comme valeur par défaut de hello, par conséquent, dans l’ordre toochange too64 bits autrement, procédez comme suit selon le type hello de votre application :</span><span class="sxs-lookup"><span data-stu-id="346c8-202">hello following types of applications have 32-bit host process as hello default, so in order toochange that too64-bit, follow these steps based on hello type of your application:</span></span>

    - <span data-ttu-id="346c8-203">Pour les applications exécutables, cela est possible en décochant les cases hello **préférer 32 bits** option Bonjour **propriétés du projet** fenêtre hello **générer** onglet.</span><span class="sxs-lookup"><span data-stu-id="346c8-203">For Executable applications, this can be done by unchecking hello **Prefer 32-bit** option in hello **Project Properties** window, on hello **Build** tab.</span></span>

    - <span data-ttu-id="346c8-204">Pour VSTest basés sur des projets de test, cela peut être effectuée en sélectionnant **Test**->**des paramètres de Test**->**Architecture du processeur par défaut en tant que X64**, à partir de hello **Visual Studio Test** option de menu.</span><span class="sxs-lookup"><span data-stu-id="346c8-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from hello **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="346c8-205">Pour les applications Web ASP.NET déployées localement, cela est possible en vérifiant hello **utilisez hello 64 bits d’IIS Express pour les projets et sites web**, sous **outils** ->  **Options**->**projets et Solutions**->**projets Web**.</span><span class="sxs-lookup"><span data-stu-id="346c8-205">For locally deployed ASP.NET Web applications, this can be done by checking hello **Use hello 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="346c8-206">Pour les applications Web ASP.NET déployées sur Azure, cela est possible en choisissant hello **plate-forme 64 bits** Bonjour **paramètres de l’Application** sur hello portail Azure.</span><span class="sxs-lookup"><span data-stu-id="346c8-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing hello **Platform as 64-bit** in hello **Application Settings** on hello Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="346c8-207">Stratégie d'indexation</span><span class="sxs-lookup"><span data-stu-id="346c8-207">Indexing Policy</span></span>
1. <span data-ttu-id="346c8-208">**Utilisation de l’indexation différée pour des taux d’ingestion plus rapides en période de pointe**</span><span class="sxs-lookup"><span data-stu-id="346c8-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="346c8-209">COSMOS DB permet toospecify – au niveau de collection hello : une stratégie d’indexation, qui vous permet de toochoose si vous souhaitez que les documents hello dans un toobe collection automatiquement indexé ou non.</span><span class="sxs-lookup"><span data-stu-id="346c8-209">Cosmos DB allows you toospecify – at hello collection level – an indexing policy, which enables you toochoose if you want hello documents in a collection toobe automatically indexed or not.</span></span>  <span data-ttu-id="346c8-210">En outre, vous avez le choix entre des mises à jour d’index synchrones (cohérentes) et asynchrones (différées).</span><span class="sxs-lookup"><span data-stu-id="346c8-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="346c8-211">Par défaut, les index hello est mis à jour synchrone chaque insertion, remplacer ou supprimer d’une collection de toohello document.</span><span class="sxs-lookup"><span data-stu-id="346c8-211">By default, hello index is updated synchronously on each insert, replace, or delete of a document toohello collection.</span></span> <span data-ttu-id="346c8-212">Mode synchrone en mode Active hello requêtes toohonor hello même [au niveau de cohérence](consistency-levels.md) que celui de hello document lit sans délai pour les index hello trop « rattraper ».</span><span class="sxs-lookup"><span data-stu-id="346c8-212">Synchronously mode enables hello queries toohonor hello same [consistency level](consistency-levels.md) as that of hello document reads without any delay for hello index too“catch up".</span></span>

    <span data-ttu-id="346c8-213">Indexation différée peut être considéré comme pour les scénarios dans lesquels les données sont écrites en rafales, et que vous souhaitez tooamortize hello travail requis tooindex contenu sur une longue période de temps.</span><span class="sxs-lookup"><span data-stu-id="346c8-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want tooamortize hello work required tooindex content over a longer period of time.</span></span> <span data-ttu-id="346c8-214">Indexation différée vous permet également de toouse votre approvisionné efficacement de débit et de servir des requêtes d’écriture aux heures de pointe avec une latence minimale.</span><span class="sxs-lookup"><span data-stu-id="346c8-214">Lazy indexing also allows you toouse your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="346c8-215">Il est important toonote, toutefois, que lors de l’indexation différée est activée, les résultats de requête sont cohérentes quel que soit le niveau de cohérence hello configuré pour le compte de base de données Cosmos hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-215">It is important toonote, however, that when lazy indexing is enabled, query results are eventually consistent regardless of hello consistency level configured for hello Cosmos DB account.</span></span>

    <span data-ttu-id="346c8-216">Par conséquent, mode d’indexation cohérent (IndexingPolicy.IndexingMode a la valeur tooConsistent) entraîne hello plus élevé demande unité coût pour chaque écriture, tout en Lazy indexation mode (IndexingPolicy.IndexingMode a la valeur tooLazy) et l’indexation (IndexingPolicy.Automatic a la valeur tooFalse) ont coût nul indexation au moment de hello d’écriture.</span><span class="sxs-lookup"><span data-stu-id="346c8-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set tooConsistent) incurs hello highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set tooLazy) and no indexing (IndexingPolicy.Automatic is set tooFalse) have zero indexing cost at hello time of write.</span></span>
2. <span data-ttu-id="346c8-217">**Exclusion des chemins d’accès inutilisés de l’indexation pour des écritures plus rapides**</span><span class="sxs-lookup"><span data-stu-id="346c8-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="346c8-218">Stratégie d’indexation COSMOS de base de données vous permet également de toospecify tooinclude de chemins d’accès de document ou à exclure de l’indexation en tirant parti de l’indexation des chemins d’accès (IndexingPolicy.IncludedPaths et IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="346c8-218">Cosmos DB’s indexing policy also allows you toospecify which document paths tooinclude or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="346c8-219">utilisation de Hello de l’indexation de chemins d’accès peut offrir des performances d’écriture amélioré et le stockage d’index inférieure pour les scénarios qui Bonjour modèles de requête sont appelés au préalable, les coûts d’indexation sont directement en corrélation nombre toohello de chemins d’accès uniques indexés.</span><span class="sxs-lookup"><span data-stu-id="346c8-219">hello use of indexing paths can offer improved write performance and lower index storage for scenarios in which hello query patterns are known beforehand, as indexing costs are directly correlated toohello number of unique paths indexed.</span></span>  <span data-ttu-id="346c8-220">Par exemple, hello suivant de code montre comment tooexclude une section complète de hello documents (aussi appelé)</span><span class="sxs-lookup"><span data-stu-id="346c8-220">For example, hello following code shows how tooexclude an entire section of hello documents (a.k.a.</span></span> <span data-ttu-id="346c8-221">une sous-arborescence) de l’indexation à l’aide de hello « * » générique.</span><span class="sxs-lookup"><span data-stu-id="346c8-221">a subtree) from indexing using hello "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="346c8-222">Pour plus d’informations, consultez [Stratégies d’indexation d’Azure Cosmos DB](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="346c8-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="346c8-223">Débit</span><span class="sxs-lookup"><span data-stu-id="346c8-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="346c8-224">**Mesure et réglage pour réduire l’utilisation d’unités de requête par seconde**</span><span class="sxs-lookup"><span data-stu-id="346c8-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="346c8-225">COSMOS DB offre un ensemble complet d’opérations de base de données, y compris des requêtes relationnelles et hiérarchiques avec UDF, procédures stockées et déclencheurs – fonctionnement sur des documents hello dans une collection de base de données.</span><span class="sxs-lookup"><span data-stu-id="346c8-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on hello documents within a database collection.</span></span> <span data-ttu-id="346c8-226">coût Hello associée à chacune de ces opérations varie en fonction de hello UC, e/s et mémoire requise toocomplete hello opération.</span><span class="sxs-lookup"><span data-stu-id="346c8-226">hello cost associated with each of these operations varies based on hello CPU, IO, and memory required toocomplete hello operation.</span></span> <span data-ttu-id="346c8-227">Au lieu de penser et la gestion des ressources matérielles, vous pouvez considérer d’une unité de demande (RU) en tant qu’une seule mesure pour tooperform requis de ressources hello diverses opérations de base de données et le service demande d’une application.</span><span class="sxs-lookup"><span data-stu-id="346c8-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for hello resources required tooperform various database operations and service an application request.</span></span>

    <span data-ttu-id="346c8-228">[Unités de requête](request-units.md) sont configurés pour chaque compte de base de données en fonction du nombre de hello d’unités de capacité que vous achetez.</span><span class="sxs-lookup"><span data-stu-id="346c8-228">[Request units](request-units.md) are provisioned for each database account based on hello number of capacity units that you purchase.</span></span> <span data-ttu-id="346c8-229">La consommation d'unités de demande est évaluée en fonction d'un taux par seconde.</span><span class="sxs-lookup"><span data-stu-id="346c8-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="346c8-230">Les applications qui dépassent les unités de demande configuré hello du taux de leur compte est limité jusqu'à ce que le taux de hello inférieure hello niveau réservé pour le compte de hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-230">Applications that exceed hello provisioned request unit rate for their account is limited until hello rate drops below hello reserved level for hello account.</span></span> <span data-ttu-id="346c8-231">Si votre application a besoin d'un niveau de débit plus élevé, vous pouvez acheter des unités de capacité supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="346c8-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="346c8-232">complexité Hello d’une requête a un impact sur le nombre d’unités demande sont consommé pour une opération.</span><span class="sxs-lookup"><span data-stu-id="346c8-232">hello complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="346c8-233">nombre Hello de prédicats, nature de prédicats de hello, nombre des UDF et la taille de hello du jeu de données source hello tous influencent coût hello d’opérations de requête.</span><span class="sxs-lookup"><span data-stu-id="346c8-233">hello number of predicates, nature of hello predicates, number of UDFs, and hello size of hello source data set all influence hello cost of query operations.</span></span>

    <span data-ttu-id="346c8-234">surcharge de hello toomeasure de n’importe quelle opération (créer, mettre à jour ou supprimer), inspecter l’en-tête x-ms-demande-frais de hello (ou hello propriété RequestCharge équivalente dans ResourceResponse<T> ou FeedResponse<T> Bonjour .NET SDK) toomeasure nombre de Hello d’unités de demande utilisés par ces opérations.</span><span class="sxs-lookup"><span data-stu-id="346c8-234">toomeasure hello overhead of any operation (create, update, or delete), inspect hello x-ms-request-charge header (or hello equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in hello .NET SDK) toomeasure hello number of request units consumed by these operations.</span></span>

    ```C#
    // Measure hello performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure hello performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="346c8-235">frais de demande renvoyé dans cet en-tête Hello désigne une fraction de votre débit approvisionné (c'est-à-dire 2000 RUs / seconde).</span><span class="sxs-lookup"><span data-stu-id="346c8-235">hello request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="346c8-236">Par exemple, si hello requête précédente retourne 1000 1 Ko-documents, coût hello d’opération de hello est 1000.</span><span class="sxs-lookup"><span data-stu-id="346c8-236">For example, if hello preceding query returns 1000 1KB-documents, hello cost of hello operation is 1000.</span></span> <span data-ttu-id="346c8-237">Par conséquent, au sein d’une seconde, serveur de hello ne honore que deux de ces demandes avant la limitation des demandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="346c8-237">As such, within one second, hello server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="346c8-238">Pour plus d’informations, consultez [unités de requête](request-units.md) et hello [calculatrice des unités de demande](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="346c8-238">For more information, see [Request units](request-units.md) and hello [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="346c8-239">**Gestion de la limite de taux/du taux de requête trop importants**</span><span class="sxs-lookup"><span data-stu-id="346c8-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="346c8-240">Lorsqu’un client essaie de débit réservés de tooexceed hello pour un compte, il n’existe aucune dégradation des performances sur le serveur de hello et aucune utilisation de la capacité de débit au-delà du niveau de hello réservé.</span><span class="sxs-lookup"><span data-stu-id="346c8-240">When a client attempts tooexceed hello reserved throughput for an account, there is no performance degradation at hello server and no use of throughput capacity beyond hello reserved level.</span></span> <span data-ttu-id="346c8-241">serveur de Hello va se terminer manière préemptive demande hello avec RequestRateTooLarge (code d’état HTTP 429) et retour hello x-ms-nouvelle tentative-après-ms en-tête indiquant hello durée, en millisecondes, pendant lequel hello utilisateur doit attendre avant de retenter la demande de hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-241">hello server will preemptively end hello request with RequestRateTooLarge (HTTP status code 429) and return hello x-ms-retry-after-ms header indicating hello amount of time, in milliseconds, that hello user must wait before reattempting hello request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="346c8-242">Kits de développement logiciel Hello toutes implicitement intercepter cette réponse respectent en-tête hello spécifiée par le serveur retry-after et nouvelle tentative de demande de hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-242">hello SDKs all implicitly catch this response, respect hello server-specified retry-after header, and retry hello request.</span></span> <span data-ttu-id="346c8-243">À moins que votre compte est accessible simultanément par plusieurs clients, hello suivant sera réalisée.</span><span class="sxs-lookup"><span data-stu-id="346c8-243">Unless your account is being accessed concurrently by multiple clients, hello next retry will succeed.</span></span>

    <span data-ttu-id="346c8-244">Si vous avez plusieurs clients cumulative d’exploitation cohérente du taux de demande hello, hello par défaut de nouvelles tentatives actuellement too9 ensemble en interne par le client de hello ne suffisent pas ; Dans ce cas, les clients hello lève une DocumentClientException avec l’application en état code 429 toohello.</span><span class="sxs-lookup"><span data-stu-id="346c8-244">If you have more than one client cumulatively operating consistently above hello request rate, hello default retry count currently set too9 internally by hello client may not suffice; in this case, hello client throws a DocumentClientException with status code 429 toohello application.</span></span> <span data-ttu-id="346c8-245">nombre de tentatives Hello par défaut peut être modifié par hello paramètre RetryOptions sur l’instance de ConnectionPolicy hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-245">hello default retry count can be changed by setting hello RetryOptions on hello ConnectionPolicy instance.</span></span> <span data-ttu-id="346c8-246">Par défaut, hello DocumentClientException avec le code d’état 429 est retourné après un délai d’attente cumulé de 30 secondes si la demande de hello continue toooperate du taux de demande hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-246">By default, hello DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if hello request continues toooperate above hello request rate.</span></span> <span data-ttu-id="346c8-247">Cela produit même lorsque nombre de tentatives hello est inférieur au nombre de tentatives maximum de hello, qu’il s’agisse de la valeur par défaut hello 9 ou une valeur définie par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="346c8-247">This occurs even when hello current retry count is less than hello max retry count, be it hello default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="346c8-248">Tandis que hello automatisée comportement des nouvelles tentatives permet aux tooimprove résilience et la facilité d’utilisation pour hello la plupart des applications, il peut provenir opposés lors de l’exécution des tests de performances, en particulier quand mesurer la latence.</span><span class="sxs-lookup"><span data-stu-id="346c8-248">While hello automated retry behavior helps tooimprove resiliency and usability for hello most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="346c8-249">latence de client observée Hello atteindra si expérience de hello atteint la limitation du serveur hello et provoque le client hello réessayer toosilently de kit de développement logiciel.</span><span class="sxs-lookup"><span data-stu-id="346c8-249">hello client-observed latency will spike if hello experiment hits hello server throttle and causes hello client SDK toosilently retry.</span></span> <span data-ttu-id="346c8-250">latence de tooavoid des pics se produisent au cours des expériences de performances, mesure hello frais retournés par chaque opération et s’assurer que les demandes fonctionnent sous les taux réservé hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-250">tooavoid latency spikes during performance experiments, measure hello charge returned by each operation and ensure that requests are operating below hello reserved request rate.</span></span> <span data-ttu-id="346c8-251">Pour plus d’informations, consultez [Unités de requête](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="346c8-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="346c8-252">**Conception de documents plus petits pour un débit plus élevé**</span><span class="sxs-lookup"><span data-stu-id="346c8-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="346c8-253">Bonjour demande frais (autrement dit, le coût de traitement de la demande) d’une opération donnée sont directement mis en corrélation de taille toohello du document de hello.</span><span class="sxs-lookup"><span data-stu-id="346c8-253">hello request charge (i.e. request processing cost) of a given operation is directly correlated toohello size of hello document.</span></span> <span data-ttu-id="346c8-254">Des opérations sur des documents volumineux coûtent plus cher que des opérations sur de petits documents.</span><span class="sxs-lookup"><span data-stu-id="346c8-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="346c8-255">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="346c8-255">Next steps</span></span>
<span data-ttu-id="346c8-256">Pour un tooevaluate d’application utilisée exemple Cosmos DB pour les scénarios de haute performance sur quelques ordinateurs clients, consultez [performances et évolutivité de test avec la base de données Cosmos](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="346c8-256">For a sample application used tooevaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="346c8-257">En outre, toolearn savoir plus sur la conception de votre application pour la mise à l’échelle et de hautes performances, consultez [de partitionnement et de mise à l’échelle dans la base de données Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="346c8-257">Also, toolearn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
