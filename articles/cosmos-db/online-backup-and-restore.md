---
title: Sauvegarde et restauration en ligne avec Azure Cosmos DB | Microsoft Docs
description: "Découvrez comment effectuer des sauvegardes et des restaurations automatiques sur une base de données Azure Cosmos DB."
keywords: sauvegarde et restauration, sauvegarde en ligne
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="38f81-104">Sauvegarde et restauration en ligne automatiques avec Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="38f81-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="38f81-105">Azure Cosmos DB sauvegarde automatiquement toutes vos données à intervalles réguliers.</span><span class="sxs-lookup"><span data-stu-id="38f81-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="38f81-106">Les sauvegardes automatiques sont effectuées sans affecter les performances ou la disponibilité de vos opérations de base de données.</span><span class="sxs-lookup"><span data-stu-id="38f81-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="38f81-107">Toutes vos sauvegardes sont stockées séparément dans un autre service de stockage, et ces sauvegardes sont répliquées globalement pour garantir la résilience contre les sinistres régionaux.</span><span class="sxs-lookup"><span data-stu-id="38f81-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="38f81-108">Les sauvegardes automatiques sont destinées aux scénarios où vous supprimez accidentellement votre conteneur Cosmos DB et où vous avez besoin ultérieurement d’une solution de récupération de données ou de récupération d’urgence.</span><span class="sxs-lookup"><span data-stu-id="38f81-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="38f81-109">Cet article commence par un récapitulatif sur la redondance et la disponibilité des données dans Cosmos DB et traite ensuite des sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="38f81-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="38f81-110">Récapitulatif de la haute disponibilité avec Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="38f81-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="38f81-111">Cosmos DB est conçu pour être [globalement distribué](distribute-data-globally.md) : il vous permet de mettre à l’échelle le débit dans plusieurs régions Azure, ainsi que le basculement indiqué par la stratégie et les API multihébergement transparentes.</span><span class="sxs-lookup"><span data-stu-id="38f81-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="38f81-112">En tant que système de base de données offrant des [contrats SLA de disponibilité à 99,99 %](https://azure.microsoft.com/support/legal/sla/cosmos-db), toutes les écritures dans Cosmos DB sont validées durablement sur des disques locaux par un quorum de réplicas au sein d’un centre de données local avant d’accuser réception au client.</span><span class="sxs-lookup"><span data-stu-id="38f81-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="38f81-113">Notez que la haute disponibilité de Cosmos DB s’appuie sur le stockage local et ne dépend d’aucune technologie de stockage externe.</span><span class="sxs-lookup"><span data-stu-id="38f81-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="38f81-114">En outre, si votre compte de base de données est associé à plusieurs régions Azure, vos écritures sont également répliquées entre les autres régions.</span><span class="sxs-lookup"><span data-stu-id="38f81-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="38f81-115">Pour mettre à l’échelle votre débit, et accéder aux données à une latence faible, vous pouvez avoir autant de régions lues associées à votre compte de base de données que vous le souhaitez.</span><span class="sxs-lookup"><span data-stu-id="38f81-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="38f81-116">Dans chaque région de lecture, les données (répliquées) sont rendues persistantes durablement sur un jeu de réplicas.</span><span class="sxs-lookup"><span data-stu-id="38f81-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="38f81-117">Comme illustré dans le schéma suivant, un seul conteneur Cosmos DB est [partitionné horizontalement](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="38f81-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="38f81-118">Une « partition » est indiquée par un cercle dans le diagramme suivant, et chaque partition est hautement disponible via un jeu de réplicas.</span><span class="sxs-lookup"><span data-stu-id="38f81-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="38f81-119">Il s’agit de la distribution locale au sein d’une seule région Azure (indiquée par l’axe des abscisses).</span><span class="sxs-lookup"><span data-stu-id="38f81-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="38f81-120">En outre, chaque partition (avec son jeu de réplicas correspondant) est ensuite globalement distribuée dans plusieurs régions liées à votre compte de base de données (par exemple, dans cette illustration, les trois régions : États-Unis de l’Est, États-Unis de l’Ouest et Centre de l’Inde).</span><span class="sxs-lookup"><span data-stu-id="38f81-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="38f81-121">Le « jeu de partitions » est une entité globalement distribuée comprenant plusieurs copies de vos données dans chaque région (indiquée par l’axe des ordonnées).</span><span class="sxs-lookup"><span data-stu-id="38f81-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="38f81-122">Vous pouvez affecter la priorité aux régions associées à votre compte de base de données ; Cosmos DB basculera en toute transparence à la région suivante en cas de sinistre.</span><span class="sxs-lookup"><span data-stu-id="38f81-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="38f81-123">Vous pouvez également simuler le basculement manuellement pour tester la disponibilité de bout en bout de votre application.</span><span class="sxs-lookup"><span data-stu-id="38f81-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="38f81-124">L’image suivante illustre le degré élevé de redondance avec Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="38f81-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Degré élevé de redondance avec Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Degré élevé de redondance avec Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="38f81-127">Sauvegardes complètes, automatiques, en ligne</span><span class="sxs-lookup"><span data-stu-id="38f81-127">Full, automatic, online backups</span></span>
<span data-ttu-id="38f81-128">Oups, j’ai supprimé mon conteneur ou ma base de données !</span><span class="sxs-lookup"><span data-stu-id="38f81-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="38f81-129">Avec Cosmos DB, vos données, ainsi que les sauvegardes de vos données sont rendues hautement redondantes et résilientes aux sinistres régionaux.</span><span class="sxs-lookup"><span data-stu-id="38f81-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="38f81-130">Actuellement, ces sauvegardes automatisées sont effectuées environ toutes les quatre heures et les deux sauvegardes les plus récentes sont stockées en permanence.</span><span class="sxs-lookup"><span data-stu-id="38f81-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="38f81-131">Si les données sont accidentellement supprimées ou endommagées, contactez le [support technique Azure](https://azure.microsoft.com/support/options/) dans les 8 heures.</span><span class="sxs-lookup"><span data-stu-id="38f81-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="38f81-132">Les sauvegardes sont effectuées sans affecter les performances ou la disponibilité de vos opérations de base de données.</span><span class="sxs-lookup"><span data-stu-id="38f81-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="38f81-133">Cosmos DB effectue la sauvegarde en arrière-plan sans consommer les RU approvisionnées ni affecter les performances et sans affecter la disponibilité de votre base de données.</span><span class="sxs-lookup"><span data-stu-id="38f81-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="38f81-134">Contrairement à vos données qui sont stockées dans Cosmos DB, les sauvegardes automatiques sont stockées dans le service Stockage Blob Azure.</span><span class="sxs-lookup"><span data-stu-id="38f81-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="38f81-135">Pour garantir un chargement efficace et à faible latence, la capture instantanée de votre sauvegarde est chargée vers une instance de stockage Blob Azure dans la même région que la région d’écriture en cours de votre compte de base de données Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="38f81-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="38f81-136">Pour assurer la résilience contre les sinistres régionaux, chaque instantané de vos données de sauvegarde dans le stockage blob Azure est à nouveau répliqué via le stockage géoredondant (GRS) vers une autre région.</span><span class="sxs-lookup"><span data-stu-id="38f81-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="38f81-137">Le schéma suivant montre que l’ensemble du conteneur Cosmos DB (avec les trois partitions principales dans la région États-Unis de l’Ouest, dans cet exemple) est sauvegardé dans un compte Stockage Blob Azure distant dans la région États-Unis de l’Ouest, puis répliqué par GRS dans la région États-Unis de l’Est.</span><span class="sxs-lookup"><span data-stu-id="38f81-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="38f81-138">L’image suivante illustre les sauvegardes complètes périodiques de toutes les entités Cosmos DB dans Stockage Azure GRS.</span><span class="sxs-lookup"><span data-stu-id="38f81-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Sauvegardes complètes périodiques de toutes les entités Cosmos DB dans Stockage Azure GRS](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="38f81-140">Période de rétention des sauvegardes</span><span class="sxs-lookup"><span data-stu-id="38f81-140">Backup retention period</span></span>
<span data-ttu-id="38f81-141">Comme décrit ci-dessus, Azure Cosmos DB prend des captures instantanées de vos données toutes les quatre heures et conserve les deux dernières captures instantanées de chaque partition pendant 30 jours.</span><span class="sxs-lookup"><span data-stu-id="38f81-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="38f81-142">Conformément à nos obligations réglementaires, les instantanés sont supprimés au bout de 90 jours.</span><span class="sxs-lookup"><span data-stu-id="38f81-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="38f81-143">Si vous souhaitez conserver vos propres instantanés, vous pouvez utiliser l’exportation à l’option d’exportation vers un fichier JSON de l’[outil de migration de données](import-data.md#export-to-json-file) d’Azure Cosmos DB pour planifier des sauvegardes supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="38f81-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="38f81-144">Restauration d’une base de données depuis une sauvegarde en ligne</span><span class="sxs-lookup"><span data-stu-id="38f81-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="38f81-145">En cas de suppression accidentelle de vos données, vous pouvez [émettre un ticket de support](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) ou [appeler le support technique Azure](https://azure.microsoft.com/support/options/) pour restaurer les données à partir de la dernière sauvegarde automatique.</span><span class="sxs-lookup"><span data-stu-id="38f81-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="38f81-146">Si vous devez restaurer votre base de données en raison d’un problème d’altération des données, consultez [Gestion de l’altération des données](#handling-data-corruption) lorsque vous devez prendre des mesures supplémentaires pour empêcher les données altérées de pénétrer les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="38f81-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="38f81-147">Pour obtenir une capture instantanée spécifique de votre sauvegarde à restaurer, Cosmos DB requiert que les données soient accessibles pendant la durée du cycle de sauvegarde de cette capture instantanée.</span><span class="sxs-lookup"><span data-stu-id="38f81-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="38f81-148">Gestion de l’altération des données</span><span class="sxs-lookup"><span data-stu-id="38f81-148">Handling data corruption</span></span>
<span data-ttu-id="38f81-149">Azure Cosmos DB conserve les deux dernières sauvegardes de chaque partition dans le système.</span><span class="sxs-lookup"><span data-stu-id="38f81-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="38f81-150">Ce modèle fonctionne parfaitement lorsque un conteneur (collection de documents, graphique, table) ou une base de données est accidentellement supprimé car une des dernières versions peut être restaurée.</span><span class="sxs-lookup"><span data-stu-id="38f81-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="38f81-151">Toutefois, dans le cas où les utilisateurs présentent un problème d’altération des données, Azure Cosmos DB peut ne pas être informé de l’altération des données et il est possible que l’altération pénètre les sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="38f81-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="38f81-152">Dès que l’altération est supprimée, vous devez supprimer le conteneur altéré (collection/graphique/table) afin que les sauvegardes soient protégés contre l’écrasement des données altérées.</span><span class="sxs-lookup"><span data-stu-id="38f81-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="38f81-153">Étant donné que la dernière sauvegarde peut dater de quatre heures, l’utilisateur peut employer [modifier le flux](change-feed.md) pour capturer et stocker les quatre dernières heures de données avant de supprimer le conteneur.</span><span class="sxs-lookup"><span data-stu-id="38f81-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="38f81-154">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="38f81-154">Next steps</span></span>

<span data-ttu-id="38f81-155">Pour répliquer votre base de données dans plusieurs centres de données, consultez [Azure Cosmos DB, un service de base de données mondialement distribué sur Azure](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="38f81-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="38f81-156">Pour contacter le support technique Azure, [émettez un ticket à partir du Portail Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="38f81-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>

