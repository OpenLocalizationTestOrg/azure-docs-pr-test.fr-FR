---
title: "contrôle d’accès prise en charge de pare-feu de base de données Cosmos aaaAzure & IP | Documents Microsoft"
description: "Découvrez comment toouse stratégies de contrôle d’accès IP pour le pare-feu prennent en charge sur les comptes de base de données de base de données Azure Cosmos."
keywords: "contrôle d’accès IP, prise en charge du pare-feu"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: b5cdbdb28e9d7ee0fd0ea54aad277167b699929f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="a4ffa-104">Prise en charge du pare-feu Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="a4ffa-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="a4ffa-105">toosecure les données stockées dans un compte de base de données de base de données Azure Cosmos, Azure Cosmos DB a fourni le prise en charge pour une clé secrète en fonction [modèle d’autorisation](https://msdn.microsoft.com/library/azure/dn783368.aspx) qui utilise un code d’authentification forte message en fonction de hachage (HMAC).</span><span class="sxs-lookup"><span data-stu-id="a4ffa-105">toosecure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="a4ffa-106">À présent, en outre toohello secret en fonction de modèle d’autorisation, base de données Azure Cosmos prend en charge basée sur des contrôles d’accès IP pour la prise en charge de pare-feu entrantes.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-106">Now, in addition toohello secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="a4ffa-107">Ce modèle est très similaire règles de pare-feu toohello d’un système de base de données traditionnelle et fournit un niveau supplémentaire de sécurité toohello compte de base de données de base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-107">This model is very similar toohello firewall rules of a traditional database system and provides an additional level of security toohello Azure Cosmos DB database account.</span></span> <span data-ttu-id="a4ffa-108">Avec ce modèle, vous pouvez désormais configurer une base de données Azure Cosmos de base de données compte toobe accessible uniquement à partir d’un jeu approuvé d’ordinateurs ou services de cloud computing.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-108">With this model, you can now configure an Azure Cosmos DB database account toobe accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="a4ffa-109">Accéder aux ressources de base de données Cosmos tooAzure à partir de ces jeux approuvées des ordinateurs et des services requièrent toujours hello appelant toopresent un jeton d’autorisation valide.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-109">Access tooAzure Cosmos DB resources from these approved sets of machines and services still require hello caller toopresent a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="a4ffa-110">Vue d’ensemble du contrôle d’accès IP</span><span class="sxs-lookup"><span data-stu-id="a4ffa-110">IP access control overview</span></span>
<span data-ttu-id="a4ffa-111">Par défaut, un compte de base de données de base de données Azure Cosmos est accessible à partir de l’internet public tant que la demande de hello est accompagnée d’un jeton d’autorisation valide.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as hello request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="a4ffa-112">contrôle d’accès stratégie tooconfigure IP, les utilisateur de hello doit fournir des ensemble hello d’adresses IP ou des plages d’adresses IP dans toobe de forme CIDR inclus en tant que hello autorisée de la liste des adresses IP de client pour un compte de base de données spécifique.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-112">tooconfigure IP policy-based access control, hello user must provide hello set of IP addresses or IP address ranges in CIDR form toobe included as hello allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="a4ffa-113">Une fois cette configuration est appliquée, toutes les demandes provenant d’ordinateurs en dehors de cette liste autorisée seront bloqués par le serveur de hello.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by hello server.</span></span>  <span data-ttu-id="a4ffa-114">connexion Hello flux de traitement d’hello contrôle d’accès basé sur IP est décrite dans hello suivant schéma.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-114">hello connection processing flow for hello IP-based access control is described in hello following diagram.</span></span>

![Diagramme illustrant le processus de connexion hello pour le contrôle d’accès basé sur IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="a4ffa-116">Connexions à partir de services cloud</span><span class="sxs-lookup"><span data-stu-id="a4ffa-116">Connections from cloud services</span></span>
<span data-ttu-id="a4ffa-117">Dans Azure, les services cloud sont une méthode très courante d’hébergement de la logique de service de couche intermédiaire à l’aide d’Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="a4ffa-118">tooan d’accès tooenable compte de base de données de base de données Azure Cosmos à partir d’un service cloud, hello adresse IP publique du service de cloud computing hello doit être ajouté toohello autorisée de la liste des adresses IP associées à votre compte de base de données de base de données Azure Cosmos par [configuration Hello de stratégie de contrôle d’accès IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="a4ffa-118">tooenable access tooan Azure Cosmos DB database account from a cloud service, hello public IP address of hello cloud service must be added toohello allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="a4ffa-119">Cela garantit que toutes les instances de rôle des services de cloud computing ont accès tooyour compte de base de données de base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-119">This ensures that all role instances of cloud services have access tooyour Azure Cosmos DB database account.</span></span> <span data-ttu-id="a4ffa-120">Vous pouvez récupérer des adresses IP pour vos services cloud Bonjour portail Azure, comme indiqué dans hello suivant capture d’écran.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-120">You can retrieve IP addresses for your cloud services in hello Azure portal, as shown in hello following screenshot.</span></span>

![Capture d’écran montrant l’adresse IP publique de hello pour un service cloud affichés dans hello portail Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="a4ffa-122">Lorsque vous faites évoluer votre service cloud en ajoutant une ou plusieurs instances de rôle supplémentaires, ces nouvelles instances auront automatiquement compte de base de données de base de données Azure Cosmos de toohello accès, car ils font partie de hello même service cloud.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access toohello Azure Cosmos DB database account since they are part of hello same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="a4ffa-123">Connexions à partir de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="a4ffa-123">Connections from virtual machines</span></span>
<span data-ttu-id="a4ffa-124">[Machines virtuelles](https://azure.microsoft.com/services/virtual-machines/) ou [machines virtuelles identiques](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) peut également être utilisé toohost services de niveau intermédiaire à l’aide de la base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used toohost middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="a4ffa-125">tooconfigure hello Azure Cosmos DB de base de données compte tooallow l’accès à partir d’ordinateurs virtuels, les adresses IP publiques de machines virtuelles identiques et/ou de la machine virtuelle doit être configuré comme l’un des hello autorisée pour votre compte de base de données de base de données Azure Cosmos par des adresses IP [configuration de la stratégie de contrôle d’accès IP hello](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="a4ffa-125">tooconfigure hello Azure Cosmos DB database account tooallow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of hello allowed IP addresses for your Azure Cosmos DB database account by [configuring hello IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="a4ffa-126">Vous pouvez récupérer des adresses IP pour les ordinateurs virtuels dans hello portail Azure, comme indiqué dans hello suivant capture d’écran.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-126">You can retrieve IP addresses for virtual machines in hello Azure portal, as shown in hello following screenshot.</span></span>

![Capture d’écran montrant une adresse IP publique pour un ordinateur virtuel affiché dans hello portail Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="a4ffa-128">Lorsque vous ajoutez le groupe d’instances de machine virtuelle supplémentaire toohello, elles sont fournies automatiquement compte de base de données access tooyour base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-128">When you add additional virtual machine instances toohello group, they are automatically provided access tooyour Azure Cosmos DB database account.</span></span>

## <a name="connections-from-hello-internet"></a><span data-ttu-id="a4ffa-129">Connexions à partir de hello internet</span><span class="sxs-lookup"><span data-stu-id="a4ffa-129">Connections from hello internet</span></span>
<span data-ttu-id="a4ffa-130">Lorsque vous avez accès à une base de données Azure Cosmos compte base de données à partir d’un ordinateur sur hello internet, hello adresse IP du client ou la plage d’adresses IP de l’ordinateur de hello doit être ajouté toohello liste d’adresses IP pour le compte de base de données de base de données Azure Cosmos de hello autorisée.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-130">When you access an Azure Cosmos DB database account from a computer on hello internet, hello client IP address or IP address range of hello machine must be added toohello allowed list of IP address for hello Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="a4ffa-131"><a id="configure-ip-policy"></a>Configuration de la stratégie de contrôle d’accès IP hello</span><span class="sxs-lookup"><span data-stu-id="a4ffa-131"><a id="configure-ip-policy"></a> Configuring hello IP access control policy</span></span>
<span data-ttu-id="a4ffa-132">stratégie de contrôle d’accès Hello IP peut être définie dans hello portail Azure, ou par programmation via [CLI d’Azure](cli-samples.md), [Azure Powershell](powershell-samples.md), ou hello [API REST](/rest/api/documentdb/) en mettant à jour hello `ipRangeFilter` propriété.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-132">hello IP access control policy can be set in hello Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or hello [REST API](/rest/api/documentdb/) by updating hello `ipRangeFilter` property.</span></span> <span data-ttu-id="a4ffa-133">Les plages/adresses IP doivent être séparées par des virgules et ne doivent pas contenir d’espaces.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="a4ffa-134">Exemple : « 13.91.6.132,13.91.6.1/24 ».</span><span class="sxs-lookup"><span data-stu-id="a4ffa-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="a4ffa-135">Lors de la mise à jour de votre compte de base de données à utiliser ces méthodes, être toopopulate que tous les tooprevent de propriétés hello la réinitialisation des paramètres de toodefault.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-135">When updating your database account through these methods, be sure toopopulate all of hello properties tooprevent resetting toodefault settings.</span></span>

> [!NOTE]
> <span data-ttu-id="a4ffa-136">En activant une stratégie de contrôle d’accès IP pour votre compte de base de données de base de données Azure Cosmos, tous les accès tooyour compte de base de données de base de données Azure Cosmos à partir d’ordinateurs à l’extérieur de hello configuré autorisé la liste des plages d’adresses IP sont bloqués.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="a4ffa-137">En vertu de ce modèle, navigation opération hello de plan des données à partir du portail de hello sera également l’intégrité de hello tooensure bloqués de contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-137">By virtue of this model, browsing hello data plane operation from hello portal will also be blocked tooensure hello integrity of access control.</span></span>

<span data-ttu-id="a4ffa-138">développement de toosimplify, hello portail Azure permet d’identifier et ajouter IP hello de votre toohello d’ordinateur client autorisée de la liste, afin que les applications qui s’exécutent de votre ordinateur peuvent accéder à hello compte de base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-138">toosimplify development, hello Azure portal helps you identify and add hello IP of your client machine toohello allowed list, so that apps running your machine can access hello Azure Cosmos DB account.</span></span> <span data-ttu-id="a4ffa-139">Notez que hello client ici l’adresse IP est détecté comme indiqué par le portail de hello.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-139">Note that hello client IP address here is detected as seen by hello portal.</span></span> <span data-ttu-id="a4ffa-140">Il peut être adresse IP du client hello de votre ordinateur, mais elle peut également être hello adresseIP de votre passerelle de réseau.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-140">It may be hello client IP address of your machine, but it could also be hello IP address of your network gateway.</span></span> <span data-ttu-id="a4ffa-141">N’oubliez pas de tooremove avant le cours tooproduction.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-141">Do not forget tooremove it before going tooproduction.</span></span>

<span data-ttu-id="a4ffa-142">stratégie de contrôle d’accès tooset hello IP Bonjour portail Azure, accédez Panneau de compte de base de données Azure Cosmos toohello, cliquez sur **pare-feu** dans le menu de navigation hello, puis cliquez sur **ON**</span><span class="sxs-lookup"><span data-stu-id="a4ffa-142">tooset hello IP access control policy in hello Azure portal, navigate toohello Azure Cosmos DB account blade, click **Firewall** in hello navigation menu, then click **ON**</span></span> 

![Capture d’écran montrant comment tooopen hello panneau pare-feu Bonjour portail Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="a4ffa-144">Dans le volet de nouveau hello, spécifiez si hello portail Azure peut accéder au compte de hello, ajoutez d’autres adresses et plages si nécessaire, puis cliquez sur **enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-144">In hello new pane, specify whether hello Azure portal can access hello account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="a4ffa-145">Lorsque vous activez une stratégie de contrôle d’accès IP, vous devez adresse IP de hello tooadd pourquoi l’accès toomaintain portail Azure.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-145">When you enable an IP access control policy, you need tooadd hello IP address for hello Azure portal toomaintain access.</span></span> <span data-ttu-id="a4ffa-146">les adresses IP portails Hello sont :</span><span class="sxs-lookup"><span data-stu-id="a4ffa-146">hello portal IP addresses are:</span></span>
> |<span data-ttu-id="a4ffa-147">Région</span><span class="sxs-lookup"><span data-stu-id="a4ffa-147">Region</span></span>|<span data-ttu-id="a4ffa-148">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="a4ffa-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="a4ffa-149">Toutes les régions, à l’exception de celles spécifiées ci-dessous</span><span class="sxs-lookup"><span data-stu-id="a4ffa-149">All regions except those specified below</span></span>| <span data-ttu-id="a4ffa-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="a4ffa-150">104.42.195.92</span></span>|
> |<span data-ttu-id="a4ffa-151">Allemagne</span><span class="sxs-lookup"><span data-stu-id="a4ffa-151">Germany</span></span>|<span data-ttu-id="a4ffa-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="a4ffa-152">51.4.229.218</span></span>|
> |<span data-ttu-id="a4ffa-153">Chine</span><span class="sxs-lookup"><span data-stu-id="a4ffa-153">China</span></span>|<span data-ttu-id="a4ffa-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="a4ffa-154">139.217.8.252</span></span>|
> |<span data-ttu-id="a4ffa-155">Gouvernement des États-Unis – Arizona</span><span class="sxs-lookup"><span data-stu-id="a4ffa-155">US Gov Arizona</span></span>|<span data-ttu-id="a4ffa-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="a4ffa-156">52.244.48.71</span></span>|
>

![Capture d’écran montrant la façon dont les paramètres de pare-feu tooconfigure Bonjour portail Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-hello-ip-access-control-policy"></a><span data-ttu-id="a4ffa-158">Résolution des problèmes de stratégie de contrôle d’accès hello IP</span><span class="sxs-lookup"><span data-stu-id="a4ffa-158">Troubleshooting hello IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="a4ffa-159">Opérations du portail</span><span class="sxs-lookup"><span data-stu-id="a4ffa-159">Portal operations</span></span>
<span data-ttu-id="a4ffa-160">En activant une stratégie de contrôle d’accès IP pour votre compte de base de données de base de données Azure Cosmos, tous les accès tooyour compte de base de données de base de données Azure Cosmos à partir d’ordinateurs à l’extérieur de hello configuré autorisé la liste des plages d’adresses IP sont bloqués.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access tooyour Azure Cosmos DB database account from machines outside hello configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="a4ffa-161">Par conséquent, si vous souhaitez que les opérations de plan de données du portail tooenable à la navigation sur les collections et les documents de la requête, vous devez tooexplicitly autoriser l’accès de portail Azure à l’aide de hello **pare-feu** panneau dans le portail de hello.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-161">Therefore if you want tooenable portal data plane operations like browsing collections and query documents, you need tooexplicitly allow Azure portal access using hello **Firewall** blade in hello portal.</span></span> 

![Capture d’écran montrant comment tooenable accès toohello portail Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="a4ffa-163">Kit de développement logiciel (SDK) et API REST</span><span class="sxs-lookup"><span data-stu-id="a4ffa-163">SDK & Rest API</span></span>
<span data-ttu-id="a4ffa-164">Pour des raisons de sécurité, l’accès via le Kit de développement logiciel ou de l’API REST à partir d’ordinateurs pas sur la liste autorisée de hello renverra une réponse de 404 introuvable générique avec des détails supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-164">For security reasons, access via SDK or REST API from machines not on hello allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="a4ffa-165">Vérifiez que hello IP autorisée liste configuré pour votre base de données Azure Cosmos de base de données compte tooensure hello stratégie correcte est appliquée tooyour compte de base de données de base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="a4ffa-165">Please verify hello IP allowed list configured for your Azure Cosmos DB database account tooensure hello correct policy configuration is applied tooyour Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a4ffa-166">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a4ffa-166">Next steps</span></span>
<span data-ttu-id="a4ffa-167">Pour plus d’informations sur les conseils sur les performances relatives au réseau, consultez [Conseils relatifs aux performances](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="a4ffa-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

