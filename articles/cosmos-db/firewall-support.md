---
title: "Prise en charge du pare-feu Azure Cosmos DB et contrôle d’accès IP | Microsoft Docs"
description: "Découvrez comment utiliser les stratégies de contrôle d’accès IP pour la prise en charge du pare-feu dans les comptes de base de données Azure Cosmos DB."
keywords: "contrôle d’accès IP, prise en charge du pare-feu"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="4a1dc-104">Prise en charge du pare-feu Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4a1dc-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="4a1dc-105">Pour sécuriser les données stockées dans un compte de base de données Azure Cosmos DB, Azure Cosmos DB assure la prise en charge d’un [modèle d’autorisation](https://msdn.microsoft.com/library/azure/dn783368.aspx) basé sur une clé secrète, qui utilise un code d’authentification de message basé sur le hachage (HMAC) à forte intégrité.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="4a1dc-106">Outre le modèle d’autorisations basé sur un secret, Azure Cosmos DB prend désormais en charge les contrôles d’accès basés sur une stratégie IP pour la prise en charge du pare-feu entrant.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="4a1dc-107">Ce modèle est très semblable aux règles de pare-feu d’un système de base de données traditionnel et renforce la sécurité du compte de base de données Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="4a1dc-108">Avec ce modèle, vous pouvez désormais configurer un compte de base de données Azure Cosmos DB pour qu’il soit accessible uniquement à partir d’un ensemble d’ordinateurs et/ou de services cloud approuvés.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="4a1dc-109">L’accès aux ressources Azure Cosmos DB à partir de ces ensembles d’ordinateurs et de services approuvés nécessite toujours que l’appelant présente un jeton d’autorisation valide.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="4a1dc-110">Vue d’ensemble du contrôle d’accès IP</span><span class="sxs-lookup"><span data-stu-id="4a1dc-110">IP access control overview</span></span>
<span data-ttu-id="4a1dc-111">Par défaut, un compte de base de données Azure Cosmos DB est accessible depuis l’Internet public tant que la demande est accompagnée d’un jeton d’autorisation valide.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="4a1dc-112">Pour configurer le contrôle d’accès basé sur la stratégie IP, l’utilisateur doit fournir le jeu d’adresses IP ou des plages d’adresses IP au format CIDR pour être ajouté à la liste d’adresses IP clients autorisées pour un compte de base de données donné.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="4a1dc-113">Une fois que cette configuration est appliquée, toutes les demandes provenant d’ordinateurs ne figurant pas sur cette liste autorisée seront bloquées par le serveur.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="4a1dc-114">Le flux de traitement de connexion du contrôle d’accès basé sur IP est décrit dans le diagramme suivant.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagramme illustrant le processus de connexion du contrôle d’accès basé sur IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="4a1dc-116">Connexions à partir de services cloud</span><span class="sxs-lookup"><span data-stu-id="4a1dc-116">Connections from cloud services</span></span>
<span data-ttu-id="4a1dc-117">Dans Azure, les services cloud sont une méthode très courante d’hébergement de la logique de service de couche intermédiaire à l’aide d’Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="4a1dc-118">Pour autoriser l’accès à un compte de base de données Azure Cosmos DB à partir d’un service cloud, l’adresse IP publique de ce dernier doit être ajoutée à la liste d’adresses IP autorisées de votre compte de base de données Azure Cosmos DB en [configurant la stratégie de contrôle d’accès IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4a1dc-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="4a1dc-119">Cela garantit que toutes les instances de rôle des services cloud ont accès à votre compte de base de données Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="4a1dc-120">Vous pouvez récupérer des adresses IP pour vos services cloud dans le portail Azure, comme illustré dans la capture d’écran suivante.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Capture d’écran illustrant l’adresse IP publique pour un service cloud affichée dans le portail Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="4a1dc-122">Lorsque vous faites évoluer votre service cloud en ajoutant des instances de rôle supplémentaires, ces nouvelles instances auront automatiquement accès au compte de base de données Azure Cosmos DB, car ils font partie du même service cloud.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="4a1dc-123">Connexions à partir de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="4a1dc-123">Connections from virtual machines</span></span>
<span data-ttu-id="4a1dc-124">Des [machines virtuelles](https://azure.microsoft.com/services/virtual-machines/) ou des [jeux de mise à l’échelle de machine virtuelle](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) peuvent également être utilisés pour héberger les services de couche intermédiaire à l’aide d’Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="4a1dc-125">Pour configurer le compte de base de données Azure Cosmos DB afin qu’il autorise l’accès à partir de machines virtuelles, les adresses IP publiques de la machine virtuelle ou du groupe de machines virtuelles identiques doivent figurer parmi les adresses IP autorisées de votre compte de base de données Azure Cosmos DB en [configurant la stratégie de contrôle d’accès IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="4a1dc-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="4a1dc-126">Vous pouvez récupérer des adresses IP pour des machines virtuelles dans le portail Azure, comme illustré dans la capture d’écran suivante.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Capture d’écran illustrant une adresse IP publique pour une machine virtuelle affichée dans le portail Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="4a1dc-128">Lorsque vous ajoutez des instances de machine virtuelle supplémentaires au groupe, elles disposent automatiquement d’un accès à votre compte de base de données Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="4a1dc-129">Connexions à partir d’Internet</span><span class="sxs-lookup"><span data-stu-id="4a1dc-129">Connections from the internet</span></span>
<span data-ttu-id="4a1dc-130">Lorsque vous accédez à un compte de base de données Azure Cosmos DB à partir d’un ordinateur sur Internet, l’adresse IP ou la plage d’adresses IP de l’ordinateur doit être ajoutée à la liste d’adresses IP autorisées pour le compte de base de données Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="4a1dc-131"><a id="configure-ip-policy"></a> Configuration de la stratégie de contrôle d’accès IP</span><span class="sxs-lookup"><span data-stu-id="4a1dc-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="4a1dc-132">La stratégie de contrôle d’accès IP peut être définie dans le portail Azure ou par programmation avec [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md)ou [l’API REST](/rest/api/documentdb/) en mettant à jour la propriété `ipRangeFilter`.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="4a1dc-133">Les plages/adresses IP doivent être séparées par des virgules et ne doivent pas contenir d’espaces.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="4a1dc-134">Exemple : « 13.91.6.132,13.91.6.1/24 ».</span><span class="sxs-lookup"><span data-stu-id="4a1dc-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="4a1dc-135">Lors de la mise à jour de votre compte de base de données avec ces méthodes, veillez à renseigner toutes les propriétés afin d’éviter le rétablissement des paramètres par défaut.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="4a1dc-136">En activant une stratégie de contrôle d’accès IP pour votre compte de base de données Azure Cosmos DB, tous les accès à votre compte de base de données Azure Cosmos DB à partir d’ordinateurs ne figurant pas sur la liste de plages d’adresses IP autorisées sont bloqués.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4a1dc-137">En vertu de ce modèle, la navigation dans le plan de données à partir du portail sera également bloquée pour assurer l’intégrité du contrôle d’accès.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="4a1dc-138">Pour simplifier le développement, le portail Azure vous aide à identifier et à ajouter l’adresse IP de votre ordinateur client à la liste autorisée, afin que les applications qui exécutent votre machine puissent accéder au compte Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="4a1dc-139">Dans ce cas, l’adresse IP du client est détectée comme indiquée par le portail.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="4a1dc-140">Il peut s’agir de l’adresse IP client de votre ordinateur, mais il peut également s’agir de l’adresse IP de votre passerelle réseau.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="4a1dc-141">N’oubliez pas de la supprimer avant de passer à la production.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="4a1dc-142">Pour définir la stratégie de contrôle d’accès IP dans le portail Azure, accédez au panneau du compte Azure Cosmos DB, cliquez sur **Pare-feu** dans le menu de navigation, puis cliquez sur **ACTIVÉ**.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Capture d’écran montrant comment ouvrir le panneau Pare-feu dans le portail Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="4a1dc-144">Dans le volet Nouveau, indiquez si le portail Azure peut accéder au compte et ajoutez d’autres adresses et plages si nécessaire, puis cliquez sur **Enregistrer**.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="4a1dc-145">Quand vous activez une stratégie de contrôle d’accès IP, vous devez ajouter l’adresse IP du portail Azure pour conserver l’accès.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="4a1dc-146">Les adresses IP du portail sont :</span><span class="sxs-lookup"><span data-stu-id="4a1dc-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="4a1dc-147">Région</span><span class="sxs-lookup"><span data-stu-id="4a1dc-147">Region</span></span>|<span data-ttu-id="4a1dc-148">Adresse IP</span><span class="sxs-lookup"><span data-stu-id="4a1dc-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="4a1dc-149">Toutes les régions, à l’exception de celles spécifiées ci-dessous</span><span class="sxs-lookup"><span data-stu-id="4a1dc-149">All regions except those specified below</span></span>| <span data-ttu-id="4a1dc-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="4a1dc-150">104.42.195.92</span></span>|
> |<span data-ttu-id="4a1dc-151">Allemagne</span><span class="sxs-lookup"><span data-stu-id="4a1dc-151">Germany</span></span>|<span data-ttu-id="4a1dc-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="4a1dc-152">51.4.229.218</span></span>|
> |<span data-ttu-id="4a1dc-153">Chine</span><span class="sxs-lookup"><span data-stu-id="4a1dc-153">China</span></span>|<span data-ttu-id="4a1dc-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="4a1dc-154">139.217.8.252</span></span>|
> |<span data-ttu-id="4a1dc-155">Gouvernement des États-Unis – Arizona</span><span class="sxs-lookup"><span data-stu-id="4a1dc-155">US Gov Arizona</span></span>|<span data-ttu-id="4a1dc-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="4a1dc-156">52.244.48.71</span></span>|
>

![Capture d’écran montrant comment configurer les paramètres du pare-feu dans le portail Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="4a1dc-158">Dépannage de la stratégie de contrôle d’accès IP</span><span class="sxs-lookup"><span data-stu-id="4a1dc-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="4a1dc-159">Opérations du portail</span><span class="sxs-lookup"><span data-stu-id="4a1dc-159">Portal operations</span></span>
<span data-ttu-id="4a1dc-160">En activant une stratégie de contrôle d’accès IP pour votre compte de base de données Azure Cosmos DB, tous les accès à votre compte de base de données Azure Cosmos DB à partir d’ordinateurs ne figurant pas sur la liste de plages d’adresses IP autorisées sont bloqués.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="4a1dc-161">Par conséquent, si vous souhaitez activer les opérations de plan de données du portail telles que la navigation dans les collections et l’interrogation des documents, vous devez autoriser explicitement l’accès au portail Azure à l’aide du panneau **Pare-feu** dans le portail.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Capture d’écran montrant comment activer l’accès au portail Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="4a1dc-163">Kit de développement logiciel (SDK) et API REST</span><span class="sxs-lookup"><span data-stu-id="4a1dc-163">SDK & Rest API</span></span>
<span data-ttu-id="4a1dc-164">Pour des raisons de sécurité, l’accès via le Kit de développement logiciel (SDK) ou l’API REST à partir d’ordinateurs ne figurant pas dans la liste autorisée renverra une réponse générique 404 Introuvable, ainsi que des détails supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="4a1dc-165">Consultez la liste d’adresses IP autorisées configurée pour votre compte de base de données Azure Cosmos DB afin de vérifier que la configuration de la stratégie appropriée est appliquée à votre compte de base de données Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="4a1dc-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="4a1dc-166">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="4a1dc-166">Next steps</span></span>
<span data-ttu-id="4a1dc-167">Pour plus d’informations sur les conseils sur les performances relatives au réseau, consultez [Conseils relatifs aux performances](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="4a1dc-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>

