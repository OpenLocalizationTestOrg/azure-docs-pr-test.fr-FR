---
title: "aaaSQL des métriques de requête pour l’API Azure Cosmos DB DocumentDB | Documents Microsoft"
description: "Découvrez comment tooinstrument et debug hello des performances des requêtes SQL de demandes de base de données Azure Cosmos."
keywords: "syntaxe sql, requête sql, requêtes sql, langage de requête json, concepts de bases de données, requêtes sql et fonctions agrégées"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="25b29-104">Réglage des performances de requête avec Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="25b29-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="25b29-105">Azure Cosmos DB fournit une [API SQL pour interroger des données](documentdb-sql-query.md), sans nécessiter de schéma ou d’index secondaires.</span><span class="sxs-lookup"><span data-stu-id="25b29-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="25b29-106">Cet article fournit hello suivant des informations destinées aux développeurs :</span><span class="sxs-lookup"><span data-stu-id="25b29-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="25b29-107">Détails techniques sur le fonctionnement de l’exécution de requêtes SQL dans Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="25b29-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="25b29-108">Développements sur les en-têtes de demande et réponse des requêtes, et sur les options du kit SDK client</span><span class="sxs-lookup"><span data-stu-id="25b29-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="25b29-109">Conseils et meilleures pratiques pour les performances de requêtes</span><span class="sxs-lookup"><span data-stu-id="25b29-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="25b29-110">Exemples de mode de performances des requêtes toodebug de statistiques d’exécution tooutilize SQL</span><span class="sxs-lookup"><span data-stu-id="25b29-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="25b29-111">À propos de l’exécution de requêtes SQL</span><span class="sxs-lookup"><span data-stu-id="25b29-111">About SQL query execution</span></span>

<span data-ttu-id="25b29-112">Dans la base de données Azure Cosmos, vous stockez des données dans les conteneurs, qui peuvent se remplir tooany [débit de demande ou de la taille de stockage](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="25b29-113">Base de données Azure Cosmos redimensionne en toute transparence des données entre les partitions physiques sous hello couvre la croissance des données toohandle ou augmenter le débit approvisionné.</span><span class="sxs-lookup"><span data-stu-id="25b29-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="25b29-114">Vous pouvez émettre le conteneur de tooany de requêtes SQL à l’aide de hello API REST ou l’un des hello pris en charge [kits de développement logiciel DocumentDB](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="25b29-115">Pour résumer brièvement le partitionnement : vous définissez une clé de partition, par exemple "city", qui détermine la façon dont les données sont fractionnées entre plusieurs partitions physiques.</span><span class="sxs-lookup"><span data-stu-id="25b29-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="25b29-116">Clé de partition unique de données appartenant tooa (par exemple, « city » == « Seattle ») est stocké dans une partition physique, mais en général, une seule partition physique a plusieurs clés de partition.</span><span class="sxs-lookup"><span data-stu-id="25b29-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="25b29-117">Lorsqu’une partition a atteint sa taille de stockage, hello service en toute transparence fractionne de partition de hello en deux nouvelles partitions et divise clé de partition hello uniformément entre ces partitions.</span><span class="sxs-lookup"><span data-stu-id="25b29-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="25b29-118">Étant donné que les partitions sont transitoires, hello API utilisent une abstraction d’une « clé plage de partition », qui indique les plages hello des hachages de clé de partition.</span><span class="sxs-lookup"><span data-stu-id="25b29-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="25b29-119">Lorsque vous émettez une requête de tooAzure Cosmos DB, hello SDK exécute les étapes logiques :</span><span class="sxs-lookup"><span data-stu-id="25b29-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="25b29-120">Analyser le plan d’exécution de requête hello SQL requête toodetermine hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="25b29-121">Si la requête de hello comprend un filtre par rapport à la clé de partition hello, tel que `SELECT * FROM c WHERE c.city = "Seattle"`, il est routé tooa une seule partition.</span><span class="sxs-lookup"><span data-stu-id="25b29-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="25b29-122">Si la requête de hello n’a pas un filtre sur la clé de partition, puis elle est exécutée dans toutes les partitions et résultats sont fusionnés côté client.</span><span class="sxs-lookup"><span data-stu-id="25b29-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="25b29-123">requête de Hello est exécuté au sein de chaque partition de série ou parallèle, en fonction de la configuration du client.</span><span class="sxs-lookup"><span data-stu-id="25b29-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="25b29-124">Dans chaque partition, les requêtes hello risque de rendre un ou plusieurs allers-retours en fonction de la complexité de la requête hello, configuré la taille de la page et configuré le débit de la collection de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="25b29-125">Chaque exécution retourne le nombre hello de [unités de requête](request-units.md) consommée par l’exécution des requêtes et éventuellement, des statistiques d’exécution de requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="25b29-126">Hello SDK effectue une synthèse des résultats de la requête hello sur plusieurs partitions.</span><span class="sxs-lookup"><span data-stu-id="25b29-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="25b29-127">Par exemple, si la requête de hello implique une clause ORDER BY sur plusieurs partitions, les résultats à partir des partitions individuelles sont les résultats triés de fusion de tooreturn globalement trié par ordre.</span><span class="sxs-lookup"><span data-stu-id="25b29-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="25b29-128">Si la requête de hello est une agrégation telle que `COUNT`, hello des nombres à partir des partitions individuelles sont additionnée tooproduce hello nombre total.</span><span class="sxs-lookup"><span data-stu-id="25b29-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="25b29-129">Kits de développement logiciel Hello fournissent diverses options pour l’exécution des requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="25b29-130">Par exemple, dans .NET ces options sont disponibles dans hello `FeedOptions` classe.</span><span class="sxs-lookup"><span data-stu-id="25b29-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="25b29-131">Hello tableau suivant décrit ces options et leur impact sur la durée d’exécution de requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="25b29-132">Option</span><span class="sxs-lookup"><span data-stu-id="25b29-132">Option</span></span> | <span data-ttu-id="25b29-133">Description</span><span class="sxs-lookup"><span data-stu-id="25b29-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="25b29-134">Doit être défini tootrue pour toute requête qui nécessite toobe exécutée sur plusieurs partitions.</span><span class="sxs-lookup"><span data-stu-id="25b29-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="25b29-135">Il s’agit d’un indicateur explicite de tooenable vous compromis de performances consciente toomake au moment du développement.</span><span class="sxs-lookup"><span data-stu-id="25b29-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="25b29-136">Doit être définie tootrue si vous avez refusé d’indexation, mais requête de hello toorun via une analyse malgré tout.</span><span class="sxs-lookup"><span data-stu-id="25b29-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="25b29-137">Uniquement applicable si l’indexation pour hello demandé chemin de filtrage est désactivé.</span><span class="sxs-lookup"><span data-stu-id="25b29-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="25b29-138">nombre maximal de Hello de tooreturn d’éléments par aller-retour toohello serveur.</span><span class="sxs-lookup"><span data-stu-id="25b29-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="25b29-139">En définissant trop-1, vous pouvez laisser les serveur hello gérer nombre hello d’éléments.</span><span class="sxs-lookup"><span data-stu-id="25b29-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="25b29-140">Ou bien, vous pouvez réduire cette valeur de tooretrieve uniquement un petit nombre d’éléments par aller-retour.</span><span class="sxs-lookup"><span data-stu-id="25b29-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="25b29-141">Ceci est une option côté client et utiliser la consommation de mémoire toolimit hello lors de l’ordre de partitions croisées par.</span><span class="sxs-lookup"><span data-stu-id="25b29-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="25b29-142">Une valeur plus élevée permet de réduire la latence hello de tri de partitions croisées.</span><span class="sxs-lookup"><span data-stu-id="25b29-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="25b29-143">Obtient ou définit le nombre de hello d’opérations simultanées exécuté côté client lors de l’exécution de requête parallèle Bonjour service de base de données Azure DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="25b29-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="25b29-144">Une valeur de propriété positif limite hello valeur du nombre d’opérations simultanées toohello ensemble.</span><span class="sxs-lookup"><span data-stu-id="25b29-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="25b29-145">Si sa valeur est accessible sans à 0, système de hello décide automatiquement de nombre hello de toorun des opérations simultanées.</span><span class="sxs-lookup"><span data-stu-id="25b29-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="25b29-146">Permet une journalisation détaillée des statistiques du temps passé dans les différentes phases d’exécution de la requête, telles que le moment de la compilation, la durée de la boucle d’indexation et la durée de chargement des documents.</span><span class="sxs-lookup"><span data-stu-id="25b29-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="25b29-147">Vous pouvez partager la sortie à partir des statistiques de requête avec les problèmes de performances de requête toodiagnose prise en charge Azure.</span><span class="sxs-lookup"><span data-stu-id="25b29-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="25b29-148">Vous pouvez reprendre l’exécution des requêtes en passant d’un jeton de continuation opaque hello retourné par une requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="25b29-149">jeton de continuation Hello encapsule tous les états requis pour l’exécution de requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="25b29-150">Vous pouvez limiter la taille maximale de hello hello du jeton de continuation retourné par le serveur de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="25b29-151">Vous devrez peut-être tooset cela si votre hôte d’application a des limites de taille d’en-tête de réponse.</span><span class="sxs-lookup"><span data-stu-id="25b29-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="25b29-152">Définition de cette propriété peut augmenter hello RUs consommées pour les requêtes de hello et la durée globales.</span><span class="sxs-lookup"><span data-stu-id="25b29-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="25b29-153">Par exemple, prenons un exemple de requête sur la clé de partition demandé sur une collection de `/city` en tant que partition hello configurée avec 100 000 ur/s de débit et de clé.</span><span class="sxs-lookup"><span data-stu-id="25b29-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="25b29-154">Vous demandez cette requête à l’aide `CreateDocumentQuery<T>` dans .NET hello suivante :</span><span class="sxs-lookup"><span data-stu-id="25b29-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="25b29-155">Hello extrait du Kit de développement logiciel illustrée ci-dessus, correspond toohello suivant demande l’API REST :</span><span class="sxs-lookup"><span data-stu-id="25b29-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="25b29-156">Chaque page de l’exécution de requête correspond tooa API REST `POST` avec hello `Accept: application/query+json` en-tête et la requête SQL dans le corps de hello hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="25b29-157">Chaque requête effectue un ou plusieurs arrondies serveur toohello allers-retours hello `x-ms-continuation` jeton répercutée entre hello client et serveur tooresume de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="25b29-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="25b29-158">options de configuration Hello dans FeedOptions sont passées server toohello sous forme de hello d’en-têtes de demande.</span><span class="sxs-lookup"><span data-stu-id="25b29-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="25b29-159">Par exemple, `MaxItemCount` correspond trop`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="25b29-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="25b29-160">Hello demande retourne suivant hello (tronquées pour une meilleure lisibilité) réponse :</span><span class="sxs-lookup"><span data-stu-id="25b29-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="25b29-161">les en-têtes de réponse de la clé Hello renvoyés par la requête de hello hello suivants :</span><span class="sxs-lookup"><span data-stu-id="25b29-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="25b29-162">Option</span><span class="sxs-lookup"><span data-stu-id="25b29-162">Option</span></span> | <span data-ttu-id="25b29-163">Description</span><span class="sxs-lookup"><span data-stu-id="25b29-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="25b29-164">nombre de Hello d’éléments retournés dans la réponse de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="25b29-165">Cela dépend de hello fourni `x-ms-max-item-count`, hello le nombre d’éléments qui peuvent être contenues au sein de la taille de charge utile de réponse maximal hello, débit approvisionné de hello et exécution des requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="25b29-166">Hello continuation jeton tooresume l’exécution de requête hello, si des résultats supplémentaires sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="25b29-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="25b29-167">statistiques de requête Hello pour l’exécution de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="25b29-168">Il s’agit d’une chaîne délimitée qui contient des statistiques de temps passé dans hello différentes phases d’exécution de la requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="25b29-169">Retourné si `x-ms-documentdb-populatequerymetrics` est défini trop`True`.</span><span class="sxs-lookup"><span data-stu-id="25b29-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="25b29-170">Hello nombre de [unités de requête](request-units.md) consommés par requête de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="25b29-171">Pour plus d’informations sur les en-têtes de demande d’API REST hello et les options, consultez [interrogation des ressources à l’aide de hello API REST de DocumentDB](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="25b29-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="25b29-172">Meilleures pratiques pour les performances de requêtes</span><span class="sxs-lookup"><span data-stu-id="25b29-172">Best practices for query performance</span></span>
<span data-ttu-id="25b29-173">Hello Voici les facteurs courants hello ayant un impact sur les performances des requêtes de base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="25b29-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="25b29-174">Nous approfondissons chacune de ces rubriques dans cet article.</span><span class="sxs-lookup"><span data-stu-id="25b29-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="25b29-175">Facteur</span><span class="sxs-lookup"><span data-stu-id="25b29-175">Factor</span></span> | <span data-ttu-id="25b29-176">Conseil</span><span class="sxs-lookup"><span data-stu-id="25b29-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="25b29-177">Débit approvisionné</span><span class="sxs-lookup"><span data-stu-id="25b29-177">Provisioned throughput</span></span> | <span data-ttu-id="25b29-178">RU de mesures par requête et assurez-vous d’avoir un débit approvisionné hello requis pour vos requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="25b29-179">Partitionnement et clés de partition</span><span class="sxs-lookup"><span data-stu-id="25b29-179">Partitioning and partition keys</span></span> | <span data-ttu-id="25b29-180">Favoriser les requêtes avec la valeur de clé de partition hello dans la clause de filtre de hello pour une latence faible.</span><span class="sxs-lookup"><span data-stu-id="25b29-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="25b29-181">Options de requête et de kit SDK</span><span class="sxs-lookup"><span data-stu-id="25b29-181">SDK and query options</span></span> | <span data-ttu-id="25b29-182">Suivez les meilleures pratiques du kit SDK, comme la connectivité directe, et paramétrez les options d’exécution de requêtes du côté client.</span><span class="sxs-lookup"><span data-stu-id="25b29-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="25b29-183">Latence du réseau</span><span class="sxs-lookup"><span data-stu-id="25b29-183">Network latency</span></span> | <span data-ttu-id="25b29-184">Prendre en compte réseau temps de mesure et utiliser multihébergement tooread API à partir de hello plus proche de la région.</span><span class="sxs-lookup"><span data-stu-id="25b29-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="25b29-185">Stratégie d'indexation</span><span class="sxs-lookup"><span data-stu-id="25b29-185">Indexing Policy</span></span> | <span data-ttu-id="25b29-186">Assurez-vous que vous avez hello requis chemins d’accès/stratégie d’indexation pour la requête de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="25b29-187">Mesures d’exécution des requêtes</span><span class="sxs-lookup"><span data-stu-id="25b29-187">Query execution metrics</span></span> | <span data-ttu-id="25b29-188">Analyser hello requête d’exécution métriques tooidentify potentielle réécritures des formes de requêtes et de données.</span><span class="sxs-lookup"><span data-stu-id="25b29-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="25b29-189">Débit approvisionné</span><span class="sxs-lookup"><span data-stu-id="25b29-189">Provisioned throughput</span></span>
<span data-ttu-id="25b29-190">Cosmos DB vous permet de créer des conteneurs de données, chacun avec un débit réservé qui est exprimé en RU (unité de requête) par seconde.</span><span class="sxs-lookup"><span data-stu-id="25b29-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="25b29-191">Une lecture d’un document de 1 Ko est 1 ur et chaque opération (y compris les requêtes) est normalisé tooa nombre fixe d’unités réservées en fonction de sa complexité.</span><span class="sxs-lookup"><span data-stu-id="25b29-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="25b29-192">Par exemple, si vous avez 1000 RU/s configurées pour votre conteneur, et que vous avez une requête, telle que `SELECT * FROM c WHERE c.city = 'Seattle'` qui consomme 5 RU, vous pouvez alors effectuer (1000 RU/s) / (5 RU/requête) = 200 requêtes/s de ce genre de requête par seconde.</span><span class="sxs-lookup"><span data-stu-id="25b29-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="25b29-193">Si vous envoyez de plus de 200 requêtes/s, service de hello démarre débit maximal de demandes entrantes ci-dessus 200/s.</span><span class="sxs-lookup"><span data-stu-id="25b29-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="25b29-194">Hello kits de développement logiciel gèrent automatiquement cet incident en effectuant une interruption/nouvelle tentative, par conséquent, vous pouvez remarquer une latence plus élevée pour ces requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="25b29-195">Augmentation hello configuré débit toohello requis valeur améliore le débit et la latence de la requête.</span><span class="sxs-lookup"><span data-stu-id="25b29-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="25b29-196">toolearn en savoir plus sur les unités de demande, consultez [unités de requête](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="25b29-197">Partitionnement et clés de partition</span><span class="sxs-lookup"><span data-stu-id="25b29-197">Partitioning and partition keys</span></span>
<span data-ttu-id="25b29-198">Avec la base de données Azure Cosmos, en général, les requêtes effectuent dans hello suivant l’ordre, de la plus rapide/plus efficace tooslower/moins efficace.</span><span class="sxs-lookup"><span data-stu-id="25b29-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="25b29-199">GET sur une clé de partition unique et une clé d’élément</span><span class="sxs-lookup"><span data-stu-id="25b29-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="25b29-200">Requête avec une clause de filtre sur une clé de partition unique</span><span class="sxs-lookup"><span data-stu-id="25b29-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="25b29-201">Requête sans clause de filtre d’égalité ou de plage sur une propriété</span><span class="sxs-lookup"><span data-stu-id="25b29-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="25b29-202">Requête sans filtre</span><span class="sxs-lookup"><span data-stu-id="25b29-202">Query without filters</span></span>

<span data-ttu-id="25b29-203">Interroge ce tooconsult besoin une latence plus élevée toutes les partitions nécessaire et peut consommer RUs plus élevées.</span><span class="sxs-lookup"><span data-stu-id="25b29-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="25b29-204">Étant donné que chaque partition a l’indexation automatique contre toutes les propriétés, les requêtes hello peuvent être utilisée efficacement à partir de l’index de hello dans ce cas.</span><span class="sxs-lookup"><span data-stu-id="25b29-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="25b29-205">Vous pouvez effectuer des requêtes qui s’étendent sur des partitions plus rapides à l’aide des options de parallélisme hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="25b29-206">toolearn en savoir plus sur le partitionnement et les clés de partition, consultez [partitionnement dans la base de données Azure Cosmos](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="25b29-207">Options de requête et de kit SDK</span><span class="sxs-lookup"><span data-stu-id="25b29-207">SDK and query options</span></span>
<span data-ttu-id="25b29-208">Consultez [conseils relatifs aux performances](performance-tips.md) et [les tests de performances](performance-testing.md) pour comment tooget hello mieux les performances côté client à partir de la base de données Azure Cosmos.</span><span class="sxs-lookup"><span data-stu-id="25b29-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="25b29-209">Cela inclut l’utilisation hello dernière kits de développement logiciel, configuration des configurations spécifiques à une plateforme comme nombre de connexions, la fréquence de garbage collection, par défaut et à l’aide des options de connectivité léger comme Direct/TCP.</span><span class="sxs-lookup"><span data-stu-id="25b29-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="25b29-210">Nombre maximum d’éléments</span><span class="sxs-lookup"><span data-stu-id="25b29-210">Max Item Count</span></span>
<span data-ttu-id="25b29-211">Pour les requêtes, hello valeur `MaxItemCount` peut avoir un impact significatif sur le moment de la requête de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="25b29-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="25b29-212">Chaque aller-retour toohello server renvoie pas plus de nombre hello d’éléments de `MaxItemCount` (valeur par défaut de 100 éléments).</span><span class="sxs-lookup"><span data-stu-id="25b29-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="25b29-213">Une valeur plus élevée tooa (-1 est maximale et recommandée) améliore votre durée de requête globale en limitant hello nombre d’allers-retours entre le serveur et le client, en particulier pour les requêtes avec des jeux de résultats volumineux.</span><span class="sxs-lookup"><span data-stu-id="25b29-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="25b29-214">Degré maximal de parallélisme</span><span class="sxs-lookup"><span data-stu-id="25b29-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="25b29-215">Pour les requêtes, paramétrer hello `MaxDegreeOfParallelism` tooidentify hello les configurations pour votre application, en particulier si vous effectuez des requêtes entre partitions (sans un filtre sur la valeur de clé de partition hello).</span><span class="sxs-lookup"><span data-stu-id="25b29-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="25b29-216">`MaxDegreeOfParallelism`contrôle le nombre maximal hello de tâches en parallèle, c'est-à-dire hello maximum toobe partitions visité en parallèle.</span><span class="sxs-lookup"><span data-stu-id="25b29-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="25b29-217">Supposons que</span><span class="sxs-lookup"><span data-stu-id="25b29-217">Let’s assume that</span></span>
* <span data-ttu-id="25b29-218">D = nombre par défaut maximal de tâches parallèles (= nombre total de processeur d’ordinateur du client hello)</span><span class="sxs-lookup"><span data-stu-id="25b29-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="25b29-219">P = nombre maximal de tâches parallèles spécifié par l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="25b29-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="25b29-220">N = nombre de partitions doit toobe visité pour répondre à une requête</span><span class="sxs-lookup"><span data-stu-id="25b29-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="25b29-221">Voici les implications en matière de comportement des requêtes parallèles hello pour différentes valeurs de P.</span><span class="sxs-lookup"><span data-stu-id="25b29-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="25b29-222">(P == 0) = > Mode série</span><span class="sxs-lookup"><span data-stu-id="25b29-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="25b29-223">(P == 1) => Une tâche maximum</span><span class="sxs-lookup"><span data-stu-id="25b29-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="25b29-224">(P > 1) => Nombre minimum de tâches parallèles (P, N)</span><span class="sxs-lookup"><span data-stu-id="25b29-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="25b29-225">(P < 1) => Nombre minimum de tâches parallèles (N, D)</span><span class="sxs-lookup"><span data-stu-id="25b29-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="25b29-226">Pour obtenir les notes de publication des kits SDK et des renseignements complémentaires sur les classes et les méthodes implémentées, consultez [Kits SDK DocumentDB](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="25b29-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="25b29-227">Latence du réseau</span><span class="sxs-lookup"><span data-stu-id="25b29-227">Network latency</span></span>
<span data-ttu-id="25b29-228">Consultez [distribution globale de base de données Azure Cosmos](tutorial-global-distribution-documentdb.md) de tooset jusqu'à la distribution globale, puis se connecter à la région toohello le plus proche.</span><span class="sxs-lookup"><span data-stu-id="25b29-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="25b29-229">Latence du réseau a un impact significatif sur les performances des requêtes lorsque vous devez toomake plusieurs allers-retours ou récupérer un grand jeu de résultats de requête de hello.</span><span class="sxs-lookup"><span data-stu-id="25b29-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="25b29-230">Hello section sur les métriques d’exécution de requête explique comment tooretrieve hello heure d’exécution du serveur de requêtes ( `totalExecutionTimeInMs`), vous pouvez faire la différence entre le temps passé dans l’exécution des requêtes et des temps de transit du réseau.</span><span class="sxs-lookup"><span data-stu-id="25b29-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="25b29-231">Stratégie d’indexation</span><span class="sxs-lookup"><span data-stu-id="25b29-231">Indexing policy</span></span>
<span data-ttu-id="25b29-232">Consultez [Configuration de la stratégie d’indexation](indexing-policies.md) pour l’indexation de chemins, de types et de modes, ainsi que leur impact sur l’exécution des requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="25b29-233">Par défaut, hello stratégie d’indexation utilise une indexation de hachage pour les chaînes, ce qui est efficace pour les requêtes d’égalité, mais pas pour les requêtes de plage/order par les requêtes.</span><span class="sxs-lookup"><span data-stu-id="25b29-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="25b29-234">Si vous avez besoin des requêtes de plage pour les chaînes, nous recommandons de spécifier hello type d’index de plage pour toutes les chaînes.</span><span class="sxs-lookup"><span data-stu-id="25b29-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="25b29-235">Mesures d’exécution des requêtes</span><span class="sxs-lookup"><span data-stu-id="25b29-235">Query execution metrics</span></span>
<span data-ttu-id="25b29-236">Vous pouvez obtenir les métriques détaillées sur l’exécution des requêtes en passant hello facultatif `x-ms-documentdb-populatequerymetrics` en-tête (`FeedOptions.PopulateQueryMetrics` Bonjour .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="25b29-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="25b29-237">Hello la valeur retournée dans `x-ms-documentdb-query-metrics` a hello suivant des paires clé-valeur destinés à un dépannage de l’exécution de requêtes avancé.</span><span class="sxs-lookup"><span data-stu-id="25b29-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="25b29-238">Mesure</span><span class="sxs-lookup"><span data-stu-id="25b29-238">Metric</span></span> | <span data-ttu-id="25b29-239">Unité</span><span class="sxs-lookup"><span data-stu-id="25b29-239">Unit</span></span> | <span data-ttu-id="25b29-240">Description</span><span class="sxs-lookup"><span data-stu-id="25b29-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="25b29-241">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-241">milliseconds</span></span> | <span data-ttu-id="25b29-242">Durée d’exécution de la requête</span><span class="sxs-lookup"><span data-stu-id="25b29-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="25b29-243">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-243">milliseconds</span></span> | <span data-ttu-id="25b29-244">Durée de compilation de la requête</span><span class="sxs-lookup"><span data-stu-id="25b29-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="25b29-245">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-245">milliseconds</span></span> | <span data-ttu-id="25b29-246">Plan de requête logique toobuild de temps</span><span class="sxs-lookup"><span data-stu-id="25b29-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="25b29-247">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-247">milliseconds</span></span> | <span data-ttu-id="25b29-248">Plan de requête physique toobuild de temps</span><span class="sxs-lookup"><span data-stu-id="25b29-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="25b29-249">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-249">milliseconds</span></span> | <span data-ttu-id="25b29-250">Temps consacré à l’optimisation de la requête</span><span class="sxs-lookup"><span data-stu-id="25b29-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="25b29-251">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-251">milliseconds</span></span> | <span data-ttu-id="25b29-252">Temps passé dans l’exécution de la requête</span><span class="sxs-lookup"><span data-stu-id="25b29-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="25b29-253">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-253">milliseconds</span></span> | <span data-ttu-id="25b29-254">Temps passé dans la couche de l’index physique</span><span class="sxs-lookup"><span data-stu-id="25b29-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="25b29-255">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-255">milliseconds</span></span> | <span data-ttu-id="25b29-256">Temps de chargement de documents</span><span class="sxs-lookup"><span data-stu-id="25b29-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="25b29-257">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-257">milliseconds</span></span> | <span data-ttu-id="25b29-258">Temps total consacré à l’exécution de fonctions (intégrées) système, en millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="25b29-259">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-259">milliseconds</span></span> | <span data-ttu-id="25b29-260">Temps total consacré à l’exécution de fonctions définies par l’utilisateur, en millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="25b29-261">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-261">milliseconds</span></span> | <span data-ttu-id="25b29-262">Nombre total de documents récupérés</span><span class="sxs-lookup"><span data-stu-id="25b29-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="25b29-263">octets</span><span class="sxs-lookup"><span data-stu-id="25b29-263">bytes</span></span> | <span data-ttu-id="25b29-264">Taille totale des documents récupérés, en octets</span><span class="sxs-lookup"><span data-stu-id="25b29-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="25b29-265">count</span><span class="sxs-lookup"><span data-stu-id="25b29-265">count</span></span> | <span data-ttu-id="25b29-266">Nombre de documents sortants</span><span class="sxs-lookup"><span data-stu-id="25b29-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="25b29-267">millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-267">milliseconds</span></span> | <span data-ttu-id="25b29-268">Durée moyenne d’exécution de la requête, en millisecondes</span><span class="sxs-lookup"><span data-stu-id="25b29-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="25b29-269">ratio (< = 1)</span><span class="sxs-lookup"><span data-stu-id="25b29-269">ratio (<=1)</span></span> | <span data-ttu-id="25b29-270">Ratio du nombre de documents mis en correspondance par le nombre de toohello hello filtre des documents chargés</span><span class="sxs-lookup"><span data-stu-id="25b29-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="25b29-271">Hello client SDK peut en interne rendre plusieurs requêtes opérations tooserve hello requête dans chaque partition.</span><span class="sxs-lookup"><span data-stu-id="25b29-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="25b29-272">client de Hello effectue plusieurs appels par partition si les résultats total hello dépassent `x-ms-max-item-count`, si la requête de hello dépasse le débit approvisionné de hello pour les partitions hello, ou si hello charge utile de requête atteint la taille maximale de hello par page si hello requête atteint hello système allouée limite de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="25b29-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="25b29-273">Chaque exécution de requête partielle retourne un `x-ms-documentdb-query-metrics` pour cette page.</span><span class="sxs-lookup"><span data-stu-id="25b29-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="25b29-274">Voici quelques exemples de requêtes et comment toointerpret des métriques de hello retournés à partir de l’exécution de la requête :</span><span class="sxs-lookup"><span data-stu-id="25b29-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="25b29-275">Interroger</span><span class="sxs-lookup"><span data-stu-id="25b29-275">Query</span></span> | <span data-ttu-id="25b29-276">Exemples de mesures</span><span class="sxs-lookup"><span data-stu-id="25b29-276">Sample Metric</span></span> | <span data-ttu-id="25b29-277">Description</span><span class="sxs-lookup"><span data-stu-id="25b29-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="25b29-278">Hello nombre de documents récupérés est 100 + 1 toomatch hello mot clé TOP.</span><span class="sxs-lookup"><span data-stu-id="25b29-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="25b29-279">Le temps de la requête est essentiellement consacré à `WriteOutputTime` et `DocumentLoadTime` puisqu’il s’agit d’une analyse.</span><span class="sxs-lookup"><span data-stu-id="25b29-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="25b29-280">RetrievedDocumentCount est désormais plus élevé (500 + 1 toomatch hello clause TOP).</span><span class="sxs-lookup"><span data-stu-id="25b29-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="25b29-281">Environ 0,9 ms est passé dans IndexLookupTime pour une recherche de clé, car c’est une recherche d’index sur `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="25b29-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="25b29-282">Légèrement plus de temps (1,7 ms) est passé dans IndexLookupTime sur une analyse de plage, car c’est une recherche d’index sur `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="25b29-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="25b29-283">Même temps passé sur `DocumentLoadTime` que sur les requêtes précédentes, mais `WriteOutputTime` est inférieur, car nous ne projetons qu’une seule propriété.</span><span class="sxs-lookup"><span data-stu-id="25b29-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="25b29-284">Environ 213 ms est consacré à `UserDefinedFunctionExecutionTime` l’exécution de hello UDF sur chaque valeur de `c.N`.</span><span class="sxs-lookup"><span data-stu-id="25b29-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="25b29-285">Environ 0,6 ms est consacré à `IndexLookupTime` sur `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="25b29-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="25b29-286">La plupart des hello interroger le temps d’exécution (ms ~ 7) dans `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="25b29-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="25b29-287">La requête est exécutée en tant qu’analyse, car elle utilise `LOWER`, et 500 documents sur les 2491 récupérés sont retournés.</span><span class="sxs-lookup"><span data-stu-id="25b29-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="25b29-288">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="25b29-288">Next steps</span></span>
* <span data-ttu-id="25b29-289">toolearn sur hello pris en charge les opérateurs de requête SQL et les mots clés, consultez [requête SQL](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="25b29-290">toolearn sur les unités de demande, consultez [unités de requête](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="25b29-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="25b29-291">toolearn sur la stratégie d’indexation, consultez [stratégie d’indexation](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="25b29-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 


