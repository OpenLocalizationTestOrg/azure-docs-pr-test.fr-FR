---
title: "journaux d’Application Insight aaaAnalyze avec Spark - Azure HDInsight | Documents Microsoft"
description: "Découvrez comment tooexport Application Insight consigne tooblob stockage et ensuite d’analyser les journaux hello avec Spark sur HDInsight."
services: hdinsight
documentationcenter: 
author: Blackmist
manager: jhubbard
editor: cgronlun
ms.assetid: 883beae6-9839-45b5-94f7-7eb0f4534ad5
ms.service: hdinsight
ms.custom: hdinsightactive
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 08/15/2017
ms.author: larryfr
ms.openlocfilehash: 11ed8cf68dba8d5f9d6e4a65eba0d2b5a950cd00
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="analyze-application-insights-telemetry-logs-with-spark-on-hdinsight"></a><span data-ttu-id="02375-103">Analyser les journaux de télémétrie Application Insights avec Spark sur HDInsight</span><span class="sxs-lookup"><span data-stu-id="02375-103">Analyze Application Insights telemetry logs with Spark on HDInsight</span></span>

<span data-ttu-id="02375-104">Découvrez comment toouse nouvelles sur HDInsight tooanalyze les données de télémétrie Application Insight.</span><span class="sxs-lookup"><span data-stu-id="02375-104">Learn how toouse Spark on HDInsight tooanalyze Application Insight telemetry data.</span></span>

<span data-ttu-id="02375-105">[Visual Studio Application Insights](../application-insights/app-insights-overview.md) est un service d’analyse qui surveille vos applications web.</span><span class="sxs-lookup"><span data-stu-id="02375-105">[Visual Studio Application Insights](../application-insights/app-insights-overview.md) is an analytics service that monitors your web applications.</span></span> <span data-ttu-id="02375-106">Les données de télémétrie générées par Application Insights peuvent être exporté tooAzure de stockage.</span><span class="sxs-lookup"><span data-stu-id="02375-106">Telemetry data generated by Application Insights can be exported tooAzure Storage.</span></span> <span data-ttu-id="02375-107">Une fois les données de salutation dans le stockage Azure, HDInsight peut être utilisé tooanalyze il.</span><span class="sxs-lookup"><span data-stu-id="02375-107">Once hello data is in Azure Storage, HDInsight can be used tooanalyze it.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="02375-108">Composants requis</span><span class="sxs-lookup"><span data-stu-id="02375-108">Prerequisites</span></span>

* <span data-ttu-id="02375-109">Une application qui est configuré toouse Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-109">An application that is configured toouse Application Insights.</span></span>

* <span data-ttu-id="02375-110">Maîtrise de la création d’un cluster HDInsight sous Linux.</span><span class="sxs-lookup"><span data-stu-id="02375-110">Familiarity with creating a Linux-based HDInsight cluster.</span></span> <span data-ttu-id="02375-111">Pour plus d’informations, consultez la rubrique [Création de Spark sur HDInsight](hdinsight-apache-spark-jupyter-spark-sql.md).</span><span class="sxs-lookup"><span data-stu-id="02375-111">For more information, see [Create Spark on HDInsight](hdinsight-apache-spark-jupyter-spark-sql.md).</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="02375-112">étapes de Hello dans ce document nécessitent un cluster HDInsight qui utilise Linux.</span><span class="sxs-lookup"><span data-stu-id="02375-112">hello steps in this document require an HDInsight cluster that uses Linux.</span></span> <span data-ttu-id="02375-113">Linux est hello seul système d’exploitation utilisé sur HDInsight version 3.4 ou supérieure.</span><span class="sxs-lookup"><span data-stu-id="02375-113">Linux is hello only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="02375-114">Pour plus d’informations, consultez [Suppression de HDInsight sous Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span><span class="sxs-lookup"><span data-stu-id="02375-114">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span>

* <span data-ttu-id="02375-115">Un navigateur Web.</span><span class="sxs-lookup"><span data-stu-id="02375-115">A web browser.</span></span>

<span data-ttu-id="02375-116">Hello ressources suivantes ont été utilisés dans le développement et le test de ce document :</span><span class="sxs-lookup"><span data-stu-id="02375-116">hello following resources were used in developing and testing this document:</span></span>

* <span data-ttu-id="02375-117">Données de télémétrie application Insights a été générées à l’aide un [application web Node.js configuré toouse Application Insights](../application-insights/app-insights-nodejs.md).</span><span class="sxs-lookup"><span data-stu-id="02375-117">Application Insights telemetry data was generated using a [Node.js web app configured toouse Application Insights](../application-insights/app-insights-nodejs.md).</span></span>

* <span data-ttu-id="02375-118">Un Spark basés sur Linux sur la version 3.5 du cluster HDInsight a été utilisé tooanalyze hello données.</span><span class="sxs-lookup"><span data-stu-id="02375-118">A Linux-based Spark on HDInsight cluster version 3.5 was used tooanalyze hello data.</span></span>

## <a name="architecture-and-planning"></a><span data-ttu-id="02375-119">Architecture et planification</span><span class="sxs-lookup"><span data-stu-id="02375-119">Architecture and planning</span></span>

<span data-ttu-id="02375-120">Hello suivant le diagramme illustre l’architecture du service de cet exemple hello :</span><span class="sxs-lookup"><span data-stu-id="02375-120">hello following diagram illustrates hello service architecture of this example:</span></span>

![diagramme montrant les données circulent à partir du stockage de tooblob Application Insights, puis traitées par Spark sur HDInsight](./media/hdinsight-spark-analyze-application-insight-logs/appinsightshdinsight.png)

### <a name="azure-storage"></a><span data-ttu-id="02375-122">Stockage Azure</span><span class="sxs-lookup"><span data-stu-id="02375-122">Azure storage</span></span>

<span data-ttu-id="02375-123">Application Insights peuvent être configuré toocontinuously exportation télémétrie informations tooblobs.</span><span class="sxs-lookup"><span data-stu-id="02375-123">Application Insights can be configured toocontinuously export telemetry information tooblobs.</span></span> <span data-ttu-id="02375-124">HDInsight peut ensuite lire les données stockées dans des objets BLOB de hello.</span><span class="sxs-lookup"><span data-stu-id="02375-124">HDInsight can then read data stored in hello blobs.</span></span> <span data-ttu-id="02375-125">Toutefois, il existe certaines conditions que vous devez remplir :</span><span class="sxs-lookup"><span data-stu-id="02375-125">However, there are some requirements that you must follow:</span></span>

* <span data-ttu-id="02375-126">**Emplacement**: si hello compte de stockage et HDInsight se trouvent dans différents emplacements, il peut augmenter la latence.</span><span class="sxs-lookup"><span data-stu-id="02375-126">**Location**: If hello Storage Account and HDInsight are in different locations, it may increase latency.</span></span> <span data-ttu-id="02375-127">Elle augmente également coût, comme les frais de sortie sont appliqué toodata déplacement entre les régions.</span><span class="sxs-lookup"><span data-stu-id="02375-127">It also increases cost, as egress charges are applied toodata moving between regions.</span></span>

    > [!WARNING]
    > <span data-ttu-id="02375-128">L’utilisation d’un compte de stockage dans un emplacement autre que HDInsight n’est pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="02375-128">Using a Storage Account in a different location than HDInsight is not supported.</span></span>

* <span data-ttu-id="02375-129">**Type d’objet blob** : HDInsight prend uniquement en charge les objets blob de blocs.</span><span class="sxs-lookup"><span data-stu-id="02375-129">**Blob type**: HDInsight only supports block blobs.</span></span> <span data-ttu-id="02375-130">Par défaut, application Insights toousing objets BLOB de blocs, donc doit fonctionner par défaut avec HDInsight.</span><span class="sxs-lookup"><span data-stu-id="02375-130">Application Insights defaults toousing block blobs, so should work by default with HDInsight.</span></span>

<span data-ttu-id="02375-131">Pour plus d’informations sur l’ajout de tooan de stockage supplémentaire existante du cluster HDInsight, consultez hello [ajouter des comptes de stockage supplémentaires](hdinsight-hadoop-add-storage.md) document.</span><span class="sxs-lookup"><span data-stu-id="02375-131">For information on adding additional storage tooan existing HDInsight cluster, see hello [Add additional storage accounts](hdinsight-hadoop-add-storage.md) document.</span></span>

### <a name="data-schema"></a><span data-ttu-id="02375-132">Schéma de données</span><span class="sxs-lookup"><span data-stu-id="02375-132">Data schema</span></span>

<span data-ttu-id="02375-133">Application Insights fournit [exporter le modèle de données](../application-insights/app-insights-export-data-model.md) les informations de format de données de télémétrie hello exportées tooblobs.</span><span class="sxs-lookup"><span data-stu-id="02375-133">Application Insights provides [export data model](../application-insights/app-insights-export-data-model.md) information for hello telemetry data format exported tooblobs.</span></span> <span data-ttu-id="02375-134">étapes Hello dans ce document utilisent Spark SQL toowork avec les données de salutation.</span><span class="sxs-lookup"><span data-stu-id="02375-134">hello steps in this document use Spark SQL toowork with hello data.</span></span> <span data-ttu-id="02375-135">Spark SQL peut générer automatiquement un schéma pour la structure de données JSON hello enregistré par l’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-135">Spark SQL can automatically generate a schema for hello JSON data structure logged by Application Insights.</span></span>

## <a name="export-telemetry-data"></a><span data-ttu-id="02375-136">Exporter les données de télémétrie</span><span class="sxs-lookup"><span data-stu-id="02375-136">Export telemetry data</span></span>

<span data-ttu-id="02375-137">Suivez les étapes de hello dans [configurer l’exportation continue](../application-insights/app-insights-export-telemetry.md) tooconfigure votre tooan informations de télémétrie Application Insights tooexport stockage Azure d’objets blob.</span><span class="sxs-lookup"><span data-stu-id="02375-137">Follow hello steps in [Configure Continuous Export](../application-insights/app-insights-export-telemetry.md) tooconfigure your Application Insights tooexport telemetry information tooan Azure storage blob.</span></span>

## <a name="configure-hdinsight-tooaccess-hello-data"></a><span data-ttu-id="02375-138">Configurer les données de salutation tooaccess HDInsight</span><span class="sxs-lookup"><span data-stu-id="02375-138">Configure HDInsight tooaccess hello data</span></span>

<span data-ttu-id="02375-139">Si vous créez un cluster HDInsight, ajoutez le compte de stockage hello lors de la création du cluster.</span><span class="sxs-lookup"><span data-stu-id="02375-139">If you are creating an HDInsight cluster, add hello storage account during cluster creation.</span></span>

<span data-ttu-id="02375-140">tooadd hello cluster existant tooan de compte de stockage Azure, utilisez les informations de hello Bonjour [ajouter des comptes de stockage supplémentaires](hdinsight-hadoop-add-storage.md) document.</span><span class="sxs-lookup"><span data-stu-id="02375-140">tooadd hello Azure Storage Account tooan existing cluster, use hello information in hello [Add additional Storage Accounts](hdinsight-hadoop-add-storage.md) document.</span></span>

## <a name="analyze-hello-data-pyspark"></a><span data-ttu-id="02375-141">Analyser les données de salutation : PySpark</span><span class="sxs-lookup"><span data-stu-id="02375-141">Analyze hello data: PySpark</span></span>

1. <span data-ttu-id="02375-142">À partir de hello [portail Azure](https://portal.azure.com), sélectionnez votre Spark sur le cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="02375-142">From hello [Azure portal](https://portal.azure.com), select your Spark on HDInsight cluster.</span></span> <span data-ttu-id="02375-143">À partir de hello **liens rapides** section, sélectionnez **tableaux de bord de Cluster**, puis sélectionnez **bloc-notes Jupyter** à partir du Panneau de Cluster Dashboard__ hello.</span><span class="sxs-lookup"><span data-stu-id="02375-143">From hello **Quick Links** section, select **Cluster Dashboards**, and then select **Jupyter Notebook** from hello Cluster Dashboard__ blade.</span></span>

    ![tableaux de bord de cluster Hello](./media/hdinsight-spark-analyze-application-insight-logs/clusterdashboards.png)

2. <span data-ttu-id="02375-145">Dans hello coin supérieur droit de la page de Notebook hello, sélectionnez **nouveau**, puis **PySpark**.</span><span class="sxs-lookup"><span data-stu-id="02375-145">In hello upper right corner of hello Jupyter page, select **New**, and then **PySpark**.</span></span> <span data-ttu-id="02375-146">Un nouvel onglet de navigateur s’ouvre, contenant un notebook Jupyter basé sur Python.</span><span class="sxs-lookup"><span data-stu-id="02375-146">A new browser tab containing a Python-based Jupyter Notebook opens.</span></span>

3. <span data-ttu-id="02375-147">Dans le premier champ de hello (appelé un **cellule**) sur la page de hello, entrez hello suivant du texte :</span><span class="sxs-lookup"><span data-stu-id="02375-147">In hello first field (called a **cell**) on hello page, enter hello following text:</span></span>

   ```python
   sc._jsc.hadoopConfiguration().set('mapreduce.input.fileinputformat.input.dir.recursive', 'true')
   ```

    <span data-ttu-id="02375-148">Ce code configure Spark toorecursively accès hello structure de répertoire pour les données d’entrée hello.</span><span class="sxs-lookup"><span data-stu-id="02375-148">This code configures Spark toorecursively access hello directory structure for hello input data.</span></span> <span data-ttu-id="02375-149">Télémétrie application Insights est connecté tooa directory structure similaire toohello `/{telemetry type}/YYYY-MM-DD/{##}/`.</span><span class="sxs-lookup"><span data-stu-id="02375-149">Application Insights telemetry is logged tooa directory structure similar toohello `/{telemetry type}/YYYY-MM-DD/{##}/`.</span></span>

4. <span data-ttu-id="02375-150">Utilisez **MAJ + ENTRÉE** code hello de toorun.</span><span class="sxs-lookup"><span data-stu-id="02375-150">Use **SHIFT+ENTER** toorun hello code.</span></span> <span data-ttu-id="02375-151">Sur hello à gauche de la cellule de hello, un «\*» s’affiche entre hello crochets tooindicate que code hello dans cette cellule est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="02375-151">On hello left side of hello cell, an '\*' appears between hello brackets tooindicate that hello code in this cell is being executed.</span></span> <span data-ttu-id="02375-152">Une fois qu’il se termine, hello '\*' modifie tooa nombre et la sortie similaire toohello suit texte s’affiche sous la cellule de hello :</span><span class="sxs-lookup"><span data-stu-id="02375-152">Once it completes, hello '\*' changes tooa number, and output similar toohello following text is displayed below hello cell:</span></span>

        Creating SparkContext as 'sc'

        ID    YARN Application ID    Kind    State    Spark UI    Driver log    Current session?
        3    application_1468969497124_0001    pyspark    idle    Link    Link    ✔

        Creating HiveContext as 'sqlContext'
        SparkContext and HiveContext created. Executing user code ...
5. <span data-ttu-id="02375-153">Une nouvelle cellule est créée sous hello tout d’abord un.</span><span class="sxs-lookup"><span data-stu-id="02375-153">A new cell is created below hello first one.</span></span> <span data-ttu-id="02375-154">Entrez hello après le texte dans la nouvelle cellule de hello.</span><span class="sxs-lookup"><span data-stu-id="02375-154">Enter hello following text in hello new cell.</span></span> <span data-ttu-id="02375-155">Remplacez `CONTAINER` et `STORAGEACCOUNT` avec le nom de compte de stockage Windows Azure hello et le nom de conteneur qui contient les données d’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-155">Replace `CONTAINER` and `STORAGEACCOUNT` with hello Azure storage account name and blob container name that contains Application Insights data.</span></span>

   ```python
   %%bash
   hdfs dfs -ls wasb://CONTAINER@STORAGEACCOUNT.blob.core.windows.net/
   ```

    <span data-ttu-id="02375-156">Utilisez **MAJ + ENTRÉE** tooexecute cette cellule.</span><span class="sxs-lookup"><span data-stu-id="02375-156">Use **SHIFT+ENTER** tooexecute this cell.</span></span> <span data-ttu-id="02375-157">Vous voyez un toohello similaire de résultat suivant de texte :</span><span class="sxs-lookup"><span data-stu-id="02375-157">You see a result similar toohello following text:</span></span>

        Found 1 items
        drwxrwxrwx   -          0 1970-01-01 00:00 wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_2bededa61bc741fbdee6b556571a4831

    <span data-ttu-id="02375-158">chemin d’accès de wasb Hello retourné est un emplacement hello Hello les données de télémétrie Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-158">hello wasb path returned is hello location of hello Application Insights telemetry data.</span></span> <span data-ttu-id="02375-159">Hello de modification `hdfs dfs -ls` hello cellule toouse hello wasb chemin d’accès retourné de ligne, puis utilisez **MAJ + ENTRÉE** cellule de hello toorun à nouveau.</span><span class="sxs-lookup"><span data-stu-id="02375-159">Change hello `hdfs dfs -ls` line in hello cell toouse hello wasb path returned, and then use **SHIFT+ENTER** toorun hello cell again.</span></span> <span data-ttu-id="02375-160">Ce temps, les résultats hello doivent afficher les répertoires hello qui contiennent des données de télémétrie.</span><span class="sxs-lookup"><span data-stu-id="02375-160">This time, hello results should display hello directories that contain telemetry data.</span></span>

   > [!NOTE]
   > <span data-ttu-id="02375-161">Les étapes de cette section reste hello Hello, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` active a été utilisée.</span><span class="sxs-lookup"><span data-stu-id="02375-161">For hello remainder of hello steps in this section, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` directory was used.</span></span> <span data-ttu-id="02375-162">Votre structure de répertoires peut être différente.</span><span class="sxs-lookup"><span data-stu-id="02375-162">Your directory structure may be different.</span></span>

6. <span data-ttu-id="02375-163">Dans la cellule suivante de hello, entrez hello suivant code : Remplacez `WASB_PATH` avec chemin d’accès de hello à partir de l’étape précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="02375-163">In hello next cell, enter hello following code: Replace `WASB_PATH` with hello path from hello previous step.</span></span>

   ```python
   jsonFiles = sc.textFile('WASB_PATH')
   jsonData = sqlContext.read.json(jsonFiles)
   ```

    <span data-ttu-id="02375-164">Ce code crée une trame de données à partir des fichiers JSON hello exportées par le processus d’exportation continue hello.</span><span class="sxs-lookup"><span data-stu-id="02375-164">This code creates a dataframe from hello JSON files exported by hello continuous export process.</span></span> <span data-ttu-id="02375-165">Utilisez **MAJ + ENTRÉE** toorun cette cellule.</span><span class="sxs-lookup"><span data-stu-id="02375-165">Use **SHIFT+ENTER** toorun this cell.</span></span>
7. <span data-ttu-id="02375-166">Dans la cellule suivante de hello, entrez et exécutez hello suivant schéma hello tooview Spark créé pour les fichiers JSON hello :</span><span class="sxs-lookup"><span data-stu-id="02375-166">In hello next cell, enter and run hello following tooview hello schema that Spark created for hello JSON files:</span></span>

   ```python
   jsonData.printSchema()
   ```

    <span data-ttu-id="02375-167">schéma Hello pour chaque type de données de télémétrie est différent.</span><span class="sxs-lookup"><span data-stu-id="02375-167">hello schema for each type of telemetry is different.</span></span> <span data-ttu-id="02375-168">exemple Hello est hello de schéma est généré pour les demandes web (les données stockées dans hello `Requests` sous-répertoire) :</span><span class="sxs-lookup"><span data-stu-id="02375-168">hello following example is hello schema that is generated for web requests (data stored in hello `Requests` subdirectory):</span></span>

        root
        |-- context: struct (nullable = true)
        |    |-- application: struct (nullable = true)
        |    |    |-- version: string (nullable = true)
        |    |-- custom: struct (nullable = true)
        |    |    |-- dimensions: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |    |-- metrics: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- eventTime: string (nullable = true)
        |    |    |-- isSynthetic: boolean (nullable = true)
        |    |    |-- samplingRate: double (nullable = true)
        |    |    |-- syntheticSource: string (nullable = true)
        |    |-- device: struct (nullable = true)
        |    |    |-- browser: string (nullable = true)
        |    |    |-- browserVersion: string (nullable = true)
        |    |    |-- deviceModel: string (nullable = true)
        |    |    |-- deviceName: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- osVersion: string (nullable = true)
        |    |    |-- type: string (nullable = true)
        |    |-- location: struct (nullable = true)
        |    |    |-- city: string (nullable = true)
        |    |    |-- clientip: string (nullable = true)
        |    |    |-- continent: string (nullable = true)
        |    |    |-- country: string (nullable = true)
        |    |    |-- province: string (nullable = true)
        |    |-- operation: struct (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |-- session: struct (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- isFirst: boolean (nullable = true)
        |    |-- user: struct (nullable = true)
        |    |    |-- anonId: string (nullable = true)
        |    |    |-- isAuthenticated: boolean (nullable = true)
        |-- internal: struct (nullable = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- documentVersion: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |-- request: array (nullable = true)
        |    |-- element: struct (containsNull = true)
        |    |    |-- count: long (nullable = true)
        |    |    |-- durationMetric: struct (nullable = true)
        |    |    |    |-- count: double (nullable = true)
        |    |    |    |-- max: double (nullable = true)
        |    |    |    |-- min: double (nullable = true)
        |    |    |    |-- sampledValue: double (nullable = true)
        |    |    |    |-- stdDev: double (nullable = true)
        |    |    |    |-- value: double (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |    |-- responseCode: long (nullable = true)
        |    |    |-- success: boolean (nullable = true)
        |    |    |-- url: string (nullable = true)
        |    |    |-- urlData: struct (nullable = true)
        |    |    |    |-- base: string (nullable = true)
        |    |    |    |-- hashTag: string (nullable = true)
        |    |    |    |-- host: string (nullable = true)
        |    |    |    |-- protocol: string (nullable = true)
8. <span data-ttu-id="02375-169">Utilisez hello suivant tooregister hello trame de données comme une table temporaire et exécuter une requête sur les données de salutation :</span><span class="sxs-lookup"><span data-stu-id="02375-169">Use hello following tooregister hello dataframe as a temporary table and run a query against hello data:</span></span>

   ```python
   jsonData.registerTempTable("requests")
   df = sqlContext.sql("select context.location.city from requests where context.location.city is not null")
   df.show()
   ```

    <span data-ttu-id="02375-170">Cette requête retourne des informations de ville hello pour les premiers enregistrements de 20 hello où context.location.city n’est pas null.</span><span class="sxs-lookup"><span data-stu-id="02375-170">This query returns hello city information for hello top 20 records where context.location.city is not null.</span></span>

   > [!NOTE]
   > <span data-ttu-id="02375-171">structure de contexte Hello est présente dans toutes les données de télémétrie enregistrées par l’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-171">hello context structure is present in all telemetry logged by Application Insights.</span></span> <span data-ttu-id="02375-172">élément de ville Hello ne peut-être pas être rempli dans vos journaux.</span><span class="sxs-lookup"><span data-stu-id="02375-172">hello city element may not be populated in your logs.</span></span> <span data-ttu-id="02375-173">Utilisez hello schéma tooidentify autres éléments que vous pouvez interroger peuvent contenir des données de vos journaux.</span><span class="sxs-lookup"><span data-stu-id="02375-173">Use hello schema tooidentify other elements that you can query that may contain data for your logs.</span></span>

    <span data-ttu-id="02375-174">Cette requête retourne toohello similaire à informations suivant le texte :</span><span class="sxs-lookup"><span data-stu-id="02375-174">This query returns information similar toohello following text:</span></span>

        +---------+
        |     city|
        +---------+
        | Bellevue|
        |  Redmond|
        |  Seattle|
        |Charlotte|
        ...
        +---------+

## <a name="analyze-hello-data-scala"></a><span data-ttu-id="02375-175">Analyser les données de salutation : Scala</span><span class="sxs-lookup"><span data-stu-id="02375-175">Analyze hello data: Scala</span></span>

1. <span data-ttu-id="02375-176">À partir de hello [portail Azure](https://portal.azure.com), sélectionnez votre Spark sur le cluster HDInsight.</span><span class="sxs-lookup"><span data-stu-id="02375-176">From hello [Azure portal](https://portal.azure.com), select your Spark on HDInsight cluster.</span></span> <span data-ttu-id="02375-177">À partir de hello **liens rapides** section, sélectionnez **tableaux de bord de Cluster**, puis sélectionnez **bloc-notes Jupyter** à partir du Panneau de Cluster Dashboard__ hello.</span><span class="sxs-lookup"><span data-stu-id="02375-177">From hello **Quick Links** section, select **Cluster Dashboards**, and then select **Jupyter Notebook** from hello Cluster Dashboard__ blade.</span></span>

    ![tableaux de bord de cluster Hello](./media/hdinsight-spark-analyze-application-insight-logs/clusterdashboards.png)
2. <span data-ttu-id="02375-179">Dans hello coin supérieur droit de la page de Notebook hello, sélectionnez **nouveau**, puis **Scala**.</span><span class="sxs-lookup"><span data-stu-id="02375-179">In hello upper right corner of hello Jupyter page, select **New**, and then **Scala**.</span></span> <span data-ttu-id="02375-180">Un nouvel onglet de navigateur s’ouvre, contenant un bloc-notes Jupyter basé sur Scala.</span><span class="sxs-lookup"><span data-stu-id="02375-180">A new browser tab containing a Scala-based Jupyter Notebook appears.</span></span>
3. <span data-ttu-id="02375-181">Dans le premier champ de hello (appelé un **cellule**) sur la page de hello, entrez hello suivant du texte :</span><span class="sxs-lookup"><span data-stu-id="02375-181">In hello first field (called a **cell**) on hello page, enter hello following text:</span></span>

   ```scala
   sc.hadoopConfiguration.set("mapreduce.input.fileinputformat.input.dir.recursive", "true")
   ```

    <span data-ttu-id="02375-182">Ce code configure Spark toorecursively accès hello structure de répertoire pour les données d’entrée hello.</span><span class="sxs-lookup"><span data-stu-id="02375-182">This code configures Spark toorecursively access hello directory structure for hello input data.</span></span> <span data-ttu-id="02375-183">Application Insights la télémétrie est ouvert une structure de répertoires tooa similaire`/{telemetry type}/YYYY-MM-DD/{##}/`.</span><span class="sxs-lookup"><span data-stu-id="02375-183">Application Insights telemetry is logged tooa directory structure similar too`/{telemetry type}/YYYY-MM-DD/{##}/`.</span></span>

4. <span data-ttu-id="02375-184">Utilisez **MAJ + ENTRÉE** code hello de toorun.</span><span class="sxs-lookup"><span data-stu-id="02375-184">Use **SHIFT+ENTER** toorun hello code.</span></span> <span data-ttu-id="02375-185">Sur hello à gauche de la cellule de hello, un «\*» s’affiche entre hello crochets tooindicate que code hello dans cette cellule est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="02375-185">On hello left side of hello cell, an '\*' appears between hello brackets tooindicate that hello code in this cell is being executed.</span></span> <span data-ttu-id="02375-186">Une fois qu’il se termine, hello '\*' modifie tooa nombre et la sortie similaire toohello suit texte s’affiche sous la cellule de hello :</span><span class="sxs-lookup"><span data-stu-id="02375-186">Once it completes, hello '\*' changes tooa number, and output similar toohello following text is displayed below hello cell:</span></span>

        Creating SparkContext as 'sc'

        ID    YARN Application ID    Kind    State    Spark UI    Driver log    Current session?
        3    application_1468969497124_0001    spark    idle    Link    Link    ✔

        Creating HiveContext as 'sqlContext'
        SparkContext and HiveContext created. Executing user code ...
5. <span data-ttu-id="02375-187">Une nouvelle cellule est créée sous hello tout d’abord un.</span><span class="sxs-lookup"><span data-stu-id="02375-187">A new cell is created below hello first one.</span></span> <span data-ttu-id="02375-188">Entrez hello après le texte dans la nouvelle cellule de hello.</span><span class="sxs-lookup"><span data-stu-id="02375-188">Enter hello following text in hello new cell.</span></span> <span data-ttu-id="02375-189">Remplacez `CONTAINER` et `STORAGEACCOUNT` avec le nom de compte de stockage Windows Azure hello et le nom de conteneur qui contient l’Application Insights se connecte.</span><span class="sxs-lookup"><span data-stu-id="02375-189">Replace `CONTAINER` and `STORAGEACCOUNT` with hello Azure storage account name and blob container name that contains Application Insights logs.</span></span>

   ```scala
   %%bash
   hdfs dfs -ls wasb://CONTAINER@STORAGEACCOUNT.blob.core.windows.net/
   ```

    <span data-ttu-id="02375-190">Utilisez **MAJ + ENTRÉE** tooexecute cette cellule.</span><span class="sxs-lookup"><span data-stu-id="02375-190">Use **SHIFT+ENTER** tooexecute this cell.</span></span> <span data-ttu-id="02375-191">Vous voyez un toohello similaire de résultat suivant de texte :</span><span class="sxs-lookup"><span data-stu-id="02375-191">You see a result similar toohello following text:</span></span>

        Found 1 items
        drwxrwxrwx   -          0 1970-01-01 00:00 wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_2bededa61bc741fbdee6b556571a4831

    <span data-ttu-id="02375-192">chemin d’accès de wasb Hello retourné est un emplacement hello Hello les données de télémétrie Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-192">hello wasb path returned is hello location of hello Application Insights telemetry data.</span></span> <span data-ttu-id="02375-193">Hello de modification `hdfs dfs -ls` hello cellule toouse hello wasb chemin d’accès retourné de ligne, puis utilisez **MAJ + ENTRÉE** cellule de hello toorun à nouveau.</span><span class="sxs-lookup"><span data-stu-id="02375-193">Change hello `hdfs dfs -ls` line in hello cell toouse hello wasb path returned, and then use **SHIFT+ENTER** toorun hello cell again.</span></span> <span data-ttu-id="02375-194">Ce temps, les résultats hello doivent afficher les répertoires hello qui contiennent des données de télémétrie.</span><span class="sxs-lookup"><span data-stu-id="02375-194">This time, hello results should display hello directories that contain telemetry data.</span></span>

   > [!NOTE]
   > <span data-ttu-id="02375-195">Les étapes de cette section reste hello Hello, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` active a été utilisée.</span><span class="sxs-lookup"><span data-stu-id="02375-195">For hello remainder of hello steps in this section, hello `wasb://appinsights@contosostore.blob.core.windows.net/contosoappinsights_{ID}/Requests` directory was used.</span></span> <span data-ttu-id="02375-196">Ce répertoire n’existe peut-être pas, sauf si vos données de télémétrie sont destinées à une application web.</span><span class="sxs-lookup"><span data-stu-id="02375-196">This directory may not exist unless your telemetry data is for a web app.</span></span>

6. <span data-ttu-id="02375-197">Dans la cellule suivante de hello, entrez hello suivant code : Remplacez `WASB\_PATH` avec chemin d’accès de hello à partir de l’étape précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="02375-197">In hello next cell, enter hello following code: Replace `WASB\_PATH` with hello path from hello previous step.</span></span>

   ```scala
   var jsonFiles = sc.textFile('WASB_PATH')
   val sqlContext = new org.apache.spark.sql.SQLContext(sc)
   var jsonData = sqlContext.read.json(jsonFiles)
   ```

    <span data-ttu-id="02375-198">Ce code crée une trame de données à partir des fichiers JSON hello exportées par le processus d’exportation continue hello.</span><span class="sxs-lookup"><span data-stu-id="02375-198">This code creates a dataframe from hello JSON files exported by hello continuous export process.</span></span> <span data-ttu-id="02375-199">Utilisez **MAJ + ENTRÉE** toorun cette cellule.</span><span class="sxs-lookup"><span data-stu-id="02375-199">Use **SHIFT+ENTER** toorun this cell.</span></span>

7. <span data-ttu-id="02375-200">Dans la cellule suivante de hello, entrez et exécutez hello suivant schéma hello tooview Spark créé pour les fichiers JSON hello :</span><span class="sxs-lookup"><span data-stu-id="02375-200">In hello next cell, enter and run hello following tooview hello schema that Spark created for hello JSON files:</span></span>

   ```scala
   jsonData.printSchema
   ```

    <span data-ttu-id="02375-201">schéma Hello pour chaque type de données de télémétrie est différent.</span><span class="sxs-lookup"><span data-stu-id="02375-201">hello schema for each type of telemetry is different.</span></span> <span data-ttu-id="02375-202">exemple Hello est hello de schéma est généré pour les demandes web (les données stockées dans hello `Requests` sous-répertoire) :</span><span class="sxs-lookup"><span data-stu-id="02375-202">hello following example is hello schema that is generated for web requests (data stored in hello `Requests` subdirectory):</span></span>

        root
        |-- context: struct (nullable = true)
        |    |-- application: struct (nullable = true)
        |    |    |-- version: string (nullable = true)
        |    |-- custom: struct (nullable = true)
        |    |    |-- dimensions: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |    |-- metrics: array (nullable = true)
        |    |    |    |-- element: string (containsNull = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- eventTime: string (nullable = true)
        |    |    |-- isSynthetic: boolean (nullable = true)
        |    |    |-- samplingRate: double (nullable = true)
        |    |    |-- syntheticSource: string (nullable = true)
        |    |-- device: struct (nullable = true)
        |    |    |-- browser: string (nullable = true)
        |    |    |-- browserVersion: string (nullable = true)
        |    |    |-- deviceModel: string (nullable = true)
        |    |    |-- deviceName: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- osVersion: string (nullable = true)
        |    |    |-- type: string (nullable = true)
        |    |-- location: struct (nullable = true)
        |    |    |-- city: string (nullable = true)
        |    |    |-- clientip: string (nullable = true)
        |    |    |-- continent: string (nullable = true)
        |    |    |-- country: string (nullable = true)
        |    |    |-- province: string (nullable = true)
        |    |-- operation: struct (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |-- session: struct (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- isFirst: boolean (nullable = true)
        |    |-- user: struct (nullable = true)
        |    |    |-- anonId: string (nullable = true)
        |    |    |-- isAuthenticated: boolean (nullable = true)
        |-- internal: struct (nullable = true)
        |    |-- data: struct (nullable = true)
        |    |    |-- documentVersion: string (nullable = true)
        |    |    |-- id: string (nullable = true)
        |-- request: array (nullable = true)
        |    |-- element: struct (containsNull = true)
        |    |    |-- count: long (nullable = true)
        |    |    |-- durationMetric: struct (nullable = true)
        |    |    |    |-- count: double (nullable = true)
        |    |    |    |-- max: double (nullable = true)
        |    |    |    |-- min: double (nullable = true)
        |    |    |    |-- sampledValue: double (nullable = true)
        |    |    |    |-- stdDev: double (nullable = true)
        |    |    |    |-- value: double (nullable = true)
        |    |    |-- id: string (nullable = true)
        |    |    |-- name: string (nullable = true)
        |    |    |-- responseCode: long (nullable = true)
        |    |    |-- success: boolean (nullable = true)
        |    |    |-- url: string (nullable = true)
        |    |    |-- urlData: struct (nullable = true)
        |    |    |    |-- base: string (nullable = true)
        |    |    |    |-- hashTag: string (nullable = true)
        |    |    |    |-- host: string (nullable = true)
        |    |    |    |-- protocol: string (nullable = true)

8. <span data-ttu-id="02375-203">Utilisez hello suivant tooregister hello trame de données comme une table temporaire et exécuter une requête sur les données de salutation :</span><span class="sxs-lookup"><span data-stu-id="02375-203">Use hello following tooregister hello dataframe as a temporary table and run a query against hello data:</span></span>

   ```scala
   jsonData.registerTempTable("requests")
   var city = sqlContext.sql("select context.location.city from requests where context.location.city is not null limit 10").show()
   ```

    <span data-ttu-id="02375-204">Cette requête retourne des informations de ville hello pour les premiers enregistrements de 20 hello où context.location.city n’est pas null.</span><span class="sxs-lookup"><span data-stu-id="02375-204">This query returns hello city information for hello top 20 records where context.location.city is not null.</span></span>

   > [!NOTE]
   > <span data-ttu-id="02375-205">structure de contexte Hello est présente dans toutes les données de télémétrie enregistrées par l’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="02375-205">hello context structure is present in all telemetry logged by Application Insights.</span></span> <span data-ttu-id="02375-206">élément de ville Hello ne peut-être pas être rempli dans vos journaux.</span><span class="sxs-lookup"><span data-stu-id="02375-206">hello city element may not be populated in your logs.</span></span> <span data-ttu-id="02375-207">Utilisez hello schéma tooidentify autres éléments que vous pouvez interroger peuvent contenir des données de vos journaux.</span><span class="sxs-lookup"><span data-stu-id="02375-207">Use hello schema tooidentify other elements that you can query that may contain data for your logs.</span></span>
   >
   >

    <span data-ttu-id="02375-208">Cette requête retourne toohello similaire à informations suivant le texte :</span><span class="sxs-lookup"><span data-stu-id="02375-208">This query returns information similar toohello following text:</span></span>

        +---------+
        |     city|
        +---------+
        | Bellevue|
        |  Redmond|
        |  Seattle|
        |Charlotte|
        ...
        +---------+

## <a name="next-steps"></a><span data-ttu-id="02375-209">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="02375-209">Next steps</span></span>

<span data-ttu-id="02375-210">Pour plus d’exemples d’utilisation de Spark toowork avec des données et des services dans Azure, consultez hello suivant des documents :</span><span class="sxs-lookup"><span data-stu-id="02375-210">For more examples of using Spark toowork with data and services in Azure, see hello following documents:</span></span>

* [<span data-ttu-id="02375-211">Spark avec BI : effectuez une analyse interactive des données à l’aide de Spark dans HDInsight avec des outils BI</span><span class="sxs-lookup"><span data-stu-id="02375-211">Spark with BI: Perform interactive data analysis using Spark in HDInsight with BI tools</span></span>](hdinsight-apache-spark-use-bi-tools.md)
* [<span data-ttu-id="02375-212">Spark avec Machine Learning : utilisez Spark dans HDInsight pour l’analyse de la température des bâtiments à l’aide des données des systèmes HVAC</span><span class="sxs-lookup"><span data-stu-id="02375-212">Spark with Machine Learning: Use Spark in HDInsight for analyzing building temperature using HVAC data</span></span>](hdinsight-apache-spark-ipython-notebook-machine-learning.md)
* [<span data-ttu-id="02375-213">Spark avec Machine Learning : Spark utilisation dans résultats de l’inspection alimentaires toopredict HDInsight</span><span class="sxs-lookup"><span data-stu-id="02375-213">Spark with Machine Learning: Use Spark in HDInsight toopredict food inspection results</span></span>](hdinsight-apache-spark-machine-learning-mllib-ipython.md)
* [<span data-ttu-id="02375-214">Streaming Spark : Utiliser Spark dans HDInsight pour créer des applications de diffusion en continu</span><span class="sxs-lookup"><span data-stu-id="02375-214">Spark Streaming: Use Spark in HDInsight for building streaming applications</span></span>](hdinsight-apache-spark-eventhub-streaming.md)
* [<span data-ttu-id="02375-215">Analyse des journaux de site web à l’aide de Spark dans HDInsight</span><span class="sxs-lookup"><span data-stu-id="02375-215">Website log analysis using Spark in HDInsight</span></span>](hdinsight-apache-spark-custom-library-website-log-analysis.md)

<span data-ttu-id="02375-216">Pour plus d’informations sur la création et exécution d’applications Spark, consultez hello suivant des documents :</span><span class="sxs-lookup"><span data-stu-id="02375-216">For information on creating and running Spark applications, see hello following documents:</span></span>

* [<span data-ttu-id="02375-217">Créer une application autonome avec Scala</span><span class="sxs-lookup"><span data-stu-id="02375-217">Create a standalone application using Scala</span></span>](hdinsight-apache-spark-create-standalone-application.md)
* [<span data-ttu-id="02375-218">Exécution de travaux à distance avec Livy sur un cluster Spark</span><span class="sxs-lookup"><span data-stu-id="02375-218">Run jobs remotely on a Spark cluster using Livy</span></span>](hdinsight-apache-spark-livy-rest-interface.md)
