---
title: "aaaScript du développement d’actions avec HDInsight - Azure | Documents Microsoft"
description: "Découvrez comment toocustomize Hadoop clusters avec l’Action de Script. Action de script peut être utilisé tooinstall des logiciels supplémentaires en cours d’exécution sur une configuration Hadoop cluster ou toochange hello des applications installées sur un cluster."
services: hdinsight
documentationcenter: 
tags: azure-portal
author: mumian
manager: jhubbard
editor: cgronlun
ms.assetid: 836d68a8-8b21-4d69-8b61-281a7fe67f21
ms.service: hdinsight
ms.workload: big-data
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/25/2017
ms.author: jgao
ROBOTS: NOINDEX
ms.openlocfilehash: 4fc3a389df8a003f7129ab00b4cd9bc7ad81a419
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="develop-script-action-scripts-for-hdinsight-windows-based-clusters"></a><span data-ttu-id="642f1-104">Développer des scripts d’action de script pour des clusters HDInsight Windows</span><span class="sxs-lookup"><span data-stu-id="642f1-104">Develop Script Action scripts for HDInsight Windows-based clusters</span></span>
<span data-ttu-id="642f1-105">Découvrez comment toowrite Action de Script des scripts pour HDInsight.</span><span class="sxs-lookup"><span data-stu-id="642f1-105">Learn how toowrite Script Action scripts for HDInsight.</span></span> <span data-ttu-id="642f1-106">Pour plus d’informations sur les scripts d’action de script, consultez [Personnaliser des clusters HDInsight à l’aide d’une action de script](hdinsight-hadoop-customize-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-106">For information on using Script Action scripts, see [Customize HDInsight clusters using Script Action](hdinsight-hadoop-customize-cluster.md).</span></span> <span data-ttu-id="642f1-107">Pour hello même article écrit pour les clusters HDInsight de basés sur Linux, consultez [des scripts de développer une Action de Script pour HDInsight](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-107">For hello same article written for Linux-based HDInsight clusters, see [Develop Script Action scripts for HDInsight](hdinsight-hadoop-script-actions-linux.md).</span></span>



> [!IMPORTANT]
> <span data-ttu-id="642f1-108">les étapes dans ce document seul le travail clusters HDInsight de basés sur Windows Hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-108">hello steps in this document only work for Windows-based HDInsight clusters.</span></span> <span data-ttu-id="642f1-109">HDInsight est uniquement disponible sur Windows pour les versions antérieures à HDInsight 3.4.</span><span class="sxs-lookup"><span data-stu-id="642f1-109">HDInsight is only available on Windows for versions lower than HDInsight 3.4.</span></span> <span data-ttu-id="642f1-110">Linux est hello seul système d’exploitation utilisé sur HDInsight version 3.4 ou supérieure.</span><span class="sxs-lookup"><span data-stu-id="642f1-110">Linux is hello only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="642f1-111">Pour plus d’informations, consultez [Suppression de HDInsight sous Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span><span class="sxs-lookup"><span data-stu-id="642f1-111">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span> <span data-ttu-id="642f1-112">Pour plus d’informations sur l’utilisation des actions de script avec les clusters basés sur Linux, consultez [Développement d’action de script avec HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-112">For information on using script actions with Linux-based clusters, see [Script action development with HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span></span>
>
>



<span data-ttu-id="642f1-113">Action de script peut être utilisé tooinstall des logiciels supplémentaires en cours d’exécution sur une configuration Hadoop cluster ou toochange hello des applications installées sur un cluster.</span><span class="sxs-lookup"><span data-stu-id="642f1-113">Script Action can be used tooinstall additional software running on a Hadoop cluster or toochange hello configuration of applications installed on a cluster.</span></span> <span data-ttu-id="642f1-114">Actions de script sont des scripts qui s’exécutent sur les nœuds de cluster hello lors du déploiement de clusters HDInsight, et elles sont exécutées une fois que les nœuds de cluster de hello terminer la configuration de HDInsight.</span><span class="sxs-lookup"><span data-stu-id="642f1-114">Script actions are scripts that run on hello cluster nodes when HDInsight clusters are deployed, and they are executed once nodes in hello cluster complete HDInsight configuration.</span></span> <span data-ttu-id="642f1-115">Une action de script est exécutée sous des privilèges de compte d’administrateur système et fournit des droits d’accès complets des nœuds de cluster toohello.</span><span class="sxs-lookup"><span data-stu-id="642f1-115">A script action is executed under system admin account privileges and provides full access rights toohello cluster nodes.</span></span> <span data-ttu-id="642f1-116">Chaque cluster peut être fourni avec une liste de toobe d’actions de script exécutée dans l’ordre de hello dans lequel elles sont spécifiées.</span><span class="sxs-lookup"><span data-stu-id="642f1-116">Each cluster can be provided with a list of script actions toobe executed in hello order in which they are specified.</span></span>

> [!NOTE]
> <span data-ttu-id="642f1-117">Si vous rencontrez hello message d’erreur suivant :</span><span class="sxs-lookup"><span data-stu-id="642f1-117">If you experience hello following error message:</span></span>
>
> <span data-ttu-id="642f1-118">System.Management.Automation.CommandNotFoundException ; %Exceptionmessage : hello terme 'Save-HDIFile' n’est pas reconnu comme nom hello de l’applet de commande, fonction, fichier de script ou programme exécutable.</span><span class="sxs-lookup"><span data-stu-id="642f1-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage : hello term 'Save-HDIFile' is not recognized as hello name of a cmdlet, function, script file, or operable program.</span></span> <span data-ttu-id="642f1-119">Vérifier l’orthographe hello du nom de hello, ou si un chemin d’accès existe, vérifiez que le chemin hello est correct et réessayez.</span><span class="sxs-lookup"><span data-stu-id="642f1-119">Check hello spelling of hello name, or if a path was included, verify that hello path is correct and try again.</span></span>
> <span data-ttu-id="642f1-120">Cela signifie que vous n’avez pas inclure des méthodes d’assistance hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-120">It is because you didn't include hello helper methods.</span></span>  <span data-ttu-id="642f1-121">Consultez [Méthodes d’assistance pour les scripts personnalisés](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span><span class="sxs-lookup"><span data-stu-id="642f1-121">See [Helper methods for custom scripts](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span></span>
>
>

## <a name="sample-scripts"></a><span data-ttu-id="642f1-122">Exemples de scripts</span><span class="sxs-lookup"><span data-stu-id="642f1-122">Sample scripts</span></span>
<span data-ttu-id="642f1-123">Pour créer des clusters HDInsight sur un système d’exploitation Windows, hello Action de Script est le script Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="642f1-123">For creating HDInsight clusters on Windows operating system, hello Script Action is Azure PowerShell script.</span></span> <span data-ttu-id="642f1-124">Bonjour script suivant est un exemple de configuration des fichiers de configuration de site hello :</span><span class="sxs-lookup"><span data-stu-id="642f1-124">hello following script is a sample for configuring hello site configuration files:</span></span>

[!INCLUDE [upgrade-powershell](../../includes/hdinsight-use-latest-powershell.md)]

    param (
        [parameter(Mandatory)][string] $ConfigFileName,
        [parameter(Mandatory)][string] $Name,
        [parameter(Mandatory)][string] $Value,
        [parameter()][string] $Description
    )

    if (!$Description) {
        $Description = ""
    }

    $hdiConfigFiles = @{
        "hive-site.xml" = "$env:HIVE_HOME\conf\hive-site.xml";
        "core-site.xml" = "$env:HADOOP_HOME\etc\hadoop\core-site.xml";
        "hdfs-site.xml" = "$env:HADOOP_HOME\etc\hadoop\hdfs-site.xml";
        "mapred-site.xml" = "$env:HADOOP_HOME\etc\hadoop\mapred-site.xml";
        "yarn-site.xml" = "$env:HADOOP_HOME\etc\hadoop\yarn-site.xml"
    }

    if (!($hdiConfigFiles[$ConfigFileName])) {
        Write-HDILog "Unable tooconfigure $ConfigFileName because it is not part of hello HDI configuration files."
        return
    }

    [xml]$configFile = Get-Content $hdiConfigFiles[$ConfigFileName]

    $existingproperty = $configFile.configuration.property | where {$_.Name -eq $Name}

    if ($existingproperty) {
        $existingproperty.Value = $Value
        $existingproperty.Description = $Description
    } else {
        $newproperty = @($configFile.configuration.property)[0].Clone()
        $newproperty.Name = $Name
        $newproperty.Value = $Value
        $newproperty.Description = $Description
        $configFile.configuration.AppendChild($newproperty)
    }

    $configFile.Save($hdiConfigFiles[$ConfigFileName])

    Write-HDILog "$configFileName has been configured."

<span data-ttu-id="642f1-125">script de Hello accepte quatre paramètres, nom de fichier de configuration de hello, propriété hello toomodify, hello valeur tooset et une description.</span><span class="sxs-lookup"><span data-stu-id="642f1-125">hello script takes four parameters, hello configuration file name, hello property you want toomodify, hello value you want tooset, and a description.</span></span> <span data-ttu-id="642f1-126">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="642f1-126">For example:</span></span>

    hive-site.xml hive.metastore.client.socket.timeout 90

<span data-ttu-id="642f1-127">Ces paramètres définit hello hive.metastore.client.socket.timeout valeur too90 hello hive-site.XML fichier.</span><span class="sxs-lookup"><span data-stu-id="642f1-127">These parameters sets hello hive.metastore.client.socket.timeout value too90 in hello hive-site.xml file.</span></span>  <span data-ttu-id="642f1-128">Hello par défaut est 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="642f1-128">hello default value is 60 seconds.</span></span>

<span data-ttu-id="642f1-129">Cet exemple de script est également disponible à l’adresse [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span><span class="sxs-lookup"><span data-stu-id="642f1-129">This sample script can also be found at [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span></span>

<span data-ttu-id="642f1-130">HDInsight fournit plusieurs scripts tooinstall des composants supplémentaires sur les clusters HDInsight :</span><span class="sxs-lookup"><span data-stu-id="642f1-130">HDInsight provides several scripts tooinstall additional components on HDInsight clusters:</span></span>

| <span data-ttu-id="642f1-131">Nom</span><span class="sxs-lookup"><span data-stu-id="642f1-131">Name</span></span> | <span data-ttu-id="642f1-132">Script</span><span class="sxs-lookup"><span data-stu-id="642f1-132">Script</span></span> |
| --- | --- |
| <span data-ttu-id="642f1-133">**Installation de Spark**</span><span class="sxs-lookup"><span data-stu-id="642f1-133">**Install Spark**</span></span> |<span data-ttu-id="642f1-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span><span class="sxs-lookup"><span data-stu-id="642f1-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span></span> <span data-ttu-id="642f1-135">Consultez [Installer et utiliser Spark sur les clusters HDInsight][hdinsight-install-spark].</span><span class="sxs-lookup"><span data-stu-id="642f1-135">See [Install and use Spark on HDInsight clusters][hdinsight-install-spark].</span></span> |
| <span data-ttu-id="642f1-136">**Installation de R**</span><span class="sxs-lookup"><span data-stu-id="642f1-136">**Install R**</span></span> |<span data-ttu-id="642f1-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span><span class="sxs-lookup"><span data-stu-id="642f1-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span></span> <span data-ttu-id="642f1-138">Consultez [Installer et utiliser R sur les clusters HDInsight][hdinsight-r-scripts].</span><span class="sxs-lookup"><span data-stu-id="642f1-138">See [Install and use R on HDInsight clusters][hdinsight-r-scripts].</span></span> |
| <span data-ttu-id="642f1-139">**Installation de Solr**</span><span class="sxs-lookup"><span data-stu-id="642f1-139">**Install Solr**</span></span> |<span data-ttu-id="642f1-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="642f1-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span></span> <span data-ttu-id="642f1-141">Consultez [Installer et utiliser Solr sur les clusters HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-141">See [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span> |
| <span data-ttu-id="642f1-142">- **Installation de Giraph**</span><span class="sxs-lookup"><span data-stu-id="642f1-142">- **Install Giraph**</span></span> |<span data-ttu-id="642f1-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="642f1-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span></span> <span data-ttu-id="642f1-144">Consultez [Installer et utiliser Giraph sur les clusters HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-144">See [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span> |

<span data-ttu-id="642f1-145">Action de script peut être déployée à partir de hello portail Azure, Azure PowerShell ou à l’aide de hello HDInsight .NET SDK.</span><span class="sxs-lookup"><span data-stu-id="642f1-145">Script Action can be deployed from hello Azure portal, Azure PowerShell or by using hello HDInsight .NET SDK.</span></span>  <span data-ttu-id="642f1-146">Pour plus d’informations, consultez l’article [Personnaliser des clusters HDInsight à l’aide d’une d’action de script][hdinsight-cluster-customize].</span><span class="sxs-lookup"><span data-stu-id="642f1-146">For more information, see [Customize HDInsight clusters using Script Action][hdinsight-cluster-customize].</span></span>

> [!NOTE]
> <span data-ttu-id="642f1-147">exemples de scripts Hello fonctionnent uniquement avec la version du cluster HDInsight 3.1 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="642f1-147">hello sample scripts work only with HDInsight cluster version 3.1 or above.</span></span> <span data-ttu-id="642f1-148">Pour plus d’informations sur les versions des clusters HDInsight, consultez la page [Versions des clusters HDInsight](hdinsight-component-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-148">For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).</span></span>
>
>

## <a name="helper-methods-for-custom-scripts"></a><span data-ttu-id="642f1-149">Méthodes d’assistance pour les scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="642f1-149">Helper methods for custom scripts</span></span>
<span data-ttu-id="642f1-150">L’action de script fournit des méthodes d’assistance que vous pouvez utiliser lors de l’écriture de scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="642f1-150">Script Action helper methods are utilities that you can use while writing custom scripts.</span></span> <span data-ttu-id="642f1-151">Ces méthodes sont définies dans [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1)et peuvent être inclus dans vos scripts à l’aide de hello suivant l’exemple :</span><span class="sxs-lookup"><span data-stu-id="642f1-151">These methods are defined in [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1), and can be included in your scripts using hello following sample:</span></span>

    # Download config action module from a well-known directory.
    $CONFIGACTIONURI = "https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1";
    $CONFIGACTIONMODULE = "C:\apps\dist\HDInsightUtilities.psm1";
    $webclient = New-Object System.Net.WebClient;
    $webclient.DownloadFile($CONFIGACTIONURI, $CONFIGACTIONMODULE);

    # (TIP) Import config action helper method module toomake writing config action easy.
    if (Test-Path ($CONFIGACTIONMODULE))
    {
        Import-Module $CONFIGACTIONMODULE;
    }
    else
    {
        Write-Output "Failed tooload HDInsightUtilities module, exiting ...";
        exit;
    }

<span data-ttu-id="642f1-152">Voici les méthodes d’assistance hello fournies par ce script :</span><span class="sxs-lookup"><span data-stu-id="642f1-152">Here are hello helper methods that are provided by this script:</span></span>

| <span data-ttu-id="642f1-153">Méthode d'assistance</span><span class="sxs-lookup"><span data-stu-id="642f1-153">Helper method</span></span> | <span data-ttu-id="642f1-154">Description</span><span class="sxs-lookup"><span data-stu-id="642f1-154">Description</span></span> |
| --- | --- |
| <span data-ttu-id="642f1-155">**Save-HDIFile**</span><span class="sxs-lookup"><span data-stu-id="642f1-155">**Save-HDIFile**</span></span> |<span data-ttu-id="642f1-156">Télécharger un fichier à partir de hello l’identificateur de ressource uniforme (URI) tooa emplacement spécifié sur le disque local hello associé au cluster de toohello attribué de nœuds de machine virtuelle Azure hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-156">Download a file from hello specified Uniform Resource Identifier (URI) tooa location on hello local disk that is associated with hello Azure VM node assigned toohello cluster.</span></span> |
| <span data-ttu-id="642f1-157">**Expand-HDIZippedFile**</span><span class="sxs-lookup"><span data-stu-id="642f1-157">**Expand-HDIZippedFile**</span></span> |<span data-ttu-id="642f1-158">Décompresser un fichier zippé.</span><span class="sxs-lookup"><span data-stu-id="642f1-158">Unzip a zipped file.</span></span> |
| <span data-ttu-id="642f1-159">**Invoke-HDICmdScript**</span><span class="sxs-lookup"><span data-stu-id="642f1-159">**Invoke-HDICmdScript**</span></span> |<span data-ttu-id="642f1-160">Exécuter un script à partir de cmd.exe.</span><span class="sxs-lookup"><span data-stu-id="642f1-160">Run a script from cmd.exe.</span></span> |
| <span data-ttu-id="642f1-161">**HDILog d'écriture**</span><span class="sxs-lookup"><span data-stu-id="642f1-161">**Write-HDILog**</span></span> |<span data-ttu-id="642f1-162">Écrire la sortie à partir du script personnalisé de hello utilisé pour une action de script.</span><span class="sxs-lookup"><span data-stu-id="642f1-162">Write output from hello custom script used for a script action.</span></span> |
| <span data-ttu-id="642f1-163">**Get-Services**</span><span class="sxs-lookup"><span data-stu-id="642f1-163">**Get-Services**</span></span> |<span data-ttu-id="642f1-164">Obtenir la liste des services en cours d’exécution sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-164">Get a list of services running on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="642f1-165">**Get-Service**</span><span class="sxs-lookup"><span data-stu-id="642f1-165">**Get-Service**</span></span> |<span data-ttu-id="642f1-166">Avec le nom de service spécifique hello en tant qu’entrée, obtenir des informations détaillées pour un service spécifique (nom du service, l’identificateur de processus, état, etc.) sur l’ordinateur hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-166">With hello specific service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="642f1-167">**Get-HDIServices**</span><span class="sxs-lookup"><span data-stu-id="642f1-167">**Get-HDIServices**</span></span> |<span data-ttu-id="642f1-168">Obtenir la liste des services HDInsight en cours d’exécution sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-168">Get a list of HDInsight services running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-169">**Get-HDIService**</span><span class="sxs-lookup"><span data-stu-id="642f1-169">**Get-HDIService**</span></span> |<span data-ttu-id="642f1-170">Nom de hello spécifique HDInsight service en tant qu’entrée, obtenir des informations détaillées pour un service spécifique (nom du service, l’identificateur de processus, état, etc.) sur l’ordinateur hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-170">With hello specific HDInsight service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on hello machine where hello script executes.</span></span> |
| <span data-ttu-id="642f1-171">**Get-ServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="642f1-171">**Get-ServicesRunning**</span></span> |<span data-ttu-id="642f1-172">Obtenir la liste des services qui s’exécutent sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-172">Get a list of services that are running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-173">**Get-ServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="642f1-173">**Get-ServiceRunning**</span></span> |<span data-ttu-id="642f1-174">Vérifiez si un service spécifique (par nom) est en cours d’exécution sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-174">Check if a specific service (by name) is running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-175">**Get-HDIServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="642f1-175">**Get-HDIServicesRunning**</span></span> |<span data-ttu-id="642f1-176">Obtenir la liste des services HDInsight en cours d’exécution sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-176">Get a list of HDInsight services running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-177">**Get-HDIServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="642f1-177">**Get-HDIServiceRunning**</span></span> |<span data-ttu-id="642f1-178">Vérifiez si un service HDInsight spécifique (par nom) est en cours d’exécution sur l’ordinateur de hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-178">Check if a specific HDInsight service (by name) is running on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-179">**Get-HDIHadoopVersion**</span><span class="sxs-lookup"><span data-stu-id="642f1-179">**Get-HDIHadoopVersion**</span></span> |<span data-ttu-id="642f1-180">Obtenir la version de hello de Hadoop installé sur l’ordinateur hello où s’exécute le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-180">Get hello version of Hadoop installed on hello computer where hello script executes.</span></span> |
| <span data-ttu-id="642f1-181">**Test-IsHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="642f1-181">**Test-IsHDIHeadNode**</span></span> |<span data-ttu-id="642f1-182">Vérifiez si ordinateur hello où s’exécute le script de hello est un nœud principal.</span><span class="sxs-lookup"><span data-stu-id="642f1-182">Check if hello computer where hello script executes is a head node.</span></span> |
| <span data-ttu-id="642f1-183">**Test-IsActiveHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="642f1-183">**Test-IsActiveHDIHeadNode**</span></span> |<span data-ttu-id="642f1-184">Vérifiez si ordinateur hello où s’exécute le script de hello est un nœud principal actif.</span><span class="sxs-lookup"><span data-stu-id="642f1-184">Check if hello computer where hello script executes is an active head node.</span></span> |
| <span data-ttu-id="642f1-185">**Test-IsHDIDataNode**</span><span class="sxs-lookup"><span data-stu-id="642f1-185">**Test-IsHDIDataNode**</span></span> |<span data-ttu-id="642f1-186">Vérifiez si ordinateur hello où s’exécute le script de hello est un nœud de données.</span><span class="sxs-lookup"><span data-stu-id="642f1-186">Check if hello computer where hello script executes is a data node.</span></span> |
| <span data-ttu-id="642f1-187">**Edit-HDIConfigFile**</span><span class="sxs-lookup"><span data-stu-id="642f1-187">**Edit-HDIConfigFile**</span></span> |<span data-ttu-id="642f1-188">Modifier les fichiers de configuration hive-site.XML hello, core-site.XML, hdfs-site.XML, mapred-site.XML ou yarn-site.Xml.</span><span class="sxs-lookup"><span data-stu-id="642f1-188">Edit hello config files hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml, or yarn-site.xml.</span></span> |

## <a name="best-practices-for-script-development"></a><span data-ttu-id="642f1-189">Meilleures pratiques relatives au développement de scripts</span><span class="sxs-lookup"><span data-stu-id="642f1-189">Best practices for script development</span></span>
<span data-ttu-id="642f1-190">Lorsque vous développez un script personnalisé pour un cluster HDInsight, il existe plusieurs meilleures tookeep de pratiques à l’esprit :</span><span class="sxs-lookup"><span data-stu-id="642f1-190">When you develop a custom script for an HDInsight cluster, there are several best practices tookeep in mind:</span></span>

* <span data-ttu-id="642f1-191">Recherchez la version de Hadoop hello</span><span class="sxs-lookup"><span data-stu-id="642f1-191">Check for hello Hadoop version</span></span>

    <span data-ttu-id="642f1-192">Uniquement HDInsight version 3.1 (Hadoop 2.4) et supérieur prennent en charge à l’aide de composants de Script Action tooinstall personnalisés sur un cluster.</span><span class="sxs-lookup"><span data-stu-id="642f1-192">Only HDInsight version 3.1 (Hadoop 2.4) and above support using Script Action tooinstall custom components on a cluster.</span></span> <span data-ttu-id="642f1-193">Dans votre script personnalisé, vous devez utiliser hello **Get-HDIHadoopVersion** version d’assistance méthode toocheck hello Hadoop avant de procéder à la réalisation d’autres tâches dans le script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-193">In your custom script, you must use hello **Get-HDIHadoopVersion** helper method toocheck hello Hadoop version before proceeding with performing other tasks in hello script.</span></span>
* <span data-ttu-id="642f1-194">Fournir stable lie les ressources tooscript</span><span class="sxs-lookup"><span data-stu-id="642f1-194">Provide stable links tooscript resources</span></span>

    <span data-ttu-id="642f1-195">Les utilisateurs devraient vous assurer que tous les scripts hello et autres artefacts sont utilisés dans une personnalisation hello d’un cluster restent disponibles tout au long de durée de vie hello du cluster de hello et que les versions hello de ces fichiers ne changent pas pour la durée hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-195">Users should make sure that all hello scripts and other artifacts used in hello customization of a cluster remain available throughout hello lifetime of hello cluster and that hello versions of these files do not change for hello duration.</span></span> <span data-ttu-id="642f1-196">Ces ressources sont requises si hello cette opération de nœuds de cluster de hello est requis.</span><span class="sxs-lookup"><span data-stu-id="642f1-196">These resources are required if hello reimaging of nodes in hello cluster is required.</span></span> <span data-ttu-id="642f1-197">meilleure pratique de Hello est toodownload et archivez tous les éléments dans un compte de stockage hello des contrôles utilisateur.</span><span class="sxs-lookup"><span data-stu-id="642f1-197">hello best practice is toodownload and archive everything in a Storage account that hello user controls.</span></span> <span data-ttu-id="642f1-198">Cela peut être le compte de stockage par défaut hello ou un des autres comptes de stockage hello spécifiés au moment de hello du déploiement d’un cluster personnalisé.</span><span class="sxs-lookup"><span data-stu-id="642f1-198">This can be hello default Storage account or any of hello additional Storage accounts specified at hello time of deployment for a customized cluster.</span></span>
    <span data-ttu-id="642f1-199">Bonjour Spark et R personnalisé des exemples de cluster fournies dans la documentation de hello, par exemple, nous avons une copie locale des ressources de hello dans ce compte de stockage : https://hdiconfigactions.blob.core.windows.net/.</span><span class="sxs-lookup"><span data-stu-id="642f1-199">In hello Spark and R customized cluster samples provided in hello documentation, for example, we have made a local copy of hello resources in this Storage account: https://hdiconfigactions.blob.core.windows.net/.</span></span>
* <span data-ttu-id="642f1-200">Assurez-vous que le script de personnalisation de cluster hello est idempotente</span><span class="sxs-lookup"><span data-stu-id="642f1-200">Ensure that hello cluster customization script is idempotent</span></span>

    <span data-ttu-id="642f1-201">Vous devez attendre que les nœuds hello d’un cluster HDInsight est réinitialisée pendant la durée de vie de cluster hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-201">You must expect that hello nodes of an HDInsight cluster is reimaged during hello cluster lifetime.</span></span> <span data-ttu-id="642f1-202">script de personnalisation de cluster Hello est exécutée chaque fois qu’un cluster est réinitialisé.</span><span class="sxs-lookup"><span data-stu-id="642f1-202">hello cluster customization script is run whenever a cluster is reimaged.</span></span> <span data-ttu-id="642f1-203">Ce script doit être idempotente toobe conçu dans le sens hello que lors de la réinitialisation, script de hello doit s’assurer que le cluster hello est retourné toohello que état où elle se trouvait juste après que le script de hello pour hello première exécution lorsque le cluster de hello était initialement personnalisés créé.</span><span class="sxs-lookup"><span data-stu-id="642f1-203">This script must be designed toobe idempotent in hello sense that upon reimaging, hello script should ensure that hello cluster is returned toohello same customized state that it was in just after hello script ran for hello first time when hello cluster was initially created.</span></span> <span data-ttu-id="642f1-204">Par exemple, si un script personnalisé installé une application à D:\AppLocation sur sa première exécution, puis à chaque exécution ultérieure, lors de la réinitialisation, script de hello doit vérifier l’existence d’application hello en hello emplacement D:\AppLocation avant de continuer avec d’autres étapes de script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-204">For example, if a custom script installed an application at D:\AppLocation on its first run, then on each subsequent run, upon reimaging, hello script should check whether hello application exists at hello D:\AppLocation location before proceeding with other steps in hello script.</span></span>
* <span data-ttu-id="642f1-205">Installer des composants personnalisés dans un emplacement optimal de hello</span><span class="sxs-lookup"><span data-stu-id="642f1-205">Install custom components in hello optimal location</span></span>

    <span data-ttu-id="642f1-206">Lorsque les nœuds de cluster sont réinitialisés, lecteur de ressources C:\ hello et lecteur D:\ du système peuvent être remis en forme, entraînant la perte de hello de données et applications qui avaient été installées sur ces lecteurs.</span><span class="sxs-lookup"><span data-stu-id="642f1-206">When cluster nodes are reimaged, hello C:\ resource drive and D:\ system drive can be reformatted, resulting in hello loss of data and applications that had been installed on those drives.</span></span> <span data-ttu-id="642f1-207">Cela peut également se produire si un nœud de machine virtuelle Azure (VM) qui fait partie du cluster de hello tombe en panne et est remplacé par un nouveau nœud.</span><span class="sxs-lookup"><span data-stu-id="642f1-207">This could also happen if an Azure virtual machine (VM) node that is part of hello cluster goes down and is replaced by a new node.</span></span> <span data-ttu-id="642f1-208">Vous pouvez installer les composants sur hello lecteur D:\ ou emplacement de C:\apps hello sur le cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-208">You can install components on hello D:\ drive or in hello C:\apps location on hello cluster.</span></span> <span data-ttu-id="642f1-209">Tous les autres emplacements sur le lecteur C:\ de hello sont réservés.</span><span class="sxs-lookup"><span data-stu-id="642f1-209">All other locations on hello C:\ drive are reserved.</span></span> <span data-ttu-id="642f1-210">Spécifiez hello emplacement pour les applications ou bibliothèques toobe installé dans le script de personnalisation de cluster hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-210">Specify hello location where applications or libraries are toobe installed in hello cluster customization script.</span></span>
* <span data-ttu-id="642f1-211">Garantir une haute disponibilité de l’architecture de cluster hello</span><span class="sxs-lookup"><span data-stu-id="642f1-211">Ensure high availability of hello cluster architecture</span></span>

    <span data-ttu-id="642f1-212">HDInsight possède une architecture actif / passif pour la haute disponibilité, dans quel un nœud principal est en mode actif (hello HDInsight exécutant services) et hello autres nœud principal est en mode veille (dans le HDInsight services ne sont pas en cours d’exécution).</span><span class="sxs-lookup"><span data-stu-id="642f1-212">HDInsight has an active-passive architecture for high availability, in which one head node is in active mode (where hello HDInsight services are running) and hello other head node is in standby mode (in which HDInsight services are not running).</span></span> <span data-ttu-id="642f1-213">les nœuds Hello basculer entre les modes actifs et passifs si services HDInsight sont interrompues.</span><span class="sxs-lookup"><span data-stu-id="642f1-213">hello nodes switch active and passive modes if HDInsight services are interrupted.</span></span> <span data-ttu-id="642f1-214">Si une action de script est services tooinstall utilisé sur les deux nœuds principal pour la haute disponibilité, notez que ce mécanisme de basculement HDInsight hello n’est pas en mesure de tooautomatically échouent sur ces services installé par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="642f1-214">If a script action is used tooinstall services on both head nodes for high availability, note that hello HDInsight failover mechanism is not able tooautomatically fail over these user-installed services.</span></span> <span data-ttu-id="642f1-215">Par conséquent, installé par l’utilisateur des services sur les nœuds principal HDInsight qui sont attendu toobe hautement disponible doivent être ont leur propre mécanisme de basculement en mode actif / passif ou en mode actif-actif.</span><span class="sxs-lookup"><span data-stu-id="642f1-215">So user-installed services on HDInsight head nodes that are expected toobe highly available must either have their own failover mechanism if in active-passive mode or be in active-active mode.</span></span>

    <span data-ttu-id="642f1-216">Une commande de l’Action de Script HDInsight s’exécute sur les deux nœuds principal lorsque le rôle de nœud principal et hello est spécifié en tant que valeur Bonjour *ClusterRoleCollection* paramètre.</span><span class="sxs-lookup"><span data-stu-id="642f1-216">An HDInsight Script Action command runs on both head nodes when hello head-node role is specified as a value in hello *ClusterRoleCollection* parameter.</span></span> <span data-ttu-id="642f1-217">Par conséquent, lorsque vous concevez des scripts personnalisés, vérifiez qu'il est au fait de cette configuration.</span><span class="sxs-lookup"><span data-stu-id="642f1-217">So when you design a custom script, make sure that your script is aware of this setup.</span></span> <span data-ttu-id="642f1-218">Vous ne devez pas exécuter des problèmes où hello mêmes services sont installés et démarrés sur les deux nœuds principaux d’hello et ils finissent en concurrence avec eux.</span><span class="sxs-lookup"><span data-stu-id="642f1-218">You should not run into problems where hello same services are installed and started on both of hello head nodes and they end up competing with each other.</span></span> <span data-ttu-id="642f1-219">En outre, sachez que les données sont perdues lors de la réinitialisation, logiciels installés via l’Action de Script a toobe toosuch résilient événements.</span><span class="sxs-lookup"><span data-stu-id="642f1-219">Also, be aware that data is lost during reimaging, so software installed via Script Action has toobe resilient toosuch events.</span></span> <span data-ttu-id="642f1-220">Les applications doivent prendre toowork conçue avec des données hautement disponibles sont répartie sur plusieurs nœuds.</span><span class="sxs-lookup"><span data-stu-id="642f1-220">Applications should be designed toowork with highly available data that is distributed across many nodes.</span></span> <span data-ttu-id="642f1-221">Notez que le maximum de 1/5 de nœuds hello dans un cluster peut être réinitialisé à hello même temps.</span><span class="sxs-lookup"><span data-stu-id="642f1-221">Note that as many as 1/5 of hello nodes in a cluster can be reimaged at hello same time.</span></span>
* <span data-ttu-id="642f1-222">Configurer le stockage d’objets Blob Azure hello des composants personnalisés toouse</span><span class="sxs-lookup"><span data-stu-id="642f1-222">Configure hello custom components toouse Azure Blob storage</span></span>

    <span data-ttu-id="642f1-223">les composants personnalisés Hello que vous installez sur les nœuds de cluster hello peuvent avoir un toouse de configuration par défaut stockage de système de fichiers distribués Hadoop (HDFS).</span><span class="sxs-lookup"><span data-stu-id="642f1-223">hello custom components that you install on hello cluster nodes might have a default configuration toouse Hadoop Distributed File System (HDFS) storage.</span></span> <span data-ttu-id="642f1-224">Vous devez modifier hello configuration toouse stockage d’objets Blob Azure à la place.</span><span class="sxs-lookup"><span data-stu-id="642f1-224">You should change hello configuration toouse Azure Blob storage instead.</span></span> <span data-ttu-id="642f1-225">Sur la réinitialisation du cluster, système de fichiers HDFS hello obtient mis en forme et vous perdez toutes les données qui y sont stockées.</span><span class="sxs-lookup"><span data-stu-id="642f1-225">On a cluster reimage, hello HDFS file system gets formatted and you would lose any data that is stored there.</span></span> <span data-ttu-id="642f1-226">L'utilisation du stockage d'objets blob Azure au lieu du stockage HDFS garantit que vos données sont conservées.</span><span class="sxs-lookup"><span data-stu-id="642f1-226">Using Azure Blob storage instead ensures that your data is retained.</span></span>

## <a name="common-usage-patterns"></a><span data-ttu-id="642f1-227">Modes d’utilisation courants</span><span class="sxs-lookup"><span data-stu-id="642f1-227">Common usage patterns</span></span>
<span data-ttu-id="642f1-228">Cette section fournit des conseils sur l’implémentation des modèles d’utilisation courants hello que vous pouvez rencontrer lors de l’écriture de votre propre script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="642f1-228">This section provides guidance on implementing some of hello common usage patterns that you might run into while writing your own custom script.</span></span>

### <a name="configure-environment-variables"></a><span data-ttu-id="642f1-229">Configuration des variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="642f1-229">Configure environment variables</span></span>
<span data-ttu-id="642f1-230">Dans le développement d’action de script, vous sentirez souvent hello devez tooset variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="642f1-230">Often in script action development, you feel hello need tooset environment variables.</span></span> <span data-ttu-id="642f1-231">Par exemple, un scénario le plus probable est lorsque vous téléchargez un fichier binaire à partir d’un site externe, l’installer sur un cluster de hello et ajoutez un emplacement où il est variable d’environnement « PATH » installé tooyour hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-231">For instance, a most likely scenario is when you download a binary from an external site, install it on hello cluster, and add hello location of where it is installed tooyour ‘PATH’ environment variable.</span></span> <span data-ttu-id="642f1-232">Hello suivant extrait de code montre comment les variables d’environnement tooset dans hello script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="642f1-232">hello following snippet shows you how tooset environment variables in hello custom script.</span></span>

    Write-HDILog "Starting environment variable setting at: $(Get-Date)";
    [Environment]::SetEnvironmentVariable('MDS_RUNNER_CUSTOM_CLUSTER', 'true', 'Machine');

<span data-ttu-id="642f1-233">Cette instruction définit la variable d’environnement hello **MDS_RUNNER_CUSTOM_CLUSTER** toohello valeur 'true' et jeux hello étendue de cette variable toobe à l’échelle de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="642f1-233">This statement sets hello environment variable **MDS_RUNNER_CUSTOM_CLUSTER** toohello value 'true' and also sets hello scope of this variable toobe machine-wide.</span></span> <span data-ttu-id="642f1-234">Dans certains cas, il est important que les variables d’environnement sont définies au niveau de portée approprié hello : utilisateur ou ordinateur.</span><span class="sxs-lookup"><span data-stu-id="642f1-234">At times it is important that environment variables are set at hello appropriate scope – machine or user.</span></span> <span data-ttu-id="642f1-235">Cliquez [ici][1] pour obtenir plus d’informations sur la définition des variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="642f1-235">Refer [here][1] for more information on setting environment variables.</span></span>

### <a name="access-toolocations-where-hello-custom-scripts-are-stored"></a><span data-ttu-id="642f1-236">Toolocations d’accès où sont stockés les scripts personnalisés hello</span><span class="sxs-lookup"><span data-stu-id="642f1-236">Access toolocations where hello custom scripts are stored</span></span>
<span data-ttu-id="642f1-237">Scripts utilisés toocustomize un tooeither de besoins de cluster soit dans le compte de stockage par défaut hello pour le cluster de hello dans un conteneur en lecture seule public sur d’autres comptes de stockage.</span><span class="sxs-lookup"><span data-stu-id="642f1-237">Scripts used toocustomize a cluster needs tooeither be in hello default storage account for hello cluster or in a public read-only container on any other storage account.</span></span> <span data-ttu-id="642f1-238">Si votre script accède à des ressources situées ailleurs ceux-ci doivent toobe dans accessible publiquement (publics au moins en lecture seule).</span><span class="sxs-lookup"><span data-stu-id="642f1-238">If your script accesses resources located elsewhere these need toobe in a publicly accessible (at least public read-only).</span></span> <span data-ttu-id="642f1-239">Par exemple, vous pouvez souhaitez tooaccess un fichier et enregistrez-le à l’aide de la commande hello SaveFile-HDI.</span><span class="sxs-lookup"><span data-stu-id="642f1-239">For instance you might want tooaccess a file and save it using hello SaveFile-HDI command.</span></span>

    Save-HDIFile -SrcUri 'https://somestorageaccount.blob.core.windows.net/somecontainer/some-file.jar' -DestFile 'C:\apps\dist\hadoop-2.4.0.2.1.9.0-2196\share\hadoop\mapreduce\some-file.jar'

<span data-ttu-id="642f1-240">Dans cet exemple, vous devez vous assurer que le conteneur de hello 'somecontainer' dans le compte de stockage 'somestorageaccount' n’est accessible publiquement.</span><span class="sxs-lookup"><span data-stu-id="642f1-240">In this example, you must ensure that hello container 'somecontainer' in storage account 'somestorageaccount' is publicly accessible.</span></span> <span data-ttu-id="642f1-241">Dans le cas contraire, le script de hello lève une exception « Introuvable » et échouer.</span><span class="sxs-lookup"><span data-stu-id="642f1-241">Otherwise, hello script throws a ‘Not Found’ exception and fail.</span></span>

### <a name="pass-parameters-toohello-add-azurermhdinsightscriptaction-cmdlet"></a><span data-ttu-id="642f1-242">Passer des paramètres toohello Add-AzureRmHDInsightScriptAction applet de commande</span><span class="sxs-lookup"><span data-stu-id="642f1-242">Pass parameters toohello Add-AzureRmHDInsightScriptAction cmdlet</span></span>
<span data-ttu-id="642f1-243">toopass plusieurs applet de commande de paramètres toohello Add-AzureRmHDInsightScriptAction, vous devez tooformat hello chaîne valeur toocontain tous les paramètres de script de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-243">toopass multiple parameters toohello Add-AzureRmHDInsightScriptAction cmdlet, you need tooformat hello string value toocontain all parameters for hello script.</span></span> <span data-ttu-id="642f1-244">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="642f1-244">For example:</span></span>

    "-CertifcateUri wasb:///abc.pfx -CertificatePassword 123456 -InstallFolderName MyFolder"

<span data-ttu-id="642f1-245">or</span><span class="sxs-lookup"><span data-stu-id="642f1-245">or</span></span>

    $parameters = '-Parameters "{0};{1};{2}"' -f $CertificateName,$certUriWithSasToken,$CertificatePassword


### <a name="throw-exception-for-failed-cluster-deployment"></a><span data-ttu-id="642f1-246">Lever une exception pour l’échec d’un déploiement de cluster</span><span class="sxs-lookup"><span data-stu-id="642f1-246">Throw exception for failed cluster deployment</span></span>
<span data-ttu-id="642f1-247">Si vous souhaitez tooget précisément averti du fait de hello de personnalisation cluster a échoué comme prévu, il est important toothrow une exception et Échec de la création du cluster hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-247">If you want tooget accurately notified of hello fact that cluster customization did not succeed as expected, it is important toothrow an exception and fail hello cluster creation.</span></span> <span data-ttu-id="642f1-248">Par exemple, vous pouvez souhaitez tooprocess un fichier s’il existe et gérer les cas d’erreur hello où le fichier de hello n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="642f1-248">For instance, you might want tooprocess a file if it exists and handle hello error case where hello file does not exist.</span></span> <span data-ttu-id="642f1-249">Il en résulterait que script de hello s’arrête correctement et hello état du cluster de hello est correctement connu.</span><span class="sxs-lookup"><span data-stu-id="642f1-249">This would ensure that hello script exits gracefully and hello state of hello cluster is correctly known.</span></span> <span data-ttu-id="642f1-250">Hello extrait de code suivant donne un exemple de procédure tooachieve cela :</span><span class="sxs-lookup"><span data-stu-id="642f1-250">hello following snippet gives an example of how tooachieve this:</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    exit
    }

<span data-ttu-id="642f1-251">Dans cet extrait de code, si le fichier de hello n’existe pas, il entraînerait tooa état hello script réellement s’arrête correctement après l’impression du message d’erreur hello, alors que le cluster de hello atteint l’état en cours d’exécution, en supposant qu’il les processus de personnalisation de cluster « avec succès » s’est terminée.</span><span class="sxs-lookup"><span data-stu-id="642f1-251">In this snippet, if hello file did not exist, it would lead tooa state where hello script actually exits gracefully after printing hello error message, and hello cluster reaches running state assuming it "successfully" completed cluster customization process.</span></span> <span data-ttu-id="642f1-252">Si vous souhaitez toobe précisément averti du fait de hello de personnalisation cluster essentiellement a échoué comme prévu en raison d’un fichier manquant, il est plus approprié toothrow une exception et que vous échouer l’étape de personnalisation de cluster hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-252">If you want toobe accurately notified of hello fact that cluster customization essentially did not succeed as expected because of a missing file, it is more appropriate toothrow an exception and fail hello cluster customization step.</span></span> <span data-ttu-id="642f1-253">tooachieve cela vous devez utiliser hello suivant extrait de code à la place.</span><span class="sxs-lookup"><span data-stu-id="642f1-253">tooachieve this you must use hello following sample code snippet instead.</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    throw
    }


## <a name="checklist-for-deploying-a-script-action"></a><span data-ttu-id="642f1-254">Liste de vérification pour le déploiement d’une action de script</span><span class="sxs-lookup"><span data-stu-id="642f1-254">Checklist for deploying a script action</span></span>
<span data-ttu-id="642f1-255">Voici les étapes hello que étaient lors de la préparation toodeploy ces scripts :</span><span class="sxs-lookup"><span data-stu-id="642f1-255">Here are hello steps we took when preparing toodeploy these scripts:</span></span>

1. <span data-ttu-id="642f1-256">Placez les fichiers hello qui contiennent des scripts personnalisés hello dans un emplacement accessible par les nœuds de cluster hello lors du déploiement.</span><span class="sxs-lookup"><span data-stu-id="642f1-256">Put hello files that contain hello custom scripts in a place that is accessible by hello cluster nodes during deployment.</span></span> <span data-ttu-id="642f1-257">Il peut s’agir d’une des valeur par défaut hello ou des comptes de stockage supplémentaires spécifiées au moment de hello de déploiement de cluster, ou tout autre conteneur de stockage accessible publiquement.</span><span class="sxs-lookup"><span data-stu-id="642f1-257">This can be any of hello default or additional Storage accounts specified at hello time of cluster deployment, or any other publicly accessible storage container.</span></span>
2. <span data-ttu-id="642f1-258">Ajouter des vérifications en toomake scripts assurer qu’elles s’exécutent de manière idempotente, afin que le script de hello peut être exécutée à plusieurs reprises sur hello même nœud.</span><span class="sxs-lookup"><span data-stu-id="642f1-258">Add checks into scripts toomake sure that they execute idempotently, so that hello script can be executed multiple times on hello same node.</span></span>
3. <span data-ttu-id="642f1-259">Hello d’utilisation **Write-Output** tooSTDOUT de tooprint d’applet de commande Azure PowerShell, ainsi que STDERR.</span><span class="sxs-lookup"><span data-stu-id="642f1-259">Use hello **Write-Output** Azure PowerShell cmdlet tooprint tooSTDOUT as well as STDERR.</span></span> <span data-ttu-id="642f1-260">N'utilisez pas **Write-Host**.</span><span class="sxs-lookup"><span data-stu-id="642f1-260">Do not use **Write-Host**.</span></span>
4. <span data-ttu-id="642f1-261">Utiliser un dossier de fichiers temporaires, tels que $env : TEMP, tookeep hello fichier téléchargé utilisée par les scripts de hello et puis les nettoyer après aient l’exécution de scripts.</span><span class="sxs-lookup"><span data-stu-id="642f1-261">Use a temporary file folder, such as $env:TEMP, tookeep hello downloaded file used by hello scripts and then clean them up after scripts have executed.</span></span>
5. <span data-ttu-id="642f1-262">5.Installez des logiciels personnalisés uniquement aux emplacements suivants : D:\ ou C:\apps.</span><span class="sxs-lookup"><span data-stu-id="642f1-262">Install custom software only at D:\ or C:\apps.</span></span> <span data-ttu-id="642f1-263">Autres emplacements sur le lecteur C: de hello ne doivent pas servir comme ils sont réservés.</span><span class="sxs-lookup"><span data-stu-id="642f1-263">Other locations on hello C: drive should not be used as they are reserved.</span></span> <span data-ttu-id="642f1-264">Notez que l’installation des fichiers sur le lecteur C: de hello en dehors du dossier de C:\apps hello peut-être générer des échecs d’installation pendant reimages du nœud de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-264">Note that installing files on hello C: drive outside of hello C:\apps folder may result in setup failures during reimages of hello node.</span></span>
6. <span data-ttu-id="642f1-265">Dans événement hello que les paramètres au niveau du système d’exploitation ou les fichiers de configuration de service Hadoop ont été modifiés, vous pouvez vouloir toorestart HDInsight services afin qu’ils peuvent tous les paramètres au niveau du système d’exploitation, tels que des variables d’environnement hello set dans les scripts de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-265">In hello event that OS-level settings or Hadoop service configuration files were changed, you may want toorestart HDInsight services so that they can pick up any OS-level settings, such as hello environment variables set in hello scripts.</span></span>

## <a name="debug-custom-scripts"></a><span data-ttu-id="642f1-266">Déboguer des scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="642f1-266">Debug custom scripts</span></span>
<span data-ttu-id="642f1-267">journaux des erreurs de script Hello sont stockées, ainsi que d’autres de sortie du compte de stockage par défaut hello que vous avez spécifié pour le cluster hello lors de sa création.</span><span class="sxs-lookup"><span data-stu-id="642f1-267">hello script error logs are stored, along with other output, in hello default Storage account that you specified for hello cluster at its creation.</span></span> <span data-ttu-id="642f1-268">Hello journaux sont stockés dans une table avec le nom de hello *u < \cluster-name-fragment >< \time-stamp > setuplog*.</span><span class="sxs-lookup"><span data-stu-id="642f1-268">hello logs are stored in a table with hello name *u<\cluster-name-fragment><\time-stamp>setuplog*.</span></span> <span data-ttu-id="642f1-269">Il s’agit de journaux agrégées qui ont des enregistrements à partir de tous les nœuds hello (nœud principal et nœuds de travail) sur le hello script s’exécute dans un cluster de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-269">These are aggregated logs that have records from all of hello nodes (head node and worker nodes) on which hello script runs in hello cluster.</span></span>
<span data-ttu-id="642f1-270">Toocheck hello journaux est toouse facilement les outils HDInsight pour Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="642f1-270">An easy way toocheck hello logs is toouse HDInsight Tools for Visual Studio.</span></span> <span data-ttu-id="642f1-271">Pour installer les outils de hello, consultez [commencer à l’aide des outils Visual Studio Hadoop pour HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span><span class="sxs-lookup"><span data-stu-id="642f1-271">For installing hello tools, see [Get started using Visual Studio Hadoop tools for HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span></span>

<span data-ttu-id="642f1-272">**journal de hello toocheck à l’aide de Visual Studio**</span><span class="sxs-lookup"><span data-stu-id="642f1-272">**toocheck hello log using Visual Studio**</span></span>

1. <span data-ttu-id="642f1-273">Ouvrez Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="642f1-273">Open Visual Studio.</span></span>
2. <span data-ttu-id="642f1-274">Cliquez sur **Affichage**, puis sur **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="642f1-274">Click **View**, and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="642f1-275">Cliquez sur « Azure », cliquez sur se connecter trop**abonnements Microsoft Azure**, puis entrez vos informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="642f1-275">Right-click "Azure", click Connect too**Microsoft Azure Subscriptions**, and then enter your credentials.</span></span>
4. <span data-ttu-id="642f1-276">Développez **stockage**compte de stockage Azure hello utilisé en tant que système de fichiers par défaut hello successivement **Tables**, puis double-cliquez sur le nom de la table hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-276">Expand **Storage**, expand hello Azure storage account used as hello default file system, expand **Tables**, and then double-click hello table name.</span></span>

<span data-ttu-id="642f1-277">Vous pouvez également à distance dans toosee de nœuds de cluster hello STDOUT et STDERR pour des scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="642f1-277">You can also remote into hello cluster nodes toosee both STDOUT and STDERR for custom scripts.</span></span> <span data-ttu-id="642f1-278">Hello journaux sur chaque nœud sont spécifiques seul nœud toothat et être connectés à **C:\HDInsightLogs\DeploymentAgent.log**.</span><span class="sxs-lookup"><span data-stu-id="642f1-278">hello logs on each node are specific only toothat node and are logged into **C:\HDInsightLogs\DeploymentAgent.log**.</span></span> <span data-ttu-id="642f1-279">Ces fichiers journaux enregistrent toutes les sorties à partir d’un script personnalisé hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-279">These log files record all outputs from hello custom script.</span></span> <span data-ttu-id="642f1-280">Un extrait de journal pour une action de script Spark ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="642f1-280">An example log snippet for a Spark script action looks like this:</span></span>

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand; Details : BEGIN: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Starting Spark installation at: 09/04/2014 21:46:02 Done with Spark installation at: 09/04/2014 21:46:38;

    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand;
    Details : END: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;


<span data-ttu-id="642f1-281">Dans ce journal, il est clair qu’action de script Spark hello a été exécutée sur hello ordinateur virtuel nommé HEADNODE0 et qu’aucune exceptions ont été levées lors de l’exécution de hello.</span><span class="sxs-lookup"><span data-stu-id="642f1-281">In this log, it is clear that hello Spark script action has been executed on hello VM named HEADNODE0 and that no exceptions were thrown during hello execution.</span></span>

<span data-ttu-id="642f1-282">Dans l’événement de hello un échec d’exécution se produit, sortie hello décrivant il est également contenue dans ce fichier journal.</span><span class="sxs-lookup"><span data-stu-id="642f1-282">In hello event that an execution failure occurs, hello output describing it is also contained in this log file.</span></span> <span data-ttu-id="642f1-283">les informations de Hello fournies dans ces journaux doivent être utiles lors du débogage des problèmes de script qui peuvent survenir.</span><span class="sxs-lookup"><span data-stu-id="642f1-283">hello information provided in these logs should be helpful in debugging script problems that may arise.</span></span>

## <a name="see-also"></a><span data-ttu-id="642f1-284">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="642f1-284">See also</span></span>
* <span data-ttu-id="642f1-285">[Personnaliser des clusters HDInsight à l’aide d’une action de script][hdinsight-cluster-customize]</span><span class="sxs-lookup"><span data-stu-id="642f1-285">[Customize HDInsight clusters using Script Action][hdinsight-cluster-customize]</span></span>
* <span data-ttu-id="642f1-286">[Installer et utiliser Spark sur les clusters HDInsight][hdinsight-install-spark]</span><span class="sxs-lookup"><span data-stu-id="642f1-286">[Install and use Spark on HDInsight clusters][hdinsight-install-spark]</span></span>
* <span data-ttu-id="642f1-287">[Installer et utiliser R sur les clusters HDInsight][hdinsight-r-scripts]</span><span class="sxs-lookup"><span data-stu-id="642f1-287">[Install and use R on HDInsight clusters][hdinsight-r-scripts]</span></span>
* <span data-ttu-id="642f1-288">[Installer et utiliser Solr sur les clusters HDInsight](hdinsight-hadoop-solr-install.md)</span><span class="sxs-lookup"><span data-stu-id="642f1-288">[Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span>
* <span data-ttu-id="642f1-289">[Installez et utilisez Giraph sur les clusters HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="642f1-289">[Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span>

[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md
[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md
[hdinsight-r-scripts]: hdinsight-hadoop-r-scripts.md
[powershell-install-configure]: install-configure-powershell.md

<!--Reference links in article-->
[1]: https://msdn.microsoft.com/library/96xafkes(v=vs.110).aspx
