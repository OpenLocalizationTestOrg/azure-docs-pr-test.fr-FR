---
title: "Développement d’une action de script avec HDInsight - Azure | Documents Microsoft"
description: "Découvrez comment personnaliser des clusters Hadoop avec une action de script. L’action de script permet d’installer des logiciels supplémentaires s’exécutant sur un cluster Hadoop ou de modifier la configuration des applications installées sur un cluster."
services: hdinsight
documentationcenter: 
tags: azure-portal
author: mumian
manager: jhubbard
editor: cgronlun
ms.assetid: 836d68a8-8b21-4d69-8b61-281a7fe67f21
ms.service: hdinsight
ms.workload: big-data
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/25/2017
ms.author: jgao
ROBOTS: NOINDEX
ms.openlocfilehash: 0e182e6b43fd2d17524c1da36cf4c204bb1b865a
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="develop-script-action-scripts-for-hdinsight-windows-based-clusters"></a><span data-ttu-id="11af7-104">Développer des scripts d’action de script pour des clusters HDInsight Windows</span><span class="sxs-lookup"><span data-stu-id="11af7-104">Develop Script Action scripts for HDInsight Windows-based clusters</span></span>
<span data-ttu-id="11af7-105">Découvrez comment écrire des scripts d’action de script pour HDInsight.</span><span class="sxs-lookup"><span data-stu-id="11af7-105">Learn how to write Script Action scripts for HDInsight.</span></span> <span data-ttu-id="11af7-106">Pour plus d’informations sur les scripts d’action de script, consultez [Personnaliser des clusters HDInsight à l’aide d’une action de script](hdinsight-hadoop-customize-cluster.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-106">For information on using Script Action scripts, see [Customize HDInsight clusters using Script Action](hdinsight-hadoop-customize-cluster.md).</span></span> <span data-ttu-id="11af7-107">Pour accéder au même article écrit pour les clusters HDInsight basés sur Linux, consultez [Développer des scripts d’action de script pour HDInsight](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-107">For the same article written for Linux-based HDInsight clusters, see [Develop Script Action scripts for HDInsight](hdinsight-hadoop-script-actions-linux.md).</span></span>



> [!IMPORTANT]
> <span data-ttu-id="11af7-108">Les étapes décrites dans ce document fonctionnent uniquement pour les clusters HDInsight Windows.</span><span class="sxs-lookup"><span data-stu-id="11af7-108">The steps in this document only work for Windows-based HDInsight clusters.</span></span> <span data-ttu-id="11af7-109">HDInsight est uniquement disponible sur Windows pour les versions antérieures à HDInsight 3.4.</span><span class="sxs-lookup"><span data-stu-id="11af7-109">HDInsight is only available on Windows for versions lower than HDInsight 3.4.</span></span> <span data-ttu-id="11af7-110">Linux est le seul système d’exploitation utilisé sur HDInsight version 3.4 ou supérieure.</span><span class="sxs-lookup"><span data-stu-id="11af7-110">Linux is the only operating system used on HDInsight version 3.4 or greater.</span></span> <span data-ttu-id="11af7-111">Pour plus d’informations, consultez [Suppression de HDInsight sous Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span><span class="sxs-lookup"><span data-stu-id="11af7-111">For more information, see [HDInsight retirement on Windows](hdinsight-component-versioning.md#hdinsight-windows-retirement).</span></span> <span data-ttu-id="11af7-112">Pour plus d’informations sur l’utilisation des actions de script avec les clusters basés sur Linux, consultez [Développement d’action de script avec HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-112">For information on using script actions with Linux-based clusters, see [Script action development with HDInsight (Linux)](hdinsight-hadoop-script-actions-linux.md).</span></span>
>
>



<span data-ttu-id="11af7-113">L’action de script permet d’installer des logiciels supplémentaires s’exécutant sur un cluster Hadoop ou de modifier la configuration des applications installées sur un cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-113">Script Action can be used to install additional software running on a Hadoop cluster or to change the configuration of applications installed on a cluster.</span></span> <span data-ttu-id="11af7-114">Les actions de script sont des scripts qui s'exécutent sur des nœuds de cluster lors du déploiement des clusters HDInsight. Elles sont exécutées une fois la configuration de HDInsight terminée dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-114">Script actions are scripts that run on the cluster nodes when HDInsight clusters are deployed, and they are executed once nodes in the cluster complete HDInsight configuration.</span></span> <span data-ttu-id="11af7-115">Une action de script est exécutée avec les privilèges d'un compte d'administrateur système qui fournissent des droits d'accès complets aux nœuds du cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-115">A script action is executed under system admin account privileges and provides full access rights to the cluster nodes.</span></span> <span data-ttu-id="11af7-116">Chaque cluster peut recevoir une liste d'actions de script qui sont exécutées dans l'ordre spécifié.</span><span class="sxs-lookup"><span data-stu-id="11af7-116">Each cluster can be provided with a list of script actions to be executed in the order in which they are specified.</span></span>

> [!NOTE]
> <span data-ttu-id="11af7-117">Si vous obtenez le message d’erreur suivant :</span><span class="sxs-lookup"><span data-stu-id="11af7-117">If you experience the following error message:</span></span>
>
> <span data-ttu-id="11af7-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage : Le terme ’Save-HDIFile’ n’est pas reconnu comme le nom d’une applet de commande, une fonction, un fichier de script ou un programme exécutable.</span><span class="sxs-lookup"><span data-stu-id="11af7-118">System.Management.Automation.CommandNotFoundException; ExceptionMessage : The term 'Save-HDIFile' is not recognized as the name of a cmdlet, function, script file, or operable program.</span></span> <span data-ttu-id="11af7-119">Vérifiez l’orthographe du nom ou, si un chemin d’accès a été inclus, vérifiez que le chemin d’accès est correct et réessayez.</span><span class="sxs-lookup"><span data-stu-id="11af7-119">Check the spelling of the name, or if a path was included, verify that the path is correct and try again.</span></span>
> <span data-ttu-id="11af7-120">Cela signifie que vous n’avez pas inclus les méthodes d’assistance.</span><span class="sxs-lookup"><span data-stu-id="11af7-120">It is because you didn't include the helper methods.</span></span>  <span data-ttu-id="11af7-121">Consultez [Méthodes d’assistance pour les scripts personnalisés](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span><span class="sxs-lookup"><span data-stu-id="11af7-121">See [Helper methods for custom scripts](hdinsight-hadoop-script-actions.md#helper-methods-for-custom-scripts).</span></span>
>
>

## <a name="sample-scripts"></a><span data-ttu-id="11af7-122">Exemples de scripts</span><span class="sxs-lookup"><span data-stu-id="11af7-122">Sample scripts</span></span>
<span data-ttu-id="11af7-123">Pour créer des clusters HDInsight sur un système d’exploitation Windows, l’action de script est le script Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="11af7-123">For creating HDInsight clusters on Windows operating system, the Script Action is Azure PowerShell script.</span></span> <span data-ttu-id="11af7-124">Le script suivant est un exemple pour configurer les fichiers de configuration de site :</span><span class="sxs-lookup"><span data-stu-id="11af7-124">The following script is a sample for configuring the site configuration files:</span></span>

[!INCLUDE [upgrade-powershell](../../includes/hdinsight-use-latest-powershell.md)]

    param (
        [parameter(Mandatory)][string] $ConfigFileName,
        [parameter(Mandatory)][string] $Name,
        [parameter(Mandatory)][string] $Value,
        [parameter()][string] $Description
    )

    if (!$Description) {
        $Description = ""
    }

    $hdiConfigFiles = @{
        "hive-site.xml" = "$env:HIVE_HOME\conf\hive-site.xml";
        "core-site.xml" = "$env:HADOOP_HOME\etc\hadoop\core-site.xml";
        "hdfs-site.xml" = "$env:HADOOP_HOME\etc\hadoop\hdfs-site.xml";
        "mapred-site.xml" = "$env:HADOOP_HOME\etc\hadoop\mapred-site.xml";
        "yarn-site.xml" = "$env:HADOOP_HOME\etc\hadoop\yarn-site.xml"
    }

    if (!($hdiConfigFiles[$ConfigFileName])) {
        Write-HDILog "Unable to configure $ConfigFileName because it is not part of the HDI configuration files."
        return
    }

    [xml]$configFile = Get-Content $hdiConfigFiles[$ConfigFileName]

    $existingproperty = $configFile.configuration.property | where {$_.Name -eq $Name}

    if ($existingproperty) {
        $existingproperty.Value = $Value
        $existingproperty.Description = $Description
    } else {
        $newproperty = @($configFile.configuration.property)[0].Clone()
        $newproperty.Name = $Name
        $newproperty.Value = $Value
        $newproperty.Description = $Description
        $configFile.configuration.AppendChild($newproperty)
    }

    $configFile.Save($hdiConfigFiles[$ConfigFileName])

    Write-HDILog "$configFileName has been configured."

<span data-ttu-id="11af7-125">Le script accepte quatre paramètres : le nom de fichier de la configuration, la propriété à modifier, la valeur à définir et une description.</span><span class="sxs-lookup"><span data-stu-id="11af7-125">The script takes four parameters, the configuration file name, the property you want to modify, the value you want to set, and a description.</span></span> <span data-ttu-id="11af7-126">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="11af7-126">For example:</span></span>

    hive-site.xml hive.metastore.client.socket.timeout 90

<span data-ttu-id="11af7-127">Ces paramètres définissent la valeur hive.metastore.client.socket.timeout sur 90 dans le fichier hive-site.xml.</span><span class="sxs-lookup"><span data-stu-id="11af7-127">These parameters sets the hive.metastore.client.socket.timeout value to 90 in the hive-site.xml file.</span></span>  <span data-ttu-id="11af7-128">La valeur par défaut est de 60 secondes.</span><span class="sxs-lookup"><span data-stu-id="11af7-128">The default value is 60 seconds.</span></span>

<span data-ttu-id="11af7-129">Cet exemple de script est également disponible à l’adresse [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span><span class="sxs-lookup"><span data-stu-id="11af7-129">This sample script can also be found at [https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1](https://hditutorialdata.blob.core.windows.net/customizecluster/editSiteConfig.ps1).</span></span>

<span data-ttu-id="11af7-130">HDInsight propose plusieurs scripts pour installer des composants supplémentaires sur les clusters HDInsight :</span><span class="sxs-lookup"><span data-stu-id="11af7-130">HDInsight provides several scripts to install additional components on HDInsight clusters:</span></span>

| <span data-ttu-id="11af7-131">Nom</span><span class="sxs-lookup"><span data-stu-id="11af7-131">Name</span></span> | <span data-ttu-id="11af7-132">Script</span><span class="sxs-lookup"><span data-stu-id="11af7-132">Script</span></span> |
| --- | --- |
| <span data-ttu-id="11af7-133">**Installation de Spark**</span><span class="sxs-lookup"><span data-stu-id="11af7-133">**Install Spark**</span></span> |<span data-ttu-id="11af7-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span><span class="sxs-lookup"><span data-stu-id="11af7-134">https://hdiconfigactions.blob.core.windows.net/sparkconfigactionv03/spark-installer-v03.ps1.</span></span> <span data-ttu-id="11af7-135">Consultez [Installer et utiliser Spark sur les clusters HDInsight][hdinsight-install-spark].</span><span class="sxs-lookup"><span data-stu-id="11af7-135">See [Install and use Spark on HDInsight clusters][hdinsight-install-spark].</span></span> |
| <span data-ttu-id="11af7-136">**Installation de R**</span><span class="sxs-lookup"><span data-stu-id="11af7-136">**Install R**</span></span> |<span data-ttu-id="11af7-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span><span class="sxs-lookup"><span data-stu-id="11af7-137">https://hdiconfigactions.blob.core.windows.net/rconfigactionv02/r-installer-v02.ps1.</span></span> <span data-ttu-id="11af7-138">Consultez [Installer et utiliser R sur les clusters HDInsight][hdinsight-r-scripts].</span><span class="sxs-lookup"><span data-stu-id="11af7-138">See [Install and use R on HDInsight clusters][hdinsight-r-scripts].</span></span> |
| <span data-ttu-id="11af7-139">**Installation de Solr**</span><span class="sxs-lookup"><span data-stu-id="11af7-139">**Install Solr**</span></span> |<span data-ttu-id="11af7-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="11af7-140">https://hdiconfigactions.blob.core.windows.net/solrconfigactionv01/solr-installer-v01.ps1.</span></span> <span data-ttu-id="11af7-141">Consultez [Installer et utiliser Solr sur les clusters HDInsight](hdinsight-hadoop-solr-install.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-141">See [Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span> |
| <span data-ttu-id="11af7-142">- **Installation de Giraph**</span><span class="sxs-lookup"><span data-stu-id="11af7-142">- **Install Giraph**</span></span> |<span data-ttu-id="11af7-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span><span class="sxs-lookup"><span data-stu-id="11af7-143">https://hdiconfigactions.blob.core.windows.net/giraphconfigactionv01/giraph-installer-v01.ps1.</span></span> <span data-ttu-id="11af7-144">Consultez [Installer et utiliser Giraph sur les clusters HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-144">See [Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span> |

<span data-ttu-id="11af7-145">L’action de script peut être déployée à partir du portail Azure, d’Azure PowerShell ou du Kit de développement logiciel (SDK) .NET HDInsight.</span><span class="sxs-lookup"><span data-stu-id="11af7-145">Script Action can be deployed from the Azure portal, Azure PowerShell or by using the HDInsight .NET SDK.</span></span>  <span data-ttu-id="11af7-146">Pour plus d’informations, consultez l’article [Personnaliser des clusters HDInsight à l’aide d’une d’action de script][hdinsight-cluster-customize].</span><span class="sxs-lookup"><span data-stu-id="11af7-146">For more information, see [Customize HDInsight clusters using Script Action][hdinsight-cluster-customize].</span></span>

> [!NOTE]
> <span data-ttu-id="11af7-147">Les exemples de scripts fonctionnent uniquement avec le cluster HDInsight version 3.1 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="11af7-147">The sample scripts work only with HDInsight cluster version 3.1 or above.</span></span> <span data-ttu-id="11af7-148">Pour plus d’informations sur les versions des clusters HDInsight, consultez la page [Versions des clusters HDInsight](hdinsight-component-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-148">For more information on HDInsight cluster versions, see [HDInsight cluster versions](hdinsight-component-versioning.md).</span></span>
>
>

## <a name="helper-methods-for-custom-scripts"></a><span data-ttu-id="11af7-149">Méthodes d’assistance pour les scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="11af7-149">Helper methods for custom scripts</span></span>
<span data-ttu-id="11af7-150">L’action de script fournit des méthodes d’assistance que vous pouvez utiliser lors de l’écriture de scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="11af7-150">Script Action helper methods are utilities that you can use while writing custom scripts.</span></span> <span data-ttu-id="11af7-151">Ces méthodes sont définies dans [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1) et peuvent être inclues dans vos scripts à l’aide des éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="11af7-151">These methods are defined in [https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1](https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1), and can be included in your scripts using the following sample:</span></span>

    # Download config action module from a well-known directory.
    $CONFIGACTIONURI = "https://hdiconfigactions.blob.core.windows.net/configactionmodulev05/HDInsightUtilities-v05.psm1";
    $CONFIGACTIONMODULE = "C:\apps\dist\HDInsightUtilities.psm1";
    $webclient = New-Object System.Net.WebClient;
    $webclient.DownloadFile($CONFIGACTIONURI, $CONFIGACTIONMODULE);

    # (TIP) Import config action helper method module to make writing config action easy.
    if (Test-Path ($CONFIGACTIONMODULE))
    {
        Import-Module $CONFIGACTIONMODULE;
    }
    else
    {
        Write-Output "Failed to load HDInsightUtilities module, exiting ...";
        exit;
    }

<span data-ttu-id="11af7-152">Voici les méthodes d’assistance fournies par ce script :</span><span class="sxs-lookup"><span data-stu-id="11af7-152">Here are the helper methods that are provided by this script:</span></span>

| <span data-ttu-id="11af7-153">Méthode d'assistance</span><span class="sxs-lookup"><span data-stu-id="11af7-153">Helper method</span></span> | <span data-ttu-id="11af7-154">Description</span><span class="sxs-lookup"><span data-stu-id="11af7-154">Description</span></span> |
| --- | --- |
| <span data-ttu-id="11af7-155">**Save-HDIFile**</span><span class="sxs-lookup"><span data-stu-id="11af7-155">**Save-HDIFile**</span></span> |<span data-ttu-id="11af7-156">Télécharger un fichier à partir de l'URI spécifié vers un emplacement du disque local qui est associé au nœud de machine virtuelle Azure affecté au cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-156">Download a file from the specified Uniform Resource Identifier (URI) to a location on the local disk that is associated with the Azure VM node assigned to the cluster.</span></span> |
| <span data-ttu-id="11af7-157">**Expand-HDIZippedFile**</span><span class="sxs-lookup"><span data-stu-id="11af7-157">**Expand-HDIZippedFile**</span></span> |<span data-ttu-id="11af7-158">Décompresser un fichier zippé.</span><span class="sxs-lookup"><span data-stu-id="11af7-158">Unzip a zipped file.</span></span> |
| <span data-ttu-id="11af7-159">**Invoke-HDICmdScript**</span><span class="sxs-lookup"><span data-stu-id="11af7-159">**Invoke-HDICmdScript**</span></span> |<span data-ttu-id="11af7-160">Exécuter un script à partir de cmd.exe.</span><span class="sxs-lookup"><span data-stu-id="11af7-160">Run a script from cmd.exe.</span></span> |
| <span data-ttu-id="11af7-161">**HDILog d'écriture**</span><span class="sxs-lookup"><span data-stu-id="11af7-161">**Write-HDILog**</span></span> |<span data-ttu-id="11af7-162">Écrire la sortie du script personnalisé utilisé pour une action de script.</span><span class="sxs-lookup"><span data-stu-id="11af7-162">Write output from the custom script used for a script action.</span></span> |
| <span data-ttu-id="11af7-163">**Get-Services**</span><span class="sxs-lookup"><span data-stu-id="11af7-163">**Get-Services**</span></span> |<span data-ttu-id="11af7-164">Obtenir la liste des services s'exécutant sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-164">Get a list of services running on the machine where the script executes.</span></span> |
| <span data-ttu-id="11af7-165">**Get-Service**</span><span class="sxs-lookup"><span data-stu-id="11af7-165">**Get-Service**</span></span> |<span data-ttu-id="11af7-166">En utilisant le nom de service spécifique comme entrée, obtenir des informations détaillées pour un service spécifique (nom du service, ID de processus, état, etc.) sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-166">With the specific service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on the machine where the script executes.</span></span> |
| <span data-ttu-id="11af7-167">**Get-HDIServices**</span><span class="sxs-lookup"><span data-stu-id="11af7-167">**Get-HDIServices**</span></span> |<span data-ttu-id="11af7-168">Obtenir la liste des services HDInsight en cours d'exécution sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-168">Get a list of HDInsight services running on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-169">**Get-HDIService**</span><span class="sxs-lookup"><span data-stu-id="11af7-169">**Get-HDIService**</span></span> |<span data-ttu-id="11af7-170">En utilisant le nom de service HDInsight spécifique comme entrée, obtenir des informations détaillées pour un service spécifique (nom du service, l'identificateur de processus, état, etc.) sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-170">With the specific HDInsight service name as input, get detailed information for a specific service (service name, process ID, state, etc.) on the machine where the script executes.</span></span> |
| <span data-ttu-id="11af7-171">**Get-ServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="11af7-171">**Get-ServicesRunning**</span></span> |<span data-ttu-id="11af7-172">Obtenir la liste des services en cours d'exécution sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-172">Get a list of services that are running on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-173">**Get-ServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="11af7-173">**Get-ServiceRunning**</span></span> |<span data-ttu-id="11af7-174">Vérifier si un service spécifique (par nom) est en cours d'exécution sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-174">Check if a specific service (by name) is running on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-175">**Get-HDIServicesRunning**</span><span class="sxs-lookup"><span data-stu-id="11af7-175">**Get-HDIServicesRunning**</span></span> |<span data-ttu-id="11af7-176">Obtenir la liste des services HDInsight en cours d'exécution sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-176">Get a list of HDInsight services running on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-177">**Get-HDIServiceRunning**</span><span class="sxs-lookup"><span data-stu-id="11af7-177">**Get-HDIServiceRunning**</span></span> |<span data-ttu-id="11af7-178">Vérifier si un service HDInsight spécifique (par nom) est en cours d'exécution sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-178">Check if a specific HDInsight service (by name) is running on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-179">**Get-HDIHadoopVersion**</span><span class="sxs-lookup"><span data-stu-id="11af7-179">**Get-HDIHadoopVersion**</span></span> |<span data-ttu-id="11af7-180">Obtenir la version de Hadoop installée sur l'ordinateur où s'exécute le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-180">Get the version of Hadoop installed on the computer where the script executes.</span></span> |
| <span data-ttu-id="11af7-181">**Test-IsHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="11af7-181">**Test-IsHDIHeadNode**</span></span> |<span data-ttu-id="11af7-182">Vérifier si l'ordinateur où s'exécute le script est un nœud principal.</span><span class="sxs-lookup"><span data-stu-id="11af7-182">Check if the computer where the script executes is a head node.</span></span> |
| <span data-ttu-id="11af7-183">**Test-IsActiveHDIHeadNode**</span><span class="sxs-lookup"><span data-stu-id="11af7-183">**Test-IsActiveHDIHeadNode**</span></span> |<span data-ttu-id="11af7-184">Vérifier si l'ordinateur où s'exécute le script est un nœud principal actif.</span><span class="sxs-lookup"><span data-stu-id="11af7-184">Check if the computer where the script executes is an active head node.</span></span> |
| <span data-ttu-id="11af7-185">**Test-IsHDIDataNode**</span><span class="sxs-lookup"><span data-stu-id="11af7-185">**Test-IsHDIDataNode**</span></span> |<span data-ttu-id="11af7-186">Vérifier si l'ordinateur où s'exécute le script est un nœud de données.</span><span class="sxs-lookup"><span data-stu-id="11af7-186">Check if the computer where the script executes is a data node.</span></span> |
| <span data-ttu-id="11af7-187">**Edit-HDIConfigFile**</span><span class="sxs-lookup"><span data-stu-id="11af7-187">**Edit-HDIConfigFile**</span></span> |<span data-ttu-id="11af7-188">Modifier les fichiers de configuration hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml ou yarn-site.xml.</span><span class="sxs-lookup"><span data-stu-id="11af7-188">Edit the config files hive-site.xml, core-site.xml, hdfs-site.xml, mapred-site.xml, or yarn-site.xml.</span></span> |

## <a name="best-practices-for-script-development"></a><span data-ttu-id="11af7-189">Meilleures pratiques relatives au développement de scripts</span><span class="sxs-lookup"><span data-stu-id="11af7-189">Best practices for script development</span></span>
<span data-ttu-id="11af7-190">Quand vous développez un script personnalisé pour un cluster HDInsight, tenez compte des meilleures pratiques suivantes :</span><span class="sxs-lookup"><span data-stu-id="11af7-190">When you develop a custom script for an HDInsight cluster, there are several best practices to keep in mind:</span></span>

* <span data-ttu-id="11af7-191">Rechercher la version Hadoop</span><span class="sxs-lookup"><span data-stu-id="11af7-191">Check for the Hadoop version</span></span>

    <span data-ttu-id="11af7-192">Seul HDInsight 3.1 (Hadoop 2.4) ou version ultérieure prend en charge l'utilisation d'une action de script pour installer des composants personnalisés sur un cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-192">Only HDInsight version 3.1 (Hadoop 2.4) and above support using Script Action to install custom components on a cluster.</span></span> <span data-ttu-id="11af7-193">Dans votre script personnalisé, vous devez utiliser la méthode d'assistance **Get-HDIHadoopVersion** pour vérifier la version de Hadoop avant d'effectuer d'autres tâches dans le script.</span><span class="sxs-lookup"><span data-stu-id="11af7-193">In your custom script, you must use the **Get-HDIHadoopVersion** helper method to check the Hadoop version before proceeding with performing other tasks in the script.</span></span>
* <span data-ttu-id="11af7-194">Fournir des liens stables vers les ressources de script</span><span class="sxs-lookup"><span data-stu-id="11af7-194">Provide stable links to script resources</span></span>

    <span data-ttu-id="11af7-195">Les utilisateurs doivent s'assurer que tous les scripts et autres artefacts utilisés dans la personnalisation d'un cluster sont disponibles tout au long de la durée de vie du cluster et que les versions de ces fichiers ne changent pas au cours de cette période.</span><span class="sxs-lookup"><span data-stu-id="11af7-195">Users should make sure that all the scripts and other artifacts used in the customization of a cluster remain available throughout the lifetime of the cluster and that the versions of these files do not change for the duration.</span></span> <span data-ttu-id="11af7-196">Ces ressources sont requises si le réimageage des nœuds dans le cluster est requis.</span><span class="sxs-lookup"><span data-stu-id="11af7-196">These resources are required if the reimaging of nodes in the cluster is required.</span></span> <span data-ttu-id="11af7-197">La meilleure pratique consiste à tout télécharger et à tout archiver dans un compte de stockage contrôlé par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="11af7-197">The best practice is to download and archive everything in a Storage account that the user controls.</span></span> <span data-ttu-id="11af7-198">Cela peut être le compte de stockage par défaut ou les comptes de stockage supplémentaires spécifiés au moment du déploiement d'un cluster personnalisé.</span><span class="sxs-lookup"><span data-stu-id="11af7-198">This can be the default Storage account or any of the additional Storage accounts specified at the time of deployment for a customized cluster.</span></span>
    <span data-ttu-id="11af7-199">Dans les exemples de clusters Spark et R personnalisés fournis dans la documentation, par exemple, nous avons créé une copie locale des ressources dans ce compte de stockage : https://hdiconfigactions.blob.core.windows.net/.</span><span class="sxs-lookup"><span data-stu-id="11af7-199">In the Spark and R customized cluster samples provided in the documentation, for example, we have made a local copy of the resources in this Storage account: https://hdiconfigactions.blob.core.windows.net/.</span></span>
* <span data-ttu-id="11af7-200">S’assurer que le script de personnalisation du cluster est idempotent</span><span class="sxs-lookup"><span data-stu-id="11af7-200">Ensure that the cluster customization script is idempotent</span></span>

    <span data-ttu-id="11af7-201">Vous devez tenir compte du réimageage des nœuds d'un cluster HDInsight au cours de la durée de vie du cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-201">You must expect that the nodes of an HDInsight cluster is reimaged during the cluster lifetime.</span></span> <span data-ttu-id="11af7-202">Le script de personnalisation du cluster est exécuté chaque fois qu'un cluster est réimagé.</span><span class="sxs-lookup"><span data-stu-id="11af7-202">The cluster customization script is run whenever a cluster is reimaged.</span></span> <span data-ttu-id="11af7-203">Ce script doit être conçu pour être idempotent afin que lors du réimageage, le script s’assure que le cluster retrouve l’état personnalisé qui était le sien juste après la première exécution du script lors de la création initiale du cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-203">This script must be designed to be idempotent in the sense that upon reimaging, the script should ensure that the cluster is returned to the same customized state that it was in just after the script ran for the first time when the cluster was initially created.</span></span> <span data-ttu-id="11af7-204">Par exemple, si un script personnalisé a installé une application à l’emplacement D:\AppLocation lors de sa première exécution, alors, à chaque exécution ultérieure, lors du réimageage, le script doit vérifier si l'application existe à l'emplacement D:\AppLocation avant de passer aux autres étapes du script.</span><span class="sxs-lookup"><span data-stu-id="11af7-204">For example, if a custom script installed an application at D:\AppLocation on its first run, then on each subsequent run, upon reimaging, the script should check whether the application exists at the D:\AppLocation location before proceeding with other steps in the script.</span></span>
* <span data-ttu-id="11af7-205">Installer des composants personnalisés dans l’emplacement optimal</span><span class="sxs-lookup"><span data-stu-id="11af7-205">Install custom components in the optimal location</span></span>

    <span data-ttu-id="11af7-206">Lorsque les nœuds de cluster sont réimagés, le lecteur des ressources C:\ et le lecteur du système D:\ peuvent être reformatés, ce qui entraîne la perte des données et des applications qui avaient été installées sur ces lecteurs.</span><span class="sxs-lookup"><span data-stu-id="11af7-206">When cluster nodes are reimaged, the C:\ resource drive and D:\ system drive can be reformatted, resulting in the loss of data and applications that had been installed on those drives.</span></span> <span data-ttu-id="11af7-207">Cela peut également se produire si un nœud de machine virtuelle (VM) Azure qui fait partie du cluster tombe en panne et est remplacé par un nouveau nœud.</span><span class="sxs-lookup"><span data-stu-id="11af7-207">This could also happen if an Azure virtual machine (VM) node that is part of the cluster goes down and is replaced by a new node.</span></span> <span data-ttu-id="11af7-208">Vous pouvez installer les composants sur le lecteur D:\ ou dans l'emplacement C:\apps sur le cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-208">You can install components on the D:\ drive or in the C:\apps location on the cluster.</span></span> <span data-ttu-id="11af7-209">Tous les autres emplacements sur le lecteur C:\ sont réservés.</span><span class="sxs-lookup"><span data-stu-id="11af7-209">All other locations on the C:\ drive are reserved.</span></span> <span data-ttu-id="11af7-210">Indiquez l'emplacement d'installation des applications ou bibliothèques dans le script de personnalisation de cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-210">Specify the location where applications or libraries are to be installed in the cluster customization script.</span></span>
* <span data-ttu-id="11af7-211">Garantir la haute disponibilité de l’architecture du cluster</span><span class="sxs-lookup"><span data-stu-id="11af7-211">Ensure high availability of the cluster architecture</span></span>

    <span data-ttu-id="11af7-212">HDInsight possède une architecture actif/passif pour la haute disponibilité, dans laquelle un nœud principal est en mode actif (où les services HDInsight sont en cours d'exécution) et l'autre nœud principal est en mode veille (dans lequel les services HDInsight ne sont pas en cours d’exécution).</span><span class="sxs-lookup"><span data-stu-id="11af7-212">HDInsight has an active-passive architecture for high availability, in which one head node is in active mode (where the HDInsight services are running) and the other head node is in standby mode (in which HDInsight services are not running).</span></span> <span data-ttu-id="11af7-213">Les nœuds basculent entre les modes actif et passif si les services HDInsight sont interrompus.</span><span class="sxs-lookup"><span data-stu-id="11af7-213">The nodes switch active and passive modes if HDInsight services are interrupted.</span></span> <span data-ttu-id="11af7-214">Si une action de script est utilisée pour installer les services sur les deux nœuds principaux pour la haute disponibilité, notez que le mécanisme de basculement HDInsight n’est pas en mesure de basculer automatiquement ces services installés par l'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="11af7-214">If a script action is used to install services on both head nodes for high availability, note that the HDInsight failover mechanism is not able to automatically fail over these user-installed services.</span></span> <span data-ttu-id="11af7-215">Ainsi, les services installés par l'utilisateur sur les nœuds principaux HDInsight qui sont censés être hautement disponibles doivent soit avoir leur propre mécanisme de basculement en mode actif/passif soit être en mode actif-actif.</span><span class="sxs-lookup"><span data-stu-id="11af7-215">So user-installed services on HDInsight head nodes that are expected to be highly available must either have their own failover mechanism if in active-passive mode or be in active-active mode.</span></span>

    <span data-ttu-id="11af7-216">Une commande d’action de script HDInsight s’exécute sur les deux nœuds principaux si le rôle de nœud principal est spécifié en tant que valeur dans le paramètre *ClusterRoleCollection* .</span><span class="sxs-lookup"><span data-stu-id="11af7-216">An HDInsight Script Action command runs on both head nodes when the head-node role is specified as a value in the *ClusterRoleCollection* parameter.</span></span> <span data-ttu-id="11af7-217">Par conséquent, lorsque vous concevez des scripts personnalisés, vérifiez qu'il est au fait de cette configuration.</span><span class="sxs-lookup"><span data-stu-id="11af7-217">So when you design a custom script, make sure that your script is aware of this setup.</span></span> <span data-ttu-id="11af7-218">Vous devez vous assurer que des services identiques ne sont pas installés et démarrés sur les deux nœuds principaux pour éviter les conflits.</span><span class="sxs-lookup"><span data-stu-id="11af7-218">You should not run into problems where the same services are installed and started on both of the head nodes and they end up competing with each other.</span></span> <span data-ttu-id="11af7-219">Sachez, par ailleurs, que les données seront perdues lors des réimageages ; les logiciels installés à l'aide d'actions de script ne doivent donc pas être affectés par de tels événements.</span><span class="sxs-lookup"><span data-stu-id="11af7-219">Also, be aware that data is lost during reimaging, so software installed via Script Action has to be resilient to such events.</span></span> <span data-ttu-id="11af7-220">Les applications doivent être conçues pour fonctionner avec des données hautement disponibles qui sont distribuées sur de nombreux nœuds.</span><span class="sxs-lookup"><span data-stu-id="11af7-220">Applications should be designed to work with highly available data that is distributed across many nodes.</span></span> <span data-ttu-id="11af7-221">Notez que jusqu'à 1/5 des nœuds d'un cluster peuvent être réimagés en même temps.</span><span class="sxs-lookup"><span data-stu-id="11af7-221">Note that as many as 1/5 of the nodes in a cluster can be reimaged at the same time.</span></span>
* <span data-ttu-id="11af7-222">Configurer les composants personnalisés pour utiliser le stockage d’objets blob Azure</span><span class="sxs-lookup"><span data-stu-id="11af7-222">Configure the custom components to use Azure Blob storage</span></span>

    <span data-ttu-id="11af7-223">Les composants personnalisés que vous installez sur les nœuds de cluster peuvent être configurés par défaut pour utiliser le stockage HDFS (Hadoop Distributed File System).</span><span class="sxs-lookup"><span data-stu-id="11af7-223">The custom components that you install on the cluster nodes might have a default configuration to use Hadoop Distributed File System (HDFS) storage.</span></span> <span data-ttu-id="11af7-224">Vous devez modifier la configuration de façon à utiliser plutôt le stockage d'objets blob Azure.</span><span class="sxs-lookup"><span data-stu-id="11af7-224">You should change the configuration to use Azure Blob storage instead.</span></span> <span data-ttu-id="11af7-225">Sur un réimageage de cluster, le système de fichiers HDFS est formaté et vous perdez alors toutes les données qui y sont stockées.</span><span class="sxs-lookup"><span data-stu-id="11af7-225">On a cluster reimage, the HDFS file system gets formatted and you would lose any data that is stored there.</span></span> <span data-ttu-id="11af7-226">L'utilisation du stockage d'objets blob Azure au lieu du stockage HDFS garantit que vos données sont conservées.</span><span class="sxs-lookup"><span data-stu-id="11af7-226">Using Azure Blob storage instead ensures that your data is retained.</span></span>

## <a name="common-usage-patterns"></a><span data-ttu-id="11af7-227">Modes d’utilisation courants</span><span class="sxs-lookup"><span data-stu-id="11af7-227">Common usage patterns</span></span>
<span data-ttu-id="11af7-228">Cette section fournit des conseils sur l'implémentation de certains des modèles d'utilisation courants que vous pouvez rencontrer lors de l'écriture de votre propre script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="11af7-228">This section provides guidance on implementing some of the common usage patterns that you might run into while writing your own custom script.</span></span>

### <a name="configure-environment-variables"></a><span data-ttu-id="11af7-229">Configuration des variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="11af7-229">Configure environment variables</span></span>
<span data-ttu-id="11af7-230">Dans le développement d'actions de script, il est souvent nécessaire de définir des variables d'environnement.</span><span class="sxs-lookup"><span data-stu-id="11af7-230">Often in script action development, you feel the need to set environment variables.</span></span> <span data-ttu-id="11af7-231">Par exemple, la situation suivante correspond à un scénario très probable : vous téléchargez un fichier binaire à partir d'un site externe, l’installez sur le cluster et ajoutez l'emplacement où il est installé à votre variable d'environnement « PATH ».</span><span class="sxs-lookup"><span data-stu-id="11af7-231">For instance, a most likely scenario is when you download a binary from an external site, install it on the cluster, and add the location of where it is installed to your ‘PATH’ environment variable.</span></span> <span data-ttu-id="11af7-232">L'extrait de code suivant montre comment définir des variables d'environnement dans le script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="11af7-232">The following snippet shows you how to set environment variables in the custom script.</span></span>

    Write-HDILog "Starting environment variable setting at: $(Get-Date)";
    [Environment]::SetEnvironmentVariable('MDS_RUNNER_CUSTOM_CLUSTER', 'true', 'Machine');

<span data-ttu-id="11af7-233">Cette instruction définit la variable d'environnement **MDS_RUNNER_CUSTOM_CLUSTER** sur la valeur « true » et définit également l'étendue de cette variable à l'échelle de l'ordinateur.</span><span class="sxs-lookup"><span data-stu-id="11af7-233">This statement sets the environment variable **MDS_RUNNER_CUSTOM_CLUSTER** to the value 'true' and also sets the scope of this variable to be machine-wide.</span></span> <span data-ttu-id="11af7-234">Dans certains cas, il est important que les variables d'environnement soient définies avec l’étendue appropriée (machine ou utilisateur).</span><span class="sxs-lookup"><span data-stu-id="11af7-234">At times it is important that environment variables are set at the appropriate scope – machine or user.</span></span> <span data-ttu-id="11af7-235">Cliquez [ici][1] pour obtenir plus d’informations sur la définition des variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="11af7-235">Refer [here][1] for more information on setting environment variables.</span></span>

### <a name="access-to-locations-where-the-custom-scripts-are-stored"></a><span data-ttu-id="11af7-236">Accès aux emplacements où sont stockés les scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="11af7-236">Access to locations where the custom scripts are stored</span></span>
<span data-ttu-id="11af7-237">Les scripts utilisés pour personnaliser un cluster doivent être soit dans le compte de stockage par défaut pour le cluster soit dans un conteneur public en lecture seule sur un autre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="11af7-237">Scripts used to customize a cluster needs to either be in the default storage account for the cluster or in a public read-only container on any other storage account.</span></span> <span data-ttu-id="11af7-238">Si votre script accède à des ressources situées ailleurs, celles-ci doivent se trouver dans un conteneur accessible publiquement (au moins public en lecture seule).</span><span class="sxs-lookup"><span data-stu-id="11af7-238">If your script accesses resources located elsewhere these need to be in a publicly accessible (at least public read-only).</span></span> <span data-ttu-id="11af7-239">Par exemple, vous souhaitez accéder à un fichier et l’enregistrer à l'aide de la commande HDI SaveFile.</span><span class="sxs-lookup"><span data-stu-id="11af7-239">For instance you might want to access a file and save it using the SaveFile-HDI command.</span></span>

    Save-HDIFile -SrcUri 'https://somestorageaccount.blob.core.windows.net/somecontainer/some-file.jar' -DestFile 'C:\apps\dist\hadoop-2.4.0.2.1.9.0-2196\share\hadoop\mapreduce\some-file.jar'

<span data-ttu-id="11af7-240">Dans cet exemple, vous devez vous assurer que le conteneur « somecontainer » du compte de stockage « somestorageaccount » est accessible publiquement.</span><span class="sxs-lookup"><span data-stu-id="11af7-240">In this example, you must ensure that the container 'somecontainer' in storage account 'somestorageaccount' is publicly accessible.</span></span> <span data-ttu-id="11af7-241">Sinon, le script lève une exception « Introuvable » et échoue.</span><span class="sxs-lookup"><span data-stu-id="11af7-241">Otherwise, the script throws a ‘Not Found’ exception and fail.</span></span>

### <a name="pass-parameters-to-the-add-azurermhdinsightscriptaction-cmdlet"></a><span data-ttu-id="11af7-242">Transmettez les paramètres à l’applet de commande Add-AzureRmHDInsightScriptAction</span><span class="sxs-lookup"><span data-stu-id="11af7-242">Pass parameters to the Add-AzureRmHDInsightScriptAction cmdlet</span></span>
<span data-ttu-id="11af7-243">Pour transmettre plusieurs paramètres à l’applet de commande Add-AzureRmHDInsightScriptAction, vous devez mettre en forme la valeur de chaîne pour qu’elle contienne tous les paramètres du script.</span><span class="sxs-lookup"><span data-stu-id="11af7-243">To pass multiple parameters to the Add-AzureRmHDInsightScriptAction cmdlet, you need to format the string value to contain all parameters for the script.</span></span> <span data-ttu-id="11af7-244">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="11af7-244">For example:</span></span>

    "-CertifcateUri wasb:///abc.pfx -CertificatePassword 123456 -InstallFolderName MyFolder"

<span data-ttu-id="11af7-245">or</span><span class="sxs-lookup"><span data-stu-id="11af7-245">or</span></span>

    $parameters = '-Parameters "{0};{1};{2}"' -f $CertificateName,$certUriWithSasToken,$CertificatePassword


### <a name="throw-exception-for-failed-cluster-deployment"></a><span data-ttu-id="11af7-246">Lever une exception pour l’échec d’un déploiement de cluster</span><span class="sxs-lookup"><span data-stu-id="11af7-246">Throw exception for failed cluster deployment</span></span>
<span data-ttu-id="11af7-247">Si vous souhaitez être notifié précisément du fait que la personnalisation du cluster n’a pas réussi comme prévu, il est important qu’une exception soit levée et que la création du cluster échoue.</span><span class="sxs-lookup"><span data-stu-id="11af7-247">If you want to get accurately notified of the fact that cluster customization did not succeed as expected, it is important to throw an exception and fail the cluster creation.</span></span> <span data-ttu-id="11af7-248">Par exemple, vous souhaitez traiter un fichier s'il existe et gérer la situation d'erreur si le fichier n'existe pas.</span><span class="sxs-lookup"><span data-stu-id="11af7-248">For instance, you might want to process a file if it exists and handle the error case where the file does not exist.</span></span> <span data-ttu-id="11af7-249">Cela garantira que le script s'arrête normalement et que l'état du cluster est correctement connu.</span><span class="sxs-lookup"><span data-stu-id="11af7-249">This would ensure that the script exits gracefully and the state of the cluster is correctly known.</span></span> <span data-ttu-id="11af7-250">L'extrait de code suivant fournit un exemple montrant comment y parvenir :</span><span class="sxs-lookup"><span data-stu-id="11af7-250">The following snippet gives an example of how to achieve this:</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    exit
    }

<span data-ttu-id="11af7-251">Dans cet extrait, si le fichier n’existe pas, le script peut s’arrêter de manière appropriée après l’affichage du message d’erreur et le cluster est défini sur l’état En cours d’exécution, en supposant qu’il a terminé correctement le processus de personnalisation du cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-251">In this snippet, if the file did not exist, it would lead to a state where the script actually exits gracefully after printing the error message, and the cluster reaches running state assuming it "successfully" completed cluster customization process.</span></span> <span data-ttu-id="11af7-252">Si vous souhaitez être averti précisément du fait que la personnalisation du cluster a échoué de manière inattendue en raison d’un fichier manquant, il est préférable de lever une exception et de faire échouer l’étape de personnalisation du cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-252">If you want to be accurately notified of the fact that cluster customization essentially did not succeed as expected because of a missing file, it is more appropriate to throw an exception and fail the cluster customization step.</span></span> <span data-ttu-id="11af7-253">Pour ce faire, vous devez plutôt utiliser l’extrait de code suivant.</span><span class="sxs-lookup"><span data-stu-id="11af7-253">To achieve this you must use the following sample code snippet instead.</span></span>

    If(Test-Path($SomePath)) {
        #Process file in some way
    } else {
        # File does not exist; handle error case
        # Print error message
    throw
    }


## <a name="checklist-for-deploying-a-script-action"></a><span data-ttu-id="11af7-254">Liste de vérification pour le déploiement d’une action de script</span><span class="sxs-lookup"><span data-stu-id="11af7-254">Checklist for deploying a script action</span></span>
<span data-ttu-id="11af7-255">Voici les étapes à suivre avant de déployer des scripts :</span><span class="sxs-lookup"><span data-stu-id="11af7-255">Here are the steps we took when preparing to deploy these scripts:</span></span>

1. <span data-ttu-id="11af7-256">Placez les fichiers qui contiennent les scripts personnalisés dans un emplacement accessible aux nœuds du cluster lors du déploiement.</span><span class="sxs-lookup"><span data-stu-id="11af7-256">Put the files that contain the custom scripts in a place that is accessible by the cluster nodes during deployment.</span></span> <span data-ttu-id="11af7-257">Il peut s'agir de tout compte de stockage par défaut ou supplémentaire spécifié lors du déploiement du cluster, ou de tout conteneur de stockage accessible au public.</span><span class="sxs-lookup"><span data-stu-id="11af7-257">This can be any of the default or additional Storage accounts specified at the time of cluster deployment, or any other publicly accessible storage container.</span></span>
2. <span data-ttu-id="11af7-258">Ajoutez des contrôles dans les scripts pour vous assurer qu'ils s'exécutent de manière idempotente, ce qui permet d'exécuter le script plusieurs fois sur le même nœud.</span><span class="sxs-lookup"><span data-stu-id="11af7-258">Add checks into scripts to make sure that they execute idempotently, so that the script can be executed multiple times on the same node.</span></span>
3. <span data-ttu-id="11af7-259">Utilisez l’applet de commande Azure PowerShell **Write-Output** pour imprimer dans STDOUT et dans STDERR.</span><span class="sxs-lookup"><span data-stu-id="11af7-259">Use the **Write-Output** Azure PowerShell cmdlet to print to STDOUT as well as STDERR.</span></span> <span data-ttu-id="11af7-260">N'utilisez pas **Write-Host**.</span><span class="sxs-lookup"><span data-stu-id="11af7-260">Do not use **Write-Host**.</span></span>
4. <span data-ttu-id="11af7-261">Utilisez un dossier de fichiers temporaires, tel que $env:TEMP, pour conserver le fichier téléchargé utilisé par les scripts, puis nettoyez-le au terme de l'exécution des scripts.</span><span class="sxs-lookup"><span data-stu-id="11af7-261">Use a temporary file folder, such as $env:TEMP, to keep the downloaded file used by the scripts and then clean them up after scripts have executed.</span></span>
5. <span data-ttu-id="11af7-262">5.Installez des logiciels personnalisés uniquement aux emplacements suivants : D:\ ou C:\apps.</span><span class="sxs-lookup"><span data-stu-id="11af7-262">Install custom software only at D:\ or C:\apps.</span></span> <span data-ttu-id="11af7-263">N'utilisez pas d'autres emplacements sur le lecteur C:, car ceux-ci sont réservés.</span><span class="sxs-lookup"><span data-stu-id="11af7-263">Other locations on the C: drive should not be used as they are reserved.</span></span> <span data-ttu-id="11af7-264">Notez que l'installation de fichiers sur le lecteur C: à l’extérieur du dossier C:/apps peut entraîner des erreurs d'installation lors des opérations de réimageage du nœud.</span><span class="sxs-lookup"><span data-stu-id="11af7-264">Note that installing files on the C: drive outside of the C:\apps folder may result in setup failures during reimages of the node.</span></span>
6. <span data-ttu-id="11af7-265">En cas de modification des paramètres au niveau du système d'exploitation ou des fichiers de configuration du service Hadoop, vous pouvez redémarrer les services HDInsight pour qu'ils récupèrent des paramètres au niveau du système d'exploitation, tels que les variables d'environnement définies dans les scripts.</span><span class="sxs-lookup"><span data-stu-id="11af7-265">In the event that OS-level settings or Hadoop service configuration files were changed, you may want to restart HDInsight services so that they can pick up any OS-level settings, such as the environment variables set in the scripts.</span></span>

## <a name="debug-custom-scripts"></a><span data-ttu-id="11af7-266">Déboguer des scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="11af7-266">Debug custom scripts</span></span>
<span data-ttu-id="11af7-267">Les journaux des erreurs de script et d'autres sorties sont stockés dans le compte de stockage par défaut que vous avez spécifié pour le cluster au moment de sa création.</span><span class="sxs-lookup"><span data-stu-id="11af7-267">The script error logs are stored, along with other output, in the default Storage account that you specified for the cluster at its creation.</span></span> <span data-ttu-id="11af7-268">Les journaux sont stockés dans une table nommée *u<\cluster-name-fragment><\time-stamp>setuplog*.</span><span class="sxs-lookup"><span data-stu-id="11af7-268">The logs are stored in a table with the name *u<\cluster-name-fragment><\time-stamp>setuplog*.</span></span> <span data-ttu-id="11af7-269">Il s'agit de journaux agrégés contenant des enregistrements de tous les nœuds (nœud principal et nœuds de travail) sur lesquels le script s'exécute dans le cluster.</span><span class="sxs-lookup"><span data-stu-id="11af7-269">These are aggregated logs that have records from all of the nodes (head node and worker nodes) on which the script runs in the cluster.</span></span>
<span data-ttu-id="11af7-270">Pour vérifier facilement les journaux, utilisez les outils HDInsight pour Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="11af7-270">An easy way to check the logs is to use HDInsight Tools for Visual Studio.</span></span> <span data-ttu-id="11af7-271">Pour installer les outils, consultez [Prise en main des outils Hadoop de Visual Studio pour HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span><span class="sxs-lookup"><span data-stu-id="11af7-271">For installing the tools, see [Get started using Visual Studio Hadoop tools for HDInsight](hdinsight-hadoop-visual-studio-tools-get-started.md#install-data-lake-tools-for-visual-studio)</span></span>

<span data-ttu-id="11af7-272">**Pour vérifier le journal à l’aide de Visual Studio**</span><span class="sxs-lookup"><span data-stu-id="11af7-272">**To check the log using Visual Studio**</span></span>

1. <span data-ttu-id="11af7-273">Ouvrez Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="11af7-273">Open Visual Studio.</span></span>
2. <span data-ttu-id="11af7-274">Cliquez sur **Affichage**, puis sur **Explorateur de serveurs**.</span><span class="sxs-lookup"><span data-stu-id="11af7-274">Click **View**, and then click **Server Explorer**.</span></span>
3. <span data-ttu-id="11af7-275">Cliquez avec le bouton droit sur Azure, cliquez sur Se connecter à **Abonnements Microsoft Azure**, puis entrez vos informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="11af7-275">Right-click "Azure", click Connect to **Microsoft Azure Subscriptions**, and then enter your credentials.</span></span>
4. <span data-ttu-id="11af7-276">Développez successivement **Stockage**, le compte de stockage Azure utilisé comme système de fichiers par défaut, **Tables**, puis double-cliquez sur le nom de la table.</span><span class="sxs-lookup"><span data-stu-id="11af7-276">Expand **Storage**, expand the Azure storage account used as the default file system, expand **Tables**, and then double-click the table name.</span></span>

<span data-ttu-id="11af7-277">Vous pouvez également accéder à distance aux nœuds de cluster pour voir les informations STDOUT et STDERR des scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="11af7-277">You can also remote into the cluster nodes to see both STDOUT and STDERR for custom scripts.</span></span> <span data-ttu-id="11af7-278">Les journaux de chaque nœud sont spécifiques à celui-ci et sont enregistrés dans **C:\HDInsightLogs\DeploymentAgent.log**.</span><span class="sxs-lookup"><span data-stu-id="11af7-278">The logs on each node are specific only to that node and are logged into **C:\HDInsightLogs\DeploymentAgent.log**.</span></span> <span data-ttu-id="11af7-279">Ces fichiers journaux enregistrent tous les résultats du script personnalisé.</span><span class="sxs-lookup"><span data-stu-id="11af7-279">These log files record all outputs from the custom script.</span></span> <span data-ttu-id="11af7-280">Un extrait de journal pour une action de script Spark ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="11af7-280">An example log snippet for a Spark script action looks like this:</span></span>

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand; Details : BEGIN: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Starting Spark installation at: 09/04/2014 21:46:02 Done with Spark installation at: 09/04/2014 21:46:38;

    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;
    ...

    Microsoft.Hadoop.Deployment.Engine.CustomPowershellScriptCommand;
    Details : END: Invoking powershell script https://configactions.blob.core.windows.net/sparkconfigactions/spark-installer.ps1.;
    Version : 2.1.0.0;
    ActivityId : 739e61f5-aa22-4254-aafc-9faf56fc2692;
    AzureVMName : HEADNODE0;
    IsException : False;
    ExceptionType : ;
    ExceptionMessage : ;
    InnerExceptionType : ;
    InnerExceptionMessage : ;
    Exception : ;


<span data-ttu-id="11af7-281">Dans ce journal, il apparaît clairement que l'action de script Spark a été exécutée sur la machine virtuelle nommée HEADNODE0 et qu'aucune exception n'a été générée pendant l'exécution.</span><span class="sxs-lookup"><span data-stu-id="11af7-281">In this log, it is clear that the Spark script action has been executed on the VM named HEADNODE0 and that no exceptions were thrown during the execution.</span></span>

<span data-ttu-id="11af7-282">En cas d'échec de l'exécution, la sortie décrivant cet échec est également contenue dans ce fichier journal.</span><span class="sxs-lookup"><span data-stu-id="11af7-282">In the event that an execution failure occurs, the output describing it is also contained in this log file.</span></span> <span data-ttu-id="11af7-283">Les informations fournies dans ces journaux doivent être utiles lors du débogage des problèmes de script qui peuvent survenir.</span><span class="sxs-lookup"><span data-stu-id="11af7-283">The information provided in these logs should be helpful in debugging script problems that may arise.</span></span>

## <a name="see-also"></a><span data-ttu-id="11af7-284">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="11af7-284">See also</span></span>
* <span data-ttu-id="11af7-285">[Personnaliser des clusters HDInsight à l’aide d’une action de script][hdinsight-cluster-customize]</span><span class="sxs-lookup"><span data-stu-id="11af7-285">[Customize HDInsight clusters using Script Action][hdinsight-cluster-customize]</span></span>
* <span data-ttu-id="11af7-286">[Installer et utiliser Spark sur les clusters HDInsight][hdinsight-install-spark]</span><span class="sxs-lookup"><span data-stu-id="11af7-286">[Install and use Spark on HDInsight clusters][hdinsight-install-spark]</span></span>
* <span data-ttu-id="11af7-287">[Installer et utiliser R sur les clusters HDInsight][hdinsight-r-scripts]</span><span class="sxs-lookup"><span data-stu-id="11af7-287">[Install and use R on HDInsight clusters][hdinsight-r-scripts]</span></span>
* <span data-ttu-id="11af7-288">[Installer et utiliser Solr sur les clusters HDInsight](hdinsight-hadoop-solr-install.md)</span><span class="sxs-lookup"><span data-stu-id="11af7-288">[Install and use Solr on HDInsight clusters](hdinsight-hadoop-solr-install.md).</span></span>
* <span data-ttu-id="11af7-289">[Installez et utilisez Giraph sur les clusters HDInsight](hdinsight-hadoop-giraph-install.md).</span><span class="sxs-lookup"><span data-stu-id="11af7-289">[Install and use Giraph on HDInsight clusters](hdinsight-hadoop-giraph-install.md).</span></span>

[hdinsight-provision]: hdinsight-provision-clusters.md
[hdinsight-cluster-customize]: hdinsight-hadoop-customize-cluster.md
[hdinsight-install-spark]: hdinsight-hadoop-spark-install.md
[hdinsight-r-scripts]: hdinsight-hadoop-r-scripts.md
[powershell-install-configure]: install-configure-powershell.md

<!--Reference links in article-->
[1]: https://msdn.microsoft.com/library/96xafkes(v=vs.110).aspx
