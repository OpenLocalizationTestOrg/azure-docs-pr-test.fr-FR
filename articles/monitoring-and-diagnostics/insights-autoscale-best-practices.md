---
title: "pratiques aaaBest pour la mise à l’échelle | Documents Microsoft"
description: "Modèles de mise à l’échelle automatique d’Azure pour Web Apps, Virtual Machine Scale Sets et Cloud Services"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: eb731c15e440af93a2675210583878814d0d8818
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="b4bc0-103">Meilleures pratiques pour la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-103">Best practices for Autoscale</span></span>
<span data-ttu-id="b4bc0-104">Cet article explique les meilleures pratiques tooautoscale, dans Azure.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-104">This article teaches best practices tooautoscale in Azure.</span></span> <span data-ttu-id="b4bc0-105">Mise à l’échelle du moniteur Azure s’applique uniquement trop[machines virtuelles identiques](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Services de cloud computing](https://azure.microsoft.com/services/cloud-services/), et [du Service d’applications - applications Web](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="b4bc0-105">Azure Monitor autoscale applies only too[Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="b4bc0-106">Les autres services Azure utilisent des méthodes de mise à l’échelle différentes.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="b4bc0-107">Concepts de la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-107">Autoscale concepts</span></span>
* <span data-ttu-id="b4bc0-108">Une ressource ne peut avoir qu’ *un* paramètre de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="b4bc0-109">Un paramètre de mise à l’échelle automatique peut comporter un ou plusieurs profils et chaque profil peut avoir une ou plusieurs règles de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="b4bc0-110">Un paramètre de mise à l’échelle s’adapte instances horizontalement, qui est *hors* en augmentant les instances hello et *dans* en diminuant le nombre de hello d’instances.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-110">An autoscale setting scales instances horizontally, which is *out* by increasing hello instances and *in* by decreasing hello number of instances.</span></span>
  <span data-ttu-id="b4bc0-111">Un paramètre de mise à l’échelle automatique a une valeur d’instances maximum, minimum et par défaut.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="b4bc0-112">Un travail de mise à l’échelle lit toujours hello associés aux métrique tooscale en vérifiant si elle a atteint hello le seuil configuré pour la montée en puissance parallèle ou d’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-112">An autoscale job always reads hello associated metric tooscale by, checking if it has crossed hello configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="b4bc0-113">Vous pouvez afficher une liste des mesures pour la mise à l’échelle automatique dans la rubrique [Mesures courantes de mise à l’échelle automatique Azure Monitor](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="b4bc0-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="b4bc0-114">Tous les seuils sont calculés au niveau de l’instance.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="b4bc0-115">Par exemple, « montée en puissance par 1 instance lorsque moyenne du processeur > 80 % lorsque le nombre d’instances est 2 », signifie la montée en puissance parallèle lorsque hello moyenne du processeur entre toutes les instances est supérieur à 80 %.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when hello average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="b4bc0-116">Vous recevez toujours les notifications d’erreur par e-mail.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="b4bc0-117">Plus précisément, hello propriétaire, collaborateur et les lecteurs de ressources cible de hello reçoivent le message électronique.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-117">Specifically, hello owner, contributor, and readers of hello target resource receive email.</span></span> <span data-ttu-id="b4bc0-118">Vous recevez également un e-mail de *récupération* lorsque la mise à l’échelle automatique se rétablit après une défaillance et fonctionne à nouveau normalement.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="b4bc0-119">Vous pouvez participer tooreceive une notification d’action réussie de l’échelle par e-mail et de webhooks.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-119">You can opt-in tooreceive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="b4bc0-120">Meilleures pratiques relatives à la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-120">Autoscale best practices</span></span>
<span data-ttu-id="b4bc0-121">Utilisez hello suivant les meilleures pratiques que vous utilisez la mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-121">Use hello following best practices as you use autoscale.</span></span>

### <a name="ensure-hello-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="b4bc0-122">Vérifiez les valeurs minimale et maximale hello sont différents et ont une marge suffisante entre eux</span><span class="sxs-lookup"><span data-stu-id="b4bc0-122">Ensure hello maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="b4bc0-123">Si vous disposez d’un paramètre qui a minimum = 2, maximale = 2 et le nombre d’instances actuelles hello est 2, aucune action de mise à l’échelle ne peut se produire.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-123">If you have a setting that has minimum=2, maximum=2 and hello current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="b4bc0-124">Conserver une marge suffisante entre les nombres d’instance minimum et maximum hello, qui sont inclus.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-124">Keep an adequate margin between hello maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="b4bc0-125">La mise à l’échelle agit toujours entre ces limites.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="b4bc0-126">La mise à l’échelle manuelle est réinitialisée par les valeurs min et max de mise à l’échelle</span><span class="sxs-lookup"><span data-stu-id="b4bc0-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="b4bc0-127">Si vous mettez à jour hello instance nombre tooa valeur ci-dessus manuellement ou que vous inférieure hello, hello du moteur de mise à l’échelle automatiquement met à l’échelle minimale de toohello précédent (le cas ci-dessous) ou hello maximale (le cas ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="b4bc0-127">If you manually update hello instance count tooa value above or below hello maximum, hello autoscale engine automatically scales back toohello minimum (if below) or hello maximum (if above).</span></span> <span data-ttu-id="b4bc0-128">Par exemple, vous définissez plage hello entre 3 et 6.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-128">For example, you set hello range between 3 and 6.</span></span> <span data-ttu-id="b4bc0-129">Si vous avez une instance en cours d’exécution, moteur de mise à l’échelle hello dimensionne too3 instances lors de sa prochaine exécution.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-129">If you have one running instance, hello autoscale engine scales too3 instances on its next run.</span></span> <span data-ttu-id="b4bc0-130">De même, il serait mise à l’échelle de 8 instances sauvegarder too6 lors de sa prochaine exécution.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-130">Likewise, it would scale-in 8 instances back too6 on its next run.</span></span>  <span data-ttu-id="b4bc0-131">Mise à l’échelle manuelle est temporaire, sauf si vous réinitialisez également les règles de mise à l’échelle hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-131">Manual scaling is very temporary unless you reset hello autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="b4bc0-132">Utilisez toujours une combinaison de règle d’augmentation et de diminution de la taille des instances qui exécute une augmentation et une diminution</span><span class="sxs-lookup"><span data-stu-id="b4bc0-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="b4bc0-133">Si vous utilisez uniquement une partie de la combinaison de hello, mise à l’échelle mise à l’échelle en unique, ou, jusqu'à ce que hello maximum ou minimum, a été atteint.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-133">If you use only one part of hello combination, autoscale scale-in that single out, or in, until hello maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-hello-azure-portal-and-hello-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="b4bc0-134">Ne passez pas de type hello portail Azure et hello portail Azure classic, lors de la gestion de mise à l’échelle</span><span class="sxs-lookup"><span data-stu-id="b4bc0-134">Do not switch between hello Azure portal and hello Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="b4bc0-135">Pour les Services de cloud computing et les Services d’application (applications Web), utilisez hello portail Azure (portal.azure.com) toocreate et gérer les paramètres de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-135">For Cloud Services and App Services (Web Apps), use hello Azure portal (portal.azure.com) toocreate and manage autoscale settings.</span></span> <span data-ttu-id="b4bc0-136">Pour les machines virtuelles identiques toocreate PowerShell, CLI ou l’API REST et gérer le paramètre de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API toocreate and manage autoscale setting.</span></span> <span data-ttu-id="b4bc0-137">Ne change pas entre hello portail Azure classic (manage.windowsazure.com) et hello portail Azure (portal.azure.com) lors de la gestion des configurations de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-137">Do not switch between hello Azure classic portal (manage.windowsazure.com) and hello Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="b4bc0-138">Hello portail Azure classic et ses principales sous-jacente présente des limitations.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-138">hello Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="b4bc0-139">Déplacez la mise à l’échelle de toohello toomanage portail Azure à l’aide d’une interface utilisateur graphique.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-139">Move toohello Azure portal toomanage autoscale using a graphical user interface.</span></span> <span data-ttu-id="b4bc0-140">les options de Hello sont toouse hello échelle PowerShell, CLI ou une API REST (via l’Explorateur de ressources Azure).</span><span class="sxs-lookup"><span data-stu-id="b4bc0-140">hello options are toouse hello autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-hello-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="b4bc0-141">Choisir hello de statistique appropriée pour vos métriques de diagnostic</span><span class="sxs-lookup"><span data-stu-id="b4bc0-141">Choose hello appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="b4bc0-142">Pour les métriques de diagnostics, vous pouvez choisir parmi *moyenne*, *Minimum*, *maximale* et *Total* comme une mesure tooscale par.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric tooscale by.</span></span> <span data-ttu-id="b4bc0-143">Hello plus courante est *moyenne*.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-143">hello most common statistic is *Average*.</span></span>

### <a name="choose-hello-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="b4bc0-144">Choisissez les seuils hello avec soin pour tous les types de mesure</span><span class="sxs-lookup"><span data-stu-id="b4bc0-144">Choose hello thresholds carefully for all metric types</span></span>
<span data-ttu-id="b4bc0-145">Nous vous recommandons de choisir avec soin des seuils différents pour l’augmentation de la taille des instances et la diminution de la taille des instances en fonction des pratiques.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="b4bc0-146">Nous *déconseillons* comme exemples hello ci-dessous avec les paramètres de mise à l’échelle hello des valeurs de seuil d’identiques ou très similaires pour et dans les conditions :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-146">We *do not recommend* autoscale settings like hello examples below with hello same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="b4bc0-147">Augmenter les instances de 1 lorsque le nombre de threads <= 600</span><span class="sxs-lookup"><span data-stu-id="b4bc0-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="b4bc0-148">Diminuer les instances de 1 lorsque le nombre de threads >= 600</span><span class="sxs-lookup"><span data-stu-id="b4bc0-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="b4bc0-149">Examinons un exemple de ce qui peut entraîner le comportement tooa qui peut sembler déroutant.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-149">Let's look at an example of what can lead tooa behavior that may seem confusing.</span></span> <span data-ttu-id="b4bc0-150">Envisagez de hello suivant la séquence.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-150">Consider hello following sequence.</span></span>

1. <span data-ttu-id="b4bc0-151">Supposons il existe 2 toobegin instances avec et le nombre moyen de hello de threads par instance développe ensuite too625.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-151">Assume there are 2 instances toobegin with and then hello average number of threads per instance grows too625.</span></span>
2. <span data-ttu-id="b4bc0-152">La mise à l’échelle automatique augmente la taille des instances en ajoutant une 3ème instance.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="b4bc0-153">Ensuite, supposons que le nombre de threads de moyenne hello sur l’instance trouve too575.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-153">Next, assume that hello average thread count across instance falls too575.</span></span>
4. <span data-ttu-id="b4bc0-154">Avant la mise à l’échelle vers le bas, mise à l’échelle tente tooestimate quel état final hello sera si elle est redimensionnée dans.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-154">Before scaling down, autoscale tries tooestimate what hello final state will be if it scaled in.</span></span> <span data-ttu-id="b4bc0-155">Par exemple, 575 x 3 (nombre d’instances actuel) = 1 725 / 2 (nombre final d’instances lors de la descente en puissance) = 862,5 threads.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="b4bc0-156">Cela signifie qu’autoscale aurait tooimmediately montée en puissance parallèle à nouveau même après que elle à l’échelle, si hello moyen thread count reste hello même ou même situe uniquement une petite quantité.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-156">This means autoscale would have tooimmediately scale-out again even after it scaled in, if hello average thread count remains hello same or even falls only a small amount.</span></span> <span data-ttu-id="b4bc0-157">Toutefois, si elle mis à l’échelle, reprenez d’ensemble du processus hello, début boucle infinie de tooan.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-157">However, if it scaled up again, hello whole process would repeat, leading tooan infinite loop.</span></span>
5. <span data-ttu-id="b4bc0-158">tooavoid cette situation (appelée « battements »), mise à l’échelle n’évolue pas vers le bas du tout.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-158">tooavoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="b4bc0-159">Au lieu de cela, il ignore et réévalue condition hello nouveau hello prochaine heure hello du service s’exécute.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-159">Instead, it skips and reevaluates hello condition again hello next time hello service's job executes.</span></span> <span data-ttu-id="b4bc0-160">Cela pourrait perturber de nombreuses personnes, car la mise à l’échelle ne s’affichent toowork lorsque le nombre de threads moyenne hello était 575.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-160">This could confuse many people because autoscale wouldn't appear toowork when hello average thread count was 575.</span></span>

<span data-ttu-id="b4bc0-161">Estimation lors d’une mise à l’échelle est prévue tooavoid « bagottement » les situations où les actions de mise à l’échelle et de montée en puissance parallèle accéder en permanence dans les deux sens.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-161">Estimation during a scale-in is intended tooavoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="b4bc0-162">Gardez ce comportement à l’esprit lorsque vous choisissez hello mêmes seuils pour la montée en puissance parallèle et dans.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-162">Keep this behavior in mind when you choose hello same thresholds for scale-out and in.</span></span>

<span data-ttu-id="b4bc0-163">Nous vous recommandons de choisir une marge suffisante entre hello montée en puissance parallèle et de seuils.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-163">We recommend choosing an adequate margin between hello scale-out and in thresholds.</span></span> <span data-ttu-id="b4bc0-164">Par exemple, considérez hello suivant la meilleure combinaison de la règle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-164">As an example, consider hello following better rule combination.</span></span>

* <span data-ttu-id="b4bc0-165">Augmenter les instances de 1 lorsque le % du processeur >= 80</span><span class="sxs-lookup"><span data-stu-id="b4bc0-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="b4bc0-166">Diminuer les instances de 1 lorsque le % du processeur <= 60</span><span class="sxs-lookup"><span data-stu-id="b4bc0-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="b4bc0-167">Dans ce cas</span><span class="sxs-lookup"><span data-stu-id="b4bc0-167">In this case</span></span>  

1. <span data-ttu-id="b4bc0-168">Supposons que 2 toostart instances avec.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-168">Assume there are 2 instances toostart with.</span></span>
2. <span data-ttu-id="b4bc0-169">Si hello % de l’UC moyenne entre les instances est too80, mise à l’échelle dotée de l’ajout d’une troisième instance de.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-169">If hello average CPU% across instances goes too80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="b4bc0-170">Supposons maintenant que sur le temps hello processeur % situe too60.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-170">Now assume that over time hello CPU% falls too60.</span></span>
4. <span data-ttu-id="b4bc0-171">L’échelle de règle de mise à l’échelle évalue l’état final de hello s’il s’agissait de tooscale.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-171">Autoscale's scale-in rule estimates hello final state if it were tooscale-in.</span></span> <span data-ttu-id="b4bc0-172">Par exemple, 60 x 3 (nombre d’instances actuel) = 180 / 2 (nombre final d’instances lors de la descente en puissance) = 90.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="b4bc0-173">Par conséquent, mise à l’échelle ne pas échelle-dans, car cela aurait tooscale montée immédiatement.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-173">So autoscale does not scale-in because it would have tooscale-out again immediately.</span></span> <span data-ttu-id="b4bc0-174">Au lieu de cela, elle ignore la descente en puissance.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="b4bc0-175">échelle de temps suivant Hello vérifie, hello du processeur continue toofall too50.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-175">hello next time autoscale checks, hello CPU continues toofall too50.</span></span> <span data-ttu-id="b4bc0-176">Elle estime à nouveau - instance 50 x 3 = 150 / 2 instances = 75, ce qui est sous le seuil de montée en puissance parallèle hello 80, afin qu’il met à l’échelle dans les instances de too2 avec succès.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below hello scale-out threshold of 80, so it scales in successfully too2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="b4bc0-177">Considérations relatives aux valeurs de seuil de la mise à l’échelle pour les mesures spéciales</span><span class="sxs-lookup"><span data-stu-id="b4bc0-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="b4bc0-178">Pour les mesures spéciales telles que métrique de longueur de file d’attente du Bus de Service ou de stockage, seuil de hello est le nombre moyen de hello de messages disponibles par le nombre actuel d’instances.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-178">For special metrics such as Storage or Service Bus Queue length metric, hello threshold is hello average number of messages available per current number of instances.</span></span> <span data-ttu-id="b4bc0-179">Choisissez soigneusement hello choisir la valeur de seuil de hello pour cette mesure.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-179">Carefully choose hello choose hello threshold value for this metric.</span></span>

<span data-ttu-id="b4bc0-180">Nous allons illustrer avec un exemple tooensure vous comprenez le comportement de hello mieux.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-180">Let's illustrate it with an example tooensure you understand hello behavior better.</span></span>

* <span data-ttu-id="b4bc0-181">Augmenter les instances de 1 lorsque le nombre de messages de file d’attente de stockage >= 50</span><span class="sxs-lookup"><span data-stu-id="b4bc0-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="b4bc0-182">Diminuer les instances de 1 lorsque le nombre de messages de file d’attente de stockage <= 10</span><span class="sxs-lookup"><span data-stu-id="b4bc0-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="b4bc0-183">Tenez compte des hello suivant séquence :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-183">Consider hello following sequence:</span></span>

1. <span data-ttu-id="b4bc0-184">Il existe 2 instances de file d’attente de stockage.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="b4bc0-185">Messages conservent à venir et lorsque vous examinez la file d’attente de stockage hello, nombre total de hello lit 50.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-185">Messages keep coming and when you review hello storage queue, hello total count reads 50.</span></span> <span data-ttu-id="b4bc0-186">Vous pourriez supposer que la mise à l’échelle automatique devrait démarrer une action de montée en charge.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="b4bc0-187">Toutefois, notez que le nombre de messages par instance est de 50/2 = 25 messages.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="b4bc0-188">Par conséquent, la montée en charge ne se produit pas.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-188">So, scale-out does not occur.</span></span> <span data-ttu-id="b4bc0-189">Pour hello premier toohappen de montée en puissance parallèle, le nombre de messages total hello dans la file d’attente de stockage hello doit être 100.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-189">For hello first scale-out toohappen, hello total message count in hello storage queue should be 100.</span></span>
3. <span data-ttu-id="b4bc0-190">Ensuite, supposons que le nombre de messages total hello atteint 100.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-190">Next, assume that hello total message count reaches 100.</span></span>
4. <span data-ttu-id="b4bc0-191">Une instance de file d’attente de stockage 3e est ajoutée en raison de l’action de montée en puissance parallèle tooa.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-191">A 3rd storage queue instance is added due tooa scale-out action.</span></span>  <span data-ttu-id="b4bc0-192">Hello prochaine action montée en puissance parallèle n’aura lieu que hello total nombre de messages dans la file d’attente hello atteint 150 car 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-192">hello next scale-out action will not happen until hello total message count in hello queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="b4bc0-193">Nombre de hello de messages dans la file d’attente hello obtient désormais plus petit.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-193">Now hello number of messages in hello queue gets smaller.</span></span> <span data-ttu-id="b4bc0-194">Avec 3 instances, hello première échelle dans action qui se produit lorsque hello nombre total de messages dans les files d’attente additionner too30 car 30/3 = 10 messages par instance, qui est le seuil d’échelle dans hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-194">With 3 instances, hello first scale-in action happens when hello total messages in all queues add up too30 because 30/3 = 10 messages per instance, which is hello scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="b4bc0-195">Considérations relatives à la mise à l’échelle lorsque plusieurs profils sont configurés dans un paramètre de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="b4bc0-196">Dans un paramètre de mise à l’échelle automatique, vous pouvez choisir un profil par défaut, qui est toujours appliqué indépendamment de toute planification ou de l’heure, ou vous pouvez choisir un profil récurrent ou un profil pour une durée fixe avec une plage de dates et d’heures.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="b4bc0-197">Lorsque le service de mise à l’échelle les traite, il vérifie toujours Bonjour suivant l’ordre :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-197">When autoscale service processes them, it always checks in hello following order:</span></span>

1. <span data-ttu-id="b4bc0-198">Profil de date fixe</span><span class="sxs-lookup"><span data-stu-id="b4bc0-198">Fixed Date profile</span></span>
2. <span data-ttu-id="b4bc0-199">Profil récurrent</span><span class="sxs-lookup"><span data-stu-id="b4bc0-199">Recurring profile</span></span>
3. <span data-ttu-id="b4bc0-200">Profil par défaut (« Toujours »)</span><span class="sxs-lookup"><span data-stu-id="b4bc0-200">Default ("Always") profile</span></span>

<span data-ttu-id="b4bc0-201">Si une profil condition est remplie, mise à l’échelle ne vérifie pas de condition de profil suivante hello en dessous.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-201">If a profile condition is met, autoscale does not check hello next profile condition below it.</span></span> <span data-ttu-id="b4bc0-202">La mise à l’échelle automatique ne traite qu’un seul profil à la fois.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="b4bc0-203">Cela signifie que si vous souhaitez tooalso incluent une condition de traitement d’un profil de niveau inférieur, vous devez inclure ces règles également dans le profil actuel de hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-203">This means if you want tooalso include a processing condition from a lower-tier profile, you must include those rules as well in hello current profile.</span></span>

<span data-ttu-id="b4bc0-204">Examinons cela à l’aide d’un exemple :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-204">Let's review this using an example:</span></span>

<span data-ttu-id="b4bc0-205">image de Hello ci-dessous illustre un paramètre de mise à l’échelle avec un profil par défaut d’instances minimum = instances 2 et maximales = 10.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-205">hello image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="b4bc0-206">Dans cet exemple, les règles sont tooscale configuré à la sortie lorsque le nombre de messages hello dans la file d’attente hello est supérieur à 10 et de la mise à l’échelle lorsque le nombre de messages hello dans la file d’attente hello est inférieure à 3.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-206">In this example, rules are configured tooscale-out when hello message count in hello queue is greater than 10 and scale-in when hello message count in hello queue is less than 3.</span></span> <span data-ttu-id="b4bc0-207">Désormais, les ressources hello peuvent évoluer entre 2 et 10 instances.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-207">So now hello resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="b4bc0-208">En outre, il existe un profil récurrent défini pour Lundi.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="b4bc0-209">Il est défini pour des instances minimum = 2 et des instances maximum = 12.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="b4bc0-210">Cela signifie que le lundi, échelle de temps de première hello vérifie cette condition, si le nombre d’instances hello est 2, il met à l’échelle toohello nouveau minimum de 3.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-210">This means on Monday, hello first time autoscale checks for this condition, if hello instance count is 2, it scales toohello new minimum of 3.</span></span> <span data-ttu-id="b4bc0-211">Tant que la mise à l’échelle continue toofind cette condition profil mis en correspondance (lundi), elle traite uniquement en fonction de l’UC scale-out/dans règles hello configurés pour ce profil.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-211">As long as autoscale continues toofind this profile condition matched (Monday), it only processes hello CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="b4bc0-212">À ce stade, il ne vérifie pas la longueur de file d’attente hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-212">At this time, it does not check for hello queue length.</span></span> <span data-ttu-id="b4bc0-213">Toutefois, si vous voulez également hello toobe du condition longueur de file d’attente activée, vous devez inclure également ces règles de profil par défaut de hello dans votre profil lundi.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-213">However, if you also want hello queue length condition toobe checked, you should include those rules from hello default profile as well in your Monday profile.</span></span>

<span data-ttu-id="b4bc0-214">De même, lors de la mise à l’échelle bascule le profil par défaut de toohello précédent, il vérifie d’abord si les conditions minimales et maximales hello sont remplies.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-214">Similarly, when autoscale switches back toohello default profile, it first checks if hello minimum and maximum conditions are met.</span></span> <span data-ttu-id="b4bc0-215">Si le nombre de hello d’instances au moment de hello est 12, il met à l’échelle dans too10, hello maximale autorisée pour le profil par défaut de hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-215">If hello number of instances at hello time is 12, it scales in too10, hello maximum allowed for hello default profile.</span></span>

![paramètres de mise à l’échelle automatique](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="b4bc0-217">Considérations relatives à la mise à l’échelle lorsque plusieurs règles sont configurées dans un profil</span><span class="sxs-lookup"><span data-stu-id="b4bc0-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="b4bc0-218">Il existe des cas où vous avez peut-être tooset plusieurs règles dans un profil.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-218">There are cases where you may have tooset multiple rules in a profile.</span></span> <span data-ttu-id="b4bc0-219">Hello suivant l’ensemble de règles de mise à l’échelle est utilisé par les services utilisent lorsque plusieurs règles sont définies.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-219">hello following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="b4bc0-220">Pour *l’augmentation de la taille des instances*, la mise à l’échelle automatique s’exécute si une règle est respectée.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="b4bc0-221">Sur *dans l’échelle*, mise à l’échelle requièrent toutes les règles toobe remplie.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-221">On *scale-in*, autoscale require all rules toobe met.</span></span>

<span data-ttu-id="b4bc0-222">tooillustrate, supposez que vous avez hello suivant les règles de mise à l’échelle 4 :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-222">tooillustrate, assume that you have hello following 4 autoscale rules:</span></span>

* <span data-ttu-id="b4bc0-223">Si UC < 30 %, diminuer la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="b4bc0-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="b4bc0-224">Si Mémoire < 50 %, diminuer la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="b4bc0-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="b4bc0-225">Si UC > 75 %, augmenter la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="b4bc0-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="b4bc0-226">Si Mémoire > 75 %, augmenter la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="b4bc0-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="b4bc0-227">Puis hello suivante se produit :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-227">Then hello follow occurs:</span></span>

* <span data-ttu-id="b4bc0-228">Si le processeur est de 76 % et la mémoire est de 50 %, une augmentation de la taille des instances se produit.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="b4bc0-229">Si le processeur est de 50 % et la mémoire est de 76 %, une augmentation de la taille des instances se produit.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="b4bc0-230">Hello d’autre part, si le processeur est 25 % et la mémoire est mise à l’échelle de 51 % **pas** dans l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-230">On hello other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="b4bc0-231">Dans l’ordre dans tooscale, processeur doit être 29 % et la mémoire 49 %.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-231">In order tooscale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="b4bc0-232">Sélectionnez toujours un nombre d’instances par défaut sans échec</span><span class="sxs-lookup"><span data-stu-id="b4bc0-232">Always select a safe default instance count</span></span>
<span data-ttu-id="b4bc0-233">nombre d’instances par défaut Hello est important de mise à l’échelle met à l’échelle le nombre de toothat service lorsque les mesures ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-233">hello default instance count is important autoscale scales your service toothat count when metrics are not available.</span></span> <span data-ttu-id="b4bc0-234">Par conséquent, sélectionnez un nombre d’instances par défaut qui est sécurisé pour vos charges de travail.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="b4bc0-235">Configuration des notifications de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="b4bc0-235">Configure autoscale notifications</span></span>
<span data-ttu-id="b4bc0-236">Mise à l’échelle avertit les administrateurs de hello et collaborateurs de ressource de hello par courrier électronique en cas de hello conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="b4bc0-236">Autoscale notifies hello administrators and contributors of hello resource by email if any of hello following conditions occur:</span></span>

* <span data-ttu-id="b4bc0-237">service de mise à l’échelle échoue tootake une action.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-237">autoscale service fails tootake an action.</span></span>
* <span data-ttu-id="b4bc0-238">Métriques ne sont pas disponibles pour le service de mise à l’échelle toomake une décision de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-238">Metrics are not available for autoscale service toomake a scale decision.</span></span>
* <span data-ttu-id="b4bc0-239">Les métriques sont disponible (récupération) à nouveau toomake une décision de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-239">Metrics are available (recovery) again toomake a scale decision.</span></span>
  <span data-ttu-id="b4bc0-240">En outre toohello les conditions ci-dessus, vous pouvez configurer tooget de notifications par courrier électronique ou webhook notifié des actions de mise à l’échelle réussie.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-240">In addition toohello conditions above, you can configure email or webhook notifications tooget notified for successful scale actions.</span></span>
  
<span data-ttu-id="b4bc0-241">Vous pouvez également utiliser un état d’intégrité de journal d’activité toomonitor alerte hello du moteur de mise à l’échelle hello.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-241">You can also use an Activity Log alert toomonitor hello health of hello autoscale engine.</span></span> <span data-ttu-id="b4bc0-242">Voici des exemples trop[créer une alerte de journal activité toomonitor toutes les opérations du moteur de mise à l’échelle de votre abonnement](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) ou trop[créer une alerte de journal activité toomonitor tout échec de la mise à l’échelle de la mise à l’échelle dans / mise à l’échelle des opérations votre abonnement](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="b4bc0-242">Here are examples too[create an Activity Log Alert toomonitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or too[create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="b4bc0-243">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="b4bc0-243">Next Steps</span></span>
- [<span data-ttu-id="b4bc0-244">Créer une alerte de journal activité toomonitor toutes les opérations du moteur de mise à l’échelle de votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="b4bc0-244">Create an Activity Log Alert toomonitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="b4bc0-245">Créer une alerte de journal activité toomonitor tout échec de la mise à l’échelle de la mise à l’échelle dans / monter en charge les opérations de votre abonnement</span><span class="sxs-lookup"><span data-stu-id="b4bc0-245">Create an Activity Log Alert toomonitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
