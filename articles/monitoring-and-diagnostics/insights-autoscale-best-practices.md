---
title: "Bonnes pratiques pour la mise à l’échelle automatique | Microsoft Docs"
description: "Modèles de mise à l’échelle automatique d’Azure pour Web Apps, Virtual Machine Scale Sets et Cloud Services"
author: anirudhcavale
manager: orenr
editor: 
services: monitoring-and-diagnostics
documentationcenter: monitoring-and-diagnostics
ms.assetid: 9fa2b94b-dfa5-4106-96ff-74fd1fba4657
ms.service: monitoring-and-diagnostics
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/07/2017
ms.author: ancav
ms.openlocfilehash: 54dad831287376db7fb2dc46e4591be1499dc072
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="best-practices-for-autoscale"></a><span data-ttu-id="bb78c-103">Meilleures pratiques pour la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-103">Best practices for Autoscale</span></span>
<span data-ttu-id="bb78c-104">Cet article présente les bonnes pratiques relatives à la mise à l’échelle automatique dans Azure.</span><span class="sxs-lookup"><span data-stu-id="bb78c-104">This article teaches best practices to autoscale in Azure.</span></span> <span data-ttu-id="bb78c-105">La mise à l’échelle automatique Azure Monitor s’applique uniquement aux [jeux de mise à l’échelle de machine virtuelle](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [services cloud](https://azure.microsoft.com/services/cloud-services/) et à [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span><span class="sxs-lookup"><span data-stu-id="bb78c-105">Azure Monitor autoscale applies only to [Virtual Machine Scale Sets](https://azure.microsoft.com/services/virtual-machine-scale-sets/), [Cloud Services](https://azure.microsoft.com/services/cloud-services/), and [App Service - Web Apps](https://azure.microsoft.com/services/app-service/web/).</span></span> <span data-ttu-id="bb78c-106">Les autres services Azure utilisent des méthodes de mise à l’échelle différentes.</span><span class="sxs-lookup"><span data-stu-id="bb78c-106">Other Azure services use different scaling methods.</span></span>

## <a name="autoscale-concepts"></a><span data-ttu-id="bb78c-107">Concepts de la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-107">Autoscale concepts</span></span>
* <span data-ttu-id="bb78c-108">Une ressource ne peut avoir qu’ *un* paramètre de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-108">A resource can have only *one* autoscale setting</span></span>
* <span data-ttu-id="bb78c-109">Un paramètre de mise à l’échelle automatique peut comporter un ou plusieurs profils et chaque profil peut avoir une ou plusieurs règles de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-109">An autoscale setting can have one or more profiles and each profile can have one or more autoscale rules.</span></span>
* <span data-ttu-id="bb78c-110">Un paramètre de mise à l’échelle automatique met à l’échelle les instances horizontalement, c’est-à-dire vers *l’extérieur* en augmentant la taille des instances et vers *l’intérieur* en diminuant la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-110">An autoscale setting scales instances horizontally, which is *out* by increasing the instances and *in* by decreasing the number of instances.</span></span>
  <span data-ttu-id="bb78c-111">Un paramètre de mise à l’échelle automatique a une valeur d’instances maximum, minimum et par défaut.</span><span class="sxs-lookup"><span data-stu-id="bb78c-111">An autoscale setting has a maximum, minimum, and default value of instances.</span></span>
* <span data-ttu-id="bb78c-112">Une tâche de mise à l’échelle automatique lit la mesure associée à mettre à l’échelle, en vérification qu’elle a dépassé le seuil configuré pour l’augmentation ou la diminution de taille d’instance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-112">An autoscale job always reads the associated metric to scale by, checking if it has crossed the configured threshold for scale-out or scale-in.</span></span> <span data-ttu-id="bb78c-113">Vous pouvez afficher une liste des mesures pour la mise à l’échelle automatique dans la rubrique [Mesures courantes de mise à l’échelle automatique Azure Monitor](insights-autoscale-common-metrics.md).</span><span class="sxs-lookup"><span data-stu-id="bb78c-113">You can view a list of metrics that autoscale can scale by at [Azure Monitor autoscaling common metrics](insights-autoscale-common-metrics.md).</span></span>
* <span data-ttu-id="bb78c-114">Tous les seuils sont calculés au niveau de l’instance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-114">All thresholds are calculated at an instance level.</span></span> <span data-ttu-id="bb78c-115">Par exemple, « l’augmentation de la taille des instances de 1 instance lorsque la moyenne du processeur est supérieure à 80 % quand le nombre d’instances est égal à 2 » signifie l’augmentation de la taille des instances lorsque la moyenne du processeur sur toutes les instances est supérieure à 80 %.</span><span class="sxs-lookup"><span data-stu-id="bb78c-115">For example, "scale out by 1 instance when average CPU > 80% when instance count is 2", means scale-out when the average CPU across all instances is greater than 80%.</span></span>
* <span data-ttu-id="bb78c-116">Vous recevez toujours les notifications d’erreur par e-mail.</span><span class="sxs-lookup"><span data-stu-id="bb78c-116">You always receive failure notifications via email.</span></span> <span data-ttu-id="bb78c-117">Plus précisément, le propriétaire, le collaborateur et les lecteurs de la ressource cible reçoivent un e-mail.</span><span class="sxs-lookup"><span data-stu-id="bb78c-117">Specifically, the owner, contributor, and readers of the target resource receive email.</span></span> <span data-ttu-id="bb78c-118">Vous recevez également un e-mail de *récupération* lorsque la mise à l’échelle automatique se rétablit après une défaillance et fonctionne à nouveau normalement.</span><span class="sxs-lookup"><span data-stu-id="bb78c-118">You also always receive a *recovery* email when autoscale recovers from a failure and starts functioning normally.</span></span>
* <span data-ttu-id="bb78c-119">Vous pouvez choisir de recevoir une notification d’action réussie de mise à l’échelle par e-mail et webhooks.</span><span class="sxs-lookup"><span data-stu-id="bb78c-119">You can opt-in to receive a successful scale action notification via email and webhooks.</span></span>

## <a name="autoscale-best-practices"></a><span data-ttu-id="bb78c-120">Meilleures pratiques relatives à la mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-120">Autoscale best practices</span></span>
<span data-ttu-id="bb78c-121">Utilisez les meilleures pratiques suivantes lorsque vous utilisez la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-121">Use the following best practices as you use autoscale.</span></span>

### <a name="ensure-the-maximum-and-minimum-values-are-different-and-have-an-adequate-margin-between-them"></a><span data-ttu-id="bb78c-122">Vérifiez que les valeurs minimales et maximales sont différentes et séparées par une marge suffisante.</span><span class="sxs-lookup"><span data-stu-id="bb78c-122">Ensure the maximum and minimum values are different and have an adequate margin between them</span></span>
<span data-ttu-id="bb78c-123">Si le paramètre a une valeur minimum = 2, une valeur maximum = 2 et que le nombre d’instances actuel est égal à 2, aucune action de mise à l’échelle ne peut se produire.</span><span class="sxs-lookup"><span data-stu-id="bb78c-123">If you have a setting that has minimum=2, maximum=2 and the current instance count is 2, no scale action can occur.</span></span> <span data-ttu-id="bb78c-124">Conservez une marge suffisante entre les nombres d’instances minimum et maximum, qui sont inclusifs.</span><span class="sxs-lookup"><span data-stu-id="bb78c-124">Keep an adequate margin between the maximum and minimum instance counts, which are inclusive.</span></span> <span data-ttu-id="bb78c-125">La mise à l’échelle agit toujours entre ces limites.</span><span class="sxs-lookup"><span data-stu-id="bb78c-125">Autoscale always scales between these limits.</span></span>

### <a name="manual-scaling-is-reset-by-autoscale-min-and-max"></a><span data-ttu-id="bb78c-126">La mise à l’échelle manuelle est réinitialisée par les valeurs min et max de mise à l’échelle</span><span class="sxs-lookup"><span data-stu-id="bb78c-126">Manual scaling is reset by autoscale min and max</span></span>
<span data-ttu-id="bb78c-127">Si vous mettez à jour manuellement le nombre d’instances avec une valeur inférieure au minimum ou supérieure au maximum, le moteur de mise à l’échelle s’ajuste automatiquement à la valeur minimale (si elle est inférieure) ou à la valeur maximale (le cas ci-dessus).</span><span class="sxs-lookup"><span data-stu-id="bb78c-127">If you manually update the instance count to a value above or below the maximum, the autoscale engine automatically scales back to the minimum (if below) or the maximum (if above).</span></span> <span data-ttu-id="bb78c-128">Par exemple, vous définissez la plage entre 3 et 6.</span><span class="sxs-lookup"><span data-stu-id="bb78c-128">For example, you set the range between 3 and 6.</span></span> <span data-ttu-id="bb78c-129">Si vous avez une seule instance en cours d’exécution, le moteur de mise à l’échelle automatique met à l’échelle sur 3 instances lors de sa prochaine exécution.</span><span class="sxs-lookup"><span data-stu-id="bb78c-129">If you have one running instance, the autoscale engine scales to 3 instances on its next run.</span></span> <span data-ttu-id="bb78c-130">De même, pour 8 instances, il diminuerait ce nombre à 6 lors de sa prochaine exécution.</span><span class="sxs-lookup"><span data-stu-id="bb78c-130">Likewise, it would scale-in 8 instances back to 6 on its next run.</span></span>  <span data-ttu-id="bb78c-131">La mise à l’échelle manuelle est temporaire, sauf si vous réinitialisez aussi les règles de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="bb78c-131">Manual scaling is very temporary unless you reset the autoscale rules as well.</span></span>

### <a name="always-use-a-scale-out-and-scale-in-rule-combination-that-performs-an-increase-and-decrease"></a><span data-ttu-id="bb78c-132">Utilisez toujours une combinaison de règle d’augmentation et de diminution de la taille des instances qui exécute une augmentation et une diminution</span><span class="sxs-lookup"><span data-stu-id="bb78c-132">Always use a scale-out and scale-in rule combination that performs an increase and decrease</span></span>
<span data-ttu-id="bb78c-133">Si vous n’utilisez qu’une partie de la combinaison, la mise à l’échelle automatique augmente ou diminue la taille des instances uniquement pour cette partie jusqu’à ce que la valeur maximum ou minimum soit atteinte.</span><span class="sxs-lookup"><span data-stu-id="bb78c-133">If you use only one part of the combination, autoscale scale-in that single out, or in, until the maximum, or minimum, is reached.</span></span>

### <a name="do-not-switch-between-the-azure-portal-and-the-azure-classic-portal-when-managing-autoscale"></a><span data-ttu-id="bb78c-134">Ne basculez pas entre le portail Azure et le portail Azure Classic lors de la gestion de la mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-134">Do not switch between the Azure portal and the Azure classic portal when managing Autoscale</span></span>
<span data-ttu-id="bb78c-135">Pour Services cloud et App Services (Web Apps), utilisez le portail Azure (portal.azure.com) pour créer et gérer les paramètres de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-135">For Cloud Services and App Services (Web Apps), use the Azure portal (portal.azure.com) to create and manage autoscale settings.</span></span> <span data-ttu-id="bb78c-136">Pour Virtual Machine Scale Sets, utilisez PowerShell, l’interface de ligne de commande (CLI) ou l’API REST pour créer et gérer les paramètres de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-136">For Virtual Machine Scale Sets use PowerShell, CLI or REST API to create and manage autoscale setting.</span></span> <span data-ttu-id="bb78c-137">Ne basculez pas entre le portail Azure Classic (manage.windowsazure.com) et le portail Azure (portal.azure.com) lors de la gestion des configurations de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-137">Do not switch between the Azure classic portal (manage.windowsazure.com) and the Azure portal (portal.azure.com) when managing autoscale configurations.</span></span> <span data-ttu-id="bb78c-138">Le portail Azure Classic et son serveur principal sous-jacent présentent des limitations.</span><span class="sxs-lookup"><span data-stu-id="bb78c-138">The Azure classic portal and its underlying backend has limitations.</span></span> <span data-ttu-id="bb78c-139">Accédez au portail Azure pour gérer la mise à l’échelle automatique à l’aide d’une interface utilisateur graphique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-139">Move to the Azure portal to manage autoscale using a graphical user interface.</span></span> <span data-ttu-id="bb78c-140">Les options disponibles sont : Autoscale PowerShell, l’interface de ligne de commande (CLI) ou l’API REST (via Azure Resource Explorer).</span><span class="sxs-lookup"><span data-stu-id="bb78c-140">The options are to use the autoscale PowerShell, CLI or REST API (via Azure Resource Explorer).</span></span>

### <a name="choose-the-appropriate-statistic-for-your-diagnostics-metric"></a><span data-ttu-id="bb78c-141">Sélection de la statistique appropriée pour votre mesure de diagnostic</span><span class="sxs-lookup"><span data-stu-id="bb78c-141">Choose the appropriate statistic for your diagnostics metric</span></span>
<span data-ttu-id="bb78c-142">Pour les mesures de diagnostics, vous pouvez choisir entre *Moyen*, *Minimum*, *Maximum* et *Total* comme mesure de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="bb78c-142">For diagnostics metrics, you can choose among *Average*, *Minimum*, *Maximum* and *Total* as a metric to scale by.</span></span> <span data-ttu-id="bb78c-143">La statistique la plus courante est *Moyen*.</span><span class="sxs-lookup"><span data-stu-id="bb78c-143">The most common statistic is *Average*.</span></span>

### <a name="choose-the-thresholds-carefully-for-all-metric-types"></a><span data-ttu-id="bb78c-144">Sélection des seuils pour tous les types de mesure</span><span class="sxs-lookup"><span data-stu-id="bb78c-144">Choose the thresholds carefully for all metric types</span></span>
<span data-ttu-id="bb78c-145">Nous vous recommandons de choisir avec soin des seuils différents pour l’augmentation de la taille des instances et la diminution de la taille des instances en fonction des pratiques.</span><span class="sxs-lookup"><span data-stu-id="bb78c-145">We recommend carefully choosing different thresholds for scale-out and scale-in based on practical situations.</span></span>

<span data-ttu-id="bb78c-146">Nous vous *déconseillons* de choisir des paramètres de mise à l’échelle tels que les exemples ci-dessous, avec des valeurs de seuil très similaires ou identiques pour l’augmentation et la diminution de la taille des instances :</span><span class="sxs-lookup"><span data-stu-id="bb78c-146">We *do not recommend* autoscale settings like the examples below with the same or very similar threshold values for out and in conditions:</span></span>

* <span data-ttu-id="bb78c-147">Augmenter les instances de 1 lorsque le nombre de threads <= 600</span><span class="sxs-lookup"><span data-stu-id="bb78c-147">Increase instances by 1 count when Thread Count <= 600</span></span>
* <span data-ttu-id="bb78c-148">Diminuer les instances de 1 lorsque le nombre de threads >= 600</span><span class="sxs-lookup"><span data-stu-id="bb78c-148">Decrease instances by 1 count when Thread Count >= 600</span></span>

<span data-ttu-id="bb78c-149">Examinons un exemple de ce qui peut entraîner un comportement qui peut sembler déroutant.</span><span class="sxs-lookup"><span data-stu-id="bb78c-149">Let's look at an example of what can lead to a behavior that may seem confusing.</span></span> <span data-ttu-id="bb78c-150">Examinez la séquence suivante.</span><span class="sxs-lookup"><span data-stu-id="bb78c-150">Consider the following sequence.</span></span>

1. <span data-ttu-id="bb78c-151">Supposons qu’il existe 2 instances pour commencer et ensuite, le nombre moyen de threads par instance atteint 625.</span><span class="sxs-lookup"><span data-stu-id="bb78c-151">Assume there are 2 instances to begin with and then the average number of threads per instance grows to 625.</span></span>
2. <span data-ttu-id="bb78c-152">La mise à l’échelle automatique augmente la taille des instances en ajoutant une 3ème instance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-152">Autoscale scales out adding a 3rd instance.</span></span>
3. <span data-ttu-id="bb78c-153">Ensuite, supposons que le nombre de threads moyen entre les instances diminue pour atteindre 575.</span><span class="sxs-lookup"><span data-stu-id="bb78c-153">Next, assume that the average thread count across instance falls to 575.</span></span>
4. <span data-ttu-id="bb78c-154">Avant la descente en puissance, la mise à l’échelle automatique essaye d’estimer quel sera l’état final en cas de diminution de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-154">Before scaling down, autoscale tries to estimate what the final state will be if it scaled in.</span></span> <span data-ttu-id="bb78c-155">Par exemple, 575 x 3 (nombre d’instances actuel) = 1 725 / 2 (nombre final d’instances lors de la descente en puissance) = 862,5 threads.</span><span class="sxs-lookup"><span data-stu-id="bb78c-155">For example, 575 x  3 (current instance count) = 1,725 / 2 (final number of instances when scaled down) = 862.5 threads.</span></span> <span data-ttu-id="bb78c-156">Cela signifie que la mise à l’échelle automatique augmenterait immédiatement la taille des instances même après la diminution des instances, si le nombre moyen de threads reste le même ou même baisse d’une petite quantité.</span><span class="sxs-lookup"><span data-stu-id="bb78c-156">This means autoscale would have to immediately scale-out again even after it scaled in, if the average thread count remains the same or even falls only a small amount.</span></span> <span data-ttu-id="bb78c-157">Toutefois, en cas de nouvelle montée en puissance, l’ensemble du processus se répète, menant à une boucle infinie.</span><span class="sxs-lookup"><span data-stu-id="bb78c-157">However, if it scaled up again, the whole process would repeat, leading to an infinite loop.</span></span>
5. <span data-ttu-id="bb78c-158">Pour éviter ce problème , la mise à l’échelle automatique ne descend pas du tout en puissance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-158">To avoid this situation (termed "flapping"), autoscale does not scale down at all.</span></span> <span data-ttu-id="bb78c-159">Au lieu de cela, elle ignore et réévalue la condition lors de la prochaine exécution de la tâche du service.</span><span class="sxs-lookup"><span data-stu-id="bb78c-159">Instead, it skips and reevaluates the condition again the next time the service's job executes.</span></span> <span data-ttu-id="bb78c-160">Cela peut perturber de nombreuses personnes, car la mise à l’échelle automatique semble ne pas fonctionner lorsque le nombre moyen de threads est de 575.</span><span class="sxs-lookup"><span data-stu-id="bb78c-160">This could confuse many people because autoscale wouldn't appear to work when the average thread count was 575.</span></span>

<span data-ttu-id="bb78c-161">Lors d’une mise à l’échelle, l’estimation permet d’éviter les situations de « bagottement », où la taille des instances est continuellement modifiée (diminuée puis augmentée, et inversement).</span><span class="sxs-lookup"><span data-stu-id="bb78c-161">Estimation during a scale-in is intended to avoid "flapping" situations, where scale-in and scale-out actions continually go back and forth.</span></span> <span data-ttu-id="bb78c-162">Gardez ce comportement à l’esprit lorsque vous choisissez les mêmes seuils pour la diminution et l’augmentation de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-162">Keep this behavior in mind when you choose the same thresholds for scale-out and in.</span></span>

<span data-ttu-id="bb78c-163">Nous vous recommandons de choisir une marge suffisante entre les seuils de diminution et d’augmentation de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-163">We recommend choosing an adequate margin between the scale-out and in thresholds.</span></span> <span data-ttu-id="bb78c-164">Par exemple, examinez la combinaison de règles suivante bien plus adaptée.</span><span class="sxs-lookup"><span data-stu-id="bb78c-164">As an example, consider the following better rule combination.</span></span>

* <span data-ttu-id="bb78c-165">Augmenter les instances de 1 lorsque le % du processeur >= 80</span><span class="sxs-lookup"><span data-stu-id="bb78c-165">Increase instances by 1 count when CPU%  >= 80</span></span>
* <span data-ttu-id="bb78c-166">Diminuer les instances de 1 lorsque le % du processeur <= 60</span><span class="sxs-lookup"><span data-stu-id="bb78c-166">Decrease instances by 1 count when CPU% <= 60</span></span>

<span data-ttu-id="bb78c-167">Dans ce cas</span><span class="sxs-lookup"><span data-stu-id="bb78c-167">In this case</span></span>  

1. <span data-ttu-id="bb78c-168">Supposons qu’il existe 2 instances pour commencer.</span><span class="sxs-lookup"><span data-stu-id="bb78c-168">Assume there are 2 instances to start with.</span></span>
2. <span data-ttu-id="bb78c-169">Si le pourcentage moyen du processeur entre les instances atteint 80, la mise à l’échelle automatique augmente la taille des instances en ajoutant une troisième instance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-169">If the average CPU% across instances goes to 80, autoscale scales out adding a third instance.</span></span>
3. <span data-ttu-id="bb78c-170">Supposons maintenant qu’au fil du temps, le pourcentage du processeur baisse à 60.</span><span class="sxs-lookup"><span data-stu-id="bb78c-170">Now assume that over time the CPU% falls to 60.</span></span>
4. <span data-ttu-id="bb78c-171">La règle de diminution de la taille des instances de la mise à l’échelle automatique évalue l’état final en cas de diminution de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-171">Autoscale's scale-in rule estimates the final state if it were to scale-in.</span></span> <span data-ttu-id="bb78c-172">Par exemple, 60 x 3 (nombre d’instances actuel) = 180 / 2 (nombre final d’instances lors de la descente en puissance) = 90.</span><span class="sxs-lookup"><span data-stu-id="bb78c-172">For example, 60 x 3 (current instance count) = 180 / 2 (final number of instances when scaled down) = 90.</span></span> <span data-ttu-id="bb78c-173">Par conséquent, la mise à l’échelle automatique ne diminue pas la taille des instances, car il lui faudrait de nouveau monter en puissance immédiatement.</span><span class="sxs-lookup"><span data-stu-id="bb78c-173">So autoscale does not scale-in because it would have to scale-out again immediately.</span></span> <span data-ttu-id="bb78c-174">Au lieu de cela, elle ignore la descente en puissance.</span><span class="sxs-lookup"><span data-stu-id="bb78c-174">Instead, it skips scaling down.</span></span>
5. <span data-ttu-id="bb78c-175">Lors de la vérification de mise à l’échelle de temps suivante, l’UC continue sa diminution à 50.</span><span class="sxs-lookup"><span data-stu-id="bb78c-175">The next time autoscale checks, the CPU continues to fall to 50.</span></span> <span data-ttu-id="bb78c-176">Une nouvelle estimation est effectuée : 3 x 50 instances = 150 / 2 instances = 75, ce qui est inférieur au seuil d’augmentation de la taille des instances qui est de 80, la diminution de la taille des instances s’exécute pour obtenir 2 instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-176">It estimates again -  50 x 3 instance = 150 / 2 instances = 75, which is below the scale-out threshold of 80, so it scales in successfully to 2 instances.</span></span>

### <a name="considerations-for-scaling-threshold-values-for-special-metrics"></a><span data-ttu-id="bb78c-177">Considérations relatives aux valeurs de seuil de la mise à l’échelle pour les mesures spéciales</span><span class="sxs-lookup"><span data-stu-id="bb78c-177">Considerations for scaling threshold values for special metrics</span></span>
 <span data-ttu-id="bb78c-178">Pour les mesures spéciales, telles que les mesures de longueur de file d’attente Service Bus ou de stockage, le seuil correspond au nombre moyen de messages disponibles en fonction du nombre actuel d’instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-178">For special metrics such as Storage or Service Bus Queue length metric, the threshold is the average number of messages available per current number of instances.</span></span> <span data-ttu-id="bb78c-179">Choisissez soigneusement la valeur de seuil pour cette mesure.</span><span class="sxs-lookup"><span data-stu-id="bb78c-179">Carefully choose the choose the threshold value for this metric.</span></span>

<span data-ttu-id="bb78c-180">Examinons un exemple qui vous permettra de mieux comprendre ce comportement.</span><span class="sxs-lookup"><span data-stu-id="bb78c-180">Let's illustrate it with an example to ensure you understand the behavior better.</span></span>

* <span data-ttu-id="bb78c-181">Augmenter les instances de 1 lorsque le nombre de messages de file d’attente de stockage >= 50</span><span class="sxs-lookup"><span data-stu-id="bb78c-181">Increase instances by 1 count when Storage Queue message count >= 50</span></span>
* <span data-ttu-id="bb78c-182">Diminuer les instances de 1 lorsque le nombre de messages de file d’attente de stockage <= 10</span><span class="sxs-lookup"><span data-stu-id="bb78c-182">Decrease instances by 1 count when Storage Queue message count <= 10</span></span>

<span data-ttu-id="bb78c-183">Examinez la séquence suivante :</span><span class="sxs-lookup"><span data-stu-id="bb78c-183">Consider the following sequence:</span></span>

1. <span data-ttu-id="bb78c-184">Il existe 2 instances de file d’attente de stockage.</span><span class="sxs-lookup"><span data-stu-id="bb78c-184">There are 2 storage queue instances.</span></span>
2. <span data-ttu-id="bb78c-185">Les messages continuent d’arriver et lorsque vous examinez la file d’attente de stockage, le nombre total est de 50.</span><span class="sxs-lookup"><span data-stu-id="bb78c-185">Messages keep coming and when you review the storage queue, the total count reads 50.</span></span> <span data-ttu-id="bb78c-186">Vous pourriez supposer que la mise à l’échelle automatique devrait démarrer une action de montée en charge.</span><span class="sxs-lookup"><span data-stu-id="bb78c-186">You might assume that autoscale should start a scale-out action.</span></span> <span data-ttu-id="bb78c-187">Toutefois, notez que le nombre de messages par instance est de 50/2 = 25 messages.</span><span class="sxs-lookup"><span data-stu-id="bb78c-187">However, note that it is still 50/2 = 25 messages per instance.</span></span> <span data-ttu-id="bb78c-188">Par conséquent, la montée en charge ne se produit pas.</span><span class="sxs-lookup"><span data-stu-id="bb78c-188">So, scale-out does not occur.</span></span> <span data-ttu-id="bb78c-189">Pour que la montée en charge se produise, le nombre total de messages dans la file d’attente de stockage doit être égal à 100.</span><span class="sxs-lookup"><span data-stu-id="bb78c-189">For the first scale-out to happen, the total message count in the storage queue should be 100.</span></span>
3. <span data-ttu-id="bb78c-190">Ensuite, supposons que le nombre total de messages atteigne 100.</span><span class="sxs-lookup"><span data-stu-id="bb78c-190">Next, assume that the total message count reaches 100.</span></span>
4. <span data-ttu-id="bb78c-191">Une 3e instance de file d'attente de stockage est ajoutée en raison d’une action de montée en charge.</span><span class="sxs-lookup"><span data-stu-id="bb78c-191">A 3rd storage queue instance is added due to a scale-out action.</span></span>  <span data-ttu-id="bb78c-192">La prochaine action de montée en charge ne se produira que lorsque le nombre total de messages dans la file d’attente atteindra 150, car 150/3 = 50.</span><span class="sxs-lookup"><span data-stu-id="bb78c-192">The next scale-out action will not happen until the total message count in the queue reaches 150 because 150/3 = 50.</span></span>
5. <span data-ttu-id="bb78c-193">Maintenant, le nombre de messages dans la file d’attente diminue.</span><span class="sxs-lookup"><span data-stu-id="bb78c-193">Now the number of messages in the queue gets smaller.</span></span> <span data-ttu-id="bb78c-194">Avec 3 instances, la première action de diminution de la taille des instances se produit lorsque le nombre total de messages dans la file d’attente atteint 30, ce qui donne 30/3=10 messages par instance, ce qui correspond au seuil de diminution de la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-194">With 3 instances, the first scale-in action happens when the total messages in all queues add up to 30 because 30/3 = 10 messages per instance, which is the scale-in threshold.</span></span>

### <a name="considerations-for-scaling-when-multiple-profiles-are-configured-in-an-autoscale-setting"></a><span data-ttu-id="bb78c-195">Considérations relatives à la mise à l’échelle lorsque plusieurs profils sont configurés dans un paramètre de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-195">Considerations for scaling when multiple profiles are configured in an autoscale setting</span></span>
<span data-ttu-id="bb78c-196">Dans un paramètre de mise à l’échelle automatique, vous pouvez choisir un profil par défaut, qui est toujours appliqué indépendamment de toute planification ou de l’heure, ou vous pouvez choisir un profil récurrent ou un profil pour une durée fixe avec une plage de dates et d’heures.</span><span class="sxs-lookup"><span data-stu-id="bb78c-196">In an autoscale setting, you can choose a default profile, which is always applied without any dependency on schedule or time, or you can choose a recurring profile or a profile for a fixed period with a date and time range.</span></span>

<span data-ttu-id="bb78c-197">Lorsque le service de mise à l’échelle automatique traite ces éléments, il vérifie toujours ce qui suit dans l’ordre :</span><span class="sxs-lookup"><span data-stu-id="bb78c-197">When autoscale service processes them, it always checks in the following order:</span></span>

1. <span data-ttu-id="bb78c-198">Profil de date fixe</span><span class="sxs-lookup"><span data-stu-id="bb78c-198">Fixed Date profile</span></span>
2. <span data-ttu-id="bb78c-199">Profil récurrent</span><span class="sxs-lookup"><span data-stu-id="bb78c-199">Recurring profile</span></span>
3. <span data-ttu-id="bb78c-200">Profil par défaut (« Toujours »)</span><span class="sxs-lookup"><span data-stu-id="bb78c-200">Default ("Always") profile</span></span>

<span data-ttu-id="bb78c-201">Si une condition de profil est remplie, la mise à l’échelle automatique ne vérifie pas la condition de profil suivante.</span><span class="sxs-lookup"><span data-stu-id="bb78c-201">If a profile condition is met, autoscale does not check the next profile condition below it.</span></span> <span data-ttu-id="bb78c-202">La mise à l’échelle automatique ne traite qu’un seul profil à la fois.</span><span class="sxs-lookup"><span data-stu-id="bb78c-202">Autoscale only processes one profile at a time.</span></span> <span data-ttu-id="bb78c-203">Cela signifie que si vous souhaitez également inclure une condition de traitement d’un profil de niveau inférieur, vous devez également inclure ces règles dans le profil actuel.</span><span class="sxs-lookup"><span data-stu-id="bb78c-203">This means if you want to also include a processing condition from a lower-tier profile, you must include those rules as well in the current profile.</span></span>

<span data-ttu-id="bb78c-204">Examinons cela à l’aide d’un exemple :</span><span class="sxs-lookup"><span data-stu-id="bb78c-204">Let's review this using an example:</span></span>

<span data-ttu-id="bb78c-205">L’image ci-dessous illustre un paramètre de mise à l’échelle automatique avec un profil par défaut d’instances minimum = 2 et d’instances maximum = 10.</span><span class="sxs-lookup"><span data-stu-id="bb78c-205">The image below shows an autoscale setting with a default profile of minimum instances = 2 and maximum instances = 10.</span></span> <span data-ttu-id="bb78c-206">Dans cet exemple, les règles sont configurées pour la montée en charge lorsque le nombre de messages dans la file d’attente est supérieur à 10 et une diminution de la taille des instances lorsque le nombre de messages dans la file d’attente est inférieur à 3.</span><span class="sxs-lookup"><span data-stu-id="bb78c-206">In this example, rules are configured to scale-out when the message count in the queue is greater than 10 and scale-in when the message count in the queue is less than 3.</span></span> <span data-ttu-id="bb78c-207">À présent, la ressource peut évoluer entre 2 et 10 instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-207">So now the resource can scale between 2 and 10 instances.</span></span>

<span data-ttu-id="bb78c-208">En outre, il existe un profil récurrent défini pour Lundi.</span><span class="sxs-lookup"><span data-stu-id="bb78c-208">In addition, there is a recurring profile set for Monday.</span></span> <span data-ttu-id="bb78c-209">Il est défini pour des instances minimum = 2 et des instances maximum = 12.</span><span class="sxs-lookup"><span data-stu-id="bb78c-209">It is set for minimum instances = 2 and maximum instances = 12.</span></span> <span data-ttu-id="bb78c-210">Cela signifie que le lundi, la première fois que la mise à l’échelle automatique vérifie cette condition, si le nombre d’instances est égal à 2, il est mis à l’échelle pour correspondre au nouveau niveau minimum de 3.</span><span class="sxs-lookup"><span data-stu-id="bb78c-210">This means on Monday, the first time autoscale checks for this condition, if the instance count is 2, it scales to the new minimum of 3.</span></span> <span data-ttu-id="bb78c-211">Tant que la mise à l’échelle automatique rencontre cette condition de profil respectée (lundi), elle ne traite que les règles de montée/descente en puissance basées sur le processeur configurées pour ce profil.</span><span class="sxs-lookup"><span data-stu-id="bb78c-211">As long as autoscale continues to find this profile condition matched (Monday), it only processes the CPU-based scale-out/in rules configured for this profile.</span></span> <span data-ttu-id="bb78c-212">À ce stade, elle ne vérifie pas la longueur de la file d’attente.</span><span class="sxs-lookup"><span data-stu-id="bb78c-212">At this time, it does not check for the queue length.</span></span> <span data-ttu-id="bb78c-213">Toutefois, si vous souhaitez également que la condition de longueur de la file d’attente soit vérifiée, vous devez inclure les règles du profil par défaut dans votre profil de Lundi.</span><span class="sxs-lookup"><span data-stu-id="bb78c-213">However, if you also want the queue length condition to be checked, you should include those rules from the default profile as well in your Monday profile.</span></span>

<span data-ttu-id="bb78c-214">De même, lorsque la mise à l’échelle automatique bascule vers le profil par défaut, elle vérifie d’abord si les conditions minimales et maximales sont remplies.</span><span class="sxs-lookup"><span data-stu-id="bb78c-214">Similarly, when autoscale switches back to the default profile, it first checks if the minimum and maximum conditions are met.</span></span> <span data-ttu-id="bb78c-215">Si le nombre d’instances à ce moment-là est égal à 12, la taille des instances diminue jusqu’à 10, le maximum autorisé pour le profil par défaut.</span><span class="sxs-lookup"><span data-stu-id="bb78c-215">If the number of instances at the time is 12, it scales in to 10, the maximum allowed for the default profile.</span></span>

![paramètres de mise à l’échelle automatique](./media/insights-autoscale-best-practices/insights-autoscale-best-practices-2.png)

### <a name="considerations-for-scaling-when-multiple-rules-are-configured-in-a-profile"></a><span data-ttu-id="bb78c-217">Considérations relatives à la mise à l’échelle lorsque plusieurs règles sont configurées dans un profil</span><span class="sxs-lookup"><span data-stu-id="bb78c-217">Considerations for scaling when multiple rules are configured in a profile</span></span>
<span data-ttu-id="bb78c-218">Il existe des cas où vous devrez définir plusieurs règles dans un profil.</span><span class="sxs-lookup"><span data-stu-id="bb78c-218">There are cases where you may have to set multiple rules in a profile.</span></span> <span data-ttu-id="bb78c-219">L’ensemble de règles de mise à l’échelle automatique suivant est utilisé par les services lorsque plusieurs règles sont définies.</span><span class="sxs-lookup"><span data-stu-id="bb78c-219">The following set of autoscale rules are used by services use when multiple rules are set.</span></span>

<span data-ttu-id="bb78c-220">Pour *l’augmentation de la taille des instances*, la mise à l’échelle automatique s’exécute si une règle est respectée.</span><span class="sxs-lookup"><span data-stu-id="bb78c-220">On *scale out*, autoscale runs if any rule is met.</span></span>
<span data-ttu-id="bb78c-221">Pour la *diminution de la taille des instances*, la mise à l’échelle automatique nécessite que toutes les règles soient respectées.</span><span class="sxs-lookup"><span data-stu-id="bb78c-221">On *scale-in*, autoscale require all rules to be met.</span></span>

<span data-ttu-id="bb78c-222">Pour illustrer cela, supposons que vous disposez des 4 règles de mise à l’échelle automatique suivantes :</span><span class="sxs-lookup"><span data-stu-id="bb78c-222">To illustrate, assume that you have the following 4 autoscale rules:</span></span>

* <span data-ttu-id="bb78c-223">Si UC < 30 %, diminuer la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="bb78c-223">If CPU < 30 %, scale-in by 1</span></span>
* <span data-ttu-id="bb78c-224">Si Mémoire < 50 %, diminuer la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="bb78c-224">If Memory < 50%, scale-in by 1</span></span>
* <span data-ttu-id="bb78c-225">Si UC > 75 %, augmenter la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="bb78c-225">If CPU > 75%, scale-out by 1</span></span>
* <span data-ttu-id="bb78c-226">Si Mémoire > 75 %, augmenter la taille des instances de 1</span><span class="sxs-lookup"><span data-stu-id="bb78c-226">If Memory > 75%, scale-out by 1</span></span>

<span data-ttu-id="bb78c-227">Alors, ce qui suit se produit :</span><span class="sxs-lookup"><span data-stu-id="bb78c-227">Then the follow occurs:</span></span>

* <span data-ttu-id="bb78c-228">Si le processeur est de 76 % et la mémoire est de 50 %, une augmentation de la taille des instances se produit.</span><span class="sxs-lookup"><span data-stu-id="bb78c-228">If CPU is 76% and Memory is 50%, we scale-out.</span></span>
* <span data-ttu-id="bb78c-229">Si le processeur est de 50 % et la mémoire est de 76 %, une augmentation de la taille des instances se produit.</span><span class="sxs-lookup"><span data-stu-id="bb78c-229">If CPU is 50% and Memory is 76% we scale-out.</span></span>

<span data-ttu-id="bb78c-230">En revanche, si le processeur est de 25 % et la mémoire est de 51 %, la mise à l’échelle automatique ne diminue **pas** la taille des instances.</span><span class="sxs-lookup"><span data-stu-id="bb78c-230">On the other hand, if CPU is 25% and memory is 51% autoscale does **not** scale-in.</span></span> <span data-ttu-id="bb78c-231">Pour diminuer la taille des instances, le processeur doit être de 29 % et la mémoire de 49 %.</span><span class="sxs-lookup"><span data-stu-id="bb78c-231">In order to scale-in, CPU must be 29% and Memory 49%.</span></span>

### <a name="always-select-a-safe-default-instance-count"></a><span data-ttu-id="bb78c-232">Sélectionnez toujours un nombre d’instances par défaut sans échec</span><span class="sxs-lookup"><span data-stu-id="bb78c-232">Always select a safe default instance count</span></span>
<span data-ttu-id="bb78c-233">Le nombre d’instances par défaut est important, car la mise à l’échelle de vos services s’effectue en fonction de ce nombre lorsque les mesures ne sont pas disponibles.</span><span class="sxs-lookup"><span data-stu-id="bb78c-233">The default instance count is important autoscale scales your service to that count when metrics are not available.</span></span> <span data-ttu-id="bb78c-234">Par conséquent, sélectionnez un nombre d’instances par défaut qui est sécurisé pour vos charges de travail.</span><span class="sxs-lookup"><span data-stu-id="bb78c-234">Therefore, select a default instance count that's safe for your workloads.</span></span>

### <a name="configure-autoscale-notifications"></a><span data-ttu-id="bb78c-235">Configuration des notifications de mise à l’échelle automatique</span><span class="sxs-lookup"><span data-stu-id="bb78c-235">Configure autoscale notifications</span></span>
<span data-ttu-id="bb78c-236">La mise à l’échelle automatique notifie par e-mail les administrateurs et les collaborateurs de la ressource si l’une des conditions suivantes se produit :</span><span class="sxs-lookup"><span data-stu-id="bb78c-236">Autoscale notifies the administrators and contributors of the resource by email if any of the following conditions occur:</span></span>

* <span data-ttu-id="bb78c-237">le service de mise à l’échelle automatique ne parvient pas à effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="bb78c-237">autoscale service fails to take an action.</span></span>
* <span data-ttu-id="bb78c-238">Les mesures ne sont pas disponibles pour que le service de mise à l’échelle automatique prenne une décision de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="bb78c-238">Metrics are not available for autoscale service to make a scale decision.</span></span>
* <span data-ttu-id="bb78c-239">Les mesures sont de nouveau disponibles (récupération) pour prendre une décision de mise à l’échelle.</span><span class="sxs-lookup"><span data-stu-id="bb78c-239">Metrics are available (recovery) again to make a scale decision.</span></span>
  <span data-ttu-id="bb78c-240">Outre les conditions ci-dessus, vous pouvez configurer des notifications par e-mail ou webhook pour être averti en cas d’action de mise à l’échelle réussie.</span><span class="sxs-lookup"><span data-stu-id="bb78c-240">In addition to the conditions above, you can configure email or webhook notifications to get notified for successful scale actions.</span></span>
  
<span data-ttu-id="bb78c-241">Vous pouvez également utiliser une alerte de journal d’activité pour surveiller l’intégrité du moteur de mise à l’échelle automatique.</span><span class="sxs-lookup"><span data-stu-id="bb78c-241">You can also use an Activity Log alert to monitor the health of the autoscale engine.</span></span> <span data-ttu-id="bb78c-242">Voici des exemples pour [créer une alerte de journal d’activité pour surveiller toutes les opérations du moteur de mise à l’échelle automatique dans votre abonnement](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) ou [créer une alerte de journal d’activité pour surveiller tous les échecs d’opérations de mise à l’échelle automatique dans votre abonnement](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span><span class="sxs-lookup"><span data-stu-id="bb78c-242">Here are examples to [create an Activity Log Alert to monitor all autoscale engine operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert) or to [create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert).</span></span>

## <a name="next-steps"></a><span data-ttu-id="bb78c-243">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bb78c-243">Next Steps</span></span>
- [<span data-ttu-id="bb78c-244">Créer une alerte de journal d’activité pour surveiller toutes les opérations du moteur de mise à l’échelle automatique dans votre abonnement.</span><span class="sxs-lookup"><span data-stu-id="bb78c-244">Create an Activity Log Alert to monitor all autoscale engine operations on your subscription.</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-alert)
- [<span data-ttu-id="bb78c-245">Créer une alerte de journal d’activité pour surveiller tous les échecs d’opérations de mise à l’échelle automatique dans votre abonnement</span><span class="sxs-lookup"><span data-stu-id="bb78c-245">Create an Activity Log Alert to monitor all failed autoscale scale in/scale out operations on your subscription</span></span>](https://github.com/Azure/azure-quickstart-templates/tree/master/monitor-autoscale-failed-alert)
