---
title: "Afficher et utiliser un modèle Azure Resource Manager de machine virtuelle | Microsoft Docs"
description: "Découvrez comment utiliser le modèle Azure Resource Manager à partir d’une machine virtuelle pour créer d’autres machines virtuelles"
services: devtest-lab,virtual-machines,visual-studio-online
documentationcenter: na
author: tomarcher
manager: douge
editor: 
ms.assetid: a759d9ce-655c-4ac6-8834-cb29dd7d30dd
ms.service: devtest-lab
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/05/2017
ms.author: tarcher
ms.openlocfilehash: 12cdb61667f77215c894800d5c439235e767a26b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="use-a-virtual-machines-azure-resource-manager-template"></a><span data-ttu-id="0045b-103">Utiliser un modèle Azure Resource Manager de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="0045b-103">Use a virtual machine's Azure Resource Manager template</span></span>

<span data-ttu-id="0045b-104">Lorsque vous créez une machine virtuelle dans DevTest Labs via le [portail Azure](http://go.microsoft.com/fwlink/p/?LinkID=525040), vous pouvez voir le modèle Azure Resource Manager avant d’enregistrer la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="0045b-104">When you are creating a virtual machine (VM) in DevTest Labs through the [Azure portal](http://go.microsoft.com/fwlink/p/?LinkID=525040), you can view the Azure Resource Manager template before you save the VM.</span></span> <span data-ttu-id="0045b-105">Le modèle peut alors être utilisé comme base pour créer d’autres machines virtuelles lab avec les mêmes paramètres.</span><span class="sxs-lookup"><span data-stu-id="0045b-105">The template can then be used as a basis to create more lab VMs with the same settings.</span></span>

<span data-ttu-id="0045b-106">Cet article décrit comment afficher le modèle Resource Manager lors de la création d’une machine virtuelle et comment le déployer ultérieurement pour automatiser la création de la même machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="0045b-106">This article describes how to view the Resource Manager template when creating a VM, and how to deploy it later to automate creation of the same VM.</span></span>

## <a name="multi-vm-vs-single-vm-resource-manager-templates"></a><span data-ttu-id="0045b-107">Modèles Resource Manager à plusieurs machines virtuelles ou à machine virtuelle unique</span><span class="sxs-lookup"><span data-stu-id="0045b-107">Multi-VM vs. single-VM Resource Manager templates</span></span>
<span data-ttu-id="0045b-108">Il existe deux façons de créer des machines virtuelles dans DevTest Labs à l’aide d’un modèle Resource Manager : configurer la ressource Microsoft.DevTestLab/labs/virtualmachines ou configurer la ressource Microsoft.Commpute/virtualmachines.</span><span class="sxs-lookup"><span data-stu-id="0045b-108">There are two ways to create VMs in DevTest Labs using a Resource Manager template: provision the Microsoft.DevTestLab/labs/virtualmachines resource or provision the Microsoft.Commpute/virtualmachines resource.</span></span> <span data-ttu-id="0045b-109">Chaque méthode est utilisée dans des scénarios différents et nécessite des autorisations différentes.</span><span class="sxs-lookup"><span data-stu-id="0045b-109">Each is used in different scenarios and require different permissions.</span></span>

- <span data-ttu-id="0045b-110">Les modèles Resource Manager qui utilisent un type de ressource Microsoft.DevTestLab/labs/virtualmachines (tel que déclaré dans la propriété « ressource » du modèle) peuvent configurer des machines virtuelles lab individuelles.</span><span class="sxs-lookup"><span data-stu-id="0045b-110">Resource Manager templates that use a Microsoft.DevTestLab/labs/virtualmachines resource type (as declared in the “resource” property in the template) can provision individual lab VMs.</span></span> <span data-ttu-id="0045b-111">Chaque machine virtuelle apparaît alors sous la forme d’un seul élément dans la liste de machines virtuelles DevTest Labs :</span><span class="sxs-lookup"><span data-stu-id="0045b-111">Each VM then shows up as a single item in the DevTest Labs virtual machines list:</span></span>

   ![Liste des machines virtuelles qui apparaissent comme un seul élément dans la liste de machines virtuelles DevTest Lab](./media/devtest-lab-use-arm-template/devtestlab-lab-vm-single-item.png)

   <span data-ttu-id="0045b-113">Ce type de modèle Resource Manager peut être configuré via la commande Azure PowerShell **New-AzureRmResourceGroupDeployment** ou via la commande Azure CLI **az group deployment create**.</span><span class="sxs-lookup"><span data-stu-id="0045b-113">This type of Resource Manager template can be provisioned through the Azure PowerShell command **New-AzureRmResourceGroupDeployment** or through the Azure CLI command **az group deployment create**.</span></span> <span data-ttu-id="0045b-114">Il requiert des autorisations d’administrateur. Les utilisateurs assignés à un rôle d’utilisateur DevTest Labs ne peuvent donc pas effectuer le déploiement.</span><span class="sxs-lookup"><span data-stu-id="0045b-114">It requires administrator permissions, so users who are assigned with a DevTest Labs user role can’t perform the deployment.</span></span> 

- <span data-ttu-id="0045b-115">Les modèles Resource Manager qui utilisent un type de ressource Microsoft.Compute/virtualmachines peuvent configurer plusieurs machines virtuelles en tant qu’environnement unique dans la liste des machines virtuelles DevTest Labs :</span><span class="sxs-lookup"><span data-stu-id="0045b-115">Resource Manager templates that use a Microsoft.Compute/virtualmachines resource type can provision multiple VMs as a single environment in the DevTest Labs virtual machines list:</span></span>

   ![Liste des machines virtuelles qui apparaissent comme un seul élément dans la liste de machines virtuelles DevTest Lab](./media/devtest-lab-use-arm-template/devtestlab-lab-vm-single-environment.png)

   <span data-ttu-id="0045b-117">Les machines virtuelles qui se trouvent dans le même environnement peuvent être gérées ensemble et partagent le même cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="0045b-117">VMs in the same environment can be managed together and share the same lifecycle.</span></span> <span data-ttu-id="0045b-118">Les utilisateurs affectés à un rôle d’utilisateur DevTest Labs peuvent créer des environnements à l’aide de ces modèles, si l’administrateur a configuré le laboratoire de cette façon.</span><span class="sxs-lookup"><span data-stu-id="0045b-118">Users who are assigned with a DevTest Labs user role can create environments using those templates as long as the administrator has configured the lab that way.</span></span>

<span data-ttu-id="0045b-119">Le reste de cet article présente les modèles Resource Manager qui utilisent Mirosoft.DevTestLab/labs/virtualmachines.</span><span class="sxs-lookup"><span data-stu-id="0045b-119">The remainder of this article discusses Resource Manager templates that use Mirosoft.DevTestLab/labs/virtualmachines.</span></span> <span data-ttu-id="0045b-120">Ils sont utilisés par les administrateurs de laboratoire pour automatiser la création de machines virtuelles lab (par exemple, des machines virtuelles revendicables) ou la génération de l’image de référence (par exemple, Image Factory).</span><span class="sxs-lookup"><span data-stu-id="0045b-120">These are used by lab admins to automate lab VM creation (for example, claimable VMs) or golden image generation (for example, image factory).</span></span>

<span data-ttu-id="0045b-121">Les [Bonnes pratiques de création de modèles Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-template-best-practices) contiennent de nombreuses directives et suggestions pour vous aider à créer des modèles Azure Resource Manager fiables et faciles à utiliser.</span><span class="sxs-lookup"><span data-stu-id="0045b-121">[Best practices for creating Azure Resource Manager templates](https://docs.microsoft.com/azure/azure-resource-manager/resource-manager-template-best-practices) offers many guidelines and suggestions to help you create Azure Resource Manager templates that are reliable and easy to use.</span></span>

## <a name="view-and-save-a-virtual-machines-resource-manager-template"></a><span data-ttu-id="0045b-122">Afficher et enregistrer un modèle Resource Manager de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="0045b-122">View and save a virtual machine's Resource Manager template</span></span>
1. <span data-ttu-id="0045b-123">Suivez les étapes de la section [Créer votre première machine virtuelle dans un laboratoire](devtest-lab-create-first-vm.md) pour commencer à créer une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="0045b-123">Follow the steps at [Create your first VM in a lab](devtest-lab-create-first-vm.md) to begin creating a virtual machine.</span></span>
1. <span data-ttu-id="0045b-124">Entrez les informations requises pour votre machine virtuelle et ajoutez les artefacts que vous souhaitez pour cette machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="0045b-124">Enter the required information for your virtual machine and add any artifacts you want for this VM.</span></span>
1. <span data-ttu-id="0045b-125">Au bas de la fenêtre Configurer les paramètres, choisissez **Afficher le modèle ARM**.</span><span class="sxs-lookup"><span data-stu-id="0045b-125">At the bottom of the Configure settings window, choose **View ARM template**.</span></span>

   ![Bouton Afficher le modèle ARM](./media/devtest-lab-use-arm-template/devtestlab-lab-view-rm-template.png)
1. <span data-ttu-id="0045b-127">Copiez et enregistrez le modèle Resource Manager à utiliser ultérieurement pour créer une autre machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="0045b-127">Copy and save the Resource Manager template to use later to create another virtual machine.</span></span>

   ![Modèle Resource Manager à enregistrer pour une utilisation ultérieure](./media/devtest-lab-use-arm-template/devtestlab-lab-copy-rm-template.png)

<span data-ttu-id="0045b-129">Après avoir enregistré le modèle Resource Manager, vous devez mettre à jour la section Paramètres du modèle avant de pouvoir l’utiliser.</span><span class="sxs-lookup"><span data-stu-id="0045b-129">After you have saved the Resource Manager template, you must update the parameters section of the template before you can use it.</span></span> <span data-ttu-id="0045b-130">Vous pouvez créer un paramètre .json qui personnalise simplement les paramètres en dehors du modèle Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="0045b-130">You can create a parameter.json that customizes just the parameters, outside of the actual Resource Manager template.</span></span> 

![Personnaliser les paramètres à l’aide d’un fichier JSON](./media/devtest-lab-use-arm-template/devtestlab-lab-custom-params.png)

## <a name="deploy-a-resource-manager-template-to-create-a-vm"></a><span data-ttu-id="0045b-132">Déployer un modèle Resource Manager pour créer une machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="0045b-132">Deploy a Resource Manager template to create a VM</span></span>
<span data-ttu-id="0045b-133">Après avoir enregistré un modèle Resource Manager et l’avoir personnalisé selon vos besoins, vous pouvez l’utiliser pour automatiser la création de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="0045b-133">After you have saved a Resource Manager template and customized it for your needs, you can use it to automate VM creation.</span></span> <span data-ttu-id="0045b-134">La rubrique [Déployer des ressources avec des modèles Resource Manager et Azure PowerShell](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy) explique comment utiliser Azure PowerShell avec des modèles Resource Manager pour déployer vos ressources sur Azure.</span><span class="sxs-lookup"><span data-stu-id="0045b-134">[Deploy resources with Resource Manager templates and Azure PowerShell](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy) describes how to use Azure PowerShell with Resource Manager templates to deploy your resources to Azure.</span></span> <span data-ttu-id="0045b-135">La rubrique [Déployer des ressources avec des modèles Resource Manager et Azure CLI](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy-cli) explique comment utiliser Azure CLI avec des modèles Resource Manager pour déployer vos ressources sur Azure.</span><span class="sxs-lookup"><span data-stu-id="0045b-135">[Deploy resources with Resource Manager templates and Azure CLI](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy-cli) describes how to use Azure CLI with Resource Manager templates to deploy your resources to Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="0045b-136">Seul un utilisateur disposant des autorisations de propriétaire de laboratoire peut créer des machines virtuelles à partir d’un modèle Resource Manager avec Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0045b-136">Only a user with lab owner permissions can create VMs from a Resource Manager template by using Azure PowerShell.</span></span> <span data-ttu-id="0045b-137">Si vous souhaitez automatiser la création de machines virtuelles à l’aide d’un modèle Resource Manager et que vous disposez uniquement d’autorisations utilisateur, vous pouvez utiliser la commande [ **az lab vm create** dans l’interface CLI](https://docs.microsoft.com/cli/azure/lab/vm#create).</span><span class="sxs-lookup"><span data-stu-id="0045b-137">If you want to automate VM creation using a Resource Manager template and you only have user permissions, you can use the [**az lab vm create** command in the CLI](https://docs.microsoft.com/cli/azure/lab/vm#create).</span></span>

### <a name="next-steps"></a><span data-ttu-id="0045b-138">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="0045b-138">Next steps</span></span>
* <span data-ttu-id="0045b-139">Découvrez comment [Créer des environnements à plusieurs machines virtuelles avec les modèles Resource Manager](devtest-lab-create-environment-from-arm.md).</span><span class="sxs-lookup"><span data-stu-id="0045b-139">Learn how to [Create multi-VM environments with Resource Manager templates](devtest-lab-create-environment-from-arm.md).</span></span>
* <span data-ttu-id="0045b-140">Découvrez les autres modèles Resource Manager à démarrage rapide pour l’automatisation de DevTest Labs à partir du [référentiel DevTest Labs GitHub public](https://github.com/Azure/azure-quickstart-templates).</span><span class="sxs-lookup"><span data-stu-id="0045b-140">Explore more quick-start Resource Manager templates for DevTest Labs automation from the [public DevTest Labs GitHub repo](https://github.com/Azure/azure-quickstart-templates).</span></span>
