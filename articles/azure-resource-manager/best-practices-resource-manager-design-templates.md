---
title: "Concevoir des modèles Azure pour des solutions complexes | Microsoft Docs"
description: "Présente les bonnes pratiques de conception des modèles Azure Resource Manager pour les scénarios complexes"
services: azure-resource-manager
documentationcenter: 
author: tfitzmac
manager: timlt
editor: tysonn
ms.assetid: ce1141d6-ece7-4976-acea-1db1f775409e
ms.service: azure-resource-manager
ms.workload: multiple
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/19/2016
ms.author: tomfitz
ms.openlocfilehash: dcc31f7a8c85a8f7fbd554371a66fb1e348bca17
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/03/2017
---
# <a name="design-patterns-for-azure-resource-manager-templates-when-deploying-complex-solutions"></a><span data-ttu-id="79762-103">Concevoir des modèles pour les modèles Azure Resource Manager lors du déploiement de solutions complexes</span><span class="sxs-lookup"><span data-stu-id="79762-103">Design patterns for Azure Resource Manager templates when deploying complex solutions</span></span>
<span data-ttu-id="79762-104">À l’aide d’une approche souple, basée sur des modèles Azure Resource Manager, vous pouvez déployer des topologies complexes rapidement et de manière homogène.</span><span class="sxs-lookup"><span data-stu-id="79762-104">Using a flexible approach based on Azure Resource Manager templates, you can deploy complex topologies quickly and consistently.</span></span> <span data-ttu-id="79762-105">Vous pouvez adapter facilement ces déploiements selon l’évolution des offres principales. Vous pouvez également les adapter aux variables des scénarios ou clients hors-norme.</span><span class="sxs-lookup"><span data-stu-id="79762-105">You can adapt these deployments easily as core offerings evolve or to accommodate variants for outlier scenarios or customers.</span></span>

<span data-ttu-id="79762-106">Cette rubrique fait partie d’un livre blanc plus volumineux.</span><span class="sxs-lookup"><span data-stu-id="79762-106">This topic is part of a larger whitepaper.</span></span> <span data-ttu-id="79762-107">Pour lire le livre blanc complet, téléchargez [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf) (Considérations et pratiques éprouvées concernant les modèles Azure Resource Manager de classe mondiale).</span><span class="sxs-lookup"><span data-stu-id="79762-107">To read the full paper, download [World Class Azure Resource Manager Templates Considerations and Proven Practices](http://download.microsoft.com/download/8/E/1/8E1DBEFA-CECE-4DC9-A813-93520A5D7CFE/World Class ARM Templates - Considerations and Proven Practices.pdf).</span></span>

<span data-ttu-id="79762-108">Les modèles associent les avantages du gestionnaire Azure Resource Manager sous-jacent à l’adaptabilité et à la lisibilité de JSON (JavaScript Objet Notation).</span><span class="sxs-lookup"><span data-stu-id="79762-108">Templates combine the benefits of the underlying Azure Resource Manager with the adaptability and readability of JavaScript Object Notation (JSON).</span></span> <span data-ttu-id="79762-109">En utilisant des modèles, vous pouvez :</span><span class="sxs-lookup"><span data-stu-id="79762-109">Using templates, you can:</span></span>

* <span data-ttu-id="79762-110">déployer des topologies et leurs charges de travail de manière cohérente ;</span><span class="sxs-lookup"><span data-stu-id="79762-110">Deploy topologies and their workloads consistently.</span></span>
* <span data-ttu-id="79762-111">gérer l’ensemble de vos ressources dans une application à l’aide de groupes de ressources ;</span><span class="sxs-lookup"><span data-stu-id="79762-111">Manage all your resources in an application together using resource groups.</span></span>
* <span data-ttu-id="79762-112">appliquer le contrôle d’accès en fonction du rôle (RBAC) pour accorder un accès approprié aux utilisateurs, groupes et services ;</span><span class="sxs-lookup"><span data-stu-id="79762-112">Apply role-based access control (RBAC) to grant appropriate access to users, groups, and services.</span></span>
* <span data-ttu-id="79762-113">utiliser le marquage des associations pour rationaliser des tâches telles que la facturation des cumuls.</span><span class="sxs-lookup"><span data-stu-id="79762-113">Use tagging associations to streamline tasks such as billing rollups.</span></span>

<span data-ttu-id="79762-114">Cet article fournit des détails sur les scénarios de consommation, l’architecture et les modèles d’implémentation identifiés au cours de nos sessions de conception et pendant les implémentations de modèle dans le monde réel auprès des clients AzureCAT (Azure Customer Advisory Team).</span><span class="sxs-lookup"><span data-stu-id="79762-114">This article provides details on consumption scenarios, architecture, and implementation patterns identified during our design sessions and real-world template implementations with Azure Customer Advisory Team (AzureCAT) customers.</span></span> <span data-ttu-id="79762-115">Ces approches reposent sur des pratiques éprouvées qui, loin d’être théoriques, sont documentées par le développement de modèles pour 12 des principales technologies OSS basées sur Linux, notamment : Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise optimisé par Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis et Nagios.</span><span class="sxs-lookup"><span data-stu-id="79762-115">Far from academic, these approaches are proven practices informed by the development of templates for 12 of the top Linux-based OSS technologies, including: Apache Kafka, Apache Spark, Cloudera, Couchbase, Hortonworks HDP, DataStax Enterprise powered by Apache Cassandra, Elasticsearch, Jenkins, MongoDB, PostgreSQL, Redis, and Nagios.</span></span> 

<span data-ttu-id="79762-116">Cet article partage ces pratiques éprouvées pour vous aider à concevoir des modèles Azure Resource Manager de premier ordre.</span><span class="sxs-lookup"><span data-stu-id="79762-116">This article shares these proven practices to help you architect world class Azure Resource Manager templates.</span></span>  

<span data-ttu-id="79762-117">Au cours de notre collaboration avec les clients, nous avons identifié plusieurs expériences de consommation de modèles Resource Manager dans les entreprises, chez les intégrateurs de systèmes et les fournisseurs de services cloud.</span><span class="sxs-lookup"><span data-stu-id="79762-117">In our work with customers, we have identified several Resource Manager template consumption experiences across enterprises, System Integrators (SI)s, and CSVs.</span></span> <span data-ttu-id="79762-118">Les sections suivantes fournissent une vue d’ensemble des scénarios courants et des modèles pour différents types de client.</span><span class="sxs-lookup"><span data-stu-id="79762-118">The following sections provide a high-level overview of common scenarios and patterns for different customer types.</span></span>

## <a name="enterprises-and-system-integrators"></a><span data-ttu-id="79762-119">Entreprises et intégrateurs de systèmes</span><span class="sxs-lookup"><span data-stu-id="79762-119">Enterprises and system integrators</span></span>
<span data-ttu-id="79762-120">Dans les grandes entreprises, il existe généralement deux utilisateurs de modèles Resource Manager : les équipes de développement logiciel internes et les services informatiques.</span><span class="sxs-lookup"><span data-stu-id="79762-120">Within large organizations, we commonly see two consumers of Resource Manager templates: internal software development teams and corporate IT.</span></span> <span data-ttu-id="79762-121">Nous avons observé que les scénarios des intégrateurs de systèmes correspondent à ceux des entreprises. Par conséquent, les mêmes considérations s’appliquent.</span><span class="sxs-lookup"><span data-stu-id="79762-121">We've found that the scenarios for the SIs map to the scenarios for Enterprises, so the same considerations apply.</span></span>

### <a name="internal-software-development-teams"></a><span data-ttu-id="79762-122">Équipes de développement logiciel internes</span><span class="sxs-lookup"><span data-stu-id="79762-122">Internal software development teams</span></span>
<span data-ttu-id="79762-123">Si votre équipe développe des logiciels pour soutenir votre activité, les modèles constituent un moyen simple de déployer rapidement des technologies à utiliser dans des solutions propres à l’activité.</span><span class="sxs-lookup"><span data-stu-id="79762-123">If your team develops software to support your business, templates provide an easy way to quickly deploy technologies for use in business-specific solutions.</span></span> <span data-ttu-id="79762-124">Vous pouvez également utiliser ces modèles pour créer rapidement des environnements de formation qui permettent aux membres des équipes d’acquérir les compétences nécessaires.</span><span class="sxs-lookup"><span data-stu-id="79762-124">You can also use templates to rapidly create training environments that enable team members to gain necessary skills.</span></span>

<span data-ttu-id="79762-125">Vous pouvez utiliser les modèles en l’état, les étendre ou les modifier en fonction de vos besoins.</span><span class="sxs-lookup"><span data-stu-id="79762-125">You can use templates as-is or extend or compose them to accommodate your needs.</span></span> <span data-ttu-id="79762-126">En utilisant un marquage dans les modèles, vous pouvez fournir un récapitulatif de facturation avec différentes vues, par exemple équipe, projet, individu et formation.</span><span class="sxs-lookup"><span data-stu-id="79762-126">Using tagging within templates, you can provide a billing summary with various views such as team, project, individual, and education.</span></span>

<span data-ttu-id="79762-127">Les entreprises souhaitent souvent créer des équipes de développement logiciel pour créer un modèle de déploiement cohérent d’une solution.</span><span class="sxs-lookup"><span data-stu-id="79762-127">Businesses often want software development teams to create a template for consistent deployment of a solution.</span></span> <span data-ttu-id="79762-128">Le modèle facilite les contraintes afin que certains éléments au sein de cet environnement restent fixes et ne puissent pas être substitués.</span><span class="sxs-lookup"><span data-stu-id="79762-128">The template facilitates constraints so certain items within that environment remain fixed and can't be overridden.</span></span> <span data-ttu-id="79762-129">Par exemple, une banque peut exiger qu’un modèle inclue le contrôle RBAC afin qu’aucun programmeur ne puisse modifier de solution bancaire pour envoyer des données à un compte de stockage personnel.</span><span class="sxs-lookup"><span data-stu-id="79762-129">For example, a bank might require a template to include RBAC so a programmer can’t revise a banking solution to send data to a personal storage account.</span></span>

### <a name="corporate-it"></a><span data-ttu-id="79762-130">Services informatiques</span><span class="sxs-lookup"><span data-stu-id="79762-130">Corporate IT</span></span>
<span data-ttu-id="79762-131">Les entreprises disposant de services informatiques utilisent généralement des modèles pour fournir une capacité de cloud et des fonctionnalités hébergées dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="79762-131">Corporate IT organizations typically use templates for delivering cloud capacity and cloud-hosted capabilities.</span></span>

#### <a name="cloud-capacity"></a><span data-ttu-id="79762-132">Capacité de cloud</span><span class="sxs-lookup"><span data-stu-id="79762-132">Cloud capacity</span></span>
<span data-ttu-id="79762-133">Les groupes de services informatiques fournissent généralement une capacité de cloud aux équipes dans des tailles standard : petite, moyenne et grande.</span><span class="sxs-lookup"><span data-stu-id="79762-133">A common way for corporate IT groups to provide cloud capacity for teams is with "t-shirt sizes", which are standard offering sizes such as small, medium, and large.</span></span> <span data-ttu-id="79762-134">Les offres de taille standard peuvent combiner différents types et quantités de ressources tout en fournissant un niveau de normalisation qui permet d’utiliser les modèles.</span><span class="sxs-lookup"><span data-stu-id="79762-134">The t-shirt sized offerings can mix different resource types and quantities while providing a level of standardization that makes it possible to use templates.</span></span> <span data-ttu-id="79762-135">Les modèles proposent des capacités d’une manière cohérente qui appliquent des stratégies d’entreprise et utilisent le marquage pour fournir la rétrofacturation aux entreprises utilisatrices.</span><span class="sxs-lookup"><span data-stu-id="79762-135">The templates deliver capacity in a consistent way that enforces corporate policies and uses tagging to provide chargeback to consuming organizations.</span></span>

<span data-ttu-id="79762-136">Par exemple, vous devez peut-être fournir des environnements de développement, de test ou de production dans lesquels les équipes de développement logiciel peuvent déployer leurs solutions.</span><span class="sxs-lookup"><span data-stu-id="79762-136">For example, you may need to provide development, test, or production environments within which the software development teams can deploy their solutions.</span></span> <span data-ttu-id="79762-137">L’environnement dispose d’une topologie de réseau prédéfinie et d’éléments que les équipes de développement logiciel ne peuvent pas modifier, par exemple des règles régissant l’accès à l’Internet public et l’inspection des paquets.</span><span class="sxs-lookup"><span data-stu-id="79762-137">The environment has a predefined network topology and elements that the software development teams cannot change, such as rules governing access to the public internet and packet inspection.</span></span> <span data-ttu-id="79762-138">Vous pouvez également disposer de rôles propres à l’entreprise pour ces environnements avec des droits d’accès distincts pour l’environnement.</span><span class="sxs-lookup"><span data-stu-id="79762-138">You may also have organization-specific roles for these environments with distinct access rights for the environment.</span></span>

#### <a name="cloud-hosted-capabilities"></a><span data-ttu-id="79762-139">Fonctionnalités hébergées dans le cloud</span><span class="sxs-lookup"><span data-stu-id="79762-139">Cloud-hosted capabilities</span></span>
<span data-ttu-id="79762-140">Vous pouvez utiliser des modèles pour prendre en charge des fonctionnalités hébergées dans le cloud, notamment des packages logiciels individuels ou des offres composites qui sont proposés aux services internes.</span><span class="sxs-lookup"><span data-stu-id="79762-140">You can use templates to support cloud-hosted capabilities, including individual software packages or composite offerings that are offered to internal lines of business.</span></span> <span data-ttu-id="79762-141">Exemple d’une offre composite : analyse proposée en tant que service (analyse, visualisation et autres technologies), transmise dans une configuration optimisée et connectée dans une topologie de réseau prédéfinie.</span><span class="sxs-lookup"><span data-stu-id="79762-141">An example of a composite offering would be analytics-as-a-service—analytics, visualization, and other technologies—delivered in an optimized, connected configuration on a predefined network topology.</span></span>

<span data-ttu-id="79762-142">Les fonctionnalités hébergées dans le cloud sont influencées par les considérations relatives à la sécurité et aux rôles établies par l’offre de capacité de cloud sur laquelle elles sont basées.</span><span class="sxs-lookup"><span data-stu-id="79762-142">Cloud-hosted capabilities are affected by the security and role considerations established by the cloud capacity offering on which they’re built.</span></span> <span data-ttu-id="79762-143">Ces fonctionnalités sont proposées telles quelles ou en tant que service administré.</span><span class="sxs-lookup"><span data-stu-id="79762-143">These capabilities are offered as is or as a managed service.</span></span> <span data-ttu-id="79762-144">Pour ce dernier, des rôles avec contrainte d’accès sont requis pour permettre l’accès à l’environnement à des fins de gestion.</span><span class="sxs-lookup"><span data-stu-id="79762-144">For the latter, access-constrained roles are required to enable access into the environment for management purposes.</span></span>

## <a name="cloud-service-vendors"></a><span data-ttu-id="79762-145">Fournisseurs de services cloud</span><span class="sxs-lookup"><span data-stu-id="79762-145">Cloud service vendors</span></span>
<span data-ttu-id="79762-146">Après nous être entretenus avec de nombreux fournisseurs de services cloud, nous avons identifié plusieurs approches qui vous permettent de déployer des services pour vos clients ainsi que les obligations associées.</span><span class="sxs-lookup"><span data-stu-id="79762-146">After talking to many CSVs, we identified multiple approaches you can take to deploy services for your customers and associated requirements.</span></span>

### <a name="csv-hosted-offering"></a><span data-ttu-id="79762-147">Offre hébergée par un fournisseur de services cloud</span><span class="sxs-lookup"><span data-stu-id="79762-147">CSV-hosted offering</span></span>
<span data-ttu-id="79762-148">Si vous hébergez votre offre dans votre abonnement Azure, deux approches d’hébergement sont courantes : un déploiement distinct pour chaque client ou le déploiement d’unités d’échelle qui étayent l’infrastructure partagée utilisée pour tous les clients.</span><span class="sxs-lookup"><span data-stu-id="79762-148">If you host your offering in your own Azure subscription, two hosting approaches are common: deploying a distinct deployment for every customer or deploying scale units that underpin a shared infrastructure used for all customers.</span></span>

* <span data-ttu-id="79762-149">**Déploiements distincts pour chaque client.**</span><span class="sxs-lookup"><span data-stu-id="79762-149">**Distinct deployments for each customer.**</span></span> <span data-ttu-id="79762-150">Les déploiements distincts par client nécessitent des topologies fixes de différentes configurations connues.</span><span class="sxs-lookup"><span data-stu-id="79762-150">Distinct deployments per customer require fixed topologies of different known configurations.</span></span> <span data-ttu-id="79762-151">Ces déploiements peuvent avoir différentes tailles de machine virtuelle, différents nombres de nœuds et différentes quantités de stockage associé.</span><span class="sxs-lookup"><span data-stu-id="79762-151">These deployments may have different virtual machine (VM) sizes, varying numbers of nodes, and different amounts of associated storage.</span></span> <span data-ttu-id="79762-152">Le marquage des déploiements est utilisé pour la facturation des cumuls de chaque client.</span><span class="sxs-lookup"><span data-stu-id="79762-152">Tagging of deployments is used for roll-up billing of each customer.</span></span> <span data-ttu-id="79762-153">Un contrôle RBAC peut être activé pour permettre aux clients d’accéder aux aspects de leur environnement cloud.</span><span class="sxs-lookup"><span data-stu-id="79762-153">RBAC may be enabled to allow customers access to aspects of their cloud environment.</span></span>
* <span data-ttu-id="79762-154">**Unités d’échelle dans des environnements partagés mutualisés.**</span><span class="sxs-lookup"><span data-stu-id="79762-154">**Scale units in shared multi-tenant environments.**</span></span> <span data-ttu-id="79762-155">Un modèle peut représenter une unité d’échelle pour des environnements mutualisés.</span><span class="sxs-lookup"><span data-stu-id="79762-155">A template can represent a scale unit for multi-tenant environments.</span></span> <span data-ttu-id="79762-156">Dans ce cas, une même infrastructure est utilisée pour prendre en charge tous les clients.</span><span class="sxs-lookup"><span data-stu-id="79762-156">In this case, the same infrastructure is used to support all customers.</span></span> <span data-ttu-id="79762-157">Les déploiements représentent un groupe de ressources qui offrent un niveau de capacité pour l’offre hébergée, comme le nombre d’utilisateurs et le nombre de transactions.</span><span class="sxs-lookup"><span data-stu-id="79762-157">The deployments represent a group of resources that deliver a level of capacity for the hosted offering, such as number of users and number of transactions.</span></span> <span data-ttu-id="79762-158">Ces unités d’échelle sont augmentées ou réduites en fonction des besoins de la demande.</span><span class="sxs-lookup"><span data-stu-id="79762-158">These scale units are increased or decreased as demand requires.</span></span>

### <a name="csv-offering-injected-into-customer-subscription"></a><span data-ttu-id="79762-159">Offre des fournisseurs de services cloud injectée dans l’abonnement client</span><span class="sxs-lookup"><span data-stu-id="79762-159">CSV offering injected into customer subscription</span></span>
<span data-ttu-id="79762-160">Il se peut que vous souhaitiez déployer vos logiciels dans les abonnements possédés par les clients finaux.</span><span class="sxs-lookup"><span data-stu-id="79762-160">You may want to deploy your software into subscriptions owned by end customers.</span></span> <span data-ttu-id="79762-161">Vous pouvez utiliser des modèles pour effectuer des déploiements distincts dans le compte Azure d’un client.</span><span class="sxs-lookup"><span data-stu-id="79762-161">You can use templates to deploy distinct deployments into a customer’s Azure account.</span></span>

<span data-ttu-id="79762-162">Ces déploiements utilisent le contrôle RBAC afin que vous puissiez mettre à jour et gérer le déploiement dans le compte du client.</span><span class="sxs-lookup"><span data-stu-id="79762-162">These deployments use RBAC so you can update and manage the deployment within the customer’s account.</span></span>

### <a name="azure-marketplace"></a><span data-ttu-id="79762-163">Place de marché Azure</span><span class="sxs-lookup"><span data-stu-id="79762-163">Azure Marketplace</span></span>
<span data-ttu-id="79762-164">Si vous souhaitez promouvoir et vendre vos offres sur une place de marché, par exemple la Place de marché Microsoft Azure, vous pouvez développer des modèles pour fournir des types distincts de déploiement exécutés dans le compte Azure d’un client.</span><span class="sxs-lookup"><span data-stu-id="79762-164">To advertise and sell your offerings through a marketplace, such as Azure Marketplace, you can develop templates to deliver distinct types of deployments that run in a customer’s Azure account.</span></span> <span data-ttu-id="79762-165">Ces déploiements distincts sont décrits en général d’après leur taille (petite, moyenne, grande), le type de produit/public (communauté, développeur, entreprise) ou le type de fonctionnalité (de base, haute disponibilité).</span><span class="sxs-lookup"><span data-stu-id="79762-165">These distinct deployments can be typically described as a t-shirt size (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>  <span data-ttu-id="79762-166">Dans certains cas, ces types vous permettent de spécifier certains attributs du déploiement, tels que le type de machine virtuelle ou le nombre de disques.</span><span class="sxs-lookup"><span data-stu-id="79762-166">In some cases, these types allow you to specify certain attributes of the deployment, such as VM type or number of disks.</span></span>

## <a name="oss-projects"></a><span data-ttu-id="79762-167">Projets OSS</span><span class="sxs-lookup"><span data-stu-id="79762-167">OSS projects</span></span>
<span data-ttu-id="79762-168">Dans les projets open source, les modèles Resource Manager permettent à une communauté de déployer rapidement une solution à l’aide des pratiques éprouvées.</span><span class="sxs-lookup"><span data-stu-id="79762-168">Within open source projects, Resource Manager templates enable a community to deploy a solution quickly using proven practices.</span></span> <span data-ttu-id="79762-169">Vous pouvez stocker des modèles dans un dépôt GitHub afin que la communauté puisse les réviser au fil du temps.</span><span class="sxs-lookup"><span data-stu-id="79762-169">You can store templates in a GitHub repository so the community can revise them over time.</span></span> <span data-ttu-id="79762-170">Les utilisateurs déploient ces modèles dans leur propre abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="79762-170">Users deploy these templates in their own Azure subscriptions.</span></span>

<span data-ttu-id="79762-171">Les sections suivantes identifient les éléments à prendre en compte avant de concevoir votre solution.</span><span class="sxs-lookup"><span data-stu-id="79762-171">The following sections identify the things you need to consider before designing your solution.</span></span>

## <a name="identifying-what-is-outside-and-inside-a-vm"></a><span data-ttu-id="79762-172">Identification des éléments externes et internes d’une machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="79762-172">Identifying what is outside and inside a VM</span></span>
<span data-ttu-id="79762-173">Lorsque vous concevez votre modèle, il est utile d’examiner les exigences en termes d’éléments externes et internes des machines virtuelles :</span><span class="sxs-lookup"><span data-stu-id="79762-173">As you design your template, it’s helpful to look at the requirements in terms of what's outside and inside the virtual machines (VMs):</span></span>

* <span data-ttu-id="79762-174">Les éléments extérieurs correspondent aux machines virtuelles et aux autres ressources de votre déploiement, par exemple la topologie de réseau, le marquage, les références aux certificats/secrets et le contrôle d’accès basé sur les rôles.</span><span class="sxs-lookup"><span data-stu-id="79762-174">Outside means the VMs and other resources of your deployment, such as the network topology, tagging, references to the certs/secrets, and role-based access control.</span></span> <span data-ttu-id="79762-175">Toutes ces ressources font partie de votre modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-175">All these resources are part of your template.</span></span>
* <span data-ttu-id="79762-176">Les éléments intérieurs correspondent aux logiciels installés et à la configuration d’état souhaité globale.</span><span class="sxs-lookup"><span data-stu-id="79762-176">Inside means the installed software and overall desired state configuration.</span></span> <span data-ttu-id="79762-177">Les autres mécanismes, tels que les extensions de machine virtuelle ou les scripts sont utilisés en tout ou partie.</span><span class="sxs-lookup"><span data-stu-id="79762-177">Other mechanisms, such as VM extensions or scripts, are used in whole or in part.</span></span> <span data-ttu-id="79762-178">Ces mécanismes peuvent être identifiés et exécutés par le modèle, mais ils n’en font pas partie.</span><span class="sxs-lookup"><span data-stu-id="79762-178">These mechanisms may be identified and executed by the template but aren’t in it.</span></span>

<span data-ttu-id="79762-179">Exemples courants des activités à faire « en interne » :</span><span class="sxs-lookup"><span data-stu-id="79762-179">Common examples of activities you would do “inside the box” include -</span></span>  

* <span data-ttu-id="79762-180">Installer ou supprimer des fonctionnalités et des rôles de serveur</span><span class="sxs-lookup"><span data-stu-id="79762-180">Install or remove server roles and features</span></span>
* <span data-ttu-id="79762-181">Installer et configurer des logiciels au niveau du nœud ou du cluster</span><span class="sxs-lookup"><span data-stu-id="79762-181">Install and configure software at the node or cluster level</span></span>
* <span data-ttu-id="79762-182">Déployer des sites web sur un serveur web</span><span class="sxs-lookup"><span data-stu-id="79762-182">Deploy websites on a web server</span></span>
* <span data-ttu-id="79762-183">Déployer des schémas de base de données</span><span class="sxs-lookup"><span data-stu-id="79762-183">Deploy database schemas</span></span>
* <span data-ttu-id="79762-184">Gérer le Registre ou d’autres types de paramètre de configuration</span><span class="sxs-lookup"><span data-stu-id="79762-184">Manage registry or other types of configuration settings</span></span>
* <span data-ttu-id="79762-185">Gérer les fichiers et répertoires</span><span class="sxs-lookup"><span data-stu-id="79762-185">Manage files and directories</span></span>
* <span data-ttu-id="79762-186">Démarrer, arrêter et gérer les processus et services</span><span class="sxs-lookup"><span data-stu-id="79762-186">Start, stop, and manage processes and services</span></span>
* <span data-ttu-id="79762-187">Gérer les groupes locaux et comptes d’utilisateur</span><span class="sxs-lookup"><span data-stu-id="79762-187">Manage local groups and user accounts</span></span>
* <span data-ttu-id="79762-188">Installer et gérer les packages (.msi, .exe, yum, etc.)</span><span class="sxs-lookup"><span data-stu-id="79762-188">Install and manage packages (.msi, .exe, yum, etc.)</span></span>
* <span data-ttu-id="79762-189">Gérer les variables d’environnement</span><span class="sxs-lookup"><span data-stu-id="79762-189">Manage environment variables</span></span>
* <span data-ttu-id="79762-190">Exécuter les scripts natifs (Windows PowerShell, bash, etc.)</span><span class="sxs-lookup"><span data-stu-id="79762-190">Run native scripts (Windows PowerShell, bash, etc.)</span></span>

### <a name="desired-state-configuration-dsc"></a><span data-ttu-id="79762-191">Configuration d’état souhaité (DSC)</span><span class="sxs-lookup"><span data-stu-id="79762-191">Desired state configuration (DSC)</span></span>
<span data-ttu-id="79762-192">Réfléchissez à l’état interne de vos machines virtuelles au-delà du déploiement ; vous voulez vous assurer que ce déploiement ne « dérive » pas de la configuration que vous avez définie et archivée dans le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="79762-192">Thinking about the internal state of your VMs beyond deployment, you want to make sure this deployment doesn’t "drift" from the configuration that you have defined and checked into source control.</span></span> <span data-ttu-id="79762-193">Cette approche vous assure que vos développeurs ou que votre personnel des opérations n’apportent pas de modifications ad hoc à un environnement, qui ne sont pas approuvées, testées ou enregistrées dans le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="79762-193">This approach ensures your developers or operations staff don’t make ad-hoc changes to an environment that are not vetted, tested, or recorded in source control.</span></span> <span data-ttu-id="79762-194">Ce contrôle est important, car les modifications manuelles ne figurent pas dans le contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="79762-194">This control is important, because the manual changes are not in source control.</span></span> <span data-ttu-id="79762-195">Elles ne font donc pas partie du déploiement standard et ont un impact sur les futurs déploiements automatisés du logiciel.</span><span class="sxs-lookup"><span data-stu-id="79762-195">They are also not part of the standard deployment and will impact future automated deployments of the software.</span></span>

<span data-ttu-id="79762-196">Outre pour vos employés internes, la configuration d’état souhaité est également importante en matière de sécurité.</span><span class="sxs-lookup"><span data-stu-id="79762-196">Beyond your internal employees, desired state configuration is also important from a security perspective.</span></span> <span data-ttu-id="79762-197">Les pirates informatiques essaient régulièrement de compromettre et d’exploiter les systèmes logiciels.</span><span class="sxs-lookup"><span data-stu-id="79762-197">Hackers are regularly trying to compromise and exploit software systems.</span></span> <span data-ttu-id="79762-198">En cas de succès, il est courant d’installer des fichiers et de modifier l’état d’un système compromis.</span><span class="sxs-lookup"><span data-stu-id="79762-198">When successful, it's common to install files and otherwise change the state of a compromised system.</span></span> <span data-ttu-id="79762-199">À l’aide de la configuration d’état souhaité, vous pouvez identifier des deltas entre l’état souhaité et l’état réel, et restaurer une configuration connue.</span><span class="sxs-lookup"><span data-stu-id="79762-199">Using desired state configuration, you can identify deltas between the desired and actual state and restore a known configuration.</span></span>

<span data-ttu-id="79762-200">Il existe des extensions de ressource pour les mécanismes les plus populaires de DSC : DSC PowerShell, Chef et Puppet.</span><span class="sxs-lookup"><span data-stu-id="79762-200">There are resource extensions for the most popular mechanisms for DSC - PowerShell DSC, Chef, and Puppet.</span></span> <span data-ttu-id="79762-201">Chacune de ces extensions peut déployer l’état initial de votre machine virtuelle et peut également être utilisée pour vérifier que l’état souhaité est conservé.</span><span class="sxs-lookup"><span data-stu-id="79762-201">Each of these extensions can deploy the initial state of your VM and also be used to make sure the desired state is maintained.</span></span>

## <a name="common-template-scopes"></a><span data-ttu-id="79762-202">Étendues courantes de modèle</span><span class="sxs-lookup"><span data-stu-id="79762-202">Common template scopes</span></span>
<span data-ttu-id="79762-203">Nous avons vu que trois étendues clés de modèle de solution émergent.</span><span class="sxs-lookup"><span data-stu-id="79762-203">In our experience, we’ve seen three key solution templates scopes emerge.</span></span> <span data-ttu-id="79762-204">Ces trois étendues (de capacité, de fonctionnalité et de solution de bout en bout) sont décrites plus en détail dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="79762-204">These three scopes – capacity, capability, and end-to-end solution – are described in the following sections.</span></span>

### <a name="capacity-scope"></a><span data-ttu-id="79762-205">Étendue de capacité</span><span class="sxs-lookup"><span data-stu-id="79762-205">Capacity scope</span></span>
<span data-ttu-id="79762-206">Une étendue de capacité fournit un ensemble de ressources dans une topologie standard qui est préconfigurée pour respecter les réglementations et les stratégies.</span><span class="sxs-lookup"><span data-stu-id="79762-206">A capacity scope delivers a set of resources in a standard topology that is pre-configured to be in compliance with regulations and policies.</span></span> <span data-ttu-id="79762-207">L’exemple le plus courant consiste à déployer un environnement de développement standard dans un scénario d’informatique d’entreprise ou d’intégrateur de système.</span><span class="sxs-lookup"><span data-stu-id="79762-207">The most common example is deploying a standard development environment in an Enterprise IT or SI scenario.</span></span>

### <a name="capability-scope"></a><span data-ttu-id="79762-208">Étendue de fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="79762-208">Capability scope</span></span>
<span data-ttu-id="79762-209">Une étendue de fonctionnalité est axée sur le déploiement et la configuration d’une topologie pour une technologie donnée.</span><span class="sxs-lookup"><span data-stu-id="79762-209">A capability scope is focused on deploying and configuring a topology for a given technology.</span></span> <span data-ttu-id="79762-210">Les scénarios courants incluent les technologies SQL Server, Cassandra et Hadoop.</span><span class="sxs-lookup"><span data-stu-id="79762-210">Common scenarios including technologies such as SQL Server, Cassandra, Hadoop.</span></span>

### <a name="end-to-end-solution-scope"></a><span data-ttu-id="79762-211">Étendue de solution de bout en bout</span><span class="sxs-lookup"><span data-stu-id="79762-211">End-to-end solution scope</span></span>
<span data-ttu-id="79762-212">Une étendue de solution de bout en bout est ciblée au-delà d’une seule et même fonctionnalité et est plutôt axée sur la fourniture d’une solution de bout en bout composée de plusieurs fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="79762-212">An End-to-End Solution Scope is targeted beyond a single capability, and instead focused on delivering an end to end solution comprised of multiple capabilities.</span></span>  

<span data-ttu-id="79762-213">Un modèle avec étendue de solution se manifeste comme un ensemble d’un ou plusieurs modèles à étendue de fonctionnalité avec des ressources, une logique et un état souhaité propres à la solution.</span><span class="sxs-lookup"><span data-stu-id="79762-213">A solution-scoped template scope manifests itself as a set of one or more capability-scoped templates with solution-specific resources, logic, and desired state.</span></span> <span data-ttu-id="79762-214">Un modèle avec étendue de solution est par exemple un modèle de solution de pipeline de données de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="79762-214">An example of a solution-scoped template is an end to end data pipeline solution template.</span></span> <span data-ttu-id="79762-215">Le modèle peut combiner une topologie et un état propres à une solution avec plusieurs modèles de solution avec étendue de fonctionnalité comme Kafka, Storm et Hadoop.</span><span class="sxs-lookup"><span data-stu-id="79762-215">The template might mix solution-specific topology and state with multiple capability-scoped solution templates such as Kafka, Storm, and Hadoop.</span></span>

## <a name="choosing-free-form-vs-known-configurations"></a><span data-ttu-id="79762-216">Choix de configurations ouvertes et connues</span><span class="sxs-lookup"><span data-stu-id="79762-216">Choosing free-form vs. known configurations</span></span>
<span data-ttu-id="79762-217">Initialement, vous pouvez penser qu’un modèle doit donner aux clients la flexibilité maximale, mais de nombreuses considérations affectent le choix quant à l’utilisation de configurations ouvertes ou connues.</span><span class="sxs-lookup"><span data-stu-id="79762-217">You might initially think a template should give consumers the utmost flexibility, but many considerations affect the choice of whether to use free-form configurations vs. known configurations.</span></span> <span data-ttu-id="79762-218">Cette section identifie les principales exigences des clients et les considérations techniques qui ont façonné l’approche partagée dans ce document.</span><span class="sxs-lookup"><span data-stu-id="79762-218">This section identifies the key customer requirements and technical considerations that shaped the approach shared in this document.</span></span>

### <a name="free-form-configurations"></a><span data-ttu-id="79762-219">Configurations ouvertes</span><span class="sxs-lookup"><span data-stu-id="79762-219">Free-form configurations</span></span>
<span data-ttu-id="79762-220">De prime abord, les configurations ouvertes semblent idéales.</span><span class="sxs-lookup"><span data-stu-id="79762-220">On the surface, free-form configurations sound ideal.</span></span> <span data-ttu-id="79762-221">Elles vous permettent de sélectionner un type de machine virtuelle et de fournir un nombre arbitraire de nœuds et de disques attachés pour ces nœuds, et ce, en tant que paramètres pour un modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-221">They allow you to select a VM type and provide an arbitrary number of nodes and attached disks for those nodes — and do so as parameters to a template.</span></span> <span data-ttu-id="79762-222">Toutefois, cette approche n’est pas idéale pour certains scénarios.</span><span class="sxs-lookup"><span data-stu-id="79762-222">However, this approach is not ideal for some scenarios.</span></span>

<span data-ttu-id="79762-223">L’article [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) (Taille des machines virtuelles) présente les différents types et tailles de machines virtuelles disponibles, ainsi que le nombre de disques (2, 4, 8, 16 ou 32) pouvant être attachés.</span><span class="sxs-lookup"><span data-stu-id="79762-223">In [Sizes for virtual machines](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), the different VM types and available sizes are identified, and each of the number of durable disks (2, 4, 8, 16, or 32) that can be attached.</span></span> <span data-ttu-id="79762-224">Chaque disque attaché fournit 500 E/S par seconde, et plusieurs disques peuvent être regroupés pour obtenir un multiplicateur de ce nombre d’E/S par seconde.</span><span class="sxs-lookup"><span data-stu-id="79762-224">Each attached disk provides 500 IOPS and multiples of these disks can be pooled for a multiplier of that number of IOPS.</span></span> <span data-ttu-id="79762-225">Par exemple, 16 disques peuvent être regroupés pour fournir 8 000 E/S par seconde.</span><span class="sxs-lookup"><span data-stu-id="79762-225">For example, 16 disks can be pooled to provide 8,000 IOPS.</span></span> <span data-ttu-id="79762-226">Le regroupement est effectué avec la configuration dans le système d’exploitation, à l’aide des espaces de stockage Microsoft Windows ou des disques RAID (Redundant Array of Inexpensive Disk) dans Linux.</span><span class="sxs-lookup"><span data-stu-id="79762-226">Pooling is done with configuration in the operating system, using Microsoft Windows Storage Spaces or redundant array of inexpensive disks (RAID) in Linux.</span></span>

<span data-ttu-id="79762-227">Une configuration ouverte permet de sélectionner plusieurs instances de machine virtuelle, différents types de machine virtuelle et différentes tailles de ces instances, un nombre de disques différent en fonction du type de machine virtuelle et un ou plusieurs scripts pour configurer le contenu de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="79762-227">A free-form configuration enables the selection several VM instances, various VM types and sizes for those instances, various disks for the VM type, and one or more scripts to configure the VM contents.</span></span>

<span data-ttu-id="79762-228">Il est courant qu’un déploiement comprenne plusieurs types de nœud, tels que les nœuds principaux et de données. Cette flexibilité est donc souvent proposée pour tous les types de nœud.</span><span class="sxs-lookup"><span data-stu-id="79762-228">It is common that a deployment may have multiple types of nodes, such as master and data nodes, so this flexibility is often provided for every node type.</span></span>

<span data-ttu-id="79762-229">Lorsque vous commencez à déployer des clusters de toutes tailles, vous commencez à travailler avec des scénarios complexes.</span><span class="sxs-lookup"><span data-stu-id="79762-229">As you start to deploy clusters of any significance, you begin to work with these complex scenarios.</span></span> <span data-ttu-id="79762-230">Si vous déployez un cluster Hadoop, par exemple, comprenant 8 nœuds principaux et 200 nœuds de données, puis regroupez 4 disques attachés sur chaque nœud principal et 16 disques attachés par nœud de données, vous disposez de 208 machines virtuelles et de 3 232 disques à gérer.</span><span class="sxs-lookup"><span data-stu-id="79762-230">If you were deploying a Hadoop cluster, for example, with 8 master nodes and 200 data nodes, and pooled 4 attached disks on each master node and pooled 16 attached disks per data node, you would have 208 VMs and 3,232 disks to manage.</span></span>

<span data-ttu-id="79762-231">Un compte de stockage limite les demandes supérieures à sa limite identifiée de 20 000 transactions par seconde. Vous devez donc examiner le partitionnement de comptes de stockage et effectuer des calculs pour déterminer le nombre approprié de comptes de stockage pour s’adapter à cette topologie.</span><span class="sxs-lookup"><span data-stu-id="79762-231">A storage account will throttle requests above its identified 20,000 transactions/second limit, so you should look at storage account partitioning and use calculations to determine the appropriate number of storage accounts to accommodate this topology.</span></span> <span data-ttu-id="79762-232">Étant donné la multitude des combinaisons prises en charge par l’approche ouverte, des calculs dynamiques sont requis pour déterminer le partitionnement approprié.</span><span class="sxs-lookup"><span data-stu-id="79762-232">Given the multitude of combinations supported by the free-form approach, dynamic calculations are required to determine the appropriate partitioning.</span></span> <span data-ttu-id="79762-233">Actuellement, le langage du modèle Azure Resource Manager ne fournit pas de fonctions mathématiques. Vous devez donc effectuer ces calculs dans le code, en générant un modèle unique, codé en dur avec les détails appropriés.</span><span class="sxs-lookup"><span data-stu-id="79762-233">The Azure Resource Manager Template Language does not presently provide mathematical functions, so you must perform these calculations in code, generating a unique, hard-coded template with the appropriate details.</span></span>

<span data-ttu-id="79762-234">Dans les scénarios d’informatique d’entreprise ou d’intégrateur de système, une personne doit mettre à jour les modèles et assurer le support des topologies déployées pour une ou plusieurs organisations.</span><span class="sxs-lookup"><span data-stu-id="79762-234">In enterprise IT and SI scenarios, someone must maintain the templates and support the deployed topologies for one or more organizations.</span></span> <span data-ttu-id="79762-235">Cette surcharge supplémentaire, à savoir différentes configurations et différents modèles pour chaque client, est loin d’être souhaitable.</span><span class="sxs-lookup"><span data-stu-id="79762-235">This additional overhead — different configurations and templates for each customer — is far from desirable.</span></span>

<span data-ttu-id="79762-236">Vous pouvez utiliser ces modèles pour déployer des environnements dans l’abonnement Azure de vos clients, mais les équipes informatiques d’entreprise et les fournisseurs de services cloud les déploient généralement dans leur propre abonnement, en utilisant une fonction de rétrofacturation pour facturer leurs clients.</span><span class="sxs-lookup"><span data-stu-id="79762-236">You can use these templates to deploy environments in your customer’s Azure subscription, but both corporate IT teams and CSVs typically deploy them into their own subscriptions, using a chargeback function to bill their customers.</span></span> <span data-ttu-id="79762-237">Dans ces scénarios, l’objectif est de déployer une capacité pour plusieurs clients au sein d’un pool d’abonnements et de conserver des déploiements denses dans les abonnements pour réduire leur prolifération, qui implique un plus grand nombre d’abonnements à gérer.</span><span class="sxs-lookup"><span data-stu-id="79762-237">In these scenarios, the goal is to deploy capacity for multiple customers across a pool of subscriptions and keep deployments densely populated into the subscriptions to minimize subscription sprawl—that is, more subscriptions to manage.</span></span> <span data-ttu-id="79762-238">Avec des tailles de déploiement réellement dynamiques, atteindre ce type de densité nécessite une planification attentive et le développement supplémentaire de travail de génération de modèles automatique pour le compte de l’entreprise.</span><span class="sxs-lookup"><span data-stu-id="79762-238">With truly dynamic deployment sizes, achieving this type of density requires careful planning and additional development for scaffolding work on behalf of the organization.</span></span>

<span data-ttu-id="79762-239">En outre, vous ne pouvez pas créer d’abonnements via un appel d’API, mais devez le faire manuellement via le portail.</span><span class="sxs-lookup"><span data-stu-id="79762-239">In addition, you can’t create subscriptions via an API call but must do so manually through the portal.</span></span> <span data-ttu-id="79762-240">À mesure que le nombre d’abonnements augmente, la prolifération d’abonnements nécessite une intervention humaine, car elle ne peut pas être automatisée.</span><span class="sxs-lookup"><span data-stu-id="79762-240">As the number of subscriptions increases, any resulting subscription sprawl requires human intervention—it can’t be automated.</span></span> <span data-ttu-id="79762-241">Avec des tailles de déploiements aussi variables, vous seriez tenu de préconfigurer manuellement un certain nombre d’abonnements pour garantir la disponibilité des abonnements.</span><span class="sxs-lookup"><span data-stu-id="79762-241">With so much variability in the sizes of deployments, you would have to pre-provision a number of subscriptions manually to ensure subscriptions are available.</span></span>

<span data-ttu-id="79762-242">Compte tenu de tous ces facteurs, une configuration réellement ouverte est moins intéressante que de prime abord.</span><span class="sxs-lookup"><span data-stu-id="79762-242">Considering all these factors, a truly free-form configuration is less appealing than at first blush.</span></span>

### <a name="known-configurations--the-t-shirt-sizing-approach"></a><span data-ttu-id="79762-243">Configurations connues : l’approche des tailles standard</span><span class="sxs-lookup"><span data-stu-id="79762-243">Known configurations — the t-shirt sizing approach</span></span>
<span data-ttu-id="79762-244">Au lieu de proposer un modèle qui fournit une flexibilité totale et des variations innombrables, dans notre expérience, un modèle courant consiste à permettre de sélectionner des configurations connues, c’est-à-dire des tailles standard (bac à sable, petite, moyenne et grande).</span><span class="sxs-lookup"><span data-stu-id="79762-244">Rather than offer a template that provides total flexibility and countless variations, in our experience a common pattern is to provide the ability to select known configurations — in effect, standard t-shirt sizes such as sandbox, small, medium, and large.</span></span> <span data-ttu-id="79762-245">Les autres exemples de taille standard sont des offres de produits, telles que l’édition Community ou Enterprise.</span><span class="sxs-lookup"><span data-stu-id="79762-245">Other examples of t-shirt sizes are product offerings, such as community edition or enterprise edition.</span></span>  <span data-ttu-id="79762-246">Dans d’autres cas, il peut s’agir de configurations d’une technologie propres à une charge de travail, par exemple MapReduce ou sans SQL.</span><span class="sxs-lookup"><span data-stu-id="79762-246">In other cases, it may be workload-specific configurations of a technology – such as map reduce or no sql.</span></span>

<span data-ttu-id="79762-247">Nombre d’entreprises informatiques, de fournisseurs OSS et d’intégrateurs de systèmes proposent leurs offres aujourd’hui de cette façon dans des environnements locaux, virtualisés (entreprises) ou en tant qu’offres SaaS (fournisseurs de services cloud et de systèmes d’exploitation).</span><span class="sxs-lookup"><span data-stu-id="79762-247">Many enterprise IT organizations, OSS vendors, and SIs make their offerings available today in this way in on-premises, virtualized environments (enterprises) or as software-as-a-service (SaaS) offerings (CSVs and OSVs).</span></span>

<span data-ttu-id="79762-248">Cette approche fournit des configurations correctes, connues de différentes tailles qui sont préconfigurées pour les clients.</span><span class="sxs-lookup"><span data-stu-id="79762-248">This approach provides good, known configurations of varying sizes that are preconfigured for customers.</span></span> <span data-ttu-id="79762-249">Sans configurations connues, les clients finaux doivent eux-mêmes déterminer la taille de cluster, tenir compte des contraintes des ressources de plateforme et effectuer des opérations mathématiques pour identifier le partitionnement résultant des comptes de stockage et des autres ressources (en raison des contraintes de taille de cluster et de ressource).</span><span class="sxs-lookup"><span data-stu-id="79762-249">Without known configurations, end customers must determine cluster sizing on their own, factor in platform resource constraints, and do math to identify the resulting partitioning of storage accounts and other resources (due to cluster size and resource constraints).</span></span> <span data-ttu-id="79762-250">Les configurations connues permettent aux clients de sélectionner facilement la bonne taille, c’est-à-dire un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="79762-250">Known configurations enable customers to easily select the right t-shirt size—that is, a given deployment.</span></span> <span data-ttu-id="79762-251">Outre l’amélioration de l’expérience du client qu’il procure, un petit nombre de configurations connues est plus facile à prendre en charge et peut vous aider à fournir un haut niveau de densité.</span><span class="sxs-lookup"><span data-stu-id="79762-251">In addition to making a better experience for the customer, a small number of known configurations is easier to support and can help you deliver a higher level of density.</span></span>

<span data-ttu-id="79762-252">Une approche de configuration connue axée sur des tailles standard peut également proposer un nombre de nœuds variable par taille.</span><span class="sxs-lookup"><span data-stu-id="79762-252">A known configuration approach focused on t-shirt sizes may also have varying number of nodes within a size.</span></span> <span data-ttu-id="79762-253">Par exemple, une petite taille peut comprendre 3 à 10 nœuds.</span><span class="sxs-lookup"><span data-stu-id="79762-253">For example, a small t-shirt size may be between 3 and 10 nodes.</span></span>  <span data-ttu-id="79762-254">La taille standard est conçue pour prendre en charge jusqu’à 10 nœuds et permettre au client d’effectuer des sélections libres allant jusqu’à la taille maximale identifiée.</span><span class="sxs-lookup"><span data-stu-id="79762-254">The t-shirt size would be designed to accommodate up to 10 nodes and provide the consumer the ability to make free form selections up to the maximum size identified.</span></span>  

<span data-ttu-id="79762-255">Une taille standard basée sur le type de charge de travail peut être plus libre en termes de nombre de nœuds pouvant être déployés, mais aura une taille de nœud distincte de la charge de travail et une configuration des logiciels sur le nœud.</span><span class="sxs-lookup"><span data-stu-id="79762-255">A t-shirt size based on workload type, may be more free form in nature in terms of the number of nodes that can be deployed but will have workload distinct node size and configuration of the software on the node.</span></span>

<span data-ttu-id="79762-256">Les tailles standard basées sur les offres de produits, telles que Community ou Enterprise, peuvent avoir des types de ressource et un nombre maximal de nœuds distincts pouvant être déployés. Cela tient généralement aux licences ou à la disponibilité des fonctionnalités entre les différentes offres.</span><span class="sxs-lookup"><span data-stu-id="79762-256">T-shirt sizes based on product offerings, such as community or Enterprise, may have distinct resource types and maximum number of nodes that can be deployed, typically tied to licensing considerations or feature availability across the different offerings.</span></span>

<span data-ttu-id="79762-257">Vous pouvez également satisfaire des clients avec des variantes uniques utilisant des modèles basés sur JSON.</span><span class="sxs-lookup"><span data-stu-id="79762-257">You can also accommodate customers with unique variants using the JSON-based templates.</span></span> <span data-ttu-id="79762-258">Lorsque vous faites face à des valeurs hors-norme, vous pouvez incorporer la planification et les considérations appropriées pour le développement, le support et l’évaluation des coûts.</span><span class="sxs-lookup"><span data-stu-id="79762-258">When dealing with outliers, you can incorporate the appropriate planning and considerations for development, support, and costing.</span></span>

<span data-ttu-id="79762-259">En fonction des scénarios de consommation de modèle par les clients et des besoins identifiés au début de ce document, nous avons identifié un schéma de décomposition de modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-259">Based on the customer template consumption scenarios, and requirements identified at the start of this document, we identified a pattern for template decomposition.</span></span>

## <a name="capacity-and-capability-scoped-solution-templates"></a><span data-ttu-id="79762-260">Modèles de solution avec étendue de capacité et de fonctionnalité</span><span class="sxs-lookup"><span data-stu-id="79762-260">Capacity and capability-scoped solution templates</span></span>
<span data-ttu-id="79762-261">La décomposition fournit une approche modulaire au développement de modèles, qui prend en charge la réutilisation, l’extensibilité, le test et les outils.</span><span class="sxs-lookup"><span data-stu-id="79762-261">Decomposition provides a modular approach to template development that supports reuse, extensibility, testing, and tooling.</span></span> <span data-ttu-id="79762-262">Cette section fournit des détails sur la façon dont une approche de décomposition peut être appliquée à des modèles avec une étendue de capacité ou de fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="79762-262">This section provides detail on how a decomposition approach can be applied to templates with a Capacity or Capability scope.</span></span>

<span data-ttu-id="79762-263">Dans cette approche, un modèle principal reçoit des valeurs de paramètre d’un utilisateur de modèle, puis établit un lien vers plusieurs types de modèle et de script en aval, comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="79762-263">In this approach, a main template receives parameter values from a template consumer, then links to several types of templates and scripts downstream as shown below.</span></span> <span data-ttu-id="79762-264">Les paramètres, les variables statiques et les variables générées permettent de fournir des valeurs aux modèles liés.</span><span class="sxs-lookup"><span data-stu-id="79762-264">Parameters, static variables, and generated variables are used to provide values in and out of the linked templates.</span></span>

![Paramètres de modèle](./media/best-practices-resource-manager-design-templates/template-parameters.png)

<span data-ttu-id="79762-266">**Les paramètres sont transmis à un modèle principal, puis aux modèles liés**</span><span class="sxs-lookup"><span data-stu-id="79762-266">**Parameters are passed to a main template then to linked templates**</span></span>

<span data-ttu-id="79762-267">Les sections suivantes sont consacrées aux types de modèle et de script composant un modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-267">The following sections focus on the types of templates and scripts that a single template is decomposed into.</span></span> <span data-ttu-id="79762-268">Elles présentent également les approches adoptées pour transférer les informations d’état entre les modèles.</span><span class="sxs-lookup"><span data-stu-id="79762-268">The sections present approaches for passing state information among the templates.</span></span> <span data-ttu-id="79762-269">Chaque modèle ainsi que les types de script dans l’image sont décrits avec des exemples.</span><span class="sxs-lookup"><span data-stu-id="79762-269">Each template and the script types in the image are described along with examples.</span></span> <span data-ttu-id="79762-270">Pour obtenir un exemple contextuel, consultez la rubrique « Synthèse générale : Exemple d’implémentation » plus loin dans ce document.</span><span class="sxs-lookup"><span data-stu-id="79762-270">For a contextual example, see "Putting it together: a sample implementation" later in this document.</span></span>

### <a name="template-metadata"></a><span data-ttu-id="79762-271">Métadonnées de modèle</span><span class="sxs-lookup"><span data-stu-id="79762-271">Template metadata</span></span>
<span data-ttu-id="79762-272">Les métadonnées de modèle (fichier metadata.json) contiennent des paires clé/valeur, qui décrivent un modèle dans JSON, lequel peut être lu par les utilisateurs et les systèmes logiciels.</span><span class="sxs-lookup"><span data-stu-id="79762-272">Template metadata (the metadata.json file) contains key/value pairs that describe a template in JSON, which can be read by humans and software systems.</span></span>

![Métadonnées de modèle](./media/best-practices-resource-manager-design-templates/template-metadata.png)

<span data-ttu-id="79762-274">**Les métadonnées de modèle sont décrites dans le fichier metadata.json**</span><span class="sxs-lookup"><span data-stu-id="79762-274">**Template metadata is described in the metadata.json file**</span></span>

<span data-ttu-id="79762-275">Les agents de logiciel peuvent récupérer le fichier metadata.json et publier les informations et un lien vers le modèle dans une page ou un répertoire web.</span><span class="sxs-lookup"><span data-stu-id="79762-275">Software agents can retrieve the metadata.json file and publish the information and a link to the template in a web page or directory.</span></span> <span data-ttu-id="79762-276">Les éléments incluent *itemDisplayName*, *description*, *summary*, *githubUsername* et *dateUpdated*.</span><span class="sxs-lookup"><span data-stu-id="79762-276">Elements include *itemDisplayName*, *description*, *summary*, *githubUsername*, and *dateUpdated*.</span></span>

<span data-ttu-id="79762-277">Un exemple de fichier est présenté ci-dessous dans son intégralité.</span><span class="sxs-lookup"><span data-stu-id="79762-277">An example file is shown below in its entirety.</span></span>

    {
        "itemDisplayName": "PostgreSQL 9.3 on Ubuntu VMs",
        "description": "This template creates a PostgreSQL streaming-replication between a master and one or more slave servers each with 2 striped data disks. The database servers are deployed into a private-only subnet with one publicly accessible jumpbox VM in a DMZ subnet with public IP.",
        "summary": "PostgreSQL stream-replication with multiple slave servers and a publicly accessible jumpbox VM",
        "githubUsername": "arsenvlad",
        "dateUpdated": "2015-04-24"
    }

### <a name="main-template"></a><span data-ttu-id="79762-278">Modèle principal</span><span class="sxs-lookup"><span data-stu-id="79762-278">Main template</span></span>
<span data-ttu-id="79762-279">Le modèle principal reçoit les paramètres d’un utilisateur, utilise ces informations pour renseigner des variables objets complexes et exécute les modèles liés.</span><span class="sxs-lookup"><span data-stu-id="79762-279">The main template receives parameters from a user, uses that information to populate complex object variables, and executes the linked templates.</span></span>

![Modèle principal](./media/best-practices-resource-manager-design-templates/main-template.png)

<span data-ttu-id="79762-281">**Le modèle principal reçoit les paramètres d’un utilisateur**</span><span class="sxs-lookup"><span data-stu-id="79762-281">**The main template receives parameters from a user**</span></span>

<span data-ttu-id="79762-282">Un paramètre fourni est un type de configuration connue également désigné sous le nom de paramètre de taille standard en raison de ses valeurs normalisées : petit, moyen ou grand.</span><span class="sxs-lookup"><span data-stu-id="79762-282">One parameter that is provided is a known configuration type also known as the t-shirt size parameter because of its standardized values such as small, medium, or large.</span></span> <span data-ttu-id="79762-283">Dans la pratique, vous pouvez utiliser ce paramètre de plusieurs façons.</span><span class="sxs-lookup"><span data-stu-id="79762-283">In practice, you can use this parameter in multiple ways.</span></span> <span data-ttu-id="79762-284">Pour plus d’informations, consultez la rubrique « Modèles de ressource de configuration connue », plus loin dans ce document.</span><span class="sxs-lookup"><span data-stu-id="79762-284">For details, see "Known configuration resources template" later in this document.</span></span>

<span data-ttu-id="79762-285">Certaines ressources sont déployées indépendamment de la configuration connue spécifiée par un paramètre utilisateur.</span><span class="sxs-lookup"><span data-stu-id="79762-285">Some resources are deployed regardless of the known configuration specified by a user parameter.</span></span> <span data-ttu-id="79762-286">Ces ressources sont approvisionnées à l’aide d’un modèle de ressource partagé unique et sont partagées par les autres modèles, le modèle de ressource partagé étant exécuté en premier.</span><span class="sxs-lookup"><span data-stu-id="79762-286">These resources are provisioned using a single shared resource template and are shared by other templates, so the shared resource template is run first.</span></span>

<span data-ttu-id="79762-287">Certaines ressources sont déployées éventuellement, indépendamment de la configuration connue spécifiée.</span><span class="sxs-lookup"><span data-stu-id="79762-287">Some resources are deployed optionally regardless of the specified known configuration.</span></span>

### <a name="shared-resources-template"></a><span data-ttu-id="79762-288">Modèle de ressource partagé</span><span class="sxs-lookup"><span data-stu-id="79762-288">Shared resources template</span></span>
<span data-ttu-id="79762-289">Ce modèle propose des ressources communes à toutes les configurations connues.</span><span class="sxs-lookup"><span data-stu-id="79762-289">This template delivers resources that are common across all known configurations.</span></span> <span data-ttu-id="79762-290">Il contient le réseau virtuel, des groupes à haute disponibilité et les autres ressources qui sont requises, quel que soit le modèle de configuration connue déployé.</span><span class="sxs-lookup"><span data-stu-id="79762-290">It contains the virtual network, availability sets, and other resources that are required regardless of the known configuration template that is deployed.</span></span>

![Ressources de modèle](./media/best-practices-resource-manager-design-templates/template-resources.png)

<span data-ttu-id="79762-292">**Modèle de ressource partagé**</span><span class="sxs-lookup"><span data-stu-id="79762-292">**Shared resources template**</span></span>

<span data-ttu-id="79762-293">Les noms de ressource, comme le nom de réseau virtuel, sont basés sur le modèle principal.</span><span class="sxs-lookup"><span data-stu-id="79762-293">Resource names, such as the virtual network name, are based on the main template.</span></span> <span data-ttu-id="79762-294">Vous pouvez les spécifier en tant que variable dans ce modèle ou les recevoir de l’utilisateur en tant que paramètre, comme requis par votre entreprise.</span><span class="sxs-lookup"><span data-stu-id="79762-294">You can specify them as a variable within that template or receive them as a parameter from the user, as required by your organization.</span></span>

### <a name="optional-resources-template"></a><span data-ttu-id="79762-295">Modèle de ressource facultatif</span><span class="sxs-lookup"><span data-stu-id="79762-295">Optional resources template</span></span>
<span data-ttu-id="79762-296">Le modèle de ressource facultatif contient des ressources qui sont déployées par programme en fonction de la valeur d’une variable ou d’un paramètre.</span><span class="sxs-lookup"><span data-stu-id="79762-296">The optional resources template contains resources that are programmatically deployed based on the value of a parameter or variable.</span></span>

![Ressources facultatives](./media/best-practices-resource-manager-design-templates/optional-resources.png)

<span data-ttu-id="79762-298">**Modèle de ressource facultatif**</span><span class="sxs-lookup"><span data-stu-id="79762-298">**Optional resources template**</span></span>

<span data-ttu-id="79762-299">Par exemple, vous pouvez utiliser un modèle de ressource facultatif pour configurer une jumpbox, qui permet d’accéder indirectement à un environnement déployé à partir de l’Internet public.</span><span class="sxs-lookup"><span data-stu-id="79762-299">For example, you can use an optional resources template to configure a jumpbox that enables indirect access to a deployed environment from the public Internet.</span></span> <span data-ttu-id="79762-300">Vous devez utiliser un paramètre ou une variable pour déterminer si la jumpbox doit être activée, et pour identifier la fonction *concat* permettant de générer le nom cible du modèle, par exemple *jumpbox_enabled.json*.</span><span class="sxs-lookup"><span data-stu-id="79762-300">You would use a parameter or variable to identify whether the jumpbox should be enabled and the *concat* function to build the target name for the template, such as *jumpbox_enabled.json*.</span></span> <span data-ttu-id="79762-301">La liaison de modèles doit utiliser la variable obtenue pour installer la jumpbox.</span><span class="sxs-lookup"><span data-stu-id="79762-301">Template linking would use the resulting variable to install the jumpbox.</span></span>

<span data-ttu-id="79762-302">Vous pouvez lier le modèle de ressource facultatif à partir de plusieurs emplacements :</span><span class="sxs-lookup"><span data-stu-id="79762-302">You can link the optional resources template from multiple places:</span></span>

* <span data-ttu-id="79762-303">S’il est applicable à tous les déploiements, créez un lien contrôlé par les paramètres à partir du modèle de ressource partagé.</span><span class="sxs-lookup"><span data-stu-id="79762-303">When applicable to every deployment, create a parameter-driven link from the shared resources template.</span></span>
* <span data-ttu-id="79762-304">S’il est applicable à certaines configurations connues, par exemple, uniquement sur les déploiements à grande échelle, créez un lien contrôlé par les paramètres ou contrôlé par les variables à partir du modèle de configuration connue.</span><span class="sxs-lookup"><span data-stu-id="79762-304">When applicable to select known configurations—for example, only install on large deployments—create a parameter-driven or variable-driven link from the known configuration template.</span></span>

<span data-ttu-id="79762-305">Si une ressource donnée est facultative, il se peut qu’elle soit contrôlée par le fournisseur du modèle plutôt que par son utilisateur.</span><span class="sxs-lookup"><span data-stu-id="79762-305">Whether a given resource is optional may not be driven by the template consumer but instead by the template provider.</span></span> <span data-ttu-id="79762-306">Par exemple, vous devrez peut-être répondre à une spécification de produit particulière ou à un module complémentaire de produit (commun aux fournisseurs de services cloud), ou appliquer des stratégies (communes aux groupes d’intégrateurs de systèmes et de services informatiques).</span><span class="sxs-lookup"><span data-stu-id="79762-306">For example, you may need to satisfy a particular product requirement or product add-on (common for CSVs) or to enforce policies (common for SIs and enterprise IT groups).</span></span> <span data-ttu-id="79762-307">Dans ce cas, vous pouvez utiliser une variable pour déterminer si la ressource doit être déployée.</span><span class="sxs-lookup"><span data-stu-id="79762-307">In these cases, you can use a variable to identify whether the resource should be deployed.</span></span>

### <a name="known-configuration-resources-template"></a><span data-ttu-id="79762-308">Modèle de ressource de configuration connue</span><span class="sxs-lookup"><span data-stu-id="79762-308">Known configuration resources template</span></span>
<span data-ttu-id="79762-309">Dans le modèle principal, un paramètre peut être exposé pour permettre à l’utilisateur de spécifier la configuration connue souhaitée à déployer.</span><span class="sxs-lookup"><span data-stu-id="79762-309">In the main template, a parameter can be exposed to allow the template consumer to specify a desired known configuration to deploy.</span></span> <span data-ttu-id="79762-310">Souvent, cette configuration connue utilise une approche de taille standard, avec un ensemble de tailles de configuration fixes, telles que bac à sable, petite, moyenne et grande.</span><span class="sxs-lookup"><span data-stu-id="79762-310">Often, this known configuration uses a t-shirt size approach with a set of fixed configuration sizes such as sandbox, small, medium, and large.</span></span>

![Ressources de configuration connue](./media/best-practices-resource-manager-design-templates/known-config.png)

<span data-ttu-id="79762-312">**Modèle de ressource de configuration connue**</span><span class="sxs-lookup"><span data-stu-id="79762-312">**Known configuration resources template**</span></span>

<span data-ttu-id="79762-313">L’approche des tailles standard est couramment utilisée, mais les paramètres peuvent représenter n’importe quel ensemble de configurations connues.</span><span class="sxs-lookup"><span data-stu-id="79762-313">The t-shirt size approach is commonly used, but the parameters can represent any set of known configurations.</span></span> <span data-ttu-id="79762-314">Par exemple, vous pouvez spécifier un ensemble d’environnements pour une application d’entreprise comme Développement, Test et Production.</span><span class="sxs-lookup"><span data-stu-id="79762-314">For example, you can specify a set of environments for an enterprise application such as Development, Test, and Product.</span></span> <span data-ttu-id="79762-315">Vous pouvez également l’utiliser pour un service cloud afin de représenter différentes unités d’échelle, versions de produit ou configurations de produit comme Community, Developer ou Enterprise.</span><span class="sxs-lookup"><span data-stu-id="79762-315">Or you could use it for a cloud service to represent different scale units, product versions, or product configurations such as Community, Developer, or Enterprise.</span></span>

<span data-ttu-id="79762-316">Comme pour le modèle de ressource partagé, les variables sont transmises au modèle de configuration connue par :</span><span class="sxs-lookup"><span data-stu-id="79762-316">As with the shared resource template, variables are passed to the known configurations template from either:</span></span>

* <span data-ttu-id="79762-317">Un utilisateur final : autrement dit, les paramètres envoyés au modèle principal.</span><span class="sxs-lookup"><span data-stu-id="79762-317">An end user—that is, the parameters sent to the main template.</span></span>
* <span data-ttu-id="79762-318">Une entreprise : autrement dit, les variables du modèle principal qui représentent les exigences ou les stratégies internes.</span><span class="sxs-lookup"><span data-stu-id="79762-318">An organization—that is, the variables in the main template that represent internal requirements or policies.</span></span>

### <a name="member-resources-template"></a><span data-ttu-id="79762-319">Modèle de ressource de membre</span><span class="sxs-lookup"><span data-stu-id="79762-319">Member resources template</span></span>
<span data-ttu-id="79762-320">Dans une configuration connue, un ou plusieurs types de nœud de membre sont souvent inclus.</span><span class="sxs-lookup"><span data-stu-id="79762-320">Within a known configuration, one or more member node types are often included.</span></span> <span data-ttu-id="79762-321">Par exemple, avec Hadoop, vous disposez de nœuds principaux et de nœuds de données.</span><span class="sxs-lookup"><span data-stu-id="79762-321">For example, with Hadoop you have master nodes and data nodes.</span></span> <span data-ttu-id="79762-322">Si vous installez MongoDB, vous disposez de nœuds de données et d’un arbitre.</span><span class="sxs-lookup"><span data-stu-id="79762-322">If you are installing MongoDB, you have data nodes and an arbiter.</span></span> <span data-ttu-id="79762-323">Si vous déployez DataStax, vous disposez de nœuds de données et d’une machine virtuelle avec OpsCenter installé.</span><span class="sxs-lookup"><span data-stu-id="79762-323">If you are deploying DataStax, you have data nodes and a VM with OpsCenter installed.</span></span>

![Ressources de membres](./media/best-practices-resource-manager-design-templates/member-resources.png)

<span data-ttu-id="79762-325">**Modèle de ressource de membre**</span><span class="sxs-lookup"><span data-stu-id="79762-325">**Member resources template**</span></span>

<span data-ttu-id="79762-326">Chaque type de nœud peut avoir différentes tailles de machines virtuelles, différents nombres de disques attachés, des scripts pour installer et configurer les nœuds, des configurations de port pour les machines virtuelles, plusieurs instances, etc.</span><span class="sxs-lookup"><span data-stu-id="79762-326">Each type of nodes can have different sizes of VMs, numbers of attached disks, scripts to install and set up the nodes, port configurations for the VMs, number of instances, and other details.</span></span> <span data-ttu-id="79762-327">Ainsi, chaque type de nœud obtient son propre modèle de ressource de membre qui contient les détails du déploiement et de la configuration d’une infrastructure, ainsi que les détails relatifs à l’exécution de scripts pour déployer et configurer des logiciels sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="79762-327">So each node type gets its own member resource template, which contains the details for deploying and configuring an infrastructure as well as executing scripts to deploy and configure software within the VM.</span></span>

<span data-ttu-id="79762-328">En général, pour les machines virtuelles, deux types de script sont utilisés : les scripts réutilisables à grande échelle et les scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="79762-328">For VMs, typically two types of scripts are used, widely reusable and custom scripts.</span></span>

### <a name="widely-reusable-scripts"></a><span data-ttu-id="79762-329">Scripts réutilisables à grande échelle</span><span class="sxs-lookup"><span data-stu-id="79762-329">Widely reusable scripts</span></span>
<span data-ttu-id="79762-330">Les scripts réutilisables à grande échelle peuvent être utilisés dans plusieurs types de modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-330">Widely reusable scripts can be used across multiple types of templates.</span></span> <span data-ttu-id="79762-331">L’un des meilleurs exemples de ces scripts réutilisables à grande échelle configure RAID sur Linux afin de regrouper les disques pour augmenter le nombre d’E/S par seconde.</span><span class="sxs-lookup"><span data-stu-id="79762-331">One of the better examples of these widely reusable scripts sets up RAID on Linux to pool disks and gain a greater number of IOPS.</span></span> <span data-ttu-id="79762-332">Quels que soient les logiciels installés sur la machine virtuelle, ce script permet de réutiliser les pratiques éprouvées pour les scénarios courants.</span><span class="sxs-lookup"><span data-stu-id="79762-332">Regardless of the software being installed in the VM, this script provides reuse of proven practices for common scenarios.</span></span>

![Scripts réutilisables](./media/best-practices-resource-manager-design-templates/reusable-scripts.png)

<span data-ttu-id="79762-334">**Les modèles de ressource de membre peuvent appeler des scripts réutilisables à grande échelle**</span><span class="sxs-lookup"><span data-stu-id="79762-334">**Member resources templates can call widely reusable scripts**</span></span>

### <a name="custom-scripts"></a><span data-ttu-id="79762-335">Scripts personnalisés</span><span class="sxs-lookup"><span data-stu-id="79762-335">Custom scripts</span></span>
<span data-ttu-id="79762-336">Les modèles appellent généralement un ou plusieurs scripts qui installent et configurent des logiciels sur les machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="79762-336">Templates commonly call one or more scripts that install and configure software within VMs.</span></span> <span data-ttu-id="79762-337">Cette approche est couramment rencontrée dans les topologies de grande taille dans lesquelles plusieurs instances d’un ou plusieurs types de membre sont déployées.</span><span class="sxs-lookup"><span data-stu-id="79762-337">A common pattern is seen with large topologies where multiple instances of one or more member types are deployed.</span></span> <span data-ttu-id="79762-338">Un script d’installation pouvant être exécuté en parallèle est lancé pour chaque machine virtuelle, suivi d’un script de configuration qui est appelé à l’issue du déploiement de toutes les machines virtuelles (ou de toutes les machines virtuelles d’un type de membre donné).</span><span class="sxs-lookup"><span data-stu-id="79762-338">An installation script is initiated for every VM that can be run in parallel, followed by a setup script that is called after all VMs (or all VMs of a given member type) are deployed.</span></span>

![Scripts personnalisés](./media/best-practices-resource-manager-design-templates/custom-scripts.png)

<span data-ttu-id="79762-340">**Les modèles de ressource de membre peuvent appeler des scripts pour un objectif spécifique, par exemple la configuration d’une machine virtuelle**</span><span class="sxs-lookup"><span data-stu-id="79762-340">**Member resources templates can call scripts for a specific purpose such as VM configuration**</span></span>

## <a name="capability-scoped-solution-template-example---redis"></a><span data-ttu-id="79762-341">Exemple de modèle de solution avec étendue de capacité : Redis</span><span class="sxs-lookup"><span data-stu-id="79762-341">Capability-scoped solution template example - Redis</span></span>
<span data-ttu-id="79762-342">Pour illustrer le fonctionnement d’une implémentation, examinons un exemple pratique de création d’un modèle qui facilite le déploiement et la configuration de Redis dans des tailles standard.</span><span class="sxs-lookup"><span data-stu-id="79762-342">To show how an implementation might work, let's look at a practical example of building a template that facilitates the deployment and configuration of Redis in standard t-shirt sizes.</span></span>  

<span data-ttu-id="79762-343">Pour le déploiement, il existe un ensemble de ressources partagées (réseau virtuel, compte de stockage, groupes à haute disponibilité) et une ressource facultative (jumpbox).</span><span class="sxs-lookup"><span data-stu-id="79762-343">For the deployment, there are a set of shared resources (virtual network, storage account, availability sets) and an optional resource (jumpbox).</span></span> <span data-ttu-id="79762-344">Il existe plusieurs configurations connues représentées par des tailles standard (petite, moyenne, grande), mais chacune dispose d’un type de nœud unique.</span><span class="sxs-lookup"><span data-stu-id="79762-344">There are multiple known configurations represented as t-shirt sizes (small, medium, large) but each with a single node type.</span></span> <span data-ttu-id="79762-345">Il existe également deux scripts propres aux besoins (installation et configuration).</span><span class="sxs-lookup"><span data-stu-id="79762-345">There are also two purpose-specific scripts (installation, configuration).</span></span>

### <a name="creating-the-template-files"></a><span data-ttu-id="79762-346">Création de fichiers de modèle</span><span class="sxs-lookup"><span data-stu-id="79762-346">Creating the template files</span></span>
<span data-ttu-id="79762-347">Vous allez créer un modèle principal nommé azuredeploy.json.</span><span class="sxs-lookup"><span data-stu-id="79762-347">You would create a Main Template named azuredeploy.json.</span></span>

<span data-ttu-id="79762-348">Vous allez créer un modèle de ressource partagé, nommé shared-resources.json.</span><span class="sxs-lookup"><span data-stu-id="79762-348">You create Shared Resources Template named shared-resources.json</span></span>

<span data-ttu-id="79762-349">Vous allez créer un modèle de ressource facultatif pour permettre le déploiement d’une jumpbox, nommée jumpbox_enabled.json.</span><span class="sxs-lookup"><span data-stu-id="79762-349">You create an Optional Resource Template to enable the deployment of a jumpbox, named jumpbox_enabled.json</span></span>

<span data-ttu-id="79762-350">Comme Redis utilise simplement un type de nœud unique, vous allez créer un modèle de ressource de membre unique, nommé node-resources.json.</span><span class="sxs-lookup"><span data-stu-id="79762-350">Redis uses just a single node type, so you create a single Member Resource Template named node-resources.json.</span></span>

<span data-ttu-id="79762-351">Avec Redis, vous allez installer chaque nœud, puis configurer le cluster.</span><span class="sxs-lookup"><span data-stu-id="79762-351">With Redis, you want to install each individual node, and then set up the cluster.</span></span>  <span data-ttu-id="79762-352">Vous disposez de scripts répondant aux besoins de l’installation et de la configuration : redis-cluster-install.sh et redis-cluster-setup.sh.</span><span class="sxs-lookup"><span data-stu-id="79762-352">You have scripts to accommodate the installation and set up, redis-cluster-install.sh and redis-cluster-setup.sh.</span></span>

### <a name="linking-the-templates"></a><span data-ttu-id="79762-353">Liaison des modèles</span><span class="sxs-lookup"><span data-stu-id="79762-353">Linking the templates</span></span>
<span data-ttu-id="79762-354">À l’aide d’une liaison de modèles, le modèle principal est lié au modèle de ressource partagé, qui établit le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="79762-354">Using template linking, the main template links out to the shared resources template, which establishes the virtual network.</span></span>

<span data-ttu-id="79762-355">Une logique est ajoutée dans le modèle principal pour permettre aux utilisateurs du modèle de spécifier si une jumpbox doit être déployée.</span><span class="sxs-lookup"><span data-stu-id="79762-355">Logic is added within the main template to enable consumers of the template to specify whether a jumpbox should be deployed.</span></span> <span data-ttu-id="79762-356">La valeur *enabled* du paramètre *EnableJumpbox* indique que le client souhaite en déployer une.</span><span class="sxs-lookup"><span data-stu-id="79762-356">An *enabled* value for the *EnableJumpbox* parameter indicates that the customer wants to deploy a jumpbox.</span></span> <span data-ttu-id="79762-357">Si cette valeur est indiquée, le modèle concatène *_enabled* comme suffixe d’un nom de modèle de base pour la fonctionnalité jumpbox.</span><span class="sxs-lookup"><span data-stu-id="79762-357">When this value is provided, the template concatenates *_enabled* as a suffix to a base template name for the jumpbox capability.</span></span>

<span data-ttu-id="79762-358">Le modèle principal applique la valeur de paramètre *large* comme suffixe d’un nom de modèle de base pour les tailles standard, puis utilise cette valeur dans un lien du modèle vers *technology_on_os_large.json*.</span><span class="sxs-lookup"><span data-stu-id="79762-358">The main template applies the *large* parameter value as a suffix to a base template name for t-shirt sizes, and then uses that value in a template link out to *technology_on_os_large.json*.</span></span>

<span data-ttu-id="79762-359">La topologie doit ressembler à cette illustration.</span><span class="sxs-lookup"><span data-stu-id="79762-359">The topology would resemble this illustration.</span></span>

![Modèle Redis](./media/best-practices-resource-manager-design-templates/redis-template.png)

<span data-ttu-id="79762-361">**Structure d’un modèle Redis**</span><span class="sxs-lookup"><span data-stu-id="79762-361">**Template structure for a Redis template**</span></span>

### <a name="configuring-state"></a><span data-ttu-id="79762-362">Configuration d’un état</span><span class="sxs-lookup"><span data-stu-id="79762-362">Configuring state</span></span>
<span data-ttu-id="79762-363">Pour les nœuds du cluster, il existe deux étapes de configuration de l’état, représentées par des scripts propres aux besoins.</span><span class="sxs-lookup"><span data-stu-id="79762-363">For the nodes in the cluster, there are two steps to configuring the state, both represented by Purpose Specific Scripts.</span></span>  <span data-ttu-id="79762-364">« redis-cluster-install.sh » installe Redis et « redis-cluster-setup.sh » configure le cluster.</span><span class="sxs-lookup"><span data-stu-id="79762-364">"redis-cluster-install.sh" installs Redis and "redis-cluster-setup.sh" sets up the cluster.</span></span>

### <a name="supporting-different-size-deployments"></a><span data-ttu-id="79762-365">Prise en charge des déploiements de taille différente</span><span class="sxs-lookup"><span data-stu-id="79762-365">Supporting Different Size Deployments</span></span>
<span data-ttu-id="79762-366">Au sein des variables, le modèle de taille standard spécifie le nombre de nœuds de chaque type à déployer pour la taille spécifiée (*large*).</span><span class="sxs-lookup"><span data-stu-id="79762-366">Inside variables, the t-shirt size template specifies the number of nodes of each type to deploy for the specified size (*large*).</span></span> <span data-ttu-id="79762-367">Il déploie ensuite ce nombre d’instances de machine virtuelle à l’aide de boucles de ressources, en fournissant des noms uniques aux ressources en ajoutant un nom de nœud avec un numéro de séquence numérique à partir de *copyIndex()*.</span><span class="sxs-lookup"><span data-stu-id="79762-367">It then deploys that number of VM instances using resource loops, providing unique names to resources by appending a node name with a numeric sequence number from *copyIndex()*.</span></span> <span data-ttu-id="79762-368">Il applique ces étapes pour les deux machines virtuelles de la zone sensible, comme défini dans le modèle de nom standard.</span><span class="sxs-lookup"><span data-stu-id="79762-368">It does these steps for both hot and warm zone VMs, as defined in the t-shirt name template</span></span>

## <a name="decomposition-and-end-to-end-solution-scoped-templates"></a><span data-ttu-id="79762-369">Modèles de décomposition et avec étendue de solution de bout en bout</span><span class="sxs-lookup"><span data-stu-id="79762-369">Decomposition and end-to-end solution scoped templates</span></span>
<span data-ttu-id="79762-370">Un modèle de solution avec étendue de solution de bout en bout est destiné à fournir une solution de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="79762-370">A solution template with an end-to-end solution scope is focused on delivering an end-to-end solution.</span></span>  <span data-ttu-id="79762-371">Cette approche repose généralement sur la composition de plusieurs modèles avec étendue de fonctionnalité avec des ressources supplémentaires, une logique et un état.</span><span class="sxs-lookup"><span data-stu-id="79762-371">This approach is typically a composition of multiple capability-scoped templates with additional resources, logic, and state.</span></span>

<span data-ttu-id="79762-372">Comme illustré dans l’image ci-dessous, un même modèle utilisé pour les modèles avec étendue de fonctionnalité est étendu pour les modèles avec étendue de solution de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="79762-372">As highlighted in the image below, the same model used for capability scoped templates is extended for templates with an End-to-End Solution Scope.</span></span>

<span data-ttu-id="79762-373">Un modèle de ressource partagé et des modèles de ressource facultatifs remplissent la même fonction que dans les approches de modèle avec étendue de capacité et de fonctionnalité, mais ils sont destinés à la solution de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="79762-373">A Shared Resources Template and Optional Resources Templates serve the same function as in the capacity and capability scoped template approaches, but are scoped for the end to end solution.</span></span>

<span data-ttu-id="79762-374">Comme les modèles avec étendue de solution de bout en bout peuvent avoir également des tailles standard, le modèle de ressource de configuration connue reflète ce qui est requis pour une configuration connue donnée de la solution.</span><span class="sxs-lookup"><span data-stu-id="79762-374">As end to end solution scoped templates also can typically have t-shirt sizes, the Known Configuration Resources template reflects what is required for a given known configuration of the solution.</span></span>

<span data-ttu-id="79762-375">Le modèle de ressource de configuration connue établit un lien vers un ou plusieurs modèles de solution avec étendue de fonctionnalité, qui sont pertinents pour la solution de bout en bout, ainsi que vers les modèles de ressource de membre qui sont requis pour la solution de bout en bout.</span><span class="sxs-lookup"><span data-stu-id="79762-375">The Known Configuration Resources Template links to one or more capability scoped solution templates that are relevant to the end to end solution as well as the Member Resource Templates that are required for the end to end solution.</span></span>

<span data-ttu-id="79762-376">Comme la taille standard de la solution peut être différente de celle du modèle individuel avec étendue de fonctionnalité, les variables au sein du modèle de ressource de configuration connu permettent de fournir les valeurs appropriées des modèles de solution avec étendue de fonctionnalité en aval pour déployer la taille standard appropriée.</span><span class="sxs-lookup"><span data-stu-id="79762-376">As the t-shirt size of the solution may be different than the individual capability-scoped template, variables within the Known Configuration Resources Template are used to provide the appropriate values for downstream capability scoped solution templates to deploy the appropriate t-shirt size.</span></span>

![Bout en bout](./media/best-practices-resource-manager-design-templates/end-to-end.png)

<span data-ttu-id="79762-378">**Le modèle utilisé pour les modèles de solution avec étendue de capacité ou de fonctionnalité peut être facilement étendu en modèle avec étendue de solution de bout en bout**</span><span class="sxs-lookup"><span data-stu-id="79762-378">**The model used for capacity or capability scoped solution templates can be readily extended for end to end solution template scopes**</span></span>

## <a name="preparing-templates-for-the-marketplace"></a><span data-ttu-id="79762-379">Préparation des modèles pour le Marketplace</span><span class="sxs-lookup"><span data-stu-id="79762-379">Preparing templates for the Marketplace</span></span>
<span data-ttu-id="79762-380">L’approche décrite plus haut répond facilement aux scénarios dans lesquels les entreprises, les intégrateurs de systèmes et les fournisseurs de services cloud souhaitent déployer eux-mêmes les modèles ou permettre à leurs clients de le faire.</span><span class="sxs-lookup"><span data-stu-id="79762-380">The preceding approach readily accommodates scenarios where Enterprises, SIs, and CSVs want to either deploy the templates themselves or enable their customers to deploy on their own.</span></span>

<span data-ttu-id="79762-381">Un autre scénario souhaité consiste à déployer un modèle via le Marketplace.</span><span class="sxs-lookup"><span data-stu-id="79762-381">Another desired scenario is deploying a template via the marketplace.</span></span>  <span data-ttu-id="79762-382">Cette approche de décomposition fonctionne également pour le Marketplace, avec quelques changements mineurs.</span><span class="sxs-lookup"><span data-stu-id="79762-382">This decomposition approach works for the marketplace as well, with some minor changes.</span></span>

<span data-ttu-id="79762-383">Comme indiqué plus haut, les modèles permettent d’offrir des types de déploiement distinct pour la vente dans le Marketplace.</span><span class="sxs-lookup"><span data-stu-id="79762-383">As mentioned previously, templates can be used to offer distinct deployment types for sale in the marketplace.</span></span> <span data-ttu-id="79762-384">Les types de déploiement distinct peuvent être des tailles standard (petite, moyenne, grande), le type de produit/public (communauté, développeur, entreprise) ou le type de fonctionnalité (de base, haute disponibilité).</span><span class="sxs-lookup"><span data-stu-id="79762-384">Distinct deployment types may be t-shirt sizes (small, medium, large), product/audience type (community, developer, enterprise), or feature type (basic, high availability).</span></span>

<span data-ttu-id="79762-385">Comme illustré ci-dessous, la solution de bout en bout existante ou les modèles avec étendue de fonctionnalité peuvent être facilement utilisés pour répertorier les différentes configurations connues dans le Marketplace.</span><span class="sxs-lookup"><span data-stu-id="79762-385">As shown below, the existing end to end solution or capability scoped templates can be readily utilized to list the different known configurations in the marketplace.</span></span>

<span data-ttu-id="79762-386">Les paramètres du modèle principal sont tout d’abord modifiés afin de supprimer le paramètre entrant nommé tshirtSize.</span><span class="sxs-lookup"><span data-stu-id="79762-386">The parameters to the main template are first modified to remove the inbound parameter named tshirtSize.</span></span>

<span data-ttu-id="79762-387">Bien que les types de déploiement distinct soient mappés au modèle de ressource de configuration connue, ils ont également besoin des ressources communes et de la configuration du modèle de ressource partagé et, potentiellement, de celles du modèle de ressource facultatif.</span><span class="sxs-lookup"><span data-stu-id="79762-387">While the distinct deployment types map to the Known Configuration Resources Template, they also need the common resources and configuration found in the Shared Resources Template and potentially those in Optional Resource Templates.</span></span>

<span data-ttu-id="79762-388">Pour publier votre modèle dans le Marketplace, vous devez établir des copies distinctes de votre modèle principal, qui remplace le paramètre entrant tshirtSize auparavant disponible par une variable intégrée au modèle.</span><span class="sxs-lookup"><span data-stu-id="79762-388">If you want to publish your template to the marketplace, you establish distinct copies of your Main template that replaces the previously available inbound parameter of tshirtSize to a variable embedded within the template.</span></span>

![Marketplace](./media/best-practices-resource-manager-design-templates/marketplace.png)

<span data-ttu-id="79762-390">**Adaptation d’un modèle avec étendue de solution pour le Marketplace**</span><span class="sxs-lookup"><span data-stu-id="79762-390">**Adapting a solution scoped template for the marketplace**</span></span>

## <a name="next-steps"></a><span data-ttu-id="79762-391">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="79762-391">Next steps</span></span>
* <span data-ttu-id="79762-392">Pour en savoir plus sur le partage d’état dans les modèles, consultez [Partage d’état dans les modèles Azure Resource Manager](best-practices-resource-manager-state.md).</span><span class="sxs-lookup"><span data-stu-id="79762-392">To learn about sharing state into and out of templates, see [Sharing state in Azure Resource Manager templates](best-practices-resource-manager-state.md).</span></span>
* <span data-ttu-id="79762-393">Pour obtenir des conseils sur l’utilisation de Resource Manager par les entreprises pour gérer efficacement les abonnements, voir [Structure d’Azure Enterprise - Gouvernance normative de l’abonnement](resource-manager-subscription-governance.md).</span><span class="sxs-lookup"><span data-stu-id="79762-393">For guidance on how enterprises can use Resource Manager to effectively manage subscriptions, see [Azure enterprise scaffold - prescriptive subscription governance](resource-manager-subscription-governance.md).</span></span>

