---
title: "aaaAzure Active l’authentification et le Gestionnaire de ressources | Documents Microsoft"
description: "Tooauthentication de guide du développeur avec hello API Azure Resource Manager et Azure Active Directory pour l’intégration d’une application avec d’autres abonnements Azure."
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="b11e6-103">Utiliser le Gestionnaire de ressources des API d’authentification abonnements tooaccess</span><span class="sxs-lookup"><span data-stu-id="b11e6-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="b11e6-104">Introduction</span><span class="sxs-lookup"><span data-stu-id="b11e6-104">Introduction</span></span>
<span data-ttu-id="b11e6-105">Si vous êtes un développeur de logiciels ayant besoin de toocreate une application qui gère les ressources Azure du client, cette rubrique vous montre comment tooauthenticate avec hello API du Gestionnaire de ressources Azure et obtenir tooresources d’accès dans les autres abonnements.</span><span class="sxs-lookup"><span data-stu-id="b11e6-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="b11e6-106">Votre application peut accéder aux hello API du Gestionnaire de ressources de deux manières :</span><span class="sxs-lookup"><span data-stu-id="b11e6-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="b11e6-107">**Accès de l’utilisateur et de l’application**: pour les applications qui accèdent aux ressources pour le compte d’un utilisateur connecté.</span><span class="sxs-lookup"><span data-stu-id="b11e6-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="b11e6-108">Cette approche fonctionne pour les applications, telles que les applications web et les outils en ligne de commande, qui n’assurent que la « gestion interactive » des ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="b11e6-109">**Accès de l’application uniquement**: pour les applications qui exécutent des services démons et des tâches planifiées.</span><span class="sxs-lookup"><span data-stu-id="b11e6-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="b11e6-110">identité de l’application Hello bénéficie des ressources de toohello un accès direct.</span><span class="sxs-lookup"><span data-stu-id="b11e6-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="b11e6-111">Cette approche fonctionne pour les applications nécessitant des tooAzure l’accès contrôlé à distance (sans assistance) à long terme.</span><span class="sxs-lookup"><span data-stu-id="b11e6-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="b11e6-112">Cette rubrique fournit des instructions détaillées toocreate une application qui utilise ces deux méthodes d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="b11e6-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="b11e6-113">Il montre comment tooperform chaque étape avec les API REST ou c#.</span><span class="sxs-lookup"><span data-stu-id="b11e6-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="b11e6-114">les applications ASP.NET MVC complete Hello est disponible à l’adresse [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="b11e6-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="b11e6-115">Quelle application web de hello est</span><span class="sxs-lookup"><span data-stu-id="b11e6-115">What hello web app does</span></span>
<span data-ttu-id="b11e6-116">application Hello web :</span><span class="sxs-lookup"><span data-stu-id="b11e6-116">hello web app:</span></span>

1. <span data-ttu-id="b11e6-117">Connecte un utilisateur Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="b11e6-118">Demande utilisateur toogrant hello web application accès tooResource Manager.</span><span class="sxs-lookup"><span data-stu-id="b11e6-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="b11e6-119">Se procure le jeton d’accès de l’utilisateur et de l’application pour accéder à Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="b11e6-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="b11e6-120">Utilise toocall jeton (à l’étape 3) le Gestionnaire de ressources et le rôle de tooa principal du service de l’application assign hello abonnement hello, ce qui donne l’abonnement de la toohello hello application de l’accès à long terme.</span><span class="sxs-lookup"><span data-stu-id="b11e6-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="b11e6-121">Obtient le jeton d’accès de l’application uniquement.</span><span class="sxs-lookup"><span data-stu-id="b11e6-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="b11e6-122">Utilise les ressources de jeton (à l’étape 5) toomanage dans l’abonnement hello via le Gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="b11e6-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="b11e6-123">Voici le flux de bout en bout hello d’application web de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-123">Here's hello end-to-end flow of hello web application.</span></span>

![Flux d’authentification de Resource Manager](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="b11e6-125">En tant qu’utilisateur, vous fournissez l’id d’abonnement hello pour l’abonnement de hello souhaité toouse :</span><span class="sxs-lookup"><span data-stu-id="b11e6-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![indiquer l’identifiant de l’abonnement](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="b11e6-127">Sélectionnez toouse de compte hello pour la connexion.</span><span class="sxs-lookup"><span data-stu-id="b11e6-127">Select hello account toouse for logging in.</span></span>

![sélectionner le compte](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="b11e6-129">Indiquez vos informations d’identification.</span><span class="sxs-lookup"><span data-stu-id="b11e6-129">Provide your credentials.</span></span>

![Fournir des informations d’identification](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="b11e6-131">Accorder des abonnements Azure hello application accès tooyour :</span><span class="sxs-lookup"><span data-stu-id="b11e6-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Accorder l'accès](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="b11e6-133">Gérez vos abonnements connectés :</span><span class="sxs-lookup"><span data-stu-id="b11e6-133">Manage your connected subscriptions:</span></span>

![Connecter un abonnement](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="b11e6-135">Inscription de l’application</span><span class="sxs-lookup"><span data-stu-id="b11e6-135">Register application</span></span>
<span data-ttu-id="b11e6-136">Avant de commencer l’écriture du code, inscrivez votre application web à Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="b11e6-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="b11e6-137">inscription d’une application Hello crée une identité centrale pour votre application dans Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b11e6-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="b11e6-138">Elle contient des informations de base relatives à votre application comme ID de Client OAuth, URL de réponse et les informations d’identification que votre application utilise tooauthenticate et l’accès aux API du Gestionnaire de ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="b11e6-139">inscription d’une application Hello enregistre également hello différents délégué des autorisations dont votre application a besoin lors de l’accès APIs Microsoft pour le compte d’utilisateur de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="b11e6-140">Votre application ayant accès à plusieurs abonnements, vous devez la configurer comme une application mutualisée.</span><span class="sxs-lookup"><span data-stu-id="b11e6-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="b11e6-141">validation de toopass, fournir un domaine associé à votre Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b11e6-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="b11e6-142">les domaines de hello toosee associés à votre Azure Active Directory, ouvrez une session toohello [portail classic](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="b11e6-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="b11e6-143">Sélectionnez votre annuaire Azure Active Directory, puis **Domaines**.</span><span class="sxs-lookup"><span data-stu-id="b11e6-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="b11e6-144">Bonjour à l’exemple suivant montre comment tooregister hello application à l’aide d’Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="b11e6-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="b11e6-145">Vous devez disposer de hello version la plus récente (août 2016) d’Azure PowerShell pour toowork de cette commande.</span><span class="sxs-lookup"><span data-stu-id="b11e6-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="b11e6-146">toolog dans en tant que hello application AD, vous devez mot de passe et l’id de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="b11e6-147">toosee hello id de l’application qui est retourné à partir de la commande précédente hello, utilisez :</span><span class="sxs-lookup"><span data-stu-id="b11e6-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="b11e6-148">Bonjour à l’exemple suivant montre comment tooregister hello application à l’aide de CLI d’Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="b11e6-149">les résultats de Hello incluent hello AppId, dont vous aurez besoin lors de l’authentification en tant qu’application hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="b11e6-150">Configuration facultative : informations d’identification des certificats</span><span class="sxs-lookup"><span data-stu-id="b11e6-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="b11e6-151">Azure AD prend également en charge les informations d’identification de certificat pour les applications : vous créez un certificat auto-signé, conserver la clé privée de hello et ajouter l’inscription d’application hello tooyour clé publique Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b11e6-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="b11e6-152">Pour l’authentification, votre application envoie un tooAzure de charge utile de petits AD signé à l’aide de votre clé privée et Azure AD valide la signature hello à l’aide de la clé publique hello que vous avez enregistré.</span><span class="sxs-lookup"><span data-stu-id="b11e6-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="b11e6-153">Pour plus d’informations sur la création d’une application AD avec un certificat, consultez [utiliser Azure PowerShell toocreate un principal de service des ressources de tooaccess](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) ou [CLI d’Azure utilisation toocreate un principal de service tooaccess ressources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="b11e6-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="b11e6-154">Obtention de l’ID du client à partir de l’ID d’abonnement</span><span class="sxs-lookup"><span data-stu-id="b11e6-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="b11e6-155">toorequest un jeton qui peut être utilisé toocall Gestionnaire de ressources, votre application doit ID tooknow hello du hello Azure AD qui héberge hello abonnement Azure client.</span><span class="sxs-lookup"><span data-stu-id="b11e6-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="b11e6-156">Vos utilisateurs connaissent sûrement leurs ID d’abonnement, mais pas nécessairement leurs ID de client Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="b11e6-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="b11e6-157">tooget hello id de l’utilisateur client, demandez à utilisateur de hello hello id d’abonnement. Fournir cet id d’abonnement lors de l’envoi d’une demande sur l’abonnement de hello :</span><span class="sxs-lookup"><span data-stu-id="b11e6-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="b11e6-158">demande de Hello échoue, car l’utilisateur de hello n’a pas encore connecté, mais vous pouvez récupérer l’id de client hello de réponse de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="b11e6-159">Dans cette exception, extraire l’id de client hello à partir de la valeur d’en-tête de réponse hello pour **WWW-Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="b11e6-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="b11e6-160">Vous voyez cette implémentation Bonjour [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) (méthode).</span><span class="sxs-lookup"><span data-stu-id="b11e6-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="b11e6-161">Obtention du jeton de l’utilisateur et de l’application</span><span class="sxs-lookup"><span data-stu-id="b11e6-161">Get user + app access token</span></span>
<span data-ttu-id="b11e6-162">Votre application redirige l’utilisateur de hello tooAzure AD avec un OAuth 2.0 autoriser demande - informations d’identification de l’utilisateur tooauthenticate hello et obtenir un code d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="b11e6-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="b11e6-163">Votre application utilise tooget de code d’autorisation hello un jeton d’accès pour le Gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="b11e6-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="b11e6-164">Hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) méthode crée la demande d’autorisation de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="b11e6-165">Cette rubrique montre à hello API REST demandes tooauthenticate hello utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b11e6-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="b11e6-166">Vous pouvez également utiliser l’authentification tooperform de bibliothèques d’assistance dans votre code.</span><span class="sxs-lookup"><span data-stu-id="b11e6-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="b11e6-167">Pour plus d’informations sur ces bibliothèques, consultez [Bibliothèques d’authentification d’Azure Active Directory](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="b11e6-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="b11e6-168">Pour des conseils sur l’intégration de la gestion de l’identité dans une application, consultez le [Guide du développeur Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="b11e6-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="b11e6-169">Demande d’autorisation (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="b11e6-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="b11e6-170">Émettre un point de terminaison de Authorize d’ouvrir Connect/OAuth2.0 autoriser les demandes d’ID de toohello Azure AD :</span><span class="sxs-lookup"><span data-stu-id="b11e6-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="b11e6-171">les paramètres de chaîne de requête de Hello qui sont disponibles pour cette demande sont décrits dans hello [demander un code d’autorisation](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) rubrique.</span><span class="sxs-lookup"><span data-stu-id="b11e6-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="b11e6-172">Hello suivant montre l’exemple de comment toorequest OAuth2.0 autorisation :</span><span class="sxs-lookup"><span data-stu-id="b11e6-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="b11e6-173">Azure AD authentifie l’utilisateur de hello et, si nécessaire, demande hello utilisateur toogrant autorisation toohello application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="b11e6-174">Il retourne toohello de code d’autorisation hello URL de réponse de votre application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="b11e6-175">En fonction de hello demandé response_mode, Azure AD soit renvoie un hello des données dans la chaîne de requête ou en tant que données de publication.</span><span class="sxs-lookup"><span data-stu-id="b11e6-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="b11e6-176">Demande d’autorisation (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="b11e6-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="b11e6-177">Si vous seulement souhaitez tooaccess Azure Resource Manager pour le compte d’utilisateur de hello, mais également autoriser hello utilisateur toosign dans l’application de tooyour à l’aide de leur compte Azure AD, émettre une Open ID autoriser demande de connexion.</span><span class="sxs-lookup"><span data-stu-id="b11e6-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="b11e6-178">Avec Open ID de connexion, votre application reçoit également une id_token d’Azure AD que votre application peut utiliser toosign utilisateur de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="b11e6-179">les paramètres de chaîne de requête de Hello qui sont disponibles pour cette demande sont décrits dans hello [envoi hello connectez-vous demande](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) rubrique.</span><span class="sxs-lookup"><span data-stu-id="b11e6-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="b11e6-180">Exemple de demande Open ID Connect :</span><span class="sxs-lookup"><span data-stu-id="b11e6-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="b11e6-181">Azure AD authentifie l’utilisateur de hello et, si nécessaire, demande hello utilisateur toogrant autorisation toohello application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="b11e6-182">Il retourne toohello de code d’autorisation hello URL de réponse de votre application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="b11e6-183">En fonction de hello demandé response_mode, Azure AD soit renvoie un hello des données dans la chaîne de requête ou en tant que données de publication.</span><span class="sxs-lookup"><span data-stu-id="b11e6-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="b11e6-184">Exemple de réponse Open ID Connect :</span><span class="sxs-lookup"><span data-stu-id="b11e6-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="b11e6-185">Demande de jeton (flux d’octroi d’un code d’autorisation OAuth2.0)</span><span class="sxs-lookup"><span data-stu-id="b11e6-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="b11e6-186">Maintenant que votre application a reçu le code d’autorisation de hello d’Azure AD, il est le jeton d’accès de temps tooget hello pour le Gestionnaire de ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="b11e6-187">Valider une demande jeton d’OAuth2.0 Code Grant toohello Azure AD point de terminaison Token :</span><span class="sxs-lookup"><span data-stu-id="b11e6-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="b11e6-188">les paramètres de chaîne de requête de Hello qui sont disponibles pour cette demande sont décrits dans hello [utiliser du code d’autorisation hello](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) rubrique.</span><span class="sxs-lookup"><span data-stu-id="b11e6-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="b11e6-189">Bonjour à l’exemple suivant illustre une demande de jeton d’octroi de code avec les informations d’identification de mot de passe :</span><span class="sxs-lookup"><span data-stu-id="b11e6-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="b11e6-190">Lorsque vous travaillez avec les informations d’identification de certificat, créez un JSON Web Token (JWT) et le signe (RSA SHA256) à l’aide de la clé privée de hello des informations d’identification du certificat de votre application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="b11e6-191">types de revendications de jeton de hello Hello sont affichés dans [les revendications de jeton JWT](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="b11e6-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="b11e6-192">Pour référence, consultez hello [code de bibliothèque d’Active Directory d’authentification (.NET)](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign des jetons JWT d’Assertion de Client.</span><span class="sxs-lookup"><span data-stu-id="b11e6-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="b11e6-193">Consultez hello [spécification de connexion d’ID ouvrir](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) pour plus d’informations sur l’authentification du client.</span><span class="sxs-lookup"><span data-stu-id="b11e6-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="b11e6-194">Hello, l’exemple suivant illustre une demande de jeton d’octroi de code avec les informations d’identification de certificat :</span><span class="sxs-lookup"><span data-stu-id="b11e6-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="b11e6-195">Exemple de réponse de jeton d’octroi de code :</span><span class="sxs-lookup"><span data-stu-id="b11e6-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="b11e6-196">Gérer la réponse de jeton d’octroi de code</span><span class="sxs-lookup"><span data-stu-id="b11e6-196">Handle code grant token response</span></span>
<span data-ttu-id="b11e6-197">Une réponse correcte de jeton contient de jeton d’accès hello (utilisateur + app) pour le Gestionnaire de ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="b11e6-198">Votre application utilise cette tooaccess de jeton d’accès Gestionnaire de ressources pour le compte d’utilisateur de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="b11e6-199">durée de vie Hello des jetons d’accès émis par Azure AD est d’une heure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="b11e6-200">Il est peu probable que votre application web a besoin de jeton d’accès toorenew hello (utilisateur + application).</span><span class="sxs-lookup"><span data-stu-id="b11e6-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="b11e6-201">Si elle a besoin de jeton d’accès toorenew hello, utilisez le jeton d’actualisation hello que votre application reçoit dans la réponse du jeton hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="b11e6-202">Valider une demande de jeton OAuth2.0 toohello Azure AD point de terminaison Token :</span><span class="sxs-lookup"><span data-stu-id="b11e6-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="b11e6-203">Hello toouse de paramètres avec la demande d’actualisation hello sont décrites dans [jeton d’accès de l’actualisation hello](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="b11e6-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="b11e6-204">Hello suivant montre comment actualiser le jeton toouse hello :</span><span class="sxs-lookup"><span data-stu-id="b11e6-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="b11e6-205">Bien que les jetons d’actualisation peuvent être utilisé tooget nouveaux jetons d’accès pour le Gestionnaire de ressources Azure, ils ne conviennent pas pour l’accès hors connexion par votre application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="b11e6-206">durée de vie des jetons actualisation Hello est limitée, et des jetons d’actualisation sont liées toohello utilisateur.</span><span class="sxs-lookup"><span data-stu-id="b11e6-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="b11e6-207">Si l’utilisateur de hello quitte l’organisation de hello, application hello à l’aide du jeton d’actualisation hello perd l’accès.</span><span class="sxs-lookup"><span data-stu-id="b11e6-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="b11e6-208">Cette approche n’est pas appropriée pour les applications qui sont utilisés par les équipes toomanage leurs ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="b11e6-209">Vérifiez si utilisateur peut assigner toosubscription d’accès</span><span class="sxs-lookup"><span data-stu-id="b11e6-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="b11e6-210">Votre application dispose maintenant d’un jeton tooaccess Azure Resource Manager pour le compte d’utilisateur de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="b11e6-211">étape suivante de Hello est tooconnect votre abonnement de toohello d’application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="b11e6-212">Une fois connecté, votre application peut gérer les abonnements, même lorsque l’utilisateur de hello n’est pas présent (accès hors connexion à long terme).</span><span class="sxs-lookup"><span data-stu-id="b11e6-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="b11e6-213">Pour chaque abonnement tooconnect, appelez hello [les autorisations de liste de gestionnaire de ressources](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine si utilisateur de hello possède les droits de gestion d’accès pour l’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="b11e6-214">Hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) méthode Hello, exemple d’application ASP.NET MVC implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="b11e6-215">Hello suivant montre l’exemple de comment toorequest les autorisations d’un utilisateur sur un abonnement.</span><span class="sxs-lookup"><span data-stu-id="b11e6-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="b11e6-216">83cfe939-2402-4581-b761-4f59b0a041e4 est l’id hello d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="b11e6-217">Un exemple d’autorisations de l’utilisateur tooget hello réponse lors de l’abonnement est :</span><span class="sxs-lookup"><span data-stu-id="b11e6-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="b11e6-218">autorisations de Hello API retourne plusieurs autorisations.</span><span class="sxs-lookup"><span data-stu-id="b11e6-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="b11e6-219">Chaque autorisation est constituée d’actions autorisées (paramètre Actions) et interdites (paramètre NotActions).</span><span class="sxs-lookup"><span data-stu-id="b11e6-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="b11e6-220">Si une action est présente dans hello liste d’actions de n’importe quelle autorisation autorisée et non présent dans la liste de notactions hello de cette autorisation, l’utilisateur hello est autorisée tooperform cette action.</span><span class="sxs-lookup"><span data-stu-id="b11e6-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="b11e6-221">**Microsoft.Authorization/RoleAssignments/Write** est action hello que qui accorde l’accès de gestion.</span><span class="sxs-lookup"><span data-stu-id="b11e6-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="b11e6-222">Votre application doit analyser hello autorisations résultat toolook pour une correspondance d’expression régulière sur cette chaîne d’action dans les actions hello et notactions de chaque autorisation.</span><span class="sxs-lookup"><span data-stu-id="b11e6-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="b11e6-223">Obtention du jeton d’accès de l’application uniquement</span><span class="sxs-lookup"><span data-stu-id="b11e6-223">Get app-only access token</span></span>
<span data-ttu-id="b11e6-224">Vous savez maintenant, si l’utilisateur hello peut attribuer des accès toohello abonnement Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="b11e6-225">les étapes suivantes Hello sont :</span><span class="sxs-lookup"><span data-stu-id="b11e6-225">hello next steps are:</span></span>

1. <span data-ttu-id="b11e6-226">Affecter hello approprié RBAC rôle tooyour identité de l’application sur l’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="b11e6-227">Valider l’assignation d’accès hello en demandant l’autorisation de l’Application hello sur les abonnement hello ou en accédant au Gestionnaire de ressources à l’aide du jeton d’application uniquement.</span><span class="sxs-lookup"><span data-stu-id="b11e6-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="b11e6-228">Connexion d’enregistrement hello dans votre structure de données d’applications « abonnements connectés » - persistance id hello d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="b11e6-229">Examinons de plus près à la première étape de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="b11e6-230">tooassign hello approprié RBAC rôle toohello identité de l’application, vous devez déterminer :</span><span class="sxs-lookup"><span data-stu-id="b11e6-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="b11e6-231">id d’objet Hello d’identité de votre application dans Azure Active Directory l’utilisateur hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="b11e6-232">Identificateur Hello du rôle RBAC hello requis par votre application sur un abonnement de hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="b11e6-233">Lorsque votre application authentifie un utilisateur à partir d’une instance d’Azure AD, elle crée un objet principal du service pour votre application dans cette instance.</span><span class="sxs-lookup"><span data-stu-id="b11e6-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="b11e6-234">Azure permet de RBAC rôles toobe affecté tooservice principaux applications de toocorresponding toogrant un accès direct sur les ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="b11e6-235">Cette action est exactement ce que nous souhaitons toodo.</span><span class="sxs-lookup"><span data-stu-id="b11e6-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="b11e6-236">Requête les identificateurs de principal du service de votre application dans l’utilisateur connecté hello hello hello de la toodetermine de l’API Graph de hello Azure Active Directory de Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b11e6-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="b11e6-237">Il vous suffit un jeton d’accès pour le Gestionnaire de ressources Azure, vous avez besoin d’un nouveau Bonjour de jeton toocall accès API Azure AD Graph.</span><span class="sxs-lookup"><span data-stu-id="b11e6-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="b11e6-238">Chaque application dans Azure AD a tooquery d’autorisation à son propre objet principal de service, par conséquent, un jeton d’accès d’application uniquement est suffisant.</span><span class="sxs-lookup"><span data-stu-id="b11e6-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="b11e6-239">Obtenir un jeton d’accès d’application uniquement pour l’API Microsoft Azure AD Graph</span><span class="sxs-lookup"><span data-stu-id="b11e6-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="b11e6-240">tooauthenticate votre application et obtenir un jeton tooAzure AD Graph API, émettre un Client d’informations d’identification Grant OAuth2.0 flux demande de jeton tooAzure AD point de terminaison token (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/jeton**).</span><span class="sxs-lookup"><span data-stu-id="b11e6-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="b11e6-241">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) méthode Hello, exemple d’application ASP.net MVC Obtient un accès de l’application uniquement jeton pour l’utilisation de l’API Graph hello bibliothèque d’authentification Active Directory pour .NET.</span><span class="sxs-lookup"><span data-stu-id="b11e6-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="b11e6-242">les paramètres de chaîne de requête de Hello qui sont disponibles pour cette demande sont décrits dans hello [demande un jeton d’accès](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) rubrique.</span><span class="sxs-lookup"><span data-stu-id="b11e6-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="b11e6-243">Voici un exemple de demande de jeton d’octroi d’informations d’identification du client :</span><span class="sxs-lookup"><span data-stu-id="b11e6-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="b11e6-244">Voici un exemple de réponse à une demande de jeton d’octroi d’informations d’identification du client :</span><span class="sxs-lookup"><span data-stu-id="b11e6-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="b11e6-245">Obtenir le principal de service d’application ObjectId dans l’instance Azure AD de l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="b11e6-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="b11e6-246">À présent, utiliser hello de jeton tooquery accès uniquement par l’application hello [principaux du Service Azure AD Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) hello de toodetermine API Id d’objet de principal du service de l’application hello dans le répertoire de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="b11e6-247">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) méthode Hello, exemple d’application ASP.net MVC implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="b11e6-248">Hello suivant montre l’exemple de comment toorequest principal du service d’une application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="b11e6-249">a0448380-c346-4f9f-b897-c18733de9394 est l’id de client hello de l’application hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="b11e6-250">Hello exemple suivant illustre une réponse toohello demande pour le service de l’application principale</span><span class="sxs-lookup"><span data-stu-id="b11e6-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="b11e6-251">Obtenir l’identificateur du rôle Azure RBAC</span><span class="sxs-lookup"><span data-stu-id="b11e6-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="b11e6-252">tooassign hello approprié RBAC tooyour service de rôle principal, vous devez déterminer l’identificateur hello du rôle de Azure RBAC hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="b11e6-253">Hello RBAC rôle qui correspond à votre application :</span><span class="sxs-lookup"><span data-stu-id="b11e6-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="b11e6-254">Si votre application surveille uniquement les abonnement hello, sans apporter de modifications, il requiert uniquement des autorisations de lecteur sur les abonnement hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="b11e6-255">Affecter hello **lecteur** rôle.</span><span class="sxs-lookup"><span data-stu-id="b11e6-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="b11e6-256">Si votre application gère l’abonnement Azure hello, création/modification/suppression d’entités, elle nécessite une des autorisations de collaborateur hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="b11e6-257">toomanage un type particulier de ressource, attribuer des rôles de propres à la ressource collaborateur hello (contributeur de l’ordinateur virtuel, les collaborateurs de réseau virtuel, collaborateur de compte de stockage, etc.)</span><span class="sxs-lookup"><span data-stu-id="b11e6-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="b11e6-258">toomanage n’importe quel type de ressource, l’affectation hello **collaborateur** rôle.</span><span class="sxs-lookup"><span data-stu-id="b11e6-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="b11e6-259">attribution de rôle Hello pour votre application étant toousers visible, sélectionnez hello requis de moins de privilèges.</span><span class="sxs-lookup"><span data-stu-id="b11e6-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="b11e6-260">Appelez hello [définition de rôle Gestionnaire de ressources API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist tous les rôles Azure RBAC et recherche ensuite parcourir hello de toofind hello résultat souhaité de définition de rôle par nom.</span><span class="sxs-lookup"><span data-stu-id="b11e6-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="b11e6-261">Hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) méthode Hello, exemple d’application ASP.net MVC implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="b11e6-262">montre l’exemple de la requête suivante de Hello comment identificateur de rôle Azure RBAC tooget.</span><span class="sxs-lookup"><span data-stu-id="b11e6-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="b11e6-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb est l’id hello d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="b11e6-264">réponse de Hello est Bonjour suivant le format :</span><span class="sxs-lookup"><span data-stu-id="b11e6-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="b11e6-265">Il est inutile toocall cette API en continu.</span><span class="sxs-lookup"><span data-stu-id="b11e6-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="b11e6-266">Une fois que vous avez déterminé hello GUID connu de définition de rôle hello, vous pouvez construire des id de définition de rôle hello en tant que :</span><span class="sxs-lookup"><span data-stu-id="b11e6-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="b11e6-267">Voici hello des GUID bien connu des rôles intégrés couramment utilisées :</span><span class="sxs-lookup"><span data-stu-id="b11e6-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="b11e6-268">Rôle</span><span class="sxs-lookup"><span data-stu-id="b11e6-268">Role</span></span> | <span data-ttu-id="b11e6-269">Guid</span><span class="sxs-lookup"><span data-stu-id="b11e6-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="b11e6-270">Lecteur</span><span class="sxs-lookup"><span data-stu-id="b11e6-270">Reader</span></span> |<span data-ttu-id="b11e6-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="b11e6-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="b11e6-272">Contributeur</span><span class="sxs-lookup"><span data-stu-id="b11e6-272">Contributor</span></span> |<span data-ttu-id="b11e6-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="b11e6-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="b11e6-274">Collaborateur de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="b11e6-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="b11e6-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="b11e6-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="b11e6-276">Collaborateur de réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="b11e6-276">Virtual Network Contributor</span></span> |<span data-ttu-id="b11e6-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="b11e6-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="b11e6-278">Collaborateur de compte de stockage</span><span class="sxs-lookup"><span data-stu-id="b11e6-278">Storage Account Contributor</span></span> |<span data-ttu-id="b11e6-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="b11e6-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="b11e6-280">Collaborateur de site web</span><span class="sxs-lookup"><span data-stu-id="b11e6-280">Website Contributor</span></span> |<span data-ttu-id="b11e6-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="b11e6-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="b11e6-282">Collaborateur de plan web</span><span class="sxs-lookup"><span data-stu-id="b11e6-282">Web Plan Contributor</span></span> |<span data-ttu-id="b11e6-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="b11e6-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="b11e6-284">Collaborateur SQL Server</span><span class="sxs-lookup"><span data-stu-id="b11e6-284">SQL Server Contributor</span></span> |<span data-ttu-id="b11e6-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="b11e6-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="b11e6-286">Collaborateur de base de données SQL</span><span class="sxs-lookup"><span data-stu-id="b11e6-286">SQL DB Contributor</span></span> |<span data-ttu-id="b11e6-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="b11e6-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="b11e6-288">Affecter le RBAC rôle tooapplication</span><span class="sxs-lookup"><span data-stu-id="b11e6-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="b11e6-289">Vous disposez de tous les éléments nécessaires tooassign hello approprié RBAC rôle tooyour principal du service à l’aide de hello [le Gestionnaire de ressources créez l’attribution de rôle](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="b11e6-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="b11e6-290">Hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) méthode Hello, exemple d’application ASP.net MVC implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="b11e6-291">Une tooapplication exemple demande tooassign RBAC rôle :</span><span class="sxs-lookup"><span data-stu-id="b11e6-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="b11e6-292">Dans la demande hello, hello valeurs suivantes est utilisée :</span><span class="sxs-lookup"><span data-stu-id="b11e6-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="b11e6-293">Guid</span><span class="sxs-lookup"><span data-stu-id="b11e6-293">Guid</span></span> | <span data-ttu-id="b11e6-294">Description</span><span class="sxs-lookup"><span data-stu-id="b11e6-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="b11e6-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="b11e6-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="b11e6-296">id de Hello d’abonnement de hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="b11e6-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="b11e6-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="b11e6-298">id de l’objet de principal du service de l’application hello hello Hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="b11e6-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="b11e6-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="b11e6-300">id de Hello du rôle de lecteur hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="b11e6-301">4f87261d-2816-465d-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="b11e6-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="b11e6-302">un nouveau guid créé pour la nouvelle attribution de rôle hello</span><span class="sxs-lookup"><span data-stu-id="b11e6-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="b11e6-303">réponse de Hello est Bonjour suivant le format :</span><span class="sxs-lookup"><span data-stu-id="b11e6-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="b11e6-304">Obtenir un jeton d’accès d’application uniquement pour Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="b11e6-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="b11e6-305">toovalidate cette application accède hello souhaitée sur l’abonnement de hello, effectuer une tâche de test sur abonnement hello à l’aide d’un jeton d’application uniquement.</span><span class="sxs-lookup"><span data-stu-id="b11e6-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="b11e6-306">tooget un jeton d’accès d’application uniquement, suivez les instructions à partir de la section [obtenir d’un jeton d’accès application uniquement pour l’API Azure AD Graph](#app-azure-ad-graph), avec une valeur différente pour le paramètre de ressource hello :</span><span class="sxs-lookup"><span data-stu-id="b11e6-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="b11e6-307">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) méthode Hello, exemple d’application ASP.NET MVC Obtient un accès de l’application uniquement jeton pour à l’aide du Gestionnaire de ressources Azure hello bibliothèque d’authentification Active Directory pour .net.</span><span class="sxs-lookup"><span data-stu-id="b11e6-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="b11e6-308">Obtention des autorisations de l’application sur l’abonnement</span><span class="sxs-lookup"><span data-stu-id="b11e6-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="b11e6-309">toocheck votre application a hello souhaité d’accès sur un abonnement Azure, vous pouvez également appeler hello [les autorisations de gestionnaire de ressources](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="b11e6-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="b11e6-310">Cette approche est semblable toohow vous de déterminer si les utilisateurs hello dispose des droits de gestion de l’accès pour l’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="b11e6-311">Toutefois, cette fois-ci, appeler des API d’autorisations de hello avec le jeton d’accès d’application uniquement hello que vous avez reçu dans l’étape précédente de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="b11e6-312">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) méthode Hello, exemple d’application ASP.NET MVC implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="b11e6-313">Gestion des abonnements connectés</span><span class="sxs-lookup"><span data-stu-id="b11e6-313">Manage connected subscriptions</span></span>
<span data-ttu-id="b11e6-314">Lorsque le rôle RBAC approprié hello est assigné principal du service de l’application tooyour lors de l’abonnement de hello, votre application peut conserver d’analyse et la gestion à l’aide des jetons d’accès d’application uniquement pour le Gestionnaire de ressources Azure.</span><span class="sxs-lookup"><span data-stu-id="b11e6-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="b11e6-315">Si un propriétaire d’abonnement Supprime l’attribution de rôle de votre application à l’aide du portail classique de hello ou les outils de ligne de commande, votre application est tooaccess n’est plus en mesure de cet abonnement.</span><span class="sxs-lookup"><span data-stu-id="b11e6-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="b11e6-316">Dans ce cas, vous devez notifier les utilisateurs hello que connexion hello abonnement de hello a été interrompue à partir de l’extérieur application hello et leur donner une option trop « réparer » les connexion hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="b11e6-317">« Réparer » créerait simplement nouvelle attribution de rôle hello qui a été supprimée en mode hors connexion.</span><span class="sxs-lookup"><span data-stu-id="b11e6-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="b11e6-318">Tout comme vous avez activé l’application hello utilisateur tooconnect abonnements tooyour, vous devez autoriser les abonnements de toodisconnect utilisateur hello trop.</span><span class="sxs-lookup"><span data-stu-id="b11e6-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="b11e6-319">À partir d’un point de gestion des accès, de vue déconnecter consiste à effacer l’attribution de rôle hello principal du service de l’application hello vis-à-vis d’abonnement de hello.</span><span class="sxs-lookup"><span data-stu-id="b11e6-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="b11e6-320">Si vous le souhaitez, un état de l’application hello pour l’abonnement de hello peut également supprimé.</span><span class="sxs-lookup"><span data-stu-id="b11e6-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="b11e6-321">Seuls les utilisateurs disposant des autorisations de gestion de l’accès sur l’abonnement de hello sont abonnement de hello en mesure de toodisconnect.</span><span class="sxs-lookup"><span data-stu-id="b11e6-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="b11e6-322">Hello [RevokeRoleFromServicePrincipalOnSubscription méthode](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) Hello ASP.net MVC, exemple d’application implémente cet appel.</span><span class="sxs-lookup"><span data-stu-id="b11e6-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="b11e6-323">Et voilà ! Les utilisateurs peuvent maintenant se connecter et gérer facilement leurs abonnements Azure avec votre application.</span><span class="sxs-lookup"><span data-stu-id="b11e6-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>
