---
title: demande aaaAdvanced limitation avec gestion des API Azure
description: "Découvrez comment toocreate et appliquer le quota flexible et stratégies de gestion des API Azure de limitation du débit."
services: api-management
documentationcenter: 
author: darrelmiller
manager: erikre
editor: 
ms.assetid: fc813a65-7793-4c17-8bb9-e387838193ae
ms.service: api-management
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: ac87f83118a37bd587fddf044e5c2d6fc2af9031
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="advanced-request-throttling-with-azure-api-management"></a><span data-ttu-id="f0226-103">Limitation de requêtes avancée avec Gestion des API Azure</span><span class="sxs-lookup"><span data-stu-id="f0226-103">Advanced request throttling with Azure API Management</span></span>
<span data-ttu-id="f0226-104">Les demandes entrantes en mesure de toothrottle est un rôle clé de la gestion des API Azure.</span><span class="sxs-lookup"><span data-stu-id="f0226-104">Being able toothrottle incoming requests is a key role of Azure API Management.</span></span> <span data-ttu-id="f0226-105">Permet de gestion des API en contrôle taux hello de demandes ou hello total de demandes/données transférées, API fournisseurs tooprotect leurs API à partir des abus et créer une valeur pour les différents niveaux de produit d’API.</span><span class="sxs-lookup"><span data-stu-id="f0226-105">Either by controlling hello rate of requests or hello total requests/data transferred, API Management allows API providers tooprotect their APIs from abuse and create value for different API product tiers.</span></span>

## <a name="product-based-throttling"></a><span data-ttu-id="f0226-106">Limitation en fonction du produit</span><span class="sxs-lookup"><span data-stu-id="f0226-106">Product based throttling</span></span>
<span data-ttu-id="f0226-107">toodate, capacités de limitation des taux de hello ont été limitée toobeing étendue tooa particulier produit abonnement (essentiellement une clé), défini dans hello portail de gestion des API serveur de publication.</span><span class="sxs-lookup"><span data-stu-id="f0226-107">toodate, hello rate throttling capabilities have been limited toobeing scoped tooa particular Product subscription (essentially a key), defined in hello API Management publisher portal.</span></span> <span data-ttu-id="f0226-108">Cela est utile pour les limites de tooapply fournisseur hello API aux développeurs de hello qui se sont inscrits toouse leur API, toutefois, il ne change rien, par exemple, dans la limitation des utilisateurs finaux de hello API.</span><span class="sxs-lookup"><span data-stu-id="f0226-108">This is useful for hello API provider tooapply limits on hello developers who have signed up toouse their API, however, it does not help, for example, in throttling individual end-users of hello API.</span></span> <span data-ttu-id="f0226-109">Il est possible que pour un utilisateur unique de tooconsume d’application du développeur hello hello quota entière et puis empêchent autres clients de développeur de hello application hello de toouse en mesure de.</span><span class="sxs-lookup"><span data-stu-id="f0226-109">It is possible that for single user of hello developer's application tooconsume hello entire quota and then prevent other customers of hello developer from being able toouse hello application.</span></span> <span data-ttu-id="f0226-110">En outre, plusieurs clients qui peuvent générer un volume élevé de demandes peuvent limiter les utilisateurs toooccasional d’accès.</span><span class="sxs-lookup"><span data-stu-id="f0226-110">Also, several customers who might generate a high volume of requests may limit access toooccasional users.</span></span>

## <a name="custom-key-based-throttling"></a><span data-ttu-id="f0226-111">Limitation basée sur une clé personnalisée</span><span class="sxs-lookup"><span data-stu-id="f0226-111">Custom key based throttling</span></span>
<span data-ttu-id="f0226-112">Hello nouvelle [taux limite par clé](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) et [par clé de quota](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) stratégies également fournir un contrôle de tootraffic solution beaucoup plus souple.</span><span class="sxs-lookup"><span data-stu-id="f0226-112">hello new [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies provide a significantly more flexible solution tootraffic control.</span></span> <span data-ttu-id="f0226-113">Ces nouvelles stratégies autorisent toodefine expressions tooidentify hello les clés qui seront l’utilisation du trafic de tootrack utilisé.</span><span class="sxs-lookup"><span data-stu-id="f0226-113">These new policies allow you toodefine expressions tooidentify hello keys that will be used tootrack traffic usage.</span></span> <span data-ttu-id="f0226-114">Hello bonne façon est le plus simple illustrée par un exemple.</span><span class="sxs-lookup"><span data-stu-id="f0226-114">hello way this works is easiest illustrated with an example.</span></span> 

## <a name="ip-address-throttling"></a><span data-ttu-id="f0226-115">Limitation par adresse IP</span><span class="sxs-lookup"><span data-stu-id="f0226-115">IP Address throttling</span></span>
<span data-ttu-id="f0226-116">les stratégies suivantes Hello restreignent un seul client IP adresse tooonly 10 appelle chaque minute, avec un total d’appels de 1 000 000 et 10 000 kilo-octets de la bande passante par mois.</span><span class="sxs-lookup"><span data-stu-id="f0226-116">hello following policies restrict a single client IP address tooonly 10 calls every minute, with a total of 1,000,000 calls and 10,000 kilobytes of bandwidth per month.</span></span> 

```xml
<rate-limit-by-key  calls="10"
          renewal-period="60"
          counter-key="@(context.Request.IpAddress)" />

<quota-by-key calls="1000000"
          bandwidth="10000"
          renewal-period="2629800"
          counter-key="@(context.Request.IpAddress)" />
```

<span data-ttu-id="f0226-117">Si tous les clients sur Internet de hello utilisé une adresse IP unique, cela peut être un moyen efficace de limiter l’utilisation par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="f0226-117">If all clients on hello Internet used a unique IP address, this might be an effective way of limiting usage by user.</span></span> <span data-ttu-id="f0226-118">Toutefois, il est probable que plusieurs utilisateurs seront partage une seule adresse IP publique échéance hello toothem l’accès à Internet via un périphérique NAT.</span><span class="sxs-lookup"><span data-stu-id="f0226-118">However, it is quite likely that multiple users will sharing a single public IP address due toothem accessing hello Internet via a NAT device.</span></span> <span data-ttu-id="f0226-119">En dépit de cela, pour les API qui permettent de hello d’accès non authentifié `IpAddress` peut être préférable de hello.</span><span class="sxs-lookup"><span data-stu-id="f0226-119">Despite this, for APIs that allow unauthenticated access hello `IpAddress` might be hello best option.</span></span>

## <a name="user-identity-throttling"></a><span data-ttu-id="f0226-120">Limitation par identité d'utilisateur</span><span class="sxs-lookup"><span data-stu-id="f0226-120">User identity throttling</span></span>
<span data-ttu-id="f0226-121">Si un utilisateur final est authentifié, une clé de limitation de la clé peut être générée en fonction d’informations qui identifient cet utilisateur de façon unique.</span><span class="sxs-lookup"><span data-stu-id="f0226-121">If an end user is authenticated then a throttling key can be generated based on information that uniquely identifies an that user.</span></span>

```xml
<rate-limit-by-key calls="10"
    renewal-period="60"
    counter-key="@(context.Request.Headers.GetValueOrDefault("Authorization","").AsJwt()?.Subject)" />
```

<span data-ttu-id="f0226-122">Dans cet exemple nous extraire l’en-tête d’autorisation hello, convertissez-le trop`JWT` de l’objet et utiliser le sujet hello d’utilisateur de hello hello tooidentify jeton et l’utiliser comme clé de limitation du débit de hello.</span><span class="sxs-lookup"><span data-stu-id="f0226-122">In this example we extract hello Authorization header, convert it too`JWT` object and use hello subject of hello token tooidentify hello user and use that as hello rate limiting key.</span></span> <span data-ttu-id="f0226-123">Si l’identité utilisateur hello est stockée dans hello `JWT` comme un des hello autres revendications ensuite que la valeur peut être utilisée à la place.</span><span class="sxs-lookup"><span data-stu-id="f0226-123">If hello user identity is stored in hello `JWT` as one of hello other claims then that value could be used in its place.</span></span>

## <a name="combined-policies"></a><span data-ttu-id="f0226-124">Stratégies combinées</span><span class="sxs-lookup"><span data-stu-id="f0226-124">Combined policies</span></span>
<span data-ttu-id="f0226-125">Bien que hello nouvelles stratégies de limitation offrent davantage de contrôle que hello existante des stratégies de limitation, il est toujours valeur combinant deux fonctionnalités.</span><span class="sxs-lookup"><span data-stu-id="f0226-125">Although hello new throttling policies provide more control than hello existing throttling policies, there is still value combining both capabilities.</span></span> <span data-ttu-id="f0226-126">Limitation de la clé de produit abonnement ([taux d’appels limite par abonnement](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) et [définir le quota d’utilisation par abonnement](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) est un excellent moyen tooenable monétisation d’une API en débitant basée sur les niveaux d’utilisation.</span><span class="sxs-lookup"><span data-stu-id="f0226-126">Throttling by product subscription key ([Limit call rate by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRate) and [Set usage quota by subscription](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuota)) is a great way tooenable monetizing of an API by charging based on usage levels.</span></span> <span data-ttu-id="f0226-127">Hello contrôle plus fin d’être en mesure de toothrottle par l’utilisateur est complémentaire et empêche le comportement de l’un utilisateur dégrader expérience hello d’un autre.</span><span class="sxs-lookup"><span data-stu-id="f0226-127">hello finer grained control of being able toothrottle by user is complementary and prevents one user's behavior from degrading hello experience of another.</span></span> 

## <a name="client-driven-throttling"></a><span data-ttu-id="f0226-128">Limitation par client</span><span class="sxs-lookup"><span data-stu-id="f0226-128">Client driven throttling</span></span>
<span data-ttu-id="f0226-129">Lorsque hello limitation de la clé est définie en utilisant un [expression de stratégie](https://msdn.microsoft.com/library/azure/dn910913.aspx), il s’agit de fournisseur hello API qui consiste à choisir comment hello de limitation est étendue.</span><span class="sxs-lookup"><span data-stu-id="f0226-129">When hello throttling key is defined using a [policy expression](https://msdn.microsoft.com/library/azure/dn910913.aspx), then it is hello API provider that is choosing how hello throttling is scoped.</span></span> <span data-ttu-id="f0226-130">Toutefois, un développeur peut décider d’évaluation de toocontrol limiter leurs propres clients.</span><span class="sxs-lookup"><span data-stu-id="f0226-130">However, a developer might want toocontrol how they rate limit their own customers.</span></span> <span data-ttu-id="f0226-131">Cela peut être activé par le fournisseur d’API hello en introduisant client application toocommunicate hello clé toohello un en-tête personnalisé tooallow hello du développeur API.</span><span class="sxs-lookup"><span data-stu-id="f0226-131">This could be enabled by hello API provider by introducing a custom header tooallow hello developer's client application toocommunicate hello key toohello API.</span></span>

```xml
<rate-limit-by-key calls="100"
          renewal-period="60"
          counter-key="@(request.Headers.GetValueOrDefault("Rate-Key",""))"/>
```

<span data-ttu-id="f0226-132">Cela permet de toochoose d’application du développeur hello client comment ils veulent toocreate clé de limitation du débit de hello.</span><span class="sxs-lookup"><span data-stu-id="f0226-132">This enables hello developer's client application toochoose how they want toocreate hello rate limiting key.</span></span> <span data-ttu-id="f0226-133">Avec un peu d’ingéniosité un développeur client peut créer leurs propres niveaux de taux en allouant des jeux de clés toousers et de rotation de l’utilisation de la clé de hello.</span><span class="sxs-lookup"><span data-stu-id="f0226-133">With a little bit of ingenuity a client developer could create their own rate tiers by allocating sets of keys toousers and rotating hello key usage.</span></span>

## <a name="summary"></a><span data-ttu-id="f0226-134">Résumé</span><span class="sxs-lookup"><span data-stu-id="f0226-134">Summary</span></span>
<span data-ttu-id="f0226-135">Gestion des API Azure fournit des devis limitation tooboth taux protéger et ajoutez le service de l’API tooyour valeur.</span><span class="sxs-lookup"><span data-stu-id="f0226-135">Azure API Management provides rate and quote throttling tooboth protect and add value tooyour API service.</span></span> <span data-ttu-id="f0226-136">Hello limitation de nouvelles stratégies avec les règles de portée personnalisées autorise que vous plus fine plus aisément un contrôle sur les stratégies de tooenable vos applications de meilleure toobuild clients.</span><span class="sxs-lookup"><span data-stu-id="f0226-136">hello new throttling policies with custom scoping rules allow you finer grained control over those policies tooenable your customers toobuild even better applications.</span></span> <span data-ttu-id="f0226-137">exemples de Hello dans cet article montrent utilisez hello de ces nouvelles stratégies par clés avec des adresses IP du client, identité des utilisateurs et des valeurs de client générée de limitation du débit de fabrication.</span><span class="sxs-lookup"><span data-stu-id="f0226-137">hello examples in this article demonstrate hello use of these new policies by manufacturing rate limiting keys with client IP addresses, user identity, and client generated values.</span></span> <span data-ttu-id="f0226-138">Toutefois, il existe de nombreuses autres parties du message de type hello qui peuvent être utilisées telles que l’agent utilisateur, de fragments de chemin d’accès d’URL, de taille de message.</span><span class="sxs-lookup"><span data-stu-id="f0226-138">However, there are many other parts of hello message that could be used such as user agent, URL path fragments, message size.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f0226-139">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f0226-139">Next steps</span></span>
<span data-ttu-id="f0226-140">Veuillez envoyez-nous vos commentaires dans le thread de Disqus hello pour cette rubrique.</span><span class="sxs-lookup"><span data-stu-id="f0226-140">Please give us your feedback in hello Disqus thread for this topic.</span></span> <span data-ttu-id="f0226-141">Il serait très toohear sur les autres valeurs de clés potentielles qui ont été un choix logique dans vos scénarios.</span><span class="sxs-lookup"><span data-stu-id="f0226-141">It would be great toohear about other potential key values that have been a logical choice in your scenarios.</span></span>

## <a name="watch-a-video-overview-of-these-policies"></a><span data-ttu-id="f0226-142">Regarder une vidéo de présentation de ces stratégies.</span><span class="sxs-lookup"><span data-stu-id="f0226-142">Watch a video overview of these policies</span></span>
<span data-ttu-id="f0226-143">Pour plus d’informations sur hello [taux limite par clé](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) et [par clé de quota](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) stratégies abordées dans cet article, veuillez consulter hello suivant vidéo.</span><span class="sxs-lookup"><span data-stu-id="f0226-143">For more information on hello [rate-limit-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#LimitCallRateByKey) and [quota-by-key](https://msdn.microsoft.com/library/azure/dn894078.aspx#SetUsageQuotaByKey) policies covered in this article, please watch hello following video.</span></span>

> [!VIDEO https://channel9.msdn.com/Blogs/AzureApiMgmt/Advanced-Request-Throttling-with-Azure-API-Management/player]
> 
> 

