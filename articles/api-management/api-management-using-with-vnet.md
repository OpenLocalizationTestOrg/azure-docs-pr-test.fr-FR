---
title: "aaaHow toouse gestion des API Azure avec des réseaux virtuels"
description: "Découvrez comment toosetup un réseau virtuel tooa de connexion dans Gestion des API Azure et l’accès web des services par son biais."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="232d6-103">Comment toouse gestion des API Azure avec des réseaux virtuels</span><span class="sxs-lookup"><span data-stu-id="232d6-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="232d6-104">Réseaux virtuels Azure (réseaux virtuels) permettent de tooplace une de vos ressources Azure dans un réseau routables non internet que vous contrôlez l’accès à.</span><span class="sxs-lookup"><span data-stu-id="232d6-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="232d6-105">Ces réseaux peut ensuite être tooyour connectés sur des réseaux locaux à l’aide de différentes technologies VPN.</span><span class="sxs-lookup"><span data-stu-id="232d6-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="232d6-106">toolearn plus d’informations sur les réseaux virtuels Azure démarrer avec les informations de hello ici : [vue d’ensemble du réseau virtuel Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="232d6-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="232d6-107">Gestion des API Azure peuvent être déployée à l’intérieur de hello de réseau virtuel (VNET), pour qu’il puisse accéder aux services principaux dans le réseau de hello.</span><span class="sxs-lookup"><span data-stu-id="232d6-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="232d6-108">Hello portail des développeurs et la passerelle API, peut être accessible à partir de hello Internet ou uniquement dans le réseau virtuel de hello toobe configuré.</span><span class="sxs-lookup"><span data-stu-id="232d6-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="232d6-109">La gestion des API Azure prend en charge les réseaux virtuels classiques et Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="232d6-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="232d6-110"><a name="enable-vpn"></a>Activer la connexion au réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="232d6-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="232d6-111">Connectivité de réseau virtuel n’est disponible dans hello **Premium** et **développeur** niveaux.</span><span class="sxs-lookup"><span data-stu-id="232d6-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="232d6-112">tooswitch entre les couches de hello, ouvrez votre service de gestion des API Bonjour portail Azure, puis hello **mise à l’échelle et la tarification** onglet. Sous hello **niveau tarifaire** , sélectionnez le niveau Premium ou le développeur de hello et cliquez sur Enregistrer.</span><span class="sxs-lookup"><span data-stu-id="232d6-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="232d6-113">connectivité de réseau virtuel tooenable, ouvrez votre service de gestion des API Bonjour portail Azure, hello **réseau virtuel** page.</span><span class="sxs-lookup"><span data-stu-id="232d6-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Menu Réseau virtuel du service Gestion des API][api-management-using-vnet-menu]

<span data-ttu-id="232d6-115">Sélectionnez le type d’accès hello souhaité :</span><span class="sxs-lookup"><span data-stu-id="232d6-115">Select hello desired access type:</span></span>

* <span data-ttu-id="232d6-116">**Externe**: portail de passerelle et le développeur de la gestion des API hello sont accessibles à partir de hello internet public via un équilibreur de charge externe.</span><span class="sxs-lookup"><span data-stu-id="232d6-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="232d6-117">passerelle de Hello peut accéder aux ressources au sein du réseau virtuel de hello.</span><span class="sxs-lookup"><span data-stu-id="232d6-117">hello gateway can access resources within hello virtual network.</span></span>

![Homologation publique][api-management-vnet-public]

* <span data-ttu-id="232d6-119">**Interne**: portail de passerelle et le développeur de la gestion des API hello sont accessibles uniquement à partir de réseau virtuel de hello via un équilibreur de charge interne.</span><span class="sxs-lookup"><span data-stu-id="232d6-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="232d6-120">passerelle de Hello peut accéder aux ressources au sein du réseau virtuel de hello.</span><span class="sxs-lookup"><span data-stu-id="232d6-120">hello gateway can access resources within hello virtual network.</span></span>

![Homologation privée][api-management-vnet-private]

<span data-ttu-id="232d6-122">Vous voyez maintenant une liste de toutes les régions où votre service Gestion des API est créé.</span><span class="sxs-lookup"><span data-stu-id="232d6-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="232d6-123">Sélectionnez un réseau VNET et un sous-réseau pour chaque région.</span><span class="sxs-lookup"><span data-stu-id="232d6-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="232d6-124">liste de Hello est remplie avec classique et réseaux virtuels de gestionnaire de ressources disponibles dans vos abonnements Azure qui sont configurés dans la région de hello que vous configurez.</span><span class="sxs-lookup"><span data-stu-id="232d6-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="232d6-125">**Point de terminaison de service** dans hello diagramme ci-dessus inclut passerelle/Proxy, portail de publication, portail des développeurs, GIT et hello point de terminaison de gestion directe.</span><span class="sxs-lookup"><span data-stu-id="232d6-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="232d6-126">**Point de terminaison de gestion** Bonjour diagramme ci-dessus est le point de terminaison hello hébergé sur la configuration du service de hello toomanage via le portail Azure et Powershell.</span><span class="sxs-lookup"><span data-stu-id="232d6-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="232d6-127">Notez également, que, bien que le diagramme de hello affiche les adresses IP de ses points de terminaison différents, le service de gestion des API **uniquement** répond à ses noms d’hôtes configurés.</span><span class="sxs-lookup"><span data-stu-id="232d6-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="232d6-128">Lorsque vous déployez un tooa d’instance gestion des API Azure Resource Manager VNET, hello service doit être un sous-réseau dédié qui ne contient aucuns autres ressources à l’exception des instances de la gestion des API Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="232d6-129">Si une tentative est faite toodeploy un tooa d’instance gestion des API Azure sous-réseau de gestionnaire de ressources du VNET qui contient d’autres ressources, le déploiement de hello échoue.</span><span class="sxs-lookup"><span data-stu-id="232d6-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Sélectionner le VPN][api-management-setup-vpn-select]

<span data-ttu-id="232d6-131">Cliquez sur **enregistrer** haut hello écran hello.</span><span class="sxs-lookup"><span data-stu-id="232d6-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="232d6-132">Hello adresse VIP de l’instance de gestion des API hello change chaque fois réseau virtuel est activé ou désactivé.</span><span class="sxs-lookup"><span data-stu-id="232d6-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="232d6-133">Hello adresse VIP modifiera également lors de la gestion des API est déplacée de **externe** trop**interne** ou vice versa</span><span class="sxs-lookup"><span data-stu-id="232d6-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="232d6-134">Si vous supprimez la gestion des API à partir d’un réseau virtuel ou que vous modifiez hello une qu’il est déployé dans, hello réseau virtuel précédemment utilisé peut rester verrouillé pour les heures de too4.</span><span class="sxs-lookup"><span data-stu-id="232d6-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="232d6-135">Pendant cette période il ne sera pas possible de toodelete hello réseau virtuel ou déployer une nouvelle tooit de ressources.</span><span class="sxs-lookup"><span data-stu-id="232d6-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="232d6-136"><a name="enable-vnet-powershell"></a>Activation de la connexion au réseau virtuel à l’aide d’applets de commande PowerShell</span><span class="sxs-lookup"><span data-stu-id="232d6-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="232d6-137">Vous pouvez également activer la connectivité de réseau virtuel à l’aide des applets de commande PowerShell hello</span><span class="sxs-lookup"><span data-stu-id="232d6-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="232d6-138">**Créer un service de gestion des API à l’intérieur d’un réseau virtuel**: utiliser l’applet de commande hello [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate un service de gestion des API Azure à l’intérieur d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="232d6-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="232d6-139">**Déployer un service de gestion des API existant à l’intérieur d’un réseau virtuel**: utiliser l’applet de commande hello [AzureRmApiManagementDeployment de mise à jour](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove un service de gestion des API Azure existant à l’intérieur d’un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="232d6-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="232d6-140"><a name="connect-vnet"></a>Connecter tooa web service est hébergé dans un réseau virtuel</span><span class="sxs-lookup"><span data-stu-id="232d6-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="232d6-141">Une fois votre service de gestion des API toohello connecté réseau virtuel, l’accès à des services principaux qu’il contient n’est pas différente de l’accès aux services publics.</span><span class="sxs-lookup"><span data-stu-id="232d6-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="232d6-142">Tapez simplement dans hello nom d’hôte (si un serveur DNS est configuré pour le réseau virtuel de hello) de votre service web ou une adresse IP locale de hello en hello **URL du service Web** champ lors de la création d’une nouvelle API ou modifier un existant.</span><span class="sxs-lookup"><span data-stu-id="232d6-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Ajouter des API à partir du VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="232d6-144"><a name="network-configuration-issues"></a>Problèmes courants liés à la configuration du réseau</span><span class="sxs-lookup"><span data-stu-id="232d6-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="232d6-145">Voici une liste des problèmes courants de configuration incorrecte qui peuvent se produire lors du déploiement du service de gestion des API dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="232d6-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="232d6-146">**Installation du serveur DNS personnalisée**: hello service de gestion des API dépend de plusieurs services Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="232d6-147">Lors de la gestion des API est hébergée dans un réseau virtuel avec un serveur DNS personnalisé, il doit les noms d’hôte tooresolve hello de ces services Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="232d6-148">Veuillez suivre [ce](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guide sur la configuration de serveurs DNS personnalisée.</span><span class="sxs-lookup"><span data-stu-id="232d6-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="232d6-149">Consultez le tableau de ports hello ci-dessous et autres exigences réseau pour référence.</span><span class="sxs-lookup"><span data-stu-id="232d6-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="232d6-150">Il est recommandé que, si vous utilisez un ou les serveurs DNS personnalisé pour hello réseau virtuel, vous définir qui **avant** déploiement d’un service de gestion des API dans celui-ci.</span><span class="sxs-lookup"><span data-stu-id="232d6-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="232d6-151">Sinon vous devez trop mettre à jour service de gestion des API hello chaque fois que vous modifiez les serveurs DNS hello (s) en exécutant hello [appliquer une opération de Configuration réseau](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="232d6-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="232d6-152">**Ports requis pour la gestion des API**: trafic entrant et sortant dans le sous-réseau hello dans lequel est déployée gestion des API peut être contrôlé à l’aide de [groupe de sécurité réseau][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="232d6-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="232d6-153">Si ces ports ne sont pas disponibles, la gestion des API risque de ne pas fonctionner correctement et d’être inaccessible.</span><span class="sxs-lookup"><span data-stu-id="232d6-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="232d6-154">Le blocage d’un ou plusieurs de ces ports constitue un autre problème de configuration courant lorsque vous utilisez la gestion des API dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="232d6-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="232d6-155">Lorsqu’une instance de service de gestion des API est hébergée dans un réseau virtuel, les ports hello Bonjour tableau suivant sont utilisées.</span><span class="sxs-lookup"><span data-stu-id="232d6-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="232d6-156">Port(s) source / de destination</span><span class="sxs-lookup"><span data-stu-id="232d6-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="232d6-157">Direction</span><span class="sxs-lookup"><span data-stu-id="232d6-157">Direction</span></span> | <span data-ttu-id="232d6-158">Protocole de transfert</span><span class="sxs-lookup"><span data-stu-id="232d6-158">Transport protocol</span></span> | <span data-ttu-id="232d6-159">Objectif</span><span class="sxs-lookup"><span data-stu-id="232d6-159">Purpose</span></span> | <span data-ttu-id="232d6-160">Source / Destination</span><span class="sxs-lookup"><span data-stu-id="232d6-160">Source / Destination</span></span> | <span data-ttu-id="232d6-161">Type d’accès</span><span class="sxs-lookup"><span data-stu-id="232d6-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="232d6-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="232d6-162">* / 80, 443</span></span> |<span data-ttu-id="232d6-163">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="232d6-163">Inbound</span></span> |<span data-ttu-id="232d6-164">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-164">TCP</span></span> |<span data-ttu-id="232d6-165">TooAPI de communication client Management</span><span class="sxs-lookup"><span data-stu-id="232d6-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="232d6-166">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="232d6-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="232d6-167">Externe</span><span class="sxs-lookup"><span data-stu-id="232d6-167">External</span></span> |
| <span data-ttu-id="232d6-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="232d6-168">* / 3443</span></span> |<span data-ttu-id="232d6-169">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="232d6-169">Inbound</span></span> |<span data-ttu-id="232d6-170">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-170">TCP</span></span> |<span data-ttu-id="232d6-171">Point de terminaison de gestion pour le portail Azure et Powershell</span><span class="sxs-lookup"><span data-stu-id="232d6-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="232d6-172">INTERNET / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="232d6-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="232d6-173">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-173">External & Internal</span></span> |
| <span data-ttu-id="232d6-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="232d6-174">* / 80, 443</span></span> |<span data-ttu-id="232d6-175">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-175">Outbound</span></span> |<span data-ttu-id="232d6-176">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-176">TCP</span></span> |<span data-ttu-id="232d6-177">Dépendance sur Stockage Azure et Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="232d6-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="232d6-178">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-179">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-179">External & Internal</span></span> |
| <span data-ttu-id="232d6-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="232d6-180">* / 1433</span></span> |<span data-ttu-id="232d6-181">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-181">Outbound</span></span> |<span data-ttu-id="232d6-182">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-182">TCP</span></span> |<span data-ttu-id="232d6-183">Dépendance sur SQL Azure</span><span class="sxs-lookup"><span data-stu-id="232d6-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="232d6-184">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-185">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-185">External & Internal</span></span> |
| <span data-ttu-id="232d6-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="232d6-186">* / 11000 - 11999</span></span> |<span data-ttu-id="232d6-187">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-187">Outbound</span></span> |<span data-ttu-id="232d6-188">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-188">TCP</span></span> |<span data-ttu-id="232d6-189">Dépendance Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="232d6-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="232d6-190">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-191">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-191">External & Internal</span></span> |
| <span data-ttu-id="232d6-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="232d6-192">* / 14000 - 14999</span></span> |<span data-ttu-id="232d6-193">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-193">Outbound</span></span> |<span data-ttu-id="232d6-194">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-194">TCP</span></span> |<span data-ttu-id="232d6-195">Dépendance Azure SQL V12</span><span class="sxs-lookup"><span data-stu-id="232d6-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="232d6-196">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-197">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-197">External & Internal</span></span> |
| <span data-ttu-id="232d6-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="232d6-198">* / 5671</span></span> |<span data-ttu-id="232d6-199">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-199">Outbound</span></span> |<span data-ttu-id="232d6-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="232d6-200">AMQP</span></span> |<span data-ttu-id="232d6-201">Dépendance de stratégie du Hub tooEvent journal et l’agent d’analyse</span><span class="sxs-lookup"><span data-stu-id="232d6-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="232d6-202">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-203">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-203">External & Internal</span></span> |
| <span data-ttu-id="232d6-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="232d6-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="232d6-205">Trafic entrant et sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-205">Inbound & Outbound</span></span> |<span data-ttu-id="232d6-206">UDP</span><span class="sxs-lookup"><span data-stu-id="232d6-206">UDP</span></span> |<span data-ttu-id="232d6-207">Dépendance sur Cache Redis</span><span class="sxs-lookup"><span data-stu-id="232d6-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="232d6-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="232d6-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="232d6-209">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-209">External & Internal</span></span> |-
| <span data-ttu-id="232d6-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="232d6-210">* / 445</span></span> |<span data-ttu-id="232d6-211">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="232d6-211">Outbound</span></span> |<span data-ttu-id="232d6-212">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-212">TCP</span></span> |<span data-ttu-id="232d6-213">Dépendance sur le partage de fichiers Azure pour GIT</span><span class="sxs-lookup"><span data-stu-id="232d6-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="232d6-214">VIRTUAL_NETWORK / INTERNET</span><span class="sxs-lookup"><span data-stu-id="232d6-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="232d6-215">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-215">External & Internal</span></span> |
| <span data-ttu-id="232d6-216">* / *</span><span class="sxs-lookup"><span data-stu-id="232d6-216">* / *</span></span> | <span data-ttu-id="232d6-217">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="232d6-217">Inbound</span></span> |<span data-ttu-id="232d6-218">TCP</span><span class="sxs-lookup"><span data-stu-id="232d6-218">TCP</span></span> |<span data-ttu-id="232d6-219">Équilibrage de charge de l’infrastructure Azure</span><span class="sxs-lookup"><span data-stu-id="232d6-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="232d6-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="232d6-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="232d6-221">Externe et interne</span><span class="sxs-lookup"><span data-stu-id="232d6-221">External & Internal</span></span> |

* <span data-ttu-id="232d6-222">**Fonctionnalité SSL**: certificat SSL de tooenable a besoin d’un service de gestion des API hello création et la validation des chaîne tooocsp.msocsp.com de connectivité réseau sortant, mscrl.microsoft.com et crl.microsoft.com. Cette dépendance n’est pas obligatoire, si n’importe quel certificat que vous téléchargez tooAPI gestion contiennent la racine d’autorité de certification de toohello hello chaîne complète.</span><span class="sxs-lookup"><span data-stu-id="232d6-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="232d6-223">**Accès DNS** : l’accès sortant sur le port 53 est nécessaire pour la communication avec des serveurs DNS.</span><span class="sxs-lookup"><span data-stu-id="232d6-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="232d6-224">Si un serveur DNS personnalisé existe sur hello l’autre extrémité d’une passerelle VPN, le serveur DNS de hello doit être accessible à partir du sous-réseau hello gestion des API d’hébergement.</span><span class="sxs-lookup"><span data-stu-id="232d6-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="232d6-225">**Contrôle d’intégrité et métriques**: réseau sortant connectivité tooAzure analyse points de terminaison résoudre sous hello suivant domaines : global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="232d6-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="232d6-226">**Itinéraire installation rapide**: une configuration de client commune est toodefine leur propres itinéraire par défaut (0.0.0.0/0), ce qui force sortant Internet trafic tooinstead flux localement.</span><span class="sxs-lookup"><span data-stu-id="232d6-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="232d6-227">Ce flux de trafic sauts invariablement de connectivité avec la gestion des API Azure, car le trafic sortant de hello est bloqué localement ou NAT qui a recours à ensemble non reconnaissable de tooan d’adresses qui ne fonctionnent plus avec différents points de terminaison Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="232d6-228">solution Hello est toodefine un (ou plusieurs) des itinéraires définis par l’utilisateur ([UDRs][UDRs]) sur le sous-réseau hello contenant hello gestion des API Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="232d6-229">Un UDR définit les itinéraires de sous-réseau spécifique qui seront respectées au lieu de l’itinéraire par défaut hello.</span><span class="sxs-lookup"><span data-stu-id="232d6-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="232d6-230">Si possible, il est recommandé de hello toouse configuration suivante :</span><span class="sxs-lookup"><span data-stu-id="232d6-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="232d6-231">configuration de ExpressRoute Hello annonce 0.0.0.0/0 et par défaut force tunnels tout le trafic sortant sur site.</span><span class="sxs-lookup"><span data-stu-id="232d6-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="232d6-232">Hello UDR appliqué toohello sous-réseau contenant hello gestion des API Azure définit 0.0.0.0/0 avec un type de tronçon suivant d’Internet.</span><span class="sxs-lookup"><span data-stu-id="232d6-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="232d6-233">Bonjour effets combinés de ces étapes est qu’au niveau du sous-réseau UDR hello est prioritaire sur hello ExpressRoute forcé tunneling, garantissant ainsi un accès Internet sortant à partir de hello gestion des API Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="232d6-234">Gestion des API Azure n’est pas pris en charge avec des configurations de ExpressRoute qui **incorrectement cross-publier d’itinéraires de hello publics d’homologation toohello privés d’homologation chemin**.</span><span class="sxs-lookup"><span data-stu-id="232d6-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="232d6-235">Les configurations ExpressRoute ayant une homologation publique configurée reçoivent les annonces de routage depuis Microsoft pour un grand ensemble de plages d'adresses IP Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="232d6-236">Si ces plages d’adresses sont incorrectement entre publiés sur le chemin d’accès d’homologation privée hello, le résultat final de hello est que tous les paquets réseau sortant à partir du sous-réseau de l’instance de gestion des API Azure hello sont incorrectement en tunnel force le tooa local réseau client infrastructure.</span><span class="sxs-lookup"><span data-stu-id="232d6-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="232d6-237">Ce flux réseau interrompt la gestion des API Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="232d6-238">problème de toothis solution Hello est itinéraires de publication entre toostop de hello publics d’homologation toohello privés d’homologation chemin d’accès.</span><span class="sxs-lookup"><span data-stu-id="232d6-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="232d6-239"><a name="troubleshooting"></a>Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="232d6-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="232d6-240">Lorsque vous élaborez réseau tooyour de modifications, consultez trop[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate si hello service de gestion des API n’a pas perdu tooany accès Hello ressources critiques qui il dépend.</span><span class="sxs-lookup"><span data-stu-id="232d6-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="232d6-241">état de connectivité Hello doit être mis à jour toutes les 15 minutes.</span><span class="sxs-lookup"><span data-stu-id="232d6-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="232d6-242"><a name="limitations"></a>Limitations</span><span class="sxs-lookup"><span data-stu-id="232d6-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="232d6-243">Un sous-réseau contenant des instances du service Gestion des API ne peut pas contenir d’autres types de ressource Azure.</span><span class="sxs-lookup"><span data-stu-id="232d6-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="232d6-244">sous-réseau de Hello et hello gestion des API service doit être hello même abonnement.</span><span class="sxs-lookup"><span data-stu-id="232d6-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="232d6-245">Un sous-réseau contenant des instances du service Gestion des API ne peut pas être déplacé entre des abonnements.</span><span class="sxs-lookup"><span data-stu-id="232d6-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="232d6-246">Lors de l’utilisation d’un réseau virtuel interne, seule une adresse IP interne sera disponible à partir de la plage de hello indiqué dans [RFC 1918](https://tools.ietf.org/html/rfc1918), une adresse IP publique ne peut pas être fournie.</span><span class="sxs-lookup"><span data-stu-id="232d6-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="232d6-247">Pour les déploiements de gestion des API de plusieurs régions, avec des réseaux virtuels internes configurées, les utilisateurs sont chargés de gérer leur propres comme ils possèdent hello DNS d’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="232d6-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="232d6-248"><a name="related-content"></a>Contenu connexe</span><span class="sxs-lookup"><span data-stu-id="232d6-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="232d6-249">Connexion d’un toobackend de réseau virtuel à l’aide de la passerelle Vpn</span><span class="sxs-lookup"><span data-stu-id="232d6-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="232d6-250">Connexion d’un réseau virtuel utilisant des modèles de déploiement différents</span><span class="sxs-lookup"><span data-stu-id="232d6-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="232d6-251">Méthode d’appel de toouse hello tootrace d’inspecteur de l’API de gestion des API Azure</span><span class="sxs-lookup"><span data-stu-id="232d6-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md
