---
title: "Résolution des problèmes du cache Redis Azure | Microsoft Docs"
description: "Découvrez comment résoudre les problèmes courants liés au cache Redis Azure."
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 928b9b9c-d64f-4252-884f-af7ba8309af6
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 01/06/2017
ms.author: sdanie
ms.openlocfilehash: 2e9d1b644f1e80c7d916a261a6c47fcc11a1ffe0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-troubleshoot-azure-redis-cache"></a><span data-ttu-id="107a6-103">Résolution des problèmes du cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="107a6-103">How to troubleshoot Azure Redis Cache</span></span>
<span data-ttu-id="107a6-104">Cet article fournit des conseils pour résoudre les catégories suivantes de problèmes liés au cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="107a6-104">This article provides guidance for troubleshooting the following categories of Azure Redis Cache issues.</span></span>

* <span data-ttu-id="107a6-105">[Résolution des problèmes côté client](#client-side-troubleshooting) : cette section fournit des instructions concernant l’identification et la résolution des problèmes provoqués par la connexion de l’application au cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="107a6-105">[Client side troubleshooting](#client-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused by the application connecting to Azure Redis Cache.</span></span>
* <span data-ttu-id="107a6-106">[Résolution des problèmes côté serveur](#server-side-troubleshooting) : cette section fournit des instructions concernant l’identification et la résolution des problèmes côté serveur du cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="107a6-106">[Server side troubleshooting](#server-side-troubleshooting) - This section provides guidelines on identifying and resolving issues caused on the Azure Redis Cache server side.</span></span>
* <span data-ttu-id="107a6-107">[Exceptions au délai d’expiration de StackExchange.Redis](#stackexchangeredis-timeout-exceptions) : cette section fournit des informations concernant la résolution des problèmes liés à l’utilisation du client StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="107a6-107">[StackExchange.Redis timeout exceptions](#stackexchangeredis-timeout-exceptions) - This section provides information on troubleshooting issues when using the StackExchange.Redis client.</span></span>

> [!NOTE]
> <span data-ttu-id="107a6-108">Dans ce guide, plusieurs procédures de résolution de problèmes comprennent des instructions pour exécuter des commandes Redis et surveiller diverses mesures de performances.</span><span class="sxs-lookup"><span data-stu-id="107a6-108">Several of the troubleshooting steps in this guide include instructions to run Redis commands and monitor various performance metrics.</span></span> <span data-ttu-id="107a6-109">Pour plus d’informations et d’instructions, consultez les articles dans la section [Informations supplémentaires](#additional-information) .</span><span class="sxs-lookup"><span data-stu-id="107a6-109">For more information and instructions, see the articles in the [Additional information](#additional-information) section.</span></span>
> 
> 

## <a name="client-side-troubleshooting"></a><span data-ttu-id="107a6-110">Résolution des problèmes côté client</span><span class="sxs-lookup"><span data-stu-id="107a6-110">Client side troubleshooting</span></span>
<span data-ttu-id="107a6-111">Cette section traite des problèmes qui surviennent à cause d’un souci sur l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="107a6-111">This section discusses troubleshooting issues that occur because of a condition on the client application.</span></span>

* [<span data-ttu-id="107a6-112">Saturation de la mémoire sur le client</span><span class="sxs-lookup"><span data-stu-id="107a6-112">Memory pressure on the client</span></span>](#memory-pressure-on-the-client)
* [<span data-ttu-id="107a6-113">Augmentation de trafic</span><span class="sxs-lookup"><span data-stu-id="107a6-113">Burst of traffic</span></span>](#burst-of-traffic)
* [<span data-ttu-id="107a6-114">Utilisation importante du processeur du client</span><span class="sxs-lookup"><span data-stu-id="107a6-114">High client CPU usage</span></span>](#high-client-cpu-usage)
* [<span data-ttu-id="107a6-115">Bande passante dépassée côté client</span><span class="sxs-lookup"><span data-stu-id="107a6-115">Client Side Bandwidth Exceeded</span></span>](#client-side-bandwidth-exceeded)
* [<span data-ttu-id="107a6-116">Taille importante de la demande/réponse</span><span class="sxs-lookup"><span data-stu-id="107a6-116">Large Request/Response Size</span></span>](#large-requestresponse-size)
* [<span data-ttu-id="107a6-117">Qu’est-il arrivé à mes données dans Redis ?</span><span class="sxs-lookup"><span data-stu-id="107a6-117">What happened to my data in Redis?</span></span>](#what-happened-to-my-data-in-redis)

### <a name="memory-pressure-on-the-client"></a><span data-ttu-id="107a6-118">Saturation de la mémoire sur le client</span><span class="sxs-lookup"><span data-stu-id="107a6-118">Memory pressure on the client</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-119">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-119">Problem</span></span>
<span data-ttu-id="107a6-120">Une saturation de la mémoire sur l’ordinateur client génère des problèmes de performances de toutes sortes, susceptibles de retarder le traitement des données envoyées par l’instance Redis sans délai.</span><span class="sxs-lookup"><span data-stu-id="107a6-120">Memory pressure on the client machine leads to all kinds of performance problems that can delay processing of data that was sent by the Redis instance without any delay.</span></span> <span data-ttu-id="107a6-121">En cas de saturation de la mémoire, le système doit généralement paginer les données de la mémoire physique dans la mémoire virtuelle située sur le disque.</span><span class="sxs-lookup"><span data-stu-id="107a6-121">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="107a6-122">Cette *pagination* ralentit considérablement le système.</span><span class="sxs-lookup"><span data-stu-id="107a6-122">This *page faulting* causes the system to slow down significantly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-123">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-123">Measurement</span></span>
1. <span data-ttu-id="107a6-124">Surveillez l’utilisation de la mémoire sur l’ordinateur et vérifiez qu’elle ne dépasse pas la mémoire disponible.</span><span class="sxs-lookup"><span data-stu-id="107a6-124">Monitor memory usage on machine to make sure that it does not exceed available memory.</span></span> 
2. <span data-ttu-id="107a6-125">Surveillez le compteur de performances `Page Faults/Sec`.</span><span class="sxs-lookup"><span data-stu-id="107a6-125">Monitor the `Page Faults/Sec` performance counter.</span></span> <span data-ttu-id="107a6-126">La plupart des systèmes rencontrent des erreurs de page, même lors d’un fonctionnement normal. Donc, surveillez les pics dans ce compteur de performances, car ils correspondent à des délais d’attente.</span><span class="sxs-lookup"><span data-stu-id="107a6-126">Most systems will have some page faults even during normal operation, so watch for spikes in this page faults performance counter which correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-127">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-127">Resolution</span></span>
<span data-ttu-id="107a6-128">Agrandissez la taille de la machine virtuelle de votre client en lui attribuant davantage de mémoire ou analysez vos graphiques d’utilisation de la mémoire afin d’en réduire la consommation.</span><span class="sxs-lookup"><span data-stu-id="107a6-128">Upgrade your client to a larger client VM size with more memory or dig into your memory usage patterns to reduce memory consuption.</span></span>

### <a name="burst-of-traffic"></a><span data-ttu-id="107a6-129">Augmentation de trafic</span><span class="sxs-lookup"><span data-stu-id="107a6-129">Burst of traffic</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-130">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-130">Problem</span></span>
<span data-ttu-id="107a6-131">Les augmentations de trafic combinées à des paramètres `ThreadPool` insatisfaisants peuvent retarder le traitement des données déjà envoyées par le serveur Redis, mais pas encore consommées côté client.</span><span class="sxs-lookup"><span data-stu-id="107a6-131">Bursts of traffic combined with poor `ThreadPool` settings can result in delays in processing data already sent by the Redis Server but not yet consumed on the client side.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-132">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-132">Measurement</span></span>
<span data-ttu-id="107a6-133">Surveillez comment évoluent vos statistiques `ThreadPool` au fil du temps à l’aide d’un code [tel que celui-ci](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="107a6-133">Monitor how your `ThreadPool` statistics change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/ThreadPoolMonitor/ThreadPoolLogger.cs).</span></span> <span data-ttu-id="107a6-134">Vous pouvez également consulter le message `TimeoutException` émis par StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="107a6-134">You can also look at the `TimeoutException` message from StackExchange.Redis.</span></span> <span data-ttu-id="107a6-135">Voici un exemple :</span><span class="sxs-lookup"><span data-stu-id="107a6-135">Here is an example :</span></span>

    System.TimeoutException: Timeout performing EVAL, inst: 8, mgr: Inactive, queue: 0, qu: 0, qs: 0, qc: 0, wr: 0, wq: 0, in: 64221, ar: 0, 
    IOCP: (Busy=6,Free=999,Min=2,Max=1000), WORKER: (Busy=7,Free=8184,Min=2,Max=8191)

<span data-ttu-id="107a6-136">Dans le message ci-dessus, plusieurs problèmes sont intéressants :</span><span class="sxs-lookup"><span data-stu-id="107a6-136">In the above message, there are several issues that are interesting:</span></span>

1. <span data-ttu-id="107a6-137">Notez que dans les sections `IOCP` et `WORKER`, la valeur de `Busy` est supérieure à la valeur de `Min`.</span><span class="sxs-lookup"><span data-stu-id="107a6-137">Notice that in the `IOCP` section and the `WORKER` section you have a `Busy` value that is greater than the `Min` value.</span></span> <span data-ttu-id="107a6-138">Cela signifie que vos paramètres de `ThreadPool` ont besoin d’être ajustés.</span><span class="sxs-lookup"><span data-stu-id="107a6-138">This means that your `ThreadPool` settings need adjusting.</span></span>
2. <span data-ttu-id="107a6-139">Vous pouvez également voir `in: 64221`.</span><span class="sxs-lookup"><span data-stu-id="107a6-139">You can also see `in: 64221`.</span></span> <span data-ttu-id="107a6-140">Cela indique que 64 211 octets ont été reçus au niveau de la couche de socket du noyau, mais ne sont pas encore lus par l’application (par exemple StackExchange.Redis).</span><span class="sxs-lookup"><span data-stu-id="107a6-140">This indicates that 64211 bytes have been received at the kernel socket layer but haven't yet been read by the application (e.g. StackExchange.Redis).</span></span> <span data-ttu-id="107a6-141">En général, cela signifie que votre application ne lit pas les données du réseau aussi rapidement que le serveur les lui envoie.</span><span class="sxs-lookup"><span data-stu-id="107a6-141">This typically means that your application isn't reading data from the network as quickly as the server is sending it to you.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-142">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-142">Resolution</span></span>
<span data-ttu-id="107a6-143">Configurez les [paramètres de votre pool de threads](https://gist.github.com/JonCole/e65411214030f0d823cb) pour vous assurer qu’ils s’adaptent rapidement en cas d’augmentation du trafic.</span><span class="sxs-lookup"><span data-stu-id="107a6-143">Configure your [ThreadPool Settings](https://gist.github.com/JonCole/e65411214030f0d823cb) to make sure that your thread pool will scale up quickly under burst scenarios.</span></span>

### <a name="high-client-cpu-usage"></a><span data-ttu-id="107a6-144">Utilisation importante du processeur du client</span><span class="sxs-lookup"><span data-stu-id="107a6-144">High client CPU usage</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-145">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-145">Problem</span></span>
<span data-ttu-id="107a6-146">Une utilisation élevée du processeur sur le client révèle que le système n’arrive pas à effectuer le travail qu’on lui demande de faire.</span><span class="sxs-lookup"><span data-stu-id="107a6-146">High CPU usage on the client is an indication that the system cannot keep up with the work that it has been asked to perform.</span></span> <span data-ttu-id="107a6-147">En d’autres termes, le client risque de ne pas pouvoir traiter une réponse de Redis dans les délais, même si Redis a envoyé la réponse très rapidement.</span><span class="sxs-lookup"><span data-stu-id="107a6-147">This means that the client may fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-148">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-148">Measurement</span></span>
<span data-ttu-id="107a6-149">Surveillez l’utilisation du processeur par tout le système dans le portail Azure ou à l’aide du compteur de performances associé.</span><span class="sxs-lookup"><span data-stu-id="107a6-149">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="107a6-150">Ne tenez pas compte du processeur de *processus* , car un processus peut utiliser faiblement le processeur pendant que le processeur système est fortement sollicité.</span><span class="sxs-lookup"><span data-stu-id="107a6-150">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="107a6-151">Regardez les pics d’utilisation du processeur qui correspondent à des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-151">Watch for spikes in CPU usage that correspond with timeouts.</span></span> <span data-ttu-id="107a6-152">Lorsque le processeur est très utilisé, vous pouvez également voir s’afficher des valeurs `in: XXX` élevées dans les messages d’erreur `TimeoutException`, comme ceux décrits dans la section [Augmentation de trafic](#burst-of-traffic).</span><span class="sxs-lookup"><span data-stu-id="107a6-152">As a result of high CPU, you may also see high `in: XXX` values in `TimeoutException` error messages as described in the [Burst of traffic](#burst-of-traffic) section.</span></span>

> [!NOTE]
> <span data-ttu-id="107a6-153">StackExchange.Redis 1.1.603 et versions ultérieures inclut la mesure `local-cpu` dans les messages d’erreur `TimeoutException`.</span><span class="sxs-lookup"><span data-stu-id="107a6-153">StackExchange.Redis 1.1.603 and later includes the `local-cpu` metric in `TimeoutException` error messages.</span></span> <span data-ttu-id="107a6-154">Vérifiez que vous utilisez la dernière version en date du [package NuGet StackExchange.Redis](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="107a6-154">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="107a6-155">Nous corrigeons en permanence le code pour le rendre plus robuste aux délais d’expiration. Il est donc primordial d’utiliser la dernière version.</span><span class="sxs-lookup"><span data-stu-id="107a6-155">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
> 
> 

#### <a name="resolution"></a><span data-ttu-id="107a6-156">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-156">Resolution</span></span>
<span data-ttu-id="107a6-157">Procédez à la mise à niveau vers une plus grande taille de machine virtuelle avec davantage de capacités processeur ou recherchez la cause des pics d’utilisation du processeur.</span><span class="sxs-lookup"><span data-stu-id="107a6-157">Upgrade to a larger VM size with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="client-side-bandwidth-exceeded"></a><span data-ttu-id="107a6-158">Bande passante dépassée côté client</span><span class="sxs-lookup"><span data-stu-id="107a6-158">Client side bandwidth exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-159">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-159">Problem</span></span>
<span data-ttu-id="107a6-160">Les ordinateurs clients de tailles différentes limitent la bande passante du réseau qu’ils peuvent utiliser.</span><span class="sxs-lookup"><span data-stu-id="107a6-160">Different sized client machines have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="107a6-161">Si le client dépasse la bande passante disponible, les données ne sont pas traitées côté client aussi rapidement que le serveur les envoie.</span><span class="sxs-lookup"><span data-stu-id="107a6-161">If the client exceeds the available bandwidth, then data will not be processed on the client side as quickly as the server is sending it.</span></span> <span data-ttu-id="107a6-162">Cette situation peut entraîner des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-162">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-163">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-163">Measurement</span></span>
<span data-ttu-id="107a6-164">Surveillez comment votre utilisation de la bande passante évolue au fil du temps, à l’aide d’un code [tel que celui-ci](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span><span class="sxs-lookup"><span data-stu-id="107a6-164">Monitor how your Bandwidth usage change over time using code [like this](https://github.com/JonCole/SampleCode/blob/master/BandWidthMonitor/BandwidthLogger.cs).</span></span> <span data-ttu-id="107a6-165">Notez que ce code peut ne pas s’exécuter correctement dans certains environnements aux autorisations restreintes (tels que les sites web Azure).</span><span class="sxs-lookup"><span data-stu-id="107a6-165">Note that this code may not run successfully in some environments with restricted permissions (like Azure web sites).</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-166">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-166">Resolution</span></span>
<span data-ttu-id="107a6-167">Augmentez la taille de la machine mémoire du client ou réduisez la consommation de la bande passante du réseau.</span><span class="sxs-lookup"><span data-stu-id="107a6-167">Increase Client VM size or reduce network bandwidth consumption.</span></span>

### <a name="large-requestresponse-size"></a><span data-ttu-id="107a6-168">Taille importante de la demande/réponse</span><span class="sxs-lookup"><span data-stu-id="107a6-168">Large Request/Response Size</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-169">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-169">Problem</span></span>
<span data-ttu-id="107a6-170">Une demande/réponse volumineuse peut entraîner des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-170">A large request/response can cause timeouts.</span></span> <span data-ttu-id="107a6-171">Par exemple, supposons que la durée du délai d’expiration que vous avez configurée sur votre client est de 1 seconde.</span><span class="sxs-lookup"><span data-stu-id="107a6-171">As an example, Suppose your timeout value configured on your client is 1 second.</span></span> <span data-ttu-id="107a6-172">Votre application demande deux clés (par exemple, « A » et « B ») en même temps (à l’aide de la même connexion réseau physique).</span><span class="sxs-lookup"><span data-stu-id="107a6-172">Your application requests two keys (e.g. 'A' and 'B') at the same time (using the same physical network connection).</span></span> <span data-ttu-id="107a6-173">La plupart des clients prennent en charge le traitement en « pipeline » des demandes, de sorte que les deux demandes A et B sont envoyées l’une après l’autre au serveur sans attendre les réponses.</span><span class="sxs-lookup"><span data-stu-id="107a6-173">Most clients support "Pipelining" of requests, such that both requests 'A' and 'B' are sent on the wire to the server one after the other without waiting for the responses.</span></span> <span data-ttu-id="107a6-174">Le serveur renvoie les réponses dans le même ordre.</span><span class="sxs-lookup"><span data-stu-id="107a6-174">The server will send the responses back in the same order.</span></span> <span data-ttu-id="107a6-175">Si la réponse A est suffisamment volumineuse, elle peut saturer la majeure partie du délai d’expiration des demandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="107a6-175">If response 'A' is large enough it can eat up most of the timeout for subsequent requests.</span></span> 

<span data-ttu-id="107a6-176">L’exemple suivant illustre ce cas de figure.</span><span class="sxs-lookup"><span data-stu-id="107a6-176">The following example demonstrates this scenario.</span></span> <span data-ttu-id="107a6-177">Dans ce scénario, les demandes A et B sont envoyées rapidement, le serveur commence à renvoyer rapidement les réponses A et B, mais en raison du temps de transfert des données, la réponse B reste coincée derrière la réponse A et expire même si le serveur a répondu rapidement.</span><span class="sxs-lookup"><span data-stu-id="107a6-177">In this scenario, Request 'A' and 'B' are sent quickly, the server starts sending responses 'A' and 'B' quickly, but because of data transfer times, 'B' get stuck behind the other request and times out even though the server responded quickly.</span></span>

    |-------- 1 Second Timeout (A)----------|
    |-Request A-|
         |-------- 1 Second Timeout (B) ----------|
         |-Request B-|
                |- Read Response A --------|
                                           |- Read Response B-| (**TIMEOUT**)



#### <a name="measurement"></a><span data-ttu-id="107a6-178">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-178">Measurement</span></span>
<span data-ttu-id="107a6-179">C’est une valeur difficile à mesurer.</span><span class="sxs-lookup"><span data-stu-id="107a6-179">This is a difficult one to measure.</span></span> <span data-ttu-id="107a6-180">Vous devez adapter votre code client pour suivre les requêtes et réponses volumineuses.</span><span class="sxs-lookup"><span data-stu-id="107a6-180">You basically have to instrument your client code to track large requests and responses.</span></span> 

#### <a name="resolution"></a><span data-ttu-id="107a6-181">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-181">Resolution</span></span>
1. <span data-ttu-id="107a6-182">Redis est optimisé pour un grand nombre de petites valeurs plutôt que pour quelques grandes valeurs.</span><span class="sxs-lookup"><span data-stu-id="107a6-182">Redis is optimized for a large number of small values, rather than a few large values.</span></span> <span data-ttu-id="107a6-183">La meilleure solution consiste à diviser vos données en valeurs plus petites.</span><span class="sxs-lookup"><span data-stu-id="107a6-183">The preferred solution is to break up your data into related smaller values.</span></span> <span data-ttu-id="107a6-184">Lisez le billet [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) pour savoir pourquoi les valeurs moins élevées sont recommandées.</span><span class="sxs-lookup"><span data-stu-id="107a6-184">See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details around why smaller values are recommended.</span></span>
2. <span data-ttu-id="107a6-185">Augmentez la taille de votre machine virtuelle (pour le client et le serveur de cache Redis) afin d’obtenir une bande passante plus élevée et ainsi de réduire le temps de transfert des réponses volumineuses.</span><span class="sxs-lookup"><span data-stu-id="107a6-185">Increase the size of your VM (for client and Redis Cache Server), to get higher bandwidth capabilities, reducing data transfer times for larger responses.</span></span> <span data-ttu-id="107a6-186">Notez que l’obtention d’une bande passante supérieure uniquement sur le serveur ou sur le client peut ne pas suffire.</span><span class="sxs-lookup"><span data-stu-id="107a6-186">Note that getting more bandwidth on just the server or just on the client may not be enough.</span></span> <span data-ttu-id="107a6-187">Mesurez votre utilisation de la bande passante et comparez-la aux capacités de la taille de votre machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="107a6-187">Measure your bandwidth usage and compare it to the capabilities of the size of VM you currently have.</span></span>
3. <span data-ttu-id="107a6-188">Augmentez le nombre d’objets `ConnectionMultiplexer` utilisés et traitez les demandes en tourniquet sur différentes connexions.</span><span class="sxs-lookup"><span data-stu-id="107a6-188">Increase the number of `ConnectionMultiplexer` objects you use and round-robin requests over different connections.</span></span>

### <a name="what-happened-to-my-data-in-redis"></a><span data-ttu-id="107a6-189">Qu’est-il arrivé à mes données dans Redis ?</span><span class="sxs-lookup"><span data-stu-id="107a6-189">What happened to my data in Redis?</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-190">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-190">Problem</span></span>
<span data-ttu-id="107a6-191">Je m’attendais à trouver certaines données dans mon instance du cache Redis Azure, mais elles semblent absentes.</span><span class="sxs-lookup"><span data-stu-id="107a6-191">I expected for certain data to be in my Azure Redis Cache instance but it didn't seem to be there.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-192">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-192">Resolution</span></span>
<span data-ttu-id="107a6-193">Consultez la page [What happened to my data in Redis?](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) pour identifier les causes et solutions possibles.</span><span class="sxs-lookup"><span data-stu-id="107a6-193">See [What happened to my data in Redis?](https://gist.github.com/JonCole/b6354d92a2d51c141490f10142884ea4#file-whathappenedtomydatainredis-md) for possible causes and resolutions.</span></span>

## <a name="server-side-troubleshooting"></a><span data-ttu-id="107a6-194">Résolution des problèmes côté serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-194">Server side troubleshooting</span></span>
<span data-ttu-id="107a6-195">Cette section traite des problèmes qui surviennent en raison d’un souci sur le serveur du cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-195">This section discusses troubleshooting issues that occur because of a condition on the cache server.</span></span>

* [<span data-ttu-id="107a6-196">Saturation de la mémoire sur le serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-196">Memory Pressure on the server</span></span>](#memory-pressure-on-the-server)
* [<span data-ttu-id="107a6-197">Utilisation élevée du processeur / charge importante du serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-197">High CPU usage / Server Load</span></span>](#high-cpu-usage-server-load)
* [<span data-ttu-id="107a6-198">Bande passante dépassée côté serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-198">Server Side Bandwidth Exceeded</span></span>](#server-side-bandwidth-exceeded)

### <a name="memory-pressure-on-the-server"></a><span data-ttu-id="107a6-199">Saturation de la mémoire sur le serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-199">Memory Pressure on the server</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-200">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-200">Problem</span></span>
<span data-ttu-id="107a6-201">La saturation de la mémoire sur le serveur génère toutes sortes de problèmes de performance susceptibles de retarder le traitement des demandes.</span><span class="sxs-lookup"><span data-stu-id="107a6-201">Memory pressure on the server side leads to all kinds of performance problems that can delay processing of requests.</span></span> <span data-ttu-id="107a6-202">En cas de saturation de la mémoire, le système doit généralement paginer les données de la mémoire physique dans la mémoire virtuelle située sur le disque.</span><span class="sxs-lookup"><span data-stu-id="107a6-202">When memory pressure hits, the system typically has to page data from physical memory to virtual memory which is on disk.</span></span> <span data-ttu-id="107a6-203">Cette *pagination* ralentit considérablement le système.</span><span class="sxs-lookup"><span data-stu-id="107a6-203">This *page faulting* causes the system to slow down significantly.</span></span> <span data-ttu-id="107a6-204">Plusieurs causes peuvent être à l’origine de cette saturation de la mémoire :</span><span class="sxs-lookup"><span data-stu-id="107a6-204">There are several possible causes of this memory pressure:</span></span> 

1. <span data-ttu-id="107a6-205">Le cache de données est saturé.</span><span class="sxs-lookup"><span data-stu-id="107a6-205">You have filled the cache to full capacity with data.</span></span> 
2. <span data-ttu-id="107a6-206">Redis constate une fragmentation importante de la mémoire, le plus souvent provoquée par le stockage d’objets volumineux. Redis est optimisé pour les petits objets. Pour en savoir plus, consultez le billet [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ).</span><span class="sxs-lookup"><span data-stu-id="107a6-206">Redis is seeing high memory fragmentation - most often caused by storing large objects (Redis is optimized for a small objects - See the [What is the ideal value size range for redis? Is 100KB too large?](https://groups.google.com/forum/#!searchin/redis-db/size/redis-db/n7aa2A4DZDs/3OeEPHSQBAAJ) post for details).</span></span> 

#### <a name="measurement"></a><span data-ttu-id="107a6-207">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-207">Measurement</span></span>
<span data-ttu-id="107a6-208">Redis fournit deux mesures qui peuvent vous aider à identifier ce problème.</span><span class="sxs-lookup"><span data-stu-id="107a6-208">Redis exposes two metrics that can help you identify this issue.</span></span> <span data-ttu-id="107a6-209">Il s’agit de `used_memory` et de `used_memory_rss`.</span><span class="sxs-lookup"><span data-stu-id="107a6-209">The first is `used_memory` and the other is `used_memory_rss`.</span></span> <span data-ttu-id="107a6-210">[Ces mesures](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) sont disponibles dans le portail Azure ou via la commande [Redis INFO](http://redis.io/commands/info).</span><span class="sxs-lookup"><span data-stu-id="107a6-210">[These metrics](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) are available in the Azure Portal or through the [Redis INFO](http://redis.io/commands/info) command.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-211">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-211">Resolution</span></span>
<span data-ttu-id="107a6-212">Vous pouvez apporter plusieurs modifications pour maintenir une utilisation correcte de la mémoire :</span><span class="sxs-lookup"><span data-stu-id="107a6-212">There are several possible changes that you can make to help keep memory usage healthy:</span></span>

1. <span data-ttu-id="107a6-213">[Configurez une stratégie de mémoire](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) et définissez des délais d’expiration sur vos clés.</span><span class="sxs-lookup"><span data-stu-id="107a6-213">[Configure a memory policy](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) and set expiration times on your keys.</span></span> <span data-ttu-id="107a6-214">Sachez que cela peut ne pas suffire si vous constatez une fragmentation.</span><span class="sxs-lookup"><span data-stu-id="107a6-214">Note that this may not be sufficient if you have fragmentation.</span></span>
2. <span data-ttu-id="107a6-215">[Configurez une valeur maxmemory-reserved](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) suffisamment grande pour compenser la fragmentation de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="107a6-215">[Configure a maxmemory-reserved value](cache-configure.md#maxmemory-policy-and-maxmemory-reserved) that is large enough to compensate for memory fragmentation.</span></span>
3. <span data-ttu-id="107a6-216">Divisez vos objets volumineux mis en cache en objets plus petits.</span><span class="sxs-lookup"><span data-stu-id="107a6-216">Break up your large cached objects into smaller related objects.</span></span>
4. <span data-ttu-id="107a6-217">[mise à l’échelle](cache-how-to-scale.md) pour augmenter la taille du cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-217">[Scale](cache-how-to-scale.md) to a larger cache size.</span></span>
5. <span data-ttu-id="107a6-218">Si vous utilisez un [cache premium avec cluster Redis activé](cache-how-to-premium-clustering.md), vous pouvez [augmenter le nombre de partitions](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span><span class="sxs-lookup"><span data-stu-id="107a6-218">If you are using a [premium cache with Redis cluster enabled](cache-how-to-premium-clustering.md) you can [increase the number of shards](cache-how-to-premium-clustering.md#change-the-cluster-size-on-a-running-premium-cache).</span></span>

### <a name="high-cpu-usage--server-load"></a><span data-ttu-id="107a6-219">Utilisation élevée du processeur / charge importante du serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-219">High CPU usage / Server Load</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-220">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-220">Problem</span></span>
<span data-ttu-id="107a6-221">En cas d’utilisation élevée du processeur, le client risque de ne pas pouvoir traiter une réponse de Redis dans les délais, même si Redis a renvoyé la réponse très rapidement.</span><span class="sxs-lookup"><span data-stu-id="107a6-221">High CPU usage can mean that the client side can fail to process a response from Redis in a timely fashion even though Redis sent the response very quickly.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-222">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-222">Measurement</span></span>
<span data-ttu-id="107a6-223">Surveillez l’utilisation du processeur par tout le système dans le portail Azure ou à l’aide du compteur de performances associé.</span><span class="sxs-lookup"><span data-stu-id="107a6-223">Monitor the System Wide CPU usage through the Azure Portal or through the associated performance counter.</span></span> <span data-ttu-id="107a6-224">Ne tenez pas compte du processeur de *processus* , car un processus peut utiliser faiblement le processeur pendant que le processeur système est fortement sollicité.</span><span class="sxs-lookup"><span data-stu-id="107a6-224">Be careful not to monitor *process* CPU because a single process can have low CPU usage at the same time that overall system CPU can be high.</span></span> <span data-ttu-id="107a6-225">Regardez les pics d’utilisation du processeur qui correspondent à des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-225">Watch for spikes in CPU usage that correspond with timeouts.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-226">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-226">Resolution</span></span>
<span data-ttu-id="107a6-227">[mise à l’échelle](cache-how-to-scale.md) vers une plus grande taille de cache avec davantage de capacités processeur ou recherchez la cause des pics d’utilisation du processeur.</span><span class="sxs-lookup"><span data-stu-id="107a6-227">[Scale](cache-how-to-scale.md) to a larger cache tier with more CPU capacity or investigate what is causing CPU spikes.</span></span> 

### <a name="server-side-bandwidth-exceeded"></a><span data-ttu-id="107a6-228">Bande passante dépassée côté serveur</span><span class="sxs-lookup"><span data-stu-id="107a6-228">Server Side Bandwidth Exceeded</span></span>
#### <a name="problem"></a><span data-ttu-id="107a6-229">Problème</span><span class="sxs-lookup"><span data-stu-id="107a6-229">Problem</span></span>
<span data-ttu-id="107a6-230">Les instances de cache de différentes tailles limitent la bande passante du réseau qu’ils peuvent utiliser.</span><span class="sxs-lookup"><span data-stu-id="107a6-230">Different sized cache instances have limitations on how much network bandwidth they have available.</span></span> <span data-ttu-id="107a6-231">Si le serveur dépasse la bande passante disponible, les données ne sont pas envoyées au client aussi rapidement.</span><span class="sxs-lookup"><span data-stu-id="107a6-231">If the server exceeds the available bandwidth, then data will not be sent to the client as quickly.</span></span> <span data-ttu-id="107a6-232">Cette situation peut entraîner des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-232">This can lead to timeouts.</span></span>

#### <a name="measurement"></a><span data-ttu-id="107a6-233">Mesure</span><span class="sxs-lookup"><span data-stu-id="107a6-233">Measurement</span></span>
<span data-ttu-id="107a6-234">Vous pouvez surveiller la mesure `Cache Read` , qui évalue la quantité de données lues dans le cache en mégaoctets par seconde (Mo/s) pendant l’intervalle de création de rapport.</span><span class="sxs-lookup"><span data-stu-id="107a6-234">You can monitor the `Cache Read` metric, which is the amount of data read from the cache in Megabytes per second (MB/s) during the specified reporting interval.</span></span> <span data-ttu-id="107a6-235">Cette valeur correspond à la bande passante réseau utilisée par ce cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-235">This value corresponds to the network bandwidth used by this cache.</span></span> <span data-ttu-id="107a6-236">Si vous souhaitez configurer des alertes pour des limites de bande passante réseau côté serveur, vous pouvez les créer à l’aide du compteur `Cache Read` .</span><span class="sxs-lookup"><span data-stu-id="107a6-236">If you want to set up alerts for server side network bandwidth limits, you can create them using this `Cache Read` counter.</span></span> <span data-ttu-id="107a6-237">Comparez vos relevés aux valeurs indiquées dans [ce tableau](cache-faq.md#cache-performance) afin de connaître les limites de bande passante observées pour plusieurs tailles et niveaux de tarification du cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-237">Compare your readings with the values in [this table](cache-faq.md#cache-performance) for the observed bandwidth limits for various cache pricing tiers and sizes.</span></span>

#### <a name="resolution"></a><span data-ttu-id="107a6-238">Résolution :</span><span class="sxs-lookup"><span data-stu-id="107a6-238">Resolution</span></span>
<span data-ttu-id="107a6-239">Si vous êtes constamment près de la bande passante maximale observée pour votre taille et votre niveau de tarification de cache, envisagez une [mise à l’échelle](cache-how-to-scale.md) vers une taille ou un niveau de tarification offrant une bande passante réseau supérieure, en utilisant les valeurs de [ce tableau](cache-faq.md#cache-performance) comme guide.</span><span class="sxs-lookup"><span data-stu-id="107a6-239">If you are consistently near the observed maximum bandwidth for your pricing tier and cache size, consider [scaling](cache-how-to-scale.md) to a pricing tier or size that has greater network bandwidth, using the values in [this table](cache-faq.md#cache-performance) as a guide.</span></span>

## <a name="stackexchangeredis-timeout-exceptions"></a><span data-ttu-id="107a6-240">Exceptions au délai d’expiration de StackExchange.Redis</span><span class="sxs-lookup"><span data-stu-id="107a6-240">StackExchange.Redis timeout exceptions</span></span>
<span data-ttu-id="107a6-241">Pour les opérations synchrones, StackExchange.Redis utilise un paramètre de configuration appelé `synctimeout`, qui a une valeur par défaut de 1000 ms.</span><span class="sxs-lookup"><span data-stu-id="107a6-241">StackExchange.Redis uses a configuration setting named `synctimeout` for synchronous operations which has a default value  of 1000 ms.</span></span> <span data-ttu-id="107a6-242">Si un appel synchrone ne se termine pas dans le délai imparti, le client StackExchange.Redis génère une erreur de délai d’expiration similaire à l’exemple suivant.</span><span class="sxs-lookup"><span data-stu-id="107a6-242">If a synchronous call doesn’t complete in the stipulated time, the StackExchange.Redis client throws a timeout error similar to the following example.</span></span>

    System.TimeoutException: Timeout performing MGET 2728cc84-58ae-406b-8ec8-3f962419f641, inst: 1,mgr: Inactive, queue: 73, qu=6, qs=67, qc=0, wr=1/1, in=0/0 IOCP: (Busy=6, Free=999, Min=2,Max=1000), WORKER (Busy=7,Free=8184,Min=2,Max=8191)


<span data-ttu-id="107a6-243">Ce message d’erreur contient des mesures qui peuvent vous aider à identifier la cause du problème et à en trouver la solution.</span><span class="sxs-lookup"><span data-stu-id="107a6-243">This error message contains metrics that can help point you to the cause and possible resolution of the issue.</span></span> <span data-ttu-id="107a6-244">Le tableau suivant contient des détails sur les mesures des messages d’erreur.</span><span class="sxs-lookup"><span data-stu-id="107a6-244">The following table contains details about the error message metrics.</span></span>

| <span data-ttu-id="107a6-245">Mesure de message d’erreur</span><span class="sxs-lookup"><span data-stu-id="107a6-245">Error message metric</span></span> | <span data-ttu-id="107a6-246">Détails</span><span class="sxs-lookup"><span data-stu-id="107a6-246">Details</span></span> |
| --- | --- |
| <span data-ttu-id="107a6-247">inst</span><span class="sxs-lookup"><span data-stu-id="107a6-247">inst</span></span> |<span data-ttu-id="107a6-248">Dans le dernier intervalle de temps, aucune commande n’a été émise.</span><span class="sxs-lookup"><span data-stu-id="107a6-248">In the last time slice: 0 commands have been issued</span></span> |
| <span data-ttu-id="107a6-249">mgr</span><span class="sxs-lookup"><span data-stu-id="107a6-249">mgr</span></span> |<span data-ttu-id="107a6-250">Le gestionnaire de socket exécute `socket.select`, c’est-à-dire qu’il demande au système d’exploitation de lui désigner un socket occupé. En fait, le lecteur n’effectue aucune lecture active sur le réseau, car il pense qu’il n’y a rien à faire.</span><span class="sxs-lookup"><span data-stu-id="107a6-250">The socket manager is performing `socket.select` which means it is asking the OS to indicate a socket that has something to do; basically: the reader is not actively reading from the network because it doesn't think there is anything to do</span></span> |
| <span data-ttu-id="107a6-251">file d'attente</span><span class="sxs-lookup"><span data-stu-id="107a6-251">queue</span></span> |<span data-ttu-id="107a6-252">73 opérations sont en cours.</span><span class="sxs-lookup"><span data-stu-id="107a6-252">There are 73 total in-progress operations</span></span> |
| <span data-ttu-id="107a6-253">qu</span><span class="sxs-lookup"><span data-stu-id="107a6-253">qu</span></span> |<span data-ttu-id="107a6-254">6 des opérations en cours sont dans en file d’attente et n’ont pas encore été envoyées au réseau sortant.</span><span class="sxs-lookup"><span data-stu-id="107a6-254">6 of the in-progress operations are in the unsent queue and have not yet been written to the outbound network</span></span> |
| <span data-ttu-id="107a6-255">qs</span><span class="sxs-lookup"><span data-stu-id="107a6-255">qs</span></span> |<span data-ttu-id="107a6-256">67 des opérations en cours ont été envoyées au serveur, mais aucune réponse n’est disponible.</span><span class="sxs-lookup"><span data-stu-id="107a6-256">67 of he in-progress operations have been sent to the server but a response is not yet available.</span></span> <span data-ttu-id="107a6-257">La réponse peut être `Not yet sent by the server` ou `sent by the server but not yet processed by the client.`.</span><span class="sxs-lookup"><span data-stu-id="107a6-257">The response could be `Not yet sent by the server` or `sent by the server but not yet processed by the client.`</span></span> |
| <span data-ttu-id="107a6-258">qc</span><span class="sxs-lookup"><span data-stu-id="107a6-258">qc</span></span> |<span data-ttu-id="107a6-259">Aucune des opérations en cours n’a reçu de réponse, mais elles sont marquées comme terminées en raison de leur attente dans la boucle d’exécution.</span><span class="sxs-lookup"><span data-stu-id="107a6-259">0 of the in-progress operations have seen replies but have not yet been marked as complete due to waiting on the completion loop</span></span> |
| <span data-ttu-id="107a6-260">wr</span><span class="sxs-lookup"><span data-stu-id="107a6-260">wr</span></span> |<span data-ttu-id="107a6-261">Un enregistreur est actif (ce qui signifie que les 6 demandes en attente ne sont pas ignorées) octets/enregistreurs actifs</span><span class="sxs-lookup"><span data-stu-id="107a6-261">There is an active writer (meaning the 6 unsent requests are not being ignored) bytes/activewriters</span></span> |
| <span data-ttu-id="107a6-262">commencer</span><span class="sxs-lookup"><span data-stu-id="107a6-262">in</span></span> |<span data-ttu-id="107a6-263">Aucun lecteur n’est actif et aucun octet n’est disponible en lecture sur la carte réseau octets/lecteurs actifs</span><span class="sxs-lookup"><span data-stu-id="107a6-263">There are no active readers and zero bytes are available to be read on the NIC bytes/activereaders</span></span> |

### <a name="steps-to-investigate"></a><span data-ttu-id="107a6-264">Procédure d’analyse</span><span class="sxs-lookup"><span data-stu-id="107a6-264">Steps to investigate</span></span>
1. <span data-ttu-id="107a6-265">Il est recommandé de suivre la procédure ci-dessous pour se connecter, en cas d’utilisation du client StackExchange.Redis.</span><span class="sxs-lookup"><span data-stu-id="107a6-265">As a best practice make sure you are using the following pattern to connect when using the StackExchange.Redis client.</span></span>

    ```c#
    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...");
    
    });
    
    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }
    ````

    <span data-ttu-id="107a6-266">Pour plus d’informations, consultez [Utilisation du Cache Redis Azure](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span><span class="sxs-lookup"><span data-stu-id="107a6-266">For more information, see [Connect to the cache using StackExchange.Redis](cache-dotnet-how-to-use-azure-redis-cache.md#connect-to-the-cache).</span></span>

1. <span data-ttu-id="107a6-267">Vérifiez que votre Cache Redis Azure et l’application cliente sont dans la même région dans Azure.</span><span class="sxs-lookup"><span data-stu-id="107a6-267">Ensure that your Azure Redis Cache and the client application are in the same region in Azure.</span></span> <span data-ttu-id="107a6-268">Par exemple, vous pouvez rencontrer des délais d’expiration lorsque votre cache est dans la région Est des États-Unis, que le client se trouve dans l’Ouest des États-Unis et que la demande n’est pas traitée pendant l’intervalle `synctimeout`. Vous pouvez également rencontrer des délais d’expiration lorsque vous procédez à un débogage à partir de votre ordinateur de développement local.</span><span class="sxs-lookup"><span data-stu-id="107a6-268">For example, you might be getting timeouts when your cache is in East US but the client is in West US and the request doesn't complete within the `synctimeout` interval or you might be getting timeouts when you are debugging from your local development machine.</span></span> 
   
    <span data-ttu-id="107a6-269">Il est vivement recommandé de placer le cache et le client dans la même région Azure.</span><span class="sxs-lookup"><span data-stu-id="107a6-269">It’s highly recommended to have the cache and in the client in the same Azure region.</span></span> <span data-ttu-id="107a6-270">Si votre implémentation nécessite des appels interrégionaux, vous devez régler l’intervalle `synctimeout` sur une valeur supérieure à la valeur par défaut (1 000 ms), en incluant une propriété `synctimeout` dans la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="107a6-270">If you have a scenario that includes cross region calls, you should set the `synctimeout` interval to a value higher than the default 1000 ms interval by including a `synctimeout` property in the connection string.</span></span> <span data-ttu-id="107a6-271">L’exemple suivant montre un extrait de chaîne de connexion au cache StackExchange.Redis avec une valeur de 2 000 ms pour `synctimeout` .</span><span class="sxs-lookup"><span data-stu-id="107a6-271">The following example shows a StackExchange.Redis cache connection string snippet with a `synctimeout` of 2000 ms.</span></span>
   
        synctimeout=2000,cachename.redis.cache.windows.net,abortConnect=false,ssl=true,password=...
2. <span data-ttu-id="107a6-272">Vérifiez que vous utilisez la dernière version en date du [package NuGet StackExchange.Redis](https://www.nuget.org/packages/StackExchange.Redis/).</span><span class="sxs-lookup"><span data-stu-id="107a6-272">Ensure you using the latest version of the [StackExchange.Redis NuGet package](https://www.nuget.org/packages/StackExchange.Redis/).</span></span> <span data-ttu-id="107a6-273">Nous corrigeons en permanence le code pour le rendre plus robuste aux délais d’expiration. Il est donc primordial d’utiliser la dernière version.</span><span class="sxs-lookup"><span data-stu-id="107a6-273">There are bugs constantly being fixed in the code to make it more robust to timeouts so having the latest version is important.</span></span>
3. <span data-ttu-id="107a6-274">Si des demandes sont impactées par les limitations de bande passante sur le serveur ou le client, leur traitement prend davantage de temps, ce qui entraîne des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-274">If there are requests that are getting bound by bandwidth limitations on the server or client, it will take longer for them to complete and thereby cause timeouts.</span></span> <span data-ttu-id="107a6-275">Pour voir si le délai d’expiration est dû à la bande passante réseau sur le serveur, consultez [Bande passante dépassée côté serveur](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="107a6-275">To see if your timeout is due to network bandwidth on the server, see [Server side bandwidth exceeded](#server-side-bandwidth-exceeded).</span></span> <span data-ttu-id="107a6-276">Pour voir si le délai d’expiration est dû à la bande passante réseau sur le client, consultez [Bande passante dépassée côté client](#client-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="107a6-276">To see if your timeout is due to client network bandwidth, see [Client side bandwidth exceeded](#client-side-bandwidth-exceeded).</span></span>
4. <span data-ttu-id="107a6-277">Constatez-vous une utilisation intensive du processeur sur le serveur ou sur le client ?</span><span class="sxs-lookup"><span data-stu-id="107a6-277">Are you getting CPU bound on the server or on the client?</span></span>
   
   * <span data-ttu-id="107a6-278">Vérifiez si vous constatez une utilisation intensive du processeur sur votre client, qui pourrait empêcher le traitement de la demande pendant l’intervalle `synctimeout` , entraînant un délai d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-278">Check if you are getting bound by CPU on your client which could cause the request to not be processed within the `synctimeout` interval, thus causing a timeout.</span></span> <span data-ttu-id="107a6-279">Augmentez la taille de votre client ou répartissez la charge pour résoudre ce problème.</span><span class="sxs-lookup"><span data-stu-id="107a6-279">Moving to a larger client size or distributing the load can help to control this.</span></span> 
   * <span data-ttu-id="107a6-280">Vérifiez si vous constatez une utilisation intensive du processeur sur votre serveur, à l’aide de la `CPU` [mesure de performance du cache](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span><span class="sxs-lookup"><span data-stu-id="107a6-280">Check if you are getting CPU bound on the server by monitoring the `CPU` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="107a6-281">L’entrée de demandes pendant que Redis utilise intensivement le processeur peut entraîner une expiration du traitement des demandes.</span><span class="sxs-lookup"><span data-stu-id="107a6-281">Requests coming in while Redis is CPU bound can cause those requests to timeout.</span></span> <span data-ttu-id="107a6-282">Pour résoudre ce problème, vous pouvez répartir la charge sur plusieurs partitions dans un cache premium, ou effectuer une mise à niveau vers une taille ou un niveau de tarification supérieur.</span><span class="sxs-lookup"><span data-stu-id="107a6-282">To address this you can distribute the load across multiple shards in a premium cache, or upgrade to a larger size or pricing tier.</span></span> <span data-ttu-id="107a6-283">Pour plus d’informations, consultez [Bande passante dépassée côté serveur](#server-side-bandwidth-exceeded).</span><span class="sxs-lookup"><span data-stu-id="107a6-283">For more information, see [Server Side Bandwidth Exceeded](#server-side-bandwidth-exceeded).</span></span>
5. <span data-ttu-id="107a6-284">Le traitement de certaines commandes est-il trop long sur le serveur ?</span><span class="sxs-lookup"><span data-stu-id="107a6-284">Are there commands taking long time to process on the server?</span></span> <span data-ttu-id="107a6-285">Les commandes qui prennent beaucoup de temps sur le serveur redis peuvent entraîner des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-285">Long running commands that are taking long time to process on the redis-server can cause timeouts.</span></span> <span data-ttu-id="107a6-286">Les commandes `mget` avec un nombre important de clés, `keys *` ou des scripts mal rédigés prennent notamment beaucoup de temps pour s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="107a6-286">Some examples of long running commands are `mget` with large numbers of keys, `keys *` or poorly written lua scripts.</span></span> <span data-ttu-id="107a6-287">Vous pouvez vous connecter à votre instance de cache Redis Azure à l’aide du client redis-cli, ou utiliser la [Console Redis](cache-configure.md#redis-console) et exécuter la commande [SlowLog](http://redis.io/commands/slowlog) pour identifier les demandes prenant davantage de temps que prévu.</span><span class="sxs-lookup"><span data-stu-id="107a6-287">You can connect to your Azure Redis Cache instance using the redis-cli client or use the [Redis Console](cache-configure.md#redis-console) and run the [SlowLog](http://redis.io/commands/slowlog) command to see if there are requests taking longer than expected.</span></span> <span data-ttu-id="107a6-288">Le serveur Redis et StackExchange.Redis sont optimisés pour traiter un grand nombre de petites requêtes plutôt qu’un nombre réduit de demandes volumineuses.</span><span class="sxs-lookup"><span data-stu-id="107a6-288">Redis Server and StackExchange.Redis are optimized for many small requests rather than fewer large requests.</span></span> <span data-ttu-id="107a6-289">Fractionner vos données en segments plus petits peut améliorer les choses.</span><span class="sxs-lookup"><span data-stu-id="107a6-289">Splitting your data into smaller chunks may improve things here.</span></span> 
   
    <span data-ttu-id="107a6-290">Pour plus d’informations sur la connexion au point de terminaison SSL du cache Redis Azure à l’aide de redis-cli et de stunnel, consultez le billet de blog [Announcing ASP.NET Session State Provider for Redis Preview Release](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) .</span><span class="sxs-lookup"><span data-stu-id="107a6-290">For information on connecting to the Azure Redis Cache SSL endpoint using redis-cli and stunnel, see the [Announcing ASP.NET Session State Provider for Redis Preview Release](http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx) blog post.</span></span> <span data-ttu-id="107a6-291">Pour plus d’informations, consultez [SlowLog](http://redis.io/commands/slowlog).</span><span class="sxs-lookup"><span data-stu-id="107a6-291">For more information, see [SlowLog](http://redis.io/commands/slowlog).</span></span>
6. <span data-ttu-id="107a6-292">Une charge élevée du serveur Redis peut provoquer des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-292">High Redis server load can cause timeouts.</span></span> <span data-ttu-id="107a6-293">Vous pouvez surveiller la charge du serveur à l’aide de la `Redis Server Load` [mesure des performances du cache](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span><span class="sxs-lookup"><span data-stu-id="107a6-293">You can monitor the server load by monitoring the `Redis Server Load` [cache performance metric](cache-how-to-monitor.md#available-metrics-and-reporting-intervals).</span></span> <span data-ttu-id="107a6-294">Une charge serveur de 100 (valeur maximale) signifie que le serveur redis a été occupé à plein temps à traiter des demandes.</span><span class="sxs-lookup"><span data-stu-id="107a6-294">A server load of 100 (maximum value) signifies that the redis server has been busy, with no idle time, processing requests.</span></span> <span data-ttu-id="107a6-295">Pour voir si certaines demandes monopolisent les capacités du serveur, exécutez la commande SlowLog comme indiqué dans le paragraphe précédent.</span><span class="sxs-lookup"><span data-stu-id="107a6-295">To see if certain requests are taking up all of the server capability, run the SlowLog command, as described in the previous paragraph.</span></span> <span data-ttu-id="107a6-296">Pour plus d’informations, consultez [Utilisation élevée du processeur / charge importante du serveur](#high-cpu-usage-server-load).</span><span class="sxs-lookup"><span data-stu-id="107a6-296">For more information, see [High CPU usage / Server Load](#high-cpu-usage-server-load).</span></span>
7. <span data-ttu-id="107a6-297">Un autre événement côté client a-t-il pu causer un blocage du réseau ?</span><span class="sxs-lookup"><span data-stu-id="107a6-297">Was there any other event on the client side that could have caused a network blip?</span></span> <span data-ttu-id="107a6-298">Sur le client (web, rôle de travail ou MV Iaas), vérifiez si un événement comme la mise à l’échelle du nombre d’instances du client, le déploiement d’une nouvelle version du client ou l’activation de la mise à l’échelle automatique, est présent.Lors de notre test, nous avons constaté que la mise à l’échelle automatique, l’augmentation ou la réduction de la taille des instances peut entraîner la perte de la connexion au réseau pendant plusieurs secondes.</span><span class="sxs-lookup"><span data-stu-id="107a6-298">Check on the client (web, worker role or an Iaas VM) if there was an event like scaling the number of client instances up or down, or deploying a new version of the client or auto-scale is enabled?In our testing we have found that autoscale or scaling up/down can cause outbound network connectivity can be lost for several seconds.</span></span> <span data-ttu-id="107a6-299">Le code de StackExchange.Redis résiste à de tels événements et rétablit la connexion.</span><span class="sxs-lookup"><span data-stu-id="107a6-299">StackExchange.Redis code is resilient to such events and will reconnect.</span></span> <span data-ttu-id="107a6-300">Pendant ce temps de reconnexion, toutes les demandes dans la file d’attente peuvent expirer.</span><span class="sxs-lookup"><span data-stu-id="107a6-300">During this time of re-connection any requests in the queue can time out.</span></span>
8. <span data-ttu-id="107a6-301">Une demande volumineuse précédant plusieurs petites demandes dans le cache Redis a-t-elle pu voir son délai expirer ?</span><span class="sxs-lookup"><span data-stu-id="107a6-301">Was there a big request preceding several small requests to the Redis Cache that timed out?</span></span> <span data-ttu-id="107a6-302">Le paramètre `qs` du message d’erreur vous indique le nombre de requêtes envoyées du client au serveur, mais qui n’ont pas encore traité une réponse.</span><span class="sxs-lookup"><span data-stu-id="107a6-302">The parameter `qs` in the error message tells you how many requests were sent from the client to the server, but have not yet processed a response.</span></span> <span data-ttu-id="107a6-303">Cette valeur peut continuer d’augmenter car StackExchange.Redis utilise une seule connexion TCP et ne peut lire qu’une réponse à la fois.</span><span class="sxs-lookup"><span data-stu-id="107a6-303">This value can keep growing because StackExchange.Redis uses a single TCP connection and can only read one response at a time.</span></span> <span data-ttu-id="107a6-304">L’expiration de la première opération n’empêche pas l’échange des données avec le serveur, et les autres demandes sont bloquées jusqu’à ce que la première soit terminée, ce qui provoque des délais d’expiration.</span><span class="sxs-lookup"><span data-stu-id="107a6-304">Even though the first operation timed out, it does not stop the data being sent to/from the server, and other requests are blocked until this is finished, causing time outs.</span></span> <span data-ttu-id="107a6-305">Une solution pour réduire le risque de délais d’expiration consiste à vérifier que le cache est assez grand pour votre charge de travail et à fractionner les valeurs importantes en valeurs plus petites.</span><span class="sxs-lookup"><span data-stu-id="107a6-305">One solution is to minimize the chance of timeouts by ensuring that your cache is large enough for your workload and splitting large values into smaller chunks.</span></span> <span data-ttu-id="107a6-306">Une autre solution consiste à utiliser un pool d’objets `ConnectionMultiplexer` dans votre client et à choisir le `ConnectionMultiplexer` le moins chargé lors de l’envoi d’une nouvelle demande.</span><span class="sxs-lookup"><span data-stu-id="107a6-306">Another possible solution is to use a pool of `ConnectionMultiplexer` objects in your client, and choose the least loaded `ConnectionMultiplexer` when sending a new request.</span></span> <span data-ttu-id="107a6-307">Ceci doit empêcher un délai de faire expirer les autres demandes.</span><span class="sxs-lookup"><span data-stu-id="107a6-307">This should prevent a single timeout from causing other requests to also timeout.</span></span>
9. <span data-ttu-id="107a6-308">Si vous utilisez `RedisSessionStateprovider`, vérifiez que vous avez configuré correctement le délai d’expiration de nouvelle tentative.</span><span class="sxs-lookup"><span data-stu-id="107a6-308">If you are using `RedisSessionStateprovider`, ensure you have set the retry timeout correctly.</span></span> <span data-ttu-id="107a6-309">`retrytimeoutInMilliseconds` doit être supérieur à `operationTimeoutinMilliseonds`, sans quoi aucune nouvelle tentative ne se produit.</span><span class="sxs-lookup"><span data-stu-id="107a6-309">`retrytimeoutInMilliseconds` should be higher than `operationTimeoutinMilliseonds`, otherwise no retries will occur.</span></span> <span data-ttu-id="107a6-310">Dans l’exemple suivant, `retrytimeoutInMilliseconds` est réglé sur 3 000.</span><span class="sxs-lookup"><span data-stu-id="107a6-310">In the following example `retrytimeoutInMilliseconds` is set to 3000.</span></span> <span data-ttu-id="107a6-311">Pour plus d’informations, voir [Fournisseur d’état de session ASP.NET pour Cache Redis Azure](cache-aspnet-session-state-provider.md) et [How to use the configuration parameters of Session State Provider and Output Cache Provider](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration) (Comment utiliser les paramètres de configuration du fournisseur d’état de session et du fournisseur de caches de sortie).</span><span class="sxs-lookup"><span data-stu-id="107a6-311">For more information, see [ASP.NET Session State Provider for Azure Redis Cache](cache-aspnet-session-state-provider.md) and [How to use the configuration parameters of Session State Provider and Output Cache Provider](https://github.com/Azure/aspnet-redis-providers/wiki/Configuration).</span></span>

    <add
      name="AFRedisCacheSessionStateProvider"
      type="Microsoft.Web.Redis.RedisSessionStateProvider"
      host="enbwcache.redis.cache.windows.net"
      port="6380"
      accessKey="…"
      ssl="true"
      databaseId="0"
      applicationName="AFRedisCacheSessionState"
      connectionTimeoutInMilliseconds = "5000"
      operationTimeoutInMilliseconds = "1000"
      retryTimeoutInMilliseconds="3000" />


1. <span data-ttu-id="107a6-312">Vérifiez l’utilisation de la mémoire sur le serveur du cache Redis Azure en [surveillant](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` et `Used Memory`.</span><span class="sxs-lookup"><span data-stu-id="107a6-312">Check memory usage on the Azure Redis Cache server by [monitoring](cache-how-to-monitor.md#available-metrics-and-reporting-intervals) `Used Memory RSS` and `Used Memory`.</span></span> <span data-ttu-id="107a6-313">Si une stratégie d’éviction est en place, Redis commence la suppression de clés lorsque `Used_Memory` atteint la taille du cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-313">If an eviction policy is in place, Redis starts evicting keys when `Used_Memory` reaches the cache size.</span></span> <span data-ttu-id="107a6-314">Dans l’idéal, `Used Memory RSS` doit être légèrement supérieur à `Used memory`.</span><span class="sxs-lookup"><span data-stu-id="107a6-314">Ideally, `Used Memory RSS` should be only slightly higher than `Used memory`.</span></span> <span data-ttu-id="107a6-315">Une différence importante traduit une fragmentation de la mémoire (interne ou externe).</span><span class="sxs-lookup"><span data-stu-id="107a6-315">A large difference means there is memory fragmentation (internal or external.</span></span> <span data-ttu-id="107a6-316">Lorsque `Used Memory RSS` est inférieur à `Used Memory`, cela signifie que le système d’exploitation a permuté une partie de la mémoire cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-316">When `Used Memory RSS` is less than `Used Memory`, it means part of the cache memory has been swapped  by the operating system.</span></span> <span data-ttu-id="107a6-317">Dans ce cas, vous pouvez rencontrer des latences importantes.</span><span class="sxs-lookup"><span data-stu-id="107a6-317">If this occurs you can expect some significant latencies.</span></span> <span data-ttu-id="107a6-318">Comme Redis ne contrôle pas le mode de mappage de ses allocations aux pages mémoire, une valeur élevée de `Used Memory RSS` traduit souvent un pic d’utilisation de la mémoire.</span><span class="sxs-lookup"><span data-stu-id="107a6-318">Because Redis does not have control over how its allocations are mapped to memory pages, high `Used Memory RSS` is often the result of a spike in memory usage.</span></span> <span data-ttu-id="107a6-319">Lorsque Redis libère de la mémoire, celle-ci est redonnée à l’allocateur qui peut (ou pas) rendre la mémoire au système.</span><span class="sxs-lookup"><span data-stu-id="107a6-319">When Redis frees memory, the memory is given back to the allocator, and the allocator may or may not give the memory back to the system.</span></span> <span data-ttu-id="107a6-320">Il peut y avoir une différence entre la valeur de `Used Memory` et la consommation de mémoire telle qu’elle est indiquée par le système d’exploitation.</span><span class="sxs-lookup"><span data-stu-id="107a6-320">There may be a discrepancy between the `Used Memory` value and memory consumption as reported by the operating system.</span></span> <span data-ttu-id="107a6-321">Ceci peut s’expliquer par le fait que la mémoire a été utilisée et libérée par Redis, mais pas restituée au système.</span><span class="sxs-lookup"><span data-stu-id="107a6-321">It may be due to the fact memory has been used and released by Redis, but not given back to the system.</span></span> <span data-ttu-id="107a6-322">Pour réduire les problèmes de mémoire, vous pouvez effectuer les étapes suivantes.</span><span class="sxs-lookup"><span data-stu-id="107a6-322">To help mitigate memory issues you can perform the following steps.</span></span>
   
   * <span data-ttu-id="107a6-323">Augmentez la taille du cache, afin de ne plus être soumis aux limitations de mémoire du système.</span><span class="sxs-lookup"><span data-stu-id="107a6-323">Upgrade the cache to a larger size so that you are not running up against memory limitations on the system.</span></span>
   * <span data-ttu-id="107a6-324">Définissez des délais d’expiration sur les clés afin que les anciennes valeurs soient supprimées de manière proactive.</span><span class="sxs-lookup"><span data-stu-id="107a6-324">Set expiration times on the keys so that older values are evicted proactively.</span></span>
   * <span data-ttu-id="107a6-325">Surveillez la mesure de cache `used_memory_rss` .</span><span class="sxs-lookup"><span data-stu-id="107a6-325">Monitor the the `used_memory_rss` cache metric.</span></span> <span data-ttu-id="107a6-326">Lorsque cette valeur s’approche de la taille du cache, vous risquez de voir apparaître des problèmes de performance.</span><span class="sxs-lookup"><span data-stu-id="107a6-326">When this value approaches the size of their cache, you are likely to start seeing performance issues.</span></span> <span data-ttu-id="107a6-327">Répartissez les données sur plusieurs partitions, si vous utilisez un cache premium, ou augmentez la taille du cache.</span><span class="sxs-lookup"><span data-stu-id="107a6-327">Distribute the data across multiple shards if you are using a premium cache, or upgrade to a larger cache size.</span></span>
   
   <span data-ttu-id="107a6-328">Pour plus d’informations, consultez [Saturation de la mémoire sur le serveur](#memory-pressure-on-the-server).</span><span class="sxs-lookup"><span data-stu-id="107a6-328">For more information, see [Memory Pressure on the server](#memory-pressure-on-the-server).</span></span>

## <a name="additional-information"></a><span data-ttu-id="107a6-329">Informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="107a6-329">Additional information</span></span>
* [<span data-ttu-id="107a6-330">Que propose Cache Redis et quelle taille dois-je utiliser ?</span><span class="sxs-lookup"><span data-stu-id="107a6-330">What Redis Cache offering and size should I use?</span></span>](cache-faq.md#what-redis-cache-offering-and-size-should-i-use)
* [<span data-ttu-id="107a6-331">Comment puis-je évaluer et tester les performances de mon cache ?</span><span class="sxs-lookup"><span data-stu-id="107a6-331">How can I benchmark and test the performance of my cache?</span></span>](cache-faq.md#how-can-i-benchmark-and-test-the-performance-of-my-cache)
* [<span data-ttu-id="107a6-332">Comment exécuter des commandes Redis ?</span><span class="sxs-lookup"><span data-stu-id="107a6-332">How can I run Redis commands?</span></span>](cache-faq.md#how-can-i-run-redis-commands)
* [<span data-ttu-id="107a6-333">Surveillance du cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="107a6-333">How to monitor Azure Redis Cache</span></span>](cache-how-to-monitor.md)

