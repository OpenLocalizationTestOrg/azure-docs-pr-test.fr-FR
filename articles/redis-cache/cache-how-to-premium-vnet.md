---
title: "Configurer un réseau virtuel pour un Cache Redis Azure Premium | Microsoft Docs"
description: "Découvrez comment créer et gérer la prise en charge de réseau virtuel pour vos instances de Cache Redis Azure de niveau Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="1675c-103">Comment configurer la prise en charge de réseau virtuel pour un Cache Redis Azure Premium</span><span class="sxs-lookup"><span data-stu-id="1675c-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="1675c-104">Le Cache Redis Azure offre différents types de caches permettant de choisir en toute flexibilité parmi plusieurs tailles et fonctionnalités de caches, notamment les fonctionnalités de couche Premium telles que le clustering, la persistance et la prise en charge du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="1675c-105">Un réseau VNet est un réseau privé dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="1675c-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="1675c-106">Lorsqu’une instance de Cache Redis Azure est configurée avec un réseau virtuel, elle n’est pas adressable publiquement et est accessible uniquement à partir de machines virtuelles et d’applications sur le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="1675c-107">Cet article décrit comment configurer la prise en charge de réseau virtuel pour une instance Premium de Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="1675c-108">Le Cache Redis Azure prend en charge les réseaux virtuels classiques et de Gestionnaire de ressources.</span><span class="sxs-lookup"><span data-stu-id="1675c-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="1675c-109">Pour plus d’informations sur les autres fonctionnalités du cache Premium, consultez [Introduction au niveau Premium du Cache Redis Azure](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="1675c-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="1675c-110">Pourquoi un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="1675c-110">Why VNet?</span></span>
<span data-ttu-id="1675c-111">Le déploiement d’un [Réseau virtuel Azure (VNet)](https://azure.microsoft.com/services/virtual-network/) offre une sécurité et une isolation améliorées pour votre Cache Redis Azure, ainsi que des sous-réseaux, des stratégies de contrôle d’accès et d’autres fonctionnalités permettant de restreindre davantage l’accès.</span><span class="sxs-lookup"><span data-stu-id="1675c-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="1675c-112">Prise en charge des réseaux virtuels</span><span class="sxs-lookup"><span data-stu-id="1675c-112">Virtual network support</span></span>
<span data-ttu-id="1675c-113">La configuration de la prise en charge du réseau virtuel (VNet) s’effectue dans le panneau **Nouveau cache Redis** lors de la création du cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="1675c-114">Une fois que vous avez sélectionné le niveau tarifaire Premium, vous pouvez configurer l’intégration du réseau virtuel Redis en sélectionnant un réseau virtuel situé dans le même abonnement et le même emplacement que votre cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="1675c-115">Pour utiliser un nouveau réseau virtuel, vous devez tout d’abord le créer en suivant les étapes indiquées dans [Créer un réseau virtuel à l’aide du Portail Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) ou [Créer un réseau virtuel (classique) à l’aide du Portail ](../virtual-network/virtual-networks-create-vnet-classic-pportal.md). Revenez ensuite au panneau **Nouveau cache Redis** pour créer et configurer votre cache Premium.</span><span class="sxs-lookup"><span data-stu-id="1675c-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="1675c-116">Pour configurer le réseau virtuel pour votre nouveau cache, cliquez sur **Réseau virtuel** dans le panneau **Nouveau cache Redis**, puis sélectionnez le réseau virtuel souhaité dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="1675c-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Réseau virtuel][redis-cache-vnet]

<span data-ttu-id="1675c-118">Sélectionnez le sous-réseau souhaité dans la liste déroulante **Sous-réseau**, puis spécifiez **l’adresse IP statique** souhaitée.</span><span class="sxs-lookup"><span data-stu-id="1675c-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="1675c-119">Si vous utilisez un réseau virtuel classique, le champ **Adresse IP statique** est facultatif. Si aucune adresse IP statique n’est spécifiée, une option sera choisie dans le sous-réseau sélectionné.</span><span class="sxs-lookup"><span data-stu-id="1675c-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="1675c-120">Lorsque vous déployez un Cache Redis Azure vers un réseau virtuel Gestionnaire des ressources, le cache doit se trouver dans un sous-réseau dédié ne contenant pas de ressources autres que des instances du Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="1675c-121">Si vous tentez de déployer un Cache Redis Azure sur un réseau virtuel Gestionnaire des ressources vers un sous-réseau contenant d’autres ressources, le déploiement échoue.</span><span class="sxs-lookup"><span data-stu-id="1675c-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Réseau virtuel][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="1675c-123">Azure réserve dans chaque sous-réseau des adresses IP qui ne peuvent pas être utilisées.</span><span class="sxs-lookup"><span data-stu-id="1675c-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="1675c-124">Les première et dernière adresse IP des sous-réseaux sont réservées à la conformité du protocole, et 3 adresses supplémentaires sont utilisées pour les services Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="1675c-125">Pour plus d’informations, consultez [Existe-t-il des restrictions sur l’utilisation des adresses IP au sein de ces sous-réseaux ?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="1675c-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="1675c-126">Outre les adresses IP utilisées par l’infrastructure réseau virtuel Azure, chaque d’instance Redis dans le sous-réseau utilise deux adresses IP par partition et une adresse IP supplémentaire pour l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="1675c-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="1675c-127">Un cache non cluster est considéré comme ayant une seule partition.</span><span class="sxs-lookup"><span data-stu-id="1675c-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="1675c-128">Une fois le cache créé, vous pouvez afficher la configuration du réseau virtuel en cliquant sur **Réseau virtuel** dans le **menu Ressource**.</span><span class="sxs-lookup"><span data-stu-id="1675c-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Réseau virtuel][redis-cache-vnet-info]

<span data-ttu-id="1675c-130">Pour vous connecter à votre instance du Cache Redis Azure lorsque vous utilisez un réseau virtuel, spécifiez le nom d’hôte de votre cache dans la chaîne de connexion, comme indiqué dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="1675c-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="1675c-131">Forum aux questions sur le réseau virtuel de Cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="1675c-132">La liste suivante présente différentes réponses aux questions les plus fréquemment posées sur la mise à l’échelle du Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="1675c-133">Quels sont les problèmes de configuration les plus courants au niveau du Cache Redis Azure et des réseaux virtuels ?</span><span class="sxs-lookup"><span data-stu-id="1675c-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="1675c-134">Comment puis-je vérifier que mon cache fonctionne dans un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="1675c-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="1675c-135">Puis-je utiliser des réseaux virtuels avec un cache De base ou Standard ?</span><span class="sxs-lookup"><span data-stu-id="1675c-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="1675c-136">Pourquoi la création d’un cache Redis échoue-t-elle dans certains sous-réseaux mais pas d’autres ?</span><span class="sxs-lookup"><span data-stu-id="1675c-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="1675c-137">Quelles sont les exigences d’espace d’adressage du sous-réseau ?</span><span class="sxs-lookup"><span data-stu-id="1675c-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="1675c-138">Toutes les fonctionnalités fonctionnent-elles lorsque vous hébergez un cache dans un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="1675c-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="1675c-139">Quels sont les problèmes de configuration les plus courants au niveau du Cache Redis Azure et des réseaux virtuels ?</span><span class="sxs-lookup"><span data-stu-id="1675c-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="1675c-140">Lorsque le Cache Redis Azure est hébergé dans un réseau virtuel, les ports dans les tableaux suivants sont utilisés.</span><span class="sxs-lookup"><span data-stu-id="1675c-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="1675c-141">Si ces ports dans les tableaux suivants sont bloqués, le cache risque de ne pas fonctionner correctement.</span><span class="sxs-lookup"><span data-stu-id="1675c-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="1675c-142">Le blocage d’un ou plusieurs de ces ports constitue le problème de configuration le plus courant lorsque vous utilisez le Cache Redis Azure dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="1675c-143">Configuration requise de port sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="1675c-144">Configuration requise de port entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="1675c-145">Configuration requise de port sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-145">Outbound port requirements</span></span>

<span data-ttu-id="1675c-146">Il existe sept configurations requises de port sortant.</span><span class="sxs-lookup"><span data-stu-id="1675c-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="1675c-147">Si vous le souhaitez, toutes les connexions sortantes vers Internet peuvent être effectuées via un appareil d’audit local du client.</span><span class="sxs-lookup"><span data-stu-id="1675c-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="1675c-148">Trois des ports acheminent le trafic vers des points de terminaison Azure se chargeant du stockage Azure et d’Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="1675c-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="1675c-149">Les plages de ports restantes et pour les communications internes du sous-réseau Redis.</span><span class="sxs-lookup"><span data-stu-id="1675c-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="1675c-150">Aucune règle de groupe de sécurité réseau de sous-réseau n’est requise pour les communications sur sous-réseau Redis interne.</span><span class="sxs-lookup"><span data-stu-id="1675c-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="1675c-151">Port(s)</span><span class="sxs-lookup"><span data-stu-id="1675c-151">Port(s)</span></span> | <span data-ttu-id="1675c-152">Direction</span><span class="sxs-lookup"><span data-stu-id="1675c-152">Direction</span></span> | <span data-ttu-id="1675c-153">Protocole de transfert</span><span class="sxs-lookup"><span data-stu-id="1675c-153">Transport Protocol</span></span> | <span data-ttu-id="1675c-154">Objectif</span><span class="sxs-lookup"><span data-stu-id="1675c-154">Purpose</span></span> | <span data-ttu-id="1675c-155">Adresse IP locale</span><span class="sxs-lookup"><span data-stu-id="1675c-155">Local IP</span></span> | <span data-ttu-id="1675c-156">Adresse IP distante</span><span class="sxs-lookup"><span data-stu-id="1675c-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1675c-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="1675c-157">80, 443</span></span> |<span data-ttu-id="1675c-158">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-158">Outbound</span></span> |<span data-ttu-id="1675c-159">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-159">TCP</span></span> |<span data-ttu-id="1675c-160">Dépendances Redis sur Azure Storage/l’infrastructure à clé publique (Internet)</span><span class="sxs-lookup"><span data-stu-id="1675c-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="1675c-161">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="1675c-162">53</span><span class="sxs-lookup"><span data-stu-id="1675c-162">53</span></span> |<span data-ttu-id="1675c-163">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-163">Outbound</span></span> |<span data-ttu-id="1675c-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="1675c-164">TCP/UDP</span></span> |<span data-ttu-id="1675c-165">Dépendances Redis sur le DNS (Internet/réseau virtuel)</span><span class="sxs-lookup"><span data-stu-id="1675c-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="1675c-166">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="1675c-167">8443</span><span class="sxs-lookup"><span data-stu-id="1675c-167">8443</span></span> |<span data-ttu-id="1675c-168">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-168">Outbound</span></span> |<span data-ttu-id="1675c-169">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-169">TCP</span></span> |<span data-ttu-id="1675c-170">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-170">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-171">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-171">(Redis subnet)</span></span> | <span data-ttu-id="1675c-172">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-172">(Redis subnet)</span></span> |
| <span data-ttu-id="1675c-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="1675c-173">10221-10231</span></span> |<span data-ttu-id="1675c-174">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-174">Outbound</span></span> |<span data-ttu-id="1675c-175">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-175">TCP</span></span> |<span data-ttu-id="1675c-176">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-176">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-177">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-177">(Redis subnet)</span></span> | <span data-ttu-id="1675c-178">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-178">(Redis subnet)</span></span> |
| <span data-ttu-id="1675c-179">20226</span><span class="sxs-lookup"><span data-stu-id="1675c-179">20226</span></span> |<span data-ttu-id="1675c-180">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-180">Outbound</span></span> |<span data-ttu-id="1675c-181">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-181">TCP</span></span> |<span data-ttu-id="1675c-182">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-182">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-183">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-183">(Redis subnet)</span></span> |<span data-ttu-id="1675c-184">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-184">(Redis subnet)</span></span> |
| <span data-ttu-id="1675c-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="1675c-185">13000-13999</span></span> |<span data-ttu-id="1675c-186">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-186">Outbound</span></span> |<span data-ttu-id="1675c-187">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-187">TCP</span></span> |<span data-ttu-id="1675c-188">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-188">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-189">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-189">(Redis subnet)</span></span> |<span data-ttu-id="1675c-190">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-190">(Redis subnet)</span></span> |
| <span data-ttu-id="1675c-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="1675c-191">15000-15999</span></span> |<span data-ttu-id="1675c-192">Règle de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="1675c-192">Outbound</span></span> |<span data-ttu-id="1675c-193">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-193">TCP</span></span> |<span data-ttu-id="1675c-194">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-194">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-195">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-195">(Redis subnet)</span></span> |<span data-ttu-id="1675c-196">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="1675c-197">Configuration requise des ports entrants</span><span class="sxs-lookup"><span data-stu-id="1675c-197">Inbound port requirements</span></span>

<span data-ttu-id="1675c-198">Il existe huit configurations requises de port entrant.</span><span class="sxs-lookup"><span data-stu-id="1675c-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="1675c-199">Les requêtes entrantes dans ces plages proviennent d’autres services hébergés dans le même réseau virtuel ou des communications sur sous-réseau Redis interne.</span><span class="sxs-lookup"><span data-stu-id="1675c-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="1675c-200">Port(s)</span><span class="sxs-lookup"><span data-stu-id="1675c-200">Port(s)</span></span> | <span data-ttu-id="1675c-201">Direction</span><span class="sxs-lookup"><span data-stu-id="1675c-201">Direction</span></span> | <span data-ttu-id="1675c-202">Protocole de transfert</span><span class="sxs-lookup"><span data-stu-id="1675c-202">Transport Protocol</span></span> | <span data-ttu-id="1675c-203">Objectif</span><span class="sxs-lookup"><span data-stu-id="1675c-203">Purpose</span></span> | <span data-ttu-id="1675c-204">Adresse IP locale</span><span class="sxs-lookup"><span data-stu-id="1675c-204">Local IP</span></span> | <span data-ttu-id="1675c-205">Adresse IP distante</span><span class="sxs-lookup"><span data-stu-id="1675c-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="1675c-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="1675c-206">6379, 6380</span></span> |<span data-ttu-id="1675c-207">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-207">Inbound</span></span> |<span data-ttu-id="1675c-208">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-208">TCP</span></span> |<span data-ttu-id="1675c-209">Communication client avec Redis, équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="1675c-210">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-210">(Redis subnet)</span></span> |<span data-ttu-id="1675c-211">Réseau virtuel, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-212">8443</span><span class="sxs-lookup"><span data-stu-id="1675c-212">8443</span></span> |<span data-ttu-id="1675c-213">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-213">Inbound</span></span> |<span data-ttu-id="1675c-214">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-214">TCP</span></span> |<span data-ttu-id="1675c-215">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-215">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-216">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-216">(Redis subnet)</span></span> |<span data-ttu-id="1675c-217">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-217">(Redis subnet)</span></span> |
| <span data-ttu-id="1675c-218">8500</span><span class="sxs-lookup"><span data-stu-id="1675c-218">8500</span></span> |<span data-ttu-id="1675c-219">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-219">Inbound</span></span> |<span data-ttu-id="1675c-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="1675c-220">TCP/UDP</span></span> |<span data-ttu-id="1675c-221">Équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-221">Azure load balancing</span></span> | <span data-ttu-id="1675c-222">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-222">(Redis subnet)</span></span> |<span data-ttu-id="1675c-223">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="1675c-224">10221-10231</span></span> |<span data-ttu-id="1675c-225">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-225">Inbound</span></span> |<span data-ttu-id="1675c-226">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-226">TCP</span></span> |<span data-ttu-id="1675c-227">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-227">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-228">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-228">(Redis subnet)</span></span> |<span data-ttu-id="1675c-229">(Sous-réseau Redis) Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="1675c-230">13000-13999</span></span> |<span data-ttu-id="1675c-231">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-231">Inbound</span></span> |<span data-ttu-id="1675c-232">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-232">TCP</span></span> |<span data-ttu-id="1675c-233">Communication client avec les clusters Redis, équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="1675c-234">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-234">(Redis subnet)</span></span> |<span data-ttu-id="1675c-235">Réseau virtuel, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="1675c-236">15000-15999</span></span> |<span data-ttu-id="1675c-237">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-237">Inbound</span></span> |<span data-ttu-id="1675c-238">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-238">TCP</span></span> |<span data-ttu-id="1675c-239">Communication client avec les clusters Redis, équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="1675c-240">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-240">(Redis subnet)</span></span> |<span data-ttu-id="1675c-241">Réseau virtuel, Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-242">16001</span><span class="sxs-lookup"><span data-stu-id="1675c-242">16001</span></span> |<span data-ttu-id="1675c-243">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-243">Inbound</span></span> |<span data-ttu-id="1675c-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="1675c-244">TCP/UDP</span></span> |<span data-ttu-id="1675c-245">Équilibrage de charge Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-245">Azure load balancing</span></span> | <span data-ttu-id="1675c-246">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-246">(Redis subnet)</span></span> |<span data-ttu-id="1675c-247">Azure Load Balancer</span><span class="sxs-lookup"><span data-stu-id="1675c-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="1675c-248">20226</span><span class="sxs-lookup"><span data-stu-id="1675c-248">20226</span></span> |<span data-ttu-id="1675c-249">Trafic entrant</span><span class="sxs-lookup"><span data-stu-id="1675c-249">Inbound</span></span> |<span data-ttu-id="1675c-250">TCP</span><span class="sxs-lookup"><span data-stu-id="1675c-250">TCP</span></span> |<span data-ttu-id="1675c-251">Communications internes pour Redis</span><span class="sxs-lookup"><span data-stu-id="1675c-251">Internal communications for Redis</span></span> | <span data-ttu-id="1675c-252">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-252">(Redis subnet)</span></span> |<span data-ttu-id="1675c-253">(sous-réseau Redis)</span><span class="sxs-lookup"><span data-stu-id="1675c-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="1675c-254">Conditions supplémentaires pour la connectivité réseau VNET</span><span class="sxs-lookup"><span data-stu-id="1675c-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="1675c-255">Il existe des exigences de connectivité réseau pour le Cache Redis Azure qui peuvent ne pas être initialement satisfaites dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="1675c-256">Le Cache Redis Azure nécessite tous les éléments suivants pour fonctionner correctement lorsqu’il est utilisé dans un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="1675c-257">Connectivité réseau sortante à des points de terminaison Azure Storage dans le monde entier.</span><span class="sxs-lookup"><span data-stu-id="1675c-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="1675c-258">Cela inclut les points de terminaison situés dans la même région que le cache Redis Azure, ainsi que les points de terminaison de stockage situés dans d’ **autres** régions Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="1675c-259">Les points de terminaison du Stockage Azure se résolvent dans les domaines DNS suivants : *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net* et *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="1675c-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="1675c-260">Connectivité réseau sortante à *ocsp.msocsp.com*, *mscrl.microsoft.com* et *crl.microsoft.com*. Cette connectivité est nécessaire pour prendre en charge la fonctionnalité SSL.</span><span class="sxs-lookup"><span data-stu-id="1675c-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="1675c-261">La configuration DNS pour le réseau virtuel doit être capable de résoudre tous les points de terminaison et les domaines mentionnés dans les points précédents.</span><span class="sxs-lookup"><span data-stu-id="1675c-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="1675c-262">La configuration DNS requise peut être satisfaite en garantissant qu'une infrastructure DNS valide est configurée et gérée pour le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="1675c-263">Connectivité réseau sortante aux points de terminaison de surveillance Azure suivants qui se résolvent dans les domaines DNS suivants : shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net et azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="1675c-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="1675c-264">Comment puis-je vérifier que mon cache fonctionne dans un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="1675c-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="1675c-265">Lors de la connexion à une instance Cache Redis Azure hébergée dans un réseau virtuel, vos clients de cache doivent figurer dans le même réseau virtuel, notamment les applications de test ou les outils de test Ping de diagnostic.</span><span class="sxs-lookup"><span data-stu-id="1675c-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="1675c-266">Une fois les exigences de port configurées comme décrit dans la section précédente, vous pouvez vérifier que votre cache fonctionne en procédant comme suit.</span><span class="sxs-lookup"><span data-stu-id="1675c-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="1675c-267">[Redémarrez](cache-administration.md#reboot) tous les nœuds de cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="1675c-268">Si toutes les dépendances de cache requises sont inaccessibles (comme décrit dans [Configuration requise des ports entrants](cache-how-to-premium-vnet.md#inbound-port-requirements) et [Configuration requise des ports sortants](cache-how-to-premium-vnet.md#outbound-port-requirements)), le cache ne redémarre plus correctement.</span><span class="sxs-lookup"><span data-stu-id="1675c-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="1675c-269">Une fois les nœuds de cache redémarrés (comme indiqué par l’état du cache dans le portail Azure), vous pouvez effectuer les tests suivants :</span><span class="sxs-lookup"><span data-stu-id="1675c-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="1675c-270">Vous pouvez effectuer un test ping du point de terminaison du cache (en utilisant le port 6380) à partir d’une machine figurant dans le même réseau virtuel que le cache, à l’aide de la commande [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="1675c-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="1675c-271">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="1675c-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="1675c-272">Si l’outil `tcping` signale que le port est ouvert, cela signifie que le cache est disponible pour connexion à partir de clients dans le réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="1675c-273">Un autre test consiste à créer un client de cache de test (qui peut être une simple application console utilisant StackExchange.Redis) qui se connecte au cache et ajoute et récupère des éléments de celui-ci.</span><span class="sxs-lookup"><span data-stu-id="1675c-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="1675c-274">Installez l’exemple d’application cliente sur une machine virtuelle figurant dans le même réseau virtuel que le cache, puis exécutez l’application pour vérifier la connectivité au cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="1675c-275">Puis-je utiliser des réseaux virtuels avec un cache De base ou Standard ?</span><span class="sxs-lookup"><span data-stu-id="1675c-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="1675c-276">Vous ne pouvez utiliser des réseaux virtuels qu’avec les caches de niveau Premium.</span><span class="sxs-lookup"><span data-stu-id="1675c-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="1675c-277">Pourquoi la création d’un cache Redis échoue-t-elle dans certains sous-réseaux mais pas d’autres ?</span><span class="sxs-lookup"><span data-stu-id="1675c-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="1675c-278">Si vous déployez un Cache Redis Azure sur un réseau virtuel Gestionnaire des ressources, le cache doit se trouver dans un sous-réseau dédié qui ne contient aucun autre type de ressource.</span><span class="sxs-lookup"><span data-stu-id="1675c-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="1675c-279">Si vous tentez de déployer un Cache Redis Azure sur un sous-réseau de réseau virtuel Gestionnaire des ressources vers un sous-réseau contenant d’autres ressources, le déploiement échoue.</span><span class="sxs-lookup"><span data-stu-id="1675c-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="1675c-280">Vous devez supprimer les ressources existantes dans le sous-réseau avant de pouvoir créer un nouveau cache Redis.</span><span class="sxs-lookup"><span data-stu-id="1675c-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="1675c-281">Vous pouvez déployer plusieurs types de ressources sur un réseau virtuel classique, à condition de disposer de suffisamment d’adresses IP disponibles.</span><span class="sxs-lookup"><span data-stu-id="1675c-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="1675c-282">Quelles sont les exigences d’espace d’adressage du sous-réseau ?</span><span class="sxs-lookup"><span data-stu-id="1675c-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="1675c-283">Azure réserve dans chaque sous-réseau des adresses IP qui ne peuvent pas être utilisées.</span><span class="sxs-lookup"><span data-stu-id="1675c-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="1675c-284">Les première et dernière adresse IP des sous-réseaux sont réservées à la conformité du protocole, et 3 adresses supplémentaires sont utilisées pour les services Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="1675c-285">Pour plus d’informations, consultez [Existe-t-il des restrictions sur l’utilisation des adresses IP au sein de ces sous-réseaux ?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="1675c-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="1675c-286">Outre les adresses IP utilisées par l’infrastructure réseau virtuel Azure, chaque d’instance Redis dans le sous-réseau utilise deux adresses IP par partition et une adresse IP supplémentaire pour l’équilibrage de charge.</span><span class="sxs-lookup"><span data-stu-id="1675c-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="1675c-287">Un cache non cluster est considéré comme ayant une seule partition.</span><span class="sxs-lookup"><span data-stu-id="1675c-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="1675c-288">Toutes les fonctionnalités fonctionnent-elles lorsque vous hébergez un cache dans un réseau virtuel ?</span><span class="sxs-lookup"><span data-stu-id="1675c-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="1675c-289">Quand votre cache fait partie d’un réseau virtuel, seuls les clients de ce réseau virtuel peuvent accéder au cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="1675c-290">Par conséquent, les fonctionnalités de gestion de cache suivantes ne fonctionnent pas pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="1675c-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="1675c-291">Console redis. Console Redis s’exécutant dans votre navigateur local situé à l’extérieur du réseau virtuel, il ne peut pas se connecter à votre cache.</span><span class="sxs-lookup"><span data-stu-id="1675c-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="1675c-292">Utiliser ExpressRoute avec le Cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="1675c-293">Les clients peuvent connecter un circuit [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) à leur infrastructure de réseau virtuel pour étendre leur réseau local à Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="1675c-294">Par défaut, un circuit ExpressRoute nouvellement créé n’effectue pas de tunneling forcé (publication d’un routage par défaut, 0.0.0.0/0) sur un réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="1675c-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="1675c-295">Par conséquent, la connectivité Internet sortante est autorisée directement à partir du réseau virtuel, et les applications clientes sont en mesure de se connecter à d’autres points de terminaison Azure, dont Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="1675c-296">Toutefois, une configuration de client courante consiste à utiliser un tunneling forcé (publication d’un routage par défaut), qui force le trafic Internet sortant à circuler localement à la place.</span><span class="sxs-lookup"><span data-stu-id="1675c-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="1675c-297">Ce flux de trafic interrompt la connectivité avec le Cache Redis Azure si le trafic sortant est bloqué localement, par exemple, quand l’instance du Cache Redis Azure ne peut pas communiquer avec ses dépendances.</span><span class="sxs-lookup"><span data-stu-id="1675c-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="1675c-298">La solution consiste à définir un (ou plusieurs) itinéraires définis par l’utilisateur (UDR) sur le sous-réseau qui contient le Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="1675c-299">Un itinéraire défini par l'utilisateur définit des itinéraires spécifiques au sous-réseau qui seront respectés au lieu de l'itinéraire par défaut.</span><span class="sxs-lookup"><span data-stu-id="1675c-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="1675c-300">Si possible, il est recommandé d'utiliser la configuration suivante :</span><span class="sxs-lookup"><span data-stu-id="1675c-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="1675c-301">La configuration ExpressRoute annonce 0.0.0.0/0 et par défaut, tunnelise de force tout le trafic sortant sur site.</span><span class="sxs-lookup"><span data-stu-id="1675c-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="1675c-302">L’UDR appliqué au sous-réseau contenant le Cache Redis Azure définit 0.0.0.0/0 avec un itinéraire de travail pour le trafic TCP/IP vers le réseau internet public, par exemple, en définissant le type de tronçon suivant vers « Internet ».</span><span class="sxs-lookup"><span data-stu-id="1675c-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="1675c-303">L’effet combiné de ces étapes est que l’UDR de niveau sous-réseau a la priorité sur le tunneling forcé ExpressRoute, garantissant ainsi un accès Internet sortant à partir du Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="1675c-304">La connexion à une instance du Cache Redis Azure à partir d’une application locale à l’aide d’ExpressRoute n’est pas un scénario d’utilisation classique pour des raisons de performances (pour des performances optimales, les clients du Cache Redis Azure doivent être situés dans la même région que le Cache Redis Azure).</span><span class="sxs-lookup"><span data-stu-id="1675c-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="1675c-305">Les itinéraires définis dans un UDR **doivent** être suffisamment spécifiques pour avoir la priorité sur les itinéraires annoncés par la configuration ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="1675c-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="1675c-306">L'exemple suivant utilise la plage d'adresses 0.0.0.0/0 étendue qui peut potentiellement être remplacée accidentellement par les annonces de routage à l'aide de plages d'adresses plus spécifiques.</span><span class="sxs-lookup"><span data-stu-id="1675c-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="1675c-307">Le cache Redis Azure n’est pas pris en charge avec les configurations ExpressRoute qui **publient incorrectement de façon croisée des itinéraires à partir du chemin d’accès d’homologation publique vers le chemin d’accès d’homologation privée**.</span><span class="sxs-lookup"><span data-stu-id="1675c-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="1675c-308">Les configurations ExpressRoute ayant une homologation publique configurée reçoivent des annonces de routage en provenance de Microsoft pour un grand ensemble de plages d’adresses IP Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="1675c-309">Si ces plages d’adresses sont incorrectement publiées de façon croisée sur le chemin d’accès d’homologation privée, il en résulte que tous les paquets réseau sortants du sous-réseau de l’instance du Cache Redis Azure sont incorrectement acheminés de force vers l’infrastructure réseau locale d’un client.</span><span class="sxs-lookup"><span data-stu-id="1675c-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="1675c-310">Ce flux réseau interrompt le Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="1675c-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="1675c-311">La solution à ce problème consiste à arrêter les itinéraires croisés depuis le chemin d'accès d'homologation publique vers le chemin d'accès d'homologation privée.</span><span class="sxs-lookup"><span data-stu-id="1675c-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="1675c-312">Vous trouverez des informations générales sur les itinéraires définis par l'utilisateur dans cette [présentation](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1675c-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="1675c-313">Pour plus d’informations sur ExpressRoute, voir [Aperçu technique d’ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="1675c-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="1675c-314">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="1675c-314">Next steps</span></span>
<span data-ttu-id="1675c-315">Découvrez comment utiliser davantage de fonctionnalités de cache de niveau Premium.</span><span class="sxs-lookup"><span data-stu-id="1675c-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="1675c-316">Introduction au niveau Premium du Cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="1675c-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png

