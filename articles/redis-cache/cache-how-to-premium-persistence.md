---
title: "Comment configurer la persistance des données pour un Cache Redis Azure Premium"
description: "Découvrez comment configurer et gérer la persistance des données pour vos instances de Cache Redis Azure de niveau Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: b01cf279-60a0-4711-8c5f-af22d9540d38
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 08/24/2017
ms.author: sdanie
ms.openlocfilehash: 638f0154d3a4fd091197a2da86374a053b31c4c0
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="how-to-configure-data-persistence-for-a-premium-azure-redis-cache"></a><span data-ttu-id="05ff2-103">Comment configurer la persistance des données pour un Cache Redis Azure Premium</span><span class="sxs-lookup"><span data-stu-id="05ff2-103">How to configure data persistence for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="05ff2-104">Le Cache Redis Azure offre différents types de caches permettant de choisir en toute flexibilité parmi plusieurs tailles et fonctionnalités de caches en toute flexibilité, notamment les fonctionnalités de couche Premium telles que le clustering, la persistance et la prise en charge du réseau virtuel.</span><span class="sxs-lookup"><span data-stu-id="05ff2-104">Azure Redis Cache has different cache offerings which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="05ff2-105">Cet article décrit comment configurer la persistance dans une instance Premium de Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="05ff2-105">This article describes how to configure persistence in a premium Azure Redis Cache instance.</span></span>

<span data-ttu-id="05ff2-106">Pour plus d’informations sur les autres fonctionnalités du cache Premium, consultez [Introduction au niveau Premium du Cache Redis Azure](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="05ff2-106">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="what-is-data-persistence"></a><span data-ttu-id="05ff2-107">Qu’est-ce que la persistance des données ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-107">What is data persistence?</span></span>
<span data-ttu-id="05ff2-108">La [persistance Redis](https://redis.io/topics/persistence) vous permet de conserver les données stockées dans Redis.</span><span class="sxs-lookup"><span data-stu-id="05ff2-108">[Redis persistence](https://redis.io/topics/persistence) allows you to persist data stored in Redis.</span></span> <span data-ttu-id="05ff2-109">Vous pouvez également prendre des instantanés et sauvegarder les données que vous pouvez charger en cas de défaillance matérielle.</span><span class="sxs-lookup"><span data-stu-id="05ff2-109">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="05ff2-110">Il s’agit d’un avantage substantiel par rapport au niveau De base ou Standard, où toutes les données sont stockées en mémoire et il existe un risque de perte de données en cas de défaillance des nœuds de cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-110">This is a huge advantage over Basic or Standard tier where all the data is stored in memory and there can be potential data loss in case of a failure where Cache nodes are down.</span></span> 

<span data-ttu-id="05ff2-111">Le Cache Redis Azure offre la persistance Redis à l’aide des modèles suivants :</span><span class="sxs-lookup"><span data-stu-id="05ff2-111">Azure Redis Cache offers Redis persistence using the following models:</span></span>

* <span data-ttu-id="05ff2-112">**Persistance RDB** : Quand la persistance RDB (base de données Redis) est configurée, le Cache Redis Azure conserve un instantané du cache Redis dans un format binaire Redis sur le disque selon une fréquence de sauvegarde configurable.</span><span class="sxs-lookup"><span data-stu-id="05ff2-112">**RDB persistence** - When RDB (Redis database) persistence is configured, Azure Redis Cache persists a snapshot of the Redis cache in a Redis binary format to disk based on a configurable backup frequency.</span></span> <span data-ttu-id="05ff2-113">Si un événement catastrophique se produit et provoque la désactivation du cache principal et du réplica, le cache est reconstruit à l’aide de l’instantané le plus récent.</span><span class="sxs-lookup"><span data-stu-id="05ff2-113">If a catastrophic event occurs that disables both the primary and replica cache, the cache is reconstructed using the most recent snapshot.</span></span> <span data-ttu-id="05ff2-114">Découvrez-en plus sur les [avantages](https://redis.io/topics/persistence#rdb-advantages) et les [inconvénients](https://redis.io/topics/persistence#rdb-disadvantages) de la persistance RDB.</span><span class="sxs-lookup"><span data-stu-id="05ff2-114">Learn more about the [advantages](https://redis.io/topics/persistence#rdb-advantages) and [disadvantages](https://redis.io/topics/persistence#rdb-disadvantages) of RDB persistence.</span></span>
* <span data-ttu-id="05ff2-115">**Persistance AOF** : Lorsque la persistance AOF (Append Only File) est configurée, le Cache Redis Azure enregistre chaque opération d’écriture dans un journal qui est enregistré au moins une fois par seconde dans un compte de stockage Azure.</span><span class="sxs-lookup"><span data-stu-id="05ff2-115">**AOF persistence** - When AOF (Append only file) persistence is configured, Azure Redis Cache saves every write operation to a log that is saved at least once per second into an Azure Storage account.</span></span> <span data-ttu-id="05ff2-116">Si un événement catastrophique se produit et provoque la désactivation du cache principal et du réplica, le cache est reconstruit à l’aide des opérations d’écriture stockées.</span><span class="sxs-lookup"><span data-stu-id="05ff2-116">If a catastrophic event occurs that disables both the primary and replica cache, the cache is reconstructed using the stored write operations.</span></span> <span data-ttu-id="05ff2-117">Découvrez-en plus sur les [avantages](https://redis.io/topics/persistence#aof-advantages) et les [inconvénients](https://redis.io/topics/persistence#aof-disadvantages) de la persistance AOF.</span><span class="sxs-lookup"><span data-stu-id="05ff2-117">Learn more about the [advantages](https://redis.io/topics/persistence#aof-advantages) and [disadvantages](https://redis.io/topics/persistence#aof-disadvantages) of AOF persistence.</span></span>

<span data-ttu-id="05ff2-118">La persistance est configurée à partir du panneau **Nouveau Cache Redis** lors de la création du cache et du **menu Ressource** pour les caches Premium existants.</span><span class="sxs-lookup"><span data-stu-id="05ff2-118">Persistence is configured from the **New Redis Cache** blade during cache creation and on the **Resource menu** for existing premium caches.</span></span>

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="05ff2-119">Une fois que vous avez sélectionné un niveau tarifaire Premium, cliquez sur **Persistance Redis**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-119">Once a premium pricing tier is selected, click **Redis persistence**.</span></span>

![Persistance Redis][redis-cache-persistence]

<span data-ttu-id="05ff2-121">Les étapes de la section suivante décrivent comment configurer la persistance Redis sur votre nouveau cache Premium.</span><span class="sxs-lookup"><span data-stu-id="05ff2-121">The steps in the next section describe how to configure Redis persistence on your new premium cache.</span></span> <span data-ttu-id="05ff2-122">Une fois la persistance Redis configurée, cliquez sur **Créer** pour créer votre cache Premium avec la persistance Redis.</span><span class="sxs-lookup"><span data-stu-id="05ff2-122">Once Redis persistence is configured, click **Create** to create your new premium cache with Redis persistence.</span></span>

## <a name="enable-redis-persistence"></a><span data-ttu-id="05ff2-123">Activation de la persistance Redis</span><span class="sxs-lookup"><span data-stu-id="05ff2-123">Enable Redis persistence</span></span>

<span data-ttu-id="05ff2-124">Le panneau **Persistance des données Redis** permet de configurer la persistance Redis en sélectionnant la persistance **RDB** ou **AOF**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-124">Redis persistence is enabled on the **Redis data persistence** blade by choosing either **RDB** or **AOF** persistence.</span></span> <span data-ttu-id="05ff2-125">Pour les nouveaux caches, ce panneau est accessible pendant la création du cache, comme décrit dans la section précédente.</span><span class="sxs-lookup"><span data-stu-id="05ff2-125">For new caches, this blade is accessed during the cache creation process, as described in the previous section.</span></span> <span data-ttu-id="05ff2-126">Pour les caches existants, le panneau **Persistance des données Redis** est accessible à partir du **menu Ressource** de votre cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-126">For existing caches, the **Redis data persistence** blade is accessed from the **Resource menu** for your cache.</span></span>

![Paramètres Redis][redis-cache-settings]


## <a name="configure-rdb-persistence"></a><span data-ttu-id="05ff2-128">Configuration de la persistance RDB</span><span class="sxs-lookup"><span data-stu-id="05ff2-128">Configure RDB persistence</span></span>

<span data-ttu-id="05ff2-129">Pour activer la persistance RDB, cliquez sur **RDB**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-129">To enable RDB persistence, click **RDB**.</span></span> <span data-ttu-id="05ff2-130">Pour désactiver la persistance RDB sur un cache Premium précédemment activé, cliquez sur **Désactivé**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-130">To disable RDB persistence on a previously enabled premium cache, click **Disabled**.</span></span>

![Persistance RDB Redis][redis-cache-rdb-persistence]

<span data-ttu-id="05ff2-132">Pour configurer l’intervalle de sauvegarde, sélectionnez une **Fréquence de sauvegarde** dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="05ff2-132">To configure the backup interval, select a **Backup Frequency** from the drop-down list.</span></span> <span data-ttu-id="05ff2-133">Vous avez le choix entre **15 minutes**, **30 minutes**, **60 minutes**, **6 heures**, **12 heures** et **24 heures**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-133">Choices include **15 Minutes**, **30 minutes**, **60 minutes**, **6 hours**, **12 hours**, and **24 hours**.</span></span> <span data-ttu-id="05ff2-134">Cet intervalle débute au moment où l’opération de sauvegarde précédente s’est terminée correctement. Une fois l’intervalle écoulé, une nouvelle sauvegarde est lancée.</span><span class="sxs-lookup"><span data-stu-id="05ff2-134">This interval starts counting down after the previous backup operation successfully completes and when it elapses a new backup is initiated.</span></span>

<span data-ttu-id="05ff2-135">Cliquez sur **Compte de stockage** pour sélectionner le compte de stockage à utiliser, puis, dans la liste déroulante **Clé de stockage**, choisissez d’utiliser la **Clé primaire** ou la **Clé secondaire**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-135">Click **Storage Account** to select the storage account to use, and choose either the **Primary key** or **Secondary key** to use from the **Storage Key** drop-down.</span></span> <span data-ttu-id="05ff2-136">Vous devez choisir un compte de stockage situé dans la même région que le cache. Un compte **Stockage Premium** est recommandé, car ce type de stockage offre un débit plus élevé.</span><span class="sxs-lookup"><span data-stu-id="05ff2-136">You must choose a storage account in the same region as the cache, and a **Premium Storage** account is recommended because premium storage has higher throughput.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="05ff2-137">Si la clé de stockage pour votre compte de persistance est régénérée, vous devez reconfigurer la clé souhaitée dans la liste déroulante **Clé de stockage** .</span><span class="sxs-lookup"><span data-stu-id="05ff2-137">If the storage key for your persistence account is regenerated, you must reconfigure the desired key from the **Storage Key** drop-down.</span></span>
> 
> 

<span data-ttu-id="05ff2-138">Cliquez sur **OK** pour enregistrer la configuration de persistance.</span><span class="sxs-lookup"><span data-stu-id="05ff2-138">Click **OK** to save the persistence configuration.</span></span>

<span data-ttu-id="05ff2-139">La sauvegarde suivante (ou première sauvegarde pour les nouveaux caches) est lancée une fois que l'intervalle de fréquence de sauvegarde est écoulé.</span><span class="sxs-lookup"><span data-stu-id="05ff2-139">The next backup (or first backup for new caches) is initiated once the backup frequency interval elapses.</span></span>

## <a name="configure-aof-persistence"></a><span data-ttu-id="05ff2-140">Configuration de la persistance AOF</span><span class="sxs-lookup"><span data-stu-id="05ff2-140">Configure AOF persistence</span></span>

<span data-ttu-id="05ff2-141">Pour activer la persistance AOF, cliquez sur **AOF**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-141">To enable AOF persistence, click **AOF**.</span></span> <span data-ttu-id="05ff2-142">Pour désactiver la persistance AOF sur un cache Premium précédemment activé, cliquez sur **Désactivé**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-142">To disable AOF persistence on a previously enabled premium cache, click **Disabled**.</span></span>

![Persistance AOF Redis][redis-cache-aof-persistence]

<span data-ttu-id="05ff2-144">Pour configurer la persistance AOF, spécifiez un **Premier compte de stockage**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-144">To configure AOF persistence, specify a **First Storage Account**.</span></span> <span data-ttu-id="05ff2-145">Ce compte de stockage doit se trouver dans la même région que le cache. Un compte **Stockage Premium** est recommandé, car ce type de stockage offre un débit plus élevé.</span><span class="sxs-lookup"><span data-stu-id="05ff2-145">This storage account must be in the same region as the cache, and a **Premium Storage** account is recommended because premium storage has higher throughput.</span></span> <span data-ttu-id="05ff2-146">Vous pouvez éventuellement configurer un compte de stockage supplémentaire nommé **Deuxième compte de stockage**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-146">You can optionally configure an additional storage account named **Second Storage Account**.</span></span> <span data-ttu-id="05ff2-147">Si un deuxième compte de stockage est configuré, les opérations d’écriture dans le cache de réplica sont enregistrées dans ce deuxième compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="05ff2-147">If a second storage account is configured, the writes to the replica cache are written to this second storage account.</span></span> <span data-ttu-id="05ff2-148">Pour chaque compte de stockage configuré, sélectionnez la **clé primaire** ou **clé secondaire** à utiliser dans la liste déroulante **Clé de stockage**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-148">For each configured storage account, choose either the **Primary key** or **Secondary key** to use from the **Storage Key** drop-down.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="05ff2-149">Si la clé de stockage pour votre compte de persistance est régénérée, vous devez reconfigurer la clé souhaitée dans la liste déroulante **Clé de stockage** .</span><span class="sxs-lookup"><span data-stu-id="05ff2-149">If the storage key for your persistence account is regenerated, you must reconfigure the desired key from the **Storage Key** drop-down.</span></span>
> 
> 

<span data-ttu-id="05ff2-150">Lorsque la persistance AOF est activée, les opérations d’écriture dans le cache sont enregistrées dans le compte de stockage désigné (ou les comptes si vous avez configuré un deuxième compte de stockage).</span><span class="sxs-lookup"><span data-stu-id="05ff2-150">When AOF persistence is enabled, write operations to the cache are saved to the designated storage account (or accounts if you have configured a second storage account).</span></span> <span data-ttu-id="05ff2-151">En cas de défaillance catastrophique affectant à la fois le cache principal et le réplica, le journal AOF stocké est utilisé pour reconstruire le cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-151">In the event of a catastrophic failure that takes down both the primary and replica cache, the stored AOF log is used to rebuild the cache.</span></span>

## <a name="persistence-faq"></a><span data-ttu-id="05ff2-152">Forum aux questions sur la persistance</span><span class="sxs-lookup"><span data-stu-id="05ff2-152">Persistence FAQ</span></span>
<span data-ttu-id="05ff2-153">La liste suivante présente différentes réponses aux questions les plus fréquemment posées sur la persistance du Cache Redis Azure.</span><span class="sxs-lookup"><span data-stu-id="05ff2-153">The following list contains answers to commonly asked questions about Azure Redis Cache persistence.</span></span>

* [<span data-ttu-id="05ff2-154">Puis-je activer la persistance sur un cache créé précédemment ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-154">Can I enable persistence on a previously created cache?</span></span>](#can-i-enable-persistence-on-a-previously-created-cache)
* [<span data-ttu-id="05ff2-155">Puis-je activer la persistance AOF et RDB en même temps ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-155">Can I enable AOF and RDB persistence at the same time?</span></span>](#can-i-enable-aof-and-rdb-persistence-at-the-same-time)
* [<span data-ttu-id="05ff2-156">Quel modèle de persistance dois-je choisir ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-156">Which persistence model should I choose?</span></span>](#which-persistence-model-should-i-choose)
* [<span data-ttu-id="05ff2-157">Que se passe-t-il si j’ai mis à l’échelle vers une taille différente et si une sauvegarde antérieure à l’opération de mise à l’échelle, est restaurée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-157">What happens if I have scaled to a different size and a backup is restored that was made before the scaling operation?</span></span>](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)


### <a name="rdb-persistence"></a><span data-ttu-id="05ff2-158">Persistance RDB</span><span class="sxs-lookup"><span data-stu-id="05ff2-158">RDB persistence</span></span>
* [<span data-ttu-id="05ff2-159">Puis-je modifier la fréquence de sauvegarde RDB après avoir créé le cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-159">Can I change the RDB backup frequency after I create the cache?</span></span>](#can-i-change-the-rdb-backup-frequency-after-i-create-the-cache)
* [<span data-ttu-id="05ff2-160">Pourquoi, si la fréquence de sauvegarde RDB est de 60 minutes, y a-t-il un délai supérieur à 60 minutes entre les sauvegardes ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-160">Why if I have an RDB backup frequency of 60 minutes there is more than 60 minutes between backups?</span></span>](#why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)
* [<span data-ttu-id="05ff2-161">Qu’advient-il des anciennes sauvegardes RDB quand une nouvelle sauvegarde est effectuée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-161">What happens to the old RDB backups when a new backup is made?</span></span>](#what-happens-to-the-old-rdb-backups-when-a-new-backup-is-made)

### <a name="aof-persistence"></a><span data-ttu-id="05ff2-162">Persistance AOF</span><span class="sxs-lookup"><span data-stu-id="05ff2-162">AOF persistence</span></span>
* [<span data-ttu-id="05ff2-163">Quand dois-je utiliser un deuxième compte de stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-163">When should I use a second storage account?</span></span>](#when-should-i-use-a-second-storage-account)
* [<span data-ttu-id="05ff2-164">La persistance AOF affecte-t-elle le débit, la latence ou les performances de mon cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-164">Does AOF persistence affect throughout, latency, or performance of my cache?</span></span>](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)
* [<span data-ttu-id="05ff2-165">Comment puis-je supprimer le deuxième compte de stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-165">How can I remove the second storage account?</span></span>](#how-can-i-remove-the-second-storage-account)
* [<span data-ttu-id="05ff2-166">Qu’est-ce qu’une réécriture et comment affecte-t-elle mon cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-166">What is a rewrite and how does it affect my cache?</span></span>](#what-is-a-rewrite-and-how-does-it-affect-my-cache)
* [<span data-ttu-id="05ff2-167">À quoi dois-je attendre lors de la mise à l’échelle d’un cache avec la persistance AOF activée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-167">What should I expect when scaling a cache with AOF enabled?</span></span>](#what-should-i-expect-when-scaling-a-cache-with-aof-enabled)
* [<span data-ttu-id="05ff2-168">Comment sont organisées mes données AOF dans le stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-168">How is my AOF data organized in storage?</span></span>](#how-is-my-aof-data-organized-in-storage)


### <a name="can-i-enable-persistence-on-a-previously-created-cache"></a><span data-ttu-id="05ff2-169">Puis-je activer la persistance sur un cache créé précédemment ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-169">Can I enable persistence on a previously created cache?</span></span>
<span data-ttu-id="05ff2-170">Oui, la persistance Redis peut être configurée lors de la création du cache ou sur les caches Premium existants.</span><span class="sxs-lookup"><span data-stu-id="05ff2-170">Yes, Redis persistence can be configured both at cache creation and on existing premium caches.</span></span>

### <a name="can-i-enable-aof-and-rdb-persistence-at-the-same-time"></a><span data-ttu-id="05ff2-171">Puis-je activer la persistance AOF et RDB en même temps ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-171">Can I enable AOF and RDB persistence at the same time?</span></span>

<span data-ttu-id="05ff2-172">Non, vous pouvez uniquement activer RDB ou AOF, mais pas les deux en même temps.</span><span class="sxs-lookup"><span data-stu-id="05ff2-172">No, you can enable only RDB or AOF, but not both at the same time.</span></span>

### <a name="which-persistence-model-should-i-choose"></a><span data-ttu-id="05ff2-173">Quel modèle de persistance dois-je choisir ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-173">Which persistence model should I choose?</span></span>

<span data-ttu-id="05ff2-174">La persistance AOF enregistre chaque écriture dans un journal, ce qui a un impact sur le débit, par rapport à la persistance RDB qui enregistre des sauvegardes à l’intervalle de sauvegarde configuré, avec un impact minimal sur les performances.</span><span class="sxs-lookup"><span data-stu-id="05ff2-174">AOF persistence saves every write to a log, which has some impact on throughput, compared with RDB persistence which saves backups based on the configured backup interval, with minimal impact on performance.</span></span> <span data-ttu-id="05ff2-175">Choisissez la persistance AOF si votre objectif principal est de minimiser la perte de données et si vous pouvez gérer une réduction du débit de votre cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-175">Choose AOF persistence if your primary goal is to minimize data loss, and you can handle a decrease in throughput for your cache.</span></span> <span data-ttu-id="05ff2-176">Choisissez la persistance RDB si vous souhaitez maintenir un débit optimal de votre cache mais avez quand même besoin d’un mécanisme de récupération de données.</span><span class="sxs-lookup"><span data-stu-id="05ff2-176">Choose RDB persistence if you wish to maintain optimal throughput on your cache, but still want a mechanism for data recovery.</span></span>

* <span data-ttu-id="05ff2-177">Découvrez-en plus sur les [avantages](https://redis.io/topics/persistence#rdb-advantages) et les [inconvénients](https://redis.io/topics/persistence#rdb-disadvantages) de la persistance RDB.</span><span class="sxs-lookup"><span data-stu-id="05ff2-177">Learn more about the [advantages](https://redis.io/topics/persistence#rdb-advantages) and [disadvantages](https://redis.io/topics/persistence#rdb-disadvantages) of RDB persistence.</span></span>
* <span data-ttu-id="05ff2-178">Découvrez-en plus sur les [avantages](https://redis.io/topics/persistence#aof-advantages) et les [inconvénients](https://redis.io/topics/persistence#aof-disadvantages) de la persistance AOF.</span><span class="sxs-lookup"><span data-stu-id="05ff2-178">Learn more about the [advantages](https://redis.io/topics/persistence#aof-advantages) and [disadvantages](https://redis.io/topics/persistence#aof-disadvantages) of AOF persistence.</span></span>

<span data-ttu-id="05ff2-179">Pour plus d’informations sur les performances lors de l’utilisation de persistance AOF, consultez [La persistance affecte-t-elle le débit, la latence ou les performances de mon cache ?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)</span><span class="sxs-lookup"><span data-stu-id="05ff2-179">For more information on performance when using AOF persistence, see [Does AOF persistence affect throughout, latency, or performance of my cache?](#does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache)</span></span>

### <a name="what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation"></a><span data-ttu-id="05ff2-180">Que se passe-t-il si j’ai mis à l’échelle vers une taille différente et si une sauvegarde antérieure à l’opération de mise à l’échelle, est restaurée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-180">What happens if I have scaled to a different size and a backup is restored that was made before the scaling operation?</span></span>

<span data-ttu-id="05ff2-181">Pour la persistance RDB et AOF :</span><span class="sxs-lookup"><span data-stu-id="05ff2-181">For both RDB and AOF persistence:</span></span>

* <span data-ttu-id="05ff2-182">Si vous avez mis à l’échelle vers une plus grande taille, cela n’a aucun impact.</span><span class="sxs-lookup"><span data-stu-id="05ff2-182">If you have scaled to a larger size, there is no impact.</span></span>
* <span data-ttu-id="05ff2-183">Si vous avez mis à l’échelle vers une taille plus petite et que vous avez un paramètre personnalisé de [bases de données](cache-configure.md#databases) supérieur à la [limite des bases de données](cache-configure.md#databases) pour votre nouvelle taille, les données de ces bases de données ne sont pas restaurées.</span><span class="sxs-lookup"><span data-stu-id="05ff2-183">If you have scaled to a smaller size, and you have a custom [databases](cache-configure.md#databases) setting that is greater than the [databases limit](cache-configure.md#databases) for your new size, data in those databases isn't restored.</span></span> <span data-ttu-id="05ff2-184">Pour en savoir plus, voir [Les paramètres personnalisés de mes bases de données sont-ils affectés au cours de la mise à l’échelle ?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)</span><span class="sxs-lookup"><span data-stu-id="05ff2-184">For more information, see [Is my custom databases setting affected during scaling?](cache-how-to-scale.md#is-my-custom-databases-setting-affected-during-scaling)</span></span>
* <span data-ttu-id="05ff2-185">Si vous avez mis à l’échelle vers une plus petite taille et que l’espace est insuffisant pour contenir toutes les données issues de la dernière sauvegarde, les clés sont supprimées lors du processus de restauration, généralement à l’aide de la stratégie d’éviction [allkeys-lru](http://redis.io/topics/lru-cache) .</span><span class="sxs-lookup"><span data-stu-id="05ff2-185">If you have scaled to a smaller size, and there isn't enough room in the smaller size to hold all of the data from the last backup, keys will be evicted during the restore process, typically using the [allkeys-lru](http://redis.io/topics/lru-cache) eviction policy.</span></span>

### <a name="can-i-change-the-rdb-backup-frequency-after-i-create-the-cache"></a><span data-ttu-id="05ff2-186">Puis-je modifier la fréquence de sauvegarde RDB après avoir créé le cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-186">Can I change the RDB backup frequency after I create the cache?</span></span>
<span data-ttu-id="05ff2-187">Oui, vous pouvez modifier la fréquence de sauvegarde pour la persistance RDB dans le panneau **Persistance des données Redis**.</span><span class="sxs-lookup"><span data-stu-id="05ff2-187">Yes, you can change the backup frequency for RDB persistence on the **Redis data persistence** blade.</span></span> <span data-ttu-id="05ff2-188">Pour obtenir des instructions, consultez la page [Configuration de la persistance Redis](#configure-redis-persistence).</span><span class="sxs-lookup"><span data-stu-id="05ff2-188">For instructions, see [Configure Redis persistence](#configure-redis-persistence).</span></span>

### <a name="why-if-i-have-an-rdb-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups"></a><span data-ttu-id="05ff2-189">Pourquoi, si la fréquence de sauvegarde RDB est de 60 minutes, y a-t-il un délai supérieur à 60 minutes entre les sauvegardes ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-189">Why if I have an RDB backup frequency of 60 minutes there is more than 60 minutes between backups?</span></span>
<span data-ttu-id="05ff2-190">L’intervalle de fréquence de sauvegarde avec la persistance RDB ne démarre qu’une fois le processus de sauvegarde précédent terminé.</span><span class="sxs-lookup"><span data-stu-id="05ff2-190">The RDB persistence backup frequency interval does not start until the previous backup process has completed successfully.</span></span> <span data-ttu-id="05ff2-191">Si la fréquence de sauvegarde est de 60 minutes et que l’exécution d’un processus de sauvegarde prend 15 minutes, la sauvegarde suivante ne démarre que 75 minutes après l’heure de début de la sauvegarde précédente.</span><span class="sxs-lookup"><span data-stu-id="05ff2-191">If the backup frequency is 60 minutes and it takes a backup process 15 minutes to successfully complete, the next backup won't start until 75 minutes after the start time of the previous backup.</span></span>

### <a name="what-happens-to-the-old-rdb-backups-when-a-new-backup-is-made"></a><span data-ttu-id="05ff2-192">Qu’advient-il des anciennes sauvegardes RDB quand une nouvelle sauvegarde est effectuée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-192">What happens to the old RDB backups when a new backup is made?</span></span>
<span data-ttu-id="05ff2-193">Toutes les sauvegardes avec la persistance RDB à l’exception de la plus récente sont supprimées automatiquement.</span><span class="sxs-lookup"><span data-stu-id="05ff2-193">All RDB persistence backups except for the most recent one are automatically deleted.</span></span> <span data-ttu-id="05ff2-194">Cette suppression peut ne pas avoir lieu immédiatement, mais les anciennes sauvegardes ne sont pas conservées indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="05ff2-194">This deletion may not happen immediately but older backups are not persisted indefinitely.</span></span>


### <a name="when-should-i-use-a-second-storage-account"></a><span data-ttu-id="05ff2-195">Quand dois-je utiliser un deuxième compte de stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-195">When should I use a second storage account?</span></span>

<span data-ttu-id="05ff2-196">Vous devez utiliser un deuxième compte de stockage pour la persistance AOF lorsque vous pensez que vous avez plus d’opérations que prévues définies sur le cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-196">You should use a second storage account for AOF persistence when you believe you have higher than expected set operations on the cache.</span></span>  <span data-ttu-id="05ff2-197">La configuration du deuxième compte de stockage permet de vous assurer que votre cache n’atteindra pas les limites de bande passante de stockage.</span><span class="sxs-lookup"><span data-stu-id="05ff2-197">Setting up the secondary storage account helps ensure your cache doesn't reach storage bandwidth limits.</span></span>

### <a name="does-aof-persistence-affect-throughout-latency-or-performance-of-my-cache"></a><span data-ttu-id="05ff2-198">La persistance AOF affecte-t-elle le débit, la latence ou les performances de mon cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-198">Does AOF persistence affect throughout, latency, or performance of my cache?</span></span>

<span data-ttu-id="05ff2-199">La persistance AOF affecte le débit d’environ 15 à 20 % lorsque le cache n’a pas atteint la charge maximale (charges de l’UC et du serveur inférieures à 90 %).</span><span class="sxs-lookup"><span data-stu-id="05ff2-199">AOF persistence affects throughput by about 15% – 20% when the cache is below maximum load (CPU and Server Load both under 90%).</span></span> <span data-ttu-id="05ff2-200">Il ne devrait pas y avoir de problèmes de latence lorsque le cache se trouve dans ces limites.</span><span class="sxs-lookup"><span data-stu-id="05ff2-200">There should not be latency issues when the cache is within these limits.</span></span> <span data-ttu-id="05ff2-201">Toutefois, le cache atteindra plus rapidement ces limites avec la persistance AOF activée.</span><span class="sxs-lookup"><span data-stu-id="05ff2-201">However, the cache will reach these limits sooner with AOF enabled.</span></span>

### <a name="how-can-i-remove-the-second-storage-account"></a><span data-ttu-id="05ff2-202">Comment puis-je supprimer le deuxième compte de stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-202">How can I remove the second storage account?</span></span>

<span data-ttu-id="05ff2-203">Vous pouvez supprimer le compte de stockage secondaire pour la persistance AOF en définissant le deuxième compte de stockage de manière à ce qu’il soit identique au premier compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="05ff2-203">You can remove the AOF persistence secondary storage account by setting the second storage account to be the same as the first storage account.</span></span> <span data-ttu-id="05ff2-204">Pour obtenir des instructions, consultez la page [Configuration de la persistance AOF](#configure-aof-persistence).</span><span class="sxs-lookup"><span data-stu-id="05ff2-204">For instructions, see [Configure AOF persistence](#configure-aof-persistence).</span></span>

### <a name="what-is-a-rewrite-and-how-does-it-affect-my-cache"></a><span data-ttu-id="05ff2-205">Qu’est-ce qu’une réécriture et comment affecte-t-elle mon cache ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-205">What is a rewrite and how does it affect my cache?</span></span>

<span data-ttu-id="05ff2-206">Lorsque le fichier AOF devient suffisamment volumineux, une réécriture est automatiquement mise en file d’attente dans le cache.</span><span class="sxs-lookup"><span data-stu-id="05ff2-206">When the AOF file becomes large enough, a rewrite is automatically queued on the cache.</span></span> <span data-ttu-id="05ff2-207">La réécriture redimensionne le fichier AOF avec l’ensemble minimal d’opérations nécessaires pour créer le jeu de données en cours.</span><span class="sxs-lookup"><span data-stu-id="05ff2-207">The rewrite resizes the AOF file with the minimal set of operations needed to create the current data set.</span></span> <span data-ttu-id="05ff2-208">Durant les réécritures, attendez-vous à atteindre plus rapidement les limites de performances, en particulier lors du traitement de grands jeux de données.</span><span class="sxs-lookup"><span data-stu-id="05ff2-208">During rewrites, expect to reach performance limits sooner especially when dealing with large datasets.</span></span> <span data-ttu-id="05ff2-209">Les réécritures s’effectueront moins souvent au fur et à mesure que le fichier AOF deviendra volumineux, mais elles prendront un temps considérable le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="05ff2-209">Rewrites occur less often as the AOF file becomes larger, but will take a significant amount of time when it happens.</span></span>

### <a name="what-should-i-expect-when-scaling-a-cache-with-aof-enabled"></a><span data-ttu-id="05ff2-210">À quoi dois-je attendre lors de la mise à l’échelle d’un cache avec la persistance AOF activée ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-210">What should I expect when scaling a cache with AOF enabled?</span></span>

<span data-ttu-id="05ff2-211">Si le fichier AOF est particulièrement volumineux au moment de la mise à l’échelle, attendez-vous à ce que l’opération de mise à l’échelle soit plus longue que prévue, étant donné qu’elle rechargera le fichier une fois la mise à l’échelle terminée.</span><span class="sxs-lookup"><span data-stu-id="05ff2-211">If the AOF file at the time of scaling is significantly large, then expect the scale operation to take longer than expected since it will be reloading the file after scaling has finished.</span></span>

<span data-ttu-id="05ff2-212">Pour en savoir plus sur la mise à l’échelle, consultez [Que se passe-t-il si j’ai mis à l’échelle vers une taille différente et si une sauvegarde antérieure à l’opération de mise à l’échelle est restaurée ?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)</span><span class="sxs-lookup"><span data-stu-id="05ff2-212">For more information on scaling, see [What happens if I have scaled to a different size and a backup is restored that was made before the scaling operation?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)</span></span>

### <a name="how-is-my-aof-data-organized-in-storage"></a><span data-ttu-id="05ff2-213">Comment sont organisées mes données AOF dans le stockage ?</span><span class="sxs-lookup"><span data-stu-id="05ff2-213">How is my AOF data organized in storage?</span></span>

<span data-ttu-id="05ff2-214">Les données stockées dans des fichiers AOF sont divisées en plusieurs objets blob de pages par nœud afin d’augmenter les performances d’enregistrement des données dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="05ff2-214">Data stored in AOF files is divided into multiple page blobs per node to increase performance of saving the data to storage.</span></span> <span data-ttu-id="05ff2-215">Le tableau suivant montre comment de nombreux objets blob de pages sont utilisés pour chaque niveau tarifaire :</span><span class="sxs-lookup"><span data-stu-id="05ff2-215">The following table displays how many page blobs are used for each pricing tier:</span></span>

| <span data-ttu-id="05ff2-216">Niveau Premium</span><span class="sxs-lookup"><span data-stu-id="05ff2-216">Premium tier</span></span> | <span data-ttu-id="05ff2-217">Objets blob</span><span class="sxs-lookup"><span data-stu-id="05ff2-217">Blobs</span></span> |
|--------------|-------|
| <span data-ttu-id="05ff2-218">P1</span><span class="sxs-lookup"><span data-stu-id="05ff2-218">P1</span></span>           | <span data-ttu-id="05ff2-219">4 par partition</span><span class="sxs-lookup"><span data-stu-id="05ff2-219">4 per shard</span></span>    |
| <span data-ttu-id="05ff2-220">P2</span><span class="sxs-lookup"><span data-stu-id="05ff2-220">P2</span></span>           | <span data-ttu-id="05ff2-221">8 par partition</span><span class="sxs-lookup"><span data-stu-id="05ff2-221">8 per shard</span></span>    |
| <span data-ttu-id="05ff2-222">P3</span><span class="sxs-lookup"><span data-stu-id="05ff2-222">P3</span></span>           | <span data-ttu-id="05ff2-223">16 par partition</span><span class="sxs-lookup"><span data-stu-id="05ff2-223">16 per shard</span></span>   |
| <span data-ttu-id="05ff2-224">P4</span><span class="sxs-lookup"><span data-stu-id="05ff2-224">P4</span></span>           | <span data-ttu-id="05ff2-225">20 par partition</span><span class="sxs-lookup"><span data-stu-id="05ff2-225">20 per shard</span></span>   |

<span data-ttu-id="05ff2-226">Lorsque le clustering est activé, chaque partition dans le cache a son propre ensemble d’objets blob de pages, comme indiqué dans le tableau précédent.</span><span class="sxs-lookup"><span data-stu-id="05ff2-226">When clustering is enabled, each shard in the cache has its own set of page blobs, as indicated in the previous table.</span></span> <span data-ttu-id="05ff2-227">Par exemple, un cache P2 avec trois partitions distribue son fichier AOF entre 24 objets blob de pages (8 objets blob par partition, avec 3 partitions).</span><span class="sxs-lookup"><span data-stu-id="05ff2-227">For example, a P2 cache with three shards distributes its AOF file across 24 page blobs (8 blobs per shard, with 3 shards).</span></span>

<span data-ttu-id="05ff2-228">Après une réécriture, deux jeux de fichiers AOF se trouvent dans le stockage.</span><span class="sxs-lookup"><span data-stu-id="05ff2-228">After a rewrite, two sets of AOF files exist in storage.</span></span> <span data-ttu-id="05ff2-229">Les réécritures s’effectuent en arrière-plan et s’ajoutent au premier jeu de fichiers, alors que les opérations définies qui sont envoyées dans le cache lors de la réécriture s’ajoutent au deuxième jeu.</span><span class="sxs-lookup"><span data-stu-id="05ff2-229">Rewrites occur in the background and append to the first set of files, while set operations that are sent to the cache during the rewrite append to the second set.</span></span> <span data-ttu-id="05ff2-230">Une sauvegarde est temporairement stockée pendant les réécritures en cas d’échec, mais elle est immédiatement supprimée à la fin de la réécriture.</span><span class="sxs-lookup"><span data-stu-id="05ff2-230">A backup is temporarily stored during rewrites in case of failure, but is promptly deleted after a rewrite finishes.</span></span>


## <a name="next-steps"></a><span data-ttu-id="05ff2-231">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="05ff2-231">Next steps</span></span>
<span data-ttu-id="05ff2-232">Découvrez comment utiliser davantage de fonctionnalités de cache de niveau Premium.</span><span class="sxs-lookup"><span data-stu-id="05ff2-232">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="05ff2-233">Introduction au niveau Premium du Cache Redis Azure</span><span class="sxs-lookup"><span data-stu-id="05ff2-233">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png

[redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png

[redis-cache-rdb-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-rdb-persistence.png

[redis-cache-aof-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-aof-persistence.png

[redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png
