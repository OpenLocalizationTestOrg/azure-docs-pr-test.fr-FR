---
title: "Mise à jour d’un service cloud | Microsoft Docs"
description: "Découvrez comment mettre à jour des services cloud dans Azure. Découvrez comment mettre à jour un service cloud se poursuit pour garantir la disponibilité."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="f3d5e-104">Mettre à jour un service cloud</span><span class="sxs-lookup"><span data-stu-id="f3d5e-104">How to update a cloud service</span></span>

<span data-ttu-id="f3d5e-105">La mise à jour d’un service cloud, et notamment de ses rôles et du système d’exploitation invité, est un processus qui se déroule en trois étapes.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="f3d5e-106">Tout d’abord, les fichiers binaires et de configuration du nouveau Service Cloud et de la version de système d’exploitation doivent être téléchargés.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="f3d5e-107">Dans un deuxième temps, Azure réserve des ressources de calcul et réseau au Service Cloud selon les spécifications de la nouvelle version de Service Cloud.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="f3d5e-108">Enfin, Azure effectue une mise à niveau propagée pour effectuer une mise à jour incrémentielle du client vers la nouvelle version ou le nouveau système d’exploitation invité tout en préservant votre disponibilité.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="f3d5e-109">Cet article discute des détails de cette dernière étape, la mise à jour propagée.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="f3d5e-110">Mettre à jour un Service Azure</span><span class="sxs-lookup"><span data-stu-id="f3d5e-110">Update an Azure Service</span></span>
<span data-ttu-id="f3d5e-111">Azure organise vos instances de rôle en regroupements logiques appelés domaines de mise à niveau (UD).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="f3d5e-112">Les domaines de mise à niveau (UD) sont des ensembles logiques d’instances de rôle qui sont mis à jour en tant que groupe.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="f3d5e-113">Azure met à jour un domaine de mise à niveau de Service Cloud à la fois, ce qui permet aux instances présentes sur les autres domaines de mise à niveau de maintenir le trafic.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="f3d5e-114">Le nombre de domaines de mise à niveau par défaut est de 5.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="f3d5e-115">Vous pouvez spécifier un nombre différent de domaines de mise à niveau en incluant l’attribut upgradeDomainCount dans le fichier de définition du service (.csdef).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="f3d5e-116">Pour plus d’informations sur l’attribut upgradeDomainCount, consultez [Schéma WebRole](https://msdn.microsoft.com/library/azure/gg557553.aspx) ou [Schéma WorkerRole](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="f3d5e-117">Lorsque vous effectuez la mise à jour sur place d’un ou de plusieurs rôles dans votre service, Azure met à jour les ensembles d’instances de rôle en fonction du domaine de mise à niveau auquel ils appartiennent.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="f3d5e-118">Azure met à jour toutes les instances dans un domaine de mise à niveau donné (les arrête, les met à jour, les remet en ligne) puis passe au domaine suivant.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="f3d5e-119">En arrêtant uniquement les instances en cours d’exécution dans le domaine de mise à niveau en cours, Azure garantit que l’opération aura un impact minimal sur le service en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="f3d5e-120">Pour plus d’informations, consultez [Déroulement de la mise à niveau](#howanupgradeproceeds) plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="f3d5e-121">Bien que les termes **mise à jour** et **mise à niveau** aient une signification légèrement différente dans le contexte Azure, ils peuvent être utilisés indifféremment pour les processus et les descriptions des fonctionnalités du présent document.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="f3d5e-122">Votre service doit définir au moins deux instances d’un rôle pour que le rôle soit mis à jour sur place, sans interruption de service.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="f3d5e-123">Si le service se compose d’une seule instance de rôle, votre service sera indisponible jusqu’à la fin de la mise à jour sur place.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="f3d5e-124">Cette rubrique décrit les informations suivantes sur les mises à jour Azure :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="f3d5e-125">Modifications de service autorisées pendant une mise à jour</span><span class="sxs-lookup"><span data-stu-id="f3d5e-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="f3d5e-126">Déroulement d’une mise à niveau</span><span class="sxs-lookup"><span data-stu-id="f3d5e-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="f3d5e-127">Restauration d’une mise à jour</span><span class="sxs-lookup"><span data-stu-id="f3d5e-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="f3d5e-128">Lancement de plusieurs opérations de mutation sur un déploiement en cours</span><span class="sxs-lookup"><span data-stu-id="f3d5e-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="f3d5e-129">Distribution des rôles entre domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="f3d5e-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="f3d5e-130">Modifications de service autorisées pendant une mise à jour</span><span class="sxs-lookup"><span data-stu-id="f3d5e-130">Allowed service changes during an update</span></span>
<span data-ttu-id="f3d5e-131">Le tableau suivant présente les modifications de service autorisées au cours d’une mise à jour :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="f3d5e-132">Modifications autorisées de l’hébergement, des services et des rôles</span><span class="sxs-lookup"><span data-stu-id="f3d5e-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="f3d5e-133">Mise à jour sur place</span><span class="sxs-lookup"><span data-stu-id="f3d5e-133">In-place update</span></span> | <span data-ttu-id="f3d5e-134">Intermédiaire (échange d’adresses IP virtuelles)</span><span class="sxs-lookup"><span data-stu-id="f3d5e-134">Staged (VIP swap)</span></span> | <span data-ttu-id="f3d5e-135">Supprimer et redéployer</span><span class="sxs-lookup"><span data-stu-id="f3d5e-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="f3d5e-136">Version de système d’exploitation</span><span class="sxs-lookup"><span data-stu-id="f3d5e-136">Operating system version</span></span> |<span data-ttu-id="f3d5e-137">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-137">Yes</span></span> |<span data-ttu-id="f3d5e-138">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-138">Yes</span></span> |<span data-ttu-id="f3d5e-139">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-139">Yes</span></span> |
| <span data-ttu-id="f3d5e-140">Niveau de confiance .NET</span><span class="sxs-lookup"><span data-stu-id="f3d5e-140">.NET trust level</span></span> |<span data-ttu-id="f3d5e-141">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-141">Yes</span></span> |<span data-ttu-id="f3d5e-142">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-142">Yes</span></span> |<span data-ttu-id="f3d5e-143">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-143">Yes</span></span> |
| <span data-ttu-id="f3d5e-144">Taille de la machine virtuelle<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="f3d5e-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="f3d5e-145">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="f3d5e-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="f3d5e-146">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-146">Yes</span></span> |<span data-ttu-id="f3d5e-147">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-147">Yes</span></span> |
| <span data-ttu-id="f3d5e-148">Paramètres de stockage locaux</span><span class="sxs-lookup"><span data-stu-id="f3d5e-148">Local storage settings</span></span> |<span data-ttu-id="f3d5e-149">Augmentation uniquement<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="f3d5e-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="f3d5e-150">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-150">Yes</span></span> |<span data-ttu-id="f3d5e-151">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-151">Yes</span></span> |
| <span data-ttu-id="f3d5e-152">Ajouter et supprimer les rôles dans un service</span><span class="sxs-lookup"><span data-stu-id="f3d5e-152">Add or remove roles in a service</span></span> |<span data-ttu-id="f3d5e-153">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-153">Yes</span></span> |<span data-ttu-id="f3d5e-154">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-154">Yes</span></span> |<span data-ttu-id="f3d5e-155">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-155">Yes</span></span> |
| <span data-ttu-id="f3d5e-156">Nombre d’instances d’un rôle particulier</span><span class="sxs-lookup"><span data-stu-id="f3d5e-156">Number of instances of a particular role</span></span> |<span data-ttu-id="f3d5e-157">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-157">Yes</span></span> |<span data-ttu-id="f3d5e-158">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-158">Yes</span></span> |<span data-ttu-id="f3d5e-159">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-159">Yes</span></span> |
| <span data-ttu-id="f3d5e-160">Nombre ou type de points de terminaison pour un service</span><span class="sxs-lookup"><span data-stu-id="f3d5e-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="f3d5e-161">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="f3d5e-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="f3d5e-162">Non</span><span class="sxs-lookup"><span data-stu-id="f3d5e-162">No</span></span> |<span data-ttu-id="f3d5e-163">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-163">Yes</span></span> |
| <span data-ttu-id="f3d5e-164">Noms et valeurs de paramètres de configuration</span><span class="sxs-lookup"><span data-stu-id="f3d5e-164">Names and values of configuration settings</span></span> |<span data-ttu-id="f3d5e-165">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-165">Yes</span></span> |<span data-ttu-id="f3d5e-166">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-166">Yes</span></span> |<span data-ttu-id="f3d5e-167">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-167">Yes</span></span> |
| <span data-ttu-id="f3d5e-168">Valeurs (et non noms) des paramètres de configuration</span><span class="sxs-lookup"><span data-stu-id="f3d5e-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="f3d5e-169">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-169">Yes</span></span> |<span data-ttu-id="f3d5e-170">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-170">Yes</span></span> |<span data-ttu-id="f3d5e-171">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-171">Yes</span></span> |
| <span data-ttu-id="f3d5e-172">Ajouter de nouveau certificats</span><span class="sxs-lookup"><span data-stu-id="f3d5e-172">Add new certificates</span></span> |<span data-ttu-id="f3d5e-173">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-173">Yes</span></span> |<span data-ttu-id="f3d5e-174">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-174">Yes</span></span> |<span data-ttu-id="f3d5e-175">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-175">Yes</span></span> |
| <span data-ttu-id="f3d5e-176">Modifier les certificats existants</span><span class="sxs-lookup"><span data-stu-id="f3d5e-176">Change existing certificates</span></span> |<span data-ttu-id="f3d5e-177">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-177">Yes</span></span> |<span data-ttu-id="f3d5e-178">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-178">Yes</span></span> |<span data-ttu-id="f3d5e-179">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-179">Yes</span></span> |
| <span data-ttu-id="f3d5e-180">Déployer un nouveau code</span><span class="sxs-lookup"><span data-stu-id="f3d5e-180">Deploy new code</span></span> |<span data-ttu-id="f3d5e-181">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-181">Yes</span></span> |<span data-ttu-id="f3d5e-182">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-182">Yes</span></span> |<span data-ttu-id="f3d5e-183">Oui</span><span class="sxs-lookup"><span data-stu-id="f3d5e-183">Yes</span></span> |

<span data-ttu-id="f3d5e-184"><sup>1</sup> Modification de la taille limitée au sous-ensemble des tailles disponibles pour le service cloud.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="f3d5e-185"><sup>2</sup> Nécessite le kit de développement logiciel (SDK) Azure 1.5 ou versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="f3d5e-186">La modification de la taille de machine virtuelle détruira les données locales.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="f3d5e-187">Les éléments suivants ne sont pas pris en charge pendant une mise à jour :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="f3d5e-188">Modification du nom d’un rôle.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-188">Changing the name of a role.</span></span> <span data-ttu-id="f3d5e-189">Supprimez, puis ajoutez le rôle avec le nouveau nom.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="f3d5e-190">Modification du nombre de domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="f3d5e-191">Réduction de la taille des ressources locales.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="f3d5e-192">Si vous exécutez d’autres mises à jour de votre définition de service, comme la réduction des ressources de taille locale, vous devez exécuter une mise à jour de l’échange d’adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="f3d5e-193">Pour plus d’informations, consultez [Déploiement d’échange](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="f3d5e-194">Déroulement d’une mise à niveau</span><span class="sxs-lookup"><span data-stu-id="f3d5e-194">How an upgrade proceeds</span></span>
<span data-ttu-id="f3d5e-195">Vous pouvez décider si vous souhaitez mettre à jour tous les rôles de votre service ou un seul rôle de ce service.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="f3d5e-196">Dans les deux cas, toutes les instances de chaque rôle mis à niveau qui appartiennent au premier domaine de mise à niveau sont arrêtées, mises à niveau et remises en ligne.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="f3d5e-197">Une fois de retour en ligne, les instances du deuxième domaine de mise à niveau sont arrêtées, mises à niveau et remises en ligne.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="f3d5e-198">Un service cloud peut avoir au plus une mise à niveau active à la fois.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="f3d5e-199">La mise à niveau s’effectue toujours sur la dernière version du service cloud.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="f3d5e-200">Le diagramme suivant montre comment la mise à niveau se poursuit si vous mettez à niveau tous les rôles dans le service :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="f3d5e-201">![Mettre à niveau le service](media/cloud-services-update-azure-service/IC345879.png "Mettre à niveau le service")</span><span class="sxs-lookup"><span data-stu-id="f3d5e-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="f3d5e-202">Le diagramme suivant montre comment la mise à jour se déroule en cas de mise à jour d’un seul rôle :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="f3d5e-203">![Mettre à niveau le rôle](media/cloud-services-update-azure-service/IC345880.png "Mettre à niveau le rôle")</span><span class="sxs-lookup"><span data-stu-id="f3d5e-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="f3d5e-204">Pendant une mise à jour automatique, le 	contrôleur de structure Azure évalue de façon périodique l’état du service cloud pour déterminer quand il est temps de passer à un autre domaine de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="f3d5e-205">Cette évaluation de l’état est effectuée sur une base par rôle et considère uniquement les instances de la dernière version (c’est-à-dire les instances de domaines de mise à niveau qui ont déjà été examinées).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="f3d5e-206">Il vérifie qu’un nombre minimum d’instances de rôle, pour chaque rôle, a atteint un état terminal satisfaisant.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="f3d5e-207">Délai de démarrage de l’instance de rôle</span><span class="sxs-lookup"><span data-stu-id="f3d5e-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="f3d5e-208">Le contrôleur de structure attend 30 minutes pour que chaque instance de rôle atteigne un état démarré.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="f3d5e-209">Si la durée d'expiration est écoulée, le contrôleur de structure continuera à remonter jusqu’à l'instance de rôle suivante.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="f3d5e-210">Impact sur les données de lecteur lors de la mise à jour des services cloud</span><span class="sxs-lookup"><span data-stu-id="f3d5e-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="f3d5e-211">Lors de la mise à niveau d’un service d’instance unique vers plusieurs instances, votre service est réduit pendant que la mise à niveau est exécutée, en fonction de la façon dont Azure met à niveau les services.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="f3d5e-212">Le contrat de niveau de service garantissant la disponibilité du service ne s’applique qu’aux services déployés avec plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="f3d5e-213">La liste suivante décrit la façon dont les données de chaque lecteur sont affectées à chaque scénario de mise à niveau de service Azure :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="f3d5e-214">Scénario</span><span class="sxs-lookup"><span data-stu-id="f3d5e-214">Scenario</span></span>|<span data-ttu-id="f3d5e-215">Lecteur C</span><span class="sxs-lookup"><span data-stu-id="f3d5e-215">C Drive</span></span>|<span data-ttu-id="f3d5e-216">Lecteur D</span><span class="sxs-lookup"><span data-stu-id="f3d5e-216">D Drive</span></span>|<span data-ttu-id="f3d5e-217">Lecteur E</span><span class="sxs-lookup"><span data-stu-id="f3d5e-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="f3d5e-218">Redémarrage de la machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="f3d5e-218">VM reboot</span></span>|<span data-ttu-id="f3d5e-219">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-219">Preserved</span></span>|<span data-ttu-id="f3d5e-220">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-220">Preserved</span></span>|<span data-ttu-id="f3d5e-221">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-221">Preserved</span></span>|
|<span data-ttu-id="f3d5e-222">Redémarrage du portail</span><span class="sxs-lookup"><span data-stu-id="f3d5e-222">Portal reboot</span></span>|<span data-ttu-id="f3d5e-223">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-223">Preserved</span></span>|<span data-ttu-id="f3d5e-224">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-224">Preserved</span></span>|<span data-ttu-id="f3d5e-225">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-225">Destroyed</span></span>|
|<span data-ttu-id="f3d5e-226">Réinitialisation du portail</span><span class="sxs-lookup"><span data-stu-id="f3d5e-226">Portal reimage</span></span>|<span data-ttu-id="f3d5e-227">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-227">Preserved</span></span>|<span data-ttu-id="f3d5e-228">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-228">Destroyed</span></span>|<span data-ttu-id="f3d5e-229">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-229">Destroyed</span></span>|
|<span data-ttu-id="f3d5e-230">Mise à niveau sur place</span><span class="sxs-lookup"><span data-stu-id="f3d5e-230">In-Place Upgrade</span></span>|<span data-ttu-id="f3d5e-231">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-231">Preserved</span></span>|<span data-ttu-id="f3d5e-232">Préservé</span><span class="sxs-lookup"><span data-stu-id="f3d5e-232">Preserved</span></span>|<span data-ttu-id="f3d5e-233">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-233">Destroyed</span></span>|
|<span data-ttu-id="f3d5e-234">Migration des nœuds</span><span class="sxs-lookup"><span data-stu-id="f3d5e-234">Node migration</span></span>|<span data-ttu-id="f3d5e-235">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-235">Destroyed</span></span>|<span data-ttu-id="f3d5e-236">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-236">Destroyed</span></span>|<span data-ttu-id="f3d5e-237">Détruit</span><span class="sxs-lookup"><span data-stu-id="f3d5e-237">Destroyed</span></span>|

<span data-ttu-id="f3d5e-238">Notez que, dans la liste ci-dessus, le lecteur E: représente le lecteur racine du rôle et qu’il ne doit pas être codées en dur.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="f3d5e-239">Utilisez plutôt la variable d’environnement **%RoleRoot%** pour représenter le lecteur.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="f3d5e-240">Pour réduire les temps d’arrêt en cas de mise à niveau d’un service à instance unique, déployez un nouveau service à instances multiples sur le serveur intermédiaire et effectuez un échange d’adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="f3d5e-241">Restauration d’une mise à jour</span><span class="sxs-lookup"><span data-stu-id="f3d5e-241">Rollback of an update</span></span>
<span data-ttu-id="f3d5e-242">Azure offre une flexibilité dans la gestion des services pendant la mise à jour en vous permettant de lancer des opérations supplémentaires sur un service, une fois la demande de mise à jour initiale acceptée par le contrôleur d’architecture Azure.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="f3d5e-243">Une restauration ne peut être effectuée que lorsqu’une mise à jour (modification de configuration) ou une mise à niveau se trouve dans l’état **en cours** du déploiement.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="f3d5e-244">Une mise à jour ou mise à niveau est considérée comme en cours tant qu’il existe au moins une instance du service qui n’a pas encore été mise à jour vers la nouvelle version.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="f3d5e-245">Pour vérifier si une restauration est autorisée, assurez-vous que la valeur de l’indicateur RollbackAllowed retournée par les opérations [Obtention du déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [Obtention des propriétés de service cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx) est bien définie sur true.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="f3d5e-246">Il convient d’appeler la restauration uniquement sur une mise à jour ou une mise à niveau **sur place** , parce que les mises à niveau d’échange d’adresse virtuelle impliquent le remplacement d’une instance complète s’exécutant sur votre service avec une autre.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="f3d5e-247">Le rétablissement d’une mise à jour en cours a les effets suivants sur le déploiement :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="f3d5e-248">Toutes les instances de rôle n’ayant pas encore été mises à jour ou à niveau vers la nouvelle version ne sont ni mises à jour ni mises à niveau, car les instances s’exécutent déjà sur la version cible du service.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="f3d5e-249">Toutes les instances de rôle déjà mises à jour ou à niveau vers la nouvelle version du fichier de package de service (\*.cspkg) ou le fichier de configuration (\*.cscfg) (ou les deux fichiers) sont rétablies vers la version précédant la mise à niveau de ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="f3d5e-250">Cette fonction est assurée par les fonctionnalités suivantes :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="f3d5e-251">La [restauration de mise à jour ou de mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx), qui peut être appelée sur une mise à jour de configuration (déclenchée par un appel [Modifier la configuration du déploiement](https://msdn.microsoft.com/library/azure/ee460809.aspx)) ou une mise à niveau (déclenchée par l’appel [Mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx)) tant qu’il reste au moins une instance du service qui n’a pas encore été mise à jour vers la nouvelle version.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="f3d5e-252">L’élément Verrouillé et l’élément RollbackAllowed, qui sont retournés comme parties intégrantes du corps de réponse des opérations [Obtention du déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [Obtention des propriétés de service cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx) :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="f3d5e-253">L’élément Verrouillé permet de détecter si une opération de mutation peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="f3d5e-254">L’élément RollbackAllowed vous permet de détecter lorsque l’opération de [restauration de mise à jour ou de mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx) peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="f3d5e-255">Pour effectuer une restauration, il est inutile de vérifier les éléments Verrouillés et RollbackAllowed.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="f3d5e-256">Il suffit de vérifier que RollbackAllowed est défini sur true.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="f3d5e-257">Ces éléments sont retournés uniquement si ces méthodes sont appelées avec l’en-tête de demande défini sur « x-ms-version : 2011-10-01 » ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="f3d5e-258">Pour plus d’informations sur les en-têtes de contrôle de version, consultez [Contrôle de version de gestion de service](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="f3d5e-259">Dans certaines situations, la restauration d’une mise à jour ou d’une mise à niveau n’est pas prise en charge, notamment les suivantes :</span><span class="sxs-lookup"><span data-stu-id="f3d5e-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="f3d5e-260">Réduction des ressources locale : si la mise à jour augmente les ressources locales d’un rôle, la plateforme Azure n’autorise pas la restauration.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="f3d5e-261">Limitations de quota : si la mise à jour correspond à une opération de réduction, vous pouvez ne plus avoir suffisamment de capacité de calcul pour effectuer l’opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="f3d5e-262">Chaque abonnement Azure a un quota associé qui spécifie le nombre maximal de cœurs qui peuvent être utilisés par les services hébergés appartenant à cet abonnement.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="f3d5e-263">Si l’exécution de la restauration d’une mise à jour donnée met votre abonnement au dessus du quota, la restauration ne sera pas activée.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="f3d5e-264">Condition de concurrence : si la mise à jour initiale est terminée, la restauration est impossible.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="f3d5e-265">Exemple de la situation où le déploiement d’une mise à jour peut être utile si vous utilisez l’opération de [mise à niveau de déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx) en mode manuel pour contrôler la fréquence à laquelle la mise à niveau majeure d’un service hébergé Azure est exécutée.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="f3d5e-266">Lors du déploiement de la mise à niveau, vous appelez [Mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx) en mode manuel et commencez à parcourir les domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="f3d5e-267">Si à un moment donné, lorsque vous surveillez la mise à niveau, vous notez que des instances de rôle dans les premiers domaines de mise à niveau ne répondent plus, vous pouvez appeler une opération de [restauration de mise à jour ou de mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx) sur le déploiement, ce qui laissera les instances non mises à jour intactes, et restaurera les instances ayant été mises à niveau vers le package et la configuration de service à leur niveau antérieur.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="f3d5e-268">Lancement de plusieurs opérations de mutation sur un déploiement en cours</span><span class="sxs-lookup"><span data-stu-id="f3d5e-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="f3d5e-269">Dans certains cas, vous pouvez souhaiter initier plusieurs opérations de mutation simultanées sur un déploiement en cours.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="f3d5e-270">Par exemple, vous pouvez effectuer une mise à jour du service et, pendant la propagation de la mise à jour sur votre service, vous pouvez apporter des modifications, par exemple, restaurer la mise à jour, en appliquer une autre, ou encore supprimer le déploiement.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="f3d5e-271">Cela peut s’avérer nécessaire si une mise à niveau de service contient un code bogué qui entraîne des échecs répétés d’une instance de rôle mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="f3d5e-272">Dans ce cas, le contrôleur de structure Azure ne sera pas en mesure de faire avancer l’application de cette mise à jour, parce qu’un nombre insuffisant d’instances du domaine mis à niveau sont dans un bon état.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="f3d5e-273">Cet état est appelé *Déploiement bloqué*.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="f3d5e-274">Vous pouvez débloquer le déploiement en restaurant la mise à jour ou en appliquant une nouvelle mise à jour par dessus celle qui a échoué.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="f3d5e-275">Une fois que le contrôleur de structure Azure a reçu la demande initiale de mise à jour ou de mise à niveau, vous pouvez démarrer des opérations de mutation suivantes.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="f3d5e-276">Autrement dit, il est inutile d’attendre la fin de l’opération initiale avant de commencer une autre opération de mutation.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="f3d5e-277">Le lancement d’une deuxième opération de mise à jour pendant que la première mise à jour est en cours permet d’effectuer une opération similaire à l’opération de restauration.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="f3d5e-278">Si la deuxième mise à jour est en mode automatique, le premier domaine de mise à niveau sera immédiatement, mis à niveau, ce qui pourra éventuellement provoquer la mise hors ligne de plusieurs domaines de mise à niveau hors ligne au même moment dans le temps.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="f3d5e-279">Les opérations de mutation sont les suivantes : [Modification de la configuration du déploiement](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Mise à niveau du déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Mise à jour de l’état du déploiement](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Suppression du déploiement](https://msdn.microsoft.com/library/azure/ee460815.aspx) et [Restauration de mise à jour ou de mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="f3d5e-280">Deux opérations, [Obtention du déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [Obtention des propriétés de service cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx), retournent l’indicateur Verrouillé qui peut être examiné pour déterminer si une opération de mutation peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="f3d5e-281">Pour appeler la version de ces méthodes qui renvoie un indicateur Verrouillé, vous devez définir un en-tête de requête « x-ms-version: 2011-10-01 » ou ultérieure.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="f3d5e-282">Pour plus d’informations sur les en-têtes de contrôle de version, consultez [Contrôle de version de gestion de service](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="f3d5e-283">Distribution des rôles entre domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="f3d5e-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="f3d5e-284">Azure répartit les instances d’un rôle de manière égale sur un certain nombre de domaines de mise à niveau, qui peuvent être configurés dans le cadre du fichier de définition de service (.csdef).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="f3d5e-285">Le nombre maximal de domaines de mise à niveau est de 20, et le nombre par défaut est 5.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="f3d5e-286">Pour plus d’informations sur la façon de modifier le fichier de définition de service, consultez [Schéma de définition du service Azure (fichier .csdef)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="f3d5e-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="f3d5e-287">Par exemple, si votre rôle comporte dix instances, par défaut, chaque domaine de mise à niveau contient deux instances.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="f3d5e-288">Si votre rôle comporte 14 instances, alors quatre des domaines de mise à niveau contiennent trois instances et un cinquième domaine en contient deux.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="f3d5e-289">Les domaines de mise à niveau sont identifiés avec un index de base zéro : l’ID du premier domaine de mise à niveau est égal à 0, et le deuxième domaine de mise à niveau possède un ID de 1 et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="f3d5e-290">Le diagramme suivant montre comment un service contenant deux rôles qui sont distribués lorsque le service définit deux domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="f3d5e-291">Le service exécute huit instances de rôle web et neuf instances de rôle de travail.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="f3d5e-292">![Distribution des domaines de mise à niveau](media/cloud-services-update-azure-service/IC345533.png "Distribution des domaines de mise à niveau")</span><span class="sxs-lookup"><span data-stu-id="f3d5e-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="f3d5e-293">Notez qu’Azure contrôle la façon dont les instances sont affectées entre d’un domaine de mise à niveau à l’autre.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="f3d5e-294">Il est impossible de spécifier quelles sont les instances affectées, et à quel domaine.</span><span class="sxs-lookup"><span data-stu-id="f3d5e-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="f3d5e-295">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f3d5e-295">Next steps</span></span>
[<span data-ttu-id="f3d5e-296">Gestion des services cloud</span><span class="sxs-lookup"><span data-stu-id="f3d5e-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="f3d5e-297">Surveillance des services cloud</span><span class="sxs-lookup"><span data-stu-id="f3d5e-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="f3d5e-298">Configurer Cloud Services</span><span class="sxs-lookup"><span data-stu-id="f3d5e-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
