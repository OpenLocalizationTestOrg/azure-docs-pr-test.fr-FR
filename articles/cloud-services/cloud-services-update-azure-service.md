---
title: aaaHow tooupdate un service cloud | Documents Microsoft
description: "Découvrez comment tooupdate cloud services dans Azure. Découvrez comment une mise à jour sur un service cloud poursuit tooensure disponibilité."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 7e4c8bd46e51a555b4309ea8927d120e8efcf0ea
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooupdate-a-cloud-service"></a><span data-ttu-id="05a3e-104">Comment tooupdate un service cloud</span><span class="sxs-lookup"><span data-stu-id="05a3e-104">How tooupdate a cloud service</span></span>

<span data-ttu-id="05a3e-105">La mise à jour d’un service cloud, et notamment de ses rôles et du système d’exploitation invité, est un processus qui se déroule en trois étapes.</span><span class="sxs-lookup"><span data-stu-id="05a3e-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="05a3e-106">Tout d’abord, fichiers binaires de hello et les fichiers de configuration pour hello nouveau service de cloud computing ou version du système d’exploitation doit être téléchargée.</span><span class="sxs-lookup"><span data-stu-id="05a3e-106">First, hello binaries and configuration files for hello new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="05a3e-107">Ensuite, Azure réserve de ressources de calcul et de réseau pour le service cloud hello selon les besoins de la nouvelle version de service cloud hello hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-107">Next, Azure reserves compute and network resources for hello cloud service based on hello requirements of hello new cloud service version.</span></span> <span data-ttu-id="05a3e-108">Enfin, Azure effectue une propagée mise à niveau tooincrementally mise à jour hello client toohello nouvelle version ou invité du système d’exploitation, tout en conservant la disponibilité de votre.</span><span class="sxs-lookup"><span data-stu-id="05a3e-108">Finally, Azure performs a rolling upgrade tooincrementally update hello tenant toohello new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="05a3e-109">Cet article décrit en détail hello de cette dernière étape : hello mise à niveau propagée.</span><span class="sxs-lookup"><span data-stu-id="05a3e-109">This article discusses hello details of this last step – hello rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="05a3e-110">Mettre à jour un Service Azure</span><span class="sxs-lookup"><span data-stu-id="05a3e-110">Update an Azure Service</span></span>
<span data-ttu-id="05a3e-111">Azure organise vos instances de rôle en regroupements logiques appelés domaines de mise à niveau (UD).</span><span class="sxs-lookup"><span data-stu-id="05a3e-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="05a3e-112">Les domaines de mise à niveau (UD) sont des ensembles logiques d’instances de rôle qui sont mis à jour en tant que groupe.</span><span class="sxs-lookup"><span data-stu-id="05a3e-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="05a3e-113">Azure mises à jour un cloud service un UD à la fois, ce qui permet aux instances dans les autres toocontinue domaines d’erreur desservant le trafic.</span><span class="sxs-lookup"><span data-stu-id="05a3e-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs toocontinue serving traffic.</span></span>

<span data-ttu-id="05a3e-114">nombre de domaines de mise à niveau par défaut de Hello est 5.</span><span class="sxs-lookup"><span data-stu-id="05a3e-114">hello default number of upgrade domains is 5.</span></span> <span data-ttu-id="05a3e-115">Vous pouvez spécifier un nombre différent de domaines de mise à niveau en incluant l’attribut d’upgradeDomainCount hello dans le fichier de définition du service hello (.csdef).</span><span class="sxs-lookup"><span data-stu-id="05a3e-115">You can specify a different number of upgrade domains by including hello upgradeDomainCount attribute in hello service’s definition file (.csdef).</span></span> <span data-ttu-id="05a3e-116">Pour plus d’informations sur l’attribut d’upgradeDomainCount hello, consultez [WebRole schéma](https://msdn.microsoft.com/library/azure/gg557553.aspx) ou [WorkerRole schéma](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="05a3e-116">For more information about hello upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="05a3e-117">Lorsque vous effectuez une mise à jour sur place d’un ou plusieurs rôles dans votre service, Azure met à jour les jeux d’instances de rôle en fonction de toohello toowhich de domaine de mise à niveau qu'auquel ils appartiennent.</span><span class="sxs-lookup"><span data-stu-id="05a3e-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according toohello upgrade domain toowhich they belong.</span></span> <span data-ttu-id="05a3e-118">Azure mises à jour toutes les instances de hello dans un domaine de mise à niveau donné – les arrêter, les mettre à jour, les réafficher de sauvegarde en ligne – déplace ensuite sur le domaine suivant de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-118">Azure updates all of hello instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto hello next domain.</span></span> <span data-ttu-id="05a3e-119">En arrêtant les seules instances hello en hello actuelle mise à niveau de domaine, Azure permet de s’assurer qu’une mise à jour se produit avec hello minimales toohello d’impact sur le service en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="05a3e-119">By stopping only hello instances running in hello current upgrade domain, Azure makes sure that an update occurs with hello least possible impact toohello running service.</span></span> <span data-ttu-id="05a3e-120">Pour plus d’informations, consultez [l’exécution de mise à jour hello](#howanupgradeproceeds) plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="05a3e-120">For more information, see [How hello update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="05a3e-121">Alors que les termes du contrat de hello **mettre à jour** et **mise à niveau** ont une signification légèrement différente dans le contexte de hello Azure, ils peuvent être utilisées indifféremment pour les processus hello et les descriptions des fonctionnalités hello dans ce document.</span><span class="sxs-lookup"><span data-stu-id="05a3e-121">While hello terms **update** and **upgrade** have slightly different meaning in hello context Azure, they can be used interchangeably for hello processes and descriptions of hello features in this document.</span></span>
>
>

<span data-ttu-id="05a3e-122">Votre service doit définir au moins deux instances d’un rôle pour ce rôle toobe mis à jour sur place sans interruption de service.</span><span class="sxs-lookup"><span data-stu-id="05a3e-122">Your service must define at least two instances of a role for that role toobe updated in-place without downtime.</span></span> <span data-ttu-id="05a3e-123">Si le service de hello se compose d’une seule instance d’un rôle, votre service n’est pas disponible tant que hello mise à jour sur place est terminée.</span><span class="sxs-lookup"><span data-stu-id="05a3e-123">If hello service consists of only one instance of one role, your service will be unavailable until hello in-place update has finished.</span></span>

<span data-ttu-id="05a3e-124">Cette rubrique couvre hello d’informations sur les mises à jour Azure suivantes :</span><span class="sxs-lookup"><span data-stu-id="05a3e-124">This topic covers hello following information about Azure updates:</span></span>

* [<span data-ttu-id="05a3e-125">Modifications de service autorisées pendant une mise à jour</span><span class="sxs-lookup"><span data-stu-id="05a3e-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="05a3e-126">Déroulement d’une mise à niveau</span><span class="sxs-lookup"><span data-stu-id="05a3e-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="05a3e-127">Restauration d’une mise à jour</span><span class="sxs-lookup"><span data-stu-id="05a3e-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="05a3e-128">Lancement de plusieurs opérations de mutation sur un déploiement en cours</span><span class="sxs-lookup"><span data-stu-id="05a3e-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="05a3e-129">Distribution des rôles entre domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="05a3e-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="05a3e-130">Modifications de service autorisées pendant une mise à jour</span><span class="sxs-lookup"><span data-stu-id="05a3e-130">Allowed service changes during an update</span></span>
<span data-ttu-id="05a3e-131">Hello tableau suivant montre hello autorisé modifications tooa service pendant une mise à jour :</span><span class="sxs-lookup"><span data-stu-id="05a3e-131">hello following table shows hello allowed changes tooa service during an update:</span></span>

| <span data-ttu-id="05a3e-132">Modifications autorisées toohosting, services et des rôles</span><span class="sxs-lookup"><span data-stu-id="05a3e-132">Changes permitted toohosting, services, and roles</span></span> | <span data-ttu-id="05a3e-133">Mise à jour sur place</span><span class="sxs-lookup"><span data-stu-id="05a3e-133">In-place update</span></span> | <span data-ttu-id="05a3e-134">Intermédiaire (échange d’adresses IP virtuelles)</span><span class="sxs-lookup"><span data-stu-id="05a3e-134">Staged (VIP swap)</span></span> | <span data-ttu-id="05a3e-135">Supprimer et redéployer</span><span class="sxs-lookup"><span data-stu-id="05a3e-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="05a3e-136">Version de système d’exploitation</span><span class="sxs-lookup"><span data-stu-id="05a3e-136">Operating system version</span></span> |<span data-ttu-id="05a3e-137">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-137">Yes</span></span> |<span data-ttu-id="05a3e-138">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-138">Yes</span></span> |<span data-ttu-id="05a3e-139">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-139">Yes</span></span> |
| <span data-ttu-id="05a3e-140">Niveau de confiance .NET</span><span class="sxs-lookup"><span data-stu-id="05a3e-140">.NET trust level</span></span> |<span data-ttu-id="05a3e-141">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-141">Yes</span></span> |<span data-ttu-id="05a3e-142">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-142">Yes</span></span> |<span data-ttu-id="05a3e-143">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-143">Yes</span></span> |
| <span data-ttu-id="05a3e-144">Taille de la machine virtuelle<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="05a3e-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="05a3e-145">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="05a3e-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="05a3e-146">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-146">Yes</span></span> |<span data-ttu-id="05a3e-147">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-147">Yes</span></span> |
| <span data-ttu-id="05a3e-148">Paramètres de stockage locaux</span><span class="sxs-lookup"><span data-stu-id="05a3e-148">Local storage settings</span></span> |<span data-ttu-id="05a3e-149">Augmentation uniquement<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="05a3e-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="05a3e-150">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-150">Yes</span></span> |<span data-ttu-id="05a3e-151">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-151">Yes</span></span> |
| <span data-ttu-id="05a3e-152">Ajouter et supprimer les rôles dans un service</span><span class="sxs-lookup"><span data-stu-id="05a3e-152">Add or remove roles in a service</span></span> |<span data-ttu-id="05a3e-153">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-153">Yes</span></span> |<span data-ttu-id="05a3e-154">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-154">Yes</span></span> |<span data-ttu-id="05a3e-155">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-155">Yes</span></span> |
| <span data-ttu-id="05a3e-156">Nombre d’instances d’un rôle particulier</span><span class="sxs-lookup"><span data-stu-id="05a3e-156">Number of instances of a particular role</span></span> |<span data-ttu-id="05a3e-157">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-157">Yes</span></span> |<span data-ttu-id="05a3e-158">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-158">Yes</span></span> |<span data-ttu-id="05a3e-159">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-159">Yes</span></span> |
| <span data-ttu-id="05a3e-160">Nombre ou type de points de terminaison pour un service</span><span class="sxs-lookup"><span data-stu-id="05a3e-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="05a3e-161">Oui<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="05a3e-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="05a3e-162">Non</span><span class="sxs-lookup"><span data-stu-id="05a3e-162">No</span></span> |<span data-ttu-id="05a3e-163">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-163">Yes</span></span> |
| <span data-ttu-id="05a3e-164">Noms et valeurs de paramètres de configuration</span><span class="sxs-lookup"><span data-stu-id="05a3e-164">Names and values of configuration settings</span></span> |<span data-ttu-id="05a3e-165">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-165">Yes</span></span> |<span data-ttu-id="05a3e-166">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-166">Yes</span></span> |<span data-ttu-id="05a3e-167">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-167">Yes</span></span> |
| <span data-ttu-id="05a3e-168">Valeurs (et non noms) des paramètres de configuration</span><span class="sxs-lookup"><span data-stu-id="05a3e-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="05a3e-169">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-169">Yes</span></span> |<span data-ttu-id="05a3e-170">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-170">Yes</span></span> |<span data-ttu-id="05a3e-171">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-171">Yes</span></span> |
| <span data-ttu-id="05a3e-172">Ajouter de nouveau certificats</span><span class="sxs-lookup"><span data-stu-id="05a3e-172">Add new certificates</span></span> |<span data-ttu-id="05a3e-173">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-173">Yes</span></span> |<span data-ttu-id="05a3e-174">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-174">Yes</span></span> |<span data-ttu-id="05a3e-175">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-175">Yes</span></span> |
| <span data-ttu-id="05a3e-176">Modifier les certificats existants</span><span class="sxs-lookup"><span data-stu-id="05a3e-176">Change existing certificates</span></span> |<span data-ttu-id="05a3e-177">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-177">Yes</span></span> |<span data-ttu-id="05a3e-178">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-178">Yes</span></span> |<span data-ttu-id="05a3e-179">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-179">Yes</span></span> |
| <span data-ttu-id="05a3e-180">Déployer un nouveau code</span><span class="sxs-lookup"><span data-stu-id="05a3e-180">Deploy new code</span></span> |<span data-ttu-id="05a3e-181">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-181">Yes</span></span> |<span data-ttu-id="05a3e-182">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-182">Yes</span></span> |<span data-ttu-id="05a3e-183">Oui</span><span class="sxs-lookup"><span data-stu-id="05a3e-183">Yes</span></span> |

<span data-ttu-id="05a3e-184"><sup>1</sup> changement de taille limitée sous-ensemble toohello des tailles disponibles pour le service cloud hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-184"><sup>1</sup> Size change limited toohello subset of sizes available for hello cloud service.</span></span>

<span data-ttu-id="05a3e-185"><sup>2</sup> Nécessite le kit de développement logiciel (SDK) Azure 1.5 ou versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="05a3e-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="05a3e-186">Modification de la taille de machine virtuelle hello détruira les données locales.</span><span class="sxs-lookup"><span data-stu-id="05a3e-186">Changing hello virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="05a3e-187">Hello éléments suivants n’est pas pris en charge pendant une mise à jour :</span><span class="sxs-lookup"><span data-stu-id="05a3e-187">hello following items are not supported during an update:</span></span>

* <span data-ttu-id="05a3e-188">Changement de nom hello d’un rôle.</span><span class="sxs-lookup"><span data-stu-id="05a3e-188">Changing hello name of a role.</span></span> <span data-ttu-id="05a3e-189">Supprimez, puis ajoutez rôle hello avec le nouveau nom de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-189">Remove and then add hello role with hello new name.</span></span>
* <span data-ttu-id="05a3e-190">Modification de hello nombre de domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="05a3e-190">Changing of hello Upgrade Domain count.</span></span>
* <span data-ttu-id="05a3e-191">Diminution de la taille de hello des ressources locales de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-191">Decreasing hello size of hello local resources.</span></span>

<span data-ttu-id="05a3e-192">Si vous apportez des autres mises à jour de définition du service tooyour, tels que la diminution de la taille de hello de ressource locale, vous devez effectuer une mise à jour d’échange de VIP à la place.</span><span class="sxs-lookup"><span data-stu-id="05a3e-192">If you are making other updates tooyour service's definition, such as decreasing hello size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="05a3e-193">Pour plus d’informations, consultez [Déploiement d’échange](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="05a3e-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="05a3e-194">Déroulement d’une mise à niveau</span><span class="sxs-lookup"><span data-stu-id="05a3e-194">How an upgrade proceeds</span></span>
<span data-ttu-id="05a3e-195">Vous pouvez décider si vous souhaitez que tooupdate tous les rôles hello dans votre service ou un rôle unique dans le service hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-195">You can decide whether you want tooupdate all of hello roles in your service or a single role in hello service.</span></span> <span data-ttu-id="05a3e-196">Dans les deux cas, toutes les instances de chaque rôle qui est en cours de mise à niveau et appartiennent toohello premier domaine de mise à niveau sont arrêtés, mis à niveau et remis en ligne.</span><span class="sxs-lookup"><span data-stu-id="05a3e-196">In either case, all instances of each role that is being upgraded and belong toohello first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="05a3e-197">Une fois qu’ils sont en ligne, hello instances dans le deuxième domaine de mise à niveau hello sont arrêtés, mis à niveau et remis en ligne.</span><span class="sxs-lookup"><span data-stu-id="05a3e-197">Once they are back online, hello instances in hello second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="05a3e-198">Un service cloud peut avoir au plus une mise à niveau active à la fois.</span><span class="sxs-lookup"><span data-stu-id="05a3e-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="05a3e-199">mise à niveau Hello est toujours effectuée par rapport à la version la plus récente du service de cloud hello hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-199">hello upgrade is always performed against hello latest version of hello cloud service.</span></span>

<span data-ttu-id="05a3e-200">Hello diagramme suivant illustre comment la mise à niveau hello se poursuit si vous mettez à niveau tous les rôles hello dans le service hello :</span><span class="sxs-lookup"><span data-stu-id="05a3e-200">hello following diagram illustrates how hello upgrade proceeds if you are upgrading all of hello roles in hello service:</span></span>

<span data-ttu-id="05a3e-201">![Mettre à niveau le service](media/cloud-services-update-azure-service/IC345879.png "Mettre à niveau le service")</span><span class="sxs-lookup"><span data-stu-id="05a3e-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="05a3e-202">Le diagramme suivant montre comment la mise à jour hello se poursuit si vous mettez à niveau un seul rôle :</span><span class="sxs-lookup"><span data-stu-id="05a3e-202">This next diagram illustrates how hello update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="05a3e-203">![Mettre à niveau le rôle](media/cloud-services-update-azure-service/IC345880.png "Mettre à niveau le rôle")</span><span class="sxs-lookup"><span data-stu-id="05a3e-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="05a3e-204">Pendant une mise à jour automatique, hello contrôleur de structure Azure évalue périodiquement intégrité hello hello cloud service toodetermine lors de son toowalk safe hello UD suivant.</span><span class="sxs-lookup"><span data-stu-id="05a3e-204">During an automatic update, hello Azure Fabric Controller periodically evaluates hello health of hello cloud service toodetermine when it’s safe toowalk hello next UD.</span></span> <span data-ttu-id="05a3e-205">Cette évaluation d’intégrité est effectuée sur une base par rôle et considère que les instances dans la version la plus récente hello (autrement dit, les instances à partir de domaines d’erreur qui ont déjà été parcourues).</span><span class="sxs-lookup"><span data-stu-id="05a3e-205">This health evaluation is performed on a per-role basis and considers only instances in hello latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="05a3e-206">Il vérifie qu’un nombre minimum d’instances de rôle, pour chaque rôle, a atteint un état terminal satisfaisant.</span><span class="sxs-lookup"><span data-stu-id="05a3e-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="05a3e-207">Délai de démarrage de l’instance de rôle</span><span class="sxs-lookup"><span data-stu-id="05a3e-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="05a3e-208">Contrôleur de structure de Hello attendra 30 minutes pour chaque tooreach d’instance de rôle un état démarré.</span><span class="sxs-lookup"><span data-stu-id="05a3e-208">hello Fabric Controller will wait 30 minutes for each role instance tooreach a Started state.</span></span> <span data-ttu-id="05a3e-209">Si la durée du délai d’attente hello s’écoule, hello contrôleur de structure continuera de parcours toohello suivant instance de rôle.</span><span class="sxs-lookup"><span data-stu-id="05a3e-209">If hello timeout duration elapses, hello Fabric Controller will continue walking toohello next role instance.</span></span>

### <a name="impact-toodrive-data-during-cloud-service-upgrades"></a><span data-ttu-id="05a3e-210">Données d’impact toodrive pendant les mises à niveau de Service Cloud</span><span class="sxs-lookup"><span data-stu-id="05a3e-210">Impact toodrive data during Cloud Service upgrades</span></span>

<span data-ttu-id="05a3e-211">Lors de la mise à niveau d’un service à partir d’une instance de toomultiple instance unique votre service sera réduit pendant la mise à niveau hello est effectuée en raison de la façon de toohello Qu'azure met à niveau les services.</span><span class="sxs-lookup"><span data-stu-id="05a3e-211">When upgrading a service from a single instance toomultiple instances your service will be brought down while hello upgrade is performed due toohello way Azure upgrades services.</span></span> <span data-ttu-id="05a3e-212">Hello service contrat de niveau garantissant la disponibilité s’applique uniquement à tooservices qui sont déployés avec plusieurs instances.</span><span class="sxs-lookup"><span data-stu-id="05a3e-212">hello service level agreement guaranteeing service availability only applies tooservices that are deployed with more than one instance.</span></span> <span data-ttu-id="05a3e-213">Hello liste suivante décrit comment les données de hello sur chaque disque sont affectées par chaque scénario de mise à niveau de service Azure :</span><span class="sxs-lookup"><span data-stu-id="05a3e-213">hello following list describes how hello data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="05a3e-214">Scénario</span><span class="sxs-lookup"><span data-stu-id="05a3e-214">Scenario</span></span>|<span data-ttu-id="05a3e-215">Lecteur C</span><span class="sxs-lookup"><span data-stu-id="05a3e-215">C Drive</span></span>|<span data-ttu-id="05a3e-216">Lecteur D</span><span class="sxs-lookup"><span data-stu-id="05a3e-216">D Drive</span></span>|<span data-ttu-id="05a3e-217">Lecteur E</span><span class="sxs-lookup"><span data-stu-id="05a3e-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="05a3e-218">Redémarrage de la machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="05a3e-218">VM reboot</span></span>|<span data-ttu-id="05a3e-219">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-219">Preserved</span></span>|<span data-ttu-id="05a3e-220">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-220">Preserved</span></span>|<span data-ttu-id="05a3e-221">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-221">Preserved</span></span>|
|<span data-ttu-id="05a3e-222">Redémarrage du portail</span><span class="sxs-lookup"><span data-stu-id="05a3e-222">Portal reboot</span></span>|<span data-ttu-id="05a3e-223">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-223">Preserved</span></span>|<span data-ttu-id="05a3e-224">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-224">Preserved</span></span>|<span data-ttu-id="05a3e-225">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-225">Destroyed</span></span>|
|<span data-ttu-id="05a3e-226">Réinitialisation du portail</span><span class="sxs-lookup"><span data-stu-id="05a3e-226">Portal reimage</span></span>|<span data-ttu-id="05a3e-227">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-227">Preserved</span></span>|<span data-ttu-id="05a3e-228">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-228">Destroyed</span></span>|<span data-ttu-id="05a3e-229">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-229">Destroyed</span></span>|
|<span data-ttu-id="05a3e-230">Mise à niveau sur place</span><span class="sxs-lookup"><span data-stu-id="05a3e-230">In-Place Upgrade</span></span>|<span data-ttu-id="05a3e-231">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-231">Preserved</span></span>|<span data-ttu-id="05a3e-232">Préservé</span><span class="sxs-lookup"><span data-stu-id="05a3e-232">Preserved</span></span>|<span data-ttu-id="05a3e-233">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-233">Destroyed</span></span>|
|<span data-ttu-id="05a3e-234">Migration des nœuds</span><span class="sxs-lookup"><span data-stu-id="05a3e-234">Node migration</span></span>|<span data-ttu-id="05a3e-235">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-235">Destroyed</span></span>|<span data-ttu-id="05a3e-236">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-236">Destroyed</span></span>|<span data-ttu-id="05a3e-237">Détruit</span><span class="sxs-lookup"><span data-stu-id="05a3e-237">Destroyed</span></span>|

<span data-ttu-id="05a3e-238">Notez que, dans hello au-dessus de liste, hello lecteur E: représente le lecteur racine du rôle hello et ne doit pas être codées en dur.</span><span class="sxs-lookup"><span data-stu-id="05a3e-238">Note that, in hello above list, hello E: drive represents hello role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="05a3e-239">Au lieu de cela, utilisez hello **%roleroot%** lecteur de hello toorepresent variable environnement.</span><span class="sxs-lookup"><span data-stu-id="05a3e-239">Instead, use hello **%RoleRoot%** environment variable toorepresent hello drive.</span></span>

<span data-ttu-id="05a3e-240">temps d’arrêt hello toominimize lors de la mise à niveau d’un service à instance unique, déployez un nouveau serveur à plusieurs instances service toohello intermédiaire et effectuez un échange d’adresses IP virtuelles.</span><span class="sxs-lookup"><span data-stu-id="05a3e-240">toominimize hello downtime when upgrading a single-instance service, deploy a new multi-instance service toohello staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="05a3e-241">Restauration d’une mise à jour</span><span class="sxs-lookup"><span data-stu-id="05a3e-241">Rollback of an update</span></span>
<span data-ttu-id="05a3e-242">Azure fournit une grande souplesse dans la gestion des services pendant une mise à jour en vous permettant de lancer des opérations supplémentaires sur un service, une fois la demande de mise à jour initiale hello est accepté par le contrôleur de structure Azure de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after hello initial update request is accepted by hello Azure Fabric Controller.</span></span> <span data-ttu-id="05a3e-243">Une restauration peut être effectuée uniquement quand une mise à jour (modification de la configuration) ou de mise à niveau est Bonjour **en cours d’exécution** état sur le déploiement de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-243">A rollback can only be performed when an update (configuration change) or upgrade is in hello **in progress** state on hello deployment.</span></span> <span data-ttu-id="05a3e-244">Toobe en cours est considéré comme une mise à jour ou la mise à niveau, tant qu’il existe au moins une instance de service hello qui n’a pas encore été mis à jour toohello nouvelle version.</span><span class="sxs-lookup"><span data-stu-id="05a3e-244">An update or upgrade is considered toobe in-progress as long as there is at least one instance of hello service which has not yet been updated toohello new version.</span></span> <span data-ttu-id="05a3e-245">tootest si une restauration est autorisée, vérifiez la valeur hello d’indicateur de RollbackAllowed hello, retourné par [obtenir le déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [obtenir les propriétés de Service Cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx) opérations, a la valeur tootrue.</span><span class="sxs-lookup"><span data-stu-id="05a3e-245">tootest whether a rollback is allowed, check hello value of hello RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set tootrue.</span></span>

> [!NOTE]
> <span data-ttu-id="05a3e-246">Qu’il est judicieux toocall Rollback sur une **in situ** mettre à jour ou de mise à niveau, car l’adresse IP virtuelle impliquent de remplacer une instance en cours d’exécution complète de votre service avec un autre.</span><span class="sxs-lookup"><span data-stu-id="05a3e-246">It only makes sense toocall Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="05a3e-247">Restauration d’une mise à jour en cours a hello suivant les effets sur le déploiement de hello :</span><span class="sxs-lookup"><span data-stu-id="05a3e-247">Rollback of an in-progress update has hello following effects on hello deployment:</span></span>

* <span data-ttu-id="05a3e-248">Toutes les instances de rôle qui n’avaient pas encore été mis à jour ou mise à niveau toohello nouvelle version ne sont pas mis à jour ou mise à niveau, car ces instances sont déjà équipés hello cible du service de hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-248">Any role instances which had not yet been updated or upgraded toohello new version are not updated or upgraded, because those instances are already running hello target version of hello service.</span></span>
* <span data-ttu-id="05a3e-249">Instances de n’importe quel rôle qui a déjà été mise à jour ou toohello mis à niveau une nouvelle version du package de service hello (\*.cspkg) configuration du service de fichier ou hello (\*.cscfg) fichier (ou les deux fichiers) sont toohello restaurée de pré-mise à niveau version de Ces fichiers.</span><span class="sxs-lookup"><span data-stu-id="05a3e-249">Any role instances which had already been updated or upgraded toohello new version of hello service package (\*.cspkg) file or hello service configuration (\*.cscfg) file (or both files) are reverted toohello pre-upgrade version of these files.</span></span>

<span data-ttu-id="05a3e-250">Cette fonction est assurée par hello suivant de fonctionnalités :</span><span class="sxs-lookup"><span data-stu-id="05a3e-250">This functionally is provided by hello following features:</span></span>

* <span data-ttu-id="05a3e-251">Hello [restauration mettre à jour ou mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx) opération, qui peut être appelée sur une mise à jour de configuration (déclenchée en appelant [modifier la Configuration déploiement](https://msdn.microsoft.com/library/azure/ee460809.aspx)) ou une mise à niveau (déclenchée en appelant [ Mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx)) tant qu’il existe au moins une instance de service de hello qui n’a pas encore été mis à jour toohello nouvelle version.</span><span class="sxs-lookup"><span data-stu-id="05a3e-251">hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in hello service which has not yet been updated toohello new version.</span></span>
* <span data-ttu-id="05a3e-252">Hello verrouillé élément et élément de RollbackAllowed hello, qui sont retournées en tant que partie du corps de réponse hello Hello [obtenir le déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [obtenir les propriétés de Service Cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx) opérations :</span><span class="sxs-lookup"><span data-stu-id="05a3e-252">hello Locked element and hello RollbackAllowed element, which are returned as part of hello response body of hello [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="05a3e-253">élément verrouillé de Hello vous permet de toodetect lorsqu’une opération de mutation peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="05a3e-253">hello Locked element allows you toodetect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="05a3e-254">Hello RollbackAllowed élément vous permet de toodetect lorsque hello [restauration mise à jour ou mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx) opération peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="05a3e-254">hello RollbackAllowed element allows you toodetect when hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="05a3e-255">Dans l’ordre tooperform une restauration, il est inutile toocheck à la fois hello verrouillé et hello RollbackAllowed éléments.</span><span class="sxs-lookup"><span data-stu-id="05a3e-255">In order tooperform a rollback, you do not have toocheck both hello Locked and hello RollbackAllowed elements.</span></span> <span data-ttu-id="05a3e-256">Il suffit de tooconfirm que RollbackAllowed a la valeur tootrue.</span><span class="sxs-lookup"><span data-stu-id="05a3e-256">It suffices tooconfirm that RollbackAllowed is set tootrue.</span></span> <span data-ttu-id="05a3e-257">Ces éléments sont retournés uniquement si ces méthodes sont appelées à l’aide d’en-tête de demande de hello défini trop « x-ms-version : 2011-10-01 » ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="05a3e-257">These elements are only returned if these methods are invoked by using hello request header set too“x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="05a3e-258">Pour plus d’informations sur les en-têtes de contrôle de version, consultez [Contrôle de version de gestion de service](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="05a3e-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="05a3e-259">Dans certaines situations, la restauration d’une mise à jour ou d’une mise à niveau n’est pas prise en charge, notamment les suivantes :</span><span class="sxs-lookup"><span data-stu-id="05a3e-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="05a3e-260">Réduction des ressources locales - si hello mise à jour augmente hello des ressources locales pour un rôle hello plateforme Azure n’autorise pas restaurant.</span><span class="sxs-lookup"><span data-stu-id="05a3e-260">Reduction in local resources - If hello update increases hello local resources for a role hello Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="05a3e-261">Limitations de quota - si une mise à l’échelle vers le bas opération vous pouvez ne plus mise à jour hello n’a opération de restauration suffisante calcul quota toocomplete hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-261">Quota limitations - If hello update was a scale down operation you may no longer have sufficient compute quota toocomplete hello rollback operation.</span></span> <span data-ttu-id="05a3e-262">Chaque abonnement Azure dispose d’un quota associé qui spécifie le nombre maximal de hello de cœurs qui peuvent être consommés par tous les services hébergés qui appartiennent toothat abonnement.</span><span class="sxs-lookup"><span data-stu-id="05a3e-262">Each Azure subscription has a quota associated with it that specifies hello maximum number of cores which can be consumed by all hosted services that belong toothat subscription.</span></span> <span data-ttu-id="05a3e-263">Si l’exécution de la restauration d’une mise à jour donnée met votre abonnement au dessus du quota, la restauration ne sera pas activée.</span><span class="sxs-lookup"><span data-stu-id="05a3e-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="05a3e-264">Condition de concurrence - si la mise à jour initiale de hello terminée, une restauration n’est pas possible.</span><span class="sxs-lookup"><span data-stu-id="05a3e-264">Race condition - If hello initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="05a3e-265">Est d’un exemple de lorsque la restauration d’une mise à jour hello peut être utile si vous utilisez hello [mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx) opération taux de hello toocontrol mode manuel à laquelle un tooyour mise à niveau majeure sur place Azure le service hébergé est transférée.</span><span class="sxs-lookup"><span data-stu-id="05a3e-265">An example of when hello rollback of an update might be useful is if you are using hello [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode toocontrol hello rate at which a major in-place upgrade tooyour Azure hosted service is rolled out.</span></span>

<span data-ttu-id="05a3e-266">Lors du déploiement de mise à niveau hello hello vous appelez [mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx) en mode manuel et commencez les domaines de mise à niveau toowalk.</span><span class="sxs-lookup"><span data-stu-id="05a3e-266">During hello rollout of hello upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin toowalk upgrade domains.</span></span> <span data-ttu-id="05a3e-267">Si à un moment donné, lorsque vous analysez la mise à niveau de hello, vous notez des instances de rôle dans hello premiers domaines de mise à niveau que vous examinez sont devenues ne répond pas, vous pouvez appeler hello [restauration mise à jour ou mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx) opération sur le déploiement de hello, qui Pour laisser instances hello intact qui n’avaient pas encore été mis à niveau et les instances de restauration qui avaient été mis à niveau toohello précédent package de service et de configuration.</span><span class="sxs-lookup"><span data-stu-id="05a3e-267">If at some point, as you monitor hello upgrade, you note some role instances in hello first upgrade domains that you examine have become unresponsive, you can call hello [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on hello deployment, which will leave untouched hello instances which had not yet been upgraded and rollback instances which had been upgraded toohello previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="05a3e-268">Lancement de plusieurs opérations de mutation sur un déploiement en cours</span><span class="sxs-lookup"><span data-stu-id="05a3e-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="05a3e-269">Dans certains cas vous souhaiterez tooinitiate plusieurs opérations de mutation simultanées sur un déploiement en cours.</span><span class="sxs-lookup"><span data-stu-id="05a3e-269">In some cases you may want tooinitiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="05a3e-270">Par exemple, vous pouvez effectuer une mise à jour de service et, pendant cette mise à jour est déployée sur votre service, vous toomake certaines modifications, par exemple, tooroll hello mise à jour, appliquer une autre mise à jour ou le même supprimer hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want toomake some change, e.g. tooroll hello update back, apply a different update, or even delete hello deployment.</span></span> <span data-ttu-id="05a3e-271">Un cas dans lesquels il peut être nécessaire est si une mise à niveau de service contient un code bogué qui provoque un blocage de toorepeatedly instance rôle mis à niveau.</span><span class="sxs-lookup"><span data-stu-id="05a3e-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance toorepeatedly crash.</span></span> <span data-ttu-id="05a3e-272">Dans ce cas, hello contrôleur de structure Azure ne sera pas toomake en mesure de sa progression dans l’application de mise à niveau, car un nombre insuffisant d’instances dans le domaine de mise à niveau de hello est intègre.</span><span class="sxs-lookup"><span data-stu-id="05a3e-272">In this case, hello Azure Fabric Controller will not be able toomake progress in applying that upgrade because an insufficient number of instances in hello upgraded domain are healthy.</span></span> <span data-ttu-id="05a3e-273">Cet état est tooas auxquels un *déploiement bloqué*.</span><span class="sxs-lookup"><span data-stu-id="05a3e-273">This state is referred tooas a *stuck deployment*.</span></span> <span data-ttu-id="05a3e-274">Vous pouvez débloquer le déploiement de hello en annulation de la mise à jour hello ou en appliquant une nouvelle mise à jour par-dessus hello un échec.</span><span class="sxs-lookup"><span data-stu-id="05a3e-274">You can unstick hello deployment by rolling back hello update or applying a fresh update over top of hello failing one.</span></span>

<span data-ttu-id="05a3e-275">Une fois que le service hello hello demande initiale tooupdate ou mise à niveau a été reçu par hello contrôleur de structure Azure, vous pouvez démarrer des opérations de mutation suivantes.</span><span class="sxs-lookup"><span data-stu-id="05a3e-275">Once hello initial request tooupdate or upgrade hello service has been received by hello Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="05a3e-276">Autrement dit, vous n’avez pas les toowait pour hello opération initiale toocomplete avant de commencer une autre opération de mutation.</span><span class="sxs-lookup"><span data-stu-id="05a3e-276">That is, you do not have toowait for hello initial operation toocomplete before you can start another mutating operation.</span></span>

<span data-ttu-id="05a3e-277">Initialisation d’une deuxième opération de mise à jour lors de la première mise à jour de hello est en cours effectue une opération rollback toohello similaire.</span><span class="sxs-lookup"><span data-stu-id="05a3e-277">Initiating a second update operation while hello first update is ongoing will perform similar toohello rollback operation.</span></span> <span data-ttu-id="05a3e-278">Si la mise à jour de la deuxième hello est en mode automatique, hello premier domaine de mise à niveau est mis à niveau immédiatement, pouvant entraîner tooinstances à partir de plusieurs domaines de mise à niveau soient hors connexion au hello même point dans le temps.</span><span class="sxs-lookup"><span data-stu-id="05a3e-278">If hello second update is in automatic mode, hello first upgrade domain will be upgraded immediately, possibly leading tooinstances from multiple upgrade domains being offline at hello same point in time.</span></span>

<span data-ttu-id="05a3e-279">Hello opérations de mutation sont les suivantes : [modifier la Configuration déploiement](https://msdn.microsoft.com/library/azure/ee460809.aspx), [mettre à niveau un déploiement](https://msdn.microsoft.com/library/azure/ee460793.aspx), [état de déploiement de mise à jour](https://msdn.microsoft.com/library/azure/ee460808.aspx), [supprimer Déploiement](https://msdn.microsoft.com/library/azure/ee460815.aspx), et [mise à jour de la restauration ou de mise à niveau](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="05a3e-279">hello mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="05a3e-280">Deux opérations, [obtenir le déploiement](https://msdn.microsoft.com/library/azure/ee460804.aspx) et [obtenir les propriétés de Service Cloud](https://msdn.microsoft.com/library/azure/ee460806.aspx), retourne un indicateur de verrouillé hello qui peut être examiné toodetermine si une opération de mutation peut être appelée sur un déploiement donné.</span><span class="sxs-lookup"><span data-stu-id="05a3e-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return hello Locked flag which can be examined toodetermine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="05a3e-281">Dans la commande toocall hello version de ces méthodes qui retourne hello verrouillé indicateur, vous devez définir des en-tête de demande trop « x-ms-version : 2011-10-01 » ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="05a3e-281">In order toocall hello version of these methods which returns hello Locked flag, you must set request header too“x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="05a3e-282">Pour plus d’informations sur les en-têtes de contrôle de version, consultez [Contrôle de version de gestion de service](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="05a3e-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="05a3e-283">Distribution des rôles entre domaines de mise à niveau</span><span class="sxs-lookup"><span data-stu-id="05a3e-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="05a3e-284">Azure distribue uniformément les instances d’un rôle dans un nombre défini de domaines de mise à niveau, qui peuvent être configurés en tant que partie hello service (.csdef) du fichier de définition.</span><span class="sxs-lookup"><span data-stu-id="05a3e-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of hello service definition (.csdef) file.</span></span> <span data-ttu-id="05a3e-285">Hello le nombre maximal de domaines de mise à niveau est 20 et par défaut de hello est 5.</span><span class="sxs-lookup"><span data-stu-id="05a3e-285">hello max number of upgrade domains is 20 and hello default is 5.</span></span> <span data-ttu-id="05a3e-286">Pour plus d’informations sur la façon dont toomodify hello le fichier de définition de service, consultez [schéma de définition de Service Azure (fichier de .csdef)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="05a3e-286">For more information about how toomodify hello service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="05a3e-287">Par exemple, si votre rôle comporte dix instances, par défaut, chaque domaine de mise à niveau contient deux instances.</span><span class="sxs-lookup"><span data-stu-id="05a3e-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="05a3e-288">Si votre rôle a 14 instances, quatre des domaines de mise à niveau hello contiennent trois instances, et un cinquième domaine contient deux.</span><span class="sxs-lookup"><span data-stu-id="05a3e-288">If your role has 14 instances, then four of hello upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="05a3e-289">Domaines de mise à niveau sont identifiés avec un index de base zéro : hello premier domaine de mise à niveau a un ID égal à 0, et deuxième domaine de mise à niveau hello possède un ID de 1 et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="05a3e-289">Upgrade domains are identified with a zero-based index: hello first upgrade domain has an ID of 0, and hello second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="05a3e-290">Hello diagramme suivant illustre comment un service qui contient deux rôles sont distribués lors du service de hello définit deux domaines de mise à niveau.</span><span class="sxs-lookup"><span data-stu-id="05a3e-290">hello following diagram illustrates how a service than contains two roles are distributed when hello service defines two upgrade domains.</span></span> <span data-ttu-id="05a3e-291">service de Hello exécute huit instances de rôle web de hello et neuf instances de rôle de travail hello.</span><span class="sxs-lookup"><span data-stu-id="05a3e-291">hello service is running eight instances of hello web role and nine instances of hello worker role.</span></span>

<span data-ttu-id="05a3e-292">![Distribution des domaines de mise à niveau](media/cloud-services-update-azure-service/IC345533.png "Distribution des domaines de mise à niveau")</span><span class="sxs-lookup"><span data-stu-id="05a3e-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="05a3e-293">Notez qu’Azure contrôle la façon dont les instances sont affectées entre d’un domaine de mise à niveau à l’autre.</span><span class="sxs-lookup"><span data-stu-id="05a3e-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="05a3e-294">Il n’est pas possible toospecify les instances sont allouées toowhich domaine.</span><span class="sxs-lookup"><span data-stu-id="05a3e-294">It's not possible toospecify which instances are allocated toowhich domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="05a3e-295">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="05a3e-295">Next steps</span></span>
[<span data-ttu-id="05a3e-296">Comment les Services de cloud computing tooManage</span><span class="sxs-lookup"><span data-stu-id="05a3e-296">How tooManage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="05a3e-297">Comment les Services de cloud computing tooMonitor</span><span class="sxs-lookup"><span data-stu-id="05a3e-297">How tooMonitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="05a3e-298">Comment les Services de cloud computing tooConfigure</span><span class="sxs-lookup"><span data-stu-id="05a3e-298">How tooConfigure Cloud Services</span></span>](cloud-services-how-to-configure.md)  
