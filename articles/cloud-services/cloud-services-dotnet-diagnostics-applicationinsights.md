---
title: "Résoudre les problèmes de services cloud à l’aide d’Application Insights | Microsoft Docs"
description: "Découvrez comment résoudre les problèmes de service cloud en utilisant Application Insights pour traiter les données des diagnostics Azure."
services: cloud-services
documentationcenter: .net
author: sbtron
manager: timlt
editor: tysonn
ms.assetid: e93f387b-ef29-4731-ae41-0676722accb6
ms.service: cloud-services
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/23/2017
ms.author: saurabh
ms.openlocfilehash: 4001ca908ff00b1a40829d687589080e9b07b18a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshoot-cloud-services-using-application-insights"></a><span data-ttu-id="5f809-103">Résoudre les problèmes de Cloud Services à l’aide d’Application Insights</span><span class="sxs-lookup"><span data-stu-id="5f809-103">Troubleshoot Cloud Services using Application Insights</span></span>
<span data-ttu-id="5f809-104">Avec le kit [Azure SDK 2.8](https://azure.microsoft.com/downloads/) et l’extension des diagnostics Azure 1.5, vous pouvez envoyer directement à Application Insights les données Azure Diagnostics pour votre service cloud.</span><span class="sxs-lookup"><span data-stu-id="5f809-104">With [Azure SDK 2.8](https://azure.microsoft.com/downloads/) and Azure diagnostics extension 1.5, you can send Azure Diagnostics data for your Cloud Service directly to Application Insights.</span></span> <span data-ttu-id="5f809-105">Les journaux recueillis par Azure Diagnostics (journaux d’applications, journaux des événements Windows, journaux ETW, compteurs de performances, etc.) peuvent être envoyés à Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-105">The logs collected by Azure Diagnostics&mdash;including application logs, Windows Event Logs, ETW Logs, and performance counters&mdash;can be sent to Application Insights.</span></span> <span data-ttu-id="5f809-106">Vous pouvez dès lors visualiser ces informations dans l’interface utilisateur du portail Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-106">You can then visualize this information in the Application Insights portal UI.</span></span> <span data-ttu-id="5f809-107">Vous pouvez ensuite utiliser le kit SDK Application Insights pour tirer des enseignements des métriques et des journaux issus de votre application, mais aussi des données de niveau système et infrastructure issues d’Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="5f809-107">You can then use the Application Insights SDK to get insights into metrics and logs that come from your application, as well as the system and infrastructure-level data that comes from Azure Diagnostics.</span></span>

## <a name="configure-azure-diagnostics-to-send-data-to-application-insights"></a><span data-ttu-id="5f809-108">Configurer les diagnostics Azure pour envoyer des données à Application Insights</span><span class="sxs-lookup"><span data-stu-id="5f809-108">Configure Azure Diagnostics to send data to Application Insights</span></span>
<span data-ttu-id="5f809-109">Suivez ces étapes pour configurer votre projet de service cloud de sorte qu’il envoie les données Azure Diagnostics à Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-109">Follow these steps to set up your cloud service project to send Azure Diagnostics data to Application Insights.</span></span>

1. <span data-ttu-id="5f809-110">Dans l’Explorateur de solutions Visual Studio, cliquez avec le bouton droit sur un rôle, puis sélectionnez **Propriétés** pour ouvrir le Concepteur de rôle.</span><span class="sxs-lookup"><span data-stu-id="5f809-110">In Visual Studio Solution Explorer, right-click a role and select **Properties** to open the Role designer.</span></span>

    ![Propriétés de rôle de l'Explorateur de solutions][1]

2. <span data-ttu-id="5f809-112">Dans la section **Diagnostics** du Concepteur de rôle, sélectionnez l’option **Envoyer les données de diagnostics à Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="5f809-112">In the **Diagnostics** section of the Role designer, select the **Send diagnostics data to Application Insights** option.</span></span>

    ![Le Concepteur de rôle envoie les données des diagnostics à Application Insights][2]

3. <span data-ttu-id="5f809-114">Dans la boîte de dialogue qui s’affiche, sélectionnez la ressource Application Insights à laquelle vous voulez envoyer les données Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="5f809-114">In the dialog box that pops up, select the Application Insights resource that you want to send the Azure diagnostics data to.</span></span> <span data-ttu-id="5f809-115">Cette boîte de dialogue vous permet de sélectionner une ressource Application Insights existante dans votre abonnement ou de spécifier manuellement la clé d'instrumentation d’une ressource Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-115">The dialog box allows you to select an existing Application Insights resource from your subscription or to manually specify an instrumentation key for an Application Insights resource.</span></span> <span data-ttu-id="5f809-116">Pour plus d’informations sur la création d’une ressource Application Insights, consultez [Créer une ressource Application Insights](../application-insights/app-insights-create-new-resource.md).</span><span class="sxs-lookup"><span data-stu-id="5f809-116">For more information on creating an Application Insights resource, see [Create a new Application Insights resource](../application-insights/app-insights-create-new-resource.md).</span></span>

    ![sélectionner une ressource Application Insights][3]

    <span data-ttu-id="5f809-118">Une fois que vous avez ajouté la ressource Application Insights, la clé d’instrumentation de la ressource est stockée comme paramètre de configuration de service avec le nom **APPINSIGHTS_INSTRUMENTATIONKEY**.</span><span class="sxs-lookup"><span data-stu-id="5f809-118">Once you have added the Application Insights resource, the instrumentation key for that resource is stored as a service configuration setting with the name **APPINSIGHTS_INSTRUMENTATIONKEY**.</span></span> <span data-ttu-id="5f809-119">Vous pouvez modifier ce paramètre de configuration pour chaque configuration ou environnement de service.</span><span class="sxs-lookup"><span data-stu-id="5f809-119">You can change this configuration setting for each service configuration or environment.</span></span> <span data-ttu-id="5f809-120">Pour ce faire, sélectionnez une autre configuration dans la liste **Configuration du service**, puis spécifiez une nouvelle clé d’instrumentation pour cette configuration.</span><span class="sxs-lookup"><span data-stu-id="5f809-120">To do so, select a different configuration from the **Service Configuration** list and specify a new instrumentation key for that configuration.</span></span>

    ![sélectionner une configuration de service][4]

    <span data-ttu-id="5f809-122">Le paramètre de configuration **APPINSIGHTS_INSTRUMENTATIONKEY** est utilisé par Visual Studio pour configurer l’extension des diagnostics avec les informations appropriées de la ressource Application Insights lors de la publication.</span><span class="sxs-lookup"><span data-stu-id="5f809-122">The **APPINSIGHTS_INSTRUMENTATIONKEY** configuration setting is used by Visual Studio to configure the diagnostics extension with the appropriate Application Insights resource information during publishing.</span></span> <span data-ttu-id="5f809-123">Le paramètre de configuration est un moyen pratique de définir une clé d'instrumentation différente pour chaque configuration de service.</span><span class="sxs-lookup"><span data-stu-id="5f809-123">The configuration setting is a convenient way of defining different instrumentation keys for different service configurations.</span></span> <span data-ttu-id="5f809-124">Visual Studio traduit ce paramètre et l'insère dans la configuration publique de l’extension des diagnostics pendant le processus de publication.</span><span class="sxs-lookup"><span data-stu-id="5f809-124">Visual Studio will translate that setting and insert it into the diagnostics extension public configuration during the publish process.</span></span> <span data-ttu-id="5f809-125">Pour simplifier le processus de configuration de l’extension des diagnostics avec PowerShell, la sortie du package de Visual Studio contient aussi le fichier XML de configuration publique avec la clé d’instrumentation Application Insights appropriée.</span><span class="sxs-lookup"><span data-stu-id="5f809-125">To simplify the process of configuring the diagnostics extension with PowerShell, the package output from Visual Studio also contains the public configuration XML with the appropriate Application Insights instrumentation key.</span></span> <span data-ttu-id="5f809-126">Les fichiers de configuration publique sont créés dans le dossier Extensions et suivent le modèle *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span><span class="sxs-lookup"><span data-stu-id="5f809-126">The public config files are created in the Extensions folder and follow the pattern *PaaSDiagnostics.&lt;RoleName&gt;.PubConfig.xml*.</span></span> <span data-ttu-id="5f809-127">Les déploiements basés sur PowerShell peuvent utiliser ce modèle pour mapper chaque configuration à un rôle.</span><span class="sxs-lookup"><span data-stu-id="5f809-127">Any PowerShell-based deployments can use this pattern to map each configuration to a role.</span></span>

4) <span data-ttu-id="5f809-128">Pour configurer les diagnostics Azure de sorte qu’ils envoient à Application Insights tous les compteurs de performances et les journaux de niveau erreur, activez l’option **Envoyer les données de diagnostic à Application Insights**.</span><span class="sxs-lookup"><span data-stu-id="5f809-128">To configure Azure diagnostics to send all performance counters and error-level logs collected by the Azure diagnostics agent to Application Insights, enable the **Send diagnostics data to Application Insights** option.</span></span> 

    <span data-ttu-id="5f809-129">Si vous voulez configurer avec plus de précision les données envoyées à Application Insights, vous devez modifier manuellement le fichier *diagnostics.wadcfgx* pour chaque rôle.</span><span class="sxs-lookup"><span data-stu-id="5f809-129">If you want to further configure what data is sent to Application Insights, you must manually edit the *diagnostics.wadcfgx* file for each role.</span></span> <span data-ttu-id="5f809-130">Consultez [Configurer les diagnostics Azure pour envoyer des données à Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) pour en savoir plus sur la mise à jour manuelle de la configuration.</span><span class="sxs-lookup"><span data-stu-id="5f809-130">See [Configure Azure Diagnostics to send data to Application Insights](#configure-azure-diagnostics-to-send-data-to-application-insights) to learn more about manually updating the configuration.</span></span>

<span data-ttu-id="5f809-131">Une fois le service cloud configuré pour envoyer les données Azure Diagnostics à Application Insights, vous pouvez le déployer sur Azure normalement, en veillant à ce que l’extension des diagnostics Azure soit activée.</span><span class="sxs-lookup"><span data-stu-id="5f809-131">When the cloud service is configured to send Azure diagnostics data to application insights, you can deploy it to Azure normally, making sure the Azure diagnostics extension is enabled.</span></span> <span data-ttu-id="5f809-132">Pour plus d’informations, consultez [Publication d’un service cloud en utilisant Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span><span class="sxs-lookup"><span data-stu-id="5f809-132">For more information, see  [Publishing a Cloud Service using Visual Studio](../vs-azure-tools-publishing-a-cloud-service.md).</span></span>  

## <a name="viewing-azure-diagnostics-data-in-application-insights"></a><span data-ttu-id="5f809-133">Affichage des données des diagnostics Azure dans Application Insights</span><span class="sxs-lookup"><span data-stu-id="5f809-133">Viewing Azure diagnostics data in Application Insights</span></span>
<span data-ttu-id="5f809-134">Les données télémétriques de diagnostic Azure s’affichent dans la ressource Application Insights configurées pour votre service cloud.</span><span class="sxs-lookup"><span data-stu-id="5f809-134">The Azure diagnostic telemetry shows up in the Application Insights resource configured for your cloud service.</span></span>

<span data-ttu-id="5f809-135">Les types de journal Azure Diagnostics sont mappés aux concepts Application Insights comme suit :</span><span class="sxs-lookup"><span data-stu-id="5f809-135">Azure diagnostics log types map to Application Insights concepts in these ways:</span></span>

* <span data-ttu-id="5f809-136">Les compteurs de performances s’affichent en tant que métriques personnalisées dans Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-136">Performance counters are displayed as Custom Metrics in Application Insights.</span></span>
* <span data-ttu-id="5f809-137">Les journaux des événements Windows s’affichent en tant que traces et événements personnalisés dans Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-137">Windows Event Logs are shown as Traces and Custom Events in Application Insights.</span></span>
* <span data-ttu-id="5f809-138">Les journaux d’applications, les journaux ETW et les journaux d’infrastructure de diagnostics éventuels s’affichent en tant que traces dans Application Insights.</span><span class="sxs-lookup"><span data-stu-id="5f809-138">Application logs, ETW logs, and any Diagnostics Infrastructure logs are shown as Traces in Application Insights.</span></span>

<span data-ttu-id="5f809-139">Pour afficher les données Azure Diagnostics dans Application Insights, procédez de l’une des façons suivantes :</span><span class="sxs-lookup"><span data-stu-id="5f809-139">To view Azure diagnostics data in Application Insights, do one of the following:</span></span>

* <span data-ttu-id="5f809-140">Utilisez [Metrics Explorer](../application-insights/app-insights-metrics-explorer.md) pour visualiser les compteurs de performances personnalisés ou le nombre des différents types d’événement du journal des événements Windows.</span><span class="sxs-lookup"><span data-stu-id="5f809-140">Use [Metrics explorer](../application-insights/app-insights-metrics-explorer.md) to visualize any custom performance counters or counts of different types of Windows Event Log events.</span></span>

    ![Métriques personnalisées dans Metrics Explorer][5]

* <span data-ttu-id="5f809-142">Utilisez [Search](../application-insights/app-insights-diagnostic-search.md) pour effectuer des recherches dans les journaux des traces envoyés par Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="5f809-142">Use [Search](../application-insights/app-insights-diagnostic-search.md) to search across the  trace logs sent by Azure Diagnostics.</span></span> <span data-ttu-id="5f809-143">Par exemple, si une exception non prise en charge a occasionné un incident et le recyclage du rôle, les informations sur l’exception s’affichent dans le canal *Application* du *Journal des événements Windows*.</span><span class="sxs-lookup"><span data-stu-id="5f809-143">For example, if an unhandled exception has caused the role to crash and recycle, information about the exception shows up in the *Application* channel of *Windows Event Log*.</span></span> <span data-ttu-id="5f809-144">Vous pouvez utiliser Search pour rechercher l’erreur du Journal des événements Windows et obtenir la trace de pile complète de l’exception pour identifier la cause du problème.</span><span class="sxs-lookup"><span data-stu-id="5f809-144">You can use search to look at the Windows Event Log error and get the full stack trace for the exception to help find the cause of the issue.</span></span>

    ![Rechercher dans les traces][6]

## <a name="next-steps"></a><span data-ttu-id="5f809-146">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="5f809-146">Next Steps</span></span>
* <span data-ttu-id="5f809-147">[Ajouter le Kit de développement logiciel (SDK) Application Insights à votre service cloud](../application-insights/app-insights-cloudservices.md) pour envoyer des données sur les demandes, les exceptions, les dépendances et la télémétrie personnalisée à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="5f809-147">[Add the Application Insights SDK to your cloud service](../application-insights/app-insights-cloudservices.md) to send data about requests, exceptions, dependencies, and any custom telemetry from your application.</span></span> <span data-ttu-id="5f809-148">En combinant ces informations avec les données Azure Diagnostics, vous pouvez obtenir une vue complète de votre application et du système dans la même ressource Application Insight.</span><span class="sxs-lookup"><span data-stu-id="5f809-148">When combined with the Azure Diagnostics data, this information you can get a complete view of your application and system, all in the same Application Insight resource.</span></span>  

<!--Image references-->
[1]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/solution-explorer-properties.png
[2]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-sendtoappinsights.png
[3]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/select-appinsights-resource.png
[4]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/role-designer-appinsights-serviceconfig.png
[5]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/metrics-explorer-custom-metrics.png
[6]: ./media/cloud-services-dotnet-diagnostics-applicationinsights/search-windowseventlog-error.png
