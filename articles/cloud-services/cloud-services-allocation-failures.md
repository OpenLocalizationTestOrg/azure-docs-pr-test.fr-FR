---
title: "Échec d’allocation de Service de cloud computing d’aaaTroubleshooting | Documents Microsoft"
description: "Résolution des problèmes d'échec d'allocation lors du déploiement de services cloud dans Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="65f08-103">Résolution des problèmes d'échec d'allocation lors du déploiement de services cloud dans Azure</span><span class="sxs-lookup"><span data-stu-id="65f08-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="65f08-104">Résumé</span><span class="sxs-lookup"><span data-stu-id="65f08-104">Summary</span></span>
<span data-ttu-id="65f08-105">Lorsque vous déployez des instances tooa Service de cloud computing ou que vous ajoutez un site web ou des instances de rôle de travail, Microsoft Azure alloue des ressources de calcul.</span><span class="sxs-lookup"><span data-stu-id="65f08-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="65f08-106">Vous pouvez parfois recevoir des erreurs lorsque vous effectuez ces opérations avant même que vous atteigniez les limites d’abonnement Azure hello.</span><span class="sxs-lookup"><span data-stu-id="65f08-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="65f08-107">Cet article explique les causes hello de certaines hello courants d’échecs d’allocation et suggère des corrections possibles.</span><span class="sxs-lookup"><span data-stu-id="65f08-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="65f08-108">Hello informations peuvent également être utiles lorsque vous planifiez le déploiement de hello de vos services.</span><span class="sxs-lookup"><span data-stu-id="65f08-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="65f08-109">Fonctionne de l’allocation en arrière-plan</span><span class="sxs-lookup"><span data-stu-id="65f08-109">Background – How allocation works</span></span>
<span data-ttu-id="65f08-110">serveurs Hello dans les centres de données Azure sont partitionnés en clusters.</span><span class="sxs-lookup"><span data-stu-id="65f08-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="65f08-111">Une nouvelle demande d'allocation de service cloud est tentée dans plusieurs clusters.</span><span class="sxs-lookup"><span data-stu-id="65f08-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="65f08-112">Lorsque la première instance de hello est service de cloud tooa déployé (en soit intermédiaire ou de production), que le service cloud obtient tooa épinglé cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="65f08-113">Les autres déploiements pour le service de cloud computing hello se produira hello même cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="65f08-114">Dans cet article, nous l’appellerons toothis en tant que « cluster tooa épinglé ».</span><span class="sxs-lookup"><span data-stu-id="65f08-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="65f08-115">Le diagramme 1 ci-dessous illustre le cas hello d’une allocation normale qui est tentée dans plusieurs clusters ; Figure 2 illustre les cas de hello d’une allocation tooCluster épinglée de 2 car qui est hello où CS_1 de Service Cloud existant est hébergé.</span><span class="sxs-lookup"><span data-stu-id="65f08-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![Schéma d’allocation](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="65f08-117">Raisons de l’échec d’une allocation</span><span class="sxs-lookup"><span data-stu-id="65f08-117">Why allocation failure happens</span></span>
<span data-ttu-id="65f08-118">Lorsqu’une demande d’allocation est épinglé tooa cluster, il existe un risque plus élevé d’échec toofind libérer des ressources, car le pool de ressources disponibles hello est limitée tooa cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="65f08-119">En outre, si votre demande d’allocation est épinglé tooa cluster, mais de type hello de ressource que vous avez demandée n’est pas pris en charge par ce cluster, votre demande échoue même si le cluster de hello dispose des ressources gratuites.</span><span class="sxs-lookup"><span data-stu-id="65f08-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="65f08-120">Diagramme 3 ci-dessous illustre les cas de hello où une allocation en attente échoue parce que le cluster de candidat uniquement hello n’a pas de libérer des ressources.</span><span class="sxs-lookup"><span data-stu-id="65f08-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="65f08-121">Figure 4 illustre les cas de hello où une allocation en attente échoue parce que le cluster de candidat hello uniquement ne prend pas en charge hello demandé la taille de machine virtuelle, même si le cluster de hello a libérer des ressources.</span><span class="sxs-lookup"><span data-stu-id="65f08-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![Échec d’allocation épinglée](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="65f08-123">Résolution des problèmes d'échec d'allocation pour les services cloud</span><span class="sxs-lookup"><span data-stu-id="65f08-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="65f08-124">Message d’erreur</span><span class="sxs-lookup"><span data-stu-id="65f08-124">Error Message</span></span>
<span data-ttu-id="65f08-125">Vous pouvez voir hello message d’erreur suivant :</span><span class="sxs-lookup"><span data-stu-id="65f08-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="65f08-126">Problèmes courants</span><span class="sxs-lookup"><span data-stu-id="65f08-126">Common Issues</span></span>
<span data-ttu-id="65f08-127">Voici hello allocation scénarios courants qui provoquent un cluster unique d’allocation demande toobe tooa épinglés.</span><span class="sxs-lookup"><span data-stu-id="65f08-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="65f08-128">Déploiement tooStaging emplacement - si un service cloud dispose d’un déploiement dans les deux emplacements, puis service de cloud entière hello est épinglé tooa spécifique du cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="65f08-129">Cela signifie que s’il existe déjà un déploiement dans l’emplacement de production hello, puis un nouveau déploiement intermédiaire ne peut être affecté Bonjour même cluster en tant qu’emplacement de production hello.</span><span class="sxs-lookup"><span data-stu-id="65f08-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="65f08-130">Si le cluster de hello est proche de sa capacité, demande de hello peut échouer.</span><span class="sxs-lookup"><span data-stu-id="65f08-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="65f08-131">Mise à l’échelle : ajout de nouvelles instances tooan service de cloud computing doit allouer Bonjour même cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="65f08-132">Les demandes de mise à l'échelle minime peuvent généralement être allouées, mais pas toujours.</span><span class="sxs-lookup"><span data-stu-id="65f08-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="65f08-133">Si le cluster de hello est proche de sa capacité, demande de hello peut échouer.</span><span class="sxs-lookup"><span data-stu-id="65f08-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="65f08-134">Groupe d’affinités - un nouveau service de cloud vide tooan de déploiement peut être alloué par fabric hello dans n’importe quel cluster dans cette région, sauf si le service de cloud computing hello est épinglé tooan affinité du groupe.</span><span class="sxs-lookup"><span data-stu-id="65f08-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="65f08-135">Toohello déploiements même groupe d’affinités va être tentée sur hello même cluster.</span><span class="sxs-lookup"><span data-stu-id="65f08-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="65f08-136">Si le cluster de hello est proche de sa capacité, demande de hello peut échouer.</span><span class="sxs-lookup"><span data-stu-id="65f08-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="65f08-137">Réseau virtuel de groupe d’affinités - réseaux virtuels plus anciens ont été groupes tooaffinity liée à la place des régions, et les services de cloud computing dans ces réseaux virtuels serait cluster du groupe d’affinités toohello épinglés.</span><span class="sxs-lookup"><span data-stu-id="65f08-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="65f08-138">Type de toothis de déploiements de réseau virtuel va être tentée sur le cluster de hello épinglée.</span><span class="sxs-lookup"><span data-stu-id="65f08-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="65f08-139">Si le cluster de hello est proche de sa capacité, demande de hello peut échouer.</span><span class="sxs-lookup"><span data-stu-id="65f08-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="65f08-140">Solutions</span><span class="sxs-lookup"><span data-stu-id="65f08-140">Solutions</span></span>
1. <span data-ttu-id="65f08-141">Redéploiement tooa nouveau service cloud - cette solution est probablement toobe plus de succès car elle permet de toochoose de plateforme hello de tous les clusters dans cette région.</span><span class="sxs-lookup"><span data-stu-id="65f08-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="65f08-142">Déployez la charge de travail hello tooa nouveau service de cloud</span><span class="sxs-lookup"><span data-stu-id="65f08-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="65f08-143">Mettre à jour hello CNAME ou un enregistrement toopoint trafic toohello nouveau service cloud</span><span class="sxs-lookup"><span data-stu-id="65f08-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="65f08-144">Une fois que le trafic de zéro va toohello ancien site, vous pouvez supprimer le service de cloud ancien hello.</span><span class="sxs-lookup"><span data-stu-id="65f08-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="65f08-145">Cette solution ne devrait pas entraîner de temps d'arrêt.</span><span class="sxs-lookup"><span data-stu-id="65f08-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="65f08-146">Supprimer la production et la mise en lots d’emplacements : cette solution permet de conserver votre nom DNS existante, mais entraîne l’application de tooyour de temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="65f08-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="65f08-147">Suppression de production de hello et intermédiaire des emplacements d’un service cloud existant afin que le service de cloud computing hello est vide, puis</span><span class="sxs-lookup"><span data-stu-id="65f08-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="65f08-148">Créer un nouveau déploiement dans le service cloud existant hello.</span><span class="sxs-lookup"><span data-stu-id="65f08-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="65f08-149">Tooallocation sur tous les clusters dans la région de hello réessaye.</span><span class="sxs-lookup"><span data-stu-id="65f08-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="65f08-150">Vérifiez le service de cloud computing hello n’est pas un groupe d’affinités de tooan liée.</span><span class="sxs-lookup"><span data-stu-id="65f08-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="65f08-151">Adresse IP réservée - cette solution permet de conserver votre adresse IP existante d’adresses, mais entraîne application tooyour de temps d’arrêt.</span><span class="sxs-lookup"><span data-stu-id="65f08-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="65f08-152">Créez une IP réservée pour votre déploiement à l'aide de PowerShell</span><span class="sxs-lookup"><span data-stu-id="65f08-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="65f08-153">Suivez #2 supérieure, rendre toospecify vraiment hello nouvelle adresse IP réservée dans CSCFG du service hello.</span><span class="sxs-lookup"><span data-stu-id="65f08-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="65f08-154">Supprimer le groupe d'affinités pour les nouveaux déploiements : les groupes d'affinités ne sont plus recommandés.</span><span class="sxs-lookup"><span data-stu-id="65f08-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="65f08-155">Suivez les étapes de #1 ci-dessus toodeploy un nouveau service cloud.</span><span class="sxs-lookup"><span data-stu-id="65f08-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="65f08-156">Vérifiez que le service cloud n'est pas dans un groupe d'affinités.</span><span class="sxs-lookup"><span data-stu-id="65f08-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="65f08-157">Convertir tooa réseau virtuel régional - voir [comment toomigrate à partir de groupes d’affinités tooa réseau virtuel régional (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="65f08-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>
