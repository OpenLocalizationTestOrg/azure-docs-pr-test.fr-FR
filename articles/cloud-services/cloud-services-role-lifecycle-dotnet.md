---
title: "événements de cycle de vie de Service Cloud aaaHandle | Documents Microsoft"
description: "Explique comment utiliser des méthodes de cycle de vie hello d’un rôle de Service de cloud computing dans .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: cc0ccc5f055b965202b6e081a6ab72ad5d39b034
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="customize-hello-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="bc44e-103">Personnaliser hello du cycle de vie d’un rôle Web ou de travail dans .NET</span><span class="sxs-lookup"><span data-stu-id="bc44e-103">Customize hello Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="bc44e-104">Lorsque vous créez un rôle de travail, vous étendez hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe qui fournit des méthodes pour vous toooverride qui vous permettre de répondre à des événements de toolifecycle.</span><span class="sxs-lookup"><span data-stu-id="bc44e-104">When you create a worker role, you extend hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you toooverride that let you respond toolifecycle events.</span></span> <span data-ttu-id="bc44e-105">Pour les rôles web, cette classe est facultative, vous devez l’utiliser dans les événements toolifecycle toorespond.</span><span class="sxs-lookup"><span data-stu-id="bc44e-105">For web roles this class is optional, so you must use it toorespond toolifecycle events.</span></span>

## <a name="extend-hello-roleentrypoint-class"></a><span data-ttu-id="bc44e-106">Étendre la classe RoleEntryPoint de hello</span><span class="sxs-lookup"><span data-stu-id="bc44e-106">Extend hello RoleEntryPoint class</span></span>
<span data-ttu-id="bc44e-107">Hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) classe inclut des méthodes qui sont appelées par Azure lorsqu’elle **démarre**, **exécute**, ou **arrête** un rôle web ou de travail.</span><span class="sxs-lookup"><span data-stu-id="bc44e-107">hello [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="bc44e-108">Vous pouvez éventuellement substituer ces l’initialisation toomanage méthodes, séquences d’arrêt ou thread d’exécution hello du rôle de hello.</span><span class="sxs-lookup"><span data-stu-id="bc44e-108">You can optionally override these methods toomanage role initialization, role shutdown sequences, or hello execution thread of hello role.</span></span> 

<span data-ttu-id="bc44e-109">Lors de l’extension **RoleEntryPoint**, vous devez être conscient de hello suit les comportements des méthodes de hello :</span><span class="sxs-lookup"><span data-stu-id="bc44e-109">When extending **RoleEntryPoint**, you should be aware of hello following behaviors of hello methods:</span></span>

* <span data-ttu-id="bc44e-110">Hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) et [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) méthodes retournent une valeur booléenne, il est possible de tooreturn **false** à partir de ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="bc44e-110">hello [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible tooreturn **false** from these methods.</span></span>
  
   <span data-ttu-id="bc44e-111">Si votre code renvoie **false**, processus de rôle hello se termine soudainement, sans exécuter une séquence d’arrêt peut avoir.</span><span class="sxs-lookup"><span data-stu-id="bc44e-111">If your code returns **false**, hello role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="bc44e-112">En règle générale, vous devez éviter de retourner **false** de hello **OnStart** (méthode).</span><span class="sxs-lookup"><span data-stu-id="bc44e-112">In general, you should avoid returning **false** from hello **OnStart** method.</span></span>
* <span data-ttu-id="bc44e-113">Une exception non interceptée dans la surcharge d'une méthode **RoleEntryPoint** est traitée comme une exception non gérée.</span><span class="sxs-lookup"><span data-stu-id="bc44e-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="bc44e-114">Si une exception se produit dans une des méthodes de cycle de vie hello, Azure déclenche hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) événement, et ensuite les processus hello sont terminée.</span><span class="sxs-lookup"><span data-stu-id="bc44e-114">If an exception occurs within one of hello lifecycle methods, Azure will raise hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then hello process is terminated.</span></span> <span data-ttu-id="bc44e-115">Une fois mis hors connexion, votre rôle sera redémarré par Azure.</span><span class="sxs-lookup"><span data-stu-id="bc44e-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="bc44e-116">Lorsqu’une exception non gérée se produit, hello [arrêt](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) événement n’est pas déclenché et hello **OnStop** méthode n’est pas appelée.</span><span class="sxs-lookup"><span data-stu-id="bc44e-116">When an unhandled exception occurs, hello [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and hello **OnStop** method is not called.</span></span>

<span data-ttu-id="bc44e-117">Si votre rôle ne démarre pas ou est recyclé entre hello l’initialisation, occupés et arrêt des États, votre code peut lever une exception non gérée dans un des événements de cycle de vie hello que chaque rôle de hello temps redémarre.</span><span class="sxs-lookup"><span data-stu-id="bc44e-117">If your role does not start, or is recycling between hello initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of hello lifecycle events each time hello role restarts.</span></span> <span data-ttu-id="bc44e-118">Dans ce cas, utilisez hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) événement toodetermine hello la cause de l’exception de hello et gérer de façon appropriée.</span><span class="sxs-lookup"><span data-stu-id="bc44e-118">In this case, use hello [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event toodetermine hello cause of hello exception and handle it appropriately.</span></span> <span data-ttu-id="bc44e-119">Votre rôle peut également retourner hello [exécuter](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) (méthode), ce qui amène hello rôle toorestart.</span><span class="sxs-lookup"><span data-stu-id="bc44e-119">Your role may also be returning from hello [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes hello role toorestart.</span></span> <span data-ttu-id="bc44e-120">Pour plus d’informations sur les États de déploiement, consultez [tooRecycle de problèmes qui Cause rôles](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="bc44e-120">For more information about deployment states, see [Common Issues Which Cause Roles tooRecycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="bc44e-121">Si vous utilisez hello **Azure Tools pour Microsoft Visual Studio** toodevelop votre application, des modèles de projet hello rôle étendent automatiquement hello **RoleEntryPoint** classe pour vous, Bonjour *WebRole.cs* et *WorkerRole.cs* fichiers.</span><span class="sxs-lookup"><span data-stu-id="bc44e-121">If you are using hello **Azure Tools for Microsoft Visual Studio** toodevelop your application, hello role project templates automatically extend hello **RoleEntryPoint** class for you, in hello *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="bc44e-122">Méthode OnStart</span><span class="sxs-lookup"><span data-stu-id="bc44e-122">OnStart method</span></span>
<span data-ttu-id="bc44e-123">Hello **OnStart** méthode est appelée lorsque votre instance de rôle est remise en ligne par Azure.</span><span class="sxs-lookup"><span data-stu-id="bc44e-123">hello **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="bc44e-124">Pendant l’exécution de hello code OnStart, l’instance de rôle hello est marqué comme **occupé** et aucun trafic externe ne sera tooit dirigé par l’équilibrage de charge hello.</span><span class="sxs-lookup"><span data-stu-id="bc44e-124">While hello OnStart code is executing, hello role instance is marked as **Busy** and no external traffic will be directed tooit by hello load balancer.</span></span> <span data-ttu-id="bc44e-125">Vous pouvez substituer cet méthode tooperform du travail d’initialisation, telles que la mise en œuvre des gestionnaires d’événements et le démarrage [Azure Diagnostics](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="bc44e-125">You can override this method tooperform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="bc44e-126">Si **OnStart** retourne **true**, hello instance est correctement initialisée et Azure appelle hello **RoleEntryPoint.Run** (méthode).</span><span class="sxs-lookup"><span data-stu-id="bc44e-126">If **OnStart** returns **true**, hello instance is successfully initialized and Azure calls hello **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="bc44e-127">Si **OnStart** retourne **false**, rôle de hello se termine immédiatement, sans exécuter les séquences d’arrêt planifié.</span><span class="sxs-lookup"><span data-stu-id="bc44e-127">If **OnStart** returns **false**, hello role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="bc44e-128">Hello suivant exemple de code montre comment toooverride hello **OnStart** (méthode).</span><span class="sxs-lookup"><span data-stu-id="bc44e-128">hello following code example shows how toooverride hello **OnStart** method.</span></span> <span data-ttu-id="bc44e-129">Cette méthode configure et démarre un moniteur de diagnostic lors de l’instance de rôle hello démarre et définit un transfert de la journalisation de compte de stockage de données tooa :</span><span class="sxs-lookup"><span data-stu-id="bc44e-129">This method configures and starts a diagnostic monitor when hello role instance starts and sets up a transfer of logging data tooa storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="bc44e-130">Méthode OnStop</span><span class="sxs-lookup"><span data-stu-id="bc44e-130">OnStop method</span></span>
<span data-ttu-id="bc44e-131">Hello **OnStop** méthode est appelée après qu’une instance de rôle a été mises hors connexion par Azure et avant l’arrêt du processus hello.</span><span class="sxs-lookup"><span data-stu-id="bc44e-131">hello **OnStop** method is called after a role instance has been taken offline by Azure and before hello process exits.</span></span> <span data-ttu-id="bc44e-132">Vous pouvez remplacer ce code toocall de méthode requis pour votre toocleanly d’instance de rôle arrêté.</span><span class="sxs-lookup"><span data-stu-id="bc44e-132">You can override this method toocall code required for your role instance toocleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bc44e-133">Le code s’exécutant dans hello **OnStop** méthode a une durée limitée de toofinish lorsqu’elle est appelée pour des raisons autres qu’un arrêt initié par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bc44e-133">Code running in hello **OnStop** method has a limited time toofinish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="bc44e-134">Une fois cette durée écoulée, processus de hello se termine, donc vous devez vous assurer que le code Bonjour **OnStop** méthode peut s’exécuter rapidement ou qu’il peut ne pas en cours d’exécution toocompletion.</span><span class="sxs-lookup"><span data-stu-id="bc44e-134">After this time elapses, hello process is terminated, so you must make sure that code in hello **OnStop** method can run quickly or tolerates not running toocompletion.</span></span> <span data-ttu-id="bc44e-135">Hello **OnStop** méthode est appelée après hello **arrêt** événement est déclenché.</span><span class="sxs-lookup"><span data-stu-id="bc44e-135">hello **OnStop** method is called after hello **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="bc44e-136">Méthode Run</span><span class="sxs-lookup"><span data-stu-id="bc44e-136">Run method</span></span>
<span data-ttu-id="bc44e-137">Vous pouvez remplacer hello **exécuter** méthode tooimplement un thread d’exécution longue pour votre instance de rôle.</span><span class="sxs-lookup"><span data-stu-id="bc44e-137">You can override hello **Run** method tooimplement a long-running thread for your role instance.</span></span>

<span data-ttu-id="bc44e-138">Substitution de hello **exécuter** méthode n’est pas requise ; l’implémentation par défaut de hello démarre un thread qui se met en veille indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="bc44e-138">Overriding hello **Run** method is not required; hello default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="bc44e-139">Si vous ne substituez pas hello **exécuter** méthode, votre code sera bloqué indéfiniment.</span><span class="sxs-lookup"><span data-stu-id="bc44e-139">If you do override hello **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="bc44e-140">Si hello **exécuter** méthode est retournée, rôle de hello est automatiquement normalement recyclé ; en d’autres termes, Azure déclenche hello **arrêt** hello d’événements et les appels **OnStop** méthode afin que vos séquences d’arrêt puissent être exécutées avant que le rôle de hello est mis hors connexion.</span><span class="sxs-lookup"><span data-stu-id="bc44e-140">If hello **Run** method returns, hello role is automatically gracefully recycled; in other words, Azure raises hello **Stopping** event and calls hello **OnStop** method so that your shutdown sequences may be executed before hello role is taken offline.</span></span>

### <a name="implementing-hello-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="bc44e-141">Implémentation des méthodes de cycle de vie ASP.NET hello pour un rôle web</span><span class="sxs-lookup"><span data-stu-id="bc44e-141">Implementing hello ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="bc44e-142">Vous pouvez utiliser les méthodes de cycle de vie ASP.NET hello, en outre toothose fournie par hello **RoleEntryPoint** toomanage des séquences d’initialisation et d’arrêt pour un rôle web, de classe.</span><span class="sxs-lookup"><span data-stu-id="bc44e-142">You can use hello ASP.NET lifecycle methods, in addition toothose provided by hello **RoleEntryPoint** class, toomanage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="bc44e-143">Cela peut être utile à des fins de compatibilité si vous déplacez un tooAzure d’application ASP.NET existante.</span><span class="sxs-lookup"><span data-stu-id="bc44e-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application tooAzure.</span></span> <span data-ttu-id="bc44e-144">méthodes de cycle de vie ASP.NET Hello sont appelées à partir de hello **RoleEntryPoint** méthodes.</span><span class="sxs-lookup"><span data-stu-id="bc44e-144">hello ASP.NET lifecycle methods are called from within hello **RoleEntryPoint** methods.</span></span> <span data-ttu-id="bc44e-145">Hello **Application\_Démarrer** méthode est appelée après hello **RoleEntryPoint.OnStart** fin de la méthode.</span><span class="sxs-lookup"><span data-stu-id="bc44e-145">hello **Application\_Start** method is called after hello **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="bc44e-146">Hello **Application\_fin** méthode est appelée avant hello **RoleEntryPoint.OnStop** méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="bc44e-146">hello **Application\_End** method is called before hello **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bc44e-147">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bc44e-147">Next steps</span></span>
<span data-ttu-id="bc44e-148">Découvrez comment trop[créer un package de service cloud](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="bc44e-148">Learn how too[create a cloud service package](cloud-services-model-and-package.md).</span></span>

