---
title: Planification de votre infrastructure de sauvegarde de machines virtuelles dans Azure | Microsoft Docs
description: "Considérations importantes avant la sauvegarde de machines virtuelles dans Azure"
services: backup
documentationcenter: 
author: markgalioto
manager: carmonm
editor: 
keywords: sauvegarde de machines virtuelles
ms.assetid: 19d2cf82-1f60-43e1-b089-9238042887a9
ms.service: backup
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 7/18/2017
ms.author: markgal;trinadhk
ms.openlocfilehash: 0c930c7413b24a811707c3a1ff3d7d70585bc528
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/29/2017
---
# <a name="plan-your-vm-backup-infrastructure-in-azure"></a><span data-ttu-id="9244d-104">Planification de votre infrastructure de sauvegarde de machines virtuelles dans Azure</span><span class="sxs-lookup"><span data-stu-id="9244d-104">Plan your VM backup infrastructure in Azure</span></span>
<span data-ttu-id="9244d-105">Cet article formule des suggestions de performances et de ressources pour vous aider à planifier votre infrastructure de sauvegarde de machines virtuelles.</span><span class="sxs-lookup"><span data-stu-id="9244d-105">This article provides performance and resource suggestions to help you plan your VM backup infrastructure.</span></span> <span data-ttu-id="9244d-106">Il définit également les principaux aspects du service Backup, qui peuvent être essentiels afin de vous aider à déterminer votre architecture, à planifier sa capacité et à définir des planifications.</span><span class="sxs-lookup"><span data-stu-id="9244d-106">It also defines key aspects of the Backup service; these aspects can be critical in determining your architecture, capacity planning, and scheduling.</span></span> <span data-ttu-id="9244d-107">Si vous avez [préparé votre environnement](backup-azure-vms-prepare.md), la planification est l’étape à suivre avant de passer à la [sauvegarde des machines virtuelles](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="9244d-107">If you've [prepared your environment](backup-azure-vms-prepare.md), planning is the next step before you begin [to back up VMs](backup-azure-vms.md).</span></span> <span data-ttu-id="9244d-108">Si vous avez besoin d’informations sur les machines virtuelles Azure, consultez la [Documentation sur les machines virtuelles](https://azure.microsoft.com/documentation/services/virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="9244d-108">If you need more information about Azure virtual machines, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="how-does-azure-back-up-virtual-machines"></a><span data-ttu-id="9244d-109">Comment Azure sauvegarde-t-il des machines virtuelles Azure ?</span><span class="sxs-lookup"><span data-stu-id="9244d-109">How does Azure back up virtual machines?</span></span>
<span data-ttu-id="9244d-110">Lorsque le service Azure Backup lance le travail de sauvegarde à l’heure planifiée, il déclenche l’extension de sauvegarde pour prendre un instantané à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="9244d-110">When the Azure Backup service initiates a backup job at the scheduled time, it triggers the backup extension to take a point-in-time snapshot.</span></span> <span data-ttu-id="9244d-111">Le service Azure Backup utilise l’extension _VMSnapshot_ dans Windows et l’extension _VMSnapshotLinux_ dans Linux.</span><span class="sxs-lookup"><span data-stu-id="9244d-111">The Azure Backup service uses the _VMSnapshot_ extension in Windows, and the _VMSnapshotLinux_ extension in Linux.</span></span> <span data-ttu-id="9244d-112">L’extension est installée lors de la première sauvegarde de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-112">The extension is installed during the first VM backup.</span></span> <span data-ttu-id="9244d-113">Pour que l’extension soit installée, la machine virtuelle doit être en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9244d-113">To install the extension, the VM must be running.</span></span> <span data-ttu-id="9244d-114">Si la machine virtuelle n’est pas en cours d’exécution, le service Sauvegarde prend un instantané du stockage sous-jacent (car aucune écriture de l’application n’a lieu pendant l’arrêt de la machine virtuelle).</span><span class="sxs-lookup"><span data-stu-id="9244d-114">If the VM is not running, the Backup service takes a snapshot of the underlying storage (since no application writes occur while the VM is stopped).</span></span>

<span data-ttu-id="9244d-115">Lorsque de la prise d’un instantané de machines virtuelles Windows, le service Sauvegarde se coordonne avec le service VSS pour obtenir un instantané cohérent des disques de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-115">When taking a snapshot of Windows VMs, the Backup service coordinates with the Volume Shadow Copy Service (VSS) to get a consistent snapshot of the virtual machine's disks.</span></span> <span data-ttu-id="9244d-116">Si vous effectuez des sauvegardes de machines virtuelles Linux, vous pouvez écrire vos propres scripts personnalisés pour garantir la cohérence lors de la prise d’un instantané de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-116">If you're backing up Linux VMs, you can write your own custom scripts to ensure consistency when taking a VM snapshot.</span></span> <span data-ttu-id="9244d-117">Des détails relatifs à l’appel de ces scripts sont fournis plus loin dans cet article.</span><span class="sxs-lookup"><span data-stu-id="9244d-117">Details on invoking these scripts are provided later in this article.</span></span>

<span data-ttu-id="9244d-118">Après que le service Sauvegarde Azure a pris l’instantané, les données sont transférées vers le coffre de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-118">Once the Azure Backup service takes the snapshot, the data is transferred to the vault.</span></span> <span data-ttu-id="9244d-119">Pour optimiser l’efficacité, le service identifie et transfère uniquement les blocs de données qui ont été modifiés depuis la sauvegarde précédente.</span><span class="sxs-lookup"><span data-stu-id="9244d-119">To maximize efficiency, the service identifies and transfers only the blocks of data that have changed since the previous backup.</span></span>

![Architecture de la sauvegarde des machines virtuelles Azure](./media/backup-azure-vms-introduction/vmbackup-architecture.png)

<span data-ttu-id="9244d-121">Une fois le transfert de données terminé, l’instantané est supprimé et un point de récupération est créé.</span><span class="sxs-lookup"><span data-stu-id="9244d-121">When the data transfer is complete, the snapshot is removed and a recovery point is created.</span></span>

> [!NOTE]
> 1. <span data-ttu-id="9244d-122">Pendant le processus de sauvegarde, le service Sauvegarde Azure n’inclut pas le disque temporaire attaché à la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-122">During the backup process, Azure Backup doesn't include the temporary disk attached to the virtual machine.</span></span> <span data-ttu-id="9244d-123">Pour plus d’informations, voir le blog relatif au [stockage temporaire](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span><span class="sxs-lookup"><span data-stu-id="9244d-123">For more information, see the blog on [temporary storage](https://blogs.msdn.microsoft.com/mast/2013/12/06/understanding-the-temporary-drive-on-windows-azure-virtual-machines/).</span></span>
> 2. <span data-ttu-id="9244d-124">Étant donné que le service Sauvegarde Azure prend un instantané au niveau du stockage et transfère celui-ci vers le coffre de sauvegarde, ne modifiez pas les clés du compte de stockage avant la fin du travail de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-124">Since Azure Backup takes a storage-level snapshot and transfers that snapshot to vault, do not change the storage account keys until the backup job finishes.</span></span>
> 3. <span data-ttu-id="9244d-125">Pour les machines virtuelles premium, nous copions la capture instantanée vers le compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-125">For premium VMs, we copy the snapshot to storage account.</span></span> <span data-ttu-id="9244d-126">L’objectif est de s’assurer que le service Azure Backup dispose d’un nombre suffisant d’opérations d’E/S par seconde pour transférer des données vers l’archivage.</span><span class="sxs-lookup"><span data-stu-id="9244d-126">This is to make sure that Azure Backup service gets sufficient IOPS for transferring data to vault.</span></span> <span data-ttu-id="9244d-127">Cette copie supplémentaire du stockage est facturée en fonction de la taille allouée de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-127">This additional copy of storage is charged as per the VM allocated size.</span></span> 
>

### <a name="data-consistency"></a><span data-ttu-id="9244d-128">Cohérence des données</span><span class="sxs-lookup"><span data-stu-id="9244d-128">Data consistency</span></span>
<span data-ttu-id="9244d-129">La sauvegarde et la restauration des données critiques d’entreprise sont compliquées par le fait qu’elles doivent être sauvegardées alors que les applications qui génèrent les données sont en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="9244d-129">Backing up and restoring business critical data is complicated by the fact that business critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="9244d-130">Pour résoudre ce problème, Azure Backup prend en charge des sauvegardes cohérentes avec les applications Windows et les machines virtuelles Linux</span><span class="sxs-lookup"><span data-stu-id="9244d-130">To address this, Azure Backup supports application-consistent backups for both Windows and Linux VMs</span></span>
#### <a name="windows-vm"></a><span data-ttu-id="9244d-131">Machine virtuelle Windows</span><span class="sxs-lookup"><span data-stu-id="9244d-131">Windows VM</span></span>
<span data-ttu-id="9244d-132">Azure Backup effectue la sauvegarde complète VSS sur les machines virtuelles Windows (en savoir plus sur la [sauvegarde complète VSS](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span><span class="sxs-lookup"><span data-stu-id="9244d-132">Azure Backup takes VSS full backups on Windows VMs (read more about [VSS full backup](http://blogs.technet.com/b/filecab/archive/2008/05/21/what-is-the-difference-between-vss-full-backup-and-vss-copy-backup-in-windows-server-2008.aspx)).</span></span> <span data-ttu-id="9244d-133">Pour activer les sauvegardes de copie VSS, la clé de registre suivant doit être définie sur la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-133">To enable VSS copy backups, the following registry key needs to be set on the VM.</span></span>

```
[HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\BCDRAGENT]
"USEVSSCOPYBACKUP"="TRUE"
```

#### <a name="linux-vms"></a><span data-ttu-id="9244d-134">Machines virtuelles Linux</span><span class="sxs-lookup"><span data-stu-id="9244d-134">Linux VMs</span></span>
<span data-ttu-id="9244d-135">Le service Sauvegarde Azure fournit une infrastructure de script.</span><span class="sxs-lookup"><span data-stu-id="9244d-135">Azure Backup provides a scripting framework.</span></span> <span data-ttu-id="9244d-136">Pour garantir la cohérence des applications lors de la sauvegarde de machines virtuelles Linux, créez des pré-scripts et post-scripts personnalisés qui contrôlent le flux et l’environnement de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-136">To ensure application consistency when backing up Linux VMs, create custom pre-scripts and post-scripts that control the backup workflow and environment.</span></span> <span data-ttu-id="9244d-137">Le service Sauvegarde Azure appelle le pré-script avant de prendre l’instantané de machine virtuelle, puis appelle le post-script à la fin du travail de prise d’instantané de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-137">Azure Backup invokes the pre-script before taking the VM snapshot and invokes the post-script once the VM snapshot job completes.</span></span> <span data-ttu-id="9244d-138">Pour plus d’informations, voir [Sauvegarde cohérente des applications des machines virtuelles Linux à l’aide de pré-scripts et de post-scripts](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="9244d-138">For more details, see [application consistent VM backups using pre-script and post-script](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span>
> [!NOTE]
> <span data-ttu-id="9244d-139">Le service Sauvegarde Azure appelle uniquement les pré-scripts et post-scripts écrits par le client.</span><span class="sxs-lookup"><span data-stu-id="9244d-139">Azure Backup only invokes the customer-written pre- and post-scripts.</span></span> <span data-ttu-id="9244d-140">Si les pré-scripts et post-scripts s’exécutent avec succès. le service Sauvegarde Azure marque le point de récupération comme étant cohérent dans l’application.</span><span class="sxs-lookup"><span data-stu-id="9244d-140">If the pre-script and post-scripts execute successfully, Azure Backup marks the recovery point as application consistent.</span></span> <span data-ttu-id="9244d-141">Toutefois, le client est responsable de la cohérence des applications lors de l’utilisation des scripts personnalisés.</span><span class="sxs-lookup"><span data-stu-id="9244d-141">However, the customer is ultimately responsible for the application consistency when using custom scripts.</span></span>
>


<span data-ttu-id="9244d-142">Ce tableau décrit les types de compatibilité et les conditions dans lesquelles elles se produisent pendant les procédures de sauvegarde et de restauration de machine virtuelle Azure.</span><span class="sxs-lookup"><span data-stu-id="9244d-142">This table explains the types of consistency and the conditions that they occur under during Azure VM backup and restore procedures.</span></span>

| <span data-ttu-id="9244d-143">Cohérence</span><span class="sxs-lookup"><span data-stu-id="9244d-143">Consistency</span></span> | <span data-ttu-id="9244d-144">En fonction du service VSS</span><span class="sxs-lookup"><span data-stu-id="9244d-144">VSS-based</span></span> | <span data-ttu-id="9244d-145">Explication et détails</span><span class="sxs-lookup"><span data-stu-id="9244d-145">Explanation and details</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9244d-146">Cohérence des applications</span><span class="sxs-lookup"><span data-stu-id="9244d-146">Application consistency</span></span> |<span data-ttu-id="9244d-147">Oui pour Windows</span><span class="sxs-lookup"><span data-stu-id="9244d-147">Yes for Windows</span></span>|<span data-ttu-id="9244d-148">La cohérence des applications est idéale pour les charges de travail, car elle apporte les garanties suivantes :</span><span class="sxs-lookup"><span data-stu-id="9244d-148">Application consistency is ideal for workloads as it ensures that:</span></span><ol><li> <span data-ttu-id="9244d-149">la machine virtuelle *démarre*.</span><span class="sxs-lookup"><span data-stu-id="9244d-149">The VM *boots up*.</span></span> <li><span data-ttu-id="9244d-150">Les données *ne sont pas endommagées*.</span><span class="sxs-lookup"><span data-stu-id="9244d-150">There is *no corruption*.</span></span> <li><span data-ttu-id="9244d-151">Il n’y a *aucune perte de données*.</span><span class="sxs-lookup"><span data-stu-id="9244d-151">There is *no data loss*.</span></span><li> <span data-ttu-id="9244d-152">Les données sont cohérentes vis-à-vis de l’application qui les utilise grâce à la sollicitation de l’application au moment de la sauvegarde (à l’aide de VSS) pré/post script.</span><span class="sxs-lookup"><span data-stu-id="9244d-152">The data is consistent to the application that uses the data, by involving the application at the time of backup--using VSS or pre/post script.</span></span></ol> <li><span data-ttu-id="9244d-153">*Machines virtuelles Windows* : La plupart des charges de travail de Microsoft ont des enregistreurs VSS qui effectuent des actions de charges de travail spécifiques relatives à la cohérence des données.</span><span class="sxs-lookup"><span data-stu-id="9244d-153">*Windows VMs*- Most Microsoft workloads have VSS writers that do workload-specific actions related to data consistency.</span></span> <span data-ttu-id="9244d-154">Par exemple, Microsoft SQL Server dispose d’un enregistreur VSS qui garantit que les écritures dans le journal des transactions et de la base de données sont effectuées correctement.</span><span class="sxs-lookup"><span data-stu-id="9244d-154">For example, Microsoft SQL Server has a VSS writer that ensures that the writes to the transaction log file and the database are done correctly.</span></span> <span data-ttu-id="9244d-155">Pour les sauvegardes d’une machine virtuelle Azure Windows, la création d’un point de récupération cohérent signifie que l’extension de sauvegarde a pu appeler le flux de travail VSS et se terminer avant la prise de l’instantané de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-155">For Azure Windows VM backups, to create an application-consistent recovery point, the backup extension must invoke the VSS workflow and complete it before taking the VM snapshot.</span></span> <span data-ttu-id="9244d-156">Pour que l’instantané de machine virtuelle Azure soit précis, les enregistreurs VSS de toutes les applications de machine virtuelle Azure doivent également se terminer.</span><span class="sxs-lookup"><span data-stu-id="9244d-156">For the Azure VM snapshot to be accurate, the VSS writers of all Azure VM applications must complete as well.</span></span> <span data-ttu-id="9244d-157">(Découvrez les [principes de base du service VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) et son [fonctionnement](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span><span class="sxs-lookup"><span data-stu-id="9244d-157">(Learn the [basics of VSS](http://blogs.technet.com/b/josebda/archive/2007/10/10/the-basics-of-the-volume-shadow-copy-service-vss.aspx) and dive deep into the details of [how it works](https://technet.microsoft.com/library/cc785914%28v=ws.10%29.aspx)).</span></span> </li> <li> <span data-ttu-id="9244d-158">*Machines virtuelles Linux* : les clients peuvent exécuter des [pré-scripts et post-scripts personnalisés pour assurer la cohérence de l’application](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span><span class="sxs-lookup"><span data-stu-id="9244d-158">*Linux VMs*- Customers can execute [custom pre-script and post-script to ensure application consistency](https://docs.microsoft.com/azure/backup/backup-azure-linux-app-consistent).</span></span> </li> |
| <span data-ttu-id="9244d-159">Cohérence du système de fichiers</span><span class="sxs-lookup"><span data-stu-id="9244d-159">File-system consistency</span></span> |<span data-ttu-id="9244d-160">Oui : pour les ordinateurs Windows</span><span class="sxs-lookup"><span data-stu-id="9244d-160">Yes - for Windows-based computers</span></span> |<span data-ttu-id="9244d-161">Il existe deux scénarios où le point de récupération peut être *cohérent avec le système de fichiers* :</span><span class="sxs-lookup"><span data-stu-id="9244d-161">There are two scenarios where the recovery point can be *file-system consistent*:</span></span><ul><li><span data-ttu-id="9244d-162">Sauvegardes de machines virtuelles Linux dans Azure, sans pré/post-script ou si le pré/post-script a échoué.</span><span class="sxs-lookup"><span data-stu-id="9244d-162">Backups of Linux VMs in Azure, without pre-script/post-script or if pre-script/post-script failed.</span></span> <li><span data-ttu-id="9244d-163">Échec de VSS lors de la sauvegarde de machines virtuelles Windows dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9244d-163">VSS failure during backup for Windows VMs in Azure.</span></span></li></ul> <span data-ttu-id="9244d-164">Dans les deux cas, la meilleure solution consiste à s’assurer que les conditions suivantes sont satisfaites :</span><span class="sxs-lookup"><span data-stu-id="9244d-164">In both these cases, the best that can be done is to ensure that:</span></span> <ol><li> <span data-ttu-id="9244d-165">la machine virtuelle *démarre*.</span><span class="sxs-lookup"><span data-stu-id="9244d-165">The VM *boots up*.</span></span> <li><span data-ttu-id="9244d-166">Les données *ne sont pas endommagées*.</span><span class="sxs-lookup"><span data-stu-id="9244d-166">There is *no corruption*.</span></span><li><span data-ttu-id="9244d-167">Il n’y a *aucune perte de données*.</span><span class="sxs-lookup"><span data-stu-id="9244d-167">There is *no data loss*.</span></span></ol> <span data-ttu-id="9244d-168">Les applications doivent implémenter leur propre mécanisme de « correctif » sur les données restaurées.</span><span class="sxs-lookup"><span data-stu-id="9244d-168">Applications need to implement their own "fix-up" mechanism on the restored data.</span></span> |
| <span data-ttu-id="9244d-169">Cohérence en cas d’incident</span><span class="sxs-lookup"><span data-stu-id="9244d-169">Crash consistency</span></span> |<span data-ttu-id="9244d-170">Non</span><span class="sxs-lookup"><span data-stu-id="9244d-170">No</span></span> |<span data-ttu-id="9244d-171">Cette situation est la même que lorsqu’une machine virtuelle rencontre un « incident » (via une réinitialisation matérielle ou logicielle).</span><span class="sxs-lookup"><span data-stu-id="9244d-171">This situation is equivalent to a virtual machine experiencing a "crash" (through either a soft or hard reset).</span></span> <span data-ttu-id="9244d-172">La cohérence en cas d’incident se produit généralement lorsque la machine virtuelle Azure est arrêtée au moment de la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-172">Crash consistency typically happens when the Azure virtual machine is shut down at the time of backup.</span></span> <span data-ttu-id="9244d-173">Un point de récupération cohérent ne fournit aucune garantie de cohérence des données sur le support de stockage, que ce soit au niveau du système d’exploitation ou de l’application.</span><span class="sxs-lookup"><span data-stu-id="9244d-173">A crash-consistent recovery point provides no guarantees around the consistency of the data on the storage medium--either from the perspective of the operating system or the application.</span></span> <span data-ttu-id="9244d-174">Seules les données déjà présentes sur le disque au moment de la sauvegarde sont capturées et sauvegardées.</span><span class="sxs-lookup"><span data-stu-id="9244d-174">Only the data that already exists on the disk at the time of backup is captured and backed up.</span></span> <br/> <br/> <span data-ttu-id="9244d-175">Même s’il n’existe aucune garantie, le démarrage a généralement lieu et est suivi d’une procédure de vérification du disque comme chkdsk permettant de résoudre les erreurs d’endommagement.</span><span class="sxs-lookup"><span data-stu-id="9244d-175">While there are no guarantees, usually, the operating system boots, followed by disk-checking procedure, like chkdsk, to fix any corruption errors.</span></span> <span data-ttu-id="9244d-176">Les données ou les écritures en mémoire qui n’ont pas été transférées sur le disque sont perdues.</span><span class="sxs-lookup"><span data-stu-id="9244d-176">Any in-memory data or writes that have not been transferred to the disk are lost.</span></span> <span data-ttu-id="9244d-177">Si une restauration de données est nécessaire, l’application suit généralement son propre mécanisme de vérification.</span><span class="sxs-lookup"><span data-stu-id="9244d-177">The application typically follows with its own verification mechanism in case data rollback needs to be done.</span></span> <br><br><span data-ttu-id="9244d-178">Par exemple, cette situation peut survenir si le journal des transactions comporte des entrées qui n’existent pas dans la base de données. Le logiciel de base de données effectue alors une restauration jusqu’à ce que les données soient cohérentes.</span><span class="sxs-lookup"><span data-stu-id="9244d-178">As an example, if the transaction log has entries that are not present in the database, then the database software does a rollback until the data is consistent.</span></span> <span data-ttu-id="9244d-179">Lorsque des données sont réparties sur plusieurs disques virtuels (comme des volumes fractionnés), un point de récupération cohérent après incident ne fournit aucune garantie quant à l’exactitude des données.</span><span class="sxs-lookup"><span data-stu-id="9244d-179">When data is spread across multiple virtual disks (like spanned volumes), a crash-consistent recovery point provides no guarantees for the correctness of the data.</span></span> |

## <a name="performance-and-resource-utilization"></a><span data-ttu-id="9244d-180">Performance et utilisation des ressources</span><span class="sxs-lookup"><span data-stu-id="9244d-180">Performance and resource utilization</span></span>
<span data-ttu-id="9244d-181">Au même titre qu’un logiciel de sauvegarde déployé sur site, il est recommandé de planifier les besoins en capacité et en consommation de ressources lors d’une sauvegarde de machines virtuelles dans Azure.</span><span class="sxs-lookup"><span data-stu-id="9244d-181">Like backup software that is deployed on-premises, you should plan for capacity and resource utilization needs when backing up VMs in Azure.</span></span> <span data-ttu-id="9244d-182">Les [limites d’Azure Storage](../azure-subscription-service-limits.md#storage-limits) définissent la structuration des déploiements de machine virtuelle pour obtenir des performances maximales avec un impact minimal sur l’exécution des charges de travail.</span><span class="sxs-lookup"><span data-stu-id="9244d-182">The [Azure Storage limits](../azure-subscription-service-limits.md#storage-limits) define how to structure VM deployments to get maximum performance with minimum impact to running workloads.</span></span>

<span data-ttu-id="9244d-183">Tenez compte des limites de stockage Azure indiquées ci-dessous lorsque vous planifiez vos performances de sauvegarde :</span><span class="sxs-lookup"><span data-stu-id="9244d-183">Pay attention to the following Azure Storage limits when planning backup performance:</span></span>

* <span data-ttu-id="9244d-184">Nombre maximal de sorties par compte de stockage</span><span class="sxs-lookup"><span data-stu-id="9244d-184">Max egress per storage account</span></span>
* <span data-ttu-id="9244d-185">Taux de requête total par compte de stockage</span><span class="sxs-lookup"><span data-stu-id="9244d-185">Total request rate per storage account</span></span>

### <a name="storage-account-limits"></a><span data-ttu-id="9244d-186">Limites de compte de stockage</span><span class="sxs-lookup"><span data-stu-id="9244d-186">Storage account limits</span></span>
<span data-ttu-id="9244d-187">Les données de sauvegarde copiées à partir d’un compte de stockage s’ajoutent aux opérations d’entrées/sorties par seconde (IOPS) et génèrent (ou débitent) des mesures du compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-187">Backup data copied from a storage account, adds to the input/output operations per second (IOPS) and egress (or throughput) metrics of the storage account.</span></span> <span data-ttu-id="9244d-188">Dans le même temps, les machines virtuelles consomment des IOPS et du débit.</span><span class="sxs-lookup"><span data-stu-id="9244d-188">At the same time, virtual machines are also consuming IOPS and throughput.</span></span> <span data-ttu-id="9244d-189">L’objectif est de garantir que le trafic de sauvegarde et de machine virtuelle ne dépassent pas les limites de votre compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-189">The goal is to ensure Backup and virtual machine traffic don't exceed your storage account limits.</span></span>

### <a name="number-of-disks"></a><span data-ttu-id="9244d-190">Nombre de disques</span><span class="sxs-lookup"><span data-stu-id="9244d-190">Number of disks</span></span>
<span data-ttu-id="9244d-191">Le processus de sauvegarde tente d’exécuter un travail de sauvegarde aussi rapidement que possible.</span><span class="sxs-lookup"><span data-stu-id="9244d-191">The backup process tries to complete a backup job as quickly as possible.</span></span> <span data-ttu-id="9244d-192">Autrement dit, il consomme un maximum de ressources.</span><span class="sxs-lookup"><span data-stu-id="9244d-192">In doing so, it consumes as many resources as it can.</span></span> <span data-ttu-id="9244d-193">Cependant, toutes les opérations d’E/S sont limitées par le *débit cible d’un seul objet Blob*, qui est limité à 60 Mo par seconde.</span><span class="sxs-lookup"><span data-stu-id="9244d-193">However, all I/O operations are limited by the *Target Throughput for Single Blob*, which has a limit of 60 MB per second.</span></span> <span data-ttu-id="9244d-194">Afin de tenter d’accélérer l’opération, le processus de sauvegarde tente de sauvegarder chacun des disques de la machine virtuelle *en parallèle*.</span><span class="sxs-lookup"><span data-stu-id="9244d-194">In an attempt to maximize its speed, the backup process tries to back up each of the VM's disks *in parallel*.</span></span> <span data-ttu-id="9244d-195">Si une machine virtuelle comprend quatre disques, le service tente de sauvegarder les quatre disques simultanément.</span><span class="sxs-lookup"><span data-stu-id="9244d-195">If a VM has four disks, the service attempts to back up all four disks in parallel.</span></span> <span data-ttu-id="9244d-196">Le facteur le plus important pour déterminer le trafic de sauvegarde d’un compte de stockage client est le **nombre de disques** sauvegardés.</span><span class="sxs-lookup"><span data-stu-id="9244d-196">The **number of disks** being backed up, is the most important factor in determining storage account backup traffic.</span></span>

### <a name="backup-schedule"></a><span data-ttu-id="9244d-197">Planification de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="9244d-197">Backup schedule</span></span>
<span data-ttu-id="9244d-198">Autre facteur ayant un impact sur les performances : la **planification de sauvegarde**.</span><span class="sxs-lookup"><span data-stu-id="9244d-198">An additional factor that impacts performance is the **backup schedule**.</span></span> <span data-ttu-id="9244d-199">Configurer vos stratégies de manière à sauvegarder simultanément toutes les machines virtuelles revient à planifier un embouteillage.</span><span class="sxs-lookup"><span data-stu-id="9244d-199">If you configure the policies so all VMs are backed up at the same time, you have scheduled a traffic jam.</span></span> <span data-ttu-id="9244d-200">Le processus de sauvegarde tente de sauvegarder tous les disques en parallèle.</span><span class="sxs-lookup"><span data-stu-id="9244d-200">The backup process attempts to back up all disks in parallel.</span></span> <span data-ttu-id="9244d-201">Pour réduire le trafic de sauvegarde à partir d’un compte de stockage, sauvegardez les différentes machines virtuelles à différents moments de la journée en évitant tout chevauchement.</span><span class="sxs-lookup"><span data-stu-id="9244d-201">To reduce the backup traffic from a storage account, back up different VMs at different time of the day, with no overlap.</span></span>

## <a name="capacity-planning"></a><span data-ttu-id="9244d-202">Planification de la capacité</span><span class="sxs-lookup"><span data-stu-id="9244d-202">Capacity planning</span></span>
<span data-ttu-id="9244d-203">En associant les facteurs précédents, vous devez planifier les besoins d’utilisation du compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-203">Putting the previous factors together, you need to plan for the storage account usage needs.</span></span> <span data-ttu-id="9244d-204">Téléchargez la [feuille de calcul Excel de planification des capacités des machines virtuelles](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) pour voir l’impact de vos choix en matière de planification de disques et de sauvegardes.</span><span class="sxs-lookup"><span data-stu-id="9244d-204">Download the [VM backup capacity planning Excel spreadsheet](https://gallery.technet.microsoft.com/Azure-Backup-Storage-a46d7e33) to see the impact of your disk and backup schedule choices.</span></span>

### <a name="backup-throughput"></a><span data-ttu-id="9244d-205">Débit de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="9244d-205">Backup throughput</span></span>
<span data-ttu-id="9244d-206">Pour chaque disque en cours de sauvegarde, Azure Backup lit les blocs sur le disque et stocke uniquement les données modifiées (sauvegarde incrémentielle).</span><span class="sxs-lookup"><span data-stu-id="9244d-206">For each disk being backed up, Azure Backup reads the blocks on the disk and stores only the changed data (incremental backup).</span></span> <span data-ttu-id="9244d-207">Le tableau suivant montre les valeurs moyennes de débit du service de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-207">The following table shows the average Backup service throughput values.</span></span> <span data-ttu-id="9244d-208">Utilisez les données suivantes pour estimer le temps nécessaire à la sauvegarde d’un disque d’une taille donnée.</span><span class="sxs-lookup"><span data-stu-id="9244d-208">Using the following data, you can estimate the amount of time needed to back up a disk of a given size.</span></span>

| <span data-ttu-id="9244d-209">Opération de sauvegarde</span><span class="sxs-lookup"><span data-stu-id="9244d-209">Backup operation</span></span> | <span data-ttu-id="9244d-210">Meilleur débit</span><span class="sxs-lookup"><span data-stu-id="9244d-210">Best-case throughput</span></span> |
| --- | --- |
| <span data-ttu-id="9244d-211">Sauvegarde initiale</span><span class="sxs-lookup"><span data-stu-id="9244d-211">Initial backup</span></span> |<span data-ttu-id="9244d-212">160 Mbits/s</span><span class="sxs-lookup"><span data-stu-id="9244d-212">160 Mbps</span></span> |
| <span data-ttu-id="9244d-213">Sauvegarde incrémentielle (DR)</span><span class="sxs-lookup"><span data-stu-id="9244d-213">Incremental backup (DR)</span></span> |<span data-ttu-id="9244d-214">640 Mbits/s </span><span class="sxs-lookup"><span data-stu-id="9244d-214">640 Mbps</span></span> <br><br> <span data-ttu-id="9244d-215">Le débit diminue de manière significative si les données modifiées (qui doivent être sauvegardées) sont dispersées sur le disque.</span><span class="sxs-lookup"><span data-stu-id="9244d-215">Throughput drops significantly if the changed data (that needs to be backed up) is dispersed across the disk.</span></span>|

## <a name="total-vm-backup-time"></a><span data-ttu-id="9244d-216">Durée de sauvegarde de machine virtuelle totale</span><span class="sxs-lookup"><span data-stu-id="9244d-216">Total VM backup time</span></span>
<span data-ttu-id="9244d-217">La majeure partie du temps de sauvegarde est consacrée à la lecture et la copie des données, mais il existe d’autres opérations qui contribuent à la durée totale nécessaire à la sauvegarde d’une machine virtuelle :</span><span class="sxs-lookup"><span data-stu-id="9244d-217">While most of the backup time is spent reading and copying data, other operations contribute to the total time needed to back up a VM:</span></span>

* <span data-ttu-id="9244d-218">Délai nécessaire à l’ [installation ou à la mise à jour de l’extension de sauvegarde](backup-azure-vms.md).</span><span class="sxs-lookup"><span data-stu-id="9244d-218">Time needed to [install or update the backup extension](backup-azure-vms.md).</span></span>
* <span data-ttu-id="9244d-219">Heure de l'instantané, qui est la durée nécessaire au déclenchement d’un instantané.</span><span class="sxs-lookup"><span data-stu-id="9244d-219">Snapshot time, which is the time taken to trigger a snapshot.</span></span> <span data-ttu-id="9244d-220">Les instantanés sont déclenchés peu avant l’heure de sauvegarde planifiée.</span><span class="sxs-lookup"><span data-stu-id="9244d-220">Snapshots are triggered close to the scheduled backup time.</span></span>
* <span data-ttu-id="9244d-221">Délai d’attente de file d’attente.</span><span class="sxs-lookup"><span data-stu-id="9244d-221">Queue wait time.</span></span> <span data-ttu-id="9244d-222">Comme le service Backup traite les sauvegardes de plusieurs clients, il se peut que la copie de données de sauvegarde de l’instantané vers l’archivage Backup ou Recovery Services ne démarre pas immédiatement.</span><span class="sxs-lookup"><span data-stu-id="9244d-222">Since the Backup service is processing backups from multiple customers, copying backup data from snapshot to the backup or Recovery Services vault might not start immediately.</span></span> <span data-ttu-id="9244d-223">Lors des pics de charge, les temps d’attente peuvent durer jusqu’à huit heures en raison du nombre de sauvegardes à traiter.</span><span class="sxs-lookup"><span data-stu-id="9244d-223">In times of peak load, the wait can stretch up to eight hours due to the number of backups being processed.</span></span> <span data-ttu-id="9244d-224">Toutefois, la durée de sauvegarde totale d’un ordinateur virtuel est inférieure à 24 heures pour des stratégies de sauvegarde quotidiennes.</span><span class="sxs-lookup"><span data-stu-id="9244d-224">However, the total VM backup time is less than 24 hours for daily backup policies.</span></span>
* <span data-ttu-id="9244d-225">Le temps de transfert de données, le temps nécessaire pour que le service de sauvegarde calcule les modifications incrémentielles à partir d’une sauvegarde précédente de calcul et de transfère ces modifications dans l’archivage.</span><span class="sxs-lookup"><span data-stu-id="9244d-225">Data transfer time, time needed for backup service to compute the incremental changes from previous backup and transfer those changes to vault storage.</span></span>

### <a name="why-am-i-observing-longer12-hours-backup-time"></a><span data-ttu-id="9244d-226">Pourquoi les temps de sauvegarde semblent-ils plus longs (>12 heures) ?</span><span class="sxs-lookup"><span data-stu-id="9244d-226">Why am I observing longer(>12 hours) backup time?</span></span>
<span data-ttu-id="9244d-227">La sauvegarde consiste en deux phases : la prise d’instantané et le transfert de l’instantané vers l’archivage.</span><span class="sxs-lookup"><span data-stu-id="9244d-227">Backup consists of two phases: taking snapshots and transferring the snapshots to the vault.</span></span> <span data-ttu-id="9244d-228">Le service de sauvegarde optimise pour le stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-228">The Backup service optimizes for storage.</span></span> <span data-ttu-id="9244d-229">Lorsque vous transférez des données d’instantané dans un coffre, le service transfère uniquement les modifications incrémentielles à partir de l’instantané précédent.</span><span class="sxs-lookup"><span data-stu-id="9244d-229">When transferring the snapshot data to a vault, the service only transfers incremental changes from the previous snapshot.</span></span>  <span data-ttu-id="9244d-230">Pour déterminer les modifications incrémentielles, le service calcule la somme de contrôle des blocs.</span><span class="sxs-lookup"><span data-stu-id="9244d-230">To determine the incremental changes, the service computes the checksum of the blocks.</span></span> <span data-ttu-id="9244d-231">Si un bloc est modifié, le bloc est identifié comme un bloc à envoyer au coffre.</span><span class="sxs-lookup"><span data-stu-id="9244d-231">If a block is changed, the block is identified as a block to be sent to the vault.</span></span> <span data-ttu-id="9244d-232">Le service examine ensuite davantage chacun des blocs identifiés, à la recherche d’opportunités de réduire les données à transférer.</span><span class="sxs-lookup"><span data-stu-id="9244d-232">Then the service drills further into each of the identified blocks, looking for opportunities to minimize the data to transfer.</span></span> <span data-ttu-id="9244d-233">Après avoir évalué tous les blocs modifiés, le service fusionne les modifications et les envoie au coffre.</span><span class="sxs-lookup"><span data-stu-id="9244d-233">After evaluating all changed blocks, the service coalesces the changes and sends them to the vault.</span></span> <span data-ttu-id="9244d-234">Dans certaines applications héritées, les écritures de petite taille et fragmentées ne sont pas optimales pour le stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-234">In some legacy applications, small, fragmented writes are not optimal for storage.</span></span> <span data-ttu-id="9244d-235">Si l’instantané contient un grand nombre d’écritures de petite taille et fragmentées, le service consacre plus de temps à traiter les données écrites par les applications.</span><span class="sxs-lookup"><span data-stu-id="9244d-235">If the snapshot contains many small, fragmented writes, the service spends additional time processing the data written by the applications.</span></span> <span data-ttu-id="9244d-236">La taille de bloc d’écriture d’application recommandée depuis Azure pour les applications exécutées dans la machine virtuelle est de 8 Ko au minimum.</span><span class="sxs-lookup"><span data-stu-id="9244d-236">The recommended application write block from Azure, for applications running inside the VM, is a minimum of 8 KB.</span></span> <span data-ttu-id="9244d-237">Si votre application utilise un bloc de moins de 8 Ko, les performances de sauvegarde sont affectées.</span><span class="sxs-lookup"><span data-stu-id="9244d-237">If your application uses a block of less than 8 KB, backup performance is effected.</span></span> <span data-ttu-id="9244d-238">Pour obtenir de l’aide concernant le réglage de votre application afin d’améliorer les performances de sauvegarde, voir [Paramétrage des applications pour optimiser les performances de Stockage Azure](../storage/common/storage-premium-storage-performance.md).</span><span class="sxs-lookup"><span data-stu-id="9244d-238">For help with tuning your application to improve backup performance, see [Tuning applications for optimal performance with Azure storage](../storage/common/storage-premium-storage-performance.md).</span></span> <span data-ttu-id="9244d-239">Bien que l’article sur les performances de sauvegarde utilise des exemples de stockage Premium, il est aussi applicable aux disques de stockage Standard.</span><span class="sxs-lookup"><span data-stu-id="9244d-239">Though the article on backup performance uses Premium storage examples, the guidance is applicable for Standard storage disks.</span></span>

## <a name="total-restore-time"></a><span data-ttu-id="9244d-240">Temps de restauration total</span><span class="sxs-lookup"><span data-stu-id="9244d-240">Total restore time</span></span>
<span data-ttu-id="9244d-241">Une opération de restauration se compose de deux sous-tâches principales : copie de données depuis un coffre vers le compte de stockage choisi et création de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-241">A restore operation consists of two main sub tasks: Copying data back from the vault to the chosen customer storage account, and creating the virtual machine.</span></span> <span data-ttu-id="9244d-242">La copie de données depuis un coffre dépend de l’endroit où les sauvegardes sont stockées en interne dans Azure et de l’endroit où le compte de stockage client est stocké.</span><span class="sxs-lookup"><span data-stu-id="9244d-242">Copying data back from the vault depends on where the backups are stored internally in Azure, and where the customer storage account is stored.</span></span> <span data-ttu-id="9244d-243">Le temps nécessaire pour copier des données dépend des paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="9244d-243">Time taken to copy data depends upon:</span></span>
* <span data-ttu-id="9244d-244">Délai d’attente de la file : étant donné que le service traite des restaurations à partir de plusieurs clients en même temps, les demandes de restauration sont mises en file d’attente.</span><span class="sxs-lookup"><span data-stu-id="9244d-244">Queue wait time - Since the service processes restore jobs from multiple customers at the same time, restore requests are put in a queue.</span></span>
* <span data-ttu-id="9244d-245">Heure de copie des données : les données sont copiées du coffre de sauvegarde vers le compte de stockage client.</span><span class="sxs-lookup"><span data-stu-id="9244d-245">Data copy time - Data is copied from the vault to the customer storage account.</span></span> <span data-ttu-id="9244d-246">Le temps de restauration des IOPS et du débit que le service Sauvegarde Azure atteint sur le compte de stockage client sélectionné.</span><span class="sxs-lookup"><span data-stu-id="9244d-246">Restore time depends on IOPS and throughput Azure Backup service gets on the selected customer storage account.</span></span> <span data-ttu-id="9244d-247">Pour réduire le temps de copie pendant le processus de restauration, sélectionnez un compte de stockage non chargé avec d’autres lectures et écritures d’application.</span><span class="sxs-lookup"><span data-stu-id="9244d-247">To reduce the copying time during the restore process, select a storage account not loaded with other application writes and reads.</span></span>

## <a name="best-practices"></a><span data-ttu-id="9244d-248">Meilleures pratiques</span><span class="sxs-lookup"><span data-stu-id="9244d-248">Best practices</span></span>
<span data-ttu-id="9244d-249">Nous vous suggérons de suivre les meilleures pratiques ci-dessous lors de la configuration de sauvegardes de machines virtuelles :</span><span class="sxs-lookup"><span data-stu-id="9244d-249">We suggest following these practices while configuring backups for virtual machines:</span></span>

* <span data-ttu-id="9244d-250">Ne planifiez pas la sauvegarde de plus de 10 machines virtuelles classiques à partir du même service cloud en même temps.</span><span class="sxs-lookup"><span data-stu-id="9244d-250">Don't schedule more than 10 classic VMs from the same cloud service to back up at the same time.</span></span> <span data-ttu-id="9244d-251">Si vous souhaitez sauvegarder davantage de machines virtuelles d’un même service cloud, échelonnez les débuts de sauvegarde d’heure en heure.</span><span class="sxs-lookup"><span data-stu-id="9244d-251">If you want to back up multiple VMs from same cloud service, stagger the backup start times by an hour.</span></span>
* <span data-ttu-id="9244d-252">Ne planifiez pas la sauvegarde simultanée de plus de 40 machines virtuelles simultanément.</span><span class="sxs-lookup"><span data-stu-id="9244d-252">Do not schedule more than 40 VMs to back up at the same time.</span></span>
* <span data-ttu-id="9244d-253">Planifiez les sauvegardes de machines virtuelles pendant les heures creuses.</span><span class="sxs-lookup"><span data-stu-id="9244d-253">Schedule VM backups during non-peak hours.</span></span> <span data-ttu-id="9244d-254">Ainsi, le service Sauvegarde utilise des IOPS pour transférer les données du compte de stockage client vers le coffre de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-254">This way the Backup service uses IOPS for transferring data from the customer storage account to the vault.</span></span>
* <span data-ttu-id="9244d-255">Veillez à appliquer une stratégie aux machines virtuelles réparties entre les différents comptes de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-255">Make sure that a policy is applied on VMs spread across different storage accounts.</span></span> <span data-ttu-id="9244d-256">Nous vous suggérons de limiter à 20 le nombre total de disques d’un même compte de stockage protégés par la même planification de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-256">We suggest no more than 20 total disks from a single storage account be protected by the same backup schedule.</span></span> <span data-ttu-id="9244d-257">Si votre compte de stockage contient plus de 20 disques, répartissez ces machines virtuelles entre plusieurs stratégies afin d’obtenir les IOPS requises pendant la phase de transfert du processus de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-257">If you have greater than 20 disks in a storage account, spread those VMs across multiple policies to get the required IOPS during the transfer phase of the backup process.</span></span>
* <span data-ttu-id="9244d-258">Évitez de restaurer une machine virtuelle exécutée sur le stockage Premium vers le même compte de stockage.</span><span class="sxs-lookup"><span data-stu-id="9244d-258">Do not restore a VM running on Premium storage to same storage account.</span></span> <span data-ttu-id="9244d-259">Si le processus de restauration coïncide avec l’opération de sauvegarde, cela réduira les IOPS disponibles pour la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-259">If the restore operation process coincides with the backup operation, it reduces the available IOPS for backup.</span></span>
* <span data-ttu-id="9244d-260">Pour la sauvegarde de machine virtuelle Premium, assurez-vous que le compte de stockage qui héberge les disques Premium dispose d’au moins 50 % d’espace libre pour créer des captures instantanées intermédiaires pour une sauvegarde réussie.</span><span class="sxs-lookup"><span data-stu-id="9244d-260">For Premium VM backup, ensure that storage account that hosts premium disks has atleast 50% free space for staging snapshot for a successful backup.</span></span> 
* <span data-ttu-id="9244d-261">Assurez-vous que la version Python sur les machines virtuelles Linux activées pour la sauvegarde est 2.7</span><span class="sxs-lookup"><span data-stu-id="9244d-261">Make sure that python version on Linux VMs enabled for backup is 2.7</span></span>

## <a name="data-encryption"></a><span data-ttu-id="9244d-262">Chiffrement des données</span><span class="sxs-lookup"><span data-stu-id="9244d-262">Data encryption</span></span>
<span data-ttu-id="9244d-263">Azure Backup ne chiffre pas les données dans le cadre du processus de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="9244d-263">Azure Backup does not encrypt data as a part of the backup process.</span></span> <span data-ttu-id="9244d-264">Toutefois, vous pouvez chiffrer les données dans la machine virtuelle et sauvegarder les données protégées en toute transparence (pour en savoir plus, lire [sauvegarde des données chiffrées](backup-azure-vms-encryption.md)).</span><span class="sxs-lookup"><span data-stu-id="9244d-264">However, you can encrypt data within the VM and back up the protected data seamlessly (read more about [backup of encrypted data](backup-azure-vms-encryption.md)).</span></span>

## <a name="calculating-the-cost-of-protected-instances"></a><span data-ttu-id="9244d-265">Calcul du coût des instances protégées</span><span class="sxs-lookup"><span data-stu-id="9244d-265">Calculating the cost of protected instances</span></span>
<span data-ttu-id="9244d-266">Les machines virtuelles Azure sauvegardées par le biais d’Azure Backup sont soumises à la [Tarification d’Azure Backup](https://azure.microsoft.com/pricing/details/backup/).</span><span class="sxs-lookup"><span data-stu-id="9244d-266">Azure virtual machines that are backed up through Azure Backup are subject to [Azure Backup pricing](https://azure.microsoft.com/pricing/details/backup/).</span></span> <span data-ttu-id="9244d-267">Le calcul des instances protégées est basé sur la taille *réelle* de la machine virtuelle, qui est la somme de toutes les données de la machine virtuelle, à l’exception du « disque de ressources ».</span><span class="sxs-lookup"><span data-stu-id="9244d-267">The Protected Instances calculation is based on the *actual* size of the virtual machine, which is the sum of all the data in the virtual machine--excluding the “resource disk.”</span></span>

<span data-ttu-id="9244d-268">La tarification pour la sauvegarde des machines virtuelles n’est *pas* basée sur la taille maximale prise en charge pour chaque disque de données attaché à la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-268">Pricing for backing up VMs is *not* based on the maximum supported size for each data disk attached to the virtual machine.</span></span> <span data-ttu-id="9244d-269">La tarification est basée sur les données réelles stockées sur le disque de données.</span><span class="sxs-lookup"><span data-stu-id="9244d-269">Pricing is based on the actual data stored in the data disk.</span></span> <span data-ttu-id="9244d-270">De même, la facture du stockage de sauvegarde est basée sur la quantité de données stockées sur le service Sauvegarde Azure, qui est la somme des données réelles de chaque point de récupération.</span><span class="sxs-lookup"><span data-stu-id="9244d-270">Similarly, the backup storage bill is based on the amount of data that is stored in Azure Backup, which is the sum of the actual data in each recovery point.</span></span>

<span data-ttu-id="9244d-271">Prenons l’exemple d’une machine virtuelle de taille standard A2 avec deux disques de données supplémentaires d’une taille maximale de 1 To.</span><span class="sxs-lookup"><span data-stu-id="9244d-271">For example, take an A2 Standard-sized virtual machine that has two additional data disks with a maximum size of 1 TB each.</span></span> <span data-ttu-id="9244d-272">Le tableau suivant indique les données réelles stockées sur chacun de ces disques :</span><span class="sxs-lookup"><span data-stu-id="9244d-272">The following table gives the actual data stored on each of these disks:</span></span>

| <span data-ttu-id="9244d-273">Type de disque</span><span class="sxs-lookup"><span data-stu-id="9244d-273">Disk type</span></span> | <span data-ttu-id="9244d-274">Taille maximale</span><span class="sxs-lookup"><span data-stu-id="9244d-274">Max size</span></span> | <span data-ttu-id="9244d-275">Données réelles présentes</span><span class="sxs-lookup"><span data-stu-id="9244d-275">Actual data present</span></span> |
| --- | --- | --- |
| <span data-ttu-id="9244d-276">Disque de système d’exploitation</span><span class="sxs-lookup"><span data-stu-id="9244d-276">Operating system disk</span></span> |<span data-ttu-id="9244d-277">1 023 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-277">1023 GB</span></span> |<span data-ttu-id="9244d-278">17 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-278">17 GB</span></span> |
| <span data-ttu-id="9244d-279">Disque local/Disque de ressources</span><span class="sxs-lookup"><span data-stu-id="9244d-279">Local disk / Resource disk</span></span> |<span data-ttu-id="9244d-280">135 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-280">135 GB</span></span> |<span data-ttu-id="9244d-281">5 Go (non inclus pour la sauvegarde)</span><span class="sxs-lookup"><span data-stu-id="9244d-281">5 GB (not included for backup)</span></span> |
| <span data-ttu-id="9244d-282">Disque de données 1</span><span class="sxs-lookup"><span data-stu-id="9244d-282">Data disk 1</span></span> |<span data-ttu-id="9244d-283">1 023 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-283">1023 GB</span></span> |<span data-ttu-id="9244d-284">30 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-284">30 GB</span></span> |
| <span data-ttu-id="9244d-285">Disque de données 2</span><span class="sxs-lookup"><span data-stu-id="9244d-285">Data disk 2</span></span> |<span data-ttu-id="9244d-286">1 023 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-286">1023 GB</span></span> |<span data-ttu-id="9244d-287">0 Go</span><span class="sxs-lookup"><span data-stu-id="9244d-287">0 GB</span></span> |

<span data-ttu-id="9244d-288">La taille *réelle* de la machine virtuelle est dans ce cas 17 Go + 30 Go + 0 Go= 47 Go.</span><span class="sxs-lookup"><span data-stu-id="9244d-288">The *actual* size of the virtual machine in this case is 17 GB + 30 GB + 0 GB = 47 GB.</span></span> <span data-ttu-id="9244d-289">Cette taille d’instance protégée (47 Go) devient la base de la facture mensuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-289">This Protected Instance size (47 GB) becomes the basis for the monthly bill.</span></span> <span data-ttu-id="9244d-290">La taille de l’instance protégée utilisée pour la facturation augmente à mesure qu’augmente le volume des données dans la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-290">As the amount of data in the virtual machine grows, the Protected Instance size used for billing changes accordingly.</span></span>

<span data-ttu-id="9244d-291">La facturation ne commence pas avant la fin de la première sauvegarde réussie.</span><span class="sxs-lookup"><span data-stu-id="9244d-291">Billing does not start until the first successful backup completes.</span></span> <span data-ttu-id="9244d-292">À partir de ce moment, la facturation du stockage et des instances protégées commence.</span><span class="sxs-lookup"><span data-stu-id="9244d-292">At this point, the billing for both Storage and Protected Instances begins.</span></span> <span data-ttu-id="9244d-293">La facturation continue tant que des *données de sauvegarde sont stockées dans le coffre de sauvegarde* pour la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-293">Billing continues as long as there is *any backup data stored in a vault* for the virtual machine.</span></span> <span data-ttu-id="9244d-294">Si vous arrêtez la protection sur la machine virtuelle, alors que des données de sauvegarde de la machine virtuelle figurent dans un coffre de sauvegarde, la facturation continue.</span><span class="sxs-lookup"><span data-stu-id="9244d-294">If you stop protection on the virtual machine, but virtual machine backup data exists in a vault, billing continues.</span></span>

<span data-ttu-id="9244d-295">La facturation pour une machine virtuelle spécifiée ne s’interrompt que si la protection est levée *et* que toutes les données de sauvegarde sont supprimées.</span><span class="sxs-lookup"><span data-stu-id="9244d-295">Billing for a specified virtual machine stops only if the protection is stopped *and* all backup data is deleted.</span></span> <span data-ttu-id="9244d-296">Lorsque la protection s’arrête, si aucun travail de sauvegarde n’est actif, la taille de la dernière sauvegarde de machine virtuelle réussie devient la taille de l’Instance protégée utilisée pour la facture mensuelle.</span><span class="sxs-lookup"><span data-stu-id="9244d-296">When protection stops and there are no active backup jobs, the size of the last successful VM backup becomes the Protected Instance size used for the monthly bill.</span></span>

## <a name="questions"></a><span data-ttu-id="9244d-297">Des questions ?</span><span class="sxs-lookup"><span data-stu-id="9244d-297">Questions?</span></span>
<span data-ttu-id="9244d-298">Si vous avez des questions ou si vous souhaitez que certaines fonctionnalités soient incluses, [envoyez-nous vos commentaires](http://aka.ms/azurebackup_feedback).</span><span class="sxs-lookup"><span data-stu-id="9244d-298">If you have questions, or if there is any feature that you would like to see included, [send us feedback](http://aka.ms/azurebackup_feedback).</span></span>

## <a name="next-steps"></a><span data-ttu-id="9244d-299">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="9244d-299">Next steps</span></span>
* [<span data-ttu-id="9244d-300">Sauvegarde de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="9244d-300">Back up virtual machines</span></span>](backup-azure-vms.md)
* [<span data-ttu-id="9244d-301">Gestion de la sauvegarde de machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="9244d-301">Manage virtual machine backup</span></span>](backup-azure-manage-vms.md)
* [<span data-ttu-id="9244d-302">Restauration des machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="9244d-302">Restore virtual machines</span></span>](backup-azure-restore-vms.md)
* [<span data-ttu-id="9244d-303">Résoudre les problèmes de sauvegarde de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="9244d-303">Troubleshoot VM backup issues</span></span>](backup-azure-vms-troubleshoot.md)
