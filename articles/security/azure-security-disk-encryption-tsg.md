---
title: "aaaAzure résolution des problèmes de chiffrement de disque | Documents Microsoft"
description: "Cet article contient des conseils de dépannage concernant Microsoft Azure Disk Encryption pour les machines virtuelles IaaS Windows et Linux."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="da142-103">Guide de dépannage Azure Disk Encryption</span><span class="sxs-lookup"><span data-stu-id="da142-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="da142-104">Ce guide est aux professionnels informatiques (IT), informations d’aux analystes en sécurité et problèmes liés à des administrateurs de cloud dont l’organisation utilisent le chiffrement des disques Azure et avez besoin de conseils tootroubleshoot-chiffrement de disque.</span><span class="sxs-lookup"><span data-stu-id="da142-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="da142-105">Résolution des problèmes de chiffrement de disque de système d’exploitation Linux</span><span class="sxs-lookup"><span data-stu-id="da142-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="da142-106">Chiffrement de disque du système d’exploitation Linux devez démonter toorunning préalable du lecteur hello du système d’exploitation via le processus de chiffrement de disque complet hello.</span><span class="sxs-lookup"><span data-stu-id="da142-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="da142-107">S’il ne peut pas, un message d’erreur « Échec toounmount après... »</span><span class="sxs-lookup"><span data-stu-id="da142-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="da142-108">message d’erreur est probablement toooccur.</span><span class="sxs-lookup"><span data-stu-id="da142-108">error message is likely toooccur.</span></span>

<span data-ttu-id="da142-109">Cela se produit souvent lors d’une tentative de chiffrement de disque dans un environnement de machines virtuelles cible, quand l’image de ce dernier a été modifiée par rapport à celle de la galerie d’images stock (officielles) prises en charge.</span><span class="sxs-lookup"><span data-stu-id="da142-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="da142-110">Voici quelques exemples des écarts par rapport à partir de l’image hello pris en charge, ce qui peut interférer avec un lecteur de l’extension hello capacité toounmount hello du système d’exploitation :</span><span class="sxs-lookup"><span data-stu-id="da142-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="da142-111">Images personnalisées qui ne correspondent plus au système de fichiers et/ou au schéma de partitionnement pris en charge.</span><span class="sxs-lookup"><span data-stu-id="da142-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="da142-112">Images personnalisées avec des applications telles que les antivirus, Docker, SAP, MongoDB ou Cassandra Apache en cours d’exécution dans tooencryption préalable du système d’exploitation hello.</span><span class="sxs-lookup"><span data-stu-id="da142-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="da142-113">Ces applications sont tooterminate difficile, et lorsqu’ils conservent le lecteur de fichiers ouverts handles toohello du système d’exploitation, hello ne peut pas être démonté, à l’origine de la défaillance.</span><span class="sxs-lookup"><span data-stu-id="da142-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="da142-114">Les scripts personnalisés qui s’exécutent dans fermant étape de chiffrement toohello de proximité permettre interférer et provoquer cette défaillance.</span><span class="sxs-lookup"><span data-stu-id="da142-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="da142-115">Cela peut se produire lorsqu’un modèle de gestionnaire de ressources définit plusieurs extensions tooexecute simultanément, ou qu’une extension de script personnalisé ou une autre action s’exécute simultanément toodisk chiffrement.</span><span class="sxs-lookup"><span data-stu-id="da142-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="da142-116">Sérialisation et d’isoler ces étapes pour résoudre les problème de hello.</span><span class="sxs-lookup"><span data-stu-id="da142-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="da142-117">Lorsque SELinux n’a pas été désactivé tooenabling préalable chiffrement, hello démontez étape échoue.</span><span class="sxs-lookup"><span data-stu-id="da142-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="da142-118">SELinux peut être réactivé à la fin du chiffrement.</span><span class="sxs-lookup"><span data-stu-id="da142-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="da142-119">Lorsque hello du système d’exploitation disque utilise le schéma d’un gestionnaire de volume logique (bien que la prise en charge du disque de données Gestionnaire de volume logique limitée est disponible, disque de système d’exploitation du Gestionnaire de volume logique n’est pas)</span><span class="sxs-lookup"><span data-stu-id="da142-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="da142-120">Lorsque les conditions requises en matière de capacité de mémoire minimale ne sont pas remplies (7 Go sont recommandés pour le chiffrement de disque de système d’exploitation).</span><span class="sxs-lookup"><span data-stu-id="da142-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="da142-121">Lorsque les lecteurs de données ont été montés de manière récursive sous le répertoire /mnt/ou les uns sous les autres (par exemple /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.).</span><span class="sxs-lookup"><span data-stu-id="da142-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="da142-122">Lorsque les autres [conditions préalables](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) pour l’utilisation d’Azure Disk Encryption pour Linux ne sont pas satisfaites.</span><span class="sxs-lookup"><span data-stu-id="da142-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="da142-123">Impossible de tooencrypt</span><span class="sxs-lookup"><span data-stu-id="da142-123">Unable tooencrypt</span></span>

<span data-ttu-id="da142-124">Dans certains cas, le chiffrement de disque Linux hello apparaît toobe bloqué au niveau de « Chiffrement de disque du système d’exploitation a démarré » et SSH est désactivée.</span><span class="sxs-lookup"><span data-stu-id="da142-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="da142-125">Ce processus peut prendre entre toocomplete 3-16 heures sur une image de la galerie de stock.</span><span class="sxs-lookup"><span data-stu-id="da142-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="da142-126">Si les disques de données de taille de multi-to sont ajoutés, les processus hello peuvent prendre des jours.</span><span class="sxs-lookup"><span data-stu-id="da142-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="da142-127">Bonjour séquence de chiffrement de disque du système d’exploitation Linux démonte le lecteur de hello du système d’exploitation temporairement et effectue le chiffrement par bloc de hello totalité du système d’exploitation du disque, avant de remonter elle dans son état chiffré.</span><span class="sxs-lookup"><span data-stu-id="da142-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="da142-128">Contrairement au chiffrement de disque Azure sur Windows, chiffrement de disque Linux n’autorise pas l’utilisation simultanée de hello machine virtuelle pendant le chiffrement hello est en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="da142-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="da142-129">caractéristiques de performances Hello Hello machine virtuelle, y compris la taille de hello de disque de hello et indique si le compte de stockage hello est sauvegardé par le stockage standard ou premium (SSD), peuvent influencer considérablement hello durée toocomplete chiffrement.</span><span class="sxs-lookup"><span data-stu-id="da142-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="da142-130">état de toocheck, champ ProgressMessage de hello retourné à partir de hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) commande peut être interrogée.</span><span class="sxs-lookup"><span data-stu-id="da142-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="da142-131">Alors que lecteur de hello du système d’exploitation est chiffrée, hello VM entre dans un état de maintenance et SSH est également désactivé tooprevent n’importe quel processus en cours de toohello interruption de service.</span><span class="sxs-lookup"><span data-stu-id="da142-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="da142-132">EncryptionInProgress sera signalé pour la majorité de hello des temps de hello pendant que le chiffrement est en cours, suivie de plusieurs heures plus tard avec un message VMRestartPending invitant toorestart hello machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="da142-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="da142-133">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="da142-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="da142-134">Une fois invité tooreboot hello machine virtuelle, et après le redémarrage de hello machine virtuelle et en donnant 2 à 3 minutes pour le redémarrage de hello et toobe dernières étapes effectuées sur la cible de hello, message d’état hello indique que le chiffrement est enfin terminée.</span><span class="sxs-lookup"><span data-stu-id="da142-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="da142-135">Une fois que ce message est disponible, lecteur de système d’exploitation hello chiffré n’est attendue toobe prêt pour une utilisation et pour toobe de machine virtuelle hello utilisable.</span><span class="sxs-lookup"><span data-stu-id="da142-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="da142-136">Dans les cas où cette séquence n’est pas visible, ou si les informations de démarrage, un message de progression ou autres indicateurs d’erreur signalent que le chiffrement du système d’exploitation a échoué au milieu de hello de ce processus (par exemple si hello « Échec de toounmount » message d’erreur décrit dans ce guide), Il est recommandé de capture instantanée de toorestore hello VM toohello précédent ou sauvegarde effectuée immédiatement préalable tooencryption.</span><span class="sxs-lookup"><span data-stu-id="da142-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="da142-137">Toohello préalable prochaine tentative, il est suggéré toore-évaluer les caractéristiques de hello Hello machine virtuelle et vous assurer que toutes les conditions préalables sont satisfaites.</span><span class="sxs-lookup"><span data-stu-id="da142-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="da142-138">Résolution des problèmes Azure Disk Encryption derrière un pare-feu</span><span class="sxs-lookup"><span data-stu-id="da142-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="da142-139">Lorsque connectivité est limitée par une capacité hello pare-feu, une exigence de proxy ou paramètres de groupe (NSG) de sécurité réseau, hello extension tooperform nécessitent tâches peut être interrompues.</span><span class="sxs-lookup"><span data-stu-id="da142-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="da142-140">Cela peut entraîner des messages d’état tels que « État de l’Extension non disponible sur la machine virtuelle de hello » dans des scénarios attendus échouent toofinish.</span><span class="sxs-lookup"><span data-stu-id="da142-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="da142-141">les sections Hello qui suivent a certains problèmes courants de pare-feu que vous pouvez examiner.</span><span class="sxs-lookup"><span data-stu-id="da142-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="da142-142">groupes de sécurité réseau ;</span><span class="sxs-lookup"><span data-stu-id="da142-142">Network security groups</span></span>
<span data-ttu-id="da142-143">Les paramètres appliqués du groupe de sécurité réseau doivent toujours autoriser la hello point de terminaison toomeet hello documentée réseau configuration [conditions préalables](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) pour le chiffrement du disque.</span><span class="sxs-lookup"><span data-stu-id="da142-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="da142-144">Azure Key Vault derrière un pare-feu</span><span class="sxs-lookup"><span data-stu-id="da142-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="da142-145">Hello machine virtuelle doit être en mesure de tooaccess coffre de clés.</span><span class="sxs-lookup"><span data-stu-id="da142-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="da142-146">Consultez tooguidance lors d’une erreur de tookey accès derrière un pare-feu qui est géré par hello [le coffre de clés](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) équipe.</span><span class="sxs-lookup"><span data-stu-id="da142-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="da142-147">Gestion des packages Linux derrière un pare-feu</span><span class="sxs-lookup"><span data-stu-id="da142-147">Linux package management behind firewall</span></span>
<span data-ttu-id="da142-148">Au moment de l’exécution, le chiffrement de disque Azure pour Linux s’appuie sur package management tooinstall nécessité composants prérequis tooenabling préalable le chiffrement du système du hello cibler la distribution.</span><span class="sxs-lookup"><span data-stu-id="da142-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="da142-149">Si les paramètres de pare-feu empêchent d’hello machine virtuelle en mesure de toodownload et installent ces composants, les échecs suivants sont attendus.</span><span class="sxs-lookup"><span data-stu-id="da142-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="da142-150">tooconfigure d’étapes Hello que cela peut varier selon la distribution.</span><span class="sxs-lookup"><span data-stu-id="da142-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="da142-151">Sous Red Hat, lorsqu’un proxy est requis, vous devez absolument vous assurer que subscription-manager et yum sont configurés correctement.</span><span class="sxs-lookup"><span data-stu-id="da142-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="da142-152">Consultez [l’article](https://access.redhat.com/solutions/189533) de support Red Hat à ce propos.</span><span class="sxs-lookup"><span data-stu-id="da142-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="da142-153">Résolution des problèmes Windows Server 2016 Server Core</span><span class="sxs-lookup"><span data-stu-id="da142-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="da142-154">Sur Server Core de Windows Server 2016, composant de bdehdcfg hello n’est pas disponible par défaut.</span><span class="sxs-lookup"><span data-stu-id="da142-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="da142-155">Ce composant est requis par Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="da142-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="da142-156">tooworkaround ce problème, le hello copie suivant 4 fichiers depuis un dossier de c:\windows\system32 toohello machine virtuelle du centre de données de Windows Server 2016 d’image de Server Core hello :</span><span class="sxs-lookup"><span data-stu-id="da142-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="da142-157">Ensuite, exécutez hello de commande suivante :</span><span class="sxs-lookup"><span data-stu-id="da142-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="da142-158">Cette opération crée une partition de système de 550 Mo et puis après un redémarrage, vous pouvez utiliser des volumes de Diskpart toocheck hello et continuer.</span><span class="sxs-lookup"><span data-stu-id="da142-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="da142-159">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="da142-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="da142-160">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="da142-160">See also</span></span>
<span data-ttu-id="da142-161">Dans ce document, vous avez appris plus sur certains problèmes courants dans le chiffrement du disque Azure et comment tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="da142-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="da142-162">Pour plus d’informations sur ce service et ses fonctionnalités, consultez ces pages :</span><span class="sxs-lookup"><span data-stu-id="da142-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="da142-163">Appliquer le chiffrement de disque dans Azure Security Center</span><span class="sxs-lookup"><span data-stu-id="da142-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="da142-164">Chiffrement d’une machine virtuelle Azure</span><span class="sxs-lookup"><span data-stu-id="da142-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- <span data-ttu-id="da142-165">[Azure Data Encryption-at-Rest](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest) (Chiffrement des données Azure au repos)</span><span class="sxs-lookup"><span data-stu-id="da142-165">[Azure Data Encryption-at-Rest](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)</span></span>
