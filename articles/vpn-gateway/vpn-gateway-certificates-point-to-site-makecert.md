---
title: "Générer et exporter des certificats pour les connexions de point à site : MakeCert : Azure | Microsoft Docs"
description: "Cet article décrit les étapes permettant de créer un certificat racine auto-signé, d’exporter la clé publique et de générer des certificats clients à l’aide de MakeCert."
services: vpn-gateway
documentationcenter: na
author: cherylmc
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 
ms.service: vpn-gateway
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 08/09/2017
ms.author: cherylmc
ms.openlocfilehash: 4c51edac3b1cdafae8f9543bd0e3133b6a050f73
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 08/18/2017
---
# <a name="generate-and-export-certificates-for-point-to-site-connections-using-makecert"></a><span data-ttu-id="efdf5-103">Générer et exporter des certificats pour les connexions de point à site à l’aide de MakeCert</span><span class="sxs-lookup"><span data-stu-id="efdf5-103">Generate and export certificates for Point-to-Site connections using MakeCert</span></span>

<span data-ttu-id="efdf5-104">Les connexions de point à site utilisent des certificats pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="efdf5-104">Point-to-Site connections use certificates to authenticate.</span></span> <span data-ttu-id="efdf5-105">Cet article vous explique comment créer un certificat racine auto-signé et générer des certificats clients à l’aide de MakeCert.</span><span class="sxs-lookup"><span data-stu-id="efdf5-105">This article shows you how to create a self-signed root certificate and generate client certificates using MakeCert.</span></span> <span data-ttu-id="efdf5-106">Si vous recherchez des étapes de la configuration de point à site, telles que le chargement des certificats racines, sélectionnez l’un des articles « Configuration d’une connexion point à site à un réseau virtuel » dans la liste suivante :</span><span class="sxs-lookup"><span data-stu-id="efdf5-106">If you are looking for Point-to-Site configuration steps, such as how to upload root certificates, select one of the 'Configure Point-to-Site' articles from the following list:</span></span>

> [!div class="op_single_selector"]
> * [<span data-ttu-id="efdf5-107">Création de certificat auto-signés - PowerShell</span><span class="sxs-lookup"><span data-stu-id="efdf5-107">Create self-signed certificates - PowerShell</span></span>](vpn-gateway-certificates-point-to-site.md)
> * [<span data-ttu-id="efdf5-108">Création de certificat auto-signés - Makecert</span><span class="sxs-lookup"><span data-stu-id="efdf5-108">Create self-signed certificates - MakeCert</span></span>](vpn-gateway-certificates-point-to-site-makecert.md)
> * [<span data-ttu-id="efdf5-109">Configuration d’une connexion de point à site à un réseau virtuel - Resource Manager - Portail Azure</span><span class="sxs-lookup"><span data-stu-id="efdf5-109">Configure Point-to-Site - Resource Manager - Azure portal</span></span>](vpn-gateway-howto-point-to-site-resource-manager-portal.md)
> * [<span data-ttu-id="efdf5-110">Configuration d’une connexion point à site à un réseau virtuel - Resource Manager - PowerShell</span><span class="sxs-lookup"><span data-stu-id="efdf5-110">Configure Point-to-Site - Resource Manager - PowerShell</span></span>](vpn-gateway-howto-point-to-site-rm-ps.md)
> * [<span data-ttu-id="efdf5-111">Configuration d’une connexion de point à site à un réseau virtuel - Classic - Portail Azure</span><span class="sxs-lookup"><span data-stu-id="efdf5-111">Configure Point-to-Site - Classic - Azure portal</span></span>](vpn-gateway-howto-point-to-site-classic-azure-portal.md)
> 
> 

<span data-ttu-id="efdf5-112">Bien que nous recommandions de suivre les [étapes Windows 10 PowerShell](vpn-gateway-certificates-point-to-site.md) pour créer vos certificats, nous fournissons ces instructions MakeCert en tant que méthode facultative.</span><span class="sxs-lookup"><span data-stu-id="efdf5-112">While we recommend using the [Windows 10 PowerShell steps](vpn-gateway-certificates-point-to-site.md) to create your certificates, we provide these MakeCert instructions as an optional method.</span></span> <span data-ttu-id="efdf5-113">Les certificats que vous générez à l’aide de ces deux méthodes peuvent être installés sur [tout système d’exploitation client pris en charge](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span><span class="sxs-lookup"><span data-stu-id="efdf5-113">The certificates that you generate using either method can be installed on [any supported client operating system](vpn-gateway-howto-point-to-site-resource-manager-portal.md#faq).</span></span> <span data-ttu-id="efdf5-114">Toutefois, MakeCert présente la limitation suivante :</span><span class="sxs-lookup"><span data-stu-id="efdf5-114">However, MakeCert has the following limitation:</span></span>

* <span data-ttu-id="efdf5-115">MakeCert est déconseillé.</span><span class="sxs-lookup"><span data-stu-id="efdf5-115">MakeCert is deprecated.</span></span> <span data-ttu-id="efdf5-116">Cela signifie que cet outil pourrait être supprimé à tout moment.</span><span class="sxs-lookup"><span data-stu-id="efdf5-116">This means that this tool could be removed at any point.</span></span> <span data-ttu-id="efdf5-117">Les certificats que vous avez déjà générés à l’aide de MakeCert ne sont pas affectés quand MakeCert n’est plus disponible.</span><span class="sxs-lookup"><span data-stu-id="efdf5-117">Any certificates that you already generated using MakeCert won't be affected when MakeCert is no longer available.</span></span> <span data-ttu-id="efdf5-118">MakeCert est utilisé uniquement pour générer les certificats, pas comme mécanisme de validation.</span><span class="sxs-lookup"><span data-stu-id="efdf5-118">MakeCert is only used to generate the certificates, not as a validating mechanism.</span></span>

## <span data-ttu-id="efdf5-119"><a name="rootcert"></a>Créer un certificat racine auto-signé</span><span class="sxs-lookup"><span data-stu-id="efdf5-119"><a name="rootcert"></a>Create a self-signed root certificate</span></span>

<span data-ttu-id="efdf5-120">Les étapes suivantes vous montrent comment créer un certificat auto-signé à l’aide de MakeCert.</span><span class="sxs-lookup"><span data-stu-id="efdf5-120">The following steps show you how to create a self-signed certificate using MakeCert.</span></span> <span data-ttu-id="efdf5-121">Ces étapes ne sont pas spécifiques au modèle de déploiement.</span><span class="sxs-lookup"><span data-stu-id="efdf5-121">These steps are not deployment-model specific.</span></span> <span data-ttu-id="efdf5-122">Elles sont valides pour le modèle Resource Manager et classique.</span><span class="sxs-lookup"><span data-stu-id="efdf5-122">They are valid for both Resource Manager and classic.</span></span>

1. <span data-ttu-id="efdf5-123">Téléchargez et installez [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="efdf5-123">Download and install [MakeCert](https://msdn.microsoft.com/library/windows/desktop/aa386968(v=vs.85).aspx).</span></span>
2. <span data-ttu-id="efdf5-124">Après l’installation, vous pouvez généralement trouver l’utilitaire makecert.exe dans le chemin d’accès suivant : C:\Program Files (x86)\Windows Kits\10\bin\<arch>.</span><span class="sxs-lookup"><span data-stu-id="efdf5-124">After installation, you can typically find the makecert.exe utility under this path: 'C:\Program Files (x86)\Windows Kits\10\bin\<arch>'.</span></span> <span data-ttu-id="efdf5-125">Toutefois, il est possible qu’il ait été installé dans un autre emplacement.</span><span class="sxs-lookup"><span data-stu-id="efdf5-125">Although, it's possible that it was installed to another location.</span></span> <span data-ttu-id="efdf5-126">Ouvrez une invite de commandes avec des privilèges d’administrateur et accédez au dossier de l’utilitaire MakeCert.</span><span class="sxs-lookup"><span data-stu-id="efdf5-126">Open a command prompt as administrator and navigate to the location of the MakeCert utility.</span></span> <span data-ttu-id="efdf5-127">Vous pouvez utiliser l’exemple suivant, en l’ajustant pour l’emplacement approprié :</span><span class="sxs-lookup"><span data-stu-id="efdf5-127">You can use the following example, adjusting for the proper location:</span></span>

  ```cmd
  cd C:\Program Files (x86)\Windows Kits\10\bin\x64
  ```
3. <span data-ttu-id="efdf5-128">Créez et installez un certificat dans le magasin de certificats personnels sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="efdf5-128">Create and install a certificate in the Personal certificate store on your computer.</span></span> <span data-ttu-id="efdf5-129">L’exemple suivant crée un fichier *.cer* correspondant que vous chargez sur Azure au moment de la configuration P2S.</span><span class="sxs-lookup"><span data-stu-id="efdf5-129">The following example creates a corresponding *.cer* file that you upload to Azure when configuring P2S.</span></span> <span data-ttu-id="efdf5-130">Remplacez 'P2SRootCert' et 'P2SRootCert.cer' par le nom que vous voulez attribuer au certificat.</span><span class="sxs-lookup"><span data-stu-id="efdf5-130">Replace 'P2SRootCert' and 'P2SRootCert.cer' with the name that you want to use for the certificate.</span></span> <span data-ttu-id="efdf5-131">Le certificat se trouve dans votre dossier Certificates : Current User\Personal\Certificates.</span><span class="sxs-lookup"><span data-stu-id="efdf5-131">The certificate is located in your 'Certificates - Current User\Personal\Certificates'.</span></span>

  ```cmd
  makecert -sky exchange -r -n "CN=P2SRootCert" -pe -a sha256 -len 2048 -ss My
  ```

## <span data-ttu-id="efdf5-132"><a name="cer"></a>Exporter la clé publique (.cer)</span><span class="sxs-lookup"><span data-stu-id="efdf5-132"><a name="cer"></a>Export the public key (.cer)</span></span>

[!INCLUDE [Export public key](../../includes/vpn-gateway-certificates-export-public-key-include.md)]

<span data-ttu-id="efdf5-133">Le fichier exported.cer doit être chargé dans Azure.</span><span class="sxs-lookup"><span data-stu-id="efdf5-133">The exported.cer file must be uploaded to Azure.</span></span> <span data-ttu-id="efdf5-134">Pour obtenir des instructions, consultez [Configurer une connexion de point à site](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span><span class="sxs-lookup"><span data-stu-id="efdf5-134">For instructions, see [Configure a Point-to-Site connection](vpn-gateway-howto-point-to-site-resource-manager-portal.md#uploadfile).</span></span> <span data-ttu-id="efdf5-135">Pour ajouter un certificat racine approuvé, voir [cette section](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) de l’article.</span><span class="sxs-lookup"><span data-stu-id="efdf5-135">To add an additional trusted root certificate, see [this section](vpn-gateway-howto-point-to-site-resource-manager-portal.md#add) of the article.</span></span>

### <a name="export-the-self-signed-certificate-and-private-key-to-store-it-optional"></a><span data-ttu-id="efdf5-136">Exporter le certificat auto-signé et la clé privée pour la stocker (facultatif)</span><span class="sxs-lookup"><span data-stu-id="efdf5-136">Export the self-signed certificate and private key to store it (optional)</span></span>

<span data-ttu-id="efdf5-137">Vous souhaiterez peut-être exporter le certificat racine auto-signé et le stocker en toute sécurité.</span><span class="sxs-lookup"><span data-stu-id="efdf5-137">You may want to export the self-signed root certificate and store it safely.</span></span> <span data-ttu-id="efdf5-138">Si besoin est, vous pouvez l’installer ultérieurement sur un autre ordinateur et générer davantage de certificats clients ou exporter un autre fichier .cer.</span><span class="sxs-lookup"><span data-stu-id="efdf5-138">If need be, you can later install it on another computer and generate more client certificates, or export another .cer file.</span></span> <span data-ttu-id="efdf5-139">Pour exporter le certificat racine auto-signé au format .pfx, sélectionnez le certificat racine et suivez les étapes décrites dans la section [Exporter un certificat client](#clientexport).</span><span class="sxs-lookup"><span data-stu-id="efdf5-139">To export the self-signed root certificate as a .pfx, select the root certificate and use the same steps as described in [Export a client certificate](#clientexport).</span></span>

## <a name="create-and-install-client-certificates"></a><span data-ttu-id="efdf5-140">Créer et installer des certificats clients</span><span class="sxs-lookup"><span data-stu-id="efdf5-140">Create and install client certificates</span></span>

<span data-ttu-id="efdf5-141">Vous n’installez pas le certificat auto-signé directement sur l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="efdf5-141">You don't install the self-signed certificate directly on the client computer.</span></span> <span data-ttu-id="efdf5-142">Vous devez générer un certificat client à partir du certificat auto-signé.</span><span class="sxs-lookup"><span data-stu-id="efdf5-142">You need to generate a client certificate from the self-signed certificate.</span></span> <span data-ttu-id="efdf5-143">Ensuite, vous exportez et installez le certificat client sur l’ordinateur client.</span><span class="sxs-lookup"><span data-stu-id="efdf5-143">You then export and install the client certificate to the client computer.</span></span> <span data-ttu-id="efdf5-144">Les étapes suivantes ne sont pas spécifiques au modèle de déploiement.</span><span class="sxs-lookup"><span data-stu-id="efdf5-144">The following steps are not deployment-model specific.</span></span> <span data-ttu-id="efdf5-145">Elles sont valides pour le modèle Resource Manager et classique.</span><span class="sxs-lookup"><span data-stu-id="efdf5-145">They are valid for both Resource Manager and classic.</span></span>

### <span data-ttu-id="efdf5-146"><a name="clientcert"></a>Générer un certificat client</span><span class="sxs-lookup"><span data-stu-id="efdf5-146"><a name="clientcert"></a>Generate a client certificate</span></span>

<span data-ttu-id="efdf5-147">Chaque ordinateur client qui se connecte à un réseau virtuel avec une connexion de point à site doit avoir un certificat client installé.</span><span class="sxs-lookup"><span data-stu-id="efdf5-147">Each client computer that connects to a VNet using Point-to-Site must have a client certificate installed.</span></span> <span data-ttu-id="efdf5-148">Vous générez un certificat client à partir du certificat racine auto-signé, puis l’exportez et l’installez.</span><span class="sxs-lookup"><span data-stu-id="efdf5-148">You generate a client certificate from the self-signed root certificate, and then export and install the client certificate.</span></span> <span data-ttu-id="efdf5-149">Si le certificat client n’est pas installé, l’authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="efdf5-149">If the client certificate is not installed, authentication fails.</span></span> 

<span data-ttu-id="efdf5-150">Les étapes suivantes vous guident dans la génération d’un certificat client à partir d’un certificat racine auto-signé.</span><span class="sxs-lookup"><span data-stu-id="efdf5-150">The following steps walk you through generating a client certificate from a self-signed root certificate.</span></span> <span data-ttu-id="efdf5-151">Vous pouvez générer plusieurs certificats clients à partir d’un même certificat racine.</span><span class="sxs-lookup"><span data-stu-id="efdf5-151">You may generate multiple client certificates from the same root certificate.</span></span> <span data-ttu-id="efdf5-152">Lorsque vous générez des certificats clients suivant les étapes ci-dessous, le certificat client est automatiquement installé sur l’ordinateur que vous avez utilisé pour générer le certificat.</span><span class="sxs-lookup"><span data-stu-id="efdf5-152">When you generate client certificates using the steps below, the client certificate is automatically installed on the computer that you used to generate the certificate.</span></span> <span data-ttu-id="efdf5-153">Si vous souhaitez installer un certificat client sur un autre ordinateur client, vous pouvez exporter le certificat.</span><span class="sxs-lookup"><span data-stu-id="efdf5-153">If you want to install a client certificate on another client computer, you can export the certificate.</span></span>
 
1. <span data-ttu-id="efdf5-154">Sur l’ordinateur que vous avez utilisé pour créer le certificat auto-signé, ouvrez une invite de commandes comme administrateur.</span><span class="sxs-lookup"><span data-stu-id="efdf5-154">On the same computer that you used to create the self-signed certificate, open a command prompt as administrator.</span></span>
2. <span data-ttu-id="efdf5-155">Modifiez et exécutez l’exemple pour générer un certificat client.</span><span class="sxs-lookup"><span data-stu-id="efdf5-155">Modify and run the sample to generate a client certificate.</span></span>
  * <span data-ttu-id="efdf5-156">Remplacez *"P2SRootCert"* par le nom du certificat racine auto-signé à partir duquel vous générez le certificat client.</span><span class="sxs-lookup"><span data-stu-id="efdf5-156">Change *"P2SRootCert"* to the name of the self-signed root that you are generating the client certificate from.</span></span> <span data-ttu-id="efdf5-157">Veillez à utiliser le nom du certificat racine, c'est-à-dire la valeur « CN » que vous avez spécifiée lorsque vous avez créé le certificat racine auto-signé.</span><span class="sxs-lookup"><span data-stu-id="efdf5-157">Make sure you are using the name of the root certificate, which is whatever the 'CN=' value was that you specified when you created the self-signed root.</span></span>
  * <span data-ttu-id="efdf5-158">Remplacez *P2SChildCert* par le nom que vous souhaitez pour générer un certificat client.</span><span class="sxs-lookup"><span data-stu-id="efdf5-158">Change *P2SChildCert* to the name you want to generate a client certificate to be.</span></span>

  <span data-ttu-id="efdf5-159">Si vous exécutez l’exemple suivant en l’état, cette opération entraîne la création d’un certificat client nommé P2SChildcert dans votre magasin de certificats personnel généré à partir du certificat racine P2SChildcert.</span><span class="sxs-lookup"><span data-stu-id="efdf5-159">If you run the following example without modifying it, the result is a client certificate named P2SChildcert in your Personal certificate store that was generated from root certificate P2SRootCert.</span></span>

  ```cmd
  makecert.exe -n "CN=P2SChildCert" -pe -sky exchange -m 96 -ss My -in "P2SRootCert" -is my -a sha256
  ```

### <span data-ttu-id="efdf5-160"><a name="clientexport"></a>Exporter un certificat client</span><span class="sxs-lookup"><span data-stu-id="efdf5-160"><a name="clientexport"></a>Export a client certificate</span></span>

[!INCLUDE [Export client certificate](../../includes/vpn-gateway-certificates-export-client-cert-include.md)]

### <span data-ttu-id="efdf5-161"><a name="install"></a>Installer un certificat client exporté</span><span class="sxs-lookup"><span data-stu-id="efdf5-161"><a name="install"></a>Install an exported client certificate</span></span>

[!INCLUDE [Install client certificate](../../includes/vpn-gateway-certificates-install-client-cert-include.md)]

## <a name="next-steps"></a><span data-ttu-id="efdf5-162">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="efdf5-162">Next steps</span></span>

<span data-ttu-id="efdf5-163">Poursuivez votre configuration point à site.</span><span class="sxs-lookup"><span data-stu-id="efdf5-163">Continue with your Point-to-Site configuration.</span></span> 

* <span data-ttu-id="efdf5-164">Pour connaître les étapes du modèle de déploiement **Resource Manager**, consultez la page [Configurer une connexion de point à site à un réseau virtuel](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span><span class="sxs-lookup"><span data-stu-id="efdf5-164">For **Resource Manager** deployment model steps, see [Configure a Point-to-Site connection to a VNet](vpn-gateway-howto-point-to-site-resource-manager-portal.md).</span></span>
* <span data-ttu-id="efdf5-165">Pour connaître les étapes du modèle de déploiement **Classic**, consultez la page [Configurer une connexion VPN de point à site à un réseau virtuel (Classic)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="efdf5-165">For **classic** deployment model steps, see [Configure a Point-to-Site VPN connection to a VNet (classic)](vpn-gateway-howto-point-to-site-classic-azure-portal.md).</span></span>
