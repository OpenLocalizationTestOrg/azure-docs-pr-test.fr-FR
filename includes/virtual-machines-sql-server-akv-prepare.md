## <a name="prepare-for-akv-integration"></a><span data-ttu-id="283f2-101">Préparation pour AKV Integration</span><span class="sxs-lookup"><span data-stu-id="283f2-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="283f2-102">Il existe plusieurs conditions préalables pour utiliser Azure Key Vault Integration pour configurer votre machine virtuelle SQL Server :</span><span class="sxs-lookup"><span data-stu-id="283f2-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="283f2-103">Installation d'Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="283f2-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="283f2-104">Création d'un Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="283f2-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="283f2-105">Création d’un coffre de clés</span><span class="sxs-lookup"><span data-stu-id="283f2-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="283f2-106">Les sections suivantes décrivent ces conditions préalables et les informations que vous devez collecter pour exécuter ultérieurement des applets de commande PowerShell.</span><span class="sxs-lookup"><span data-stu-id="283f2-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="283f2-107">Installation d'Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="283f2-107">Install Azure PowerShell</span></span>
<span data-ttu-id="283f2-108">Assurez-vous que vous avez installé la dernière version du kit de développement logiciel (SDK) Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="283f2-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="283f2-109">Pour plus d’informations, consultez la rubrique [Installation et configuration d’Azure PowerShell](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="283f2-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="283f2-110">Création d'un Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="283f2-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="283f2-111">Tout d’abord, votre abonnement doit comporter un [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (ADD).</span><span class="sxs-lookup"><span data-stu-id="283f2-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="283f2-112">Cela vous permet, entre autres avantages, d'accorder des droits d'accès à votre coffre de clés à certains utilisateurs et d'applications.</span><span class="sxs-lookup"><span data-stu-id="283f2-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="283f2-113">Inscrivez ensuite une application auprès d'ADD.</span><span class="sxs-lookup"><span data-stu-id="283f2-113">Next, register an application with AAD.</span></span> <span data-ttu-id="283f2-114">Vous obtiendrez un compte Principal du service ayant un accès à votre coffre de clés dont votre machine virtuelle a besoin.</span><span class="sxs-lookup"><span data-stu-id="283f2-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="283f2-115">Dans l’article Coffre de clés Azure, vous pouvez trouver ces étapes dans la section [Inscription d’une application auprès d’Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register), ou vous pouvez voir les étapes avec des captures d’écran dans la section **Obtention d’une identité pour l’application** de [ce billet de blog](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="283f2-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="283f2-116">Avant d'effectuer ces étapes, notez que vous devez collecter les informations suivantes au cours de cette inscription. Elles seront nécessaires ultérieurement lorsque vous activerez Azure Key Vault Integration dans votre machine virtuelle SQL.</span><span class="sxs-lookup"><span data-stu-id="283f2-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="283f2-117">Une fois l’application ajoutée, recherchez **l’ID CLIENT** dans l’onglet **CONFIGURER**.</span><span class="sxs-lookup"><span data-stu-id="283f2-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="283f2-118">![ID de Client Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="283f2-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="283f2-119">L’ID client est affecté ultérieurement au paramètre **$spName** (nom du principal du service) dans le script PowerShell pour activer l’intégration du Coffre de clés Azure.</span><span class="sxs-lookup"><span data-stu-id="283f2-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="283f2-120">Au cours de ces étapes, lorsque vous créez votre clé, copiez également son secret comme indiqué dans la capture d'écran suivante.</span><span class="sxs-lookup"><span data-stu-id="283f2-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="283f2-121">Ce secret de clé est affecté ultérieurement au paramètre **$spSecret** (secret du principal du service) dans le script PowerShell.</span><span class="sxs-lookup"><span data-stu-id="283f2-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="283f2-122">![Secret Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="283f2-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="283f2-123">Vous devez autoriser ce nouvel ID client pour disposer des autorisations d’accès suivantes : **chiffrer**, **déchiffrer**, **wrapKey**, **unwrapKey**, **signer**, et **vérifier**.</span><span class="sxs-lookup"><span data-stu-id="283f2-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="283f2-124">Cette opération s’effectue avec l’applet de commande [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) .</span><span class="sxs-lookup"><span data-stu-id="283f2-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="283f2-125">Pour plus d’informations, consultez [Autorisation de l’application pour l’utilisation de la clé ou du secret](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="283f2-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="283f2-126">Création d’un coffre de clés</span><span class="sxs-lookup"><span data-stu-id="283f2-126">Create a key vault</span></span>
<span data-ttu-id="283f2-127">Pour utiliser Azure Key Vault pour stocker les clés que vous utiliserez pour le chiffrement dans votre machine virtuelle, vous devez accéder à un coffre de clés.</span><span class="sxs-lookup"><span data-stu-id="283f2-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="283f2-128">Si vous n’avez pas déjà configuré votre coffre de clés, créez-en un en suivant les étapes décrites dans la rubrique [Prise en main du coffre de clés Azure](../articles/key-vault/key-vault-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="283f2-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="283f2-129">Avant d'effectuer ces étapes, vous devrez collecter certaines informations au cours de la configuration. Elles seront nécessaires ultérieurement lorsque vous activerez Azure Key Vault Integration dans votre machine virtuelle SQL.</span><span class="sxs-lookup"><span data-stu-id="283f2-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="283f2-130">Lorsque vous arrivez à l’étape de création d’un coffre de clés, notez la propriété **vaultUri** renvoyée. Il s’agit de l’URL du coffre de clés.</span><span class="sxs-lookup"><span data-stu-id="283f2-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="283f2-131">Dans l’exemple illustré ci-dessous et fourni à cette étape, le nom du coffre de clés est ContosoKeyVault. Par conséquent, l’URL du coffre de clés sera https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="283f2-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="283f2-132">L’URL du coffre de clés est affectée ultérieurement au paramètre **$akvURL** dans le script PowerShell pour activer l’intégration du coffre de clés Azure.</span><span class="sxs-lookup"><span data-stu-id="283f2-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>

