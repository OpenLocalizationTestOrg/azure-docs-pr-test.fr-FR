# <a name="common-errors-during-classic-to-azure-resource-manager-migration"></a><span data-ttu-id="01c11-101">Erreurs courantes lors de la migration de Classic vers Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="01c11-101">Common errors during Classic to Azure Resource Manager migration</span></span>
<span data-ttu-id="01c11-102">Cet article répertorie les erreurs les plus courantes et leur atténuation lors la migration de ressources IaaS du modèle de déploiement Azure Classic vers la pile Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-102">This article catalogs the most common errors and mitigations during the migration of IaaS resources from Azure classic deployment model to the Azure Resource Manager stack.</span></span>

## <a name="list-of-errors"></a><span data-ttu-id="01c11-103">Liste d’erreurs</span><span class="sxs-lookup"><span data-stu-id="01c11-103">List of errors</span></span>
| <span data-ttu-id="01c11-104">Chaîne d’erreur</span><span class="sxs-lookup"><span data-stu-id="01c11-104">Error string</span></span> | <span data-ttu-id="01c11-105">Atténuation</span><span class="sxs-lookup"><span data-stu-id="01c11-105">Mitigation</span></span> |
| --- | --- |
| <span data-ttu-id="01c11-106">Erreur interne du serveur</span><span class="sxs-lookup"><span data-stu-id="01c11-106">Internal server error</span></span> |<span data-ttu-id="01c11-107">Dans certains cas, il s’agit d’une erreur temporaire qui disparaît à la tentative suivante.</span><span class="sxs-lookup"><span data-stu-id="01c11-107">In some cases, this is a transient error that goes away with a retry.</span></span> <span data-ttu-id="01c11-108">Si elle persiste, [contactez le support technique Azure](../articles/azure-supportability/how-to-create-azure-support-request.md), car un examen des journaux de la plateforme est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="01c11-108">If it continues to persist, [contact Azure support](../articles/azure-supportability/how-to-create-azure-support-request.md) as it needs investigation of platform logs.</span></span> <br><br> <span data-ttu-id="01c11-109">**REMARQUE :** lorsque l’incident est suivi par l’équipe de support, ne tentez aucune procédure d’atténuation automatique, car cela pourrait avoir des conséquences inattendues sur votre environnement.</span><span class="sxs-lookup"><span data-stu-id="01c11-109">**NOTE:** Once the incident is tracked by the support team, please do not attempt any self-mitigation as this might have unintended consequences on your environment.</span></span> |
| <span data-ttu-id="01c11-110">La migration n’est pas prise en charge pour le déploiement {deployment-name} dans le service hébergé {hosted-service-name} car il s’agit d’un déploiement PaaS (Web/Worker).</span><span class="sxs-lookup"><span data-stu-id="01c11-110">Migration is not supported for Deployment {deployment-name}  in HostedService {hosted-service-name} because it is a PaaS deployment (Web/Worker).</span></span> |<span data-ttu-id="01c11-111">Cela se produit lorsque le déploiement contient un rôle web/de travail.</span><span class="sxs-lookup"><span data-stu-id="01c11-111">This happens when a deployment contains a web/worker role.</span></span> <span data-ttu-id="01c11-112">Étant donné que la migration n’est prise en charge que pour les Machines Virtuelles, veuillez supprimer le rôle web/de travail du déploiement et effectuer une nouvelle tentative de migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-112">Since migration is only supported for Virtual Machines, please remove the web/worker role from the deployment and try migration again.</span></span> |
| <span data-ttu-id="01c11-113">Échec du déploiement du modèle {template-name}.</span><span class="sxs-lookup"><span data-stu-id="01c11-113">Template {template-name} deployment failed.</span></span> <span data-ttu-id="01c11-114">CorrelationId={guid}</span><span class="sxs-lookup"><span data-stu-id="01c11-114">CorrelationId={guid}</span></span> |<span data-ttu-id="01c11-115">Sur le serveur principal du service de migration, nous utilisons des modèles Azure Resource Manager pour créer des ressources dans la pile Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-115">In the backend of migration service, we use Azure Resource Manager templates to create resources in the Azure Resource Manager stack.</span></span> <span data-ttu-id="01c11-116">Les modèles étant idempotents, vous pouvez généralement réessayer en toute sécurité l’opération de migration pour passer outre cette erreur.</span><span class="sxs-lookup"><span data-stu-id="01c11-116">Since templates are idempotent, usually you can safely retry the migration operation to get past this error.</span></span> <span data-ttu-id="01c11-117">Si elle persiste, veuillez [contactez le support Azure](../articles/azure-supportability/how-to-create-azure-support-request.md) et lui donner le CorrelationId.</span><span class="sxs-lookup"><span data-stu-id="01c11-117">If this error continues to persist, please [contact Azure support](../articles/azure-supportability/how-to-create-azure-support-request.md) and give them the CorrelationId.</span></span> <br><br> <span data-ttu-id="01c11-118">**REMARQUE :** lorsque l’incident est suivi par l’équipe de support, ne tentez aucune procédure d’atténuation automatique, car cela pourrait avoir des conséquences inattendues sur votre environnement.</span><span class="sxs-lookup"><span data-stu-id="01c11-118">**NOTE:** Once the incident is tracked by the support team, please do not attempt any self-mitigation as this might have unintended consequences on your environment.</span></span> |
| <span data-ttu-id="01c11-119">Le réseau virtuel {virtual-network-name} n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="01c11-119">The virtual network {virtual-network-name} does not exist.</span></span> |<span data-ttu-id="01c11-120">Cela peut se produire si vous avez créé le réseau virtuel dans le nouveau Portail Azure.</span><span class="sxs-lookup"><span data-stu-id="01c11-120">This can happen if you created the Virtual Network in the new Azure portal.</span></span> <span data-ttu-id="01c11-121">Le nom réel du réseau virtuel suit le modèle « Group * <VNET name>».</span><span class="sxs-lookup"><span data-stu-id="01c11-121">The actual Virtual Network name follows the pattern "Group * <VNET name>"</span></span> |
| <span data-ttu-id="01c11-122">La machine virtuelle {vm-name} du service hébergé {hosted-service-name} contient une extension {extension-name} qui n’est pas prise en charge dans Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-122">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} which is not supported in Azure Resource Manager.</span></span> <span data-ttu-id="01c11-123">Il est recommandé de la désinstaller de la machine virtuelle avant de poursuivre la migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-123">It is recommended to uninstall it from the VM before continuing with migration.</span></span> |<span data-ttu-id="01c11-124">Les extensions XML telles que BGInfo 1.* ne sont pas prises en charge dans Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-124">XML extensions such as BGInfo 1.* are not supported in Azure Resource Manager.</span></span> <span data-ttu-id="01c11-125">Par conséquent, elles ne peuvent pas faire l’objet d’une migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-125">Therefore, these extensions cannot be migrated.</span></span> <span data-ttu-id="01c11-126">Si elles sont toujours installées sur la machine virtuelle, elles sont automatiquement désinstallées avant la fin de la migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-126">If these extensions are left installed on the virtual machine, they are automatically uninstalled before completing the migration.</span></span> |
| <span data-ttu-id="01c11-127">La machine virtuelle {vm-name} du service hébergé {hosted-service-name} contient l’extension VMSnapshot/VMSnapshotLinux, dont la migration n’est actuellement pas prise en charge.</span><span class="sxs-lookup"><span data-stu-id="01c11-127">VM {vm-name} in HostedService {hosted-service-name} contains Extension VMSnapshot/VMSnapshotLinux, which is currently not supported for Migration.</span></span> <span data-ttu-id="01c11-128">Désinstallez-la de la machine virtuelle et rajoutez-la à l’aide d’Azure Resource Manager une fois la migration terminée.</span><span class="sxs-lookup"><span data-stu-id="01c11-128">Uninstall it from the VM and add it back using Azure Resource Manager after the Migration is Complete</span></span> |<span data-ttu-id="01c11-129">C’est le scénario dans lequel la machine virtuelle est configurée pour la Sauvegarde Azure.</span><span class="sxs-lookup"><span data-stu-id="01c11-129">This is the scenario where the virtual machine is configured for Azure Backup.</span></span> <span data-ttu-id="01c11-130">Étant donné qu’il n’est pas pris en charge pour le moment, suivez la solution de contournement à la page https://aka.ms/vmbackupmigration</span><span class="sxs-lookup"><span data-stu-id="01c11-130">Since this is currently an unsupported scenario, please follow the workaround at https://aka.ms/vmbackupmigration</span></span> |
| <span data-ttu-id="01c11-131">La machine virtuelle {vm-name} du service hébergé {hosted-service-name} contient une extension {extension-name} dont l’état n’est pas généré à partir de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="01c11-131">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} whose Status is not being reported from the VM.</span></span> <span data-ttu-id="01c11-132">Par conséquent, elle ne peut pas faire l’objet d’une migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-132">Hence, this VM cannot be migrated.</span></span> <span data-ttu-id="01c11-133">Assurez-vous que l’état de l’extension est généré ou désinstallez l’extension de la machine virtuelle et effectuez une nouvelle tentative de migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-133">Ensure that the Extension status is being reported or uninstall the extension from the VM and retry migration.</span></span> <br><br> <span data-ttu-id="01c11-134">La machine virtuelle {vm-name} du service hébergé {hosted-service-name} contient une extension {extension-name} qui génère l’état de gestionnaire : {handler-status}.</span><span class="sxs-lookup"><span data-stu-id="01c11-134">VM {vm-name} in HostedService {hosted-service-name} contains Extension {extension-name} reporting Handler Status: {handler-status}.</span></span> <span data-ttu-id="01c11-135">Par conséquent, la machine virtuelle ne peut pas être migrée.</span><span class="sxs-lookup"><span data-stu-id="01c11-135">Hence, the VM cannot be migrated.</span></span> <span data-ttu-id="01c11-136">Assurez-vous que l’état du gestionnaire de l’extension généré est {handler-status} ou désinstallez-la de la machine virtuelle et effectuez une nouvelle tentative de migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-136">Ensure that the Extension handler status being reported is {handler-status} or uninstall it from the VM and retry migration.</span></span> <br><br> <span data-ttu-id="01c11-137">L’agent de la machine virtuelle {vm-name} du service hébergé {hosted-service-name} génère l’état global « Pas prêt ».</span><span class="sxs-lookup"><span data-stu-id="01c11-137">VM Agent for VM {vm-name} in HostedService {hosted-service-name} is reporting the overall agent status as Not Ready.</span></span> <span data-ttu-id="01c11-138">Par conséquent, la machine virtuelle ne peut pas faire l’objet d’une migration, si elle a une extension migrable.</span><span class="sxs-lookup"><span data-stu-id="01c11-138">Hence, the VM may not be migrated, if it has a migratable extension.</span></span> <span data-ttu-id="01c11-139">Assurez-vous que l’agent de la machine virtuelle génère l’état global de l’agent « Prêt ».</span><span class="sxs-lookup"><span data-stu-id="01c11-139">Ensure that the VM Agent is reporting overall agent status as Ready.</span></span> <span data-ttu-id="01c11-140">Reportez-vous à https://aka.ms/classiciaasmigrationfaqs.</span><span class="sxs-lookup"><span data-stu-id="01c11-140">Refer to https://aka.ms/classiciaasmigrationfaqs.</span></span> |<span data-ttu-id="01c11-141">L’agent invité Azure et les extensions de machines virtuelles ont besoin d’un accès Internet sortant au compte de stockage de la machine virtuelle pour remplir leur état.</span><span class="sxs-lookup"><span data-stu-id="01c11-141">Azure guest agent & VM Extensions need outbound internet access to the VM storage account to populate their status.</span></span> <span data-ttu-id="01c11-142">Causes les plus courantes d’échec de l’état :</span><span class="sxs-lookup"><span data-stu-id="01c11-142">Common causes of status failure include</span></span> <li> <span data-ttu-id="01c11-143">un groupe de sécurité réseau bloque l’accès sortant à Internet ;</span><span class="sxs-lookup"><span data-stu-id="01c11-143">a Network Security Group that blocks outbound access to the internet</span></span> <li> <span data-ttu-id="01c11-144">le réseau virtuel a des serveurs DNS locaux et la connectivité DNS est perdue.</span><span class="sxs-lookup"><span data-stu-id="01c11-144">If the VNET has on-prem DNS servers and DNS connectivity is lost</span></span> <br><br> <span data-ttu-id="01c11-145">Si vous continuez à voir l’état « non pris en charge », vous pouvez désinstaller les extensions pour ignorer cette vérification et poursuivre la migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-145">If you continue to see an unsupported status, you can uninstall the extensions to skip this check and move forward with migration.</span></span> |
| <span data-ttu-id="01c11-146">La migration n’est pas prise en charge pour le déploiement {deployment-name} dans le service hébergé {hosted-service-name} car il contient plusieurs groupes à haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="01c11-146">Migration is not supported for Deployment {deployment-name} in HostedService {hosted-service-name} because it has multiple Availability Sets.</span></span> |<span data-ttu-id="01c11-147">Actuellement, seuls les services hébergés contenant au maximum un groupe à haute disponibilité peuvent faire l’objet d’une migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-147">Currently, only hosted services that have 1 or less Availability sets can be migrated.</span></span> <span data-ttu-id="01c11-148">Pour contourner ce problème, déplacez les groupes à haute disponibilité excédentaires et les machines virtuelles qu’ils contiennent vers un autre service hébergé.</span><span class="sxs-lookup"><span data-stu-id="01c11-148">To work around this problem, please move the additional Availability sets and Virtual machines in those Availability sets to a different hosted service.</span></span> |
| <span data-ttu-id="01c11-149">La migration n’est pas prise en charge pour le déploiement {deployment-name} dans le service hébergé {hosted-service-name} car il contient des machines virtuelles qui ne font pas partie du groupe à haute disponibilité, même si le service hébergé en contient une.</span><span class="sxs-lookup"><span data-stu-id="01c11-149">Migration is not supported for Deployment {deployment-name} in HostedService {hosted-service-name because it has VMs that are not part of the Availability Set even though the HostedService contains one.</span></span> |<span data-ttu-id="01c11-150">La solution de contournement de ce scénario consiste à déplacer toutes les machines virtuelles dans un même groupe à haute disponibilité ou à supprimer toutes les machines virtuelles du groupe à haute disponibilité dans le service hébergé.</span><span class="sxs-lookup"><span data-stu-id="01c11-150">The workaround for this scenario is to either move all the virtual machines into a single Availability set or remove all Virtual machines from the Availability set in the hosted service.</span></span> |
| <span data-ttu-id="01c11-151">Le compte de stockage/service hébergé/réseau virtuel {virtual-network-name} est en cours de migration et, par conséquent, n’est pas modifiable.</span><span class="sxs-lookup"><span data-stu-id="01c11-151">Storage account/HostedService/Virtual Network {virtual-network-name} is in the process of being migrated and hence cannot be changed</span></span> |<span data-ttu-id="01c11-152">Cette erreur se produit lorsque l’opération de migration « Préparer » a été effectuée sur la ressource et qu’une opération susceptible d’apporter une modification à la ressource est déclenchée.</span><span class="sxs-lookup"><span data-stu-id="01c11-152">This error happens when the "Prepare" migration operation has been completed on the resource and an operation that would make a change to the resource is triggered.</span></span> <span data-ttu-id="01c11-153">En raison du verrouillage du plan de gestion après l’opération « Préparer », les modifications apportées à la ressource sont bloquées.</span><span class="sxs-lookup"><span data-stu-id="01c11-153">Because of the lock on the management plane after "Prepare" operation, any changes to the resource are blocked.</span></span> <span data-ttu-id="01c11-154">Pour déverrouiller le plan de gestion, vous pouvez exécuter l’opération de migration « Valider » pour terminer la migration ou l’opération de migration « Abandonner » pour annuler l’opération « Préparer ».</span><span class="sxs-lookup"><span data-stu-id="01c11-154">To unlock the management plane, you can run the "Commit" migration operation to complete migration or the "Abort" migration operation to roll back the "Prepare" operation.</span></span> |
| <span data-ttu-id="01c11-155">La migration n’est pas autorisée pour le service hébergé {hosted-service-name} car il contient une machine virtuelle {vm-name} à l’état : RoleStateUnknown.</span><span class="sxs-lookup"><span data-stu-id="01c11-155">Migration is not allowed for HostedService {hosted-service-name} because it has VM {vm-name} in State: RoleStateUnknown.</span></span> <span data-ttu-id="01c11-156">La migration n’est autorisée que lorsque la machine virtuelle est à l’un des états suivants : En cours d’exécution, Arrêtée, Arrêtée libérée.</span><span class="sxs-lookup"><span data-stu-id="01c11-156">Migration is allowed only when the VM is in one of the following states - Running, Stopped, Stopped Deallocated.</span></span> |<span data-ttu-id="01c11-157">La machine virtuelle peut être en cours de transition d’état, ce qui se produit habituellement lors d’une opération de mise à jour sur le service hébergé, comme un redémarrage, l’installation d’une extension, etc. Il est recommandé d’attendre que l’opération de mise à jour soit terminée sur le service hébergé avant d’essayer d’effectuer la migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-157">The VM might be undergoing through a state transition, which usually happens when during an update operation on the HostedService such as a reboot, extension installation etc. It is recommended for the update operation to complete on the HostedService before trying migration.</span></span> |
| <span data-ttu-id="01c11-158">Le déploiement {nom} dans le service hébergé {nom} contient une machine virtuelle {nom} avec un disque de données {nom} dont les octets de taille d’objet Blob physique {taille} ne correspondent pas aux octets de taille logique de disque de données de la machine virtuelle {taille}.</span><span class="sxs-lookup"><span data-stu-id="01c11-158">Deployment {deployment-name} in HostedService {hosted-service-name} contains a VM {vm-name} with Data Disk {data-disk-name} whose physical blob size {size-of-the-vhd-blob-backing-the-data-disk} bytes does not match the VM Data Disk logical size {size-of-the-data-disk-specified-in-the-vm-api} bytes.</span></span> <span data-ttu-id="01c11-159">La migration se déroule sans spécifier une taille pour le disque de données pour la machine virtuelle Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-159">Migration will proceed without specifying a size for the data disk for the Azure Resource Manager VM.</span></span> | <span data-ttu-id="01c11-160">Cette erreur se produit si vous avez redimensionné l’objet Blob de disque dur virtuel sans mettre à jour la taille du modèle de l’API de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="01c11-160">This error happens if you've resized the VHD blob without updating the size in the VM API model.</span></span> <span data-ttu-id="01c11-161">Vous trouverez les étapes de correction détaillées [ci-dessous](#vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes).</span><span class="sxs-lookup"><span data-stu-id="01c11-161">Detailed mitigation steps are outlined [below](#vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes).</span></span>|
| <span data-ttu-id="01c11-162">Une exception de stockage s’est produite lors de la validation du disque de données {nom du disque de données} avec le lien du support {URI du disque de données} pour la machine virtuelle {nom de la machine virtuelle} dans le service cloud {nom du service cloud}.</span><span class="sxs-lookup"><span data-stu-id="01c11-162">A storage exception occurred while validating data disk {data disk name} with media link {data disk Uri} for VM {VM name} in Cloud Service {Cloud Service name}.</span></span> <span data-ttu-id="01c11-163">Veuillez vous assurer que le lien du support de disque dur virtuel est accessible pour cette machine virtuelle</span><span class="sxs-lookup"><span data-stu-id="01c11-163">Please ensure that the VHD media link is accessible for this virtual machine</span></span> | <span data-ttu-id="01c11-164">Cette erreur peut se produire si les disques de la machine virtuelle ont été supprimés ou ne sont pas plus accessibles.</span><span class="sxs-lookup"><span data-stu-id="01c11-164">This error can happen if the disks of the VM have been deleted or are not accessible anymore.</span></span> <span data-ttu-id="01c11-165">Vérifiez que les disques de la machine virtuelle existent.</span><span class="sxs-lookup"><span data-stu-id="01c11-165">Please make sure the disks for the VM exist.</span></span>|
| <span data-ttu-id="01c11-166">La machine virtuelle {nom de la machine virtuelle} dans le service hébergé {nom du service cloud} contient un disque avec un élément MediaLink {vhd-uri} ayant le nom d’objet blob {vhd-nom d’objet blob} qui n’est pas pris en charge dans Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="01c11-166">VM {vm-name} in HostedService {cloud-service-name} contains Disk with MediaLink {vhd-uri} which has blob name {vhd-blob-name}  that is not supported in Azure Resource Manager.</span></span> | <span data-ttu-id="01c11-167">Cette erreur se produit lorsque le nom de l’objet blob comporte un « / » lequel n’est pas pris en charge dans le fournisseur de ressources de calcul actuellement.</span><span class="sxs-lookup"><span data-stu-id="01c11-167">This error occurs when the name of the blob has a "/" in it which is not supported in Compute Resource Provider currently.</span></span> |
| <span data-ttu-id="01c11-168">La migration n’est pas autorisée pour le déploiement {deployment-name} dans le service hébergé {cloud-service-name}, car celui-ci ne se trouve pas dans l’étendue régionale.</span><span class="sxs-lookup"><span data-stu-id="01c11-168">Migration is not allowed for Deployment {deployment-name} in HostedService {cloud-service-name} as it is not in the regional scope.</span></span> <span data-ttu-id="01c11-169">Consultez l’adresse http://aka.ms/regionalscope pour déplacer ce déploiement vers l’étendue régionale.</span><span class="sxs-lookup"><span data-stu-id="01c11-169">Please refer to http://aka.ms/regionalscope for moving this deployment to regional scope.</span></span> | <span data-ttu-id="01c11-170">En 2014, Azure a annoncé que les ressources réseau allaient être déplacées d’une étendue de niveau cluster vers une étendue régionale.</span><span class="sxs-lookup"><span data-stu-id="01c11-170">In 2014, Azure announced that networking resources will move from a cluster level scope to regional scope.</span></span> <span data-ttu-id="01c11-171">Pour plus d’informations ( http://aka.ms/regionalscope ), consultez l’article [ http://aka.ms/regionalscope ].</span><span class="sxs-lookup"><span data-stu-id="01c11-171">See [http://aka.ms/regionalscope] for more details (http://aka.ms/regionalscope).</span></span> <span data-ttu-id="01c11-172">Cette erreur se produit lorsque le déploiement en cours de migration n’a pas fait l’objet d’une opération de mise à jour qui le déplace automatiquement vers une étendue régionale.</span><span class="sxs-lookup"><span data-stu-id="01c11-172">This error happens when the deployment being migrated has not had an update operation, which automatically moves it to a regional scope.</span></span> <span data-ttu-id="01c11-173">Le meilleur moyen de contourner ce problème consiste à ajouter un point de terminaison à une machine virtuelle ou à un disque de données dans la machine virtuelle, puis à retenter la migration.</span><span class="sxs-lookup"><span data-stu-id="01c11-173">Best workaround is to either add an endpoint to a VM or a data disk to the VM and then retry migration.</span></span> <br> <span data-ttu-id="01c11-174">Pour plus d’informations, consultez l’article [Comment configurer des points de terminaison sur une machine virtuelle Windows classique dans Azure](../articles/virtual-machines/windows/classic/setup-endpoints.md#create-an-endpoint) ou [Attacher un disque de données à une machine virtuelle Windows créée avec le modèle de déploiement classique](../articles/virtual-machines/windows/classic/attach-disk.md).</span><span class="sxs-lookup"><span data-stu-id="01c11-174">See [How to set up endpoints on a classic Windows virtual machine in Azure](../articles/virtual-machines/windows/classic/setup-endpoints.md#create-an-endpoint) or [Attach a data disk to a Windows virtual machine created with the classic deployment model](../articles/virtual-machines/windows/classic/attach-disk.md)</span></span>|


## <a name="detailed-mitigations"></a><span data-ttu-id="01c11-175">Étapes de correction détaillées</span><span class="sxs-lookup"><span data-stu-id="01c11-175">Detailed mitigations</span></span>

### <a name="vm-with-data-disk-whose-physical-blob-size-bytes-does-not-match-the-vm-data-disk-logical-size-bytes"></a><span data-ttu-id="01c11-176">Une machine virtuelle avec un disque de données dont les octets de taille d’objet Blob physique ne correspondent pas à ceux de la taille logique du disque de données de la machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="01c11-176">VM with Data Disk whose physical blob size bytes does not match the VM Data Disk logical size bytes.</span></span>

<span data-ttu-id="01c11-177">Cela se produit lorsque la taille logique du disque de données est désynchronisée avec celle de l’objet Blob de disque dur virtuel réel.</span><span class="sxs-lookup"><span data-stu-id="01c11-177">This happens when the Data disk logical size can get out of sync with the actual VHD blob size.</span></span> <span data-ttu-id="01c11-178">Vous pouvez facilement vérifier cela à l’aide des commandes suivantes :</span><span class="sxs-lookup"><span data-stu-id="01c11-178">This can be easily verified using the following commands:</span></span>

#### <a name="verifying-the-issue"></a><span data-ttu-id="01c11-179">Vérification du problème</span><span class="sxs-lookup"><span data-stu-id="01c11-179">Verifying the issue</span></span>

```PowerShell
# Store the VM details in the VM object
$vm = Get-AzureVM -ServiceName $servicename -Name $vmname

# Display the data disk properties
# NOTE the data disk LogicalDiskSizeInGB below which is 11GB. Also note the MediaLink Uri of the VHD blob as we'll use this in the next step
$vm.VM.DataVirtualHardDisks


HostCaching         : None
DiskLabel           : 
DiskName            : coreosvm-coreosvm-0-201611230636240687
Lun                 : 0
LogicalDiskSizeInGB : 11
MediaLink           : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
SourceMediaLink     : 
IOType              : Standard
ExtensionData       : 

# Now get the properties of the blob backing the data disk above
# NOTE the size of the blob is about 15 GB which is different from LogicalDiskSizeInGB above
$blob = Get-AzureStorageblob -Blob "coreosvm-dd1.vhd" -Container vhds 

$blob

ICloudBlob        : Microsoft.WindowsAzure.Storage.Blob.CloudPageBlob
BlobType          : PageBlob
Length            : 16106127872
ContentType       : application/octet-stream
LastModified      : 11/23/2016 7:16:22 AM +00:00
SnapshotTime      : 
ContinuationToken : 
Context           : Microsoft.WindowsAzure.Commands.Common.Storage.AzureStorageContext
Name              : coreosvm-dd1.vhd
```

#### <a name="mitigating-the-issue"></a><span data-ttu-id="01c11-180">Correction du problème</span><span class="sxs-lookup"><span data-stu-id="01c11-180">Mitigating the issue</span></span>

```PowerShell
# Convert the blob size in bytes to GB into a variable which we'll use later
$newSize = [int]($blob.Length / 1GB)

# See the calculated size in GB
$newSize

15

# Store the disk name of the data disk as we'll use this to identify the disk to be updated
$diskName = $vm.VM.DataVirtualHardDisks[0].DiskName

# Identify the LUN of the data disk to remove
$lunToRemove = $vm.VM.DataVirtualHardDisks[0].Lun

# Now remove the data disk from the VM so that the disk isn't leased by the VM and it's size can be updated
Remove-AzureDataDisk -LUN $lunToRemove -VM $vm | Update-AzureVm -Name $vmname -ServiceName $servicename

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureVM       213xx1-b44b-1v6n-23gg-591f2a13cd16   Succeeded  

# Verify we have the right disk that's going to be updated
Get-AzureDisk -DiskName $diskName

AffinityGroup        : 
AttachedTo           : 
IsCorrupted          : False
Label                : 
Location             : East US
DiskSizeInGB         : 11
MediaLink            : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
DiskName             : coreosvm-coreosvm-0-201611230636240687
SourceImageName      : 
OS                   : 
IOType               : Standard
OperationDescription : Get-AzureDisk
OperationId          : 0c56a2b7-a325-123b-7043-74c27d5a61fd
OperationStatus      : Succeeded

# Now update the disk to the new size
Update-AzureDisk -DiskName $diskName -ResizedSizeInGB $newSize -Label $diskName

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureDisk     cv134b65-1b6n-8908-abuo-ce9e395ac3e7 Succeeded 

# Now verify that the "DiskSizeInGB" property of the disk matches the size of the blob 
Get-AzureDisk -DiskName $diskName


AffinityGroup        : 
AttachedTo           : 
IsCorrupted          : False
Label                : coreosvm-coreosvm-0-201611230636240687
Location             : East US
DiskSizeInGB         : 15
MediaLink            : https://contosostorage.blob.core.windows.net/vhds/coreosvm-dd1.vhd
DiskName             : coreosvm-coreosvm-0-201611230636240687
SourceImageName      : 
OS                   : 
IOType               : Standard
OperationDescription : Get-AzureDisk
OperationId          : 1v53bde5-cv56-5621-9078-16b9c8a0bad2
OperationStatus      : Succeeded

# Now we'll add the disk back to the VM as a data disk. First we need to get an updated VM object
$vm = Get-AzureVM -ServiceName $servicename -Name $vmname

Add-AzureDataDisk -Import -DiskName $diskName -LUN 0 -VM $vm -HostCaching ReadWrite | Update-AzureVm -Name $vmname -ServiceName $servicename

OperationDescription OperationId                          OperationStatus
-------------------- -----------                          ---------------
Update-AzureVM       b0ad3d4c-4v68-45vb-xxc1-134fd010d0f8 Succeeded      
```

### <a name="moving-a-vm-to-a-different-subscription-after-completing-migration"></a><span data-ttu-id="01c11-181">Déplacer une machine virtuelle vers un autre abonnement après la fin de la migration</span><span class="sxs-lookup"><span data-stu-id="01c11-181">Moving a VM to a different subscription after completing migration</span></span>

<span data-ttu-id="01c11-182">Après avoir terminé le processus de migration, vous souhaiterez peut-être déplacer la machine virtuelle vers un autre abonnement.</span><span class="sxs-lookup"><span data-stu-id="01c11-182">After you complete the migration process, you may want to move the VM to another subscription.</span></span> <span data-ttu-id="01c11-183">Toutefois, si vous avez une clé secrète ou un certificat sur la machine virtuelle qui fait référence à une ressource Key Vault, le déplacement n’est actuellement pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="01c11-183">However, if you have a secret/certificate on the VM that references a Key Vault resource, the move is currently not supported.</span></span> <span data-ttu-id="01c11-184">Les instructions ci-dessous vous permettent de contourner le problème.</span><span class="sxs-lookup"><span data-stu-id="01c11-184">The below instructions will allow you to workaround the issue.</span></span> 

#### <a name="powershell"></a><span data-ttu-id="01c11-185">PowerShell</span><span class="sxs-lookup"><span data-stu-id="01c11-185">PowerShell</span></span>
```powershell
$vm = Get-AzureRmVM -ResourceGroupName "MyRG" -Name "MyVM"
Remove-AzureRmVMSecret -VM $vm
Update-AzureRmVM -ResourceGroupName "MyRG" -VM $vm
```
#### <a name="azure-cli-20"></a><span data-ttu-id="01c11-186">Azure CLI 2.0</span><span class="sxs-lookup"><span data-stu-id="01c11-186">Azure CLI 2.0</span></span>

```bash
az vm update -g "myrg" -n "myvm" --set osProfile.Secrets=[]
```
