> [!div class="op_single_selector"]
> * [<span data-ttu-id="e68ce-101">Linux</span><span class="sxs-lookup"><span data-stu-id="e68ce-101">Linux</span></span>](../articles/iot-hub/iot-hub-linux-iot-edge-simulated-device.md)
> * [<span data-ttu-id="e68ce-102">Windows</span><span class="sxs-lookup"><span data-stu-id="e68ce-102">Windows</span></span>](../articles/iot-hub/iot-hub-windows-iot-edge-simulated-device.md)

<span data-ttu-id="e68ce-103">Cette procédure pas à pas de hello [Cloud d’appareil simulé télécharger l’exemple] vous montre comment toouse [Azure IoT bord] [ lnk-sdk] toosend appareil-à-cloud télémétrie tooIoT concentrateur de simulé appareils.</span><span class="sxs-lookup"><span data-stu-id="e68ce-103">This walkthrough of hello [Simulated Device Cloud Upload sample] shows you how toouse [Azure IoT Edge][lnk-sdk] toosend device-to-cloud telemetry tooIoT Hub from simulated devices.</span></span>

<span data-ttu-id="e68ce-104">Cette procédure pas à pas inclut les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="e68ce-104">This walkthrough covers:</span></span>

* <span data-ttu-id="e68ce-105">**Architecture**: architecture informations hello [Cloud d’appareil simulé télécharger l’exemple].</span><span class="sxs-lookup"><span data-stu-id="e68ce-105">**Architecture**: architectural information about hello [Simulated Device Cloud Upload sample].</span></span>
* <span data-ttu-id="e68ce-106">**Générez et exécutez**: toobuild de hello étapes requis et exemple hello d’exécution.</span><span class="sxs-lookup"><span data-stu-id="e68ce-106">**Build and run**: hello steps required toobuild and run hello sample.</span></span>

## <a name="architecture"></a><span data-ttu-id="e68ce-107">Architecture</span><span class="sxs-lookup"><span data-stu-id="e68ce-107">Architecture</span></span>

<span data-ttu-id="e68ce-108">Hello [Cloud d’appareil simulé télécharger l’exemple] montre comment toocreate une passerelle qui envoie les données de télémétrie des simulée IoT hub tooan de périphériques.</span><span class="sxs-lookup"><span data-stu-id="e68ce-108">hello [Simulated Device Cloud Upload sample] shows how toocreate a gateway that sends telemetry from simulated devices tooan IoT hub.</span></span> <span data-ttu-id="e68ce-109">Un périphérique n’est peut-être pas en mesure de tooconnect directement tooIoT Hub, car les périphériques hello :</span><span class="sxs-lookup"><span data-stu-id="e68ce-109">A device may not be able tooconnect directly tooIoT Hub because hello device:</span></span>

* <span data-ttu-id="e68ce-110">L’appareil n’utilise pas un protocole de communication compris par IoT Hub</span><span class="sxs-lookup"><span data-stu-id="e68ce-110">Does not use a communications protocol understood by IoT Hub.</span></span>
* <span data-ttu-id="e68ce-111">N’est pas assez intelligente tooremember hello identité attribuée tooit par IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-111">Is not smart enough tooremember hello identity assigned tooit by IoT Hub.</span></span>

<span data-ttu-id="e68ce-112">Une passerelle IoT peut résoudre ces problèmes Bonjour suivant façons :</span><span class="sxs-lookup"><span data-stu-id="e68ce-112">An IoT Edge gateway can solve these problems in hello following ways:</span></span>

* <span data-ttu-id="e68ce-113">passerelle de Hello comprend protocole hello utilisée par des appareils hello, reçoit les données de télémétrie appareil-à-cloud à partir de l’appareil de hello et transmet ces tooIoT messages concentrateur à l’aide d’un protocole compris par IoT hub de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-113">hello gateway understands hello protocol used by hello device, receives device-to-cloud telemetry from hello device, and forwards those messages tooIoT Hub using a protocol understood by hello IoT hub.</span></span>

* <span data-ttu-id="e68ce-114">passerelle de Hello mappe toodevices d’identités IoT Hub et agit comme un proxy lorsqu’un appareil envoie des messages tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-114">hello gateway maps IoT Hub identities toodevices and acts as a proxy when a device sends messages tooIoT Hub.</span></span>

<span data-ttu-id="e68ce-115">Hello suivant schéma montre hello les principaux composants de l’exemple hello, y compris hello les modules IoT bord :</span><span class="sxs-lookup"><span data-stu-id="e68ce-115">hello following diagram shows hello main components of hello sample, including hello IoT Edge modules:</span></span>

![][1]

<span data-ttu-id="e68ce-116">les modules Hello ne passent pas de messages directement tooeach autres.</span><span class="sxs-lookup"><span data-stu-id="e68ce-116">hello modules do not pass messages directly tooeach other.</span></span> <span data-ttu-id="e68ce-117">les modules Hello publier des messages tooan interne service broker remet toohello de messages hello autres modules à l’aide d’un mécanisme d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="e68ce-117">hello modules publish messages tooan internal broker that delivers hello messages toohello other modules using a subscription mechanism.</span></span> <span data-ttu-id="e68ce-118">Pour plus d’informations, voir [Get started with Azure IoT Edge (Prise en main d’Azure IoT Edge)][lnk-gw-getstarted].</span><span class="sxs-lookup"><span data-stu-id="e68ce-118">For more information, see [Get started with Azure IoT Edge][lnk-gw-getstarted].</span></span>

### <a name="protocol-ingestion-module"></a><span data-ttu-id="e68ce-119">Module d'ingestion de protocole</span><span class="sxs-lookup"><span data-stu-id="e68ce-119">Protocol ingestion module</span></span>

<span data-ttu-id="e68ce-120">Ce module est hello point de départ pour recevoir des données à partir de périphériques, via la passerelle de hello et dans le cloud de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-120">This module is hello starting point for receiving data from devices, through hello gateway, and into hello cloud.</span></span> <span data-ttu-id="e68ce-121">Dans l’exemple hello, hello module :</span><span class="sxs-lookup"><span data-stu-id="e68ce-121">In hello sample, hello module:</span></span>

1. <span data-ttu-id="e68ce-122">Crée les données de la température simulée.</span><span class="sxs-lookup"><span data-stu-id="e68ce-122">Creates simulated temperature data.</span></span> <span data-ttu-id="e68ce-123">Si vous utilisez des périphériques physiques, module de hello lit les données à partir de ces périphériques physiques.</span><span class="sxs-lookup"><span data-stu-id="e68ce-123">If you use physical devices, hello module reads data from those physical devices.</span></span>
1. <span data-ttu-id="e68ce-124">Crée un message.</span><span class="sxs-lookup"><span data-stu-id="e68ce-124">Creates a message.</span></span>
1. <span data-ttu-id="e68ce-125">Place les données de température hello simulé dans le contenu du message hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-125">Places hello simulated temperature data into hello message content.</span></span>
1. <span data-ttu-id="e68ce-126">Ajoute une propriété avec un message factice de toohello d’adresse MAC.</span><span class="sxs-lookup"><span data-stu-id="e68ce-126">Adds a property with a fake MAC address toohello message.</span></span>
1. <span data-ttu-id="e68ce-127">Rend le module de hello message toohello disponible suivant dans la chaîne de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-127">Makes hello message available toohello next module in hello chain.</span></span>

<span data-ttu-id="e68ce-128">module Hello appelé **ingestion de protocole X** Bonjour diagramme précédent est appelé **appareil simulé** dans le code source de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-128">hello module called **Protocol X ingestion** in hello previous diagram is called **Simulated device** in hello source code.</span></span>

### <a name="mac-lt-gt-iot-hub-id-module"></a><span data-ttu-id="e68ce-129">MAC &lt;-&gt; IoT Hub ID module</span><span class="sxs-lookup"><span data-stu-id="e68ce-129">MAC &lt;-&gt; IoT Hub ID module</span></span>

<span data-ttu-id="e68ce-130">Ce module analyse les messages dotés d’une propriété d’adresse Mac.</span><span class="sxs-lookup"><span data-stu-id="e68ce-130">This module scans for messages that have a Mac address property.</span></span> <span data-ttu-id="e68ce-131">Dans l’exemple hello, module de réception du protocole hello ajoute la propriété d’adresse MAC hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-131">In hello sample, hello protocol ingestion module adds hello MAC address property.</span></span> <span data-ttu-id="e68ce-132">Si le module de hello détecte une telle propriété, il ajoute une autre propriété avec un message de clé toohello appareil IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-132">If hello module finds such a property, it adds another property with an IoT Hub device key toohello message.</span></span> <span data-ttu-id="e68ce-133">module de Hello rend ensuite le module de hello message toohello disponible suivant dans la chaîne de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-133">hello module then makes hello message available toohello next module in hello chain.</span></span>

<span data-ttu-id="e68ce-134">développement de Hello définit un mappage entre les adresses MAC et appareils de hello simulée IoT Hub identités tooassociate avec les identités des appareils IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-134">hello developer sets up a mapping between MAC addresses and IoT Hub identities tooassociate hello simulated devices with IoT Hub device identities.</span></span> <span data-ttu-id="e68ce-135">développeur de Hello ajoute manuellement le mappage de hello dans le cadre de la configuration du module hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-135">hello developer adds hello mapping manually as part of hello module configuration.</span></span>

> [!NOTE]
> <span data-ttu-id="e68ce-136">Cet exemple utilise une adresse MAC comme identificateur unique de l'appareil et la met en corrélation avec une identité d'appareil IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-136">This sample uses a MAC address as a unique device identifier and correlates it with an IoT Hub device identity.</span></span> <span data-ttu-id="e68ce-137">Toutefois, vous pouvez écrire votre propre module qui utilise un autre identificateur unique.</span><span class="sxs-lookup"><span data-stu-id="e68ce-137">However, you can write your own module that uses a different unique identifier.</span></span> <span data-ttu-id="e68ce-138">Par exemple, vos appareils peuvent avoir des numéros de série uniques ou les données de télémétrie hello peuvent inclure un nom de périphérique intégré unique.</span><span class="sxs-lookup"><span data-stu-id="e68ce-138">For example, your devices may have unique serial numbers or hello telemetry data may include a unique embedded device name.</span></span>

### <a name="iot-hub-communication-module"></a><span data-ttu-id="e68ce-139">Module de communication IoT Hub</span><span class="sxs-lookup"><span data-stu-id="e68ce-139">IoT Hub communication module</span></span>

<span data-ttu-id="e68ce-140">Ce module prend les messages avec un IoT Hub propriété de clé de périphérique qui a été affectée par le module précédent de hello.</span><span class="sxs-lookup"><span data-stu-id="e68ce-140">This module takes messages with an IoT Hub device key property that was assigned by hello previous module.</span></span> <span data-ttu-id="e68ce-141">module de Hello envoie un message de type hello tooIoT contenu concentrateur à l’aide de hello le protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="e68ce-141">hello module sends hello message content tooIoT Hub using hello HTTP protocol.</span></span> <span data-ttu-id="e68ce-142">HTTP est un des hello trois protocoles compris par IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="e68ce-142">HTTP is one of hello three protocols understood by IoT Hub.</span></span>

<span data-ttu-id="e68ce-143">Au lieu d’ouvrir une connexion pour chaque appareil simulé, ce module ouvre une connexion HTTP à partir de la toohello IoT hub hello passerelle.</span><span class="sxs-lookup"><span data-stu-id="e68ce-143">Instead of opening a connection for each simulated device, this module opens a single HTTP connection from hello gateway toohello IoT hub.</span></span> <span data-ttu-id="e68ce-144">module de Hello multiplexage puis des connexions à partir de tous les appareils hello simulée sur cette connexion.</span><span class="sxs-lookup"><span data-stu-id="e68ce-144">hello module then multiplexes connections from all hello simulated devices over that connection.</span></span> <span data-ttu-id="e68ce-145">Cette approche permet un tooconnect passerelle unique plus grand nombre d’appareils.</span><span class="sxs-lookup"><span data-stu-id="e68ce-145">This approach enables a single gateway tooconnect many more devices.</span></span>

## <a name="before-you-get-started"></a><span data-ttu-id="e68ce-146">Avant de commencer</span><span class="sxs-lookup"><span data-stu-id="e68ce-146">Before you get started</span></span>

<span data-ttu-id="e68ce-147">Avant de commencer, vous devez :</span><span class="sxs-lookup"><span data-stu-id="e68ce-147">Before you get started, you must:</span></span>

* <span data-ttu-id="e68ce-148">[Créez un hub IoT] [ lnk-create-hub] dans votre abonnement Azure, vous devez fournir hello nom de votre concentrateur de toocomplete cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="e68ce-148">[Create an IoT hub][lnk-create-hub] in your Azure subscription, you need hello name of your hub toocomplete this walkthrough.</span></span> <span data-ttu-id="e68ce-149">Si vous ne possédez pas de compte, vous pouvez créer un [compte gratuit][lnk-free-trial] en quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="e68ce-149">If you don't have an account, you can create a [free account][lnk-free-trial] in just a couple of minutes.</span></span>
* <span data-ttu-id="e68ce-150">Ajouter deux périphériques tooyour IoT hub et prenez note de leur ID et les clés de l’appareil.</span><span class="sxs-lookup"><span data-stu-id="e68ce-150">Add two devices tooyour IoT hub and make a note of their ids and device keys.</span></span> <span data-ttu-id="e68ce-151">Vous pouvez utiliser hello [Explorateur de périphérique] [ lnk-device-explorer] ou [iothub-explorer] [ lnk-iothub-explorer] outil tooadd votre concentrateur de IoT toohello périphériques vous avez créé dans hello précédente étape et récupérer leurs clés.</span><span class="sxs-lookup"><span data-stu-id="e68ce-151">You can use hello [device explorer][lnk-device-explorer] or [iothub-explorer][lnk-iothub-explorer] tool tooadd your devices toohello IoT hub you created in hello previous step and retrieve their keys.</span></span>

![][2]

<!-- Images -->
[1]: media/iot-hub-iot-edge-simulated-selector/image1.png
[2]: media/iot-hub-iot-edge-simulated-selector/image2.png

<!-- Links -->
[Cloud d’appareil simulé télécharger l’exemple]: https://github.com/Azure/iot-edge/blob/master/samples/simulated_device_cloud_upload/README.md
[lnk-sdk]: https://github.com/Azure/iot-edge
[lnk-gw-getstarted]: ../articles/iot-hub/iot-hub-linux-iot-edge-get-started.md
[lnk-free-trial]: https://azure.microsoft.com/pricing/free-trial/
[lnk-device-explorer]: https://github.com/Azure/azure-iot-sdk-csharp/tree/master/tools/DeviceExplorer
[lnk-iothub-explorer]: https://github.com/Azure/iothub-explorer/blob/master/readme.md
[lnk-create-hub]: ../articles/iot-hub/iot-hub-create-through-portal.md