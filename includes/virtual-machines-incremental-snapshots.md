# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="87b9f-101">Sauvegarder les disques de machines virtuelles Azure non gérés avec des captures instantanées incrémentielles</span><span class="sxs-lookup"><span data-stu-id="87b9f-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="87b9f-102">Vue d'ensemble</span><span class="sxs-lookup"><span data-stu-id="87b9f-102">Overview</span></span>
<span data-ttu-id="87b9f-103">Le stockage Azure fournit une fonctionnalité de hello tootake des instantanés d’objets BLOB.</span><span class="sxs-lookup"><span data-stu-id="87b9f-103">Azure Storage provides hello capability tootake snapshots of blobs.</span></span> <span data-ttu-id="87b9f-104">Instantanés capturent l’état de l’objet blob hello à ce stade dans le temps.</span><span class="sxs-lookup"><span data-stu-id="87b9f-104">Snapshots capture hello blob state at that point in time.</span></span> <span data-ttu-id="87b9f-105">Dans cet article, nous décrivons un scénario dans lequel vous pouvez gérer des sauvegardes de disques de machine virtuelle à l’aide de captures instantanées.</span><span class="sxs-lookup"><span data-stu-id="87b9f-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="87b9f-106">Vous pouvez utiliser cette méthode lorsque vous ne choisissez pas toouse sauvegarde Azure et Service de récupération et souhaits toocreate une stratégie de sauvegarde personnalisée pour vos disques de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="87b9f-106">You can use this methodology when you choose not toouse Azure Backup and Recovery Service, and wish toocreate a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="87b9f-107">Les disques de machine virtuelle Azure sont stockés en tant qu’objets blob de pages dans Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="87b9f-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="87b9f-108">Étant donné que nous décrivons une stratégie de sauvegarde pour les disques de machine virtuelle dans cet article, nous nous référons toosnapshots dans le contexte de hello d’objets BLOB de pages.</span><span class="sxs-lookup"><span data-stu-id="87b9f-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer toosnapshots in hello context of page blobs.</span></span> <span data-ttu-id="87b9f-109">toolearn savoir plus sur les captures instantanées, consultez trop[création d’un instantané d’un objet Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="87b9f-109">toolearn more about snapshots, refer too[Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="87b9f-110">Qu’est-ce qu’un instantané ?</span><span class="sxs-lookup"><span data-stu-id="87b9f-110">What is a snapshot?</span></span>
<span data-ttu-id="87b9f-111">Un instantané d’objet blob est une version en lecture seule d’un objet blob capturé à un instant donné.</span><span class="sxs-lookup"><span data-stu-id="87b9f-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="87b9f-112">Un instantané peut être lu, copié ou supprimé, mais pas modifié.</span><span class="sxs-lookup"><span data-stu-id="87b9f-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="87b9f-113">Instantanés fournissent un tooback moyen d’un objet blob, tel qu’il apparaît à un moment donné.</span><span class="sxs-lookup"><span data-stu-id="87b9f-113">Snapshots provide a way tooback up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="87b9f-114">Jusqu'à ce que le reste de la version 2015-04-05, vous aviez des captures instantanées de hello capacité toocopy complète.</span><span class="sxs-lookup"><span data-stu-id="87b9f-114">Until REST version 2015-04-05, you had hello ability toocopy full snapshots.</span></span> <span data-ttu-id="87b9f-115">Avec hello REST version 2015-08-07 et versions ultérieures, vous pouvez également copier des instantanés incrémentiels.</span><span class="sxs-lookup"><span data-stu-id="87b9f-115">With hello REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="87b9f-116">Copie d’un instantané complet</span><span class="sxs-lookup"><span data-stu-id="87b9f-116">Full snapshot copy</span></span>
<span data-ttu-id="87b9f-117">Les instantanés peuvent être copiées du compte de stockage tooanother en tant que les sauvegardes de l’objet blob de base hello tookeep blob.</span><span class="sxs-lookup"><span data-stu-id="87b9f-117">Snapshots can be copied tooanother storage account as a blob tookeep backups of hello base blob.</span></span> <span data-ttu-id="87b9f-118">Vous pouvez également copier un instantané sur l’objet blob de base, qui est similaire à la restauration hello blob tooan version antérieure.</span><span class="sxs-lookup"><span data-stu-id="87b9f-118">You can also copy a snapshot over its base blob, which is like restoring hello blob tooan earlier version.</span></span> <span data-ttu-id="87b9f-119">Lorsqu’un instantané est copié à partir d’un tooanother de compte de stockage, il occupe hello même espace en tant qu’objet blob de page de base hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-119">When a snapshot is copied from one storage account tooanother, it occupies hello same space as hello base page blob.</span></span> <span data-ttu-id="87b9f-120">Par conséquent, la copie d’instantanés entières à partir d’un tooanother de compte de stockage est lent et consomme la quantité d’espace dans le compte de stockage cible hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-120">Therefore, copying whole snapshots from one storage account tooanother is slow and consumes much space in hello target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="87b9f-121">Si vous copiez à destination de tooanother hello objet blob de base, les instantanés hello d’objet blob de hello ne sont pas copiés en même temps.</span><span class="sxs-lookup"><span data-stu-id="87b9f-121">If you copy hello base blob tooanother destination, hello snapshots of hello blob are not copied along with it.</span></span> <span data-ttu-id="87b9f-122">De même, si vous remplacez un objet blob de base avec une copie, instantanés associés d’objet blob de base hello ne sont pas affectés et restent intacts sous le nom d’objet blob de base hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with hello base blob are not affected and stay intact under hello base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="87b9f-123">Sauvegarder des disques à l’aide d’instantanés</span><span class="sxs-lookup"><span data-stu-id="87b9f-123">Back up disks using snapshots</span></span>
<span data-ttu-id="87b9f-124">En tant qu’une stratégie de sauvegarde pour vos disques de machine virtuelle, vous pouvez prendre des instantanés périodiques de l’objet blob de disque ou la page hello et copiez-les tooanother compte de stockage à l’aide des outils tels que [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) opération ou [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="87b9f-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of hello disk or page blob, and copy them tooanother storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="87b9f-125">Vous pouvez copier un instantané tooa page objet blob de destination avec un nom différent.</span><span class="sxs-lookup"><span data-stu-id="87b9f-125">You can copy a snapshot tooa destination page blob with a different name.</span></span> <span data-ttu-id="87b9f-126">Hello résultant destination objet blob de pages est un objet blob de page accessible en écriture et pas un instantané.</span><span class="sxs-lookup"><span data-stu-id="87b9f-126">hello resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="87b9f-127">Plus loin dans cet article, nous décrivons les sauvegardes de tootake étapes de disques de machine virtuelle à l’aide de captures instantanées.</span><span class="sxs-lookup"><span data-stu-id="87b9f-127">Later in this article, we describe steps tootake backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="87b9f-128">Restaurer des disques à l’aide d’instantanés</span><span class="sxs-lookup"><span data-stu-id="87b9f-128">Restore disks using snapshots</span></span>
<span data-ttu-id="87b9f-129">Lorsqu’il est toorestore temps votre tooa disque stable version qui a été précédemment capturée dans un des instantanés de sauvegarde hello, vous pouvez copier un instantané sur l’objet blob de page de base hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-129">When it is time toorestore your disk tooa stable version that was previously captured in one of hello backup snapshots, you can copy a snapshot over hello base page blob.</span></span> <span data-ttu-id="87b9f-130">Une fois l’instantané d’hello blob de page de base toohello promues, hello instantané est conservé, mais sa source est remplacée par une copie qui peut être lue et modifiée.</span><span class="sxs-lookup"><span data-stu-id="87b9f-130">After hello snapshot is promoted toohello base page blob, hello snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="87b9f-131">Plus loin dans cet article, nous décrivons étapes toorestore une version antérieure de votre disque à partir de son instantané.</span><span class="sxs-lookup"><span data-stu-id="87b9f-131">Later in this article we describe steps toorestore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="87b9f-132">Implémentation de la copie d’un instantané complet</span><span class="sxs-lookup"><span data-stu-id="87b9f-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="87b9f-133">Vous pouvez implémenter une capture instantanée complète en procédant comme suit de hello,</span><span class="sxs-lookup"><span data-stu-id="87b9f-133">You can implement a full snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="87b9f-134">Tout d’abord, prenez un instantané de hello objet blob de base à l’aide de hello [objet Blob instantané](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) opération.</span><span class="sxs-lookup"><span data-stu-id="87b9f-134">First, take a snapshot of hello base blob using hello [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="87b9f-135">Ensuite, copiez hello instantané tooa cible stockage compte à l’aide [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="87b9f-135">Then, copy hello snapshot tooa target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="87b9f-136">Répétez ce processus toomaintain sauvegarder votre objet blob de base.</span><span class="sxs-lookup"><span data-stu-id="87b9f-136">Repeat this process toomaintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="87b9f-137">Copie d’un instantané incrémentiel</span><span class="sxs-lookup"><span data-stu-id="87b9f-137">Incremental snapshot copy</span></span>
<span data-ttu-id="87b9f-138">nouvelle fonctionnalité de Hello Bonjour [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API fournit une quantité tooback façon mieux des instantanés hello de vos objets BLOB de pages ou de disques.</span><span class="sxs-lookup"><span data-stu-id="87b9f-138">hello new feature in hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way tooback up hello snapshots of your page blobs or disks.</span></span> <span data-ttu-id="87b9f-139">Hello API retourne liste hello des modifications entre l’objet blob de base hello et les instantanés de hello, ce qui réduit la quantité de hello d’espace de stockage utilisé sur le compte de sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-139">hello API returns hello list of changes between hello base blob and hello snapshots, which reduces hello amount of storage space used on hello backup account.</span></span> <span data-ttu-id="87b9f-140">Hello API prend en charge les objets BLOB de pages sur le stockage Premium ainsi que le stockage Standard.</span><span class="sxs-lookup"><span data-stu-id="87b9f-140">hello API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="87b9f-141">À l’aide de cette API, vous pouvez créer des solutions de sauvegarde plus rapides et efficaces pour les machines virtuelles Azure.</span><span class="sxs-lookup"><span data-stu-id="87b9f-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="87b9f-142">Cette API sera disponible avec hello REST version 2015-08-07 et versions ultérieures.</span><span class="sxs-lookup"><span data-stu-id="87b9f-142">This API will be available with hello REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="87b9f-143">La copie d’instantané incrémentielle vous permet de toocopy à partir d’un stockage compte tooanother hello différence,</span><span class="sxs-lookup"><span data-stu-id="87b9f-143">Incremental Snapshot Copy allows you toocopy from one storage account tooanother hello difference between,</span></span>

* <span data-ttu-id="87b9f-144">l’objet blob de base et son instantané OU</span><span class="sxs-lookup"><span data-stu-id="87b9f-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="87b9f-145">Les deux instantanés d’objet blob de base hello</span><span class="sxs-lookup"><span data-stu-id="87b9f-145">Any two snapshots of hello base blob</span></span>

<span data-ttu-id="87b9f-146">Condition hello conditions suivantes est remplie,</span><span class="sxs-lookup"><span data-stu-id="87b9f-146">Provided hello following conditions are met,</span></span>

* <span data-ttu-id="87b9f-147">objet blob de Hello a été créé sur Jan-01-2016 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="87b9f-147">hello blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="87b9f-148">objet blob de Hello n’a pas été enregistré avec [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) ou [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) entre deux instantanés.</span><span class="sxs-lookup"><span data-stu-id="87b9f-148">hello blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="87b9f-149">**Remarque**: cette fonctionnalité est disponible pour les objets blob de pages Azure Standard et Premium.</span><span class="sxs-lookup"><span data-stu-id="87b9f-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="87b9f-150">Lorsque vous disposez d’une stratégie de sauvegarde personnalisée à l’aide de captures instantanées, copie d’instantanés de hello à partir d’un tooanother de compte de stockage peut être lente et peut consommer l’espace de stockage.</span><span class="sxs-lookup"><span data-stu-id="87b9f-150">When you have a custom backup strategy using snapshots, copying hello snapshots from one storage account tooanother can be slow and can consume much storage space.</span></span> <span data-ttu-id="87b9f-151">Au lieu de copier un compte de stockage de sauvegarde tooa hello intégralité de l’instantané, vous pouvez écrire la différence hello entre un blob de page sauvegarde tooa instantanés consécutifs.</span><span class="sxs-lookup"><span data-stu-id="87b9f-151">Instead of copying hello entire snapshot tooa backup storage account, you can write hello difference between consecutive snapshots tooa backup page blob.</span></span> <span data-ttu-id="87b9f-152">De cette manière, le hello toocopy et hello espace toostore sauvegardes est sensiblement réduite.</span><span class="sxs-lookup"><span data-stu-id="87b9f-152">This way, hello time toocopy and hello space toostore backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="87b9f-153">Implémentation de la copie d’un instantané incrémentiel</span><span class="sxs-lookup"><span data-stu-id="87b9f-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="87b9f-154">Vous pouvez implémenter la copie d’instantané incrémentielle en procédant comme suit de hello,</span><span class="sxs-lookup"><span data-stu-id="87b9f-154">You can implement incremental snapshot copy by doing hello following,</span></span>

* <span data-ttu-id="87b9f-155">Prendre un instantané de l’utilisation de base blob hello [objet Blob instantané](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="87b9f-155">Take a snapshot of hello base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="87b9f-156">Copie hello instantané toohello cible stockage de sauvegarde compte à l’aide de [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="87b9f-156">Copy hello snapshot toohello target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="87b9f-157">Il s’agit d’objets blob de page sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-157">This is hello backup page blob.</span></span> <span data-ttu-id="87b9f-158">Prendre un instantané de l’objet blob de page sauvegarde hello et stockez-le dans un compte de sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-158">Take a snapshot of hello backup page blob and store it in hello backup account.</span></span>
* <span data-ttu-id="87b9f-159">Prendre une autre capture instantanée de hello objet blob de base à l’aide d’objet Blob instantané.</span><span class="sxs-lookup"><span data-stu-id="87b9f-159">Take another snapshot of hello base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="87b9f-160">Obtenir la différence hello entre les instantanés de première et deuxième hello de l’utilisation de base blob hello [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="87b9f-160">Get hello difference between hello first and second snapshots of hello base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="87b9f-161">Utilisez le paramètre hello **prevsnapshot**, toospecify hello hello capture instantanée différence de hello tooget avec la valeur DateTime.</span><span class="sxs-lookup"><span data-stu-id="87b9f-161">Use hello new parameter **prevsnapshot**, toospecify hello DateTime value of hello snapshot you want tooget hello difference with.</span></span> <span data-ttu-id="87b9f-162">Lorsque ce paramètre est présent, hello réponse REST inclut uniquement les pages de hello qui ont été modifiés entre l’instantané de la cible et l’instantané précédent, y compris les pages clairs.</span><span class="sxs-lookup"><span data-stu-id="87b9f-162">When this parameter is present, hello REST response includes only hello pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="87b9f-163">Utilisez [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply ces objets blob de modifications toohello page de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="87b9f-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) tooapply these changes toohello backup page blob.</span></span>
* <span data-ttu-id="87b9f-164">Enfin, prenez un instantané de l’objet blob de page sauvegarde hello et stockez-le dans le compte de stockage de sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-164">Finally, take a snapshot of hello backup page blob and store it in hello backup storage account.</span></span>

<span data-ttu-id="87b9f-165">Dans la section suivante de hello, nous allons examiner plus en détail comment vous pouvez gérer des sauvegardes de disques à l’aide de la copie d’instantané incrémentielle</span><span class="sxs-lookup"><span data-stu-id="87b9f-165">In hello next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="87b9f-166">Scénario</span><span class="sxs-lookup"><span data-stu-id="87b9f-166">Scenario</span></span>
<span data-ttu-id="87b9f-167">Dans cette section, nous décrivons un scénario qui implique une stratégie de sauvegarde personnalisée pour les disques de machine virtuelle à l’aide de captures instantanées.</span><span class="sxs-lookup"><span data-stu-id="87b9f-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="87b9f-168">Prenez une machine virtuelle Azure de série DS avec un disque P30 de stockage Premium attaché.</span><span class="sxs-lookup"><span data-stu-id="87b9f-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="87b9f-169">disque Hello P30 appelé *mypremiumdisk* est stocké dans un compte de stockage premium appelé *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-169">hello P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="87b9f-170">Un compte de stockage standard appelé *mybackupstdaccount* est utilisé pour stocker la sauvegarde hello de *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-170">A standard storage account called *mybackupstdaccount* is used for storing hello backup of *mypremiumdisk*.</span></span> <span data-ttu-id="87b9f-171">Nous aimerions tookeep un instantané de *mypremiumdisk* toutes les 12 heures.</span><span class="sxs-lookup"><span data-stu-id="87b9f-171">We would like tookeep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="87b9f-172">toolearn sur la création de compte de stockage et des disques, consultez trop[comptes de stockage sur Azure](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="87b9f-172">toolearn about creating storage account and disks, refer too[About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="87b9f-173">toolearn sur la sauvegarde des machines virtuelles Azure, consultez trop[les sauvegardes de Plan Azure VM](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="87b9f-173">toolearn about backing up Azure VMs, refer too[Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-toomaintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="87b9f-174">Sauvegardes de toomaintain étapes d’un disque à l’aide d’instantanés incrémentiels</span><span class="sxs-lookup"><span data-stu-id="87b9f-174">Steps toomaintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="87b9f-175">Hello étapes suivantes décrivent comment les instantanés tootake de *mypremiumdisk* et conservez des sauvegardes hello dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-175">hello following steps describe how tootake snapshots of *mypremiumdisk* and maintain hello backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="87b9f-176">sauvegarde Hello est un objet blob de page standard appelé *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-176">hello backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="87b9f-177">Hello objet blob de pages sauvegarde reflète toujours hello même état que l’instantané d’hello *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-177">hello backup page blob always reflects hello same state as hello last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="87b9f-178">Créer un objet blob de page sauvegarde hello pour le disque de stockage premium, en prenant un instantané de *mypremiumdisk* appelé *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-178">Create hello backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="87b9f-179">Copiez cette toomybackupstdaccount instantané en tant qu’objet blob de pages appelé *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-179">Copy this snapshot toomybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="87b9f-180">Prenez un instantané de *mybackupstdpageblob* nommé *mybackupstdpageblob_ss1*, à l’aide de [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob), et stockez-le dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="87b9f-181">Au cours de la fenêtre de sauvegarde hello, créer un nouvel instantané de *mypremiumdisk*, par exemple *mypremiumdisk_ss2*et les stocker dans *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-181">During hello backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="87b9f-182">Obtenir les modifications incrémentielles hello entre les instantanés hello deux, *mypremiumdisk_ss2* et *mypremiumdisk_ss1*, à l’aide [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) sur  *mypremiumdisk_ss2* avec hello **prevsnapshot** paramètre la valeur timestamp toohello de *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-182">Get hello incremental changes between hello two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with hello **prevsnapshot** parameter set toohello timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="87b9f-183">Écrire ces blob de page de sauvegarde des modifications incrémentielles toohello *mybackupstdpageblob* dans *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-183">Write these incremental changes toohello backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="87b9f-184">S’il existe des plages supprimés dans les modifications incrémentielles hello, elles doivent être effacées à partir de l’objet blob de page sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-184">If there are deleted ranges in hello incremental changes, they must be cleared from hello backup page blob.</span></span> <span data-ttu-id="87b9f-185">Utilisez [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) blob de page sauvegarde toohello toowrite les modifications incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="87b9f-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) toowrite incremental changes toohello backup page blob.</span></span>
6. <span data-ttu-id="87b9f-186">Prendre un instantané de l’objet blob de page sauvegarde hello *mybackupstdpageblob*, appelé *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-186">Take a snapshot of hello backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="87b9f-187">Supprimer l’instantané précédent de hello *mypremiumdisk_ss1* à partir du compte de stockage premium.</span><span class="sxs-lookup"><span data-stu-id="87b9f-187">Delete hello previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="87b9f-188">Répétez les étapes 4 à 6 pour chaque fenêtre de sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="87b9f-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="87b9f-189">De cette façon, vous pouvez gérer les sauvegardes de *mypremiumdisk* dans un compte de stockage Standard.</span><span class="sxs-lookup"><span data-stu-id="87b9f-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Sauvegarder un disque à l’aide d’instantanés incrémentiels](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-toorestore-a-disk-from-snapshots"></a><span data-ttu-id="87b9f-191">Étapes toorestore un disque d’instantanés</span><span class="sxs-lookup"><span data-stu-id="87b9f-191">Steps toorestore a disk from snapshots</span></span>
<span data-ttu-id="87b9f-192">Bonjour comme suit, décrivent comment toorestore hello disque premium, *mypremiumdisk* tooan instantané précédemment à partir du compte de stockage de sauvegarde hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-192">hello following steps, describe how toorestore hello premium disk, *mypremiumdisk* tooan earlier snapshot from hello backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="87b9f-193">Identifier hello point dans le temps que vous souhaitez toorestore hello premium disque.</span><span class="sxs-lookup"><span data-stu-id="87b9f-193">Identify hello point in time that you wish toorestore hello premium disk to.</span></span> <span data-ttu-id="87b9f-194">Supposons qu’il est snapshot *mybackupstdpageblob_ss2*, qui est stockée dans le compte de stockage de sauvegarde hello *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in hello backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="87b9f-195">Dans mybackupstdaccount, promouvoir l’instantané d’hello *mybackupstdpageblob_ss2* en tant que nouveau blob de page de base sauvegarde hello *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-195">In mybackupstdaccount, promote hello snapshot *mybackupstdpageblob_ss2* as hello new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="87b9f-196">Prenez un instantané de cet objet blob de pages de sauvegarde restauré appelé *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="87b9f-197">Objet blob de pages copie restaurée de hello *mybackupstdpageblobrestored* de *mybackupstdaccount* trop*mypremiumaccount* en tant que disque premium de la nouvelle hello  *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="87b9f-197">Copy hello restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* too*mypremiumaccount* as hello new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="87b9f-198">Prenez un instantané de *mypremiumdiskrestored*, appelé *mypremiumdiskrestored_ss1* pour les futures sauvegardes incrémentielles.</span><span class="sxs-lookup"><span data-stu-id="87b9f-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="87b9f-199">Point de série de hello DS disque de machine virtuelle toohello restauré *mypremiumdiskrestored* et détacher hello ancien *mypremiumdisk* à partir de la machine virtuelle de hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-199">Point hello DS series VM toohello restored disk *mypremiumdiskrestored* and detach hello old *mypremiumdisk* from hello VM.</span></span>
7. <span data-ttu-id="87b9f-200">Commencer les processus de sauvegarde hello décrites dans la section précédente pour le disque de hello restauré *mypremiumdiskrestored*, à l’aide de hello *mybackupstdpageblobrestored* en tant qu’objet blob de page sauvegarde hello.</span><span class="sxs-lookup"><span data-stu-id="87b9f-200">Begin hello Backup process described in previous section for hello restored disk *mypremiumdiskrestored*, using hello *mybackupstdpageblobrestored* as hello backup page blob.</span></span>

![Restaurer un disque à partir d’instantanés](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="87b9f-202">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="87b9f-202">Next Steps</span></span>
<span data-ttu-id="87b9f-203">Les liens de suivants de hello d’utilisation toolearn plus d’informations sur la création d’instantanés d’un objet blob et de planification de votre infrastructure de sauvegarde de machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="87b9f-203">Use hello following links toolearn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="87b9f-204">Création d’un instantané d’objet blob</span><span class="sxs-lookup"><span data-stu-id="87b9f-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="87b9f-205">Planification de votre infrastructure de sauvegarde de machines virtuelles</span><span class="sxs-lookup"><span data-stu-id="87b9f-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

